IGrooveFormsFieldColumnPropertiesPrivate.InitializeFieldViewColumnProperties(GrooveRunTimeData.g_pPropertyList, i_ViewName, i_FieldName, i_CPElement);
					
					ReplaceViewColumnPropertiesCache(i_FieldName, pIFormsFieldViewColumnProperties);

					Transaction.Commit();
					return pIFormsFieldViewColumnProperties;				
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}		
		}

		function SetDefaultColumnPropertiesForViewPriv(i_ViewName, i_FieldName, i_DefaultCount, i_TotalCount, i_CustomTotal, i_PixelTotal, i_SortOrder, i_bShowTwisty, i_ColumnHeader, i_Precision)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
				try
				{
					var CP = CreateColumnPropertiesPriv(i_ViewName, i_FieldName);
					var ViewName = i_ViewName;
					if ((typeof ViewName == "undefined" || ViewName == null) && GrooveRunTimeData.g_pIFormsToolDataModelPrivate.NewDatabaseViewID != null)
						ViewName = GrooveRunTimeData.g_pIFormsToolDataModelPrivate.NewDatabaseViewID;
					ApplyDefaultColumnProperties(CP, i_DefaultCount, i_TotalCount, i_CustomTotal, i_PixelTotal, ViewName, i_FieldName, i_SortOrder, i_bShowTwisty, i_ColumnHeader, i_Precision);
					ApplyColumnPropertiesPriv(CP, i_FieldName);
					Transaction.Commit();
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}			
		}

		function CreateColumnPropertyEnumPriv(i_FieldName)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
				try
				{
					var pViewColumnPropertiesCache = OpenCacheFromRunTimeData(GrooveRunTimeData.g_FieldColumnPropertiesCache, i_FieldName);
					var pColumnPropertyNameValueEnum = pViewColumnPropertiesCache.LockedCreateNameValueEnum();
					var CPEnum = CreateUnknownEnumFromStringIIDs("{BDD3700E-B207-482e-8642-0550843473A8}", "{01EDDEB5-FA50-495a-88C2-A91CC1F754B5}");
					while (pColumnPropertyNameValueEnum.HasMore())
					{
						var Pair = pColumnPropertyNameValueEnum.OpenNextPair();
						CPEnum.Add(Pair.Second);
					}
					Transaction.Commit();
					return CPEnum.IGrooveUnknownEnum;
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}			
		}

		function DoColumnPropertiesExistPriv(i_ViewName, i_FieldName)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var bHasCP = false;
				if (IsObjectInCache(i_FieldName, GrooveRunTimeData.g_FieldColumnPropertiesCache))
				{
					var pViewColumnPropertiesCache = OpenObjectFromCache(i_FieldName, GrooveRunTimeData.g_FieldColumnPropertiesCache);
					if (IsObjectInCache(i_ViewName, pViewColumnPropertiesCache))
						bHasCP = true;
				}
				
				CPSem.DoUnlock();
				return bHasCP;
			}
			catch(error)
			{
				CPSem.DoUnlock();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function OpenColumnPropertiesPriv(i_ViewName, i_FieldName)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				if (IsObjectInCache(i_FieldName, GrooveRunTimeData.g_FieldColumnPropertiesCache))
				{
					var pViewColumnPropertiesCache = OpenObjectFromCache(i_FieldName, GrooveRunTimeData.g_FieldColumnPropertiesCache);
					if (IsObjectInCache(i_ViewName, pViewColumnPropertiesCache))
					{
						var CP = OpenObjectFromCache(i_ViewName, pViewColumnPropertiesCache);
						if (CP.IGrooveFormsFieldColumnPropertiesPrivate.CPElement.IsValid())
							return CP;
						else
						{
							RemoveColumnPropertiesFromCache(i_ViewName, i_FieldName);
							var pField = OpenFormsFieldByName(i_FieldName);
							CreateColumnPropertiesCacheForField(pField);
							return OpenColumnPropertiesPriv(i_ViewName, i_FieldName);
						}
					}
					else
						return null;
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
			finally
			{
				CPSem.DoUnlock();
			}
		}

		function ApplyColumnPropertiesPriv(i_CP, i_FieldName)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
				try
				{
					StoreColumnProperties(i_FieldName, i_CP);
					// RSSToDo: Removed since this was now causing problems with Hugh's code.
					// would have removed anyway - must fix problems in our UI.
					//UpdateFieldsFile();
					Transaction.Commit();
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}				
		}

		function RemoveColumnPropertiesPriv(i_ViewName, i_FieldName, i_bUpdateFieldsFile)
		{
			GrooveDebugFunctions.DisplayAssert(i_ViewName != null, "Invalid View Name passed into RemoveColumnProperties");
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
				try
				{
					var pIField = OpenFormsFieldByName(i_FieldName);

					// Remove the column properties element from the field.
					if (pIField.IGrooveFormsFieldPrivate.FieldElement.ContentElementWithNameExists("urn:groove.net:ColumnProperties"))
					{
						var pColumnPropertiesElement = pIField.IGrooveFormsFieldPrivate.FieldElement.OpenContentElementByName("urn:groove.net:ColumnProperties");
						if (pColumnPropertiesElement.ContentElementWithNameAndAttributeExists("urn:groove.net:ColumnProperty", "ViewName", i_ViewName))
						{
							var CPElement = pColumnPropertiesElement.OpenContentElementByNameAndAttribute("urn:groove.net:ColumnProperty", "ViewName", i_ViewName)
							CPElement.Delete();
							if (!pIField.IsNew && i_bUpdateFieldsFile)
								UpdateFieldsFile();
						}
					}

					RemoveColumnPropertiesFromCache(i_ViewName, i_FieldName);
					
					Transaction.Commit();
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}				
		}

		function RemoveColumnPropertiesFromCache(i_ViewName, i_FieldName)
		{
			// Remove the column properties object from the cache.
			if (IsObjectInCache(i_FieldName, GrooveRunTimeData.g_FieldColumnPropertiesCache))
			{
				var pViewColumnPropertiesCache = OpenObjectFromCache(i_FieldName, GrooveRunTimeData.g_FieldColumnPropertiesCache);
				if (IsObjectInCache(i_ViewName, pViewColumnPropertiesCache))
				{
					RemoveObjectFromCache(i_ViewName, pViewColumnPropertiesCache);
					if (pViewColumnPropertiesCache.IsEmpty())
						RemoveObjectFromCache(i_FieldName, GrooveRunTimeData.g_FieldColumnPropertiesCache);
				}
			}
		}

		/*
		function ReadColumnPropertiesPriv(i_FieldName)
		{
			ReadColumnProperties(i_FieldName);
		}
		*/

		function GetFieldPropertiesPriv(i_pIField, i_PropertyName, i_PropertyType, i_PropertyLocation, i_RelativeValue, i_RelativePosition)
		{
			var FieldPropertiesNameValueEnum = GetFieldProperties(i_pIField, i_PropertyName, i_PropertyType, i_PropertyLocation, i_RelativeValue, i_RelativePosition);
			return FieldPropertiesNameValueEnum;
		}

		function GetFieldPropertiesElementPriv(i_FieldName)
		{
			var FieldPropertiesElement = int_GetPropertiesForField(i_FieldName);
			return FieldPropertiesElement;
		}

		function GetRelativePositionPriv(i_pIField, i_PropertyType, i_PropertyLocation)
		{
			var RelativePosition = GetRelativePosition(i_pIField, i_PropertyType, i_PropertyLocation);
			return RelativePosition;
		}

		function GetPropertyUnitPriv(i_pIField)
		{
			var PropertyUnit = GetPropertyUnit(i_pIField);
			return PropertyUnit;
		}

		function AddRemoveHTMLComponentToToolPriv(i_Type, i_Name, i_bAdd)
		{
			AddRemoveHTMLComponentToTool(i_Type, i_Name, i_bAdd);
		}

		function UpdateFieldsFile()
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
				try
				{
					if (typeof GrooveRunTimeData.g_pDatabase.IGrooveFormsSandbox != "undefined")
					{
						var DbID = GrooveRunTimeData.g_pDatabase.IGrooveFormsSandboxPrivate.OpenParentID();
						pDb = GrooveRunTimeData.g_pIFormsToolDataModel.OpenDatabase(DbID);
					}
					else
					{
						pDb = GrooveRunTimeData.g_pDatabase;
					}

					var pRootElement = GrooveRunTimeData.g_pFieldsDocument.OpenRootElement();
					var BIS = pRootElement.Serialize(GrooveSerializeType_XML, GrooveCharEncodingType_UTF8, GrooveSerializeOption_WithFormatting | GrooveSerializeOption_NoProlog | GrooveSerializeOption_NoFragmentWrapper);				
					if (pDb.DoesDatabaseObjectExistByFullName("Fields.xml") == false)
					{
						Transaction.Abort();
						var objError = new Error(-2147220474, "Fields file does not exist.");
						throw objError;
					}
					else
						pDb.ReplaceDatabaseObjectByFullName("Fields.xml", BIS, GrooveRunTimeData.g_FieldsDocumentVersionID);

					// RSSToDo: See if this removes conflicts for fields.xml file when saving.
					// LoadFieldsDocument();
					// RSSToDo: see if just updating the version ID fixes the problem.
					var pDatabaseObject = pDb.OpenDatabaseObjectByFullName("Fields.xml");
					GrooveRunTimeData.g_FieldsDocumentVersionID = pDatabaseObject.DatabaseObjectVersionID;

					Transaction.Commit();
				}
				catch (error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function UpdateFile(BIS, i_FileID, i_VersionID)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				if (GrooveRunTimeData.g_pDatabase.DoesDatabaseObjectExistByID(i_FileID) == false)
				{
					CPSem.DoUnlock();
					return false;
				}
				else
				{
					var CIS = BIS.OpenCharInputStream(GrooveCharEncodingType_UTF8);
					var FormSource = CIS.ReadChars(-1);
					BIS.Close();
					var BIS2 = CreateByteInputStreamFromString(FormSource, GrooveCharEncodingType_UTF8);
					GrooveRunTimeData.g_pDatabase.ReplaceDatabaseObjectByID(i_FileID, BIS2, i_VersionID);
					BIS2.Close();
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				CPSem.DoUnlock();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function RemoveFieldFromFormPriv(i_FieldName, i_pIField, FileID, i_UpdateCustom)
		{
			RemoveFieldFromForm(i_FieldName, i_pIField, FileID, i_UpdateCustom);
		}

		function RemoveFieldFromFormElementPriv(i_FieldName, i_pIField, i_FormRootElement, i_UpdateCustom)
		{
			RemoveFieldFromFormElement(i_FieldName, i_pIField, i_FormRootElement, i_UpdateCustom);
		}

		function AddRemoveSortFromCollectionListPriv(i_bAdd, i_SortName, i_Order, i_DataType, i_FieldName, i_ToolObj, i_bIsTextView, i_bIsAttachments, i_bIsHierarchical)
		{
			AddRemoveSortFromCollectionList(i_bAdd, i_SortName, i_Order, i_DataType, i_FieldName, i_ToolObj, i_bIsTextView, i_bIsAttachments, i_bIsHierarchical);
		}

		function AddFieldToSchemaPriv(i_pIField)
		{
			AddFieldToSchema(i_pIField.FieldName, i_pIField.IGrooveFormsFieldPrivate.ObjectType, i_pIField.DataType, i_pIField.IGrooveFormsFieldPrivate.FieldElement.OpenName(), i_pIField.IGrooveFormsFieldPrivate.FieldType);
		}

		function SetTotalSizePriv(i_TotalSize)
		{
			GrooveRunTimeData.g_TotalSize = i_TotalSize;
		}
		
		function CalculateColumnWidthPriv(TotalCount, DefaultCount, CustomTotal, PixelTotal, bIsCustom)
		{
			CalculateColumnWidth(TotalCount, DefaultCount, CustomTotal, PixelTotal, bIsCustom);
		}

		function LoadFieldsDocumentPriv()
		{
			LoadFieldsDocument();
		}

		function DeleteDependencyFilePriv(i_FilePath)
		{
			int_DeleteDependencyFile(i_FilePath);
		}

		function GetTotalAndDefaultCountsPriv(i_ViewName, i_bIsAttachments)
		{
			var pColumnCountCache = GetTotalAndDefaultCounts(i_ViewName, i_bIsAttachments);
			return pColumnCountCache;
		}

		function RemoveFieldFromCurrentFormFieldArray(i_FieldName, i_FormRootElement, i_UpdateCustom)
		{
			if (i_FormRootElement.ContentElementWithNameExists("BODY"))
			{
				var pBODYElement = i_FormRootElement.OpenContentElementByName("BODY");
				if (pBODYElement.ContentElementWithNameExists("GROOVEFORMFIELDS"))
				{
					var pCurrentFormFieldListElement = pBODYElement.OpenContentElementByName("GROOVEFORMFIELDS");
					var strNames = pCurrentFormFieldListElement.OpenAttribute("names");
					var NamesArray = strNames.split(",");
					NamesArray = RemoveArrayValue(NamesArray, i_FieldName);
					var strNewNames = NamesArray.join(",");
					pCurrentFormFieldListElement.SetAttribute("names", strNewNames);
					if (typeof i_UpdateCustom!= "undefined" && i_UpdateCustom == true)
					{
						if (pCurrentFormFieldListElement.DoesAttributeExist("customnames"))
						{
							var CustomNames = pCurrentFormFieldListElement.OpenAttribute("customnames");
							var CustomNamesArray = CustomNames.split(",");
							if (IsInArray(CustomNamesArray, i_FieldName))
							{
								CustomNamesArray = RemoveArrayValue(CustomNamesArray, i_FieldName);
								var NewCustomNames = CustomNamesArray.join(",");
								pCurrentFormFieldListElement.SetAttribute("customnames", NewCustomNames);
							}
						}
					}
				}
			}
		}

		function GetSystemFieldsInited()
		{
			if (GrooveRunTimeData.g_pPropertyList.PropertyExists("SystemFieldsInited") && GrooveRunTimeData.g_pPropertyList.OpenPropertyAsBool("SystemFieldsInited"))
				return true;
			else
				return false;
		}

		function IsFieldInSchemaPriv(i_FieldName)
		{
			return int_IsFieldInSchema(i_FieldName);
		}

		function AddFieldToTriggerListPriv(pIFormsField)
		{
			AddFieldToTriggerList(pIFormsField);
		}

		function AddFieldFromDesignerPriv(i_pIField)
		{
			int_AddField(i_pIField, true, false, null, false);
			var ToolObj = int_OpenToolObject();
			int_UpdateToolFile(ToolObj.ToolFileName, ToolObj.RootElement);
		}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   @           ≤  ¿  ≥      ¥      µ  Ä        ®     /Ü  /Ü        è     Aà Aà                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              »               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   i   ÄName:   G r o o v e F o r m s D e s i g n e r O b j e c t . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE  IPTI  ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n   o     F a c t  ÄSCRIPTINTERFACE       ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }       ÄIIDL   { C D C 8 D C E F - D 1 5 B - 4 0 9 a - 9 8 5 2 - 4 E 8 D 9 8 6 0 F 9 C 0 }   A   ÄName0   I G r o o v e F o r m s F i e l d F a c t o r y        	 Ä
		function CreateFormsField(i_FieldLabel, i_MetaDataName, i_FieldName)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				//GrooveDebugFunctions.DisplayAssert(0,"");
				if (typeof i_FieldLabel == "undefined" || i_FieldLabel == "")
				{
					var error = new Error;
					error.description = "You must supply a valid label.  It cannot be an empty string.";
					error.number = -2147220478;
					throw error;
				}
				
				var WasLoaded = LoadFieldsDocument(true);
				if (WasLoaded)
				{
					var pMetaDataObject = GetMetaDataContentByName(GrooveRunTimeData.g_pMetaDataTable, i_MetaDataName, GrooveMetaData_RawEntry);
					var MDContentElement = pMetaDataObject.ContentElement;
					var ElementName = MDContentElement.OpenName();
					var FieldName;
					// If the field name is blank generate one from the field label.
					if (i_FieldName == "")			
						FieldName = CreateValidXMLName(i_FieldLabel);
					else
						FieldName = i_FieldName;

					var FieldElementEnum = GetElementEnumByElementNameAndAttributeValue(GrooveRunTimeData.g_pFieldsDocument, ElementName, "NAME", FieldName, GrooveRunTimeData.g_pFieldsRootElement);
					if (FieldElementEnum.HasMore())
					{
						var i = 0;
						FieldElementEnum = GetElementEnumByElementNameAndAttributeValue(GrooveRunTimeData.g_pFieldsDocument, ElementName, "NAME", FieldName + i, GrooveRunTimeData.g_pFieldsRootElement);
						while (FieldElementEnum.HasMore())
						{
							i++;
							FieldElementEnum = GetElementEnumByElementNameAndAttributeValue(GrooveRunTimeData.g_pFieldsDocument, ElementName, "NAME", FieldName + i, GrooveRunTimeData.g_pFieldsRootElement);
						}
						FieldName += i;
					}

					// Now we have a field name, a meta data object and a field label.  We can now create the field.
					var pIFormsField = int_CreateFieldInstance(i_MetaDataName, FieldName, i_FieldLabel, pMetaDataObject);
					Transaction.Commit();
					return pIFormsField;
				}
				Transaction.Commit();
				return GrooveScriptFunctions.CreateNewObject("");
			}
			catch(error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
			
		}
	
		}             b                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          r    \"
                   § i              )            ÄSCRIPTINTERFACE       ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }       ÄIIDL   { F D 1 F E F F D - 6 3 4 9 - 4 6 1 0 - A 5 B 1 - A 1 1 A 5 8 7 6 5 E 9 3 }   ;   ÄName(   I G r o o v e F o r m s D e s i g n e r   .    .# Ä
		function CreateFieldEnum()
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				if (GrooveRunTimeData.g_FieldsCache.IsEmpty())
				{
					LoadFieldsDocument();
				}
				var FieldEnum = CreateUnknownEnumFromStringIIDs("{E06FAAF0-4E0D-4f9b-B12A-04ACC3941703}", "{BB681D49-F5F9-4aad-8496-D1A231180596}");
				var FieldNamesArray = GetFieldNamesArray();
				for (var i = 0; i < FieldNamesArray.length; i++)
				{
					var pField = OpenFieldInCacheByName(FieldNamesArray[i]);
					FieldEnum.Add(pField);
				}
				CPSem.DoUnlock();
				return FieldEnum.IGrooveUnknownEnum;
			}
			catch(error)
			{
				CPSem.DoUnlock();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function CreateFieldNameEnum()
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				if (GrooveRunTimeData.g_FieldsCache.IsEmpty())
				{
					LoadFieldsDocument();
				}
				var FieldEnum = CreateBSTREnum();
				var FieldNamesArray = GetFieldNamesArray();
				for (var i = 0; i < FieldNamesArray.length; i++)
				{
					FieldEnum.Add(FieldNamesArray[i]);
				}
				
				CPSem.DoUnlock();
				return FieldEnum.IGrooveBSTREnum;
			}
			catch(error)
			{
				CPSem.DoUnlock();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function DoesFormsFieldExist(i_FieldName)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				if (GrooveRunTimeData.g_FieldsCache.IsEmpty())
				{
					LoadFieldsDocument();
				}
				var b = GrooveRunTimeData.g_FieldsCache.LockedHasItem(i_FieldName);
				CPSem.DoUnlock();
				return b;
			}
			catch(error)
			{
				CPSem.DoUnlock();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function OpenFormsFieldByName(i_FieldName)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var pIFormsField = OpenFieldInCacheByName(i_FieldName);
				if (pIFormsField != null)
				{
					CPSem.DoUnlock();
					return pIFormsField;
				}
				else
				{
					var error = new Error;
					error.description = "Field does not exist (" + i_FieldName + ")";
					error.number = -2147220476;
					throw error;
				}
			}
			catch(error)
			{
				CPSem.DoUnlock();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				return GrooveScriptFunctions.CreateNewObject("");
			}
		}

		function AddField(i_pIField)
		{
			int_AddField(i_pIField, true, false, null, true);
			var ToolObj = int_OpenToolObject();
			int_UpdateToolFile(ToolObj.ToolFileName, ToolObj.RootElement);
		}

		function AddMultipleFields(i_pFieldEnum)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Delta = GrooveRunTimeData.g_pDynMgr.CreateDelta();
				try
				{
					//GrooveDebugFunctions.DisplayAssert(0, "");
					var pSchema = GetSchema();
					while (i_pFieldEnum.HasMore())
					{
						var pIField = i_pFieldEnum.OpenNext();
						int_AddField(pIField, false, true, pSchema, true);
					}
					var ToolObj = int_OpenToolObject();
					int_UpdateToolFile(ToolObj.ToolFileName, ToolObj.RootElement);
					UpdateSchemaFile(pSchema);
					UpdateFieldsFile();					
					GrooveRunTimeData.g_pDynMgr.DoDelta(Delta);
				}
				catch(error)
				{
					Delta.Abort();
					GrooveDebugFunctions.DisplayAsse          rt(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function RemoveField(i_pIField)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
				try
				{
					
					if (i_pIField.IGrooveFormsField.FieldType == "Image")
						int_DeleteDependencyFileForImageField(i_pIField);

					RemoveFieldInstance(i_pIField, true);
					Transaction.Commit();
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function RemoveMultipleFields(i_pIFieldEnum)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Delta = GrooveRunTimeData.g_pDynMgr.CreateDelta();
				try
				{
					while (i_pIFieldEnum.HasMore())
					{
						var pIField = i_pIFieldEnum.OpenNext();
						if (pIField.IGrooveFormsField.FieldType == "Image")
							int_DeleteDependencyFileForImageField(pIField);

						RemoveFieldInstance(pIField, false);
					}
					var ToolObj = int_OpenToolObject();
					int_UpdateToolFile(ToolObj.ToolFileName, ToolObj.RootElement);
					UpdateFieldsFile();
					GrooveRunTimeData.g_pDynMgr.DoDelta(Delta);
				}
				catch(error)
				{
					Delta.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function int_DeleteDependencyFile(i_FilePath)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
				try
				{
					var FileName = RightBack(i_FilePath, "/");
					if (GrooveRunTimeData.g_pDatabase.DoesDatabaseObjectExistByFullName(FileName))
					{
						var DatabaseObject = GrooveRunTimeData.g_pDatabase.OpenDatabaseObjectByFullName(FileName);
						if (DatabaseObject != null)
						{
							var ObjectID = DatabaseObject.DatabaseObjectID;
							GrooveRunTimeData.g_pDatabase.DeleteDatabaseObject(ObjectID);
						}
					}
					Transaction.Commit();
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
				finally
				{
					CPSem.DoUnlock();
				}
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function int_DeleteDependencyFileForImageField(i_pIField)
		{
			var FieldPropertiesElement = int_GetPropertiesForField(i_pIField.FieldType);
			var FieldPropertiesEnum = FieldPropertiesElement.OpenContentElementEnum();
			var PropertyFound = false;
			while (FieldPropertiesEnum.HasMore())
			{
				var FieldPropertyElement = FieldPropertiesEnum.OpenNext();
				var PropertyName = FieldPropertyElement.OpenAttribute("Name");
				var PropertyType = FieldPropertyElement.OpenAttribute("Type");
				var PropertyLocation = FieldPropertyElement.OpenAttribute("Location");
				if (PropertyType == "Browse")
				{
					Property      à  Found = true;
					break;
				}
			}

			// Only try to delete the file if the property was found.
			if (PropertyFound)
			{
				var NameValueEnum = GetFieldProperties(i_pIField, PropertyName, PropertyType, PropertyLocation, null, null);
				if (NameValueEnum.HasMore())
				{
					var Pair = NameValueEnum.OpenNextPair();
					var FilePath = Pair.Second;
					if (typeof FilePath != "undefined" && FilePath != null && FilePath != "")
						int_DeleteDependencyFile(FilePath);
				}
			}
		}

		function int_GetPropertiesForField(i_Name)
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			try
			{
				if (GrooveRunTimeData.g_pMetaDataTable.LockedHasItem(i_Name))
				{
					CPSem.DoUnlock();
					return GrooveRunTimeData.g_pMetaDataTable.LockedGetItem(i_Name).LockedGetItem("PropertyListElement");
				}
				
				CPSem.DoUnlock();
				return null;
			}
			catch(error)
			{
				CPSem.DoUnlock();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               b                     @            ∑  –   ∏      π  (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ÿ                Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   .   ÄName(   G r o o v e F o r m s F i e l d . g s l   u       ÄSCRIPT     ÄSCRIPT     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE  IPTI  ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n   r     F a c t  ÄSCRIPT           Ä
	
	T      ÄSCRIPTINTERFACE       ÄLIBIDL   { 6 5 D 4 8 B 8 E - E 9 A 4 - 4 9 1 a - B B D 4 - 0 5 5 8 3 D 7 9 B 1 D 7 }       ÄIIDL   { 7 1 7 7 5 7 C A - 1 A 6 4 - 4 b 6 a - 9 0 4 4 - A 6 B D 7 3 4 9 7 4 C E }       ÄName0   I G r o o v e F o r m s F i e l d P r i v a t e   l    q Ä

		function InitializeFormsField(i_FieldName, i_pFieldElement, i_pIFormsDesignerPrivate, i_pMetaDataTable, i_pIPropertyList)
		{
			
			GrooveRunTimeData.g_PropertyList = i_pIPropertyList;
			GrooveRunTimeData.g_FieldName = i_FieldName;						
			GrooveRunTimeData.g_pIFormsDesignerPrivate = i_pIFormsDesignerPrivate;
			GrooveRunTimeData.g_pMetaDataTable = i_pMetaDataTable;
			GrooveRunTimeData.g_FieldElement = i_pFieldElement;
			GrooveRunTimeData.g_Telespace = i_pIPropertyList.OpenProperty(PROPERTY_TELESPACE);

			if (i_FieldName == "_CreatedBy" || i_FieldName == "_Created" || i_FieldName == "_Modified")
			{
				PutFieldType("SystemField");
				if (i_FieldName == "_Created" || i_FieldName == "_Modified")
					PutDataType("Date");
			}
			else
				PutFieldType(GetMetaDataNameByDisplayName(GetTypeDisplayName(), GrooveRunTimeData.g_pMetaDataTable));

			GrooveRunTimeData.IsNew = true;
		}

		function ShutdownField()
		{
			GrooveRunTimeData.LockedRemoveAllItems();
		}

		function PutFieldElement(i_pIFieldElement)
		{
			GrooveRunTimeData.g_FieldElement =  i_pIFieldElement;
		}

		function PutFieldType(i_FieldType)
		{
			GrooveRunTimeData.g_pIFormsDesignerPrivate.SetFieldType(GrooveRunTimeData.g_FieldName, i_FieldType);
		}

		function GetFieldElement()
		{
			var pFieldElement = GrooveRunTimeData.g_FieldElement;
			return pFieldElement;
		}

		function GetObjectType()
		{
			var ObjectType = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenFieldObjectType(GrooveRunTimeData.g_FieldName);
			return ObjectType;
		}

		function PutDataType(i_DataType)
		{
			GrooveRunTimeData.g_pIFormsDesignerPrivate.SetFieldDataType(GrooveRunTimeData.g_FieldName, i_DataType);
		}

		function PutIsNew(i_bIsNew)
		{
			GrooveRunTimeData.g_IsNew = i_bIsNew;
			GrooveRunTimeData.g_FieldElement.SetAttributeAsBool("IsNew",i_bIsNew);
		}

	sNe        ø    ÄSCRIPTINTERFACE       ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }       ÄIIDL   { 0 4 D F 1 E 9 B - 5 0 8 E - 4 2 c b - 9 C 4 6 - E E 9 4 3 3 2 1 0 0 D F }       ÄNameP   I G r o o v e F o r m s F i e l d C o l u m n P r o p e r t i e s F a c t o r y        ; Ä
		function CreateColumnProperties(i_ViewName)
		{	
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var FieldName = GetFieldName();
				var pIColumnProperties = GrooveRunTimeData.g_pIFormsDesignerPrivate.CreateColumnPropertiesPriv(i_ViewName, FieldName);
				Transaction.Commit();
				return pIColumnProperties;
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				Transaction.Abort();
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}
	                                                                                                                                                                                                                         ∏w   ≤    hç   T!    ú i     Ù          )            ÄSCRIPTINTERFACE       ÄDefault   1     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }       ÄIIDL   { B B 6 8 1 D 4 9 - F 5 F 9 - 4 a a d - 8 4 9 6 - D 1 A 2 3 1 1 8 0 5 9 6 }       ÄName"   I G r o o v e F o r m s F i e l d      ê Ä

		function GetContainedBy()
		{
			var ContainedBy = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenFieldContainedBy(GrooveRunTimeData.g_FieldName);
			return ContainedBy;
		}
		
		function PutContainedBy(i_ContainedBy)
		{
			GrooveRunTimeData.g_pIFormsDesignerPrivate.SetFieldContainedBy(GrooveRunTimeData.g_FieldName, i_ContainedBy);
		}

		function GetHTMLElement()
		{
			var pHTMLElement = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenFieldHTMLElement(GrooveRunTimeData.g_FieldName);
			return pHTMLElement;
		}

		function PutHTMLElement(i_pHTMLElement)
		{
			GrooveRunTimeData.g_pIFormsDesignerPrivate.SetFieldHTMLElement(GrooveRunTimeData.g_FieldName, i_pHTMLElement);
		}

		function GetFieldType()
		{
			var FieldType = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenFieldType(GrooveRunTimeData.g_FieldName);
			return FieldType;
		}

		function GetTypeDisplayName()
		{
			var TypeDisplayName = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenTypeDisplayName(GrooveRunTimeData.g_FieldName);
			return TypeDisplayName;
		}

		function GetFieldName()
		{
			return GrooveRunTimeData.g_FieldName;
		}

		function GetFieldLabel()
		{
			var FieldLabel = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenFieldLabel(GrooveRunTimeData.g_FieldName);
			return FieldLabel;
		}

		function PutFieldLabel(i_Label)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				GrooveRunTimeData.g_pIFormsDesignerPrivate.SetFieldLabel(GrooveRunTimeData.g_FieldName, i_Label);
				Transaction.Commit();
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				Transaction.Abort();
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function GetPersistable()
		{
			var Persistable = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenFieldPersistable(GrooveRunTimeData.g_FieldName);
			return Persistable;
		}

		function GetMetaDataKey()
		{
			var MetaDataKey = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenFieldMetaDataKey(GrooveRunTimeData.g_FieldName);
			return MetaDataKey;
		}

		function GetDataType()
		{
			var DataType = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenFieldDataType(GrooveRunTimeData.g_FieldName);
			return DataType;
		}

		function SetFieldProperties(i_PropertyName, i_PropertyType, i_PropertyLocation, i_PropertyValue, i_RelativeValue, i_RelativePosition, i_PropertyUnit)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var FieldType = GetFieldType();
				var FieldName = GetFieldName();

				if (typeof i_PropertyValue == "undefined" && FieldType != "SectionHeading" && FieldType != "StaticText" && FieldType != "Line" && FieldType != "Break" && FieldType != "Button" && FieldType != "Image")
				{
					Transaction.Commit();
					return;
				}

				if (typeof i_RelativeValue == "undefined")
					i_RelativeValue = "";

				if (typeof i_RelativePosition == "undefined")
					i_RelativePosition = GrooveFormsRelativePosition_Left;

				if (typeof i_PropertyUnit == "undefined")
					i_PropertyUnit = 0;

				//GrooveDebugFunctions.DisplayAssert(0, "Break");
				GrooveRunTimeData.g_pIFormsDesignerPrivate.SetFieldPropertiesPriv(i_PropertyName, i_PropertyType, i_PropertyLocation, i_PropertyValue, i_RelativeValue, i_RelativePosition, i_PropertyUnit, FieldName);
				Transaction.Commit();
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				Transaction.Abort();
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function SetDefaultColumnPropertiesForView(i_ViewName, i_SortOrder, i_bShowTwisty, i_ColumnHeader, i_Precis      0  ion)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var bIsAttachments = false;
				if (GetFieldType() == "Attachments")
					bIsAttachments = true;
				var pColumnCountCache = GrooveRunTimeData.g_pIFormsDesignerPrivate.GetTotalAndDefaultCountsPriv(i_ViewName, bIsAttachments);
				GrooveRunTimeData.g_pIFormsDesignerPrivate.SetDefaultColumnPropertiesForViewPriv(i_ViewName, GrooveRunTimeData.g_FieldName, pColumnCountCache.DefaultCount, pColumnCountCache.TotalCount, pColumnCountCache.CustomTotal, pColumnCountCache.PixelTotal, i_SortOrder, i_bShowTwisty, i_ColumnHeader, i_Precision);
				Transaction.Commit();
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				Transaction.Abort();
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function CreateColumnPropertyEnum()
		{
			var Enum = GrooveRunTimeData.g_pIFormsDesignerPrivate.CreateColumnPropertyEnumPriv(i_FieldName);
			return Enum;
		}

		function DoColumnPropertiesExist(i_ViewName)
		{
			var bExist = GrooveRunTimeData.g_pIFormsDesignerPrivate.DoColumnPropertiesExistPriv(i_ViewName, GetFieldName());
			return bExist;
		}

		function OpenColumnProperties(i_ViewName)
		{
			try
			{
				var pCP = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenColumnPropertiesPriv(i_ViewName, GetFieldName());
				if (pCP == null)
				{
					var error = new Error;
					error.description = "Column properties for the specified view cannot be found.";
					error.number = -2147220475;
					throw error;	
				}
				return pCP;
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function ApplyColumnProperties(i_pIFieldViewColumnProperties)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				GrooveRunTimeData.g_pIFormsDesignerPrivate.ApplyColumnPropertiesPriv(i_pIFieldViewColumnProperties, GetFieldName());	
				Transaction.Commit();
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				Transaction.Abort();
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function RemoveColumnProperties(i_ViewName)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				GrooveRunTimeData.g_pIFormsDesignerPrivate.RemoveColumnPropertiesPriv(i_ViewName, GrooveRunTimeData.g_FieldName , false);
				Transaction.Commit();
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				Transaction.Abort();
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function Commit()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				GrooveRunTimeData.g_pIFormsDesignerPrivate.UpdateFieldsFile();
				Transaction.Commit();
			}
			catch(error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				Transaction.Abort();
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function GetIsNew()
		{
			return GrooveRunTimeData.IsNew;	
		}

		function PutTypeDisplayName(i_TypeDisplayName)
		{
			GrooveRunTimeData.g_pIFormsDesignerPrivate.SetFieldTypeDisplayName(GrooveRunTimeData.g_FieldName, i_TypeDisplayName);
		}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ø                     @            ª  `  º      Ω  ®                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        h               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   O   ÄNameP   G r o o v e F o r m s F i e l d V i e w C o l u m n P r o p e r t i e s . g s l   tt      ÄSCRIPT     ÄSCRIPT     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE  FACE  ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n    +    o r y =  ÄSCRIPT         /  Ä	
		function FinalConstruct()
		{

		}

	
		{
        =    ÄSCRIPTINTERFACE       ÄDefault   1     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }   bu  ÄIIDL   { 0 1 E D D E B 5 - F A 5 0 - 4 9 5 a - 8 8 C 2 - A 9 1 C C 1 F 7 5 4 B 5 }   t.  ÄNameB   I G r o o v e F o r m s F i e l d C o l u m n P r o p e r t i e s       Ä
		function GetColumnName()
		{
			return GrooveRunTimeData.g_ColumnName;
		}

		function PutColumnName(i_ColumnName)
		{
			GrooveRunTimeData.g_ColumnName = i_ColumnName;
			GrooveRunTimeData.g_CPElement.SetAttribute("ColumnName", i_ColumnName);
		}

		function GetColumnHeader()
		{
			return GrooveRunTimeData.g_ColumnHeader;
		}

		function PutColumnHeader(i_ColumnHeader)
		{
			GrooveRunTimeData.g_ColumnHeader = i_ColumnHeader;
			GrooveRunTimeData.g_CPElement.SetAttribute("ColumnHeader", i_ColumnHeader);
		}

		function GetColumnWidth()
		{
			return GrooveRunTimeData.g_ColumnWidth;
		}

		function PutColumnWidth(i_ColumnWidth)
		{
			GrooveRunTimeData.g_ColumnWidth = i_ColumnWidth;
			GrooveRunTimeData.g_CPElement.SetAttribute("ColumnWidth", i_ColumnWidth);
		}

		function GetColumnWidthStyle()
		{
			return GrooveRunTimeData.g_ColumnWidthStyle;
		}

		function PutColumnWidthStyle(i_ColumnWidthStyle)
		{
			GrooveRunTimeData.g_ColumnWidthStyle = i_ColumnWidthStyle;
			GrooveRunTimeData.g_CPElement.SetAttribute("WidthStyle", GetColumnWidthStyleStringFromEnumValue(i_ColumnWidthStyle));
		}

		function GetSortOrder()
		{
			return GrooveRunTimeData.g_SortOrder;
		}

		function PutSortOrder(i_SortOrder)
		{
			GrooveRunTimeData.g_SortOrder = i_SortOrder;
			GrooveRunTimeData.g_CPElement.SetAttribute("SortOrder", GetColumnSortOrderStringFromEnumValue(i_SortOrder));
		}

		function GetPrecision()
		{
			return GrooveRunTimeData.g_Precision;
		}

		function PutPrecision(i_Precision)
		{
			GrooveRunTimeData.g_Precision = i_Precision;
			GrooveRunTimeData.g_CPElement.SetAttribute("Precision", i_Precision);
		}

		function GetViewName()
		{
			return GrooveRunTimeData.g_ViewName;
		}

		function GetShowTwisty()
		{
			return GrooveRunTimeData.g_ShowTwisty;
		}

		function PutShowTwisty(i_bShowTwisty)
		{
			GrooveRunTimeData.g_ShowTwisty = i_bShowTwisty;
			GrooveRunTimeData.g_CPElement.SetAttributeAsBool("ShowTwisty", i_bShowTwisty);
		}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           åE	   Ü    \J    § i              )            ÄSCRIPTINTERFACE       ÄLIBIDL   { 6 5 D 4 8 B 8 E - E 9 A 4 - 4 9 1 a - B B D 4 - 0 5 5 8 3 D 7 9 B 1 D 7 }   ve  ÄIIDL   { F 2 4 2 6 A 0 F - D 6 6 2 - 4 0 d 3 - 9 0 8 4 - 3 E 4 6 0 E A 8 9 0 D F }   rS  ÄNameP   I G r o o v e F o r m s F i e l d C o l u m n P r o p e r t i e s P r i v a t e   im   Ò Ä
		function InitializeFieldViewColumnProperties(i_PropertyList, i_ViewName, i_FieldName, i_CPElement)
		{
			GrooveRunTimeData.g_PropertyList = i_PropertyList;
			GrooveRunTimeData.g_CPElement = i_CPElement;
			
			var ViewName = i_ViewName;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("ViewName"))
				ViewName = GrooveRunTimeData.g_CPElement.OpenAttribute("ViewName");
			else
				GrooveRunTimeData.g_CPElement.SetAttribute("ViewName", ViewName);		
			
			var ColumnName = i_FieldName;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("ColumnName"))
				ColumnName = GrooveRunTimeData.g_CPElement.OpenAttribute("ColumnName");
			else
				GrooveRunTimeData.g_CPElement.SetAttribute("ColumnName", ColumnName);

			var ColumnHeader = i_FieldName;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("ColumnHeader"))
				ColumnHeader = GrooveRunTimeData.g_CPElement.OpenAttribute("ColumnHeader");

			var ColumnWidth = 0;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("ColumnWidth"))
				ColumnWidth = GrooveRunTimeData.g_CPElement.OpenAttribute("ColumnWidth");

			var ColumnWidthStyle = GrooveFormsColumnWidthStyle_Percent;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("WidthStyle"))
				ColumnWidthStyle = GetEnumValueFromColumnWidthStyleString(GrooveRunTimeData.g_CPElement.OpenAttribute("WidthStyle"));
			
			var SortOrder = GrooveFormsColumnSortOrder_Ordinal;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("SortOrder"))
				SortOrder = GetEnumValueFromColumnSortOrderString(GrooveRunTimeData.g_CPElement.OpenAttribute("SortOrder"));

			var Precision = 0;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("Precision"))
				Precision = GrooveRunTimeData.g_CPElement.OpenAttribute("Precision");

			var ReadOnly = true;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("ReadOnly"))
				ReadOnly = GrooveRunTimeData.g_CPElement.OpenAttribute("ReadOnly");
			if (ReadOnly == "")
				ReadOnly=true;
			
			var Custom = false;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("Custom"))
				Custom = GrooveRunTimeData.g_CPElement.OpenAttributeAsBool("Custom");

			var ShowTwisty = false;
			if (GrooveRunTimeData.g_CPElement.DoesAttributeExist("ShowTwisty"))
				ShowTwisty = GrooveRunTimeData.g_CPElement.OpenAttributeAsBool("ShowTwisty");
			
				

			GrooveRunTimeData.g_ViewName = ViewName;
			GrooveRunTimeData.g_FieldName = i_FieldName;
			GrooveRunTimeData.g_ColumnName = ColumnName;
			GrooveRunTimeData.g_ColumnHeader = ColumnHeader;
			GrooveRunTimeData.g_ColumnWidth = ColumnWidth;
			GrooveRunTimeData.g_ColumnWidthStyle = ColumnWidthStyle;
			GrooveRunTimeData.g_SortOrder = SortOrder;
			GrooveRunTimeData.g_Precision = Precision;
			GrooveRunTimeData.g_ReadOnly = ReadOnly;
			PutReadOnly(ReadOnly);
			GrooveRunTimeData.g_Custom = Custom;
			PutCustom(Custom);
			GrooveRunTimeData.g_ShowTwisty = ShowTwisty;
			PutShowTwisty(ShowTwisty);
			PutSortOrder(SortOrder);
			
		}

		function ShutdownFieldViewColumnProperties()
		{
			GrooveRunTimeData.RemoveItem("g_PropertyList");
			GrooveRunTimeData.RemoveItem("g_ViewName");
			GrooveRunTimeData.RemoveAllItems();
		}

		function GetReadOnly()
		{
			return GrooveRunTimeData.g_ReadOnly;
		}

		function PutReadOnly(i_bReadOnly)
		{
			GrooveRunTimeData.g_ReadOnly = i_bReadOnly;
			GrooveRunTimeData.g_CPElement.SetAttributeAsBool("ReadOnly", i_bReadOnly);
		}

		function GetCustom()
		{
			return GrooveRunTimeData.g_Custom;
		}

		function PutCustom(i_bCustom)
		{
			GrooveRunTimeData.g_Custom = i_bCustom;
			GrooveRunTimeData.g_CPElement.SetAttributeAsBool("Custom", i_bCustom);
		}

		function PutViewName(i_ViewNa      ∞  me)
		{
			GrooveRunTimeData.g_ViewName = i_ViewName;
			GrooveRunTimeData.g_CPElement.SetAttribute("ViewName", i_ViewName);
		}

		function GetCPElement()
		{
			return GrooveRunTimeData.g_CPElement;
		}

		function PutCPElement(i_CPElement)
		{
			GrooveRunTimeData.g_CPElement = i_CPElement;
		}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    =                     @            ø  P  ¿      ¡  @	  ¬                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    X               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   R   ÄName&   G r o o v e F o r m s F o r m . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE    ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n        o r y =            ÄSCRIPTINTERFACE       ÄLIBIDL   { 6 5 D 4 8 B 8 E - E 9 A 4 - 4 9 1 a - B B D 4 - 0 5 5 8 3 D 7 9 B 1 D 7 }   m   ÄIIDL   { 6 E 6 2 A 0 0 9 - 4 5 E A - 4 7 4 6 - 8 1 B 5 - E D 6 5 C E 6 0 B E 1 2 }   i   ÄName.   I G r o o v e F o r m s F o r m P r i v a t e      Ø Ä
		function InitializeForm(i_pPropertyList, i_DatabaseObject, i_pIFormsDesigner, i_pIMetaDataTable, i_pDatabase)
		{
			GrooveRunTimeData.g_pDynMgr = i_pPropertyList.OpenPropertyAsIUnknown("_DynamicsManager");
			GrooveRunTimeData.g_PropertyList = i_pPropertyList;
			GrooveRunTimeData.g_DatabaseObject = i_DatabaseObject;
			GrooveRunTimeData.g_pIFormsDesigner = i_pIFormsDesigner;
			GrooveRunTimeData.g_pIFormsDesignerPrivate = i_pIFormsDesigner.IGrooveFormsDesignerPrivate;
			GrooveRunTimeData.g_pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
			GrooveRunTimeData.g_Telespace = GrooveRunTimeData.g_PropertyList.OpenPropertyAsIUnknown("_Telespace");
			GrooveRunTimeData.g_MetaDataTable = i_pIMetaDataTable;
			GrooveRunTimeData.g_pDatabase = i_pDatabase;
			GrooveRunTimeData.g_IsResponse = false;

			var pByteInputStream = GrooveRunTimeData.g_DatabaseObject.OpenByteInputStream();
			try
			{
				var pCurrentFormDocument = GrooveRunTimeData.g_pSM.CreateTemporaryXMLDocument(GrooveRunTimeData.g_DatabaseObject.FileName);
				var pNewRootElement = pCurrentFormDocument.CreateElementFromStream(pByteInputStream, GrooveParseOption_Default | GrooveParseOption_StripContentWhitespace);
				pByteInputStream.Close();
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, "You received the following error opening form data: " + error.description);
				pByteInputStream.Close();
			}
			pCurrentFormDocument.SetRootElement(pNewRootElement);
			GrooveRunTimeData.g_pCurrentFormRootElement = pCurrentFormDocument.OpenRootElement();
		}

		function ShutdownForm()
		{
			GrooveRunTimeData.RemoveAllItems();
		}

		function SaveChanges(i_FieldsToRemoveEnum, i_FieldsToAddEnum, i_StyleName, i_pScriptCodeEnum, i_bIsResponse)
		{
			GrooveRunTimeData.g_IsResponse = i_bIsResponse;
			ApplyFormChanges(i_FieldsToRemoveEnum, i_FieldsToAddEnum, i_StyleName, i_pScriptCodeEnum, i_bIsResponse);
		}
	       å                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ≤    L«   F    å i     ÿ          )            ÄSCRIPT         „ Ä
		function ApplyFormChanges(i_FieldsToRemoveEnum, i_FieldsToAddEnum, i_StyleName, i_pScriptCodeEnum, i_bIsResponse)
		{
			var Delta = GrooveRunTimeData.g_pDynMgr.CreateDelta();
			// Create the temporary form root element (in GrooveFormsHelperFunctions2.gsl).
			CreateTempFormElement(GrooveRunTimeData.g_pIFormsDesigner, GrooveRunTimeData.g_pCurrentFormRootElement, GrooveRunTimeData.g_MetaDataTable, i_FieldsToRemoveEnum, i_FieldsToAddEnum, i_StyleName, i_bIsResponse);
			// Add the script code files for a real form save.
			if (i_pScriptCodeEnum != null && i_pScriptCodeEnum.HasMore())
			{
				var pHeadElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("HEAD");
				var ScriptElementEnum = pHeadElement.OpenContentElementEnumByName("SCRIPT");
				while (ScriptElementEnum.HasMore())
				{
					// Delete the old custom script code elements.
					var ScriptElement = ScriptElementEnum.OpenNext();
					if (ScriptElement.DoesAttributeExist("SCRIPTTYPE") && ScriptElement.OpenAttribute("SCRIPTTYPE") == "CustomScriptCode")
						ScriptElement.Delete();
				}
				// Add the files to the document share engine.
				while (i_pScriptCodeEnum.HasMore())
				{
					var pScriptCodeObject = i_pScriptCodeEnum.OpenNext();
					int_AddScriptCode(pScriptCodeObject, pHeadElement, false);
				}
			}
			// Added here for performance reasons
			var ToolObj = int_OpenToolObject();
			int_UpdateToolFile(ToolObj.ToolFileName, ToolObj.RootElement);

			UpdateFormFile();

			GrooveRunTimeData.g_pDynMgr.DoDelta(Delta);
		}

		function UpdateFormFile()
		{
			var pRootElement = GrooveRunTimeData.g_pCurrentFormRootElement;
			var BIS = pRootElement.Serialize(GrooveSerializeType_XML, GrooveCharEncodingType_UTF8, GrooveSerializeOption_ConvertLFToCRLF | GrooveSerializeOption_NoEmptyTags | GrooveSerializeOption_NoFragmentWrapper | GrooveSerializeOption_NoProlog | GrooveSerializeOption_WithFormatting);
			GrooveRunTimeData.g_pIFormsDesignerPrivate.UpdateFile(BIS, GrooveRunTimeData.g_DatabaseObject.DatabaseObjectID, GrooveRunTimeData.g_DatabaseObject.DatabaseObjectVersionID);
		}

		function int_AddScriptCode(i_pScriptCode, i_pHeadElement, i_AddFile)
		{
			// Need to get the database name of the real database, not the sandbox.
			var pDatabase = GrooveRunTimeData.g_pDatabase;
			var CurrentDatabaseName;
			if (typeof pDatabase.IGrooveFormsSandbox != "undefined")
				CurrentDatabaseName = pDatabase.IGrooveFormsSandboxPrivate.OpenParentName();
			else
				CurrentDatabaseName = pDatabase.DatabaseName;

			var FileName = i_pScriptCode.Name;
			var FileLanguage = i_pScriptCode.Language;
			var FilePath = CurrentDatabaseName + "/" + FileName;

			var pCustomScriptCodeElement = i_pHeadElement.CreateElement("SCRIPT", i_pHeadElement);
			pCustomScriptCodeElement.SetAttribute("LANGUAGE", FileLanguage);
			pCustomScriptCodeElement.SetAttribute("NAME", FileName);
			pCustomScriptCodeElement.SetAttribute("SCRIPTLANGUAGE", FileLanguage);
			pCustomScriptCodeElement.SetAttribute("SCRIPTNAME", FileName);
			pCustomScriptCodeElement.SetAttribute("SRC", FilePath);
			pCustomScriptCodeElement.SetAttribute("SCRIPTTYPE", "CustomScriptCode");

			if (i_AddFile)
			{
				var BIS = CreateByteInputStreamFromString(i_pScriptCode.Script, GrooveCharEncodingType_UTF8);

				if (pDatabase.DoesDatabaseObjectExistByFullName(FileName))
					pDatabase.ReplaceDatabaseObjectByFullName(FileName, BIS);
				else
					pDatabase.AddFile(FileName, BIS, GrooveFormsDatabaseObjectType_FileFromDisk);
			}
		}

		function int_OpenToolObject()
		{
			var ToolObj;
			if (typeof GrooveRunTimeData.g_pDatabase.IGrooveFormsSandbox != "undefined")
				ToolObj = GrooveRunTimeData.g_pDatabase.IGrooveFormsSandboxPrivate.OpenToolObject();
			else
				ToolObj = GrooveRunTimeData.g_pDatabase.IGrooveFormsDatabasePrivate.OpenToolObject();
			return ToolObj;
		}

		function int_UpdateToolFile(i_FileName, i_Element)
		{
			if (typeof GrooveRunTimeData.g_pDatabase.IGroo      H	  veFormsSandbox != "undefined")
				ToolObj = GrooveRunTimeData.g_pDatabase.IGrooveFormsSandboxPrivate.UpdateToolFile(i_FileName, i_Element);
			else
				ToolObj = GrooveRunTimeData.g_pDatabase.IGrooveFormsDatabasePrivate.UpdateToolFile(i_FileName, i_Element);
		}
	  var DatabaseObjectID = pDatabaseObject.DatabaseObjectID;
					pDatabase.DeleteDatabaseObject(DatbaseObjectID);
				}
			}
		}

		function GetStyleName()
		{
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
			if (pCurrentFormFieldListElement.DoesAttributeExist("style"))
				return pCurrentFormFieldListElement.OpenAttribute("style");
			else
				return null;
		}

		function PutStyleName(i_StyleName)
		{
			var pMetaDataEntry = GetMetaDataContentByName(GrooveRunTimeData.g_MetaDataTable, i_StyleName, GrooveMetaData_RawEntry);
			if (typeof pMetaDataEntry != "undefined" && pMetaDataEntry != null && pMetaDataEntry.ContainedBy == "HEAD")
			{
				var pHeadElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("HEAD");
				var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
				var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
				if (pHeadElement.ContentElementWithNameExists("STYLE"))
					pHeadElement.OpenContentElementByName("STYLE").Delete();
				pHeadElement.CreateElementCopy(pMetaDataEntry.ContentElement, pHeadElement);
				pCurrentFormFieldListElement.SetAttribute("style", pMetaDataEntry.DisplayName);
			}
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ç å               ÄSCRIPTINTERFACE       ÄDefault   1     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }   e   ÄIIDL   { 1 2 3 4 B 3 B 8 - 2 F 1 3 - 4 8 b d - 9 4 4 9 - B D 8 0 2 7 7 F D 0 2 B }   p   ÄName    I G r o o v e F o r m s F o r m   C    ] Ä
		function AddScriptCode(i_pScriptCode)
		{
			var pHeadElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("HEAD");
			int_AddScriptCode(i_pScriptCode, pHeadElement, true);
		}

		function AppendField(i_pIField)
		{
			AddFieldToFormElement(i_pIField, GrooveRunTimeData.g_pIFormsDesigner, GrooveRunTimeData.g_pCurrentFormRootElement);
		}

		/*
		function AppendMultipleFields(i_pIFieldEnum)
		{
		}
		*/

		function Commit()
		{
			UpdateFormFile();
		}

		function CreateCopy(i_FormName)
		{
			if (!GrooveRunTimeData.g_pDatabase.DoesDatabaseObjectExistByFullName(i_FormName))
			{
				var BIS = GrooveRunTimeData.g_DatabaseObject.OpenByteInputStream();
				var FormID = GrooveRunTimeData.g_pDatabase.AddFile(i_FormName, BIS, GrooveFormsDatabaseObjectType_Form);
				return FormID;
			}
			else
				return null;
		}

		function CreateFieldNameEnum()
		{
			var FieldNameEnum = CreateBSTREnum();
			try
			{
				var pFormElement = GrooveRunTimeData.g_pCurrentFormRootElement;
				if (typeof pFormElement != "undefined" && pFormElement != null)
				{
					var pBodyElement = pFormElement.OpenContentElementByName("BODY");
					var pGrooveFormFieldsElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
					var FormFieldsNames = pGrooveFormFieldsElement.OpenAttribute("names").split(",");
					var i = 0;
					var iCount = FormFieldsNames.length;
					while (i < iCount)
					{
						FieldNameEnum.Add(FormFieldsName[i]);
						i++;
					}
				}
			}
			catch (error)
			{
			}
			return FieldNameEnum.IGrooveBSTREnum;
		}

		function GetIsResponse()
		{
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			if (pBodyElement.DoesAttributeExist("FormType"))
			{
				var Value = pBodyElement.OpenAttribute("FormType");
				if (Value == "Response")
					return true;
			}
			return false;
		}

		function PutIsResponse(i_IsResponse)
		{
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			if (i_IsResponse)
				pBodyElement.SetAttribute("FormType", "Response");
			else if (pBodyElement.DoesAttributeExist("FormType"))
				pBodyElement.DeleteAttribute("FormType");
		}

		function RemoveField(i_pIField)
		{
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
			// Get the custom names array from the groove form fields element.
			var CustomFieldNameArray = new Array();
			if (pCurrentFormFieldListElement.DoesAttributeExist("customnames"))
				CustomFieldNameArray = pCurrentFormFieldListElement.OpenAttribute("customnames").split(",");
			// Check whether the field is custom or now and pass it to the remove function.
			var CustomRemoveFlag = false;
			if (IsInArray(CustomFieldNameArray, i_pIField.FieldName))
				CustomRemoveFlag = true;

			GrooveRunTimeData.g_pIFormsDesignerPrivate.RemoveFieldFromFormElementPriv(i_pIField.FieldName, i_pIField, GrooveRunTimeData.g_pCurrentFormRootElement, CustomRemoveFlag);
		}

		function RemoveScriptCode(i_pScriptCode)
		{
			var pHeadElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("HEAD");
			var ScriptElement = pHeadElement.OpenContentElementByNameAndAttribute("SCRIPT", "SCRIPTNAME", i_pScriptCode.Name);
			if (ScriptElement.DoesAttributeExist("SCRIPTTYPE") && ScriptElement.OpenAttribute("SCRIPTTYPE") == "CustomScriptCode")
			{
				ScriptElement.Delete();
				if (pDatabase.DoesDatabaseObjectExistByFullName(FileName))
				{
					var pDatabaseObject = pDatabase.OpenDatabaseObjectByFullName(FileName);
					      ÄSCRIPT         EÖÄ
	var g_pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
	var g_pDynMgr = PropertyList.OpenPropertyAsIUnknown(PROPERTY_DYNAMICS_MANAGER);
	var g_Account = OpenAccountFromPropertyList(PropertyList);
	var g_Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);

	var g_TelespaceURLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.TelespaceURLSyntax");
	var g_TelespaceCanonicalURL = g_Telespace.OpenCanonicalURL();
	var g_TelespaceGUID = g_TelespaceURLSyntax.ParseCanonicalURL(g_TelespaceCanonicalURL);
	var g_ToolName = PropertyList.OpenProperty(PROPERTY_TOOL_NAME);
	var g_pWindowsManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
	var g_SessionID = CreateGUID();
	var g_SharedObjectTableName = "GrooveFormsUIRunTimeData" + g_SessionID;
	var g_UIRunTimeData = GrooveScriptFunctions.OpenSharedObjectTable(g_SharedObjectTableName);
	var g_ToolObjectCache = OpenCacheFromRunTimeData(g_UIRunTimeData, "ToolObject_ObjectCache");
	var g_ComponentObjectCache = OpenCacheFromRunTimeData(g_UIRunTimeData, "ComponentObject_ObjectCache");

	// Internationalization global variables.
	var g_pNullObject = GrooveScriptFunctions.CreateNewObject("");

	// Interface pointers for the DataModelDelegate
	var g_pIFormsToolDataModelPrivate = DataModelDelegate.IGrooveFormsToolDataModelPrivate;
	var g_pIFormsToolDataModel = DataModelDelegate.IGrooveFormsToolDataModel;
	var g_pIFormsToolConfigurationSettings = DataModelDelegate.IGrooveFormsToolConfigurationSettings;

	var g_CurrentState;
	var g_DesignerState = false;
	var g_MetaDataTable = null;
	var g_bCommandsShown = false;
	var g_OnFormPage = false;
	var g_pFieldsDocument;
	var g_FieldsDocumentVersionID = "";
	var g_ToolObjectVersionID = "";
	var g_Schema;
	var g_MetaDataLoaded = false;
	var g_CurrentTool = null;
	var g_pForm = null;
	var g_CurrentToolInited = false;
	var g_IsPreview = false;
	var g_IsNew = false;
	var g_SystemDatabaseID = null;
	var g_FormSepIndex = -1;
	var g_ViewSepIndex = -1;
	var g_CurrentViewID;
	var g_CurrentFormID;
	var g_MenuClass1State = null;
	var g_MenuClass2State = null;
	var g_IsSearchActive = false;
	var g_CurrentRecordID;
	var g_Document = null;
	var g_PreviewDocument = null;
    var g_Application = null;
	var g_DefaultButtons = "";
	var g_SearchButtons = "";
	var g_UpdateMenuFlag = true;
	var g_FormMenuBuilt = false;
	var g_ViewMenuBuilt	= false;
	var g_ModifyFormMenuBuilt = false;
	var g_ModifyViewMenuBuilt	= false;
	var g_IsImporting = false;
	var g_ReturnToMgr = false;
	var g_ShowSandboxButtons = false;
	var g_Dirty = false;
	var g_NeedToRemoveSandbox = false;
	var g_FileScriptCode = new Array();
	var g_ScriptCodeChanged = false;
	var g_ACLCookie;
	var g_DelegateIsSinked = false;
	var g_SaveInProgress = false;
	var g_SaveSuccess = false;
	var g_IsDirtySave = false;
	var g_SchemaUpdateInProgress = false;
	var g_WebBrowserTotalSize = 0;
	var g_UIPropertyListIsValid = false;
	var g_AwaitingDatabaseAdded = false;
	var g_UIIsVisible = false;
	var g_ReloadViewLocationMessageBoxActive = false;
	var g_VerifyDesignerPermissionMessageBoxActive = false;
	var g_ToolAvailable = true;
	var g_BrowseToRecordID = null;
	var g_pDesigner = null;
	// Menu command containers
	var g_FileNewCC = null;
	var g_FileDocumentCC = null;
	var g_EditUndoRedoCC = null;
	var g_EditClipboardCC = null;
	var g_EditCopyLinksCC = null;
	var g_EditCC = null;
	var g_EditMarkRead = null;
	var g_EditMarkUnread = null;
	var g_ViewShowHideCC = null;
	var g_ViewCC = null;
	var g_FormatCC = null;
	var g_OptionsCC = null;
	var g_FileAddEntryCC = null;
	var g_EditSearchCC = null;
	var g_ViewByCC = null;
	var GlobalCommandContainer = null;
	var g_DebugView = false;
	var g_Trust = false;
	var g_PromptedForTrust = false;

	function InstanceObject()
	{
		this.Element;
		this.ContentElement;
		this.Name="";
		this.Label="";
		this.MetaDataKey="";
		this.ContainedBy="";
		this.ObjectType="";
		this.Type;
		this.TypeDisplayName;
		this.Persist;
		this.ColumnPropertiesArray;
		this.DataType;
	}

	function SystemFieldAttributes()
	{
		this.FieldName;
		this.FieldLabel;
		this.FieldType;
		this.Prefix;
	}

	function MenuObject()
	{
		this.Label;
		this.UserData;
	}

	//**************************************************************************//
	//					ScriptHostComponent Sinks								//
	//**************************************************************************//

	function Initialize()
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			g_MetaDataTable = g_pIFormsToolDataModelPrivate.MetaDataTable;
			//GrooveDebugFunctions.DisplayAssert(0, "Break");
		
			ConnectObject(DataModelDelegate, "DataModelDelegate_");

			if (PropertyList.PropertyExists("FormsLastDirectory") == false)
				PropertyList.SetProperty("FormsLastDirectory", "", 0);

			// Sink ACL changes
			if (PropertyList.PropertyExists(PROPERTY_OBJECT_ENTRY_STORE))
			{
				ObjectEntryStore = PropertyList.OpenProperty(PROPERTY_OBJECT_ENTRY_STORE);
				var ScopeURLURI = PropertyList.OpenProperty(PROPERTY_TOOL).ObjectTypesScopeURL;
				var ScopeURL = ScopeURLURI.String;
				g_ACLCookie = ObjectEntryStore.AddAggregatedListener(ScriptHostComponent.IGrooveAggregatedObjectEntryStoreListener, ScopeURL);
			}
			// this fixes a problem where if you crash and need to restart and you were in design mode, we will
			// unlock when you come back in so any other mgr could go into design mode without you needing to 
			// open design mode and exit again.
			UnlockAllDBs();

			if (PropertyList.PropertyExists("GrooveForms_ToolDisseminatorVersion") == false)
				PropertyList.SetProperty("GrooveForms_ToolDisseminatorVersion", 0, GroovePropertyFlag_Private);

			Transaction.Commit();
		}
		catch(error)
		{
			GrooveDebugFunctions.DisplayAssert(0, error.description);
			Transaction.Abort();
		}
	}

	function OnSetUIProperties()
	{
		g_UIPropertyListIsValid = true;
				
		// We now need to initialize our Databases..
		if (typeof g_CurrentState == "undefined")
		{		
			if ((g_MSIEVersion.MajorVersion < 5) || (g_MSIEVersion.MajorVersion == 5 && g_MSIEVersion.MinorVersion == 0))
			{
				LoadHomePage()
				return;
			}
			else
			{
				FillDatabasesList();
				//GrooveDebugFunctions.DisplayAssert(0, "Break");
				//InitializeRunTimeSettings();
				LoadHomePage();				
				//var CellSizeObj = FormHomePageLayout.OpenControlInfo("WebBrowserView");
				//g_WebBrowserTotalSize = CellSizeObj.Size().CurrentWidthInPixels;
				//UpgradeCode();
			}
		}
	}

	function OnRevokeUIProperties()
	{
		g_UIPropertyListIsValid = false;
		// Want to call ShutdownBridge here to insure that
		// when the web browser view goes away, the bridge is not
		// left with a stale pointer.
		ShutdownBridge();
	}

	function OnViewContainerShow()
	{
		Timer.Start();
		g_UIIsVisible = true;
		//WebBrowserView.IgnoreNavigateTogether = true;
		//ShowFormViewMenus(g_CurrentState == "HomePage");
	}

	function OnViewContainerHide()
	{
		Timer.Stop();
		g_UIIsVisible = false;
	}


	// CommandBar 

	function OnConnectToExternalObject(i_Object, i_ConnectionID)
	{
		//GrooveDebugFunctions.DisplayAssert(0, "Break");
		if (0 == i_ConnectionID)
		{
			UICommandContainer = i_Object;
			
			//if (typeof g_CurrentRecordID != "undefined")
				//ShowUICommands(!g_DesignerState);
		}
		else if (1 == i_ConnectionID)
		{
			GlobalCommandContainer = i_Object;
			//ShowMenuCommands();
		}				
	}
	
	function OnUnconnectFromExternalObjects()
	{
		// Unconnect all sinks

		if (typeof UICommandContainer != "undefined")
		{
			HideUICommands();
		}

		if (typeof GlobalCommandContainer != "undefined")
			HideMenuCommands();

		UICommandContainer = null;
		GlobalCommandContainer = null;
		delete UICommandContainer;
		delete GlobalCommandContainer;
		CollectGarbage();
	}

	function Terminate()
	{
		//GrooveDebugFunctions.DisplayAssert(0, "Terminate called");
		// Remove ACL listener
		if (typeof ObjectEntryStore != "undefined")
			ObjectEntryStore.RemoveAggregatedListener(g_ACLCookie);	

		if (g_pDesigner != null)
		{
			g_pDesigner.UnloadComponentCache();
			UnloadDesignerScript();
		}
		
		if (PropertyList.PropertyExists("FormsCurrentDatabase"))
		{
			var Database = PropertyList.OpenPropertyAsIUnknown("FormsCurrentDatabase");
			if (typeof Database != "undefined" && Database != null)
			{
				Database.IGrooveFormsDatabasePrivate.ShutdownDatabase();
			}
		}


		// Unlock any locked dbs
		UnlockAllDBs();
		ShutdownBridge();

		if (typeof g_pForm!= "undefined" && g_pForm != null)
		{
			g_pForm.Close();
			g_pForm = null;
			delete g_pForm;
		}

		if (g_CurrentTool)
		{
			DisconnectObject(g_CurrentTool.OpenDelegateComponent());
			g_CurrentTool = null;
			delete g_CurrentTool;
		}
		DisconnectObject(DataModelDelegate);
		g_pSM = null;
		delete g_pSM;
		g_Account = null;
		delete g_Account;
		g_Schema = null;
		delete g_Schema;
		CollectGarbage();
	}

	function OnPropertyChanged(i_Key, i_Value, i_LocallyGenerated)
	{
		if (i_Key == "DeleteFormatting")
		{
			var Transaction = g_Telespace.OpenTransaction(false);
			try
			{
				var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
				if (typeof ToolDelegate == "object")
				{
					ToolDelegate.RemoveFieldFormatInfo(i_Value);
					var DatabaseName = GetCurrentDatabaseName();
					var RecordType = GetRecordTypeForDatabaseName(DatabaseName);
					ToolDelegate.IGrooveFormsDatabaseToolPrivate.ModifyRecordSetEngineTriggerList(RecordType, i_Value, false);
				}

				Transaction.Commit();
			}
			catch (error)
			{
				Transaction.Abort();
				DisplayError(error);
			}
		}
		else if (i_Key == "GrooveForms_DefaultView")
		{
			SetDefaultLabelOnDefaultView(i_Value);
		}
		else if (i_Key == "GrooveForms_DefaultForm")
		{
			SetDefaultLabelOnDefaultForm(i_Value);
		}
		else if (i_Key == "GrooveForms_DesignChanged" && !i_LocallyGenerated && g_UIIsVisible)
		{
			PostEvent(122023, 0);
		}
	}

	function OnPostedEvent(i_Event)
	{
		if (i_Event == 122023)
			ReloadViewLocationAlert();
		else if (i_Event == 123546)
			VerifyDesignerPermission();
	}

	function OnTranslateAccelerator(i_Msg, i_KeyCode, i_KeyState, i_KeyModifiers)
	{
		if (i_Msg == GROOVE_WM_KEYDOWN && i_KeyCode == GROOVE_VK_INSERT && !(i_KeyModifiers & GROOVE_KEYMOD_CONTROL) && !(i_KeyModifiers & GROOVE_KEYMOD_SHIFT) && (typeof g_CurrentState == "undefined" || g_CurrentState == "HomePage"))
		{
			try
			{
				if (FocusOnView() && typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID != -1)
				{
					ToggleRecordRead();
					return true;
				}
				else
					return false;
			}
			catch (error)
			{
				return false;
			}
		}
		else if (i_Msg == GROOVE_WM_KEYUP && i_KeyCode == GROOVE_VK_DELETE && !(i_KeyModifiers & GROOVE_KEYMOD_CONTROL) && !(i_KeyModifiers & GROOVE_KEYMOD_SHIFT))
		{
			Delete();
		}
		else if (i_Msg == GROOVE_WM_KEYDOWN && i_KeyCode == GROOVE_VK_ENTER)
		{
			try
			{
				if (FocusOnView() && typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID != -1)
				{
					OpenEntry();
					return true;
				}
				else
					return false;
			}
			catch (error)
			{
				return false;
			}
		}
		else if (i_Msg == GROOVE_WM_KEYUP && i_KeyCode == GROOVE_VK_D && (i_KeyModifiers & GROOVE_KEYMOD_SHIFT) && (i_KeyModifiers & GROOVE_KEYMOD_CONTROL) && (i_KeyModifiers & GROOVE_KEYMOD_ALT))
		{
			try
			{
				if (!g_DebugView)
				{
					OuterViewContainer.LayoutByName = "DebugLayout";
					g_DebugView = true;
				}
				else
				{
					OpenDesigner("H");
					g_DebugView = false;
				}

				return true;	
			}
			catch(error)
			{
				return false;
			}
		}
		return false;
	}

	//**************************************************************************//
	//				End	ScriptHostComponent Methods								//
	//**************************************************************************//

	//**************************************************************************//
	//					UICommandContainer/Menu Methods							//
	//**************************************************************************//

	function SetPropertiesOnUICommandNoImage(i_pCommand, i_ToolTip, i_Label, i_Mnemonic, i_pListener)
	{
		SetPropertiesOnUICommand(i_pCommand, i_ToolTip, i_Label, i_Mnemonic, "", "", 0, 0, 0, i_pListener);
	}

	function SetPropertiesOnUICommand(i_pCommand, i_ToolTip, i_Label, i_Mnemonic, i_ImageURL, i_ImageMaskURL, i_ImageOffset, i_ImageWidth, i_ImageHeight, i_pListener)
	{
		i_pCommand.Tooltip = i_ToolTip;
		i_pCommand.Label = i_Label;

		if (i_Label != "")
			i_pCommand.DisplayLabel = true;
		else
			i_pCommand.DisplayLabel = false;

		if (i_Mnemonic != "")
			i_pCommand.Mnemonic = i_Mnemonic;

		if (i_ImageURL != "")
			i_pCommand.SetImage(i_ImageURL, i_ImageMaskURL, i_ImageOffset, i_ImageWidth, i_ImageHeight);

		if (i_pListener != null)
			i_pCommand.Listener = i_pListener;
	}

	function ShowUICommands(i_OnHomePage)
	{
		if ((g_MSIEVersion.MajorVersion < 5) || (g_MSIEVersion.MajorVersion == 5 && g_MSIEVersion.MinorVersion == 0))
			return;

		if (typeof UICommandContainer == "undefined" || UICommandContainer == null)
			return;
			
		if (g_pIFormsToolConfigurationSettings.AllowDesigner && !g_Trust)
			return;
		
		if (typeof g_pIFormsToolConfigurationSettings.ShowAllCommandBarButtons == "undefined" ||
			g_pIFormsToolConfigurationSettings.ShowAllCommandBarButtons == true)
		{
			if (!g_bCommandsShown && !g_OnFormPage)
			{
				g_bCommandsShown = true;

				var pCommand;
				var ImagesURL = "grooveFile:///ToolData\\groove.net\\CommonData\\CommonToolIconImages.jpg";
				var ImagesMaskURL = "grooveFile:///ToolData\\groove.net\\CommonData\\CommonToolIconImagesMask.bmp";
				var ImagePosition = 0;
				var Offset = 0;
				var Position = UICommandContainer.GetNumberOfUICommands();
				var Width = 16;
				var Height = 16;

				if (i_OnHomePage)
				{
					g_UpdateMenuFlag = true;
					g_FormMenuBuilt = false;
					g_ViewMenuBuilt	= false;
					g_ModifyFormMenuBuilt = false;
					g_ModifyViewMenuBuilt	= false;

					if (typeof g_pIFormsToolConfigurationSettings.AllowCreate == "undefined" ||
						g_pIFormsToolConfigurationSettings.AllowCreate == true)
					{
						Offset = Width * 62;
						var FormSubContainer = UICommandContainer.InsertUICommandContainer(FORMS_TOOL_FORM_MENU, Position++);
						SetPropertiesOnUICommand
							(
							FormSubContainer.UICommand, 
							FORMS_TOOL_FORM_MENU_TOOLTIP, 
							FORMS_TOOL_FORM_MENU_LABEL,
							"",
							ImagesURL,
							ImagesMaskURL,
							Offset,
							Width,
							Height,
							ScriptHostComponent.IGrooveUICommandListener
							);

						var pFormContainer = FormSubContainer.UICommandContainer2;
						pFormContainer.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;
												
						if (!CanCreate())
							FormSubContainer.Enabled = false;
						else
							FormSubContainer.Enabled = true;

					}

					if (typeof g_pIFormsToolConfigurationSettings.AllowSearch == "undefined" ||
						g_pIFormsToolConfigurationSettings.AllowSearch == true)
					{
						Offset = Width * 84;
						pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_SEARCH, Position++);
						SetPropertiesOnUICommand
							(
							pCommand,
							FORMS_TOOL_SEARCH_TOOLTIP,
							"",
							"",
							ImagesURL, 
							ImagesMaskURL, 
							Offset, 
							Width, 
							Height,
							ScriptHostComponent.IGrooveUICommandListener
							);
					}

					UICommandContainer.InsertSeparator(FORMS_TOOL_SEP1, Position++);

					//Cut
					Offset = Width * 2;
					pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_CUT, Position++);
					SetPropertiesOnUICommand
						(
						pCommand,
						FORMS_TOOL_CUT_TOOLTIP,
						"",
						"",
						ImagesURL, 
						ImagesMaskURL, 
						Offset, 
						Width, 
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);

					//Copy
					Offset = Width * 3;
					pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_COPY, Position++);
					SetPropertiesOnUICommand
						(
						pCommand,
						FORMS_TOOL_COPY_TOOLTIP,
						"",
						"",
						ImagesURL, 
						ImagesMaskURL, 
						Offset, 
						Width, 
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);

					//Paste
					Offset = Width * 5;
					pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_PASTE, Position++);
					SetPropertiesOnUICommand
						(
						pCommand,
						FORMS_TOOL_PASTE_TOOLTIP,
						"",
						"",
						ImagesURL, 
						ImagesMaskURL, 
						Offset, 
						Width, 
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);
					
					UICommandContainer.InsertSeparator(FORMS_TOOL_SEP2, Position++);

					//Previous unread
					Offset = Width * 6;
					pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_PREVIOUS_UNREAD, Position++);
					SetPropertiesOnUICommand
						(
						pCommand,
						FORMS_TOOL_PREVIOUS_UNREAD_TOOLTIP,
						"",
						"",
						ImagesURL, 
						ImagesMaskURL, 
						Offset, 
						Width, 
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);

					//Next unread
					Offset = Width * 7;
					pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_NEXT_UNREAD, Position++);
					SetPropertiesOnUICommand
						(
						pCommand,
						FORMS_TOOL_NEXT_UNREAD_TOOLTIP,
						"",
						"",
						ImagesURL, 
						ImagesMaskURL, 
						Offset, 
						Width, 
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);
					
					UICommandContainer.InsertSeparator(FORMS_TOOL_SEP3, Position++);

					//Expand
					Offset = Width * 12;
					pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_EXPAND, Position++);
					SetPropertiesOnUICommand
						(
						pCommand,
						FORMS_TOOL_EXPAND_TOOLTIP,
						"",
						"",
						ImagesURL, 
						ImagesMaskURL, 
						Offset, 
						Width, 
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);

					//Collapse
					Offset = Width * 13;
					pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_COLLAPSE, Position++);
					SetPropertiesOnUICommand
						(
						pCommand,
						FORMS_TOOL_COLLAPSE_TOOLTIP,
						"",
						"",
						ImagesURL, 
						ImagesMaskURL, 
						Offset, 
						Width, 
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);
					
					//View menu
					Offset = Width * 63;
					var ViewSubContainer = UICommandContainer.InsertUICommandContainer(FORMS_TOOL_VIEW_MENU, Position++);
					SetPropertiesOnUICommand
						(
						ViewSubContainer.UICommand,
						FORMS_TOOL_VIEW_MENU_TOOLTIP,
						FORMS_TOOL_VIEW_MENU_LABEL,
						"",
						ImagesURL, 
						ImagesMaskURL, 
						Offset, 
						Width, 
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);

					var pViewContainer = ViewSubContainer.UICommandContainer2;
					pViewContainer.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;

					if (g_pIFormsToolDataModel.CanUseDesigner() && (typeof g_pIFormsToolConfigurationSettings.AllowDesigner == "undefined" ||
						g_pIFormsToolConfigurationSettings.AllowDesigner == true))
					{
						
						UICommandContainer.InsertSeparator(FORMS_TOOL_SEP4, Position++);

						Offset = Width * 83;
						var ManagerSubContainer = UICommandContainer.InsertUICommandContainer(FORMS_TOOL_MANAGER_MENU, Position++);
						SetPropertiesOnUICommand
							(
							ManagerSubContainer.UICommand,
							FORMS_TOOL_MANAGER_TOOLTIP,
							FORMS_TOOL_MANAGER_LABEL,
							"",
							ImagesURL, 
							ImagesMaskURL, 
							Offset, 
							Width, 
							Height,
							null
							);

						var pManagerUICommandContainer = ManagerSubContainer.UICommandContainer2;
						pManagerUICommandContainer.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;

						pCommand = pManagerUICommandContainer.InsertUICommand(FORMS_TOOL_CREATE_NEW_FORM, 0);
						pCommand.Label = FORMS_TOOL_CREATE_NEW_FORM_LABEL;

						var EditFormSubContainer = pManagerUICommandContainer.InsertUICommandContainer(FORMS_TOOL_EDIT_FORM_MENU, 1);
						EditFormSubContainer = EditFormSubContainer.UICommandContainer;
						EditFormSubContainer.UICommand.Label = FORMS_TOOL_EDIT_FORM_MENU_LABEL;
						EditFormSubContainer.UICommandContainer2.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;

						pManagerUICommandContainer.InsertSeparator(FORMS_TOOL_MANAGER_MENU_SEP1, 2);

						pCommand = pManagerUICommandContainer.InsertUICommand(FORMS_TOOL_CREATE_NEW_VIEW, 3);
						pCommand.Label = FORMS_TOOL_CREATE_NEW_VIEW_LABEL;

						var EditViewSubContainer = pManagerUICommandContainer.InsertUICommandContainer(FORMS_TOOL_EDIT_VIEW_MENU, 4);
						EditViewSubContainer = EditViewSubContainer.UICommandContainer;
						EditViewSubContainer.UICommand.Label = FORMS_TOOL_EDIT_VIEW_MENU_LABEL;
						EditViewSubContainer.UICommandContainer2.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;

						pManagerUICommandContainer.InsertSeparator(FORMS_TOOL_MANAGER_MENU_SEP2, 5);

						pCommand = pManagerUICommandContainer.InsertUICommand(FORMS_TOOL_OPEN_MANAGER, 6);
						pCommand.Label = FORMS_TOOL_OPEN_MANAGER_LABEL;
						
						pManagerUICommandContainer.InsertSeparator(FORMS_TOOL_MANAGER_MENU_SEP3, 7);

						pCommand = pManagerUICommandContainer.InsertUICommand(FORMS_TOOL_SHOW_PERMISSIONS, 8);
						pCommand.Label = FORMS_TOOL_SHOW_PERMISSIONS_LABEL;
						if (g_CurrentTool)
							pCommand.Enabled = true;
						else
							pCommand.Enabled = false;
						

					}
				}
				else
				{
					Offset = Width * 37;
					pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_HOMEPAGE, Position++);
					SetPropertiesOnUICommand
						(
						pCommand,
						FORMS_TOOL_HOMEPAGE_TOOLTIP,
						FORMS_TOOL_HOMEPAGE_LABEL,
						"",
						ImagesURL,
						ImagesMaskURL,
						Offset,
						Width,
						Height,
						ScriptHostComponent.IGrooveUICommandListener
						);

					if (g_ShowSandboxButtons)
					{
						UICommandContainer.InsertSeparator(FORMS_TOOL_SEP1, Position++);

						Offset = Width * 135;
						pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_APPLY_SANDBOX, Position++);
						SetPropertiesOnUICommand
							(
							pCommand,
							FORMS_TOOL_APPLY_SANDBOX_TOOLTIP,
							FORMS_TOOL_APPLY_SANDBOX_LABEL,
							"",
							ImagesURL,
							ImagesMaskURL,
							Offset,
							Width,
							Height,
							ScriptHostComponent.IGrooveUICommandListener
							);

						Offset = Width * 136;
						pCommand = UICommandContainer.InsertUICommand(FORMS_TOOL_CANCEL_SANDBOX, Position++);
						SetPropertiesOnUICommand
							(
							pCommand,
							FORMS_TOOL_CANCEL_SANDBOX_TOOLTIP,
							FORMS_TOOL_CANCEL_SANDBOX_LABEL,
							"",
							ImagesURL,
							ImagesMaskURL,
							Offset,
							Width,
							Height,
							ScriptHostComponent.IGrooveUICommandListener
							);
					}
				}
			}
		}
	}

	function SafeRemoveSeparatorFromContainer(i_pContainer, i_SeparatorName)
	{
		if (i_pContainer.SeparatorExists(i_SeparatorName))
			i_pContainer.RemoveSeparator(i_SeparatorName);
	}

	function SafeRemoveUICommandFromContainer(i_pContainer, i_CommandName)
	{
		if (i_pContainer.UICommandExists(i_CommandName))
			i_pContainer.RemoveUICommand(i_CommandName);
	}

	function SafeRemoveCommandContainerFromContainer(i_pContainer, i_CommandContainerName)
	{
		if (i_pContainer.UICommandContainerExists(i_CommandContainerName))
			i_pContainer.RemoveUICommandContainer(i_CommandContainerName);
	}

	function SafeRemoveAllUICommandsFromSubContainer(i_pParentContainer, i_SubContainerName, i_RemoveSubContainer)
	{
		var pSubContainer = OpenSubCommandContainerNoThrow(i_pParentContainer, i_SubContainerName);
		if (null != pSubContainer)
		{
			pSubContainer.UICommandContainer.RemoveAllUICommands();

			if (i_RemoveSubContainer)
				i_pParentContainer.RemoveUICommandContainer(i_SubContainerName);
		}
	}

	function HideUICommands()
	{
		g_bCommandsShown = false;
		
		if (typeof UICommandContainer == "undefined")
			return;

 		var pManagerContainer = OpenSubCommandContainerNoThrow(UICommandContainer, FORMS_TOOL_MANAGER_MENU);
		if (null != pManagerContainer)
		{
			// Remove the edit form menu items.
			SafeRemoveAllUICommandsFromSubContainer(pManagerContainer.UICommandContainer, FORMS_TOOL_EDIT_FORM_MENU, true);

			// Remove the edit view menu items.
			SafeRemoveAllUICommandsFromSubContainer(pManagerContainer.UICommandContainer, FORMS_TOOL_EDIT_VIEW_MENU, true);

			// And remove all from this container
			pManagerContainer.UICommandContainer.RemoveAllUICommands();
		}

		// Remove the Form and View menu command containers
		SafeRemoveAllUICommandsFromSubContainer(UICommandContainer, FORMS_TOOL_FORM_MENU, true);
		SafeRemoveAllUICommandsFromSubContainer(UICommandContainer, FORMS_TOOL_VIEW_MENU, true);

		// Remove Separators and other commands
		SafeRemoveSeparatorFromContainer(UICommandContainer, FORMS_TOOL_SEP1);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_SEARCH);
		SafeRemoveSeparatorFromContainer(UICommandContainer, FORMS_TOOL_SEP2);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_CUT);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_COPY);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_PASTE);
		SafeRemoveSeparatorFromContainer(UICommandContainer, FORMS_TOOL_SEP3);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_NEXT_UNREAD);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_PREVIOUS_UNREAD);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_EXPAND);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_COLLAPSE);
		SafeRemoveSeparatorFromContainer(UICommandContainer, FORMS_TOOL_SEP4);
		SafeRemoveCommandContainerFromContainer(UICommandContainer, FORMS_TOOL_MANAGER_MENU);

		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_HOMEPAGE);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_APPLY_SANDBOX);
		SafeRemoveUICommandFromContainer(UICommandContainer, FORMS_TOOL_CANCEL_SANDBOX);
	}

	function UpdateContainerItems(i_UICommandContainer, i_UICommand)
	{
		if (GetIsSafeForUI() == false)
			return;

		var CommandURL = i_UICommand.CommandURL;
		var ContainerURL = i_UICommandContainer.CommandURL;
		if (ContainerURL == FORMS_TOOL_MANAGER_MENU)
		{
			switch(CommandURL)
			{
				case FORMS_TOOL_OPEN_MANAGER:
				{
					if (g_pIFormsToolDataModel.OpenDatabaseCount() > 0)
						i_UICommand.Enabled = true;
					else
						i_UICommand.Enabled = false;
					break;
				}
				case FORMS_TOOL_CREATE_NEW_FORM:
				{
					i_UICommand.Enabled = true;
					break;
				}
				case FORMS_TOOL_EDIT_FORM_MENU:
				case FORMS_TOOL_CREATE_NEW_VIEW:
				{
					i_UICommand.Enabled = EnableMenus("MenuClass2");
					break
				}					
				case FORMS_TOOL_EDIT_VIEW_MENU:
				{
					i_UICommand.Enabled = EnableMenus("MenuClass1");
					break
				}
				
				case FORMS_TOOL_SHOW_PERMISSIONS:
				{
					if (g_CurrentTool)
						i_UICommand.Enabled = true;
					else
						i_UICommand.Enabled = false;
				}
			}
		}
	}

	function UpdateContainerState(i_pIUICommandContainer)
	{
		if (i_pIUICommandContainer.CommandURL == FORMS_TOOL_FORM_MENU ||
			i_pIUICommandContainer.CommandURL == FT_MENU_FILE_ADD_ENTRY_MENU)
			BuildFormsMenu(i_pIUICommandContainer);
		else if (i_pIUICommandContainer.CommandURL == FORMS_TOOL_VIEW_MENU || 
				 i_pIUICommandContainer.CommandURL == FT_MENU_VIEW_VIEW_BY_MENU)
			BuildViewsMenu(i_pIUICommandContainer);
		else if (i_pIUICommandContainer.CommandURL == FORMS_TOOL_EDIT_FORM_MENU)
			FillManagerEditFormsMenu();
		else if (i_pIUICommandContainer.CommandURL == FORMS_TOOL_EDIT_VIEW_MENU)
			FillManagerEditViewsMenu();
	}

	function UpdateMenuCommand(i_UICommand)
	{
		var CommandURL = i_UICommand.CommandURL;

		if (CommandURL == FORMS_TOOL_FORM_MENU)
		{
			if (!GetIsSafeForUI())
				i_UICommand.Enabled = false;
			else
				i_UICommand.Enabled = CanCreate() && EnableMenus("MenuClass1");
		}
		else if (CommandURL == FT_MENU_FILE_NEW_FORM ||
				 CommandURL == FT_MENU_FILE_NEW_VIEW)
		{
			i_UICommand.Enabled = true;
			if (g_CurrentState == "Views" || g_CurrentState == "Forms")
				i_UICommand.Enabled = false;
		}
		else if (CommandURL == FORMS_TOOL_VIEW_MENU ||
				 CommandURL == FORMS_TOOL_SEARCH)
		{
			i_UICommand.Enabled = true;
			if (GetIsSafeForUI() == false)
				i_UICommand.Enabled = false;
			else
				i_UICommand.Enabled = EnableMenus("MenuClass1");
		}
		else if (CommandURL == FT_MENU_VIEW_VIEW_BY_MENU)
			i_UICommand.Enabled = (g_CurrentState == "HomePage");
		else if (CommandURL == FT_MENU_FILE_IMPORT)
		{
			var DatabaseName = null;
			var NumViews = 0;
			DatabaseName = GetCurrentDatabaseName();
			if (DatabaseName != null)
			{
				var Db = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
				var NumViews = Db.OpenDatabaseObjectCountByType(GrooveFormsDatabaseObjectType_View);
			}

			if (g_CurrentState == "HomePage" && NumViews != 0)
			{
				i_UICommand.Label = FT_MENU_LABEL_IMPORT;
				i_UICommand.Enabled = CanCreate();
			}
			else
			{
				i_UICommand.Label = FT_MENU_LABEL_USE_TEMPLATE;
				if ((g_CurrentState == "Manager" || g_CurrentState == "HomePage") && (g_pIFormsToolDataModel.CanUseDesigner()) && (g_pIFormsToolDataModel.OpenDatabaseCount() == 0 || ViewsFormsListView.Count <= 2))
					i_UICommand.Enabled = true;
				else 
					i_UICommand.Enabled = false;
			}
		}
		else if (CommandURL == FT_MENU_FILE_CREATE_TEMPLATE)
			i_UICommand.Enabled = (FormFieldsListView.Count > 0 && g_CurrentState == "Manager");
		else if (CommandURL == FT_MENU_FILE_NEW_VIEW)
			i_UICommand.Enabled = (FormFieldsListView.Count > 0);
		else if (CommandURL == FT_MENU_FILE_ADD_ENTRY_MENU)
		{
			if (g_CurrentState == "HomePage")
				i_UICommand.Enabled = CanCreate() && GetIsSafeForUI();
			else
				i_UICommand.Enabled = false;
		}
		else if (CommandURL == FT_MENU_EDITUNDOREDO_UNDO)
		{
			if (g_CurrentTool && g_CurrentState == "HomePage")
			{
				var ToolDelegate = GetToolDelegate(g_CurrentTool);
				
				var bCanUndo = ToolDelegate.CanUndo();

				if (bCanUndo)
					i_UICommand.Enabled = true;
				else
					i_UICommand.Enabled = false;
			}
			else
				i_UICommand.Enabled = false;
		}
		else if (CommandURL == FT_MENU_EDITUNDOREDO_REDO)
		{
			if (g_CurrentTool && g_CurrentState == "HomePage")
			{
				var ToolDelegate = GetToolDelegate(g_CurrentTool);
				var bCanRedo = ToolDelegate.CanRedo();

				if (bCanRedo)
					i_UICommand.Enabled = true;
				else
					i_UICommand.Enabled = false;
			}
			else
				i_UICommand.Enabled = false;
		}
		else if (CommandURL == FT_MENU_EDIT_CLIP_CUT ||
				 CommandURL == FORMS_TOOL_CUT)
		{
			// The cut command requires a record to be selected and permission to delete.
			i_UICommand.Enabled = (FocusOnView() && typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID != -1 && CanDelete(g_CurrentRecordID));
		}
		else if (CommandURL == FT_MENU_EDIT_CLIP_COPY ||
				 CommandURL == FORMS_TOOL_COPY ||
				 CommandURL == FT_MENU_EDIT_LINK_COPY_AS_LINK ||
				 CommandURL == FT_MENU_EDIT_MARK_SELECTED_READ ||
				 CommandURL == FT_MENU_EDIT_MARK_SELECTED_UNREAD)
		{
			// These commands require a record to be selected.
			i_UICommand.Enabled = (FocusOnView() && typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID != -1);
		}
		else if (CommandURL == FT_MENU_EDIT_CLIP_PASTE ||
				 CommandURL == FORMS_TOOL_PASTE)
		{
			// The paste command does not require a record to be selected.
			i_UICommand.Enabled = (FocusOnView() && CanPasteFromClipboard());
		}
		else if (CommandURL == FT_MENU_EDIT_DELETE)
		{
			if (g_CurrentState == "Forms" || g_CurrentState == "Manager")
				i_UICommand.Enabled = true;
			else
				i_UICommand.Enabled = (FocusOnView() && typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID != -1 && CanDelete(g_CurrentRecordID));
		}
		else if (CommandURL == FT_MENU_EDIT_MARK_ALL_READ ||
		         CommandURL == FT_MENU_EDIT_MARK_ALL_UNREAD ||
		         CommandURL == FT_MENU_FILE_PRINT)
		{
			// These commands do not require a record to be selected.
			i_UICommand.Enabled = FocusOnView();
		}
		else if (CommandURL == FT_MENU_VIEW_EXPAND_ALL ||
				 CommandURL == FORMS_TOOL_EXPAND ||
				 CommandURL == FT_MENU_VIEW_COLLAPSE_ALL ||
				 CommandURL == FORMS_TOOL_COLLAPSE ||
				 CommandURL == FT_MENU_FILE_EXPORT_MENU ||
				 CommandURL == FT_MENU_FILE_OPEN_ENTRY ||
				 CommandURL == FT_MENU_EDIT_SEARCH)
		{
			var NumRecords = GetRecordCount();
			if (g_CurrentState == "HomePage" && NumRecords != 0)
			{
				if (CommandURL == FT_MENU_FILE_OPEN_ENTRY)
					i_UICommand.Enabled = (typeof g_CurrentRecordID != "undefined");
				else
					i_UICommand.Enabled = true;
			}
			else
				i_UICommand.Enabled = false;
		}
		else if (CommandURL == FT_MENU_VIEW_GO_TO)
		{
			if (g_CurrentState == "HomePage")
			{
				if (g_pIFormsToolDataModel.OpenDatabaseCount() > 0)
					i_UICommand.Enabled = true;
				else
					i_UICommand.Enabled = false;
				i_UICommand.Label = FT_MENU_LABEL_GOTO_FM;
			}
			else
				i_UICommand.Label = FT_MENU_LABEL_GOTO_DV;
		}
		else if (CommandURL == FT_MENU_VIEW_NEXT_UNREAD ||
				 CommandURL == FORMS_TOOL_NEXT_UNREAD ||
				 CommandURL == FT_MENU_VIEW_PREVIOUS_UNREAD || 
				 CommandURL == FORMS_TOOL_PREVIOUS_UNREAD ||
				 CommandURL == FT_MENU_VIEW_NEXT ||
				 CommandURL == FT_MENU_VIEW_PREVIOUS)
		{
			try
			{
				if (CommandURL == FT_MENU_VIEW_NEXT_UNREAD)
					Direction = GrooveFormsNavigation_NextUnread;
				else if (CommandURL == FT_MENU_VIEW_PREVIOUS_UNREAD)
					Direction = GrooveFormsNavigation_PriorUnread;
				else if (CommandURL == FT_MENU_VIEW_NEXT)
					Direction = GrooveFormsNavigation_NextAny;
				else (CommandURL == FT_MENU_VIEW_PREVIOUS)
					Direction = GrooveFormsNavigation_PriorAny;

				var EnableUICommand = false;
				var DataList = GetDataList();
				if (DataList.DataListDisplay.Initialized)
					EnableUICommand = DataList.DataListDisplay.CanMoveFocusRow(Direction);

				i_UICommand.Enabled = EnableUICommand;
			}
			catch (error)
			{
				i_UICommand.Enabled = false;
			}
		}
		else if (CommandURL == FORMS_TOOL_APPLY_SANDBOX ||
		         CommandURL == FT_MENU_FILE_PUBLISH_MOD ||
		         CommandURL == FORMS_TOOL_CANCEL_SANDBOX ||
		         CommandURL == FT_MENU_FILE_DISCARD_MOD)
		{
			try
			{
				var pSandbox = g_pDesigner.OpenCurrentSandboxVar();
				if (g_CurrentState == "Manager" && typeof pSandbox != "undefined" && pSandbox != null && g_pIFormsToolDataModelPrivate.DoesSandboxLogFileExist(pSandbox.DatabaseID))
					i_UICommand.Enabled = true;
				else
					i_UICommand.Enabled = false;
			}
			catch (error)
			{
				i_UICommand.Enabled = false;
			}
		}
	}

	function BuildFormsMenu(i_CommandContainer)
	{
		var EnumArray = GetArrayFromEnum(GetFormNameURLEnum);
		if (EnumArray != null && EnumArray.length > 0)
		{
			var FormSubContainer;
			if (i_CommandContainer.CommandURL == FT_MENU_FILE_ADD_ENTRY_MENU)
				FormSubContainer = i_CommandContainer;
			else
				FormSubContainer = UICommandContainer.OpenUICommandContainer(FORMS_TOOL_FORM_MENU);
			var MenuBuilt = FillMenu(FormSubContainer, EnumArray[0], EnumArray[1], FORMS_TOOL_FORM_LIST, false);
			g_FormMenuBuilt = MenuBuilt;
		}
	}

	function BuildViewsMenu(i_CommandContainer)
	{
		var EnumArray = GetArrayFromEnum(GetViewNameURLEnum);
		if (EnumArray != null && EnumArray.length > 0)
		{
			var FormSubContainer;
			if (i_CommandContainer.CommandURL == FT_MENU_VIEW_VIEW_BY_MENU)
				FormSubContainer = i_CommandContainer;
			else
				FormSubContainer = UICommandContainer.OpenUICommandContainer(FORMS_TOOL_VIEW_MENU);
			var MenuBuilt = FillMenu(FormSubContainer, EnumArray[0], EnumArray[1], FORMS_TOOL_VIEW_LIST, true);
			g_ViewMenuBuilt = MenuBuilt;
		}
	}

	function GetArrayFromEnum(i_Function)
	{
		var EnumArray = new Array();

		if (g_FormMenuBuilt && g_ViewMenuBuilt && g_ModifyFormMenuBuilt && g_ModifyViewMenuBuilt)
			g_UpdateMenuFlag = false;

		if (g_UpdateMenuFlag)
		{
			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName != null)
			{
				var NameURLEnum = i_Function(DatabaseName);
				if (NameURLEnum == null)
					return null;

				var NameArray = new Array();
				var URLArray = new Array();
				var Count = 0;

				while (NameURLEnum.HasMore())
				{
					var NameURLPair = NameURLEnum.OpenNextPair();
					NameArray[Count] = NameURLPair.First;
					URLArray[Count] = NameURLPair.Second;
					Count++;
				}
				EnumArray[0] = NameArray;
				EnumArray[1] = URLArray;
			}
		}

		return EnumArray;
	}

	function FillMenu(i_pContainer, i_NameArray, i_URLArray, i_Prefix, i_IsView)
	{
		// Clear the menu of all its items.
		i_pContainer.UICommandContainer.RemoveAllUICommands();

		var MenuBuilt = false;
		
		var MenuArray = new Array();

		var i = 0;
		while(i < i_NameArray.length)
		{
			var MenuObj = new MenuObject;
			MenuObj.Label = i_NameArray[i];
			MenuObj.UserData = i_URLArray[i];
			MenuArray[i] = MenuObj;
			i++;
		}
		
		MenuArray.sort(CompareMenu);

		var i = 0;
		while(i < MenuArray.length)
		{
			// Add the form to the main form menu.
			var pMainUICommand = i_pContainer.UICommandContainer.InsertUICommand(i_Prefix + i, i);
			pMainUICommand.Label = MenuArray[i].Label;
			pMainUICommand.UserData = MenuArray[i].UserData;
			pMainUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			if (i_IsView && GetCurrentWebView() == MenuArray[i].Label)
			{
				pMainUICommand.RadioCheck = true;
				pMainUICommand.CheckState = GrooveCheckState_Checked;
			}
			MenuBuilt = true;
			i++;
		}

		return MenuBuilt;
	}

	function CompareMenu(MenuObjA, MenuObjB)
	{
		if (MenuObjA.Label.toLowerCase() > MenuObjB.Label.toLowerCase())
			return 1;
		if (MenuObjA.Label.toLowerCase() < MenuObjB.Label.toLowerCase())
			return -1;
		return 0;
	}

	function FillManagerEditFormsMenu()
	{
		LoadDesignerScript();

		// Get the form enum from the database if the sandbox has not been created yet.
		var FormEnumArray;
		if (g_pDesigner.OpenCurrentSandboxVar() == null)
			FormEnumArray = GetArrayFromEnum(GetFormNameIDEnum);
		else
			FormEnumArray = GetArrayFromEnum(GetFormNameIDEnumFromSandbox);

		if (FormEnumArray != null && FormEnumArray.length > 0)
		{
			var ManagerSubContainer = UICommandContainer.OpenUICommandContainer(FORMS_TOOL_MANAGER_MENU);
			var pEditFormContainer = ManagerSubContainer.UICommandContainer.OpenUICommandContainer(FORMS_TOOL_EDIT_FORM_MENU);
			pEditFormContainer.UICommandContainer.RemoveAllUICommands();

			var FormMenuArray = new Array();

			var i = 0;
			while(i < FormEnumArray[0].length)
			{
				var MenuObj = new MenuObject;
				MenuObj.Label = FormEnumArray[0][i];
				MenuObj.UserData = FormEnumArray[1][i];
				FormMenuArray[i] = MenuObj;
				i++;
			}
			
			FormMenuArray.sort(CompareMenu);

			var i = 0;
			while(i < FormMenuArray.length)
			{
				var pEditUICommand = pEditFormContainer.UICommandContainer.InsertUICommand(FORMS_TOOL_EDIT_FORM_LIST + i, i);
				pEditUICommand.Label = FormMenuArray[i].Label + "...";
				pEditUICommand.UserData = FormMenuArray[i].UserData;
				pEditUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				i++;
			}

			g_ModifyFormMenuBuilt = true;
		}
	}

	function FillManagerEditViewsMenu()
	{
		LoadDesignerScript();

		// Get the view enum from the database if the sandbox has not been created yet.
		var ViewEnumArray;
		if (g_pDesigner.OpenCurrentSandboxVar() == null)
			ViewEnumArray = GetArrayFromEnum(GetViewNameIDEnum);
		else
			ViewEnumArray = GetArrayFromEnum(GetViewNameIDEnumFromSandbox);

		if (ViewEnumArray != null && ViewEnumArray.length > 0)
		{
			var ManagerSubContainer = UICommandContainer.OpenUICommandContainer(FORMS_TOOL_MANAGER_MENU);
			var pEditViewContainer = ManagerSubContainer.UICommandContainer.OpenUICommandContainer(FORMS_TOOL_EDIT_VIEW_MENU);
			pEditViewContainer.UICommandContainer.RemoveAllUICommands();

			var ViewMenuArray = new Array();

			var i = 0;
			while(i < ViewEnumArray[0].length)
			{
				var MenuObj = new MenuObject;
				MenuObj.Label = ViewEnumArray[0][i];
				MenuObj.UserData = ViewEnumArray[1][i];
				ViewMenuArray[i] = MenuObj;
				i++;
			}
			
			ViewMenuArray.sort(CompareMenu);

			var i = 0;
			while(i < ViewMenuArray.length)
			{
				var pEditUICommand = pEditViewContainer.UICommandContainer.InsertUICommand(FORMS_TOOL_EDIT_VIEW_LIST + i, i);
				pEditUICommand.Label = ViewMenuArray[i].Label + "...";
				pEditUICommand.UserData = ViewMenuArray[i].UserData;
				pEditUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				MenuBuilt = true;
				i++;
			}

			g_ModifyViewMenuBuilt = true;
		}
	}

	function ShowFormViewMenus(i_Show)
	{
		HideUICommands();
		ShowUICommands(i_Show);
	}

	function SetUICommandEnabled(i_URL, i_Enabled)
	{
		if (typeof UICommandContainer != "undefined" && UICommandContainer != null)
		{
			if (UICommandContainer.UICommandExists(i_URL))
			{
				var pCommand = UICommandContainer.OpenUICommand(i_URL);
				pCommand.Enabled = i_Enabled;
			}
		}
	}

	function SetUICommandContainerEnabled(i_URL, i_Enabled)
	{
		
		if (typeof UICommandContainer != "undefined" && UICommandContainer != null)
		{
			var pCommandContainer = OpenSubCommandContainerNoThrow(UICommandContainer, i_URL);
			if (null != pCommandContainer)
			{
				if (i_URL == FORMS_TOOL_FORM_MENU && !CanCreate())
					pCommandContainer.Enabled = false;
				else
					pCommandContainer.Enabled = i_Enabled;
			}
		}
	}

	function EnableMenus(i_MenuClass)
	{
		try
		{
			// This is an optimization so that the other code does not need to be
			// run through if the state is already cached in a global variable.
			if (i_MenuClass == "MenuClass1" && g_MenuClass1State != null)
				return g_MenuClass1State;
			else if (i_MenuClass == "MenuClass2" && g_MenuClass2State != null)
				return g_MenuClass2State;

			if (g_pIFormsToolDataModel.OpenDatabaseCount() == 0)
				return false;

			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}			
			
			if (DatabaseName == null)
			{
				var NameArray = GetDatabaseNames();
				if(NameArray != null && NameArray.length > 0)
					DatabaseName = NameArray[0];		
				else
					return false;	
			}

			var pIGrooveFormsToolDataModel = g_pIFormsToolDataModel;

			if (typeof pIGrooveFormsToolDataModel != "undefined" && pIGrooveFormsToolDataModel != null)
			{
				if (i_MenuClass == "MenuClass1")
				{
					if (g_MenuClass1State == null)
					{
						var State = true;					
						var Db = OpenDatabaseByName(pIGrooveFormsToolDataModel, DatabaseName);

						var NumViews = Db.OpenDatabaseObjectCountByType(GrooveFormsDatabaseObjectType_View);
						if (NumViews == 0)
							State = false;

						var NumForms = Db.OpenDatabaseObjectCountByType(GrooveFormsDatabaseObjectType_Form);
						if (NumForms == 0)
							State = false;

						g_MenuClass1State = State;
					}
					return g_MenuClass1State;
				}
				else if (i_MenuClass == "MenuClass2")
				{
					if (g_MenuClass2State == null)
					{
						var State = true;			
						var Db = OpenDatabaseByName(pIGrooveFormsToolDataModel, DatabaseName);
						
						var NumForms = Db.OpenDatabaseObjectCountByType(GrooveFormsDatabaseObjectType_Form);
						if (NumForms == 0)
							State = false;

						g_MenuClass2State = State;
					}
					return g_MenuClass2State;
				}
			}
			else
				return false;
		}
		catch (error)
		{
			//GrooveScriptFunctions.DisplayAssert(0, "Error enabling menus: " + error.description);
			return false;
		}
	}

	function ShowMenuCommands(i_State)
	{
		if (typeof GlobalCommandContainer == "undefined" || GlobalCommandContainer == null)
			return;
			
		if (g_pIFormsToolConfigurationSettings.AllowDesigner && !g_Trust)
			return;
		
		try
		{
			// Get all of the Tool specific Command Containers
			g_FileNewCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_FileNewToolCommands");
			g_FileDocumentCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_FileDocumentToolCommands");
			g_EditUndoRedoCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_EditUndoRedoToolCommands");
			g_EditClipboardCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_EditClipboardToolCommands");
			g_EditCopyLinksCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_EditCopyLinksToolCommands");
			g_EditCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_EditToolCommands");
			g_EditMarkRead = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_MarkRead");
			g_EditMarkUnread = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_MarkUnread");
			g_ViewShowHideCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_ViewShowHideToolCommands");
			g_ViewCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_ViewToolCommands");
			g_FormatCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_TopLevelToolCommands1");
			g_OptionsCC = OpenSubCommandContainerNoThrow(GlobalCommandContainer, "GUICC_Options");

			// Need to remove the menu commands from the previous state
			HideMenuCommands();
			// Note that all commands the tool supports appear on one of the menus above

			var ImagesURL = "grooveFile:///ToolData\\groove.net\\CommonData\\CommonToolIconImages.jpg";
			var ImagesMaskURL = "grooveFile:///ToolData\\groove.net\\CommonData\\CommonToolIconImagesMask.bmp";
			var Offset = 0;
			var Width = 16;
			var Height = 16;
			
			if (null != g_FileNewCC)
			{
				var Position = g_FileNewCC.GetNumberOfUICommands();

				if (g_pIFormsToolDataModel.CanUseDesigner() && (typeof g_pIFormsToolConfigurationSettings.AllowDesigner == "undefined" ||
							g_pIFormsToolConfigurationSettings.AllowDesigner == true))
				{
					Offset = Width * 62;
					var UICommand = g_FileNewCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_NEW_FORM, Position++);
					SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_NEW_FORM, "", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

					Offset = Width * 63;
					var UICommand = g_FileNewCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_NEW_VIEW, Position++);
					SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_NEW_VIEW, "", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);
				}
			}
			
			if (null != g_FileDocumentCC)
			{
				var Position = g_FileDocumentCC.GetNumberOfUICommands();

				g_FileAddEntryCC = g_FileDocumentCC.UICommandContainer.InsertUICommandContainer(FT_MENU_FILE_ADD_ENTRY_MENU, Position++);
				Offset = Width * 62;
				SetPropertiesOnUICommand
								(
								g_FileAddEntryCC.UICommand, 
								"", 
								FT_MENU_LABEL_ADD_ENTRY,
								"",
								ImagesURL,
								ImagesMaskURL,
								Offset,
								Width,
								Height,
								ScriptHostComponent.IGrooveUICommandListener
								);

				g_FileAddEntryCC.UICommandContainer2.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;

				var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_OPEN_ENTRY, Position++);
				SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_OPEN_ENTRY, "", ScriptHostComponent.IGrooveUICommandListener);

				g_FileDocumentCC.UICommandContainer.InsertSeparator(FT_MENU_FILE_SEP1, Position++);

				if (g_pIFormsToolDataModel.CanUseDesigner() && (typeof g_pIFormsToolConfigurationSettings.AllowDesigner == "undefined" ||
							g_pIFormsToolConfigurationSettings.AllowDesigner == true))
				{
					Offset = Width * 0;
					var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_PUBLISH_MOD, Position++);
					SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_PUBLISH_MOD, "", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

					Offset = Width * 16;
					var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_DISCARD_MOD, Position++);
					SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_DISCARD_MOD, "", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

					g_FileDocumentCC.UICommandContainer.InsertSeparator(FT_MENU_FILE_SEP2, Position++);
					
					var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_CREATE_TEMPLATE, Position++);
					SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_CREATE_TEMPLATE, "", ScriptHostComponent.IGrooveUICommandListener);

					g_FileDocumentCC.UICommandContainer.InsertSeparator(FT_MENU_FILE_SEP3, Position++);
				}

				var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_IMPORT, Position++);
				SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_IMPORT, "", ScriptHostComponent.IGrooveUICommandListener);

				var g_FileExportCC = g_FileDocumentCC.UICommandContainer.InsertUICommandContainer(FT_MENU_FILE_EXPORT_MENU, Position++);
				SetPropertiesOnUICommandNoImage(g_FileExportCC.UICommand, "", FT_MENU_LABEL_EXPORT, "", ScriptHostComponent.IGrooveUICommandListener);

				if (null != g_FileExportCC)
				{
					var SubCCPosition = g_FileAddEntryCC.GetNumberOfUICommands();
					
					var UICommand = g_FileExportCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_EXPORT_BIN, SubCCPosition++);
					SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_EXPORT_BIN, "", ScriptHostComponent.IGrooveUICommandListener);

					var UICommand = g_FileExportCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_EXPORT_TAB, SubCCPosition);
					SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_EXPORT_TAB, "", ScriptHostComponent.IGrooveUICommandListener);

					var UICommand = g_FileExportCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_EXPORT_STRUCT, SubCCPosition++);
					SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_EXPORT_STRUCT, "", ScriptHostComponent.IGrooveUICommandListener);

					var UICommand = g_FileExportCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_EXPORT_XML, SubCCPosition++);
					SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_EXPORT_XML, "", ScriptHostComponent.IGrooveUICommandListener);
				}

				g_FileDocumentCC.UICommandContainer.InsertSeparator(FT_MENU_FILE_SEP4, Position++);

				var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(FT_MENU_FILE_PRINT, Position++);
				SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_PRINT, "", ScriptHostComponent.IGrooveUICommandListener);
			}
			
			if (null != g_EditClipboardCC)
			{
				var Position = g_EditClipboardCC.GetNumberOfUICommands();

				// Edit - Clipboard Menu
				Offset = Width * 2;
				var UICommand = g_EditClipboardCC.UICommandContainer.InsertUICommand(FT_MENU_EDIT_CLIP_CUT, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_CLIP_CUT, "Ctrl+X", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				Offset = Width * 3;
				UICommand = g_EditClipboardCC.UICommandContainer.InsertUICommand(FT_MENU_EDIT_CLIP_COPY, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_CLIP_COPY, "Ctrl+C", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				Offset = Width * 5;
				UICommand = g_EditClipboardCC.UICommandContainer.InsertUICommand(FT_MENU_EDIT_CLIP_PASTE, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_CLIP_PASTE, "Ctrl+V", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);
			}

			if (null != g_EditCopyLinksCC)
			{
				var Position = g_EditCopyLinksCC.GetNumberOfUICommands();

				// Edit - Copy Links Menu
				Offset = Width * 4;
				var UICommand = g_EditCopyLinksCC.UICommandContainer.InsertUICommand(FT_MENU_EDIT_LINK_COPY_AS_LINK, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_LINK_COPY_AS_LINK, "Ctrl+L", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);
			}

			if (null != g_EditCC)
			{
				var Position = g_EditCC.GetNumberOfUICommands();

				//Edit - Delete
				Offset = Width * 16;
				var UICommand = g_EditCC.UICommandContainer.InsertUICommand(FT_MENU_EDIT_DELETE, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_DELETE, "", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				g_EditCC.UICommandContainer.InsertSeparator(FT_MENU_EDIT_SEP1, Position++);

				//Edit - Search
				Offset = Width * 84;
				var UICommand = g_EditCC.UICommandContainer.InsertUICommand(FT_MENU_EDIT_SEARCH, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_SEARCH, "", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				g_EditCC.UICommandContainer.InsertSeparator(FT_MENU_EDIT_SEP2, Position++);

			}

			if (null != g_EditUndoRedoCC)
			{
				var Position = g_EditUndoRedoCC.GetNumberOfUICommands();
				
				if (typeof g_pIFormsToolConfigurationSettings.AllowUndoRedo == "undefined" ||
					g_pIFormsToolConfigurationSettings.AllowUndoRedo == true)
				{
					// Edit - Undo/Redo Menu
					Offset = Width * 24;
					var UICommand = g_EditUndoRedoCC.UICommandContainer.InsertUICommand(FT_MENU_EDITUNDOREDO_UNDO, Position++);
					SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_UNDO, "Ctrl+Z", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

					Offset = Width * 25;
					UICommand = g_EditUndoRedoCC.UICommandContainer.InsertUICommand(FT_MENU_EDITUNDOREDO_REDO, Position++);
					SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_REDO, "Ctrl+Y", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);
				}
			}

			if (null != g_EditMarkRead)
			{
				var UICommand = g_EditMarkRead.UICommandContainer.InsertUICommand(FT_MENU_EDIT_MARK_SELECTED_READ, 0);
				SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_MARK_SELECTED, "Ctrl+0x73", ScriptHostComponent.IGrooveUICommandListener);

//				var UICommand = g_EditMarkRead.UICommandContainer.InsertUICommand(FT_MENU_EDIT_MARK_ALL_READ, 1);
//				SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_MARK_TOOL, "Ctrl+Shift+0x73", ScriptHostComponent.IGrooveUICommandListener);
			}

			if (null != g_EditMarkUnread)
			{
				var UICommand = g_EditMarkUnread.UICommandContainer.InsertUICommand(FT_MENU_EDIT_MARK_SELECTED_UNREAD, 0)
				SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_MARK_SELECTED, "", ScriptHostComponent.IGrooveUICommandListener);

//				var UICommand = g_EditMarkUnread.UICommandContainer.InsertUICommand(FT_MENU_EDIT_MARK_ALL_UNREAD, 1)
//				SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_MARK_TOOL, "", ScriptHostComponent.IGrooveUICommandListener);
			}

			if (null != g_ViewCC)
			{
				var Position = g_ViewCC.GetNumberOfUICommands();

				// View Menu
				if (g_pIFormsToolDataModel.CanUseDesigner() && (typeof g_pIFormsToolConfigurationSettings.AllowDesigner == "undefined" ||
								g_pIFormsToolConfigurationSettings.AllowDesigner == true))
				{
					UICommand = g_ViewCC.UICommandContainer.InsertUICommand(FT_MENU_VIEW_GO_TO, Position++);
					SetPropertiesOnUICommandNoImage(UICommand, "", FT_MENU_LABEL_GOTO_FM, "", ScriptHostComponent.IGrooveUICommandListener);

					g_ViewCC.UICommandContainer.InsertSeparator(FT_MENU_VIEW_SEP1, Position++);
				}
				
				Offset = Width * 12;
				var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(FT_MENU_VIEW_EXPAND_ALL, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_EXPAND_ALL, "", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				Offset = Width * 13;
				var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(FT_MENU_VIEW_COLLAPSE_ALL, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_COLLAPSE_ALL, "", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				g_ViewCC.UICommandContainer.InsertSeparator(FT_MENU_VIEW_SEP2, Position++);
				
				Offset = Width * 9;
				var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(FT_MENU_VIEW_NEXT, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_NEXT_ENTRY, "0x72", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				Offset = Width * 8;
				UICommand = g_ViewCC.UICommandContainer.InsertUICommand(FT_MENU_VIEW_PREVIOUS, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_PREVIOUS_ENTRY, "Shift+0x72", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);
				
				Offset = Width * 7;
				var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(FT_MENU_VIEW_NEXT_UNREAD, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_NEXT_UNREAD, "0x73", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				Offset = Width * 6;
				UICommand = g_ViewCC.UICommandContainer.InsertUICommand(FT_MENU_VIEW_PREVIOUS_UNREAD, Position++);
				SetPropertiesOnUICommand(UICommand, "", FT_MENU_LABEL_PREVIOUS_UNREAD, "Shift+0x73", ImagesURL, ImagesMaskURL, Offset, Width, Height, ScriptHostComponent.IGrooveUICommandListener);

				g_ViewCC.UICommandContainer.InsertSeparator(FT_MENU_VIEW_SEP3, Position++);

				g_ViewByCC = g_ViewCC.UICommandContainer.InsertUICommandContainer(FT_MENU_VIEW_VIEW_BY_MENU, Position++);

				var ImagePosition = 0;
				Offset = Width * 63;
				SetPropertiesOnUICommand
					(
					g_ViewByCC.UICommand,
					"",
					FT_MENU_VIEW_LABEL_VIEW_BY,
					"",
					ImagesURL, 
					ImagesMaskURL, 
					Offset, 
					Width, 
					Height,
					ScriptHostComponent.IGrooveUICommandListener
					);

				g_ViewByCC.UICommandContainer2.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;

			}

			if (null != g_OptionsCC)
			{
				var UICommand = g_OptionsCC.UICommandContainer.InsertUICommand(FORMS_TOOL_SHOW_PERMISSIONS, 8);
				SetPropertiesOnUICommandNoImage(UICommand, "", FORMS_TOOL_SHOW_PERMISSIONS_LABEL, "", ScriptHostComponent.IGrooveUICommandListener);
				if (g_CurrentTool)
					UICommand.Enabled = true;
				else
					UICommand.Enabled = false;
			}
		}
		catch (error)
		{
			DisplayError(error);
		}
	}

	function HideMenuCommands()
	{  		
		if (typeof GlobalCommandContainer == "undefined" || GlobalCommandContainer == null)
			return;

		if (null != g_FileNewCC)
		{
			// Edit - Clipboard Menu
			SafeRemoveUICommandFromContainer(g_FileNewCC, FT_MENU_FILE_NEW_FORM);
			SafeRemoveUICommandFromContainer(g_FileNewCC, FT_MENU_FILE_NEW_VIEW);
		}

		if (null != g_FileDocumentCC)
		{
			// Edit - Clipboard Menu
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_ADD_ENTRY_MENU);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_OPEN_ENTRY);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_SEP1);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_PUBLISH_MOD);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_DISCARD_MOD);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_SEP2);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_CREATE_TEMPLATE);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_SEP3);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_IMPORT);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_EXPORT_MENU);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_SEP4);
			SafeRemoveUICommandFromContainer(g_FileDocumentCC, FT_MENU_FILE_PRINT);
		}
		
		if (null != g_EditClipboardCC)
		{
			// Edit - Clipboard Menu
			SafeRemoveUICommandFromContainer(g_EditClipboardCC, FT_MENU_EDIT_CLIP_CUT);
			SafeRemoveUICommandFromContainer(g_EditClipboardCC, FT_MENU_EDIT_CLIP_COPY);
			SafeRemoveUICommandFromContainer(g_EditClipboardCC, FT_MENU_EDIT_CLIP_PASTE);
		}

		if (null != g_EditCopyLinksCC)
		{
			// Edit - Copy Links Menu
			SafeRemoveUICommandFromContainer(g_EditCopyLinksCC, FT_MENU_EDIT_LINK_COPY_AS_LINK);
		}

		if (null != g_EditCC)
		{
			SafeRemoveUICommandFromContainer(g_EditCC, FT_MENU_EDIT_DELETE);
			SafeRemoveUICommandFromContainer(g_EditCC, FT_MENU_EDIT_SEP1);
			SafeRemoveUICommandFromContainer(g_EditCC, FT_MENU_EDIT_SEARCH);
			SafeRemoveUICommandFromContainer(g_EditCC, FT_MENU_EDIT_SEP2);
		}

		if (null != g_EditUndoRedoCC)
		{
			// Edit - Undo/Redo Menu
			SafeRemoveUICommandFromContainer(g_EditUndoRedoCC, FT_MENU_EDITUNDOREDO_UNDO);
			SafeRemoveUICommandFromContainer(g_EditUndoRedoCC, FT_MENU_EDITUNDOREDO_REDO);
		}

		if (null != g_EditMarkRead)
		{
			// Edit - Mark Read Menu
			SafeRemoveUICommandFromContainer(g_EditMarkRead, FT_MENU_EDIT_MARK_SELECTED_READ);
//			SafeRemoveUICommandFromContainer(g_EditMarkRead, FT_MENU_EDIT_MARK_ALL_READ);
		}

		if (null != g_EditMarkUnread)
		{
			// Edit - Mark Unread Menu
			SafeRemoveUICommandFromContainer(g_EditMarkUnread, FT_MENU_EDIT_MARK_SELECTED_UNREAD);
//			SafeRemoveUICommandFromContainer(g_EditMarkUnread, FT_MENU_EDIT_MARK_ALL_UNREAD);
		}

		if (null != g_ViewCC)
		{
			// View
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_SEP1);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_GO_TO);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_EXPAND_ALL);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_COLLAPSE_ALL);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_SEP2);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_NEXT);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_PREVIOUS);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_NEXT_UNREAD);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_PREVIOUS_UNREAD);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_SEP3);
			SafeRemoveUICommandFromContainer(g_ViewCC, FT_MENU_VIEW_VIEW_BY_MENU);
		}

		if (null != g_OptionsCC)
		{
			SafeRemoveUICommandFromContainer(g_OptionsCC, FORMS_TOOL_SHOW_PERMISSIONS);
		}

	}

	function ExecuteMenuCommand(i_UICommand)
	{
		var CommandURL = i_UICommand.CommandURL;
		ExecuteCommand(CommandURL, i_UICommand);
	}

	function ExecuteCommand(CommandURL, i_UICommand)
	{
		try
		{
			// Code to execute menu commands
			if (CommandURL == FT_MENU_EDIT_CLIP_CUT ||
				CommandURL == FORMS_TOOL_CUT)
				Cut();
			else if (CommandURL == FT_MENU_EDIT_CLIP_COPY ||
					 CommandURL == FORMS_TOOL_COPY)
				CopyToClipboard();
			else if (CommandURL == FT_MENU_EDIT_CLIP_PASTE ||
					 CommandURL == FORMS_TOOL_PASTE)
				PasteFromClipboard();
			else if (CommandURL == FT_MENU_EDIT_LINK_COPY_AS_LINK)
				CopyAsLink();
			else if (CommandURL == FT_MENU_EDIT_DELETE)
				Delete();
			else if (CommandURL == FT_MENU_FILE_OPEN_ENTRY)
				OpenEntry();
			else if (CommandURL == FT_MENU_FILE_PRINT)
				Print();
			else if (CommandURL == FT_MENU_EDIT_MARK_ALL_READ)
				MarkAllRecordsRead();
			else if (CommandURL == FT_MENU_EDIT_MARK_ALL_UNREAD)
				MarkAllRecordsRead(false);
			else if (CommandURL == FT_MENU_EDIT_MARK_SELECTED_UNREAD)
				MarkRecordRead(false);
			else if (CommandURL == FT_MENU_EDIT_MARK_SELECTED_READ)
				MarkRecordRead(true);
			else if (CommandURL == FT_MENU_VIEW_GO_TO)
			{
				if (g_CurrentState == "HomePage")
					OpenDesigner("M");
				else
					OpenDesigner("H");
			}
			else if (CommandURL == FT_MENU_VIEW_EXPAND_ALL ||
					 CommandURL == FORMS_TOOL_EXPAND)
			{
				if (g_pForm.DoesDelegateComponentExist())
				{
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
					UIToolDelegate.IGrooveFormsDatabaseUITool.ExpandAll();
				}
				else
					ThrowError("Form does not have delegate component.");
			}
			else if (CommandURL == FT_MENU_VIEW_COLLAPSE_ALL ||
					 CommandURL == FORMS_TOOL_COLLAPSE)
			{
				if (g_pForm.DoesDelegateComponentExist())
				{
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
					UIToolDelegate.IGrooveFormsDatabaseUITool.CollapseAll();
				}
				else
					ThrowError("Form does not have delegate component.");
			}
			else if (CommandURL == FT_MENU_VIEW_NEXT)
				NavigateToDocument(GrooveFormsNavigation_NextAny);
			else if (CommandURL == FT_MENU_VIEW_PREVIOUS)
				NavigateToDocument(GrooveFormsNavigation_PriorAny);
			else if (CommandURL == FT_MENU_VIEW_NEXT_UNREAD ||
					 CommandURL == FORMS_TOOL_NEXT_UNREAD)
				NavigateToDocument(GrooveFormsNavigation_NextUnread);
			else if (CommandURL == FT_MENU_VIEW_PREVIOUS_UNREAD ||
					 CommandURL == FORMS_TOOL_PREVIOUS_UNREAD)
				NavigateToDocument(GrooveFormsNavigation_PriorUnread);
			else if (CommandURL == FORMS_TOOL_SHOW_PERMISSIONS)
				ViewDatabaseToolPermissions();
			else if (CommandURL == FT_MENU_EDITUNDOREDO_UNDO)
			{
				if (g_CurrentTool && g_CurrentState == "HomePage")
				{
					var ToolDelegate = GetToolDelegate(g_CurrentTool);
					ToolDelegate.Undo();
				}
			}
			else if (CommandURL == FT_MENU_EDITUNDOREDO_REDO)
			{
				if (g_CurrentTool && g_CurrentState == "HomePage")
				{
					var ToolDelegate = GetToolDelegate(g_CurrentTool);
					ToolDelegate.Redo();
				}
			}
			else if (CommandURL == FORMS_TOOL_HOMEPAGE)
				OpenDesigner("H");
			else if (CommandURL == FORMS_TOOL_APPLY_SANDBOX ||
					 CommandURL == FT_MENU_FILE_PUBLISH_MOD)
				ApplySandboxChanges();
			else if (CommandURL == FORMS_TOOL_CANCEL_SANDBOX ||
					 CommandURL == FT_MENU_FILE_DISCARD_MOD)
				DiscardSandboxChanges();
			else if (CommandURL == FORMS_TOOL_OPEN_MANAGER)
				OpenDesigner("M");
			else if (CommandURL == FORMS_TOOL_CREATE_NEW_FORM ||
					 CommandURL == FT_MENU_FILE_NEW_FORM)
				CreateNewForm(CommandURL);
			else if (CommandURL == FORMS_TOOL_CREATE_NEW_VIEW ||
					 CommandURL == FT_MENU_FILE_NEW_VIEW)
				CreateNewView(CommandURL);
			else if (CommandURL == FORMS_TOOL_SEARCH ||
					 CommandURL == FT_MENU_EDIT_SEARCH)
				LoadFormSearchControl();
			else if (CommandURL == FT_MENU_FILE_CREATE_TEMPLATE)
			{	
				LoadDesignerScript();
				g_pDesigner.ExportDatabaseToTemplate();
			}
			else if (CommandURL == FT_MENU_FILE_IMPORT)
			{
				if (g_CurrentState == "HomePage" && g_pIFormsToolDataModel.OpenDatabaseCount() != 0)
					ImportData();
				else if (g_CurrentState == "Manager" || g_CurrentState == "HomePage")
					ImportDbObjects();
			}
			else if (CommandURL == FT_MENU_FILE_EXPORT_BIN)
				ExportData(0);
			else if (CommandURL == FT_MENU_FILE_EXPORT_TAB)
				ExportData(1);
			else if (CommandURL == FT_MENU_FILE_EXPORT_STRUCT)
				ExportData(2);
			else if (CommandURL == FT_MENU_FILE_EXPORT_XML)
				ExportData(3);
			else if (CommandURL.indexOf(FORMS_TOOL_FORM_LIST) >= 0)
				ChangeForm(i_UICommand);
			else if (CommandURL.indexOf(FORMS_TOOL_VIEW_LIST) >= 0)
				ChangeView(i_UICommand);
			else if (CommandURL.indexOf(FORMS_TOOL_EDIT_FORM_LIST) >= 0)
			{
				LoadDesignerScript();
				g_pDesigner.EditViewForm(i_UICommand, "F");
			}
			else if (CommandURL.indexOf(FORMS_TOOL_EDIT_VIEW_LIST) >= 0)
			{
				LoadDesignerScript();
				g_pDesigner.EditViewForm(i_UICommand, "V");
			}
		}
		catch (error)
		{
			DisplayError(error);
		}
	}

	//**************************************************************************//
	//				End	UICommandContainer/Menu Methods							//
	//**************************************************************************//

	//**************************************************************************//
	//                       Clipboard Functions                                //
	//**************************************************************************//

	function Cut()
	{
		CopyToClipboard();
		DeleteRecord(g_CurrentRecordID);
	}

	function CopyToClipboard()
	{
		try
		{
			SetClipboardEmpty();

			var Clipboard = GetClipboard();
			var ToolDelegate = GetToolDelegate(g_CurrentTool);

			// Set clipboard text so it can be pasted into text documents.
			var ExportString = ToolDelegate.ExportEntryToString(g_CurrentRecordID);
			if (ExportString != null)
				Clipboard.SetDataAsString("Text", ExportString);

			// Set clipboard as element so it can be pasted back into forms.
			var ExportElement = ToolDelegate.ExportEntryToElement(g_CurrentRecordID);
			if (ExportElement != null)
				Clipboard.SetDataAsElement("FormsRecord", ExportElement);
		}
		catch (error)
		{
			DisplayError(error);
		}
	}

	function CopyAsLink()
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			var pURI = GetURIToEntry(g_CurrentRecordID);
			if (pURI != null)
			{
				SetClipboardEmpty();
				CopyAsLinkToClipboard(pURI.String, "Forms Entry [" + g_CurrentRecordID + "]");
			}
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			DisplayError(error);
		}
	}

	function GetURIToEntry(i_RecordID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			var ToolURL = PropertyList.OpenProperty(PROPERTY_CANONICAL_URL);
			var pURI = GROOVE_GLOBAL_MISC_POINTER.OpenURI(ToolURL);
			pURI.SetQueryPart("RecordID", i_RecordID);
			Transaction.Commit();
			
			return pURI;
		}
		catch (error)
		{
			Transaction.Abort();
			return null;
		}
	}

	function PasteFromClipboard()
	{
		try
		{
			g_pWindowsManager.ShowWaitCursor();
			if (CanPasteFromClipboard())
			{
				var Clipboard = GetClipboard();

				var DatabaseName = null;
				try
				{
					DatabaseName = GetCurrentDatabaseName();
				}
				catch(error)
				{
				}

				if (DatabaseName == null)
				{
					g_pWindowsManager.ShowWaitCursor(false);
					DisplayError(new Error("Error getting database name."));
					return;
				}

				var ToolDelegate = GetToolDelegate(g_CurrentTool);

				// Import the contents of the clipboard into the forms database.
				var BIS = Clipboard.OpenDataAsBinary("FormsRecord");
				ToolDelegate.ImportFromStream(BIS, g_ToolName, DatabaseName, GetSelectedRecordID());
			}
		}
		catch (error)
		{
			DisplayError(new Error("There was an error pasting the record into the forms tool. Please try again."));
		}
		finally
		{
			g_pWindowsManager.ShowWaitCursor(false);
		}
	}

	function CanPasteFromClipboard()
	{
		try
		{
			var Clipboard = GetClipboard();
			return (Clipboard.IsDataAvailable("FormsRecord") && CanCreate());
		}
		catch (error)
		{
			return false;
		}
	}

	//**************************************************************************//
	//                     End Clipboard Functions                              //
	//**************************************************************************//

	//**************************************************************************//
	//                     Print Functions                                      //
	//**************************************************************************//

	function Print()
	{
		try
		{
			var PrintSubForm = PropertyList.OpenProperty(PROPERTY_FORM).ComponentContainer.OpenComponentByName("PrintSubForm");
			var Window = CreateWindowForSubForm("Print", PrintSubForm);

			// Stop if not connected to delegate.
			var b = Window.DoesDelegateComponentExist();
			if (b == false)
				g_ParentCode.ThrowError("Can't open the Delegate Code component.");
			
			var PrintHost = Window.OpenDelegateComponent();
			var PrintCode = PrintHost.GetScriptDispatch();

			var PrintHelpProvider = PrintCode.GetHelpProvider();
			SetHelpInfo("Print", PrintHelpProvider);

			PrintCode.SetWebBrowserEngine(WebBrowserEngine);
			PrintCode.SetCallbackCode(ScriptHostComponent.GetScriptDispatch());
			PrintCode.LoadPrintOptions();
			
			var Result = Window.DoModal();
			Window.Destroy();
		}
		catch (error)
		{
			g_ParentCode.DisplayError(error);
		}
	}

	//**************************************************************************//
	//                     End Print Functions                                  //
	//**************************************************************************//

	//**************************************************************************//
	//				Unread Mark and Navigation Functions						//
	//**************************************************************************//

	function ToggleRecordRead()
	{
		// RMJLATER - not much difference between this and MarkRecordRead
		var Transaction = g_Telespace.OpenTransaction(false);	
		try
		{
			if (typeof g_CurrentRecordID != "undefined")
			{
				// Load the tool if it's not already loaded - we're going to need it
				var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
				if (typeof ToolDelegate == "object")
				{
					Timer.Stop();
					ToolDelegate.MarkRecordRead(g_CurrentRecordID, true, true);
				}
				else
					Timer.Stop();
				Transaction.Commit();
				return true;
			}
			else 
			{
				Transaction.Commit();
				return false;
			}
		}
		catch (error)
		{
			Transaction.Abort();
			return false;
		}
	}

	function MarkAllRecordsRead(i_bRead)
	{
		var Transaction = g_Telespace.OpenTransaction(false);	
		try
		{	
			if (typeof i_bRead == "undefined")
				i_bRead = true;
			// Load the tool if it's not already loaded - we're going to need it
			var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
			if (typeof ToolDelegate == "object")
			{
				Timer.Stop();
				ToolDelegate.MarkAllRecordsRead(i_bRead);
			}
			else
				Timer.Stop();
			Transaction.Commit();
			return true;
		}
		catch (e)
		{
			Transaction.Abort();
			return false;
		}
	}

	function MarkRecordRead(i_bRead)
	{
		var Transaction = g_Telespace.OpenTransaction(false);	
		try
		{
			if (typeof g_CurrentRecordID !="undefined")
			{
				// Load the tool if it's not already loaded - we're going to need it
				var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
				if (typeof ToolDelegate == "object")
				{
					ToolDelegate.MarkRecordRead(g_CurrentRecordID, i_bRead);
				}
				Transaction.Commit();
				return true;
			}
			else
			{
				Transaction.Commit();
				return false;
			}				
			
		}
		catch (e)
		{
			Transaction.Abort();
			return false;
		}
	}

	function NavigateToDocument(i_Direction)
	{
		g_pWindowsManager.ShowWaitCursor();
		try
		{
			if (typeof g_pForm == "undefined" || g_pForm == null)
				g_pForm = g_CurrentTool.UITool.CreateForm();
			
			if (g_pForm.DoesDelegateComponentExist())
				var UIToolDelegate = g_pForm.OpenDelegateComponent();
			else
				ThrowError("Form does not have delegate component.");

			var RecordID = UIToolDelegate.IGrooveFormsDatabaseUITool.NavigateToDocument(i_Direction, g_CurrentRecordID);
			UIToolDelegate = null;
			delete UIToolDelegate;
			var DataList = GetDataList();
			if (DataList.DataListDisplay.Initialized)
			{
				DataList.DataListDisplay.ScrollToRow(RecordID);
				DataList.DataListDisplay.SetFocusRow(RecordID);
			}
			SetSelectedRecordID(RecordID);
		}
		catch(error)
		{
			DisplayError(error);
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}
			return null;
		}
		finally
		{
			g_pWindowsManager.ShowWaitCursor(false);
		}
	}
	//**************************************************************************//
	//			End	Unread Mark and Navigation Functions						//
	//**************************************************************************//

	//**************************************************************************//
	//						Help Functions										//
	//**************************************************************************//
	function SetHelpInfo(i_ToolState, i_pIRTFHelpProvider)
	{
		// This function allows us to have context sensitive help.  When this function
		// is called, the ContextHelpID is changed so that if someone hits F1 while in
		// any of these states, we will be taken to the specific help as opposed to just
		// going to the beginning of the Forms Help.
		//
		// The states we support for help are
		//
		// 1. HomePage
		// 2. Form Design
		// 3. View Design
		// 4. Forms Manager
		// 5. Add Field Wizard
		// 6. Add Field To View dialog
		// 7. Modify Column Properties dialog
		// 8. Search Dialog
		// 9. Add Script To Form dialog
		// 10.Add Script To Tool dialog
		//
		// The following functions will call this method
		// SwitchUI (2, 3, 4)
		// LoadHomePage (1)
		// LoadFieldProperties (5)
		// PromptForView (6)
		// ModifyColumnProperties (7)
		// LoadFormSearchControl (8)
		// LoadAddScriptCodeControl (9, 10)

		var ContextHelpID = 0;
		// Get the help information.
		if (i_ToolState == "HomePage")
		{
			ContextHelpID = PropertyList.OpenPropertyAsLong("HomePageContextHelpURL");
			if (g_pIFormsToolConfigurationSettings.HelpID != 0 && g_pIFormsToolConfigurationSettings.HelpID != ContextHelpID)
				ContextHelpID = g_pIFormsToolConfigurationSettings.HelpID;
				
  		if (g_pIFormsToolConfigurationSettings.HelpDisplayName != "" && g_pIFormsToolConfigurationSettings.HelpDisplayName != "Forms")
				i_pIRTFHelpProvider.HelpDisplayName = g_pIFormsToolConfigurationSettings.HelpDisplayName;

		}
		else if (i_ToolState == "Forms")
			ContextHelpID = PropertyList.OpenPropertyAsLong("FormDesignerContextHelpURL");
		else if (i_ToolState == "Views")
			ContextHelpID = PropertyList.OpenPropertyAsLong("ViewDesignerContextHelpURL");
		else if (i_ToolState == "Manager")
			ContextHelpID = PropertyList.OpenPropertyAsLong("FormManagerContextHelpURL");
		else if (i_ToolState == "AddFieldWizard")
			ContextHelpID = PropertyList.OpenPropertyAsLong("AddFieldWizardContextHelpURL");
		else if (i_ToolState == "PromptForView")
			ContextHelpID = PropertyList.OpenPropertyAsLong("PromptForViewContextHelpURL");
		else if (i_ToolState == "ModifyColumnProperties")
			ContextHelpID = PropertyList.OpenPropertyAsLong("ModifyColumnPropertiesContextHelpURL");
		else if (i_ToolState == "SearchDialog")
			ContextHelpID = PropertyList.OpenPropertyAsLong("SearchDialogContextHelpURL");
		else if (i_ToolState == "AddScriptToForm")
			ContextHelpID = PropertyList.OpenPropertyAsLong("AddScriptToFormContextHelpURL");
		else if (i_ToolState == "AddScriptToTool")
			ContextHelpID = PropertyList.OpenPropertyAsLong("AddScriptToToolContextHelpURL");
		else if (i_ToolState == "Print")
			ContextHelpID = PropertyList.OpenPropertyAsLong("PrintContextHelpURL");

		// Forward the help information.
		i_pIRTFHelpProvider.SetHelpID(4, ContextHelpID, 0);
	}

	function GetClipboard()
	{
		return GrooveScriptFunctions.CreateNewObject("Groove.UIManager").OpenClipboard();
	}

	function FocusOnView()
	{
		try
		{
			if (g_CurrentState == "HomePage")
			{
				if (WebBrowserView.TopLevelURL.indexOf("FormsViewFrame.html") >= 0)
					return true;
				else
					return false;
			}
			else
			{
				return false;
			}
		}
		catch (error)
		{
			return false;
		}
	}

	function OpenEntry()
	{
		if (FocusOnView() && typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID != -1 && g_Document != null)
		{
			if (typeof g_Document.parentWindow != "undefined")
			{
				if (typeof g_Document.parentWindow.goDelete != "undefined")
					g_Document.parentWindow.goOpen(g_CurrentRecordID);
			}
		}		
	}

	function Delete()
	{
		if (g_CurrentState == "Forms" || g_CurrentState == "Manager")
			{
				var pFocusComponent = SafeOpenProperty(UIPropertyList, UI_PROPERTY_UIACTIVE_COMPONENT, null);
				if (null != pFocusComponent)
				{
					var ComponentName = pFocusComponent.Component.OpenName();
					if (ComponentName == "FormFieldsListView")
					{
						g_pDesigner.DeleteField();
						return true;
					}
					else if (ComponentName == "ViewsFormsListView")
					{
						g_pDesigner.DeleteViewForm();
						return true;
					}
				}	
			}
			else if (FocusOnView() && typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID != -1 && g_Document != null)
			{
				if (typeof g_Document.parentWindow != "undefined")
				{
					try
					{
						if (typeof g_Document.parentWindow.goDelete != "undefined")
							g_Document.parentWindow.goDelete();
					}
					catch(error)
					{
					}
				}
			}

	}

	//**************************************************************************//
	//					End	Help Functions										//
	//**************************************************************************//

	//**************************************************************************//
	//					Upgrade Code Functions									//
	//**************************************************************************//	

	function UpgradeCode()
	{
		//GrooveDebugFunctions.DisplayAssert(0,"");
		if (PropertyList.PropertyExists("TriggerListFixup") == false)
			FixupTriggerList();
		else if (PropertyList.OpenProperty("TriggerListFixup") != CURRENT_FORMS_VERSION)
			FixupTriggerList();
	}

	function FixupTriggerList()
	{
		var DbCount = GetDatabaseCount();
		if (DbCount == 0)
			return;
					
		var DatabaseName = null;
		try
		{
			DatabaseName = GetCurrentDatabaseName();
		}
		catch(error)
		{
		}

		if (DatabaseName != null)
		{
			var Database = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			var RecordType = GetRecordTypeForDatabaseName(DatabaseName);
			
			var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
			var DeletedList = Database.IGrooveFormsDatabasePrivate.DeletedFieldsList;
			var DeletedFieldNameValueEnum = DeletedList.OpenPropertyEnum();
			while (DeletedFieldNameValueEnum.HasMore())
			{
				var Pair = DeletedFieldNameValueEnum.OpenNextPair();
				ToolDelegate.IGrooveFormsDatabaseToolPrivate.ModifyRecordSetEngineTriggerList(RecordType, Pair.First, false);
			}
			PropertyList.SetProperty("TriggerListFixup", CURRENT_FORMS_VERSION, GroovePropertyFlag_Private);
		}
	}

	//**************************************************************************//
	//					End	Upgrade Code Functions								//
	//**************************************************************************//


	//**************************************************************************//
	//					General Forms Designer Functions						//
	//**************************************************************************//	
	function FillViewsFormsListView(i_SandboxID)
	{
		//GrooveDebugFunctions.DisplayAssert(0, "About to fill views/forms");
		try
		{
			var curSel = ViewsFormsListView.SelectionIndex;
			ViewsFormsListView.ResetContent();
			var FD = ViewsFormsListView.FontDescriptor;
			FD.Bold = true;
			g_FormSepIndex = ViewsFormsListView.AddItem2("Forms", -1, FD, 0);
			g_ViewSepIndex = ViewsFormsListView.AddItem2("Views", -1, FD, 1);
			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch (error)
			{
				
			}
			
			if (DatabaseName == null)
				ThrowError("Error getting database name.");

			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);

			if (pDatabase.DoesSandboxExistByID(i_SandboxID))
			{
				var pSandbox = pDatabase.OpenSandboxByID(i_SandboxID);

				var ObjectEnum = pSandbox.CreateDatabaseObjectNameAndTypeEnum();
				while (ObjectEnum.HasMore())
				{
					var SSPair = ObjectEnum.OpenNextPair();
					
					var Type = SSPair.Second;
					
					if (Type == GrooveFormsDatabaseObjectType_Form || Type == GrooveFormsDatabaseObjectType_View)
					{
						if (Type == GrooveFormsDatabaseObjectType_Form)
						{
							var index = ViewsFormsListView.InsertItem(g_ViewSepIndex,LeftBack(SSPair.First, "."));
							g_ViewSepIndex++;
							ViewsFormsListView.SetItemText(index, 1, "Form");
						}
						else if (Type == GrooveFormsDatabaseObjectType_View)
						{
							var index = ViewsFormsListView.AddItem(LeftBack(SSPair.First, "."));
							ViewsFormsListView.SetItemText(index, 1, "Data List");
						}
						
						var pSandboxObject = pSandbox.OpenDatabaseObjectByFullName(SSPair.First);
						var SandboxID = pSandboxObject.DatabaseObjectID;
						ViewsFormsListView.SetItemData(index, SandboxID);
					}			
				}

				ViewsFormsListView.SetSelectionByIndex(curSel);
				GROOVE_GLOBAL_MISC_POINTER.RegisterOneTimeCallback(ScriptHostComponent.IGrooveEventCallback, 81265);
			}
		
		}
		catch(error)
		{
			DisplayError(error);
		}
	}

	function OpenDesigner(i_State)
	{
		if (!CanOpenDesigner())
		{
			DisplayMgrWarning();
			return;
		}
		
		g_pWindowsManager.ShowWaitCursor();

		if (i_State == "F" || i_State == "V" || i_State == "M")
		{
			
			LoadDesignerScript();
			try
			{
				LoadMetaData();
			}
			catch(error)
			{
				DisplayError(error);
				return;
			}
			// Not on a form, so reset global variable.
			SetOnFormPage(false);

			
			var b = g_pDesigner.CreateOrOpenDatabaseForDesign(i_State);
			if (b)
			{
				//GrooveDebugFunctions.DisplayAssert(0, "");
				g_pDesigner.InitializeDesigner();
				if (g_pDesigner.GetSystemFieldsInited() && (!PropertyList.PropertyExists("SystemFieldsInited") || !PropertyList.OpenPropertyAsBool("SystemFieldsInited")))
					PropertyList.SetPropertyAsBool("SystemFieldsInited", true);
				g_pDesigner.SetTotalSize(g_WebBrowserTotalSize);
				if (i_State == "F" || i_State == "V")
				{
					if (i_State == "F")
					{
						var DialogTitle = "Form Name";
						var DefaultValue = "New Form";
					}
					else if (i_State == "V")
					{
						var DialogTitle = "View Name";
						var DefaultValue = "New View";
					}
					g_ShowSandboxButtons = false;
				}
				else if (i_State == "M")
				{
					g_ShowSandboxButtons = true;
				}

				if (OuterViewContainer.LayoutByName == "FormHomePageLayout")
				{
					ShutdownBridge();
					g_DesignerState = true;
				}

				ShowFormViewMenus(false);

				if (i_State == "F" || i_State == "V")
				{
					OuterViewContainer.LayoutByName = "OuterLayout";
					if (i_State == "F")
					{
						g_ComponentObjectCache.FormNameEditControl.Enabled = true;
						g_ComponentObjectCache.FormNameEditControl.Text = "New Form";
						g_IsNew = true;
						g_Dirty = false;
						SwitchUI("Forms");
						g_pDesigner.EnableDisabledFields();
						g_ComponentObjectCache.ResponseCheckbox.CheckState = GrooveCheckState_Unchecked;
						var Db = OpenDatabaseByID(GetCurrentDatabaseID());
						FormCount = 0;
						if (Db != null)
							FormCount = Db.OpenDatabaseObjectCountByType(GrooveFormsDatabaseObjectType_Form);

						if (FormCount == 0)
							g_ComponentObjectCache.DefaultFormCheckbox.CheckState = GrooveCheckState_Checked;
						else
							g_ComponentObjectCache.DefaultFormCheckbox.CheckState = GrooveCheckState_Unchecked;
					}
					else
					{
						g_ComponentObjectCache.FormNameEditControl.Text = "New View";
						g_ComponentObjectCache.FormNameEditControl.Enabled = true;
						g_IsNew = true;
						g_Dirty = false;
						SwitchUI("Views");
						g_pDesigner.DisableNonPersistableFields();
						g_ComponentObjectCache.GridLines.CheckState = GrooveCheckState_Checked;
						g_ComponentObjectCache.StretchChoice.CheckState = GrooveCheckState_Checked;
						g_ComponentObjectCache.DefaultViewCheckbox.CheckState = GrooveCheckState_Unchecked;
					}
				}
				else if (i_State == "M")
				{
					SwitchUI("Manager");
					g_ReturnToMgr = true;
				}
				
				g_ComponentObjectCache.FormNameEditControl.SetSelection(0, g_ComponentObjectCache.FormNameEditControl.Text.length);
				
				g_pWindowsManager.ShowWaitCursor(false);
				
				return true;
			}
			else
			{
				g_pWindowsManager.ShowWaitCursor(false);
				return false;
			}
		}
		else if (i_State == "H")
		{
			if (g_Dirty)
			{
				g_SaveInProgress = true;
				g_IsDirtySave = true;
				g_SaveSuccess = g_pDesigner.PromptForDirtySave();
			}

			// Remove the current sandbox if no changes have been made.
			if (g_pDesigner != null && g_pDesigner.OpenCurrentSandboxVar() != null)
			{
				var pSandbox = g_pDesigner.OpenCurrentSandbox();
				if (g_NeedToRemoveSandbox || (!g_IsImporting && typeof pSandbox != "undefined" && !g_pIFormsToolDataModelPrivate.DoesSandboxLogFileExist(pSandbox.DatabaseID)))
					RemoveCurrentSandbox(true);
			}

			g_Dirty = false;
			g_NeedToRemoveSandbox = false;

			ViewsFormsListView.ResetContent();
			ShutdownBridge();
			OuterViewContainer.LayoutByName = "FormHomePageLayout";
			LoadHomePage();
			SetupBridge();
			g_DesignerState = false;
			g_CurrentState = "HomePage";
			g_ShowSandboxButtons = false;
			UnlockAllDBs();
			ShowFormViewMenus(true);
			ShowMenuCommands();
			g_ReturnToMgr = false;
		}
		g_pWindowsManager.ShowWaitCursor(false);
	}
	
	function SwitchUI(i_Type)
	{
		if (i_Type != "Manager")
			OuterViewContainer.LayoutByName = "OuterLayout";

		var TableSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.HTMLTableLayoutControlInfo");
		var TableCellObj = TableSizeObj.Cell();

		if (i_Type == "Forms" && g_CurrentState!="Forms")
		{
			// Reset add script code global variables.
			g_FileScriptCode = new Array();
			g_ScriptCodeChanged = false;

			g_ComponentObjectCache.PageTitle.SetText("Create Form");
			//GrooveDebugFunctions.DisplayAssert(0, "Column count: "+ FormFieldsListView.ColumnCount);
			if (!g_ComponentObjectCache.InnerFormLayout.IsControlInLayout("AddScriptCodeButton"))
			{
				TableCellObj.Name="AddCodeToForm";
				g_ComponentObjectCache.InnerFormLayout.AddControlByName("AddScriptCodeButton", TableCellObj);
			}
			g_ComponentObjectCache.AddScriptCodeButton.Label = "Add Form Script...";
			g_ComponentObjectCache.AddScriptCodeButton.Tooltip = "Add JavaScript or VBScript code to this form";

			if (FormFieldsListView.ColumnCount > 3)
			{
				FormFieldsListView.RemoveColumn(5);
				FormFieldsListView.RemoveColumn(4);
				FormFieldsListView.RemoveColumn(3);
				FormFieldsListView.RemoveColumn(2);
			}

			if (g_IsNew == false && FormFieldsListView.ColumnCount < 3)
			{
				var LVCInfo = GrooveScriptFunctions.CreateNewObject("Groove.ListViewColumnInfo");
				LVCInfo.WidthType = GrooveListViewColumnWidthType_AutoSize;
				LVCInfo.Alignment = GrooveListViewColumnAlignment_Left;
				LVCInfo.HeaderAlignment = GrooveListViewColumnAlignment_Left;
				LVCInfo.ColumnHeading = "Custom Field";
				FormFieldsListView.InsertColumn2(2, LVCInfo);
			}
			g_ComponentObjectCache.InnerViewContainer.LayoutByName = "ModifyFormLayout";
			g_ComponentObjectCache.InnerViewContainer.SetFocus("FormNameEditControl");
			TableCellObj.Name = "Second";
			g_ComponentObjectCache.OuterLayout.AddControlByName("SaveButton",TableCellObj);
			TableCellObj.Name = "Third";
			g_ComponentObjectCache.OuterLayout.AddControlByName("CancelButton", TableCellObj);
			SetCurrentFormID();
			g_CurrentState = "Forms";
			SetHelpInfo("Forms", RTFHelpProvider);
		}
		else if (i_Type == "Views" && g_CurrentState!="Views")
		{
			g_ComponentObjectCache.PageTitle.SetText("Create View");
			g_ComponentObjectCache.ViewInfo.SetText("This view displays the following columns of checked fields:");
			g_ComponentObjectCache.GridLines.Label = "Show grid lines";
			//GrooveDebugFunctions.DisplayAssert(0, "Column count: "+ FormFieldsListView.ColumnCount);
			if (FormFieldsListView.ColumnCount == 3)
				FormFieldsListView.RemoveColumn(2);
			if (FormFieldsListView.ColumnCount < 6)
			{
				var LVCInfo = GrooveScriptFunctions.CreateNewObject("Groove.ListViewColumnInfo");
				LVCInfo.WidthType = GrooveListViewColumnWidthType_AutoSize;
				LVCInfo.Alignment = GrooveListViewColumnAlignment_Left;
				LVCInfo.HeaderAlignment = GrooveListViewColumnAlignment_Left;
				LVCInfo.ColumnHeading = "Column Header";
				FormFieldsListView.InsertColumn2(2, LVCInfo);

				LVCInfo.WidthType = GrooveListViewColumnWidthType_Pixels;
				LVCInfo.WidthInPixels = 40;
				LVCInfo.Alignment = GrooveListViewColumnAlignment_Right;
				LVCInfo.HeaderAlignment = GrooveListViewColumnAlignment_Right;
				LVCInfo.ColumnHeading = "Width";
				FormFieldsListView.InsertColumn2(3, LVCInfo);

				LVCInfo.WidthType = GrooveListViewColumnWidthType_AutoSize;
				LVCInfo.Alignment = GrooveListViewColumnAlignment_Left;
				LVCInfo.HeaderAlignment = GrooveListViewColumnAlignment_Left;
				LVCInfo.ColumnHeading = "Sort";
				FormFieldsListView.InsertColumn2(4, LVCInfo);

				LVCInfo.WidthType = GrooveListViewColumnWidthType_Pixels;
				LVCInfo.WidthInPixels = 40;
				LVCInfo.Alignment = GrooveListViewColumnAlignment_Right;
				LVCInfo.HeaderAlignment = GrooveListViewColumnAlignment_Right;
				LVCInfo.ColumnHeading = "Precision";
				FormFieldsListView.InsertColumn2(5, LVCInfo);
			}
			g_ComponentObjectCache.InnerViewContainer.LayoutByName = "ModifyDataViewLayout";
			g_ComponentObjectCache.InnerViewContainer.SetFocus("FormNameEditControl");
			TableCellObj.Name = "Second";
			g_ComponentObjectCache.OuterLayout.AddControlByName("SaveButton",TableCellObj);
			TableCellObj.Name = "Third";
			g_ComponentObjectCache.OuterLayout.AddControlByName("CancelButton", TableCellObj);
			SetCurrentViewID();
			g_CurrentState = "Views";
			SetHelpInfo("Views", RTFHelpProvider);
		}
		else if (i_Type == "Manager" && g_CurrentState!="Manager")
		{
			// Reset add script code global variables.
			g_FileScriptCode = new Array();
			g_ScriptCodeChanged = false;

			
			if (g_ComponentObjectCache.ManagerInnerLayout.IsControlInLayout("AddScriptCodeButton"))
				g_ComponentObjectCache.ManagerInnerLayout.RemoveControl("AddScriptCodeButton");
			
			if (!g_ComponentObjectCache.ManagerInnerLayout.IsControlInLayout("ImportFormButton"))
			{
				TableCellObj.Name="ImportForm";
				g_ComponentObjectCache.ManagerInnerLayout.AddControlByName("ImportFormButton", TableCellObj);
			}

			if (!g_ComponentObjectCache.ManagerInnerLayout.IsControlInLayout("ExportFormButton"))
			{
				TableCellObj.Name="ExportForm";
				g_ComponentObjectCache.ManagerInnerLayout.AddControlByName("ExportFormButton", TableCellObj);
			}
			
			
			OuterViewContainer.LayoutByName = "ManagerOuterLayout";
			g_ComponentObjectCache.PageTitle.SetText("Forms Manager");
			g_CurrentState = "Manager";
			SetHelpInfo("Manager", RTFHelpProvider);
		}
	}

	function SetCurrentViewID()
	{
		if (g_IsNew)
		{
			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName != null)
			{
				var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
				if (pDatabase)
				{
					g_CurrentViewID = pDatabase.CreateDatabaseObjectID();
					g_pIFormsToolDataModelPrivate.NewDatabaseViewID = pDatabase.CreateDatabaseObjectID();
				}
			}
		}
		else
		{
			var index = ViewsFormsListView.SelectionIndex;
			if (index != -1)
			{
				g_CurrentViewID = ViewsFormsListView.GetItemData(index);
				var NewViewID = GetDatabaseViewIDFromSandboxViewID(g_CurrentViewID);
				if (NewViewID != null)
					g_pIFormsToolDataModelPrivate.NewDatabaseViewID = NewViewID;
				else
					g_pIFormsToolDataModelPrivate.NewDatabaseViewID = GetDatabaseObjectIDFromLogForSandboxObjectID(g_CurrentViewID);
			}
			else
				GrooveDebugFunctions.DisplayAssert(0, "A View is not selected.");
		}
		//GrooveDebugFunctions.DisplayAssert(0, "View ID: " + g_CurrentViewID);
	}

	function SetCurrentFormID()
	{
		if (g_IsNew)
		{
			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName != null)
			{
				var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
				if (pDatabase)
				{
					g_CurrentFormID = pDatabase.CreateDatabaseObjectID();
					g_pIFormsToolDataModelPrivate.NewDatabaseFormID = pDatabase.CreateDatabaseObjectID();
				}
			}
		}
		else
		{
			var index = ViewsFormsListView.SelectionIndex;
			if (index != -1)
			{
				g_CurrentFormID = ViewsFormsListView.GetItemData(index);
				var NewFormID = GetDatabaseViewIDFromSandboxViewID(g_CurrentFormID);
				if (NewFormID != null)
					g_pIFormsToolDataModelPrivate.NewDatabaseFormID = NewFormID;
				else
					g_pIFormsToolDataModelPrivate.NewDatabaseFormID = GetDatabaseObjectIDFromLogForSandboxObjectID(g_CurrentFormID);
			}
			else
				GrooveDebugFunctions.DisplayAssert(0, "A Form is not selected.");
		}
	}

	function GetDatabaseObjectIDFromLogForSandboxObjectID(i_SandboxObjectID)
	{
		try
		{
			LoadDesignerScript();
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			//GrooveDebugFunctions.DisplayAssert(0, "");
			return g_pIFormsToolDataModelPrivate.OpenDatabaseObjectIDFromLogForSandboxObjectID(pSandbox.DatabaseID, i_SandboxObjectID);
		}
		catch (error)
		{
			return null;
		}
	}
	
	function GetSandboxObjectIDFromLogForDatabaseObjectID(i_DatabaseObjectID)
	{
		try
		{
			LoadDesignerScript();
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			//GrooveDebugFunctions.DisplayAssert(0, "");
			return g_pIFormsToolDataModelPrivate.OpenSandboxObjectIDFromLogForDatabaseObjectID(pSandbox.DatabaseID, i_DatabaseObjectID);
		}
		catch (error)
		{
			return null;
		}
	}

	function GetDatabaseViewIDFromSandboxViewID(i_SandboxViewID)
	{
		try
		{
			LoadDesignerScript();
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			return g_pIFormsToolDataModelPrivate.OpenViewObjectIDFromVersionFile(pSandbox.DatabaseID, i_SandboxViewID, "SbObjectID", "DBObjectID");
		}
		catch (error)
		{
			return null;
		}
	}

	function GetSandboxViewIDFromDatabaseViewID(i_DatabaseViewID)
	{
		try
		{
			LoadDesignerScript();
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			return g_pIFormsToolDataModelPrivate.OpenViewObjectIDFromVersionFile(pSandbox.DatabaseID, i_DatabaseViewID, "DBObjectID", "SbObjectID");
		}
		catch (error)
		{
			return null;
		}
	}

	function CanOpenDesigner()
	{
		var bTspPaused = g_Telespace.Descriptor.CommunicationsStatusAndControl.IsPaused(GrooveCommunicationsDirection_Both);
		var bCommsPaused = App.PauseCommunications;
		var bMoreThanOneMgr = IsMoreThanOneManager();
		var DbCount = GetDatabaseCount();
		
		if ((bTspPaused || bCommsPaused) && bMoreThanOneMgr && DbCount == 0)
			return false;
		else
			return true;
	}

	function IsMoreThanOneManager()
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			var Roles = Helper_GetRoles(STR_COMMON_ACCESS_CONTROL_TELESPACE_SCOPE_URL, g_Telespace, STR_COMMON_ACCESS_CONTROL_COMPONENT_GROUP_OBJECT_ID);
			var TemplateRoleEnum = Roles.TemplateRoles.CreateEnum("Role");
			
			var ManagerCount = 0;
			var MemberEnum = g_Telespace.Members.CreateEnum();
			while(MemberEnum.HasMore())
			{
				var Member = MemberEnum.OpenNext();
				var ContactURL = Member.ContactURL;
				var UserRole = Helper_GetRoleForUser(Roles, TemplateRoleEnum, ContactURL);
				if (UserRole.Name == STR_COMMON_ACCESS_CONTROL_TELESPACE_MANAGER_ROLE_NAME)
					ManagerCount++;
				
				if (ManagerCount > 1)
					break;
			}
			Transaction.Commit();

			if (ManagerCount > 1)
				return true;
			else
				return false;
		}
		catch(error)
		{
			Transaction.Abort();
			return true;
		}
	}

	function DisplayMgrWarning()
	{
		if (g_UIPropertyListIsValid)
		{
			var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			App.GrooveMessageBox(Window, g_Account, FORMS_TOOL_MGR_WARNING, FORMS_TOOL_MGR_WARNING_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Hand);	
		}
	}

	function LoadDesignerScript()
	{
		if (g_pDesigner == null)
		{
			var ExecutionContext = ScriptHostComponent.ScriptExecutionContexts.CreateExecutionContext("GrooveFormsDesignerCode");
			if (ExecutionContext.State == GrooveScriptExecutionContextState_New ||
				ExecutionContext.State == GrooveScriptExecutionContextState_Closed)
			{
				var Transaction = g_Telespace.OpenTransaction(false);
				try
				{
					
					ExecutionContext.AddCodeFromURL("http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.Tools.Business.GrooveForms.GrooveFormsDesignerGlue_GSL&Version=2&Factory=Open");
					ScriptHostComponent.ScriptExecutionContexts.StartExecutionContext("GrooveFormsDesignerCode");
					Transaction.Commit();
				}
				catch(error)
				{
					GrooveDebugFunctions.DisplayAssert(0, "");
					Transaction.Abort();
				}
					g_pDesigner = ScriptHostComponent.ScriptExecutionContexts.OpenExecutionContextCode("GrooveFormsDesignerCode");
					g_pDesigner.LoadComponentCache();
			}
		}
	}

	function UnloadDesignerScript()
	{
		var ExecutionContext = ScriptHostComponent.ScriptExecutionContexts.CreateExecutionContext("GrooveFormsDesignerCode");
		if (ExecutionContext.State != GrooveScriptExecutionContextState_Closed)
		{
			g_pDesigner.UnloadComponentCache();
			ScriptHostComponent.ScriptExecutionContexts.StopExecutionContext("GrooveFormsDesignerCode", GrooveScriptExecutionContextShutdownFlag_Remove);
			g_pDesigner = null;
		}
	}
	
	//**************************************************************************//
	//				End	General Forms Designer Functions						//
	//**************************************************************************//

	//**************************************************************************//
	//					Misc. Web Page Callout Functions						//
	//**************************************************************************//
	function GetTimeCheck()
	{
		return GrooveScriptFunctions.CreateNewObject("Groove.TimingCheck");
	}

	function GetAccount()
	{
		return g_Account;
	}

	function IsUIVisible()
	{
		return g_UIIsVisible;
	}

	function AreThereFormsOrViews()
	{
		if (ViewsFormsListView.Count > 2)
			return true;
		else 
			return false;
	}

	function GetDatabaseCount()
	{
		var DbCount = g_pIFormsToolDataModel.OpenDatabaseCount();
		return DbCount;
	}
	
	function SetCurrentWebView(i_View)
	{
		try
		{
			// Rebuild the views menu if a different view was selected.
			var CurrentView = SafeOpenProperty(PropertyList, "GrooveForms_CurrentWebView", "");

			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName == null)
				return;

			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			if (pDatabase == null)
				return;

			if (i_View !="" && pDatabase.DoesDatabaseObjectExistByFullName(i_View + ".vtml"))
			{
				var pView = pDatabase.OpenDatabaseObjectByFullName(i_View + ".vtml");
				var DbObjID = pView.DatabaseObjectID;
			}
			else
			{
				PropertyList.SetProperty("GrooveForms_CurrentWebView", "", GroovePropertyFlag_Private);
				return;
			}

			if (i_View != CurrentView)
			{
				g_ViewMenuBuilt = false;
				g_UpdateMenuFlag = true;
			}

			if (g_Document != null)
			{
				RemoveHTMLDocument(g_Document);
			}

			UseView(DbObjID);
			
			PropertyList.SetProperty("GrooveForms_CurrentWebView", i_View, GroovePropertyFlag_Private);
		}
		catch (error)
		{
			DisplayError(error);
		}
	}

	function GetCurrentWebView()
	{
		try
		{
			var DefaultView = SafeOpenProperty(PropertyList, "GrooveForms_DefaultView", "");

			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName != null)
			{
				var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
				var DefaultViewName = "";
				if (DefaultView != ""  && pDatabase.DoesDatabaseObjectExistByID(DefaultView)) 
					DefaultViewName = pDatabase.OpenDatabaseObjectByID(DefaultView).DisplayName;
			}
			else
				DefaultViewName = "";

			return SafeOpenProperty(PropertyList, "GrooveForms_CurrentWebView", DefaultViewName);
		}
		catch(error)
		{

		}
	}

	function GetURLForViewByName(i_ViewName)
	{
		var DatabaseName = null;
		try
		{
			DatabaseName = GetCurrentDatabaseName();
		}
		catch(error)
		{
		}

		if (DatabaseName != null)
		{
			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			if (pDatabase.DoesDatabaseObjectExistByFullName(i_ViewName + ".vtml"))
			{
				var pDbObj = pDatabase.OpenDatabaseObjectByFullName(i_ViewName + ".vtml");
				var URL = pDbObj.BindableURL;
				return URL;
			}
		}
		return "";
	}

	function SetViewFrameSize(i_FrameSize)
	{
		PropertyList.SetProperty("GrooveForms_CurrentFrameSize", i_FrameSize, GroovePropertyFlag_Private);
	}

	function GetViewFrameSize()
	{
		return SafeOpenProperty(PropertyList, "GrooveForms_CurrentFrameSize", "75%,*");
	}

	function GetCurrentDefaultForm()
	{
		return SafeOpenProperty(PropertyList, "GrooveForms_DefaultForm", "");	
	}

	function GetIsSafeForUI()
	{
		try
		{
			var pIFormsToolDataModelPrivate = g_pIFormsToolDataModelPrivate;
			return pIFormsToolDataModelPrivate.IsSafeForUI;
		}
		catch (error)
		{
			return false;
		}
	}

	function UseView(i_ViewName)
	{
		// With this call we should be calling on the g_CurrentTool since we know it
		// should be available.  This is unlike the other calls which need to be called
		// when in design mode.
		try
		{
			if (g_ToolAvailable)
			{
				if (typeof g_CurrentTool == "undefined" || g_CurrentTool == null)
				{
					var DatabaseName = null;
					try
					{
						DatabaseName = GetCurrentDatabaseName();
					}
					catch(error)
					{
					}

					if (DatabaseName == null)
					{
						return null;
					}

					var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
					if (Tool == null)
						return null;

					SinkTool(Tool);
				}			
			
				if (typeof g_pForm == "undefined" || g_pForm == null)
					g_pForm = g_CurrentTool.UITool.CreateForm();
				
				if (g_pForm.DoesDelegateComponentExist())
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
				else
					ThrowError("Form does not have delegate component.");

				try
				{
					var Transaction = g_Telespace.OpenTransaction(false);
					UIToolDelegate.IGrooveFormsDatabaseUITool.UseView(i_ViewName);
					Transaction.Commit();
				}
				catch (error)
				{
					Transaction.Abort();
				}

				UIToolDelegate = null;
				delete UIToolDelegate;
			}
		}
		catch(error)
		{
			DisplayError(error);
		}
	}

	function GetFormOrViewNameURLEnum(i_DatabaseName, i_Type)
	{
		try
		{
			if (g_ToolAvailable == false)
				return null;

			if (g_pIFormsToolDataModelPrivate.IsSafeForUI)
			{
				var ToolName = GetToolNameForDatabase(i_DatabaseName);
				if (g_CurrentTool == null || (g_CurrentTool.Name != ToolName)) 
				{
					var Tool = LoadTool(i_DatabaseName, g_Telespace, g_pIFormsToolDataModel);
					if (Tool != null)
						SinkTool(Tool);
					else
						return null;
				}

				var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, i_DatabaseName);

				if (!g_CurrentToolInited)
					InitToolDelegate(pDatabase);

				if (!g_CurrentToolInited)
					return null;

				var FormNameURLEnum = pDatabase.CreateNameURLEnum(i_Type);

				return FormNameURLEnum;
			}
			else
				LoadHomePage();
		}
		catch (error)
		{
			DisplayError(error);
		}
	}

	function GetFormNameURLEnum(i_DatabaseName)
	{
		return GetFormOrViewNameURLEnum(i_DatabaseName, GrooveFormsDatabaseObjectType_Form);
	}

	function GetFormNameIDEnum()
	{
		var DatabaseName = null;
		try
		{
			DatabaseName = GetCurrentDatabaseName();
		}
		catch(error)
		{
		}

		if (DatabaseName != null)
		{
			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			var FormNameIDEnum = pDatabase.CreateNameIDEnum(GrooveFormsDatabaseObjectType_Form);
			return FormNameIDEnum;
		}
		else
			return null;
	}

	function GetViewNameIDEnum()
	{
		var DatabaseName = null;
		try
		{
			DatabaseName = GetCurrentDatabaseName();
		}
		catch(error)
		{
		}

		if (DatabaseName == null)
			ThrowError("Error getting database name.");

		if (DatabaseName != null)
		{
			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);			
			var ViewNameIDEnum = pDatabase.CreateNameIDEnum(GrooveFormsDatabaseObjectType_View);
			return ViewNameIDEnum;
		}
		else
			return null;
	}

	function GetFormNameIDEnumFromSandbox()
	{
		try
		{
			LoadDesignerScript();
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			return pSandbox.CreateNameIDEnum(GrooveFormsDatabaseObjectType_Form);
		}
		catch (error)
		{
			return null;
		}
	}

	function GetViewNameIDEnumFromSandbox()
	{
		try
		{
			LoadDesignerScript();
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			return pSandbox.CreateNameIDEnum(GrooveFormsDatabaseObjectType_View);
		}
		catch (error)
		{
			return null;
		}
	}

	function GetViewNameURLEnum(i_DatabaseName)
	{
		return GetFormOrViewNameURLEnum(i_DatabaseName, GrooveFormsDatabaseObjectType_View);
	}

	function SetCurrentDocument(i_Document)
	{
		g_Document = i_Document;
	}

	function SetCurrentPreviewDocument(i_Document)
	{
		g_PreviewDocument = i_Document;
	}

    function SetApplication(i_Application)
    {
        g_Application = i_Application;
    }

    function GetApplication(i_Application)
    {
        return g_Application;
    }

	function SetButtonsHTML(i_Default, i_Search)
	{
		g_DefaultButtons = i_Default;
		g_SearchButtons = i_Search;
	}

	function SetOnFormPage(i_OnFormPage)
	{
		g_OnFormPage = i_OnFormPage;
	}

	function DisplayViewNavButtons()
	{
		if (g_Document != null && g_DefaultButtons != "" && g_SearchButtons != "")
		{
			var objDivViewNavBase = g_Document.getElementById("divViewNavBase");
			if (typeof objDivViewNavBase != "undefined" && objDivViewNavBase != null)
			{
				if (g_IsSearchActive)
				{
					objDivViewNavBase.innerHTML = g_SearchButtons;

					if (typeof g_Document.parentWindow != "undefined")
					{
						if (typeof g_Document.parentWindow.goSearchComplete != "undefined")
							g_Document.parentWindow.goSearchComplete();
					}
				}
				else
				{
					objDivViewNavBase.innerHTML = g_DefaultButtons;

					if (typeof g_Document.parentWindow != "undefined")
					{
						if (typeof g_Document.parentWindow.displayViewCount != "undefined")
							g_Document.parentWindow.displayViewCount();
					}
				}
			}
		}
	}

	function ClearPermissionCaches()
	{
		var ItemNameEnum = g_UIRunTimeData.CreateItemNameEnum();
		while (ItemNameEnum.HasMore())
		{
			var ItemName = ItemNameEnum.OpenNext();
			if (ItemName == "CanCreate" || ItemName.indexOf("CanEdit_") >= 0 || ItemName.indexOf("CanDelete_") >= 0)
				g_UIRunTimeData.RemoveItem(ItemName);
		}
	}

	function EnableEditDeleteButtons()
	{
		if (FocusOnView())
		{
			DisplayViewNavButtons();
			if (typeof g_CurrentRecordID != "undefined" &&
				typeof g_Document != "undefined" &&
				typeof g_Document.parentWindow != "undefined" &&
				typeof g_Document.parentWindow.canEditOrDelete != "undefined")
			{
				g_Document.parentWindow.canEditOrDelete(null);
			}
		}
	}

	function ReloadPreviewPane(i_RecordID)
	{
		if (FocusOnView())
		{
			if (typeof g_Document != "undefined" &&
				typeof g_Document.parentWindow != "undefined" &&
				typeof g_Document.parentWindow.goPreview != "undefined")
			{
				g_Document.parentWindow.goPreview(i_RecordID);
			}
		}
	}

	function DisplayPreviewForRecordID(i_RecordID)
	{
		try
		{
			if (g_PreviewDocument != null && typeof g_PreviewDocument.body != "undefined" && typeof g_PreviewDocument.parentWindow != "undefined")
			{
				if (typeof g_PreviewDocument.parentWindow.removeDocument != "undefined")
					g_PreviewDocument.parentWindow.removeDocument();

				if (typeof g_PreviewDocument.parentWindow.initFormPage != "undefined")
					g_PreviewDocument.parentWindow.initFormPage(i_RecordID);

				if (typeof g_PreviewDocument.parentWindow.addDocument != "undefined")
					g_PreviewDocument.parentWindow.addDocument();

				return 1;
			}
			else
			{
				return -1;
			}
		}
		catch (error)
		{
			return error.number;
		}
	}

	function GetDataList()
	{
		if (g_Document != null)
		{
			var arrObject = g_Document.getElementsByTagName("OBJECT");
			var i = 0;
			while(i < arrObject.length)
			{
				if (arrObject[i].getAttribute("DataType") == "DataList")
					return arrObject[i];
				
				i++;
			}
		}
		else
			return null;
	}	

	function GetDataListCollectionCount()
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			if (typeof g_pForm == "undefined" || g_pForm == null)
				g_pForm = g_CurrentTool.UITool.CreateForm();
			
			if (g_pForm.DoesDelegateComponentExist())
				var UIToolDelegate = g_pForm.OpenDelegateComponent();
			else
				ThrowError("Form does not have delegate component.");

			var CollectionCount = 0;
			if (UIToolDelegate.Component.OpenName() =="UIDelegate")
			{
				CollectionCount = UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.GetDataListCollectionCount();
			}
			else
				GrooveDebugFunctions.DisplayAssert(0, "PLEASE NOTE THIS ERROR (GetDataListCollectionCount) - You've received this error, but you can run through it. Please report that you've received this error.");
			UIToolDelegate = null;
			delete UIToolDelegate;
			Transaction.Commit();
			return CollectionCount;
		}
		catch(error)
		{
			DisplayError(error);
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}
			Transaction.Abort();
			return null;
		}
	}

	function GetToolCollectionCount()
	{
		try
		{
			if (!g_UIRunTimeData.HasItem("g_ToolCollectionCount"))
			{
				var DatabaseName = null;
				try
				{
					DatabaseName = GetCurrentDatabaseName();
				}
				catch(error)
				{
				}

				if (DatabaseName != null)
				{
					var Database = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
					var DatabaseTool = Database.Tool;
					if (DatabaseTool.DoesDelegateComponentExist())
					{
						var Delegate = DatabaseTool.OpenDelegateComponent();

						var CollectionCount = null;
						if (typeof Delegate == "object")
							CollectionCount = Delegate.IGrooveFormsDatabaseToolPrivate.GetToolCollectionCount();

						g_UIRunTimeData.SetItem("g_ToolCollectionCount", CollectionCount);
					}
				}
				else
					return null;
			}
			return g_UIRunTimeData.GetItem("g_ToolCollectionCount");
		}
		catch (error)
		{
			return null;
		}
	}

	function WebBrowserViewNavigate(i_URL)
	{
		try
		{
			if (WebBrowserView.window)
			{
				WebBrowserView.window.location.href = i_URL;
				return true;
			}
			else
			{
				return false;
			}
		}
		catch (error)
		{
			return false;
		}
	}

	function WebBrowserViewNavigatePreview(i_URL)
	{
		try
		{
			
			if (g_PreviewDocument != null && typeof g_PreviewDocument.parentWindow != "undefined")
			{
				g_PreviewDocument.parentWindow.location.href = i_URL;
				return true;
			}
			else
			{
				return false;
			}
		}
		catch (error)
		{
			return false;
		}
	}

	function ActiveXMessageBox()
	{
		OKMessageBox("ActiveX options required for the Forms tool are currently disabled. To resolve this problem, open Internet Explorer, select Tools - Internet Options, click Security, click Custom Level, and enable \"Run ActiveX controls and plug-ins\" and \"Script ActiveX controls marked safe for scripting\". Then return to the Forms tool and select any view to refresh the window.", "ActiveX not enabled");
	}

	function OKMessageBox(i_Message, i_Title)
	{
		if (g_UIPropertyListIsValid && g_UIIsVisible)
		{
			var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			App.GrooveMessageBox(Window, g_Account, i_Message, i_Title, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
		}
	}

	function YesNoMessageBox(i_Message, i_Title)
	{
		if (g_UIPropertyListIsValid)
		{
			var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			var Result = App.GrooveMessageBox(Window, g_Account, i_Message, i_Title, GrooveMessageBoxStyle_YesNo, GrooveMessageBoxIcon_Information);
			if (Result == GrooveMessageBoxResultCode_Yes)
				return true;
			else
				return false;
		}
	}

	function GrooveNavigate(i_URL)
	{
		if (g_UIPropertyListIsValid && g_UIIsVisible)
		{
			try
			{
				var pSyntax = GrooveScriptFunctions.CreateNewObject( "Groove.TelespaceURLSyntax" )
				if( pSyntax.IsValidURL( i_URL ) && i_URL.indexOf( "grooveIdentity" )==-1 )
				{
					// URL should be bindable but is canonical... #HPYE5U2K2R
					var sIdentityURL = PropertyList.OpenProperty( PROPERTY_CURRENT_IDENTITY_URL );
					i_URL = pSyntax.CreateBindableURL( i_URL, sIdentityURL );
				}
				var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
				var AccountGUID = PropertyList.OpenProperty(PROPERTY_ACCOUNT_GUID);
				App.LaunchOrNavigateToURL(i_URL, Window, AccountGUID, false);
			}
			catch (error)
			{
				DisplayError(error);
			}
		}
	}

	function SetCurrentURL(i_RecordID)
	{
		if (g_UIPropertyListIsValid)
		{
			var BindableURL = PropertyList.OpenProperty(PROPERTY_TOOL_URL);
			var pURI = GROOVE_GLOBAL_MISC_POINTER.OpenURI(BindableURL);
			pURI.SetQueryPart("RecordID", i_RecordID);
			var Tool = PropertyList.OpenProperty(PROPERTY_TOOL);
			var Name = Tool.DisplayName;
			var pIURLNavigator = UIPropertyList.OpenPropertyAsIUnknown(UIPROPERTY_URLNAVIGATOR);
	
			pIURLNavigator.SetCurrentURL(pURI.String, g_Telespace.DisplayName + " - " + Name, Name, false);
		}
	}

	//**************************************************************************//
	//				End	Misc. Web Page Callout Functions						//
	//**************************************************************************//

	//**************************************************************************//
	//					Search Functions										//
	//**************************************************************************//

	function GetSearchActive()
	{
		return g_IsSearchActive;
	}

	function SearchData(i_FieldValuePairArray, i_BoolType)
	{
		g_pWindowsManager.ShowWaitCursor();
		try
		{
			if (g_IsPreview)
				return;

			var FieldValueEnum = CreateStringStringEnum(false);
			var i = 0;
			while(i < i_FieldValuePairArray.length)
			{
				var FieldObject = i_FieldValuePairArray[i];
				FieldValueEnum.Add(FieldObject.name, FieldObject.value);
				i++;
			}

			if (typeof g_pForm == "undefined" || g_pForm == null)
				g_pForm = g_CurrentTool.UITool.CreateForm();
			
			if (g_pForm.DoesDelegateComponentExist())
				var UIToolDelegate = g_pForm.OpenDelegateComponent();
			else
				ThrowError("Form does not have delegate component.");

			UIToolDelegate.IGrooveFormsDatabaseUITool.Search(FieldValueEnum.StringStringEnum, i_BoolType);
			UIToolDelegate = null;
			delete UIToolDelegate;
		}
		catch(error)
		{
			DisplayError(error);
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}
			return null;
		}
		finally
		{
			g_pWindowsManager.ShowWaitCursor(false);
		}
	}

	function ClearSearchResults()
	{
		g_pWindowsManager.ShowWaitCursor();
		try
		{
			if (g_IsPreview)
				return;

			if (typeof g_pForm == "undefined" || g_pForm == null)
				g_pForm = g_CurrentTool.UITool.CreateForm();
			
			if (g_pForm.DoesDelegateComponentExist())
				var UIToolDelegate = g_pForm.OpenDelegateComponent();
			else
				ThrowError("Form does not have delegate component.");

			UIToolDelegate.IGrooveFormsDatabaseUITool.ClearSearchResults();
			UIToolDelegate = null;
			delete UIToolDelegate;
			// Set the search active flag to false and display the default buttons.
			g_IsSearchActive = false;
			DisplayViewNavButtons();
		}
		catch(error)
		{
			DisplayError(error);
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}
			return null;
		}
		finally
		{
			g_pWindowsManager.ShowWaitCursor(false);
		}
	}
	//**************************************************************************//
	//				End	Search Functions										//
	//**************************************************************************//

	//**************************************************************************//
	//					Record Functions										//
	//**************************************************************************//
	function CreateNewRecord()
	{
		var Transaction = g_Telespace.OpenTransaction(false);	
		try
		{
			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName == null)
				ThrowError("Error getting database name.");

			var RecordType = GetRecordTypeForDatabaseName(DatabaseName);
			var ToolDelegate = LoadCurrentToolDelegateNoThrow(DatabaseName, OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName), g_Telespace, g_pIFormsToolDataModel);
			var Record = null;
			if (typeof ToolDelegate == "object")
				Record = ToolDelegate.CreateRecord(RecordType);

			Transaction.Commit();
			return Record;
		}
		catch (error)
		{
			Transaction.Abort();
			return null;
			//DisplayError(error);
		}
	}

	function SubmitData(i_FieldValuePairArray, i_FormNameString, i_FieldElementArray)
	{
		// RMJ - code looks like ModifyRecord
		try
		{
			if (g_IsPreview)
				return;

			var FieldValueEnum = CreateStringStringEnum(false);
			var i = 0;
			while(i < i_FieldValuePairArray.length)
			{
				var FieldObject = i_FieldValuePairArray[i];
				FieldValueEnum.Add(FieldObject.name, FieldObject.value);
				i++;
			}
			
			// We want to only store the ID, not the URL
			var FormID = RightBack(i_FormNameString, "_ComponentData/");
			FieldValueEnum.Add("grooveFormName", FormID);

			var FieldElementEnum = CreateUnknownEnumFromStringIIDs("{EF326EF3-8B82-11D1-AC82-0080C7C135C6}", "{1ECBB27A-70C8-11D1-933C-0080C7DE32C6}");
			var i = 0;
			while(i < i_FieldElementArray.length)
			{
				var WrapperElement = GetWrapperElement();
				WrapperElement.SetAttribute("FieldName", i_FieldElementArray[i].name);
				WrapperElement.AppendContentElement(i_FieldElementArray[i].element);
				FieldElementEnum.Add(WrapperElement);
				i++;
			}

			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName != null)
			{
				var RecordType = GetRecordTypeForDatabaseName(DatabaseName);
				var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
				var DatabaseTool = pDatabase.Tool;
				if (DatabaseTool.DoesDelegateComponentExist())
				{
					var Delegate = DatabaseTool.OpenDelegateComponent();

					if (typeof Delegate == "object")
						Delegate.IGrooveFormsDatabaseToolPrivate.SubmitData(FieldValueEnum.StringStringEnum, RecordType, FieldElementEnum.UnknownEnum);
				}
			}
		}
		catch(error)
		{
			DisplayError(error);
			return null;
		}
	}

	function AddRecord(i_FieldValuePairArray, i_FormNameString, i_Record, i_FieldElementArray, i_AttachmentsFieldName, i_AttachmentsElement)
	{
		var Transaction = g_Telespace.OpenTransaction(false);		
		try
		{
			var FieldValueEnum = CreateStringStringEnum(false);
			var i = 0;
			while (i < i_FieldValuePairArray.length)
			{
				var FieldObject = i_FieldValuePairArray[i];
				// Must use String() here because doubles are converted to locale specific
				// strings for some reason. I need them to be stored as normal numbers.
				FieldValueEnum.Add(FieldObject.name, String(FieldObject.value));
				i++;
			}

			// We want to only store the ID, not the URL
			var FormID = RightBack(i_FormNameString, "_ComponentData/");
			FieldValueEnum.Add("grooveFormName", FormID);

			var FieldElementEnum = CreateUnknownEnumFromStringIIDs("{EF326EF3-8B82-11D1-AC82-0080C7C135C6}", "{1ECBB27A-70C8-11D1-933C-0080C7DE32C6}");
			var i = 0;
			while (i < i_FieldElementArray.length)
			{
				var WrapperElement = GetWrapperElement();
				WrapperElement.SetAttribute("FieldName", i_FieldElementArray[i].name);
				WrapperElement.AppendContentElement(i_FieldElementArray[i].element);
				WrapperElement.SetAttribute("ContentElementName", i_FieldElementArray[i].element.OpenName());
				FieldElementEnum.Add(WrapperElement);
				i++;
			}

			if (i_AttachmentsFieldName !="" && i_AttachmentsElement != null)
			{
				var WrapperElement = GetWrapperElement();
				WrapperElement.SetAttribute("FieldName", i_AttachmentsFieldName);
				WrapperElement.AppendContentElement(i_AttachmentsElement);
				WrapperElement.SetAttribute("ContentElementName", i_AttachmentsElement.OpenName());
				FieldElementEnum.Add(WrapperElement);
			}

			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName == null)
				ThrowError("Error getting database name.");

			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			var DatabaseTool = pDatabase.Tool;
			if (DatabaseTool.DoesDelegateComponentExist())
			{
				var Delegate = DatabaseTool.OpenDelegateComponent();

				if (typeof Delegate == "object")
					Delegate.IGrooveFormsDatabaseToolPrivate.AddRecord(FieldValueEnum.StringStringEnum, i_Record, FieldElementEnum.UnknownEnum);
			}
			Transaction.Commit();
		}
		catch(error)
		{
			Transaction.Abort();
			DisplayError(error);
			return null;
		}
	}

	function ModifyRecord(i_FieldValuePairArray, i_FormNameString, i_RecordID, i_FieldElementArray, i_AttachmentsFieldName, i_AttachmentsElement)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			var FieldValueEnum = CreateStringStringEnum(false);
			var i = 0;
			while (i < i_FieldValuePairArray.length)
			{
				var FieldObject = i_FieldValuePairArray[i];
				// Must use String() here because doubles are converted to locale specific
				// strings for some reason. I need them to be stored as normal numbers.
				FieldValueEnum.Add(FieldObject.name, String(FieldObject.value));
				i++;
			}
			
			// We want to only store the ID, not the URL
			var FormID = RightBack(i_FormNameString, "_ComponentData/");
			FieldValueEnum.Add("grooveFormName", FormID);

			var FieldElementEnum = CreateUnknownEnumFromStringIIDs("{EF326EF3-8B82-11D1-AC82-0080C7C135C6}", "{1ECBB27A-70C8-11D1-933C-0080C7DE32C6}");
			var i = 0;
			while (i < i_FieldElementArray.length)
			{
				var WrapperElement = GetWrapperElement();
				WrapperElement.SetAttribute("FieldName", i_FieldElementArray[i].name);
				WrapperElement.AppendContentElement(i_FieldElementArray[i].element);
				WrapperElement.SetAttribute("ContentElementName", i_FieldElementArray[i].element.OpenName());
				FieldElementEnum.Add(WrapperElement);
				i++;
			}

			if (i_AttachmentsFieldName !="" && i_AttachmentsElement != null)
			{
				var WrapperElement = GetWrapperElement();
				WrapperElement.SetAttribute("FieldName", i_AttachmentsFieldName);
				WrapperElement.AppendContentElement(i_AttachmentsElement);
				WrapperElement.SetAttribute("ContentElementName", i_AttachmentsElement.OpenName());
				FieldElementEnum.Add(WrapperElement);
			}

			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName == null)
				ThrowError("Error getting database name.");

			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			var DatabaseTool = pDatabase.Tool;
			if (DatabaseTool.DoesDelegateComponentExist())
			{
				var Delegate = DatabaseTool.OpenDelegateComponent();

				if (typeof Delegate == "object")
					Delegate.IGrooveFormsDatabaseToolPrivate.ModifyRecord(FieldValueEnum.StringStringEnum, i_RecordID, FieldElementEnum.UnknownEnum);
			}
			Transaction.Commit();
		}
		catch(error)
		{
			Transaction.Abort();
			DisplayError(error);
			return null;
		}
	}

	function DeleteRecord(i_RecordID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName == null)
				ThrowError("Error getting database name.");

			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			var FormsToolDataModelDelegate = GetToolDelegate(pDatabase.Tool);
			FormsToolDataModelDelegate.DeleteRecord(i_RecordID);
			// Reset global variable so it does not persist with no records in record set.
			g_CurrentRecordID = -1;
			Transaction.Commit();
		}
		catch(error)
		{
			Transaction.Abort();
			DisplayError(error);
			return null;
		}
	}

	function GetFormUrlByRecord(i_pRecord)
	{
		var Transaction = g_Telespace.OpenTransaction(false);		
		try
		{
			if (i_pRecord.HasField("grooveFormName"))
			{
				var CanonicalURL = i_pRecord.OpenField("grooveFormName");
				var BindableURL = "";
				if (VerifyFormExistsForURL(CanonicalURL))
				{
					if (CanonicalURL.indexOf("_ComponentData/") >= 0)
						BindableURL = GetBindableURL(CanonicalURL);
					else
						BindableURL = GetBindableURLFromDBObjectID(CanonicalURL);
				}
				else
					BindableURL = GetBindableURLFromDefaultForm();

				if (BindableURL == "")
				{
					BindableURL = GetBindableURLFromDefaultForm();
					if (BindableURL == "")
						ThrowError("Error getting URL for Form");
				}

				Transaction.Commit();
				return BindableURL;
			}
			else
			{
				var BindableURL = GetBindableURLFromDefaultForm();
				Transaction.Commit();
				return BindableURL;
			}
		}
		catch (error)
		{
			Transaction.Abort();
			//DisplayError(error);
			return "";
		}
	}

	function GetFormUrlByRecordID(i_RecordID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);		
		try
		{
			if (i_RecordID)
			{
				var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
				if (typeof ToolDelegate == "object")
				{
					var FormRecord = ToolDelegate.OpenRecordByID(i_RecordID);
					if (FormRecord)
					{
						if (FormRecord.HasField("grooveFormName"))
						{
							var CanonicalURL = FormRecord.OpenField("grooveFormName");
							var BindableURL = "";
							if (VerifyFormExistsForURL(CanonicalURL))
							{
								if (CanonicalURL.indexOf("_ComponentData/") >= 0)
									BindableURL = GetBindableURL(CanonicalURL);
								else
									BindableURL = GetBindableURLFromDBObjectID(CanonicalURL);
							}
							else
								BindableURL = GetBindableURLFromDefaultForm();

							if (BindableURL == "")
							{
								BindableURL = GetBindableURLFromDefaultForm();
								if (BindableURL == "")
									ThrowError("Error getting URL for Form");
							}

							Transaction.Commit();
							return BindableURL;
						}
						else
						{
							var BindableURL = GetBindableURLFromDefaultForm();
							Transaction.Commit();
							return BindableURL;
						}
					}
					else
					{
						Transaction.Commit();
						return "";
					}
				}
				else
				{
					Transaction.Commit();
					return "";
				}
			}
			else
			{
				Transaction.Commit();
				return "";
			}
		}
		catch (error)
		{
			Transaction.Abort();
			//DisplayError(error);
			return "";
		}
	}

	function GetNameValueEnumByRecordID(i_RecordID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);		
		try
		{
			var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
			if (typeof ToolDelegate != "object")
			{
				var EmptyEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum();
				Transaction.Commit();
				return EmptyEnum;
			}
			else
				var FormRecord = ToolDelegate.OpenRecordByID(i_RecordID);

			if (FormRecord)
			{
				Transaction.Commit();
				return FormRecord.OpenFieldNameValueEnum();
			}
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			return null;
		}
	}

	function GetRecordByRecordID(i_RecordID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);		
		try
		{
			if (i_RecordID == -1)
			{
				Transaction.Commit();
				return null;
			}

			var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
			if (typeof ToolDelegate != "object")
			{
				Transaction.Commit();
				return null;
			}
			else
				var FormRecord = ToolDelegate.OpenRecordByID(i_RecordID);

			if (FormRecord)
			{
				Transaction.Commit();
				return FormRecord;
			}
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			return null;
		}
	}

	function GetAuthorNameFromRecord(i_pRecord)
	{
		var Name = OpenRecordCreatorName(PropertyList, i_pRecord, false);
		return Name;
	}

	function SetSelectedRecordID(i_RecordID)
	{
		Timer.Stop();
		Timer.Start();
		g_CurrentRecordID = i_RecordID;
		try
		{
			if (g_CurrentTool || g_pForm)
			{
				if (typeof g_pForm == "undefined" || g_pForm == null)
					g_pForm = g_CurrentTool.UITool.CreateForm();
				
				if (g_pForm.DoesDelegateComponentExist())
				{
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
					
					UIToolDelegate.IGrooveFormsDatabaseUITool.CurrentSelectedRecord = i_RecordID;
					var RecordID = UIToolDelegate.IGrooveFormsDatabaseUITool.CurrentSelectedRecord;
					if (RecordID != -1)
						PropertyList.SetProperty("GrooveFormsLastSelectedRecord", RecordID, GroovePropertyFlag_Private);
				}
			}
		}
		catch(error)
		{
			DisplayError(error);
		}
	}

	function GetSelectedRecordID()
	{
		Timer.Stop();
		Timer.Start();
		try
		{
			if (g_BrowseToRecordID != null)
			{
				var RecordID = g_BrowseToRecordID;
				g_BrowseToRecordID = null;
				return RecordID;
			}
			else if (g_CurrentTool || g_pForm)
			{
				if (typeof g_pForm == "undefined" || g_pForm == null)
					g_pForm = g_CurrentTool.UITool.CreateForm();
				
				if (g_pForm.DoesDelegateComponentExist())
				{
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
					var RecordID = UIToolDelegate.IGrooveFormsDatabaseUITool.CurrentSelectedRecord;
					
					if (RecordID == -1 && PropertyList.PropertyExists("GrooveFormsLastSelectedRecord"))
						return PropertyList.OpenProperty("GrooveFormsLastSelectedRecord");
					else
						return RecordID;
				}
			}
			return null;
		}
		catch (error)
		{
			DisplayError(error);
			return null;
		}
	}

	//**************************************************************************//
	//				End	Record Functions										//
	//**************************************************************************//

	//**************************************************************************//
	//					Import Data/Export Data Functions						//
	//**************************************************************************//	

	function ExportData(i_ExportType)
	{
		var ShowingWaitCursor = false;
		// If the last used directory exists then use it, otherwise use the root.
		var strLastDirectory = SafeOpenProperty(PropertyList, "GrooveFormsLastUsedDirectory", "");
		// Set up the filter and extension depending on the export type.
		if (i_ExportType == GrooveFormsExportType_BinaryXML || i_ExportType == GrooveFormsExportType_XML)
		{
			var strFilter = g_FORMS_XML_FILTER;
			var strExtension = g_FORMS_XML_EXTENSION;
		}
		else if (i_ExportType == GrooveFormsExportType_TabularText)
		{
			var strFilter = g_FORMS_TABULAR_FILTER;
			var strExtension = g_FORMS_TABULAR_EXTENSION;
		}
		else if (i_ExportType == GrooveFormsExportType_StructuredText)
		{
			var strFilter = g_FORMS_STRUCTURED_FILTER;
			var strExtension = g_FORMS_STRUCTURED_EXTENSION;
		}

		// Open the save file dialog box to save the exported data.
		var FileResult = App.SaveFileDialog("Export Records to File...", strFilter , strLastDirectory, "GrooveFormsData" + strExtension, g_Account, 1, false);

		var Transaction = g_Telespace.OpenTransaction(false);		
		try
		{
			if (g_ToolAvailable)
			{
				if (typeof g_CurrentTool == "undefined" || g_CurrentTool == null)
				{
					var DatabaseName = null;
					try
					{
						DatabaseName = GetCurrentDatabaseName();
					}
					catch(error)
					{
					}

					if (DatabaseName == null)
					{
						Transaction.Abort();
						return null;
					}

					var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
					if (Tool == null)
					{
						Transaction.Abort();
						return null;
					}

					SinkTool(Tool);
				}
			}
					
			var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
			if (GrooveDialogBoxResultCode_OK == FileResult.Result)
			{
				g_pWindowsManager.ShowWaitCursor();
				ShowingWaitCursor = true;
				// Update the last used directory property.
				var strPath = LeftBack(FileResult.Data, "\\");
				PropertyList.SetProperty("GrooveFormsLastUsedDirectory", strPath, 0);
				// Add extension for export type if it isn't already there.
				if ((i_ExportType == GrooveFormsExportType_BinaryXML || i_ExportType == GrooveFormsExportType_XML) && FileResult.Data.lastIndexOf(g_FORMS_XML_EXTENSION) < 0)
					FileResult.Data += g_FORMS_XML_EXTENSION;
				else if (i_ExportType == GrooveFormsExportType_TabularText && FileResult.Data.lastIndexOf(g_FORMS_TABULAR_EXTENSION) < 0)
					FileResult.Data += g_FORMS_TABULAR_EXTENSION;
				else if (i_ExportType == GrooveFormsExportType_StructuredText && FileResult.Data.lastIndexOf(g_FORMS_STRUCTURED_EXTENSION) < 0)
					FileResult.Data += g_FORMS_STRUCTURED_EXTENSION;

				// Get the record id enum for the current data list.
				if (typeof g_pForm == "undefined" || g_pForm == null)
					g_pForm = g_CurrentTool.UITool.CreateForm();
				
				if (g_pForm.DoesDelegateComponentExist())
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
				else
					ThrowError("Form does not have delegate component.");

				if (UIToolDelegate.Component.OpenName() =="UIDelegate")
				{
					var DataListRecordIDEnum = g_pNullObject;
					DataListRecordIDEnum = UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.GetDataListRecordIDEnum();
				}

				UIToolDelegate = null;
				delete UIToolDelegate;

				// Get the column headers for the fields in the current data list.
				var ViewFields = "";
				var ViewNames = "";
				if (i_ExportType == GrooveFormsExportType_TabularText || i_ExportType == GrooveFormsExportType_StructuredText)
				{
					ViewFields = GetFieldNameOrLabelFromDataList("Name");
					ViewNames = GetFieldNameOrLabelFromDataList("Label");
				}

				var DataExported = ToolDelegate.ExportToFile(i_ExportType, FileResult.Data, ViewFields, ViewNames, DataListRecordIDEnum);
				g_pWindowsManager.ShowWaitCursor(false);
			}

			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			DisplayError(error);
			if (ShowingWaitCursor)
				g_pWindowsManager.ShowWaitCursor(false);
			return "";
		}
	}

	function ExportPrintData(i_PrintType, i_ViewFields, i_ViewNames, i_FormatValues, i_BreakString)
	{
		var Transaction = g_Telespace.OpenTransaction(false);		
		try
		{
			var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
			var DataExported = ToolDelegate.ExportToPrint(i_PrintType, i_ViewFields, i_ViewNames, i_FormatValues, i_BreakString);
			Transaction.Commit();
			return DataExported;
		}
		catch (error)
		{
			Transaction.Abort();
			DisplayError(error);
			return "";
		}
	}

	function GetFieldNameOrLabelFromDataList(i_Type)
	{
		// Get column headers from data list.
		var ReturnArray = new Array();
		var pDataListDisplay = GetDataList();
		var ColumnSet = pDataListDisplay.ColumnSets.Open(pDataListDisplay.CurrentColumnSet);
		var ColumnEnum = ColumnSet.Columns.CreateEnum();
		while (ColumnEnum.HasMore())
		{
			var Column = ColumnEnum.OpenNext();
			var ColumnName = Column.Name;
			// Do not include the author column if it is hidden.
			if (ColumnName == "_CreatedBy" && !Column.Visible)
				continue;
			// Do not include the unread mark and attachment columns in the export data.
			if (ColumnName != "_IsRead")
			{
				if (i_Type == "Name")
					ReturnArray[ReturnArray.length] = ColumnName;
				else if (i_Type == "Label")
				{
					if (ColumnName == "FileIcon")
						ReturnArray[ReturnArray.length] = "Attachments";
					else
						ReturnArray[ReturnArray.length] = Column.Label;
				}
			}
		}
		return ReturnArray.join(",");
	}

	function ImportData()
	{
		var Transaction = g_Telespace.OpenTransaction(false);		
		try
		{
			var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
			
				
				
			// If the last used directory exists then use it, otherwise use the root.
			var strLastDirectory = SafeOpenProperty(PropertyList, "GrooveFormsLastUsedDirectory", "");

			// Open the open file dialog and get the result.
			var FileResult = App.OpenFileDialog("Import File", g_FORMS_XML_FILTER, strLastDirectory, "", g_Account, 1, true);
			if (GrooveDialogBoxResultCode_OK == FileResult.Result)
			{
				var strFiles = FileResult.Data;
				var strFileName = RightBack(strFiles, "\\");
				var strExtension = RightBack(strFileName, ".").toLowerCase();
				var FileArray = strFiles.split("|");

				// Display an error if an invalid file type was selected.
				if (strExtension != "xml")
				{
					Transaction.Abort();
					OKMessageBox("The file you selected (\"" + strFileName + "\") is not a valid form data file. Please select a file with the extension \".xml\" to import form data.", "Invalid Form Data File");
					return;
				}

				FilePath = FileArray[0];
				if (FileArray.length == 1)
					var strPath = LeftBack(FilePath, "\\");
				else
					var strPath = FileArray[0];

				PropertyList.SetProperty("GrooveFormsLastUsedDirectory", strPath, 0);

				if (FileArray.length == 1)
					raw_ImportData(FileArray[0]);
				else
				{
					var i = 1;
					var iCount = FileArray.length;
					while (i < iCount)
					{
						if (FileArray[0].charAt(FileArray[0].length - 1) == "\\")
							raw_ImportData(FileArray[0] + FileArray[i]);
						else
							raw_ImportData(FileArray[0] + "\\" + FileArray[i]);
						i++;
					}
				}
			}
				
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			DisplayError(error);
		}
	}

	function raw_ImportData(i_Path)
	{
		try
		{
			g_pWindowsManager.ShowWaitCursor();
			var ToolDelegate = GetToolDelegate(g_CurrentTool);
			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			if (DatabaseName == null)
			{
				DisplayError(new Error("Error getting database name."));
				return;
			}
			var DataImported = ToolDelegate.ImportFromFile(i_Path, g_ToolName, DatabaseName);
		}
		catch (error)
		{
			OKMessageBox("The file you selected for importing, " + i_Path + ", does not contain valid Groove Forms XML. You can only import XML files that were created by exporting from a Groove Forms or Groove Discussion tool.", "Invalid Data File");
		}
		finally
		{
			g_pWindowsManager.ShowWaitCursor(false);
		}
	}

	//**************************************************************************//
	//				End	Import Data/Export Data Functions						//
	//**************************************************************************//		

	//**************************************************************************//
	//						Timer Callbacks										//
	//**************************************************************************//	

	function Timer_OnTimer(i_TimerName)
	{
		Timer.Stop();
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			if (g_CurrentRecordID)
			{
				if (g_CurrentRecordID != -1)
				{	
					var CurrentRecord = GetRecordByRecordID(g_CurrentRecordID);
					if (typeof CurrentRecord != "undefined")
					{
						if (CurrentRecord.OpenField("_IsRead") == false)
						{
							var ToolDelegate = LoadCurrentToolDelegateNoThrow(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
							if (null != ToolDelegate)
							{
								ToolDelegate.MarkRecordRead(g_CurrentRecordID , true);
							}
						}
					}
				}
			}

			Transaction.Commit();
		}
		catch(error)
		{
			Transaction.Abort();
		}
	}

	function AdviseEndTimer_OnTimer(i_TimerName)
	{
		AdviseEndTimer.Stop();
		var b = g_pDesigner.PromptForView();
		if (!b)
		{
			g_SaveInProgress = false;
			g_SaveSuccess = false;
			return;
		}
		//else if (g_ReturnToMgr)
		//{
			ShowPublishNotification();
			OpenDesigner("M");
		//}
		//else
		//{
		//	ShowPublishNotification();
		//	OpenDesigner("H");
		//}
	}

	//**************************************************************************//
	//					End	Timer Callbacks										//
	//**************************************************************************//	

	//**************************************************************************//
	//					Locking functions										//
	//**************************************************************************//

	function LockDb()
	{
		try
		{
			var DeviceURL = GrooveScriptFunctions.CreateNewObject("Groove.SystemServices").TransportServices.OpenLocalDeviceURL();

			var DBName = null;
			try
			{
				DBName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}

			var DBPropertyName = DBName + "_Lock";
			var DBPropertyValue = SafeOpenProperty(PropertyList, DBPropertyName, "");
			var CurrentSessionID = g_pIFormsToolDataModelPrivate.DesignerSessionID;
			if (DBPropertyValue !="" && DBPropertyValue != DeviceURL)
			{
				OKMessageBox("The database you selected is currently being edited by someone else. Please try again later.", "Forms Tool Design In Use");
				return false;
			}
			else if (CurrentSessionID != "" && CurrentSessionID != g_SessionID)
			{
				OKMessageBox("The database you selected is currently being edited in another window. You can only have the designer opened in a single window at a time.", "Forms Tool Design In Use");
				return false;
			}
			
			PropertyList.SetProperty(DBPropertyName, DeviceURL);
			g_pIFormsToolDataModelPrivate.DesignerSessionID = g_SessionID;
			return true;
			
		}
		catch (error)
		{
			DisplayError(error);
			return false;
		}
	}

	function UnlockAllDBs()
	{
		var DBNameArray = GetDatabaseNames();
		var i = 0;
		while (i < DBNameArray.length)
		{
			UnlockDb(DBNameArray[i]);
			i++;
		}
		// We should also unlock for the null case
		UnlockDb(null);	
	}

	function UnlockDb(i_DatabaseName)
	{
		var DeviceURL = GrooveScriptFunctions.CreateNewObject("Groove.SystemServices").TransportServices.OpenLocalDeviceURL();
		var DBPropertyName = i_DatabaseName + "_Lock";
		var DBPropertyValue = SafeOpenProperty(PropertyList, DBPropertyName, "");
		if (DBPropertyValue == DeviceURL)
			PropertyList.SetProperty(DBPropertyName, "");
		if (g_pIFormsToolDataModelPrivate.DesignerSessionID == g_SessionID)
			g_pIFormsToolDataModelPrivate.DesignerSessionID = "";
	}

	//**************************************************************************//
	//				End	Locking functions										//
	//**************************************************************************//

	//**************************************************************************//
	//					  Database Functions									//
	//**************************************************************************//
	function FillDatabasesList()
	{
		try
		{
			DatabaseListView.ResetContent();
			var pSSEnum = g_pIFormsToolDataModel.CreateDatabaseNameAndIDEnum();
			while (pSSEnum.HasMore())
			{
				var SSPair = pSSEnum.OpenNextPair();
				var index = DatabaseListView.AddItem(SSPair.First);
				DatabaseListView.SetItemData(index, SSPair.Second);
			}
			
			if (DatabaseListView.Count > 0)
			{
				DatabaseListView.SetSelectionByIndex(0);
				var DatabaseName = DatabaseListView.GetSelectionText();
				var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
				GrooveDebugFunctions.DisplayAssert(pDatabase != null, "");
				if (pDatabase.IsToolInstalled())
				{
					if (GetIsSafeForUI() && g_ToolAvailable)
					{
						if (typeof g_CurrentTool == "undefined" || g_CurrentTool == null)
						{
							var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
							if (Tool != null)
								SinkTool(Tool);
							else
								return;

						}
					}
				}
			}
		}
		catch(error)
		{
			DisplayError(error);
		}
	}
	
	function OpenDatabaseByID(i_DatabaseID)
	{
		if (i_DatabaseID != -1)
		{
			var pDatabase = g_pIFormsToolDataModel.OpenDatabase(i_DatabaseID);
			return pDatabase;
		}
		else 
			return null;
	}
	
	function GetDatabaseNames()
	{
		try
		{
			var pDatabaseNamesEnum = g_pIFormsToolDataModel.CreateDatabaseNamesEnum();
			var DatabaseNameArray = new Array();
			var i=0;
			while (pDatabaseNamesEnum.HasMore())
			{			
				var itemName = pDatabaseNamesEnum.OpenNext();
				DatabaseNameArray[i] = itemName;
				i++;
			}

			return DatabaseNameArray;
		}
		catch (error)
		{
			return null;
		}

	}

	function GetCurrentDatabaseName()
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			//GrooveDebugFunctions.DisplayAssert(0, "");
			if (!g_UIRunTimeData.HasItem("g_CurrentDatabaseName") || g_UIRunTimeData.GetItem("g_CurrentDatabaseID") == -1)
			{
				if (PropertyList.PropertyExists("FormsCurrentDatabase"))
				{
					var Database = PropertyList.OpenPropertyAsIUnknown("FormsCurrentDatabase");
					if (typeof Database != "undefined" && Database != null)
					{
						var bExists = false;
						var DbName = Database.DatabaseName;
						try
						{
							bExists = g_pIFormsToolDataModel.DoesDatabaseExist(DbName);
						}
						catch(error)
						{
						}

						if (bExists)
							g_UIRunTimeData.SetItem("g_CurrentDatabaseName", DbName);
						else
						{
							var index = DatabaseListView.SelectionIndex;
							if (index != -1)
							{
								var DbID = DatabaseListView.GetItemData(index);
								if (g_pIFormsToolDataModel.DoesDatabaseExistByID(DbID))
								{
									var Database = g_pIFormsToolDataModel.OpenDatabase(DbID);
									SetCurrentDatabase(Database);
									g_UIRunTimeData.SetItem("g_CurrentDatabaseName", Database.DatabaseName);
								}
								else
								{
									Transaction.Commit();
									return null;
								}
							}	
						}
					}
				}
				else
				{
					var index = DatabaseListView.SelectionIndex;
					if (index != -1)
					{
						var DbID = DatabaseListView.GetItemData(index);
						if (g_pIFormsToolDataModel.DoesDatabaseExistByID(DbID))
						{
							var Database = g_pIFormsToolDataModel.OpenDatabase(DbID);
							SetCurrentDatabase(Database);
							g_UIRunTimeData.SetItem("g_CurrentDatabaseName", Database.DatabaseName);
						}
						else
						{
							Transaction.Commit();
							return null;
						}
					}
					else
					{
						Transaction.Commit();
						return null;
					}
				}
			}
			Transaction.Commit();
			return g_UIRunTimeData.GetItem("g_CurrentDatabaseName");
		}
		catch (error)
		{
			Transaction.Abort();
			DisplayError(error);
			return null;
		}
	}

	function GetCurrentDatabaseID()
	{
		if (!g_UIRunTimeData.HasItem("g_CurrentDatabaseID") || g_UIRunTimeData.GetItem("g_CurrentDatabaseID") == -1)
		{
			if (PropertyList.PropertyExists("FormsCurrentDatabase"))
			{
				var Database = PropertyList.OpenPropertyAsIUnknown("FormsCurrentDatabase");
				if (typeof Database != "undefined" && Database != null)
				{
					var DbName = Database.DatabaseName;
					if (g_pIFormsToolDataModel.DoesDatabaseExist(DbName))
						g_UIRunTimeData.SetItem("g_CurrentDatabaseID", Database.DatabaseID);
					else
					{
						var index = DatabaseListView.SelectionIndex;
						if (index != -1)
						{
							var DbID = DatabaseListView.GetItemData(index);
							if (g_pIFormsToolDataModel.DoesDatabaseExistByID(DbID))
							{
								var Database = g_pIFormsToolDataModel.OpenDatabase(DbID);
								SetCurrentDatabase(Database);
								g_UIRunTimeData.SetItem("g_CurrentDatabaseID", Database.DatabaseID);
							}
							else
								return -1;
						}
					}	
				}
			}
			else
			{
				var index = DatabaseListView.SelectionIndex;
				if (index != -1)
				{
					var DbID = DatabaseListView.GetItemData(index);
					if (g_pIFormsToolDataModel.DoesDatabaseExistByID(DbID))
					{
						var Database = g_pIFormsToolDataModel.OpenDatabase(DbID);
						SetCurrentDatabase(Database);
						g_UIRunTimeData.SetItem("g_CurrentDatabaseID", Database.DatabaseID);
					}
					else
						return -1;
				}
				else
					g_UIRunTimeData.SetItem("g_CurrentDatabaseID", index);
			}
		}
		return g_UIRunTimeData.GetItem("g_CurrentDatabaseID");
	}

	function SetCurrentDatabase(i_pDatabase)
	{
		if (g_pIFormsToolDataModel.DoesDatabaseExist(i_pDatabase.DatabaseName))
		{
			PropertyList.AddRuntimeProperty("FormsCurrentDatabase", i_pDatabase);
			if (i_pDatabase.IsToolInstalled())
			{
				var Tool = LoadTool(i_pDatabase.DatabaseName, g_Telespace, g_pIFormsToolDataModel);
				if (Tool != null)
					SinkTool(Tool);
			}
		}
	}

	function DbNameIDObject()
	{
		this.Name;
		this.ID;
	}

	function CompareDbObj(DbObjA, DbObjB)
	{
		if (DbObjA.Name.toLowerCase() > DbObjB.Name.toLowerCase())
			return 1;
		if (DbObjA.Name.toLowerCase() < DbObjB.Name.toLowerCase())
			return -1;
		return 0;
	}

	function DeleteMultipleDatabases()
	{
		try
		{
			var pSSEnum = g_pIFormsToolDataModel.CreateDatabaseNameAndIDEnum();
			var DbObjArray = new Array();
			while (pSSEnum.HasMore())
			{
				var SSPair = pSSEnum.OpenNextPair();
				var DbNameIDObj = new DbNameIDObject;
				DbNameIDObj.Name = SSPair.First;
				DbNameIDObj.ID = SSPair.Second;
				DbObjArray[DbObjArray.length] = DbNameIDObj;
			}

			DbObjArray.sort(CompareDbObj);
			
			var Delta = g_pDynMgr.OpenDelta("", false);
			Delta.AdvancedDelta2.LocalOnly = true;
			Delta.Begin();
			g_ToolAvailable = false;
			FlushUITool();
			var i = 1;
			var iCount = DbObjArray.length;
			while (i < iCount)
			{
				var DbID = DbObjArray[i].ID;
				if (g_pIFormsToolDataModel.DoesDatabaseExist(DbObjArray[i].Name))
					g_pIFormsToolDataModel.DeleteDatabase(DbID);
				i++;
			}
			g_pDynMgr.DoDelta(Delta);

			FillDatabasesList();
		}
		catch (error)
		{
			if(Delta)
				Delta.Abort();
		}
	}

	//**************************************************************************//
	//					  End Database Functions								//
	//**************************************************************************//

	//**************************************************************************//
	//					   WebPage Functions									//
	//**************************************************************************//	
	function LoadHomePage()
	{
		g_CurrentState = "HomePage";
		return;
		try
		{
			if (g_pIFormsToolConfigurationSettings.AllowDesigner && !g_Trust)
			{
				if (g_PromptedForTrust && !g_Trust)
					return;
				
				if (!YesNoMessageBox("This version of the Forms tool may contain scripts which could be harmful to your computer. To use this tool you should trust other members of this space.  Do you want to continue?", "Warning..."))
				{
					
					WebBrowserView.Navigate(BuildPathFromBase("file:///", "FormsDoNotTrust.html"));
					HideUICommands();
					g_PromptedForTrust = true;
					return;
				}
				else
					g_Trust = true;	
			}
			
			var WelcomePathURL;

			//WebBrowserView.IgnoreNavigateTogether = true;
			if (g_UIPropertyListIsValid)
			{
				var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
				Window.WindowProperties.LockUpdate = true;
			}
			if (typeof g_pIFormsToolConfigurationSettings.FormsWelcomePageURL == "undefined" || 
				g_pIFormsToolConfigurationSettings.FormsWelcomePageURL == "")
			{
				WelcomePathURL = BuildPathFromBase("file:///", "FormsHomePage.html");
				g_pIFormsToolConfigurationSettings.FormsWelcomePageURL = WelcomePathURL;
			}
			else
				WelcomePathURL = g_pIFormsToolConfigurationSettings.FormsWelcomePageURL;

			if ((g_MSIEVersion.MajorVersion < 5) || (g_MSIEVersion.MajorVersion == 5 && g_MSIEVersion.MinorVersion == 0))
				WebBrowserView.Navigate(BuildPathFromBase("file:///", "FormsBrowserUpgrade.html"));
			else
			{
				if (g_MSIEVersion.MajorVersion > 5 || (g_MSIEVersion.MajorVersion == 5 && g_MSIEVersion.MinorVersion >=50))
				{
					WebBrowserView.Navigate(WelcomePathURL);
				}
				else if (g_MSIEVersion.MajorVersion == 5 && g_MSIEVersion.MinorVersion == 0 && g_MSIEVersion.BuildVersion >= 2919)
					WebBrowserView.Navigate(WelcomePathURL);
			}
			g_CurrentState = "HomePage";
			SetHelpInfo("HomePage", RTFHelpProvider);
			FormHomePageLayout.SetFocus("WebBrowserView");
		}
		catch(error)
		{
		}
		finally
		{
			if (Window)
				Window.WindowProperties.LockUpdate = false;
		}
	}

	function ReloadViewLocation()
	{
		if ((g_MSIEVersion.MajorVersion < 5) || (g_MSIEVersion.MajorVersion == 5 && g_MSIEVersion.MinorVersion == 0))
			WebBrowserView.Navigate(BuildPathFromBase("file:///", "FormsBrowserUpgrade.html"));
		else if (WebBrowserView.window != null && g_CurrentState == "HomePage")
		{
			// This check is made to see if we're looking at a view.
			if (WebBrowserView.TopLevelURL.indexOf("FormsViewFrame.html") >= 0)
			{
				LoadHomePage();
				var CurrentView = GetCurrentWebView();
				var DbName = GetCurrentDatabaseName();
				if (DbName == null)
					return;
				var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DbName);
				if (pDatabase!= null && pDatabase.DoesDatabaseObjectExistByFullName(CurrentView + ".vtml"))
				{
					var pView = pDatabase.OpenDatabaseObjectByFullName(CurrentView + ".vtml");
					var DbObjID = pView.DatabaseObjectID;
				}
				else
					SetCurrentWebView("");
			}
			else
			{
				try
				{
					// This means we're looking at a form and we need to disable the save button.
					if (typeof WebBrowserView.window.designChanged != "undefined")
						WebBrowserView.window.designChanged();
					else
						WebBrowserView.window.location.reload(true);
				}
				catch(error)
				{
					GrooveDebugFunctions.OutputString("\nError reloading view location: " + error.description + "\n\n");
				}
			}
		}
	}

	//**************************************************************************//
	//					End WebPage Functions									//
	//**************************************************************************//	

	//**************************************************************************//
	//					 MetaData Functions										//
	//**************************************************************************//	

	function LoadMetaData()
	{
		try
		{
			if (g_MetaDataLoaded)
				return true;
			
			var FieldPropertiesSubForm = PropertyList.OpenProperty(PROPERTY_FORM).ComponentContainer.OpenComponentByName("FieldPropertiesSubForm");
			var FieldPropertiesHost = FieldPropertiesSubForm.OpenDelegateComponent();
			var FieldPropertiesCode = FieldPropertiesHost.GetScriptDispatch();
			
			// Build up an array of field types in the order we want them displayed in
			var MetaDataArray = new Array();
			var pNameEnum = g_MetaDataTable.LockedCreateNameValueEnum();
			while (pNameEnum.HasMore())
			{
				var pEntry = pNameEnum.OpenNextPair();
				var pMetaData = pEntry.Second;
				if (pMetaData.HasItem("ListIndex"))
					MetaDataArray[pMetaData.ListIndex] = pMetaData;
				else if (pMetaData.ObjectType == "S")
				{
					var Name = pMetaData.DisplayName;
					if (Name == "")
					Name = pMetaData.Name;
					var index = g_ComponentObjectCache.StylesCombobox.AddItem(Name);
					g_ComponentObjectCache.StylesCombobox.SetItemData(index, pMetaData.Name);
				}
			}

			// Now enumerate over the array, adding the items to the listbox
			FieldPropertiesCode.ResetFieldTypes();
			var i = 0;
			while (i < MetaDataArray.length)
			{
				var Name = MetaDataArray[i].DisplayName;
				if (Name == "")
					Name = MetaDataArray[i].Name;
				
				FieldPropertiesCode.AddFieldType(Name, MetaDataArray[i].Name, MetaDataArray[i].ObjectType);
				i++;
			}			

			FieldPropertiesCode.SetInitialSelection();
			g_ComponentObjectCache.StylesCombobox.SetSelectionByIndex(0);
			g_MetaDataLoaded = true;
			return true;
		}
		catch (error)
		{
			g_MetaDataLoaded = false;
			GrooveDebugFunctions.DisplayAssert(0, "Error loading meta data.");
			// GrooveErrorFunctions.ErrorCode = error.number;
			return false;
		}
	}

	//**************************************************************************//
	//					End MetaData Functions									//
	//**************************************************************************//	

	//**************************************************************************//
	//					  Form Only Functions									//
	//**************************************************************************//
	function CreateNewForm()
	{
		OpenDesigner("F");
	}

	function ChangeForm(i_pCommand)
	{
		if (WebBrowserView.window == null)
			return;
			
		var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
		
		var numRecords = ToolDelegate.NumberOfRecords;
			
		var strSelectedRecord = "";

		if (g_CurrentRecordID)
			strSelectedRecord = "?SelectedID="+g_CurrentRecordID;
		WebBrowserView.window.location.href = i_pCommand.UserData + strSelectedRecord;
		HideUICommands();
	}

	function VerifyFormExistsForURL(i_URL)
	{
		// Get the ID from the end of the URL
		var FormID = "";
		if (i_URL.indexOf("_ComponentData") >= 0)
			FormID = RightBack(i_URL, "_ComponentData/");
		else
			FormID = i_URL;

		var DatabaseName = null;
		try
		{
			DatabaseName = GetCurrentDatabaseName();
		}
		catch(error)
		{
		}

		if (DatabaseName != null)
		{
			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			if (typeof pDatabase != "undefined" && pDatabase != null)
				return pDatabase.DoesDatabaseObjectExistByID(FormID);
		}

		return false;
	}

	function GetBindableURLFromDefaultForm()
	{
		try
		{
			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName());
			var DefaultForm = GetCurrentDefaultForm();
			var Result = "";
		
			if (DefaultForm != "")
			{	
				if (pDatabase.DoesDatabaseObjectExistByID(DefaultForm))
				{
					var pDatabaseObject = pDatabase.OpenDatabaseObjectByID(DefaultForm);
					var URL = pDatabaseObject.BindableURL;
					Result = URL;
				}
				else
					ThrowError("Default form no longer exists.");
			}
			else
				ThrowError("No default form found.");
		}
		catch (error)
		{
			var Enum = GetFormNameURLEnum(GetCurrentDatabaseName());
			while (Enum.HasMore())
			{
				var Pair = Enum.OpenNextPair();
				Result = Pair.Second;
				break;
			}
		}
		finally
		{
			return Result;
		}
	}

	//**************************************************************************//
	//					End  Form Only Functions								//
	//**************************************************************************//

	//**************************************************************************//
	//					  View Only Functions									//
	//**************************************************************************//
	function CreateNewView()
	{
		OpenDesigner("V");
	}

	function ChangeView(i_UICommand)
	{
		if (WebBrowserView.window == null)
			return;

		var ViewName = Right(i_UICommand.UserData, "ComponentData/");

		//UseView(ViewName);

		var strPath = BuildPathFromBase("file:///", "FormsViewFrame.html?viewname=" + escape(i_UICommand.Label));
		WebBrowserView.window.location.href = strPath;
	}

	function GetViewNamesArray(i_Db)
	{
		var NameURLEnum = i_Db.CreateNameURLEnum(GrooveFormsDatabaseObjectType_View);
		var ViewNamesArray = new Array();
		var count = 0;
		while (NameURLEnum.HasMore())
		{
			var Pair = NameURLEnum.OpenNextPair();
			ViewNamesArray[count] = Pair.First;
			count++;
		}
		return ViewNamesArray;
	}	

	//**************************************************************************//
	//					 End View Only Functions								//
	//**************************************************************************//

	//**************************************************************************//
	//						Schema Functions									//
	//**************************************************************************//
	function DoesSchemaExist(i_Name)
	{		
		try
		{
			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName());
			return pDatabase.DoesSchemaExist(i_Name);
		}
		catch(error)
		{
			DisplayError(error);
			return false;
		}
	}	
	//**************************************************************************//
	//					End	Schema Functions									//
	//**************************************************************************//

	//**************************************************************************//
	//					Dialog Functions										//
	//**************************************************************************//
	function LoadFormSearchControl()
	{
		var DatabaseName = null;
		try
		{
			DatabaseName = GetCurrentDatabaseName();
		}
		catch(error)
		{
		}

		if (DatabaseName != null)
		{
			var FormsSearchControlSubForm = PropertyList.OpenProperty(PROPERTY_FORM).ComponentContainer.OpenComponentByName("FormsSearchControlSubForm");
			var Window = CreateWindowForSubForm("Form Search", FormsSearchControlSubForm);

			var b = Window.DoesDelegateComponentExist();
			if (b == false)
				GrooveDebugFunctions.DisplayAssert(0, "Can't get the Delegate Code component");
		
			var FormSearchControlHost = Window.OpenDelegateComponent();
			var FormSearchControlCode = FormSearchControlHost.GetScriptDispatch();

			var FormNameURLEnum = GetFormNameURLEnum(DatabaseName);

			FormSearchControlCode.SetCallbackCode(ScriptHostComponent.GetScriptDispatch());
			FormSearchControlCode.Open(FormNameURLEnum);
			var FSHelpProvider = FormSearchControlCode.GetHelpProvider();
			SetHelpInfo("SearchDialog", FSHelpProvider);
			var Result = Window.DoModal();
			if (Result == GrooveWindowResult_OK)
			{
				var AndOrOption = FormSearchControlCode.GetAndOr();
				var SearchValues = FormSearchControlCode.Close();
				SearchData(SearchValues, AndOrOption);
				// Set the search active flag to true and display the search buttons.
				g_IsSearchActive = true;
				DisplayViewNavButtons();
			}

			Window.Close();
			Window.Destroy();
			SetHelpInfo("HomePage", RTFHelpProvider);
		}
		else
		{
			DisplayError("Current database name not found.");
		}
	}

	function LoadChooseDateControl(i_Date, i_FormatPattern, i_FormatStyle)
	{
		var MonthPopupSubForm = PropertyList.OpenProperty(PROPERTY_FORM).ComponentContainer.OpenComponentByName("MonthPopupSubForm");
		// Open window for subform		
		var Window = CreateWindowForSubForm("Choose Date", MonthPopupSubForm);
		Window.WindowProperties.Resizable = false;
		Window.WindowProperties.Height = 260;
		Window.WindowProperties.Width = 210;
		Window.WindowProperties.CaptionVisible = false;
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Close, false);

		var b = Window.DoesDelegateComponentExist();
		if (b == false)
			GrooveDebugFunctions.DisplayAssert(0, "Can't get the Delegate Code component");
	
		var ChooseDateHost = Window.OpenDelegateComponent();
		var ChooseDateCode = ChooseDateHost.GetScriptDispatch();

		var DefaultDate;
		if (i_FormatPattern != null && i_FormatPattern != "" && i_FormatStyle != null && i_FormatStyle != "")
			DefaultDate = LocalParseDate(i_Date, i_FormatPattern, i_FormatStyle);
		else
			DefaultDate = Number(new Date(i_Date));

		if(isNaN(DefaultDate))
			DefaultDate = new Date().valueOf();

		ChooseDateCode.SetSelection(DefaultDate);

		var Result = Window.DoModal();
		if (Result == GrooveDialogBoxResultCode_OK)
		{
			var NewDate = new Date(ChooseDateCode.GetStartDate());
			var NewMonth = Number(NewDate.getMonth()) + 1;
			var SelectedDate = LocalFormatDate(NewDate.valueOf(), i_FormatPattern, i_FormatStyle);
		}
		else
			var SelectedDate = i_Date;

		Window.Close();
		Window.Destroy();

		return SelectedDate;
	}

	function AddOptionDialog(i_Label)
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var AddOptionResult = App.GrooveInputBox(Window, g_Account, i_Label, GrooveInputBoxStyle_None, "", "Add Option");
		AddOptionText = AddOptionResult.Data;

		return AddOptionText;
	}

	function ShowPublishNotification()
	{
		if (GetFormsPreferenceAsBool(PropertyList, "PublishNotificationShowAgain" , true))
		{
			var PublishNotificationSubForm = PropertyList.OpenProperty(PROPERTY_FORM).ComponentContainer.OpenComponentByName("PublishNotificationSubForm");
			var Window = CreateWindowForSubForm("Publish Modifications", PublishNotificationSubForm);
			var Result = Window.DoModal();
			Window.Close();
			Window.Destroy();
		}
	}

	function ReloadViewLocationAlert()
	{
		if (g_UIIsVisible && g_UIPropertyListIsValid && !g_ReloadViewLocationMessageBoxActive)
		{
			g_ReloadViewLocationMessageBoxActive = true;
			OKMessageBox("A member of this space has updated the design of the forms or views in this Forms tool.", "Forms Or Views Updated");
			g_ReloadViewLocationMessageBoxActive = false;
		}
	}

	function VerifyDesignerPermission()
	{
		// Without permission to use designer, go to user mode.
		if (g_UIIsVisible && g_UIPropertyListIsValid && !g_VerifyDesignerPermissionMessageBoxActive && !CanUseDesigner())
		{
			g_VerifyDesignerPermissionMessageBoxActive = true;
			OKMessageBox("The Groove Forms Manager is available only to managers of this space, and another manager in this space has assigned you another role. Click OK to return to the data view for this Forms tool.", "Forms Tool Design Restriction");
			g_Dirty = false;
			OpenDesigner("H");
			g_VerifyDesignerPermissionMessageBoxActive = false;
		}
	}

	//**************************************************************************//
	//				End	Dialog Functions										//
	//**************************************************************************//

	//**************************************************************************//
	//					Forms Database Tool Functions							//
	//**************************************************************************//
	function RemoveTool(i_DatabaseName)
	{
		try
		{
			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, i_DatabaseName);
			pDatabase.RemoveTool();
		}
		catch(error)
		{
			DisplayError(error);
		}
	}

	function GetToolNameForDatabase(i_DatabaseName)
	{
		try
		{
			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, i_DatabaseName);
			var ToolName = pDatabase.ToolName;
			return ToolName;
		}
		catch (error)
		{
			DisplayError(error);
		}
	}

	function InitToolDelegate(i_pDatabase)
	{
		try
		{
			var DatabaseName = i_pDatabase.DatabaseName;

			if (i_pDatabase.IsToolInstalled())
			{
				if (typeof g_CurrentTool == "undefined" || g_CurrentTool == null)
				{
					var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
					if (Tool == null)
					{
						return;
					}
					SinkTool(Tool);
				}
				if (i_pDatabase.DoesSchemaExist(DatabaseName))
				{
					if (typeof g_pForm == "undefined" || g_pForm == null)
						g_pForm = g_CurrentTool.UITool.CreateForm();
					
					
					if (g_pForm.DoesDelegateComponentExist())
						var UIToolDelegate = g_pForm.OpenDelegateComponent();
					else
						ThrowError("Form does not have delegate component.");

					if (UIToolDelegate.Component.OpenName() !="UIDelegate")
					{
						//GrooveDebugFunctions.DisplayAssert(0, "Delegate not correct.");
						if (typeof g_pForm !="undefined" && g_pForm != null)
							g_pForm.Close();
						g_pForm = null;
						delete g_pForm;
						UIToolDelegate = null;
						delete UIToolDelegate;
						CollectGarbage();

						i_pDatabase.UnloadCurrentTool();
						return;
					}
					UIToolDelegate.IGrooveFormsDatabaseUITool.InitializeTool(UIPropertyList);
					UIToolDelegate = null;
					delete UIToolDelegate;
					g_CurrentToolInited = true;
				}
			}
			else
			{
				//GrooveDebugFunctions.DisplayAssert(0, "Tool not installed");
				if (typeof g_CurrentTool == "undefined" || g_CurrentTool == null)
					LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
				
				g_CurrentToolInited = false;
				return;
			}
		}
		catch (error)
		{
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
				CollectGarbage();
			}
			DisplayError(error);
			g_CurrentToolInited = false;
		}
	}

	function FlushUITool(i_Reload)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{	
			if (typeof i_Reload == "undefined")
				i_Reload = true;
			//GrooveDebugFunctions.DisplayAssert(0, "");
			try
			{
				ShutdownBridge();
			}
			catch(error)
			{
			}

			if (typeof g_pForm != "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}

			if (g_CurrentTool)
			{
				if (g_CurrentTool.DoesDelegateComponentExist())
				{
					DisconnectObject(g_CurrentTool.OpenDelegateComponent());
					g_DelegateIsSinked = false;
					g_ToolObjectCache.RemoveAllItems();
				}
			}
			g_CurrentTool = null;
			delete g_CurrentTool;
			CollectGarbage();
			if (i_Reload)
			{
				ReloadViewLocation();
				SetupBridge();
			}
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, error.description);
		}
	}

	//**************************************************************************//
	//				End	Forms Database Tool Functions							//
	//**************************************************************************//
	
	//**************************************************************************//
	//					Forms Database Template Functions						//
	//**************************************************************************//

	function ImportDbObjects()
	{
		if (!CanOpenDesigner())
		{
			DisplayMgrWarning();
			return;
		}

		try
		{
			var b = LockDb();
			if (b)
			{
				var Result = CreateDatabaseFromTemplate();
				if (GrooveDialogBoxResultCode_OK == Result)
				{
					g_IsImporting = true;
					g_pWindowsManager.ShowWaitCursor();
					// This will get unlocked in the sink of AdviseEnd below.
					var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
					Window.WindowProperties.LockUpdate = true;
					return true;
				}
				else
					UnlockDb(null);
			}
			return false;
		}
		catch(error)
		{
			g_pWindowsManager.ShowWaitCursor(false);
			g_IsImporting = false;
		}
	}

	function CreateDatabaseFromTemplate()
	{
		try
		{
			var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
			var PRootPath = pStorageURISyntax.InstallDataRootPath;				
			var strPath = PRootPath +"ToolData\\groove.net\\GrooveForms\\FormsTemplates\\";
			var DefaultDirectory = strPath;

			var FileResult = App.OpenFileDialog("Create Database From Template", g_FORMS_TEMPLATE_FILTER, DefaultDirectory, "", g_Account, 1, false);
			if (GrooveDialogBoxResultCode_OK == FileResult.Result)
			{
				var strFilePath = FileResult.Data;
				var strFileName = RightBack(strFilePath, "\\");
				// Display an error if an invalid file type was selected.
				if (RightBack(strFilePath, ".") != "fdt")
				{
					OKMessageBox("The file you selected (\"" + strFileName + "\") is not a valid template file. Please select a file with the extension \".fdt\" to import a template.", "Invalid Template File");
					return;
				}
				// RSSToDo: this code was added so that import would continue to work.  Once
				// we get merge functionality we would prompt the user to see if they
				// wanted to merge from the template or replace from the template.
				var Delta = null;
				if (g_pIFormsToolDataModel.OpenDatabaseCount() > 0)
				{
					// Remove the current sandbox if it exists.
					if (g_pDesigner != null)
					{
						// Reset the session fields array if any fields had been added before this point.
						g_pDesigner.ResetSessionFieldsArray();
						// Shut down the current sandbox in the database if it exists.
						if (g_pDesigner.OpenCurrentSandboxVar() != null)
						{
							var pSandbox = g_pDesigner.OpenCurrentSandbox();
							if (typeof pSandbox != "undefined")
								RemoveCurrentSandbox(true);
						}
					}
					Delta = g_pDynMgr.CreateDelta();
					// Remove the current database.
					var DatabaseID = GetCurrentDatabaseID();
					g_pIFormsToolDataModelPrivate.NoSandboxLog = true;
					if (PropertyList.PropertyExists("FormsCurrentDatabase"))
						PropertyList.RemoveProperty("FormsCurrentDatabase");
					if (g_UIRunTimeData.HasItem("g_CurrentDatabaseName"))
						g_UIRunTimeData.RemoveItem("g_CurrentDatabaseName");
					g_pIFormsToolDataModel.DeleteDatabase(DatabaseID);
					if (PropertyList.PropertyExists("FormsCurrentDatabase"))
						PropertyList.RemoveProperty("FormsCurrentDatabase");
					if (g_UIRunTimeData.HasItem("g_CurrentDatabaseName"))
						g_UIRunTimeData.RemoveItem("g_CurrentDatabaseName");
					if (g_UIRunTimeData.HasItem("g_CurrentDatabaseID"))
						g_UIRunTimeData.SetItem("g_CurrentDatabaseID", -1);
					DatabaseListView.ResetContent();
					g_pIFormsToolDataModelPrivate.NoSandboxLog = false;
					
					/*
					g_pIFormsToolDataModelPrivate.NoSandboxLog = true;
					DeleteMultipleDatabases();
					g_pIFormsToolDataModelPrivate.NoSandboxLog = false;
					*/
				}
				if (Delta == null)
					Delta = g_pDynMgr.CreateDelta();
				g_pWindowsManager.ShowWaitCursor();
				var DbID = g_pIFormsToolDataModel.CreateDatabaseFromTemplate(strFilePath);
				PropertyList.SetPropertyAsBool("SystemFieldsInited", true);
				var DefaultFormID = g_pIFormsToolDataModelPrivate.OpenDefaultFormID(DbID);
				var DefaultViewID = g_pIFormsToolDataModelPrivate.OpenDefaultViewID(DbID);
				PropertyList.SetProperty("GrooveForms_DefaultForm", DefaultFormID);
				PropertyList.SetProperty("GrooveForms_DefaultView", DefaultViewID);
				g_pDynMgr.DoDelta(Delta);

				// Clear the record and collection count caches.
				if (g_UIRunTimeData.HasItem("g_RecordCount"))
					g_UIRunTimeData.RemoveItem("g_RecordCount");
				if (g_UIRunTimeData.HasItem("g_ToolCollectionCount"))
					g_UIRunTimeData.RemoveItem("g_ToolCollectionCount");
			}

			return FileResult.Result;
		}
		catch(error)
		{
			if (Delta)
				Delta.Abort();
			g_pWindowsManager.ShowWaitCursor(false);
			DisplayError(error);
		}
	}

	//**************************************************************************//
	//				End	Forms Database Template Functions						//
	//**************************************************************************//

	//**************************************************************************//
	//						DataModelDelegate Sinks								//
	//**************************************************************************//
	function DataModelDelegate_OnDatabaseAdded(i_DatabaseID, i_DatabaseName)
	{
		var Telespace = g_Telespace;
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if (DatabaseListView.SelectionIndex == -1)
				FillDatabasesList();

			if (GetDatabaseCount() > 1)
			{
				DeleteMultipleDatabases();

				if (PropertyList.PropertyExists("FormsCurrentDatabase"))
					PropertyList.RemoveProperty("FormsCurrentDatabase");
				if (g_UIRunTimeData.HasItem("g_CurrentDatabaseName"))
					g_UIRunTimeData.RemoveItem("g_CurrentDatabaseName");
				if (g_UIRunTimeData.HasItem("g_CurrentDatabaseID"))
					g_UIRunTimeData.RemoveItem("g_CurrentDatabaseID");
				// Clear the record and collection count caches.
				if (g_UIRunTimeData.HasItem("g_RecordCount"))
					g_UIRunTimeData.RemoveItem("g_RecordCount");
				if (g_UIRunTimeData.HasItem("g_ToolCollectionCount"))
					g_UIRunTimeData.RemoveItem("g_ToolCollectionCount");

				var DatabaseName = GetCurrentDatabaseName();
				var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
				if (Tool != null)
				{
					SinkTool(Tool);
				}
				g_ToolAvailable = true;
			}
							
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, error.description);
		}			
	}

	function DataModelDelegate_OnUnloadTool()
	{
		FlushUITool(false);
	}

	function DataModelDelegate_OnReloadCommandBar()
	{
		if (typeof UICommandContainer != "undefined" && UICommandContainer != null)
		{
			HideUICommands();
			if(g_CurrentState == "HomePage")
				ShowUICommands(true);
			else
				ShowUICommands(false);
			ShowMenuCommands();
		}
	}

	function DataModelDelegate_OnToolAddedAndManifested(i_URL)
	{
		if (GetCurrentDatabaseID() != -1)
		{
			var DatabaseName = GetCurrentDatabaseName();
			if (DatabaseName == null)
				return;
			var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
			if (Tool != null)
			{
				var ToolDescriptor = Tool.Descriptor;
				Tool = null;
				delete Tool;
				CollectGarbage();
				if (ToolDescriptor.Installable.CanRetry)
					ToolDescriptor.Installable.Retry();

			}
		}
		else
			return;
	}

	function DataModelDelegate_OnReplaceDatabaseObject(i_DatabaseName, i_DatabaseObjectID, i_IsSchema, i_IsFields, i_ReloadTool)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			if (i_IsSchema)
			{			
				if (g_ComponentObjectCache.HasItem("DuplicateFieldButton"))
					g_ComponentObjectCache.DuplicateFieldButton.Enabled = true;
				//GrooveDebugFunctions.DisplayAssert(0, "Reloaded Schema");
			}
			else if (i_IsFields)
			{
				/*
				//GrooveDebugFunctions.DisplayAssert(0, "OnReplaceDatabaseObject for Fields.xml");
				if (g_CurrentState != "Forms" && g_CurrentState != "Views")
				{
					FieldsListView.ResetContent();
					FormFieldsListView.ResetContent();

					var pDesignerObject = GetCurrentDesignerObject();
					var pFieldEnum = pDesignerObject.CreateFieldEnum();
					while (pFieldEnum.HasMore())
					{
						var pIField = pFieldEnum.OpenNext();
						var index = FieldsListView.AddItem(pIField.FieldName);
						var bindex = FormFieldsListView.InsertItem(index, pIField.FieldLabel);
						if (index != bindex)
							GrooveDebugFunctions.DisplayAssert(0, "Indexes don't match...");
						FieldsListView.SetItemText(index, 1, pIField.TypeDisplayName);
						FieldsListView.SetItemData(index, pIField);
						FormFieldsListView.SetItemText(bindex, 1, pIField.TypeDisplayName);
						FormFieldsListView.SetItemData(bindex, pIField.FieldName);
					}
				}
				*/				
			}
			else if (i_ReloadTool)
			{
				var Tool = LoadTool(i_DatabaseName, g_Telespace, g_pIFormsToolDataModel);
				if (Tool != null)
				{
					if (typeof g_CurrentTool != "undefined" && g_CurrentTool != null && g_DelegateIsSinked)
						UnsinkTool(g_CurrentTool);
					SinkTool(Tool);
				}
			}
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			DisplayError(error);
		}
	}

	function DataModelDelegate_OnDatabaseDeleted(i_DatabaseID)
	{
		FlushUITool();
		if (PropertyList.PropertyExists("FormsCurrentDatabase"))
			PropertyList.RemoveProperty("FormsCurrentDatabase");
		if (g_UIRunTimeData.HasItem("g_CurrentDatabaseName"))
			g_UIRunTimeData.RemoveItem("g_CurrentDatabaseName");
		if (g_UIRunTimeData.HasItem("g_CurrentDatabaseID"))
			g_UIRunTimeData.RemoveItem("g_CurrentDatabaseID");
		// Clear the record and collection count caches.
		if (g_UIRunTimeData.HasItem("g_RecordCount"))
			g_UIRunTimeData.RemoveItem("g_RecordCount");
		if (g_UIRunTimeData.HasItem("g_ToolCollectionCount"))
			g_UIRunTimeData.RemoveItem("g_ToolCollectionCount");
		if (g_pDesigner != null)
			g_pDesigner.ClearSandboxVars();
		FillDatabasesList();
		LoadHomePage();		
	}

	function DataModelDelegate_OnDeleteDatabaseObject(i_DatabaseID)
	{
		g_UpdateMenuFlag = true;
		g_FormMenuBuilt = false;
		g_ViewMenuBuilt = false;
		g_ModifyFormMenuBuilt = false;
		g_ModifyViewMenuBuilt = false;
		
		if (g_pIFormsToolDataModel.DoesDatabaseExistByID(i_DatabaseID))
		{
			if (GetCurrentDatabaseID() == i_DatabaseID)
			{
				g_MenuClass1State = null;
				g_MenuClass2State = null;
				if (g_CurrentState == "Manager")
					OpenDesigner("M");
				else if (g_CurrentState == "HomePage")
				{
					var pDatabase = g_pIFormsToolDataModel.OpenDatabase(i_DatabaseID);
					var NumViews = pDatabase.OpenDatabaseObjectCountByType(GrooveFormsDatabaseObjectType_View);
					if (NumViews == 0)
						LoadHomePage();
					else
					{
						var NumForms = pDatabase.OpenDatabaseObjectCountByType(GrooveFormsDatabaseObjectType_Form);
						if (NumForms == 0)
							LoadHomePage();
					}
				}
			}
		}
	}

	function DataModelDelegate_OnFormsViewsChanged(i_DatabaseObjectID, i_DatabaseID)
	{
		//GrooveDebugFunctions.DisplayAssert(0, "Break OnFormsViewsChanged");
		g_UpdateMenuFlag = true;
		g_FormMenuBuilt = false;
		g_ViewMenuBuilt = false;
		g_ModifyFormMenuBuilt = false;
		g_ModifyViewMenuBuilt = false;
		g_MenuClass1State = null;
		g_MenuClass2State = null;
		if (g_CurrentState != "HomePage")
		{
			try
			{
				var bResult = FillViewsFormsListView(i_DatabaseID);
				if (bResult == false)
					ThrowError("Error filling Views/Forms list.");
				//if (g_CurrentState == "Manager")
				//	OpenDesigner("M");
			}
			catch (error)
			{
				DisplayError(error);
			}

		}		
	}

	function DataModelDelegate_OnReloadTool(i_DatabaseName)
	{
		var Tool = LoadTool(i_DatabaseName, g_Telespace, g_pIFormsToolDataModel);
		if (Tool != null)
		{
			if (typeof g_CurrentTool != "undefined" && g_CurrentTool != null && g_DelegateIsSinked)
				UnsinkTool(g_CurrentTool);
			SinkTool(Tool);
		}
	}

	function DataModelDelegate_OnAdviseEnd()
	{
		try
		{
			if (g_SaveInProgress)
			{
				if (g_SaveSuccess)
				{
					
					if (g_CurrentState == "Forms")
					{
						if (!g_IsPreview)
						{

							AdviseEndTimer.Stop();
							AdviseEndTimer.Start();
						}
					}
					else
					{
						GROOVE_GLOBAL_MISC_POINTER.RegisterOneTimeCallback(ScriptHostComponent.IGrooveEventCallback, 110531);
					}
				}

				if (!g_IsPreview)
					g_Dirty = false;
				else
					g_Dirty = true;

				g_SaveSuccess = false;
				g_SaveInProgress = false;
			}
			
			if (g_SchemaUpdateInProgress)
			{
				g_SchemaUpdateInProgress = false;
				g_pWindowsManager.ShowWaitCursor(false);
			}

			if (g_AwaitingDatabaseAdded)
			{
				if (DatabaseListView.SelectionIndex != -1)
				{
					var DatabaseID = DatabaseListView.GetItemData(DatabaseListView.SelectionIndex);
					var Database = OpenDatabaseByID(DatabaseID);
					if (Database != null)
					{
						SetCurrentDatabase(Database);
						OpenDesigner("F");
						g_AwaitingDatabaseAdded = false;
					}
				}
			}

			if (g_IsImporting)
			{
				FillDatabasesList();
				OpenDesigner("H");
				g_IsImporting = false;
				var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
				Window.WindowProperties.LockUpdate = false;	
				g_pWindowsManager.ShowWaitCursor(false);
			}
		}
		catch(error)
		{
			if (g_IsImporting)
			{
				if (Window)
					Window.WindowProperties.LockUpdate = false;	
				g_pWindowsManager.ShowWaitCursor(false);
			}
		}	
	}

	function DataModelDelegate_OnUpdateRuntimeSettings(HTMLComponentEnum, ViewElementEnum, SortElementEnum, VersionID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			UpdateRuntimeSettings(HTMLComponentEnum, ViewElementEnum, SortElementEnum, VersionID);
			var Tool = LoadTool(GetCurrentDatabaseName(), g_Telespace, g_pIFormsToolDataModel);
			if (Tool != null)
				SinkTool(Tool);
			
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
			DisplayError(error);
		}
	}
	
	//**************************************************************************//
	//					End	DataModelDelegate Sinks								//
	//**************************************************************************//

	//**************************************************************************//
	//					HTMLComponentBridge Functions							//
	//**************************************************************************//
	function ShutdownBridge()
	{
		try
		{
			if (g_CurrentToolInited)
			{
				if (g_CurrentTool)
				{
					if (typeof g_pForm == "undefined" || g_pForm == null)
						g_pForm = g_CurrentTool.UITool.CreateForm();
				
					if (g_pForm.DoesDelegateComponentExist())
						var UIToolDelegate = g_pForm.OpenDelegateComponent();
					else
						ThrowError("Form does not have delegate component.");

					UIToolDelegate = null;
					delete UIToolDelegate;
					g_pForm.Close();
					g_pForm = null;
					delete g_pForm;
					CollectGarbage();
					g_CurrentToolInited = false;
				}
			}
		}
		catch(error)
		{
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}
			DisplayError(error);
		}
	}	
	
	function AddOrRemoveHTMLDocument(i_Document, i_Add, i_NewRecord)
	{
		try
		{
			if (g_ToolAvailable)
			{
				if (typeof g_CurrentTool == "undefined" || g_CurrentTool == null)
				{
					var DatabaseName = null;
					try
					{
						DatabaseName = GetCurrentDatabaseName();
					}
					catch(error)
					{
					}
					
					if (DatabaseName == null)
					{
						//GrooveDebugFunctions.DisplayAssert(0, "Error getting database name.");
						return null;
					}

					var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
					if (Tool == null)
					{
						GrooveDebugFunctions.DisplayAssert(0, "Error loading tool when adding document.");
						return null;
					}
					else
					{
						SinkTool(Tool);
					}
				}
				
				if (typeof g_pForm == "undefined" || g_pForm == null)
					g_pForm = g_CurrentTool.UITool.CreateForm();
				
				if (g_pForm.DoesDelegateComponentExist())
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
				else
					ThrowError("Form does not have delegate component.");

				var bSet = UIToolDelegate.IGrooveFormsDatabaseUITool.InitializeTool(UIPropertyList);
				GrooveDebugFunctions.DisplayAssert(bSet, "");
				
				if (i_Add)
					var AttachmentsElement = UIToolDelegate.IGrooveFormsDatabaseUITool.AddDocument(i_Document, i_NewRecord);
				else
					UIToolDelegate.IGrooveFormsDatabaseUITool.RemoveDocument(i_Document);

				UIToolDelegate = null;
				delete UIToolDelegate;
				return AttachmentsElement;
			}
		}
		catch (error)
		{
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}
			DisplayError(error);
			return null;
		}
	}

	function AddHTMLDocument(i_Document, i_NewRecord)
	{
		if (i_Document != null)
		{
			if (GetIsSafeForUI())
			{
				var AttachmentsElement = AddOrRemoveHTMLDocument(i_Document, true, i_NewRecord);
				SetupBridge();
				return AttachmentsElement;
			}
			else
				return null;
		}
		else
			return null;
	}

	function RemoveHTMLDocument(i_Document)
	{
		AddOrRemoveHTMLDocument(i_Document, false, null);
	}

	function SetupBridge()
	{
		try
		{
			var DatabaseName = null;
			try
			{
				DatabaseName = GetCurrentDatabaseName();
			}
			catch(error)
			{
			}
			
			if (DatabaseName == null)
				return;

			var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
			if (pDatabase == null)
				return;

			if (!pDatabase.IsToolInstalled())
				return;

			if (typeof UIPropertyList == "undefined")
				return;

			var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
			if (Tool == null)
			{
				GrooveDebugFunctions.DisplayAssert(0, "Error loading tool when adding document.");
				return null;
			}
			else
			{
				SinkTool(Tool);
			}
		
			if (typeof g_pForm == "undefined" || g_pForm == null)
				g_pForm = g_CurrentTool.UITool.CreateForm();
			
			if (g_pForm.DoesDelegateComponentExist())
				var UIToolDelegate = g_pForm.OpenDelegateComponent();
			else
				ThrowError("Form does not have delegate component.");

			//var bSet = UIToolDelegate.IGrooveFormsDatabaseUITool.InitializeTool(UIPropertyList);
			//GrooveDebugFunctions.DisplayAssert(bSet, "");
		}
		catch (error)
		{
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}
			DisplayError(error);
			return;
		}
	}

	//**************************************************************************//
	//				End	HTMLComponentBridge Functions							//
	//**************************************************************************//

	//**************************************************************************//
	//							Sandbox Functions								//
	//**************************************************************************//

	function ApplySandboxChanges()
	{
		try
		{
			if (g_pIFormsToolDataModel.CanUseDesigner == false)
			{
				OKMessageBox("You do not have permission to save your changes to Groove.", "Forms Tool Design Restriction");
				return false;
			}

			LoadDesignerScript();
			// Apply the changes from the sandbox.
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			if (typeof pSandbox != "undefined" && g_pIFormsToolDataModelPrivate.DoesSandboxLogFileExist(pSandbox.DatabaseID))
			{
				var Transaction = g_Telespace.OpenTransaction(false);
				try
				{
					// Create the delta that will send the sandbox changes to the other users.
					var Delta = g_pDynMgr.CreateDelta();
					// Set the design changed property to notify other users.
					PropertyList.SetProperty("GrooveForms_DesignChanged", "1");
					pSandbox.ApplySandboxChanges();
					g_pDynMgr.DoDelta(Delta);
					// Call InitializeRunTimeSettings to make sure that the 
					// changes to the DIS file and other files are handled correctly
					// after the synchronous listeners have completed.
					InitializeRunTimeSettings();
					Transaction.Commit();
				}
				catch(error)
				{
					GrooveDebugFunctions.DisplayAssert(0, "Error in ApplySandboxChanges().");
					Transaction.Abort();
				}
			}
		}
		catch (error)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Error in ApplySandboxChanges().");
			if (Delta)
				Delta.Abort();

			if (Transaction)
				Transaction.Abort();
		}
		// Return to the data view and remove the current sandbox.
		g_NeedToRemoveSandbox = true;
		OpenDesigner("H");
	}

	function DiscardSandboxChanges()
	{
		try
		{
			LoadDesignerScript();
			// Discard the changes from the sandbox.
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			if (typeof pSandbox != "undefined" && g_pIFormsToolDataModelPrivate.DoesSandboxLogFileExist(pSandbox.DatabaseID))
			{
				// Ask the users if they are sure only if changes have been made.
				if (YesNoMessageBox("Discarding your modifications cannot be undone. Do you want to continue?", "Cancel All Modifications"))
				{
					g_NeedToRemoveSandbox = true;
					OpenDesigner("H");
				}
			}
			else
			{
				g_NeedToRemoveSandbox = true;
				OpenDesigner("H");
			}
		}
		catch (error)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Error in DiscardSandboxChanges().");
		}
	}

	function RemoveCurrentSandbox(i_DeleteFolder)
	{
		var Delta = g_pDynMgr.OpenDelta("", false);
		Delta.AdvancedDelta2.LocalOnly = true;
		Delta.Begin();
		try
		{
			LoadDesignerScript();
			var pSandbox = g_pDesigner.OpenCurrentSandbox();
			if (typeof pSandbox != "undefined")
			{
				var SandboxID = pSandbox.DatabaseID;
				// Shut down the sand box object.
				pSandbox.IGrooveFormsSandboxPrivate.ShutdownSandbox();
				// Remove property that saves current sandbox id in property list.
				g_pDesigner.ClearSandboxVars();
				// Delete the sandbox folder from the database.
				if (i_DeleteFolder)
				{
					g_pIFormsToolDataModelPrivate.NoSandboxLog = true;
					var pDatabase = OpenDatabaseByID(GetCurrentDatabaseID());
					pDatabase.DeleteDatabaseObject(SandboxID);
					g_pIFormsToolDataModelPrivate.NoSandboxLog = false;
				}
			}
			g_pDynMgr.DoDelta(Delta);
		}
		catch (error)
		{
			if (Delta)
				Delta.Abort();
			DisplayError(error);
		}
	}

	//**************************************************************************//
	//							End Sandbox Functions							//
	//**************************************************************************//

	//**************************************************************************//
	//						Utility Functions									//
	//**************************************************************************//

	function GetURIToCurrentRecord()
	{
		var Transaction = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE).OpenTransaction(false);
		try
		{
			var ToolURL = PropertyList.OpenProperty(PROPERTY_CANONICAL_URL);
			var pURI = GROOVE_GLOBAL_MISC_POINTER.OpenURI(ToolURL);
			if (typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID != null && g_CurrentRecordID != -1)
			{				
				pURI.SetQueryPart("RecordID", g_CurrentRecordID);
			}
			Transaction.Commit();
			return pURI;
		}
		catch (error)
		{
			Transaction.Abort();
			return null;
		}
	}
	
	function DisplayError(error)
	{
		if (g_UIPropertyListIsValid && g_UIIsVisible)
		{
			var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			App.GrooveMessageBox(Window, g_Account, "You received the following error: \n\n" + error.description, "Error", GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Error);
		}
	}

	function ThrowError(i_Description)
	{
		var objError = new Error(-213546871, i_Description);
		throw objError;
	}

	function CreateWindowForSubForm(i_Caption, i_SubForm)
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		//Set window properties
		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = ParentWindow;
		WindowProperties.Caption = i_Caption;
		WindowProperties.CaptionVisible = true;
		WindowProperties.CloseButton = false;
		WindowProperties.BorderVisible = false;
		WindowProperties.HelpButton = false;
		WindowProperties.Resizable = true;

		//Open window for subform
		Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount,"", WindowProperties, i_SubForm, false);

		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore |
									//GrooveWindowMenuCommand_Size |
									GrooveWindowMenuCommand_Minimize |
									GrooveWindowMenuCommand_Maximize,
									false);
		return Window;
	}

	function CreateValidXMLName(i_Name)
	{
		var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
		var ValidXMLName = pXMLSyntax.ConvertToXMLName(i_Name);
		return ValidXMLName;
	}

	function GetCurrentIdentityName()
	{
		var pCurrentIdentity = g_Telespace.OpenCurrentIdentity();
		var pCurrentIdentityContact = pCurrentIdentity.Contact;
		var DisplayName = pCurrentIdentityContact.ContactStoreEntry.DisplayName;
		return DisplayName;
	}

	function GetCanonicalURL(i_BindableURL)
	{
		var CanonicalURL = g_TelespaceURLSyntax.CanonicalURLFromBindableURL(i_BindableURL);
		return CanonicalURL;
	}

	function GetBindableURL(i_CanonicalURL)
	{
		var CurrentIdentityURL = PropertyList.OpenProperty(PROPERTY_CURRENT_IDENTITY_URL);
		var BindableURL = g_TelespaceURLSyntax.CreateBindableURL(i_CanonicalURL, CurrentIdentityURL);
		return BindableURL;
	}

	function GetRelativeURLFromCanonicalURL(i_CanonicalURL)
	{
		var RelativeURL = g_TelespaceURLSyntax.RelativePartFromURL(i_CanonicalURL);
		return RelativeURL;
	}

	function GetBindableURLFromRelativeURL(i_RelativeURL)
	{
		var URLWithoutRelativePart = g_TelespaceURLSyntax.URLWithoutRelativePartFromURL(g_TelespaceCanonicalURL);
		var CanonicalURL = g_TelespaceURLSyntax.CreateURL(URLWithoutRelativePart, i_RelativeURL);
		var BindableURL = GetBindableURL(CanonicalURL);
		return BindableURL;
	}

	function GetBindableURLFromDBObjectID(i_ID)
	{
		var pDatabase = OpenDatabaseByID(GetCurrentDatabaseID());
		if (pDatabase != null)
		{
			if (pDatabase.DoesDatabaseObjectExistByID(i_ID))
			{
				var pDatabaseObject = pDatabase.OpenDatabaseObjectByID(i_ID);
				return pDatabaseObject.BindableURL;
			}
		}
		return "";
	}

	function GetRecordCount()
	{
		try
		{
			if (!g_UIRunTimeData.HasItem("g_RecordCount"))
			{
				var DatabaseName = null;
				try
				{
					DatabaseName = GetCurrentDatabaseName();
				}
				catch(error)
				{
				}

				if (DatabaseName != null)
				{
					var pDatabase = OpenDatabaseByName(g_pIFormsToolDataModel, DatabaseName);
					if (pDatabase.Tool != null)
					{
						var FormsToolDataModelDelegate = GetToolDelegate(pDatabase.Tool);
						var RecordCount = FormsToolDataModelDelegate.NumberOfRecords;
						g_UIRunTimeData.SetItem("g_RecordCount", RecordCount);
					}
					else
						g_UIRunTimeData.SetItem("g_RecordCount", 0);
				}
				else
					g_UIRunTimeData.SetItem("g_RecordCount", 0);
			}
			return g_UIRunTimeData.GetItem("g_RecordCount");
		}
		catch(error)
		{
			return 0;
		}
	}

	function GetRichTextElement()
	{
		return CreateNewElement("urn:groove.net:RichText");
	}

	function GetWrapperElement()
	{
		return CreateNewElement("urn:groove.net:FormsWrapper");
	}

	function OpenUICommandNoThrow(i_pContainer, i_CommandName)
	{
		if (i_pContainer.UICommandExists(i_CommandName))
			return i_pContainer.OpenUICommand(i_CommandName);
		return null;
	}

	function OpenSubCommandContainerNoThrow(i_pParentContainer, i_SubContainerName)
	{
		if (i_pParentContainer.UICommandContainerExists(i_SubContainerName))
			{
			var pCommandContainer = i_pParentContainer.OpenUICommandContainer(i_SubContainerName);
			// Some command containers are also commands, so QI to ensure we return container
			return pCommandContainer.UICommandContainer;
			}
		return null;
	}

	function OpenSubCommandContainer(i_pParentContainer, i_SubContainerName)
	{
		var pSubCommandContainer = OpenSubCommandContainerNoThrow(i_pParentContainer, i_SubContainerName);
		if (null == pSubCommandContainer)
			ThrowError("Sub-CommandContainer " + i_SubContainerName + " not found.");
	}

	function GetMemberNameArray()
	{
		var MemberEnum = g_Telespace.Members.CreateEnum();
		var ResultArray = new Array();
		while(MemberEnum.HasMore())
		{
			var Member = MemberEnum.OpenNext();
			var DisplayName = Member.Contact.ContactStoreEntry.DisplayName;
			ResultArray[ResultArray.length] = DisplayName;
		}

		return ResultArray;
	}

	function GetCurrentAuthorName()
	{
		return OpenFullNameFromCurrentIdentity(PropertyList, true);
	}	

	function GetFormattedDate(i_Date)
	{
		var DateString = FormatDateTime(i_Date, GrooveIntlDateFormatStyle_Default, GrooveIntlDateFormatStyle_Default) ;
		return DateString;
	}

	function GetViewIDByName(ViewName, Sandbox)
	{
		var ViewObj = Sandbox.OpenDatabaseObjectByFullName(ViewName+".vtml");
		if (ViewObj)
			return ViewObj.DatabaseObjectID;
		else
			GrooveDebugFunctions.DisplayAssert(0, "No view object found.");
	}

	function OpenDatabaseObjectAsStringByFullName(i_Name)
	{
		var ReturnValue = "";
		LoadDesignerScript();
		var pSandbox = g_pDesigner.OpenCurrentSandbox();
		if (pSandbox != null)
		{
			if (pSandbox.DoesDatabaseObjectExistByFullName(i_Name))
			{
				var pSandboxObject = pSandbox.OpenDatabaseObjectByFullName(i_Name);
				var BIS = pSandboxObject.OpenByteInputStream();
				var CIS = BIS.OpenCharInputStream(GrooveCharEncodingType_UTF8);
				ReturnValue = CIS.ReadChars(-1);
				BIS.Close();
			}
			return ReturnValue;
		}
		return "";
	}

	function InitializeRunTimeSettings(i_bForce)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			if (typeof i_bForce == "undefined")	
				i_bForce = false;
			// We want to update all backend tool ui components at startup if we need to.
			var DatabaseID = GetCurrentDatabaseID();
			if (DatabaseID == -1)
			{
				Transaction.Commit();
				return null;
			}
			var pDatabase = g_pIFormsToolDataModel.OpenDatabase(DatabaseID);
			var ToolObj = pDatabase.IGrooveFormsDatabasePrivate.OpenToolObject();
			g_ToolObjectVersionID = ToolObj.VersionID;
			if (((PropertyList.OpenProperty("GrooveForms_ToolDisseminatorVersion") != g_ToolObjectVersionID) &&
				g_ToolObjectVersionID != "") || i_bForce)
			{
				var XMLDocument = ToolObj.XMLDocument;
				var pRootElement = ToolObj.RootElement;
				
				// HTMLComponents
				var HTMLComponentEnum = GetElementEnumByElementName(XMLDocument, "urn:groove.net:HTMLComponent", pRootElement);
				// CollectionDataListDataSource elements
				var ViewElementEnum = GetElementEnumByElementName(XMLDocument, "urn:groove.net:View", pRootElement);
				var SortElementEnum = GetElementEnumByElementName(XMLDocument, "urn:groove.net:Sort", pRootElement);	
				UpdateRuntimeSettings(HTMLComponentEnum, ViewElementEnum, SortElementEnum, g_ToolObjectVersionID);
			}
			Transaction.Commit();
		}
		catch(error)
		{
			GrooveDebugFunctions.DisplayAssert(0, error.description);
			Transaction.Abort();
		}
	}

	function UpdateRuntimeSettings(HTMLComponentEnum, ViewElementEnum, SortElementEnum, VersionID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			//GrooveDebugFunctions.DisplayAssert(0,"");
			if (typeof g_CurrentTool == "undefined" || g_CurrentTool == null)
			{
				var DatabaseName = null;
				try
				{
					DatabaseName = GetCurrentDatabaseName();
				}
				catch(error)
				{
				}
				
				if (DatabaseName == null)
				{
					//GrooveDebugFunctions.DisplayAssert(0, "Error getting database name.");
					Transaction.Commit();
					return null;
				}

				var Tool = LoadTool(DatabaseName, g_Telespace, g_pIFormsToolDataModel);
				if (Tool == null)
				{
					GrooveDebugFunctions.DisplayAssert(0, "Error loading tool when applying runtime settings.");
					Transaction.AdvancedTransaction2.WillAbort();
					Transaction.Abort();
					return null;
				}
				else
				{
					SinkTool(Tool);
				}
			}


			if (typeof g_pForm == "undefined" || g_pForm == null)
				g_pForm = g_CurrentTool.UITool.CreateForm();
		
			if (g_pForm.DoesDelegateComponentExist())
				var UIToolDelegate = g_pForm.OpenDelegateComponent();
			else
				ThrowError("Form does not have delegate component.");

			if (UIToolDelegate.Component.OpenName() =="UIDelegate")
			{
				//GrooveDebugFunctions.OutputString("\n\nUI VERSION OF UpdateRunTimeSettings updating HTMLComponentBridge\n\n");
				// First do the HTMLComponent bridge
				while (HTMLComponentEnum.HasMore())
				{
					var HTMLComponent = HTMLComponentEnum.OpenNext();
					var HTMLComponentName = HTMLComponent.OpenAttribute("Name");
					if (UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.DoesHTMLComponentExist(HTMLComponentName))
						UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.RemoveHTMLComponentFromBridge(HTMLComponentName);
					UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.AddHTMLComponentToBridge(HTMLComponent);
				}
				
				// Next do the CollectionDataListDataSource views
				var ViewNameEnum = CreateBSTREnum();
				while (ViewElementEnum.HasMore())
				{
					var ViewElement = ViewElementEnum.OpenNext();
					UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.AddViewToCollectionDataListDataSource(ViewElement);
					ViewNameEnum.Add(ViewElement.OpenAttribute("Name"));
				}
				
				// Now clean up any views which don't belong anymore
				UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.RemoveUnknownViewsFromCollectionDataListDataSource(ViewNameEnum.IGrooveBSTREnum);

				// Now add the sorts to the CollectionDataListDataSource
				var SortNameEnum = CreateBSTREnum();
				while (SortElementEnum.HasMore())
				{
					var SortElement = SortElementEnum.OpenNext();
					UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.AddSortToCollectionDataListDataSource(SortElement);
					SortNameEnum.Add(SortElement.OpenAttribute("Name"));
				}				
				
				// Now clean up any unknown sorts.
				UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.RemoveUnknownSortsFromCollectionDataListDataSource(SortNameEnum.IGrooveBSTREnum);

				UIToolDelegate = null;
				delete UIToolDelegate;
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
				CollectGarbage();
			}
			
			PropertyList.SetProperty("GrooveForms_ToolDisseminatorVersion", VersionID, GroovePropertyFlag_Private);
			
			Transaction.Commit();

		}
		catch(error)
		{
			if (typeof g_pForm!= "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}

			Transaction.Abort();
			DisplayError(error);
		}

		ReloadViewLocation();
	}

	function ShowNotification()
	{
		g_Dirty = false;
		ShowPublishNotification();
		if (!g_IsDirtySave)
			OpenDesigner("M");
		g_IsDirtySave = false;
	}

	function UnsinkTool(i_Tool)
	{
		if (g_DelegateIsSinked)
			DisconnectObject(i_Tool.OpenDelegateComponent());
		
		g_DelegateIsSinked = false;
	}

	function SinkTool(i_Tool)
	{
		if (!g_DelegateIsSinked && i_Tool.DoesDelegateComponentExist())
		{
			g_CurrentTool = i_Tool;
			ConnectObject(g_CurrentTool.OpenDelegateComponent(), "FormsDatabaseTool_");
			g_DelegateIsSinked = true;
		}
	}
	//**************************************************************************//
	//					End	Utility Functions									//
	//**************************************************************************//

	//**************************************************************************//
	//						Attachments Methods									//
	//**************************************************************************//

	function AddAttachments(i_DocumentShareView, i_AttachmentElement)
	{
		var strLastDirectory = PropertyList.OpenProperty("FormsLastDirectory");
		
		try
		{
			var FileResult = App.OpenFileDialog(g_FORMS_ADD_ATTACHMENTS, g_FORMS_ADD_ATTACHMENTS_FILTER, strLastDirectory, "", g_Account, 1, true);
		}
		catch (error)
		{
			DisplayError(error);
			return;
		}

		if (GrooveDialogBoxResultCode_OK == FileResult.Result)
		{
			g_pWindowsManager.ShowWaitCursor();
			var strFiles = FileResult.Data;
			var FileArray = strFiles.split("|");

			if (FileArray.length > 1)
			{
				var Root = FileArray[0];
				var i = 1;
				var iCount = FileArray.length;
				while (i < iCount)
				{
					var FilePath = Root+"\\"+FileArray[i];
					CreateAttachment(FilePath, i_DocumentShareView, i_AttachmentElement);
					i++
				}
				PropertyList.SetProperty("FormsLastDirectory", Root, GroovePropertyFlag_Private);
			}
			else
			{
				FilePath = FileArray[0];
				CreateAttachment(FilePath, i_DocumentShareView, i_AttachmentElement);
				var strPath = LeftBack(FilePath, "\\");
				PropertyList.SetProperty("FormsLastDirectory", strPath, GroovePropertyFlag_Private);
			}
			g_pWindowsManager.ShowWaitCursor(false);
		}
	}

	function CreateAttachment(i_FileName, i_DocumentShareView, i_AttachmentsElement)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			
			try
			{
				// This is a special case.  Since errors cannot be thrown from a script module back to the
				// caller, in this case it was decided to not use the helper function, but instead call
				// the factory directly.  This allows us to display a Groove dialog in order to display
				// any error which occurs.
				//var ByteInputStream = CreateByteInputStreamFromFile(i_FileName);
				var ByteInputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteInputStreamFromFile(i_FileName, false);
			}
			catch(error)
			{
				DisplayError(error);
				Transaction.Abort();
				return;
			}

			var pPathEnum = CreateBSTREnum();
			pPathEnum.Add(i_FileName);

			if (g_CurrentTool)
			{
				if (typeof g_pForm == "undefined" || g_pForm == null)
					g_pForm = g_CurrentTool.UITool.CreateForm();
				
				if (g_pForm.DoesDelegateComponentExist())
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
				else
					ThrowError("Form does not have delegate component.");

				if (i_DocumentShareView.Properties2.Initialized && (!i_DocumentShareView.Properties2.GetReadOnlyMode()))
				{
					UIToolDelegate.IGrooveFormsDatabaseUITool.CreateAttachment(pPathEnum, i_DocumentShareView, i_AttachmentsElement);
				}
				UIToolDelegate = null;
				delete UIToolDelegate;
			}

			ByteInputStream.Close();
			
			Transaction.Commit();
		}
		catch (error)
		{
			ActiveXMessageBox();
			Transaction.Abort();
			return;
		}
	}

	function DeleteAttachments(i_DocumentShareView)
	{
		try
		{
			if (i_DocumentShareView.OpenShareObjectSelectionCount() > 0)
			{
				i_DocumentShareView.Commands.DeleteSelection(true);
			}
		}
		catch (error)
		{
			ActiveXMessageBox();
		}
	}

	function GetAttachmentCount(i_AttachmentElement)
	{
		if (typeof g_pForm == "undefined" || g_pForm == null)
			g_pForm = g_CurrentTool.UITool.CreateForm();
		
		if (g_pForm.DoesDelegateComponentExist())
			var UIToolDelegate = g_pForm.OpenDelegateComponent();
		else
			ThrowError("Form does not have delegate component.");

		var count = UIToolDelegate.IGrooveFormsDatabaseUITool.OpenAttachmentCount(i_AttachmentElement);
		UIToolDelegate = null;
		delete UIToolDelegate;
		return count;
	}

	//**************************************************************************//
	//					End	Attachments Methods									//
	//**************************************************************************//

	//**************************************************************************//
	//				Backend Tool Permissions Methods/Callbacks					//
	//**************************************************************************//
	function ViewDatabaseToolPermissions()
	{
		if (g_CurrentTool)
		{
			var pToolDesc = g_CurrentTool.Descriptor;
			var pScopeURL = pToolDesc.ObjectTypesScopeURL;
			
			pToolHelper = GrooveScriptFunctions.CreateNewObject("Groove.ToolUIHelperObject");
			var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			pToolHelper.DisplayPermissionsDialog(ParentWindow, g_Account, pToolDesc, g_Telespace, pScopeURL.String);
			
		}
	}

	function CanUseDesigner()
	{
		return g_pIFormsToolDataModel.CanUseDesigner();
	}

	function CanCreate()
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			var bCanCreate = false;
			if (IsObjectInCache("CanCreate", g_UIRunTimeData))
			{
				bCanCreate = OpenObjectFromCache("CanCreate", g_UIRunTimeData);
			}
			else
			{
				if (g_CurrentTool)
				{
					var CurrentDatabaseName = GetCurrentDatabaseName();

					if (CurrentDatabaseName != null)
					{
						var ToolDelegate = LoadCurrentToolDelegate(CurrentDatabaseName, OpenDatabaseByName(g_pIFormsToolDataModel, CurrentDatabaseName), g_Telespace, g_pIFormsToolDataModel);
						if (typeof ToolDelegate == "object")
						{
							bCanCreate = ToolDelegate.CanCreateRecords();
							AddObjectToCache("CanCreate", bCanCreate, g_UIRunTimeData);
						}
					}
				}
			}

			Transaction.Commit();
			return bCanCreate;
		}
		catch (error)
		{
			Transaction.Abort();
			return false;
		}
	}

	function CanEdit(i_RecordID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			var bCanEdit = false;
			if (IsObjectInCache("CanEdit_" + i_RecordID, g_UIRunTimeData))
			{
				bCanEdit = OpenObjectFromCache("CanEdit_" + i_RecordID, g_UIRunTimeData);
			}
			else
			{
				var CurrentDatabaseName = GetCurrentDatabaseName();
				if (CurrentDatabaseName != null)
				{
					var ToolDelegate = LoadCurrentToolDelegate(CurrentDatabaseName, OpenDatabaseByName(g_pIFormsToolDataModel, CurrentDatabaseName), g_Telespace, g_pIFormsToolDataModel);
					if (typeof ToolDelegate == "object")
					{
						bCanEdit = ToolDelegate.CanEditRecord(i_RecordID);
						AddObjectToCache("CanEdit_" + i_RecordID, bCanEdit, g_UIRunTimeData);
					}
				}
			}

			Transaction.Commit();
			return bCanEdit;
		}
		catch (error)
		{
			Transaction.Abort();
			return false;
		}
	}

	function CanDelete(i_RecordID)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			var bCanDelete = false;
			if (IsObjectInCache("CanDelete_" + i_RecordID, g_UIRunTimeData))
			{
				bCanDelete = OpenObjectFromCache("CanDelete_" + i_RecordID, g_UIRunTimeData);
			}
			else
			{
				var CurrentDatabaseName = GetCurrentDatabaseName();
				if (CurrentDatabaseName != null)
				{
					var ToolDelegate = LoadCurrentToolDelegate(CurrentDatabaseName, OpenDatabaseByName(g_pIFormsToolDataModel, CurrentDatabaseName), g_Telespace, g_pIFormsToolDataModel);
					if (typeof ToolDelegate == "object")
					{
						bCanDelete = ToolDelegate.CanDeleteRecord(i_RecordID);
						AddObjectToCache("CanDelete_" + i_RecordID, bCanDelete, g_UIRunTimeData);
					}
				}
			}

			Transaction.Commit();
			return bCanDelete;
		}
		catch (error)
		{
			Transaction.Abort();
			return false;
		}
	}

	function FormsDatabaseTool_OnFormsDatabaseToolRoleChanged(i_ScopeURL, i_ObjectID, i_ChildType, i_RoleName, i_MemberContactURLOrParentRoleName, i_ChangeType)
	{
		// Refresh screen
		if (typeof UICommandContainer != "undefined" && UICommandContainer != null)
		{
			HideUICommands();
			if(g_CurrentState == "HomePage")
				ShowUICommands(true);
			else
			{
				ShowUICommands(false);
				PostEvent(123546, 0);
			}
			ShowMenuCommands();
		}

		// Clear the create and delete caches as the users role has changed.
		ClearPermissionCaches();
		// Enable or disable edit and delete buttons depending on children.
		EnableEditDeleteButtons();

		// If user is looking at the home page, reload to get forms manager buttons.
		if (g_CurrentState == "HomePage")
		{
			try
			{
				if (WebBrowserView.window != null)
				{
					if (WebBrowserView.window.location.href.indexOf("FormsHomePage.html") >= 0)
						WebBrowserView.window.location.reload(true);
					else if(typeof WebBrowserView.window.roleChanged != "undefined")
					{
						// If the user is looking at a form - call the following function
						// so that the page can change the display appropriately.
						WebBrowserView.window.roleChanged();
					}
				}
			}
			catch(error)
			{
			}
		}
	}

	function FormsDatabaseTool_OnFormsDatabaseToolRecordSetChanged(i_pTool, i_RecordSetChangeType, i_pIRecordIDEnum)
	{
		var Transaction = g_Telespace.OpenTransaction(false);
		try
		{
			if (g_CurrentTool)
			{
				if (typeof g_pForm == "undefined" || g_pForm == null)
					g_pForm = g_CurrentTool.UITool.CreateForm();
				
				if (g_pForm.DoesDelegateComponentExist())
				{
					var UIToolDelegate = g_pForm.OpenDelegateComponent();
					
					if (UIToolDelegate.Component.OpenName() =="UIDelegate")
					{
						UIToolDelegate.IGrooveFormsDatabaseUIToolPrivate.SetRecordSetChanged(i_RecordSetChangeType, i_pIRecordIDEnum);
					}
					else
						GrooveDebugFunctions.DisplayAssert(0, "PLEASE NOTE THIS ERROR (FormsDatabaseTool_OnFormsDatabaseToolRecordSetChanged) - You've received this error, but you can run through it. Please report that you've received this error.");
					UIToolDelegate = null;
					delete UIToolDelegate;
				}
			}

			try
			{
				if (i_RecordSetChangeType == GrooveRecordSetChangeType_Added || i_RecordSetChangeType == GrooveRecordSetChangeType_Removed)
				{
					// Clear the record and collection count caches.
					if (g_UIRunTimeData.HasItem("g_RecordCount"))
						g_UIRunTimeData.RemoveItem("g_RecordCount");
					if (g_UIRunTimeData.HasItem("g_ToolCollectionCount"))
						g_UIRunTimeData.RemoveItem("g_ToolCollectionCount");

					// Enable or disable edit and delete buttons depending on children.
					EnableEditDeleteButtons();
				}
			}
			catch (error)
			{
			}

			Transaction.Commit();
		}
		catch(error)
		{
			DisplayError(error);
			if (typeof g_pForm != "undefined" && g_pForm != null)
			{
				g_pForm.Close();
				g_pForm = null;
				delete g_pForm;
			}
			Transaction.Abort();
		}
	}

	function FormsDatabaseTool_OnFormsDatabaseToolFieldChanged(pTool, i_RecordID, i_FieldName, i_pFieldValueBefore, i_pFieldValueAfter)
	{
		try
		{
			// Reload the preview pane as it's contents may have changed.
			if (typeof g_CurrentRecordID != "undefined" && g_CurrentRecordID == i_RecordID)
			{
				ReloadPreviewPane(i_RecordID);
			}
		}
		catch (error)
		{
			DisplayError(error);
		}
	}

	//**************************************************************************//
	//			End	Backend Tool Permissions Methods/Callbacks					//
	//**************************************************************************//
	
	//**************************************************************************//
	//					Default Form/View Methods								//
	//**************************************************************************//
	function SetDefaultViewAndForm()
	{
		//GrooveDebugFunctions.DisplayAssert(0, "Break");
		var DefaultViewID = "";
		if (PropertyList.PropertyExists("GrooveForms_DefaultView"))
			DefaultViewID = PropertyList.OpenProperty("GrooveForms_DefaultView");

		SetDefaultLabelOnDefaultView(DefaultViewID);

		var DefaultFormID = "";
		if (PropertyList.PropertyExists("GrooveForms_DefaultForm"))
			DefaultFormID = PropertyList.OpenProperty("GrooveForms_DefaultForm");

		SetDefaultLabelOnDefaultForm(DefaultFormID);
	}
	
	function SetDefaultLabelOnDefaultView(i_ViewID)
	{
		if (g_IsImporting || g_CurrentState == "HomePage")
			return;

		var DbViewID = GetSandboxViewIDFromDatabaseViewID(i_ViewID);
		if (DbViewID == null)
			DbViewID = GetSandboxObjectIDFromLogForDatabaseObjectID(i_ViewID);
		var i = 0;
		var iCount = ViewsFormsListView.Count;
		while (i < iCount)
		{
			if (ViewsFormsListView.GetItemText(i, 1).indexOf("Data List") >=0) 
			{
				if (ViewsFormsListView.GetItemData(i) == DbViewID)
					ViewsFormsListView.SetItemText(i, 1, "Data List (Default)");
				else if (ViewsFormsListView.GetItemText(i, 1) == "Data List (Default)")
					ViewsFormsListView.SetItemText(i, 1, "Data List");
			}
			i++;
		}
	}

	function SetDefaultLabelOnDefaultForm(i_FormID)
	{
		if (g_IsImporting || g_CurrentState == "HomePage")
			return;

		var DbFormID = GetSandboxViewIDFromDatabaseViewID(i_FormID);
		if (DbFormID == null)
			DbFormID = GetSandboxObjectIDFromLogForDatabaseObjectID(i_FormID);

		if (DbFormID == null)
			DbFormID = g_CurrentFormID;

		var i = 0;
		var iCount = ViewsFormsListView.Count;
		while (i < iCount)
		{
			if (ViewsFormsListView.GetItemText(i, 1).indexOf("Form") >=0) 
			{
				if (ViewsFormsListView.GetItemData(i) == DbFormID)
					ViewsFormsListView.SetItemText(i, 1, "Form (Default)");
				else if (ViewsFormsListView.GetItemText(i, 1) == "Form (Default)")
					ViewsFormsListView.SetItemText(i, 1, "Form");
			}
			i++;
		}
	}

	//**************************************************************************//
	//				End	Default Form/View Methods								//
	//**************************************************************************//
	
	//**************************************************************************//
	//					ListView Sink Methods									//
	//**************************************************************************//

	function ViewsFormsListView_OnListViewItemActivated(i_Name, i_Index)
	{
		g_pWindowsManager.ShowWaitCursor(true);
		g_pWindowsManager.RestoreWaitCursor();
		g_pDesigner.ModifyViewForm(true);
		g_pWindowsManager.ShowWaitCursor(false);
	}

	function FormFieldsListView_OnListViewCheckChanged(i_Name, i_Index, i_Checked)
	{
		g_pDesigner.FormFieldsCheckChanged(i_Name, i_Index, i_Checked);
	}

	function FormFieldsListView_OnListViewSelectionChanged(i_Name, i_Index, i_Selected)
	{
		g_pDesigner.FormFieldsSelectionChanged(i_Name, i_Index, i_Selected);
	}

	function FormFieldsListView_OnListViewItemActivated(i_Name, i_Item)
	{
		g_pDesigner.FormFieldsItemActivated(i_Name, i_Item);
	}

	function ExportDataAndDesignButton_OnCommand(i_UICommand)
	{
		LoadDesignerScript();
		g_pDesigner.ExportDatabaseToTemplate();
		ExportData(0);
	}
	
	function ExportDataAndDesignButton_OnUpdateCommandState(i_UICommand)
	{
		if (GetCurrentDatabaseName() == null)
			ExportDataAndDesignButton.Enabled = false;
		else
			ExportDataAndDesignButton.Enabled = true;
	}

	//**************************************************************************//
	//					End ListView Sink Methods								//
	//**************************************************************************//
	
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 @           ˝     ˛      ˇ         ‡     Ä	                 √     `Ö `Ö                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   o   ÄName   G r o o v e F o r m s . g s l         ÄSCRIPTMODULE     ÄSCRIPT   
  ÄIMPLEMENTS   
  ÄIMPLEMENTS	   
  ÄIMPLEMENTS   
  ÄIMPLEMENTS   
  ÄIMPLEMENTS       ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT  MPLEME  ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n   r     m s H e             ◊  
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }       ÄIIDL   { D B 8 2 1 8 2 2 - 5 C 7 6 - 4 2 1 5 - A 5 B 4 - 4 0 8 D 2 9 F 9 C 5 5 2 }           ÄSCRIPT   - 4 2   ÄSCRIPT         º  Ä
			function OnCommand(i_UICommand)
			{
				ExecuteMenuCommand(i_UICommand);
			}

			function OnUpdateCommandState(i_UICommand)
			{
				UpdateMenuCommand(i_UICommand);
			}
		_
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }       ÄIIDL   { C 6 8 0 0 A 8 4 - 8 7 3 D - 4 1 B 5 - A 3 D 9 - 6 8 3 6 F D B 9 1 E 7 D }           ÄSCRIPT
   D 9 -   ÄSCRIPT	         â Ä
			function OnCommand2(i_pUICommandContainer2, i_UICommand)
			{
				ExecuteMenuCommand(i_UICommand);
			}

			function OnUpdateCommandState2(i_pUICommandContainer2, i_UICommand)
			{
				UpdateContainerItems(i_pUICommandContainer2, i_UICommand);
			}

			function OnUpdateContainerState2(i_pIUICommandContainer2)
			{
				UpdateContainerState(i_pIUICommandContainer2);
			}
		ntai
  ÄIMPLEMENTS       ÄLIBIDL   { 1 7 5 7 B A F 1 - 1 6 3 2 - 1 1 d 5 - 8 0 D D - 0 0 5 0 D A 1 C 0 4 B 5 }       ÄIIDL   { 1 7 5 7 B A F 7 - 1 6 3 2 - 1 1 d 5 - 8 0 D D - 0 0 5 0 D A 1 C 0 4 B 5 }           ÄSCRIPT   A 1 C   ÄSCRIPT         + Ä
			function OnRoleChanged(i_ScopeURL, i_ObjectID, i_ChildType, i_RoleName, i_MemberContactURLOrParentRoleName, i_ChangeType)
			{
				// Refresh screen
				if (typeof UICommandContainer != "undefined" && UICommandContainer!= null)
				{
					HideUICommands();
					if(g_CurrentState == "HomePage")
						ShowUICommands(true);
					else
					{
						ShowUICommands(false);
						PostEvent(123546, 0);
					}
				}

				// Clear the create and delete caches as the users role has changed.
				ClearPermissionCaches();
				// Enable or disable edit and delete buttons depending on children.
				EnableEditDeleteButtons();
				// If user is looking at the home page, reload to get forms manager buttons.
				if (g_CurrentState == "HomePage")
				{
					try
					{
						if (WebBrowserView.window != null)
						{
							if (WebBrowserView.window.location.href.indexOf("FormsHomePage.html") >= 0)
								WebBrowserView.window.location.reload(true);
							else if(typeof WebBrowserView.window.roleChanged != "undefined")
							{
								// If the user is looking at a form - call the following function
								// so that the page can change the display appropriately.
								WebBrowserView.window.roleChanged();
							}
						}
					}
					catch(error)
					{
					}
				}
			}
		
	
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }       ÄIIDL   { 5 1 B F 8 1 E 1 - 6 D E 7 - 1 1 D 2 - 9 4 6 1 - 0 0 8 0 C 7 D E 3 2 C 6 }           ÄSCRIPT             ÄS
  ÄIMPLEMENTS       ÄLIBIDL   { F 0 2 2 E 9 5 5 - 5 6 2 6 - 1 1 D 1 - A C 2 9 - 0 0 5 2 4 5 0 0 0 0 0 0 }       ÄIIDL   { F 3 5 3 C A 6 B - 0 9 9 E - 4 4 5 b - 9 1 4 F - 8 C D 3 B 9 9 9 4 B 4 A }           ÄSCRIPT                                 @·            »·    $F   ∞·    ‹§   h·    ¸◊    à·            ~    ƒ i   § :               )            ÄSCRIPT         ú- Ä
			var g_FORMS_TEMPLATE_FILTER = "Forms Database Template (*.fdt)|*.fdt||";
			var g_FORMS_XML_FILTER = "XML File (*.xml)|*.xml||";
			var g_FORMS_TABULAR_FILTER = "Tabular Text Files (*.txt)|*.txt||";
			var g_FORMS_STRUCTURED_FILTER = "Structured Text Files (*.stx)|*.stx||";
			var g_FORMS_SCRIPT_FILTER = "Script Files (*.js;*.vbs)|*.js;*.vbs||";
			var g_FORMS_HTML_FILTER = "HTML Files (*.htm;*.html)|*.htm;*.html||";
			var g_FORMS_DEPENDENT_FILTER = "All Files (*.*)|*.*||";
			var g_FORMS_XML_EXTENSION = ".xml";
			var g_FORMS_TABULAR_EXTENSION = ".txt";
			var g_FORMS_STRUCTURED_EXTENSION = ".stx";

			var g_FORMS_ADD_ATTACHMENTS = "Add Attachments...";
			var g_FORMS_ADD_ATTACHMENTS_FILTER = "All Files (*.*)|*.*||";

			//Command Bar strings
			var FORMS_TOOL_CREATE_FORM_URL			= "GUIC_FormsTool_CreateForm";
			var FORMS_TOOL_CREATE_VIEW_URL			= "GUIC_FormsTool_CreateView";
			var FORMS_TOOL_IMPORT_TEMPLATE_URL		= "GUIC_FormsTool_ImportTemplate";
			var FORMS_TOOL_EXPORT_TEMPLATE_URL		= "GUIC_FormsTool_ExportTemplate";
			var FORMS_TOOL_HOMEPAGE					= "GUIC_FormsTool_HomePage";
			var FORMS_TOOL_APPLY_SANDBOX			= "GUIC_FormsTool_ApplySandbox";
			var FORMS_TOOL_CANCEL_SANDBOX			= "GUIC_FormsTool_CancelSandbox";
			var FORMS_TOOL_SEP1						= "GUIC_FormsTool_Sep1";
			var FORMS_TOOL_SEP2						= "GUIC_FormsTool_Sep2";
			var FORMS_TOOL_SEP3						= "GUIC_FormsTool_Sep3";
			var FORMS_TOOL_SEP4						= "GUIC_FormsTool_Sep4";
			var FORMS_TOOL_CUT						= "GUIC_FormsTool_Cut";
			var FORMS_TOOL_COPY						= "GUIC_FormsTool_Copy";
			var FORMS_TOOL_PASTE					= "GUIC_FormsTool_Paste";
			var FORMS_TOOL_PREVIOUS_UNREAD			= "GUIC_FormsTool_PreviousUnread";
			var FORMS_TOOL_NEXT_UNREAD				= "GUIC_FormsTool_NextUnread";
			var FORMS_TOOL_EXPAND					= "GUIC_FormsTool_Expand";
			var FORMS_TOOL_COLLAPSE					= "GUIC_FormsTool_Collapse";
			// Form menu urls
			var FORMS_TOOL_FORM_MENU				= "GUIC_FormsTool_FormMenu";
			var FORMS_TOOL_FORM_LIST				= "GUIC_FormsTool_FormList";
			var FORMS_TOOL_FORM_LIST_SEP			= "GUIC_FormsTool_FormListSep";
			// View menu urls
			var FORMS_TOOL_VIEW_MENU				= "GUIC_FormsTool_ViewMenu";
			var FORMS_TOOL_VIEW_LIST				= "GUIC_FormsTool_ViewList";
			var FORMS_TOOL_VIEW_LIST_SEP			= "GUIC_FormsTool_ViewListSep";
			// Search menu urls
			var FORMS_TOOL_SEARCH_MENU				= "GUIC_FormsTool_SearchMenu";
			var FORMS_TOOL_SEARCH					= "GUIC_FormsTool_Search";
			// Manager menu urls
			var FORMS_TOOL_MANAGER_MENU				= "GUIC_FormsTool_ManagerMenu";
			var FORMS_TOOL_CREATE_NEW_FORM			= "GUIC_FormsTool_CreateNewForm";
			var FORMS_TOOL_EDIT_FORM_MENU			= "GUIC_FormsTool_EditFormMenu";
			var FORMS_TOOL_EDIT_FORM_LIST			= "GUIC_FormsTool_EditFormList";
			var FORMS_TOOL_MANAGER_MENU_SEP1		= "GUIC_FormsTool_ManagerMenuSep1";
			var FORMS_TOOL_CREATE_NEW_VIEW			= "GUIC_FormsTool_CreateNewView";
			var FORMS_TOOL_EDIT_VIEW_MENU			= "GUIC_FormsTool_EditViewMenu";
			var FORMS_TOOL_EDIT_VIEW_LIST			= "GUIC_FormsTool_EditViewList";
			var FORMS_TOOL_MANAGER_MENU_SEP2		= "GUIC_FormsTool_ManagerMenuSep2";
			var FORMS_TOOL_OPEN_MANAGER				= "GUIC_FormsTool_OpenManager";
			var FORMS_TOOL_MANAGER_MENU_SEP3		= "GUIC_FormsTool_ManagerMenuSep3";
			var FORMS_TOOL_SHOW_PERMISSIONS			= "GUIC_FormsTool_ShowPermissions";

			var FORMS_TOOL_CREATE_FORM_LABEL		= "New Form";
			var FORMS_TOOL_CREATE_VIEW_LABEL		= "New View";
			var FORMS_TOOL_IMPORT_TEMPLATE_LABEL	= "Import";
			var FORMS_TOOL_EXPORT_TEMPLATE_LABEL	= "Export";
			var FORMS_TOOL_OPEN_FORMS_MGR_LABEL		= "Open Forms Manager";
			var FORMS_TOOL_OPEN_HOME_PG_LABEL		= "Open Home Page";
			var FORMS_TOOL_FORM_MENU_LABEL			= "Add Record";
			var FORMS_TOOL_VIEW_MENU_LABEL			= "View by";
			var FORMS_TOOL_CLEAR_SEARCH_LABEL		= "Clear Search Results";
			var FORMS_TOOL_HOMEPAGE_LABEL			= "Go to Data View";
			var FORMS_TOOL_APPLY_SANDBOX_LABEL		= "Save to Groove";
			var FORMS_TOOL_CANCEL_SANDBOX_LABEL		= "Discard Changes";
			var FORMS_TOOL_MANAGER_LABEL			= "          Forms Manager";
			var FORMS_TOOL_CREATE_NEW_FORM_LABEL	= "Create Form...";
			var FORMS_TOOL_EDIT_FORM_MENU_LABEL		= "Modify Form";
			var FORMS_TOOL_CREATE_NEW_VIEW_LABEL	= "Create View...";
			var FORMS_TOOL_EDIT_VIEW_MENU_LABEL		= "Modify View";
			var FORMS_TOOL_OPEN_MANAGER_LABEL		= "Open Forms Manager...";
			var FORMS_TOOL_SHOW_PERMISSIONS_LABEL	= "Forms Record Permissions...";

			var FORMS_TOOL_CREATE_FORM_TOOLTIP		= "Create a form.";
			var FORMS_TOOL_CREATE_VIEW_TOOLTIP		= "Create a view.";
			var FORMS_TOOL_IMPORT_TEMPLATE_TOOLTIP	= "Import a set of forms and views from a template.";
			var FORMS_TOOL_EXPORT_TEMPLATE_TOOLTIP	= "Export the views and forms defined to a template.";
			var FORMS_TOOL_OPEN_FORMS_MGR_TOOLTIP	= "Open the Forms Manager.";
			var FORMS_TOOL_OPEN_HOME_PG_TOOLTIP		= "Open the forms tool Home Page.";
			var FORMS_TOOL_FORM_MENU_TOOLTIP		= "Add a new record";
			var FORMS_TOOL_VIEW_MENU_TOOLTIP		= "Select a different data list";
			var FORMS_TOOL_SEARCH_MENU_TOOLTIP		= "Search and display records that match the criteria you specify";
			var FORMS_TOOL_SEARCH_TOOLTIP			= "Search and display records that match the criteria you specify";
			var FORMS_TOOL_MANAGER_TOOLTIP			= "Create or modify forms and views";
			var FORMS_TOOL_HOMEPAGE_TOOLTIP			= "Go to the data view";
			var FORMS_TOOL_APPLY_SANDBOX_TOOLTIP	= "Save all changes to Groove and go to the data view";
			var FORMS_TOOL_CANCEL_SANDBOX_TOOLTIP	= "Discard all changes and go to the data view";
			var FORMS_TOOL_CUT_TOOLTIP				= "Cut (Ctrl+X)";
			var FORMS_TOOL_COPY_TOOLTIP				= "Copy (Ctrl+C)";
			var FORMS_TOOL_PASTE_TOOLTIP			= "Paste (Ctrl+V)";
			var FORMS_TOOL_PREVIOUS_UNREAD_TOOLTIP	= "Previous unread (Shift+F4)";
			var FORMS_TOOL_NEXT_UNREAD_TOOLTIP		= "Next Unread (F4)";
			var FORMS_TOOL_EXPAND_TOOLTIP			= "Expand all";
			var FORMS_TOOL_COLLAPSE_TOOLTIP			= "Collapse all";

			var FORMS_TOOL_DELETE_FIELD				= "Deleting this field will delete it from all forms and views. Do you want to continue?";
			var FORMS_TOOL_DELETE_FIELD_TITLE		= "Delete Field?";

			var FORMS_TOOL_DELETE_VIEW_OR_FORM		= "Deleting a form or view cannot be undone.  Do you want to continue?";
			var FORMS_TOOL_DELETE_VIEW_OR_FORM_TITLE= "Delete Form/View?";

			var FORMS_TOOL_DIRTY_SAVE				= "Do you want to save your changes?";
			var FORMS_TOOL_DIRTY_SAVE_TITLE			= "Save Changes?";

			var FORMS_TOOL_PREVIEW_FORM				= "Do you want to save your changes so preview can show your modifications?";
			var FORMS_TOOL_PREVIEW_FORM_TITLE		= "Save for Preview?"

			var FORMS_TOOL_MGR_WARNING				= "You must be online to create a new Forms application. Groove needs to synchronize with other members in the space."
			var FORMS_TOOL_MGR_WARNING_TITLE		= "Connection Status Warning"

			//File New
			var FT_MENU_FILE_NEW_FORM				= "FT_MENU_NewForm";
			var FT_MENU_FILE_NEW_VIEW				= "FT_MENU_NewView";
			
			//File
			var FT_MENU_FILE_ADD_ENTRY_MENU			= "FT_MENU_AddEntry";
			var FT_MENU_FILE_OPEN_ENTRY				= "FT_MENU_OpenEntry";
			var FT_MENU_FILE_SEP1					= "FT_MENU_FileSep1";
			var FT_MENU_FILE_PUBLISH_MOD			= "FT_MENU_PublishMod";
			var FT_MENU_FILE_DISCARD_MOD			= "FT_MENU_DiscardMod";
			var FT_MENU_FILE_SEP2					= "FT_MENU_FileSep2";
			var FT_MENU_FILE_CREATE_TEMPLATE		= "FT_MENU_CreateTemplate";
			var FT_MENU_FILE_SEP3					= "FT_MENU_FileSep3";
			var FT_MENU_FILE_IMPORT					= "FT_MENU_Import";
			var FT_MENU_FILE_EXPORT_MENU			= "FT_MENU_Export";
			var FT_MENU_FILE_EXPORT_BIN				= "FT_MENU_Binary";
			var FT_MENU_FILE_EXPORT_TAB				= "FT_MENU_Tabular";
			var FT_MENU_FILE_EXPORT_STRUCT			= "FT_MENU_Structured";
			var FT_MENU_FILE_EXPORT_XML				= "FT_MENU_XML";
			var FT_MENU_FILE_SEP4					= "FT_MENU_FileSep4";
			var FT_MENU_FILE_PRINT					= "FT_MENU_Print";

			//Edit Undo/Redo
			var FT_MENU_EDIT_UNDO					= "FT_MENU_Undo";
			var FT_MENU_EDIT_REDO					= "FT_MENU_Redo";
			
			// Edit Clipboard
			var FT_MENU_EDIT_CLIP_CUT				= "FT_MENU_Cut";
			var FT_MENU_ED      Ë   IT_CLIP_COPY				= "FT_MENU_Copy";
			var FT_MENU_EDIT_CLIP_PASTE				= "FT_MENU_Paste";

			// Edit Link
			var FT_MENU_EDIT_LINK_COPY_AS_LINK		= "FT_MENU_CopyAsLink";
			
			// Edit	
			var FT_MENU_EDIT_DELETE					= "FT_MENU_Delete";
			var FT_MENU_EDIT_SEP1					= "FT_MENU_EditSep1";
			var FT_MENU_EDIT_SEARCH					= "FT_MENU_Search";
			var FT_MENU_EDIT_SEP2					= "FT_MENU_EditSep2";
			var FT_MENU_EDIT_MARK_ALL_READ			= "FT_MENU_Mark_All_Read";
			var FT_MENU_EDIT_MARK_ALL_UNREAD		= "FT_MENU_Mark_All_UnRead";
			var FT_MENU_EDIT_MARK_SELECTED_UNREAD	= "FT_MENU_Mark_Selected_UnRead";
			var FT_MENU_EDIT_MARK_SELECTED_READ		= "FT_MENU_Mark_Selected_Read";

			// Edit Undo/Redo
			var FT_MENU_EDITUNDOREDO_UNDO			= "FT_MENU_Undo";
			var FT_MENU_EDITUNDOREDO_REDO			= "FT_MENU_Redo";

			// View
			var FT_MENU_VIEW_GO_TO					= "FT_MENU_GoTo";
			var FT_MENU_VIEW_SEP1					= "FT_MENU_VIEW_SEP1";
			var FT_MENU_VIEW_EXPAND_ALL				= "FT_MENU_ExpandAll";
			var FT_MENU_VIEW_COLLAPSE_ALL			= "FT_MENU_CollapseAll";
			var FT_MENU_VIEW_SEP2					= "FT_MENU_VIEW_SEP2";
			var FT_MENU_VIEW_NEXT					= "FT_MENU_Next";
			var FT_MENU_VIEW_PREVIOUS				= "FT_MENU_Previous";
			var FT_MENU_VIEW_NEXT_UNREAD			= "FT_MENU_Next_Unread";
			var FT_MENU_VIEW_PREVIOUS_UNREAD		= "FT_MENU_Previous_Unread";
			var FT_MENU_VIEW_SEP3					= "FT_MENU_VIEW_SEP3";
			var FT_MENU_VIEW_VIEW_BY_MENU			= "FT_MENU_ViewBy";
			
			// ************** Menu Labels **************************
			var FT_MENU_LABEL_NEW_FORM					= "&Form...";
			var FT_MENU_LABEL_NEW_VIEW					= "&View...";

			var FT_MENU_LABEL_ADD_ENTRY					= "&Add Record";
			var FT_MENU_LABEL_OPEN_ENTRY				= "&Open Record\tEnter";
			var FT_MENU_LABEL_PUBLISH_MOD				= "Sa&ve to Groove";
			var FT_MENU_LABEL_DISCARD_MOD				= "Discard &Modification";
			var FT_MENU_LABEL_CREATE_TEMPLATE			= "&Create Template...";
			var FT_MENU_LABEL_IMPORT					= "Im&port...";
			var FT_MENU_LABEL_USE_TEMPLATE				= "Use Temp&late...";
			var FT_MENU_LABEL_EXPORT					= "&Export All Entries";
			var FT_MENU_LABEL_EXPORT_BIN				= "&Binary XML...";
			var FT_MENU_LABEL_EXPORT_TAB				= "&Tabular Text...";
			var FT_MENU_LABEL_EXPORT_STRUCT				= "&Structured Text...";
			var FT_MENU_LABEL_EXPORT_XML				= "&XML (without attachments)...";
			var FT_MENU_LABEL_PRINT						= "P&rint...";

			var FT_MENU_LABEL_CLIP_CUT					= "Cu&t\tCtrl+X";
			var FT_MENU_LABEL_CLIP_COPY					= "&Copy\tCtrl+C";
			var FT_MENU_LABEL_CLIP_PASTE				= "&Paste\tCtrl+V";

			var FT_MENU_LABEL_LINK_COPY_AS_LINK			= "Copy Entry as &Link\tCtrl+L";

			var FT_MENU_LABEL_DELETE					= "&Delete\tDel";
			var FT_MENU_LABEL_SEARCH					= "Se&arch...";

			var FT_MENU_LABEL_MARK_TOOL					= "&Tool";
			var FT_MENU_LABEL_MARK_SELECTED				= "&Selected";

			var FT_MENU_LABEL_UNDO						= "&Undo\tCtrl+Z";
			var FT_MENU_LABEL_REDO						= "&Redo\tCtrl+Y";

			var FT_MENU_LABEL_EXPAND_ALL				= "Ex&pand All";
			var FT_MENU_LABEL_COLLAPSE_ALL				= "Co&llapse All";
			var FT_MENU_LABEL_NEXT_ENTRY				= "Next &Entry\tF8";
			var FT_MENU_LABEL_PREVIOUS_ENTRY			= "P&revious Entry\tShift+F8";
			var FT_MENU_LABEL_NEXT_UNREAD				= "Next &Unread\tF4";
			var FT_MENU_LABEL_PREVIOUS_UNREAD			= "P&revious Unread\tShift+F4";
			var FT_MENU_LABEL_GOTO_DV					= "Go To &Data View";
			var FT_MENU_LABEL_GOTO_FM					= "Go To &Forms Manager";
			var	FT_MENU_VIEW_LABEL_VIEW_BY				= "&View by";

			var g_MSIEVersion = GetMSIEVersion();
			var CURRENT_FORMS_VERSION = "2.5";
		   ÄSCRIPT          Ä
        function OnEvent(i_EventID)
        {
			if (i_EventID == 32365 && g_CurrentState == "HomePage")
				UnloadDesignerScript();
			else if (i_EventID == 110531)
				ShowNotification();
			else if (i_EventID == 81265)
				SetDefaultViewAndForm();
		}
		                                                                                                                                                                                                                                         Ü'    ◊     à	    ÄSCRIPT         L Ä
			function OnNavigate(i_pIURLNavigator, i_URL, i_bAddToHistory)
			{
				return;
				try
				{
					var pURL = GROOVE_GLOBAL_MISC_POINTER.OpenURI(i_URL);
					if (pURL.DoesQueryPartExist("RecordID"))
					{
						if ((g_MSIEVersion.MajorVersion < 5) || (g_MSIEVersion.MajorVersion == 5 && g_MSIEVersion.MinorVersion == 0))
						{
							LoadHomePage();
							return;
						}
						else
						{
							// Get the record id from the passed in URL.
							var RecordID = pURL.OpenQueryPart("RecordID");

							var ToolDelegate = LoadCurrentToolDelegate(GetCurrentDatabaseName(), OpenDatabaseByName(g_pIFormsToolDataModel, GetCurrentDatabaseName()), g_Telespace, g_pIFormsToolDataModel);
							if (typeof ToolDelegate == "object")
							{
								var FormRecord = ToolDelegate.OpenRecordByID(RecordID);
								if (FormRecord)
								{
									// Set global variable that will be read in LoadHomePage.
									g_BrowseToRecordID = RecordID;
									LoadHomePage();
								}
								else
								{
									// Show error if record id is not in the record set.
									ThrowError("Cannot find the specified entry. The entry may have been deleted.");
								}
							}
						}
					}

					// Pass the URL on in case other components are going to read it.
					var Telespace = g_Telespace;
					var Tool = PropertyList.OpenProperty(PROPERTY_TOOL);
					var Name = Tool.DisplayName;
					i_pIURLNavigator.SetCurrentURL(i_URL, Telespace.DisplayName + " - " + Name, Name, i_bAddToHistory);
				}
				catch (error)
				{
					DisplayError(error);
				}
			}
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Äg     ÄSCRIPT         w‡ Ä
			//MetaData Content enum
			var GrooveMetaData_String = 0;
			var GrooveMetaData_Element = 1;
			var GrooveMetaData_ContainedBy = 2;
			var GrooveMetaData_PropertyListElement = 3;
			var GrooveMetaData_ObjectType = 4;
			var GrooveMetaData_ContentElement = 5;
			var GrooveMetaData_RawEntry = 6;

			function OpenCacheFromRunTimeData(i_pRunTimeData, i_CacheName)
			{
				var pCache = null;
				if (i_CacheName == "" || i_CacheName == null)
					i_CacheName = "_ObjectCache";
				i_pRunTimeData.LockData();
				try
				{
					if (i_pRunTimeData.LockedHasItem(i_CacheName))
						pCache = i_pRunTimeData.LockedGetItem(i_CacheName);
					else
					{
						pCache = GrooveScriptFunctions.OpenSharedObjectTable("");
						i_pRunTimeData.LockedSetItem(i_CacheName, pCache);
					}
				}
				catch (error)
				{
				}
				i_pRunTimeData.UnlockData();
				return pCache;
			}
						
			function AddObjectToCache(i_Key, i_pObject, i_pCache)
			{
				i_pCache.SetItem(i_Key, i_pObject);
			}

			function IsObjectInCache(i_Key, i_pCache)
			{
				return i_pCache.HasItem(i_Key);
			}

			function OpenObjectFromCache(i_Key, i_pCache)
			{
				return i_pCache.GetItem(i_Key);
			}

			function RemoveObjectFromCache(i_Key, i_pCache)
			{
				if (IsObjectInCache(i_Key, i_pCache))
				{
					i_pCache.RemoveItem(i_Key);
				}
			}

			function ShutdownCache(i_pCache, i_Callback)
			{
				i_pCache.LockData();
				try
				{
					if (i_Callback)
					{
						var pEntryEnum = i_pCache.LockedCreateNameValueEnum();
						while (pEntryEnum.HasMore())
						{
							var pEntry = pEntryEnum.OpenNextPair();
							i_Callback(pEntry.First, pEntry.Second);
						}
					}
					pEntryEnum = null;
					delete pEntryEnum;
					CollectGarbarge();
					i_pCache.LockedRemoveAllItems();
				}
				catch(error)
				{
					i_pCache.LockedRemoveAllItems();
				}

				i_pCache.UnlockData();
			}

			function CreateValidXMLName(i_Name)
			{
				var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
				var ValidXMLName = pXMLSyntax.ConvertToXMLName(i_Name);
				return ValidXMLName;
			}

			function ConvertToOriginalName(i_XMLName)
			{
				var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
				var OriginalName = pXMLSyntax.ConvertFromXMLName(i_XMLName);
				return OriginalName;
			}

			function GetMetaDataContentElement(i_MetaDataName, i_MetaDataTable)
			{			
				/*
				var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
				var PRootPath = pStorageURISyntax.InstallDataRootPath;

				var pMemoryMappedFileStore = CreateMemoryMappedFileByteStore(-1, PRootPath+"\\ToolData\\groove.net\\GrooveForms\\GrooveFormsMetaData.xml");
				var pByteInputStream = pMemoryMappedFileStore.OpenByteInputStream();

				var sm = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				pMetaDataDocument = sm.CreateTemporaryXMLDocument("MetaData");
				var pMetaDataDocRootElement = pMetaDataDocument.OpenRootElement();
				pMetaDataDocRootElement.Delete();

				var pNewRootElement = pMetaDataDocument.CreateElementFromStream(pByteInputStream, GrooveParseOption_Default | GrooveParseOption_StripContentWhitespace);
				pByteInputStream.Close();

				pMetaDataDocument.SetRootElement(pNewRootElement);
				var pMetaDataDocRootElement = pMetaDataDocument.OpenRootElement();

				var pLocator = pMetaDataDocument.CreateLocator();
				var strLocatorString = ".//urn:groove.net:XMLDescription[@Name='"+ i_MetaDataName +"']";
				var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pMetaDataDocRootElement);
				while (pElementEnum.HasMore())
				{
					var pElement = pElementEnum.OpenNext();
					var pXMLElement = pElement.OpenContentElementByName("urn:groove.net:XML");
					var OSDContentElement = pXMLElement.OpenContentElement(0);
					return OSDContentElement;
				}
				*/
				var MetaDataTable = i_MetaDataTable;
				if (MetaDataTable != null)
				{
					if (MetaDataTable.HasItem(i_MetaDataName))
					{
						var MDObject = MetaDataTable.GetItem(i_MetaDataName);
						return MDObject.ContentElement;
					}
					else
						return null;
				}
				else
					return null;
			}

			function ReplaceSchema(i_TelespaceGUID, i_ToolName, i_Name, i_BIS)
			{
				
				var ValidXMLName = CreateValidXMLName(i_TelespaceGUID + "_" + i_ToolName + "_" + i_Name);

				var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
				var PRootPath = pStorageURISyntax.UserRootPath;
				var strPath = PRootPath+"schemas.xss";		
				var dbURI = "groovedatabase:///groovexss/" + strPath;
				var sm = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				var schemasdb = sm.OpenDatabase(dbURI);
				if (schemasdb.DocumentExists(ValidXMLName))
				{
					var SchemaDocument = schemasdb.OpenXMLDocument(ValidXMLName);
					SchemaDocument.SetDeleteOnRelease();
					SchemaDocument = null;
					delete SchemaDocument;
					CollectGarbage();
				}
				schemasdb.CreateXMLDocumentFromStream(i_BIS, GrooveParseOption_Default | GrooveParseOption_StripContentWhitespace, ValidXMLName);
				
				return true;
				
			}

			function ManifestToolHelper(i_DatabaseName, i_TelespaceGUID, i_ToolName, i_pIGrooveFormsToolDataModel, i_Telespace, i_MetaDataTable, PropertyList, ToolComponentResourceURL)
			{
				var UniqueName = "." + i_TelespaceGUID + "." + CreateValidXMLName(i_ToolName) + "." + CreateValidXMLName(i_DatabaseName);
				
				var cNull = GrooveScriptFunctions.CreateNewObject("");
				var OSDBaseElement = GetMetaDataContentElement("OSDBase", i_MetaDataTable);
				var DocElement = OSDBaseElement.CreateElementCopy(OSDBaseElement, cNull);
				if (!DocElement.ContentElementWithNameExists("SOFTPKG"))
					return;
				var OSDElement = DocElement.OpenContentElementByName("SOFTPKG");
				
				var VersionString = OSDElement.OpenAttribute("VERSION");
				// NameAttributeValue = "net.groove.Groove.Forms"
				NameAttributeValue = OSDElement.OpenAttribute("NAME");
				OSDElement.SetAttribute("NAME", NameAttributeValue + UniqueName);

				if (OSDElement.ContentElementWithNameExists("TITLE"))
				{
					var TitleElement = OSDElement.OpenContentElementByName("TITLE");
					TitleElement.SetContent(0, i_DatabaseName + "Tool");
				}

				if (OSDElement.ContentElementWithNameExists("IMPLEMENTATION"))
				{
					var ImplementationElement = OSDElement.OpenContentElementByName("IMPLEMENTATION");
					if (ImplementationElement.ContentElementWithNameExists("urn:groove.net:Factory"))
					{
						var FactoryElement = ImplementationElement.OpenContentElementByName("urn:groove.net:Factory");
						var pDatabase = i_pIGrooveFormsToolDataModel.OpenDatabaseByFullName(i_DatabaseName);
						if (pDatabase.DoesDatabaseObjectExistByFullName(i_DatabaseName + ".tpl"))
						{
							var pFormsDatabaseObject = pDatabase.OpenDatabaseObjectByFullName(i_DatabaseName + ".tpl");
							var BindableURL = pFormsDatabaseObject.BindableURL;
							var pTelespaceURLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.TelespaceURLSyntax");
							var TelespaceRelativeURL = pTelespaceURLSyntax.RelativePartFromURL(BindableURL);

							FactoryElement.SetAttribute("BindableURL", TelespaceRelativeURL);
							var cNull = GrooveScriptFunctions.CreateNewObject("");
							var pCM = GrooveScriptFunctions.CreateNewObject("Groove.ComponentManager");
							pCM.ManifestComponent(DocElement, cNull, i_Telespace.DisplayName, i_Telespace.OpenBindableURL());
							OSDElement.Delete();
							return true;
						}
					}
				}

				return false;
			}

			function ManifestTool(DatabaseName, i_TelespaceGUID, i_ToolName, i_ParentFolderID, PropertyList, i_pIGrooveFormsToolDataModel, i_MetaDataTable)
			{
				// we need to add the osd and get it manifested for a new template.
				var pCM = GrooveScriptFunctions.CreateNewObject("Groove.ComponentManager");
				var sp = i_pIGrooveFormsToolDataModel.OpenSOFTPKGName(DatabaseName);
				var ToolComponentResourceURL = "http:///"+sp+"?Package="+sp+"&Version=1&Factory=Open";
				PropertyList.SetProperty(ToolComponentResourceURL, DatabaseName, GroovePropertyFlag_Private);
				if (pCM.IsComponentInstalled(ToolComponentResourceURL))
					return false;

				return ManifestToolHelper(DatabaseName, i_TelespaceGUID, i_ToolName, i_pIGrooveFormsToolDataModel, PropertyList.OpenProperty(PROPERTY_TELESPACE), i_MetaDataTable, PropertyList, ToolComponentResourceURL);
			}
			
			function InitializeToolsAndSchemas(i_TelespaceGUID, i_ToolName, DocumentShareEngine, PropertyList, i_pIGrooveFormsToolDataModel, i_MetaDataTable)
			{
				// For each database, find the tool and manifest it.  
				// Also, for each database, find the schema and create a new one, then replace it with the 
				// contents of the existing one.
				var pEngineData = DocumentShareEngine.Data;
				var bWasManifested = false;
				var pDynMgr = PropertyList.OpenPropertyAsIUnknown(PROPERTY_DYNAMICS_MANAGER);
				var Delta = pDynMgr.OpenDelta("", false);
				Delta.AdvancedDelta2.LocalOnly = true;
				Delta.Begin();
				try
				{
					//GrooveDebugFunctions.DisplayAssert(0, "InitializeTools");
					// First get the names and ids of all of the databases
					var pSSEnum = i_pIGrooveFormsToolDataModel.CreateDatabaseNameAndIDEnum();
					while (pSSEnum.HasMore())
					{
						var SSPair = pSSEnum.OpenNextPair();
						var DbName = SSPair.First;
						var DbID = SSPair.Second;
						// For each db, get the corresponding tool file; if it exists
						// manifest it
						if (pEngineData.DoesFileExistInFolderByFullName(DbID, DbName + ".tpl"))
							bWasManifested = ManifestTool(DbName, i_TelespaceGUID, i_ToolName, DbID, PropertyList, i_pIGrooveFormsToolDataModel, i_MetaDataTable);

						// Next check for the schema file and make sure to create one if it doesn't exist.
						if (!pEngineData.DoesFileExistInFolderByFullName(DbID, DbName + ".xml"))
							continue;

						var Db = i_pIGrooveFormsToolDataModel.OpenDatabase(DbID);
						if (Db.DoesSchemaExist(DbName))
							continue;

						// We can call ReplaceSchema because it will create the document if one doesn't 
						// already exist.
						var DbObject = Db.OpenDatabaseObjectByFullName(DbName + ".xml");
						var BIS = DbObject.OpenByteInputStream();
						ReplaceSchema(i_TelespaceGUID, i_ToolName, DbName, BIS);
						BIS.Close();
					}
					pDynMgr.DoDelta(Delta);
					
					var DeserializeReason = PropertyList.OpenPropertyAsLong("_DeserializationReason");
					
					if (DeserializeReason == 0)
					{
						if (typeof Db != "undefined" && Db != null)
						{
							var sp = Db.SOFTPKGName;
							var pToolContainer = PropertyList.OpenProperty(PROPERTY_TOOL_CONTAINER);
							var PropertyExists = PropertyList.PropertyExists(sp);

							if ((bWasManifested && !PropertyExists) || 
								(!PropertyExists || (PropertyExists && !pToolContainer.DoesToolExist(PropertyList.OpenProperty(sp)))))
							{
								//GrooveDebugFunctions.DisplayAssert(0, "About to add tool");						
								var Delta = pDynMgr.CreateDelta();
								var ToolComponentResourceURL = "http:///"+sp+"?Package="+sp+"&Version=1&Factory=Open";
								var TCToolName = pToolContainer.AddFromTemplateURL(ToolComponentResourceURL, "", "", "Groove Forms Database Tool", "Custom");
								PropertyList.SetProperty("FormsDatabase_" + DbName + "_ToolName", TCToolName);
								PropertyList.SetProperty(sp, TCToolName);
								pDynMgr.DoDelta(Delta);
							}

  							if (PropertyList.PropertyExists(sp))
  							{
  								GrooveDebugFunctions.OutputString("\nChecking IsSerializeableAsTemplate\n\n");
  								var ToolName = PropertyList.OpenProperty(sp);
  								if (pToolContainer.DoesToolExist(ToolName))
  								{
  									var ToolDescriptor = pToolContainer.OpenToolDescriptor(ToolName);
  								}
  							}
						}
					}
				}
				catch(error)
				{
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					if (Delta)
						Delta.Abort();
				}
			}

			function CreateBinaryDocument(i_BIS, i_ID, i_Database)
			{
				var pDocument = i_Database.CreateBinaryDocumentFromStream(i_BIS, i_ID);
				var pURI = pDocument.OpenURI();
				var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
				var pBinaryDocURL = pStorageURISyntax.MakeRelative(pURI);
				return pBinaryDocURL;
			}

			function CreateGUID()
			{
				var pGuidGenerator = GROOVE_GLOBAL_MISC_POINTER.OpenGUIDGenerator();	
				var GUID = pGuidGenerator.CreateGUIDBase16();
				return GUID;
			}

			//RSSToDo: Need to figure out how to get the code which creates the tool, fields and schema
			// into the backend so that an url can be passed into createdatabase which will supply the 
			// tool with more stuff to add.
			function AddFramework(i_TelespaceGUID, i_ToolName, i_Telespace, i_Name, i_Type, i_pSandbox, i_SandboxObjectID, i_pIGrooveFormsToolDataModel, MetaDataTable)
			{
				if (i_Name == "")
					return;

				try
				{
					if (i_Type == "Database")
					{
						// We should create a database first
						var DatabaseName = i_Name;
						var DatabaseID = i_pIGrooveFormsToolDataModel.CreateNewDatabase(DatabaseName);
						if (DatabaseID == null)
							throw "Error creating database";
						return DatabaseID;
					}
					else if (i_Type == GrooveFormsDatabaseObjectType_View || i_Type == GrooveFormsDatabaseObjectType_Form || i_Type == GrooveFormsDatabaseObjectType_Fields)
					{
						var MetaDataType = (i_Type == GrooveFormsDatabaseObjectType_Fields) ? "FieldBase" : "HTMLBase";
						var MemByteStore = CreateMemoryByteStoreFromMetaData(MetaDataTable, MetaDataType);
						var ByteInputStream = MemByteStore.OpenByteInputStream();
						return AddFileToSandboxFromStream(i_pIGrooveFormsToolDataModel, i_pSandbox, i_Name, ByteInputStream, i_Type, i_SandboxObjectID);
					}
					else if (i_Type == GrooveFormsDatabaseObjectType_FileFromDisk)
					{
						var ByteInputStream = CreateByteInputStreamFromFile(i_Name);
						return AddFileToSandboxFromStream(i_pIGrooveFormsToolDataModel, i_pSandbox, i_Name, ByteInputStream, i_Type, i_SandboxObjectID);
					}
					else
						GrooveDebugFunctions.DisplayAssert(0, "Unknown type passed to AddFramework");
				}
				catch (error)
				{
					DisplayError(error);
					return null;
				}				
			}

			function GetMetaDataContentByName(i_pMetaDataTable, i_Name, i_ReturnType)
			{
				var pEntry = i_pMetaDataTable.GetItem(i_Name);
				if (pEntry == null)
					return;

				if (i_ReturnType == GrooveMetaData_String)
				{
					var MemByteStore = CreateMemoryByteStore();
					var ByteOutputStream = MemByteStore.OpenByteOutputStream(false);
					var ContentElement = null;
					if (i_Name == "FieldBase" || i_Name == "ToolBase" || i_Name == "ToolBase2" || i_Name == "DisBase")
						ContentElement = pEntry.Element.OpenContentElementByName("urn:groove.net:Document");
					else if (i_Name == "HTMLBase")
						ContentElement = pEntry.ContentElement;
					ContentElement.SerializeToStream(ByteOutputStream, GrooveSerializeType_XML, GrooveCharEncodingType_UTF8, GrooveSerializeOption_ConvertLFToCRLF | GrooveSerializeOption_WithFormatting | GrooveSerializeOption_NoProlog | GrooveSerializeOption_NoFragmentWrapper);
					var ByteInputStream = MemByteStore.OpenByteInputStream();
					var CharInputStream = ByteInputStream.OpenCharInputStream(GrooveCharEncodingType_UTF8);
					var returnString = CharInputStream.ReadChars(-1);
					ByteInputStream.Close();
					return returnString;
				}
				else if (i_ReturnType == GrooveMetaData_Element)
				{
					return pEntry.Element;
				}
				else if (i_ReturnType == GrooveMetaData_ContainedBy)
				{
					return pEntry.ContainedBy;
				}
				else if (i_ReturnType == GrooveMetaData_PropertyListElement)
				{
					return pEntry.PropertyListElement;
				}
				else if (i_ReturnType == GrooveMetaData_ObjectType)
				{
					return pEntry.ObjectType;
				}
				else if (i_ReturnType == GrooveMetaData_ContentElement)
				{
					return pEntry.ContentElement;
				}
				else if (i_ReturnType == GrooveMetaData_RawEntry)
				{
					return pEntry;
				}
				return null;
			}

			function OpenDatabaseByName(i_pIGrooveFormsToolDataModel, i_DatabaseName)
			{
				if (i_DatabaseName != null && i_pIGrooveFormsToolDataModel.DoesDatabaseExist(i_DatabaseName))
					return i_pIGrooveFormsToolDataModel.OpenDatabaseByFullName(i_DatabaseName);
				else
					return null;
			}

			function FH_CreateSchema(i_pIGrooveFormsToolDataModel, i_Name)
			{
				try
				{
					var pDatabase = OpenDatabaseByName(i_pIGrooveFormsToolDataModel, i_Name);
					var schemaBIS = pDatabase.CreateSchema(i_Name);
					return  schemaBIS; 
				}
				catch(error)
				{
					// GrooveErrorFunctions.ErrorCode = error.number;
					DisplayError(error);
				}
			}

			function CreateMemoryByteStoreFromMetaData(i_MetaDataTable, i_MetaDataName)
			{
				var MemByteStore = CreateMemoryByteStore();
				var ByteOutputStream = MemByteStore.OpenByteOutputStream(false);

				var Base = GetMetaDataContentByName(i_MetaDataTable, i_MetaDataName, GrooveMetaData_String);

				var CharOutputStream = ByteOutputStream.OpenCharOutputStream(0);
				CharOutputStream.WriteString(Base);

				return MemByteStore;
			}

			function AddFileToSandboxFromStream(i_pIGrooveFormsToolDataModel, i_pSandbox, i_Name, i_pBIS, i_Type, i_ObjectID)
			{
				//var pDatabase = i_pIGrooveFormsToolDataModel.OpenDatabase(i_DatabaseID);
			
				var FileID = i_pSandbox.AddFile(i_Name, i_pBIS, i_Type, i_ObjectID);
				
				i_pBIS.Close();

				return FileID;
			}

			function SafeOpenProperty(i_pPropertyList, i_PropertyName, i_DefaultValue)
			{
				if (i_pPropertyList.PropertyExists(i_PropertyName))
					return i_pPropertyList.OpenProperty(i_PropertyName);
				else
					return i_DefaultValue;
			}
			
			function CreateTemporaryRootElementFromStream(i_BIS, i_SchemaURI)
			{
				if (typeof i_SchemaURI == "undefined")
					i_SchemaURI = "";
				var pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				var pTmpDocument = pSM.CreateTemporaryXMLDocument("", i_SchemaURI);
				pTmpDocument.SetDeleteOnRelease();
				var pRootElement = pTmpDocument.OpenRootElement();
				pRootElement.Delete();

				// Create an element from stream
				try
				{
					var pNewRootElement = pTmpDocument.CreateElementFromStream(i_BIS, GrooveParseOption_Default | GrooveParseOption_StripContentWhitespace);
				}
				catch(error)
				{
					GrooveDebugFunctions.DisplayAssert("Error creating element from stream." + error.Description);
					return;
				}

				pTmpDocument.SetRootElement(pNewRootElement);
				pRootElement = pTmpDocument.OpenRootElement();
				return pRootElement;
			}

			function GetBasePath()
			{
				var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
				var PRootPath = pStorageURISyntax.InstallDataRootPath;
				var strPath = PRootPath + "ToolData\\groove.net\\GrooveForms\\";
				return strPath;
			}

			function BuildPathFromBase(i_PreRootPath, i_PostRootPath)
			{
				var BasePath = GetBasePath();
				return i_PreRootPath + BasePath + i_PostRootPath;
			}

			// Add an element to the back end forms tool component group.
			function AddToComponentGroup(i_Element, i_IsSingleInstance, i_ToolRoot)
			{
				var XMLDoc = i_ToolRoot.OpenXMLDocument();
				var pLocator = XMLDoc.CreateLocator();
				var strLocatorString = ".//urn:groove.net:ComponentGroup";
				var pElementEnum = pLocator.OpenElementEnum(strLocatorString, i_ToolRoot);
				if (pElementEnum.HasMore())
				{
					var CGElement = pElementEnum.OpenNext();
					// The following checks just insure we get the correct <g:ComponentGroup> element
					var DMDName = "";
					var UIDName = "";

					if (CGElement.DoesAttributeExist("DataModelDelegate"))
						DMDName = CGElement.OpenAttribute("DataModelDelegate");

					if (CGElement.DoesAttributeExist("Delegate"))
						UIDName = CGElement.OpenAttribute("Delegate");

					GrooveDebugFunctions.DisplayAssert((DMDName != "" && UIDName != ""), "Error finding Component Group");

					var CompElement = CGElement.CreateElementCopy(i_Element, CGElement);
					var CompName = CompElement.OpenAttribute("Name");

					if (i_IsSingleInstance)
						DelegateName = DMDName;
					else
						DelegateName = UIDName;

					pLocator.Invalidate(false);
					var strLocatorString = ".//urn:groove.net:Component[@Name='" + DelegateName + "']";
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, CGElement);
					if (pElementEnum.HasMore())
					{
						var DelegateElement = pElementEnum.OpenNext();
						if (DelegateElement.ContentElementWithNameExists("urn:groove.net:ComponentConnections"))
						{
							var CCElement = DelegateElement.OpenContentElementByName("urn:groove.net:ComponentConnections");
							var ConnectionElement = CCElement.CreateElement("urn:groove.net:Connection", CCElement);
							ConnectionElement.SetAttribute("Name", CompName);
							ConnectionElement.SetAttribute("ID", "99");
						}
					}
				}
			}

			// Add an element to the back end forms tool delegate.
			function AddToDelegate(i_Element, i_DelegateType, i_ToolRoot)
			{
				var XMLDoc = i_ToolRoot.OpenXMLDocument();
				var pLocator = XMLDoc.CreateLocator();
				var strLocatorString = ".//urn:groove.net:ComponentGroup";
				var pElementEnum = pLocator.OpenElementEnum(strLocatorString, i_ToolRoot);
				if (pElementEnum.HasMore())
				{
					var CGElement = pElementEnum.OpenNext();
					// The following checks just insure we get the correct <g:ComponentGroup> element
					var DMDName = "";
					var UIDName = "";

					if (CGElement.DoesAttributeExist("DataModelDelegate"))
						DMDName = CGElement.OpenAttribute("DataModelDelegate");

					if (CGElement.DoesAttributeExist("Delegate"))
						UIDName = CGElement.OpenAttribute("Delegate");

					GrooveDebugFunctions.DisplayAssert((DMDName != "" && UIDName != ""), "Error finding Component Group");

					var DelegateName = "";
					if (i_DelegateType == "DataModel")
						DelegateName = DMDName;
					else if (i_DelegateType == "UI")
						DelegateName = UIDName;

					GrooveDebugFunctions.DisplayAssert(DelegateName != "", "No delegate name.");

					pLocator.Invalidate(false);
					var strLocatorString = ".//urn:groove.net:Component[@Name='" + DelegateName + "']";
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, CGElement);
					if (pElementEnum.HasMore())
					{
						var DelegateElement = pElementEnum.OpenNext();
						var ContentElementEnum = i_Element.OpenContentElementEnum();
						while (ContentElementEnum.HasMore())
						{
							var ElementToAdd = ContentElementEnum.OpenNext();
							DelegateElement.CreateElementCopy(ElementToAdd, DelegateElement);
						}
					}
				}
			}

			function GetElementEnumByAttributeValue(i_XMLDocument, i_AttributeName, i_AttributeValue, i_ContextElement)
			{
				var pLocator = i_XMLDocument.CreateLocator();
				var strLocatorString = ".//[@"+i_AttributeName+"='"+ i_AttributeValue +"']";
				if (i_ContextElement)
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, i_ContextElement);
				else
				{
					var pRootElement = i_XMLDocument.OpenRootElement();
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pRootElement);
				}
				return pElementEnum;
			}

			function GetElementEnumByElementNameAndAttributeValue(i_XMLDocument, i_ElementName, i_AttributeName, i_AttributeValue, i_ContextElement)
			{
				var pLocator = i_XMLDocument.CreateLocator();
				var strLocatorString = ".//"+i_ElementName+"[@"+i_AttributeName+"='"+ i_AttributeValue +"']";
				if (i_ContextElement)
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, i_ContextElement);
				else
				{
					var pRootElement = i_XMLDocument.OpenRootElement();
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pRootElement);
				}
				return pElementEnum;
			}

			function GetElementEnumByElementName(i_XMLDocument, i_ElementName, i_ContextElement)
			{
				var pLocator = i_XMLDocument.CreateLocator();
				var strLocatorString = ".//"+i_ElementName;
				if (i_ContextElement)
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, i_ContextElement);
				else
				{
					var pRootElement = i_XMLDocument.OpenRootElement();
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pRootElement);
				}
				return pElementEnum;
			}

			function LoadSchema(i_TelespaceGUID, i_ToolName, i_Name, i_bIsTemp)
			{
				try
				{
					var ValidXMLName = CreateValidXMLName(i_TelespaceGUID + "_" + i_ToolName + "_" + i_Name);
					var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
					var pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
					var PRootPath = pStorageURISyntax.UserRootPath;
					var strPath = PRootPath+"schemas.xss";		
					var dbURI = "groovedatabase:///groovexss/" + strPath;
					var schemasdb = pSM.OpenDatabase(dbURI);
					if (schemasdb.DocumentExists(ValidXMLName))
					{
						var Schema = schemasdb.OpenSchema(ValidXMLName);
						if (i_bIsTemp)
						{
							var MBS = CreateMemoryByteStore();
							var schemaBOS = MBS.OpenByteOutputStream(false);
							Schema.SerializeToStream(schemaBOS, GrooveSerializeType_XML, GrooveCharEncodingType_UTF8, GrooveSerializeOption_ConvertLFToCRLF | GrooveSerializeOption_NoProlog | GrooveSerializeOption_NoFragmentWrapper);
							var schemaBIS = MBS.OpenByteInputStream();
							// Create a temporary schema to make modifications to instead of the real one.
							Schema = CreateTemporarySchemaFromStream(schemaBIS);
						}
						return Schema;
					}
					else
						return null;
				}
				catch (error)
				{
					DisplayError(error);
					return false;
				}
			}

			function CreateTemporarySchemaFromStream(i_BIS)
			{
				var pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				var TempDb = pSM.TemporaryXMLDocument.OpenDatabase();
				// Since this is temporary, we need to give it a unique name so that it doesn't 
				// conflict with other schema documents which may have the same name.
				var ValidXMLName = CreateGUID();
				return TempDb.AdvancedDatabase.CreateSchemaFromStream(i_BIS, GrooveParseOption_Default, ValidXMLName);
			}

			function GetRecordTypeForDatabaseName(DatabaseName)
			{
				var RecordType = "urn:groove.net:" + DatabaseName + "Record";
				return RecordType;
			}

			function GenerateRandomDatabaseNamePart()
			{
        // this code can be removed, thus it can return any value
				return 12345;
			}

			function GetFormsToolTemplateSchemaURI()
			{
				return "grooveDocument:///GrooveXSS/$UserRoot/Schemas.xss/GrooveFormsToolTemplateSchema.xml";
			}

			function GetFormsDesignerToolTemplateSchemaURI()
			{
				return "grooveDocument:///GrooveXSS/$UserRoot/Schemas.xss/GrooveFormsDesignerToolTemplateSchema.xml";
			}

			function GetFormsFieldsSchemaURI()
			{
				return "grooveDocument:///GrooveXSS/$UserRoot/Schemas.xss/GrooveFormsFieldsSchema.xml";
			}

			function GetDesignerObjectForDatabaseID(i_DatabaseID, i_pIDataModel)
			{
				return i_pIDataModel.OpenDesignerForDatabase(i_DatabaseID);
			}

			function GetDesignerObjectForSandboxID(i_pSandbox, i_pIDataModel)
			{
				var DbID = i_pSandbox.IGrooveFormsSandboxPrivate.OpenParentID();
				var pDb = i_pIDataModel.OpenDatabase(DbID);
				var DesignerObject = pDb.OpenDesignerForSandbox(i_pSandbox.DatabaseID);
				return DesignerObject;
			}

			function GetToolDelegate(i_Tool)
			{
				var ToolDelegate = i_Tool.OpenDelegateComponent();
				if (ToolDelegate.HasScriptableInterface("IGrooveFormsDatabaseTool2"))
					return ToolDelegate.IGrooveFormsDatabaseTool2;
				else if (ToolDelegate.HasScriptableInterface("IGrooveFormsDatabaseTool"))
					return ToolDelegate.IGrooveFormsDatabaseTool;
				else 
					return ToolDelegate;
			}

			function GetFormsPreferenceAsBool(PropertyList, i_Key, i_bDefault)
			{
				var Account = OpenAccountFromPropertyList(PropertyList);
				var PreferencesPropertyList = Account.PreferencesProvider.PropertyList;
				var FormsPreferences;
				if (!PreferencesPropertyList.PropertyExists("FormsProperties"))
					FormsPreferences = PreferencesPropertyList.CreatePropertyAsPropertyList("FormsProperties");
				else
					FormsPreferences = PreferencesPropertyList.OpenPropertyAsPropertyList("FormsProperties");
				
				var o_Value = i_bDefault;
				if (FormsPreferences.PropertyExists(i_Key))
					o_Value = FormsPreferences.OpenPropertyAsBool(i_Key);

				return o_Value;
			}

			function GetColumnSortTypeStringFromEnumValue(i_SortType)
			{
				if (i_SortType == GrooveFormsColumnSortType_Flat)
					return "0";
				else
					return "1";
			}

			function GetEnumValueFromColumnSortTypeString(i_SortTypeString)
			{
				if (i_SortTypeString == "0")
					return GrooveFormsColumnSortType_Flat;
				else
					return GrooveFormsColumnSortType_Hierarchical;
			}

			function GetContainedByEnumValueFromString(i_ContainedBy)
			{
				var ContainedBy = GrooveScriptFunctions.CreateNewObject("");
				switch (i_ContainedBy)
				{
					case "FORM":
						ContainedBy = GrooveFormsContainedBy_Form;
						break;

					case "HEAD":
						ContainedBy = GrooveFormsContainedBy_Head;
						break;

					case "BODY":
						ContainedBy = GrooveFormsContainedBy_Body;
						break;
				}
				
				return ContainedBy;	
			}

			function GetContainedByFromEnumValue(i_ContainedBy)
			{
				var ContainedBy = GrooveScriptFunctions.CreateNewObject("");
				switch (i_ContainedBy)
				{
					case GrooveFormsContainedBy_Form:
						ContainedBy = "FORM";
						break;

					case GrooveFormsContainedBy_Head:
						ContainedBy = "HEAD";
						break;

					case GrooveFormsContainedBy_Body:
						ContainedBy = "BODY";
						break;
				}
				
				return ContainedBy;	
			}

			function GetDataTypeFromEnumValue(i_DataType)
			{
				var DataType;

				switch (i_DataType)
				{
					case GrooveFormsFieldDataType_Number:
						DataType = "Number";
						break;

					case GrooveFormsFieldDataType_Date:
						DataType = "Date";
						break;

					case GrooveFormsFieldDataType_Attachments:
					case GrooveFormsFieldDataType_RichText:
						DataType = "GrooveComponent";
						break;

					default:
						DataType = "Value";
						break;
				}
				
				return DataType;
			}

			function GetDataTypeEnumValueFromString(i_DataType, i_HTMLElement)
			{
				var DataType;
			
				switch (i_DataType)
				{					 
					case "Number":
						DataType = GrooveFormsFieldDataType_Number;
						break;

					case "Date":
						DataType = GrooveFormsFieldDataType_Date;
						break;

					case "GrooveComponent":
						if (i_HTMLElement.DoesAttributeExist("DataType"))
						{
							intDataType = i_HTMLElement.OpenAttribute("DataType");
							switch(intDataType)
							{
								case "RichText":
									DataType = GrooveFormsFieldDataType_RichText;
									break;
								case "Attachments":
									DataType = GrooveFormsFieldDataType_Attachments;
									break;
							}
						}
						break;
					

					default:
						DataType = GrooveFormsFieldDataType_String;
						break;
				}
				return DataType;
			}

			function GetPropertyLocationStringFromEnumValue(i_PropertyLocation)
			{
				var PropertyLocation = "";

				switch (i_PropertyLocation)
				{
					case GrooveFormsMetaDataPropertyPersistenceType_Attribute:
						PropertyLocation = "inner";
						break;

					case GrooveFormsMetaDataPropertyPersistenceType_ChildElement:
					case GrooveFormsMetaDataPropertyPersistenceType_Content:
						PropertyLocation = "between";
						break;

					case GrooveFormsMetaDataPropertyPersistenceType_ParentElement:
						PropertyLocation = "outer";
						break;

					case GrooveFormsMetaDataPropertyPersistenceType_PeerElement:
						PropertyLocation = "relative";
						break;
				}
				
				return PropertyLocation;
			}

			function GetEnumValueFromPropertyLocationString(i_PropertyLocation, i_PropertyType)
			{
				var EnumValue = "";

				switch (i_PropertyLocation)
				{
					case "inner":
						EnumValue = GrooveFormsMetaDataPropertyPersistenceType_Attribute;
						break;
					case "between":
						if (i_PropertyType == "SubProperty")
							EnumValue = GrooveFormsMetaDataPropertyPersistenceType_ChildElement;
						else
							EnumValue = GrooveFormsMetaDataPropertyPersistenceType_Content;
						break;
					case "outer":
						EnumValue = GrooveFormsMetaDataPropertyPersistenceType_ParentElement;
						break;
					case "relative":
						EnumValue = GrooveFormsMetaDataPropertyPersistenceType_PeerElement;
						break;
				}
				
				return EnumValue;
			}

			function GetPropertyTypeStringFromEnumValue(i_PropertyType)
			{
				var PropertyType;

				switch (i_PropertyType)
				{
					case GrooveFormsMetaDataPropertyDataType_String:
						EnumValue = "Value";
						break;
					case GrooveFormsMetaDataPropertyDataType_Number:
						PropertyType = "Number";
						break;
					case GrooveFormsMetaDataPropertyDataType_Date:
						PropertyType = "Date";
						break;
					case GrooveFormsMetaDataPropertyDataType_Bool:
						PropertyType = "Constant";
						break;
					case GrooveFormsMetaDataPropertyDataType_Browse:
						PropertyType = "Browse";
						break;
					case GrooveFormsMetaDataPropertyDataType_FormatNumeric:
						PropertyType = "FormatNumeric";
						break;
					case GrooveFormsMetaDataPropertyDataType_FormatCurrency:
						PropertyType = "FormatCurrency";
						break;
					case GrooveFormsMetaDataPropertyDataType_FormatDate:
						PropertyType = "FormatDate";
						break;
					case GrooveFormsMetaDataPropertyDataType_RichText:
						PropertyType = "RichText";
						break;
					case GrooveFormsMetaDataPropertyDataType_Content:
						EnumValue = "Content";
						break;
					case GrooveFormsMetaDataPropertyDataType_Reference:
						PropertyType = "Reference";
						break;
					case GrooveFormsMetaDataPropertyDataType_SubProperty:
						PropertyType = "SubProperty";
						break;
					default:
						PropertyType = "Value";
						break;
				}
				
				return PropertyType;
			}

			function GetEnumValueFromPropertyTypeString(i_PropertyType)
			{
				var EnumValue;

				switch (i_PropertyType)
				{
					case "Value":
						EnumValue = GrooveFormsMetaDataPropertyDataType_String;
						break;
					case "Number":
						EnumValue = GrooveFormsMetaDataPropertyDataType_Number;
						break;
					case "Date":
						EnumValue = GrooveFormsMetaDataPropertyDataType_Date;
						break;
					case "Constant":
						EnumValue = GrooveFormsMetaDataPropertyDataType_Bool;
						break;
					case "Browse":
						EnumValue = GrooveFormsMetaDataPropertyDataType_Browse;
						break;
					case "FormatNumeric":
						EnumValue = GrooveFormsMetaDataPropertyDataType_FormatNumeric;
						break;
					case "FormatCurrency":
						EnumValue = GrooveFormsMetaDataPropertyDataType_FormatCurrency;
						break;
					case "FormatDate":
						EnumValue = GrooveFormsMetaDataPropertyDataType_FormatDate;
						break;
					case "RichText":
						EnumValue = GrooveFormsMetaDataPropertyDataType_RichText;
						break;
					case "Content":
						EnumValue = GrooveFormsMetaDataPropertyDataType_Content;
						break;
					case "Reference":
						EnumValue = GrooveFormsMetaDataPropertyDataType_Reference;
						break;
					case "SubProperty":
						EnumValue = GrooveFormsMetaDataPropertyDataType_SubProperty;
						break;
					default:
						EnumValue = "Value";
						break;
				}
				
				return EnumValue;
			}

			function GetRelativePositionStringFromEnumValue(i_RelativePosition)
			{
				var RelativePosition;

				switch (i_RelativePosition)
				{
					case GrooveFormsRelativePosition_Left:
						EnumValue = "Left";
						break;
					case GrooveFormsRelativePosition_Top:
						EnumValue = "Top";
						break;
					case GrooveFormsRelativePosition_Right:
						EnumValue = "Right";
						break;
				}

				return RelativePosition;
			}

			function GetEnumValueFromRelativePositionString(i_RelativePosition)
			{
				var EnumValue;

				switch (i_RelativePosition)
				{
					case "Left":
						EnumValue = GrooveFormsRelativePosition_Left;
						break;
					case "Top":
						EnumValue = GrooveFormsRelativePosition_Top;
						break;
					case "Right":
						EnumValue = GrooveFormsRelativePosition_Right;
						break;
				}

				return EnumValue;
			}

			function GetColumnWidthStyleStringFromEnumValue(i_ColumnWidthStyle)
			{
				var ColumnWidthStyle;

				switch (i_ColumnWidthStyle)
				{
					case GrooveFormsColumnWidthStyle_Percent:
						ColumnWidthStyle = "%";
						break;
					case GrooveFormsColumnWidthStyle_Pixels:
						ColumnWidthStyle = "";
						break;
				}

				return ColumnWidthStyle;
			}

			function GetEnumValueFromColumnWidthStyleString(i_ColumnWidthStyle)
			{
				var EnumValue;

				switch (i_ColumnWidthStyle)
				{
					case "%":
						EnumValue = GrooveFormsColumnWidthStyle_Percent;
						break;
					case "":
						EnumValue = GrooveFormsColumnWidthStyle_Pixels;
						break;
				}

				return EnumValue;
			}

			function GetColumnSortOrderStringFromEnumValue(i_ColumnSortOrder)
			{
				var ColumnSortOrder;

				switch (i_ColumnSortOrder)
				{
					case GrooveFormsColumnSortOrder_Ascending:
						ColumnSortOrder = "Ascending";
						break;
					case GrooveFormsColumnSortOrder_Descending:
						ColumnSortOrder = "Descending";
						break;
					case GrooveFormsColumnSortOrder_Ordinal:
						ColumnSortOrder = "Ordinal";
						break;
					case GrooveFormsColumnSortOrder_Both:
						ColumnSortOrder = "Ascending,Descending";
						break;
				}

				return ColumnSortOrder;
			}

			function GetEnumValueFromColumnSortOrderString(i_ColumnSortOrder)
			{
				var EnumValue;

				switch (i_ColumnSortOrder)
				{
					case "Ascending":
						EnumValue = GrooveFormsColumnSortOrder_Ascending;
						break;
					case "Descending":
						EnumValue = GrooveFormsColumnSortOrder_Descending;
						break;
					case "Ordinal":
						EnumValue = GrooveFormsColumnSortOrder_Ordinal;
						break;
					case "Ascending,Descending":
						EnumValue = GrooveFormsColumnSortOrder_Both;
						break;
				}

				return EnumValue;
			}

			function IsInArray(i_Array, i_Value)
			{
				var i = 0;
				var iCount = i_Array.length;
				while (i < iCount)
				{
					if (i_Value == i_Array[i])
						return true;
					i++;
				}

				return false;
			}

			function RemoveArrayValue(i_Array, i_Value)
			{
				var j = 0;
				var jCount = i_Array.length;
				while (j < jCount)
				{
					if (i_Value == i_Array[j])
					{
						delete i_Array[j];
						i_Array = CompressArray(i_Array, j);
						break;
					}
					j++;
				}
				return i_Array;
			}

			function GetMetaDataNameByDisplayName(i_DisplayName, i_MetaDataTable)
			{
				i_MetaDataTable.LockData();
				var pNameValueEnum = i_MetaDataTable.LockedCreateNameValueEnum();
				while (pNameValueEnum.HasMore())
				{
					var pNameValueEntry = pNameValueEnum.OpenNextPair();
					var pMetaDataObject = pNameValueEntry.Second;
					if (i_DisplayName == pMetaDataObject.LockedGetItem("DisplayName"))
					{
						i_MetaDataTable.UnlockData();
						return pNameValueEntry.First;
					}
				}
				
				i_MetaDataTable.UnlockData();
				return "";
			}

			function LoadTool(i_DatabaseName, i_pITelespace, i_pIFormsToolDataModel)
			{
				var Transaction = i_pITelespace.OpenTransaction(false);
				try
				{
					var Tool = null;
					if (i_pIFormsToolDataModel.DoesDatabaseExist(i_DatabaseName))
					{
						var pDb = i_pIFormsToolDataModel.OpenDatabaseByFullName(i_DatabaseName);
						Tool = pDb.Tool;
					}

					if (Tool)
					{
						if (Tool.DoesDelegateComponentExist() == false)
						{
							var ToolDescriptor = Tool.Descriptor;
							Tool = null;
							delete Tool;
							CollectGarbage();
							//GrooveDebugFunctions.DisplayAssert(0, "About to Retry");
							if (ToolDescriptor.Installable.CanRetry)
							{
								ToolDescriptor.Installable.Retry();
								Transaction.Commit();
								LoadTool(i_DatabaseName);
								return;
							}
						}
					}

					Transaction.Commit();
					return Tool;
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0,error.description);
				}
			}

			function EnsureCurrentToolInstanceValid(i_DatabaseName, i_pDatabase, i_pTelespace, i_pIFormsToolDataModel)
			{
				//GrooveDebugFunctions.DisplayAssert(0, "Break");
				var DatabaseName = i_DatabaseName;
				var pDb;
				if (typeof i_pDatabase.IGrooveFormsSandbox != "undefined")
				{
					var DbID = i_pDatabase.IGrooveFormsSandboxPrivate.OpenParentID();
					pDb = i_pIFormsToolDataModel.OpenDatabase(DbID);
					DatabaseName = pDb.DatabaseName;
				}
				else
					pDb = i_pDatabase;

				var Tool = null;
				if (pDb.IsToolInstalled())
				{
					Tool = LoadTool(DatabaseName, i_pTelespace, i_pIFormsToolDataModel);
				}
				else
					GrooveDebugFunctions.DisplayAssert(0, "Tool is not installed");
	
				return Tool;				
			}

			function LoadCurrentToolDelegateNoThrow(i_DatabaseName, i_pDatabase, i_pTelespace, i_pIFormsToolDataModel)
			{
				var Tool = EnsureCurrentToolInstanceValid(i_DatabaseName, i_pDatabase, i_pTelespace, i_pIFormsToolDataModel);

				if (Tool == null)
					return null;

				if (!Tool.DoesDelegateComponentExist())
					return null;

				var pToolDelegate = GetToolDelegate(Tool);
				return pToolDelegate;
			}

			function LoadCurrentToolDelegate(i_DatabaseName, i_pDatabase, i_pTelespace, i_pIFormsToolDataModel)
			{
				var pDelegate = LoadCurrentToolDelegateNoThrow(i_DatabaseName, i_pDatabase, i_pTelespace, i_pIFormsToolDataModel);
				if (null == pDelegate)
					GrooveErrorFunctions.SetCurrentError(-2147220473, "Tool does not have a valid delegate.");

				return pDelegate;	
			}

			function LocalParseNumber(i_NumberString)
			{
				try
				{
					if (i_NumberString != "")
					{
						var cNull = GrooveScriptFunctions.CreateNewObject("");
						var NumberFormat = g_Intl.CreateNumberFormat(cNull);
						var NumberFormattable = NumberFormat.Parse(i_NumberString, cNull);

						var NumberValue = Number.NaN;
						if (NumberFormattable.Type == GrooveIntlFormattableType_Double)
							NumberValue = NumberFormattable.Double;
						else if (NumberFormattable.Type == GrooveIntlFormattableType_Long)
							NumberValue = NumberFormattable.Long;

						return NumberValue;
					}
					else
						return Number.NaN;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function LocalFormatNumber(i_Value, i_Precision, i_Symbol)
			{
				try
				{
					var cNull = GrooveScriptFunctions.CreateNewObject("");
					// If symbol exists the value is of type currency.
					if (i_Symbol != null)
					{
						// Internationalization message formatting objects.
						var pFormatParameters = GrooveScriptFunctions.CreateNewObject("Groove.UnknownArray");
						var pMessageFormat = g_Intl.CreateMessageFormat("", cNull);
						// Set the precision value if it exists.
						var StringPrecision = "";
						var NumberPrecision = Number(i_Precision);
						if (NumberPrecision > 0)
						{
							StringPrecision = ".";
							var i = 0;
							var iCount = NumberPrecision;
							while (i < iCount)
							{
								StringPrecision += "0";
								i++;
							}
						}

						// Place quotes around the symbol if it is not the international currency character.
						if (i_Symbol != "\u00A4")
							i_Symbol = "'" + i_Symbol + "'";
						// This looks confusing, but it will end up creating a string like this:
						// "{0,number,'$'#,##0.00;('$'#,##0.00)}". The section before the semicolon
						// is for positive values, after is for negative values.
						var NumberFormat = i_Symbol + "#,##0" + StringPrecision;
						var FormatPattern = "{0,number," + NumberFormat + ";(" + NumberFormat + ")}";

						// Setup message formatter parameter array.
						pFormatParameters.RemoveAll();
						var pFormattable = g_Intl.CreateFormattableFromDouble(i_Value);
						pFormatParameters.Add(pFormattable);

						// Set message formatter pattern.
						pMessageFormat.ApplyPattern(FormatPattern);

						// Create formatted message.
						var NumberValue = pMessageFormat.Format(pFormatParameters);
						return NumberValue;
					}
					else
					{
						var NumberFormat = g_Intl.CreateNumberFormat(cNull);

						// Set the precision for the number.
						var NumberPrecision = Number(i_Precision);
						if (!isNaN(NumberPrecision))
						{
							NumberFormat.MinimumFractionDigits = NumberPrecision;
							NumberFormat.MaximumFractionDigits = NumberPrecision;
						}

						// Format the number into a string value.
						var NumberValue = NumberFormat.FormatDouble(i_Value, "", cNull);
						return NumberValue;
					}
				}
				catch (error)
				{
					return i_Value;
				}
			}

			function LocalParseDate(i_DateString, i_FormatPattern, i_FormatStyle)
			{
				try
				{
					if (i_DateString != "")
					{
						var cNull = GrooveScriptFunctions.CreateNewObject("");
						var DateFormat = null;
						// Still read the format pattern for backwards compatibility.
						if (typeof i_FormatStyle != "undefined")
							DateFormat = g_Intl.CreateDateFormatForDate(i_FormatStyle, cNull);
						else
							DateFormat = g_Intl.CreateDateFormatForPattern(i_FormatPattern, cNull);

						var DateObj = DateFormat.Parse(i_DateString, cNull);
						var DateValue = DateObj.RawDateTime;
						return DateValue;
					}
					else
						return Number.NaN;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function LocalFormatDate(i_Millis, i_FormatPattern, i_FormatStyle)
			{
				try
				{
					if (!isNaN(i_Millis))
					{
						var cNull = GrooveScriptFunctions.CreateNewObject("");
						var DateFormat = null;
						if (typeof i_FormatStyle != "undefined")
							DateFormat = g_Intl.CreateDateFormatForDate(i_FormatStyle, cNull);
						else
							DateFormat = g_Intl.CreateDateFormatForPattern(i_FormatPattern, cNull);

						var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
						var DateValue = DateFormat.Format(DateObj, "", cNull);
						return DateValue;
					}
					else
						return "";
				}
				catch (error)
				{
					return "";
				}
			}

			function CreateTempFormElement(i_pIDesigner, i_pRootElement, i_MetaDataTable, i_FieldsToRemoveEnum, i_FieldsToAddEnum, i_StyleName, i_bIsResponse)
			{
				// Get the various elements which contain the fields we're adding
				var pFormXMLDocument = i_pRootElement.OpenXMLDocument();
				var pHeadElement = i_pRootElement.OpenContentElementByName("HEAD");
				var pBodyElement = i_pRootElement.OpenContentElementByName("BODY");
				var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
				var CurrentFormFieldArray = pCurrentFormFieldListElement.OpenAttribute("names").split(",");
				// The Form element is contained by the Body element
				// First look for the form elelment we created
				var pFormElement;
				if (pBodyElement.ContentElementWithNameAndAttributeExists("FORM", "NAME", "GrooveFormBase"))
					pFormElement = pBodyElement.OpenContentElementByNameAndAttribute("FORM", "NAME", "GrooveFormBase");
				else
					pFormElement = pBodyElement.OpenContentElementByName("FORM");
				
				if (typeof pFormElement == "undefined")
					GrooveDebugFunctions.DisplayAssert(0, "Error - no Form Element present.");

				var bIsCustom = false;
				if (pFormElement.DoesAttributeExist("CUSTOM"))
				{
					if (pFormElement.OpenAttribute("CUSTOM") == "true")
						bIsCustom = true;
				}

				var CustomFieldNameArray = new Array();
				if (pCurrentFormFieldListElement.DoesAttributeExist("customnames"))
				{
					var CustomNames = pCurrentFormFieldListElement.OpenAttribute("customnames");
					CustomFieldNameArray = CustomNames.split(",");
				}

				// First handle which fields are unchecked.  If we find any unchecked fields in the list
				// which are in the GROOVEFORMFIELDS list, remove them.
				var RemoveFlag = false;
				var CustomRemoveFlag = false;
				while (i_FieldsToRemoveEnum.HasMore())
				{
					var pIField = i_pIDesigner.OpenFormsFieldByName(i_FieldsToRemoveEnum.OpenNext());
					var bIsKnownField = IsInArray(CurrentFormFieldArray, pIField.FieldName);
					if (bIsKnownField)
					{
						// Now need to remove the field from the form.
						if (IsInArray(CustomFieldNameArray, pIField.FieldName))
						{
							CustomFieldNameArray = RemoveArrayValue(CustomFieldNameArray, pIField.FieldName);
							CustomRemoveFlag = true;
						}
						i_pIDesigner.IGrooveFormsDesignerPrivate.RemoveFieldFromFormElementPriv(pIField.FieldName, pIField, i_pRootElement, CustomRemoveFlag);
						// Reset the fields array as it has changed.
						var CurrentFormFieldNames = pCurrentFormFieldListElement.OpenAttribute("names");
						if (CurrentFormFieldNames == "")
							CurrentFormFieldArray = new Array();
						else
							CurrentFormFieldArray = CurrentFormFieldNames.split(",");
						RemoveFlag = true;
					}	
				}

				// If we've removed a field we need to reset the CustomFieldNameArray so
				// that the IsFieldInArray is accurate when checking for checked fields.
				if (RemoveFlag)
				{
					if (pCurrentFormFieldListElement.DoesAttributeExist("customnames"))
					{
						var CustomFieldListString = pCurrentFormFieldListElement.OpenAttribute("customnames");
						CustomFieldNameArray = CustomFieldListString.split(",");
					}
				}

				// We need to check to see if the elements below are still valid; if not, reaquire them.
				if (pHeadElement.IsValid() == false)
				{
					// Get the various elements which contain the fields we're adding.
					var pHeadElement = i_pRootElement.OpenContentElementByName("HEAD");
					var pBodyElement = i_pRootElement.OpenContentElementByName("BODY");
					// The Form element is contained by the Body element.
					var pFormElement = pBodyElement.OpenContentElementByName("FORM");
				}

				// add the onload attribute to the body tag
				if (!pBodyElement.DoesAttributeExist("ONLOAD"))
					pBodyElement.SetAttribute("ONLOAD", "initFormPage(); addDocument();");
				if (!pBodyElement.DoesAttributeExist("ONBEFOREUNLOAD"))
					pBodyElement.SetAttribute("ONBEFOREUNLOAD", "terminateFormPage(); removeDocument();");

				// Now that we've removed all of the fields which should have been unchecked we can add the checked.
				var FormFieldsArray = new Array();
				while (i_FieldsToAddEnum.HasMore())
				{
					var pIField = i_pIDesigner.OpenFormsFieldByName(i_FieldsToAddEnum.OpenNext());

					var bIsCustomField = false;
					if (bIsCustom)
						bIsCustomField = IsInArray(CustomFieldNameArray, pIField.FieldName);

					if (!bIsCustomField)
					{
						// Add the field to the root form element.
						AddFieldToFormElement(pIField, i_pIDesigner, i_pRootElement);
						// Make sure the form element is still valid.
						if (pFormElement.IsValid() == false)
							pFormElement = pBodyElement.OpenContentElementByName("FORM");
					}
				}

				// First check to see if there is a style already added to form
				// If so, remove it first then add the new one.
				if (i_StyleName != "")
				{
					var pMetaDataEntry = GetMetaDataContentByName(i_MetaDataTable, i_StyleName, GrooveMetaData_RawEntry);
					if (pMetaDataEntry.ContainedBy == "HEAD")
					{
						if (pHeadElement.ContentElementWithNameExists("STYLE"))
							pHeadElement.OpenContentElementByName("STYLE").Delete();
						pHeadElement.CreateElementCopy(pMetaDataEntry.ContentElement, pHeadElement);
						pCurrentFormFieldListElement.SetAttribute("style", pMetaDataEntry.DisplayName);				
					}
				}

				// Remove the view script element if it exists
				if (pHeadElement.ContentElementWithNameAndAttributeExists("SCRIPT", "NAME", "FormScriptBase"))
				{
					var oldFormScriptElement = pHeadElement.OpenContentElementByNameAndAttribute("SCRIPT", "NAME", "FormScriptBase");
					oldFormScriptElement.Delete();
				}
				// Get the script from the meta data
				var newFormScriptElement = GetMetaDataContentByName(i_MetaDataTable, "FormScriptBase", GrooveMetaData_ContentElement);
				// Next make a copy of it to the header element
				pHeadElement.CreateElementCopy(newFormScriptElement, pHeadElement);
				
				// Next check to see if this should be a response form
				if (i_bIsResponse)
					pBodyElement.SetAttribute("FormType", "Response");
				else if (pBodyElement.DoesAttributeExist("FormType"))
					pBodyElement.DeleteAttribute("FormType");

				// The last thing we should do is add the submit buttons if necessary
				if (pFormElement.ContentElementWithNameAndAttributeExists("DIV", "Name", "SubmitBase"))
				{
					var oldSubmitDIVElement = pFormElement.OpenContentElementByNameAndAttribute("DIV", "Name", "SubmitBase");
					oldSubmitDIVElement.Delete();
				}
				// First get the instance
				var SubmitDIVElement =  GetMetaDataContentByName(i_MetaDataTable, "SubmitBase", GrooveMetaData_ContentElement);
				// Next make a copy of it and root the copy to the form element
				pFormElement.CreateElementCopy(SubmitDIVElement, pFormElement);
			}

			function AddFieldToFormElement(i_pIField, i_pIDesigner, i_pRootElement)
			{
				var pFormXMLDocument = i_pRootElement.OpenXMLDocument();
				var pHeadElement = i_pRootElement.OpenContentElementByName("HEAD");
				var pBodyElement = i_pRootElement.OpenContentElementByName("BODY");

				var pFormElement;
				if (pBodyElement.ContentElementWithNameAndAttributeExists("FORM", "NAME", "GrooveFormBase"))
					pFormElement = pBodyElement.OpenContentElementByNameAndAttribute("FORM", "NAME", "GrooveFormBase");
				else
					pFormElement = pBodyElement.OpenContentElementByName("FORM");

				var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
				var CurrentFormFieldArray = new Array();
				var CurrentFormFields = pCurrentFormFieldListElement.OpenAttribute("names");
				if (CurrentFormFields != "")
					CurrentFormFieldArray = CurrentFormFields.split(",");

				// If the field is already in the form, remove it and add it at the end.
				var bIsKnownField = IsInArray(CurrentFormFieldArray, i_pIField.FieldName);
				if (bIsKnownField)
				{
					i_pIDesigner.IGrooveFormsDesignerPrivate.RemoveFieldFromFormElementPriv(i_pIField.FieldName, i_pIField, i_pRootElement, false);
					// Reset the fields array as it has changed.
					var CurrentFormFieldNames = pCurrentFormFieldListElement.OpenAttribute("names");
					if (CurrentFormFieldNames == "" || CurrentFormFieldNames == ",")
						CurrentFormFieldArray = new Array();
					else
						CurrentFormFieldArray = CurrentFormFieldNames.split(",");
				}

				// Add the new field name to the form fields array and element.
				CurrentFormFieldArray[CurrentFormFieldArray.length] = i_pIField.FieldName;
				pCurrentFormFieldListElement.SetAttribute("names", CurrentFormFieldArray.join(","));
				// Need to now add the real html to the form in the correct place.
				var ElementToInsert = pFormXMLDocument.CreateElementCopy(i_pIField.HTMLElement, GrooveScriptFunctions.CreateNewObject(""));
				if (i_pIField.ContainedBy == GrooveFormsContainedBy_Form)
				{
					var pTABLEElement = pFormElement.OpenContentElementByName("TABLE");
					pTABLEElement.AppendContentElement(ElementToInsert);
				}
				else if (i_pIField.ContainedBy == GrooveFormsContainedBy_Body)
				{
					if (i_pIField.FieldType == "Heading")
					{
						var Ordinal = 0;
						if (pFormElement.IsValid())
							Ordinal = pFormElement.GetOrdinal();
						else
						{
							pFormElement = pBodyElement.OpenContentElementByName("FORM");
							Ordinal = pFormElement.GetOrdinal();
						}
						pBodyElement.InsertContentElement(Ordinal, ElementToInsert);
					}
					else
						pBodyElement.SetContentElement(pFormElement.GetOrdinal() - 1, ElementToInsert);
				}
				else if (i_pIField.ContainedBy == GrooveFormsContainedBy_Head)
					pHeadElement.AppendContentElement(ElementToInsert);
			}
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @             	             í‡  í‡                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              	  	               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t      ÄName>   G r o o v e F o r m s H e l p e r F u n c t i o n s 2 . g s l         ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT  S  ÄSCRIPT       ÄSRC.  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       & F a c  ÄSCRIPT       ÄSRC,  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e A r r a y H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   Ca    o r y =  ÄSCRIPT       ÄSRC*  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T e x t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       = O p e n    ÄSCRIPT       ÄSRC   h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e C a l e n d a r H e l p e r _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   ax                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ¥E   M   \Q   ∞ Q   | g      ∑          )      ÄSCRIPT         Ú‹ Ä

			var g_FORMS_TEMPLATE_FILTER					= "Forms Design Template (*.fdt)|*.fdt";
			var g_FORMS_SCRIPT_FILTER					= "Script (*.js;*.vbs)|*.js;*.vbs";
			var g_FORMS_STYLE_FILTER					= "CSS (*.css)|*.css";

			var FORMS_TOOL_DELETE_FIELD					= "Deleting this field will delete it from all forms and views. Do you want to continue?";
			var FORMS_TOOL_DELETE_FIELD_TITLE			= "Delete Field?";
			
			var FORMS_TOOL_DELETE_VIEW_OR_FORM			= "Deleting a form or view cannot be undone.  Do you want to continue?";
			var FORMS_TOOL_DELETE_VIEW_OR_FORM_TITLE	= "Delete Form/View?";

			var FORMS_TOOL_DELETE_SCRIPT				= "Deleting a script cannot be undone.  Do you want to continue?";
			var FORMS_TOOL_DELETE_SCRIPT_TITLE			= "Delete Script?";

			var FORMS_TOOL_DELETE_STYLE					= "Deleting a style cannot be undone.  Do you want to continue?";
			var FORMS_TOOL_DELETE_STYLE_TITLE			= "Delete Style?";

			var FORMS_TOOL_DIRTY_SAVE					= "Do you want to save your changes?";
			var FORMS_TOOL_DIRTY_SAVE_TITLE				= "Save Changes?";
			var FORMS_V3_COMP_RESOURCE_URL				= "http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.Tools.Business.GrooveForms.GrooveForms_TPL&Version=3&Factory=Open";
			
      //**************************************************************************
			//
			// From GrooveDataListAlpha.idl
			//
			//**************************************************************************

      var GrooveDataListDateTimeFormat_Default = 0;
      var GrooveDataListDateTimeFormat_ShortDate = 1;
      var GrooveDataListDateTimeFormat_LongDate = 2;
      var GrooveDataListDateTimeFormat_Hour = 4;
      var GrooveDataListDateTimeFormat_HourInDay = 5;
      var GrooveDataListDateTimeFormat_DayInMonth = 6;
      var GrooveDataListDateTimeFormat_DayOfWeek = 7;
      var GrooveDataListDateTimeFormat_ShortDayOfWeek = 8;
      var GrooveDataListDateTimeFormat_DayInYear = 9;
      var GrooveDataListDateTimeFormat_WeekInMonth = 10;
      var GrooveDataListDateTimeFormat_WeekInYear = 11;
      var GrooveDataListDateTimeFormat_Month = 12;
      var GrooveDataListDateTimeFormat_ShortMonth = 13;
      var GrooveDataListDateTimeFormat_MonthInYear = 14;
      var GrooveDataListDateTimeFormat_ShortMonthInYear = 15;
      var GrooveDataListDateTimeFormat_Year = 16;
      var GrooveDataListDateTimeFormat_ShortYear = 17;
      var GrooveDataListDateTimeFormat_ShortDateShortTime = 18;
      var GrooveDataListDateTimeFormat_MediumDateMediumTime = 19;
      var GrooveDataListDateTimeFormat_ShortTime = 20;
      var GrooveDataListDateTimeFormat_MediumTime = 21;

			//**************************************************************************
			//
			// From GlobalHelperFunctions
			//
			//**************************************************************************

			// IE registry
			var MSIE_KEY = "Software\\Microsoft\\Internet Explorer";

			var PROPERTY_CANONICAL_URL = "_CanonicalURL";
			var PROPERTY_TOOL_CONTAINER = "_ToolContainer";
			var PROPERTY_DYNAMICS_MANAGER = "_DynamicsManager";
			var PROPERTY_TELESPACE_DATABASE = "_TelespaceDatabase";
			var PROPERTY_TELESPACE_PROVIDER = "_TelespaceProvider";
			var PROPERTY_TELESPACE = "_Telespace";
			var PROPERTY_TOOL_DISPLAY_NAME = "_ToolDisplayName";
			var PROPERTY_TOOL_NAME = "_ToolName";
			var PROPERTY_TOOL_URL = "_ToolURL";
			var PROPERTY_TOOL = "_Tool";
			var PROPERTY_FORM = "_Form";
			var PROPERTY_OBJECT_ENTRY_STORE = "_ObjectEntryStore";
			var PROPERTY_ACCOUNT_GUID = "_AccountGUID";
			var PROPERTY_CURRENT_IDENTITY = "_CurrentIdentity";
			var PROPERTY_ACCOUNT = "_Account";

			// UIPropertyList constants
			var UIPROPERTY_TOP_LEVEL_WINDOW = "_TopLevelWindow";
			var UIPROPERTY_URLNAVIGATOR = "_URLNavigator";
			var UIPROPERTY_WINDOW_ACCOUNT = "_WindowAccount";
			var UI_PROPERTY_UIACTIVE_COMPONENT = "_UIActiveComponent";

			// Access control strings
			var STR_COMMON_ACCESS_CONTROL_COMPONENT_GROUP_OBJECT_ID = "$ComponentGroup";			
			var STR_COMMON_ACCESS_CONTROL_TELESPACE_MANAGER_ROLE_NAME = "$Telespace.Manager";			
			var STR_COMMON_ACCESS_CONTROL_TELESPACE_SCOPE_URL = "";

			var GROOVE_VK_ENTER = 0x0d;
			var GROOVE_VK_INSERT = 0x2d;
			var GROOVE_VK_DELETE = 0x2e;
			var GROOVE_VK_ESC = 0x1B;
			var GROOVE_VK_D = 0x44;

			// Keystroke Message Values
			var GROOVE_WM_KEYDOWN = 0x100;
			var GROOVE_WM_KEYUP = 0x101;

			// Keystate Modifier Values
			var GROOVE_KEYMOD_SHIFT = 0x00000001;
			var GROOVE_KEYMOD_CONTROL = 0x00000002;
			var GROOVE_KEYMOD_ALT = 0x00000004;

			// Global pointers
			var GROOVE_GLOBAL_MISC_POINTER = GrooveScriptFunctions.CreateNewObject("Groove.SystemServices").Misc;
			var GROOVE_NULL = GrooveScriptFunctions.CreateNewObject("");

			// Invalid date constant
			var INVALID_DATE = -0xFFFFFFFFFFFFF;
			
			// Returns all characters to the right of the search string's
			// first occurrence, searching from left to right.  Returns the
			// input string if the search string isn't found.
			//
			function Right(i_InputString, i_SearchString)
			{
				var FromPos = i_InputString.indexOf(i_SearchString);
				if (-1 == FromPos)
				{
					return i_InputString;
				}

				FromPos += i_SearchString.length;
				return i_InputString.substring(FromPos, i_InputString.length);
			}

			// Returns all characters to the right of the search string's
			// first occurrence, searching from right to left.  Returns the
			// input string if the search string isn't found.
			//
			function RightBack(i_InputString, i_SearchString)
			{
				var FromPos = i_InputString.lastIndexOf(i_SearchString)
				if (-1 == FromPos)
				{
					return i_InputString;
				}
				
				FromPos += i_SearchString.length;
				return i_InputString.substring(FromPos, i_InputString.length);
			}

			// Returns all characters to the left of the search string's
			// first occurrence, searching from left to right.  Returns the
			// input string if the search string isn't found.
			//
			function Left(i_InputString, i_SearchString)
			{
				var ToPos = i_InputString.indexOf(i_SearchString);
				if (-1 == ToPos)
				{
					return i_InputString;
				}

				return i_InputString.substring(0, ToPos);
			}

			// Returns all characters to the left of the search string's
			// first occurrence, searching from right to left.  Returns the
			// input string if the search string isn't found.
			//
			function LeftBack(i_InputString, i_SearchString)
			{
				var ToPos = i_InputString.lastIndexOf(i_SearchString);
				if (ToPos == -1)
				{
					return i_InputString;
				}

				return i_InputString.substring(0, ToPos);
			}

			// This function trims leading and trailing whitespace off the string
			function TrimEnds(String)
			{
				return TrimTail(TrimHead(String));
			}

			// This function trims leading whitespace off the string
			function TrimHead(String)
			{
				var length = String.length;
				for (i=0; i<length; i++)
				{
					if (" " != String.charAt(i))
						break;
				}
				return String.substr(i, length);
			}

			// This function trims trailing whitespace off the string
			function TrimTail(String)
			{
				var length = String.length;
				for (i=length-1; i>=0; i--)
				{
					if (" " != String.charAt(i))
						break;
				}
				return String.substr(0, i + 1);
			}	
	
			function CreateBSTREnum()
			{
				var BSTREnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateBSTREnum();
				var BSTREnumCreate = BSTREnum.BSTREnumCreate;
				return BSTREnumCreate;
			}

			function CreateStringStringEnum(i_bSort)
			{
				if (typeof i_bSort == "undefined")
					i_bSort = false;
				var StringStringEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateStringStringEnum(i_bSort);
				var StringStringEnumCreate = StringStringEnum.StringStringEnumCreate;
				return StringStringEnumCreate;
			}

			function CreateVARIANTEnum()
			{
				var VARIANTEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateVARIANTEnum();
				var VARIANTEnumCreate = VARIANTEnum.VARIANTEnumCreate;
				return VARIANTEnumCreate;
			}

			function CreateNameValueEnum()
			{
				var NameValueEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum();
				var NameValueEnumCreate = NameValueEnum.NameValueEnumCreate;
				return NameValueEnumCreate;
			}

			function CreateDoubleEnum()
			{
				var DoubleEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateDoubleEnum();
				var DoubleEnumCreate = DoubleEnum.DoubleEnumCreate;
				return DoubleEnumCreate;
			}

			function CreateUnknownEnumFromStringIIDs(i_EnumIID, i_EntryIID)
			{
				var UnknownEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs(i_EnumIID, i_EntryIID);
				var UnknownEnumCreate = UnknownEnum.UnknownEnumCreate;
				return UnknownEnumCreate;
			}

			function CreateByteInputStreamFromFile(i_File, i_DenyNone)
			{
				if (null == i_DenyNone)
					i_DenyNone = false;

				var ByteInputStream;
				try
				{
					ByteInputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteInputStreamFromFile2(i_File, i_DenyNone);
				}
				catch (e)
				{
				}
				return ByteInputStream;
			}

			function CreateByteOutputStreamFromFile(i_File, i_Append, i_ReadOnly)
			{
				if (null == i_Append)
					i_Append = false;

				if (null == i_ReadOnly)
					i_ReadOnly = false;

				var ByteOutputStream;
				try
				{
					ByteOutputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteOutputStreamFromFile(i_File, i_Append, i_ReadOnly);
				}
				catch(e)
				{
				}
				return ByteOutputStream;
			}

			function CreateMemoryByteStore(i_PageSize)
			{
				if (null == i_PageSize)
					i_PageSize = 0;

				var MemoryByteStore = GROOVE_GLOBAL_MISC_POINTER.StoreFactory.CreateMemoryByteStore(i_PageSize);
				return MemoryByteStore;
			}

			function OpenAccountFromPropertyList(pPropertyList)
			{
				return pPropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE_PROVIDER);
			}

			function OpenFullNameFromCurrentIdentity(PropertyList, i_IncludeAnnotation)
			{
				if (i_IncludeAnnotation == null)
					i_IncludeAnnotation = true;

				var Telespace = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
				var pCurrentIdentity = Telespace.OpenCurrentIdentity();
				var pCurrentIdentityContact = pCurrentIdentity.Contact;
				return OpenFullNameFromContact(pCurrentIdentityContact, i_IncludeAnnotation);
			}

			function OpenFullNameFromContact(i_Contact, i_IncludeAnnotation)
			{
				if (i_IncludeAnnotation == null)
					i_IncludeAnnotation = true;

				var Name;
				if (i_IncludeAnnotation)
					Name = i_Contact.ContactStoreEntry.DisplayName;
				else
					Name = i_Contact.OpenVCard().OpenIdentification().OpenFullName();
				return Name;
			}

			function OpenRecordCreatorName(i_pPropertyList, i_pRecord, i_UseAlias)
			{
				return OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, "_CreatedByURL");
			}

			function OpenRecordModifierName(i_pPropertyList, i_pRecord, i_UseAlias)
			{
				return OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, "_ModifiedByURL");
			}

			function OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, i_URLField)
			{
				if (i_UseAlias == null)
					i_UseAlias = false;

				var CS = i_pPropertyList.OpenProperty("_ContactStore");
				var Telespace = i_pPropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);

				try
				{
					var Transaction = Telespace.OpenTransaction(true);
					var CURL = i_pRecord.OpenFieldAsString(i_URLField);
					Transaction.Commit();

					if (CS.DoesExist(CURL))
					{
						var CurrContact = CS.Open(CURL);
						return OpenFullNameFromContact(CurrContact);
					}
					else
						return false;
				}
				catch (error)
				{
					Transaction.Abort();
					return false;
				}
			}

			function Helper_GetRoles(i_ScopeURL, i_pTelespace, i_ObjectID)
			{
				var pObjectEntryStore = i_pTelespace.ObjectEntryStore;
				if (pObjectEntryStore)
					{
					var ObjEntry = pObjectEntryStore.Open(i_ScopeURL, i_ObjectID);
					return ObjEntry.AccessControl.IGrooveRoles;
					}
				return null;
			}

			function Helper_GetRoleForUser(i_Roles, i_TemplateRoleEnum, i_ContactURL)
			{
				i_TemplateRoleEnum.Reset();
				while (i_TemplateRoleEnum.HasMore())
				{
					var TemplateRole = i_TemplateRoleEnum.OpenNext();
					if (TemplateRole.Visible)
					{
						var Role = i_Roles.Open(TemplateRole.Name);
						if (Role.ContainsMember(i_ContactURL))
							return TemplateRole;
					}
				}
			}

			function SetClipboardEmpty()
			{
				var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
				var pClipboard = pUIManager.OpenClipboard();
				pClipboard.SetEmpty();
			}

			function CopyAsLinkToClipboard(i_CanonicalURL, i_DisplayName)
			{
				var pStorageMgr = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				var pElement = pStorageMgr.CreateTemporaryElement("GrooveLink");
				pElement.SetAttribute("DisplayName", i_DisplayName);
				pElement.SetAttribute("URL", i_CanonicalURL);

				var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
				var pClipboard = pUIManager.OpenClipboard();
				pClipboard.SetDataAsElement("GrooveLink", pElement);
			}

			//	Custom object, typically used for DLLs and EXEs
			function VersionObject(i_VersionString)
			{
				var VerArray = i_VersionString.split(".");
				if (typeof i_VersionString != "undefined")
					this.VersionString = i_VersionString;
				if (typeof VerArray[0] != "undefined")
					this.MajorVersion = parseInt(VerArray[0]);
				if (typeof VerArray[1] != "undefined")
					this.MinorVersion = parseInt(VerArray[1]);
				if (typeof VerArray[2] != "undefined")
					this.BuildVersion = parseInt(VerArray[2]);
				if (typeof VerArray[3] != "undefined")
					this.SubBuildVersion = parseInt(VerArray[3]);
			}

			function GetMSIEVersion()
			{
				//	Works with IE4.0 and later
				//  See  http://support.microsoft.com/default.aspx?scid=kb;EN-US;q164539 for more
				//  information as to how IE reports version numbers back for the various
				//  versions of IE.
				var App = GrooveScriptFunctions.CreateNewObject("Groove.Application");
				var VerString = App.ReadRegistryValue(GrooveRegistryKeyValue_LocalMachine,
													  MSIE_KEY, "Version");
				if (typeof VerString != "undefined" && VerString != "")
				{
					var MSIEVersion = new VersionObject(VerString);
					return MSIEVersion;
				}
				else
					return null;
			}
			
			function ResolveLinkTargetPathName(i_Path)
			{
				if(IsLNKShortcutFile(i_Path))
				{
					var pIFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

					var SourcePath = pIFileSystemServices.OpenShortcutFileInfo(i_Path);
					return ResolveLinkTargetPathName(SourcePath);
				}
				else
				{
					return i_Path;
				}
			}

			function IsLNKShortcutFile(i_Path)
			{
				var pIFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
				var LNKExtension = "lnk";
				if(pIFileSystemServices.IsFileLinkByPath(i_Path) &&
						(LNKExtension == pIFileSystemServices.OpenFileExtension(i_Path).toLowerCase()))
					return true;
				else
					return false;
			}


			//**************************************************************************
			//
			// End from GlobalHelperFunctions
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From ArrayHelperFunctions
			//
			//**************************************************************************

			function CompressArray(i_Array, i_IndexToRemove)
			{
				var newArray = i_Array.slice(i_IndexToRemove, i_IndexToRemove+1);
				var retArray = new Array();
				var x = 0;
				for (var i = 0; i < i_Array.length; i++)
				{
					if (typeof i_Array[i] != "undefined")
					{
						retArray[x] = i_Array[i];
						x++;
					}
				}
				return retArray;						
			}

			//**************************************************************************
			//
			// End from ArrayHelperFunctions
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From CalendarHelper
			//
			//**************************************************************************

			var g_Intl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
	
			// Returns string
			function FormatDate(i_Millis, i_FormatStyle)
			{
				var DateFormat = g_Intl.CreateDateFormatForDate(i_FormatStyle, GROOVE_NULL);
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				return DateFormat.Format(DateObj, "", GROOVE_NULL);
			}

			// Returns string
			function FormatTime(i_Millis, i_FormatStyle)
			{
				var DateFormat = g_Intl.CreateDateFormatForTime(i_FormatStyle, GROOVE_NULL);
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				return DateFormat.Format(DateObj, "", GROOVE_NULL);
			}

			// Returns string
			function FormatDateTime(i_Millis, i_DateStyle, i_TimeStyle)
			{
				var DateFormat = g_Intl.CreateDateFormatForDateTime(i_DateStyle, i_TimeStyle, GROOVE_NULL);
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				return DateFormat.Format(DateObj, "", GROOVE_NULL);
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseDate(i_DateString, i_FormatStyle)
			{		
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDate(i_FormatStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseTime(i_TimeString, i_FormatStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForTime(i_FormatStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_TimeString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseDateTime(i_DateTimeString, i_DateStyle, i_TimeStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDateTime(i_DateStyle, i_TimeStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateTimeString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function ParseDateAndTime(i_DateString, i_DateStyle, i_TimeString, i_TimeStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDate(i_DateStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateString, GROOVE_NULL);
					var TimeFormat = g_Intl.CreateDateFormatForTime(i_TimeStyle, GROOVE_NULL);
					var TimeObj = TimeFormat.Parse(i_TimeString, GROOVE_NULL);
					var DateTimeObj = MergeDateAndTime(DateObj, TimeObj);
					return DateTimeObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function MergeDateAndTime(i_DateObj, i_TimeObj)
			{
				var Calendar = g_Intl.CreateCalendar();

				Calendar.DateTime = i_DateObj;
				var Year = Calendar.Get(GrooveIntlCalendarField_Year);
				var Month = Calendar.Get(GrooveIntlCalendarField_Month);
				var Day = Calendar.Get(GrooveIntlCalendarField_DayOfMonth);

				Calendar.DateTime = i_TimeObj;
				Calendar.SetDate(Year, Month, Day);

				return Calendar.DateTime;
			}

			// Creates and returns an IGrooveCalendar for the specified date/time
			function CreateCalendar(i_Millis)
			{
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				var Calendar = g_Intl.CreateCalendar();
				Calendar.DateTime = DateObj;
				return Calendar;
			}

			function StartOfDay(i_Millis)
			{
				var Calendar = CreateCalendar(i_Millis);

				var Year = Calendar.Get(GrooveIntlCalendarField_Year);
				var Month = Calendar.Get(GrooveIntlCalendarField_Month);
				var Day = Calendar.Get(GrooveIntlCalendarField_DayOfMonth);

				Calendar.Clear();
				Calendar.SetDate(Year, Month, Day);

				return Calendar.DateTime.RawDateTime;
			}

			function EndOfDay(i_Millis)
			{
				var Start = StartOfDay(i_Millis);
				var Calendar = CreateCalendar(Start);

				Calendar.Add(GrooveIntlCalendarField_DayOfMonth, 1);
				Calendar.Add(GrooveIntlCalendarField_Millisecond, -1);

				return Calendar.DateTime.RawDateTime;
			}

			//**************************************************************************
			//
			// End from CalendarHelper
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveClient.idl
			//
			//**************************************************************************
			
			// "Abort, Retry, Ignore" buttons.
			var GrooveMessageBoxStyle_AbortRetryIgnore = 0x0001;
			
			// "Cancel, Try, Continue" buttons.
			var GrooveMessageBoxStyle_CancelTryContinue = 0x0002;
			
			// "OK" button.
			var GrooveMessageBoxStyle_OK = 0x0004;
			
			// "OK, Cancel" buttons.
			var GrooveMessageBoxStyle_OKCancel = 0x0008;
			
			// "Retry, Cancel" buttons.
			var GrooveMessageBoxStyle_RetryCancel = 0x0010;
			
			// "Yes, No" buttons.
			var GrooveMessageBoxStyle_YesNo = 0x0020;
			
			// "Yes, No, Cancel" buttons.
			var GrooveMessageBoxStyle_YesNoCancel = 0x0040;

			// No icon.
			var GrooveMessageBoxIcon_None = 0x0000;

			// Exclamation icon.
			var GrooveMessageBoxIcon_Exclamation = 0x0080;

			// Warning icon.
			var GrooveMessageBoxIcon_Warning = 0x0081;

			// Information icon.
			var GrooveMessageBoxIcon_Information = 0x0100;

			// Asterisk icon.
			var GrooveMessageBoxIcon_Asterisk = 0x0101;

			// Question icon has been deprecated. Use Warning or Information as appropriate

			// Stop icon.
			var GrooveMessageBoxIcon_Stop = 0x0400;
			
			// Error icon.
			var GrooveMessageBoxIcon_Error = 0x0401;
			
			// Hand icon.
			var GrooveMessageBoxIcon_Hand = 0x0402;

			// OK.
			var GrooveMessageBoxResultCode_OK = 1;

			// Cancel.
			var GrooveMessageBoxResultCode_Cancel = 2;

			// Abort.
			var GrooveMessageBoxResultCode_Abort = 3;

			// Retry.
			var GrooveMessageBoxResultCode_Retry = 4;

			// Ignore.
			var GrooveMessageBoxResultCode_Ignore = 5;

			// Yes.
			var GrooveMessageBoxResultCode_Yes = 6;

			// No.
			var GrooveMessageBoxResultCode_No = 7;

			// Try Again.
			var GrooveMessageBoxResultCode_TryAgain = 10;

			// Continue.
			var GrooveMessageBoxResultCode_Continue = 11;

			// No special style.
			var GrooveInputBoxStyle_None = 0;

			// Password style.
			var GrooveInputBoxStyle_Password = 1;

			// AllowEmptyValue style.
			var GrooveInputBoxStyle_AllowEmptyValue = 2;

			// System directory.
			var GrooveDirectoryValue_System = 1;

			// Temp directory.
			var GrooveDirectoryValue_Temp = 2;
			
			// System registry key for GrooveRegistryKeyValue as Local Machine. 
			var GrooveRegistryKeyValue_LocalMachine = 1;

				// Dialog box value OK.
			var GrooveDialogBoxResultCode_OK = 1;

			// Dialog box value Cancel. 
			var GrooveDialogBoxResultCode_Cancel = 2;
			//**************************************************************************
			//
			// End from GrooveClient.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveInternationalization.idl
			//
			//**************************************************************************

			// Full.
			var GrooveIntlDateFormatStyle_Full = 0;

			// Long.
			var GrooveIntlDateFormatStyle_Long = 1;

			// Medium.
			var GrooveIntlDateFormatStyle_Medium = 2;

			// Short.
			var GrooveIntlDateFormatStyle_Short = 3;

			// Default.
			var GrooveIntlDateFormatStyle_Default = GrooveIntlDateFormatStyle_Short;

			// DOUBLE floating point value.
			var GrooveIntlFormattableType_Double = 1;

			// LONG signed integer value.
			var GrooveIntlFormattableType_Long = 2;

			// Era field, e.g. 0..1 (calendar specific).
			var GrooveIntlCalendarField_Era = 0;

			// Year field, e.g. 1..N.
			var GrooveIntlCalendarField_Year = 1;

			// Month field, e.g. 0..11.
			var GrooveIntlCalendarField_Month = 2;

			// Week-Of-Year field, e.g. 1..53.
			var GrooveIntlCalendarField_WeekOfYear = 3;

			// Week-Of-Month field, e.g. 0..6.
			var GrooveIntlCalendarField_WeekOfMonth = 4;

			// Day-Of-Month field, e.g. 1..31.
			var GrooveIntlCalendarField_DayOfMonth = 5;

			// Day-Of-Year field, e.g. 1..366.
			var GrooveIntlCalendarField_DayOfYear = 6;

			// Day-Of-Week field, e.g. 1..7.
			var GrooveIntlCalendarField_DayOfWeek = 7;

			// Day-Of-Week-In-Month field, e.g. 1..6, may be specified as -1.
			var GrooveIntlCalendarField_DayOfWeekInMonth = 8;

			// AM/PM field, e.g. 0..1.
			var GrooveIntlCalendarField_AMPM = 9;

			// Hour field, e.g. 0..11.
			var GrooveIntlCalendarField_Hour = 10;

			// Hour-Of-Day field, e.g. 0..23.
			var GrooveIntlCalendarField_HourOfDay = 11;

			// Minute field, e.g. 0..59.
			var GrooveIntlCalendarField_Minute = 12;

			// Second field, e.g. 0..59.
			var GrooveIntlCalendarField_Second = 13;

			// Millisecond field, e.g. 0..999.
			var GrooveIntlCalendarField_Millisecond = 14;

			// Time-Zone-Offset field, e.g. (-12 * GrooveIntlDateMillis_MillisPerHour)..(12 * GrooveIntlDateMillis_MillisPerHour).
			var GrooveIntlCalendarField_ZoneOffset = 15;

			// Daylight-Savings-Time-Offset field, e.g. 0 or GrooveIntlDateMillis_MillisPerHour.
			var GrooveIntlCalendarField_DSTOffset = 16;

			//**************************************************************************
			//
			// End from GrooveInternationalization.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCalendarTool.idl
			//
			//**************************************************************************

			// Command to add a new calendar entry.
			var GrooveCalendarCommand_NewEntry = 0;

			// Command to view or edit details about the entry.
			var GrooveCalendarCommand_OpenDetail = 1;

			// Command to delete the entry.
			var GrooveCalendarCommand_Delete = 2;

			// Command to cut the entry.
			var GrooveCalendarCommand_Cut = 3;

			// Command to copy the entry.
			var GrooveCalendarCommand_Copy = 4;

			// Command to paste the entry.
			var GrooveCalendarCommand_Paste = 5;

			// Command to copy the entry as a link.
			var GrooveCalendarCommand_CopyAsLink = 6;

			// Command to save the entry in an external format.
			var GrooveCalendarCommand_SaveAs = 7;

			// Command to mark the entry as read.
			var GrooveCalendarCommand_MarkRead = 8;

			// Command to mark the entry as unread.
			var GrooveCalendarCommand_MarkUnread = 9;

			// Command to mark all entries as read.
			var GrooveCalendarCommand_MarkAllRead = 10;

			// Command to mark all entries as unread.
			var GrooveCalendarCommand_MarkAllUnread = 11;

			// Command to display the day view.
			var GrooveCalendarCommand_DayView = 12;

			// Command to display the week view
			var GrooveCalendarCommand_WeekView = 13;

			// Command to display the month view.
			var GrooveCalendarCommand_MonthView = 14;

			// Command to display the business week view.
			var GrooveCalendarCommand_BusinessWeekView = 15;

			// Command to display the business month view.
			var GrooveCalendarCommand_BusinessMonthView = 16;

			// Command to scroll to the next unit of time.
			var GrooveCalendarCommand_ScrollNext = 17;

			// Command to scroll to the previous unit of time.
			var GrooveCalendarCommand_ScrollPrev = 18;

			// Command to scroll to the current date.
			var GrooveCalendarCommand_ScrollToday = 19;

			// Command to load a date navigation aid.
			var GrooveCalendarCommand_GoToDate = 20;

			// Command to undo the previous data change.
			var GrooveCalendarCommand_Undo = 21;

			// Command to redo the previously undone data change.
			var GrooveCalendarCommand_Redo = 22;

			// Command to enable synchronization with Outlook.
			var GrooveCalendarCommand_EnableOutlookSync = 23;

			// Command to send a single event to OUtlook.
			var GrooveCalendarCommand_SendEventToOutlook = 24;

			// Command to Print the entry.
			var GrooveCalendarCommand_Print = 25;

			//**************************************************************************
			//
			// End from GrooveCalendarTool.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveMiscServices.idl
			//
			//**************************************************************************

			// UTF8 character type.
			var GrooveCharEncodingType_UTF8 = 0;

			//**************************************************************************
			//
			// End from GrooveMiscServices.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveMiscServicesAlpha.idl
			//
			//**************************************************************************

			// Delayed deletion of temporary file.
			var GrooveTemporaryFileDeleteFlag_TimerDelay = 1;

			// Attempt deletion of temporary file on each shutdown/startup of temporary file service.
			var GrooveTemporaryFileDeleteFlag_ShutdownStartup = 2;

			//**************************************************************************
			//
			// End from GrooveMiscServicesAlpha.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCommonComponents.idl
			//
			//**************************************************************************

			// Width is determined at runtime based on available space. 
			var GrooveListViewColumnWidthType_AutoSize = 1;

			// Width is specified as a fixed number of pixels.
			var GrooveListViewColumnWidthType_Pixels = 2;

			// Column has left alignment.
			var GrooveListViewColumnAlignment_Left = 0;

			// Column has right alignment.
			var GrooveListViewColumnAlignment_Right = 1;

			// Column has center alignment.
			var GrooveListViewColumnAlignment_Center = 2;

			// Action caused by unknown source.
			var GrooveSelectionChangeActionTrigger_Unknown = 0;

			// Action caused by mouse.
			var GrooveSelectionChangeActionTrigger_ByMouse = 1;

			// Action caused by keyboard.
			var GrooveSelectionChangeActionTrigger_ByKeyboard = 2;

			// Insert item first.
			var GrooveTreeViewInsertOrder_First = 1;

			// Insert item last.
			var GrooveTreeViewInsertOrder_Last = 2;

			// Insert item at root.
			var GrooveTreeViewInsertOrder_Root = 3;

			// Insert item first in alphabetical order.
			var GrooveTreeViewInsertOrder_Sort = 4;

			// Insert item as the next sibling of the specified parent item.
			var GrooveTreeViewInsertOrder_NextSibling = 5;

			// Collapse item.
			var GrooveTreeViewExpandOrder_Collapse = 1;

			// Expand item.
			var GrooveTreeViewExpandOrder_Expand = 2;

			// Toggle.
			var GrooveTreeViewExpandOrder_Toggle = 3;

			// The execution context is new (code has never executed)
			// Code can safely be added. 
			// You cannot set the state of an execution context to this value.
			var GrooveScriptExecutionContextState_New = 1;

			// The execution context is running. Code will execute
			// when called.
			// You cannot add code while in this state.
			var GrooveScriptExecutionContextState_Running = 2;

			// The execution context is closed and code is 
			// no longer running.
			// You cannot add code while in this state.
			var GrooveScriptExecutionContextState_Closed = 3;

			// No size information specified.
			var GrooveLayoutSizeType_None = 0;

			// Size information is in pixels.
			var GrooveLayoutSizeType_Pixels = 1;

			// Size information is in percent of available space.
			var GrooveLayoutSizeType_Percent = 2;

			// Size restrictions are to be removed.
			var GrooveLayoutSizeType_Unconstrained = 3;

			// Puts the execution context in a closed state
			// and removes it from the list of existing contexts
			var GrooveScriptExecutionContextShutdownFlag_Remove = 0;

			// Terminates and removes the code contained in the
			// execution context and resets the state to New
			var GrooveScriptExecutionContextShutdownFlag_Reset = 1;

			//**************************************************************************
			//
			// End from GrooveCommonComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveUIFramework.idl
			//
			//**************************************************************************

			var GrooveWindowResult_Cancel = -1;

			// Window operation was finished normally.
			var GrooveWindowResult_OK = 0;

			// Use to show or hide the Restore command.
			var GrooveWindowMenuCommand_Restore = 0x0001;

			// Use to show or hide the Minimize command.
			var GrooveWindowMenuCommand_Minimize = 0x0008;

			// Use to show or hide the Maximize command.
			var GrooveWindowMenuCommand_Maximize = 0x0010;

			// Use to show or hide the Close command.
			var GrooveWindowMenuCommand_Close = 0x0020;

			// UICommand's state should be rendered as unchecked.
			var GrooveCheckState_Unchecked = 0;

			// UICommand's state should be rendered as checked.
			var GrooveCheckState_Checked = 1;

			// UICommand's state should be rendered as indeterminate.
			var GrooveCheckState_Indeterminate = 2;

			//**************************************************************************
			//
			// End from GrooveUIFramework.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveStorageMgr.idl
			//
			//**************************************************************************

			// Groove chooses a format automatically.
			var GrooveSerializeType_Auto = 0x00;

			// MHTML format as defined in RFC 2557.
			var GrooveSerializeType_MIME = 0x01;

			// XML format.  Note that this format does not support binary
			// documents, but it may be a body type in MHTML.
			var GrooveSerializeType_XML = 0x02;

			// Use default serialization options (use none of the other
			// available options).
			var GrooveSerializeOption_Default = 0x0000;

			var GrooveParseOption_StripContentWhitespace = 0x01;

			// Body text.
			var GrooveContentType_Text = 1;

			var GrooveXLinkShowOption_Replace = 2;
			var GrooveXLinkSerializeOption_ByValue = 0;
			var GrooveXLinkActuateType_User = 0;
			var GrooveXLinkCompressOption_OnWire = 0x01;
			var GrooveXLinkDeserializeOption_Replace = 1;

			//**************************************************************************
			//
			// End from GrooveStorageMgr.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************

			// Property is private.
			var GrooveCommunicationsDirection_Both     = 0x3;

			//**************************************************************************
			//
			// End from GrooveComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveComponents.idl
			//
			//**************************************************************************

			// Property is private.
			var GroovePropertyFlag_Private     = 0x0000;

			//**************************************************************************
			//
			// End from GrooveComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCollectionMgr.idl
			//
			//**************************************************************************
			
			// Move the cursor to the next source row, traversing down through child rows and up 
			// through parent rows.
			var GrooveCollectionNavigationOp_NextAny = 0;

			// Navigate collapsed rows when moving the cursor (the default is to skip
			// collapsed rows).
			var GrooveCollectionNavigationOption_IncludeCollapsedRows = 0x0001;

			// First row in the collection.
			var GrooveCollectionCursorPosition_First = 0;

			// Last row in the collection.
			var GrooveCollectionCursorPosition_Last = 1;
			
			// Current row in the collection.  This position is useful for performing relative cursor 
			// movement.
			var GrooveCollectionCursorPosition_Current = 2;

			//**************************************************************************
			//
			// End from GrooveCollectionMgr.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveHelperPrivate.idl
			//
			//**************************************************************************

			var GrooveAccountDialogsSubForms_FindSubform = 38;
			var GrooveAccountDialogsSubForms_PropertySheetDialogSubform = 40;

			//**************************************************************************
			//
			// End from GrooveHelperPrivate.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveRecordDatabaseAlpha.idl
			//
			//**************************************************************************
			var GrooveFieldType_None    = 0; // Implied by VARTYPE
			var GrooveFieldType_String  = 1;
			var GrooveFieldType_Boolean = 2;
			var GrooveFieldType_I4      = 5;
			var GrooveFieldType_R8      = 7;
			var GrooveFieldType_Binary  = 8;
			var GrooveFieldType_DateTime = 9;
			var GrooveFieldType_Element = 10;

			var GrooveRecordDatabaseChangeType_AddRecord = 0;
			var GrooveRecordDatabaseChangeType_AddRecords = 1;
			var GrooveRecordDatabaseChangeType_DeleteRecord = 2;
			var GrooveRecordDatabaseChangeType_DeleteRecords = 3;
			var GrooveRecordDatabaseChangeType_ReplaceRecord = 4;
			var GrooveRecordDatabaseChangeType_SetField = 5;

			//**************************************************************************
			//
			// End from GrooveRecordDatabaseAlpha.idl
			//
			//**************************************************************************
			
			//**************************************************************************
			//
			// From GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************
			
			// Indicates that the status being requested
			// or reported is for inbound communications.
			var GrooveCommunicationsDirection_Inbound  = 0x1;

			// Indicates that the status being requested
			// or reported is for outbound communications.
			var GrooveCommunicationsDirection_Outbound = 0x2;

			// Indicates that the status being requested
			// or reported is for both inbound AND outbound
			// communications.
			var GrooveCommunicationsDirection_Both     = GrooveCommunicationsDirection_Inbound | GrooveCommunicationsDirection_Outbound;
			
			//**************************************************************************
			//
			// End from GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************

			//**************************************************************************
			//
			// From GrooveDataListAlpha.idl
			//
			//**************************************************************************
			
			// No summary.
			var GrooveDataListViewColumnSummaryType_None = 0;

			// Summary is the sum of the field values in the column.
			var GrooveDataListViewColumnSummaryType_FieldValuesSum = 1;
			
			// No grouping.
			var GrooveDataListGroupType_None = 0;

			// Rows are group by unique field values.
			var GrooveDataListGroupType_UniqueFieldValues = 1;
					
			// Group row is a break on the change in units of hours.
			var GrooveDataListGroupType_Hours = 2;

			// Group row is a break on the change in units of days.
			var GrooveDataListGroupType_Days = 3;

			// Group row is a break on the change in units of weeks.
			var GrooveDataListGroupType_Weeks = 4;

			// Group row is a break on the change in units of months.
			var GrooveDataListGroupType_Months = 5;

			// Group row is a break on the change in units of years.
			var GrooveDataListGroupType_Years = 6;
			
			//**************************************************************************
			//
			// End from GrooveDataListAlpha.idl
			//
			//**************************************************************************
			
			
			function OpenCacheFromRunTimeData(i_pRunTimeData, i_CacheName)
			{
				var pCache = null;
				if (i_CacheName == "" || i_CacheName == null)
					i_CacheName = "_ObjectCache";
				i_pRunTimeData.LockData();
				try
				{
					if (i_pRunTimeData.LockedHasItem(i_CacheName))
						pCache = i_pRunTimeData.LockedGetItem(i_CacheName);
					else
					{
						pCache = GrooveScriptFunctions.OpenSharedObjectTable("");
						i_pRunTimeData.LockedSetItem(i_CacheName, pCache);
					}
				}
				catch (error)
				{
				}
				i_pRunTimeData.UnlockData();
				return pCache;
			}
						
			function AddObjectToCache(i_Key, i_pObject, i_pCache)
			{
				i_pCache.SetItem(i_Key, i_pObject);
			}

			function IsObjectInCache(i_Key, i_pCache)
			{
				return i_pCache.HasItem(i_Key);
			}

			function OpenObjectFromCache(i_Key, i_pCache)
			{
				return i_pCache.GetItem(i_Key);
			}

			function RemoveObjectFromCache(i_Key, i_pCache)
			{
				if (IsObjectInCache(i_Key, i_pCache))
				{
					i_pCache.RemoveItem(i_Key);
				}
			}

			function ShutdownCache(i_pCache, i_Callback)
			{
				i_pCache.LockData();
				try
				{
					if (i_Callback)
					{
						var pEntryEnum = i_pCache.LockedCreateNameValueEnum();
						while (pEntryEnum.HasMore())
						{
							var pEntry = pEntryEnum.OpenNextPair();
							i_Callback(pEntry.First, pEntry.Second);
						}
					}
					pEntryEnum = null;
					delete pEntryEnum;
					CollectGarbarge();
					i_pCache.LockedRemoveAllItems();
				}
				catch(error)
				{
					i_pCache.LockedRemoveAllItems();
				}

				i_pCache.UnlockData();
			}

			function ThrowError(i_Description)
			{
				var objError = new Error(-213546871, i_Description);
				throw objError;
			}

			function CreateValidXMLName(i_Name)
			{
				var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
				var ValidXMLName = pXMLSyntax.ConvertToXMLName(i_Name);
				return ValidXMLName;
			}

			function ConvertToOriginalName(i_XMLName)
			{
				if (i_XMLName != "")
				{
					var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
					var OriginalName = pXMLSyntax.ConvertFromXMLName(i_XMLName);
					return OriginalName;
				}
				else
					return i_XMLName;
				
			}

			// get the numerical value from a number string, NaN if it is not valid
			function GetValidNumber(i_NumberString, i_UIDelegate)
			{
				// Replace all non-valid characters in the number string.
				var NumberString = i_NumberString.replace(/[^\d,-\.\(]/g, "");
				// If the number string has a paren in it, replace with a negative symbol.
				NumberString = NumberString.replace(/\(/g, "-");
				if (NumberString.toString() != "")
				{
					try
					{
						var ValidNumber = i_UIDelegate.ParseNumber(NumberString);
						if (isNaN(ValidNumber))
						{
							ValidNumber = Number(NumberString);
							if (isNaN(ValidNumber))
								ValidNumber = Number.NaN;
						}
					}
					catch (error)
					{
						ValidNumber = Number.NaN;
					}
				}

				return ValidNumber;
			}

			function CreateGUID()
			{
				var pGuidGenerator = GROOVE_GLOBAL_MISC_POINTER.OpenGUIDGenerator();	
				var GUID = pGuidGenerator.CreateGUIDBase16();
				return GUID;
			}

			function SafeOpenProperty(i_pPropertyList, i_PropertyName, i_DefaultValue)
			{
				if (i_pPropertyList.PropertyExists(i_PropertyName))
					return i_pPropertyList.OpenProperty(i_PropertyName);
				else
					return i_DefaultValue;
			}

			function GetBasePath()
			{
				var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
				var PRootPath = pStorageURISyntax.InstallDataRootPath;
				var strPath = PRootPath + "ToolData\\groove.net\\GrooveForms3\\";
				return strPath;
			}

			function BuildPathFromBase(i_PreRootPath, i_PostRootPath)
			{
				var BasePath = GetBasePath();
				return i_PreRootPath + BasePath + i_PostRootPath;
			}

			function OpenRecordType()
			{
				var RecordType = "urn:groove.net:FormsToolUserData";
				return RecordType;
			}

			function GetFormsPreferenceAsBool(PropertyList, i_Key, i_bDefault)
			{
				var Account = OpenAccountFromPropertyList(PropertyList);
				var PreferencesPropertyList = Account.PreferencesProvider.PropertyList;
				var FormsPreferences;
				if (!PreferencesPropertyList.PropertyExists("FormsProperties"))
					FormsPreferences = PreferencesPropertyList.CreatePropertyAsPropertyList("FormsProperties");
				else
					FormsPreferences = PreferencesPropertyList.OpenPropertyAsPropertyList("FormsProperties");
				
				var o_Value = i_bDefault;
				if (FormsPreferences.PropertyExists(i_Key))
					o_Value = FormsPreferences.OpenPropertyAsBool(i_Key);

				return o_Value;
			}

			function GetColumnWidthStyleStringFromEnumValue(i_ColumnWidthStyle)
			{
				switch (i_ColumnWidthStyle)
				{
					case GrooveFormsToolViewColumnWidthStyle_Percent:
						return "%";
					case GrooveFormsToolViewColumnWidthStyle_Pixels:
					default:
						return "";
				}
			}

			function GetColumnSortOrderStringFromEnumValue(i_ColumnSortOrder)
			{
				switch (i_ColumnSortOrder)
				{
					case GrooveFormsToolViewColumnSortOrder_Ascending:
						return "Ascending";
					case GrooveFormsToolViewColumnSortOrder_Descending:
						return "Descending";
					case GrooveFormsToolViewColumnSortOrder_Both:
						return "Ascending,Descending";
					case GrooveFormsToolViewColumnSortOrder_Ordinal:
					default:
						return "Ordinal";
				}
			}

			function GetEnumValueFromDateFormatString(i_DateFormat)
			{
				switch (i_DateFormat)
				{
					case "Default":
						return GrooveIntlDateFormatStyle_Default;
					case "Full":
					case "Long":
						return GrooveIntlDateFormatStyle_Long;
					case "Medium":
					case "Short":
					default:
						return GrooveIntlDateFormatStyle_Short;
				}
			}

			function GetStringForFieldTypeEnumValue(i_FieldType)
			{
				switch (i_FieldType)
				{
					case GrooveFormsToolFieldType_Text:
						return "Text";
					case GrooveFormsToolFieldType_MultiLineText:
						return "Multi-line Text";
					case GrooveFormsToolFieldType_Number:
						return "Number";
					case GrooveFormsToolFieldType_UnformattedNumber:
						return "Unformatted Number";
					case GrooveFormsToolFieldType_Currency:
						return "Currency";
					case GrooveFormsToolFieldType_Date:
						return "Date";
					case GrooveFormsToolFieldType_DateTime:
						return "Date Time";
					case GrooveFormsToolFieldType_OptionButtons:
						return "Option Buttons";
					case GrooveFormsToolFieldType_CheckBox:
						return "Check Box";
					case GrooveFormsToolFieldType_DropDownList:
						return "Drop-down List";
					case GrooveFormsToolFieldType_ListBox:
						return "List Box";
					case GrooveFormsToolFieldType_Password:
						return "Password";
					case GrooveFormsToolFieldType_RichText:
						return "Rich Text";
					case GrooveFormsToolFieldType_Attachments:
						return "Attachments";
					case GrooveFormsToolFieldType_FormHeading:
						return "Form Heading";
					case GrooveFormsToolFieldType_SectionHeading:
						return "Section Heading";
					case GrooveFormsToolFieldType_StaticText:
						return "Static Text";
					case GrooveFormsToolFieldType_HorizontalLine:
						return "Horizontal Line";
					case GrooveFormsToolFieldType_NewLine:
						return "New Line";
					case GrooveFormsToolFieldType_ScriptButton:
						return "Script Button";
					case GrooveFormsToolFieldType_Image:
						return "Image";
					case GrooveFormsToolFieldType_SystemField:
						return "System Field";
				}
			}

			function GetValueFromQueryString(i_Key, i_Querystring, i_Default, i_Sep)
			{
				var strReturn = "";
				if (typeof i_Default != "undefined")
					strReturn = i_Default;

				var Separator = "=[^&]*";
				if (typeof i_Sep != "undefined")
					Separator = i_Sep;
				var objRegExp = new RegExp(i_Key + Separator, "");
				if (objRegExp.test(i_Querystring))
				{
					var strPair = objRegExp.exec(i_Querystring);
					var arrPair = strPair[0].split("=");
					if (arrPair.length == 2 && arrPair[0] == i_Key)
						strReturn = unescape(arrPair[1]);
				}

				return strReturn;
			}

			function AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, i_LayoutType)
			{
				var CellSizeObj = GrooveScriptFunctions.CreateNewObject(i_LayoutType);
				var CellObj = CellSizeObj.Cell();
				CellObj.Name = i_ObjectName + "Cell";

				if (i_Remove && i_Layout.IsControlInLayout(i_ObjectName))
					i_Layout.RemoveCellContents(CellObj);

				if (!i_Remove && !i_Layout.IsControlInLayout(i_ObjectName))
					i_Layout.AddControlByName(i_ObjectName, CellObj);
			}

			function AddRemoveCellContents(i_ObjectName, i_Layout, i_Remove)
			{
				AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, "Groove.HTMLTableLayoutControlInfo");
			}

			function AddRemoveMultiCellContents(i_ObjectName, i_Layout, i_Remove)
			{
				AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, "Groove.MultiCellLayoutControlInfo");
			}

			function ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, i_LayoutType)
			{
				var CellSizeObj = GrooveScriptFunctions.CreateNewObject(i_LayoutType);
				var CellObj = CellSizeObj.Cell();
				CellObj.Name = i_ObjectName + "Cell";
				if (i_Remove)
					CellSizeObj.SetHeight(0, GrooveLayoutSizeType_Pixels);
				else
					CellSizeObj.SetHeight(i_Size, GrooveLayoutSizeType_Pixels);
				i_Layout.AdjustCellLayout(CellObj, CellSizeObj);
			}
			
			function ShowHideCellContents(i_ObjectName, i_Layout, i_Size, i_Remove)
			{
				ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, "Groove.HTMLTableLayoutControlInfo")
			}

			function ShowHideMultiCellContents(i_ObjectName, i_Layout, i_Size, i_Remove)
			{
				ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, "Groove.MultiCellLayoutControlInfo")
			}

			function SetSelectionByItemData(i_ComboBox, i_Value)
			{
				i_ComboBox.SetSelectionByIndex(-1);
				for (var i = 0; i < i_ComboBox.Count; i++)
				{
					if (i_ComboBox.GetItemData(i) == i_Value)
					{
						i_ComboBox.SetSelectionByIndex(i);
						return;
					}
				}
			}

			function LocalParseNumber(i_NumberString)
			{
				try
				{
					if (i_NumberString != "")
					{
						var NumberFormat = g_Intl.CreateNumberFormat(GROOVE_NULL);
						var NumberFormattable = NumberFormat.Parse(i_NumberString, GROOVE_NULL);

						var NumberValue = Number.NaN;
						if (NumberFormattable.Type == GrooveIntlFormattableType_Double)
							NumberValue = NumberFormattable.Double;
						else if (NumberFormattable.Type == GrooveIntlFormattableType_Long)
							NumberValue = NumberFormattable.Long;

						return NumberValue;
					}
					else
						return Number.NaN;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function LocalFormatNumber(i_Value, i_Precision, i_Symbol)
			{
				try
				{
					// If symbol exists the value is of type currency.
					if (i_Symbol != null)
					{
						// Internationalization message formatting objects.
						var pFormatParameters = GrooveScriptFunctions.CreateNewObject("Groove.UnknownArray");
						var pMessageFormat = g_Intl.CreateMessageFormat("", GROOVE_NULL);
						// Set the precision value if it exists.
						var StringPrecision = "";
						var NumberPrecision = Number(i_Precision);
						if (NumberPrecision > 0)
						{
							StringPrecision = ".";
							var i = 0;
							var iCount = NumberPrecision;
							while (i < iCount)
							{
								StringPrecision += "0";
								i++;
							}
						}

						// Place quotes around the symbol if it is not the international currency character.
						if (i_Symbol != "\u00A4")
							i_Symbol = "'" + i_Symbol + "'";
						// This looks confusing, but it will end up creating a string like this:
						// "{0,number,'$'#,##0.00;('$'#,##0.00)}". The section before the semicolon
						// is for positive values, after is for negative values.
						var NumberFormat = i_Symbol + "#,##0" + StringPrecision;
						var FormatPattern = "{0,number," + NumberFormat + ";(" + NumberFormat + ")}";

						// Setup message formatter parameter array.
						pFormatParameters.RemoveAll();
						var pFormattable = g_Intl.CreateFormattableFromDouble(i_Value);
						pFormatParameters.Add(pFormattable);

						// Set message formatter pattern.
						pMessageFormat.ApplyPattern(FormatPattern);

						// Create formatted message.
						var NumberValue = pMessageFormat.Format(pFormatParameters);
						return NumberValue;
					}
					else
					{
						var NumberFormat = g_Intl.CreateNumberFormat(GROOVE_NULL);

						// Set the precision for the number.
						var NumberPrecision = Number(i_Precision);
						if (!isNaN(NumberPrecision))
						{
							NumberFormat.MinimumFractionDigits = NumberPrecision;
							NumberFormat.MaximumFractionDigits = NumberPrecision;
						}

						// Format the number into a string value.
						var NumberValue = NumberFormat.FormatDouble(i_Value, "", GROOVE_NULL);
						return NumberValue;
					}
				}
				catch (error)
				{
					return i_Value;
				}
			}

			function IsSystemScript(i_Name)
			{
				if (i_Name.indexOf("SystemCallouts") >= 0)
					return true;
				else
					return false;
			}

			function CheckForSameDataType(i_DataType, i_Field)
			{
				// No one should inherit from the readers and editors fields.
				var FieldName = i_Field.IGrooveFormsToolDesignObject.Name;
				if (FieldName == "_Readers" || FieldName == "_Editors")
					return false;

				// If the data type is the same, return true.
				if (i_DataType == i_Field.DataType)
					return true;
				else
					return false;
			}

		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     @           "  ‡             ›  ›                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Ë               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName>   G r o o v e F o r m s H e l p e r F u n c t i o n s 3 . g s l         ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT     ÄSCRIPT  CRIPT  ÄSCRIPT       ÄSRC  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T y p e L i b r a r i e s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       = O p e n        ÄSCRIPT       ÄSRC*  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T e x t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  LM   § A   | I      ∑          )      ÄSCRIPT         › Ä

			var g_FORMS_TEMPLATE_FILTER					= "Forms Design Template (*.fdt)|*.fdt";
			var g_FORMS_SCRIPT_FILTER					= "Script (*.js;*.vbs)|*.js;*.vbs";
			var g_FORMS_STYLE_FILTER					= "CSS (*.css)|*.css";

			var FORMS_TOOL_DELETE_FIELD					= "Deleting this field will delete it from all forms and views. Do you want to continue?";
			var FORMS_TOOL_DELETE_FIELD_TITLE			= "Delete Field?";
			
			var FORMS_TOOL_DELETE_VIEW_OR_FORM			= "Deleting a form or view cannot be undone.  Do you want to continue?";
			var FORMS_TOOL_DELETE_VIEW_OR_FORM_TITLE	= "Delete Form/View?";

			var FORMS_TOOL_DELETE_SCRIPT				= "Deleting a script cannot be undone.  Do you want to continue?";
			var FORMS_TOOL_DELETE_SCRIPT_TITLE			= "Delete Script?";

			var FORMS_TOOL_DELETE_STYLE					= "Deleting a style cannot be undone.  Do you want to continue?";
			var FORMS_TOOL_DELETE_STYLE_TITLE			= "Delete Style?";

			var FORMS_TOOL_DIRTY_SAVE					= "Do you want to save your changes?";
			var FORMS_TOOL_DIRTY_SAVE_TITLE				= "Save Changes?";
			var FORMS_V3_COMP_RESOURCE_URL				= "http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.Tools.Business.GrooveForms.GrooveForms_TPL&Version=3&Factory=Open";
			
      //**************************************************************************
			//
			// From GrooveDataListAlpha.idl
			//
			//**************************************************************************

      var GrooveDataListDateTimeFormat_Default = 0;
      var GrooveDataListDateTimeFormat_ShortDate = 1;
      var GrooveDataListDateTimeFormat_LongDate = 2;
      var GrooveDataListDateTimeFormat_Hour = 4;
      var GrooveDataListDateTimeFormat_HourInDay = 5;
      var GrooveDataListDateTimeFormat_DayInMonth = 6;
      var GrooveDataListDateTimeFormat_DayOfWeek = 7;
      var GrooveDataListDateTimeFormat_ShortDayOfWeek = 8;
      var GrooveDataListDateTimeFormat_DayInYear = 9;
      var GrooveDataListDateTimeFormat_WeekInMonth = 10;
      var GrooveDataListDateTimeFormat_WeekInYear = 11;
      var GrooveDataListDateTimeFormat_Month = 12;
      var GrooveDataListDateTimeFormat_ShortMonth = 13;
      var GrooveDataListDateTimeFormat_MonthInYear = 14;
      var GrooveDataListDateTimeFormat_ShortMonthInYear = 15;
      var GrooveDataListDateTimeFormat_Year = 16;
      var GrooveDataListDateTimeFormat_ShortYear = 17;
      var GrooveDataListDateTimeFormat_ShortDateShortTime = 18;
      var GrooveDataListDateTimeFormat_MediumDateMediumTime = 19;
      var GrooveDataListDateTimeFormat_ShortTime = 20;
      var GrooveDataListDateTimeFormat_MediumTime = 21;

			//**************************************************************************
			//
			// From GlobalHelperFunctions
			//
			//**************************************************************************

			// IE registry
			var MSIE_KEY = "Software\\Microsoft\\Internet Explorer";

			var PROPERTY_CANONICAL_URL = "_CanonicalURL";
			var PROPERTY_TOOL_CONTAINER = "_ToolContainer";
			var PROPERTY_DYNAMICS_MANAGER = "_DynamicsManager";
			var PROPERTY_TELESPACE_DATABASE = "_TelespaceDatabase";
			var PROPERTY_TELESPACE_PROVIDER = "_TelespaceProvider";
			var PROPERTY_TELESPACE = "_Telespace";
			var PROPERTY_TOOL_DISPLAY_NAME = "_ToolDisplayName";
			var PROPERTY_TOOL_NAME = "_ToolName";
			var PROPERTY_TOOL_URL = "_ToolURL";
			var PROPERTY_TOOL = "_Tool";
			var PROPERTY_FORM = "_Form";
			var PROPERTY_OBJECT_ENTRY_STORE = "_ObjectEntryStore";
			var PROPERTY_ACCOUNT_GUID = "_AccountGUID";
			var PROPERTY_CURRENT_IDENTITY = "_CurrentIdentity";
			var PROPERTY_ACCOUNT = "_Account";

			// UIPropertyList constants
			var UIPROPERTY_TOP_LEVEL_WINDOW = "_TopLevelWindow";
			var UIPROPERTY_URLNAVIGATOR = "_URLNavigator";
			var UIPROPERTY_WINDOW_ACCOUNT = "_WindowAccount";
			var UI_PROPERTY_UIACTIVE_COMPONENT = "_UIActiveComponent";

			// Access control strings
			var STR_COMMON_ACCESS_CONTROL_COMPONENT_GROUP_OBJECT_ID = "$ComponentGroup";			
			var STR_COMMON_ACCESS_CONTROL_TELESPACE_MANAGER_ROLE_NAME = "$Telespace.Manager";			
			var STR_COMMON_ACCESS_CONTROL_TELESPACE_SCOPE_URL = "";

			var GROOVE_VK_ENTER = 0x0d;
			var GROOVE_VK_INSERT = 0x2d;
			var GROOVE_VK_DELETE = 0x2e;
			var GROOVE_VK_ESC = 0x1B;
			var GROOVE_VK_D = 0x44;

			// Keystroke Message Values
			var GROOVE_WM_KEYDOWN = 0x100;
			var GROOVE_WM_KEYUP = 0x101;

			// Keystate Modifier Values
			var GROOVE_KEYMOD_SHIFT = 0x00000001;
			var GROOVE_KEYMOD_CONTROL = 0x00000002;
			var GROOVE_KEYMOD_ALT = 0x00000004;

			// Global pointers
			var GROOVE_GLOBAL_MISC_POINTER = GrooveScriptFunctions.CreateNewObject("Groove.SystemServices").Misc;
			var GROOVE_NULL = GrooveScriptFunctions.CreateNewObject("");

			// Invalid date constant
			var INVALID_DATE = -0xFFFFFFFFFFFFF;
			
			// Returns all characters to the right of the search string's
			// first occurrence, searching from left to right.  Returns the
			// input string if the search string isn't found.
			//
			function Right(i_InputString, i_SearchString)
			{
				var FromPos = i_InputString.indexOf(i_SearchString);
				if (-1 == FromPos)
				{
					return i_InputString;
				}

				FromPos += i_SearchString.length;
				return i_InputString.substring(FromPos, i_InputString.length);
			}

			// Returns all characters to the right of the search string's
			// first occurrence, searching from right to left.  Returns the
			// input string if the search string isn't found.
			//
			function RightBack(i_InputString, i_SearchString)
			{
				var FromPos = i_InputString.lastIndexOf(i_SearchString)
				if (-1 == FromPos)
				{
					return i_InputString;
				}
				
				FromPos += i_SearchString.length;
				return i_InputString.substring(FromPos, i_InputString.length);
			}

			// Returns all characters to the left of the search string's
			// first occurrence, searching from left to right.  Returns the
			// input string if the search string isn't found.
			//
			function Left(i_InputString, i_SearchString)
			{
				var ToPos = i_InputString.indexOf(i_SearchString);
				if (-1 == ToPos)
				{
					return i_InputString;
				}

				return i_InputString.substring(0, ToPos);
			}

			// Returns all characters to the left of the search string's
			// first occurrence, searching from right to left.  Returns the
			// input string if the search string isn't found.
			//
			function LeftBack(i_InputString, i_SearchString)
			{
				var ToPos = i_InputString.lastIndexOf(i_SearchString);
				if (ToPos == -1)
				{
					return i_InputString;
				}

				return i_InputString.substring(0, ToPos);
			}

			// This function trims leading and trailing whitespace off the string
			function TrimEnds(String)
			{
				return TrimTail(TrimHead(String));
			}

			// This function trims leading whitespace off the string
			function TrimHead(String)
			{
				var length = String.length;
				for (i=0; i<length; i++)
				{
					if (" " != String.charAt(i))
						break;
				}
				return String.substr(i, length);
			}

			// This function trims trailing whitespace off the string
			function TrimTail(String)
			{
				var length = String.length;
				for (i=length-1; i>=0; i--)
				{
					if (" " != String.charAt(i))
						break;
				}
				return String.substr(0, i + 1);
			}	
	
			function CreateBSTREnum()
			{
				var BSTREnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateBSTREnum();
				var BSTREnumCreate = BSTREnum.BSTREnumCreate;
				return BSTREnumCreate;
			}

			function CreateStringStringEnum(i_bSort)
			{
				if (typeof i_bSort == "undefined")
					i_bSort = false;
				var StringStringEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateStringStringEnum(i_bSort);
				var StringStringEnumCreate = StringStringEnum.StringStringEnumCreate;
				return StringStringEnumCreate;
			}

			function CreateVARIANTEnum()
			{
				var VARIANTEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateVARIANTEnum();
				var VARIANTEnumCreate = VARIANTEnum.VARIANTEnumCreate;
				return VARIANTEnumCreate;
			}

			function CreateNameValueEnum()
			{
				var NameValueEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum();
				var NameValueEnumCreate = NameValueEnum.NameValueEnumCreate;
				return NameValueEnumCreate;
			}

			function CreateDoubleEnum()
			{
				var DoubleEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateDoubleEnum();
				var DoubleEnumCreate = DoubleEnum.DoubleEnumCreate;
				return DoubleEnumCreate;
			}

			function CreateUnknownEnumFromStringIIDs(i_EnumIID, i_EntryIID)
			{
				var UnknownEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs(i_EnumIID, i_EntryIID);
				var UnknownEnumCreate = UnknownEnum.UnknownEnumCreate;
				return UnknownEnumCreate;
			}

			function CreateByteInputStreamFromFile(i_File, i_DenyNone)
			{
				if (null == i_DenyNone)
					i_DenyNone = false;

				var ByteInputStream;
				try
				{
					ByteInputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteInputStreamFromFile2(i_File, i_DenyNone);
				}
				catch (e)
				{
				}
				return ByteInputStream;
			}

			function CreateByteOutputStreamFromFile(i_File, i_Append, i_ReadOnly)
			{
				if (null == i_Append)
					i_Append = false;

				if (null == i_ReadOnly)
					i_ReadOnly = false;

				var ByteOutputStream;
				try
				{
					ByteOutputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteOutputStreamFromFile(i_File, i_Append, i_ReadOnly);
				}
				catch(e)
				{
				}
				return ByteOutputStream;
			}

			function CreateMemoryByteStore(i_PageSize)
			{
				if (null == i_PageSize)
					i_PageSize = 0;

				var MemoryByteStore = GROOVE_GLOBAL_MISC_POINTER.StoreFactory.CreateMemoryByteStore(i_PageSize);
				return MemoryByteStore;
			}

			function OpenAccountFromPropertyList(pPropertyList)
			{
				return pPropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE_PROVIDER);
			}

			function OpenFullNameFromCurrentIdentity(PropertyList, i_IncludeAnnotation)
			{
				if (i_IncludeAnnotation == null)
					i_IncludeAnnotation = true;

				var Telespace = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
				var pCurrentIdentity = Telespace.OpenCurrentIdentity();
				var pCurrentIdentityContact = pCurrentIdentity.Contact;
				return OpenFullNameFromContact(pCurrentIdentityContact, i_IncludeAnnotation);
			}

			function OpenFullNameFromContact(i_Contact, i_IncludeAnnotation)
			{
				if (i_IncludeAnnotation == null)
					i_IncludeAnnotation = true;

				var Name;
				if (i_IncludeAnnotation)
					Name = i_Contact.ContactStoreEntry.DisplayName;
				else
					Name = i_Contact.OpenVCard().OpenIdentification().OpenFullName();
				return Name;
			}

			function OpenRecordCreatorName(i_pPropertyList, i_pRecord, i_UseAlias)
			{
				return OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, "_CreatedByURL");
			}

			function OpenRecordModifierName(i_pPropertyList, i_pRecord, i_UseAlias)
			{
				return OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, "_ModifiedByURL");
			}

			function OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, i_URLField)
			{
				if (i_UseAlias == null)
					i_UseAlias = false;

				var CS = i_pPropertyList.OpenProperty("_ContactStore");
				var Telespace = i_pPropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);

				try
				{
					var Transaction = Telespace.OpenTransaction(true);
					var CURL = i_pRecord.OpenFieldAsString(i_URLField);
					Transaction.Commit();

					if (CS.DoesExist(CURL))
					{
						var CurrContact = CS.Open(CURL);
						return OpenFullNameFromContact(CurrContact);
					}
					else
						return false;
				}
				catch (error)
				{
					Transaction.Abort();
					return false;
				}
			}

			function Helper_GetRoles(i_ScopeURL, i_pTelespace, i_ObjectID)
			{
				var pObjectEntryStore = i_pTelespace.ObjectEntryStore;
				if (pObjectEntryStore)
					{
					var ObjEntry = pObjectEntryStore.Open(i_ScopeURL, i_ObjectID);
					return ObjEntry.AccessControl.IGrooveRoles;
					}
				return null;
			}

			function Helper_GetRoleForUser(i_Roles, i_TemplateRoleEnum, i_ContactURL)
			{
				i_TemplateRoleEnum.Reset();
				while (i_TemplateRoleEnum.HasMore())
				{
					var TemplateRole = i_TemplateRoleEnum.OpenNext();
					if (TemplateRole.Visible)
					{
						var Role = i_Roles.Open(TemplateRole.Name);
						if (Role.ContainsMember(i_ContactURL))
							return TemplateRole;
					}
				}
			}

			function SetClipboardEmpty()
			{
				var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
				var pClipboard = pUIManager.OpenClipboard();
				pClipboard.SetEmpty();
			}

			function CopyAsLinkToClipboard(i_CanonicalURL, i_DisplayName)
			{
				var pStorageMgr = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				var pElement = pStorageMgr.CreateTemporaryElement("GrooveLink");
				pElement.SetAttribute("DisplayName", i_DisplayName);
				pElement.SetAttribute("URL", i_CanonicalURL);

				var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
				var pClipboard = pUIManager.OpenClipboard();
				pClipboard.SetDataAsElement("GrooveLink", pElement);
			}

			//	Custom object, typically used for DLLs and EXEs
			function VersionObject(i_VersionString)
			{
				var VerArray = i_VersionString.split(".");
				if (typeof i_VersionString != "undefined")
					this.VersionString = i_VersionString;
				if (typeof VerArray[0] != "undefined")
					this.MajorVersion = parseInt(VerArray[0]);
				if (typeof VerArray[1] != "undefined")
					this.MinorVersion = parseInt(VerArray[1]);
				if (typeof VerArray[2] != "undefined")
					this.BuildVersion = parseInt(VerArray[2]);
				if (typeof VerArray[3] != "undefined")
					this.SubBuildVersion = parseInt(VerArray[3]);
			}

			function GetMSIEVersion()
			{
				//	Works with IE4.0 and later
				//  See  http://support.microsoft.com/default.aspx?scid=kb;EN-US;q164539 for more
				//  information as to how IE reports version numbers back for the various
				//  versions of IE.
				var App = GrooveScriptFunctions.CreateNewObject("Groove.Application");
				var VerString = App.ReadRegistryValue(GrooveRegistryKeyValue_LocalMachine,
													  MSIE_KEY, "Version");
				if (typeof VerString != "undefined" && VerString != "")
				{
					var MSIEVersion = new VersionObject(VerString);
					return MSIEVersion;
				}
				else
					return null;
			}
			
			function ResolveLinkTargetPathName(i_Path)
			{
				if(IsLNKShortcutFile(i_Path))
				{
					var pIFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

					var SourcePath = pIFileSystemServices.OpenShortcutFileInfo(i_Path);
					return ResolveLinkTargetPathName(SourcePath);
				}
				else
				{
					return i_Path;
				}
			}

			function IsLNKShortcutFile(i_Path)
			{
				var pIFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
				var LNKExtension = "lnk";
				if(pIFileSystemServices.IsFileLinkByPath(i_Path) &&
						(LNKExtension == pIFileSystemServices.OpenFileExtension(i_Path).toLowerCase()))
					return true;
				else
					return false;
			}


			//**************************************************************************
			//
			// End from GlobalHelperFunctions
			//
			//**************************************************************************
			
			//**************************************************************************
			//
			// From ArrayHelperFunctions
			//
			//**************************************************************************

			function CompressArray(i_Array, i_IndexToRemove)
			{
				var newArray = i_Array.slice(i_IndexToRemove, i_IndexToRemove+1);
				var retArray = new Array();
				var x = 0;
				for (var i = 0; i < i_Array.length; i++)
				{
					if (typeof i_Array[i] != "undefined")
					{
						retArray[x] = i_Array[i];
						x++;
					}
				}
				return retArray;						
			}

			//**************************************************************************
			//
			// End from ArrayHelperFunctions
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From CalendarHelper
			//
			//**************************************************************************

			var g_Intl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
	
			// Returns string
			function FormatDate(i_Millis, i_FormatStyle)
			{
				var DateFormat = g_Intl.CreateDateFormatForDate(i_FormatStyle, GROOVE_NULL);
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				return DateFormat.Format(DateObj, "", GROOVE_NULL);
			}

			// Returns string
			function FormatTime(i_Millis, i_FormatStyle)
			{
				var DateFormat = g_Intl.CreateDateFormatForTime(i_FormatStyle, GROOVE_NULL);
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				return DateFormat.Format(DateObj, "", GROOVE_NULL);
			}

			// Returns string
			function FormatDateTime(i_Millis, i_DateStyle, i_TimeStyle)
			{
				var DateFormat = g_Intl.CreateDateFormatForDateTime(i_DateStyle, i_TimeStyle, GROOVE_NULL);
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				return DateFormat.Format(DateObj, "", GROOVE_NULL);
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseDate(i_DateString, i_FormatStyle)
			{		
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDate(i_FormatStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseTime(i_TimeString, i_FormatStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForTime(i_FormatStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_TimeString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseDateTime(i_DateTimeString, i_DateStyle, i_TimeStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDateTime(i_DateStyle, i_TimeStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateTimeString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function ParseDateAndTime(i_DateString, i_DateStyle, i_TimeString, i_TimeStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDate(i_DateStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateString, GROOVE_NULL);
					var TimeFormat = g_Intl.CreateDateFormatForTime(i_TimeStyle, GROOVE_NULL);
					var TimeObj = TimeFormat.Parse(i_TimeString, GROOVE_NULL);
					var DateTimeObj = MergeDateAndTime(DateObj, TimeObj);
					return DateTimeObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function MergeDateAndTime(i_DateObj, i_TimeObj)
			{
				var Calendar = g_Intl.CreateCalendar();

				Calendar.DateTime = i_DateObj;
				var Year = Calendar.Get(GrooveIntlCalendarField_Year);
				var Month = Calendar.Get(GrooveIntlCalendarField_Month);
				var Day = Calendar.Get(GrooveIntlCalendarField_DayOfMonth);

				Calendar.DateTime = i_TimeObj;
				Calendar.SetDate(Year, Month, Day);

				return Calendar.DateTime;
			}

			// Creates and returns an IGrooveCalendar for the specified date/time
			function CreateCalendar(i_Millis)
			{
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				var Calendar = g_Intl.CreateCalendar();
				Calendar.DateTime = DateObj;
				return Calendar;
			}

			function StartOfDay(i_Millis)
			{
				var Calendar = CreateCalendar(i_Millis);

				var Year = Calendar.Get(GrooveIntlCalendarField_Year);
				var Month = Calendar.Get(GrooveIntlCalendarField_Month);
				var Day = Calendar.Get(GrooveIntlCalendarField_DayOfMonth);

				Calendar.Clear();
				Calendar.SetDate(Year, Month, Day);

				return Calendar.DateTime.RawDateTime;
			}

			function EndOfDay(i_Millis)
			{
				var Start = StartOfDay(i_Millis);
				var Calendar = CreateCalendar(Start);

				Calendar.Add(GrooveIntlCalendarField_DayOfMonth, 1);
				Calendar.Add(GrooveIntlCalendarField_Millisecond, -1);

				return Calendar.DateTime.RawDateTime;
			}

			//**************************************************************************
			//
			// End from CalendarHelper
			//
			//**************************************************************************

			//**************************************************************************
			//
			// From GrooveClient.idl
			//
			//**************************************************************************
			
			// "Abort, Retry, Ignore" buttons.
			var GrooveMessageBoxStyle_AbortRetryIgnore = 0x0001;
			
			// "Cancel, Try, Continue" buttons.
			var GrooveMessageBoxStyle_CancelTryContinue = 0x0002;
			
			// "OK" button.
			var GrooveMessageBoxStyle_OK = 0x0004;
			
			// "OK, Cancel" buttons.
			var GrooveMessageBoxStyle_OKCancel = 0x0008;
			
			// "Retry, Cancel" buttons.
			var GrooveMessageBoxStyle_RetryCancel = 0x0010;
			
			// "Yes, No" buttons.
			var GrooveMessageBoxStyle_YesNo = 0x0020;
			
			// "Yes, No, Cancel" buttons.
			var GrooveMessageBoxStyle_YesNoCancel = 0x0040;

			// No icon.
			var GrooveMessageBoxIcon_None = 0x0000;

			// Exclamation icon.
			var GrooveMessageBoxIcon_Exclamation = 0x0080;

			// Warning icon.
			var GrooveMessageBoxIcon_Warning = 0x0081;

			// Information icon.
			var GrooveMessageBoxIcon_Information = 0x0100;

			// Asterisk icon.
			var GrooveMessageBoxIcon_Asterisk = 0x0101;

			// Question icon has been deprecated. Use Warning or Information as appropriate

			// Stop icon.
			var GrooveMessageBoxIcon_Stop = 0x0400;
			
			// Error icon.
			var GrooveMessageBoxIcon_Error = 0x0401;
			
			// Hand icon.
			var GrooveMessageBoxIcon_Hand = 0x0402;

			// OK.
			var GrooveMessageBoxResultCode_OK = 1;

			// Cancel.
			var GrooveMessageBoxResultCode_Cancel = 2;

			// Abort.
			var GrooveMessageBoxResultCode_Abort = 3;

			// Retry.
			var GrooveMessageBoxResultCode_Retry = 4;

			// Ignore.
			var GrooveMessageBoxResultCode_Ignore = 5;

			// Yes.
			var GrooveMessageBoxResultCode_Yes = 6;

			// No.
			var GrooveMessageBoxResultCode_No = 7;

			// Try Again.
			var GrooveMessageBoxResultCode_TryAgain = 10;

			// Continue.
			var GrooveMessageBoxResultCode_Continue = 11;

			// No special style.
			var GrooveInputBoxStyle_None = 0;

			// Password style.
			var GrooveInputBoxStyle_Password = 1;

			// AllowEmptyValue style.
			var GrooveInputBoxStyle_AllowEmptyValue = 2;

			// System directory.
			var GrooveDirectoryValue_System = 1;

			// Temp directory.
			var GrooveDirectoryValue_Temp = 2;
			
			// System registry key for GrooveRegistryKeyValue as Local Machine. 
			var GrooveRegistryKeyValue_LocalMachine = 1;

				// Dialog box value OK.
			var GrooveDialogBoxResultCode_OK = 1;

			// Dialog box value Cancel. 
			var GrooveDialogBoxResultCode_Cancel = 2;
			//**************************************************************************
			//
			// End from GrooveClient.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveInternationalization.idl
			//
			//**************************************************************************

			// Full.
			var GrooveIntlDateFormatStyle_Full = 0;

			// Long.
			var GrooveIntlDateFormatStyle_Long = 1;

			// Medium.
			var GrooveIntlDateFormatStyle_Medium = 2;

			// Short.
			var GrooveIntlDateFormatStyle_Short = 3;

			// Default.
			var GrooveIntlDateFormatStyle_Default = GrooveIntlDateFormatStyle_Short;

			// DOUBLE floating point value.
			var GrooveIntlFormattableType_Double = 1;

			// LONG signed integer value.
			var GrooveIntlFormattableType_Long = 2;

			// Era field, e.g. 0..1 (calendar specific).
			var GrooveIntlCalendarField_Era = 0;

			// Year field, e.g. 1..N.
			var GrooveIntlCalendarField_Year = 1;

			// Month field, e.g. 0..11.
			var GrooveIntlCalendarField_Month = 2;

			// Week-Of-Year field, e.g. 1..53.
			var GrooveIntlCalendarField_WeekOfYear = 3;

			// Week-Of-Month field, e.g. 0..6.
			var GrooveIntlCalendarField_WeekOfMonth = 4;

			// Day-Of-Month field, e.g. 1..31.
			var GrooveIntlCalendarField_DayOfMonth = 5;

			// Day-Of-Year field, e.g. 1..366.
			var GrooveIntlCalendarField_DayOfYear = 6;

			// Day-Of-Week field, e.g. 1..7.
			var GrooveIntlCalendarField_DayOfWeek = 7;

			// Day-Of-Week-In-Month field, e.g. 1..6, may be specified as -1.
			var GrooveIntlCalendarField_DayOfWeekInMonth = 8;

			// AM/PM field, e.g. 0..1.
			var GrooveIntlCalendarField_AMPM = 9;

			// Hour field, e.g. 0..11.
			var GrooveIntlCalendarField_Hour = 10;

			// Hour-Of-Day field, e.g. 0..23.
			var GrooveIntlCalendarField_HourOfDay = 11;

			// Minute field, e.g. 0..59.
			var GrooveIntlCalendarField_Minute = 12;

			// Second field, e.g. 0..59.
			var GrooveIntlCalendarField_Second = 13;

			// Millisecond field, e.g. 0..999.
			var GrooveIntlCalendarField_Millisecond = 14;

			// Time-Zone-Offset field, e.g. (-12 * GrooveIntlDateMillis_MillisPerHour)..(12 * GrooveIntlDateMillis_MillisPerHour).
			var GrooveIntlCalendarField_ZoneOffset = 15;

			// Daylight-Savings-Time-Offset field, e.g. 0 or GrooveIntlDateMillis_MillisPerHour.
			var GrooveIntlCalendarField_DSTOffset = 16;

			//**************************************************************************
			//
			// End from GrooveInternationalization.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCalendarTool.idl
			//
			//**************************************************************************

			// Command to add a new calendar entry.
			var GrooveCalendarCommand_NewEntry = 0;

			// Command to view or edit details about the entry.
			var GrooveCalendarCommand_OpenDetail = 1;

			// Command to delete the entry.
			var GrooveCalendarCommand_Delete = 2;

			// Command to cut the entry.
			var GrooveCalendarCommand_Cut = 3;

			// Command to copy the entry.
			var GrooveCalendarCommand_Copy = 4;

			// Command to paste the entry.
			var GrooveCalendarCommand_Paste = 5;

			// Command to copy the entry as a link.
			var GrooveCalendarCommand_CopyAsLink = 6;

			// Command to save the entry in an external format.
			var GrooveCalendarCommand_SaveAs = 7;

			// Command to mark the entry as read.
			var GrooveCalendarCommand_MarkRead = 8;

			// Command to mark the entry as unread.
			var GrooveCalendarCommand_MarkUnread = 9;

			// Command to mark all entries as read.
			var GrooveCalendarCommand_MarkAllRead = 10;

			// Command to mark all entries as unread.
			var GrooveCalendarCommand_MarkAllUnread = 11;

			// Command to display the day view.
			var GrooveCalendarCommand_DayView = 12;

			// Command to display the week view
			var GrooveCalendarCommand_WeekView = 13;

			// Command to display the month view.
			var GrooveCalendarCommand_MonthView = 14;

			// Command to display the business week view.
			var GrooveCalendarCommand_BusinessWeekView = 15;

			// Command to display the business month view.
			var GrooveCalendarCommand_BusinessMonthView = 16;

			// Command to scroll to the next unit of time.
			var GrooveCalendarCommand_ScrollNext = 17;

			// Command to scroll to the previous unit of time.
			var GrooveCalendarCommand_ScrollPrev = 18;

			// Command to scroll to the current date.
			var GrooveCalendarCommand_ScrollToday = 19;

			// Command to load a date navigation aid.
			var GrooveCalendarCommand_GoToDate = 20;

			// Command to undo the previous data change.
			var GrooveCalendarCommand_Undo = 21;

			// Command to redo the previously undone data change.
			var GrooveCalendarCommand_Redo = 22;

			// Command to enable synchronization with Outlook.
			var GrooveCalendarCommand_EnableOutlookSync = 23;

			// Command to send a single event to OUtlook.
			var GrooveCalendarCommand_SendEventToOutlook = 24;

			// Command to Print the entry.
			var GrooveCalendarCommand_Print = 25;

			//**************************************************************************
			//
			// End from GrooveCalendarTool.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveMiscServices.idl
			//
			//**************************************************************************

			// UTF8 character type.
			var GrooveCharEncodingType_UTF8 = 0;

			//**************************************************************************
			//
			// End from GrooveMiscServices.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveMiscServicesAlpha.idl
			//
			//**************************************************************************

			// Delayed deletion of temporary file.
			var GrooveTemporaryFileDeleteFlag_TimerDelay = 1;

			// Attempt deletion of temporary file on each shutdown/startup of temporary file service.
			var GrooveTemporaryFileDeleteFlag_ShutdownStartup = 2;

			//**************************************************************************
			//
			// End from GrooveMiscServicesAlpha.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCommonComponents.idl
			//
			//**************************************************************************

			// Width is determined at runtime based on available space. 
			var GrooveListViewColumnWidthType_AutoSize = 1;

			// Width is specified as a fixed number of pixels.
			var GrooveListViewColumnWidthType_Pixels = 2;

			// Column has left alignment.
			var GrooveListViewColumnAlignment_Left = 0;

			// Column has right alignment.
			var GrooveListViewColumnAlignment_Right = 1;

			// Column has center alignment.
			var GrooveListViewColumnAlignment_Center = 2;

			// Action caused by unknown source.
			var GrooveSelectionChangeActionTrigger_Unknown = 0;

			// Action caused by mouse.
			var GrooveSelectionChangeActionTrigger_ByMouse = 1;

			// Action caused by keyboard.
			var GrooveSelectionChangeActionTrigger_ByKeyboard = 2;

			// Insert item first.
			var GrooveTreeViewInsertOrder_First = 1;

			// Insert item last.
			var GrooveTreeViewInsertOrder_Last = 2;

			// Insert item at root.
			var GrooveTreeViewInsertOrder_Root = 3;

			// Insert item first in alphabetical order.
			var GrooveTreeViewInsertOrder_Sort = 4;

			// Insert item as the next sibling of the specified parent item.
			var GrooveTreeViewInsertOrder_NextSibling = 5;

			// Collapse item.
			var GrooveTreeViewExpandOrder_Collapse = 1;

			// Expand item.
			var GrooveTreeViewExpandOrder_Expand = 2;

			// Toggle.
			var GrooveTreeViewExpandOrder_Toggle = 3;

			// The execution context is new (code has never executed)
			// Code can safely be added. 
			// You cannot set the state of an execution context to this value.
			var GrooveScriptExecutionContextState_New = 1;

			// The execution context is running. Code will execute
			// when called.
			// You cannot add code while in this state.
			var GrooveScriptExecutionContextState_Running = 2;

			// The execution context is closed and code is 
			// no longer running.
			// You cannot add code while in this state.
			var GrooveScriptExecutionContextState_Closed = 3;

			// No size information specified.
			var GrooveLayoutSizeType_None = 0;

			// Size information is in pixels.
			var GrooveLayoutSizeType_Pixels = 1;

			// Size information is in percent of available space.
			var GrooveLayoutSizeType_Percent = 2;

			// Size restrictions are to be removed.
			var GrooveLayoutSizeType_Unconstrained = 3;

			// Puts the execution context in a closed state
			// and removes it from the list of existing contexts
			var GrooveScriptExecutionContextShutdownFlag_Remove = 0;

			// Terminates and removes the code contained in the
			// execution context and resets the state to New
			var GrooveScriptExecutionContextShutdownFlag_Reset = 1;

			//**************************************************************************
			//
			// End from GrooveCommonComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveUIFramework.idl
			//
			//**************************************************************************

			var GrooveWindowResult_Cancel = -1;

			// Window operation was finished normally.
			var GrooveWindowResult_OK = 0;

			// Use to show or hide the Restore command.
			var GrooveWindowMenuCommand_Restore = 0x0001;

			// Use to show or hide the Minimize command.
			var GrooveWindowMenuCommand_Minimize = 0x0008;

			// Use to show or hide the Maximize command.
			var GrooveWindowMenuCommand_Maximize = 0x0010;

			// Use to show or hide the Close command.
			var GrooveWindowMenuCommand_Close = 0x0020;

			// UICommand's state should be rendered as unchecked.
			var GrooveCheckState_Unchecked = 0;

			// UICommand's state should be rendered as checked.
			var GrooveCheckState_Checked = 1;

			// UICommand's state should be rendered as indeterminate.
			var GrooveCheckState_Indeterminate = 2;

			//**************************************************************************
			//
			// End from GrooveUIFramework.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveStorageMgr.idl
			//
			//**************************************************************************

			// Groove chooses a format automatically.
			var GrooveSerializeType_Auto = 0x00;

			// MHTML format as defined in RFC 2557.
			var GrooveSerializeType_MIME = 0x01;

			// XML format.  Note that this format does not support binary
			// documents, but it may be a body type in MHTML.
			var GrooveSerializeType_XML = 0x02;

			// Use default serialization options (use none of the other
			// available options).
			var GrooveSerializeOption_Default = 0x0000;

			var GrooveParseOption_StripContentWhitespace = 0x01;

			// Body text.
			var GrooveContentType_Text = 1;

			var GrooveXLinkShowOption_Replace = 2;
			var GrooveXLinkSerializeOption_ByValue = 0;
			var GrooveXLinkActuateType_User = 0;
			var GrooveXLinkCompressOption_OnWire = 0x01;
			var GrooveXLinkDeserializeOption_Replace = 1;

			//**************************************************************************
			//
			// End from GrooveStorageMgr.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************

			// Property is private.
			var GrooveCommunicationsDirection_Both     = 0x3;

			//**************************************************************************
			//
			// End from GrooveComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveComponents.idl
			//
			//**************************************************************************

			// Property is private.
			var GroovePropertyFlag_Private     = 0x0000;

			//**************************************************************************
			//
			// End from GrooveComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCollectionMgr.idl
			//
			//**************************************************************************
			
			// Move the cursor to the next source row, traversing down through child rows and up 
			// through parent rows.
			var GrooveCollectionNavigationOp_NextAny = 0;

			// Navigate collapsed rows when moving the cursor (the default is to skip
			// collapsed rows).
			var GrooveCollectionNavigationOption_IncludeCollapsedRows = 0x0001;

			// First row in the collection.
			var GrooveCollectionCursorPosition_First = 0;

			// Last row in the collection.
			var GrooveCollectionCursorPosition_Last = 1;
			
			// Current row in the collection.  This position is useful for performing relative cursor 
			// movement.
			var GrooveCollectionCursorPosition_Current = 2;

			//**************************************************************************
			//
			// End from GrooveCollectionMgr.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveHelperPrivate.idl
			//
			//**************************************************************************

			var GrooveAccountDialogsSubForms_FindSubform = 38;
			var GrooveAccountDialogsSubForms_PropertySheetDialogSubform = 40;

			//**************************************************************************
			//
			// End from GrooveHelperPrivate.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveRecordDatabaseAlpha.idl
			//
			//**************************************************************************
			var GrooveFieldType_None    = 0; // Implied by VARTYPE
			var GrooveFieldType_String  = 1;
			var GrooveFieldType_Boolean = 2;
			var GrooveFieldType_I4      = 5;
			var GrooveFieldType_R8      = 7;
			var GrooveFieldType_Binary  = 8;
			var GrooveFieldType_DateTime = 9;
			var GrooveFieldType_Element = 10;
			var GrooveFieldType_Contact = 11;

			var GrooveRecordDatabaseChangeType_AddRecord = 0;
			var GrooveRecordDatabaseChangeType_AddRecords = 1;
			var GrooveRecordDatabaseChangeType_DeleteRecord = 2;
			var GrooveRecordDatabaseChangeType_DeleteRecords = 3;
			var GrooveRecordDatabaseChangeType_ReplaceRecord = 4;
			var GrooveRecordDatabaseChangeType_SetField = 5;

			//**************************************************************************
			//
			// End from GrooveRecordDatabaseAlpha.idl
			//
			//**************************************************************************
			
			//**************************************************************************
			//
			// From GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************
			
			// Indicates that the status being requested
			// or reported is for inbound communications.
			var GrooveCommunicationsDirection_Inbound  = 0x1;

			// Indicates that the status being requested
			// or reported is for outbound communications.
			var GrooveCommunicationsDirection_Outbound = 0x2;

			// Indicates that the status being requested
			// or reported is for both inbound AND outbound
			// communications.
			var GrooveCommunicationsDirection_Both     = GrooveCommunicationsDirection_Inbound | GrooveCommunicationsDirection_Outbound;
			
			//**************************************************************************
			//
			// End from GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************

			//**************************************************************************
			//
			// From GrooveDataListAlpha.idl
			//
			//**************************************************************************
			
			// No summary.
			var GrooveDataListViewColumnSummaryType_None = 0;

			// Summary is the sum of the field values in the column.
			var GrooveDataListViewColumnSummaryType_FieldValuesSum = 1;
			
			// No grouping.
			var GrooveDataListGroupType_None = 0;

			// Rows are group by unique field values.
			var GrooveDataListGroupType_UniqueFieldValues = 1;
					
			// Group row is a break on the change in units of hours.
			var GrooveDataListGroupType_Hours = 2;

			// Group row is a break on the change in units of days.
			var GrooveDataListGroupType_Days = 3;

			// Group row is a break on the change in units of weeks.
			var GrooveDataListGroupType_Weeks = 4;

			// Group row is a break on the change in units of months.
			var GrooveDataListGroupType_Months = 5;

			// Group row is a break on the change in units of years.
			var GrooveDataListGroupType_Years = 6;
			
			//**************************************************************************
			//
			// End from GrooveDataListAlpha.idl
			//
			//**************************************************************************
			
			
			function OpenCacheFromRunTimeData(i_pRunTimeData, i_CacheName)
			{
				var pCache = null;
				if (i_CacheName == "" || i_CacheName == null)
					i_CacheName = "_ObjectCache";
				i_pRunTimeData.LockData();
				try
				{
					if (i_pRunTimeData.LockedHasItem(i_CacheName))
						pCache = i_pRunTimeData.LockedGetItem(i_CacheName);
					else
					{
						pCache = GrooveScriptFunctions.OpenSharedObjectTable("");
						i_pRunTimeData.LockedSetItem(i_CacheName, pCache);
					}
				}
				catch (error)
				{
				}
				i_pRunTimeData.UnlockData();
				return pCache;
			}
						
			function AddObjectToCache(i_Key, i_pObject, i_pCache)
			{
				i_pCache.SetItem(i_Key, i_pObject);
			}

			function IsObjectInCache(i_Key, i_pCache)
			{
				return i_pCache.HasItem(i_Key);
			}

			function OpenObjectFromCache(i_Key, i_pCache)
			{
				return i_pCache.GetItem(i_Key);
			}

			function RemoveObjectFromCache(i_Key, i_pCache)
			{
				if (IsObjectInCache(i_Key, i_pCache))
				{
					i_pCache.RemoveItem(i_Key);
				}
			}

			function ShutdownCache(i_pCache, i_Callback)
			{
				i_pCache.LockData();
				try
				{
					if (i_Callback)
					{
						var pEntryEnum = i_pCache.LockedCreateNameValueEnum();
						while (pEntryEnum.HasMore())
						{
							var pEntry = pEntryEnum.OpenNextPair();
							i_Callback(pEntry.First, pEntry.Second);
						}
					}
					pEntryEnum = null;
					delete pEntryEnum;
					CollectGarbarge();
					i_pCache.LockedRemoveAllItems();
				}
				catch(error)
				{
					i_pCache.LockedRemoveAllItems();
				}

				i_pCache.UnlockData();
			}

			function ThrowError(i_Description)
			{
				var objError = new Error(-213546871, i_Description);
				throw objError;
			}

			function CreateValidXMLName(i_Name)
			{
				var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
				var ValidXMLName = pXMLSyntax.ConvertToXMLName(i_Name);
				return ValidXMLName;
			}

			function ConvertToOriginalName(i_XMLName)
			{
				if (i_XMLName != "")
				{
					var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
					var OriginalName = pXMLSyntax.ConvertFromXMLName(i_XMLName);
					return OriginalName;
				}
				else
					return i_XMLName;
				
			}

			// get the numerical value from a number string, NaN if it is not valid
			function GetValidNumber(i_NumberString, i_UIDelegate)
			{
				// Replace all non-valid characters in the number string.
				var NumberString = i_NumberString.replace(/[^\d,-\.\(]/g, "");
				// If the number string has a paren in it, replace with a negative symbol.
				NumberString = NumberString.replace(/\(/g, "-");
				if (NumberString.toString() != "")
				{
					try
					{
						var ValidNumber = i_UIDelegate.ParseNumber(NumberString);
						if (isNaN(ValidNumber))
						{
							ValidNumber = Number(NumberString);
							if (isNaN(ValidNumber))
								ValidNumber = Number.NaN;
						}
					}
					catch (error)
					{
						ValidNumber = Number.NaN;
					}
				}

				return ValidNumber;
			}

			function CreateGUID()
			{
				var pGuidGenerator = GROOVE_GLOBAL_MISC_POINTER.OpenGUIDGenerator();	
				var GUID = pGuidGenerator.CreateGUIDBase16();
				return GUID;
			}

			function SafeOpenProperty(i_pPropertyList, i_PropertyName, i_DefaultValue)
			{
				if (i_pPropertyList.PropertyExists(i_PropertyName))
					return i_pPropertyList.OpenProperty(i_PropertyName);
				else
					return i_DefaultValue;
			}

			function GetBasePath()
			{
				var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
				var PRootPath = pStorageURISyntax.InstallDataRootPath;
				var strPath = PRootPath + "ToolData\\groove.net\\GrooveForms4\\";
				return strPath;
			}

			function BuildPathFromBase(i_PreRootPath, i_PostRootPath)
			{
				var BasePath = GetBasePath();
				return i_PreRootPath + BasePath + i_PostRootPath;
			}

			function OpenRecordType()
			{
				var RecordType = "urn:groove.net:FormsToolUserData";
				return RecordType;
			}

			function GetFormsPreferenceAsBool(PropertyList, i_Key, i_bDefault)
			{
				var Account = OpenAccountFromPropertyList(PropertyList);
				var PreferencesPropertyList = Account.PreferencesProvider.PropertyList;
				var FormsPreferences;
				if (!PreferencesPropertyList.PropertyExists("FormsProperties"))
					FormsPreferences = PreferencesPropertyList.CreatePropertyAsPropertyList("FormsProperties");
				else
					FormsPreferences = PreferencesPropertyList.OpenPropertyAsPropertyList("FormsProperties");
				
				var o_Value = i_bDefault;
				if (FormsPreferences.PropertyExists(i_Key))
					o_Value = FormsPreferences.OpenPropertyAsBool(i_Key);

				return o_Value;
			}

			function GetColumnWidthStyleStringFromEnumValue(i_ColumnWidthStyle)
			{
				switch (i_ColumnWidthStyle)
				{
					case GrooveFormsToolViewColumnWidthStyle_Percent:
						return "%";
					case GrooveFormsToolViewColumnWidthStyle_Pixels:
					default:
						return "";
				}
			}

			function GetColumnSortOrderStringFromEnumValue(i_ColumnSortOrder)
			{
				switch (i_ColumnSortOrder)
				{
					case GrooveFormsToolViewColumnSortOrder_Ascending:
						return "Ascending";
					case GrooveFormsToolViewColumnSortOrder_Descending:
						return "Descending";
					case GrooveFormsToolViewColumnSortOrder_Both:
						return "Ascending,Descending";
					case GrooveFormsToolViewColumnSortOrder_Ordinal:
					default:
						return "Ordinal";
				}
			}

			function GetEnumValueFromDateFormatString(i_DateFormat)
			{
				switch (i_DateFormat)
				{
					case "Default":
						return GrooveIntlDateFormatStyle_Default;
					case "Full":
					case "Long":
						return GrooveIntlDateFormatStyle_Long;
					case "Medium":
					case "Short":
					default:
						return GrooveIntlDateFormatStyle_Short;
				}
			}

			function GetStringForFieldTypeEnumValue(i_FieldType)
			{
				switch (i_FieldType)
				{
					case GrooveFormsToolFieldType_Text:
						return "Text";
					case GrooveFormsToolFieldType_MultiLineText:
						return "Multi-line Text";
					case GrooveFormsToolFieldType_Number:
						return "Number";
					case GrooveFormsToolFieldType_UnformattedNumber:
						return "Unformatted Number";
					case GrooveFormsToolFieldType_Currency:
						return "Currency";
					case GrooveFormsToolFieldType_Date:
						return "Date";
					case GrooveFormsToolFieldType_DateTime:
						return "Date Time";
					case GrooveFormsToolFieldType_OptionButtons:
						return "Option Buttons";
					case GrooveFormsToolFieldType_CheckBox:
						return "Check Box";
					case GrooveFormsToolFieldType_DropDownList:
						return "Drop-down List";
					case GrooveFormsToolFieldType_ListBox:
						return "List Box";
					case GrooveFormsToolFieldType_Password:
						return "Password";
					case GrooveFormsToolFieldType_RichText:
						return "Rich Text";
					case GrooveFormsToolFieldType_Attachments:
						return "Attachments";
					case GrooveFormsToolFieldType_FormHeading:
						return "Form Heading";
					case GrooveFormsToolFieldType_SectionHeading:
						return "Section Heading";
					case GrooveFormsToolFieldType_StaticText:
						return "Static Text";
					case GrooveFormsToolFieldType_HorizontalLine:
						return "Horizontal Line";
					case GrooveFormsToolFieldType_NewLine:
						return "New Line";
					case GrooveFormsToolFieldType_ScriptButton:
						return "Script Button";
					case GrooveFormsToolFieldType_Image:
						return "Image";
					case GrooveFormsToolFieldType_SystemField:
						return "System Field";
				}
			}

			function GetValueFromQueryString(i_Key, i_Querystring, i_Default, i_Sep)
			{
				var strReturn = "";
				if (typeof i_Default != "undefined")
					strReturn = i_Default;

				var Separator = "=[^&]*";
				if (typeof i_Sep != "undefined")
					Separator = i_Sep;
				var objRegExp = new RegExp(i_Key + Separator, "");
				if (objRegExp.test(i_Querystring))
				{
					var strPair = objRegExp.exec(i_Querystring);
					var arrPair = strPair[0].split("=");
					if (arrPair.length == 2 && arrPair[0] == i_Key)
						strReturn = unescape(arrPair[1]);
				}

				return strReturn;
			}

			function AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, i_LayoutType)
			{
				var CellSizeObj = GrooveScriptFunctions.CreateNewObject(i_LayoutType);
				var CellObj = CellSizeObj.Cell();
				CellObj.Name = i_ObjectName + "Cell";

				if (i_Remove && i_Layout.IsControlInLayout(i_ObjectName))
					i_Layout.RemoveCellContents(CellObj);

				if (!i_Remove && !i_Layout.IsControlInLayout(i_ObjectName))
					i_Layout.AddControlByName(i_ObjectName, CellObj);
			}

			function AddRemoveCellContents(i_ObjectName, i_Layout, i_Remove)
			{
				AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, "Groove.HTMLTableLayoutControlInfo");
			}

			function AddRemoveMultiCellContents(i_ObjectName, i_Layout, i_Remove)
			{
				AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, "Groove.MultiCellLayoutControlInfo");
			}

			function ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, i_LayoutType)
			{
				var CellSizeObj = GrooveScriptFunctions.CreateNewObject(i_LayoutType);
				var CellObj = CellSizeObj.Cell();
				CellObj.Name = i_ObjectName + "Cell";
				if (i_Remove)
					CellSizeObj.SetHeight(0, GrooveLayoutSizeType_Pixels);
				else
					CellSizeObj.SetHeight(i_Size, GrooveLayoutSizeType_Pixels);
				i_Layout.AdjustCellLayout(CellObj, CellSizeObj);
			}
			
			function ShowHideCellContents(i_ObjectName, i_Layout, i_Size, i_Remove)
			{
				ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, "Groove.HTMLTableLayoutControlInfo")
			}

			function ShowHideMultiCellContents(i_ObjectName, i_Layout, i_Size, i_Remove)
			{
				ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, "Groove.MultiCellLayoutControlInfo")
			}

			function SetSelectionByItemData(i_ComboBox, i_Value)
			{
				i_ComboBox.SetSelectionByIndex(-1);
				for (var i = 0; i < i_ComboBox.Count; i++)
				{
					if (i_ComboBox.GetItemData(i) == i_Value)
					{
						i_ComboBox.SetSelectionByIndex(i);
						return;
					}
				}
			}

			function LocalParseNumber(i_NumberString)
			{
				try
				{
					if (i_NumberString != "")
					{
						var NumberFormat = g_Intl.CreateNumberFormat(GROOVE_NULL);
						var NumberFormattable = NumberFormat.Parse(i_NumberString, GROOVE_NULL);

						var NumberValue = Number.NaN;
						if (NumberFormattable.Type == GrooveIntlFormattableType_Double)
							NumberValue = NumberFormattable.Double;
						else if (NumberFormattable.Type == GrooveIntlFormattableType_Long)
							NumberValue = NumberFormattable.Long;

						return NumberValue;
					}
					else
						return Number.NaN;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function LocalFormatNumber(i_Value, i_Precision, i_Symbol)
			{
				try
				{
					// If symbol exists the value is of type currency.
					if (i_Symbol != null)
					{
						// Internationalization message formatting objects.
						var pFormatParameters = GrooveScriptFunctions.CreateNewObject("Groove.UnknownArray");
						var pMessageFormat = g_Intl.CreateMessageFormat("", GROOVE_NULL);
						// Set the precision value if it exists.
						var StringPrecision = "";
						var NumberPrecision = Number(i_Precision);
						if (NumberPrecision > 0)
						{
							StringPrecision = ".";
							var i = 0;
							var iCount = NumberPrecision;
							while (i < iCount)
							{
								StringPrecision += "0";
								i++;
							}
						}

						// Place quotes around the symbol if it is not the international currency character.
						if (i_Symbol != "\u00A4")
							i_Symbol = "'" + i_Symbol + "'";
						// This looks confusing, but it will end up creating a string like this:
						// "{0,number,'$'#,##0.00;('$'#,##0.00)}". The section before the semicolon
						// is for positive values, after is for negative values.
						var NumberFormat = i_Symbol + "#,##0" + StringPrecision;
						var FormatPattern = "{0,number," + NumberFormat + ";(" + NumberFormat + ")}";

						// Setup message formatter parameter array.
						pFormatParameters.RemoveAll();
						var pFormattable = g_Intl.CreateFormattableFromDouble(i_Value);
						pFormatParameters.Add(pFormattable);

						// Set message formatter pattern.
						pMessageFormat.ApplyPattern(FormatPattern);

						// Create formatted message.
						var NumberValue = pMessageFormat.Format(pFormatParameters);
						return NumberValue;
					}
					else
					{
						var NumberFormat = g_Intl.CreateNumberFormat(GROOVE_NULL);

						// Set the precision for the number.
						var NumberPrecision = Number(i_Precision);
						if (!isNaN(NumberPrecision))
						{
							NumberFormat.MinimumFractionDigits = NumberPrecision;
							NumberFormat.MaximumFractionDigits = NumberPrecision;
						}

						// Format the number into a string value.
						var NumberValue = NumberFormat.FormatDouble(i_Value, "", GROOVE_NULL);
						return NumberValue;
					}
				}
				catch (error)
				{
					return i_Value;
				}
			}

			function IsSystemScript(i_Name)
			{
				if (i_Name.indexOf("SystemCallouts") >= 0)
					return true;
				else
					return false;
			}

			function CheckForSameDataType(i_DataType, i_Field)
			{
				// No one should inherit from the readers and editors fields.
				var FieldName = i_Field.IGrooveFormsToolDesignObject.Name;
				if (FieldName == "_Readers" || FieldName == "_Editors")
					return false;

				// If the data type is the same, return true.
				if (i_DataType == i_Field.DataType)
					return true;
				else
					return false;
			}

		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @           2  ‡        #     2›  2›                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Ë               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   p   ÄName>   G r o o v e F o r m s H e l p e r F u n c t i o n s 3 . g s l         ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT     ÄSCRIPT  CRIPT  ÄSCRIPT       ÄSRC  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T y p e L i b r a r i e s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       = O p e n        ÄSCRIPT       ÄSRC*  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T e x t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  LM   § A   | I      ∑          )      ÄSCRIPT         Ö◊Ä

			//**************************************************************************
			//
			// From GrooveIntlResource\ResourceStringIDs.h
			//
			//**************************************************************************

			var IDS_FORMS_TOOL_ADD_ATTACHMENTS = 2683;
			var IDS_FORMS_TOOL_ADD_ATTACHMENTS_FILTER = 2684;
			var IDS_FORMS_TOOL_ADD_FIELD_GROUPS_TITLE = 2685;
			var IDS_FORMS_TOOL_ADD_SCRIPT_TITLE = 2686;
			var IDS_FORMS_TOOL_ADD_STYLES_TITLE = 2687;
			var IDS_FORMS_TOOL_ADD_TAB_GROUPS_TITLE = 2688;
			var IDS_FORMS_TOOL_ADVANCED_DESIGN_MESSAGE = 2689;
			var IDS_FORMS_TOOL_ADVANCED_DESIGN_TITLE = 2690;
			var IDS_FORMS_TOOL_APPLY_SANDBOX_LABEL = 2691;
			var IDS_FORMS_TOOL_APPLY_SANDBOX_TOOLTIP = 2692;
			var IDS_FORMS_TOOL_AUTO_CREATE_DEFAULT_FORM = 2693;
			var IDS_FORMS_TOOL_AUTO_CREATE_TYPE_EVERY_TIME = 2694;
			var IDS_FORMS_TOOL_AUTO_CREATE_TYPE_FIRST_TIME = 2695;
			var IDS_FORMS_TOOL_AUTO_RESOLVE_FAILED_MESSAGE_FOR_DESIGNERS = 2696;
			var IDS_FORMS_TOOL_BASIC_TAB_NAME = 2697;
			var IDS_FORMS_TOOL_BY_ORDINAL = 2698;
			var IDS_FORMS_TOOL_CALLOUTS_SCRIPT_PREFIX = 2699;
			var IDS_FORMS_TOOL_CANCEL_LABEL = 2700;
			var IDS_FORMS_TOOL_CANCEL_MODIFICATIONS_MESSAGE = 2701;
			var IDS_FORMS_TOOL_CANCEL_MODIFICATIONS_TITLE = 2702;
			var IDS_FORMS_TOOL_CANCEL_SANDBOX_LABEL = 2703;
			var IDS_FORMS_TOOL_CANCEL_SANDBOX_TOOLTIP = 2704;
			var IDS_FORMS_TOOL_CANCEL_TOOLTIP = 2705;
			var IDS_FORMS_TOOL_CH_COLUMN_HEADER = 2706;
			var IDS_FORMS_TOOL_CH_SORT = 2707;
			var IDS_FORMS_TOOL_CH_WIDTH = 2708;

			// GrooveFormsChoicesGlue5.gsl
			var IDS_FORMS_TOOL_CHOICES_GLUE_DESEL_DEFAULT = 2709;
			var IDS_FORMS_TOOL_CHOICES_GLUE_SEL_DEFAULT = 2710;

			// GrooveForms5Choices.grp Labels & Tooltips
			var IDS_FORMS_TOOL_CHOICES_GRP_DISPLAY_VALUE = 2711;
			var IDS_FORMS_TOOL_CHOICES_GRP_SELECT_BY_DEFAULT = 2712;
			var IDS_FORMS_TOOL_CHOICES_GRP_SORT = 2713;
			var IDS_FORMS_TOOL_CHOICES_GRP_STORED_VALUE = 2714;
			var IDS_FORMS_TOOL_CHOICES_GRP_TOOLTIP_MOVE_DOWN = 2715;
			var IDS_FORMS_TOOL_CHOICES_GRP_TOOLTIP_MOVE_UP = 2716;

			var IDS_FORMS_TOOL_CHOOSE_DATE_TITLE = 2717;
			var IDS_FORMS_TOOL_CLIPBOARD_FORMAT_FORMS_ENTRY_LINK = 2718;
			var IDS_FORMS_TOOL_CLIPBOARD_FORMAT_FORMS_VIEW_LINK = 2719;
			var IDS_FORMS_TOOL_CLOSE_SPLITTER = 2720;
			var IDS_FORMS_TOOL_CLOSE_SPLITTER_TOOLTIP = 2721;
			var IDS_FORMS_TOOL_COLLAPSE_TOOLTIP = 2722;
			var IDS_FORMS_TOOL_COLUMN_PROPERTIES_TITLE = 2723;
			var IDS_FORMS_TOOL_COLUMN_PROPERTY_AUTOFIT = 2724;
			var IDS_FORMS_TOOL_COLUMN_SORT_ORDER_ASCENDING = 2725;
			var IDS_FORMS_TOOL_COLUMN_SORT_ORDER_ASCENDING_DESCENDING = 2726;
			var IDS_FORMS_TOOL_COLUMN_SORT_ORDER_DESCENDING = 2727;
			var IDS_FORMS_TOOL_COLUMN_SORT_ORDER_ORDINAL = 2728;

			// FORMS TOOL XML BASED STRINGS
			// Common strings found in many grps
			var IDS_FORMS_TOOL_COMMON_XML_CANCEL = 2729;
			var IDS_FORMS_TOOL_COMMON_XML_CHARACTERS = 2730;
			var IDS_FORMS_TOOL_COMMON_XML_DELETE = 2731;
			var IDS_FORMS_TOOL_COMMON_XML_EIGHT = 2732;
			var IDS_FORMS_TOOL_COMMON_XML_ELEVEN = 2733;
			var IDS_FORMS_TOOL_COMMON_XML_FIFTEEN = 2734;
			var IDS_FORMS_TOOL_COMMON_XML_FIVE = 2735;
			var IDS_FORMS_TOOL_COMMON_XML_FOUR = 2736;
			var IDS_FORMS_TOOL_COMMON_XML_FOURTEEN = 2737;
			var IDS_FORMS_TOOL_COMMON_XML_LINES = 2738;
			var IDS_FORMS_TOOL_COMMON_XML_MODIFY = 2739;
			var IDS_FORMS_TOOL_COMMON_XML_NINE = 2740;
			var IDS_FORMS_TOOL_COMMON_XML_OK = 2741;
			var IDS_FORMS_TOOL_COMMON_XML_ONE = 2742;
			var IDS_FORMS_TOOL_COMMON_XML_PERCENT = 2743;
			var IDS_FORMS_TOOL_COMMON_XML_PIXELS = 2744;
			var IDS_FORMS_TOOL_COMMON_XML_SAVE = 2745;
			var IDS_FORMS_TOOL_COMMON_XML_SEVEN = 2746;
			var IDS_FORMS_TOOL_COMMON_XML_SIX = 2747;
			var IDS_FORMS_TOOL_COMMON_XML_TEN = 2748;
			var IDS_FORMS_TOOL_COMMON_XML_THIRTEEN = 2749;
			var IDS_FORMS_TOOL_COMMON_XML_THREE = 2750;
			var IDS_FORMS_TOOL_COMMON_XML_TOOLTIP_CANCEL = 2751;
			var IDS_FORMS_TOOL_COMMON_XML_TOOLTIP_SAVE = 2752;
			var IDS_FORMS_TOOL_COMMON_XML_TWELVE = 2753;
			var IDS_FORMS_TOOL_COMMON_XML_TWO = 2754;
			var IDS_FORMS_TOOL_COMMON_XML_ZERO = 2755;

			var IDS_FORMS_TOOL_CONFIG_OPTION_ALLOW_CHANGING_VIEWS = 2756;
			var IDS_FORMS_TOOL_CONFIG_OPTION_ALLOW_CREATING_NEW_RECORDS = 2757;
			var IDS_FORMS_TOOL_CONFIG_OPTION_ALLOW_MACROS = 2758;
			var IDS_FORMS_TOOL_CONFIG_OPTION_ALLOW_SEARCH = 2759;
			var IDS_FORMS_TOOL_CONFIG_OPTION_LIMIT_ONE_RECORD_PER_MEMBER = 2760;
			var IDS_FORMS_TOOL_CONFIG_OPTION_LOCK_DESIGN_WHEN_CREATING_GTA = 2761;
			var IDS_FORMS_TOOL_CONFIG_OPTION_SHOW_COMMAND_BAR = 2762;
			var IDS_FORMS_TOOL_CONFIG_OPTION_SHOW_PREVIEW_PANE = 2763;
			var IDS_FORMS_TOOL_CONTEXT_MENU_COPY = 4173;
			var IDS_FORMS_TOOL_CONTEXT_MENU_COPY_AS_LINK = 4174;
			var IDS_FORMS_TOOL_CONTEXT_MENU_CUT = 4175;
			var IDS_FORMS_TOOL_CONTEXT_MENU_DELETE = 4176;
			var IDS_FORMS_TOOL_CONTEXT_MENU_MARK_SEL_READ = 4177;
			var IDS_FORMS_TOOL_CONTEXT_MENU_MARK_SEL_UNREAD = 4178;
			var IDS_FORMS_TOOL_CONTEXT_MENU_OPEN = 4179;
			var IDS_FORMS_TOOL_CONTEXT_MENU_PROPERTIES = 4180;
			var IDS_FORMS_TOOL_COPY_TOOLTIP = 2764;
			var IDS_FORMS_TOOL_COULD_NOT_OPEN_FILE = 2765;
			var IDS_FORMS_TOOL_CREATE_DESIGN_FROM_TEMPLATE_TITLE = 2766;
			var IDS_FORMS_TOOL_CREATE_FORM_TITLE = 2767;
			var IDS_FORMS_TOOL_CREATE_NEW_FIELD_LABEL = 2768;
			var IDS_FORMS_TOOL_CREATE_NEW_FORM_LABEL = 2769;
			var IDS_FORMS_TOOL_CREATE_NEW_IP_FORM_LABEL = 2770;
			var IDS_FORMS_TOOL_CREATE_NEW_MACRO_LABEL = 2771;
			var IDS_FORMS_TOOL_CREATE_NEW_SCRIPT_LABEL = 2772;
			var IDS_FORMS_TOOL_CREATE_NEW_STYLE_LABEL = 2773;
			var IDS_FORMS_TOOL_CREATE_NEW_VIEW_LABEL = 2774;
			var IDS_FORMS_TOOL_CREATE_VIEW_TITLE = 2775;
			var IDS_FORMS_TOOL_CSV_EXTENSION = 2776;
			var IDS_FORMS_TOOL_CURRENT_VIEW_LABEL = 2777;
			var IDS_FORMS_TOOL_CUSTOM_STYLE_EDITOR_TITLE = 2778;
			var IDS_FORMS_TOOL_CUT_TOOLTIP = 2779;
			var IDS_FORMS_TOOL_DEFAULT_FORM_VIEW_NONE = 2780;
			var IDS_FORMS_TOOL_DEFAULT_SORT_BASE1 = 2781;
			var IDS_FORMS_TOOL_DEFAULT_SORT_BASE2 = 2782;
			var IDS_FORMS_TOOL_DEFAULT_SORT_BASE3 = 2783;
			var IDS_FORMS_TOOL_DEFAULT_SORT_BASE4 = 2784;
			var IDS_FORMS_TOOL_DELETE_FIELD = 2785;
			var IDS_FORMS_TOOL_DELETE_FIELD_TITLE = 2786;
			var IDS_FORMS_TOOL_DELETE_LOOKUP_REFERENCE_MESSAGE = 2787;
			var IDS_FORMS_TOOL_DELETE_LOOKUP_REFERENCE_TITLE = 2788;
			var IDS_FORMS_TOOL_DELETE_MACRO = 2789;
			var IDS_FORMS_TOOL_DELETE_MACRO_TITLE = 2790;
			var IDS_FORMS_TOOL_DELETE_RECORD_MESSAGE = 2791;
			var IDS_FORMS_TOOL_DELETE_RECORD_TITLE = 2792;
			var IDS_FORMS_TOOL_DELETE_RECORD_WITH_CHILDREN_MESSAGE = 2793;
			var IDS_FORMS_TOOL_DELETE_RECORDS_MESSAGE = 2794;
			var IDS_FORMS_TOOL_DELETE_RECORDS_TITLE = 2795;
			var IDS_FORMS_TOOL_DELETE_SCRIPT = 2796;
			var IDS_FORMS_TOOL_DELETE_SCRIPT_TITLE = 2797;
			var IDS_FORMS_TOOL_DELETE_STYLE = 2798;
			var IDS_FORMS_TOOL_DELETE_STYLE_TITLE = 2799;
			var IDS_FORMS_TOOL_DELETE_TOOLTIP = 2800;
			var IDS_FORMS_TOOL_DELETE_VIEW_OR_FORM = 2801;
			var IDS_FORMS_TOOL_DELETE_VIEW_OR_FORM_TITLE = 2802;
			var IDS_FORMS_TOOL_DESIGN_IS_OPEN_IN_ANOTHER_WINDOW = 2803;
			var IDS_FORMS_TOOL_DESIGN_NOT_INITIALIZED_ERROR = 2804;
			var IDS_FORMS_TOOL_DESIGN_OBJECT_FROM_FUTURE = 2805;
			var IDS_FORMS_TOOL_DESIGN_RESTRICTION_TITLE = 2806;
			var IDS_FORMS_TOOL_DESIGN_TEMPLATE_NAME_ERROR = 2807;
			var IDS_FORMS_TOOL_DESIGN_UPDATED_MESSAGE = 2808;

			// GrooveForms5Designer.grp Labels & Tooltips
			var IDS_FORMS_TOOL_DESIGNER_GRP_ABT_APPLY = 2809;
			var IDS_FORMS_TOOL_DESIGNER_GRP_ABT_DESCRIPTION = 2810;
			var IDS_FORMS_TOOL_DESIGNER_GRP_ABT_DESIGN_NAME = 2811;
			var IDS_FORMS_TOOL_DESIGNER_GRP_ABT_DESIGN_VERSION = 2812;
			var IDS_FORMS_TOOL_DESIGNER_GRP_ADVANCED_DESIGN = 2813;

			// GrooveFormsDesigner5.grp DataList ColumnHeaders
			var IDS_FORMS_TOOL_DESIGNER_GRP_DLCOLHDR_DESIGN_TYPE = 2814;
			var IDS_FORMS_TOOL_DESIGNER_GRP_DLCOLHDR_DSN_OBJ_NAME = 2815;
			var IDS_FORMS_TOOL_DESIGNER_GRP_DLCOLHDR_LOOKUP_KEY = 2816;
			var IDS_FORMS_TOOL_DESIGNER_GRP_DLCOLHDR_LOOKUP_TARGET = 2817;
			var IDS_FORMS_TOOL_DESIGNER_GRP_DLCOLHDR_STATUS = 2818;

			// GrooveForms5Designer.grp script code
			var IDS_FORMS_TOOL_DESIGNER_GRP_FLDLV_CHECK_ALL = 2819;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FLDLV_CHECK_NONE = 2820;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_ADD_SCRIPT = 2821;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_COL_SPAN = 2822;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_COLUMNS = 2823;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_FIELD_GRPS = 2824;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_FORM_NAME = 2825;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_FORM_SETTING = 2826;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_HTML_SOURCE = 4181;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_MOVE_LEFT_UP = 2828;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_MOVE_RIGHT_DOWN = 2829;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_CLASS_NAME = 2830;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_CUSTOM_STYLE_SUFFIX = 2831;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_ENTER_CLASS_NAME = 2832;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_INHERIT_FROM_TITLE = 2833;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_MORE_MENU_CLASS_NAME = 2834;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_MORE_MENU_HIDDEN = 2835;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_MORE_MENU_INHERIT_FROM = 2836;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_MORE_MENU_PUSH_UPDATES = 2837;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_MORE_MENU_READONLY = 2838;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_MORE_MENU_REQUIRED = 2839;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_NO_FIELD_SEL = 2840;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREV_NO_TAB_SEL = 2841;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREVIEW = 4182;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_STYLE_BUTTON_TOOLTIP = 2827;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_RESP_FORM = 2842;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_ROW_SPAN = 2843;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_SHOW_BORDER = 2844;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_STYLE = 2845;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_TAB_COLS = 2846;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_TAB_GRPS = 2847;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_VERSION_RECS = 2848;
			var IDS_FORMS_TOOL_DESIGNER_GRP_GLR_ADD_COMMENT = 2849;
			var IDS_FORMS_TOOL_DESIGNER_GRP_GLR_RESOLVE = 2850;
			var IDS_FORMS_TOOL_DESIGNER_GRP_INH_FRM_DLG_DESC = 2851;
			var IDS_FORMS_TOOL_DESIGNER_GRP_INH_FRM_DLG_LABEL = 2852;
			var IDS_FORMS_TOOL_DESIGNER_GRP_INHERIT_FROM_SCRIPT_NONE = 2853;
			var IDS_FORMS_TOOL_DESIGNER_GRP_INHERIT_FROM_SCRIPT_SELF = 2854;
			var IDS_FORMS_TOOL_DESIGNER_GRP_ITEM_STANDARD_STYLE = 2855;
			var IDS_FORMS_TOOL_DESIGNER_GRP_SCRIPT_MODIFY = 2856;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_ADD_SCRPT_TO_FRM = 2857;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_APPLY_INFO = 2858;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_CHK_ALL_FLDS = 2859;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_CHK_NONE_FLDS = 2860;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_CLOSE_WIN = 2861;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_DEL_LKUP_TRGT = 2862;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_FRM_IS_RESP = 2863;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_FRM_VERSION_RECS = 2864;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MAX_ROW_SZ = 2865;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MDFY_COL = 2866;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MDFY_SCRIPT = 2867;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MEASURE_TYPE = 2868;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MIN_ROW_SZ = 2869;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MOD_LKUP_TRGT = 2870;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MORE_PROPS = 2871;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MOV_LFT_UP = 2872;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MOV_RGT_DWN = 2873;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MOVE_BOTTOM = 2874;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MOVE_DOWN = 2875;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MOVE_TOP = 2876;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_MOVE_UP = 2877;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_NOT_IN_MNU = 2878;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_RES_LKUP_TRGT = 2879;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_SEL_FLDS_IN_FLD_GRP = 2880;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_SEL_FLDS_IN_TAB_GRP = 2881;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_SH_ADV_DSN = 2882;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_SH_BORDER = 2883;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_SH_GRD_LNS = 2884;
			var IDS_FORMS_TOOL_DESIGNER_GRP_TOOLTIP_SH_UNRD_MKS = 2885;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_CLK_COLUMN = 2886;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_DEF_SORT = 2887;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_MAX_ROW_HGT = 2888;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_MIN_ROW_HGT = 2889;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_MODIFY_COL = 2890;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_MOVE_BOTTOM = 2891;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_MOVE_DOWN = 2892;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_MOVE_TOP = 2893;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_MOVE_UP = 2894;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_NOT_IN_MNU = 2895;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_SEL_COL = 2896;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_SEL_FLDS = 2897;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_SH_GRD_LNS = 2898;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_SH_UNRD_MKS = 2899;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_VIEW_NAME = 2900;
			var IDS_FORMS_TOOL_DESIGNER_GRP_VIEW_VIEW_OPTIONS = 2901;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_SPL_EX_COL_TOOLTIP = 3156;
			var IDS_FORMS_TOOL_DESIGNER_IS_IN_USE = 2902;
			var IDS_FORMS_TOOL_DESIGNER_IS_IN_USE_TITLE = 2903;
			var IDS_FORMS_TOOL_DESIGNER_IS_IN_USE_V5 = 2904;
			var IDS_FORMS_TOOL_DESIGNER_ROLE_CHANGED_MESSAGE = 2905;
			var IDS_FORMS_TOOL_DIRTY_SAVE = 2906;
			var IDS_FORMS_TOOL_DIRTY_SAVE_TITLE = 2907;
			var IDS_FORMS_TOOL_DISPLAY_SEARCH_COUNT_OF = 2908;
			var IDS_FORMS_TOOL_DOCUMENT_NOT_FOUND_TITLE = 2909;
			var IDS_FORMS_TOOL_DOCUMENTS_SELECTED_POSTFIX = 2910;
			var IDS_FORMS_TOOL_DUPLICATE_FIELD_NEW_NAME_LABEL = 2911;
			var IDS_FORMS_TOOL_DUPLICATE_FIELD_NEW_NAME_TITLE = 2912;
			var IDS_FORMS_TOOL_EDIT_FIELD_GROUP_TITLE = 2913;
			var IDS_FORMS_TOOL_EDIT_FORM_MENU_LABEL = 2914;
			var IDS_FORMS_TOOL_EDIT_ROLE_DIALOG_TITLE = 2915;
			var IDS_FORMS_TOOL_EDIT_SCRIPT_TITLE = 2916;
			var IDS_FORMS_TOOL_EDIT_TAB_GROUP_TITLE = 2917;
			var IDS_FORMS_TOOL_EDIT_VIEW_MENU_LABEL = 2918;
			var IDS_FORMS_TOOL_EXPAND_TOOLTIP = 2919;
			var IDS_FORMS_TOOL_EXPORT_CSV_FILTER = 2920;
			var IDS_FORMS_TOOL_EXPORT_DATA = 2921;
			var IDS_FORMS_TOOL_EXPORT_INITIAL_FILE_NAME = 4183;
			var IDS_FORMS_TOOL_EXPORT_STRUCTURED_EXTENSION = 2922;
			var IDS_FORMS_TOOL_EXPORT_STRUCTURED_FILTER = 2923;
			var IDS_FORMS_TOOL_EXPORT_TABULAR_EXTENSION = 2924;
			var IDS_FORMS_TOOL_EXPORT_TABULAR_FILTER = 2925;
			var IDS_FORMS_TOOL_EXPORT_XML_EXTENSION = 2926;
			var IDS_FORMS_TOOL_EXPORT_XML_FILTER = 2927;
			var IDS_FORMS_TOOL_FIELD_NAME_FIELD_LABEL = 2928;
			var IDS_FORMS_TOOL_FIELD_PROPERTIES_TITLE = 2929;
			var IDS_FORMS_TOOL_FIELD_TYPE_ATTACHMENTS = 2930;
			var IDS_FORMS_TOOL_FIELD_TYPE_CHECK_BOX = 2931;
			var IDS_FORMS_TOOL_FIELD_TYPE_CONTACT = 2932;
			var IDS_FORMS_TOOL_FIELD_TYPE_CURRENCY = 2933;
			var IDS_FORMS_TOOL_FIELD_TYPE_DATE = 2934;
			var IDS_FORMS_TOOL_FIELD_TYPE_DATE_TIME = 2935;
			var IDS_FORMS_TOOL_FIELD_TYPE_DROP_DOWN_LIST = 2936;
			var IDS_FORMS_TOOL_FIELD_TYPE_EMBEDDED_VIEW = 2937;
			var IDS_FORMS_TOOL_FIELD_TYPE_FORM_HEADING = 2938;
			var IDS_FORMS_TOOL_FIELD_TYPE_HORIZONTAL_LINE = 2939;
			var IDS_FORMS_TOOL_FIELD_TYPE_IMAGE = 2940;
			var IDS_FORMS_TOOL_FIELD_TYPE_LIST_BOX = 2941;
			var IDS_FORMS_TOOL_FIELD_TYPE_MULTI_LINE_TEXT = 2942;
			var IDS_FORMS_TOOL_FIELD_TYPE_NEW_LINE = 2943;
			var IDS_FORMS_TOOL_FIELD_TYPE_NUMBER = 2944;
			var IDS_FORMS_TOOL_FIELD_TYPE_OPTION_BUTTONS = 2945;
			var IDS_FORMS_TOOL_FIELD_TYPE_PASSWORD = 2946;
			var IDS_FORMS_TOOL_FIELD_TYPE_RICH_TEXT = 2947;
			var IDS_FORMS_TOOL_FIELD_TYPE_SCRIPT_BUTTON = 2948;
			var IDS_FORMS_TOOL_FIELD_TYPE_SECTION_HEADING = 2949;
			var IDS_FORMS_TOOL_FIELD_TYPE_STATIC_TEXT = 2950;
			var IDS_FORMS_TOOL_FIELD_TYPE_SYSTEM_FIELD = 2951;
			var IDS_FORMS_TOOL_FIELD_TYPE_TEXT = 2952;
			var IDS_FORMS_TOOL_FIELD_TYPE_UNFORMATTED_NUMBER = 2953;
			var IDS_FORMS_TOOL_FILE_EXISTS = 2954;
			var IDS_FORMS_TOOL_FILE_EXISTS_TITLE = 2955;
			var IDS_FORMS_TOOL_FIND_TITLE = 2956;
			var IDS_FORMS_TOOL_FORM_ACCESS_LABEL = 2957;
			var IDS_FORMS_TOOL_FORM_ADVANCED_SEARCH_TITLE = 2958;
			var IDS_FORMS_TOOL_FORM_MENU_LABEL = 2959;
			var IDS_FORMS_TOOL_FORM_MENU_TOOLTIP = 2960;
			var IDS_FORMS_TOOL_FORM_PERMISSIONS_LABEL = 2961;
			var IDS_FORMS_TOOL_FORM_PERMISSIONS_LABEL2 = 2962;
			var IDS_FORMS_TOOL_FORM_SCRIPTS_TAB_NAME = 2963;
			var IDS_FORMS_TOOL_FORM_SEARCH_TITLE = 2964;
			var IDS_FORMS_TOOL_FORMS_VIEWS_UPDATED_TITLE = 2965;
			var IDS_FORMS_TOOL_FUTURE_DESIGN_OBJECTS_WARNING = 2966;
			var IDS_FORMS_TOOL_FUTURE_DESIGN_OBJECTS_WARNING_TITLE = 2967;
			var IDS_FORMS_TOOL_GLOBAL_LOOKUP_TAB_NAME = 2968;

			// GrooveForms5.grp ListView ColumnHeaders
			var IDS_FORMS_TOOL_GROOVEFORMS_GRP_LVCOLHDR_FIELD_NAME = 2969;
			var IDS_FORMS_TOOL_GROOVEFORMS_GRP_LVCOLHDR_FIELD_TYPE = 2970;
			var IDS_FORMS_TOOL_GROOVEFORMS_GRP_LVCOLHDR_LABEL = 2971;

			var IDS_FORMS_TOOL_GROUP_NAME_TITLE = 2972;
			var IDS_FORMS_TOOL_GRP_TAB_FIELD_ERROR = 4184;
			var IDS_FORMS_TOOL_GRP_TAB_FIELD_TITLE = 4185;
			var IDS_FORMS_TOOL_GRP_TAB_TEXT_ERROR = 4186;
			var IDS_FORMS_TOOL_GRP_TAB_TEXT_TITLE = 4187;
			var IDS_FORMS_TOOL_HOMEPAGE_LABEL = 2973;
			var IDS_FORMS_TOOL_HOMEPAGE_TOOLTIP = 2974;
			var IDS_FORMS_TOOL_HP_CONTINUE = 2975;
			var IDS_FORMS_TOOL_HP_DESIGNER = 2976;
			var IDS_FORMS_TOOL_HP_DESIGNER_SIMPLE = 2977;
			var IDS_FORMS_TOOL_HP_NON_DESIGNER = 2978;
			var IDS_FORMS_TOOL_HP_SANDBOX = 2979;
			var IDS_FORMS_TOOL_HP_START_HERE = 2980;
			var IDS_FORMS_TOOL_IMPORT_25_DATA = 2981;
			var IDS_FORMS_TOOL_IMPORT_DATA = 2982;
			var IDS_FORMS_TOOL_IMPORT_ERROR = 2983;
			var IDS_FORMS_TOOL_IMPORT_V3_CSV = 2984;
			var IDS_FORMS_TOOL_IMPORT_V3_WBXML = 2985;
			var IDS_FORMS_TOOL_INDEX_UPDATE_NOTIFIER_MESSAGE = 2986;
			var IDS_FORMS_TOOL_INFO_PATH_ERR_WARN_DLG_DESC = 4188;
			var IDS_FORMS_TOOL_INFO_PATH_ERR_WARN_DLG_LVCOLHDR_DESCRIPTION = 4189;
			var IDS_FORMS_TOOL_INFO_PATH_ERR_WARN_DLG_WINDOW_TITLE = 4190;
			var IDS_FORMS_TOOL_INVALID_COLUMN_TITLE = 2987;
			var IDS_FORMS_TOOL_INVALID_FIELD_TITLE = 2988;
			var IDS_FORMS_TOOL_INVALID_FORM_VIEW_NAME_ERROR = 2989;
			var IDS_FORMS_TOOL_INVALID_FORM_VIEW_NAME_TITLE = 2990;
			var IDS_FORMS_TOOL_INVALID_TEMPLATE_ERROR = 2991;
			var IDS_FORMS_TOOL_INVALID_TEMPLATE_TITLE = 2992;
			var IDS_FORMS_TOOL_IP_SOLUTION_FILTER = 2993;
			var IDS_FORMS_TOOL_JS_ADD_CUSTOM_ENTRY_TEXT = 2994;
			var IDS_FORMS_TOOL_JS_ADD_CUSTOM_ENTRY_TITLE = 2995;
			var IDS_FORMS_TOOL_JS_ALL_SUBSTRINGS_ERROR = 2996;
			var IDS_FORMS_TOOL_JS_ANY_SUBSTRINGS_ERROR = 2997;
			var IDS_FORMS_TOOL_JS_ATTACHMENT_SAVING_ERROR = 2998;
			var IDS_FORMS_TOOL_JS_BROWSE_IMAGE = 2999;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_ADD_ATTACHMENT = 3000;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_ALIGN_LEFT = 3001;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_ALIGN_RIGHT = 3002;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_BOLD = 3003;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_BULLETS = 3004;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_CENTER = 3005;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_CHECK_SPELLING = 3006;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_CHOOSE_COLOR = 3007;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_CHOOSE_FONT = 3008;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_DECREASE_INDENT = 3009;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_DELETE_ATTACHMENT = 3010;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_HYPERLINK = 3011;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_INCREASE_INDENT = 3012;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_ITALICIZE = 3013;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_JUSTIFY = 3014;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_LAUNCH_ATTACHMENT = 3015;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_SAVE_ATTACHMENT = 3016;
			var IDS_FORMS_TOOL_JS_COMMAND_BAR_UNDERLINE = 3017;
			var IDS_FORMS_TOOL_JS_CONTACT_TITLE = 3018;
			var IDS_FORMS_TOOL_JS_DATE_SAVING_ERROR = 3019;
			var IDS_FORMS_TOOL_JS_DELETED_RESPONSE_ERROR = 3020;
			var IDS_FORMS_TOOL_JS_DELETED_RESPONSE_TITLE = 3021;
			var IDS_FORMS_TOOL_JS_EDIT_RECORD_DELETED_ERROR = 3022;
			var IDS_FORMS_TOOL_JS_EMBEDDED_VIEW_INFO = 3023;
			var IDS_FORMS_TOOL_JS_EXTERNAL_OPENER_ERROR = 3024;
			var IDS_FORMS_TOOL_JS_FIELD_REQUIRED = 3025;
			var IDS_FORMS_TOOL_JS_FIELD_TITLE = 3026;
			var IDS_FORMS_TOOL_JS_FUTURE_FEATURE = 3027;
			var IDS_FORMS_TOOL_JS_HASALPHABETIC_ERROR = 3028;
			var IDS_FORMS_TOOL_JS_HASNUMERIC_ERROR = 3029;
			var IDS_FORMS_TOOL_JS_IDLE_HOURS = 3030;
			var IDS_FORMS_TOOL_JS_IDLE_HOURS_MINUTES = 3031;
			var IDS_FORMS_TOOL_JS_IDLE_MINUTES = 3032;
			var IDS_FORMS_TOOL_JS_IDLE_ONE_HOUR = 3033;
			var IDS_FORMS_TOOL_JS_IDLE_ONE_HOUR_MINUTES = 3034;
			var IDS_FORMS_TOOL_JS_IDLE_SINCE = 3035;
			var IDS_FORMS_TOOL_JS_INVALID_DATE = 3036;
			var IDS_FORMS_TOOL_JS_INVALID_DATE_RANGE = 3037;
			var IDS_FORMS_TOOL_JS_INVALID_EMAIL = 3038;
			var IDS_FORMS_TOOL_JS_INVALID_FORM_VALUES = 3039;
			var IDS_FORMS_TOOL_JS_INVALID_FORM_VALUES_TITLE = 3040;
			var IDS_FORMS_TOOL_JS_INVALID_ITEM_ERROR = 3041;
			var IDS_FORMS_TOOL_JS_INVALID_MAX_DATE = 3042;
			var IDS_FORMS_TOOL_JS_INVALID_MAX_LENGTH = 3043;
			var IDS_FORMS_TOOL_JS_INVALID_MIN_DATE = 3044;
			var IDS_FORMS_TOOL_JS_INVALID_MIN_LENGTH = 3045;
			var IDS_FORMS_TOOL_JS_INVALID_NUMBER = 3046;
			var IDS_FORMS_TOOL_JS_INVALID_PASSWORD = 3047;
			var IDS_FORMS_TOOL_JS_INVALID_SELECTION_ERROR = 3048;
			var IDS_FORMS_TOOL_JS_INVALID_SELECTION_TITLE = 3049;
			var IDS_FORMS_TOOL_JS_INVALID_ZIPCODE = 3050;
			var IDS_FORMS_TOOL_JS_ISALPHABETIC_ERROR = 3051;
			var IDS_FORMS_TOOL_JS_ISNUMERIC_ERROR = 3052;
			var IDS_FORMS_TOOL_JS_LOOKUP_ERROR = 3053;
			var IDS_FORMS_TOOL_JS_MAX_NUMBER = 3054;
			var IDS_FORMS_TOOL_JS_MIN_NUMBER = 3055;
			var IDS_FORMS_TOOL_JS_NO_SUBSTRING_ERROR = 3056;
			var IDS_FORMS_TOOL_JS_NO_SUBSTRINGS_ERROR = 3057;
			var IDS_FORMS_TOOL_JS_OPTION_ERROR = 3058;
			var IDS_FORMS_TOOL_JS_PREVIEW_RECORD_DELETED_ERROR = 3059;
			var IDS_FORMS_TOOL_JS_PROPAGATION_ERROR = 3060;
			var IDS_FORMS_TOOL_JS_RECORD_DELETED_TITLE = 3061;
			var IDS_FORMS_TOOL_JS_REMOVE_CONTACT_DLG = 3062;
			var IDS_FORMS_TOOL_JS_REMOVE_CONTACT_TITLE = 4191;
			var IDS_FORMS_TOOL_JS_SELECT_FIELDS = 3063;
			var IDS_FORMS_TOOL_JS_SUBSTRING_ERROR = 3064;
			var IDS_FORMS_TOOL_JS_UNKNOWN_FIELD_INFO = 3065;
			var IDS_FORMS_TOOL_LAUNCH_ATTACHMENTS_SECURITY_PROMPT = 3066;
			var IDS_FORMS_TOOL_LAUNCH_FILE_FOR_EDIT_SECURITY_PROMPT = 3067;
			var IDS_FORMS_TOOL_LINKED_DOCUMENT_NOT_FOUND = 3068;
			var IDS_FORMS_TOOL_LINKED_VIEW_NOT_FOUND = 3069;
			var IDS_FORMS_TOOL_LOOKUP_COLUMN_DOES_NOT_EXIST = 3070;
			var IDS_FORMS_TOOL_LOOKUP_DEFAULT_SORT_NOT_FOUND = 3071;

			// GrooveFormsLookupGlue5.gsl
			var IDS_FORMS_TOOL_LOOKUP_GLUE_DISPLAY_NAME = 3072;
			var IDS_FORMS_TOOL_LOOKUP_GLUE_DISPLAY_NAME_KEY_COLUMN = 3073;
			var IDS_FORMS_TOOL_LOOKUP_GLUE_KEY_COLUMN = 3074;
			var IDS_FORMS_TOOL_LOOKUP_GLUE_KEY_VALUE = 3075;
			var IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_COLUMN = 3076;
			var IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_ERROR = 3077;
			var IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_ERROR_TITLE = 3078;
			var IDS_FORMS_TOOL_LOOKUP_GLUE_TOOL = 3079;
			var IDS_FORMS_TOOL_LOOKUP_GLUE_VIEW = 3080;

			// GrooveForms5Lookup.grp Labels & Tooltips
			var IDS_FORMS_TOOL_LOOKUP_GRP_ALL = 3081;
			var IDS_FORMS_TOOL_LOOKUP_GRP_APPLY = 3082;
			var IDS_FORMS_TOOL_LOOKUP_GRP_BY_KEY = 3083;
			var IDS_FORMS_TOOL_LOOKUP_GRP_CLEAR = 3084;
			var IDS_FORMS_TOOL_LOOKUP_GRP_COMMENT = 3085;
			var IDS_FORMS_TOOL_LOOKUP_GRP_CROSS_SPACE = 3086;
			var IDS_FORMS_TOOL_LOOKUP_GRP_KEY_COLUMN = 3087;
			var IDS_FORMS_TOOL_LOOKUP_GRP_KEY_VALUE = 3088;
			var IDS_FORMS_TOOL_LOOKUP_GRP_KEY_VALUE_IS_FLD_NME = 3089;
			var IDS_FORMS_TOOL_LOOKUP_GRP_LOOKUP_COLUMN = 3090;
			var IDS_FORMS_TOOL_LOOKUP_GRP_LOOKUP_TYPE = 3091;
			var IDS_FORMS_TOOL_LOOKUP_GRP_NO_CACHE = 3092;
			var IDS_FORMS_TOOL_LOOKUP_GRP_RETURN = 3093;
			var IDS_FORMS_TOOL_LOOKUP_GRP_RETURN_URLS = 3094;
			var IDS_FORMS_TOOL_LOOKUP_GRP_SPACE = 3095;
			var IDS_FORMS_TOOL_LOOKUP_GRP_TOOL = 3096;
			var IDS_FORMS_TOOL_LOOKUP_GRP_TOOLTIP_KEY_VALUE = 3097;
			var IDS_FORMS_TOOL_LOOKUP_GRP_UNIQUE = 3098;
			var IDS_FORMS_TOOL_LOOKUP_GRP_VIEW = 3099;

			var IDS_FORMS_TOOL_LOOKUP_KEY_COLUMN_DOES_NOT_EXIST = 3100;
			var IDS_FORMS_TOOL_LOOKUP_OBJECT_TYPE_FIELD = 3101;
			var IDS_FORMS_TOOL_LOOKUP_OBJECT_TYPE_MACRO = 3102;
			var IDS_FORMS_TOOL_LOOKUP_OBJECT_TYPE_SCRIPT = 3103;
			var IDS_FORMS_TOOL_MACRO_ACCESS_LABEL = 3104;
			var IDS_FORMS_TOOL_MACRO_MENU_LABEL = 3105;
			var IDS_FORMS_TOOL_MACRO_MENU_TOOLTIP = 3106;
			var IDS_FORMS_TOOL_MACRO_PERMISSIONS_LABEL = 3107;
			var IDS_FORMS_TOOL_MACRO_PERMISSIONS_LABEL2 = 3108;
			var IDS_FORMS_TOOL_MANAGER_LABEL = 3109;
			var IDS_FORMS_TOOL_MANAGER_TOOLTIP = 3110;
			var IDS_FORMS_TOOL_MEMBERS_COLUMN_HEADER_LABEL = 3111;
			var IDS_FORMS_TOOL_MERGE_CANNOT_COMPLETE = 3112;
			var IDS_FORMS_TOOL_MERGE_CANNOT_COMPLETE_RESPONSE_FORM = 3113;
			var IDS_FORMS_TOOL_MERGE_CANNOT_COMPLETE_TITLE = 3114;
			var IDS_FORMS_TOOL_MERGE_DESIGN_CONFIRM_MESSAGE = 3115;
			var IDS_FORMS_TOOL_MERGE_DESIGN_MENU_LABEL = 3116;
			var IDS_FORMS_TOOL_MERGE_DESIGN_WAIT_MESSAGE = 3117;
			var IDS_FORMS_TOOL_MERGE_DESIGN_WINDOW_TITLE = 3118;
			var IDS_FORMS_TOOL_MGR_WARNING = 3119;
			var IDS_FORMS_TOOL_MGR_WARNING_TITLE = 3120;
			var IDS_FORMS_TOOL_MGR_WARNING2 = 3121;
			var IDS_FORMS_TOOL_MODIFY_FORM_TITLE_PREFIX = 3122;
			var IDS_FORMS_TOOL_MODIFY_MACRO_TITLE_PREFIX = 3123;
			var IDS_FORMS_TOOL_MODIFY_VIEW_TITLE_PREFIX = 3124;
			var IDS_FORMS_TOOL_NAVIGATE_TO_FORM_ERROR = 3125;
			var IDS_FORMS_TOOL_NAVIGATE_TO_FORM_ERROR_TITLE = 3126;
			var IDS_FORMS_TOOL_NAVIGATE_TO_VIEW_ERROR = 3127;
			var IDS_FORMS_TOOL_NAVIGATE_TO_VIEW_ERROR_TITLE = 3128;
			var IDS_FORMS_TOOL_NEW_FORM_NAME = 3129;
			var IDS_FORMS_TOOL_NEW_MACRO = 3130;
			var IDS_FORMS_TOOL_NEW_MACRO_NAME = 3131;
			var IDS_FORMS_TOOL_NEW_SCRIPT_NAME = 3132;
			var IDS_FORMS_TOOL_NEW_STYLE_NAME = 3133;
			var IDS_FORMS_TOOL_NEW_VIEW_NAME = 3134;
			var IDS_FORMS_TOOL_NEXT_UNREAD_TOOLTIP = 3135;
			var IDS_FORMS_TOOL_NO_FIELDS_SELECTED_ERROR = 3136;
			var IDS_FORMS_TOOL_NO_FIELDS_SELECTED_TITLE = 3137;
			var IDS_FORMS_TOOL_NO_PAGES = 3138;
			var IDS_FORMS_TOOL_NO_SAVE_PERMISSION_MESSAGE = 3139;
			var IDS_FORMS_TOOL_NO_VALUE = 3140;
			var IDS_FORMS_TOOL_NON_PERSISTABLE_COLUMN_ERROR = 3141;
			var IDS_FORMS_TOOL_NUMBER_OF_RECORDS_IN_VIEW = 3142;
			var IDS_FORMS_TOOL_ONE_ATTACHMENTS_FIELD_PER_FORM = 3143;
			var IDS_FORMS_TOOL_ONE_ATTACHMENTS_FIELD_PER_VIEW = 3144;
			var IDS_FORMS_TOOL_OPEN_FILE_TITLE = 3145;
			var IDS_FORMS_TOOL_OPEN_MANAGER_LABEL = 3146;
			var IDS_FORMS_TOOL_OPEN_SPLITTER = 3147;
			var IDS_FORMS_TOOL_OPEN_SPLITTER_TOOLTIP = 3148;
			var IDS_FORMS_TOOL_OPTIONS_TAB_NAME = 3149;
			var IDS_FORMS_TOOL_OTHER_SECTION_LABEL = 3150;
			var IDS_FORMS_TOOL_PAGE = 3151;
			var IDS_FORMS_TOOL_PAGE_NUMBER = 3152;
			var IDS_FORMS_TOOL_PASTE_ERROR = 3153;
			var IDS_FORMS_TOOL_PASTE_TOOLTIP = 3154;
			var IDS_FORMS_TOOL_PERCENT_SYMBOL = 3155;
			var IDS_FORMS_TOOL_PERMISSIONS_DEFAULT_DISPLAY_VALUE = 4192;
			var IDS_FORMS_TOOL_PERMISSIONS_FILTER_LABEL_CUSTOMROLES = 3159;
			var IDS_FORMS_TOOL_PERMISSIONS_FILTER_LABEL_PEOPLE = 3160;
			var IDS_FORMS_TOOL_PREVIOUS_UNREAD_TOOLTIP = 3162;
			var IDS_FORMS_TOOL_PRINT_LABEL = 3163;
			var IDS_FORMS_TOOL_PRINT_TITLE = 3164;
			var IDS_FORMS_TOOL_PRINT_TOOLTIP = 3165;
			var IDS_FORMS_TOOL_PUBLISH_MODIFICATIONS_MESSAGE = 3166;
			var IDS_FORMS_TOOL_PUBLISH_MODIFICATIONS_TITLE = 3167;
			var IDS_FORMS_TOOL_RECORD = 3168;
			var IDS_FORMS_TOOL_RECORDS = 3169;
			var IDS_FORMS_TOOL_REFRESH_DESIGN_CONFIRM_MESSAGE = 3170;
			var IDS_FORMS_TOOL_REFRESH_DESIGN_MENU_LABEL = 3171;
			var IDS_FORMS_TOOL_REFRESH_DESIGN_WAIT_MESSAGE = 3172;
			var IDS_FORMS_TOOL_REFRESH_DESIGN_WINDOW_TITLE = 3173;
			var IDS_FORMS_TOOL_REPLACE_DESIGN_CONFIRM_MESSAGE = 3174;
			var IDS_FORMS_TOOL_REPLACE_DESIGN_MENU_LABEL = 3175;
			var IDS_FORMS_TOOL_REPLACE_DESIGN_WAIT_MESSAGE = 3176;
			var IDS_FORMS_TOOL_REPLACE_DESIGN_WINDOW_TITLE = 3177;
			var IDS_FORMS_TOOL_RESET_LABEL = 3178;
			var IDS_FORMS_TOOL_RESET_TOOLTIP = 3179;
			var IDS_FORMS_TOOL_REVERT_LABEL = 3180;
			var IDS_FORMS_TOOL_REVERT_TOOLTIP = 3181;
			var IDS_FORMS_TOOL_ROLE_VIEWER_DESCRIPTION_COLUMN_TITLE = 3182;
			var IDS_FORMS_TOOL_ROLE_VIEWER_NAME_COLUMN_TITLE = 3183;
			var IDS_FORMS_TOOL_RUN_MACRO_TITLE_PREFIX = 3184;
			var IDS_FORMS_TOOL_SANDBOX_CREATION_DATE_LABEL = 3185;
			var IDS_FORMS_TOOL_SAVE_AND_CREATE_ANOTHER_DISABLED_TOOLTIP = 3186;
			var IDS_FORMS_TOOL_SAVE_AND_CREATE_ANOTHER_LABEL = 3187;
			var IDS_FORMS_TOOL_SAVE_AND_CREATE_ANOTHER_TOOLTIP = 3188;
			var IDS_FORMS_TOOL_SAVE_ATTACHMENT = 3189;
			var IDS_FORMS_TOOL_SAVE_ATTACHMENTS_FILTER = 3190;
			var IDS_FORMS_TOOL_SAVE_DISABLED_TOOLTIP = 3191;
			var IDS_FORMS_TOOL_SAVE_FORM_OR_VIEW_PERMISSION = 3192;
			var IDS_FORMS_TOOL_SAVE_LABEL = 3193;
			var IDS_FORMS_TOOL_SAVE_TOOLTIP = 3194;
			var IDS_FORMS_TOOL_SCRIPT_FILTER = 3195;
			var IDS_FORMS_TOOL_SEARCH_CLEAR_TOOLTIP = 3196;
			var IDS_FORMS_TOOL_SEARCH_MENU_TOOLTIP = 3197;
			var IDS_FORMS_TOOL_SEND_EMAIL_SECURITY_PROMPT = 3198;
			var IDS_FORMS_TOOL_SEND_IM_SECURITY_PROMPT = 3199;
			var IDS_FORMS_TOOL_SEND_INVITATION_SECURITY_PROMPT = 3200;
			var IDS_FORMS_TOOL_SEND_INVITATION_TO_CHAT_SECURITY_PROMPT = 3201;
			var IDS_FORMS_TOOL_SETTINGS_AND_OPTIONS = 3202;
			var IDS_FORMS_TOOL_SHOW_ERROR_PREFIX = 3203;
			var IDS_FORMS_TOOL_SHOW_ERROR_TITLE = 3204;
			var IDS_FORMS_TOOL_SHOW_GRID_LINES = 3205;
			var IDS_FORMS_TOOL_SHOW_VIEW_NAMES = 3206;
			var IDS_FORMS_TOOL_SO_INFO_TAB_NAME = 3207;			
			var IDS_FORMS_TOOL_STYLE_STANDARD = 3219;
			

			// GrooveForms5SubForms.grp Labels & Tooltips
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ABT_TOOL_ABOUT_TOOL = 3224;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ABT_TOOL_DES_TEMP_NAME = 3225;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ABT_TOOL_DES_TEMP_VER = 3226;

			// GrooveForms5SubForms.grp Add Obj script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_ADD_FIELD_GROUP_HELP = 3227;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_ADD_FIELD_GROUP_TOOLTIP = 3228;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_ADD_SCRIPT_HELP = 3229;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_ADD_SCRIPT_TOOLTIP = 3230;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_ADD_STYLE_HELP = 3231;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_ADD_STYLE_TOOLTIP = 3232;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_ADD_TAB_GROUP_HELP = 3233;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_ADD_TAB_GROUP_TOOLTIP = 3234;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_BROWSE = 3235;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_BROWSE_SCRIPT_TOOLTIP = 3236;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_BROWSE_STYLE_TOOLTIP = 3237;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_COPY_OF = 3238;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_COPY_OF_MULTIPLE = 3239;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_DEL_FIELD_GROUP_TOOLTIP = 3240;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_DEL_TAB_GROUP_TOOLTIP = 3241;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_DELETE = 3242;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_DELETE_TITLE = 3243;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_FILE_EXISTS = 3244;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_FILE_EXISTS_TITLE = 3245;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_MOD_FIELD_GROUP_TOOLTIP = 3246;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_MOD_TAB_GROUP_TOOLTIP = 3247;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_MODIFY_DOTS = 3248;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ADD_OBJ_NEW = 3249;

			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_APPLY_TO_ALL = 3250;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_ASCENDING = 3251;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_AUTOFIT = 3252;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_BASICS_TAB_NAME = 3253;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_BOLD = 3254;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_BOTTOM = 3255;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_CENTER = 3256;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_COL_HEADER = 3257;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_COL_PROPS = 3258;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_COL_WIDTH = 3259;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_CUSTOM_SIZE = 3260;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_DATE_FORMAT = 3261;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_DECIMAL_PLACES = 3262;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_DESCENDING = 3263;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_ERR_WDTH_MST_BE_GRTR_ZERO = 3264;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_ERR_WDTH_MST_BE_NUM = 3265;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_FONT = 3266;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_FONT_COLOR = 3267;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_GROUPED = 3268;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_HORZ_JUST = 3269;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_INC_ALL_LEVELS = 3271;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_ITALIC = 3272;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_LEFT = 3273;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_MAINT_HIER = 3274;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_OPTIONS_TAB_NAME = 3275;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_PERCENT = 3276;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_PIXELS = 3277;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_POINTS = 3278;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_RIGHT = 3279;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SECONDARY_SORT = 3280;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SHOW_TWISTY = 3281;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SIZE = 3282;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SORT_GROUP_FLD = 3283;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SORT_TYPE = 3284;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SORT_TYPE_FLAT_DESC = 3285;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SORT_TYPE_GRPED_DESC = 3286;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SORT_TYPE_HIER_DESC = 3287;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SORTING = 3288;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SORTING_DESC = 3289;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SORTS_TAB_NAME = 3290;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_SPACE_FONT = 3291;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_TOP = 3292;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_TOTAL_VALUES = 3293;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_UNDERLINE = 3294;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_VALUE_SUBST = 3295;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_VALUES_OPTIONS_TAB_NAME = 3296;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_VERT_JUST = 3297;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_WIDTH = 3298;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_CRT_VW_CREATE_VIEW = 3299;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_DT_TM_CALENDAR = 3300;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_DT_TM_TIME = 3301;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_CLASS_NAME = 3302;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_DONE = 3303;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_GROUP_CONTENTS = 3304;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_GROUP_IS_HIDDEN = 3305;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_LABEL = 3306;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_LABEL_POS = 3307;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_NEW_TAB = 3308;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_SEL_FLDS_GRP = 3309;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_SEL_FLDS_TAB = 3310;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_TAB_LABEL = 3311;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_GRP_TABS_IN_GROUP = 3312;

			// GrooveForms5SubForms.grp Edit Script script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_SCR_CREATE_LOOKUP = 3313;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_SCR_FUNCTION = 3314;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_SCR_HELP = 3315;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_SCR_LANGUAGE = 3316;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_SCR_MUST_ENTER_NAME = 3317;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_SCR_MUST_ENTER_NAME_TITLE = 3318;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_SCR_NAME = 3319;

			// GrooveForms5SubForms.grp Edit Style script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_STY_REQ_NAME = 3320;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_STY_REQ_NAME_TITLE = 3321;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_EDT_STY_STYLE_NAME = 3322;

			// GrooveFormsTool5SubForms.grp Field Wizard script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ADD_IMG = 3323;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ALL_SUBSTRINGS = 3324;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ALL_SUBSTRINGS_DSC = 3325;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ALTTEXT = 3326;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ALTTEXT_DSC = 3327;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ANY_SUBSTRINGS = 3328;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ANY_SUBSTRINGS_DSC = 3329;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ATTACHMENTS_DSC = 3330;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_AUTHENTICATION_COLOR = 3331;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_AUTHENTICATION_COLOR_LABEL = 3332;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BACK = 3333;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BG_COLOR = 3334;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BG_COLOR_DSC = 3335;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BG_COLOR_LABEL = 3336;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BORDER = 3337;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BORDER_DSC = 3338;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BORDER_LABEL = 3339;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BROWSE = 3340;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BUTTON_TEXT = 3341;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BUTTON_TEXT_DSC = 3342;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BUTTON_TEXT_LABEL = 3343;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BUTTONS = 3344;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_BUTTONS_DSC = 3345;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CENTER = 3346;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CENTER_FH_LABEL = 3347;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CENTER_IMG_LABEL = 3348;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CENTER_SH_LABEL = 3349;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CENTER_TXT_LABEL = 3350;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CHECK_BOX_DSC = 3351;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CHOOSE_COLOR = 3352;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CLEAR = 3353;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_COLOR = 3354;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CONTACT_DSC = 3355;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CREATE_FIELD = 3356;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CREATE_FILTER = 3357;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CREATE_NEW_FLD = 3358;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CRT_VIEW_FLT = 3359;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CTRL_LABEL = 3360;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_CURRENCY_DSC = 3361;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_DATE_DSC = 3362;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_DATE_PREVIEW = 3363;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_DATE_RANGE = 3364;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_DATE_TIME_DSC = 3365;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_DIS_CENTER = 3366;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_DROP_DOWN_LIST_DSC = 3367;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_EARLIEST_DATE = 3368;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_EARLIEST_DATE_DSC = 3369;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_EARLIEST_LABEL = 3370;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_EDIT_FILTER = 3371;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_EMBEDDED_VIEW_DSC = 3372;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ENT_LBL_FOR_FLD = 3373;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ENTER_TEXT_DSC = 3374;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_FINISH = 3375;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_FLD_PROP_ERR = 3376;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_FORM_HEADING_DSC = 3377;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_FORMATTING = 3378;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_FORMATTING_DSC = 3379;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_FULL_DATE = 3380;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HAS_ALPHA = 3381;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HAS_ALPHA_DSC = 3382;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HAS_NUM = 3383;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HAS_NUM_DSC = 3384;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HEADING_TEXT = 3385;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HEADING_TEXT_DSC = 3386;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HEADING_TEXT_LABEL = 3387;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HEIGHT = 3388;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HEIGHT_DSC = 3389;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HEIGHT_LABEL = 3390;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HIDE_AWARENESS = 3391;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HIDE_AWARENESS_LABEL = 3392;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HIDE_BORDER = 3393;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HIDE_BORDER_LABEL = 3394;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HIDE_CMDBAR = 3395;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HIDE_CMDBAR_LABEL = 3396;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HIDE_CNTXT_MENU = 3397;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HIDE_CNTXT_MENU_LABEL = 3398;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_HORIZONTAL_LINE_DSC = 3399;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IMAGE_DSC = 3400;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IMG_ERROR = 3401;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IMG_FILTER = 3402;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INCLUDE_BLANK = 3403;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INCLUDE_BLANK_LABEL = 3404;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_STATE = 3405;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_STATE_DSC = 3406;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_STATE_LABEL = 3407;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_VALUE = 3408;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_VALUE_DATE_DSC = 3409;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_VALUE_LABEL = 3410;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_VALUE_NUMBER_DSC = 3411;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_VALUE_RICH_TEXT_DSC = 3412;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INITIAL_VALUE_TEXT_DSC = 3413;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INV_DATE_ERR_TITLE = 3414;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INV_IMG_FILE = 3415;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INV_IMG_FILE_TITLE = 3416;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INV_LABEL = 3417;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INV_MAX_DATE_ERR = 3418;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INV_MIN_DATE_ERR = 3419;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_INV_PROP_VAL = 3420;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IS_ALPHA = 3421;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IS_ALPHA_DSC = 3422;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IS_NUM = 3423;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IS_NUM_DSC = 3424;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_FUNCTION = 3425;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_NOW = 3426;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_STATIC = 3427;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_TODAY = 3428;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_TOMORROW = 3429;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_TOOL_NAME = 3430;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_UNIQUE = 3431;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_USER_NAME = 3432;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_IV_WS_NAME = 3433;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LABEL = 3434;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LATEST_DATE = 3435;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LATEST_DATE_DSC = 3436;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LATEST_LABEL = 3437;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LBL_POS_DESC = 3438;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LIST_BOX_DSC = 3439;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LONG_DATE = 3440;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LOOKUP = 3441;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_LOOKUP_DSC = 3442;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAX_DATE_ERR_TITLE = 3443;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAX_LABEL = 3444;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAX_LENGTH = 3445;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAX_LENGTH_DSC = 3446;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAX_VAL_ERR_TITLE = 3447;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAXIMUM = 3448;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAXIMUM_LENGTH = 3449;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAXIMUM_LENGTH_DSC = 3450;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAXIMUM_LENGTH_LABEL = 3451;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAXIMUM_VALUE = 3452;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAXIMUM_VALUE_DSC = 3453;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MEDIUM_DATE = 3454;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MEMBER_NAMES = 3455;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MEMBER_NAMES_LABEL = 3456;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MIN_DATE_ERR = 3457;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MIN_DATE_ERR_TITLE = 3458;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MIN_LABEL = 3459;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MIN_LENGTH = 3460;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MIN_LENGTH_DSC = 3461;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MIN_VAL_ERR = 3462;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MIN_VAL_ERR_TITLE = 3463;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MINIMUM = 3464;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MINIMUM_VALUE = 3465;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MINIMUM_VALUE_DSC = 3466;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MINMAX_VAL_ERR = 3467;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MOD_FIELD = 3468;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MULTI_LINE_TEXT_DSC = 3469;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MULTIPLE_VALUES = 3470;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MULTIPLE_VALUES_LABEL = 3471;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NAME = 3472;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NAME_DSC = 3473;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NAME_LABEL = 3474;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NEW_LINE_DSC = 3475;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NEXT = 3476;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NO_PROPERTIES = 3477;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NO_SUBSTRINGS = 3478;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NO_SUBSTRINGS_DSC = 3479;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUM_CHAR_ERR = 3480;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUM_ERROR = 3481;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUM_ERROR_TITLE = 3482;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUM_RANGE = 3483;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUM_VAL_MSG = 3484;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUMBER_DSC = 3485;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUMBER_VISIBLE = 3486;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUMBER_VISIBLE_DSC = 3487;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_NUMBER_VISIBLE_LABEL = 3488;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ONCLICK = 3489;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_ONCLICK_DSC = 3490;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_OPTION_BUTTONS_DSC = 3491;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_OPTIONS = 3492;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_OPTIONS_DSC = 3493;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_PARAMETER = 3494;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_PASSWORD_DSC = 3495;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_PLAIN_TEXT = 3496;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_PRECISION = 3497;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_PRECISION_DSC = 3498;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_PROP_LST = 3499;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_PROP_SETTING = 3500;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_RICH_TEXT = 3501;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_RICH_TEXT_DSC = 3502;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SCRIPT_BUTTON_DSC = 3503;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SEARCHABLE = 3504;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SEARCHABLE_LABEL = 3505;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SECTION_HEADING_DSC = 3506;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SEL_BY_DEFAULT = 3507;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SEL_FLD_DESC = 3508;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SEL_FLD_TYPE = 3509;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SEL_VAL_TYPE = 3510;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SHADING = 3511;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SHADING_DSC = 3512;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SHORT_DATE = 3513;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SOURCE = 3514;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SOURCE_DSC = 3515;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SOURCE_LABEL = 3516;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_STATIC_TEXT_DSC = 3517;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_STORED_VALUE = 3518;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_STORED_VALUE_DSC = 3519;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_STORED_VALUE_LABEL = 3520;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SUBSTRING = 3521;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SUBSTRING_DSC = 3522;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SUBSTRING_NOT = 3523;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SUBSTRING_NOT_DSC = 3524;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SVE_CRT_ANO = 3525;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SYMBOL = 3526;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SYMBOL_DSC = 3527;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_SYSTEM_FIELD_DSC = 3528;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_TEXT = 3529;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_TEXT_DSC = 3530;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_THICKNESS = 3531;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_THICKNESS_DSC = 3532;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_TRANSPARENT = 3533;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_UNFORMATTED_NUMBER_DSC = 3534;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_UNIT = 3535;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_USER_DEFINED = 3536;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_USER_DEFINED_LABEL = 3537;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VAL_NONE = 3538;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VALID_EMAIL = 3539;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VALID_EMAIL_DSC = 3540;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VALID_PASSWORD = 3541;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VALID_PASSWORD_DSC = 3542;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VALID_ZIP = 3543;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VALID_ZIP_DSC = 3544;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VALIDATION = 3545;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VALIDATION_DSC = 3546;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VIEW = 3547;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VIEW_DSC = 3548;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VIEW_ERROR = 3549;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VIEW_FILTER = 3550;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VIEW_FILTER_DSC = 3551;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_VIEW_FILTER_LABEL = 3552;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_WARN_IMPORTANT = 3553;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_WARN_TEXT = 3554;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_WIDTH = 3555;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_WIDTH_DSC = 3556;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_WIDTH_LABEL = 3557;

			// GrooveForms5Designer.grp Default Items
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_ALL_NW_AND_MOD = 3558;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_ALL_RECORDS = 3559;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_ALL_RECORDS_IN_VIEW = 3560;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_ALL_UNREAD = 3561;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_ASCENDING = 3562;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_DATE_TIME_MED = 3563;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_DATE_TIME_SHT = 3564;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_DAY_IN_MONTH = 3565;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_DAY_IN_YEAR = 3566;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_DAY_OF_WEEK = 3567;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_DAY_OF_WEEK_ABBR = 3568;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_DAYS = 3569;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_DESCENDING = 3570;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_FLAT = 3571;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_FULL = 3572;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_GROUPED = 3573;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_HIERARCHICAL = 3574;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_HOUR_12_HOUR = 3575;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_HOUR_24_HOUR = 3576;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_HOURS = 3577;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_LEFT = 3578;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_LONG = 3579;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_MEDIUM = 3580;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_MONTH_ABBR = 3581;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_MONTH_FULL = 3582;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_MONTH_FULL_NUM = 3583;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_MONTH_SHRT_NUM = 3584;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_MONTHS = 3585;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_PASTED_RECORDS = 3586;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_RIGHT = 3587;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_SELECTED_RECORDS = 3588;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_SHORT = 3589;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_TIME_AS_MED = 3590;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_TIME_AS_SHT = 3591;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_TOP = 3592;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_UNIQUE_VALUES = 3593;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_WEEK_IN_MONTH = 3594;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_WEEK_IN_YEAR = 3595;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_WEEKS = 3596;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_YEAR_FULL_NUM = 3597;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_YEAR_SHRT_NUM = 3598;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_ITEM_YEARS = 3599;

			// GrooveForms5SubForms.grp Macro script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_MACRO_CREATE_LOOKUP = 3600;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_MACRO_HELP = 3601;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_MACRO_LANGUAGE = 3602;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_MACRO_MORE_CODE = 3603;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_MACRO_MST_ENTER_NAME = 3604;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_MACRO_MST_ENTER_NAME_TITLE = 3605;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_MACRO_NAME = 3606;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_MACRO_RUN_ON = 3607;

			// GrooveForms5SubForms.grp Print script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_EACH_BENEATH_PREV = 3608;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_EACH_ON_NEW_PAGE = 3609;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_EACH_WTH_NEW_LINE = 3610;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_MUST_SEL_FORM = 3611;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_MUST_SEL_FORM_TITLE = 3612;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_PRINT = 3613;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_PRINT_ALL_RECORDS = 3614;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_PRINT_VIEW = 3615;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_PRNT_THROUGH_FORM = 3616;

			// GrooveForms5SubForms.grp Record properties script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_COPY = 3617;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_CREATED_BY = 3618;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_CREATED_ON = 3619;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_DATA_TYPE = 3620;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_EXIT = 3621;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_FILE_ATTACHMENTS = 3622;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_MODIFIED_BY = 3623;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_MODIFIED_ON = 3624;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_NO_CONTACT = 3625;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_REC_DEF_NAME = 3626;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_RECORD_ID = 3627;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_TAB_ADV = 3628;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_TAB_FIELDS = 3629;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_TAB_INFO = 3630;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_TITLE = 3631;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_UNABLE_TO_DISPLAY = 3632;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REC_PROPS_VALUE = 3633;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REP_DSN_REPLACE_DESC = 3634;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REP_DSN_TOOL = 3635;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_REP_DSN_WORKSPACE = 3636;

			// GrooveForms5SubForms.grp Search script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_SRCH_ERROR_IN_DO = 3637;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_SRCH_RESET = 3638;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_SRCH_SEARCH = 3639;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_SRCH_SEARCH_ALL = 3640;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_SRCH_SEARCH_ANY = 3641;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_SRCH_SEARCH_RSLTS_DESC = 3642;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_SRCH_SELECT_FORM = 3643;

			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_ADD_COND_TO_QUERY = 3644;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_ADD_CUR_TAB_TO_GRP = 3645;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_ADD_MORE_CODE = 4193;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_ADD_TAB_GRP = 3647;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_APPLY_TO_ALL = 3648;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_CANCEL_TAB = 3649;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_COL_FONT_COLOR = 3651;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_DEL_SEL_TAB = 3652;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_FONT_FOR_COL = 3653;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_MOD_SEL_TAB = 3654;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_SEL_PRNT_FORM = 3655;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_TOTAL_RESP_TIP = 3656;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_UPDATE_CONDITION = 4194;

			// GrooveForms5SubForms.grp View Filter script
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_ADD_CONDITION = 3658;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_ALL_CONDITIONS = 3659;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_AND = 3660;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_AND_WTH_PARENS = 3661;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_ANY_CONDITION = 3662;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_APPLY_FILTER = 3663;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_FORM_LV_DESC = 3664;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_INVALID_DATE_FORMAT = 3665;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_LESS_OPTIONS = 3666;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_MORE_CONDITIONS = 3667;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_MORE_OPTIONS = 3668;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_MOVE_DOWN = 3669;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_MOVE_UP = 3670;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_MST_CHSE_FLD_ADD = 3671;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_MST_CHSE_FLD_UPD = 3672;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_OR = 3673;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_REMOVE_ALL_PARENS = 3674;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_REMOVE_COND = 3675;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_SYNTAX_ERROR = 3676;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_VW_FILT_UPDATE_CONDITION = 3677;
			var IDS_FORMS_TOOL_REMOVE_CONDITION_TOOLTIP = 3161;
			var IDS_FORMS_TOOL_MORE_OPTIONS_TOOLTIP = 3221;
			var IDS_FORMS_TOOL_LESS_OPTIONS_TOOLTIP = 3222;
			var IDS_FORMS_TOOL_LOGICAL_AND_TOOLTIP = 3223;
			var IDS_FORMS_TOOL_ADD_PARENS_TOOLTIP = 3270;
			var IDS_FORMS_TOOL_REMOVE_PARENS_TOOLTIP = 3646;
			var IDS_FORMS_TOOL_APPLY_VIEW_FILTER = 3650;
			var IDS_FORMS_TOOL_LOGICAL_OR_TOOLTIP = 3657;


			var IDS_FORMS_TOOL_TELESPACE_GUEST_ROLE_NAME = 3678;
			var IDS_FORMS_TOOL_TELESPACE_MANAGER_ROLE_NAME = 3679;
			var IDS_FORMS_TOOL_TELESPACE_MEMBER_ROLE_NAME = 3680;
			var IDS_FORMS_TOOL_TEMPLATE_FILTER = 3681;
			var IDS_FORMS_TOOL_TREE_VIEW_CONTEXT_MENU_LABEL_DUPLICATE = 3682;
			var IDS_FORMS_TOOL_TREE_VIEW_CONTEXT_MENU_LABEL_OPEN = 3683;
			var IDS_FORMS_TOOL_TREE_VIEW_CONTEXT_MENU_LABEL_PROPERTIES = 3684;
			var IDS_FORMS_TOOL_TREE_VIEW_DESIGN_LABEL = 3685;
			var IDS_FORMS_TOOL_TREE_VIEW_FIELD_DISPLAY_MESSAGE_FORMAT = 3686;
			var IDS_FORMS_TOOL_TREE_VIEW_FIELD_SUBTYPE_FORMAT_STRING = 3687;
			var IDS_FORMS_TOOL_TREE_VIEW_FIELDS_LABEL = 3688;
			var IDS_FORMS_TOOL_TREE_VIEW_FORMS_LABEL = 3689;
			var IDS_FORMS_TOOL_TREE_VIEW_GROOVE_FORM_FORMAT_STRING = 3690;
			var IDS_FORMS_TOOL_TREE_VIEW_INFOPATH_FORM_FORMAT_STRING = 3691;
			var IDS_FORMS_TOOL_TREE_VIEW_MACROS_LABEL = 3692;
			var IDS_FORMS_TOOL_TREE_VIEW_SCRIPTS_LABEL = 3693;
			var IDS_FORMS_TOOL_TREE_VIEW_SETTINGS_AND_OPTIONS_LABEL = 3694;
			var IDS_FORMS_TOOL_TREE_VIEW_STYLES_LABEL = 3695;
			var IDS_FORMS_TOOL_TREE_VIEW_SYSTEM_FIELD_TYPE_FORMAT = 3696;
			var IDS_FORMS_TOOL_TREE_VIEW_VIEWS_LABEL = 3697;
			var IDS_FORMS_TOOL_UNRESOLVEABLE_LOOKUP_ERROR_TITLE = 3698;
			var IDS_FORMS_TOOL_UPDATE_LABEL = 3699;
			var IDS_FORMS_TOOL_UPDATE_TOOLTIP = 3700;
			var IDS_FORMS_TOOL_VIEW_ACCESS_LABEL = 3701;
			var IDS_FORMS_TOOL_VIEW_DISPLAYS_COLUMNS = 3702;
			var IDS_FORMS_TOOL_VIEW_FILTER_TAB_NAME = 3703;
			var IDS_FORMS_TOOL_VIEW_MENU_LABEL = 3704;
			var IDS_FORMS_TOOL_VIEW_MENU_TOOLTIP = 3705;
			var IDS_FORMS_TOOL_VIEW_NOT_FOUND_TITLE = 3706;
			var IDS_FORMS_TOOL_VIEW_PERMISSIONS_LABEL = 3707;
			var IDS_FORMS_TOOL_VIEW_PERMISSIONS_LABEL2 = 3708;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_FONT_STYLE = 3709;
			
			
			
			var IDS_FORMS_TOOL_COMMON_THIS_TOOL =4173;
			var IDS_FORMS_TOOL_COMMON_THIS_WORKSPACE =4174;
			var IDS_FORMS_TOOL_COMMON_XML_TOOLTIP_REIMPORT =4175;
			var IDS_FORMS_TOOL_CONTEXT_MENU_COPY =4176;
			var IDS_FORMS_TOOL_CONTEXT_MENU_COPY_AS_LINK =4177;
			var IDS_FORMS_TOOL_CONTEXT_MENU_CUT =4178;
			var IDS_FORMS_TOOL_CONTEXT_MENU_DELETE =4179;
			var IDS_FORMS_TOOL_CONTEXT_MENU_MARK_SEL_READ =4180;
			var IDS_FORMS_TOOL_CONTEXT_MENU_MARK_SEL_UNREAD =4181;
			var IDS_FORMS_TOOL_CONTEXT_MENU_OPEN =4182;
			var IDS_FORMS_TOOL_CONTEXT_MENU_PROPERTIES =4183;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_HTML_SOURCE =4184;
			var IDS_FORMS_TOOL_DESIGNER_GRP_FRM_PREVIEW =4185;
			var IDS_FORMS_TOOL_EXPORT_INITIAL_FILE_NAME =4186;
			var IDS_FORMS_TOOL_GRP_TAB_FIELD_ERROR =4187;
			var IDS_FORMS_TOOL_GRP_TAB_FIELD_TITLE =4188;
			var IDS_FORMS_TOOL_GRP_TAB_TEXT_ERROR =4189;
			var IDS_FORMS_TOOL_GRP_TAB_TEXT_TITLE =4190;
			var IDS_FORMS_TOOL_INFO_PATH_ERR_WARN_DLG_DESC =4191;
			var IDS_FORMS_TOOL_INFO_PATH_ERR_WARN_DLG_LVCOLHDR_DESCRIPTION =4192;
			var IDS_FORMS_TOOL_INFO_PATH_ERR_WARN_DLG_WINDOW_TITLE =4193;
			var IDS_FORMS_TOOL_IP_FIELD_TYPE_ERROR =4194;
			var IDS_FORMS_TOOL_IP_FIELD_TYPE_ERROR_TITLE =4195;
			var IDS_FORMS_TOOL_JS_REMOVE_CONTACT_TITLE =4196;
			var IDS_FORMS_TOOL_PERMISSIONS_DEFAULT_DISPLAY_VALUE =4197;
			var IDS_FORMS_TOOL_REIMPORT_LABEL =4198;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_COL_PROP_CANNOT_SORT =4199;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_ADD_MORE_CODE =4200;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_UPDATE_CONDITION =4201;
			var IDS_FORMS_TOOL_SUBFORMS_GRP_FLD_WIZ_MAX_LABEL_SIZE_MSG =4202;
			
			var IDS_FORMS_TOOL_SUBFORMS_GRP_TOOLTIP_CLOSE_WINDOW =4251;

			var IDS_FORMS_TOOL_FIELD_GROUP_ERROR = 4301;
			var IDS_FORMS_TOOL_FIELD_GROUP_ERROR_TITLE = 4302;
			var IDS_FORMS_TOOL_TAB_GROUP_ERROR = 4303;
			var IDS_FORMS_TOOL_TAB_GROUP_ERROR_TITLE = 4304;
			
			var IDS_FORMS_TOOL_MNEMONIC_ALT_C = 4343;
			var IDS_FORMS_TOOL_MNEMONIC_ALT_B = 4344;
			var IDS_FORMS_TOOL_MNEMONIC_ALT_N = 4345;
			var IDS_FORMS_TOOL_MNEMONIC_ALT_S = 4346;
			var IDS_FORMS_TOOL_MNEMONIC_ALT_F = 4347;
			var IDS_FORMS_TOOL_ACCELERATOR_CTRL_S = 4348;
			var IDS_FORMS_TOOL_ACCELERATOR_CTRL_L = 4349;
			var IDS_FORMS_TOOL_ACCELERATOR_CTRL_F = 4350;

			//**************************************************************************
			//
			// From GrooveDataListAlpha.idl
			//
			//**************************************************************************

			var GrooveDataListDateTimeFormat_Default = 0;
			var GrooveDataListDateTimeFormat_ShortDate = 1;
			var GrooveDataListDateTimeFormat_LongDate = 2;
			var GrooveDataListDateTimeFormat_Hour = 4;
			var GrooveDataListDateTimeFormat_HourInDay = 5;
			var GrooveDataListDateTimeFormat_DayInMonth = 6;
			var GrooveDataListDateTimeFormat_DayOfWeek = 7;
			var GrooveDataListDateTimeFormat_ShortDayOfWeek = 8;
			var GrooveDataListDateTimeFormat_DayInYear = 9;
			var GrooveDataListDateTimeFormat_WeekInMonth = 10;
			var GrooveDataListDateTimeFormat_WeekInYear = 11;
			var GrooveDataListDateTimeFormat_Month = 12;
			var GrooveDataListDateTimeFormat_ShortMonth = 13;
			var GrooveDataListDateTimeFormat_MonthInYear = 14;
			var GrooveDataListDateTimeFormat_ShortMonthInYear = 15;
			var GrooveDataListDateTimeFormat_Year = 16;
			var GrooveDataListDateTimeFormat_ShortYear = 17;
			var GrooveDataListDateTimeFormat_ShortDateShortTime = 18;
			var GrooveDataListDateTimeFormat_MediumDateMediumTime = 19;
			var GrooveDataListDateTimeFormat_ShortTime = 20;
			var GrooveDataListDateTimeFormat_MediumTime = 21;
			var GrooveDataListDateTimeFormat_LongDateLongTime = 22;

			//**************************************************************************
			//
			// From GlobalHelperFunctions
			//
			//**************************************************************************

			// IE registry
			var MSIE_KEY = "Software\\Microsoft\\Internet Explorer";

			var PROPERTY_CANONICAL_URL = "_CanonicalURL";
			var PROPERTY_TOOL_CONTAINER = "_ToolContainer";
			var PROPERTY_DYNAMICS_MANAGER = "_DynamicsManager";
			var PROPERTY_TELESPACE_DATABASE = "_TelespaceDatabase";
			var PROPERTY_TELESPACE_PROVIDER = "_TelespaceProvider";
			var PROPERTY_TELESPACE = "_Telespace";
			var PROPERTY_TOOL_DISPLAY_NAME = "_ToolDisplayName";
			var PROPERTY_TOOL_NAME = "_ToolName";
			var PROPERTY_TOOL_URL = "_ToolURL";
			var PROPERTY_TOOL = "_Tool";
			var PROPERTY_FORM = "_Form";
			var PROPERTY_OBJECT_ENTRY_STORE = "_ObjectEntryStore";
			var PROPERTY_ACCOUNT_GUID = "_AccountGUID";
			var PROPERTY_CURRENT_IDENTITY = "_CurrentIdentity";
			var PROPERTY_ACCOUNT = "_Account";

			// UIPropertyList constants
			var UIPROPERTY_TOP_LEVEL_WINDOW = "_TopLevelWindow";
			var UIPROPERTY_URLNAVIGATOR = "_URLNavigator";
			var UIPROPERTY_WINDOW_ACCOUNT = "_WindowAccount";
			var UI_PROPERTY_UIACTIVE_COMPONENT = "_UIActiveComponent";

			// Access control strings
			var STR_COMMON_ACCESS_CONTROL_COMPONENT_GROUP_OBJECT_ID = "$ComponentGroup";			
			var STR_COMMON_ACCESS_CONTROL_TELESPACE_MANAGER_ROLE_NAME = "$Telespace.Manager";			
			var STR_COMMON_ACCESS_CONTROL_TELESPACE_SCOPE_URL = "";

			var GROOVE_VK_ENTER = 0x0d;
			var GROOVE_VK_INSERT = 0x2d;
			var GROOVE_VK_DELETE = 0x2e;
			var GROOVE_VK_ESC = 0x1B;
			var GROOVE_VK_D = 0x44;

			// Keystroke Message Values
			var GROOVE_WM_KEYDOWN = 0x100;
			var GROOVE_WM_KEYUP = 0x101;

			// Keystate Modifier Values
			var GROOVE_KEYMOD_SHIFT = 0x00000001;
			var GROOVE_KEYMOD_CONTROL = 0x00000002;
			var GROOVE_KEYMOD_ALT = 0x00000004;

			// Global pointers
			var GROOVE_GLOBAL_MISC_POINTER = GrooveScriptFunctions.CreateNewObject("Groove.SystemServices").Misc;
			var GROOVE_NULL = GrooveScriptFunctions.CreateNewObject("");

			// Invalid date constant
			var INVALID_DATE = -0xFFFFFFFFFFFFF;
			
			// Returns all characters to the right of the search string's
			// first occurrence, searching from left to right.  Returns the
			// input string if the search string isn't found.
			//
			function Right(i_InputString, i_SearchString)
			{
				var FromPos = i_InputString.indexOf(i_SearchString);
				if (-1 == FromPos)
				{
					return i_InputString;
				}

				FromPos += i_SearchString.length;
				return i_InputString.substring(FromPos, i_InputString.length);
			}

			// Returns all characters to the right of the search string's
			// first occurrence, searching from right to left.  Returns the
			// input string if the search string isn't found.
			//
			function RightBack(i_InputString, i_SearchString)
			{
				var FromPos = i_InputString.lastIndexOf(i_SearchString)
				if (-1 == FromPos)
				{
					return i_InputString;
				}
				
				FromPos += i_SearchString.length;
				return i_InputString.substring(FromPos, i_InputString.length);
			}

			// Returns all characters to the left of the search string's
			// first occurrence, searching from left to right.  Returns the
			// input string if the search string isn't found.
			//
			function Left(i_InputString, i_SearchString)
			{
				var ToPos = i_InputString.indexOf(i_SearchString);
				if (-1 == ToPos)
				{
					return i_InputString;
				}

				return i_InputString.substring(0, ToPos);
			}

			// Returns all characters to the left of the search string's
			// first occurrence, searching from right to left.  Returns the
			// input string if the search string isn't found.
			//
			function LeftBack(i_InputString, i_SearchString)
			{
				var ToPos = i_InputString.lastIndexOf(i_SearchString);
				if (ToPos == -1)
				{
					return i_InputString;
				}

				return i_InputString.substring(0, ToPos);
			}

			// This function trims leading and trailing whitespace off the string
			function TrimEnds(String)
			{
				return TrimTail(TrimHead(String));
			}

			// This function trims leading whitespace off the string
			function TrimHead(String)
			{
				var length = String.length;
				for (i=0; i<length; i++)
				{
					if (" " != String.charAt(i))
						break;
				}
				return String.substr(i, length);
			}

			// This function trims trailing whitespace off the string
			function TrimTail(String)
			{
				var length = String.length;
				for (i=length-1; i>=0; i--)
				{
					if (" " != String.charAt(i))
						break;
				}
				return String.substr(0, i + 1);
			}	
	
			function CreateBSTREnum()
			{
				var BSTREnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateBSTREnum();
				var BSTREnumCreate = BSTREnum.BSTREnumCreate;
				return BSTREnumCreate;
			}

			function CreateStringStringEnum(i_bSort)
			{
				if (typeof i_bSort == "undefined")
					i_bSort = false;
				var StringStringEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateStringStringEnum(i_bSort);
				var StringStringEnumCreate = StringStringEnum.StringStringEnumCreate;
				return StringStringEnumCreate;
			}

			function CreateVARIANTEnum()
			{
				var VARIANTEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateVARIANTEnum();
				var VARIANTEnumCreate = VARIANTEnum.VARIANTEnumCreate;
				return VARIANTEnumCreate;
			}

			function CreateNameValueEnum()
			{
				var NameValueEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum();
				var NameValueEnumCreate = NameValueEnum.NameValueEnumCreate;
				return NameValueEnumCreate;
			}

			function CreateDoubleEnum()
			{
				var DoubleEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateDoubleEnum();
				var DoubleEnumCreate = DoubleEnum.DoubleEnumCreate;
				return DoubleEnumCreate;
			}

			function CreateUnknownEnumFromStringIIDs(i_EnumIID, i_EntryIID)
			{
				var UnknownEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs(i_EnumIID, i_EntryIID);
				var UnknownEnumCreate = UnknownEnum.UnknownEnumCreate;
				return UnknownEnumCreate;
			}

			function CreateByteInputStreamFromFile(i_File, i_DenyNone)
			{
				if (null == i_DenyNone)
					i_DenyNone = false;

				var ByteInputStream;
				try
				{
					ByteInputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteInputStreamFromFile2(i_File, i_DenyNone);
				}
				catch (e)
				{
				}
				return ByteInputStream;
			}

			function CreateByteOutputStreamFromFile(i_File, i_Append, i_ReadOnly)
			{
				if (null == i_Append)
					i_Append = false;

				if (null == i_ReadOnly)
					i_ReadOnly = false;

				var ByteOutputStream;
				try
				{
					ByteOutputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteOutputStreamFromFile(i_File, i_Append, i_ReadOnly);
				}
				catch(e)
				{
				}
				return ByteOutputStream;
			}

			function CreateMemoryByteStore(i_PageSize)
			{
				if (null == i_PageSize)
					i_PageSize = 0;

				var MemoryByteStore = GROOVE_GLOBAL_MISC_POINTER.StoreFactory.CreateMemoryByteStore(i_PageSize);
				return MemoryByteStore;
			}

			function OpenAccountFromPropertyList(pPropertyList)
			{
				return pPropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE_PROVIDER);
			}

			function OpenFullNameFromCurrentIdentity(PropertyList, i_IncludeAnnotation)
			{
				if (i_IncludeAnnotation == null)
					i_IncludeAnnotation = true;

				var Telespace = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
				var pCurrentIdentity = Telespace.OpenCurrentIdentity();
				var pCurrentIdentityContact = pCurrentIdentity.Contact;
				return OpenFullNameFromContact(pCurrentIdentityContact, i_IncludeAnnotation);
			}

			function OpenFullNameFromContact(i_Contact, i_IncludeAnnotation)
			{
				if (i_IncludeAnnotation == null)
					i_IncludeAnnotation = true;

				var Name;
				if (i_IncludeAnnotation)
					Name = i_Contact.ContactStoreEntry.DisplayName;
				else
					Name = i_Contact.OpenVCard().OpenIdentification().OpenFullName();
				return Name;
			}

			function OpenRecordCreatorName(i_pPropertyList, i_pRecord, i_UseAlias)
			{
				return OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, "_CreatedByURL");
			}

			function OpenRecordModifierName(i_pPropertyList, i_pRecord, i_UseAlias)
			{
				return OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, "_ModifiedByURL");
			}

			function OpenRecordNameByURL(i_pPropertyList, i_pRecord, i_UseAlias, i_URLField)
			{
				if (i_UseAlias == null)
					i_UseAlias = false;

				var CS = i_pPropertyList.OpenProperty("_ContactStore");
				var Telespace = i_pPropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);

				try
				{
					var Transaction = Telespace.OpenTransaction(true);
					var CURL = i_pRecord.OpenFieldAsString(i_URLField);
					Transaction.Commit();

					if (CS.DoesExist(CURL))
					{
						var CurrContact = CS.Open(CURL);
						return OpenFullNameFromContact(CurrContact);
					}
					else
						return false;
				}
				catch (error)
				{
					Transaction.Abort();
					return false;
				}
			}

			function Helper_GetRoles(i_ScopeURL, i_pTelespace, i_ObjectID)
			{
				var pObjectEntryStore = i_pTelespace.ObjectEntryStore;
				if (pObjectEntryStore)
					{
					var ObjEntry = pObjectEntryStore.Open(i_ScopeURL, i_ObjectID);
					return ObjEntry.AccessControl.IGrooveRoles;
					}
				return null;
			}

			function Helper_GetRoleForUser(i_Roles, i_TemplateRoleEnum, i_ContactURL)
			{
				i_TemplateRoleEnum.Reset();
				while (i_TemplateRoleEnum.HasMore())
				{
					var TemplateRole = i_TemplateRoleEnum.OpenNext();
					if (TemplateRole.Visible)
					{
						var Role = i_Roles.Open(TemplateRole.Name);
						if (Role.ContainsMember(i_ContactURL))
							return TemplateRole;
					}
				}
			}

			function SetClipboardEmpty()
			{
				var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
				var pClipboard = pUIManager.OpenClipboard();
				pClipboard.SetEmpty();
			}

			function CopyAsLinkToClipboard(i_CanonicalURL, i_DisplayName)
			{
				var pStorageMgr = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				var pElement = pStorageMgr.CreateTemporaryElement("GrooveLink");
				pElement.SetAttribute("DisplayName", i_DisplayName);
				pElement.SetAttribute("URL", i_CanonicalURL);

				var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
				var pClipboard = pUIManager.OpenClipboard();
				pClipboard.SetDataAsElement("GrooveLink", pElement);
			}

			//	Custom object, typically used for DLLs and EXEs
			function VersionObject(i_VersionString)
			{
				var VerArray = i_VersionString.split(".");
				if (typeof i_VersionString != "undefined")
					this.VersionString = i_VersionString;
				if (typeof VerArray[0] != "undefined")
					this.MajorVersion = parseInt(VerArray[0]);
				if (typeof VerArray[1] != "undefined")
					this.MinorVersion = parseInt(VerArray[1]);
				if (typeof VerArray[2] != "undefined")
					this.BuildVersion = parseInt(VerArray[2]);
				if (typeof VerArray[3] != "undefined")
					this.SubBuildVersion = parseInt(VerArray[3]);
			}

			function GetMSIEVersion()
			{
				//	Works with IE4.0 and later
				//  See  http://support.microsoft.com/default.aspx?scid=kb;EN-US;q164539 for more
				//  information as to how IE reports version numbers back for the various
				//  versions of IE.
				var App = GrooveScriptFunctions.CreateNewObject("Groove.Application");
				var VerString = App.ReadRegistryValue(GrooveRegistryKeyValue_LocalMachine,
													  MSIE_KEY, "Version");
				if (typeof VerString != "undefined" && VerString != "")
				{
					var MSIEVersion = new VersionObject(VerString);
					return MSIEVersion;
				}
				else
					return null;
			}
			
			function ResolveLinkTargetPathName(i_Path)
			{
				if(IsLNKShortcutFile(i_Path))
				{
					var pIFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

					var SourcePath = pIFileSystemServices.OpenShortcutFileInfo(i_Path);
					return ResolveLinkTargetPathName(SourcePath);
				}
				else
				{
					return i_Path;
				}
			}

			function IsLNKShortcutFile(i_Path)
			{
				var pIFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
				var LNKExtension = "lnk";
				if(pIFileSystemServices.IsFileLinkByPath(i_Path) &&
						(LNKExtension == pIFileSystemServices.OpenFileExtension(i_Path).toLowerCase()))
					return true;
				else
					return false;
			}


			//**************************************************************************
			//
			// End from GlobalHelperFunctions
			//
			//**************************************************************************

			//**************************************************************************
			//
			// From ArrayHelperFunctions
			//
			//**************************************************************************

			function CompressArray(i_Array, i_IndexToRemove)
			{
				var newArray = i_Array.slice(i_IndexToRemove, i_IndexToRemove+1);
				var retArray = new Array();
				var x = 0;
				for (var i = 0; i < i_Array.length; i++)
				{
					if (typeof i_Array[i] != "undefined")
					{
						retArray[x] = i_Array[i];
						x++;
					}
				}
				return retArray;						
			}

			//**************************************************************************
			//
			// End from ArrayHelperFunctions
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From CalendarHelper
			//
			//**************************************************************************

			var g_Intl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
	
			// Returns string
			function FormatDate(i_Millis, i_FormatStyle)
			{
				if (!isNaN(i_Millis))
				{
					var DateFormat = g_Intl.CreateDateFormatForDate(i_FormatStyle, GROOVE_NULL);
					var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
					return DateFormat.Format(DateObj, "", GROOVE_NULL);
				}
				else
					return "";
			}

			// Returns string
			function FormatTime(i_Millis, i_FormatStyle)
			{
				if (!isNaN(i_Millis))
				{
					var DateFormat = g_Intl.CreateDateFormatForTime(i_FormatStyle, GROOVE_NULL);
					var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
					return DateFormat.Format(DateObj, "", GROOVE_NULL);
				}
				else
					return "";
			}

			// Returns string
			function FormatDateTime(i_Millis, i_DateStyle, i_TimeStyle)
			{
				if (!isNaN(i_Millis))
				{
					var DateFormat = g_Intl.CreateDateFormatForDateTime(i_DateStyle, i_TimeStyle, GROOVE_NULL);
					var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
					return DateFormat.Format(DateObj, "", GROOVE_NULL);
				}
				else
					return "";
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseDate(i_DateString, i_FormatStyle)
			{		
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDate(i_FormatStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseTime(i_TimeString, i_FormatStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForTime(i_FormatStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_TimeString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			// Returns raw date/time (milliseconds) or NaN for invalid strings
			function ParseDateTime(i_DateTimeString, i_DateStyle, i_TimeStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDateTime(i_DateStyle, i_TimeStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateTimeString, GROOVE_NULL);
					return DateObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function ParseDateAndTime(i_DateString, i_DateStyle, i_TimeString, i_TimeStyle)
			{
				try
				{
					var DateFormat = g_Intl.CreateDateFormatForDate(i_DateStyle, GROOVE_NULL);
					var DateObj = DateFormat.Parse(i_DateString, GROOVE_NULL);
					var TimeFormat = g_Intl.CreateDateFormatForTime(i_TimeStyle, GROOVE_NULL);
					var TimeObj = TimeFormat.Parse(i_TimeString, GROOVE_NULL);
					var DateTimeObj = MergeDateAndTime(DateObj, TimeObj);
					return DateTimeObj.RawDateTime;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function MergeDateAndTime(i_DateObj, i_TimeObj)
			{
				var Calendar = g_Intl.CreateCalendar();

				Calendar.DateTime = i_DateObj;
				var Year = Calendar.Get(GrooveIntlCalendarField_Year);
				var Month = Calendar.Get(GrooveIntlCalendarField_Month);
				var Day = Calendar.Get(GrooveIntlCalendarField_DayOfMonth);

				Calendar.DateTime = i_TimeObj;
				Calendar.SetDate(Year, Month, Day);

				return Calendar.DateTime;
			}

			// Creates and returns an IGrooveCalendar for the specified date/time
			function CreateCalendar(i_Millis)
			{
				var DateObj = g_Intl.CreateDateFromRawDateTime(i_Millis);
				var Calendar = g_Intl.CreateCalendar();
				Calendar.DateTime = DateObj;
				return Calendar;
			}

			function StartOfDay(i_Millis)
			{
				var Calendar = CreateCalendar(i_Millis);

				var Year = Calendar.Get(GrooveIntlCalendarField_Year);
				var Month = Calendar.Get(GrooveIntlCalendarField_Month);
				var Day = Calendar.Get(GrooveIntlCalendarField_DayOfMonth);

				Calendar.Clear();
				Calendar.SetDate(Year, Month, Day);

				return Calendar.DateTime.RawDateTime;
			}

			function EndOfDay(i_Millis)
			{
				var Start = StartOfDay(i_Millis);
				var Calendar = CreateCalendar(Start);

				Calendar.Add(GrooveIntlCalendarField_DayOfMonth, 1);
				Calendar.Add(GrooveIntlCalendarField_Millisecond, -1);

				return Calendar.DateTime.RawDateTime;
			}

			//**************************************************************************
			//
			// End from CalendarHelper
			//
			//**************************************************************************

			//**************************************************************************
			//
			// From GrooveClient.idl
			//
			//**************************************************************************
			
			// "Abort, Retry, Ignore" buttons.
			var GrooveMessageBoxStyle_AbortRetryIgnore = 0x0001;
			
			// "Cancel, Try, Continue" buttons.
			var GrooveMessageBoxStyle_CancelTryContinue = 0x0002;
			
			// "OK" button.
			var GrooveMessageBoxStyle_OK = 0x0004;
			
			// "OK, Cancel" buttons.
			var GrooveMessageBoxStyle_OKCancel = 0x0008;
			
			// "Retry, Cancel" buttons.
			var GrooveMessageBoxStyle_RetryCancel = 0x0010;
			
			// "Yes, No" buttons.
			var GrooveMessageBoxStyle_YesNo = 0x0020;
			
			// "Yes, No, Cancel" buttons.
			var GrooveMessageBoxStyle_YesNoCancel = 0x0040;

			// No icon.
			var GrooveMessageBoxIcon_None = 0x0000;

			// Exclamation icon.
			var GrooveMessageBoxIcon_Exclamation = 0x0080;

			// Warning icon.
			var GrooveMessageBoxIcon_Warning = 0x0081;

			// Information icon.
			var GrooveMessageBoxIcon_Information = 0x0100;

			// Asterisk icon.
			var GrooveMessageBoxIcon_Asterisk = 0x0101;

			// Question icon has been deprecated. Use Warning or Information as appropriate

			// Stop icon.
			var GrooveMessageBoxIcon_Stop = 0x0400;
			
			// Error icon.
			var GrooveMessageBoxIcon_Error = 0x0401;
			
			// Hand icon.
			var GrooveMessageBoxIcon_Hand = 0x0402;

			// OK.
			var GrooveMessageBoxResultCode_OK = 1;

			// Cancel.
			var GrooveMessageBoxResultCode_Cancel = 2;

			// Abort.
			var GrooveMessageBoxResultCode_Abort = 3;

			// Retry.
			var GrooveMessageBoxResultCode_Retry = 4;

			// Ignore.
			var GrooveMessageBoxResultCode_Ignore = 5;

			// Yes.
			var GrooveMessageBoxResultCode_Yes = 6;

			// No.
			var GrooveMessageBoxResultCode_No = 7;

			// Try Again.
			var GrooveMessageBoxResultCode_TryAgain = 10;

			// Continue.
			var GrooveMessageBoxResultCode_Continue = 11;

			// No special style.
			var GrooveInputBoxStyle_None = 0;

			// Password style.
			var GrooveInputBoxStyle_Password = 1;

			// AllowEmptyValue style.
			var GrooveInputBoxStyle_AllowEmptyValue = 2;

			// System directory.
			var GrooveDirectoryValue_System = 1;

			// Temp directory.
			var GrooveDirectoryValue_Temp = 2;
			
			// System registry key for GrooveRegistryKeyValue as Local Machine. 
			var GrooveRegistryKeyValue_LocalMachine = 1;

				// Dialog box value OK.
			var GrooveDialogBoxResultCode_OK = 1;

			// Dialog box value Cancel. 
			var GrooveDialogBoxResultCode_Cancel = 2;
			//**************************************************************************
			//
			// End from GrooveClient.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveInternationalization.idl
			//
			//**************************************************************************

			// Full.
			var GrooveIntlDateFormatStyle_Full = 0;

			// Long.
			var GrooveIntlDateFormatStyle_Long = 1;

			// Medium.
			var GrooveIntlDateFormatStyle_Medium = 2;

			// Short.
			var GrooveIntlDateFormatStyle_Short = 3;

			// Default.
			var GrooveIntlDateFormatStyle_Default = GrooveIntlDateFormatStyle_Short;

			// DOUBLE floating point value.
			var GrooveIntlFormattableType_Double = 1;

			// LONG signed integer value.
			var GrooveIntlFormattableType_Long = 2;

			// Era field, e.g. 0..1 (calendar specific).
			var GrooveIntlCalendarField_Era = 0;

			// Year field, e.g. 1..N.
			var GrooveIntlCalendarField_Year = 1;

			// Month field, e.g. 0..11.
			var GrooveIntlCalendarField_Month = 2;

			// Week-Of-Year field, e.g. 1..53.
			var GrooveIntlCalendarField_WeekOfYear = 3;

			// Week-Of-Month field, e.g. 0..6.
			var GrooveIntlCalendarField_WeekOfMonth = 4;

			// Day-Of-Month field, e.g. 1..31.
			var GrooveIntlCalendarField_DayOfMonth = 5;

			// Day-Of-Year field, e.g. 1..366.
			var GrooveIntlCalendarField_DayOfYear = 6;

			// Day-Of-Week field, e.g. 1..7.
			var GrooveIntlCalendarField_DayOfWeek = 7;

			// Day-Of-Week-In-Month field, e.g. 1..6, may be specified as -1.
			var GrooveIntlCalendarField_DayOfWeekInMonth = 8;

			// AM/PM field, e.g. 0..1.
			var GrooveIntlCalendarField_AMPM = 9;

			// Hour field, e.g. 0..11.
			var GrooveIntlCalendarField_Hour = 10;

			// Hour-Of-Day field, e.g. 0..23.
			var GrooveIntlCalendarField_HourOfDay = 11;

			// Minute field, e.g. 0..59.
			var GrooveIntlCalendarField_Minute = 12;

			// Second field, e.g. 0..59.
			var GrooveIntlCalendarField_Second = 13;

			// Millisecond field, e.g. 0..999.
			var GrooveIntlCalendarField_Millisecond = 14;

			// Time-Zone-Offset field, e.g. (-12 * GrooveIntlDateMillis_MillisPerHour)..(12 * GrooveIntlDateMillis_MillisPerHour).
			var GrooveIntlCalendarField_ZoneOffset = 15;

			// Daylight-Savings-Time-Offset field, e.g. 0 or GrooveIntlDateMillis_MillisPerHour.
			var GrooveIntlCalendarField_DSTOffset = 16;

			//**************************************************************************
			//
			// End from GrooveInternationalization.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCalendarTool.idl
			//
			//**************************************************************************

			// Command to add a new calendar entry.
			var GrooveCalendarCommand_NewEntry = 0;

			// Command to view or edit details about the entry.
			var GrooveCalendarCommand_OpenDetail = 1;

			// Command to delete the entry.
			var GrooveCalendarCommand_Delete = 2;

			// Command to cut the entry.
			var GrooveCalendarCommand_Cut = 3;

			// Command to copy the entry.
			var GrooveCalendarCommand_Copy = 4;

			// Command to paste the entry.
			var GrooveCalendarCommand_Paste = 5;

			// Command to copy the entry as a link.
			var GrooveCalendarCommand_CopyAsLink = 6;

			// Command to save the entry in an external format.
			var GrooveCalendarCommand_SaveAs = 7;

			// Command to mark the entry as read.
			var GrooveCalendarCommand_MarkRead = 8;

			// Command to mark the entry as unread.
			var GrooveCalendarCommand_MarkUnread = 9;

			// Command to mark all entries as read.
			var GrooveCalendarCommand_MarkAllRead = 10;

			// Command to mark all entries as unread.
			var GrooveCalendarCommand_MarkAllUnread = 11;

			// Command to display the day view.
			var GrooveCalendarCommand_DayView = 12;

			// Command to display the week view
			var GrooveCalendarCommand_WeekView = 13;

			// Command to display the month view.
			var GrooveCalendarCommand_MonthView = 14;

			// Command to display the business week view.
			var GrooveCalendarCommand_BusinessWeekView = 15;

			// Command to display the business month view.
			var GrooveCalendarCommand_BusinessMonthView = 16;

			// Command to scroll to the next unit of time.
			var GrooveCalendarCommand_ScrollNext = 17;

			// Command to scroll to the previous unit of time.
			var GrooveCalendarCommand_ScrollPrev = 18;

			// Command to scroll to the current date.
			var GrooveCalendarCommand_ScrollToday = 19;

			// Command to load a date navigation aid.
			var GrooveCalendarCommand_GoToDate = 20;

			// Command to undo the previous data change.
			var GrooveCalendarCommand_Undo = 21;

			// Command to redo the previously undone data change.
			var GrooveCalendarCommand_Redo = 22;

			// Command to enable synchronization with Outlook.
			var GrooveCalendarCommand_EnableOutlookSync = 23;

			// Command to send a single event to OUtlook.
			var GrooveCalendarCommand_SendEventToOutlook = 24;

			// Command to Print the entry.
			var GrooveCalendarCommand_Print = 25;

			//**************************************************************************
			//
			// End from GrooveCalendarTool.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveMiscServices.idl
			//
			//**************************************************************************

			// UTF8 character type.
			var GrooveCharEncodingType_UTF8 = 0;

			//**************************************************************************
			//
			// End from GrooveMiscServices.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveMiscServicesAlpha.idl
			//
			//**************************************************************************

			// Delayed deletion of temporary file.
			var GrooveTemporaryFileDeleteFlag_TimerDelay = 1;

			// Attempt deletion of temporary file on each shutdown/startup of temporary file service.
			var GrooveTemporaryFileDeleteFlag_ShutdownStartup = 2;

			//**************************************************************************
			//
			// End from GrooveMiscServicesAlpha.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCommonComponents.idl
			//
			//**************************************************************************

			// Width is determined at runtime based on available space. 
			var GrooveListViewColumnWidthType_AutoSize = 1;

			// Width is specified as a fixed number of pixels.
			var GrooveListViewColumnWidthType_Pixels = 2;

			// Column has left alignment.
			var GrooveListViewColumnAlignment_Left = 0;

			// Column has right alignment.
			var GrooveListViewColumnAlignment_Right = 1;

			// Column has center alignment.
			var GrooveListViewColumnAlignment_Center = 2;

			// Action caused by unknown source.
			var GrooveSelectionChangeActionTrigger_Unknown = 0;

			// Action caused by mouse.
			var GrooveSelectionChangeActionTrigger_ByMouse = 1;

			// Action caused by keyboard.
			var GrooveSelectionChangeActionTrigger_ByKeyboard = 2;

			// Insert item first.
			var GrooveTreeViewInsertOrder_First = 1;

			// Insert item last.
			var GrooveTreeViewInsertOrder_Last = 2;

			// Insert item at root.
			var GrooveTreeViewInsertOrder_Root = 3;

			// Insert item first in alphabetical order.
			var GrooveTreeViewInsertOrder_Sort = 4;

			// Insert item as the next sibling of the specified parent item.
			var GrooveTreeViewInsertOrder_NextSibling = 5;

			// Collapse item.
			var GrooveTreeViewExpandOrder_Collapse = 1;

			// Expand item.
			var GrooveTreeViewExpandOrder_Expand = 2;

			// Toggle.
			var GrooveTreeViewExpandOrder_Toggle = 3;

			// The execution context is new (code has never executed)
			// Code can safely be added. 
			// You cannot set the state of an execution context to this value.
			var GrooveScriptExecutionContextState_New = 1;

			// The execution context is running. Code will execute
			// when called.
			// You cannot add code while in this state.
			var GrooveScriptExecutionContextState_Running = 2;

			// The execution context is closed and code is 
			// no longer running.
			// You cannot add code while in this state.
			var GrooveScriptExecutionContextState_Closed = 3;

			// No size information specified.
			var GrooveLayoutSizeType_None = 0;

			// Size information is in pixels.
			var GrooveLayoutSizeType_Pixels = 1;

			// Size information is in percent of available space.
			var GrooveLayoutSizeType_Percent = 2;

			// Size restrictions are to be removed.
			var GrooveLayoutSizeType_Unconstrained = 3;

			// Puts the execution context in a closed state
			// and removes it from the list of existing contexts
			var GrooveScriptExecutionContextShutdownFlag_Remove = 0;

			// Terminates and removes the code contained in the
			// execution context and resets the state to New
			var GrooveScriptExecutionContextShutdownFlag_Reset = 1;

			//**************************************************************************
			//
			// End from GrooveCommonComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveUIFramework.idl
			//
			//**************************************************************************

			var GrooveWindowResult_Cancel = -1;

			// Window operation was finished normally.
			var GrooveWindowResult_OK = 0;

			// Use to show or hide the Restore command.
			var GrooveWindowMenuCommand_Restore = 0x0001;

			// Use to show or hide the Minimize command.
			var GrooveWindowMenuCommand_Minimize = 0x0008;

			// Use to show or hide the Maximize command.
			var GrooveWindowMenuCommand_Maximize = 0x0010;

			// Use to show or hide the Close command.
			var GrooveWindowMenuCommand_Close = 0x0020;

			// UICommand's state should be rendered as unchecked.
			var GrooveCheckState_Unchecked = 0;

			// UICommand's state should be rendered as checked.
			var GrooveCheckState_Checked = 1;

			// UICommand's state should be rendered as indeterminate.
			var GrooveCheckState_Indeterminate = 2;

			//**************************************************************************
			//
			// End from GrooveUIFramework.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveStorageMgr.idl
			//
			//**************************************************************************

			// Groove chooses a format automatically.
			var GrooveSerializeType_Auto = 0x00;

			// MHTML format as defined in RFC 2557.
			var GrooveSerializeType_MIME = 0x01;

			// XML format.  Note that this format does not support binary
			// documents, but it may be a body type in MHTML.
			var GrooveSerializeType_XML = 0x02;

			// Use default serialization options (use none of the other
			// available options).
			var GrooveSerializeOption_Default = 0x0000;

			var GrooveParseOption_StripContentWhitespace = 0x01;

			// Body text.
			var GrooveContentType_Text = 1;

			var GrooveXLinkShowOption_Replace = 2;
			var GrooveXLinkSerializeOption_ByValue = 0;
			var GrooveXLinkActuateType_User = 0;
			var GrooveXLinkCompressOption_OnWire = 0x01;
			var GrooveXLinkDeserializeOption_Replace = 1;

			//**************************************************************************
			//
			// End from GrooveStorageMgr.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************

			// Property is private.
			var GrooveCommunicationsDirection_Both     = 0x3;

			//**************************************************************************
			//
			// End from GrooveComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveComponents.idl
			//
			//**************************************************************************

			// Property is private.
			var GroovePropertyFlag_Private     = 0x0000;

			//**************************************************************************
			//
			// End from GrooveComponents.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveCollectionMgr.idl
			//
			//**************************************************************************
			
			// Move the cursor to the next source row, traversing down through child rows and up 
			// through parent rows.
			var GrooveCollectionNavigationOp_NextAny = 0;

			// Navigate collapsed rows when moving the cursor (the default is to skip
			// collapsed rows).
			var GrooveCollectionNavigationOption_IncludeCollapsedRows = 0x0001;

			// First row in the collection.
			var GrooveCollectionCursorPosition_First = 0;

			// Last row in the collection.
			var GrooveCollectionCursorPosition_Last = 1;
			
			// Current row in the collection.  This position is useful for performing relative cursor 
			// movement.
			var GrooveCollectionCursorPosition_Current = 2;

			//**************************************************************************
			//
			// End from GrooveCollectionMgr.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveHelperPrivate.idl
			//
			//**************************************************************************

			var GrooveAccountDialogsSubForms_FindSubform = 38;
			var GrooveAccountDialogsSubForms_PropertySheetDialogSubform = 40;

			//**************************************************************************
			//
			// End from GrooveHelperPrivate.idl
			//
			//**************************************************************************


			//**************************************************************************
			//
			// From GrooveRecordDatabaseAlpha.idl
			//
			//**************************************************************************
			var GrooveFieldType_None    = 0; // Implied by VARTYPE
			var GrooveFieldType_String  = 1;
			var GrooveFieldType_Boolean = 2;
			var GrooveFieldType_I4      = 5;
			var GrooveFieldType_R8      = 7;
			var GrooveFieldType_Binary  = 8;
			var GrooveFieldType_DateTime = 9;
			var GrooveFieldType_Element = 10;
			var GrooveFieldType_Contact = 11;

			var GrooveRecordDatabaseChangeType_AddRecord = 0;
			var GrooveRecordDatabaseChangeType_AddRecords = 1;
			var GrooveRecordDatabaseChangeType_DeleteRecord = 2;
			var GrooveRecordDatabaseChangeType_DeleteRecords = 3;
			var GrooveRecordDatabaseChangeType_ReplaceRecord = 4;
			var GrooveRecordDatabaseChangeType_SetField = 5;

			//**************************************************************************
			//
			// End from GrooveRecordDatabaseAlpha.idl
			//
			//**************************************************************************
			
			//**************************************************************************
			//
			// From GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************
			
			// Indicates that the status being requested
			// or reported is for inbound communications.
			var GrooveCommunicationsDirection_Inbound  = 0x1;

			// Indicates that the status being requested
			// or reported is for outbound communications.
			var GrooveCommunicationsDirection_Outbound = 0x2;

			// Indicates that the status being requested
			// or reported is for both inbound AND outbound
			// communications.
			var GrooveCommunicationsDirection_Both     = GrooveCommunicationsDirection_Inbound | GrooveCommunicationsDirection_Outbound;
			
			//**************************************************************************
			//
			// End from GrooveCommunicationsServicesAlpha.idl
			//
			//**************************************************************************

			//**************************************************************************
			//
			// From GrooveDataListAlpha.idl
			//
			//**************************************************************************
			
			// No summary.
			var GrooveDataListViewColumnSummaryType_None = 0;

			// Summary is the sum of the field values in the column.
			var GrooveDataListViewColumnSummaryType_FieldValuesSum = 1;
			
			// PK
     zäcO¨º)ë      	   1/1.z4066No grouping.
			var GrooveDataListGroupType_None = 0;

			// Rows are group by unique field values.
			var GrooveDataListGroupType_UniqueFieldValues = 1;
					
			// Group row is a break on the change in units of hours.
			var GrooveDataListGroupType_Hours = 2;

			// Group row is a break on the change in units of days.
			var GrooveDataListGroupType_Days = 3;

			// Group row is a break on the change in units of weeks.
			var GrooveDataListGroupType_Weeks = 4;

			// Group row is a break on the change in units of months.
			var GrooveDataListGroupType_Months = 5;

			// Group row is a break on the change in units of years.
			var GrooveDataListGroupType_Years = 6;
			
			//**************************************************************************
			//
			// End from GrooveDataListAlpha.idl
			//
			//**************************************************************************
			
			
			function OpenCacheFromRunTimeData(i_pRunTimeData, i_CacheName)
			{
				var pCache = null;
				if (i_CacheName == "" || i_CacheName == null)
					i_CacheName = "_ObjectCache";
				i_pRunTimeData.LockData();
				try
				{
					if (i_pRunTimeData.LockedHasItem(i_CacheName))
						pCache = i_pRunTimeData.LockedGetItem(i_CacheName);
					else
					{
						pCache = GrooveScriptFunctions.OpenSharedObjectTable("");
						i_pRunTimeData.LockedSetItem(i_CacheName, pCache);
					}
				}
				catch (error)
				{
				}
				i_pRunTimeData.UnlockData();
				return pCache;
			}
						
			function AddObjectToCache(i_Key, i_pObject, i_pCache)
			{
				i_pCache.SetItem(i_Key, i_pObject);
			}

			function IsObjectInCache(i_Key, i_pCache)
			{
				return i_pCache.HasItem(i_Key);
			}

			function OpenObjectFromCache(i_Key, i_pCache)
			{
				return i_pCache.GetItem(i_Key);
			}

			function RemoveObjectFromCache(i_Key, i_pCache)
			{
				if (IsObjectInCache(i_Key, i_pCache))
				{
					i_pCache.RemoveItem(i_Key);
				}
			}

			function ShutdownCache(i_pCache, i_Callback)
			{
				i_pCache.LockData();
				try
				{
					if (i_Callback)
					{
						var pEntryEnum = i_pCache.LockedCreateNameValueEnum();
						while (pEntryEnum.HasMore())
						{
							var pEntry = pEntryEnum.OpenNextPair();
							i_Callback(pEntry.First, pEntry.Second);
						}
					}
					pEntryEnum = null;
					delete pEntryEnum;
					CollectGarbarge();
					i_pCache.LockedRemoveAllItems();
				}
				catch(error)
				{
					i_pCache.LockedRemoveAllItems();
				}

				i_pCache.UnlockData();
			}

			function ThrowError(i_Description)
			{
				var objError = new Error(-213546871, i_Description);
				throw objError;
			}

			function CreateValidXMLName(i_Name)
			{
				var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
				var ValidXMLName = pXMLSyntax.ConvertToXMLName(i_Name);
				return ValidXMLName;
			}

			function ConvertToOriginalName(i_XMLName)
			{
				if (i_XMLName != "")
				{
					var pXMLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.XMLSyntax");
					var OriginalName = pXMLSyntax.ConvertFromXMLName(i_XMLName);
					return OriginalName;
				}
				else
					return i_XMLName;
				
			}

			// get the numerical value from a number string, NaN if it is not valid
			function GetValidNumber(i_NumberString, i_UIDelegate)
			{
				// Replace all non-valid characters in the number string.
				var NumberString = i_NumberString.replace(/[^\d,-\.\(]/g, "");
				// If the number string has a paren in it, replace with a negative symbol.
				NumberString = NumberString.replace(/\(/g, "-");
				if (NumberString.toString() != "")
				{
					try
					{
						var ValidNumber = i_UIDelegate.ParseNumber(NumberString);
						if (isNaN(ValidNumber))
						{
							ValidNumber = Number(NumberString);
							if (isNaN(ValidNumber))
								ValidNumber = Number.NaN;
						}
					}
					catch (error)
					{
						ValidNumber = Number.NaN;
					}
				}

				return ValidNumber;
			}

			function CreateGUID()
			{
				var pGuidGenerator = GROOVE_GLOBAL_MISC_POINTER.OpenGUIDGenerator();	
				var GUID = pGuidGenerator.CreateGUIDBase16();
				return GUID;
			}

			function SafeOpenProperty(i_pPropertyList, i_PropertyName, i_DefaultValue)
			{
				if (i_pPropertyList.PropertyExists(i_PropertyName))
					return i_pPropertyList.OpenProperty(i_PropertyName);
				else
					return i_DefaultValue;
			}

			function GetBasePath()
			{
				var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
				var PRootPath = pStorageURISyntax.InstallDataRootPath;
				var strPath = PRootPath + "ToolData\\groove.net\\GrooveForms5";
				var Path = strPath.replace(/\\/g, "/");
				return Path;
			}

			function BuildPathFromBase(i_Scheme, i_FileName, i_Query)
			{
				var BasePath = GetBasePath();
				var pURI = GROOVE_GLOBAL_MISC_POINTER.CreateURI();
				pURI.Scheme = i_Scheme;
				pURI.SetPath(BasePath);
				pURI.AppendPathSegment(i_FileName);
				pURI.Authority = "";
				pURI.Query = i_Query;
				var URL =  pURI.String;				
				return URL;
			}

			function OpenRecordType()
			{
				var RecordType = "urn:groove.net:FormsToolUserData";
				return RecordType;
			}

			function GetFormsPreferenceAsBool(PropertyList, i_Key, i_bDefault)
			{
				var Account = OpenAccountFromPropertyList(PropertyList);
				var PreferencesPropertyList = Account.PreferencesProvider.PropertyList;
				var FormsPreferences;
				if (!PreferencesPropertyList.PropertyExists("FormsProperties"))
					FormsPreferences = PreferencesPropertyList.CreatePropertyAsPropertyList("FormsProperties");
				else
					FormsPreferences = PreferencesPropertyList.OpenPropertyAsPropertyList("FormsProperties");
				
				var o_Value = i_bDefault;
				if (FormsPreferences.PropertyExists(i_Key))
					o_Value = FormsPreferences.OpenPropertyAsBool(i_Key);

				return o_Value;
			}

			function GetColumnWidthStyleStringFromEnumValue(i_ColumnWidthStyle)
			{
				switch (i_ColumnWidthStyle)
				{
					case GrooveFormsToolViewColumnWidthStyle_Percent:
						return "%";
					case GrooveFormsToolViewColumnWidthStyle_Pixels:
					default:
						return "";
				}
			}

			function GetColumnSortOrderStringFromEnumValue(i_ColumnSortOrder)
			{
				switch (i_ColumnSortOrder)
				{
					case GrooveFormsToolViewColumnSortOrder_Ascending:
						return "Ascending";
					case GrooveFormsToolViewColumnSortOrder_Descending:
						return "Descending";
					case GrooveFormsToolViewColumnSortOrder_Both:
						return "Ascending,Descending";
					case GrooveFormsToolViewColumnSortOrder_Ordinal:
					default:
						return "Ordinal";
				}
			}

			function GetEnumValueFromDateFormatString(i_DateFormat)
			{
				switch (i_DateFormat)
				{
					case "Default":
						return GrooveIntlDateFormatStyle_Default;
					case "Full":
					case "Long":
						return GrooveIntlDateFormatStyle_Long;
					case "Medium":
					case "Short":
					default:
						return GrooveIntlDateFormatStyle_Short;
				}
			}

			function GetStringForFieldTypeEnumValue(i_FieldType)
			{
				switch (i_FieldType)
				{
					case GrooveFormsToolFieldType_Text:
						return "Text";
					case GrooveFormsToolFieldType_MultiLineText:
						return "Multi-line Text";
					case GrooveFormsToolFieldType_Number:
						return "Number";
					case GrooveFormsToolFieldType_UnformattedNumber:
						return "Unformatted Number";
					case GrooveFormsToolFieldType_Currency:
						return "Currency";
					case GrooveFormsToolFieldType_Date:
						return "Date";
					case GrooveFormsToolFieldType_DateTime:
						return "Date Time";
					case GrooveFormsToolFieldType_OptionButtons:
						return "Option Buttons";
					case GrooveFormsToolFieldType_CheckBox:
						return "Check Box";
					case GrooveFormsToolFieldType_DropDownList:
						return "Drop-down List";
					case GrooveFormsToolFieldType_ListBox:
						return "List Box";
					case GrooveFormsToolFieldType_Password:
						return "Password";
					case GrooveFormsToolFieldType_RichText:
						return "Rich Text";
					case GrooveFormsToolFieldType_Attachments:
						return "Attachments";
					case GrooveFormsToolFieldType_FormHeading:
						return "Form Heading";
					case GrooveFormsToolFieldType_SectionHeading:
						return "Section Heading";
					case GrooveFormsToolFieldType_StaticText:
						return "Static Text";
					case GrooveFormsToolFieldType_HorizontalLine:
						return "Horizontal Line";
					case GrooveFormsToolFieldType_NewLine:
						return "New Line";
					case GrooveFormsToolFieldType_ScriptButton:
						return "Script Button";
					case GrooveFormsToolFieldType_Image:
						return "Image";
					case GrooveFormsToolFieldType_SystemField:
						return "System Field";
				}
			}

			function GetValueFromQueryString(i_Key, i_Querystring, i_Default, i_Sep)
			{
				var strReturn = "";
				if (typeof i_Default != "undefined")
					strReturn = i_Default;

				var Separator = "=[^&]*";
				if (typeof i_Sep != "undefined")
					Separator = i_Sep;
				var objRegExp = new RegExp(i_Key + Separator, "");
				if (objRegExp.test(i_Querystring))
				{
					var strPair = objRegExp.exec(i_Querystring);
					var arrPair = strPair[0].split("=");
					if (arrPair.length == 2 && arrPair[0] == i_Key)
						strReturn = unescape(arrPair[1]);
				}

				return strReturn;
			}

			function AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, i_LayoutType)
			{
				var CellSizeObj = GrooveScriptFunctions.CreateNewObject(i_LayoutType);
				var CellObj = CellSizeObj.Cell();
				CellObj.Name = i_ObjectName + "Cell";

				if (i_Remove && i_Layout.IsControlInLayout(i_ObjectName))
					i_Layout.RemoveCellContents(CellObj);

				if (!i_Remove && !i_Layout.IsControlInLayout(i_ObjectName))
					i_Layout.AddControlByName(i_ObjectName, CellObj);
			}

			function AddRemoveCellContents(i_ObjectName, i_Layout, i_Remove)
			{
				AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, "Groove.HTMLTableLayoutControlInfo");
			}

			function AddRemoveMultiCellContents(i_ObjectName, i_Layout, i_Remove)
			{
				AddRemoveCellContentsHelper(i_ObjectName, i_Layout, i_Remove, "Groove.MultiCellLayoutControlInfo");
			}

			function ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, i_LayoutType)
			{
				var CellSizeObj = GrooveScriptFunctions.CreateNewObject(i_LayoutType);
				var CellObj = CellSizeObj.Cell();
				CellObj.Name = i_ObjectName + "Cell";
				if (i_Remove)
					CellSizeObj.SetHeight(0, GrooveLayoutSizeType_Pixels);
				else
					CellSizeObj.SetHeight(i_Size, GrooveLayoutSizeType_Pixels);
				i_Layout.AdjustCellLayout(CellObj, CellSizeObj);
			}
			
			function ShowHideCellContents(i_ObjectName, i_Layout, i_Size, i_Remove)
			{
				ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, "Groove.HTMLTableLayoutControlInfo")
			}

			function ShowHideMultiCellContents(i_ObjectName, i_Layout, i_Size, i_Remove)
			{
				ShowHideCellContentsHelper(i_ObjectName, i_Layout, i_Size, i_Remove, "Groove.MultiCellLayoutControlInfo")
			}

			function SetSelectionByItemData(i_ComboBox, i_Value)
			{
				i_ComboBox.SetSelectionByIndex(-1);
				for (var i = 0; i < i_ComboBox.Count; i++)
				{
					if (i_ComboBox.GetItemData(i) == i_Value)
					{
						i_ComboBox.SetSelectionByIndex(i);
						return;
					}
				}
			}

			function LocalParseNumber(i_NumberString)
			{
				try
				{
					if (i_NumberString != "")
					{
						var NumberFormat = g_Intl.CreateNumberFormat(GROOVE_NULL);
						var NumberFormattable = NumberFormat.Parse(i_NumberString, GROOVE_NULL);

						var NumberValue = Number.NaN;
						if (NumberFormattable.Type == GrooveIntlFormattableType_Double)
							NumberValue = NumberFormattable.Double;
						else if (NumberFormattable.Type == GrooveIntlFormattableType_Long)
							NumberValue = NumberFormattable.Long;

						return NumberValue;
					}
					else
						return Number.NaN;
				}
				catch (error)
				{
					return Number.NaN;
				}
			}

			function LocalFormatNumber(i_Value, i_Precision, i_Symbol)
			{
				try
				{
					// If symbol exists the value is of type currency.
					if (i_Symbol != null)
					{
						// Internationalization message formatting objects.
						var pFormatParameters = GrooveScriptFunctions.CreateNewObject("Groove.UnknownArray");
						var pMessageFormat = g_Intl.CreateMessageFormat("", GROOVE_NULL);
						// Set the precision value if it exists.
						var StringPrecision = "";
						var NumberPrecision = Number(i_Precision);
						if (NumberPrecision > 0)
						{
							StringPrecision = ".";
							var i = 0;
							var iCount = NumberPrecision;
							while (i < iCount)
							{
								StringPrecision += "0";
								i++;
							}
						}

						// Place quotes around the symbol if it is not the international currency character.
						if (i_Symbol != "\u00A4")
							i_Symbol = "'" + i_Symbol + "'";
						// This looks confusing, but it will end up creating a string like this:
						// "{0,number,'$'#,##0.00;('$'#,##0.00)}". The section before the semicolon
						// is for positive values, after is for negative values.
						var NumberFormat = i_Symbol + "#,##0" + StringPrecision;
						var FormatPattern = "{0,number," + NumberFormat + ";(" + NumberFormat + ")}";

						// Setup message formatter parameter array.
						pFormatParameters.RemoveAll();
						var pFormattable = g_Intl.CreateFormattableFromDouble(i_Value);
						pFormatParameters.Add(pFormattable);

						// Set message formatter pattern.
						pMessageFormat.ApplyPattern(FormatPattern);

						// Create formatted message.
						var NumberValue = pMessageFormat.Format(pFormatParameters);
						return NumberValue;
					}
					else
					{
						var NumberFormat = g_Intl.CreateNumberFormat(GROOVE_NULL);

						// Set the precision for the number.
						var NumberPrecision = Number(i_Precision);
						if (!isNaN(NumberPrecision))
						{
							NumberFormat.MinimumFractionDigits = NumberPrecision;
							NumberFormat.MaximumFractionDigits = NumberPrecision;
						}

						// Format the number into a string value.
						var NumberValue = NumberFormat.FormatDouble(i_Value, "", GROOVE_NULL);
						return NumberValue;
					}
				}
				catch (error)
				{
					return i_Value;
				}
			}

			function IsSystemScript(i_Name)
			{
				if (i_Name.indexOf("SystemCallouts") >= 0)
					return true;
				else
					return false;
			}

			function CheckForSameDataType(i_DataType, i_Field)
			{
				// No one should inherit from the readers and editors fields.
				var FieldName = i_Field.IGrooveFormsToolDesignObject.Name;
				if (FieldName == "_Readers" || FieldName == "_Editors")
					return false;

				// If the data type is the same, return true.
				if (i_DataType == i_Field.DataType)
					return true;
				else
					return false;
			}

		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  @           R  ‡        3     †◊ †◊                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ë               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   D   ÄName>   G r o o v e F o r m s H e l p e r F u n c t i o n s 5 . g s l         ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT     ÄSCRIPT  CRIPT  ÄSCRIPT       ÄSRC  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T y p e L i b r a r i e s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       = O p e n        ÄSCRIPT       ÄSRC*  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T e x t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  LM   § A   | I      ∑          )      ÄSCRIPT         ÏK Ä
	// Constants
	var g_THIS_SPACE = "- This Workspace -";
	var g_THIS_TOOL  = "- This Tool -";

	// ============================================
	// === Begin Lookup Property Event Handlers ===

	// Lookup Type Radio Buttons
	function LookupTypeAllRadioButton_OnCommand(i_UICommand)
	{
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 54, true);
		LookupTypeAllRadioButton.CheckState = GrooveCheckState_Checked;
		LookupTypeKeyRadioButton.CheckState = GrooveCheckState_Unchecked;
		ResetColumnComboBoxState();
	}

	function LookupTypeKeyRadioButton_OnCommand(i_UICommand)
	{
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 54, false);
		LookupTypeAllRadioButton.CheckState = GrooveCheckState_Unchecked;
		LookupTypeKeyRadioButton.CheckState = GrooveCheckState_Checked;
		ResetColumnComboBoxState();
	}

	function LookupTelespaceCheckBox_OnCommand(i_UICommand)
	{
		if (LookupTelespaceCheckBox.CheckState == GrooveCheckState_Checked)
			LookupTelespaceComboBox.Enabled = true;
		else
			LookupTelespaceComboBox.Enabled = false;
	}

	function LookupTelespaceComboBox_OnSelectionChange(i_Name, i_Item)
	{
		LookupToolComboBox.ResetContent();
		LookupViewComboBox.ResetContent();
		LookupViewComboBox.Enabled = false;
		LookupColumnComboBox.ResetContent();
		LookupColumnComboBox.Enabled = false;
		LookupKeyColumnComboBox.ResetContent();
		LookupKeyColumnComboBox.Enabled = false;
		LookupKeyValueComboBox.ResetContent();
		LookupKeyValueComboBox.Enabled = false;								
	}

	// Tool ComboBox
	function LookupToolComboBox_OnDropDown(i_Name)
	{
		LookupToolComboBox.ResetContent();
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var ToolsEnum = g_CallbackCode.GetToolsList(TelespaceDescriptor);
		var ThisToolName = PropertyList.OpenProperty(PROPERTY_TOOL_DISPLAY_NAME);
		var ThisTool = PropertyList.OpenProperty(PROPERTY_TOOL);
		var ThisToolCanonicalURL = ThisTool.CanonicalURL;
		while (ToolsEnum != null && ToolsEnum.HasMore())
		{
			var ToolPair = ToolsEnum.OpenNextPair();
			var ToolName = ToolPair.First;
			var ToolDescriptor = ToolPair.Second;
			var ToolIndex;
			if (ToolName == ThisToolName && ThisToolCanonicalURL == ToolDescriptor.CanonicalURL)
			{
				ToolName = g_THIS_TOOL;
				ToolIndex = LookupToolComboBox.InsertItem(0, ToolName);
			}
			else
				ToolIndex = LookupToolComboBox.AddItem(ToolName);
			LookupToolComboBox.SetItemData(ToolIndex, ToolDescriptor);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		ToolsEnum = null;
		delete ToolsEnum;
		CollectGarbage();
	}

	function LookupToolComboBox_OnComboBoxCloseUp(i_Name)
	{
		LookupViewComboBox.ResetContent();
		EnableDependentComboBox(LookupToolComboBox, LookupViewComboBox);
		ResetColumnComboBoxState();
	}

	// View ComboBox
	function LookupViewComboBox_OnDropDown(i_Name)
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();
		
		LookupViewComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewEnum = g_CallbackCode.GetViewList(TelespaceDescriptor, ToolDescriptor);
		while (ViewEnum != null && ViewEnum.HasMore())
		{
			var ViewPair = ViewEnum.OpenNextPair();
			var ViewName = ViewPair.First;
			var ViewID = ViewPair.Second;
			var ViewIndex = LookupViewComboBox.AddItem(ViewName);
			LookupViewComboBox.SetItemData(ViewIndex, ViewID);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		WindowMgr.ShowWaitCursor(false);								
	}

	function LookupViewComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Column ComboBox
	function LookupKeyColumnComboBox_OnDropDown(i_Name)
	{
		LookupKeyColumnComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var KeyColumnEnum = g_CallbackCode.GetPossibleKeyList(TelespaceDescriptor, ToolDescriptor, Number(ViewID));
		while (KeyColumnEnum != null && KeyColumnEnum.HasMore())
		{
			var KeyColumnName = KeyColumnEnum.OpenNext();
			var KeyColumnIndex = LookupKeyColumnComboBox.AddItem(KeyColumnName);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
	}

	function LookupKeyColumnComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Return Column ComboBox
	function LookupColumnComboBox_OnDropDown(i_Name)
	{
		LookupColumnComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var KeyColumnName = LookupKeyColumnComboBox.GetSelectionText();

		var ColumnEnum = g_CallbackCode.GetLookupColumnList(TelespaceDescriptor, ToolDescriptor, Number(ViewID), KeyColumnName);
		while (ColumnEnum != null && ColumnEnum.HasMore())
		{
			var ColumnName = ColumnEnum.OpenNext();
			var ColumnIndex = LookupColumnComboBox.AddItem(ColumnName);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
	}

	// Lookup Key/Field ComboBox
	function LookupKeyValueComboBox_OnDropDown(i_Name)
	{
		LookupKeyValueComboBox.ResetContent();

		var FieldNameEnum = g_CallbackCode.GetKeyValueFieldNameEnum();
		while (FieldNameEnum != null && FieldNameEnum.HasMore())
		{
			var FieldName = FieldNameEnum.OpenNext();
			// Don't add system fields to the combo box.
			if (FieldName != "_CreatedBy" && FieldName != "_Created" && FieldName != "_Modified" && FieldName != "_ModifiedBy")
				LookupKeyValueComboBox.AddItem(FieldName);
		}
	}

	function LookupKeyValueComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Return Radio Buttons
	function LookupReturnAllRadioButton_OnCommand(i_UICommand)
	{
		LookupReturnAllRadioButton.CheckState = GrooveCheckState_Checked;
		LookupReturnUniqueRadioButton.CheckState = GrooveCheckState_Unchecked;
	}

	function LookupReturnUniqueRadioButton_OnCommand(i_UICommand)
	{
		LookupReturnAllRadioButton.CheckState = GrooveCheckState_Unchecked;
		LookupReturnUniqueRadioButton.CheckState = GrooveCheckState_Checked;
	}

	function ResetColumnComboBoxState()
	{
		if (LookupTypeAllRadioButton.CheckState == GrooveCheckState_Checked)
		{
			EnableDependentComboBox(LookupViewComboBox, LookupColumnComboBox);
		}
		else
		{
			EnableDependentComboBox(LookupViewComboBox, LookupKeyColumnComboBox);
			EnableDependentComboBox(LookupViewComboBox, LookupKeyValueComboBox);
			EnableDependentComboBox(LookupKeyColumnComboBox, LookupColumnComboBox);
		}
	}

	function EnableDependentComboBox(i_ComboBox, i_DependentComboBox)
	{
		if (i_ComboBox.GetSelectionIndex() >= 0 && i_ComboBox.GetSelectionText() != "")
		{
			i_DependentComboBox.Enabled = true;
		}
		else
		{
			i_DependentComboBox.ResetContent();
			i_DependentComboBox.Enabled = false;
		}
	}

	// === End Lookup Property Event Handlers ===
	// ==========================================

	function GetLookupString()
	{
		var LookupErrors = new Array();

		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceName = LookupTelespaceComboBox.GetItemText(TelespaceIndex);
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var TelespaceURL = TelespaceDescriptor.CanonicalURL;
		if (TelespaceName == g_THIS_SPACE)
			TelespaceURL = "Local";
		
		
		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolName = LookupToolComboBox.GetItemText(ToolIndex);
		var ToolDescriptor = null;
		var ToolID = "";
		if (ToolIndex == -1 || ToolName == "")
			LookupErrors[LookupErrors.length] = "Tool";
		else
		{
			if (ToolName != g_THIS_TOOL)
			{
				ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);
				ToolID = ToolDescriptor.Name;
			}
			else
				ToolID = "Local";
			
		}

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewName = LookupViewComboBox.GetItemText(ViewIndex);
		var ViewID = -1;
		if (ViewIndex == -1 || ViewName == "")
			LookupErrors[LookupErrors.length] = "View";
		else
			ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var LookupColumn = LookupColumnComboBox.GetSelectionText();
		if (LookupColumn == "")
			LookupErrors[LookupErrors.length] = "Lookup Column";

		var KeyColumn = "", KeyValue = "", KeyValueIsFieldName = false;
		if (LookupTypeKeyRadioButton.CheckState == GrooveCheckState_Checked)
		{
			KeyColumn = LookupKeyColumnComboBox.GetSelectionText();
			KeyValue = LookupKeyValueComboBox.Text;
			if (KeyColumn == "")
				LookupErrors[LookupErrors.length] = "Key Column";
			if (KeyValue == "")
				LookupErrors[LookupErrors.length] = "Key Value";

			if (g_CallbackCode.GetKeyValueIsFieldName(KeyValue))
				KeyValueIsFieldName = true;
		}

		var ReturnUnique = false;
		if (LookupReturnUniqueRadioButton.CheckState == GrooveCheckState_Checked)
			ReturnUnique = true;
		
		var NoCache = false;
		if (LookupNoCacheCheckBox.CheckState == GrooveCheckState_Checked)
			NoCache = true;

		if (LookupErrors.length > 0)
		{
			g_UIDelegate.DisplayOKMessageBox("Please fill in all available values for the lookup property. These values were left blank: " + LookupErrors.join(", ") + ".", "Invalid Lookup Property Values");
			return;
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		
		var LookupString = "TelespaceName=" + escape(TelespaceName);
		LookupString	+= "&TelespaceURL=" + escape(TelespaceURL);
		LookupString	+= "&ToolDisplayName=" + escape(ToolName);
		LookupString    += "&ToolName=" + escape(ToolID);
		LookupString    += "&ViewName=" + escape(ViewName);
		LookupString    += "&ViewID=" + escape(ViewID);
		LookupString    += "&KeyColumn=" + escape(KeyColumn);
		LookupString    += "&KeyValue=" + escape(KeyValue);
		LookupString    += "&LookupColumn=" + escape(LookupColumn);
		LookupString    += "&ReturnUnique=" + ReturnUnique;
		LookupString    += "&NoCache=" + NoCache;
		LookupString	+= "&KeyValueIsFieldName=" + KeyValueIsFieldName;
		LookupString	+= "&Comment=" + escape(LookupComment.Text);
		
		return LookupString;

	}
	
	function GetXMLSyntaxBasedLookupString()
	{
		var LookupErrors = new Array();

		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceName = LookupTelespaceComboBox.GetItemText(TelespaceIndex);
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var TelespaceURL = TelespaceDescriptor.CanonicalURL;
		if (TelespaceName == g_THIS_SPACE)
			TelespaceURL = "Local";
		
		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolName = LookupToolComboBox.GetItemText(ToolIndex);
		var ToolDescriptor = null;
		var ToolID = "";
		if (ToolIndex == -1 || ToolName == "")
			LookupErrors[LookupErrors.length] = "Tool";
		else
		{
			if (ToolName != g_THIS_TOOL)
			{
				ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);
				ToolID = ToolDescriptor.Name;
			}
			else
				ToolID = "Local";
			
		}

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewName = LookupViewComboBox.GetItemText(ViewIndex);
		var ViewID = -1;
		if (ViewIndex == -1 || ViewName == "")
			LookupErrors[LookupErrors.length] = "View";
		else
			ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var LookupColumn = LookupColumnComboBox.GetSelectionText();
		if (LookupColumn == "")
			LookupErrors[LookupErrors.length] = "Lookup Column";

		var KeyColumn = "", KeyValue = "", KeyValueIsFieldName = false;
		if (LookupTypeKeyRadioButton.CheckState == GrooveCheckState_Checked)
		{
			KeyColumn = LookupKeyColumnComboBox.GetSelectionText();
			KeyValue = LookupKeyValueComboBox.Text;
			if (KeyColumn == "")
				LookupErrors[LookupErrors.length] = "Key Column";
			if (KeyValue == "")
				LookupErrors[LookupErrors.length] = "Key Value";

			if (g_CallbackCode.GetKeyValueIsFieldName(KeyValue))
				KeyValueIsFieldName = true;
		}

		var ReturnUnique = false;
		if (LookupReturnUniqueRadioButton.CheckState == GrooveCheckState_Checked)
			ReturnUnique = true;
		
		var NoCache = false;
		if (LookupNoCacheCheckBox.CheckState == GrooveCheckState_Checked)
			NoCache = true;

		if (LookupErrors.length > 0)
		{
			g_UIDelegate.DisplayOKMessageBox("Please fill in all available values for the lookup property. These values were left blank: " + LookupErrors.join(", ") + ".", "Invalid Lookup Property Values");
			return;
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		
		var LookupString = "TelespaceName=" + CreateValidXMLName(TelespaceName);
		LookupString	+= "&TelespaceURL=" + CreateValidXMLName(TelespaceURL);
		LookupString	+= "&ToolDisplayName=" + CreateValidXMLName(ToolName);
		LookupString    += "&ToolName=" + CreateValidXMLName(ToolID);
		LookupString    += "&ViewName=" + CreateValidXMLName(ViewName);
		LookupString    += "&ViewID=" + CreateValidXMLName(ViewID);
		LookupString    += "&KeyColumn=" + CreateValidXMLName(KeyColumn);
		LookupString    += "&KeyValue=" + CreateValidXMLName(KeyValue);
		LookupString    += "&LookupColumn=" + CreateValidXMLName(LookupColumn);
		LookupString    += "&ReturnUnique=" + ReturnUnique;
		LookupString    += "&NoCache=" + NoCache;
		LookupString	+= "&KeyValueIsFieldName=" + KeyValueIsFieldName;
		LookupString	+= "&Comment=" + CreateValidXMLName(LookupComment.Text);
		
		return LookupString;

	}

	function ResetTelespaceList(i_TelespaceURL)
	{
		// Setup the telespace list combobox here
		LookupTelespaceComboBox.ResetContent();
		
		var ThisTelespace = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
		var ThisTelespaceURL = ThisTelespace.CanonicalURL;
		var ReturnDescriptor = null;
		var TelespaceProvider = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE_PROVIDER);
		var TelespaceDescriptorEnum = TelespaceProvider.IGrooveTelespaceProvider.OpenTelespaceDescriptorEnum();
		var MatchingIndex = -1;
		while (TelespaceDescriptorEnum.HasMore())
		{
			var TelespaceDescriptor = TelespaceDescriptorEnum.OpenNext();
			var DisplayName = TelespaceDescriptor.DisplayName;
			var Index;
			if (TelespaceDescriptor.CanonicalURL == ThisTelespaceURL)
			{
				DisplayName = g_THIS_SPACE;
				Index = LookupTelespaceComboBox.InsertItem(0, DisplayName);
				if (i_TelespaceURL == "Local")
				{
					ReturnDescriptor = TelespaceDescriptor;
					LookupTelespaceComboBox.SetSelectionByIndex(Index);
				}
			}
			else
				Index = LookupTelespaceComboBox.AddItem(DisplayName);
			LookupTelespaceComboBox.SetItemData(Index, TelespaceDescriptor);
			if (i_TelespaceURL == TelespaceDescriptor.CanonicalURL)
			{
				LookupTelespaceComboBox.SetSelectionByIndex(Index);
				ReturnDescriptor = LookupTelespaceComboBox.GetItemData(Index);
			}
				
		}
		
		if (i_TelespaceURL != null && i_TelespaceURL != "")
		{
			if ("Local" != i_TelespaceURL)
			{
				LookupTelespaceCheckBox.CheckState = GrooveCheckState_Checked;
				LookupTelespaceComboBox.Enabled = true;
			}
			else
			{
				LookupTelespaceCheckBox.CheckState = GrooveCheckState_Unchecked;	
				LookupTelespaceComboBox.Enabled = false;
			}
		}
		else
		{
			LookupTelespaceComboBox.SetSelectionByText(g_THIS_SPACE);
			LookupTelespaceComboBox.Enabled = false;
			LookupTelespaceCheckBox.CheckState = GrooveCheckState_Unchecked;
			ReturnDescriptor = LookupTelespaceComboBox.GetItemData(LookupTelespaceComboBox.GetSelectionIndex());
		}
		
		TelespaceDescriptorEnum = null;
		delete TelespaceDescriptorEnum;
		CollectGarbage();
		
		return ReturnDescriptor;
	}

	function ResetLookupProperty()
	{
		// Check the "All" lookup type by default.
		LookupTypeAllRadioButton.CheckState = GrooveCheckState_Checked;
		LookupTypeKeyRadioButton.CheckState = GrooveCheckState_Unchecked;
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 54, true);
		// Check the "Unique" return type by default.
		LookupReturnAllRadioButton.CheckState = GrooveCheckState_Unchecked;
		LookupReturnUniqueRadioButton.CheckState = GrooveCheckState_Checked;
		ResetTelespaceList(null);
		// Clear out all combo box values.
		LookupToolComboBox.ResetContent();
		LookupViewComboBox.ResetContent();
		LookupKeyColumnComboBox.ResetContent();
		LookupKeyValueComboBox.Text = "";
		LookupColumnComboBox.ResetContent();
		// Disable all combo boxes until they should be available.
		LookupViewComboBox.Enabled = false;
		LookupKeyColumnComboBox.Enabled = false;
		LookupColumnComboBox.Enabled = false;
		LookupNoCacheCheckBox.CheckState = GrooveCheckState_Unchecked;
		LookupComment.Text = "";
	}
	
	function GenerateLookupTargetDisplayName(i_LookupString)
	{
		var TelespaceDisplayName = GetValueFromXMLQueryString("TelespaceName", i_LookupString);
		var ToolDisplayName = GetValueFromXMLQueryString("ToolDisplayName", i_LookupString);
		var ViewName = GetValueFromXMLQueryString("ViewName", i_LookupString);
		var KeyColumn = GetValueFromXMLQueryString("KeyColumn", i_LookupString);
		var LookupColumn = GetValueFromXMLQueryString("LookupColumn", i_LookupString);
		var ReturnUnique = GetValueFromXMLQueryString("ReturnUnique", i_LookupString);
		var NoCache = GetValueFromXMLQueryString("NoCache", i_LookupString);
		
		var DisplayName = "Workspace: " + TelespaceDisplayName + "\nTool: " + ToolDisplayName + "\nView: " + ViewName;
		if (KeyColumn != "")
			DisplayName += "\nKey Column: " + KeyColumn;
			
		DisplayName += "\nLookup Column: " + LookupColumn;
		
		DisplayName += "\nOptions: NoCache:" + NoCache + "/Return Unique:" + ReturnUnique;
		
		return DisplayName;							
	}
	
	function GetValueFromXMLQueryString(i_Key, i_Querystring, i_Default, i_Sep)
	{
		var strReturn = "";
		if (typeof i_Default != "undefined")
			strReturn = i_Default;

		var Separator = "=[^&]*";
		if (typeof i_Sep != "undefined")
			Separator = i_Sep;
		var objRegExp = new RegExp(i_Key + Separator, "");
		if (objRegExp.test(i_Querystring))
		{
			var strPair = objRegExp.exec(i_Querystring);
			var arrPair = strPair[0].split("=");
			if (arrPair.length == 2 && arrPair[0] == i_Key)
				strReturn = ConvertToOriginalName(arrPair[1]);
		}

		return strReturn;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           @           Y  Ë        S     L  L                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ä(null),0               Ä(nul                 Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t      ÄName4   G r o o v e F o r m s L o o k u p G l u e 3 . g s l   i       ÄSCRIPT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         $ ©          )      ÄSCRIPT         FK Ä
	// Constants
	var g_THIS_SPACE = "- This Workspace -";
	var g_THIS_TOOL  = "- This Tool -";

	// ============================================
	// === Begin Lookup Property Event Handlers ===

	// Lookup Type Radio Buttons
	function LookupTypeAllRadioButton_OnCommand(i_UICommand)
	{
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 69, true);
		LookupTypeAllRadioButton.CheckState = GCS_CHECKED;
		LookupTypeKeyRadioButton.CheckState = GCS_UNCHECKED;
		ResetColumnComboBoxState();
	}

	function LookupTypeKeyRadioButton_OnCommand(i_UICommand)
	{
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 69, false);
		LookupTypeAllRadioButton.CheckState = GCS_UNCHECKED;
		LookupTypeKeyRadioButton.CheckState = GCS_CHECKED;
		ResetColumnComboBoxState();
	}

	function LookupTelespaceCheckBox_OnCommand(i_UICommand)
	{
		if (LookupTelespaceCheckBox.CheckState == GCS_CHECKED)
			LookupTelespaceComboBox.Enabled = true;
		else
			LookupTelespaceComboBox.Enabled = false;
	}

	function LookupTelespaceComboBox_OnSelectionChange(i_Name, i_Item)
	{
		LookupToolComboBox.ResetContent();
		LookupViewComboBox.ResetContent();
		LookupViewComboBox.Enabled = false;
		LookupColumnComboBox.ResetContent();
		LookupColumnComboBox.Enabled = false;
		LookupKeyColumnComboBox.ResetContent();
		LookupKeyColumnComboBox.Enabled = false;
		LookupKeyValueComboBox.ResetContent();
		LookupKeyValueComboBox.Enabled = false;
		LookupKeyValueIsFieldNameCheckBox.CheckState = GCS_UNCHECKED;
	}

	// Tool ComboBox
	function LookupToolComboBox_OnDropDown(i_Name)
	{
		LookupToolComboBox.ResetContent();
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var ToolsEnum = g_CallbackCode.GetToolsList(TelespaceDescriptor);
		var ThisToolName = PropertyList.OpenProperty(PROPERTY_TOOL_DISPLAY_NAME);
		var ThisTool = PropertyList.OpenProperty(PROPERTY_TOOL);
		var ThisToolCanonicalURL = ThisTool.CanonicalURL;
		while (ToolsEnum != null && ToolsEnum.HasMore())
		{
			var ToolPair = ToolsEnum.OpenNextPair();
			var ToolName = ToolPair.First;
			var ToolDescriptor = ToolPair.Second;
			var ToolIndex;
			if (ToolName == ThisToolName && ThisToolCanonicalURL == ToolDescriptor.CanonicalURL)
			{
				ToolName = g_THIS_TOOL;
				ToolIndex = LookupToolComboBox.InsertItem(0, ToolName);
			}
			else
				ToolIndex = LookupToolComboBox.AddItem(ToolName);
			LookupToolComboBox.SetItemData(ToolIndex, ToolDescriptor);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		ToolsEnum = null;
		delete ToolsEnum;
		CollectGarbage();
	}

	function LookupToolComboBox_OnComboBoxCloseUp(i_Name)
	{
		LookupViewComboBox.ResetContent();
		EnableDependentComboBox(LookupToolComboBox, LookupViewComboBox);
		ResetColumnComboBoxState();
	}

	// View ComboBox
	function LookupViewComboBox_OnDropDown(i_Name)
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();
		
		LookupViewComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewEnum = g_CallbackCode.GetViewList(TelespaceDescriptor, ToolDescriptor);
		while (ViewEnum != null && ViewEnum.HasMore())
		{
			var ViewPair = ViewEnum.OpenNextPair();
			var ViewName = ViewPair.First;
			var ViewID = ViewPair.Second;
			var ViewIndex = LookupViewComboBox.AddItem(ViewName);
			LookupViewComboBox.SetItemData(ViewIndex, ViewID);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		WindowMgr.ShowWaitCursor(false);								
	}

	function LookupViewComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Column ComboBox
	function LookupKeyColumnComboBox_OnDropDown(i_Name)
	{
		LookupKeyColumnComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var KeyColumnEnum = g_CallbackCode.GetPossibleKeyList(TelespaceDescriptor, ToolDescriptor, Number(ViewID));
		while (KeyColumnEnum != null && KeyColumnEnum.HasMore())
		{
			var KeyColumnName = KeyColumnEnum.OpenNext();
			var KeyColumnIndex = LookupKeyColumnComboBox.AddItem(KeyColumnName);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
	}

	function LookupKeyColumnComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Return Column ComboBox
	function LookupColumnComboBox_OnDropDown(i_Name)
	{
		LookupColumnComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var KeyColumnName = LookupKeyColumnComboBox.GetSelectionText();

		var ColumnEnum = g_CallbackCode.GetLookupColumnList(TelespaceDescriptor, ToolDescriptor, Number(ViewID), KeyColumnName);
		while (ColumnEnum != null && ColumnEnum.HasMore())
		{
			var ColumnName = ColumnEnum.OpenNext();
			var ColumnIndex = LookupColumnComboBox.AddItem(ColumnName);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
	}

	// Lookup Key/Field ComboBox
	function LookupKeyValueComboBox_OnDropDown(i_Name)
	{
		LookupKeyValueComboBox.ResetContent();

		var FieldNameEnum = g_CallbackCode.GetKeyValueFieldNameEnum();
		while (FieldNameEnum != null && FieldNameEnum.HasMore())
		{
			var FieldName = FieldNameEnum.OpenNext();
			// Don't add system fields to the combo box.
			if (FieldName != "_CreatedBy" && FieldName != "_Created" && FieldName != "_Modified" && FieldName != "_ModifiedBy")
				LookupKeyValueComboBox.AddItem(FieldName);
		}
	}

	function LookupKeyValueComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Return Radio Buttons
	function LookupReturnAllRadioButton_OnCommand(i_UICommand)
	{
		LookupReturnAllRadioButton.CheckState = GCS_CHECKED;
		LookupReturnUniqueRadioButton.CheckState = GCS_UNCHECKED;
	}

	function LookupReturnUniqueRadioButton_OnCommand(i_UICommand)
	{
		LookupReturnAllRadioButton.CheckState = GCS_UNCHECKED;
		LookupReturnUniqueRadioButton.CheckState = GCS_CHECKED;
	}

	function ResetColumnComboBoxState()
	{
		if (LookupTypeAllRadioButton.CheckState == GCS_CHECKED)
		{
			EnableDependentComboBox(LookupViewComboBox, LookupColumnComboBox);
		}
		else
		{
			EnableDependentComboBox(LookupViewComboBox, LookupKeyColumnComboBox);
			EnableDependentComboBox(LookupViewComboBox, LookupKeyValueComboBox);
			EnableDependentComboBox(LookupKeyColumnComboBox, LookupColumnComboBox);
		}
	}

	function EnableDependentComboBox(i_ComboBox, i_DependentComboBox)
	{
		if (i_ComboBox.GetSelectionIndex() >= 0 && i_ComboBox.GetSelectionText() != "")
		{
			i_DependentComboBox.Enabled = true;
		}
		else
		{
			i_DependentComboBox.ResetContent();
			i_DependentComboBox.Enabled = false;
		}
	}

	// === End Lookup Property Event Handlers ===
	// ==========================================

	function GetLookupString()
	{
		var LookupErrors = new Array();

		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceName = LookupTelespaceComboBox.GetItemText(TelespaceIndex);
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var TelespaceURL = TelespaceDescriptor.CanonicalURL;
		if (TelespaceName == g_THIS_SPACE)
			TelespaceURL = "Local";
		
		
		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolName = LookupToolComboBox.GetItemText(ToolIndex);
		var ToolDescriptor = null;
		var ToolID = "";
		if (ToolIndex == -1 || ToolName == "")
			LookupErrors[LookupErrors.length] = "Tool";
		else
		{
			if (ToolName != g_THIS_TOOL)
			{
				ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);
				ToolID = ToolDescriptor.Name;
			}
			else
				ToolID = "Local";
			
		}

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewName = LookupViewComboBox.GetItemText(ViewIndex);
		var ViewID = -1;
		if (ViewIndex == -1 || ViewName == "")
			LookupErrors[LookupErrors.length] = "View";
		else
			ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var LookupColumn = LookupColumnComboBox.GetSelectionText();
		if (LookupColumn == "")
			LookupErrors[LookupErrors.length] = "Lookup Column";

		var KeyColumn = "", KeyValue = "", KeyValueIsFieldName = false;
		if (LookupTypeKeyRadioButton.CheckState == GCS_CHECKED)
		{
			KeyColumn = LookupKeyColumnComboBox.GetSelectionText();
			KeyValue = LookupKeyValueComboBox.Text;
			if (KeyColumn == "")
				LookupErrors[LookupErrors.length] = "Key Column";
			if (KeyValue == "")
				LookupErrors[LookupErrors.length] = "Key Value";

			if (LookupKeyValueIsFieldNameCheckBox.CheckState == GCS_CHECKED)
				KeyValueIsFieldName = true;
		}

		var ReturnUnique = false;
		if (LookupReturnUniqueRadioButton.CheckState == GCS_CHECKED)
			ReturnUnique = true;
		
		var NoCache = false;
		if (LookupNoCacheCheckBox.CheckState == GCS_CHECKED)
			NoCache = true;

		if (LookupErrors.length > 0)
		{
			g_UIDelegate.DisplayOKMessageBox("Please fill in all available values for the lookup property. These values were left blank: " + LookupErrors.join(", ") + ".", "Invalid Lookup Property Values");
			return;
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		
		var LookupString = "TelespaceName=" + escape(TelespaceName);
		LookupString	+= "&TelespaceURL=" + escape(TelespaceURL);
		LookupString	+= "&ToolDisplayName=" + escape(ToolName);
		LookupString    += "&ToolName=" + escape(ToolID);
		LookupString    += "&ViewName=" + escape(ViewName);
		LookupString    += "&ViewID=" + escape(ViewID);
		LookupString    += "&KeyColumn=" + escape(KeyColumn);
		LookupString    += "&KeyValue=" + escape(KeyValue);
		LookupString    += "&LookupColumn=" + escape(LookupColumn);
		LookupString    += "&ReturnUnique=" + ReturnUnique;
		LookupString    += "&NoCache=" + NoCache;
		LookupString	+= "&KeyValueIsFieldName=" + KeyValueIsFieldName;
		LookupString	+= "&Comment=" + escape(LookupComment.Text);
		
		return LookupString;

	}
	
	function GetXMLSyntaxBasedLookupString()
	{
		var LookupErrors = new Array();

		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceName = LookupTelespaceComboBox.GetItemText(TelespaceIndex);
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var TelespaceURL = TelespaceDescriptor.CanonicalURL;
		if (TelespaceName == g_THIS_SPACE)
			TelespaceURL = "Local";
		
		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolName = LookupToolComboBox.GetItemText(ToolIndex);
		var ToolDescriptor = null;
		var ToolID = "";
		if (ToolIndex == -1 || ToolName == "")
			LookupErrors[LookupErrors.length] = "Tool";
		else
		{
			if (ToolName != g_THIS_TOOL)
			{
				ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);
				ToolID = ToolDescriptor.Name;
			}
			else
				ToolID = "Local";
			
		}

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewName = LookupViewComboBox.GetItemText(ViewIndex);
		var ViewID = -1;
		if (ViewIndex == -1 || ViewName == "")
			LookupErrors[LookupErrors.length] = "View";
		else
			ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var LookupColumn = LookupColumnComboBox.GetSelectionText();
		if (LookupColumn == "")
			LookupErrors[LookupErrors.length] = "Lookup Column";

		var KeyColumn = "", KeyValue = "", KeyValueIsFieldName = false;
		if (LookupTypeKeyRadioButton.CheckState == GCS_CHECKED)
		{
			KeyColumn = LookupKeyColumnComboBox.GetSelectionText();
			KeyValue = LookupKeyValueComboBox.Text;
			if (KeyColumn == "")
				LookupErrors[LookupErrors.length] = "Key Column";
			if (KeyValue == "")
				LookupErrors[LookupErrors.length] = "Key Value";

			if (LookupKeyValueIsFieldNameCheckBox.CheckState == GCS_CHECKED)
				KeyValueIsFieldName = true;
		}

		var ReturnUnique = false;
		if (LookupReturnUniqueRadioButton.CheckState == GCS_CHECKED)
			ReturnUnique = true;
		
		var NoCache = false;
		if (LookupNoCacheCheckBox.CheckState == GCS_CHECKED)
			NoCache = true;

		if (LookupErrors.length > 0)
		{
			g_UIDelegate.DisplayOKMessageBox("Please fill in all available values for the lookup property. These values were left blank: " + LookupErrors.join(", ") + ".", "Invalid Lookup Property Values");
			return;
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		
		var LookupString = "TelespaceName=" + CreateValidXMLName(TelespaceName);
		LookupString	+= "&TelespaceURL=" + CreateValidXMLName(TelespaceURL);
		LookupString	+= "&ToolDisplayName=" + CreateValidXMLName(ToolName);
		LookupString    += "&ToolName=" + CreateValidXMLName(ToolID);
		LookupString    += "&ViewName=" + CreateValidXMLName(ViewName);
		LookupString    += "&ViewID=" + CreateValidXMLName(ViewID);
		LookupString    += "&KeyColumn=" + CreateValidXMLName(KeyColumn);
		LookupString    += "&KeyValue=" + CreateValidXMLName(KeyValue);
		LookupString    += "&LookupColumn=" + CreateValidXMLName(LookupColumn);
		LookupString    += "&ReturnUnique=" + ReturnUnique;
		LookupString    += "&NoCache=" + NoCache;
		LookupString	+= "&KeyValueIsFieldName=" + KeyValueIsFieldName;
		LookupString	+= "&Comment=" + CreateValidXMLName(LookupComment.Text);
		
		return LookupString;

	}

	function ResetTelespaceList(i_TelespaceURL)
	{
		// Setup the telespace list combobox here
		LookupTelespaceComboBox.ResetContent();
		
		var ThisTelespace = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
		var ThisTelespaceURL = ThisTelespace.CanonicalURL;
		var ReturnDescriptor = null;
		var TelespaceProvider = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE_PROVIDER);
		var TelespaceDescriptorEnum = TelespaceProvider.IGrooveTelespaceProvider.OpenTelespaceDescriptorEnum();
		var MatchingIndex = -1;
		while (TelespaceDescriptorEnum.HasMore())
		{
			var TelespaceDescriptor = TelespaceDescriptorEnum.OpenNext();
			var DisplayName = TelespaceDescriptor.DisplayName;
			var Index;
			if (TelespaceDescriptor.CanonicalURL == ThisTelespaceURL)
			{
				DisplayName = g_THIS_SPACE;
				Index = LookupTelespaceComboBox.InsertItem(0, DisplayName);
				if (i_TelespaceURL == "Local")
				{
					ReturnDescriptor = TelespaceDescriptor;
					LookupTelespaceComboBox.SetSelectionByIndex(Index);
				}
			}
			else
				Index = LookupTelespaceComboBox.AddItem(DisplayName);
			LookupTelespaceComboBox.SetItemData(Index, TelespaceDescriptor);
			if (i_TelespaceURL == TelespaceDescriptor.CanonicalURL)
			{
				LookupTelespaceComboBox.SetSelectionByIndex(Index);
				ReturnDescriptor = LookupTelespaceComboBox.GetItemData(Index);
			}
				
		}
		
		if (i_TelespaceURL != null && i_TelespaceURL != "")
		{
			if ("Local" != i_TelespaceURL)
			{
				LookupTelespaceCheckBox.CheckState = GCS_CHECKED;
				LookupTelespaceComboBox.Enabled = true;
			}
			else
			{
				LookupTelespaceCheckBox.CheckState = GCS_UNCHECKED;	
				LookupTelespaceComboBox.Enabled = false;
			}
		}
		else
		{
			LookupTelespaceComboBox.SetSelectionByText(g_THIS_SPACE);
			LookupTelespaceComboBox.Enabled = false;
			LookupTelespaceCheckBox.CheckState = GCS_UNCHECKED;
			ReturnDescriptor = LookupTelespaceComboBox.GetItemData(LookupTelespaceComboBox.GetSelectionIndex());
		}
		
		TelespaceDescriptorEnum = null;
		delete TelespaceDescriptorEnum;
		CollectGarbage();
		
		return ReturnDescriptor;
	}

	function ResetLookupProperty()
	{
		// Check the "All" lookup type by default.
		LookupTypeAllRadioButton.CheckState = GCS_CHECKED;
		LookupTypeKeyRadioButton.CheckState = GCS_UNCHECKED;
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 69, true);
		// Check the "Unique" return type by default.
		LookupReturnAllRadioButton.CheckState = GCS_UNCHECKED;
		LookupReturnUniqueRadioButton.CheckState = GCS_CHECKED;
		ResetTelespaceList(null);
		// Clear out all combo box values.
		LookupToolComboBox.ResetContent();
		LookupViewComboBox.ResetContent();
		LookupKeyColumnComboBox.ResetContent();
		LookupKeyValueComboBox.Text = "";
		LookupKeyValueIsFieldNameCheckBox.CheckState = GCS_UNCHECKED;
		LookupColumnComboBox.ResetContent();
		// Disable all combo boxes until they should be available.
		LookupViewComboBox.Enabled = false;
		LookupKeyColumnComboBox.Enabled = false;
		LookupColumnComboBox.Enabled = false;
		LookupNoCacheCheckBox.CheckState = GCS_UNCHECKED;
		LookupComment.Text = "";
	}
	
	function GenerateLookupTargetDisplayName(i_LookupString)
	{
		var TelespaceDisplayName = GetValueFromXMLQueryString("TelespaceName", i_LookupString);
		var ToolDisplayName = GetValueFromXMLQueryString("ToolDisplayName", i_LookupString);
		var ViewName = GetValueFromXMLQueryString("ViewName", i_LookupString);
		var KeyColumn = GetValueFromXMLQueryString("KeyColumn", i_LookupString);
		var LookupColumn = GetValueFromXMLQueryString("LookupColumn", i_LookupString);
		var ReturnUnique = GetValueFromXMLQueryString("ReturnUnique", i_LookupString);
		var NoCache = GetValueFromXMLQueryString("NoCache", i_LookupString);
		
		var DisplayName = "Workspace: " + TelespaceDisplayName + "\nTool: " + ToolDisplayName + "\nView: " + ViewName;
		if (KeyColumn != "")
			DisplayName += "\nKey Column: " + KeyColumn;
			
		DisplayName += "\nLookup Column: " + LookupColumn;
		
		DisplayName += "\nOptions: NoCache:" + NoCache + "/Return Unique:" + ReturnUnique;
		
		return DisplayName;							
	}
	
	function GetValueFromXMLQueryString(i_Key, i_Querystring, i_Default, i_Sep)
	{
		var strReturn = "";
		if (typeof i_Default != "undefined")
			strReturn = i_Default;

		var Separator = "=[^&]*";
		if (typeof i_Sep != "undefined")
			Separator = i_Sep;
		var objRegExp = new RegExp(i_Key + Separator, "");
		if (objRegExp.test(i_Querystring))
		{
			var strPair = objRegExp.exec(i_Querystring);
			var arrPair = strPair[0].split("=");
			if (arrPair.length == 2 && arrPair[0] == i_Key)
				strReturn = ConvertToOriginalName(arrPair[1]);
		}

		return strReturn;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 @           `  Ë        Z     aK  aK                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ä(null),0               Ä(nul                 Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   K   ÄName4   G r o o v e F o r m s L o o k u p G l u e 4 . g s l   w       ÄSCRIPT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         $ ©          )      ÄSCRIPT         mQ Ä

	// ============================================
	// === Begin Lookup Property Event Handlers ===

	// Lookup Type Radio Buttons
	function LookupTypeAllRadioButton_OnCommand(i_UICommand)
	{
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 102, true);
		LookupTypeAllRadioButton.CheckState = GCS_CHECKED;
		LookupTypeKeyRadioButton.CheckState = GCS_UNCHECKED;
		ResetColumnComboBoxState();
	}

	function LookupTypeKeyRadioButton_OnCommand(i_UICommand)
	{
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 102, false);
		LookupTypeAllRadioButton.CheckState = GCS_UNCHECKED;
		LookupTypeKeyRadioButton.CheckState = GCS_CHECKED;
		ResetColumnComboBoxState();
	}

	function LookupTelespaceCheckBox_OnCommand(i_UICommand)
	{
		if (LookupTelespaceCheckBox.CheckState == GCS_CHECKED)
			LookupTelespaceComboBox.Enabled = true;
		else
			LookupTelespaceComboBox.Enabled = false;
	}

	function LookupTelespaceComboBox_OnSelectionChange(i_Name, i_Item)
	{
		LookupToolComboBox.ResetContent();
		LookupViewComboBox.ResetContent();
		LookupViewComboBox.Enabled = false;
		LookupColumnComboBox.ResetContent();
		LookupColumnComboBox.Enabled = false;
		LookupKeyColumnComboBox.ResetContent();
		LookupKeyColumnComboBox.Enabled = false;
		LookupKeyValueComboBox.ResetContent();
		LookupKeyValueComboBox.Enabled = false;
		LookupKeyValueIsFieldNameCheckBox.CheckState = GCS_UNCHECKED;
	}

	// Tool ComboBox
	function LookupToolComboBox_OnDropDown(i_Name)
	{
		LookupToolComboBox.ResetContent();
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var ToolsEnum = g_CallbackCode.GetToolsList(TelespaceDescriptor);
		var ThisToolName = PropertyList.OpenProperty(PROPERTY_TOOL_DISPLAY_NAME);
		var ThisTool = PropertyList.OpenProperty(PROPERTY_TOOL);
		var ThisToolCanonicalURL = ThisTool.CanonicalURL;
		while (ToolsEnum != null && ToolsEnum.HasMore())
		{
			var ToolPair = ToolsEnum.OpenNextPair();
			var ToolName = ToolPair.First;
			var ToolDescriptor = ToolPair.Second;
			var ToolIndex;
			if (ToolName == ThisToolName && ThisToolCanonicalURL == ToolDescriptor.CanonicalURL)
			{
				ToolName = g_THIS_TOOL;
				ToolIndex = LookupToolComboBox.InsertItem(0, ToolName);
			}
			else
				ToolIndex = LookupToolComboBox.AddItem(ToolName);
			LookupToolComboBox.SetItemData(ToolIndex, ToolDescriptor);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		ToolsEnum = null;
		delete ToolsEnum;
		CollectGarbage();
	}

	function LookupToolComboBox_OnComboBoxCloseUp(i_Name)
	{
		LookupViewComboBox.ResetContent();
		EnableDependentComboBox(LookupToolComboBox, LookupViewComboBox);
		ResetColumnComboBoxState();
	}

	// View ComboBox
	function LookupViewComboBox_OnDropDown(i_Name)
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();
		
		LookupViewComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewEnum = g_CallbackCode.GetViewList(TelespaceDescriptor, ToolDescriptor);
		while (ViewEnum != null && ViewEnum.HasMore())
		{
			var ViewPair = ViewEnum.OpenNextPair();
			var ViewName = ViewPair.First;
			var ViewID = ViewPair.Second;
			var ViewIndex = LookupViewComboBox.AddItem(ViewName);
			LookupViewComboBox.SetItemData(ViewIndex, ViewID);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		WindowMgr.ShowWaitCursor(false);								
	}

	function LookupViewComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Column ComboBox
	function LookupKeyColumnComboBox_OnDropDown(i_Name)
	{
		LookupKeyColumnComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var KeyColumnEnum = g_CallbackCode.GetPossibleKeyList(TelespaceDescriptor, ToolDescriptor, Number(ViewID));
		while (KeyColumnEnum != null && KeyColumnEnum.HasMore())
		{
			var KeyColumnName = KeyColumnEnum.OpenNext();
			var KeyColumnIndex = LookupKeyColumnComboBox.AddItem(KeyColumnName);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
	}

	function LookupKeyColumnComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Return Column ComboBox
	function LookupColumnComboBox_OnDropDown(i_Name)
	{
		g_CallbackCode.EndIMEComposition();
        LookupColumnComboBox.ResetContent();
		
		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);

		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var KeyColumnName = LookupKeyColumnComboBox.GetSelectionText();

		var ColumnEnum = g_CallbackCode.GetLookupColumnList(TelespaceDescriptor, ToolDescriptor, Number(ViewID), KeyColumnName);
		while (ColumnEnum != null && ColumnEnum.HasMore())
		{
			var ColumnName = ColumnEnum.OpenNext();
			var ColumnIndex = LookupColumnComboBox.AddItem(ColumnName);
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
	}

	// Lookup Key/Field ComboBox
	function LookupKeyValueComboBox_OnDropDown(i_Name)
	{
		LookupKeyValueComboBox.ResetContent();

		var FieldNameEnum = g_CallbackCode.GetKeyValueFieldNameEnum();
		while (FieldNameEnum != null && FieldNameEnum.HasMore())
		{
			var FieldName = FieldNameEnum.OpenNext();
			// Don't add system fields to the combo box.
			if (FieldName != "_CreatedBy" && FieldName != "_Created" && FieldName != "_Modified" && FieldName != "_ModifiedBy")
				LookupKeyValueComboBox.AddItem(FieldName);
		}
	}

	function LookupKeyValueComboBox_OnComboBoxCloseUp(i_Name)
	{
		ResetColumnComboBoxState();
	}

	// Return Radio Buttons
	function LookupReturnAllRadioButton_OnCommand(i_UICommand)
	{
		LookupReturnAllRadioButton.CheckState = GCS_CHECKED;
		LookupReturnUniqueRadioButton.CheckState = GCS_UNCHECKED;
	}

	function LookupReturnUniqueRadioButton_OnCommand(i_UICommand)
	{
		LookupReturnAllRadioButton.CheckState = GCS_UNCHECKED;
		LookupReturnUniqueRadioButton.CheckState = GCS_CHECKED;
	}

	function ResetColumnComboBoxState()
	{
		if (LookupTypeAllRadioButton.CheckState == GCS_CHECKED)
		{
			EnableDependentComboBox(LookupViewComboBox, LookupColumnComboBox);
		}
		else
		{
			EnableDependentComboBox(LookupViewComboBox, LookupKeyColumnComboBox);
			EnableDependentComboBox(LookupViewComboBox, LookupKeyValueComboBox);
			EnableDependentComboBox(LookupKeyColumnComboBox, LookupColumnComboBox);
		}
	}

	function EnableDependentComboBox(i_ComboBox, i_DependentComboBox)
	{
		if (i_ComboBox.GetSelectionIndex() >= 0 && i_ComboBox.GetSelectionText() != "")
		{
			i_DependentComboBox.Enabled = true;
		}
		else
		{
			i_DependentComboBox.ResetContent();
			i_DependentComboBox.Enabled = false;
		}
	}

	// === End Lookup Property Event Handlers ===
	// ==========================================

	function GetLookupString()
	{
		var Priv = g_UIDelegate.IGrooveFormsToolUIDelegatePrivate;
		var LookupErrors = new Array();

		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceName = LookupTelespaceComboBox.GetItemText(TelespaceIndex);
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var TelespaceURL = TelespaceDescriptor.CanonicalURL;
		if (TelespaceName == g_THIS_SPACE)
			TelespaceURL = "Local";
		
		
		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolName = LookupToolComboBox.GetItemText(ToolIndex);
		var ToolDescriptor = null;
		var ToolID = "";
		if (ToolIndex == -1 || ToolName == "")
			LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_TOOL);
		else
		{
			if (ToolName != g_THIS_TOOL)
			{
				ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);
				ToolID = ToolDescriptor.Name;
			}
			else
				ToolID = "Local";
			
		}

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewName = LookupViewComboBox.GetItemText(ViewIndex);
		var ViewID = -1;
		if (ViewIndex == -1 || ViewName == "")
			LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_VIEW);
		else
			ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var LookupColumn = LookupColumnComboBox.GetSelectionText();
		if (LookupColumn == "")
			LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_COLUMN);

		var KeyColumn = "", KeyValue = "", KeyValueIsFieldName = false;
		if (LookupTypeKeyRadioButton.CheckState == GCS_CHECKED)
		{
			KeyColumn = LookupKeyColumnComboBox.GetSelectionText();
			KeyValue = LookupKeyValueComboBox.Text;
			if (KeyColumn == "")
				LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_KEY_COLUMN);
			if (KeyValue == "")
				LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_KEY_VALUE);

			if (LookupKeyValueIsFieldNameCheckBox.CheckState == GCS_CHECKED)
				KeyValueIsFieldName = true;
		}

		var ReturnUnique = false;
		if (LookupReturnUniqueRadioButton.CheckState == GCS_CHECKED)
			ReturnUnique = true;
		
		var NoCache = false;
		if (LookupNoCacheCheckBox.CheckState == GCS_CHECKED)
			NoCache = true;

		if (LookupErrors.length > 0)
		{
			var BSTREnum = CreateBSTREnum();
			BSTREnum.Add(LookupErrors.join(", "));
			g_UIDelegate.DisplayOKMessageBox(Priv.MessageFormat(IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_ERROR, BSTREnum.IGrooveBSTREnum), Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_ERROR_TITLE));
			return;
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		
		var LookupString = "TelespaceName=" + escape(TelespaceName);
		LookupString	+= "&TelespaceURL=" + escape(TelespaceURL);
		LookupString	+= "&ToolDisplayName=" + escape(ToolName);
		LookupString    += "&ToolName=" + escape(ToolID);
		LookupString    += "&ViewName=" + escape(ViewName);
		LookupString    += "&ViewID=" + escape(ViewID);
		LookupString    += "&KeyColumn=" + escape(KeyColumn);
		LookupString    += "&KeyValue=" + escape(KeyValue);
		LookupString    += "&LookupColumn=" + escape(LookupColumn);
		LookupString    += "&ReturnUnique=" + ReturnUnique;
		LookupString    += "&NoCache=" + NoCache;
		LookupString	+= "&KeyValueIsFieldName=" + KeyValueIsFieldName;
		LookupString	+= "&Comment=" + escape(LookupComment.Text);
		
		return LookupString;

	}
	
	function GetXMLSyntaxBasedLookupString()
	{
		var Priv = g_UIDelegate.IGrooveFormsToolUIDelegatePrivate;
		var LookupErrors = new Array();

		var TelespaceIndex = LookupTelespaceComboBox.GetSelectionIndex();
		var TelespaceName = LookupTelespaceComboBox.GetItemText(TelespaceIndex);
		var TelespaceDescriptor = LookupTelespaceComboBox.GetItemData(TelespaceIndex);
		var TelespaceURL = TelespaceDescriptor.CanonicalURL;
		if (TelespaceName == g_THIS_SPACE)
			TelespaceURL = "Local";
		
		var ToolIndex = LookupToolComboBox.GetSelectionIndex();
		var ToolName = LookupToolComboBox.GetItemText(ToolIndex);
		var ToolDescriptor = null;
		var ToolID = "";
		if (ToolIndex == -1 || ToolName == "")
			LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_TOOL);
		else
		{
			if (ToolName != g_THIS_TOOL)
			{
				ToolDescriptor = LookupToolComboBox.GetItemData(ToolIndex);
				ToolID = ToolDescriptor.Name;
			}
			else
				ToolID = "Local";
			
		}

		var ViewIndex = LookupViewComboBox.GetSelectionIndex();
		var ViewName = LookupViewComboBox.GetItemText(ViewIndex);
		var ViewID = -1;
		if (ViewIndex == -1 || ViewName == "")
			LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_VIEW);
		else
			ViewID = LookupViewComboBox.GetItemData(ViewIndex);

		var LookupColumn = LookupColumnComboBox.GetSelectionText();
		if (LookupColumn == "")
			LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_COLUMN);

		var KeyColumn = "", KeyValue = "", KeyValueIsFieldName = false;
		if (LookupTypeKeyRadioButton.CheckState == GCS_CHECKED)
		{
			KeyColumn = LookupKeyColumnComboBox.GetSelectionText();
			KeyValue = LookupKeyValueComboBox.Text;
			if (KeyColumn == "")
				LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_KEY_COLUMN);
			if (KeyValue == "")
				LookupErrors[LookupErrors.length] = Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_KEY_VALUE);

			if (LookupKeyValueIsFieldNameCheckBox.CheckState == GCS_CHECKED)
				KeyValueIsFieldName = true;
		}

		var ReturnUnique = false;
		if (LookupReturnUniqueRadioButton.CheckState == GCS_CHECKED)
			ReturnUnique = true;
		
		var NoCache = false;
		if (LookupNoCacheCheckBox.CheckState == GCS_CHECKED)
			NoCache = true;

		if (LookupErrors.length > 0)
		{
			var BSTREnum = CreateBSTREnum();
			BSTREnum.Add(LookupErrors.join(", "));
			g_UIDelegate.DisplayOKMessageBox(Priv.MessageFormat(IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_ERROR, BSTREnum.IGrooveBSTREnum), Priv.GetResourcedString(IDS_FORMS_TOOL_LOOKUP_GLUE_LOOKUP_ERROR_TITLE));
			return;
		}
		
		TelespaceDescriptor = null;
		delete TelespaceDescriptor;
		CollectGarbage();
		/*
		var LookupString = "TelespaceName=" + CreateValidXMLName(TelespaceName);
		LookupString	+= "&TelespaceURL=" + CreateValidXMLName(TelespaceURL);
		LookupString	+= "&ToolDisplayName=" + CreateValidXMLName(ToolName);
		LookupString    += "&ToolName=" + CreateValidXMLName(ToolID);
		LookupString    += "&ViewName=" + CreateValidXMLName(ViewName);
		LookupString    += "&ViewID=" + CreateValidXMLName(ViewID);
		LookupString    += "&KeyColumn=" + CreateValidXMLName(KeyColumn);
		LookupString    += "&KeyValue=" + CreateValidXMLName(KeyValue);
		LookupString    += "&LookupColumn=" + CreateValidXMLName(LookupColumn);
		LookupString    += "&ReturnUnique=" + ReturnUnique;
		LookupString    += "&NoCache=" + NoCache;
		LookupString	+= "&KeyValueIsFieldName=" + KeyValueIsFieldName;
		LookupString	+= "&Comment=" + CreateValidXMLName(LookupComment.Text);
		*/
		var LookupString = Priv.CreateLookupString(TelespaceName, TelespaceURL, ToolName, ToolID, ViewName, ViewID, KeyColumn, KeyValue, LookupColumn, ReturnUnique, NoCache, KeyValueIsFieldName, LookupComment.Text);
		return LookupString;

	}

	function ResetTelespaceList(i_TelespaceURL)
	{
		// Setup the telespace list combobox here
		LookupTelespaceComboBox.ResetContent();
		
		var ThisTelespace = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
		var ThisTelespaceURL = ThisTelespace.CanonicalURL;
		var ReturnDescriptor = null;
		var TelespaceProvider = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE_PROVIDER);
		var TelespaceDescriptorEnum = TelespaceProvider.IGrooveTelespaceProvider.OpenTelespaceDescriptorEnum();
		var MatchingIndex = -1;
		while (TelespaceDescriptorEnum.HasMore())
		{
			var TelespaceDescriptor = TelespaceDescriptorEnum.OpenNext();
			var DisplayName = TelespaceDescriptor.DisplayName;
			var Index;
			if (TelespaceDescriptor.CanonicalURL == ThisTelespaceURL)
			{
				DisplayName = g_THIS_SPACE;
				Index = LookupTelespaceComboBox.InsertItem(0, DisplayName);
				if (i_TelespaceURL == "Local")
				{
					ReturnDescriptor = TelespaceDescriptor;
					LookupTelespaceComboBox.SetSelectionByIndex(Index);
				}
			}
			else
				Index = LookupTelespaceComboBox.AddItem(DisplayName);
			LookupTelespaceComboBox.SetItemData(Index, TelespaceDescriptor);
			if (i_TelespaceURL == TelespaceDescriptor.CanonicalURL)
			{
				LookupTelespaceComboBox.SetSelectionByIndex(Index);
				ReturnDescriptor = LookupTelespaceComboBox.GetItemData(Index);
			}
				
		}
		
		if (i_TelespaceURL != null && i_TelespaceURL != "")
		{
			if ("Local" != i_TelespaceURL)
			{
				LookupTelespaceCheckBox.CheckState = GCS_CHECKED;
				LookupTelespaceComboBox.Enabled = true;
			}
			else
			{
				LookupTelespaceCheckBox.CheckState = GCS_UNCHECKED;	
				LookupTelespaceComboBox.Enabled = false;
			}
		}
		else
		{
			LookupTelespaceComboBox.SetSelectionByText(g_THIS_SPACE);
			LookupTelespaceComboBox.Enabled = false;
			LookupTelespaceCheckBox.CheckState = GCS_UNCHECKED;
			ReturnDescriptor = LookupTelespaceComboBox.GetItemData(LookupTelespaceComboBox.GetSelectionIndex());
		}
		
		TelespaceDescriptorEnum = null;
		delete TelespaceDescriptorEnum;
		CollectGarbage();
		
		return ReturnDescriptor;
	}

	function ResetLookupProperty()
	{
		// Check the "All" lookup type by default.
		LookupTypeAllRadioButton.CheckState = GCS_CHECKED;
		LookupTypeKeyRadioButton.CheckState = GCS_UNCHECKED;
		ShowHideMultiCellContents("LookupColumnKeyViewContainer", PropertyLookupLayout, 102, true);
		// Check the "Unique" return type by default.
		LookupReturnAllRadioButton.CheckState = GCS_UNCHECKED;
		LookupReturnUniqueRadioButton.CheckState = GCS_CHECKED;
		ResetTelespaceList(null);
		// Clear out all combo box values.
		LookupToolComboBox.ResetContent();
		LookupViewComboBox.ResetContent();
		LookupKeyColumnComboBox.ResetContent();
		LookupKeyValueComboBox.Text = "";
		LookupKeyValueIsFieldNameCheckBox.CheckState = GCS_UNCHECKED;
		LookupColumnComboBox.ResetContent();
		// Disable all combo boxes until they should be available.
		LookupViewComboBox.Enabled = false;
		LookupKeyColumnComboBox.Enabled = false;
		LookupColumnComboBox.Enabled = false;
		LookupNoCacheCheckBox.CheckState = GCS_UNCHECKED;
		LookupComment.Text = "";
	}
	
	function GenerateLookupTargetDisplayName(i_LookupString)
	{
		var Priv = g_UIDelegate.IGrooveFormsToolUIDelegatePrivate;
		var DNBSTREnum = CreateBSTREnum();
		var TelespaceDisplayName = GetValueFromXMLQueryString("TelespaceName", i_LookupString);
		var ToolDisplayName = GetValueFromXMLQueryString("ToolDisplayName", i_LookupString);
		var ViewName = GetValueFromXMLQueryString("ViewName", i_LookupString);
		var KeyColumn = GetValueFromXMLQueryString("KeyColumn", i_LookupString);
		var KeyValue = GetValueFromXMLQueryString("KeyValue", i_LookupString);
		var LookupColumn = GetValueFromXMLQueryString("LookupColumn", i_LookupString);
		var ReturnUnique = GetValueFromXMLQueryString("ReturnUnique", i_LookupString);
		var NoCache = GetValueFromXMLQueryString("NoCache", i_LookupString);
		var KeyValueIsFieldName = GetValueFromXMLQueryString("KeyValueIsFieldName", i_LookupString);
		DNBSTREnum.Add(TelespaceDisplayName);
		DNBSTREnum.Add(ToolDisplayName);
		DNBSTREnum.Add(ViewName);
		
		
		var DisplayKeyColumn = " ";
		
		if (KeyColumn != "")
		{
			var KCBSTREnum = CreateBSTREnum();
			KCBSTREnum.Add(KeyColumn);
			KCBSTREnum.Add(KeyValue);
			DisplayKeyColumn =  Priv.MessageFormat(IDS_FORMS_TOOL_LOOKUP_GLUE_DISPLAY_NAME_KEY_COLUMN,  KCBSTREnum.IGrooveBSTREnum);
		}
		
		DNBSTREnum.Add(DisplayKeyColumn);
		DNBSTREnum.Add(LookupColumn);
		DNBSTREnum.Add(NoCache);
		DNBSTREnum.Add(ReturnUnique);
		DNBSTREnum.Add(KeyValueIsFieldName);
		
		var DisplayName = Priv.MessageFormat(IDS_FORMS_TOOL_LOOKUP_GLUE_DISPLAY_NAME , DNBSTREnum.IGrooveBSTREnum);
		
		return DisplayName;							
	}
	
	function GetValueFromXMLQueryString(i_Key, i_Querystring, i_Default, i_Sep)
	{
		var strReturn = "";
		if (typeof i_Default != "undefined")
			strReturn = i_Default;

		var Separator = "=[^&]*";
		if (typeof i_Sep != "undefined")
			Separator = i_Sep;
		var objRegExp = new RegExp(i_Key + Separator, "");
		if (objRegExp.test(i_Querystring))
		{
			var strPair = objRegExp.exec(i_Querystring);
			var arrPair = strPair[0].split("=");
			if (arrPair.length == 2 && arrPair[0] == i_Key)
				strReturn = ConvertToOriginalName(arrPair[1]);
		}

		return strReturn;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          @           h  Ë        a     àQ  àQ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ä(null),0               Ä(nul                 Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   I   ÄName4   G r o o v e F o r m s L o o k u p G l u e 5 . g s l   s       ÄSCRIPT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         $ ©          )                      @            j  Ë                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄNameF   G r o o v e F o r m s M e t a D a t a H T M L P r o p e r t y . g s l         ÄSCRIPT     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE     ÄSC  ÄSCRIPT         3  Ä

		function FinalConstruct()
		{
			
		}		
	{  ÄSCRIPTINTERFACE       ÄLIBIDL   { 6 5 D 4 8 B 8 E - E 9 A 4 - 4 9 1 a - B B D 4 - 0 5 5 8 3 D 7 9 B 1 D 7 }       ÄIIDL   { 8 D 3 D 6 1 2 3 - 7 1 1 6 - 4 6 5 5 - 9 4 F A - A D D C 6 5 0 9 0 8 6 9 }       ÄNameN   I G r o o v e F o r m s M e t a D a t a H T M L P r o p e r t y P r i v a t e      M Ä
		function InitializeMetaDataProperty(i_PropertyName, i_MetaDataHTMLPropertyDataType, i_MetaDataHTMLPropertyPersistenceType, i_GrooveFormsMetaDataPropertyValueUnitFlags)
		{
			GrooveRunTimeData.g_pPropertyName = i_PropertyName;
			GrooveRunTimeData.g_pPropertyDataType = i_MetaDataHTMLPropertyDataType;
			GrooveRunTimeData.g_pPropertyPersistenceType = i_MetaDataHTMLPropertyPersistenceType;
			GrooveRunTimeData.g_pPropertyUnitFlags = i_GrooveFormsMetaDataPropertyValueUnitFlags;
		}

		function ShutdownMetaDataProperty()
		{
			GrooveRunTimeData.RemoveAllItems();
		}

			}  ÄSCRIPTINTERFACE       ÄDefault   1     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }       ÄIIDL   { D 6 E A D F 1 8 - 4 2 A 8 - 4 4 3 b - B C A 5 - 4 D 6 0 8 A 8 1 8 1 8 7 }       ÄName@   I G r o o v e F o r m s M e t a D a t a H T M L P r o p e r t y   r    ñ Ä
		function GetPropertyName()
		{
			return GrooveRunTimeData.g_pPropertyName;	
		}
		
		function GetPropertyDataType()
		{
			return GrooveRunTimeData.g_pPropertyDataType;
		}
		
		function GetPropertyPersistenceType()
		{
			return GrooveRunTimeData.g_pPropertyPersistenceType;
		}
	
		function GetPropertyValueUnitType()
		{
			return GrooveRunTimeData.g_pPropertyUnitFlags;
		}
	
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Ñ’   ¿ Ö   ò N      È          )                      @            l  à  m      n  »                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ê               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   a   ÄName:   G r o o v e F o r m s M e t a D a t a O b j e c t . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE  1  Ä// IGrooveFormsMetaDataHTMLPropertyPrivateFactory   ÄSCRIPTINTERFACE  tyPriv  ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n   o     F a c t  ÄSCRIPT         /  Ä	
		function FinalConstruct()
		{

		}

	truct(  ÄSCRIPTINTERFACE       ÄLIBIDL   { 6 5 D 4 8 B 8 E - E 9 A 4 - 4 9 1 a - B B D 4 - 0 5 5 8 3 D 7 9 B 1 D 7 }   CR  ÄIIDL   { 1 1 6 4 2 F 9 4 - 5 1 9 F - 4 e 2 3 - A 0 6 6 - F 8 F 9 7 4 D 5 2 0 C 4 }   em  ÄNameB   I G r o o v e F o r m s M e t a D a t a O b j e c t P r i v a t e      ö Ä
		function InitializeMetaDataObject(i_MetaDataObject, i_PropertyList, i_pIFormsDataModel)
		{
			GrooveRunTimeData.g_MetaDataObject = i_MetaDataObject;
			GrooveRunTimeData.g_PropertyList = i_PropertyList;
			GrooveRunTimeData.g_pIFormsDataModel = i_pIFormsDataModel;

			// set up global variables in the GrooveRunTimeData
			GrooveRunTimeData.g_cNull = GrooveScriptFunctions.CreateNewObject("");
		}

		function ShutdownMetaDataObject()
		{
			GrooveRunTimeData.RemoveItem("g_MetaDataTable");
			GrooveRunTimeData.RemoveItem("g_PropertyList");
			GrooveRunTimeData.RemoveItem("g_pIFormsDataModel");
			GrooveRunTimeData.RemoveAllItems();
		}

	em            ÄSCRIPTINTERFACE       ÄLIBIDL   { 6 5 D 4 8 B 8 E - E 9 A 4 - 4 9 1 a - B B D 4 - 0 5 5 8 3 D 7 9 B 1 D 7 }   CR  ÄIIDL   { 9 F 1 1 E 6 E C - 0 A A 7 - 4 c 2 b - 9 1 E 3 - 2 2 3 2 C 8 3 9 B 1 3 1 }   By   5 Ä
	
		function CreateFormsMetaDataHTMLProperty(i_PropertyName, i_MetaDataHTMLPropertyDataType, i_MetaDataHTMLPropertyPersistenceType, i_GrooveFormsMetaDataPropertyValueUnitFlags)
		{
			var pMetaDataHTMLProperty = GrooveScriptFunctions.CreateNewObject("Groove.GrooveFormsMetaDataHTMLProperty");
			pMetaDataHTMLProperty.IGrooveFormsMetaDataHTMLPropertyPrivate.InitializeMetaDataProperty(i_PropertyName, i_MetaDataHTMLPropertyDataType, i_MetaDataHTMLPropertyPersistenceType, i_GrooveFormsMetaDataPropertyValueUnitFlags);
			return pMetaDataHTMLProperty;
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       å   Ü    †∆   xJ    ¿ i     :         )            ÄSCRIPTINTERFACE       ÄDefault   1     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }   Co  ÄIIDL   { C C A F B B 4 4 - B 2 D 0 - 4 5 6 6 - 8 0 9 7 - 1 7 4 7 8 2 5 F 3 0 5 B }   1C  ÄName4   I G r o o v e F o r m s M e t a D a t a O b j e c t   	    ⁄ Ä
		function GetContainedBy()
		{
			var ContainedBy = int_GetItem("ContainedBy",GrooveScriptFunctions.CreateNewObject(""));
			return ContainedBy;
		}

		function GetMetaDataName()
		{
			var MetaDataName = int_GetItem("Name","");
			return MetaDataName;
		}

		function GetMetaDataDisplayName()
		{
			var DisplayName = int_GetItem("DisplayName", "");
			return DisplayName;
		}

		function GetPersistable()
		{
			var Persistable = int_GetItem("Persist",false);
			return Persistable;
			
		}

		function GetDataType()
		{
			var DataType = GrooveFormsFieldDataType_String;
			try
			{
				if (GrooveRunTimeData.g_MetaDataObject.LockedHasItem("DataType"))
				{	
					var intDataType = GrooveRunTimeData.g_MetaDataObject.LockedGetItem("DataType"); 
					if (intDataType == "Number")
						DataType = GrooveFormsFieldDataType_Number;
					else if (intDataType == "Date")
						DataType = GrooveFormsFieldDataType_Date;
					else if (intDataType == "GrooveComponent")
					{
						var HTMLElement;
						var HTMLElement = GrooveRunTimeData.g_MetaDataObject.GetHTMLElement();
						if (HTMLElement.DoesAttributeExist("DataType"))
						{
							intDataType = HTMLElement.OpenAttribute("DataType");
							switch(intDataType)
							{
								case "RichText":
									DataType = GrooveFormsFieldDataType_RichText;
									break;
								case "Attachments":
									DataType = GrooveFormsFieldDataType_Attachments;
									break;
							}
						}
						else
							GrooveDebugFunctions.DisplayAssert(0, "Incorrect meta data.");
					}
				}
				return DataType;
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function GetHTMLElement()
		{
			var HTMLElement = GrooveRunTimeData.g_cNull;
			try
			{
				if (GrooveRunTimeData.g_MetaDataObject.LockedHasItem("ContentElement"))
					HTMLElement = GrooveRunTimeData.g_MetaDataObject.LockedGetItem("ContentElement");
				return HTMLElement;
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function GetDescription()
		{
			var Description = int_GetItem("Description", "");
			return Description;
		}

		function int_GetItem(i_ItemName, i_DefaultValue)
		{
			var Value = i_DefaultValue;
			try
			{
				if (GrooveRunTimeData.g_MetaDataObject.LockedHasItem(i_ItemName))
					Value = GrooveRunTimeData.g_MetaDataObject.LockedGetItem(i_ItemName);
				return Value;
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function CreateMetaDataHTMLPropertyEnum()
		{
			try
			{
				var pMetaDataCache = GrooveScriptFunctions.OpenSharedObjectTable(GetMetaDataName());
				
				var MetaDataHTMLPropertyEnum;

				if (!pMetaDataCache.HasItem("PropertyEnum"))
				{
					//create IGrooveFormsMetaDataHTMLPropertyEnum
					MetaDataHTMLPropertyEnum = CreateUnknownEnumFromStringIIDs("{78993C3D-B613-49b5-82AA-1E7CB37E9DB6}", "{D6EADF18-42A8-443b-BCA5-4D608A818187}");

					//open content element enum from the propertylist element
					var pPropertyListElement = GrooveRunTimeData.g_MetaDataObject.PropertyListElement;
					var pPropertyElementEnum = pPropertyListElement.OpenContentElementEnum();

					while (pPropertyElementEnum.HasMore())
					{

						var pPropertyElement = pPropertyElementEnum.OpenNext();
						
						var pMetaDataHTMLProperty = int_CreateMetaDataHTMLPropertyFromElement(pPropertyElement);
						
			      –  			MetaDataHTMLPropertyEnum.Add(pMetaDataHTMLProperty);
					}
					pMetaDataCache.SetItem("PropertyEnum", MetaDataHTMLPropertyEnum);
				}
				else
					MetaDataHTMLPropertyEnum = pMetaDataCache.GetItem("PropertyEnum");
				
				return MetaDataHTMLPropertyEnum.IGrooveUnknownEnum;
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function DoesMetaDataHTMLPropertyExist(i_Name)
		{
			var pPropertyListElement = GrooveRunTimeData.g_MetaDataObject.PropertyListElement;
			var bExists = pPropertyListElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Property", "Name", i_Name);
			return bExists;	
		}

		function OpenMetaDataHTMLProperty(i_Name)
		{
			try
			{
				if (DoesMetaDataHTMLPropertyExist(i_Name))
				{
					var pPropertyListElement = GrooveRunTimeData.g_MetaDataObject.PropertyListElement;
					var pPropertyElement = pPropertyListElement.OpenContentElementByNameAndAttribute("urn:groove.net:Property", "Name", i_Name);
					var pMetaDataHTMLProperty = int_CreateMetaDataHTMLPropertyFromElement(pPropertyElement);
					return pMetaDataHTMLProperty;
				}
				else
				{
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function int_CreateMetaDataHTMLPropertyFromElement(i_pPropertyElement)
		{
			try
			{
				var PropertyName;
				var Type;
				var Location;
				var Units;

				if (i_pPropertyElement.DoesAttributeExist("Name"))
					PropertyName = i_pPropertyElement.OpenAttribute("Name");

				if (i_pPropertyElement.DoesAttributeExist("Type"))
					Type = i_pPropertyElement.OpenAttribute("Type");
				
				if (i_pPropertyElement.DoesAttributeExist("Location"))
					Location = i_pPropertyElement.OpenAttribute("Location");

				if (i_pPropertyElement.DoesAttributeExist("Units"))
					Units = i_pPropertyElement.OpenAttribute("Units");

				var MetaDataHTMLPropertyDataType = GetEnumValueFromPropertyTypeString(Type);
				var MetaDataHTMLPropertyPersistenceType = GetEnumValueFromPropertyLocationString(Location);

				var GrooveFormsMetaDataPropertyValueUnitFlag;
				if (Units == "")
					GrooveFormsMetaDataPropertyValueUnitFlag = GrooveFormsMetaDataPropertyValueUnitFlag_None;
				else
				{
					var UnitsArray = Units.split(",");
					var i = 0;
					GrooveFormsMetaDataPropertyValueUnitFlag = GrooveFormsMetaDataPropertyValueUnitFlag_None;
					while (i < UnitsArray.length)
					{
						if (UnitsArray[i] == "Characters")
							GrooveFormsMetaDataPropertyValueUnitFlag |= GrooveFormsMetaDataPropertyValueUnitFlag_Characters;
						else if (UnitsArray[i] == "Pixels")
							GrooveFormsMetaDataPropertyValueUnitFlag |= GrooveFormsMetaDataPropertyValueUnitFlag_Pixels;
						else if (UnitsArray[i] == "Lines")
							GrooveFormsMetaDataPropertyValueUnitFlag |= GrooveFormsMetaDataPropertyValueUnitFlag_Lines;
						i++;
					}
				}
				
				var pMetaDataHTMLProperty = CreateFormsMetaDataHTMLProperty(PropertyName, MetaDataHTMLPropertyDataType, MetaDataHTMLPropertyPersistenceType, GrooveFormsMetaDataPropertyValueUnitFlag);

				return pMetaDataHTMLProperty;
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @            p  ¿  q  »   r  x  s  à   t      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            »               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   |   ÄName&   G r o o v e F o r m s P D S E . g s l       
  ÄIMPLEMENTS   
  ÄIMPLEMENTS   
  ÄIMPLEMENTS   
  ÄIMPLEMENTS	     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT  S  
  ÄIMPLEMENTS       ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   l   ÄIIDL   { 2 2 1 B 8 0 4 4 - 6 7 0 F - 1 1 d 4 - 8 F 6 4 - 0 0 5 0 D A C D 1 F 8 0 }   e       ÄSCRIPT   6 7 0   ÄSCRIPT         ¿ Ä
		function GetAcceptFilesAsLinks()
		{
			return false;
		}

		function GetAcceptedFileTypes()
		{
			var BSTREnum = CreateBSTREnum();
			return BSTREnum;
		}

		function IsAcceptedFileType(i_FileExtension)
		{
			return true;
		}

		function GetSupportLinks()
		{
			return false;
		}
		
		function GetSupportFolders()
		{
			return false;
		}

		function GetEnableFileConflictHandling()
		{
			return false;
		}
		funct
  ÄIMPLEMENTS       ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   l   ÄIIDL   { 0 D 0 1 2 A C 8 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   i       ÄSCRIPT   2 - 9 
  ÄIMPLEMENTS       ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   l   ÄIIDL   { 8 A 3 7 5 D 5 9 - D 8 E A - 4 2 7 e - B 5 1 C - 4 F B 1 A 0 4 E 4 6 1 5 }   p       ÄSCRIPT   F B 1 
  ÄIMPLEMENTS       ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   l   ÄIIDL   { 2 7 8 2 F 1 7 4 - B F A D - 4 0 6 f - 9 F 6 5 - 7 F 8 B 9 E 3 3 B 5 F 8 }   o       ÄSCRIPT
   5 F 8   ÄSCRIPT       ÄSRCX  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s A t t a c h m e n t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   t     O p  ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 3 & F a c t o r y = O p e n   s       s           ∂                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ﬁ    $i   d}           ·            |·            ·    €   § ·               )      –     ÄSCRIPT          Ä
		function GenerateAddFile(i_pDelta, i_FileID, i_ParentID, i_DisplayName, i_FullName, i_pSourceFileContents,  i_pLastModifiedTime)
		{
			int_AddFile(g_AttachmentsElement, i_FileID, i_DisplayName, i_FullName, i_pSourceFileContents,  i_pLastModifiedTime);
			FireEvent("", "ShareObjectAdded", ScriptHostComponent, i_FullName, gThisIndex);
		}

		function GenerateReplaceFile(i_pDelta, i_FileID, i_ParentID, i_DisplayName, i_FullName, i_pSourceFileContents,  i_pLastModifiedTime)
		{
			int_ReplaceFile(g_pShareDirectory, g_AttachmentsElement, i_FileID, i_DisplayName, i_FullName, i_pSourceFileContents, i_pLastModifiedTime)
		}

		function GenerateRenameShareObject(i_pDelta, i_ShareObjectID, i_NewDisplayName)
		{
			if(DoesShareObjectExistByID(i_ShareObjectID))
			{
				var DisplayName = i_NewDisplayName;
				
				RenameShareObject(i_ShareObjectID, DisplayName);		
			}	
		}
			
		function GenerateDeleteShareObject(i_pDelta, i_ShareObjectID)
		{
			var Transaction = Telespace.OpenTransaction(false);
			var b = false;
			try
			{
				var ParentID = g_pShareDirectory.OpenParentFolderID(i_ShareObjectID);
				if (typeof ParentID != "undefined" && ParentID!="")
				{
					if(g_pShareDirectory.DoesShareObjectExistByID(i_ShareObjectID))
					{
					
						try
						{
							// Get file element by ID
							var pFileElement = OpenFileElementByID(i_ShareObjectID);

						} 
						catch (error)
						{
							Transaction.Abort();
							error.description = GetString(pBundle, "Disc_MB_MFE");
							gCallbackCode.DisplayError(error);
							return false;
						}
						DeletedAttachmentsPropertyList.SetPropertyAsElement(i_ShareObjectID, pFileElement, GroovePropertyFlag_Private);


						// Open share object 
						var ShareObject = OpenShareObjectByID(i_ShareObjectID);
						var FullName = ShareObject.FullName;
						// Delete share object
						g_pShareDirectory.DeleteShareObject(i_ShareObjectID, false);
						b = true;
					}
				}
				Transaction.Commit();
				if (b)
					FireEvent("", "ShareObjectDeleted", ScriptHostComponent, FullName, i_ShareObjectID, gThisIndex);
				return true;
			}
			catch (error)
			{
				Transaction.Abort();
			}
		}

		function GenerateChangeLastModifiedTime(i_pDelta, i_ObjectID, i_pLastModifiedTime)
		{
			if (pRootFolderElement.ContentElementWithNameAndAttributeExists("urn:groove.net:File", "ID", i_ObjectID))
			{
				var pShareObjectElement = pRootFolderElement.OpenContentElementByNameAndAttribute("urn:groove.net:File", "ID", i_ObjectID);
				if(typeof i_pLastModifiedTime == "undefined")
				{
					var pCurrentFileTime = g_pFileSystemServices.OpenCurrentUTCFileTime();

					pShareObjectElement.SetAttributeAsLong("LastModifiedTimeHigh", pCurrentFileTime.HighFileTimePart);
					pShareObjectElement.SetAttributeAsLong("LastModifiedTimeLow", pCurrentFileTime.LowFileTimePart);

				}
				else
				{
					if((i_pLastModifiedTime.HighFileTimePart == 0) && (i_pLastModifiedTime.LowFileTimePart == 0))
					{
						var pCurrentFileTime = g_pFileSystemServices.OpenCurrentUTCFileTime();

						pShareObjectElement.SetAttributeAsLong("LastModifiedTimeHigh", pCurrentFileTime.HighFileTimePart);
						pShareObjectElement.SetAttributeAsLong("LastModifiedTimeLow", pCurrentFileTime.LowFileTimePart);
					}
					else
					{
						pShareObjectElement.SetAttributeAsLong("LastModifiedTimeHigh", i_pLastModifiedTime.HighFileTimePart);
						pShareObjectElement.SetAttributeAsLong("LastModifiedTimeLow", i_pLastModifiedTime.LowFileTimePart);
					}
				}
			}
			
			return true;
		}

		function GenerateCreateFolder(pDelta, i_BrowsedFolderID, i_pLastModifiedTime)
		{
			return false;
		}

		function CreateShareObjectID()
		{
			var ID = int_CreateShareObjectID();
			return ID;
		}
		                                                                                                                                                                                                                  Ä     Ä    ÄSCRIPT         O Ä
		
		function DoesFolderExistInFolderByFullName(m_BrowsedFolderID, NewFullName)
		{
			return false;
		}

		function DoesFileExistInFolderByFullName(i_ParentFolderID, i_FullName)
		{
			var b = g_pShareDirectory.DoesFileExistInFolderByFullName(i_ParentFolderID, i_FullName);
			return b;
		}

		function OpenFileInFolderByFullName(i_ParentFolderID, i_FullName)
		{
			try
			{
				var ID = int_OpenFileInFolderByFullName(g_pShareDirectory, i_ParentFolderID, i_FullName);
				return ID;
			}
			catch(error)
			{
				if (LeftBack(error.description,".") == "Invalid access to memory location")
				{
					error.description = GetString(pBundle, "Disc_MB_FileErr");
				}
						
				gCallbackCode.DisplayError(error);
				return null;
			}
		}

		function DoesShareObjectExistByID(i_FolderID)
		{
			var b = int_DoesShareObjectExistByID(g_pShareDirectory, i_FolderID);
			return b;
		}

		function DoesBrowsedFolderIDExist()
		{
			return true;
		}
		
		function OpenShareObjectByID(i_ID)
		{
			var pShareObject = int_OpenShareObjectByID(g_pShareDirectory, i_ID);
			return pShareObject;
		}
		
		function OpenUniqueFileFullNameInFolder(i_FolderID, i_SuggestedFullName)
		{
			var FileName = i_SuggestedFileName;
			if (DoesFileExistInFolderByFullName(i_FolderID, FileName) == true)
			{
				var count = 2;
				for (var i=1; i < count; i++)
				{
					var FileExt = g_pFileSystemServices.OpenFileExtension(FileName);
					var DisplayName = LeftBack(g_pFileSystemServices.OpenFileBaseName(FileName), "_");
					FileName = DisplayName + "_" + i +"." + FileExt;
					if (DoesFileExistInFolderByFullName(i_FolderID, FileName) == false)
						break;
					count++
				}
			}		
			return FileName;
		}

		function OpenConflictRegion()
		{
			return "";
		}

		function OpenRootShareFolderID()
		{
			if (typeof g_RootFolderID != "undefined")
				return g_RootFolderID;
			else
			{
				GrooveDebugFunctions.DisplayAssert(0, "No valid RootShareFolder ID");
				return "";
			}
		}
		
		function OpenParentFolderID(i_ID)
		{
			return g_RootFolderID;
		}

		function OpenBrowsedFolderID()
		{
			if (g_RootFolderID !="")
				return g_RootFolderID;
			else if (g_AttachmentsElement)
			{
				OpenShareDirectory();
				GrooveDebugFunctions.DisplayAssert(g_RootFolder != "", "Error getting RootFolderID");
				return g_RootFolderID;
			}
			else
				GrooveDebugFunctions.DisplayAssert(0, "No attachments element.");

		}

		function OpenShareObjectEnum(i_FolderID)
		{
			var ShareObjectEnum = int_OpenShareObjectEnum(g_pShareDirectory, i_FolderID);
			return ShareObjectEnum;			
		}

		function OpenShareObjectCount(i_FolderID)
		{		
			var Count = 0;
			if (typeof g_pShareDirectory != "undefined" && g_pShareDirectory != null)
			{
				Count = g_pShareDirectory.OpenShareObjectCount(i_FolderID);
			}
			return Count;			
		}

		function OpenCanonicalShareObjectURL(i_ID)
		{
			var pURI = gCallbackCode.GetURIToCurrentRecord();
			if (typeof pURI != "undefined" && pURI != null)
				return pURI.String;
			else
				return "";
		}

		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Äj     ê     ÄSCRIPT	         Ç Ä
		function HaveExecutingFiles()
		{
			return false;
		}

		// This duplicates GCoTemporaryFileServices::OpenGrooveTempPath()
		// and will go away when we change App.GetDirectoryPath() to return
		// Groove's standard $InstallDataRoot based temporary directory.
		function OpenGrooveTempPath()
		{
			var Result = "";
			Result = App.GetDirectoryPath(GrooveDirectoryValue_Temp);
			return Result;
		}

		function OpenTemporaryPath()
		{
			if (typeof TempPath == "undefined" || TempPath == "")
			{
				TempPath = OpenGrooveTempPath();
			}

			return TempPath;
		}

		function ExecuteFile(i_FileID, i_ExecuteVerb, i_SessionName)
		{
			var pShareObject = OpenShareObjectByID(i_FileID);
			var FileName = pShareObject.FullName;

			try
			{

				var pFileContents = pShareObject.File.OpenBinaryContents();

				if (typeof pFileContents == "undefined")
					return;

				TempPath = OpenTemporaryPath();
			
				// Create and launch file in external app.
				var PathName = g_pFileSystemServices.ExportFileToFolder(pFileContents, TempPath, FileName, true, true);
				App.LaunchProgram(ResolveLinkTargetPathName(PathName), "", i_ExecuteVerb);

				// Tell Groove to delete file after app's done.
				var pTemporaryFileServices = GrooveScriptFunctions.CreateNewObject("Groove.TemporaryFileServices");
				pTemporaryFileServices.TemporaryFileServices2.DeleteTemporaryPath(PathName, GrooveTemporaryFileDeleteFlag_TimerDelay, PropertyList.OpenProperty(PROPERTY_ACCOUNT_GUID));
			}
			catch (error)
			{
				error.description = GetString(pBundle, "Disc_MB_OFErr");
				gCallbackCode.DisplayError(error);
			}
		}

		

		
		function BrowseFolder(i_FolderID)
		{
			g_pShareDirectory.SetBrowsedFolderIDByMemberContactURL(i_ContactURL, i_FolderID);
			return true;
		}

		function RenameShareObject(i_ShareObjectID, i_DisplayName)
		{
			int_RenameShareObject(g_pShareDirectory, g_AttachmentsElement, i_ShareObjectID, i_DisplayName);
			
			FireEvent("", "ShareObjectRenamed", ScriptHostComponent, OldFullName, NewFullName, gThisIndex);
		}

		function DeleteAllShareObjects(i_Disseminate)
		{
			var RootFolderID = OpenRootShareFolderID();
			var ShareObjectEnum = OpenShareObjectEnum(RootFolderID);
			var fakeDelta = GrooveScriptFunctions.CreateNewObject("");
			while (ShareObjectEnum.HasMore())
			{
				var ShareObjectID = ShareObjectEnum.OpenNext().ShareObject.ID;
				GenerateDeleteShareObject(fakeDelta, ShareObjectID)	
			}
		}
		
		function CanAddFile(i_FolderID)
		{
			return true;
		}

		function CanReplaceFile(i_FileID)
		{
			return true;
		}

		function CanAddFolder(i_FolderID)
		{
			return true;
		}

		function CanDeleteShareObject(i_ShareObjectID)
		{
			return true;
		}

		function CanRenameShareObject(i_ShareObjectID)
		{
			return true;
		}

		function CanChangeFileContents(i_FileID)
		{
			return true;
		}

		   ributes(i_pFileElement, i_FileID, i_DisplayName, i_FullName, i_pSourceFileContents, i_pLastModifiedTime)
	{	
		// RSSTodo: Put a Transaction around the following and add a Property with the i_pFileElement after
		// the xlink attributes have been set.  Clean up the properties after the record is committed or at
		// initialize of the DiscussionGlue.gsl
		
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			// Set share object attributes on element
			int_SetFileElementAttributes(i_pFileElement, i_FileID, i_DisplayName, i_FullName, i_pSourceFileContents, i_pLastModifiedTime);

			AttachmentsPropertyList.SetPropertyAsElement(i_FileID, i_pFileElement, GroovePropertyFlag_Private);
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
		}
	}

	function OpenFileElementByID(i_ID)
	{
		var pFileElement = int_OpenFileElementByID(g_AttachmentsElement, i_ID);

		return pFileElement;
	}
	                                                                                                                                                  ’∂   Äù           ÄSCRIPT         ã Ä	
	var g_pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
	var g_pFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
	var g_pShareDirectory;
	var TempPath;
	var g_RootFolderID;
	var g_AttachmentsElement;
	var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
	var pCurrentIdentity = Telespace.OpenCurrentIdentity();
	var pCurrentIdentityContact = pCurrentIdentity.Contact;
	var myUserURL = pCurrentIdentity.URL();
	var g_AttachmentsElementSet;
	var pRootFolderElement;
	var gCallbackCode;
	var gThisIndex;
	var pIdentity = PropertyList.OpenPropertyAsIUnknown(PROPERTY_CURRENT_IDENTITY);
	var pContact = pIdentity.Contact;
	var i_ContactURL = pContact.OpenURL();
	var pIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
	var pBundle = pIntl.CreateResourceBundle("http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.Tools.General.Discussion.DiscussionGRP_RBD&Version=0", pIntl.DefaultLocale);
	var AttachmentsPropertyListName = CreateShareObjectID();
	var DeletedAttachmentsPropertyListName = CreateShareObjectID();
	var CurrentAttachmentsElementName = CreateShareObjectID();
	var AttachmentsPropertyList;
	var DeletedAttachmentsPropertyList;		

	function Initialize()
	{
		//GrooveScriptFunctions.DoMessageBox("break");
		if (PropertyList.PropertyExists(AttachmentsPropertyListName))
			PropertyList.RemoveProperty(AttachmentsPropertyListName, GroovePropertyFlag_Private);
		if (PropertyList.PropertyExists(DeletedAttachmentsPropertyListName))
			PropertyList.RemoveProperty(DeletedAttachmentsPropertyListName, GroovePropertyFlag_Private);
		if (PropertyList.PropertyExists(CurrentAttachmentsElementName))
			PropertyList.RemoveProperty(CurrentAttachmentsElementName, GroovePropertyFlag_Private);

		AttachmentsPropertyList = PropertyList.CreatePropertyAsPropertyList(AttachmentsPropertyListName);
		DeletedAttachmentsPropertyList = PropertyList.CreatePropertyAsPropertyList(DeletedAttachmentsPropertyListName);
	}

	function Terminate()
	{
		delete g_pShareDiectory;
		delete g_AttachmentsElement;
		delete pRootFolderElement;
		g_AttachmentsElementSet = false;
		// Should enum through attachments propertylist and remove any files which were added
		PropertyList.RemoveProperty(AttachmentsPropertyListName, GroovePropertyFlag_Private);
		PropertyList.RemoveProperty(DeletedAttachmentsPropertyListName, GroovePropertyFlag_Private);
		PropertyList.RemoveProperty(CurrentAttachmentsElementName, GroovePropertyFlag_Private);
	}
	
	function IsInitialized()
	{
		if (typeof g_AttachmentsElement == "undefined" ||
			typeof g_RootFolderID == "undefined" ||
			typeof g_pShareDirectory == "undefined")
				return false;
		else
			return true;
	}

	function SetAttachmentsElement(i_Element)
	{
		g_AttachmentsElement = i_Element;
		OpenShareDirectory();
		PropertyList.SetPropertyAsElement(CurrentAttachmentsElementName, i_Element, GroovePropertyFlag_Private);
	}

	function RevertAttachmentsElement()
	{
		g_AttachmentsElement = PropertyList.OpenPropertyAsElement(CurrentAttachmentsElementName);
		var pDocumentShareFactory = GrooveScriptFunctions.CreateNewObject("Groove.DocumentShareFactory");
		g_pShareDirectory = pDocumentShareFactory.CreateShareDirectoryFromElement(g_AttachmentsElement);
	}

	
	
	function SetIntialCallbackValues(i_CallbackCode, i_Index)
	{
		gCallbackCode = i_CallbackCode.GetScriptDispatch();
		gThisIndex = i_Index;
	}

	function OpenShareDirectory()
	{
		if (typeof g_AttachmentsElement != "undefined" && g_AttachmentsElement!=null)
		{
			g_pShareDirectory = int_OpenShareDirectory(g_AttachmentsElement);

			g_AttachmentsElementSet = true;
			return g_pShareDirectory;
		}
		else
			GrooveDebugFunctions.DisplayAssert(0, "Unable to open ShareDirectory");
	}

	function CreateOrOpenRootFolder()
	{
		g_RootFolderID = int_CreateOrOpenRootFolder(g_AttachmentsElement);
	}
	
	function SetFileElementAtt      ÄSCRIPTINTERFACE       ÄDefault   1     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }      ÄIIDL   { 3 A E 4 A 4 3 4 - 5 A 9 D - 4 d a d - 9 E F 7 - 8 9 0 5 0 D A A 1 9 2 B }   	   ÄName&   I G r o o v e F o r m s S a n d b o x      U_ Ä
		function GetDatabaseName()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var SandboxName = GrooveRunTimeData.g_SandboxFullName;
				Transaction.Commit();
				return SandboxName;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}		

		function GetDatabaseID()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var SandboxID = GrooveRunTimeData.g_SandboxID;
				Transaction.Commit();
				return SandboxID;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}		
		
		function AddFile(i_FileName, i_BIS, i_Type, i_ID)
		{
			var Delta = GrooveRunTimeData.g_DynMgr.OpenDelta("", false);
			Delta.AdvancedDelta2.LocalOnly = true;
			Delta.Begin();
			var cNull = GrooveScriptFunctions.CreateNewObject("");
			try
			{
				var i_SandboxID = GrooveRunTimeData.g_SandboxID;
				if (i_Type == GrooveFormsDatabaseObjectType_View)
					var Ext = ".vtml";
				else if (i_Type == GrooveFormsDatabaseObjectType_Form)
					var Ext = ".html";
				else if (i_Type == GrooveFormsDatabaseObjectType_Tool)
					var Ext = ".tpl";
				else if (i_Type == GrooveFormsDatabaseObjectType_FileFromDisk)
				{
					var pFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

					var Ext = "." + pFileSystemServices.OpenFileExtension(i_FileName);
					i_FileName = pFileSystemServices.OpenFileBaseName(i_FileName);
				}
				else if (i_Type == GrooveFormsDatabaseObjectType_Fields || i_Type == GrooveFormsDatabaseObjectType_Schema)
					var Ext = ".xml";


				FullName = i_FileName + Ext;
				if (typeof i_ID == "undefined" || i_ID == "" || i_ID == null)
					var ID = CreateDatabaseObjectID();
				else
					var ID = i_ID;
				GrooveRunTimeData.g_DocumentShareEngine.AddFile(ID, i_SandboxID, i_FileName, FullName , i_BIS, cNull, false);
				GrooveRunTimeData.g_DynMgr.DoDelta(Delta);
				return ID;
			}
			catch (error)
			{
				Delta.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function CreateDatabaseObjectID()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var ID = GrooveRunTimeData.g_DocumentShareEngine.CreateShareObjectID();
				Transaction.Commit();
				return ID;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function CreateSandboxScriptNameEnum()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var SandboxID = GrooveRunTimeData.g_SandboxID;
				var ShareObjectEnum = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenShareObjectEnum(SandboxID);
				var NameEnum = CreateBSTREnum(false);
				while (ShareObjectEnum.HasMore())
				{
					var ShareObject = ShareObjectEnum.OpenNext().ShareObject;
					var ShareObjectExt = RightBack(ShareObject.FullName, ".");
					if (ShareObjectExt == "js" || ShareObjectExt == "vbs")
					{
						NameEnum.Add(ShareObject.FullName);
					}
				}
				Transaction.Commit();
				return NameEnum.BSTREnum;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
			}
		}

		function CreateDatabaseObjectNameAndTypeEnum()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			var i_SandboxID = GrooveRunTimeData.g_SandboxID;
			try
			{	
				var ObjectEnum = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenShareObjectEnum(i_SandboxID);
				var SSEnum = CreateStringStringEnum(false);
				while (ObjectEnum.HasMore())
				{
					var Object = ObjectEnum.OpenNext();
					var Ext = RightBack(Object.ShareObject.FullName, ".");
					var FullName = Object.ShareObject.FullName;
					var Type = "";
					if (Ext == "html" || Ext == "dyn")
						Type = GrooveFormsDatabaseObjectType_Form;
					else if (Ext == "vtml")
						Type = GrooveFormsDatabaseObjectType_View;
					else if (Ext == "xml")
					{
						if (FullName == "Fields.xml")
							Type = GrooveFormsDatabaseObjectType_Fields;
						else
							Type = GrooveFormsDatabaseObjectType_Schema;
					}
					else if (Ext == "tpl")
						Type = GrooveFormsDatabaseObjectType_Tool;
					else
						Type = GrooveFormsDatabaseObjectType_FileFromDisk;

					SSEnum.Add(FullName, Type);				
				}

				Transaction.Commit();
				return SSEnum.StringStringEnum;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function CreateNameIDEnum(i_Type)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			var i_SandboxName = GrooveRunTimeData.g_SandboxFullName;
			var ParentID = OpenSandboxParentID();
			if (ParentID == null)
			{
				Transaction.Commit();
				return null;
			}
			try
			{
				if (GrooveRunTimeData.g_DocumentShareEngine.Data.DoesFolderExistInFolderByFullName(ParentID, i_SandboxName))
				{
					var SSEnum = CreateStringStringEnum(false);
					var FolderID = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenFolderInFolderByFullName(ParentID, i_SandboxName);
					var FileEnum = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenShareObjectEnum(FolderID);
					while (FileEnum.HasMore())
					{
						var ShareObject = FileEnum.OpenNext();
						if (i_Type == GrooveFormsDatabaseObjectType_View)
							var type = "vtml";
						else if (i_Type == GrooveFormsDatabaseObjectType_Form)
							var type = "html";
						else if (i_Type == GrooveFormsDatabaseObjectType_Tool)
							var type = "tpl";
						else if (i_Type == GrooveFormsDatabaseObjectType_Schema || i_Type == GrooveFormsDatabaseObjectType_Fields)
							var type = "xml";
						else if (i_Type == GrooveFormsDatabaseObjectType_FileFromDisk)
							var type = "";

						if (type != "" && RightBack(ShareObject.ShareObject.FullName, ".") == type)
						{
							var ID = ShareObject.ShareObject.ID;
							var Name = ShareObject.ShareObject.DisplayName;
							SSEnum.Add(Name, ID);
						}
						else if (type == "")
						{
							var ext = RightBack(ShareObject.ShareObject.FullName, ".");
							if (ext != "vtml" && ext != "html" && ext != "xml" && ext != "tpl")
							{
								var ID = ShareObject.ShareObject.ID;
								var Name = ShareObject.ShareObject.DisplayName;								
								SSEnum.Add(Name, ID);
							}
						}
					}
					GrooveRunTimeData.g_CurrentSandboxName = i_SandboxName;
					Transaction.Commit();
					return SSEnum.StringStringEnum;
				}
				else
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, "Sandbox doesn't exist");
					return null;
				}
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function CreateNameURLEnum(i_Type)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			var i_SandboxName = GrooveRunTimeData.g_SandboxFullName;
			try
			{
				var ParentID = OpenSandboxParentID();
				if (ParentID == null)
				{
					Transaction.Commit();
					return null;
				}

				if (GrooveRunTimeData.g_DocumentShareEngine.Data.DoesFolderExistInFolderByFullName(ParentID, i_SandboxName))
				{
					var SSEnum = CreateStringStringEnum(false);
					var FolderID = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenFolderInFolderByFullName(ParentID, i_SandboxName);
					var FileEnum = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenShareObjectEnum(FolderID);
					while (FileEnum.HasMore())
					{
						var ShareObject = FileEnum.OpenNext();
						if (i_Type == GrooveFormsDatabaseObjectType_View)
							var type = "vtml";
						else if (i_Type == GrooveFormsDatabaseObjectType_Form)
							var type = "html";
						else if (i_Type == GrooveFormsDatabaseObjectType_Tool)
							var type = "tpl";
						else if (i_Type == GrooveFormsDatabaseObjectType_Schema || i_Type == GrooveFormsDatabaseObjectType_Fields)
							var type = "xml";
						else if (i_Type == GrooveFormsDatabaseObjectType_FileFromDisk)
							var type = "";

						if (type != "" && RightBack(ShareObject.ShareObject.FullName, ".") == type)
						{
							var ID = ShareObject.ShareObject.ID;
							var Name = ShareObject.ShareObject.DisplayName;
							var URL = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenBindableShareObjectURL(ID);
							SSEnum.Add(Name, URL);
						}
						else if (type == "")
						{
							var ext = RightBack(ShareObject.ShareObject.FullName, ".");
							if (ext != "vtml" && ext != "html" && ext != "xml" && ext != "tpl")
							{
								var ID = ShareObject.ShareObject.ID;
								var Name = ShareObject.ShareObject.DisplayName;
								var URL = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenBindableShareObjectURL(ID);
								SSEnum.Add(Name, URL);
							}
						}
					}
					GrooveRunTimeData.g_CurrentSandboxName = i_SandboxName;
					Transaction.Commit();
					return SSEnum.StringStringEnum;
				}
				else
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, "Sandbox doesn't exist");
					return null;
				}
				Transaction.Commit();
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function DeleteDatabaseObject(i_ID)
		{
			var Delta = GrooveRunTimeData.g_DynMgr.OpenDelta("", false);
			Delta.AdvancedDelta2.LocalOnly = true;
			Delta.Begin();
			try
			{
				GrooveRunTimeData.g_DocumentShareEngine.DeleteShareObject(i_ID, false);
				//var pDBObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "SandboxCache");
				//RemoveObjectFromCache(i_ID, pDBObjectCache);
				GrooveRunTimeData.g_DynMgr.DoDelta(Delta);
			}
			catch (error)
			{
				Delta.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}	
		}

		function DoesDatabaseObjectExistByFullName(i_FullName)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var SandboxID = GrooveRunTimeData.g_SandboxID;
				var b = GrooveRunTimeData.g_DocumentShareEngine.Data.DoesFileExistInFolderByFullName(SandboxID, i_FullName);
				Transaction.Commit();
				return b;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function DoesDatabaseObjectExistByID(i_ID)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var b = GrooveRunTimeData.g_DocumentShareEngine.Data.DoesShareObjectExistByID(i_ID);
				Transaction.Commit();
				return b;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function CreateDatabaseObjectEnum(i_Type)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var pEngineData = GrooveRunTimeData.g_DocumentShareEngine.Data;
				var DatabaseID = int_OpenParentID();
				var SandboxName = GrooveRunTimeData.g_SandboxFullName;
				if (pEngineData.DoesFolderExistInFolderByFullName(DatabaseID, SandboxName))
				{
					var DatabaseObjectEnum = CreateUnknownEnumFromStringIIDs("{BF3DEF98-6EEE-42c6-AA90-CE9D2025ED7D}", "{515F5A6E-BFE4-43d3-A353-8C167CABC17F}");
					var FolderID = pEngineData.OpenFolderInFolderByFullName(DatabaseID, SandboxName);

					var FileEnum = pEngineData.OpenShareObjectEnum(FolderID);
					while (FileEnum.HasMore())
					{
						var ShareObject = FileEnum.OpenNext().ShareObject;

						var FullName = ShareObject.FullName;
						var FileExt = RightBack(FullName, ".");

						// Set the correct file extension for the given file type.
						var FileType = null;
						if (i_Type == GrooveFormsDatabaseObjectType_Schema && FullName != "Fields.xml")
							FileType = "xml";
						else if (i_Type == GrooveFormsDatabaseObjectType_Fields && FullName == "Fields.xml")
							FileType = "xml";
						else if (i_Type == GrooveFormsDatabaseObjectType_Tool)
							FileType = "tpl";
						else if (i_Type == GrooveFormsDatabaseObjectType_Form)
							FileType = "html";
						else if (i_Type == GrooveFormsDatabaseObjectType_View)
							FileType = "vtml";
						else if (i_Type == GrooveFormsDatabaseObjectType_ToolDisseminator)
							FileType = "dis";
						else if (i_Type == GrooveFormsDatabaseObjectType_FileFromDisk)
							FileType = "";

						if (FileType == null || (FileType != "" && FileExt == FileType) || (FileType == "" && FileExt != "xml" && FileExt != "tpl" && FileExt != "html" && FileExt != "vtml" && FileExt != "dis"))
						{
							var DatabaseObject = OpenDatabaseObjectByFullName(FullName);
							DatabaseObjectEnum.Add(DatabaseObject);
						}
					}
					Transaction.Commit();
					return DatabaseObjectEnum.IGrooveUnknownEnum;
				}
				else
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, "Sandbox doesn't exist.");
					return null;
				}
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				return null;
			}
		}

		function OpenDatabaseObjectByFullName(i_Name)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var SandboxID = GrooveRunTimeData.g_SandboxID;
				var DbObjectID = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenFileInFolderByFullName(SandboxID, i_Name);
				var pFormsDbObject = OpenDatabaseObjectByID(DbObjectID);
				Transaction.Commit();
				return pFormsDbObject;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
			}
		}

		function OpenDatabaseObjectByID(i_ID)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				if (i_ID == "-1")
					GrooveDebugFunctions.DisplayAssert(0, "Invalid SandboxObject ID (-1)");

				if (GrooveRunTimeData.g_DocumentShareEngine.Data.DoesShareObjectExistByID(i_ID))
				{
					var DbObject = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenShareObjectByID(i_ID);
					var pSBObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "SandboxCache");
					var pFormsDbObject = null;
					if (!IsObjectInCache(i_ID, pSBObjectCache))
					{
						pFormsDbObject = GrooveScriptFunctions.CreateNewObject("Groove.GrooveFormsDatabaseObject2");
						pFormsDbObject.IGrooveFormsDatabaseObjectPrivate.InitializeDatabaseObject(DbObject.ShareObject, GrooveRunTimeData.g_DocumentShareEngine, GrooveRunTimeData.g_PropertyList, GrooveRunTimeData.g_FormsToolDataModel, GrooveRunTimeData.g_SandboxID, GrooveRunTimeData.g_MetaDataTable, ScriptHostComponent.IGrooveFormsSandbox, GrooveRunTimeData.g_FormsToolDataModelPrivate);
						AddObjectToCache(i_ID, pFormsDbObject, pSBObjectCache);
					}
					else
					{
						pFormsDbObject = OpenObjectFromCache(i_ID, pSBObjectCache);
						if (pFormsDbObject.IGrooveFormsDatabaseObjectPrivate.OutOfDate)
						{
							pFormsDbObject.IGrooveFormsDatabaseObjectPrivate.ShutdownDatabaseObject();
							RemoveObjectFromCache(i_ID, pSBObjectCache);
							Transaction.Commit();
							return OpenDatabaseObjectByID(i_ID);
						}
					}
					Transaction.Commit();
					return pFormsDbObject;
				}
				else
				{
					Transaction.Abort();
					return null;
				}
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
			}
		}

		function OpenDatabaseObjectCountByType(i_DatabaseObjectType)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var Count = 0;
				var DbObjEnum = CreateNameURLEnum(i_DatabaseObjectType);

				while (DbObjEnum.HasMore())
				{
					var Obj = DbObjEnum.OpenNextPair();
					Count++;
				}

				Transaction.Commit();
				return Count;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
			}
		}

		function GetDatabaseObjectCount()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{				
				var Count = 0;
				var DbObjEnum = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenShareObjectEnum(GrooveRunTimeData.g_SandboxID);
			
				while (DbObjEnum.HasMore())
				{
					var Obj = DbObjEnum.OpenNext();
					Count++;
				}

				Transaction.Commit();
				return Count;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
			}	
		}

		function RenameDatabaseObject(i_ID, i_NewName)
		{
			var Delta = GrooveRunTimeData.g_DynMgr.OpenDelta("", false);
			Delta.AdvancedDelta2.LocalOnly = true;
			Delta.Begin();
			try
			{
				if (DoesDatabaseObjectExistByID(i_ID))
				{
					//var pDBObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "SandboxCache");
					//if (IsObjectInCache(i_ID, pDBObjectCache))
					//	RemoveObjectFromCache(i_ID, pDBObjectCache);
					GrooveRunTimeData.g_DocumentShareEngine.RenameShareObject(i_ID, i_NewName, false);
				}
				GrooveRunTimeData.g_DynMgr.DoDelta(Delta);
			}
			catch (error)
			{
				Delta.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);

			}
		}

		function ReplaceDatabaseObjectByFullName(i_FullName, i_BIS, i_VersionID)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			var i_SandboxID = GrooveRunTimeData.g_SandboxID;
			try
			{		
				var ID = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenFileInFolderByFullName(i_SandboxID, i_FullName);
				ReplaceDatabaseObjectByID(ID, i_BIS, i_VersionID);
				Transaction.Commit();
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function ReplaceDatabaseObjectByID(i_ID, i_BIS, i_VersionID)
		{
			var Delta = GrooveRunTimeData.g_DynMgr.OpenDelta("", false);
			Delta.AdvancedDelta2.LocalOnly = true;
			Delta.Begin();
			try
			{
				if (i_ID == "-1")
					GrooveDebugFunctions.DisplayAssert(0, "Invalid SandboxObject ID (-1)");
				var cNull = GrooveScriptFunctions.CreateNewObject("");
				if (typeof i_VersionID == "undefined")
					i_VersionID = "";
				var i_SandboxID = GrooveRunTimeData.g_SandboxID;
				if (GrooveRunTimeData.g_DocumentShareEngine.Data.DoesShareObjectExistByID(i_ID))
				{
					var DbObject = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenShareObjectByID(i_ID);
					var NewVersionID = GrooveRunTimeData.g_DocumentShareEngine.ReplaceFile2(i_ID, i_SandboxID, DbObject.ShareObject.DisplayName, DbObject.ShareObject.FullName, i_BIS, cNull, i_VersionID, "", false);
					GrooveRunTimeData.g_DynMgr.DoDelta(Delta);
					return NewVersionID;
				}
				else
				{
					Delta.Abort();
					return "";
				}
			}
			catch (error)
			{
				Delta.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function ApplySandboxChanges()
		{
			try
			{
				// Before we apply all of the sandbox changes we need to run through the fields
				// and make sure they are all in the schema/trigger list
				var DbID = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenParentFolderID(GrooveRunTimeData.g_SandboxID);
				var RootFolderID = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenRootShareFolderID();
				GrooveDebugFunctions.DisplayAssert(DbID != RootFolderID, "Error - sandbox is parented to the root folder");
				var pDatabase = GrooveRunTimeData.g_FormsToolDataModel.OpenDatabase(DbID);
				
				var pDesigner = pDatabase.OpenDesignerForSandbox(GrooveRunTimeData.g_SandboxID);
				var pFieldEnum = pDesigner.CreateFieldEnum();
				while (pFieldEnum.HasMore())
				{
					var pIField = pFieldEnum.OpenNext();
					if (pIField.Persistable)
					{
						if (!pDesigner.IGrooveFormsDesignerPrivate.IsFieldInSchemaPriv(pIField.FieldName))
						{
							pDesigner.IGrooveFormsDesignerPrivate.AddFieldToSchemaPriv(pIField);
							pDesigner.IGrooveFormsDesignerPrivate.AddFieldToTriggerListPriv(pIField);
						}
					}
				}

				// Now update the tool file.
				var ToolObj = OpenToolObject();
				UpdateToolFile(ToolObj.ToolFileName, ToolObj.RootElement);

				var SandboxID = GrooveRunTimeData.g_SandboxID;

				var pEngineData = GrooveRunTimeData.g_DocumentShareEngine.Data;
				var pFileExists = pEngineData.DoesFileExistInFolderByFullName(SandboxID, "SandboxFileUpdates.log");
				if (pFileExists)
				{
					// Get the root element from the file since it already exists.
					var pLogFileID = pEngineData.OpenFileInFolderByFullName(SandboxID, "SandboxFileUpdates.log");
					var pByteInputStream = pEngineData.OpenFileContents(pLogFileID);
					var pRootElement = CreateTemporaryRootElementFromStream(pByteInputStream);
					pByteInputStream.Close();

					GrooveRunTimeData.g_VersionInfoRootElement = null;
					
					var pElementEnum = pRootElement.OpenContentElementEnum();
					while (pElementEnum.HasMore())
					{
						var pElement = pElementEnum.OpenNext();
						if (pElement.DoesAttributeExist("Operation") && pElement.DoesAttributeExist("ID"))
						{
							var FileOperation = pElement.OpenAttribute("Operation");
							var FileID = pElement.OpenAttribute("ID");

							if (pEngineData.DoesShareObjectExistByID(FileID))
							{
								var pShareObject = pEngineData.OpenShareObjectByID(FileID).ShareObject;

								var FileName = pShareObject.FullName;
								if (FileName == "SandboxFileUpdates.log" || FileName == "VersionInfo.ver")
									continue;

								if (pElement.DoesAttributeExist("OriginalFullName"))
									FileName = pElement.OpenAttribute("OriginalFullName");
								GrooveDebugFunctions.DisplayAssert(FileName != "Fields.xml", "About to update Fields file from Sandbox - ERROR");
								switch (FileOperation)
								{
									case "Add":
									{
										var NewDatabaseObjectID = null;
										if (pElement.DoesAttributeExist("NewDatabaseViewID"))
											NewDatabaseObjectID = pElement.OpenAttribute("NewDatabaseViewID");
										else if (pElement.DoesAttributeExist("NewDatabaseFormID"))
											NewDatabaseObjectID = pElement.OpenAttribute("NewDatabaseFormID");

										AddDatabaseFileFromSandbox(pShareObject, NewDatabaseObjectID);
										break;
									}
									case "Replace":
									{
										ReplaceDatabaseFileFromSandbox(pShareObject, FileName);
										break;
									}
									case "Rename":
									{
										RenameDatabaseFileFromSandbox(pShareObject, FileName);
										break;
									}
								}
							}
							else if (FileOperation == "Delete")
							{
								if (pElement.DoesAttributeExist("OriginalFullName"))
								{
									FileName = pElement.OpenAttribute("OriginalFullName");
									DeleteDatabaseFileFromSandbox(FileName);
								}
							}
						}
					}
				}

				GrooveRunTimeData.g_VersionInfoRootElement = null;
			}
			catch (error)
			{
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          @           }  ¿  ~        †  Ä      Å  ∞  Ç            u     x`  x`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      	 »               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   n   ÄName,   G r o o v e F o r m s S a n d b o x . g s l   a       ÄSCRIPT     ÄSCRIPT     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE  0  Ä// IGrooveDocumentShareEngineSynchronousListener 
  ÄIMPLEMENTS    ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n   \     n = 2 &        î          3
  
  ÄIMPLEMENTS       ÄLIBIDL   { C 3 3 B 4 0 7 C - 2 D F A - 4 a c 0 - 8 A A 3 - 3 9 A 9 5 3 2 6 0 C E 7 }      ÄIIDL   { 2 2 4 4 6 7 B 1 - B 2 B 1 - 4 0 2 3 - B B 3 0 - 9 8 1 9 2 C D 4 E 2 C A }   .       ÄSCRIPT  RIPT        §                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Ú    |·            v    n    ¥ i     (         )            ÄSCRIPT         i Ä	
		function FinalConstruct()
		{

		}

		function priv_ShutdownSandboxCacheProc(i_Key, i_pObject)
		{
			i_pObject.IGrooveFormsDatabaseObjectPrivate.ShutdownDatabaseObject();
		}

		function OpenSandboxParentID()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var SandboxID = GrooveRunTimeData.g_SandboxID;
				var SbParentID = null;
				if (GrooveRunTimeData.g_DocumentShareEngine.Data2.DoesShareObjectExistByID(SandboxID))
					SbParentID = GrooveRunTimeData.g_DocumentShareEngine.Data.OpenParentFolderID(SandboxID);
				Transaction.Commit();
				return SbParentID;
			}
			catch (error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
			}
		}

		function AddDatabaseFileFromSandbox(i_ShareObject, i_NewSandboxObjectID)
		{
			var cNull = GrooveScriptFunctions.CreateNewObject("");
			var pEngine = GrooveRunTimeData.g_DocumentShareEngine;

			var DestinationFileName = i_ShareObject.FullName;
			var DestinationFolderID = OpenSandboxParentID();

			if (!pEngine.Data.DoesFileExistInFolderByFullName(DestinationFolderID, DestinationFileName))
			{
				var SourceFileID = i_ShareObject.ID;
				var BIS = pEngine.Data.OpenFileContents(SourceFileID);
				// New object ID is for views only, need to create a new ID for all other types of files.
				var DestinationFileID = i_NewSandboxObjectID;
				if (DestinationFileID == null)
					DestinationFileID = pEngine.CreateShareObjectID();
				pEngine.AddFile(DestinationFileID, DestinationFolderID, i_ShareObject.DisplayName, i_ShareObject.FullName, BIS, cNull, true);
				BIS.Close();
			}
		}

		function DeleteDatabaseFileFromSandbox(i_FileName)
		{
			var pEngine = GrooveRunTimeData.g_DocumentShareEngine;

			var DestinationFolderID = OpenSandboxParentID();

			if (pEngine.Data.DoesFileExistInFolderByFullName(DestinationFolderID, i_FileName))
			{
				//GrooveDebugFunctions.DisplayAssert(0, "");
				var DestinationFileID = pEngine.Data.OpenFileInFolderByFullName(DestinationFolderID, i_FileName);
				pEngine.DeleteShareObject(DestinationFileID, true);
			}
		}

		function ReplaceDatabaseFileFromSandbox(i_ShareObject, i_FileName)
		{
			var cNull = GrooveScriptFunctions.CreateNewObject("");
			var pEngine = GrooveRunTimeData.g_DocumentShareEngine;

			var DestinationFolderID = OpenSandboxParentID();

			if (pEngine.Data.DoesFileExistInFolderByFullName(DestinationFolderID, i_FileName))
			{
				var SourceFileID = i_ShareObject.ID;
				var BIS = pEngine.Data.OpenFileContents(SourceFileID);
				var DestinationFileID = pEngine.Data.OpenFileInFolderByFullName(DestinationFolderID, i_FileName);
				var DestinationShareObject = pEngine.Data.OpenShareObjectByID(DestinationFileID).ShareObject;

				var SandboxID = GrooveRunTimeData.g_SandboxID;
				var VersionID = GetFileVersionID(SandboxID, DestinationFileID);
				var NewVersionID = pEngine.ReplaceFile2(DestinationShareObject.ID, DestinationFolderID, DestinationShareObject.DisplayName, DestinationShareObject.FullName, BIS, cNull, VersionID, "", true);
				BIS.Close();
			}
		}

		function RenameDatabaseFileFromSandbox(i_ShareObject, i_FileName)
		{
			var pEngine = GrooveRunTimeData.g_DocumentShareEngine;

			var DestinationFolderID = OpenSandboxParentID();

			if (pEngine.Data.DoesFileExistInFolderByFullName(DestinationFolderID, i_FileName))
			{
				var DestinationFileID = pEngine.Data.OpenFileInFolderByFullName(DestinationFolderID, i_FileName);
				pEngine.RenameShareObject(DestinationFileID, i_ShareObject.DisplayName, true);
			}
		}

		function GetFileVersionID(i_SandboxID, i_ObjectID)
		{
			try
			{
				// Get the files version id from the version log.
				var pEngine = GrooveRunTimeData.g_DocumentShareEngine;
				var pFileExists = pEngine.Data.DoesFileExistInFolderByFullName(i_SandboxID, "VersionInfo.ver");
				if (pFileExists)
				{
					if (GrooveRunTimeData.g_VersionInfoRootElement == null)
					{
						/      ®  / Get the root element from the file since it already exists.
						var pVerFileID = pEngine.Data.OpenFileInFolderByFullName(i_SandboxID, "VersionInfo.ver");
						var pByteInputStream = pEngine.Data.OpenFileContents(pVerFileID);
						var pRootElement = CreateTemporaryRootElementFromStream(pByteInputStream);
						pByteInputStream.Close();
						GrooveRunTimeData.g_VersionInfoRootElement = pRootElement;
					}

					if (GrooveRunTimeData.g_VersionInfoRootElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Version", "DBObjectID", i_ObjectID))
					{
						var pVerElement = GrooveRunTimeData.g_VersionInfoRootElement.OpenContentElementByNameAndAttribute("urn:groove.net:Version", "DBObjectID", i_ObjectID);
						if (pVerElement.DoesAttributeExist("DBObjectVer"))
							return pVerElement.OpenAttribute("DBObjectVer");
					}
				}
				return null;
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, "Error getting verison info for file with ID: " + i_ObjectID);
				return null;
			}
		}

		function int_OpenParentName()
		{
			var pShareObject = GrooveRunTimeData.g_DocumentShareEngine.Data2.OpenShareObjectByID(OpenParentID());
			return pShareObject.ShareObject.FullName;
		}

		function int_OpenParentID()
		{
			var ParentID = GrooveRunTimeData.g_DocumentShareEngine.Data2.OpenParentFolderID(GrooveRunTimeData.g_SandboxID);
			return ParentID;
		}
	    bject)
			{
			}

			function OnAfterProcessConflictingCommand(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnCheckParentFolder(i_pIEngine, i_pIExecutionContext, i_ParentFolderID, i_ShareObjectID)
			{
			}

			function OnBeforeMoveShareObject(i_pIEngine, i_pIExecutionContext, i_SourceParentFolderID, i_DestinationParentFolderID, i_pIShareObject)
			{
			}

			function OnAfterMoveShareObject(i_pIEngine, i_pIExecutionContext, i_SourceParentFolderID, i_DestinationParentFolderID, i_pIShareObject)
			{
			}

			function OnResolveShareObjectFullNameConflict(i_pIEngine, i_pIExecutionContext, i_ParentFolderID, i_pINewShareObject, i_pIExistingShareObject, i_FullName, i_ExistingShareObjectWins, io_pIContinueOperationExecution, io_pIResolvedFullName)
			{
				// Not resolving share object full name conflict - allow default processing
				return false;
			}

		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            —§    î           ÄSCRIPTINTERFACE       ÄLIBIDL   { 6 5 D 4 8 B 8 E - E 9 A 4 - 4 9 1 a - B B D 4 - 0 5 5 8 3 D 7 9 B 1 D 7 }   	   ÄIIDL   { 8 8 0 1 3 8 0 F - 3 F 5 6 - 4 9 1 8 - A 5 6 D - 8 F E F F E 1 F 4 C 8 2 }   	   ÄName4   I G r o o v e F o r m s S a n d b o x P r i v a t e         Ä
		function InitializeSandbox(i_Sandbox, i_DocumentShareEngine, i_PropertyList, i_pIFormsToolDataModel, i_MetaDataTable, i_pIFormsToolDataModelPrivate)
		{
			GrooveRunTimeData.g_SandboxFullName = i_Sandbox.FullName;
			GrooveRunTimeData.g_SandboxID = i_Sandbox.ID;
			GrooveDebugFunctions.DisplayAssert(typeof i_DocumentShareEngine != "undefined", "Error initializing sandbox");
			GrooveRunTimeData.g_DocumentShareEngine = i_DocumentShareEngine;
			GrooveRunTimeData.g_PropertyList = i_PropertyList;

			var TelespaceCanonicalURL = GrooveRunTimeData.g_PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE).OpenCanonicalURL();

			// set up global variables in the GrooveRunTimeData
			GrooveRunTimeData.g_Telespace = GrooveRunTimeData.g_PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
			GrooveRunTimeData.g_CrossProcessSemaphore = GrooveRunTimeData.g_Telespace.CrossProcessSemaphore;
			GrooveRunTimeData.g_TelespaceURLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.TelespaceURLSyntax");
			GrooveRunTimeData.g_TelespaceGUID = GrooveRunTimeData.g_TelespaceURLSyntax.ParseCanonicalURL(TelespaceCanonicalURL);
			GrooveRunTimeData.g_ToolName = i_PropertyList.OpenProperty(PROPERTY_TOOL_NAME);
			GrooveRunTimeData.g_SOFTPKGPrefix = "net.groove.Groove.Forms";
			GrooveRunTimeData.g_CurrentTool = i_PropertyList.OpenProperty(PROPERTY_TOOL);
			GrooveRunTimeData.g_FormsToolDataModel = i_pIFormsToolDataModel;
			GrooveRunTimeData.g_FormsToolDataModelPrivate = i_pIFormsToolDataModelPrivate;
			GrooveRunTimeData.g_MetaDataTable = i_MetaDataTable;
			GrooveRunTimeData.g_DynMgr = i_PropertyList.OpenPropertyAsIUnknown(PROPERTY_DYNAMICS_MANAGER);
			ScriptHostComponent.Advise(GrooveRunTimeData.g_DocumentShareEngine, "{224467B1-B2B1-4023-BB30-98192CD4E2CA}");
		}

		function ShutdownSandbox()
		{
			if (!GrooveRunTimeData.HasItem("g_IsTerminated"))
			{
				// Terminate our sb object cache
				var pSBObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "SandboxCache");
				ShutdownCache(pSBObjectCache, priv_ShutdownSandboxCacheProc);

				ScriptHostComponent.Unadvise(GrooveRunTimeData.g_DocumentShareEngine, "{224467B1-B2B1-4023-BB30-98192CD4E2CA}");
				
				GrooveRunTimeData.RemoveAllItems();	
				GrooveRunTimeData.g_IsTerminated = true;
			}	
		}

		function GetIsSandbox()
		{
			return true;
		}

		function OpenParentName()
		{
			var ParentName = int_OpenParentName();
			return ParentName;
		}

		function OpenParentID()
		{
			var ParentID = int_OpenParentID();
			return ParentID;
		}

		function OpenToolObject()
		{
			var CPSem = GrooveRunTimeData.g_CrossProcessSemaphore;
			CPSem.DoLock();
			// First get the tool's file and get the BIS so that we can create an element and 
			// find what we need, update it, then save the file back.
			try
			{
				var pToolObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "ToolObject_ObjectCache");
				if (IsObjectInCache("RootElement", pToolObjectCache))
				{
					CPSem.DoUnlock();
					return pToolObjectCache;	
				}
				else
				{
					// Have to use the parent database name as that is the name of the dis file.
					var DatabaseName = int_OpenParentName();
					var ToolFileName = DatabaseName + ".dis";

					if (!DoesDatabaseObjectExistByFullName(ToolFileName))
					{
						CPSem.DoUnlock();
						return GrooveScriptFunctions.CreateNewObject("");
					}
					else
					{
						var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
						try
						{
							var pDatabaseObject = null;							
							pDatabaseObject = OpenDatabaseObjectByFullName(ToolFileName);				

							if (pDatabaseObject != null)
							{
								var pByteInputStream = pDatabaseObject.OpenByteInputStr      ∏  eam();
								GrooveRunTimeData.g_ToolObjectVersionID = pDatabaseObject.DatabaseObjectVersionID;
							}
							else
								GrooveDebugFunctions.DisplayAssert(0, "Error getting Tool object from database or sandbox");

							Transaction.Commit();
						}
						catch (error)
						{
							Transaction.Abort();
							GrooveDebugFunctions.DisplayAssert(0, error.description);
						}

						var pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
						var pTmpDocument = pSM.CreateTemporaryXMLDocument("TmpTool", GetFormsDesignerToolTemplateSchemaURI());
						//var pTmpDocument = pSM.CreateTemporaryXMLDocument("TmpTool", "grooveDocument:///GrooveXSS/$UserRoot/Schemas.xss/GrooveFormsDesignerToolTemplateSchema.xml");
						var pTmpRootElement = pTmpDocument.OpenRootElement();
						pTmpRootElement.Delete();

						try
						{
							var pNewRootElement = pTmpDocument.CreateElementFromStream(pByteInputStream, GrooveParseOption_Default | GrooveParseOption_StripContentWhitespace);
							pByteInputStream.Close();
						}
						catch(error)
						{
							GrooveDebugFunctions.DisplayAssert(0, "You received the following error opening the tool: "+error.description);
							pByteInputStream.Close();
							CPSem.DoUnlock();
							return null;
						}

						pTmpDocument.SetRootElement(pNewRootElement);
						pTmpRootElement = pTmpDocument.OpenRootElement();

						pToolObjectCache.ToolFileName = ToolFileName;
						pToolObjectCache.DatabaseID = GetDatabaseID();
						pToolObjectCache.XMLDocument = pTmpDocument;
						pToolObjectCache.RootElement = pTmpRootElement;
						pToolObjectCache.VersionID = pDatabaseObject.DatabaseObjectVersionID;

						CPSem.DoUnlock();
						return pToolObjectCache;
					}
				}
			}
			catch(error)
			{
				CPSem.DoUnlock();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function UpdateToolFile(i_FileName, i_Element)
		{
			try
			{
				var BIS = i_Element.Serialize(GrooveSerializeType_XML, GrooveCharEncodingType_UTF8, GrooveSerializeOption_ConvertLFToCRLF | GrooveSerializeOption_NoProlog | GrooveSerializeOption_NoFragmentWrapper);
				ReplaceDatabaseObjectByFullName(i_FileName, BIS, GrooveRunTimeData.g_ToolObjectVersionID);
				var pToolObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "ToolObject_ObjectCache");
				pToolObjectCache.RemoveAllItems();
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, error.description);
			}
		}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              3
           ÄSCRIPT         y Ä

			/************************************************************************************************/
			//																								//
			//							DocumentShare Synchronus Sinks										//
			//																								//
			/************************************************************************************************/
			
			function OnBeforeBrowseFolder(i_pEngine, i_pIExecutionContext, i_pShareObject)
			{
			}
			
			function OnAfterBrowseFolder(i_pEngine, i_pIExecutionContext, i_pShareObject)
			{
			}

			function OnBeforeFolderViewStyleChanged(i_pEngine, i_pIExecutionContext, i_pShareObject, i_ViewStyle)
			{
			}

			function OnAfterFolderViewStyleChanged(i_pEngine, i_pIExecutionContext, i_pShareObject, i_ViewStyle)
			{
			}

			function OnBeforeAddShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnAfterAddShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
	
			}

			function OnBeforeDeleteShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnAfterDeleteShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
				var pDBObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "SandboxCache");
				if (IsObjectInCache(i_pShareObject.ShareObject.ID, pDBObjectCache))
				{
					var Object = OpenObjectFromCache(i_pShareObject.ShareObject.ID, pDBObjectCache);
					Object.IGrooveFormsDatabaseObjectPrivate.OutOfDate = true;
				}
			}

			function OnBeforeReplaceShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnAfterReplaceShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
				var pDBObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "SandboxCache");
				if (IsObjectInCache(i_pShareObject.ShareObject.ID, pDBObjectCache))
				{
					var Object = OpenObjectFromCache(i_pShareObject.ShareObject.ID, pDBObjectCache);
					Object.IGrooveFormsDatabaseObjectPrivate.OutOfDate = true;
					if (Object.DatabaseObjectType == GrooveFormsDatabaseObjectType_ToolDisseminator)
					{
						var pToolObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "ToolObject_ObjectCache");
						pToolObjectCache.RemoveAllItems();
					}	
				}		
			}

			function OnBeforeRenameShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{

			}

			function OnAfterRenameShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
				var pDBObjectCache = OpenCacheFromRunTimeData(GrooveRunTimeData, "SandboxCache");
				if (IsObjectInCache(i_pShareObject.ShareObject.ID, pDBObjectCache))
				{
					var Object = OpenObjectFromCache(i_pShareObject.ShareObject.ID, pDBObjectCache);
					Object.IGrooveFormsDatabaseObjectPrivate.OutOfDate = true;
				}	
			}

			function OnBeforeFolderViewSortChange(i_Engine, i_pIExecutionContext, i_pShareObject, i_SortColumn, i_SortType)
			{
			}

			function OnAfterFolderViewSortChange(i_Engine, i_pIExecutionContext, i_pShareObject, i_SortColumn, i_SortType)
			{
			}

			function OnBeforeChangeLastModifiedTime(i_Engine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnAfterChangeLastModifiedTime(i_Engine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnBeforeChangeFileContents(i_Engine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnAfterChangeFileContents(i_Engine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnBeforeAddConflictShareObject(i_Engine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}

			function OnAfterAddConflictShareObject(i_pEngine, i_pIExecutionContext, i_ParentFolderID, i_pShareObject)
			{
			}
			function OnBeforeProcessConflictingCommand(i_Engine, i_pIExecutionContext, i_ParentFolderID, i_pShareO                      @            Ñ  X	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        `	               Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName>   G r o o v e F o r m s S c r i p t C o d e O b j e c t . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPTINTERFACE    ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n         O p e n  ÄSCRIPT         ü  Ä
		function FinalConstruct()
		{
			GrooveRunTimeData.FileName = "";
			GrooveRunTimeData.FileLanguage = "";
			GrooveRunTimeData.ScriptCode = "";
		}
	
		}  ÄSCRIPTINTERFACE       ÄDefault   1     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }       ÄIIDL   { 3 F F F A 1 C 9 - 7 1 5 D - 4 a 2 0 - 9 2 5 3 - 5 3 8 F 0 2 C D 2 B 9 3 }       ÄName,   I G r o o v e F o r m s S c r i p t C o d e        ˚ Ä
		function GetName()
		{
			return GrooveRunTimeData.FileName;
		}

		function PutName(i_Name)
		{
			GrooveRunTimeData.FileName = i_Name;
		}

		function GetLanguage()
		{
			return GrooveRunTimeData.FileLanguage;
		}

		function PutLanguage(i_Language)
		{
			GrooveRunTimeData.FileLanguage = i_Language;
		}

		function PutScript(i_ScriptCode)
		{
			GrooveRunTimeData.ScriptCode = i_ScriptCode;
		}

		function GetScript()
		{
			return GrooveRunTimeData.ScriptCode;
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  §&   D∫    å i     ÿ          )      ÄSCRIPT          ± Ä

		function ApplyViewChanges(i_FieldsToRemoveEnum, i_FieldsToAddEnum, i_bIncludeGridLines, i_bShowUnread, i_bFillScreenWithView, i_Width, i_Height)
		{
			var Delta = GrooveRunTimeData.g_pDynMgr.CreateDelta();
			// Get the various elements which contain the fields we're adding
			// The g_pCurrentFormRootElement == <HTML> element
			var IncludeGridLines = 0;
			var ShowUnread = 0;
			var FillScreenWithView = 0;
			if (i_bIncludeGridLines)
				IncludeGridLines = 1;

			if (i_bShowUnread)
				ShowUnread = 1;

			if (i_bFillScreenWithView)
				FillScreenWithView = 1;
			var pHeadElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("HEAD");
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
			var CurrentFormFieldArray = pCurrentFormFieldListElement.OpenAttribute("names").split(",");
			// The Form element is contained by the Body element
			var pFormElement = pBodyElement.OpenContentElementByName("FORM");
			// We need to hand this to RemoveFieldFromView.
			var ToolObj = int_OpenToolObject();

			var ViewName = GetViewName();

			// First handle which fields are unchecked.  If we find any unchecked fields in the list
			// which are in the GROOVEFORMFIELDS list, remove them.
			var RemoveFlag = false;
			while (i_FieldsToRemoveEnum.HasMore())
			{
				var pIField = GrooveRunTimeData.g_pIFormsDesigner.OpenFormsFieldByName(i_FieldsToRemoveEnum.OpenNext());
				var bIsKnownField = IsInArray(CurrentFormFieldArray, pIField.FieldName);
				if (bIsKnownField == true)
				{
					// First remove the field from the GrooveFormFields element names attribute
					var strNames = pCurrentFormFieldListElement.OpenAttribute("names");
					var NamesArray = strNames.split(",");
					var j = 0;
					var jCount = NamesArray.length;
					while (j < jCount)
					{
						if (pIField.FieldName == NamesArray[j])
						{
							delete NamesArray[j];
							NamesArray = CompressArray(NamesArray, j);
							break;
						}
						j++;
					}
					var strNewNames = NamesArray.join(",");
					pCurrentFormFieldListElement.SetAttribute("names", strNewNames);
					
					// Now need to remove the field from the view's tool.
					int_RemoveFieldFromView(pIField, ViewName, false, ToolObj);
					RemoveFlag = true;
				}	
			}

			// If we've removed a field we need to reset the CurrentFormFieldArray so that the
			// IsFieldInArray is accurate when checking for checked fields.
			if (RemoveFlag)
			{
				var CurrentFormFieldNames = pCurrentFormFieldListElement.OpenAttribute("names");
				if (CurrentFormFieldNames == "" || CurrentFormFieldNames == ",")
					CurrentFormFieldArray = new Array();
				else
					CurrentFormFieldArray = CurrentFormFieldNames.split(",");
			}

			// We need to check to see if the elements below are still valid; if not, reaquire them
			if (pHeadElement.IsValid() == false)
			{
				// Get the various elements which contain the fields we're adding
				// The g_pCurrentFormRootElement == <HTML> element
				var pHeadElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("HEAD");
				var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
				// The Form element is contained by the Body element
				var pFormElement = pBodyElement.OpenContentElementByName("FORM");
			}

			// add the onload attribute to the body tag
			if (!pBodyElement.DoesAttributeExist("ONLOAD"))
				pBodyElement.SetAttribute("ONLOAD", "initDataList(); addDocument();");
			if (!pBodyElement.DoesAttributeExist("ONBEFOREUNLOAD"))
				pBodyElement.SetAttribute("ONBEFOREUNLOAD", "removeDocument();");

			// We should add the view control buttons if they do not exist already.
			if (!pFormElement.ContentElementWithNameAndAttributeExists("DIV", "ID", "divViewNavBase"))
			{
				// First get the instance.
				var ViewDIVElement =  GetMetaDataContentByName(GrooveRunTimeData.g_MetaDataTable, "ViewNavBase", GrooveMetaData_ContentElement);
				// Next make a copy of it and root the copy to the form element.
				pFormElement.CreateElementCopy(ViewDIVElement, pFormElement);
			}

			// Now that we've removed all of the fields which should have been unchecked we can
			// add the checked.
			var bIsAuthorInView = false;
			while (i_FieldsToAddEnum.HasMore())
			{
				var FieldName = i_FieldsToAddEnum.OpenNext();
				if (GrooveRunTimeData.g_pIFormsDesigner.DoesFormsFieldExist(FieldName))
				{
					var pIField = GrooveRunTimeData.g_pIFormsDesigner.OpenFormsFieldByName(FieldName);
					
					if (!pIField.Persistable && pIField.FieldType!= "SystemField")
						continue;

					var bIsKnownField = IsInArray(CurrentFormFieldArray, pIField.FieldName);
					if (bIsKnownField)
					{
						// In case there is an update to the field properties
						// remove the field from the view first, then readd it.
						// This is an opportunity for a performance enhancement
						// since it updates the tool file when this is called.
						int_RemoveFieldFromView(pIField, ViewName, true, ToolObj);
						// Remove the field from the CurrentFormFieldArray and from the 
						// GROOVEFORMFIELDS element (pCurrentFormFieldListElement).
						GrooveRunTimeData.g_pIFormsDesignerPrivate.RemoveFieldFromCurrentFormFieldArray(pIField.FieldName, GrooveRunTimeData.g_pCurrentFormRootElement, false);
						// Remove the field from the field name array.
						RemoveArrayValue(CurrentFormFieldArray, pIField.FieldName);
					}

					if (pCurrentFormFieldListElement.DoesAttributeExist("names"))
						var CurrentList = pCurrentFormFieldListElement.OpenAttribute("names");
					else
						CurrentList = "";

					if (CurrentList == "")
						CurrentList = pIField.FieldName;
					else
						CurrentList += ("," + pIField.FieldName);
					pCurrentFormFieldListElement.SetAttribute("names", CurrentList);
					CurrentFormFieldArray[CurrentFormFieldArray.length] = pIField.FieldName;
					var pFieldElement = pIField.IGrooveFormsFieldPrivate.FieldElement;
					var ContentCount = 0;
					if (pFieldElement.ContentElementWithNameExists("urn:groove.net:ColumnProperties"))
					{
						var pColumnPropertiesElement = pFieldElement.OpenContentElementByName("urn:groove.net:ColumnProperties");
						ContentCount = pColumnPropertiesElement.GetContentCount();
					}
					if (ContentCount == 0)
					{
						var FieldsToAddEnumCopy = i_FieldsToAddEnum;
						FieldsToAddEnumCopy.Reset();
						var DefaultCount = 0;
						var CustomTotal = 0;
						var PixelTotal = 0;
						var TotalCount = 0;
						while (FieldsToAddEnumCopy.HasMore())
						{
							var FieldNameCopy = FieldsToAddEnumCopy.OpenNext();
							if (GrooveRunTimeData.g_pIFormsDesigner.DoesFormsFieldExist(FieldNameCopy))
							{
								var pIField1 = GrooveRunTimeData.g_pIFormsDesigner.OpenFormsFieldByName(FieldNameCopy);
								var CP = GrooveRunTimeData.g_pIFormsDesignerPrivate.OpenColumnPropertiesPriv(ViewName, pIField1.FieldName);
								if (CP == null || CP.IGrooveFormsFieldColumnPropertiesPrivate.Custom == false)
									DefaultCount++;
								else if (CP.ColumnWidthStyle == GrooveFormsColumnWidthStyle_Percent)
									CustomTotal += parseInt(CP.ColumnWidth);
								else if (CP.ColumnWidthStyle == GrooveFormsColumnWidthStyle_Pixels)
									PixelTotal += parseInt(CP.ColumnWidth);
								TotalCount++;
							}
						}

						pIField.SetDefaultColumnPropertiesForView(ViewName);
						// RSSToDo: MUST LEAVE THIS IN THE UI.
						//ShowColumnProperties(index);	
					}
					// Need to now add the xml to the tool so that the correct columns get added
					AddFieldToView(ToolObj, pIField, ViewName, true, -1);

					// Check to see if the Author column has been added to this view.
					if (pIField.FieldName == "_CreatedBy")
						bIsAuthorInView = true;
				}
			}

			// If the author column is not in the view, we need to readd it at the end and hide it.
			if (!bIsAuthorInView)
			{
				// First we need to see if it is in the view already and delete it if it is
				// 1.  Get the fieldinstance for the _CreatedBy field.
				var pIField = GrooveRunTimeData.g_pIFormsDesigner.OpenFormsFieldByName("_CreatedBy");
				int_RemoveFieldFromView(pIField, ViewName, true, ToolObj);
				GrooveRunTimeData.g_pIFormsDesignerPrivate.RemoveFieldFromCurrentFormFieldArray(pIField.FieldName, GrooveRunTimeData.g_pCurrentFormRootElement, false);
				pIField.RemoveColumnProperties(ViewName);
				// 2. Set the default column properties
				//pIField.SetDefaultColumnPropertiesForView(ViewName);		
				var CP = pIField.IGrooveFormsFieldColumnPropertiesFactory.CreateColumnProperties(ViewName);
				CP.ColumnWidth = 1;
				CP.ColumnWidthStyle = GrooveFormsColumnWidthStyle_Pixels;
				CP.ColumnHeader = "";
				CP.ColumnName = pIField.FieldName;
				CP.IGrooveFormsFieldColumnPropertiesPrivate.CPElement.SetAttribute("Visible", "false");
				pIField.ApplyColumnProperties(CP);
				pIField.Commit();
				// 3. Now add the field to the view and make sure that it is hidden
				AddFieldToView(ToolObj, pIField, ViewName, false, -1);
			}

			AddRemoveUnreadColumnToView(ToolObj, ViewName, ShowUnread);
			// Set the current state into the forms field list
			pCurrentFormFieldListElement.SetAttributeAsLong("ShowUnread", ShowUnread);

			// Now that we're done adding and removing columns from the view, we need to see if they
			// wanted to add or remove gridlines.  If they did, we need to add/remove them here.
			
			AddRemoveGridLinesToView(ToolObj, ViewName, IncludeGridLines);
			// Set the current state into the forms field list
			pCurrentFormFieldListElement.SetAttributeAsLong("IncludeGridLines", IncludeGridLines);
			
			var ObjectElement = GetObjectElement();

			if (i_bFillScreenWithView)
			{
				ObjectElement.SetAttribute("width", "100%");
				ObjectElement.SetAttribute("height", "90%");
			}
			else
			{
				if (i_Width != 0)
					ObjectElement.SetAttribute("width", i_Width);
				else
					ObjectElement.SetAttribute("width", "100%");
				if (i_Height != 0)
					ObjectElement.SetAttribute("height", i_Height);
				else
					ObjectElement.SetAttribute("height", "90%");
			}
			ObjectElement.SetAttribute("gridlines", IncludeGridLines);
			ObjectElement.SetAttribute("stretch", FillScreenWithView);
			

			// Remove the view script element if it exists
			if (pHeadElement.ContentElementWithNameAndAttributeExists("SCRIPT", "NAME", "ViewScriptBase"))
			{
				var oldViewScriptElement = pHeadElement.OpenContentElementByNameAndAttribute("SCRIPT", "NAME", "ViewScriptBase");
				oldViewScriptElement.Delete();
			}
			// Get the script from the meta data
			var newViewScriptElement = GetMetaDataContentByName(GrooveRunTimeData.g_MetaDataTable, "ViewScriptBase", GrooveMetaData_ContentElement);
			// Next make a copy of it to the header element
			pHeadElement.CreateElementCopy(newViewScriptElement, pHeadElement);

			UpdateFormFile();
			// RSSToDo: Placed here for performance reasons instead of doing it when the column properties
			// get set.
			GrooveRunTimeData.g_pIFormsDesignerPrivate.UpdateFieldsFile();
			int_UpdateToolFile(ToolObj.ToolFileName, ToolObj.RootElement);
			GrooveRunTimeData.g_pDynMgr.DoDelta(Delta);
		}

		function int_RemoveFieldFromView(i_pIField, i_ViewName, i_bFieldToBeInView, ToolObj)
		{
			// For the moment, assume we are dealing with a DataList
			var pLocator = ToolObj.XMLDocument.CreateLocator();
			// First must find the correct HTMLComponent Element
			var strLocatorString = ".//urn:groove.net:HTMLComponent[@Name='"+ i_ViewName +"']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, ToolObj.RootElement);
			while (pElementEnum.HasMore())
			{
				var pHTMLComponentElement = pElementEnum.OpenNext();
				break;
			}

			if (typeof pHTMLComponentElement == "undefined")
				return;
			else
			{
				// Next check to see if an column element with the name exists
			
				var bHasSort = false;
				var strLocatorString;
				if (i_pIField.FieldType == "Attachments")
					strLocatorString = ".//urn:groove.net:Column[@Name='FileIcon']";
				else
					strLocatorString = ".//urn:groove.net:Column[@Name='" + i_pIField.FieldName + "']";
				var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pHTMLComponentElement);
				while (pElementEnum.HasMore())
				{
					var pColumnElement = pElementEnum.OpenNext();
					if (pColumnElement.ContentElementWithNameExists("urn:groove.net:ColumnSorts"))
					{
						var pColumnSortsElement = pColumnElement.OpenContentElementByName("urn:groove.net:ColumnSorts");
						if (pColumnSortsElement.ContentElementWithNameExists("urn:groove.net:ColumnSort"))
						{
							var ColumnSortEnum = pColumnSortsElement.OpenContentElementEnumByName("urn:groove.net:ColumnSort");
							while (ColumnSortEnum.HasMore())
							{
								var ColumnSortElement = ColumnSortEnum.OpenNext();
								var Order = ColumnSortElement.OpenAttribute("SortIcon");
								var SortName = "By" + Order + i_pIField.FieldName;
								if (SortName == ColumnSortElement.OpenAttribute("Name"))
								{
									GrooveRunTimeData.g_pIFormsDesignerPrivate.AddRemoveSortFromCollectionListPriv(false, SortName, null, null, null, ToolObj, null);
									bHasSort = true;
								}
							}
						}
					}

					pColumnElement.Delete();
				}
				
				if (!i_bFieldToBeInView)
				{
					// Now find the CollectionDataList so that we can delete the column there too.
					pLocator.Invalidate(false);
					var strLocatorString = ".//urn:groove.net:Component[@Name='CollectionDataList']";
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, ToolObj.RootElement);
					while (pElementEnum.HasMore())
					{
						var CollectionDataListElement = pElementEnum.OpenNext();
						break;
					}
					
					// Now that we have the CollectionDataListElement, we can use the locator again
					// to find the column itself.
					pLocator.Invalidate(false);
					var strLocatorString = ".//urn:groove.net:View[@Name='" + i_ViewName + "']";
					var pElementEnum = pLocator.OpenElementEnum(strLocatorString, CollectionDataListElement);
					while (pElementEnum.HasMore())
					{
						var pCollectionDataListViewElement = pElementEnum.OpenNext();
						// We know that the column should be a direct child of the view element
						if (pCollectionDataListViewElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Column", "Name", i_pIField.FieldName))
						{
							var pCollectionDataListColumnElement = pCollectionDataListViewElement.OpenContentElementByNameAndAttribute("urn:groove.net:Column", "Name", i_pIField.FieldName);
							pCollectionDataListColumnElement.Delete();
						}
					}
				}
			}
		}

		function AddFieldToView(ToolObj, i_pIField, i_ViewName, i_bIsVisible, i_Ordinal)
		{
			// For the moment, assume we are dealing with a DataList
			var pLocator = ToolObj.XMLDocument.CreateLocator();
			// First must find the correct HTMLComponent Element
			var strLocatorString = ".//urn:groove.net:HTMLComponent[@Name='" + i_ViewName + "']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, ToolObj.RootElement);
			while (pElementEnum.HasMore())
			{
				var pHTMLComponentElement = pElementEnum.OpenNext();
				break;
			}

			if (typeof pHTMLComponentElement == "undefined")
			{
				// If we've reached here it means that the component wasn't found.
				// We need to create it now and move on.....
				GrooveRunTimeData.g_pIFormsDesignerPrivate.AddRemoveHTMLComponentToToolPriv("DataList", i_ViewName, true);

				AddFieldToView(ToolObj, i_pIField, i_ViewName, i_bIsVisible, i_Ordinal);	
				return;
			}
			else
			{
				// Next get the correct column properties for this view.
				var ViewCP = i_pIField.OpenColumnProperties(i_ViewName);
				
				// Next check to see if an column element with the name exists
				var strLocatorString = ".//urn:groove.net:ColumnSet[@Name='" + i_ViewName + "']";
				var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pHTMLComponentElement);
				while (pElementEnum.HasMore())
				{
					var pDataListViewElement = pElementEnum.OpenNext();
					break;
				}
				
				// If we didn't find a View element this means that a view has not been created
				// we need to add the property and create the element so that we can add a column to it.
				if (typeof pDataListViewElement == "undefined")
				{
					var pPropertyListElement = pHTMLComponentElement.OpenContentElementByName("urn:groove.net:PropertyList");
					if (pPropertyListElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Property", "Name", "Views"))
						var pPropertyElement = pPropertyListElement.OpenContentElementByNameAndAttribute("urn:groove.net:Property", "Name", "Views");
					else
					{
						var pPropertyElement = pPropertyListElement.CreateElement("urn:groove.net:Property", pPropertyListElement);
						pPropertyElement.SetAttribute("Name", "ColumnSets");
					}

					var pPropertyValueElement = pPropertyElement.CreateElement("urn:groove.net:PropertyValue", pPropertyElement);
					// Now create the actual sort element
					var pDataListViewElement = pPropertyValueElement.CreateElement("urn:groove.net:ColumnSet", pPropertyValueElement);
					// Now set the default attributes
					pDataListViewElement.SetAttribute("Name", i_ViewName);
				}
				
				// Now that we have a View element, check to see if it contains a column with the same field
				if (!pDataListViewElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Column", "Name", i_pIField.FieldName))
				{
					CreateDataListColumn(pDataListViewElement, i_pIField, ViewCP, i_bIsVisible, ToolObj, i_Ordinal);
				}
				else
				{
					var pOldColumnElement = pDataListViewElement.OpenContentElementByNameAndAttribute("urn:groove.net:Column", "Name", i_pIField.FieldName);
					pOldColumnElement.Delete();
					CreateDataListColumn(pDataListViewElement, i_pIField, ViewCP, i_bIsVisible, ToolObj, i_Ordinal);	
				}
				
				// Add columns to the Collection Data List component too.
				pLocator.Invalidate(false);
				var strLocatorString = ".//urn:groove.net:Component[@Name='CollectionDataList']";
				var pElementEnum = pLocator.OpenElementEnum(strLocatorString, ToolObj.RootElement);
				while (pElementEnum.HasMore())
				{
					var CollectionDataListElement = pElementEnum.OpenNext();
					var pPropertyListElement = CollectionDataListElement.OpenContentElementByName("urn:groove.net:PropertyList");
					var pSortsPropertyElement = pPropertyListElement.OpenContentElementByNameAndAttribute("urn:groove.net:Property", "Name", "Views");
					var pPropertyValueElement = pSortsPropertyElement.OpenContentElementByName("urn:groove.net:PropertyValue");
					var pCollectionViewElement;
					if (!pPropertyValueElement.ContentElementWithNameAndAttributeExists("urn:groove.net:View", "Name", i_ViewName))
					{
						pCollectionViewElement = pPropertyValueElement.CreateElement("urn:groove.net:View", pPropertyValueElement);
						pCollectionViewElement.SetAttribute("Name", i_ViewName);
						pCollectionViewElement.SetAttribute("DefaultSort", "ByOrdinal");
					}
					else
						pCollectionViewElement = pPropertyValueElement.OpenContentElementByNameAndAttribute("urn:groove.net:View", "Name", i_ViewName);

					if (pCollectionViewElement)
					{
						if (i_pIField.FieldType != "Attachments")
						{
							if (!pCollectionViewElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Column", "Name", i_pIField.FieldName))
							{
								var pCollectionColumnElement = pCollectionViewElement.CreateElement("urn:groove.net:Column", pCollectionViewElement);
								pCollectionColumnElement.SetAttribute("Name", i_pIField.FieldName);
								pCollectionColumnElement.SetAttribute("SourceField", i_pIField.FieldName);
								if (i_pIField.DataType == GrooveFormsFieldDataType_Number)
									pCollectionColumnElement.SetAttribute("DataType", "Double");
								else if (i_pIField.DataType == GrooveFormsFieldDataType_Date)
									pCollectionColumnElement.SetAttribute("DataType", "DateTime");
								else
									pCollectionColumnElement.SetAttribute("DataType", "String");
							}
						}
						else
						{
							if (!pCollectionViewElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Column", "Name", "FileIcon"))
							{
								var pCollectionColumnElement = pCollectionViewElement.CreateElement("urn:groove.net:Column", pCollectionViewElement);
								pCollectionColumnElement.SetAttribute("Name", "FileIcon");
								pCollectionColumnElement.SetAttribute("SourceField", "FileIcon");
								pCollectionColumnElement.SetAttribute("DataType", "Long");
							}
						}

					}
					else
						GrooveDebugFunctions.DisplayAssert(0, "Error getting View element.");
				}
			}
		}

		function CreateDataListColumn(pDataListViewElement, i_pIField, i_ViewCP, i_bIsVisible, i_ToolObj, i_Ordinal)
		{
			var pColumnElement;
			if (typeof i_Ordinal == "undefined" || i_Ordinal == -1)
				pColumnElement = pDataListViewElement.CreateElement("urn:groove.net:Column", pDataListViewElement);
			else
			{
				var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
				try
				{
					pColumnElement = pDataListViewElement.CreateElement("urn:groove.net:Column", GrooveScriptFunctions.CreateNewObject(""));
					pDataListViewElement.InsertContentElement(i_Ordinal, pColumnElement);
					Transaction.Commit();
				}
				catch(error)
				{
					Transaction.Abort();
					GrooveDebugFunctions.DisplayAssert(0, error.description);
					GrooveErrorFunctions.SetCurrentError(error.number, error.description);
				}
			}
		
			if (i_pIField.FieldType != "Attachments")
			{
				pColumnElement.SetAttribute("Name", i_pIField.FieldName);
				pColumnElement.SetAttribute("Label", i_ViewCP.ColumnHeader);
				pColumnElement.SetAttribute("Width", i_ViewCP.ColumnWidth + GetColumnWidthStyleStringFromEnumValue(i_ViewCP.ColumnWidthStyle));
			}
			else
			{
				pColumnElement.SetAttribute("Name", "FileIcon");
				pColumnElement.SetAttribute("Label", "");
				pColumnElement.SetAttribute("Width", "18");
			}
			pColumnElement.SetAttribute("ReadOnly", i_ViewCP.IGrooveFormsFieldColumnPropertiesPrivate.ReadOnly);
			
			// The following is now expressed through a format string.
			//pColumnElement.SetAttribute("Precision", i_ViewCP.Precision);
			var ShowTwisty = "False";
			if (i_ViewCP.ShowTwisty)
				ShowTwisty = "True";
		
			pColumnElement.SetAttribute("ShowTwisty", ShowTwisty);
			if (i_ViewCP.ShowTwisty)
				pColumnElement.SetAttribute("Indent", 15);
			else
				pColumnElement.SetAttribute("Indent", 0);

			// Instead of data types we need to add a display type
			var pColumnDisplayElement = pColumnElement.CreateElement("urn:groove.net:ColumnDisplay", pColumnElement);
			if (i_pIField.DataType == GrooveFormsFieldDataType_Date)
				pColumnDisplayElement.SetAttribute("Type", "DateTime");
			else if (i_pIField.DataType == GrooveFormsFieldDataType_Number)
				pColumnDisplayElement.SetAttribute("Type", "Number");
			else if (i_pIField.FieldType == "Attachments")
				pColumnDisplayElement.SetAttribute("Type", "Icon");
			else 
				pColumnDisplayElement.SetAttribute("Type", "String");

			if (i_pIField.DataType == GrooveFormsFieldDataType_Number || i_pIField.DataType == GrooveFormsFieldDataType_Date)
			{
				var BaseFormatString = "";
				var pDisplayFormatElement = pColumnDisplayElement.CreateElement("urn:groove.net:DisplayFormat", pColumnDisplayElement);
				if (i_pIField.DataType == GrooveFormsFieldDataType_Number)
				{
					var PrecisionString = "";
					if (i_ViewCP.Precision > 0)
					{
						PrecisionString += ".";
						var i = 0;
						var iCount = i_ViewCP.Precision;
						while (i < iCount)
						{
							PrecisionString += "0";
							i++;
						}
					}

					if (i_pIField.TypeDisplayName == "Currency")
					{
						var CurrencySymbol = "\u00A4";
						var ContentElementEnum = i_pIField.HTMLElement.OpenContentElementEnum();
						while (ContentElementEnum.HasMore())
						{
							var Element = ContentElementEnum.OpenNext();
							if (Element.DoesAttributeExist("SYMBOL"))
							{
								CurrencySymbol = "'" + Element.OpenAttribute("SYMBOL") + "'";
								break;
							}
							else
							{
								var InnerElementEnum = Element.OpenContentElementEnum();
								while (InnerElementEnum.HasMore())
								{
									var InnerElement = InnerElementEnum.OpenNext();
									if (InnerElement.DoesAttributeExist("SYMBOL"))
									{
										CurrencySymbol = "'" + InnerElement.OpenAttribute("SYMBOL") + "'";
										break;
									}
								}
							}
						}
						// This looks confusing, but it will end up creating a string like this:
						// "'$'#,##0.00;('$'#,##0.00)". The section before the semicolon is for
						// positive values, after the semicolon is for negative values.
						BaseFormatString = CurrencySymbol + "#,##0" + PrecisionString + ";(" + CurrencySymbol + "#,##0" + PrecisionString + ")";
					}
					else
					{
						var FormatCancel = false;

						var pFieldElement = i_pIField.IGrooveFormsFieldPrivate.FieldElement;
						var InputElementEnum = GetElementEnumByElementName(pFieldElement.OpenXMLDocument(), "INPUT", pFieldElement);
						while (InputElementEnum.HasMore())
						{
							var pInputElement = InputElementEnum.OpenNext();
							if (pInputElement.DoesAttributeExist("FrmtCancel") && pInputElement.OpenAttribute("FrmtCancel") != "")
							{
								FormatCancel = true;
								break;
							}
						}

						if (FormatCancel)
							BaseFormatString = "#0.######";
						else
							BaseFormatString = "#,##0" + PrecisionString;
					}
				}
				else if (i_pIField.DataType == GrooveFormsFieldDataType_Date)
				{
					// The format info should be an attribute somewhere in the ContentElement or its children.
					if (i_pIField.HTMLElement.DoesAttributeExist("FormatDateShortFormat") && i_pIField.HTMLElement.OpenAttribute("FormatDateShortFormat") != "")
						BaseFormatString = "short"
					else if (i_pIField.HTMLElement.DoesAttributeExist("FormatDateLongFormat") && i_pIField.HTMLElement.OpenAttribute("FormatDateLongFormat") != "")
						BaseFormatString = "full";
					else
					{
						var ContentElementEnum = i_pIField.HTMLElement.OpenContentElementEnum();
						while (ContentElementEnum.HasMore())
						{
							var Element = ContentElementEnum.OpenNext();
							if (Element.DoesAttributeExist("FormatDateShortFormat") && Element.OpenAttribute("FormatDateShortFormat") != "")
							{
								BaseFormatString = "short";
								break;
							}
							else if (Element.DoesAttributeExist("FormatDateLongFormat") && Element.OpenAttribute("FormatDateLongFormat") != "")
							{
								BaseFormatString = "full";
								break;
							}
							else
							{
								var InnerElementEnum = Element.OpenContentElementEnum();
								while(InnerElementEnum.HasMore())
								{
									var InnerElement = InnerElementEnum.OpenNext();
									if (InnerElement.DoesAttributeExist("FormatDateShortFormat") && InnerElement.OpenAttribute("FormatDateShortFormat") != "")
									{
										BaseFormatString = "short";
										break;
									}
									else if (InnerElement.DoesAttributeExist("FormatDateLongFormat") && InnerElement.OpenAttribute("FormatDateLongFormat") != "")
									{
										BaseFormatString = "full";
										break;
									}
								}

								if (BaseFormatString != "")
									break;
							}
						}
					}
				}

				pDisplayFormatElement.SetAttribute("Style", BaseFormatString);
			}
			else if (i_pIField.FieldType == "Attachments")
			{
				pIconDescElement = pColumnDisplayElement.CreateElement("urn:groove.net:IconDesc", pColumnDisplayElement);
				pIconDescElement.SetAttribute("Width", "16");
				pIconDescElement.SetAttribute("Height", "16");
				pIconDescElement.SetAttribute("ImageURL", "grooveFile:///ToolData\\groove.net\\GrooveForms\\FormsViewAttachmentIcons.jpg");
				pIconDescElement.SetAttribute("MaskURL", "grooveFile:///ToolData\\groove.net\\GrooveForms\\FormsViewAttachmentIconsMask.bmp");			
			}
			
			if (!i_bIsVisible)
				pColumnElement.SetAttribute("Visible", "false");


			// Now add the Display Sorts:
			if (i_ViewCP.SortOrder != GrooveFormsColumnSortOrder_Ordinal)
			{
				var SortOrder = GetColumnSortOrderStringFromEnumValue(i_ViewCP.SortOrder);
				var SortOrderArray = SortOrder.split(",");

				var IsHierarchical = true;
				if (i_ViewCP.SortType == GrooveFormsColumnSortType_Flat)
					IsHierarchical = false;

				var i = 0;
				var iCount = SortOrderArray.length;
				while (i < iCount)
				{
					// Only add this the first time through
					if (i == 0)
						var pColumnSortsElement = pColumnElement.CreateElement("urn:groove.net:ColumnSorts", pColumnElement);
					var SortName = "By" + SortOrderArray[i] + i_pIField.FieldName;
					if (!IsHierarchical)
						SortName += "Flat";
					var pColumnSortElement = pColumnSortsElement.CreateElement("urn:groove.net:ColumnSort", pColumnSortsElement);
					pColumnSortElement.SetAttribute("Name", SortName);
					pColumnSortElement.SetAttribute("SortIcon", SortOrderArray[i]);
					var DataType = "String";
					if (i_pIField.DataType == GrooveFormsFieldDataType_Date)
						DataType =  "DateTime";
					else if (i_pIField.DataType == GrooveFormsFieldDataType_Number)
						DataType = "Double";
					else if (i_pIField.FieldType == "Attachments")
						DataType = "Long";

					var IsTextView = false;
					if (i_pIField.FieldType == "TextView")
						IsTextView = true;

					var IsAttachments = false;
					if (i_pIField.FieldType == "Attachments")
						IsAttachments = true;
					
					GrooveRunTimeData.g_pIFormsDesignerPrivate.AddRemoveSortFromCollectionListPriv(true, pColumnSortElement.OpenAttribute("Name"), SortOrderArray[i], DataType, i_pIField.FieldName, i_ToolObj, IsTextView, IsAttachments, IsHierarchical);
					i++;
				}
			}
		}
		
		function AddRemoveUnreadColumnToView(ToolObj, i_ViewName, i_bAdd)
		{
			// GrooveDebugFunctions.DisplayAssert(0, "About to add/remove unread column");
			// Regardless of whether we're adding or removing we need to get the following:
			// For the moment, assume we are dealing with a DataList
			var pLocator = ToolObj.XMLDocument.CreateLocator();
			// First must find the correct HTMLComponent Element
			var strLocatorString = ".//urn:groove.net:HTMLComponent[@Name='" + i_ViewName + "']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, ToolObj.RootElement);
			while (pElementEnum.HasMore())
			{
				var pHTMLComponentElement = pElementEnum.OpenNext();
				break;
			}

			if (typeof pHTMLComponentElement == "undefined")
			{
				// If we've reached here it means that the component wasn't found.
				// We need to create it now and move on.....
				GrooveRunTimeData.g_pIFormsDesignerPrivate.AddRemoveHTMLComponentToToolPriv("DataList", i_ViewName, true);
				AddRemoveUnreadColumnToView(i_ViewName, i_bAdd);
				return;
			}
			else
			{
				
				// Next check to see if an column element with the name exists
				var strLocatorString = ".//urn:groove.net:ColumnSet[@Name='" + i_ViewName + "']";
				var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pHTMLComponentElement);
				while (pElementEnum.HasMore())
				{
					var pDataListViewElement = pElementEnum.OpenNext();
					break;
				}
				
				// If we didn't find a View element this means that a view has not been created
				// we need to add the property and create the element so that we can add a column to it.
				if (typeof pDataListViewElement == "undefined")
				{
					var pPropertyListElement = pHTMLComponentElement.OpenContentElementByName("urn:groove.net:PropertyList");
					if (pPropertyListElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Property", "Name", "ColumnSets"))
						var pPropertyElement = pPropertyListElement.OpenContentElementByNameAndAttribute("urn:groove.net:Property", "Name", "ColumnSets");
					else
					{
						var pPropertyElement = pPropertyListElement.CreateElement("urn:groove.net:Property", pPropertyListElement);
						pPropertyElement.SetAttribute("Name", "ColumnSets");
					}

					var pPropertyValueElement = pPropertyElement.CreateElement("urn:groove.net:PropertyValue", pPropertyElement);
					// Now create the actual sort element
					var pDataListViewElement = pPropertyValueElement.CreateElement("urn:groove.net:ColumnSet", pPropertyValueElement);
					// Now set the default attributes
					pDataListViewElement.SetAttribute("Name", i_ViewName);
				}
				
				// Now that we have a View element, check to see if it contains a column with the same field
				if (!pDataListViewElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Column", "Name", "_IsRead"))
				{
					if (i_bAdd)
					{
						var pColumnElement = pDataListViewElement.CreateElement("urn:groove.net:Column", GrooveScriptFunctions.CreateNewObject(""));
						pDataListViewElement.InsertContentElement(0, pColumnElement);
						pColumnElement.SetAttribute("Name", "_IsRead");
						pColumnElement.SetAttribute("Label", "");
						pColumnElement.SetAttribute("ReadOnly", "1");
						pColumnElement.SetAttribute("Width", "15");
						// Hack alert! The following two lines should be removed
						// when the DataList gets changed not to default the first column
						// to have an indent and show twisties
						pColumnElement.SetAttribute("ShowTwisty", "False");
						pColumnElement.SetAttribute("Indent", "0");
						// End Hack
						var pColumnDisplayElement = pColumnElement.CreateElement("urn:groove.net:ColumnDisplay", pColumnElement);
						pColumnDisplayElement.SetAttribute("Type", "Icon");
						pIconDescElement = pColumnDisplayElement.CreateElement("urn:groove.net:IconDesc", pColumnDisplayElement);
						pIconDescElement.SetAttribute("Width", "13");
						pIconDescElement.SetAttribute("Height", "13");
						pIconDescElement.SetAttribute("ImageURL", "grooveFile:///ToolData\\groove.net\\CommonData\\UnreadIconImages.jpg");
						pIconDescElement.SetAttribute("MaskURL", "grooveFile:///ToolData\\groove.net\\CommonData\\UnreadIconImagesMask.bmp");
						
						AddRemoveUnreadColumnFromCollectionDataListDataSource(i_ViewName, pLocator, ToolObj, i_bAdd);
					}
					else
						return;
				}
				else
				{
					if (!i_bAdd)
					{
						var pOldColumnElement = pDataListViewElement.OpenContentElementByNameAndAttribute("urn:groove.net:Column", "Name", "_IsRead");
						pOldColumnElement.Delete();
						AddRemoveUnreadColumnFromCollectionDataListDataSource(i_ViewName, pLocator, ToolObj, i_bAdd);									
					}
					else
						return;				
				}
			}
		}

		function AddRemoveUnreadColumnFromCollectionDataListDataSource(i_ViewName, pLocator, ToolObj, i_bAdd)
		{
			// Now need to add it to the CollectionDataList as the first column
			pLocator.Invalidate(false);
			var strLocatorString = ".//urn:groove.net:Component[@Name='CollectionDataList']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, ToolObj.RootElement);
			while (pElementEnum.HasMore())
			{
				var CollectionDataListElement = pElementEnum.OpenNext();
				var pPropertyListElement = CollectionDataListElement.OpenContentElementByName("urn:groove.net:PropertyList");
				var pSortsPropertyElement = pPropertyListElement.OpenContentElementByNameAndAttribute("urn:groove.net:Property", "Name", "Views");
				var pPropertyValueElement = pSortsPropertyElement.OpenContentElementByName("urn:groove.net:PropertyValue");
				var pCollectionViewElement;
				if (!pPropertyValueElement.ContentElementWithNameAndAttributeExists("urn:groove.net:View", "Name", i_ViewName))
				{
					pCollectionViewElement = pPropertyValueElement.CreateElement("urn:groove.net:View", pPropertyValueElement);
					pCollectionViewElement.SetAttribute("Name", i_ViewName);
					pCollectionViewElement.SetAttribute("DefaultSort", "ByOrdinal");
				}
				else
					pCollectionViewElement = pPropertyValueElement.OpenContentElementByNameAndAttribute("urn:groove.net:View", "Name", i_ViewName);

				if (pCollectionViewElement)
				{
					if (i_bAdd && !pCollectionViewElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Column", "Name", "_IsRead"))
					{
						var pCollectionColumnElement = pCollectionViewElement.CreateElement("urn:groove.net:Column", pCollectionViewElement);
						pCollectionColumnElement.SetAttribute("Name", "_IsRead");
						pCollectionColumnElement.SetAttribute("SourceField", "_IsRead");
						pCollectionColumnElement.SetAttribute("DataType", "Bool");
					}
					else if (!i_bAdd && pCollectionViewElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Column", "Name", "_IsRead"))
					{
						var pCollectionColumnElement = pCollectionViewElement.OpenContentElementByNameAndAttribute("urn:groove.net:Column", "Name", "_IsRead");
						pCollectionColumnElement.Delete();
					}

				}
				else
					GrooveDebugFunctions.DisplayAssert(0, "Error getting View element.");
			}
		}

		function AddRemoveGridLinesToView(ToolObj, i_ViewName, i_bAdd)
		{
			// For the moment, assume we are dealing with a DataList
			var pLocator = ToolObj.XMLDocument.CreateLocator();
			// First must find the correct HTMLComponent Element
			var strLocatorString = ".//urn:groove.net:HTMLComponent[@Name='" + i_ViewName + "']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, ToolObj.RootElement);
			while (pElementEnum.HasMore())
			{
				var pHTMLComponentElement = pElementEnum.OpenNext();
				break;
			}	
			
			if (typeof pHTMLComponentElement == "undefined")
			{
				GrooveDebugFunctions.DisplayAssert(0, "Can't find HTMLComponent in tool for view: " + i_ViewName);
				return;
			}

			// check to see if the Property GridLineDescriptor exists
			var strLocatorString = ".//urn:groove.net:Property[@Name='GridLines']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pHTMLComponentElement);
			if (pElementEnum.HasMore())
			{
				if (i_bAdd)
					return;
				else
				{
					while (pElementEnum.HasMore())
					{
						var pPropertyElement = pElementEnum.OpenNext();
						pPropertyElement.Delete();
					}
				}	
			}
			else
			{
				if (i_bAdd)
				{
					var pPropertyListElement = pHTMLComponentElement.OpenContentElementByName("urn:groove.net:PropertyList");
					var pPropertyElement = pPropertyListElement.CreateElement("urn:groove.net:Property", pPropertyListElement);
					pPropertyElement.SetAttribute("Name", "GridLines");
					var pPropertyValueElement = pPropertyElement.CreateElement("urn:groove.net:PropertyValue", pPropertyElement);
					pPropertyValueElement.CreateElementCopy(GetMetaDataContentByName(GrooveRunTimeData.g_MetaDataTable, "GridLinesBase", GrooveMetaData_ContentElement), pPropertyValueElement);
				}
				else
					return;
			}
		}


		function UpdateFormFile()
		{
			var pRootElement = GrooveRunTimeData.g_pCurrentFormRootElement;
			var BIS = pRootElement.Serialize(GrooveSerializeType_XML, GrooveCharEncodingType_UTF8, GrooveSerializeOption_ConvertLFToCRLF | GrooveSerializeOption_NoEmptyTags | GrooveSerializeOption_NoFragmentWrapper | GrooveSerializeOption_NoProlog | GrooveSerializeOption_WithFormatting);
			GrooveRunTimeData.g_pIFormsDesignerPrivate.UpdateFile(BIS, GrooveRunTimeData.g_DatabaseObject.DatabaseObjectID, GrooveRunTimeData.g_DatabaseObject.DatabaseObjectVersionID);
		}

		function AddColumnNameToView(i_pIField)
		{
			//var BIS = GrooveRunTimeData.g_DatabaseObject.OpenByteInputStream();
			var RootElement = GrooveRunTimeData.g_pCurrentFormRootElement;

			if (RootElement.ContentElementWithNameExists("BODY"))
			{
				var pBODYElement = RootElement.OpenContentElementByName("BODY");
				if (pBODYElement.ContentElementWithNameExists("GROOVEFORMFIELDS"))
				{
					FieldListElement = pBODYElement.OpenContentElementByName("GROOVEFORMFIELDS");
					if (FieldListElement.DoesAttributeExist("names"))
					{
						var FormFieldListString = FieldListElement.OpenAttribute("names");
						FormFieldListString+= ("," + i_pIField.FieldName);
						FieldListElement.SetAttribute("names", FormFieldListString);
					}
				}
			}			
		}

		function GetObjectElement()
		{
			var ViewName = GetViewName();
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			// The Form element is contained by the Body element
			var pFormElement = pBodyElement.OpenContentElementByName("FORM");
			// Get the document we're working on and create a locator
			var pXMLDocument = pFormElement.OpenXMLDocument();
			var pLocator = pXMLDocument.CreateLocator();
			// First check to see if a DIV element with the name exists
			var strLocatorString = ".//OBJECT[@id='" + ViewName + "']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pFormElement);
			// We check the enum to see if has any values.  If not it means that we need
			// to add the object tag for this view to the form.
			var ObjectElement;
			if (!pElementEnum.HasMore())
			{
				var MetaDataName = GetMetaDataNameByDisplayName("Data List", GrooveRunTimeData.g_MetaDataTable);
				GrooveDebugFunctions.DisplayAssert(MetaDataName!= "", "Error getting MetaDataName for view");
				ObjectElement = pFormElement.CreateElementCopy(GetMetaDataContentByName(GrooveRunTimeData.g_MetaDataTable, MetaDataName, GrooveMetaData_ContentElement), pFormElement);
				ObjectElement.SetAttribute("NAME", ViewName);
				ObjectElement.SetAttribute("id", ViewName);
			}
			else
				ObjectElement = pElementEnum.OpenNext();

			return ObjectElement;
		}

		function GetViewName()
		{
			var ViewName = GrooveRunTimeData.g_DatabaseObject.DatabaseObjectID;
			// If the database is a sandbox then get the real database object id for the view name.
			if (typeof GrooveRunTimeData.g_pDatabase.IGrooveFormsSandbox != "undefined")
			{
				ViewName = GrooveRunTimeData.g_pIFormsToolDataModelPrivate.OpenViewObjectIDFromVersionFile(GrooveRunTimeData.g_pDatabase.DatabaseID, ViewName, "SbObjectID", "DBObjectID");
				if (ViewName == null)
					ViewName = GrooveRunTimeData.g_pIFormsToolDataModelPrivate.NewDatabaseViewID;
			}

			return ViewName;
		}

		function GetOrdinalPosition(i_FieldName)
		{
			var ViewName = GetViewName();
			var ToolObj = int_OpenToolObject();
			
			// For the moment, assume we are dealing with a DataList
			var pLocator = ToolObj.XMLDocument.CreateLocator();
			// First must find the correct HTMLComponent Element
			var strLocatorString = ".//urn:groove.net:HTMLComponent[@Name='" + ViewName + "']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, ToolObj.RootElement);
			while (pElementEnum.HasMore())
			{
				var pHTMLComponentElement = pElementEnum.OpenNext();
				break;
			}

			if (typeof pHTMLComponentElement == "undefined")	
				return -1;
			
			// Next check to see if an column element with the name exists
			var strLocatorString = ".//urn:groove.net:ColumnSet[@Name='" + ViewName + "']";
			var pElementEnum = pLocator.OpenElementEnum(strLocatorString, pHTMLComponentElement);
			while (pElementEnum.HasMore())
			{
				var pDataListViewElement = pElementEnum.OpenNext();
				break;
			}
			
			// If we didn't find a View element this means that a view has not been created
			// we need to add the property and create the element so that we can add a column to it.
			if (typeof pDataListViewElement == "undefined")
				return -1;
								
			// Now that we have a View element, check to see if it contains a column with the same field
			if (!pDataListViewElement.ContentElementWithNameAndAttributeExists("urn:groove.net:Column", "Name", i_FieldName))
				return -1;
				
			var pColumnElement = pDataListViewElement.OpenContentElementByNameAndAttribute("urn:groove.net:Column", "Name", i_FieldName);
			var Ordinal = pColumnElement.GetOrdinal();
			return Ordinal;
		}

		function int_OpenToolObject()
		{
			var ToolObj;
			if (typeof GrooveRunTimeData.g_pDatabase.IGrooveFormsSandbox != "undefined")
				ToolObj = GrooveRunTimeData.g_pDatabase.IGrooveFormsSandboxPrivate.OpenToolObject();
			else
				ToolObj = GrooveRunTimeData.g_pDatabase.IGrooveFormsDatabasePrivate.OpenToolObject();
			return ToolObj;
		}

		function int_UpdateToolFile(i_FileName, i_Element)
		{
			if (typeof GrooveRunTimeData.g_pDatabase.IGrooveFormsSandbox != "undefined")
				ToolObj = GrooveRunTimeData.g_pDatabase.IGrooveFormsSandboxPrivate.UpdateToolFile(i_FileName, i_Element);
			else
				ToolObj = GrooveRunTimeData.g_pDatabase.IGrooveFormsDatabasePrivate.UpdateToolFile(i_FileName, i_Element);
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @           í  `  ì      î      ï  ê        Ö     Â±  Â±                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       h               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName&   G r o o v e F o r m s V i e w . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPTINTERFACE     ÄSCRIPTINTERFACE    ÄSCRIPT       ÄSRCD  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e F o r m s . G r o o v e F o r m s H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n    Y    o r y =  ÄSCRIPTINTERFACE       ÄLIBIDL   { 6 5 D 4 8 B 8 E - E 9 A 4 - 4 9 1 a - B B D 4 - 0 5 5 8 3 D 7 9 B 1 D 7 }   i   ÄIIDL   { 4 4 6 C E 2 6 E - 7 B 0 2 - 4 5 2 a - 9 B 1 A - 5 7 3 B F 7 F 0 4 6 3 D }   c   ÄName.   I G r o o v e F o r m s V i e w P r i v a t e      ¶
 Ä
		function InitializeView(i_pPropertyList, i_DatabaseObject, i_pIFormsDesigner, i_pIMetaDataTable, i_pIDatabase, i_pIFormsToolDataModelPrivate)
		{
			GrooveRunTimeData.g_pDynMgr = i_pPropertyList.OpenPropertyAsIUnknown(PROPERTY_DYNAMICS_MANAGER);
			GrooveRunTimeData.g_PropertyList = i_pPropertyList;
			GrooveRunTimeData.g_DatabaseObject = i_DatabaseObject;
			GrooveRunTimeData.g_pIFormsDesigner = i_pIFormsDesigner;
			GrooveRunTimeData.g_pIFormsDesignerPrivate = i_pIFormsDesigner.IGrooveFormsDesignerPrivate;
			GrooveRunTimeData.g_pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
			GrooveRunTimeData.g_Telespace = GrooveRunTimeData.g_PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
			GrooveRunTimeData.g_MetaDataTable = i_pIMetaDataTable;
			GrooveRunTimeData.g_pDatabase = i_pIDatabase;
			GrooveRunTimeData.g_pIFormsToolDataModelPrivate = i_pIFormsToolDataModelPrivate;

			var pByteInputStream = GrooveRunTimeData.g_DatabaseObject.OpenByteInputStream();
			try
			{
				var pCurrentFormDocument = GrooveRunTimeData.g_pSM.CreateTemporaryXMLDocument(GrooveRunTimeData.g_DatabaseObject.FileName);
				var pNewRootElement = pCurrentFormDocument.CreateElementFromStream(pByteInputStream, GrooveParseOption_Default | GrooveParseOption_StripContentWhitespace);
				pByteInputStream.Close();
			}
			catch (error)
			{
				GrooveDebugFunctions.DisplayAssert(0, "You received the following error opening view data: " + error.description);
				pByteInputStream.Close();
			}
			pCurrentFormDocument.SetRootElement(pNewRootElement);
			GrooveRunTimeData.g_pCurrentFormRootElement = pCurrentFormDocument.OpenRootElement();
		}

		function ShutdownView()
		{
			GrooveRunTimeData.RemoveAllItems();
		}

		function AddColumnNameToViewPriv(i_pIField)
		{
			AddColumnNameToView(i_pIField);
		}

		function AddFieldToViewPriv(ToolObj, i_pIField, i_ViewName, i_bIsVisible)
		{
			AddFieldToView(ToolObj, i_pIField, i_ViewName, i_bIsVisible, -1);
		}

		function RemoveFieldFromViewPriv(i_pIField, i_ViewName, i_bFieldToBeInView, ToolObj)
		{
			int_RemoveFieldFromView(i_pIField, i_ViewName, i_bFieldToBeInView, ToolObj);
			GrooveRunTimeData.g_pIFormsDesignerPrivate.RemoveFieldFromCurrentFormFieldArray(i_pIField.FieldName, GrooveRunTimeData.g_pCurrentFormRootElement, false);
		}

		function SaveChanges(i_FieldsToRemoveEnum, i_FieldsToAddEnum, i_bIncludeGridLines, i_bShowUnread, i_bFillScreenWithView, i_Width, i_Height)
		{
			ApplyViewChanges(i_FieldsToRemoveEnum, i_FieldsToAddEnum, i_bIncludeGridLines, i_bShowUnread, i_bFillScreenWithView, i_Width, i_Height);
		}

		function UpdateFormFilePriv()
		{
			UpdateFormFile();
		}

			             U                                                                                                                                                                                                                                                                                                                                                                           &    Dæ           å i     ÿ          )            ÄSCRIPTINTERFACE       ÄDefault   1     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }   D   ÄIIDL   { C C A D 4 D 8 7 - 7 2 2 4 - 4 1 a 7 - A D 7 A - 2 C E D 0 2 E 4 9 D E 0 }   B   ÄName    I G r o o v e F o r m s V i e w   m     Ä
		function AppendColumn(i_pIField, i_bIsVisible)
		{
			//GrooveDebugFunctions.DisplayAssert(0, "");
			if (!i_pIField.Persistable && i_pIField.FieldType!= "SystemField")
				return;
			var ToolObj = int_OpenToolObject();	
			var ViewName = GetViewName();
			AddFieldToView(ToolObj, i_pIField, ViewName, i_bIsVisible, -1);
			AddColumnNameToView(i_pIField);
		}

		function AppendMultipleColumns(i_pIFieldEnum)
		{

		}

		function Commit()
		{
			//GrooveDebugFunctions.DisplayAssert(0, "");
			var Delta = GrooveRunTimeData.g_pDynMgr.CreateDelta();
			try
			{
				var ToolObj = int_OpenToolObject();
				UpdateFormFile();
				GrooveRunTimeData.g_pIFormsDesignerPrivate.UpdateFieldsFile();
				int_UpdateToolFile(ToolObj.ToolFileName, ToolObj.RootElement);
				GrooveRunTimeData.g_pDynMgr.DoDelta(Delta);
			}
			catch(error)
			{
				Delta.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function RemoveMultipleColumns(i_pIFieldEnum)
		{

		}

		function RemoveColumn(i_pIField)
		{
			var ToolObj = int_OpenToolObject();
			int_RemoveFieldFromView(i_pIField, GrooveRunTimeData.g_DatabaseObject.DatabaseObjectID, false, ToolObj)
			GrooveRunTimeData.g_pIFormsDesignerPrivate.RemoveFieldFromCurrentFormFieldArray(i_pIField.FieldName, GrooveRunTimeData.g_pCurrentFormRootElement, false);
		}

		function GetIncludeGridLines()
		{
			var IncludeGridLines = false;
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
			var GridLinesValue = 0;
			if (pCurrentFormFieldListElement.DoesAttributeExist("IncludeGridLines"))
				GridLinesValue = pCurrentFormFieldListElement.OpenAttributeAsLong("IncludeGridLines");
			else
			{
				var ObjectElement = GetObjectElement();
				if (ObjectElement.DoesAttributeExist("gridlines"))
					GridLinesValue = ObjectElement.OpenAttribute("gridlines");
			}

			if (GridLinesValue == 1)
				IncludeGridLines = true;

			return IncludeGridLines;
		}

		function PutIncludeGridLines(i_bIncludeGridLines)
		{
			var IncludeGridLines = 0;
			if (i_bIncludeGridLines)
				IncludeGridLines = 1;
			var ToolObj = int_OpenToolObject();
			var ViewName = GetViewName();
			AddRemoveGridLinesToView(ToolObj, ViewName, IncludeGridLines);
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			// Set the current state into the forms field list
			pCurrentFormFieldListElement.SetAttributeAsLong("IncludeGridLines", IncludeGridLines);
			var ObjectElement = GetObjectElement();
			ObjectElement.SetAttribute("gridlines", IncludeGridLines);
		}

		function GetShowUnread()
		{
			var ShowUnread = false;
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
			var UnreadValue = 0;
			if (pCurrentFormFieldListElement.DoesAttributeExist("ShowUnread"))
				UnreadValue = pCurrentFormFieldListElement.OpenAttributeAsLong("ShowUnread");

			if (UnreadValue == 1)
				ShowUnread = true;

			return ShowUnread;
		}

		function PutShowUnread(i_bShowUnread)
		{
			var ShowUnread = 0;
			if (i_bShowUnread)
				ShowUnread = 1;
			var ToolObj = int_OpenToolObject();
			var ViewName = GetViewName();
			AddRemoveUnreadColumnToView(ToolObj, ViewName, ShowUnread);
			var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
			var pCurrentFormFieldListElement = pBodyElement.OpenContent          ElementByName("GROOVEFORMFIELDS");
			pCurrentFormFieldListElement.SetAttributeAsLong("ShowUnread", ShowUnread);
		}

		function GetFillScreenWithView()
		{
			var FillScreenWithView = false;
			var ObjectElement = GetObjectElement();
			var FillScreenWithViewValue = 0;
			if (ObjectElement.DoesAttributeExist("stretch"))
				FillScreenWithViewValue = ObjectElement.OpenAttribute("stretch");

			if (FillScreenWithViewValue == 1)
				FillScreenWithView = true;

			return FillScreenWithView;
		}

		function PutFillScreenWithView(i_bFillScreenWithView)
		{
			var FillScreenWithView = 0;
			if (i_bFillScreenWithView)
				FillScreenWithView = 1;
			var ObjectElement = GetObjectElement();
			ObjectElement.SetAttribute("stretch", FillScreenWithView);
		}

		function GetHeight()
		{
			var ObjectElement = GetObjectElement();
			var Height = 90;
			var HeightValue = "90"
			if (ObjectElement.DoesAttributeExist("height"))
				HeightValue = ObjectElement.OpenAttribute("height");
			
			Height = parseInt(HeightValue);
			return Height;
		}

		function SetHeight(i_Height, i_Style)
		{
			var ObjectElement = GetObjectElement();
			var Height = "" + i_Height;
			if (i_Style == GrooveFormsViewSizeStyle_Percent)
				Height = i_Height + "%";

			ObjectElement.SetAttribute("height", Height);
		}

		function GetWidth()
		{
			var ObjectElement = GetObjectElement();
			var Width = 100;
			var WidthValue = "100"
			if (ObjectElement.DoesAttributeExist("width"))
				WidthValue = ObjectElement.OpenAttribute("width");
			
			Width = parseInt(WidthValue);
			return Width;
		}

		function SetWidth(i_Width, i_Style)
		{
			var ObjectElement = GetObjectElement();
			var Width = "" + i_Width;
			if (i_Style == GrooveFormsViewSizeStyle_Percent)
				Width = i_Width + "%";

			ObjectElement.SetAttribute("width", Width);
		}

		function InsertColumn(i_Ordinal, i_pIField, i_bIsVisible)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				if (!i_pIField.Persistable)
				{
					Transaction.Abort();
					return;
				}

				if (i_Ordinal < 0)
				{
					GrooveErrorFunctions.SetCurrentError(-2147220472, "Invalid ordinal value.  Ordinal must not be less than 0.");
					Transaction.Abort();
					return;
				}
				var ToolObj = int_OpenToolObject();	
				var ViewName = GetViewName();
				AddFieldToView(ToolObj, i_pIField, ViewName, i_bIsVisible, i_Ordinal);
				AddColumnNameToView(i_pIField);
				Transaction.Commit();
			}
			catch(error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function ReplaceColumn(i_pField)
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var Ordinal = GetOrdinal(i_pField.FieldName);
				RemoveColumn(i_pField);
				InsertColumn(Ordinal, i_pField, true);
				Transaction.Commit();
			}
			catch(error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
				GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}

		function CreateColumnNameEnum()
		{
			var Transaction = GrooveRunTimeData.g_Telespace.OpenTransaction(false);
			try
			{
				var pBodyElement = GrooveRunTimeData.g_pCurrentFormRootElement.OpenContentElementByName("BODY");
				var pCurrentFormFieldListElement = pBodyElement.OpenContentElementByName("GROOVEFORMFIELDS");
				var CurrentFormFieldArray = pCurrentFormFieldListElement.OpenAttribute("names").split(",");
				var ColumnNameEnum = CreateBSTREnum();
				for (var i = 0; i < CurrentFormFieldArray.length;i++)
				{
					if (CurrentFormFieldArray[i] != "")
						ColumnNameEnum.Add(CurrentFormFieldArray[i]);
				}
				Transaction.Commit();
				return ColumnNameEnum.IGrooveBSTREnum;
			}
			catch(error)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, error.description);
			      ò  	GrooveErrorFunctions.SetCurrentError(error.number, error.description);
			}
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            U      ÄSCRIPT         
Õ Ä
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		// Note: The majority of the Constants have been removed due to the additional functionality that was added which allows us
		// to import TypeLibs (above).	Importing a typelib causes the ScriptHost to load all the exposed ENUMS that are contained
		// in the TypeLib.	The remaining constants are either true global vars (i.e.: not contained in a typelib) or are awaiting changes
		// to their typelib. SB
		//
		// Note: for the most part all of Groove's exposed Enums in the TypeLibs are preceded by GROOVE_
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		// Interface IID GUID strings.
		var IGROOVECONTACTENUM_GUID = "{55EB5111-C7B0-11d3-80C1-0050DA714497}";
		var IGROOVECONTACT_GUID = "{2B1ED848-4ABB-11D3-A601-00105A0D058F}";

		// Groove registry
		var GrooveKey = "SOFTWARE\\Microsoft\\Office\\14.0\\Groove";

		// IE registry
		var MSIE_KEY = "Software\\Microsoft\\Internet Explorer";

		// NAVBAROBJECTNAME ENUM
		var OBJECT_TITLE = "0";
		var MIDDLE_BUTTON = "1";
		var PREVIOUS_BUTTON = "2";
		var NEXT_BUTTON = "3";
		var PAGE_COUNT = "4";
		var MIDDLE_ICON_BUTTON = "5";

		// Common Tool Icon Images Indexes
		var COMMON_TOOL_ICON_IMAGE_SAVE										= 0;
		var COMMON_TOOL_ICON_IMAGE_SAVE_AS									= 1;
		var COMMON_TOOL_ICON_IMAGE_CUT										= 2;
		var COMMON_TOOL_ICON_IMAGE_COPY										= 3;
		var COMMON_TOOL_ICON_IMAGE_COPY_AS_LINK								= 4;
		var COMMON_TOOL_ICON_IMAGE_PASTE									= 5;
		var COMMON_TOOL_ICON_IMAGE_PREVIOUS_UNREAD							= 6;
		var COMMON_TOOL_ICON_IMAGE_NEXT_UNREAD								= 7;
		var COMMON_TOOL_ICON_IMAGE_NAVIGATE_PREVIOUS						= 8;
		var COMMON_TOOL_ICON_IMAGE_NAVIGATE_NEXT							= 9;
		var COMMON_TOOL_ICON_IMAGE_UNREAD_OPTION_MENU						= 10;
		var COMMON_TOOL_ICON_IMAGE_UNREAD_MARK								= 11;
		var COMMON_TOOL_ICON_IMAGE_EXPAND_ALL								= 12;
		var COMMON_TOOL_ICON_IMAGE_COLLAPSE_ALL								= 13;
		var COMMON_TOOL_ICON_IMAGE_NEW_ENTRY								= 14;
		var COMMON_TOOL_ICON_IMAGE_ATTACHMENT								= 15;
		var COMMON_TOOL_ICON_IMAGE_DELETE									= 16;
		var COMMON_TOOL_ICON_IMAGE_WRITE									= 17;
		var COMMON_TOOL_ICON_IMAGE_ADD										= 18;
		var COMMON_TOOL_ICON_IMAGE_UP_ONE_LEVEL								= 19;
		var COMMON_TOOL_ICON_IMAGE_OPEN										= 20;
		var COMMON_TOOL_ICON_IMAGE_RENAME									= 21;
		var COMMON_TOOL_ICON_IMAGE_OK										= 22;
		var COMMON_TOOL_ICON_IMAGE_CANCEL									= 23;
		var COMMON_TOOL_ICON_IMAGE_UNDO										= 24;
		var COMMON_TOOL_ICON_IMAGE_REDO										= 25;
		var COMMON_TOOL_ICON_IMAGE_FONT_STYLE								= 26;
		var COMMON_TOOL_ICON_IMAGE_BOLD										= 27;
		var COMMON_TOOL_ICON_IMAGE_ITALIC									= 28;
		var COMMON_TOOL_ICON_IMAGE_UNDERLINE								= 29;

		var COMMON_TOOL_ICON_IMAGE_PARAGRAPH								= 30;
		var COMMON_TOOL_ICON_IMAGE_OUTDENT									= 31;
		var COMMON_TOOL_ICON_IMAGE_INDENT									= 32;
		var COMMON_TOOL_ICON_IMAGE_BULLETS									= 33;
		var COMMON_TOOL_ICON_IMAGE_LEFT_JUSTIFY								= 34;
		var COMMON_TOOL_ICON_IMAGE_CENTER_JUSTIFY							= 35;
		var COMMON_TOOL_ICON_IMAGE_RIGHT_JUSTIFY							= 36;
		var COMMON_TOOL_ICON_IMAGE_PREVIOUS									= 37;
		var COMMON_TOOL_ICON_IMAGE_NEXT										= 38;
		var COMMON_TOOL_ICON_IMAGE_UP										= 39;
		var COMMON_TOOL_ICON_IMAGE_DOWN										= 40;
		var COMMON_TOOL_ICON_IMAGE_BACK_TO_START							= 41;
		var COMMON_TOOL_ICON_IMAGE_FORWARD_TO_END							= 42;
		var COMMON_TOOL_ICON_IMAGE_MOVE_TO_LEFT								= 43;
		var COMMON_TOOL_ICON_IMAGE_MOVE_TO_RIGHT							= 44;
		var COMMON_TOOL_ICON_IMAGE_MOVE_UP									= 45;
		var COMMON_TOOL_ICON_IMAGE_MOVE_DOWN								= 46;
		var COMMON_TOOL_ICON_IMAGE_SORTED_UPWARD							= 47;
		var COMMON_TOOL_ICON_IMAGE_SORTED_DOWNWARD							= 48;
		var COMMON_TOOL_ICON_IMAGE_CLICK_TO_EXPAND							= 49;
		var COMMON_TOOL_ICON_IMAGE_CLICK_TO_COLLAPSE						= 50;
		var COMMON_TOOL_ICON_IMAGE_WHITE_OK									= 51;
		var COMMON_TOOL_ICON_IMAGE_WHITE_CANCEL								= 52;
		var COMMON_TOOL_ICON_IMAGE_ALERT									= 53;
		var COMMON_TOOL_ICON_IMAGE_MORE_INFORMATION							= 54;
		var COMMON_TOOL_ICON_IMAGE_CHECK									= 55;
		var COMMON_TOOL_ICON_IMAGE_UNAVAILABLE								= 56;
		var COMMON_TOOL_ICON_IMAGE_EMPTY_CHECKBOX							= 57;
		var COMMON_TOOL_ICON_IMAGE_CHECKED_CHECKBOX							= 58;
		var COMMON_TOOL_ICON_IMAGE_DISABLED_CHECKBOX						= 59;

		var COMMON_TOOL_ICON_IMAGE_DISABLED_CHECKED_CHECKBOX				= 60;
		var COMMON_TOOL_ICON_IMAGE_HELP										= 61;
		var COMMON_TOOL_ICON_IMAGE_DOCUMENT									= 62;
		var COMMON_TOOL_ICON_IMAGE_VIEW										= 63;
		var COMMON_TOOL_ICON_IMAGE_ADD_ENTRY								= 64;
		var COMMON_TOOL_ICON_IMAGE_BLACK									= 65;
		var COMMON_TOOL_ICON_IMAGE_MAROON									= 66;
		var COMMON_TOOL_ICON_IMAGE_GREEN									= 67;
		var COMMON_TOOL_ICON_IMAGE_OLIVE									= 68;
		var COMMON_TOOL_ICON_IMAGE_NAVY										= 69;
		var COMMON_TOOL_ICON_IMAGE_PURPLE									= 70;
		var COMMON_TOOL_ICON_IMAGE_TEAL										= 71;
		var COMMON_TOOL_ICON_IMAGE_GRAY										= 72;
		var COMMON_TOOL_ICON_IMAGE_SILVER									= 73;
		var COMMON_TOOL_ICON_IMAGE_RED										= 74;
		var COMMON_TOOL_ICON_IMAGE_LIME										= 75;
		var COMMON_TOOL_ICON_IMAGE_YELLOW									= 76;
		var COMMON_TOOL_ICON_IMAGE_BLUE										= 77;
		var COMMON_TOOL_ICON_IMAGE_FUCHSIA									= 78;
		var COMMON_TOOL_ICON_IMAGE_AQUA										= 79;
		var COMMON_TOOL_ICON_IMAGE_WHITE									= 80;
		var COMMON_TOOL_ICON_IMAGE_SELECTED_CHECK							= 81;
		var COMMON_TOOL_ICON_IMAGE_SELECTED_BULLET							= 82;
		var COMMON_TOOL_ICON_IMAGE_OPEN_DIALOG								= 83;
		var COMMON_TOOL_ICON_IMAGE_SEARCH									= 84;
		var COMMON_TOOL_ICON_IMAGE_OPEN_PANE								= 85;
		var COMMON_TOOL_ICON_IMAGE_CLOSE_PANE								= 86;
		var COMMON_TOOL_ICON_IMAGE_CHECKED_BOX								= 87;
		var COMMON_TOOL_ICON_IMAGE_UNCHECKED_BOX							= 88;

		var COMMON_TOOL_ICON_IMAGE_GREEN_CHECK								= 89;
		var COMMON_TOOL_ICON_IMAGE_RED_X									= 90;
		var COMMON_TOOL_ICON_IMAGE_PROPERTY									= 91;
		var COMMON_TOOL_ICON_IMAGE_LARGE_ICON_VIEW							= 92;
		var COMMON_TOOL_ICON_IMAGE_SMALL_ICON_VIEW							= 93;
		var COMMON_TOOL_ICON_IMAGE_LIST_VIEW								= 94;
		var COMMON_TOOL_ICON_IMAGE_DETAIL_VIEW								= 95;
		var COMMON_TOOL_ICON_IMAGE_FONT_COLORS								= 96;
		var COMMON_TOOL_ICON_IMAGE_FONT_SIZES								= 97;
		var COMMON_TOOL_ICON_IMAGE_IN_TRUSTED_DOMAIN_IN_ORGANIZATION		= 98;
		var COMMON_TOOL_ICON_IMAGE_MANUALLY_AUTHENTICATED					= 99;
		var COMMON_TOOL_ICON_IMAGE_IN_TRUSTED_DOMAIN_OUTSIDE_ORGANIZATION	= 100;
		var COMMON_TOOL_ICON_IMAGE_EMAIL									= 101;
		var COMMON_TOOL_ICON_IMAGE_CONFLICT									= 102;
		var COMMON_TOOL_ICON_IMAGE_1										= 103;
		var COMMON_TOOL_ICON_IMAGE_2										= 104;
		var COMMON_TOOL_ICON_IMAGE_3										= 105;
		var COMMON_TOOL_ICON_IMAGE_4										= 106;
		var COMMON_TOOL_ICON_IMAGE_5										= 107;
		var COMMON_TOOL_ICON_IMAGE_6										= 108;
		var COMMON_TOOL_ICON_IMAGE_7										= 109;
		var COMMON_TOOL_ICON_IMAGE_8										= 110;
		var COMMON_TOOL_ICON_IMAGE_9										= 111;
		var COMMON_TOOL_ICON_IMAGE_10										= 112;

		// PropertyList constants
		var PROPERTY_NAME = "Name";
		var PROPERTY_BINDABLE_URL = "_BindableURL";
		var PROPERTY_CANONICAL_URL = "_CanonicalURL";
		var PROPERTY_TOOL_CONTAINER = "_ToolContainer";
		var PROPERTY_DYNAMICS_MANAGER = "_DynamicsManager";
		var PROPERTY_TELESPACE_MEMBERS = "_TelespaceMembers";
		var PROPERTY_CURRENT_IDENTITY_URL = "_CurrentIdentityUserURL";
		var PROPERTY_CURRENT_IDENTITY = "_CurrentIdentity";
		var PROPERTY_TELESPACE_DATABASE = "_TelespaceDatabase";
		var PROPERTY_TELESPACE_URL = "_TelespaceURL";
		var PROPERTY_TELESPACE_NAME = "_TelespaceName";
		var PROPERTY_TELESPACE = "_Telespace";
		var PROPERTY_TELESPACE_PROVIDER = "_TelespaceProvider";
		var PROPERTY_TELESPACE_RELATIVE_URL = "_TelespaceRelativeURL";
		var PROPERTY_TELESPACE_DISPLAY_NAME = "_TelespaceDisplayName";
		var PROPERTY_TOOL_DISPLAY_NAME = "_ToolDisplayName";
		var PROPERTY_TOOL_NAME = "_ToolName";
		var PROPERTY_TOOL_URL = "_ToolURL";
		var PROPERTY_TOOL = "_Tool";
		var PROPERTY_FORM = "_Form";
		var PROPERTY_COMPONENT_CONTAINER = "_ComponentContainer";
		var PROPERTY_TELESPACE_PROVIDER = "_TelespaceProvider";
		var PROPERTY_ACCOUNT = "_Account";
		var PROPERTY_OBJECT_ENTRY_STORE = "_ObjectEntryStore";
		var PROPERTY_RESOURCE_BUNDLE = "_ResourceBundle";
		var PROPERTY_CONTACT_STORE = "_ContactStore";
		var PROPERTY_ACCOUNT_PREFERENCES = "_AccountPropertyList";
		var PROPERTY_ACCOUNT_GUID = "_AccountGUID";
		var PROPERTY_TELESPACE_TEMPLATE_VERSION = "_TelespaceTemplateVersion";
		var PROPERTY_TOOL_CREATOR_CONTACT_URL = "_ToolCreatorContactURL";
		var PROPERTY_TOOL_TEMPLATE_COMPONENT_RESOURCE_URL_VERSION = "_ToolTemplateComponentResourceURLVersion";
		var PROPERTY_DESERIALIZATION_REASON = "_DeserializationReason";

		// Color constants which are used for rich text formatting
		// These need to be put in the global strings file
		
		var GLOBAL_COLOR_VALUE_BLACK_MENU_LABEL = 0x000000;
		var GLOBAL_COLOR_VALUE_MAROON_MENU_LABEL = 0x000080;
		var GLOBAL_COLOR_VALUE_GREEN_MENU_LABEL = 0x008000;
		var GLOBAL_COLOR_VALUE_OLIVE_MENU_LABEL = 0x008080;
		var GLOBAL_COLOR_VALUE_NAVY_MENU_LABEL = 0x800000;
		var GLOBAL_COLOR_VALUE_PURPLE_MENU_LABEL = 0x800080;
		var GLOBAL_COLOR_VALUE_TEAL_MENU_LABEL = 0x808000;
		var GLOBAL_COLOR_VALUE_GRAY_MENU_LABEL = 0x808080;
		var GLOBAL_COLOR_VALUE_SILVER_MENU_LABEL = 0xC0C0C0;
		var GLOBAL_COLOR_VALUE_RED_MENU_LABEL = 0x0000FF;
		var GLOBAL_COLOR_VALUE_LIME_MENU_LABEL = 0x00FF00;
		var GLOBAL_COLOR_VALUE_YELLOW_MENU_LABEL = 0x00FFFF;
		var GLOBAL_COLOR_VALUE_BLUE_MENU_LABEL = 0xFF0000;
		var GLOBAL_COLOR_VALUE_FUCHSIA_MENU_LABEL = 0xFF00FF;
		var GLOBAL_COLOR_VALUE_AQUA_MENU_LABEL = 0xFFFF00;
		var GLOBAL_COLOR_VALUE_WHITE_MENU_LABEL = 0xFFFFFF;
		var GLOBAL_XML_EXT = "xml";

		// UIPropertyList constants
		var UIPROPERTY_TOP_LEVEL_WINDOW = "_TopLevelWindow";
		var UIPROPERTY_URLNAVIGATOR = "_URLNavigator";
		var UIPROPERTY_OBJECT_REGISTRY = "_ObjectRegistry";
		var UIPROPERTY_WINDOW_ACCOUNT = "_WindowAccount";
		var UI_PROPERTY_UIACTIVE_COMPONENT = "_UIActiveComponent";
		var UI_PROPERTY_NAVIGATE_TOGETHER_OBJECT = "_NavigateTogetherObject";

		// Access control strings
		var STR_COMMON_ACCESS_CONTROL_COMPONENT_GROUP_OBJECT_ID = "$ComponentGroup";
		var STR_COMMON_ACCESS_CONTROL_COMPONENT_GROUP_OBJECT_TYPE = "$ComponentGroup";
		var STR_COMMON_ACCESS_CONTROL_TELESPACE_MANAGER_ROLE_NAME = "$Telespace.Manager";
		var STR_COMMON_ACCESS_CONTROL_TELESPACE_MEMBER_ROLE_NAME = "$Telespace.Member";
		var STR_COMMON_ACCESS_CONTROL_TELESPACE_GUEST_ROLE_NAME = "$Telespace.Guest";
		var STR_COMMON_ACCESS_CONTROL_TELESPACE_SCOPE_URL = "";
		var STR_COMMON_ACCESS_CONTROL_PROPERTY_ENABLE = "EnableAccessControl";
		var STR_COMMON_ACCESS_CONTROL_CATEGORY_ROLE = "Role";
		var STR_COMMON_ACCESS_CONTROL_CATEGORY_PERMISSION =	"Permission";

		// Virtual Key Code constants
		// See http://msdn.microsoft.com/library/psdk/winui/vkeys_529f.htm 
		// for a complete list if you need to add more.
		var GROOVE_VK_BACK = 0x08;
		var GROOVE_VK_TAB = 0x09;
		var GROOVE_VK_ENTER = 0x0d;
		var GROOVE_VK_LEFT = 0x25;
		var GROOVE_VK_RIGHT = 0x27;
		var GROOVE_VK_INSERT = 0x2d;
		var GROOVE_VK_DELETE = 0x2e;
		var GROOVE_VK_DOWN = 0x28;
		var GROOVE_VK_UP = 0x26;
		var GROOVE_VK_HOME = 0x24;
		var GROOVE_VK_END = 0x23;
		var GROOVE_VK_PGUP = 0x21;
		var GROOVE_VK_PGDN = 0x22;
		var GROOVE_VK_A = 0x41;
		var GROOVE_VK_B = 0x42;
		var GROOVE_VK_C = 0x43;
		var GROOVE_VK_D = 0x44;
		var GROOVE_VK_E = 0x45;
		var GROOVE_VK_F = 0x46;
		var GROOVE_VK_G = 0x47;
		var GROOVE_VK_I = 0x49;
		var GROOVE_VK_L = 0x4c;
		var GROOVE_VK_M = 0x4d;
		var GROOVE_VK_N = 0x4e;
		var GROOVE_VK_O = 0x4f;
		var GROOVE_VK_P = 0x50;
		var GROOVE_VK_R = 0x52;
		var GROOVE_VK_S = 0x53;
		var GROOVE_VK_U = 0x55;
		var GROOVE_VK_V = 0x56;
		var GROOVE_VK_W = 0x57;
		var GROOVE_VK_X = 0x58;
		var GROOVE_VK_Y = 0x59;
		var GROOVE_VK_Z = 0x5a;
		var GROOVE_VK_F1 = 0x70;
		var GROOVE_VK_F2 = 0x71;
		var GROOVE_VK_F3 = 0x72;
		var GROOVE_VK_F4 = 0x73;
		var GROOVE_VK_F5 = 0x74;
		var GROOVE_VK_ESC = 0x1B;
		var GROOVE_VK_SPACE = 0x20;

		// Keystroke Message Values
		var GROOVE_WM_KEYDOWN = 0x100;
		var GROOVE_WM_KEYUP = 0x101;

		// Keystate Modifier Values
		var GROOVE_KEYMOD_SHIFT = 0x00000001;
		var GROOVE_KEYMOD_CONTROL = 0x00000002;
		var GROOVE_KEYMOD_ALT = 0x00000004;

		// Global pointers
		var GROOVE_GLOBAL_MISC_POINTER = GrooveScriptFunctions.CreateNewObject("Groove.SystemServices").Misc;

		// Object pointers
		var g_pMiscHelperObject = null;
		var g_pGlobalI18N = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var g_pGlobalFormatParameters = GrooveScriptFunctions.CreateNewObject("Groove.UnknownArray");
		var g_pGlobalMessageFormat = g_pGlobalI18N.CreateMessageFormat("", GrooveScriptFunctions.CreateNewObject(""));

		// Returns all characters to the right of the search string's
		// first occurrence, searching from left to right.  Returns the
		// input string if the search string isn't found.
		//
		function Right(i_InputString, i_SearchString)
		{
			var FromPos = i_InputString.indexOf(i_SearchString);
			if (-1 == FromPos)
			{
				return i_InputString;
			}

			FromPos += i_SearchString.length;
			return i_InputString.substring(FromPos, i_InputString.length);
		}

		// Returns all characters to the right of the search string's
		// first occurrence, searching from right to left.  Returns the
		// input string if the search string isn't found.
		//
		function RightBack(i_InputString, i_SearchString)
		{
			var FromPos = i_InputString.lastIndexOf(i_SearchString)
			if (-1 == FromPos)
			{
				return i_InputString;
			}
			
			FromPos += i_SearchString.length;
			return i_InputString.substring(FromPos, i_InputString.length);
		}

		// Returns all characters to the left of the search string's
		// first occurrence, searching from left to right.  Returns the
		// input string if the search string isn't found.
		//
		function Left(i_InputString, i_SearchString)
		{
			var ToPos = i_InputString.indexOf(i_SearchString);
			if (-1 == ToPos)
			{
				return i_InputString;
			}

			return i_InputString.substring(0, ToPos);
		}

		// Returns all characters to the left of the search string's
		// first occurrence, searching from right to left.  Returns the
		// input string if the search string isn't found.
		//
		function LeftBack(i_InputString, i_SearchString)
		{
			var ToPos = i_InputString.lastIndexOf(i_SearchString);
			if (ToPos == -1)
			{
				return i_InputString;
			}

			return i_InputString.substring(0, ToPos);
		}

		// This function trims leading and trailing whitespace off the string
		function TrimEnds(String)
		{
			return TrimTail(TrimHead(String));
		}

		// This function trims leading whitespace off the string
		function TrimHead(String)
		{
			var length = String.length;
			for (i=0; i<length; i++)
			{
				if (" " != String.charAt(i))
					break;
			}
			return String.substr(i, length);
		}

		// This function trims trailing whitespace off the string
		function TrimTail(String)
		{
			var length = String.length;
			for (i=length-1; i>=0; i--)
			{
				if (" " != String.charAt(i))
					break;
			}
			return String.substr(0, i + 1);
		}

		function SubstituteArrayValuesInString(i_String, i_Array)
		{
			if (typeof i_Array != "object")
			{
				var E_INVALIDARG = -2147024809;
				throw new Error(E_INVALIDARG, "SubstituteArrayValuesInString: i_Array must be an array");
			}

			g_pGlobalFormatParameters.RemoveAll();
			for (var i = 0; i < i_Array.length; i++)
			{
				var pFormattable = g_pGlobalI18N.CreateFormattableFromString(i_Array[i]);
				g_pGlobalFormatParameters.Add(pFormattable);
			}

			g_pGlobalMessageFormat.ApplyPattern(i_String);
			return g_pGlobalMessageFormat.Format(g_pGlobalFormatParameters);
		}

		// URL HELPER FUNCTIONS

		// This function returns the URL for the component which is passed in
		function GetComponentURL(ComponentObject)
		{
			return ComponentObject.Component.BindableURL;
		}

		// Append path to URL string
		function AppendPathToURL(URL, AppendPath)
		{
			var pURL = GROOVE_GLOBAL_MISC_POINTER.OpenURI(URL);
			var Path = pURL.GetPath();
			Path += AppendPath;
			pURL.SetPath(Path);

			var NewURL = pURL.String;

			return NewURL;
		}

		// Create URL from scheme, host and path
		function CreateURLFromSchemeHostAndPath(Scheme, Host, Path)
		{
			var ValidComponentsFlag = GrooveURIComponentType_Scheme | GrooveURIComponentType_Host | GrooveURIComponentType_Path;
			var pURL = GROOVE_GLOBAL_MISC_POINTER.CreateURI(ValidComponentsFlag, "", Scheme, "", "", Host, "", Path);

			var URL = pURL.String;

			return URL;
		}

		// Create URL from scheme and path
		function CreateURLFromSchemeAndPath(Scheme, Path)
		{
			var ValidComponentsFlag = GrooveURIComponentType_Scheme | GrooveURIComponentType_Authority | GrooveURIComponentType_Path;
			var pURL = GROOVE_GLOBAL_MISC_POINTER.CreateURI(ValidComponentsFlag, "", Scheme, "", "", "", "", Path);

			var URL = pURL.String;

			return URL;
		}

		// Create URL from scheme and host
		function CreateURLFromSchemeAndHost(Scheme, Host)
		{
			var ValidComponentsFlag = GrooveURIComponentType_Scheme | GrooveURIComponentType_Host;
			var pURL = GROOVE_GLOBAL_MISC_POINTER.CreateURI(ValidComponentsFlag, "", Scheme, "", "", Host);

			var URL = pURL.String;

			return URL;
		}

		// Parse path from URL
		function ParsePathFromURL(URL)
		{
			var pURL = GROOVE_GLOBAL_MISC_POINTER.OpenURI(URL);
			var Path = pURL.GetPath();

			return Path;
		}

		function CreateNewElement(i_Name)
		{
			var StorageMgr = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
			return StorageMgr.CreateTemporaryElement(i_Name);
		}

		function CreateBSTREnum()
		{
			var BSTREnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateBSTREnum();
			var BSTREnumCreate = BSTREnum.BSTREnumCreate;
			return BSTREnumCreate;
		}

		function CreateStringStringEnum(i_bSort)
		{
			if (typeof i_bSort == "undefined")
				i_bSort = false;
			var StringStringEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateStringStringEnum(i_bSort);
			var StringStringEnumCreate = StringStringEnum.StringStringEnumCreate;
			return StringStringEnumCreate;
		}

		function CreateVARIANTEnum()
		{
			var VARIANTEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateVARIANTEnum();
			var VARIANTEnumCreate = VARIANTEnum.VARIANTEnumCreate;
			return VARIANTEnumCreate;
		}

		function CreateNameValueEnum()
		{
			var NameValueEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum();
			var NameValueEnumCreate = NameValueEnum.NameValueEnumCreate;
			return NameValueEnumCreate;
		}

		function CreateLongEnum()
		{
			var LongEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateLongEnum();
			var LongEnumCreate = LongEnum.LongEnumCreate;
			return LongEnumCreate;
		}

		function CreateDoubleEnum()
		{
			var DoubleEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateDoubleEnum();
			var DoubleEnumCreate = DoubleEnum.DoubleEnumCreate;
			return DoubleEnumCreate;
		}

		function CreateStringUnknownEnum()
		{
			var StringUnknownEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateStringUnknownEnum();
			var StringUnknownEnumCreate = StringUnknownEnum.StringUnknownEnumCreate;
			return StringUnknownEnumCreate;
		}

		function CreateUnknownEnumFromStringIIDs(i_EnumIID, i_EntryIID)
		{
			var UnknownEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs(i_EnumIID, i_EntryIID);
			var UnknownEnumCreate = UnknownEnum.UnknownEnumCreate;
			return UnknownEnumCreate;
		}

		function CreateByteInputStreamFromFile(i_File, i_DenyNone)
		{
			if (null == i_DenyNone)
				i_DenyNone = false;

			var ByteInputStream;
			try
				{
				ByteInputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteInputStreamFromFile2(i_File, i_DenyNone);
				}
			catch (e)
				{
				}
			return ByteInputStream;
		}

		function CreateByteInputStreamFromString(i_String, i_CharEncodingType)
		{
			var ByteInputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteInputStreamFromString(i_String, i_CharEncodingType);
			return ByteInputStream;
		}


		function CreateByteOutputStreamFromFile(i_File, i_Append, i_ReadOnly)
		{
			if (null == i_Append)
				i_Append = false;

			if (null == i_ReadOnly)
				i_ReadOnly = false;

			var ByteOutputStream;
			try
				{
				ByteOutputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteOutputStreamFromFile(i_File, i_Append, i_ReadOnly);
				}
			catch(e)
				{
				}
			return ByteOutputStream;
		}

		function CreateMemoryByteStore(i_PageSize)
		{
			if (null == i_PageSize)
				i_PageSize = 0;

			var MemoryByteStore = GROOVE_GLOBAL_MISC_POINTER.StoreFactory.CreateMemoryByteStore(i_PageSize);
			return MemoryByteStore;
		}

		function CreateMemoryMappedFileByteStore(i_Size, i_FilePath, i_MappingName, i_AccessType)
		{
			if (null == i_Size)
				i_Size = -1;

			if (null == i_FilePath)
				i_FilePath = "";

			if (null == i_MappingName)
				i_MappingName = "";

			if (null == i_AccessType || typeof i_AccessType == "undefined")
				i_AccessType = GrooveDataAccessType_ReadWrite;

			var MemoryMappedFileByteStore = GROOVE_GLOBAL_MISC_POINTER.StoreFactory.CreateMemoryMappedFileByteStore(i_Size, i_FilePath, i_MappingName, i_AccessType);
			return MemoryMappedFileByteStore;
		}

		function CreateMemoryCharStore(i_PageSize)
		{
			if (null == i_PageSize)
				i_PageSize = 0;

			var MemoryCharStore = GROOVE_GLOBAL_MISC_POINTER.StoreFactory.CreateMemoryCharStore(i_PageSize);
			return MemoryCharStore;
		}

		function OpenAccountFromPropertyList(pPropertyList)
		{
			return pPropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE_PROVIDER);
		}

		function OpenFullNameFromCurrentIdentity(PropertyList, i_IncludeAnnotation)
		{
			if (i_IncludeAnnotation == null)
				i_IncludeAnnotation = true;

			var Telespace = PropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);
			var pCurrentIdentity = Telespace.OpenCurrentIdentity();
			var pCurrentIdentityContact = pCurrentIdentity.Contact;
			return OpenFullNameFromContact(pCurrentIdentityContact, i_IncludeAnnotation);
		}

		function OpenRecordCreatorName(i_pPropertyList, i_pRecord, i_UseAlias)
		{
			var CS = i_pPropertyList.OpenProperty("_ContactStore");
			var Telespace = i_pPropertyList.OpenPropertyAsIUnknown(PROPERTY_TELESPACE);

			try
			{
				var Transaction = Telespace.OpenTransaction(true);
				var CURL = i_pRecord.OpenFieldAsString("_CreatedByURL");
				Transaction.Commit();
				if (CS.DoesExist(CURL))
					{
					var CurrContact = CS.Open(CURL);
					return OpenFullNameFromContact(CurrContact);
					}
				else
					return false;

			}
			catch (error)
			{
				Transaction.Abort();
				return false;
			}

		}

		function OpenFullNameFromContact(i_Contact, i_IncludeAnnotation)
		{
			// Set i_IncludeAnnotation default value in these cases:
			//
			// - Set to FALSE if input contact is NOT in contact store,
			//   because we can't support annotation for such contacts.
			//   This occurs if input is temporary email-only contact.
			//
			// - Otherwise, set to TRUE if caller didn't specify.
			//
			if (!i_Contact.HasScriptableInterface("IGrooveContactStoreEntry"))
			{
				i_IncludeAnnotation = false;
			}
			else if (i_IncludeAnnotation == null)
			{
				i_IncludeAnnotation = true;
			}
			
			// Obtain name from contact store entry if including
			// annotation, or directly from vCard otherwise.
			//
			return i_IncludeAnnotation ?
				i_Contact.ContactStoreEntry.DisplayName :
				i_Contact.OpenVCard().OpenIdentification().OpenFullName();
		}

		function OpenOriginalNameFromContact(i_pContact)
		{
  			var OriginalName = "";
  
			// Get the identification object from the vCard
			var FullName = OpenFullNameFromContact(i_pContact, false);

			// See if the contact is managed
			try
			{
				if (i_pContact.Contact3.DoesDisplayableAffiliationExist())
					OriginalName = FullName + "/" + i_pContact.Contact3.OpenDisplayableAffiliation();
			}
			catch(Error)
			{
			}

			if (OriginalName == "")
			{
				// Default original name to full name
				OriginalName = FullName;

				// See if there is an alias
				var Alias = "";
				try
				{
					Alias = i_pContact.ContactStoreEntry.Alias != "";
				}
				catch(Error)
				{
				}

				// If there wasn't an alias do FirstName + LastName
				if (Alias == "")
				{
					// Construct a full name
					var pIdentification = i_pContact.OpenVCard().OpenIdentification();
					var pName = pIdentification.OpenName();
					var ConstructedFullName = TrimEnds(pName.OpenGiven() + " " + pName.OpenFamily());

					// See if the constructed fullname is different than vCard full name
					if (ConstructedFullName != "" && FullName != ConstructedFullName)
						OriginalName = ConstructedFullName;
				}
			}
		
			// Return the original name
			return OriginalName;
		}

		function OpenNameFromContactURL(i_pPropertyList, i_ContactURL)
		{
			var CS = i_pPropertyList.OpenProperty("_ContactStore");

			if (CS.DoesExist(i_ContactURL))
			{
				var CurrContact = CS.Open(i_ContactURL);
				return OpenFullNameFromContact(CurrContact);
			}
			else
			{
				return GetString(i_pPropertyList.OpenProperty (PROPERTY_RESOURCE_BUNDLE), "System_CD_NNF");
			}
		}

		//
		// returns true if the specified contact is a Groove contact
		//
		function IsGrooveyContact(i_pContact)
		{
			return i_pContact.DoesSecurityInfoExist();
		}

		//
		// returns IGrooveContactEnum containing all input
		// contacts that are Groove (not email) contacts
		//
		function FilterGrooveContacts (i_pContactEnum)
		{
			// Create empty output enum.
			var pGrooveContactEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs(
				IGROOVECONTACTENUM_GUID,
				IGROOVECONTACT_GUID);

			// Copy each Groove contact from input to output.
			var pContact = null;
			while (i_pContactEnum.HasMore())
			{
				pContact = i_pContactEnum.OpenNext();
				if (IsGrooveyContact(pContact))
				{
					pGrooveContactEnum.UnknownEnumCreate.Add(pContact);
				}
			}

			// Reset input enum so caller can use it.
			i_pContactEnum.Reset();

			return pGrooveContactEnum;
		}

		function GetAuthenticationAndCertificationFlagsExcludingExpiredCertificatesFromContact(i_pContact)
		{
			// Initialize image index
			var AuthenticationAndCertificationFlags = GrooveContactAuthenticationAndCertificationFlags_None;

			try
			{
				// Get the AuthenticationAndCertificationFlags for the contact
				var pContactStoreEntry2 = i_pContact.ContactStoreEntry2;
				AuthenticationAndCertificationFlags = pContactStoreEntry2.AuthenticationAndCertificationFlagsExcludingExpiredCertificates;
			}
			catch(Error)
			{
			}
			return AuthenticationAndCertificationFlags;
		}

		// This method checks whether an address follows the form:  a@b.c
		// As a result the string must be at least five characters long.
		// The following are required:  @, dot, and at least one character
		// before and after each of them.  Consecutive dots are not allowed.
		function IsEmailAddressValid(i_EmailAddress)
		{
			// Trim both ends of the string
			var EmailAddress = TrimEnds(i_EmailAddress);

			// Get the length
			var AddressLength = EmailAddress.length;

			// Address must be long enough to be "a@b.c"
			if (AddressLength < 5)
				return false;

			// There can be no string of consecutive dots.
			if (-1 != EmailAddress.indexOf(".."))
				return false;

			// There must not be a ";" sign.
			if (-1 != EmailAddress.indexOf(";"))
				return false;

			// There must be a "@" sign.
			var AtPos = EmailAddress.indexOf("@");
			if (-1 == AtPos)
				return false;

			// At least one character must come before the @ sign and at least three characters,
			// e.g., "b.c" must come after it.
			if ((0 == AtPos) || (AtPos >= (AddressLength - 3)))
				return false;

			//  There must be a dot.
			var DotPos = EmailAddress.indexOf(".");
			if (-1 == DotPos)
				return false;

			// The dot cannot be the last character in the address.
			if (DotPos >= (AddressLength - 1))
				return false;
			else
				return true;
		}

		// Open (and optionally create) a property list
		function CreateOrOpenPropertyList(i_pPropertyList, i_pTelespace, i_pTool, i_Scope, i_pScriptHostComponent, i_ConnectPrefix, i_CreateIfNotFound)
		{
			var pReturnPropertyList = null;
			var ToolURL = "";
			if (i_pTool)
				ToolURL = i_pTool.BindableURL;

			// Grab the appropriate preferences list, depending upon the scope
			if (1 == i_Scope || 2 == i_Scope)
				{
				// Ask the telespace for the account property list
				var pAccountPropertyList;

				if (!i_pPropertyList.PropertyExists(PROPERTY_ACCOUNT_PREFERENCES))
					{
					return GrooveScriptFunctions.CreateNewObject("");
					}
				pAccountPropertyList = i_pPropertyList.OpenProperty(PROPERTY_ACCOUNT_PREFERENCES);

				// Generate the name of the preferences we want
				var PreferencesName = i_pTelespace.OpenCanonicalURL();
				if (1 == i_Scope)
					{
					var IdentityURL = i_pTelespace.OpenCurrentIdentityURL();
					PreferencesName += IdentityURL;
					}

				// Append the tool url if requested
				if (i_pTool)
					PreferencesName += ToolURL;

				// See if the preferences already exist
				if (!pAccountPropertyList.PropertyExists(PreferencesName))
					{
					if (!i_CreateIfNotFound)
						return;

					// Create the property list
					pReturnPropertyList = pAccountPropertyList.CreatePropertyAsPropertyList(PreferencesName);
					}
				else
					{
					pReturnPropertyList = pAccountPropertyList.OpenPropertyAsPropertyList(PreferencesName);
					}
				}
			else if (3 == i_Scope)
				{
				var pTelespacePreferencesPropertyList = i_pTelespace.PreferencesProvider.PropertyList;
				if (pTelespacePreferencesPropertyList.PropertyExists("TelespaceGlobalPreferences"))
					pReturnPropertyList = pTelespacePreferencesPropertyList.OpenPropertyAsPropertyList("TelespaceGlobalPreferences");
				else if (i_CreateIfNotFound)
					pReturnPropertyList = pTelespacePreferencesPropertyList.CreatePropertyAsPropertyList("TelespaceGlobalPreferences");
				else
					return null;
				}

			// If a property change listener was provided, then connect to the property list
			if (i_ConnectPrefix.length)
				i_pScriptHostComponent.ConnectObject(pReturnPropertyList, i_ConnectPrefix);

			return pReturnPropertyList;
		}

		function CreateOrOpenTelespacePreferencesPropertyList(i_pTelespace, i_PropertyListName)
		{
			var pTelespacePreferencesPropertyList = i_pTelespace.PreferencesProvider.PropertyList;
			var pPropertyList;
			if(!pTelespacePreferencesPropertyList.PropertyExists(i_PropertyListName))
				pPropertyList = pTelespacePreferencesPropertyList.CreatePropertyAsPropertyList(i_PropertyListName);
			else
				pPropertyList = pTelespacePreferencesPropertyList.OpenPropertyAsPropertyList(i_PropertyListName);

			return pPropertyList;
		}

		function Helper_GetRoles(i_ScopeURL, i_pTelespace, i_ObjectID)
		{
			var pObjectEntryStore = i_pTelespace.ObjectEntryStore;
			if (pObjectEntryStore)
				{
				var ObjEntry = pObjectEntryStore.Open(i_ScopeURL, i_ObjectID);
				return ObjEntry.AccessControl.IGrooveRoles;
				}
			return null;
		}

		function Helper_GetTemplateRoles(i_ScopeURL, i_pTelespace, i_ObjectID)
		{
			var Roles = Helper_GetRoles(i_ScopeURL, i_pTelespace, i_ObjectID);
			if (Roles)
				return Roles.TemplateRoles;
			return null;
		}

		function Helper_GetRoleForUser(i_Roles, i_TemplateRoleEnum, i_ContactURL)
		{
			i_TemplateRoleEnum.Reset();
			while (i_TemplateRoleEnum.HasMore())
			{
				var TemplateRole = i_TemplateRoleEnum.OpenNext();
				if (TemplateRole.Visible)
				{
					var Role = i_Roles.Open(TemplateRole.Name);
					if (Role.ContainsMember(i_ContactURL))
						return TemplateRole;
				}
			}
		}

		function ActivateDefaultView(PropertyList)
		{
			var pForm = PropertyList.OpenProperty(PROPERTY_FORM);
			var pDefaultView = pForm.OpenDefaultView();
			pDefaultView.SetDefaultFocus();
		}

		function CloseWindow(Window)
		{

			Window.Close(GrooveMessageBoxResultCode_Cancel);
			Window.Destroy(GrooveMessageBoxResultCode_Cancel);
		}

		function ExportRecordsToFile(i_RecordIDEnum, i_RecordSetEngine, i_PropertyList, i_ToolName)
		{
			var pBundle = i_PropertyList.OpenProperty(PROPERTY_RESOURCE_BUNDLE);

			try
			{
				var ExportElement = i_RecordSetEngine.ExportToElement(i_RecordIDEnum);
			}
			catch (error)
			{
				if (pBundle)
					var ErrStr = SubstitueArrayValuesInString("{0}:  {1}", new Array(GetString(pBundle, "System_Error"), error.Description));
				else
					var ErrStr = "Error: " + error.Description;

				GrooveScriptFunctions.DoMessageBox(ErrStr);
				return false;
			}

			// Before we serialize the element, we need to make any linked files dbrelative
			// this is done do to make sure that when the file is imported all linked binary
			// documents are db relative and not absolute
			try
			{
				// 1. get the document which contains the element
				var pXMLDocument = ExportElement.OpenXMLDocument();
				// 2. get a locator for this document
				var pLocator = pXMLDocument.CreateLocator();
				// 3. create a query string
				var strLocatorString = ".//urn:groove.net:File"
				// 4. get an element enum matching our query
				var pFileElementEnum = pLocator.OpenElementEnum(strLocatorString, ExportElement);
				// 5. loop through the enum and check to see if the returned element contains links
				//    if it does, make the links db relative
				while (pFileElementEnum.HasMore())
				{
					var pFileElement = pFileElementEnum.OpenNext();
					if (pFileElement.IsLinkElement())
						pFileElement.SetAttribute("MakeDBRelative", "true");
				}
			}
			catch (error)
			{
				var ErrStr = SubstitueArrayValuesInString("{0}:  {1}", new Array(GetString(pBundle, "System_Error"), error.Description))
				GrooveScriptFunctions.DoMessageBox(ErrStr);
				return false;
			}

			var strLastDirectory = "";
			var Account = OpenAccountFromPropertyList(i_PropertyList);
			var App = GrooveScriptFunctions.CreateNewObject("Groove.Application");
			if (i_PropertyList.PropertyExists(i_ToolName + "LastDirectory"))
				strLastDirectory = i_PropertyList.OpenProperty(i_ToolName + "LastDirectory");
			else
			{
				var pWin32FileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
				strLastDirectory = pWin32FileSystemServices.OpenPersonalFilesFolderPath();
			}

			if (pBundle)
				var FileResult = App.SaveFileDialog(GetString(pBundle, "System_EXPTTL"), GetString(pBundle, "System_XMLFILTER"), strLastDirectory, i_ToolName+"."+ GLOBAL_XML_EXT , Account, 1, false);
			else
				var FileResult = App.SaveFileDialog("Export Record(s) to File..." , "XML File (*.xml)|*.xml||", strLastDirectory, i_ToolName+"."+ GLOBAL_XML_EXT , Account, 1, false);

			if (GrooveDialogBoxResultCode_OK == FileResult.Result)
			{
				if (FileResult.Data.lastIndexOf(".xml") == -1)
					FileResult.Data = FileResult.Data + ".xml";

				var strPath = LeftBack(FileResult.Data, "\\");
				i_PropertyList.SetProperty(i_ToolName +"LastDirectory", strPath,0);
				var BOS = CreateByteOutputStreamFromFile(FileResult.Data);
				ExportElement.SerializeToStream(BOS, GrooveSerializeType_MIME, GrooveCharEncodingType_UTF8, GrooveSerializeOption_Default);
			}

		}

		function SetClipboardEmpty()
		{
			var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
			var pClipboard = pUIManager.OpenClipboard();
			pClipboard.SetEmpty();
		}

		// RecordSet clipboard helpers

		function CopyRecordsToClipboard(i_RecordIDEnum, i_RecordSetEngine, i_ClipboardFormat, i_ErrStr)
		{
			try
			{
				var ExportElement = i_RecordSetEngine.ExportToElement(i_RecordIDEnum);
			}
			catch (error)
			{
				var ErrStr = SubstituteArrayValuesInString("{0} {1}", new Array(i_ErrStr, error.Description));
				GrooveScriptFunctions.DoMessageBox(ErrStr);
				return false;
			}

			var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
			var pClipboard = pUIManager.OpenClipboard();
			pClipboard.SetDataAsElement(i_ClipboardFormat, ExportElement);
			return true;

		}

		// The following function has 3 possible returns:
		//		1.  If the specified format is not available on the clipboard, the function will return false
		//		2.  If the format is available and you want the records added to the record set, it will return true
		//		3.  If the format is available and you don't want the records added to the record set, it will return the record enum
		//
		// If an error occurs the function returns false
		//
		function PasteRecordsFromClipboard(i_ClipboardFormat, i_RecordSetEngine, i_bAddToRecordSet)
		{
			var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
			var pClipboard = pUIManager.OpenClipboard();
			if (pClipboard.IsDataAvailable(i_ClipboardFormat))
			{
				try
				{
					var ImportElement = pClipboard.OpenDataAsElement(i_ClipboardFormat);
					var RecordEnum = i_RecordSetEngine.ImportFromElement(ImportElement);
					if (typeof i_bAddToRecordSet == "undefined" || i_bAddToRecordSet == true)
					{
						i_RecordSetEngine.AddMultipleRecords(RecordEnum);
						return true;
					}
					else
						return RecordEnum;
				}
				catch (error)
				{
					return false;
				}
			}
			else
				return false;
		}

		function CopyTextToClipboard(i_Text)
		{
			var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
			var pClipboard = pUIManager.OpenClipboard();
			pClipboard.SetDataAsString("Text", i_Text);
		}

		function GetTextFromClipboard()
		{
			var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
			var pClipboard = pUIManager.OpenClipboard();
			if (pClipboard.IsDataAvailable("Text"))
				return pClipboard.OpenDataAsString("Text");
			else
				return "";
		}

		function CopyAsLinkToClipboard(i_CanonicalURL, i_DisplayName,i_HyperlinkName)
		{
			var pStorageMgr = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
			var pElement = pStorageMgr.CreateTemporaryElement("GrooveLink");
			pElement.SetAttribute("DisplayName", i_DisplayName);
			pElement.SetAttribute("URL", i_CanonicalURL);

			var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
			var pClipboard = pUIManager.OpenClipboard();

			var Name = i_HyperlinkName;
			if(!Name)
				Name = i_DisplayName;
			pClipboard.SetEmpty();
			pClipboard.Clipboard2.SetDataAsGrooveHyperlink(i_CanonicalURL, Name,i_DisplayName);
      
		}

		function GetString(i_pBundle, i_String)
		{
		 	return i_pBundle.OpenStringResourceAsString(i_String);
		}

		function GetResourcedString(i_ID)
		{
		 	return GrooveScriptFunctions.GetResourcedString(i_ID);
		}

		// These Can navigation functions replace DataView Functionality for CanMoveNextUnread, etc...

		function CanNavigateNextUnread(i_Collection, i_RecordID)
		{
			if (i_Collection && i_RecordID)
			{
				if (i_Collection.OpenRecordID(i_RecordID, GrooveCollectionNavigationOp_NextUnread) == -1)
					return false;
				else
					return true;
			}
			else
				return false;
		}

		function CanNavigatePreviousUnread(i_Collection, i_RecordID)
		{
			if (i_Collection && i_RecordID)
			{
				if (i_Collection.OpenRecordID(i_RecordID, GrooveCollectionNavigationOp_PriorUnread) == -1)
					return false;
				else
					return true;
			}
			else
				return false;
		}

		function CanNavigateNext(i_Collection, i_RecordID)
		{
			if (i_Collection && i_RecordID)
			{
				if (i_Collection.OpenRecordID(i_RecordID, GrooveCollectionNavigationOp_NextAny) == -1)
					return false;
				else
					return true;
			}
			else
				return false;
		}

		function CanNavigatePrevious(i_Collection, i_RecordID)
		{
			if (i_Collection && i_RecordID)
			{
				if (i_Collection.OpenRecordID(i_RecordID, GrooveCollectionNavigationOp_PriorAny) == -1)
					return false;
				else
					return true;
			}
			else
				return false;
		}

		//	Custom object, typically used for DLLs and EXEs
		function VersionObject(i_VersionString)
		{
			var VerArray = i_VersionString.split(".");
			if (typeof i_VersionString != "undefined")
				this.VersionString = i_VersionString;
			if (typeof VerArray[0] != "undefined")
				this.MajorVersion = parseInt(VerArray[0]);
			if (typeof VerArray[1] != "undefined")
				this.MinorVersion = parseInt(VerArray[1]);
			if (typeof VerArray[2] != "undefined")
				this.BuildVersion = parseInt(VerArray[2]);
			if (typeof VerArray[3] != "undefined")
				this.SubBuildVersion = parseInt(VerArray[3]);
		}

		function GetMSIEVersion()
		{
			//	Works with IE4.0 and later
			//  See  http://support.microsoft.com/default.aspx?scid=kb;EN-US;q164539 for more
			//  information as to how IE reports version numbers back for the various
			//  versions of IE.
			var App = GrooveScriptFunctions.CreateNewObject("Groove.Application");
			var VerString = App.ReadRegistryValue(GrooveRegistryKeyValue_LocalMachine,
												  MSIE_KEY, "Version");
			if (typeof VerString != "undefined" && VerString != "")
			{
				var MSIEVersion = new VersionObject(VerString);
				return MSIEVersion;
			}
			else
				return null;
		}

		function OpenCacheFromRunTimeData(i_pRunTimeData, i_CacheName)
		{
			var pCache = null;
			if (i_CacheName == "" || i_CacheName == null)
				i_CacheName = "_ObjectCache";
			i_pRunTimeData.LockData();
			try
			{
				if (i_pRunTimeData.LockedHasItem(i_CacheName))
					pCache = i_pRunTimeData.LockedGetItem(i_CacheName);
				else
				{
					pCache = GrooveScriptFunctions.OpenSharedObjectTable("");
					i_pRunTimeData.LockedSetItem(i_CacheName, pCache);
				}
			}
			catch (error)
			{
			}
			i_pRunTimeData.UnlockData();
			return pCache;
		}
					
		function AddObjectToCache(i_Key, i_pObject, i_pCache)
		{
			i_pCache.SetItem(i_Key, i_pObject);
		}

		function IsObjectInCache(i_Key, i_pCache)
		{
			return i_pCache.HasItem(i_Key);
		}

		function OpenObjectFromCache(i_Key, i_pCache)
		{
			return i_pCache.GetItem(i_Key);
		}

		function RemoveObjectFromCache(i_Key, i_pCache)
		{
			if (IsObjectInCache(i_Key, i_pCache))
			{
				i_pCache.RemoveItem(i_Key);
			}
		}

		function ShutdownCache(i_pCache, i_Callback)
		{
			i_pCache.LockData();
			try
			{
				if (i_Callback)
				{
					var pEntryEnum = i_pCache.LockedCreateNameValueEnum();
					while (pEntryEnum.HasMore())
					{
						var pEntry = pEntryEnum.OpenNextPair();
						i_Callback(pEntry.First, pEntry.Second);
					}
				}
				i_pCache.LockedRemoveAllItems();
			}
			catch(error)
			{
				i_pCache.LockedRemoveAllItems();
			}

			i_pCache.UnlockData();
		}

		function ResolveLinkTargetPathName(i_Path)
		{
			if(IsLNKShortcutFile(i_Path))
			{
				var pIFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

				var SourcePath = pIFileSystemServices.OpenShortcutFileInfo(i_Path);
				return ResolveLinkTargetPathName(SourcePath);
			}
			else
			{
				return i_Path;
			}
		}

		function IsLNKShortcutFile(i_Path)
		{
			var pIFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
			var LNKExtension = "lnk";
			if(pIFileSystemServices.IsFileLinkByPath(i_Path) &&
					(LNKExtension == pIFileSystemServices.OpenFileExtension(i_Path).toLowerCase()))
				return true;
			else
				return false;
		}

		// Used to display a subform in a dialog.
		//
		// i_FormName - Name of subform to be displayed
		// i_pForm	- IGrooveForm that manages subform (normally obtained from property list)
		// i_pParentWindow - Parent window for dialog (normally obtained from UI property list)
		// i_Caption - Caption to display, if none is specified the default in the template is used
		// i_InitializationCode - Function to be called before dialog is displayed.
		// i_InitializationArgs - Array of arguments to be passed to the initialization function.
		// i_ResultCode - Function to be called after dialog is dismissed.
		// i_ShowWindowInTaskbar - (optional) True to show window entry in system taskbar.  Default is false.
		// i_pWindowAccount - (optional) Account for dialog window when i_ShowWindowInTaskbar is true.  See remarks.
		//
		// Remarks:
		//
		// The i_InitializationCode function should look like InitializationCode(i_pDelegate, i_Args).
		// The i_ResultCode function should look like ResultCode(i_pDelegate, i_ResultCode).
		//
		// The optional i_ShowWindowInTaskbar and i_pWindowAccount parameters work together to
		// support dialog windows that appear in the system taskbar.  Groove's Window Manager
		// allows this only when the dialog has no parent (i.e. its parent is the desktop).  This
		// method normally uses the i_pParentWindow parameter both to specify the dialog's parent
		// AND ALSO to specify the dialog's account (whose skin the dialog uses).  To display a
		// dialog that appears in the system taskbar, callers must specify inputs as follows:
		//
		//    - i_pParentWindow is null (to specify NO parent window)
		//    - i_ShowWindowInTaskbar is true
		//    - i_pWindowAccount is the account for which the dialog will run
		//
		// Callers MUST specify a non-null i_pParentWindow when omitting the optional parameters.
		// Callers MUST specify a non-null i_pWindowAccount when i_pParentWindow is null.
		//
		function DisplayDialog(i_FormName, i_pForm, i_pParentWindow, i_Caption, i_InitializationCode, i_InitializationArgs, i_ResultCode, i_ShowWindowInTaskbar, i_pWindowAccount)
			{
			// Init optional parameters
			if (typeof i_ShowWindowInTaskbar == "undefined")
				{
				i_ShowWindowInTaskbar = false;
				}
			if (i_pParentWindow)
				{
				i_pWindowAccount = i_pParentWindow.OpenWindowAccount();
				}

			// Show wait cursor
			var pWindowManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
			pWindowManager.ShowWaitCursor(true);

			try
				{
				// Create new instance of specified subform
				var pForm = i_pForm.CreateFormByName(i_FormName);

				// Get the delegate
				var pDelegateHost = null;
				var pDelegate = pForm.OpenDelegateComponent();

				try
					{
					// Most delegates should be implementing an interface
					// and so we should not need to go to the script host.

					pDelegateHost = pDelegate.GetScriptDispatch();
					}
				catch (error)
					{
					pDelegateHost = pDelegate;
					}

				// Allow pre-processing on the delegate
				if (i_InitializationCode)
					i_InitializationCode(pDelegateHost, i_InitializationArgs);

				// Set up preferences for window to create
				var pWindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
				if (i_pParentWindow)
					{
					pWindowProperties.ParentWindow = i_pParentWindow;
					}
				pWindowProperties.VisibleInTaskbar = i_ShowWindowInTaskbar;
				pWindowProperties.Style = "PopupWindow";
				pWindowProperties.Caption = i_Caption;
				pWindowProperties.CloseButton = true;
				pWindowProperties.Resizable = false;
				pWindowProperties.Visible = false;

				// Create the window
				var pWindow = pWindowManager.CreateGrooveWindowForForm(i_pWindowAccount, "", pWindowProperties, pForm);

				// Dismiss wait cursor
				pWindowManager.ShowWaitCursor(false);

				// Show the window
				var Result = pWindow.DoModal();
				
				// Allow post-processing on the delegate
				if (i_ResultCode)
					return i_ResultCode(pDelegateHost, Result);
				}
			catch (error)
				{
				// Dismiss wait cursor
				pWindowManager.ShowWaitCursor(false);

				throw error;
				}
			}

		// Used to display an account subform in a dialog.
		//
		// i_pAccount - The account whose subforms should be used.
		// i_SubForm - GrooveAccountDialogsSubForms value of subform to be displayed.
		// i_pParentWindow - Parent window for dialog (normally obtained from UI property list)
		// i_Caption - Caption to display, if none is specified the default in the template is used
		// i_InitializationCode - Function to be called before dialog is displayed.
		// i_InitializationArgs - Array of arguments to be passed to the initialization function.
		// i_ResultCode - Function to be called after dialog is dismissed.
		//
		// Remarks:
		//
		// i_InitializationCode function should look like InitializationCode(i_pDelegate, i_Args)
		// i_ResultCode function should look like ResultCode(i_pDelegate, i_ResultCode)
		//
		function DisplayAccountDialog(i_pAccount, i_SubForm, i_pParentWindow, i_Caption, i_InitializationCode, i_InitializationArgs, i_ResultCode)
			{
			// Show wait cursor
			var pWindowManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
			pWindowManager.ShowWaitCursor(true);

			try
				{
				var App = GrooveScriptFunctions.CreateNewObject("Groove.Application");
				var pForm = App.Application2.CreateAccountDialogsWithSubForm(i_pAccount, i_SubForm);

				// Get the delegate
				var pDelegateHost = null;
				var pDelegate = pForm.OpenDelegateComponent();

				try
					{
					// Most delegates should be implementing an interface
					// and so we should not need to go to the script host.

					pDelegateHost = pDelegate.GetScriptDispatch();
					}
				catch (error)
					{
					// Not implemented in script code.

					pDelegateHost = pDelegate;
					}

				// Allow pre-processing on the delegate
				if (i_InitializationCode)
					i_InitializationCode(pDelegateHost, i_InitializationArgs);

				// Set up preferences for window to create
				var pWindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
				pWindowProperties.ParentWindow = i_pParentWindow;
				pWindowProperties.VisibleInTaskbar = false;
				pWindowProperties.Style = "PopupWindow";
				pWindowProperties.Caption = i_Caption;
				pWindowProperties.CloseButton = true;
				pWindowProperties.Resizable = false;
				pWindowProperties.Visible = false;

				// Create the window
				var pWindow = pWindowManager.CreateGrooveWindowForForm(i_pParentWindow.OpenWindowAccount(), "", pWindowProperties, pForm);

				// Dismiss wait cursor
				pWindowManager.ShowWaitCursor(false);

				// Show the window
				var Result = pWindow.DoModal();
				
				// Allow post-processing on the delegate
				if (i_ResultCode)
					return i_ResultCode(pDelegateHost, Result);
				}
			catch (error)
				{
				// Dismiss wait cursor
				pWindowManager.ShowWaitCursor(false);

				throw error;
				}
			}
			
		function StartBusyWindow(i_pWindow, i_Caption, i_Msg, i_Delay)
			{
			if (g_pMiscHelperObject == null)
				g_pMiscHelperObject = GrooveScriptFunctions.CreateNewObject("Groove.MiscUIHelperObject");
				 				
			return g_pMiscHelperObject.BusyWindowHelper.Start(i_Caption, i_Msg, i_pWindow, true, i_Delay);
			}
		
		function StopBusyWindow(i_BusyWindowID)
			{
			GrooveDebugFunctions.DisplayAssert(g_pMiscHelperObject != null, "You must call StartBusyWindow first.");
			g_pMiscHelperObject.BusyWindowHelper.Stop(i_BusyWindowID);
			}

		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @           §  H        ñ     %Õ  %Õ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                P               Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   R   ÄName>   G r o o v e G l o b a l H e l p e r F u n c t i o n s . g s l         ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT      ÄSCRIPT  ÄSCRIPT       ÄSRC  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T y p e L i b r a r i e s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              † A   | :      ∑          )                      @            ¶  h  ß      ®      ©                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  p               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   t   ÄName0   G r o o v e M e s s a g e B o x G l u e . g s l   t       ÄSCRIPT     ÄSCRIPT       ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       n               œ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  *    | U     ¥          )            ÄSCRIPT         î+ Ä
	var g_Button1 = null;
	var g_Button2 = null;
	var g_Button3 = null;
	var g_Style = GrooveMessageBoxStyle_OK;
	var ICON_HEIGHT = 32;

	// Handle keyboard character translation.
	function OnTranslateCharMsg(i_KeyChar, i_KeyModifiers)
	{
		// 0x1B == Escape Key
		if (0x1B == i_KeyChar)
		{
			// Select appropriate result code for style.
			var ResultCode;
			switch (g_Style)
			{
			case GrooveMessageBoxStyle_OK:
				ResultCode = GrooveMessageBoxResultCode_OK;
				break;

			case GrooveMessageBoxStyle_YesNo:
				ResultCode = GrooveMessageBoxResultCode_No;
				break;

			case GrooveMessageBoxStyle_AbortRetryIgnore:
				ResultCode = GrooveMessageBoxResultCode_Abort;
				break;

			case GrooveMessageBoxStyle_OKCancel:
			case GrooveMessageBoxStyle_YesNoCancel:
			case GrooveMessageBoxStyle_RetryCancel:
			case GrooveMessageBoxStyle_CancelTryContinue:
			default:
				ResultCode = GrooveMessageBoxResultCode_Cancel;
				break;
			}

			// Bye-bye.
			CloseWindow(ResultCode);
			return true;
		}
		else if((GrooveMessageBoxStyle_YesNo == g_Style) ||
			(GrooveMessageBoxStyle_YesNoCancel == g_Style))
		{
		    var ResultCode;
			if ((0x59 == i_KeyChar) || (0x79 == i_KeyChar))
			{
				ResultCode = GrooveMessageBoxResultCode_Yes;
				// Bye-bye.
				CloseWindow(ResultCode);
				return true;
			}
			if ((0x4E == i_KeyChar) || (0x6E == i_KeyChar))
			{
				ResultCode = GrooveMessageBoxResultCode_No;
				// Bye-bye.
				CloseWindow(ResultCode);
				return true;
			}

		}

		return false;
	}

	// Set message box style.
	function SetMessageBoxStyle(i_Style)
	{
		// Disconnect buttons, in case switching styles at runtime.
		DisconnectButtons();

		// Save style for Esc key handling.
		g_Style = i_Style;

		// Select layout and appropriate buttons.
		var LayoutName = "";
		var Button1Name = "";
		var Button2Name = "";
		var Button3Name = "";
		switch (i_Style)
		{
		case GrooveMessageBoxStyle_OK:
		default:
			LayoutName = "OKLayout";
			Button1Name = "OKButton";
			break;

		case GrooveMessageBoxStyle_OKCancel:
			LayoutName = "OKCancelLayout";
			Button1Name = "OKButton";
			Button2Name = "CancelButton";
			break;

		case GrooveMessageBoxStyle_YesNo:
			LayoutName = "YesNoLayout";
			Button1Name = "YesButton";
			Button2Name = "NoButton";
			break;

		case GrooveMessageBoxStyle_YesNoCancel:
			LayoutName = "YesNoCancelLayout";
			Button1Name = "YesButton";
			Button2Name = "NoButton";
			Button3Name = "CancelButton";
			break;

		case GrooveMessageBoxStyle_RetryCancel:
			LayoutName = "RetryCancelLayout";
			Button1Name = "RetryButton";
			Button2Name = "CancelButton";
			break;

		case GrooveMessageBoxStyle_CancelTryContinue:
			LayoutName = "CancelTryContinueLayout";
			Button1Name = "CancelButton";
			Button2Name = "TryAgainButton";
			Button3Name = "ContinueButton";
			break;

		case GrooveMessageBoxStyle_AbortRetryIgnore:
			LayoutName = "AbortRetryIgnoreLayout";
			Button1Name = "AbortButton";
			Button2Name = "RetryButton";
			Button3Name = "IgnoreButton";
			break;
		}

		// Plop in layout.
		ViewContainer.LayoutByName = LayoutName;

		// Connect to buttons and sink as appropriate.
		var Form = PropertyList.OpenProperty(PROPERTY_FORM);
		var ComponentContainer = Form.ComponentContainer;
		var ButtonHandlerName = "ButtonHandler";
		if ("" != Button1Name)
		{
			g_Button1 = ComponentContainer.OpenComponentByName(Button1Name);
			ConnectObject(g_Button1, ButtonHandlerName);
		}
		if ("" != Button2Name)
		{
			g_Button2 = ComponentContainer.OpenComponentByName(Button2Name);
			ConnectObject(g_Button2, ButtonHandlerName);
		}
		if ("" != Button3Name)
		{
			g_Button3 = ComponentContainer.OpenComponentByName(Button3Name);
			ConnectObject(g_Button3, ButtonHandlerName);
		}

		// Assign "cancel" action specially, if necessary.
		if (GrooveMessageBoxStyle_YesNo == i_Style)
		{
			g_Button2.Cancel = true;
		}
	}

	// Set message box icon.
          	function SetMessageBoxIcon(i_Icon)
	{
		// Select icon.
		//
		// NOTE: Current implementation displays some icons
		// using same image but could be improved in future
		// to display distinct images for all.
		//
		var IconFile = "";
		switch (i_Icon)
		{
		case GrooveMessageBoxIcon_Exclamation:
		case GrooveMessageBoxIcon_Warning:
			IconFile = "ExclamationIcon";
			break;

		case GrooveMessageBoxIcon_Information:
		case GrooveMessageBoxIcon_Asterisk:
			IconFile = "InformationIcon";
			break;

		case GrooveMessageBoxIcon_Stop:
		case GrooveMessageBoxIcon_Error:
		case GrooveMessageBoxIcon_Hand:
			IconFile = "StopIcon";
			break;

		case GrooveMessageBoxIcon_None:
		default:
			break;
		}

		// Update icon if selected.
		if ("" != IconFile)
		{
		// GSK_URI
		var IconPath = "ToolBMPs\\" + IconFile + ".jpg";
		var IconMaskPath = "ToolBMPs\\" + IconFile + "Mask" + ".bmp";
		var ImageURL = CreateURLFromSchemeAndPath("grooveFile", IconPath);
		var ImageMaskURL = CreateURLFromSchemeAndPath("grooveFile", IconMaskPath);
		Icon.SetImage(ImageURL, ImageMaskURL, 0, 0, ICON_HEIGHT, ICON_HEIGHT);
		}
	}

	// Set plain text into TextView rich text component.
	function SetPlainTextInTextView(i_TextView, i_PlainText)
	{
		//
		// Use rich edit component's Text Object Model (TOM)
		// access methods to set plain text into component.
		//

		// Prepare for direct TOM access
		i_TextView.Freeze(true);
		i_TextView.HideDecorations(true);

		// Retrieve TOM document
		var Cache = i_TextView.TextCache;
		var Document = Cache.Document;

		// Manipulate TOM as necessary
		var Range = Document.Range(0, tomForward);
		Range.Text = i_PlainText;

		// We don't want to specify a font facename here, since any
		// specific font we select may not support the character set
		// necessary for the current locale. So, we just specify a size
		// and let the system choose a facename for us.
		//
		Range.Font.Size = 8;

		// Done accessing TOM directly
		i_TextView.HideDecorations(false);
		Cache.Synchronize(GrooveTextCacheSyncType_Cursors);
		i_TextView.Freeze(false);
	}

	// Set actual message box text.
	function SetMessageBoxText(i_PlainText)
	{
		// Update rich text component
		SetPlainTextInTextView(MessageEdit, i_PlainText)
	}

    // Set actual message box content.
    function SetMessageBoxContent(i_Content)
    {
        if (typeof i_Content == "string")
        {
            var Prefix = "{\\rtf";
            if (i_Content.substr(0, Prefix.length) != Prefix)
                SetPlainTextInTextView(MessageEdit, i_Content);
            else
                MessageEdit.RTFContent = i_Content;
        }
        else
        {
            var Range = i_Content.Range;
            if (typeof Range != "object")
            {
                if (typeof i_Content.Element == "object")
                {
                    var TextDocument = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");
                    TextDocument.TextContent.ReadFromElement(i_Content.Element, GrooveTextContentFlag_All);
                    Range = TextDocument.Range(0, tomForward);
                    Range.MoveEnd(tomCharacter, -1);
                }
            }

            if (typeof Range == "object")
            {
                MessageEdit.TextControl.SetCursor("foo", 0, tomForward, 0);
                MessageEdit.TextControl.TypeRichText("foo", Range);
            }
        }
    }

	// Set form to display in message box.
	function SetMessageBoxDisplayForm(i_DisplayForm, i_CellHeight)
	{
		var Layout = ViewContainer.Layout;
		var TableSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.MultiCellLayoutControlInfo");
		var TableCellObj = TableSizeObj.Cell();

		// Always put icon in same cell
		TableCellObj.SetCell(1,0);
		TableSizeObj.SetHeight(90, 2);
/* This should work sometime in the future. For now just use a hardcoded name.
		var Layout = i_DisplayForm.OpenDefaultView();
		var Component = Layout.Component         ();
		var Name = Component.OpenName();
*/
		Layout.AdjustCellLayout(TableCellObj, TableSizeObj);
		Layout.AddControlByComponent("DisplayForm", i_DisplayForm, TableCellObj);
	}

	// Resize window to fit message text.
	function ResizeMessageBoxWindow(i_Window)
	{
		// Get rich text component's control size info.
		var Layout = ViewContainer.Layout;
		var ControlSizeInfo = Layout.OpenControlInfo("MessageEdit");

		// Get component's current size.
		var TextViewWidth = ControlSizeInfo.CurrentWidthInPixels;
		var TextViewHeight = ControlSizeInfo.CurrentHeightInPixels;

		// Determine required height to display text in
		// its entirety without scrollbars, given width.
		var RequiredTextViewHeight = MessageEdit.CellVisual.FitToContent(TextViewWidth);

		// Ensure that the icon height is accounted for.
		var ImageURL = Icon.ImageURL;
		if ((typeof ImageURL != "undefined") && ("" != ImageURL))
		{
			if (RequiredTextViewHeight < ICON_HEIGHT)
				RequiredTextViewHeight = ICON_HEIGHT;
		}

		// Get window's current size.
		var WindowProperties = i_Window.WindowProperties;
		var WindowWidth = WindowProperties.Width;
		var WindowHeight = WindowProperties.Height;

		// Calculate and set new window height.
		WindowHeight += (RequiredTextViewHeight - TextViewHeight);
		i_Window.SetSize(WindowWidth, WindowHeight);
	}

	// Close and destroy message box window.
	function CloseWindow(i_ResultCode)
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		Window.Close(i_ResultCode);
		Window.Destroy(i_ResultCode);
	}

	// Handle button event firing.
	function ButtonHandlerOnCommand(i_UICommand)
	{
		var CommandURL = i_UICommand.UICommand.CommandURL;

		if ("OKButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_OK);
		}
		else if ("CancelButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_Cancel);
		}
		else if ("YesButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_Yes);
		}
		else if ("NoButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_No);
		}
		else if ("TryAgainButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_TryAgain);
		}
		else if ("ContinueButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_Continue);
		}
		else if ("AbortButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_Abort);
		}
		else if ("RetryButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_Retry);
		}
		else if ("IgnoreButton" == CommandURL)
		{
			CloseWindow(GrooveMessageBoxResultCode_Ignore);
		}
	}

	function Terminate()
	{
		DisconnectButtons();
	}

	function DisconnectButtons()
	{
		if (null != g_Button1)
		{
			DisconnectObject(g_Button1);
			g_Button1 = null;
		}
		if (null != g_Button2)
		{
			DisconnectObject(g_Button2);
			g_Button2 = null;
		}
		if (null != g_Button3)
		{
			DisconnectObject(g_Button3);
			g_Button3 = null;
		}
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  œ                     @            ´  ê   ¨      ≠      Æ  p  Ø                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ò                Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   L   ÄName8   G r o o v e N a v a g a t i o n B a r G l u e 2 . g s l   {       ÄSCRIPTMODULE     ÄSCRIPT     ÄEVENT     ÄEVENT   
  ÄIMPLEMENTS	   
  ÄIMPLEMENTS     ÄSCRIPT  IPT  ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT  EMENTS  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       i o             ˆ    ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       & V  ÄEVENT       ÄDefault   1     ÄLIBIDL   { D C 0 C 3 C 8 3 - 8 D 9 0 - 4 d a 2 - 8 A 6 2 - D 9 1 4 6 2 E C A 4 6 1 }   	   ÄIIDL   { A 4 1 F 4 A 9 5 - 5 7 2 A - 4 e 0 f - 9 B 0 9 - 0 F 4 3 A D 3 B 5 B 0 A }   P       ÄEVENT       ÄLIBIDL   { D C 0 C 3 C 8 3 - 8 D 9 0 - 4 d a 2 - 8 A 6 2 - D 9 1 4 6 2 E C A 4 6 1 }   	   ÄIIDL   { 5 0 7 E 8 7 5 3 - C 4 9 4 - 1 1 d 3 - 8 1 6 B - 0 0 5 0 D A 5 F 0 8 2 9 }   n     6 B
  ÄIMPLEMENTS       ÄLIBIDL   { D C 0 C 3 C 8 3 - 8 D 9 0 - 4 d a 2 - 8 A 6 2 - D 9 1 4 6 2 E C A 4 6 1 }   	   ÄIIDL   { 5 0 7 E 8 7 5 2 - C 4 9 4 - 1 1 D 3 - 8 1 6 B - 0 0 5 0 D A 5 F 0 8 2 9 }   t       ÄSCRIPT
   8 2 9        u   
  ÄIMPLEMENTS       ÄLIBIDL   { D C 0 C 3 C 8 3 - 8 D 9 0 - 4 d a 2 - 8 A 6 2 - D 9 1 4 6 2 E C A 4 6 1 }   	   ÄIIDL   { 5 6 5 8 A 4 8 0 - A 4 E D - 4 5 1 5 - 8 1 9 8 - 5 8 5 9 F 9 A 0 A 3 1 9 }   g       ÄSCRIPT      ÄS  ÄSCRIPT         û  Ä
			function ShowUnreadIcon(i_Show)
			{
				if (i_Show)
					UnreadIcon.ImageURL = NAVBAR_IMAGE_URL;
				else
					UnreadIcon.ImageURL = "";
			}
					}
		  ÄSCRIPT         , Ä
	var g_pNavBarInstance = null;

	function Initialize()
	{
		g_pNavBarInstance = new NavigationBarInstance(ScriptHostComponent);
	}

	function CurrentObjectLabel_OnClick(i_Name)
	{
		g_pNavBarInstance.OnCurrentObjectLabelClick(i_Name, NavigationBarLayout, ObjectEditControl, CurrentObjectLabel);
	}

	function ObjectEditControl_OnSetFocus(i_Name)
	{
		//g_pNavBarInstance.OnEditSetFocus(i_Name);
	}

	function ObjectEditControl_OnReturn(i_Name)
	{
		g_pNavBarInstance.m_Editing = false;
		g_pNavBarInstance.FireEvent("Rename", ObjectEditControl.Text);
	}
	
	function ObjectEditControl_OnKillFocus(i_Name)
	{
		if (g_pNavBarInstance.m_Editing)
		{
			g_pNavBarInstance.m_Editing = false;
			ObjectEditControl_OnReturn(i_Name);
		}
	}

	function OnTranslateCharMsg(KeyChar, i_KeyModifiers)
	{
		if (g_pNavBarInstance.m_Editing == true && KeyChar == 0x1B)
		{
			g_pNavBarInstance.m_Editing=false;
			ShowComponentExt(OBJECT_TITLE, false);
			return true;
		}
		return false;
	}

	function LabelChangeDeltaInfo(LabelName, NewValue)
	{
		g_pNavBarInstance.LabelChangeDeltaInfo(LabelName, NewValue, PropertyList, ArtifactEngine);
	}

	function HideShowDeltaInfo(ComponentName, Value)
	{
		g_pNavBarInstance.HideShowDeltaInfo(ComponentName, Value);
	}
	
	function SizeDeltaInfo(ComponentName, Value)
	{
		g_pNavBarInstance.SizeDeltaInfo(ComponentName, Value, PropertyList, ArtifactEngine);
	}
	
	function ArtifactEngine_OnElementChange(i_pElement)
   	{		
		g_pNavBarInstance.OnArtifactEngineElementChange(i_pElement);
	}
	                                                                                                                                                         XG   ¯π    Ñ·    ~    ·    †Õ    0‡    ÑU   z    Ã U   ¨ :               )            ÄSCRIPT         ª( Ä
			var pIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
			var pBundle = pIntl.CreateResourceBundle("http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.ToolComponents.NavigationBar_RBD&Version=0", pIntl.DefaultLocale);
			//var pBundle = PropertyList.OpenProperty(PROPERTY_RESOURCE_BUNDLE);

			function NavigationBarInstance(i_ScriptHostComponent)
			{
				// Function initialization
				this.SetAllowRenameEvent = raw_SetAllowRenameEvent;
				this.GetAllowRenameEvent = raw_GetAllowRenameEvent;
				this.ShowComponentExt = raw_ShowComponentExt;
				this.HideComponentExt = raw_HideComponentExt;
				this.SetComponentWidthExt = raw_SetComponentWidthExt;
				this.SetTextExt = raw_SetTextExt;
				this.FireEvent = raw_FireEvent;
				this.LabelChangeDeltaInfo = raw_LabelChangeDeltaInfo;
				this.OnCurrentObjectLabelClick = raw_OnCurrentLabelClick;
				//this.OnEditSetFocus = raw_OnEditSetFocus;
								
				// Member Initialization
				this.m_AllowRenameEvent = false;
				this.m_Editing = false;
				this.m_ScriptHostComponent = i_ScriptHostComponent;

			}

			function raw_SetAllowRenameEvent(i_Allow)
			{
				this.m_AllowRenameEvent = i_Allow;
			}

			function raw_GetAllowRenameEvent()
			{
				return this.m_AllowRenameEvent;
			}

			function raw_ShowComponentExt(Name, bDoDelta, NavigationBarLayout)
			{
				var TableSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.HTMLTableLayoutControlInfo");
				var TableCell = TableSizeObj.Cell();
				var CompName;
				
				if ((Name == OBJECT_TITLE) || (Name == "CurrentObjectLabel"))
				{
					TableCell.Name = "ObjectLabel";
					CompName = "CurrentObjectLabel";
				}
				else if ((Name == MIDDLE_BUTTON) || (Name == "MiddleButton"))
				{
					TableCell.Name="MiddleButton";;
					CompName = "MiddleButton";
				}
				else if ((Name == PREVIOUS_BUTTON) || (Name == "PreviousButton"))
				{
					TableCell.Name="PreviousButton";
					CompName = "PreviousButton";
				}
				else if ((Name == PAGE_COUNT) || (Name == "PageCountLabel"))
				{
					TableCell.Name="PageCountLabel";
					CompName = "PageCountLabel";
				}
				else if ((Name == NEXT_BUTTON) || (Name == "NextButton"))
				{
					TableCell.Name="NextButton";
					CompName = "NextButton";
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox(SubstituteArrayValuesInString(GetString(pBundle, "NvgtnBr_SMB_UNKCMP"), new Array(Name)));
					return;
				}

				if (bDoDelta == true)
					HideShowDeltaInfo(Name, "Show");
				else
					NavigationBarLayout.AddControlByName(CompName, TableCell);
			}

			function raw_HideComponentExt(Name, bDoDelta, NavigationBarLayout)
			{
				var CompName;
				
				if (Name == OBJECT_TITLE)
				{
					CompName = "CurrentObjectLabel";
				}
				else if (Name == MIDDLE_BUTTON)
				{
					CompName = "MiddleButton";
				}
				else if (Name == PREVIOUS_BUTTON)
				{
					CompName = "PreviousButton";
				}
				else if (Name == PAGE_COUNT)
				{
					CompName = "PageCountLabel";
				}
				else if (Name == NEXT_BUTTON)
				{
					CompName = "NextButton";
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox(SubstituteArrayValuesInString(GetString(pBundle, "NvgtnBr_SMB_UNKCMP"), new Array(Name)));
					return;
				}

				if (bDoDelta == true)
					HideShowDeltaInfo(Name, "Hide");
				else
					NavigationBarLayout.RemoveControl(CompName);
			}

			function raw_SetComponentWidthExt(Name, Width, bDoDelta, NavigationBarLayout)
			{
				var TableSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.HTMLTableLayoutControlInfo");
				TableSizeObj.SetWidth(Width, GrooveLayoutSizeType_Pixels);
				var CompName;
				
				if ((Name == OBJECT_TITLE) || (Name == "CurrentObjectLabel"))
				{
					CompName = "CurrentObjectLabel";
				}
				else if ((Name == MIDDLE_BUTTON) || (Name == "MiddleButton"))
				{
					CompName = "MiddleButton";
				}
				else if ((Name == PREVIOUS_BUTTON) || (          Name == "PreviousButton"))
				{
					CompName = "PreviousButton";
				}
				else if ((Name == PAGE_COUNT) || (Name == "PageCountLabel"))
				{
					CompName = "PageCountLabel";
				}
				else if ((Name == NEXT_BUTTON) || (Name == "NextButton"))
				{
					CompName = "NextButton";
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox(SubstituteArrayValuesInString(GetString(pBundle, "NvgtnBr_SMB_UNKCMP"), new Array(Name)));
					return;
				}

				if (bDoDelta == true)
					SizeDeltaInfo(Name, Width);
				else
					NavigationBarLayout.AdjustControlLayout(CompName, TableSizeObj);
			}

			function raw_SetTextExt(LabelObject, Value, bDoDelta)
			{
				LabelObject.SetText(Value)
				if (bDoDelta)
					LabelDeltaInfo(LabelName, Value);
			}

			function raw_FireEvent(EventName, Parameter)
			{
				this.m_ScriptHostComponent.FireEvent("", EventName, Parameter);
				this.m_ScriptHostComponent.FireEvent("[IGrooveNavigationBarListener]", EventName, Parameter);
			}

			function raw_LabelChangeDeltaInfo(LabelName, NewValue, PropertyList, ArtifactEngine)
			{
				var Element = CreateNewElement("Changes");
				
				if (LabelName == OBJECT_TITLE)
				{
					Name = "CurrentObjectLabel";
				}
				else if (LabelName == PAGE_COUNT)
				{
					Name = "PageCountLabel";
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox(SubstituteArrayValuesInString(GetString(pBundle, "NvgtnBr_SMB_UNKCMP"), new Array(Name)));
					return;
				}
				Element.SetAttribute("Name", Name);
				Element.SetAttribute("Value", NewValue);
				
				var dynMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
				var gDelta = dynMgr.CreateDelta();
				
				ArtifactEngine.GenerateElementChangeCommand(gDelta, Element);
				dynMgr.DoDelta(gDelta);
			}

			function raw_HideShowDeltaInfo(ComponentName, Value, PropertyList, ArtifactEngine)
			{
				var Element = CreateNewElement("HideShow");
				
				if (ComponentName == OBJECT_TITLE)
				{
					Name = "CurrentObjectLabel";
				}
				else if (ComponentName == MIDDLE_BUTTON)
				{
					Name = "MiddleButton";
				}
				else if (ComponentName == PREVIOUS_BUTTON)
				{
					Name = "PreviousButton";
				}
				else if (ComponentName == PAGE_COUNT)
				{
					Name = "PageCountLabel";
				}
				else if (ComponentName == NEXT_BUTTON)
				{
					Name = "NextButton";
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox(SubstituteArrayValuesInString(GetString(pBundle, "NvgtnBr_SMB_UNKCMP"), new Array(ComponentName)));
					return;
				}
				Element.SetAttribute("Name", Name);
				Element.SetAttribute("HSValue", Value);

				var dynMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
				var gDelta = dynMgr.CreateDelta();
				
				ArtifactEngine.GenerateElementChangeCommand(gDelta, Element);
				dynMgr.DoDelta(gDelta);
			}

			function raw_SizeDeltaInfo(ComponentName, Value, PropertyList, ArtifiactEngine)
			{
					var Element = CreateNewElement("WidthSize");
				
				if (ComponentName == OBJECT_TITLE)
				{
					Name = "CurrentObjectLabel";
				}
				else if (ComponentName == MIDDLE_BUTTON)
				{
					Name = "MiddleButton";
				}
				else if (ComponentName == PREVIOUS_BUTTON)
				{
					Name = "PreviousButton";
				}
				else if (ComponentName == PAGE_COUNT)
				{
					Name = "PageCountLabel";
				}
				else if (ComponentName == NEXT_BUTTON)
				{
					Name = "NextButton";
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox(SubstituteArrayValuesInString(GetString(pBundle, "NvgtnBr_SMB_UNKCMP"), new Array(ComponentName)));
					return;
				}
				Element.SetAttribute("Name", Name);
				Element.SetAttribute("Value", Value);

				var dynMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
				var gDelta = dynMgr.CreateDelta();
				
				ArtifactEngine.GenerateElementChangeCommand(gDelta, Element);
				dynMgr.DoDelta(gDelta);
			}

			function raw_DoCommandHideShow(i_pElement, Name)
			{
				if (i_pElement.DoesAttributeExist("HSVa      x  lue"))
				{
					var HSValue = i_pElement.OpenAttribute("HSValue");
					if (HSValue == "Hide")
					{
						HideComponentExt(Name, false);
					}
					if (HSValue == "Show")
					{
						ShowComponentExt(Name, false);
					}
				}
			}

			function raw_OnArtifactEngineElementChange(i_pElement)
			{
				var Name = i_pElement.OpenAttribute("Name");
				var Command = i_pElement.OpenName();
				
				if (Command == "WidthSize")
				{
					var Value = i_pElement.OpenAttribute("Value");
					SetComponentWidthExt(Name, Value, false);
					return;
				}

				if (Name == "CurrentObjectLabel")
				{
					if (i_pElement.DoesAttributeExist("Value"))
					{
						var Value = i_pElement.OpenAttribute("Value");
						CurrentObjectLabel.SetText(Value);
						return;
					}
					DoCommandHideShow(i_pElement, Name);
					
				}
				else if (Name == "MiddleButton")
				{
					DoCommandHideShow(i_pElement, Name);
				}
				else if (Name == "PreviousButton")
				{
					DoCommandHideShow(i_pElement, Name);
				}
				else if (Name == "PageCountLabel")
				{
					if (i_pElement.DoesAttributeExist("Value"))
					{
						var Value = i_pElement.OpenAttribute("Value");
						PageCountLabel.SetText(Value);
					}
					else
						DoCommandHideShow(i_pElement, Name);
				}
				else if (Name == "NextButton")
				{
					DoCommandHideShow(i_pElement, Name);
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox(SubstituteArrayValuesInString(GetString(pBundle, "NvgtnBr_SMB_UNKCMP"), new Array(Name)));
				}					
			}

			function raw_OnCurrentLabelClick(i_Name, NavigationBarLayout, ObjectEditControl, CurrentObjectLabel)
			{
				if (this.m_AllowRenameEvent == false)
					return;

				var TableSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.HTMLTableLayoutControlInfo");
				var TableCellObj = TableSizeObj.Cell();
				TableCellObj.Name="ObjectLabel";

				// put edit control into cell
				NavigationBarLayout.AddControlByName("ObjectEditControl", TableCellObj);
				ObjectEditControl.Text = CurrentObjectLabel.GetText();
				this.m_Editing = true;

				// sink edit control's event
				
				// get edit control's value and fire an event
			}

			function raw_OnEditSetFocus()
			{
			
			}

			  ew Array(i_ButtonName)));
			}
			function GetIsEditing()
			{
				return g_pNavBarInstance.m_Editing;
			}
			                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Åu     ˆ           ÄSCRIPT	         J Ä
			var pIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
			var pBundle = pIntl.CreateResourceBundle("http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.ToolComponents.NavigationBar_RBD&Version=0", pIntl.DefaultLocale);
			//var pBundle = PropertyList.OpenProperty(PROPERTY_RESOURCE_BUNDLE);
			
			var NAVBAR_IMAGE_URL = GetString(pBundle,"NvgtnBr_IU_UNRICO");

			function SetAllowRenameEvent(Bool)
			{
				g_pNavBarInstance.SetAllowRenameEvent(Bool);	
			}

			function GetAllowRenameEvent()
			{
				return g_pNavBarInstance.GetAllowRenameEvent();
			}

			function ShowComponent(Name)
			{
				ShowComponentExt(Name, true);
			}

			function HideComponent(Name)
			{
				HideComponentExt(Name, true);
			}

			function SetComponentWidth(Name, Width)
			{
				SetComponentWidthExt(Name, Width, true);
			}

			function ShowComponentExt(Name, bDoDelta)
			{
				g_pNavBarInstance.ShowComponentExt(Name, bDoDelta, NavigationBarLayout);
			}

			function HideComponentExt(Name, bDoDelta)
			{
				g_pNavBarInstance.HideComponentExt(Name, bDoDelta, NavigationBarLayout);
			}

			function SetComponentWidthExt(Name, Width, bDoDelta)
			{
				g_pNavBarInstance.SetComponentWidthExt(Name, Width, bDoDelta, NavigationBarLayout);
			}

			function SetMiddleButtonLabel(Value)
			{
				MiddleButton.Label = Value
			}
			

			function SetMiddleButtonToolTip(Value)
			{
				MiddleButton.Tooltip = Value
			}

			function SetText(LabelName, strValue)
			{
				SetTextExt(LabelName, strValue, true);
			}

			function SetTextEx(LabelName, strValue, bDoDelta)
			{
				if (LabelName == OBJECT_TITLE)
				{
					g_pNavBarInstance.SetTextExt(CurrentObjectLabel, strValue, bDoDelta);
				}
				else if (LabelName == PAGE_COUNT)
				{
					g_pNavBarInstance.SetTextExt(PageCountLabel, strValue, bDoDelta);
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox("No label of that name.");
				}
			}

			function GetText(LabelName)
			{
				if (LabelName == OBJECT_TITLE)
				{
					return CurrentObjectLabel.GetText();
				}
				else if (LabelName == PAGE_COUNT)
				{
					return PageCountLabel.GetText();
				}
				else
				{
					GrooveScriptFunctions.DoMessageBox(GetString(pBundle, "NvgtnBr_SMB_NOLBL"));
				}
			}

			function MiddleButton_OnCommand(i_UICommand)
			{
				g_pNavBarInstance.FireEvent("ButtonClicked", MIDDLE_BUTTON);
			}

			function NextButton_OnCommand(i_UICommand)
			{
				g_pNavBarInstance.FireEvent("ButtonClicked", NEXT_BUTTON);
			}

			function PreviousButton_OnCommand(i_UICommand)
			{
				g_pNavBarInstance.FireEvent("ButtonClicked", PREVIOUS_BUTTON);
			}
			
			function LabelChangeDeltaInfo(LabelName, NewValue)
			{
				g_pNavBarInstance.LabelChangeDeltaInfo(LabelName, NewValue, PropertyList, ArtifactEngine);
			}

			function HideShowDeltaInfo(ComponentName, Value)
			{
				g_pNavBarInstance.HideShowDeltaInfo(ComponentName, Value);
			}
			
			function SizeDeltaInfo(ComponentName, Value)
			{
				g_pNavBarInstance.SizeDeltaInfo(ComponentName, Value, PropertyList, ArtifactEngine);
			}
			
			function DoCommandHideShow(i_pElement, Name)
			{
				g_pNavBarInstance.DoCommandHideShow(i_pElement, Name);
			}

			function ArtifactEngine_OnElementChange(i_pElement)
   			{		
				g_pNavBarInstance.OnArtifactEngineElementChange(i_pElement);
			}
			function SetTextColor(i_RGBValue)
			{
				
				PageCountLabel.TextColor=i_RGBValue;
				CurrentObjectLabel.TextColor=i_RGBValue;
			}
			function EnableButton(i_ButtonName, i_bEnable)
			{
				if (i_ButtonName == MIDDLE_BUTTON)
					MiddleButton.Enabled = i_bEnable;
				else if (i_ButtonName == NEXT_BUTTON)
					NextButton.Enabled = i_bEnable;
				else if (i_ButtonName == PREVIOUS_BUTTON)
					PreviousButton.Enabled = i_bEnable;
				else
					GrooveScriptFunctions.DoMessageBox(SubstituteArrayValuesInString(GetString(pBundle, "NvgtnBr_SMB_UNKBTN"), n          	            @            ±  ®	  ≤      ≥      ¥    µ      ∂      ∑      ∏      π  †	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  ∞	               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   e   ÄName4   G r o o v e P a s s w o r d F i l e G l u e . g s l   
       ÄSCRIPT     ÄSCRIPT   
  ÄIMPLEMENTS   
  ÄIMPLEMENTS     ÄSCRIPT	      ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       s i  ÄSCRIPT       ÄSRC*  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e F i l e H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       o n
  ÄIMPLEMENTS       ÄLIBIDL   { D C 0 C 3 C 8 3 - 8 D 9 0 - 4 d a 2 - 8 A 6 2 - D 9 1 4 6 2 E C A 4 6 1 }   N   ÄIIDL   { 8 1 2 7 7 1 B 8 - 9 E 0 1 - 4 b 9 0 - B 2 6 6 - C 0 9 A 3 8 5 0 3 3 B 4 }   	       ÄSCRIPT   3 B 4              ∏  
  ÄIMPLEMENTS       ÄDefault   1     ÄLIBIDL   { D C 0 C 3 C 8 3 - 8 D 9 0 - 4 d a 2 - 8 A 6 2 - D 9 1 4 6 2 E C A 4 6 1 }   N   ÄIIDL   { 6 4 5 8 1 5 B D - 5 0 9 1 - 4 2 c 9 - 8 4 3 3 - 4 D F 6 D A A B 7 6 E 2 }   e       ÄSCRIPT            3                  	  H                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Ú     Í    lÙ    b    Ï·    DM   ò U     Ì          )            ÄSCRIPT         }" Ä

	// ************************************************************
	// IGrooveTelespaceBackupRestoreDelegate
	// ************************************************************

	function InitializeForBackup(i_pITelespace, i_SaveAsType, i_InitialFileName)
		{
		//g_OpenMode = false;
		g_pTelespace = i_pITelespace;
		g_FileName = i_InitialFileName;
		g_SaveAsType = i_SaveAsType;

		//Disable radio buttons for Archives
		if (i_SaveAsType == GrooveSaveWorkspaceAsType_Archive)
		{
			CheckboxLabel.SetText(GetString(g_pBundle, "PwdFile_S_CLA"));
			PasswordCheckbox.Label = GetString(g_pBundle, "PwdFile_BT_PPA");
			DisableDataOptions();
			
			RTFHelpProvider.SetHelpID(4, 94678, 0);
		}
		else
			RTFHelpProvider.SetHelpID(4, 31971, 0);
		}

	function Restore(i_FileName, i_Navigate, i_pIdentity)
		{
		var pFileBIS = null;
		var pTelespace = GrooveScriptFunctions.CreateNewObject("");
		var Passphrase = "";
		var pDeserializationResult;
		var pWindowsManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		var pIWin32FileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
		var pIFileSystemObject = pIWin32FileSystemServices.OpenFileSystemObject(i_FileName);

		// Get a safe window
		var pWindow = null;
		if (UIPropertyList.PropertyExists(UIPROPERTY_TOP_LEVEL_WINDOW))
			pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		else
			pWindow = GrooveScriptFunctions.CreateNewObject("");

		if (!DoesFileExist(i_FileName, pWindow))
			return pTelespace;
			
		//Prevent restoring non-.gsa b/c the error that is thrown ("Parameter is incorrect.") is too generic
		var Extension = pIFileSystemObject.Extension;
		if (Extension.toLowerCase() != "gsa")
			{
			MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_Restore_FTNS_Error"), GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
			return GrooveScriptFunctions.CreateNewObject("");	
			}
		
		//AELATER2 (Erin?) - this code needs to be restructured, so that telespace restore and error handling
		// are done in one place
		
		var pIdentity = null;
		
		try
			{
			try
				{
				// Get the identity to use
				if(i_pIdentity)
					pIdentity = i_pIdentity;
				else
					pIdentity = OpenIdentity();
				
				// Get an input stream
				pFileBIS = CreateByteInputStreamFromFile(i_FileName);
				
				pWindowsManager.ShowWaitCursor(true);
				// See if we need to prompt for the password
				pDeserializationResult = g_pAccount.IGrooveTelespaceProvider2.Restore(pFileBIS, pIdentity, "", GrooveTelespaceDeserializationFlag_ReportStatistics);
				}
			catch (e)
				{
				// Close the stream
				if (pFileBIS != null && (typeof(pFileBIS) != "undefined"))
					pFileBIS.Close();
					
				var E_FAIL = -2147467259;
					
				if (e.number == TELESPACESERVICESALPHA_E_UNKNOWN_TELESPACE_TYPE)
				{
					MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_WTNI"), GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_CCW"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
					return GrooveScriptFunctions.CreateNewObject("");
				}
				
				else if (e.number == TELESPACESERVICESALPHA_E_TELESPACE_TEMPLATE_IS_NOT_INSTALLED)
				{
					MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_NV"), GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_CAW"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
					return GrooveScriptFunctions.CreateNewObject("");
				}

				else if (e.number == TELESPACESERVICESALPHA_E_MINIMUM_TELESPACE_TEMPLATE_SETTING_IS_NOT_SATISFIED)
				{
					MessageBox(pWindow, g_pAccount, GetMinimumTelespaceTemplateVersionMessageString(pIdentity), GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
					return GrooveScriptFunctions.CreateNewObject("");
				}

				else if (e.number           == E_FAIL)
				{
					MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_Restore_WAIC_Error"), GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
					return GrooveScriptFunctions.CreateNewObject("");
				}

				else if (e.number != TELESPACESERVICESALPHA_E_INVALID_PASSPHRASE)
				{
					MessageBox(pWindow, g_pAccount, e.description, GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
					return GrooveScriptFunctions.CreateNewObject("");
				}
				
				var PasswordNotProvided = true;
				// Get an input stream
				while (PasswordNotProvided)
				{
					try
						{
						var pResult = ShowPasswordDialog(pWindow, i_FileName);
						if (GrooveDialogBoxResultCode_OK == pResult.Result)
							Passphrase = pResult.Data;
						else
						{
							return pTelespace;
						}
				
						// The user may have hit Cancel if we prompted
						if (pIdentity == null)
							return pTelespace;

						// Show a wait cursor
						pWindowsManager.RestoreWaitCursor();

						// Get an input stream
						pFileBIS = CreateByteInputStreamFromFile(i_FileName);
						
						// Restore the shared space
						pDeserializationResult = g_pAccount.IGrooveTelespaceProvider2.Restore(pFileBIS, pIdentity, Passphrase, GrooveTelespaceDeserializationFlag_ReportStatistics);
						if (pDeserializationResult.Status == GrooveTelespaceDeserializationStatus_Completed)
							PasswordNotProvided = false;
						}
					catch(e)
						{
							// Close the stream
							if (pFileBIS != null && (typeof(pFileBIS) != "undefined"))
								pFileBIS.Close();
								
							if (e.number == TELESPACESERVICESALPHA_E_INVALID_PASSPHRASE)
								MessageBox(pWindow, g_pAccount, e.description, GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
								
							else if (e.number == TELESPACESERVICESALPHA_E_UNKNOWN_TELESPACE_TYPE)
							{
								MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_WTNI"), GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_CCW"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
								return GrooveScriptFunctions.CreateNewObject("");
							}

							else if (e.number == TELESPACESERVICESALPHA_E_MINIMUM_TELESPACE_TEMPLATE_SETTING_IS_NOT_SATISFIED)
							{
								MessageBox(pWindow, g_pAccount, GetMinimumTelespaceTemplateVersionMessageString(pIdentity), GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
								return GrooveScriptFunctions.CreateNewObject("");
							}

							else if (e.number == E_FAIL)
							{
								MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_Restore_WAIC_Error"), GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
								return GrooveScriptFunctions.CreateNewObject("");
							}

							else
							{
								MessageBox(pWindow, g_pAccount, e.description, GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
								return GrooveScriptFunctions.CreateNewObject("");
							}
						}
					}
				}
				
				// Generate a new name
				if (pDeserializationResult.Status == GrooveTelespaceDeserializationStatus_Completed)
					{
					// Get the telespace
					pTelespace = pDeserializationResult.Telespace;

					// Add the prefix if this is an archive
					var pTelespaceDeserializationContext = pDeserializationResult.DeserializationContext;
					var IsTemplate = pTelespaceDeserializationContext.SerializationFlags & GrooveTelespaceSerializationFlag_AsTemplate;
					if (!IsTemplate)
						{
						// Get the current display name
						var FormatString = GetString(g_pBundle, "PwdFile_S_Prefix");
						var NewName = SubstituteArrayValuesInString(FormatString, new Ar      ¯  ray(pTelespace.DisplayName));

						// Generate a unique'ish new name
						NewName = g_pAccount.TelespaceProvider.GenerateTelespaceDisplayName(NewName);

						// Set the new name
						pTelespace.DisplayName = NewName;
						}

					if (i_Navigate)
						{
						var URL = pTelespace.BindableURL;
						NavigateToSpace(URL);
						}
					}

			// Close the stream
			if (pFileBIS != null && (typeof(pFileBIS) != "undefined"))
				pFileBIS.Close();
				
			// Remove the wait cursor
			pWindowsManager.ShowWaitCursor(false);

			// Return the telespace
			return pTelespace;
			}
		catch(e)
			{
			return GrooveScriptFunctions.CreateNewObject("");
			}
		}


	a message to the user					
				MessageBox(pWindow, g_pAccount, e.description, RestoreToolMsgTitle, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);

				return pTool;
			}
	
			var PasswordNotProvided = true;
			
			while (PasswordNotProvided)
			{
				var pResult = ShowPasswordDialog(pWindow, i_FileName);
				if (GrooveDialogBoxResultCode_OK == pResult.Result)
					Passphrase = pResult.Data;
				else
				{
					return pTool;
				}
				
				try
				{
					pWindowsManager.ShowWaitCursor();
			
					// Try again with password
					pFileBIS = CreateByteInputStreamFromFile(i_FileName);
					pTool = pToolUIHelper.AddFromStream(pWindow, pFileBIS, Passphrase, OwnerToolName, pTelespaceDescriptor.Telespace, g_pAccount);
					PasswordNotProvided = false;
				}
				catch(e)
				{
					// Close the stream
					if (pFileBIS != null && (typeof(pFileBIS) != "undefined"))
						pFileBIS.Close();
						
					pWindowsManager.ShowWaitCursor(false);
			
					// If the error is "incorrect password", display a message box and retry; otherwise get out.
					if (e.number == TOOLUIHELPEROBJECT_E_INVALID_PASSPHRASE)
						MessageBox(pWindow, g_pAccount, e.description, RestoreToolMsgTitle, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
					else
					{
						// Display a message to the user							
						MessageBox(pWindow, g_pAccount, e.description, RestoreToolMsgTitle, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);

						return pTool;
					}
				}
			}
		}	
		
		// Close the stream
		if (pFileBIS != null && (typeof(pFileBIS) != "undefined"))
			pFileBIS.Close();
			
		pWindowsManager.ShowWaitCursor(false);
			
		if (i_Navigate)
			NavigateToSpace(pTelespaceDescriptor.Telespace.BindableURL);
		
		// Return the tool
		return pTool;
		}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             a3    ∏           ÄSCRIPT          Ä

	// ************************************************************
	// IGrooveToolBackupRestoreDelegate
	// ************************************************************

	function InitializeForBackup(i_pITool, i_SaveAsType, i_InitialFileName)
		{
		g_pTool = i_pITool;
		g_FileName = i_InitialFileName;
		g_SaveAsType = i_SaveAsType;

		RemoveDataOptions();
		
		if (i_SaveAsType == GrooveSaveToolAsType_Archive)
			PasswordCheckbox.Label = GetString(g_pBundle, "PwdFile_BT_PPA");

		// Setup help
		RTFHelpProvider.SetHelpID(4, 39252, 0);
		}

	function Restore(i_FileName, i_pTelespaceDescriptor, i_OwnerToolName, i_Navigate)
		{
		var pFileBIS = null;
		var Passphrase = "";
		var OwnerToolName = i_OwnerToolName;
		var pTool = GrooveScriptFunctions.CreateNewObject("");
		var pWindowsManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		var pIWin32FileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
		var pIFileSystemObject = pIWin32FileSystemServices.OpenFileSystemObject(i_FileName);

		// Get a safe window
		var pWindow = null;
		if (UIPropertyList.PropertyExists(UIPROPERTY_TOP_LEVEL_WINDOW))
			pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		else
			pWindow = GrooveScriptFunctions.CreateNewObject("");
			
		if (!DoesFileExist(i_FileName, pWindow))
			return pTool;
			
		////Prevent restoring non-.gta b/c the error that is thrown ("Parameter is incorrect.") is too generic
		var Extension = pIFileSystemObject.Extension;
		if (Extension.toLowerCase() != "gta")
			{
			MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_Restore_FTNS_Error"), GetString(g_pBundle, "PwdFile_S_RestoreTool_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
			return GrooveScriptFunctions.CreateNewObject("");	
			}
		
		// If a telespace descriptor is not provided, display the space picker dialog
		var pTelespaceDescriptor;
		if (i_pTelespaceDescriptor == null)
		{
			var pTelespaceHelper = GrooveScriptFunctions.CreateNewObject("Groove.TelespaceUIHelperObject");
			var pPaneFilter = GrooveScriptFunctions.CreateNewObject("");
			//65544 == GrooveSelectorPaneStyle_SimpleMode | GrooveSpaceSelectorPaneStyle_HideConnectedSpaces
			pTelespaceDescriptor = pTelespaceHelper.DisplayTelespaceSelectorDialog(pWindow, g_pAccount, 65544, pPaneFilter);
		}
		else
			pTelespaceDescriptor = i_pTelespaceDescriptor;

		// Get out if a space hasn't been selected
		if (pTelespaceDescriptor == null)
			return pTool;
			
		// Verify that we can restore tools into this telespace
		var pToolHelper = GrooveScriptFunctions.CreateNewObject("Groove.ToolHelperObject");
		if (!pToolHelper.CanRestore(pTelespaceDescriptor))
			{
			MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_RestoreTool_Error"), GetString(g_pBundle, "PwdFile_S_RestoreTool_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
			return pTool;
			}
		
		if (OwnerToolName == "")
		{
			var pToolContainer = pTelespaceDescriptor.Telespace.ToolContainer;
			var pRootTool = pToolContainer.OpenToolByCategory("RootDisplay");
			OwnerToolName = pRootTool.Name;
		}

		// Add the tool
		var pToolUIHelper = GrooveScriptFunctions.CreateNewObject("Groove.ToolUIHelperObject");
		
		try
		{
			pWindowsManager.ShowWaitCursor();
			
			// Get an input stream
			pFileBIS = CreateByteInputStreamFromFile(i_FileName);
			pTool = pToolUIHelper.AddFromStream(pWindow, pFileBIS, Passphrase, OwnerToolName, pTelespaceDescriptor.Telespace, g_pAccount);
		}
		catch(e)
		{
			pWindowsManager.ShowWaitCursor(false);
			
			// Close the stream
			if (pFileBIS != null && (typeof(pFileBIS) != "undefined"))
				pFileBIS.Close();

			var RestoreToolMsgTitle = GetString(g_pBundle, "PwdFile_S_RestoreTool_Title");
			
			// If the error isn't "incorrect password", put up an error message
			if (e.number != TOOLUIHELPEROBJECT_E_INVALID_PASSPHRASE)
			{
				// Display             ÄSCRIPT         ˝5 Ä

	// ********************************************************
	// Global variables
	// ********************************************************

	var g_Directory = "";
	//var g_OpenMode = false;
	var g_pAccount = null;
	var g_pTelespace = null;
	var g_pTool = null;
	var g_pBundle = PropertyList.OpenProperty(PROPERTY_RESOURCE_BUNDLE);
	var g_FileName;
	var g_IncludeContent = false;
	var g_IncludeMembers = false;
	var g_SaveAsType;

	var EXTENSION		 = GetString(g_pBundle, "PwdFile_S_Extension");
	var BROWSE_FILTER    = GetString(g_pBundle, "PwdFile_S_BrseFilter");
	var PASSPHRASECHAR_TITLE		= GetString(g_pBundle, "PwdFile_S_PassphraseChar_Title");
	var PASSPRHRASEMATCHCHAR_ERROR	= GetString(g_pBundle, "PwdFile_S_PassphraseMatchChar_Error");
	var PASSPRHRASEEMPTYCHAR_ERROR	= GetString(g_pBundle, "PwdFile_S_PassphraseEmptyChar_Error");
	var CREATEFILE_ERROR_TITLE = GetString(g_pBundle, "PwdFile_S_CreateFileError_Title");
	var CREATEFILE_ERROR_MESSAGE = GetString(g_pBundle, "PwdFile_S_CreateFileError_Message");
	var INVALIDFILE_ERROR_TITLE= GetString(g_pBundle, "PwdFile_S_PathChar_Title");
	var FILENOTFOUND_ERROR_MESSAGE	= GetString(g_pBundle, "PwdFile_S_FileDoesNotExists_Error");
	var LAST_DIRECTORY_PROPERTY = "LastDirectory";
	var IDS_DEFAULT_CONTACT_FULL_NAME_FOR_TSP_TEMPLATE_SERIALIZATION = 2410;

	// ********************************************************
	// Local functions
	// ********************************************************

	function DoesFileExist(i_FileName, i_pWindow)
		{
        var pWin32FileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
		if (!pWin32FileSystemServices.DoesFileExist(i_FileName))
            {
			var ErrorMessage = SubstituteArrayValuesInString(FILENOTFOUND_ERROR_MESSAGE, new Array(i_FileName));
			App.GrooveMessageBox(i_pWindow, g_pAccount, ErrorMessage, INVALIDFILE_ERROR_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
				
            return false;
            }
            
		return true;
		}

	function OpenIdentity()
		{
		var pIdentity = null;

		// See if there is only one identity in the account
		var pIdentityEnum = g_pAccount.CreateIdentityEnum();
		var pSingleIdentity = pIdentityEnum.OpenNext();
		if (!pIdentityEnum.HasMore())
			pIdentity = pSingleIdentity;
		else
			{
			if (UIPropertyList.PropertyExists(UIPROPERTY_TOP_LEVEL_WINDOW))
				pIdentity = DisplayAccountDialog(g_pAccount, GrooveAccountDialogsSubForms_IdentitySelectorSubForm, UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW), "", IdentitySelectorDelegateInitialization, [], IdentitySelectorDelegateResult);
			else
				pIdentity = g_pAccount.DefaultIdentity;
			}

		// Return the identity the user has chosen
		return pIdentity;
		}

	function PerformExport()
		{		
		if (g_SaveAsType == GrooveSaveToolAsType_Archive)
			SaveTool(false);
		else if (g_SaveAsType == GrooveSaveToolAsType_Template)
			SaveTool(true);
		else
			{
			var WaitMessage = "";
			if (g_SaveAsType == GrooveSaveWorkspaceAsType_Template)
				WaitMessage = GetString(g_pBundle, "PwdFile_S_GSA_Template_BusyWindowMessage");
			else
				WaitMessage = GetString(g_pBundle, "PwdFile_S_GSA_Archive_BusyWindowMessage");
			
			// Show the busy window as this may take some time
			var pBusyWindow = GrooveScriptFunctions.CreateNewObject("Groove.MiscUIHelperObject").BusyWindowHelper;
			var BusyWindowID = pBusyWindow.Start(g_pTelespace.DisplayName, WaitMessage, UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW));
			
			try
				{
				var TelespaceSerializationFlags = GrooveTelespaceSerializationFlag_Backup;
				if (g_SaveAsType == GrooveSaveWorkspaceAsType_Template)
					{
					TelespaceSerializationFlags += GrooveTelespaceSerializationFlag_AsTemplate;

					if (!g_IncludeContent)
						TelespaceSerializationFlags += GrooveTelespaceSerializationFlag_NoToolData;

					if (!g_IncludeMembers)
						TelespaceSerializationFlags += GrooveTelespaceSerialization          Flag_NoMembers;
					}

				var Password;
				if (PasswordCheckbox.checkstate == GrooveCheckState_Checked)
					Password = Passphrase.Text;
				var pParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
				var pTelespaceHelper = GrooveScriptFunctions.CreateNewObject("Groove.TelespaceUIHelperObject");
				pTelespaceHelper.SaveAsTemplate(pParentWindow, g_pAccount, g_pTelespace.Descriptor, TelespaceSerializationFlags, Password, g_FileName);

				// Dismiss the busy window
				pBusyWindow.Stop(BusyWindowID);
				}
			catch (e)
				{
				// Dismiss the busy window
				pBusyWindow.Stop(BusyWindowID);

				// Rethrow
				throw e;
				}
			}
		
		return true;
		}

	function SaveTool(i_AsTemplate)
	{
		var UserPassphrase;
		
		// Get the password (optional)
		if (PasswordCheckbox.checkstate == GrooveCheckState_Checked)
			UserPassphrase = Passphrase.Text;

		// Create a byte output stream to put the telespace into
		var pIFileBOS = CreateByteOutputStreamFromFile(g_FileName, false, false);

		// See if it worked
		if (pIFileBOS == null)
			{
			var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			MessageBox(pWindow, g_pAccount, CREATEFILE_ERROR_MESSAGE, CREATEFILE_ERROR_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
			return false;
			}

		// Show the busy window as this may take some time
		var WaitMessage = "";
		var pBusyWindow = GrooveScriptFunctions.CreateNewObject("Groove.MiscUIHelperObject").BusyWindowHelper;
		
		if (i_AsTemplate)
			WaitMessage = GetString(g_pBundle, "PwdFile_S_GTA_Template_BusyWindowMessage");
		else
			WaitMessage = GetString(g_pBundle, "PwdFile_S_GTA_Archive_BusyWindowMessage");
			
		var BusyWindowID = pBusyWindow.Start(g_pTool.DisplayName, WaitMessage, UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW));

		try
			{
			// Create vCard for serialization
			pvCard = GrooveScriptFunctions.CreateNewObject("");
			if (!g_IncludeMembers)
			{
				var pContactServices = GrooveScriptFunctions.CreateNewObject("Groove.ContactServices");
				var pvCardFactory = pContactServices.VCardFactory;
				pvCard = pvCardFactory.Create(GrooveScriptFunctions.CreateNewObject(""));
				var pIdentification = pvCard.OpenIdentification();
				pIdentification.SetFullName(GetResourcedString(IDS_DEFAULT_CONTACT_FULL_NAME_FOR_TSP_TEMPLATE_SERIALIZATION));
			}
			
			// Serialize the tool into a stream
			g_pTool.IGrooveTool2.BackupToStream(pIFileBOS, UserPassphrase, i_AsTemplate, pvCard);

			// Write the file to disk
			pIFileBOS.Flush();
			pIFileBOS.Close();		

			// Dismiss the busy window
			pBusyWindow.Stop(BusyWindowID);
			}
		catch (e)
			{
			// Write the file to disk
			pIFileBOS.Flush();
			pIFileBOS.Close();		

			// Dismiss the busy window
			pBusyWindow.Stop(BusyWindowID);

			// Rethrow
			//throw e;
			var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			MessageBox(pWindow, g_pAccount, e.description, "Error", GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Error);
			return true;
			}
	}
	
	function ValidatePassphrase()
		{
		var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);

		// Make sure they match
		if  ((PasswordCheckbox.checkstate == GrooveCheckState_Checked) && (ConfirmPassphrase.Text != Passphrase.Text))
			{
			MessageBox(pWindow, g_pAccount, PASSPRHRASEMATCHCHAR_ERROR, PASSPHRASECHAR_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
			return false;
			}

		// Good to go
		return true;
		}

	function DisableDataOptions()
		{
			ContentsCheckbox.CheckState = GrooveCheckState_Checked;
			ContentsCheckbox.Enabled = false;
			MembersCheckbox.CheckState = GrooveCheckState_Checked;
			MembersCheckbox.Enabled = false;
		}
		
	function RemoveDataOptions()
		{
			var MCellSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.MultiCellLayoutControlInfo");
			var MCellObj = MCellSizeObj.Cell();
			
			//Remove data options header
			MCellObj.Name           = "DataHeading";
			MCellSizeObj.SetHeight(0, GrooveLayoutSizeType_Pixels);
			PasswordFileLayout.AdjustCellLayout(MCellObj, MCellSizeObj);
			
			//Remove data options view
			MCellObj.Name = "DataView";
			MCellSizeObj.SetHeight(0, GrooveLayoutSizeType_Pixels);
			PasswordFileLayout.AdjustCellLayout(MCellObj, MCellSizeObj);
		}

	function NavigateToSpace(i_TelespaceBindableURL)
		{
			// Determine the window to navigate in.  Start with no window
			var pNavigationWindow = GrooveScriptFunctions.CreateNewObject("");
			
			// If the parent window is a transceiver then navigate in that window
			if (UIPropertyList.PropertyExists(UIPROPERTY_TOP_LEVEL_WINDOW))
			{
				var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
				var pParentWindow = pWindow.IGrooveWindowProperties.ParentWindow;
				if (pParentWindow && (pParentWindow.IGrooveWindowProperties.Style == "TransceiverWindow"))
					pNavigationWindow = pParentWindow;
			}
			
			// Do the navigation
			App.LaunchOrNavigateToURL(i_TelespaceBindableURL, pNavigationWindow, g_pAccount.OpenGUID());
		}
		
	function ShowPasswordDialog(i_pWindow, i_FileName)
		{
		// Build the file name without the path
		var pWin32FileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
		var BaseName = pWin32FileSystemServices.OpenFileBaseName(i_FileName);
		var Extension = pWin32FileSystemServices.OpenFileExtension(i_FileName);
		var FileName = BaseName + "." + Extension;

		var ResourcedString = (Extension == "gsa") ? GetString(g_pBundle, "PwdFile_MB_RWPT") : GetString(g_pBundle, "PwdFile_MB_RTPT");
		var Title = SubstituteArrayValuesInString(ResourcedString, new Array(FileName));
			
		return pResult = App.GrooveInputBox(i_pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_EP"), GrooveInputBoxStyle_AllowEmptyValue | GrooveInputBoxStyle_Password, "", Title);
		}	

	// ********************************************************
	// IGrooveComponent
	// ********************************************************

	function Initialize()
		{
		// Get global objects we use
		g_pAccount = OpenAccountFromPropertyList(PropertyList);
		}

	function Terminate()
		{
		// Free global objects
		g_pAccount = null;
		g_pTelespace = null;
		g_pBundle = null;
		g_pTool = null;
		}

	// ********************************************************
	// IGrooveUICommandContainerListener
	// ********************************************************

	function ContentsCheckbox_OnCommand()
		{
			if (ContentsCheckbox.checkstate == GrooveCheckState_Checked)
				g_IncludeContent = true;
			else
				g_IncludeContent = false;
		}

	function MembersCheckbox_OnCommand()
		{
			if (MembersCheckbox.checkstate == GrooveCheckState_Checked)
				g_IncludeMembers = true;
			else
				g_IncludeContent = false;
		}

	function PasswordCheckbox_OnCommand()
		{
			if (PasswordCheckbox.checkstate == GrooveCheckState_Checked)
				{	
				Passphrase.Enabled = true;
				ConfirmPassphrase.Enabled = true;
				}
			else
				{
				Passphrase.Enabled = false;
				ConfirmPassphrase.Enabled = false;
				}
		}

	function OKButton_OnCommand(i_UICommand)
		{
		// Dismiss window if path and password are ok
		if (ValidatePassphrase())
			{
			var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);

			// perform the correct operation
			//emoc
			//var OkToClose = true;
			//if (g_OpenMode)
				//OkToClose = PerformImport();
			//else
				OkToClose = PerformExport();

			//if (OkToClose)
				//{
				pWindow.Close(GrooveWindowResult_OK);
				pWindow.Destroy(GrooveWindowResult_OK);
				//}
			}
		/*else
			{
			MessageBox(pWindow, g_pAccount, GetString(g_pBundle, "PwdFile_S_DirChar_Error"), GetString(g_pBundle, "PwdFile_S_DirChar_Title"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
			}*/
		}

	function CancelButton_OnCommand(i_UICommand)
		{
		var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Message;
      ®	  		if (g_SaveAsType == GrooveSaveWorkspaceAsType_Archive)
			Message = GetString(g_pBundle, "PwdFile_MB_CAS");
		else
			Message = GetString(g_pBundle, "PwdFile_MB_CTS");
			
		var Result = MessageBox(pWindow, g_pAccount, Message, GetString(g_pBundle, "PwdFile_MB_CT"), GrooveMessageBoxStyle_YesNo, GrooveMessageBoxIcon_Information);
		
		if (Result == GrooveMessageBoxResultCode_Yes)
			{
			pWindow.Close(GrooveWindowResult_Cancel);
			pWindow.Destroy(GrooveWindowResult_Cancel);
			}
		}

	function IdentitySelectorDelegateInitialization(i_pDelegate, i_Args)
		{
		// Initialize the identity selector list
		i_pDelegate.IGrooveIdentitySelectorCode.Account = g_pAccount;
		}

	function IdentitySelectorDelegateResult(i_pDelegate, i_Result)
		{
		var pIdentity = null;
		if (GrooveWindowResult_OK == i_Result)
			{
			// Get the identity the user has chosen
			pIdentity = i_pDelegate.IGrooveIdentitySelectorCode.OpenIdentity();
			}

		return pIdentity;
		}
		
	function GetMinimumTelespaceTemplateVersionMessageString(i_pIdentity)
		{
		var pTelespaceIdentity = i_pIdentity.IGrooveTelespaceIdentity;
		var MinimumTemplateComponentResourceURL = pTelespaceIdentity.MinimumTemplateComponentResourceURL;
		
		var pVersionHelper = GrooveScriptFunctions.CreateNewObject("Groove.VersionHelper");
		var ProductVersionString = pVersionHelper.GetProductVersionStringFromTemplateResourceURLVersion(MinimumTemplateComponentResourceURL);

		return SubstituteArrayValuesInString(GetString(g_pBundle, "PwdFile_S_RestoreWorkspace_MTV"), new Array(ProductVersionString));
		}
		
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         H                     @            ª  ¿
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        »
               Ä(null),0               Ä(nul         Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄNameP   G r o o v e R e s o u r c e C l e a n u p H e l p e r F u n c t i o n s . g s l           ÄSCRIPT  RIP  ÄSCRIPT         Ô Ä

	function CallWithWaitCursor(i_Fn)
	{
		var pWindowManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		pWindowManager.ShowWaitCursor(true);
		try
		{
			i_Fn();
		}

		finally
		{
			pWindowManager.ShowWaitCursor(false);
		}
	}


	function CallWithinWriteTransaction(i_pTelespace, i_Fn)
	{
		var pTransaction = i_pTelespace.OpenTransaction(false);
		try
		{
			i_Fn();
		}

		catch (e)
		{
			pTransaction.Abort();
			throw e;
		}

		pTransaction.Commit();
	}


	function CallWithinReadTransaction(i_pTelespace, i_Fn)
	{
		var pTransaction = i_pTelespace.OpenTransaction(true);
		try
		{
			i_Fn();
		}

		finally
		{
			pTransaction.Commit();
		}
	}


	function CallWithinDelta(i_pTelespace, i_Fn)
	{
		var pDelta = i_pTelespace.Dynamics.CreateDelta();
		var Result;
		try
		{
			Result = i_Fn();
		}

		catch (e)
		{
			pDelta.Abort();
			throw e;
		}

		pDelta.Commit();
		if (Result)
			return Result;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Ñ 
     ≈          )      ÄSCRIPT         ä Ä

        var UI_COMMAND_CONTAINER_URL_FILE                 = "GUICC_File";
        var UI_COMMAND_URL_NEW_WINDOW                     = "GUIC_NewWindow";
        var UI_COMMAND_URL_NEW_SHARED_SPACE               = "GUIC_NewSharedSpace";
        var UI_COMMAND_URL_RENAME_SHARED_SPACE            = "GUIC_RenameSharedSpace";
        var UI_COMMAND_URL_DELETE_SHARED_SPACE            = "GUIC_DeleteSharedSpace";     
        var UI_COMMAND_URL_INVITE_BY_INSTANT_MESSAGE      = "GUIC_InviteByInstantMessage";
        var UI_COMMAND_URL_INVITE_BY_EMAIL                = "GUIC_InviteByEmail";
        var UI_COMMAND_URL_SAVE_INVITATION_FILE           = "GUIC_SaveInvitationFile";
        var UI_COMMAND_URL_EXIT                           = "GUIC_Exit";
                        
        var UI_COMMAND_CONTAINER_URL_EDIT                 = "GUICC_Edit";
        var UI_COMMAND_URL_EDIT_UNDO                      = "GUIC_EditUndo";
        var UI_COMMAND_URL_EDIT_REDO                      = "GUIC_EditRedo";
        var UI_COMMAND_URL_EDIT_CUT                       = "GUIC_EditCut";
        var UI_COMMAND_URL_EDIT_COPY                      = "GUIC_EditCopy";
        var UI_COMMAND_URL_EDIT_PASTE                     = "GUIC_EditPaste";
        var UI_COMMAND_URL_EDIT_SELECT_ALL                = "GUIC_EditSelectAll";

        var UI_COMMAND_CONTAINER_URL_VIEW                 = "GUICC_View";
        var UI_COMMAND_URL_GO_BACK                        = "GUIC_GoBack";
        var UI_COMMAND_URL_GO_FORWARD                     = "GUIC_GoForward";
        var UI_COMMAND_URL_GO_TO_HOME_PAGE                = "GUIC_GoToHomePage";
        var UI_COMMAND_URL_GO_TO_MY_CONTACTS              = "GUIC_GoToMyContacts";
        var UI_COMMAND_URL_GO_TO_MY_SPACES                = "GUIC_GoToMySpaces";
        var UI_COMMAND_URL_GO_TO_MY_ACCOUNT               = "GUIC_GoToMyAccount";
        var UI_COMMAND_URL_GO_TO                          = "GUIC_GoTo";
                        
        var UI_COMMAND_CONTAINER_URL_TOOLS                = "GUICC_Tools";
        var UI_COMMAND_URL_INSTANT_GROOVE                 = "GUIC_InstantGroove";
        var UI_COMMAND_URL_TOGGLE_SUPPRESS_NOTIFICATIONS  = "GUIC_ToggleSuppressNotifications";
        var UI_COMMAND_URL_TOGGLE_PAUSE_COMMUNICATIONS    = "GUIC_TogglePauseCommunications";

        var UI_COMMAND_CONTAINER_URL_HELP                 = "GUICC_Help";
        var UI_COMMAND_URL_HELP_CONTENTS                  = "GUIC_HelpContents";
        var UI_COMMAND_URL_HELP_ON                        = "GUIC_HelpOn";
        var UI_COMMAND_URL_TOGGLE_OVERVIEW                = "GUIC_ToggleOverview";
        var UI_COMMAND_URL_ABOUT_GROOVE                   = "GUIC_AboutGroove";

        var ColorNames = new Array ("System_Blk",
                                    "System_Mrn",
                                    "System_Grn",
                                    "System_Olv",
                                    "System_Nvy",
                                    "System_Prp",
                                    "System_Tl",
                                    "System_Gry",
                                    "System_Slv",
                                    "System_Rd",
                                    "System_Lm",
                                    "System_Ylw",
                                    "System_Bl",
                                    "System_Fsa",
                                    "System_Aq",
                                    "System_Wh");

        var ColorValues = new Array (0x000000,
                                     0x000080,
                                     0x008000,
                                     0x008080,
                                     0x800000,
                                     0x800080,
                                     0x808000,
                                     0x808080,
                                     0xC0C0C0,
                                     0x0000FF,
                                     0x00FF00,
                                     0x00FFFF,
                                     0xFF0000,
                                     0xFF00FF,
                                     0xFFFF00,
                                     0xFFFFFF);

        var FONT_DEFAULT_COLOR_SELECTED_IMAGE = 82;
        var FONT_COLOR_IMAGE_INDEX = 96;
        var FONT_SELECTION_IMAGE_INDEX = 97;

        var FontSizes = new Array (8,
                                   10,
                                   12,
                                   14,
                                   18,
                                   24,
                                   36,
                                   48,
                                   72);

        var FontFaces = new Array ("System_Arl",
                                   "System_CS" ,
                                   "System_CN",
                                   "System_Sym",
                                   "System_TNR",
                                   "System_WD");

        var CommonImagesURL = "grooveFile:///ToolData\\groove.net\\CommonData\\CommonToolIconImages.jpg";
        var CommonImagesMaskURL = "grooveFile:///ToolData\\groove.net\\CommonData\\CommonToolIconImagesMask.bmp";

        var pIntl = GrooveScriptFunctions.CreateNewObject ("Groove.Internationalization");
        var pBundle = pIntl.CreateResourceBundle ("http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.SystemComponents.GrooveSystemResources_RBD&amp;Version=0", pIntl.DefaultLocale);

        function OnTextCommand (i_UICommand, i_TextView, i_Toolbar)
        {
            return OnCommand (i_UICommand, i_TextView, i_Toolbar);
        }

        function OnCommand (i_UICommand, i_TextView, i_Toolbar)
        {
            var CommandURL = i_UICommand.CommandURL;

            if (CommandURL == UI_COMMAND_URL_EDIT_UNDO)
                SubmitControlChar ("Z", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_REDO)
                SubmitControlChar ("Y", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_CUT)
                SubmitControlChar ("X", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_COPY)
                SubmitControlChar ("C", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_PASTE)
                SubmitControlChar ("V", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_SELECT_ALL)
                SubmitControlChar ("A", i_TextView);

            else if (MatchCommandURL (CommandURL, "TextUndo"))
                SubmitControlChar ("Z", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextRedo"))
                SubmitControlChar ("Y", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextCut"))
                SubmitControlChar ("X", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextCopy"))
                SubmitControlChar ("C", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextPaste"))
                SubmitControlChar ("V", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextSelectAll"))
                SubmitControlChar ("A", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextDetectURLs"))
                i_TextView.DetectURLs = !i_TextView.DetectURLs;

            else if (MatchCommandURL (CommandURL, "TextFontCustom"))
                i_TextView.ChooseFont ();
                
            else if (MatchCommandURL (CommandURL, "TextFontFace"))
                i_TextView.SubmitFontChange (i_UICommand.Label, tomUndefined, tomUndefined, 0, "#UNDEF#");
                
            else if (MatchCommandURL (CommandURL, "TextFontSize"))
                i_TextView.SubmitFontChange ("", i_UICommand.UserData, tomUndefined, 0, "#UNDEF#");

            else if (MatchCommandURL (CommandURL, "TextFontColorCustom"))
            {
							  i_TextView.ChooseColor();

                // Update text color button image.
                if (i_Toolbar)
                {
                    i_TextView.FlushCommand();

                    var UICommandContainer = i_Toolbar.OpenUICommandContainer ("TextMenuFontColor_FormatFont");
                    if (UICommandContainer)
                    {
                        UICommandContainer.UICommand.UserData = tomAutoColor;
                        for (var i = 0; i < ColorValues.length; i++)
                        {
                            if (i_TextView.SelectionFont.ForeColor == ColorValues[i])
                            {
                                UICommandContainer.UICommand.UserData = i + 65;
                                break;
                            }
                        }
                    }
                }
            }
                    
            else if (MatchCommandURL (CommandURL, "TextFontColor"))
            {
                var nIndex = i_UICommand.UserData;
                if (i_Toolbar)
                {
                    // Change button image.
                    var UICommandContainer = i_Toolbar.OpenUICommandContainer ("TextMenuFontColor_FormatFont");
                    if (UICommandContainer)
                        UICommandContainer.UICommand.UserData = nIndex;
                }

                // Change font color.
                var Color = (i_UICommand.UserData == tomAutoColor) ? tomAutoColor : ColorValues[nIndex-65];
                i_TextView.SubmitFontChange ("", tomUndefined, Color, 0, "#UNDEF#");
            }    
            
            else if (MatchCommandURL (CommandURL, "TextFontBold"))
                SubmitControlChar ("B", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextFontItalic"))
                SubmitControlChar ("I", i_TextView);

            else if (MatchCommandURL (CommandURL, "TextFontUnderline"))
                SubmitControlChar ("U", i_TextView);

            else if (MatchCommandURL (CommandURL, "TextFontStrikeout"))
                SubmitControlChar ("K", i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaAlignLeft"))
                SubmitParaChange (GrooveTextParaFlag_UseAlign | GrooveTextParaFlag_AlignLeft, tomUndefined, i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaAlignCenter"))
                SubmitParaChange (GrooveTextParaFlag_UseAlign | GrooveTextParaFlag_AlignCenter, tomUndefined, i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaAlignRight"))
                SubmitParaChange (GrooveTextParaFlag_UseAlign | GrooveTextParaFlag_AlignRight, tomUndefined, i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaNumberBullet"))
            {
                var Flags = GrooveTextParaFlag_UseNumber;
                var ListType = i_TextView.TextCache.Document.Selection.Para.ListType;
                if (ListType == tomUndefined)
                    Flags |= GrooveTextParaFlag_NumberBullet;
                else if ((ListType & 0xFFFF) != tomListBullet)
                    Flags |= GrooveTextParaFlag_NumberBullet;
                else
                    Flags |= GrooveTextParaFlag_NumberNone;

                SubmitParaChange (Flags, tomUndefined, i_TextView);
            }

            else if (MatchCommandURL (CommandURL, "TextParaIndent"))
                SubmitParaChange (GrooveTextParaFlag_IndentRelative, 18.0, i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaOutdent"))
                SubmitParaChange (GrooveTextParaFlag_IndentRelative, -18.0, i_TextView);
        }

        function OnTextUpdateCommandState (i_UICommand, i_TextView, i_Toolbar)
        {
            OnUpdateCommandState (i_UICommand, i_TextView, i_Toolbar);
        }

        function OnUpdateCommandState (i_UICommand, i_TextView, i_Toolbar)
        {
            var CommandURL = i_UICommand.CommandURL;
            var ReadOnly = !i_TextView.CanEditText;

            if (CommandURL == UI_COMMAND_URL_EDIT_UNDO)
                i_UICommand.Enabled = i_TextView.CanUndo;

            else if (CommandURL == UI_COMMAND_URL_EDIT_REDO)
                i_UICommand.Enabled = i_TextView.CanRedo;

            else if (CommandURL == UI_COMMAND_URL_EDIT_CUT)
                i_UICommand.Enabled = !ReadOnly && i_TextView.CanCopy;

            else if (CommandURL == UI_COMMAND_URL_EDIT_COPY)
                i_UICommand.Enabled = i_TextView.CanCopy;

            else if (CommandURL == UI_COMMAND_URL_EDIT_PASTE)
                i_UICommand.Enabled = i_TextView.CanPaste;

            else if (CommandURL == UI_COMMAND_URL_EDIT_SELECT_ALL)
                i_UICommand.Enabled = true;

            else if (MatchCommandURL (CommandURL, "TextUndo"))
                i_UICommand.Enabled = i_TextView.CanUndo;
                
            else if (MatchCommandURL (CommandURL, "TextRedo"))
                i_UICommand.Enabled = i_TextView.CanRedo;
                
            else if (MatchCommandURL (CommandURL, "TextCut"))
                i_UICommand.Enabled = !ReadOnly && i_TextView.CanCopy;
                
            else if (MatchCommandURL (CommandURL, "TextCopy"))
                i_UICommand.Enabled = i_TextView.CanCopy;
                
            else if (MatchCommandURL (CommandURL, "TextPaste"))
                i_UICommand.Enabled = i_TextView.CanPaste;
                
            else if (MatchCommandURL (CommandURL, "TextDetectURLs"))
            {
                if (i_TextView.DetectURLs)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextFontCustom"))
                i_UICommand.Enabled = !ReadOnly;
                
            else if (MatchCommandURL (CommandURL, "TextFontFace"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.Name == i_UICommand.Label)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }
                
            else if (MatchCommandURL (CommandURL, "TextFontSize"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.Size == i_UICommand.UserData)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }
                
            else if (MatchCommandURL (CommandURL, "TextFontColorCustom"))
                i_UICommand.Enabled = !ReadOnly;

            else if (MatchCommandURL (CommandURL, "TextFontColorAuto"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.ForeColor == tomAutoColor)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
                if (i_Toolbar)
                {
                    var UICommandContainer = i_Toolbar.OpenUICommandContainer ("TextMenuFontColor_FormatFont");
                    if (UICommandContainer)
                    {
                        var nIndex = UICommandContainer.UICommand.UserData;
                        if (nIndex == tomAutoColor)
                          i_UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * FONT_DEFAULT_COLOR_SELECTED_IMAGE, 16, 16);
                        else
                          i_UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 0, 0, 0);
                    }
                }
            }

            else if (MatchCommandURL (CommandURL, "TextMenuFontColor"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_Toolbar)
                {
                    var UICommandContainer = i_Toolbar.OpenUICommandContainer ("TextMenuFontColor_FormatFont");
                    if (UICommandContainer)
                    {
                        var nIndex = UICommandContainer.UICommand.UserData;
                        if (nIndex == tomAutoColor)
                            nIndex = FONT_COLOR_IMAGE_INDEX;

                        i_UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * nIndex, 16, 16);
                    }
                }
            }
            else if (MatchCommandURL (CommandURL, "TextFontColor"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_UICommand.UserData && i_UICommand.UserData != tomAutoColor &&
                        i_TextView.SelectionFont.ForeColor == ColorValues[i_UICommand.UserData - 65])
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }
                
            else if (MatchCommandURL (CommandURL, "TextFontBold"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.Bold == tomTrue)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }
                
            else if (MatchCommandURL (CommandURL, "TextFontItalic"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.Italic == tomTrue)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextFontUnderline"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.Underline == tomSingle)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextFontStrikeout"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.StrikeThrough == tomTrue)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaAlignLeft"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.TextCache.Document.Selection.Para.Alignment == tomAlignLeft)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaAlignCenter"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.TextCache.Document.Selection.Para.Alignment == tomAlignCenter)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaAlignRight"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.TextCache.Document.Selection.Para.Alignment == tomAlignRight)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaNumberBullet"))
            {
                i_UICommand.Enabled = !ReadOnly;
                var ListType = i_TextView.TextCache.Document.Selection.Para.ListType;
                if (ListType == tomUndefined)
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
                else if ((ListType & 0xFFFF) != tomListBullet)
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Checked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaIndent"))
                i_UICommand.Enabled = !ReadOnly;

            else if (MatchCommandURL (CommandURL, "TextParaOutdent"))
                i_UICommand.Enabled = !ReadOnly;
        }

        function MatchCommandURL (i_CommandURL, i_Pattern)
        {
            var Length = i_Pattern.length;
            return i_CommandURL.substr (0, Length) == i_Pattern;
        }

        function SubmitControlChar (i_String, i_TextView)
        {
            var CharCode = i_String.charCodeAt (0) & 0x1F;
            i_TextView.SubmitText (String.fromCharCode (CharCode));
        }

        function SubmitParaChange (i_Flags, i_Left, i_TextView)
        {
            var TabPositionEnum = CreateDoubleEnum ();
            var TabFlagsEnum = CreateLongEnum ();

            i_TextView.SubmitParaChange (i_Flags,
                                         tomUndefined,
                                         tomUndefined,
                                         i_Left,
                                         tomUndefined,
                                         tomUndefined,
                                         tomUndefined,
                                         TabPositionEnum,
                                         TabFlagsEnum);
        }

        function ShowTextUICommands (i_UICommandContainer)
        {
            var Position = i_UICommandContainer.GetNumberOfUICommands ();

            var UICommand;
            var SubContainer;
            var SubSubContainer;
            var SubSubSubContainer;
            
            //------------
            // Format menu
            //------------

            SubContainer = i_UICommandContainer.InsertUICommandContainer ("TextMenuFormat", Position++);
            SubContainer = SubContainer.UICommandContainer;
            SubContainer.UICommand.Label = GetString (pBundle, "System_ML_Fmt");
            SubContainer.UICommand.Mnemonic = GetString (pBundle, "System_MN_FMT");

            //-------------
            // Font submenu
            //-------------

            SubSubContainer = SubContainer.InsertUICommandContainer ("TextMenuFont_Format", SubContainer.GetNumberOfUICommands());
            SubSubContainer = SubSubContainer.UICommandContainer;
            SubSubContainer.UICommand.Label = GetString (pBundle, "System_ML_FNT");

            //-----------------
            // Size sub-submenu
            //-----------------

            SubSubSubContainer = SubSubContainer.InsertUICommandContainer ("TextMenuFontSize_FormatFont", SubSubContainer.GetNumberOfUICommands());
            SubSubSubContainer = SubSubSubContainer.UICommandContainer;
            SubSubSubContainer.UICommand.Label = GetString (pBundle, "System_ML_SZ");

            for (i = 0; i < FontSizes.length; i++)
            {
                UICommand = SubSubSubContainer.InsertUICommand ("TextFontSize" + i + "_FormatFontSize", SubSubSubContainer.GetNumberOfUICommands());
                UICommand.Label = (new Number (FontSizes[i])).toString ();
                UICommand.UserData = FontSizes[i];
                UICommand.RadioCheck = true;
            }

            //------------------
            // Color sub-submenu
            //------------------

            SubSubSubContainer = SubSubContainer.InsertUICommandContainer ("TextMenuFontColor_FormatFont", SubSubContainer.GetNumberOfUICommands());
            SubSubSubContainer = SubSubSubContainer.UICommandContainer;
            SubSubSubContainer.UICommand.Label  = GetString (pBundle, "System_ML_CL");

            UICommand = SubSubSubContainer.InsertUICommand ("TextFontColorAuto_FormatFontColor", SubSubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_Def");
            UICommand.UserData = tomAutoColor;
            UICommand.RadioCheck = true;
            
            SubSubSubContainer.InsertSeparator ("TextSep0_FormatFontColor", SubSubSubContainer.GetNumberOfUICommands());

            for (i = 0; i < ColorValues.length; i++)
            {
                UICommand = SubSubSubContainer.InsertUICommand ("TextFontColor" + i + "_FormatFontColor", SubSubSubContainer.GetNumberOfUICommands());
                UICommand.Label = GetString (pBundle, ColorNames[i]);
                UICommand.UserData = i + 65;
                UICommand.RadioCheck = true;
                UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * UICommand.UserData, 16, 16);
            }

            SubSubSubContainer.InsertSeparator ("TextSep1_FormatFontColor", SubSubSubContainer.GetNumberOfUICommands());

            UICommand = SubSubSubContainer.InsertUICommand ("TextFontColorCustom_FormatFontColor", SubSubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_MrClr");

            //-------------
            // font effects
            //-------------
            
            SubSubContainer.InsertSeparator ("TextSep0_FormatFont", SubSubContainer.GetNumberOfUICommands());
            
            UICommand = SubSubContainer.InsertUICommand ("TextFontBold_FormatFont", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_BD");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 27, 16, 16);

            UICommand = SubSubContainer.InsertUICommand ("TextFontItalic_FormatFont", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_IT");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 28, 16, 16);

            UICommand = SubSubContainer.InsertUICommand ("TextFontUnderline_FormatFont", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_UL");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 29, 16, 16);

            UICommand = SubSubContainer.InsertUICommand ("TextFontStrikeout_FormatFont", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_SK");

            SubSubContainer.InsertSeparator ("TextSep1_FormatFont", SubSubContainer.GetNumberOfUICommands());
            
            UICommand = SubSubContainer.InsertUICommand ("TextFontCustom_FormatFont", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_MFNT");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 26, 16, 16);

            //---------------
            // Paragraph menu
            //---------------

            SubSubContainer = SubContainer.InsertUICommandContainer ("TextMenuPara_Format", SubContainer.GetNumberOfUICommands());
            SubSubContainer = SubSubContainer.UICommandContainer;
            SubSubContainer.UICommand.Label = GetString (pBundle, "System_ML_PAR");

            UICommand = SubSubContainer.InsertUICommand ("TextParaAlignLeft_FormatPara", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_AL");
            UICommand.RadioCheck = true;
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 34, 16, 16);

            UICommand = SubSubContainer.InsertUICommand ("TextParaAlignCenter_FormatPara", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_AC");
            UICommand.RadioCheck = true;
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 35, 16, 16);
            
            UICommand = SubSubContainer.InsertUICommand ("TextParaAlignRight_FormatPara", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_AR");
            UICommand.RadioCheck = true;
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 36, 16, 16);

            SubSubContainer.InsertSeparator ("TextSep0_FormatPara", SubSubContainer.GetNumberOfUICommands());

            UICommand = SubSubContainer.InsertUICommand ("TextParaNumberBullet_FormatPara", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_BL");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 33, 16, 16);

            SubSubContainer.InsertSeparator ("TextSep1_FormatPara", SubSubContainer.GetNumberOfUICommands());

            UICommand = SubSubContainer.InsertUICommand ("TextParaIndent_FormatPara", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_II");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 32, 16, 16);

            UICommand = SubSubContainer.InsertUICommand ("TextParaOutdent_FormatPara", SubSubContainer.GetNumberOfUICommands());
            UICommand.Label = GetString (pBundle, "System_ML_DI");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 31, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep0", Position++)

            //-----
            // undo
            //-----

            UICommand = i_UICommandContainer.InsertUICommand ("TextUndo", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_UN");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 24, 16, 16);

            //-----
            // redo
            //-----

            UICommand = i_UICommandContainer.InsertUICommand ("TextRedo", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_RE");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 25, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep1", Position++);
                
            //-----
            // cut
            //-----

            UICommand = i_UICommandContainer.InsertUICommand ("TextCut", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_Cut");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 2, 16, 16);

            //-----
            // copy
            //-----

            UICommand = i_UICommandContainer.InsertUICommand ("TextCopy", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_Cpy");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 3, 16, 16);

            //------
            // paste
            //------

            UICommand = i_UICommandContainer.InsertUICommand ("TextPaste", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_Pst");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 5, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep2", Position++);

            //------
            // bold
            //------

            UICommand = i_UICommandContainer.InsertUICommand ("TextFontBold", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_BT");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 27, 16, 16);

            //-------
            // italic
            //-------

            UICommand = i_UICommandContainer.InsertUICommand ("TextFontItalic", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_IT");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 28, 16, 16);

            //----------
            // underline
            //----------

            UICommand = i_UICommandContainer.InsertUICommand ("TextFontUnderline", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_UT");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 29, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep3", Position++);

            //-----------
            // align left
            //-----------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaAlignLeft", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_AL");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 34, 16, 16);

            //-------
            // center
            //-------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaAlignCenter", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_AC");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 35, 16, 16);

            //------------
            // align right
            //------------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaAlignRight", Position++);
            UICommand.Tooltip = GetString (pBundle, "System_CT_AR");
            UICommand.SetImage (CommonImagesURL, CommonImagesMaskURL, 16 * 36, 16, 16);
      
        }

        function HideTextUICommands (i_UICommandContainer)
        {
            var SubContainer;
            
            SubContainer = i_UICommandContainer.OpenUICommandContainer ("TextMenuFormat");
            SubContainer.UICommandContainer.RemoveAllUICommands ();
            i_UICommandContainer.RemoveUICommandContainer ("TextMenuFormat");

            i_UICommandContainer.RemoveSeparator ("TextSep0");

            i_UICommandContainer.RemoveUICommand ("TextUndo");
            i_UICommandContainer.RemoveUICommand ("TextRedo");

            i_UICommandContainer.RemoveSeparator ("TextSep1");

            i_UICommandContainer.RemoveUICommand ("TextCut");
            i_UICommandContainer.RemoveUICommand ("TextCopy");
            i_UICommandContainer.RemoveUICommand ("TextPaste");

            i_UICommandContainer.RemoveSeparator ("TextSep2");

            i_UICommandContainer.RemoveUICommand ("TextFontBold");
            i_UICommandContainer.RemoveUICommand ("TextFontItalic");
            i_UICommandContainer.RemoveUICommand ("TextFontUnderline");

            i_UICommandContainer.RemoveSeparator ("TextSep3");

            i_UICommandContainer.RemoveUICommand ("TextParaAlignLeft");
            i_UICommandContainer.RemoveUICommand ("TextParaAlignCenter");
            i_UICommandContainer.RemoveUICommand ("TextParaAlignRight");
        
        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @           ∆  0        º     öä  öä                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                8               Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   V   ÄNameD   G r o o v e R i c h T e x t C o m m a n d B a r H e l p e r . g s l           ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT      ÄSCRIPT  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  § U   Ä :      ø          )      ÄSCRIPT         ;a Ä

        var UI_COMMAND_CONTAINER_URL_FILE                 = "GUICC_File";
        var UI_COMMAND_URL_NEW_WINDOW                     = "GUIC_NewWindow";
        var UI_COMMAND_URL_NEW_SHARED_SPACE               = "GUIC_NewSharedSpace";
        var UI_COMMAND_URL_RENAME_SHARED_SPACE            = "GUIC_RenameSharedSpace";
        var UI_COMMAND_URL_DELETE_SHARED_SPACE            = "GUIC_DeleteSharedSpace";     
        var UI_COMMAND_URL_INVITE_BY_INSTANT_MESSAGE      = "GUIC_InviteByInstantMessage";
        var UI_COMMAND_URL_INVITE_BY_EMAIL                = "GUIC_InviteByEmail";
        var UI_COMMAND_URL_SAVE_INVITATION_FILE           = "GUIC_SaveInvitationFile";
        var UI_COMMAND_URL_EXIT                           = "GUIC_Exit";
                        
        var UI_COMMAND_CONTAINER_URL_EDIT                 = "GUICC_Edit";
        var UI_COMMAND_URL_EDIT_UNDO                      = "GUIC_EditUndo";
        var UI_COMMAND_URL_EDIT_REDO                      = "GUIC_EditRedo";
        var UI_COMMAND_URL_EDIT_CUT                       = "GUIC_EditCut";
        var UI_COMMAND_URL_EDIT_COPY                      = "GUIC_EditCopy";
        var UI_COMMAND_URL_EDIT_PASTE                     = "GUIC_EditPaste";
        var UI_COMMAND_URL_EDIT_SELECT_ALL                = "GUIC_EditSelectAll";

        var UI_COMMAND_CONTAINER_URL_VIEW                 = "GUICC_View";
        var UI_COMMAND_URL_GO_BACK                        = "GUIC_GoBack";
        var UI_COMMAND_URL_GO_FORWARD                     = "GUIC_GoForward";
        var UI_COMMAND_URL_GO_TO_HOME_PAGE                = "GUIC_GoToHomePage";
        var UI_COMMAND_URL_GO_TO_MY_CONTACTS              = "GUIC_GoToMyContacts";
        var UI_COMMAND_URL_GO_TO_MY_SPACES                = "GUIC_GoToMySpaces";
        var UI_COMMAND_URL_GO_TO_MY_ACCOUNT               = "GUIC_GoToMyAccount";
        var UI_COMMAND_URL_GO_TO                          = "GUIC_GoTo";
                        
        var UI_COMMAND_CONTAINER_URL_TOOLS                = "GUICC_Tools";
        var UI_COMMAND_URL_INSTANT_GROOVE                 = "GUIC_InstantGroove";
        var UI_COMMAND_URL_TOGGLE_SUPPRESS_NOTIFICATIONS  = "GUIC_ToggleSuppressNotifications";
        var UI_COMMAND_URL_TOGGLE_PAUSE_COMMUNICATIONS    = "GUIC_TogglePauseCommunications";

        var UI_COMMAND_CONTAINER_URL_HELP                 = "GUICC_Help";
        var UI_COMMAND_URL_HELP_CONTENTS                  = "GUIC_HelpContents";
        var UI_COMMAND_URL_HELP_ON                        = "GUIC_HelpOn";
        var UI_COMMAND_URL_TOGGLE_OVERVIEW                = "GUIC_ToggleOverview";
        var UI_COMMAND_URL_ABOUT_GROOVE                   = "GUIC_AboutGroove";

		var pIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pBundle = pIntl.CreateResourceBundle("http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.Tools.General.RichText.RichText_RBD&Version=0", pIntl.DefaultLocale);
					
		var COLOR_BLACK_MENU_LABEL = GetString(pBundle, "System_Blk");
		var COLOR_MAROON_MENU_LABEL = GetString(pBundle, "System_Mrn");
		var COLOR_GREEN_MENU_LABEL = GetString(pBundle, "System_Grn");
		var COLOR_OLIVE_MENU_LABEL = GetString(pBundle, "System_Olv");
		var COLOR_NAVY_MENU_LABEL = GetString(pBundle, "System_Nvy");
		var COLOR_PURPLE_MENU_LABEL = GetString(pBundle, "System_Prp");
		var	COLOR_TEAL_MENU_LABEL = GetString(pBundle, "System_Tl");
		var COLOR_GRAY_MENU_LABEL =GetString(pBundle, "System_Gry");
		var COLOR_SILVER_MENU_LABEL = GetString(pBundle, "System_Slv");
		var COLOR_RED_MENU_LABEL =GetString(pBundle, "System_Rd");
		var COLOR_LIME_MENU_LABEL = GetString(pBundle, "System_Lm");
		var COLOR_YELLOW_MENU_LABEL = GetString(pBundle, "System_Ylw");
		var COLOR_BLUE_MENU_LABEL =GetString(pBundle, "System_Bl");
		var COLOR_FUCHSIA_MENU_LABEL = GetString(pBundle, "System_Fsa");
		var COLOR_AQUA_MENU_LABEL = GetString(pBundle, "System_Aq");
		var COLOR_WHITE_MENU_LABEL = GetString(pBundle, "System_Wh");
		var COLOR_DEFAULT_LABEL = GetString(pBundle, "System_Def");
		var COLOR_NONE_LABEL=GetString(pBundle, "System_Nn");
		var MORE_COLORS_LABEL = GetString(pBundle, "System_MrClr");	

         var ColorNames = new Array (COLOR_BLACK_MENU_LABEL,
                                        COLOR_MAROON_MENU_LABEL,
                                        COLOR_GREEN_MENU_LABEL,
                                        COLOR_OLIVE_MENU_LABEL,
                                        COLOR_NAVY_MENU_LABEL,
                                        COLOR_PURPLE_MENU_LABEL,
                                        COLOR_TEAL_MENU_LABEL,
                                        COLOR_GRAY_MENU_LABEL,
                                        COLOR_SILVER_MENU_LABEL,
                                        COLOR_RED_MENU_LABEL,
                                        COLOR_LIME_MENU_LABEL,
                                        COLOR_YELLOW_MENU_LABEL,
                                        COLOR_BLUE_MENU_LABEL,
                                        COLOR_FUCHSIA_MENU_LABEL,
                                        COLOR_AQUA_MENU_LABEL,
                                        COLOR_WHITE_MENU_LABEL);

        var ColorValues = new Array (GLOBAL_COLOR_VALUE_BLACK_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_MAROON_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_GREEN_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_OLIVE_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_NAVY_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_PURPLE_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_TEAL_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_GRAY_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_SILVER_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_RED_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_LIME_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_YELLOW_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_BLUE_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_FUCHSIA_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_AQUA_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_WHITE_MENU_LABEL);

        var FontSizes = new Array (8,
                                   10,
                                   12,
                                   14,
                                   18,
                                   24,
                                   36,
                                   48,
                                   72);

        var FontFaces = new Array ("Arial",
                                   "Comic Sans MS" ,
                                   "Courier New",
                                   "Symbol",
                                   "Times New Roman",
                                   "Wingdings");

        function OnTextCommand (i_UICommand, i_TextView)
        {
            OnCommand (i_UICommand, i_TextView);
        }

        function OnCommand (i_UICommand, i_TextView)
        {
            var CommandURL = i_UICommand.CommandURL;

            if (CommandURL == UI_COMMAND_URL_EDIT_UNDO)
                SubmitControlChar ("Z", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_REDO)
                SubmitControlChar ("Y", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_CUT)
                SubmitControlChar ("X", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_COPY)
                SubmitControlChar ("C", i_TextView);

            else if (CommandURL == UI_COMMAND_URL_EDIT_PASTE)
                SubmitControlChar ("V", i_TextView);

            else if (MatchCommandURL (CommandURL, "TextUndo"))
                SubmitControlChar ("Z", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextRedo"))
                SubmitControlChar ("Y", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextCut"))
                SubmitControlChar ("X", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextCopy"))
                SubmitControlChar ("C", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextPaste"))
                SubmitControlChar ("V", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextFontBold"))
                SubmitControlChar ("B", i_TextView);
                
            else if (MatchCommandURL (CommandURL, "TextFontItalic"))
                SubmitControlChar ("I", i_TextView);

            else if (MatchCommandURL (CommandURL, "TextFontUnderline"))
                SubmitControlChar ("U", i_TextView);

            else if (MatchCommandURL (CommandURL, "TextFontStrikeout"))
                SubmitControlChar ("K", i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaAlignLeft"))
                SubmitParaChange (GrooveTextParaFlag_UseAlign | GrooveTextParaFlag_AlignLeft, tomUndefined, i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaAlignCenter"))
                SubmitParaChange (GrooveTextParaFlag_UseAlign | GrooveTextParaFlag_AlignCenter, tomUndefined, i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaAlignRight"))
                SubmitParaChange (GrooveTextParaFlag_UseAlign | GrooveTextParaFlag_AlignRight, tomUndefined, i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaNumberBullet"))
            {
                var Flags = GrooveTextParaFlag_UseNumber;
                var ListType = i_TextView.TextCache.Document.Selection.Para.ListType;
                if (ListType == tomUndefined)
                    Flags |= GrooveTextParaFlag_NumberBullet;
                else if ((ListType & 0xFFFF) != tomListBullet)
                    Flags |= GrooveTextParaFlag_NumberBullet;
                else
                    Flags |= GrooveTextParaFlag_NumberNone;

                SubmitParaChange (Flags, tomUndefined, i_TextView);
            }

            else if (MatchCommandURL (CommandURL, "TextParaIndent"))
                SubmitParaChange (GrooveTextParaFlag_IndentRelative, 18.0, i_TextView);

            else if (MatchCommandURL (CommandURL, "TextParaOutdent"))
                SubmitParaChange (GrooveTextParaFlag_IndentRelative, -18.0, i_TextView);
        }

        function OnTextUpdateCommandState (i_UICommand, i_TextView, i_HaveFocus)
        {
            OnUpdateCommandState (i_UICommand, i_TextView, i_HaveFocus);
        }

        function OnUpdateCommandState (i_UICommand, i_TextView, i_HaveFocus)
        {
			// If we don't have focus disable everything
			if (!i_HaveFocus)
			{
				i_UICommand.Enabled = false;
				return;
			}

            var CommandURL = i_UICommand.CommandURL;
			var ReadOnly = !i_TextView.CanEditText;

            if (CommandURL == UI_COMMAND_URL_EDIT_UNDO)
                i_UICommand.Enabled = i_TextView.CanUndo;

            else if (CommandURL == UI_COMMAND_URL_EDIT_REDO)
                i_UICommand.Enabled = i_TextView.CanRedo;

            else if (CommandURL == UI_COMMAND_URL_EDIT_CUT)
                i_UICommand.Enabled = !ReadOnly && i_TextView.CanCopy;

            else if (CommandURL == UI_COMMAND_URL_EDIT_COPY)
                i_UICommand.Enabled = i_TextView.CanCopy;

            else if (CommandURL == UI_COMMAND_URL_EDIT_PASTE)
                i_UICommand.Enabled = i_TextView.CanPaste;

            else if (MatchCommandURL (CommandURL, "TextUndo"))
                i_UICommand.Enabled = i_TextView.CanUndo;
                
            else if (MatchCommandURL (CommandURL, "TextRedo"))
                i_UICommand.Enabled = i_TextView.CanRedo;
                
            else if (MatchCommandURL (CommandURL, "TextCut"))
                i_UICommand.Enabled = !ReadOnly && i_TextView.CanCopy;
                
            else if (MatchCommandURL (CommandURL, "TextCopy"))
                i_UICommand.Enabled = i_TextView.CanCopy;
                
            else if (MatchCommandURL (CommandURL, "TextPaste"))
                i_UICommand.Enabled = i_TextView.CanPaste;
                
            else if (MatchCommandURL (CommandURL, "TextDetectURLs"))
            {
                if (i_TextView.DetectURLs)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextFontBold"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.Bold == tomTrue)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }
                
            else if (MatchCommandURL (CommandURL, "TextFontItalic"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.Italic == tomTrue)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextFontUnderline"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.Underline == tomSingle)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextFontStrikeout"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.SelectionFont.StrikeThrough == tomTrue)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaAlignLeft"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.TextCache.Document.Selection.Para.Alignment == tomAlignLeft)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaAlignCenter"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.TextCache.Document.Selection.Para.Alignment == tomAlignCenter)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaAlignRight"))
            {
                i_UICommand.Enabled = !ReadOnly;
                if (i_TextView.TextCache.Document.Selection.Para.Alignment == tomAlignRight)
                    i_UICommand.CheckState = GrooveCheckState_Checked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaNumberBullet"))
            {
                i_UICommand.Enabled = !ReadOnly;
                var ListType = i_TextView.TextCache.Document.Selection.Para.ListType;
                if (ListType == tomUndefined)
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
                else if ((ListType & 0xFFFF) != tomListBullet)
                    i_UICommand.CheckState = GrooveCheckState_Unchecked;
                else
                    i_UICommand.CheckState = GrooveCheckState_Checked;
            }

            else if (MatchCommandURL (CommandURL, "TextParaIndent"))
                i_UICommand.Enabled = !ReadOnly;

            else if (MatchCommandURL (CommandURL, "TextParaOutdent"))
                i_UICommand.Enabled = !ReadOnly;
        }

        function MatchCommandURL (i_CommandURL, i_Pattern)
        {
            var Length = i_Pattern.length;
            return i_CommandURL.substr (0, Length) == i_Pattern;
        }

        function SubmitControlChar (i_String, i_TextView)
        {
            var CharCode = i_String.charCodeAt (0) & 0x1F;
            i_TextView.SubmitText (String.fromCharCode (CharCode));
        }

        function SubmitParaChange (i_Flags, i_Left, i_TextView)
        {
			var TabPositionEnum = CreateDoubleEnum ();
			var TabFlagsEnum = CreateLongEnum ();

            i_TextView.SubmitParaChange (i_Flags,
                                         tomUndefined,
                                         tomUndefined,
                                         i_Left,
                                         tomUndefined,
                                         tomUndefined,
                                         tomUndefined,
                                         TabPositionEnum,
                                         TabFlagsEnum);
        }

        function ShowTextUICommands (i_UICommandContainer)
        {
			var ImagesURL = GetString(pBundle, "System_IU_CTII");
            var ImagesMaskURL = GetString(pBundle, "System_IMU_CTII");
			var UNDO_TOOLTIP = GetString(pBundle,"System_CT_UN");
			var REDO_TOOLTIP = GetString(pBundle,"System_CT_RE");
			var CUT_TOOLTIP = GetString(pBundle, "System_CT_Cut");
			var COPY_TOOLTIP = GetString(pBundle, "System_CT_Cpy");
			var PASTE_TOOLTIP = GetString(pBundle, "System_CT_Pst");
			var BOLD_TOOLTIP = GetString(pBundle,"System_CT_BT");
			var UNDERLINE_TOOLTIP = GetString(pBundle,"System_CT_UT");
			var ITALICS_TOOLTIP = GetString(pBundle,"System_CT_IT");
			var ALIGN_LEFT_TOOLTIP = GetString(pBundle, "System_CT_AL");
			var ALIGN_CENTER_TOOLTIP = GetString(pBundle, "System_CT_AC");
			var ALIGN_RIGHT_TOOLTIP = GetString(pBundle, "System_CT_AR");
			var BULLETS_TOOLTIP = GetString(pBundle, "System_CT_Bul");
			var INCREASE_INDENT_TOOLTIP = GetString(pBundle, "System_CT_II" );
			var DECREASE_INDENT_TOOLTIP = GetString(pBundle, "System_CT_DI" );		
			

            
			var Position = i_UICommandContainer.GetNumberOfUICommands ();
			
            //var UICommand;
            //-----
            // undo
            //-----

            UICommand = i_UICommandContainer.InsertUICommand ("TextUndo", Position++);
            UICommand.Tooltip = UNDO_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 24, 16, 16);

            //-----
            // redo
            //-----

            UICommand = i_UICommandContainer.InsertUICommand ("TextRedo", Position++);
            UICommand.Tooltip = REDO_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 25, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep1", Position++);
                
            //-----
            // cut
            //-----

            UICommand = i_UICommandContainer.InsertUICommand ("TextCut", Position++);
            UICommand.Tooltip = CUT_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 2, 16, 16);

            //-----
            // copy
            //-----

            UICommand = i_UICommandContainer.InsertUICommand ("TextCopy", Position++);
            UICommand.Tooltip = COPY_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 3, 16, 16);

            //------
            // paste
            //------

            UICommand = i_UICommandContainer.InsertUICommand ("TextPaste", Position++);
            UICommand.Tooltip = PASTE_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 5, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep2", Position++);

            //------
            // bold
            //------

            UICommand = i_UICommandContainer.InsertUICommand ("TextFontBold", Position++);
            UICommand.Tooltip = BOLD_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 27, 16, 16);

            //-------
            // italic
            //-------

            UICommand = i_UICommandContainer.InsertUICommand ("TextFontItalic", Position++);
            UICommand.Tooltip = ITALICS_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 28, 16, 16);

            //----------
            // underline
            //----------

            UICommand = i_UICommandContainer.InsertUICommand ("TextFontUnderline", Position++);
            UICommand.Tooltip = UNDERLINE_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 29, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep3", Position++);

            //-----------
            // align left
            //-----------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaAlignLeft", Position++);
            UICommand.Tooltip = ALIGN_LEFT_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 34, 16, 16);

            //-------
            // center
            //-------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaAlignCenter", Position++);
            UICommand.Tooltip = ALIGN_CENTER_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 35, 16, 16);

            //------------
            // align right
            //------------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaAlignRight", Position++);
            UICommand.Tooltip = ALIGN_RIGHT_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 36, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep4", Position++);

            //--------
            // bullets
            //--------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaNumberBullet", Position++);
            UICommand.Tooltip = BULLETS_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 33, 16, 16);

            i_UICommandContainer.InsertSeparator ("TextSep5", Position++);

            //----------------
            // increase indent
            //----------------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaIndent", Position++);
            UICommand.Tooltip = INCREASE_INDENT_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 32, 16, 16);

            //----------------
            // decrease indent
            //----------------

            UICommand = i_UICommandContainer.InsertUICommand ("TextParaOutdent", Position++);
            UICommand.Tooltip = DECREASE_INDENT_TOOLTIP;
            UICommand.SetImage (ImagesURL, ImagesMaskURL, 16 * 31, 16, 16);
        }

        function HideTextUICommands (i_UICommandContainer)
        {
            i_UICommandContainer.RemoveUICommand ("TextUndo");
            i_UICommandContainer.RemoveUICommand ("TextRedo");
            i_UICommandContainer.RemoveUICommand ("TextCut");
            i_UICommandContainer.RemoveUICommand ("TextCopy");
            i_UICommandContainer.RemoveUICommand ("TextPaste");
            i_UICommandContainer.RemoveUICommand ("TextFontBold");
            i_UICommandContainer.RemoveUICommand ("TextFontItalic");
            i_UICommandContainer.RemoveUICommand ("TextFontUnderline");
            i_UICommandContainer.RemoveUICommand ("TextParaAlignLeft");
            i_UICommandContainer.RemoveUICommand ("TextParaAlignCenter");
            i_UICommandContainer.RemoveUICommand ("TextParaAlignRight");
            i_UICommandContainer.RemoveUICommand ("TextParaNumberBullet");
            i_UICommandContainer.RemoveUICommand ("TextParaIndent");
            i_UICommandContainer.RemoveUICommand ("TextParaOutdent");
            i_UICommandContainer.RemoveSeparator ("TextSep1");
            i_UICommandContainer.RemoveSeparator ("TextSep2");
            i_UICommandContainer.RemoveSeparator ("TextSep3");
            i_UICommandContainer.RemoveSeparator ("TextSep4");
            i_UICommandContainer.RemoveSeparator ("TextSep5");
        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    @           œ  0        «     Va  Va                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                8               Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄNameF   G r o o v e R i c h T e x t C o m m a n d B a r H e l p e r 2 . g s l         ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT      ÄSCRIPT  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  § U   Ä :      ø          )                      @            —     “      ”  ê                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (               Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t      ÄNameF   G r o o v e R i c h T e x t C o m m a n d B a r H e l p e r 2 . g s l         ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT      Ä  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       n          X                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          N    † U   Ä :      ø          )            ÄSCRIPT         - Ä

        var UI_COMMAND_CONTAINER_URL_FILE                 = "GUICC_File";
        var UI_COMMAND_URL_NEW_WINDOW                     = "GUIC_NewWindow";
        var UI_COMMAND_URL_NEW_SHARED_SPACE               = "GUIC_NewSharedSpace";
        var UI_COMMAND_URL_RENAME_SHARED_SPACE            = "GUIC_RenameSharedSpace";
        var UI_COMMAND_URL_DELETE_SHARED_SPACE            = "GUIC_DeleteSharedSpace";     
        var UI_COMMAND_URL_INVITE_BY_INSTANT_MESSAGE      = "GUIC_InviteByInstantMessage";
        var UI_COMMAND_URL_INVITE_BY_EMAIL                = "GUIC_InviteByEmail";
        var UI_COMMAND_URL_SAVE_INVITATION_FILE           = "GUIC_SaveInvitationFile";
        var UI_COMMAND_URL_EXIT                           = "GUIC_Exit";
                        
        var UI_COMMAND_CONTAINER_URL_EDIT                 = "GUICC_Edit";
        var UI_COMMAND_URL_EDIT_UNDO                      = "GUIC_EditUndo";
        var UI_COMMAND_URL_EDIT_REDO                      = "GUIC_EditRedo";
        var UI_COMMAND_URL_EDIT_CUT                       = "GUIC_EditCut";
        var UI_COMMAND_URL_EDIT_COPY                      = "GUIC_EditCopy";
        var UI_COMMAND_URL_EDIT_PASTE                     = "GUIC_EditPaste";
        var UI_COMMAND_URL_EDIT_SELECT_ALL                = "GUIC_EditSelectAll";

        var UI_COMMAND_CONTAINER_URL_VIEW                 = "GUICC_View";
        var UI_COMMAND_URL_GO_BACK                        = "GUIC_GoBack";
        var UI_COMMAND_URL_GO_FORWARD                     = "GUIC_GoForward";
        var UI_COMMAND_URL_GO_TO_HOME_PAGE                = "GUIC_GoToHomePage";
        var UI_COMMAND_URL_GO_TO_MY_CONTACTS              = "GUIC_GoToMyContacts";
        var UI_COMMAND_URL_GO_TO_MY_SPACES                = "GUIC_GoToMySpaces";
        var UI_COMMAND_URL_GO_TO_MY_ACCOUNT               = "GUIC_GoToMyAccount";
        var UI_COMMAND_URL_GO_TO                          = "GUIC_GoTo";
                        
        var UI_COMMAND_CONTAINER_URL_TOOLS                = "GUICC_Tools";
        var UI_COMMAND_URL_INSTANT_GROOVE                 = "GUIC_InstantGroove";
        var UI_COMMAND_URL_TOGGLE_SUPPRESS_NOTIFICATIONS  = "GUIC_ToggleSuppressNotifications";
        var UI_COMMAND_URL_TOGGLE_PAUSE_COMMUNICATIONS    = "GUIC_TogglePauseCommunications";

        var UI_COMMAND_CONTAINER_URL_HELP                 = "GUICC_Help";
        var UI_COMMAND_URL_HELP_CONTENTS                  = "GUIC_HelpContents";
        var UI_COMMAND_URL_HELP_ON                        = "GUIC_HelpOn";
        var UI_COMMAND_URL_TOGGLE_OVERVIEW                = "GUIC_ToggleOverview";
        var UI_COMMAND_URL_ABOUT_GROOVE                   = "GUIC_AboutGroove";

		var pIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pBundle = pIntl.CreateResourceBundle("http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.Tools.General.RichText.RichText_RBD&Version=0", pIntl.DefaultLocale);
					
		var COLOR_BLACK_MENU_LABEL = GetString(pBundle, "System_Blk");
		var COLOR_MAROON_MENU_LABEL = GetString(pBundle, "System_Mrn");
		var COLOR_GREEN_MENU_LABEL = GetString(pBundle, "System_Grn");
		var COLOR_OLIVE_MENU_LABEL = GetString(pBundle, "System_Olv");
		var COLOR_NAVY_MENU_LABEL = GetString(pBundle, "System_Nvy");
		var COLOR_PURPLE_MENU_LABEL = GetString(pBundle, "System_Prp");
		var	COLOR_TEAL_MENU_LABEL = GetString(pBundle, "System_Tl");
		var COLOR_GRAY_MENU_LABEL =GetString(pBundle, "System_Gry");
		var COLOR_SILVER_MENU_LABEL = GetString(pBundle, "System_Slv");
		var COLOR_RED_MENU_LABEL =GetString(pBundle, "System_Rd");
		var COLOR_LIME_MENU_LABEL = GetString(pBundle, "System_Lm");
		var COLOR_YELLOW_MENU_LABEL = GetString(pBundle, "System_Ylw");
		var COLOR_BLUE_MENU_LABEL =GetString(pBundle, "System_Bl");
		var COLOR_FUCHSIA_MENU_LABEL = GetString(pBundle, "System_Fsa");
		var COLOR_AQUA_MENU_LABEL = GetString(pBundle, "System_Aq");
		var COLOR_WHITE_MENU_LABEL = GetSt      ò   ring(pBundle, "System_Wh");
		var COLOR_DEFAULT_LABEL = GetString(pBundle, "System_Def");
		var COLOR_NONE_LABEL=GetString(pBundle, "System_Nn");
		var MORE_COLORS_LABEL = GetString(pBundle, "System_MrClr");
		var SIZE_8_LABEL = GetString(pBundle, "System_ML_8");
		var SIZE_10_LABEL = GetString(pBundle, "System_ML_10");
		var SIZE_12_LABEL = GetString(pBundle, "System_ML_12");
		var SIZE_14_LABEL = GetString(pBundle, "System_ML_14");
		var SIZE_18_LABEL = GetString(pBundle, "System_ML_18");
		var SIZE_24_LABEL = GetString(pBundle, "System_ML_24");
		var SIZE_36_LABEL = GetString(pBundle, "System_ML_36");
		var SIZE_48_LABEL = GetString(pBundle, "System_ML_48");
		var SIZE_72_LABEL = GetString(pBundle, "System_ML_72");	

         var ColorNames = new Array (COLOR_BLACK_MENU_LABEL,
                                        COLOR_MAROON_MENU_LABEL,
                                        COLOR_GREEN_MENU_LABEL,
                                        COLOR_OLIVE_MENU_LABEL,
                                        COLOR_NAVY_MENU_LABEL,
                                        COLOR_PURPLE_MENU_LABEL,
                                        COLOR_TEAL_MENU_LABEL,
                                        COLOR_GRAY_MENU_LABEL,
                                        COLOR_SILVER_MENU_LABEL,
                                        COLOR_RED_MENU_LABEL,
                                        COLOR_LIME_MENU_LABEL,
                                        COLOR_YELLOW_MENU_LABEL,
                                        COLOR_BLUE_MENU_LABEL,
                                        COLOR_FUCHSIA_MENU_LABEL,
                                        COLOR_AQUA_MENU_LABEL,
                                        COLOR_WHITE_MENU_LABEL);

        var ColorValues = new Array (GLOBAL_COLOR_VALUE_BLACK_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_MAROON_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_GREEN_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_OLIVE_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_NAVY_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_PURPLE_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_TEAL_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_GRAY_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_SILVER_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_RED_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_LIME_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_YELLOW_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_BLUE_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_FUCHSIA_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_AQUA_MENU_LABEL,
                                     GLOBAL_COLOR_VALUE_WHITE_MENU_LABEL);

        var FontSizes = new Array (SIZE_8_LABEL,
                                   SIZE_10_LABEL,
                                   SIZE_12_LABEL,
                                   SIZE_14_LABEL,
                                   SIZE_18_LABEL,
                                   SIZE_24_LABEL,
                                   SIZE_36_LABEL,
                                   SIZE_48_LABEL,
                                   SIZE_72_LABEL);

		var FontSizeValues = new Array(	8,
										10,
										12,
										14,
										18,
										24,
										36,
										48,
										72);

        var FontFaces = new Array ("Arial",
                                   "Comic Sans MS" ,
                                   "Courier New",
                                   "Symbol",
                                   "Times New Roman",
                                   "Wingdings");

        

                                                                                                                                                                 X                    @            ’  ®  ÷  ‡                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ∞               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName:   G r o o v e T e x t H e l p e r F u n c t i o n s . g s l         ÄSCRIPTMODULE  SCRIPTMODULE  ÄSCRIPTMODULE            ÄSCRIPT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Ä +      ≥          )      Ë     ÄSCRIPT         Ï Ä

	// ************************************************************************
	//
	// GrooveTextHelperFunctions.gsl
	//	
	// Text-related glue code functions to supplement JScript.
	//
	// Copyright 2000 Groove Networks, Inc.  All Rights Reserved.
	// Written by Mike F, 08/23/2000
	//
	// ************************************************************************
	//
	//		function TrimWhiteSpace(i_String) 
	//		function LTrimWhiteSpace(i_String)
	//		function RTrimWhiteSpace(i_String)
	//
	//		-- second parameter is optional and defaults to space (" ")
	//		function Trim(i_String, i_TrimChar) 
	//		function LTrim(i_String, i_TrimChar)
	//		function RTrim(i_String, i_TrimChar)
	//
	// ************************************************************************

	//---------------------------------------------------------------
	// Removes all whitespace at the beginning and end of
	// the supplied string.  Whitespace is: [ \f\n\r\t\v]
	//---------------------------------------------------------------
	function TrimWhiteSpace(i_String) 
	{
		var retStr;
		retStr = LTrimWhiteSpace(i_String);
		retStr = RTrimWhiteSpace(retStr);
		return retStr;
	}

	//---------------------------------------------------------------
	// Removes all whitespace at the beginning of the
	// supplied string.  Whitespace is: [ \f\n\r\t\v]
	//---------------------------------------------------------------
	function LTrimWhiteSpace(i_String)
	{
		var whitespace = /\s/;
		var len = i_String.length;
		var start = 0;
		while (i_String.charAt(start).search(whitespace) != -1 && start < len)
			start++;
		return i_String.slice(start);
	}

	//---------------------------------------------------------------
	// Removes all whitespace at the end of the supplied
	// string.  Whitespace is: [ \f\n\r\t\v]
	//---------------------------------------------------------------
	function RTrimWhiteSpace(i_String)
	{
		var whitespace = /\s/;
		var end = i_String.length-1;
		while (i_String.charAt(end).search(whitespace) != -1 && end > 0)
			end--;
		return i_String.slice(0,end+1);
	}

	//---------------------------------------------------------------
	// Removes all characters at the beginning and end of the supplied
	// string that match the supplied character.  If no character is
	// supplied, the function trims spaces.
	//---------------------------------------------------------------
	function Trim(i_String, i_TrimChar) 
	{
		var retStr;
		retStr = LTrim(i_String, i_TrimChar);
		retStr = RTrim(retStr, i_TrimChar);
		return retStr;
	}

	//---------------------------------------------------------------
	// Removes all characters at the beginning of the supplied
	// string that match the supplied character.  If no character is
	// supplied, the function trims spaces.
	//---------------------------------------------------------------
	function LTrim(i_String, i_TrimChar)
	{
		// if i_TrimChar not specified, default to space (' ')
		if (typeof i_TrimChar == "undefined") i_TrimChar = ' ';

		var start = 0;
		while (i_String.charAt(start) == i_TrimChar && start < i_String.length)
			start++;
		return i_String.slice(start);
	}

	//---------------------------------------------------------------
	// Removes all characters at the end of the supplied string that
	// match the supplied character.  If no character is supplied,
	// the function trims spaces.
	//---------------------------------------------------------------
	function RTrim(i_String, i_TrimChar)
	{
		// if i_TrimChar not specified, default to space (' ')
		if (typeof i_TrimChar == "undefined") i_TrimChar = ' ';

		var end = i_String.length-1;
		while (i_String.charAt(end) == i_TrimChar && end > 0)
			end--;
		return i_String.slice(0,end+1);
	}

	                                                                                                                                                                                                                                         Ä              5      @            ÿ  h   Ÿ  ò   ⁄  ò   €    ‹     ›      %    6    "    +    ?    4    $    ;  
      1    ,                 8    5    0                    <    '  	  /     B     -        !    9  	          A    @    =            #    :    *    &    (  
        	  )        7             >    2    .          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      E5 p                Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName.   G r o o v e T y p e L i b r a r i e s . g s l         ÄSCRIPTMODULE     Äurn:groove.net:DocumentD     ÄSCRIPTMODULE      @      ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB	     ÄTYPELIB
     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB      ÄTYPELIB!     ÄTYPELIB"     ÄTYPELIB#     ÄTYPELIB$     ÄTYPELIB%     ÄTYPELIB&     ÄTYPELIB'     ÄTYPELIB(     ÄTYPELIB)     ÄTYPELIB*     ÄTYPELIB+     ÄTYPELIB,     ÄTYPELIB-     ÄTYPELIB.     ÄTYPELIB/     ÄTYPELIB0     ÄTYPELIB1     ÄTYPELIB2     ÄTYPELIB3     ÄTYPELIB4     ÄTYPELIB5     ÄTYPELIB6     ÄTYPELIB7     ÄTYPELIB8     ÄTYPELIB9     ÄTYPELIB:     ÄTYPELIB;     ÄTYPELIB<     ÄTYPELIB=     ÄTYPELIB>     ÄTYPELIB?     ÄTYPELIB@     ÄTYPELIBA     ÄTYPELIBB     ÄSCRIPTC  PELIB  ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName:   G r o o v e D i s c u s s i o n T o o l D e l e g a t e s     ÄLIBIDL   { 0 1 B 9 9 9 7 7 - 3 9 7 E - 4 9 2 d - A 4 F B - E D 2 9 6 B A F B F F 7 }   72         ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME(   G r o o v e C r y p t o S e r v i c e s       ÄLIBIDL   { 0 3 5 A D 9 1 0 - 3 4 D 5 - 4 C E 6 - B 9 6 A - 1 7 7 4 2 9 9 F 4 B 4 3 }   47    ELIB  ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME   G r o o v e F o r m s     ÄLIBIDL   { 0 5 1 C 8 C 9 A - D E 3 7 - 4 5 4 5 - A E 3 4 - 0 A 6 A 4 A E 8 C 0 1 4 }   te      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAMEP   G r o o v e P r o j e c t D a s h b o a r d P e n d i n g I t e m D e t a i l s   6-  ÄLIBIDL   { 0 8 9 C 3 2 A B - 5 9 7 5 - 4 2 3 3 - B 1 E 6 - D 5 9 D D D D 4 D C C A }   ov    - 4   ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName&   G r o o v e T a s k S c h e d u l e r     ÄLIBIDL   { 0 8 F A 7 D 2 5 - 4 2 8 8 - 4 4 3 F - B C 8 3 - E D 9 E B D 1 6 F C 3 1 }   		      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME.   G r o o v e C o m m u n i c a t i o n s M g r     ÄLIBIDL   { 0 9 9 2 B 6 4 0 - A E D E - 1 1 d 1 - A 0 6 A - 0 0 8 0 C 7 4 0 B F B D }   ch      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName   D o c u m e n t S h a r e     ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   me    5 -   ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME.   G r o o v e T e l e s p a c e S e r v i c e s     ÄLIBIDL   { 0 F 6 C 0 7 5 0 - 5 A 3 B - 1 1 d 2 - 9 4 4 F - 0 0 8 0 C 7 D E 3 2 C 6 }   }"      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME   G r o o v e C l i e n t       ÄLIBIDL   { 5 A A 9 1 6 C 6 - B F 1 2 - 1 1 D 3 - 8 0 A 0 - 0 0 C 0 4 F A 1 1 0 0 A }         2 -   ÄTYPELIB       ÄLIBIDL   { B 5 6 2 9 7 2 0 - 0 5 5 3 - 4 2 4 8 - 8 0 6 1 - C 5 8 1 F 4 3 0 5 7 7 B }         VER       E     Äurn:groove.net:Document           2 9 7 2 0 - 0 5 5 3 - 4 2 4 8 - 8 0 6 1 - C 5 8 1 F 4 3 0 5 7 7 B }         0 C 0 4 F A 1 1 0 0 A }             †'    ö                                                                                                                            \t                                                                                                                                                    ¯ƒ                                                                                                                                                                    åÿ    (ƒ    ºÿ    T–    ‘¸    t¿    ‘    î‰    Ñ      «          )      †     ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME4   G r o o v e C o n t a c t S e r v i c e s A l p h a   Se  ÄLIBIDL   { 1 0 A D 6 6 2 D - 5 A D 4 - 4 a c d - A 4 1 7 - 9 3 F 5 1 3 5 8 D E 0 C }   A3      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME"   G r o o v e O b j e c t S t o r e     ÄLIBIDL   { 1 7 5 7 B A F 1 - 1 6 3 2 - 1 1 d 5 - 8 0 D D - 0 0 5 0 D A 1 C 0 4 B 5 }   24          ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName   G r o o v e A u d i o     ÄLIBIDL   { 1 8 8 5 E 2 F 7 - C 1 E 3 - 1 1 D 3 - 8 E 3 7 - 0 0 5 0 D A B 9 3 5 6 2 }   E0      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName4   G r o o v e A c c o u n t S e r v i c e s A l p h a   45  ÄLIBIDL   { 1 B 6 9 D 3 2 3 - 3 9 C D - 4 3 f f - 8 1 0 1 - A C F 7 2 F 3 6 F C A 1 }   LI      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME,   G r o o v e U I F r a m e w o r k W i n 3 2   R=  ÄLIBIDL   { 1 D 2 A C 8 E C - C 2 3 4 - 1 1 d 3 - 8 0 A 1 - 0 0 C 0 4 F A 1 1 0 0 A }   D1      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME@   G r o o v e M a n a g e d O b j e c t S e r v i c e s A l p h a       ÄLIBIDL   { 1 E B 1 4 E 0 6 - E 5 5 8 - 4 f 5 2 - 9 F 5 5 - E 3 2 E 9 A 6 7 8 C E F }   9D          ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME   G r o o v e T e x t T o o l s     ÄLIBIDL   { 2 8 D 0 C 8 0 9 - 4 B 8 5 - 1 1 D 3 - 8 9 5 7 - 0 0 1 0 5 A 2 7 2 D C F }   E-      ÄTYPELIB       ÄName8   G r o o v e T e l e s p a c e S e r v i c e s A l p h a   ct  ÄLIBIDL   { 2 A 5 1 6 0 E C - F F B 5 - 4 5 1 6 - 8 F C 6 - 7 F 7 1 B E A E 7 5 C 8 }    L          ÄTYPELIB       ÄNameB   G r o o v e C o m m u n i c a t i o n s S e r v i c e s A l p h a     ÄLIBIDL   { 3 0 8 5 0 E D F - 6 5 4 4 - 4 9 d 8 - B 2 F 7 - 1 2 1 9 F 5 5 2 F 5 8 6 }   >          ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName,   G r o o v e F o r m s T o o l P r i v a t e   		  ÄLIBIDL   { 3 6 6 D F D 5 1 - 2 C 2 2 - 4 3 8 d - 9 1 3 5 - 5 0 9 3 E 3 1 0 2 4 4 7 }   "1      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME6   G r o o v e I d e n t i t y S e r v i c e s A l p h a     ÄLIBIDL   { 3 7 E 3 A F 3 B - 5 7 B E - 4 d 3 5 - 8 0 2 8 - 6 3 A 9 4 3 8 F 9 0 0 1 }    M      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME*   G r o o v e C o n t a c t S e r v i c e s     ÄLIBIDL   { 3 A E 5 5 7 E 8 - E 2 0 1 - 1 1 D 2 - A 5 F 0 - 0 0 1 0 5 A 0 D 0 5 8 F }   fi          ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName0   G r o o v e C u s t o m e r S e r v i c e M g r   1d  ÄLIBIDL   { 3 E 7 0 E 5 1 5 - F 1 A 4 - 1 1 D 2 - A F 3 5 - 0 0 5 0 0 4 6 7 7 0 0 A }   8C          ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName,   G r o o v e I d e n t i t y S e r v i c e s   MI  ÄLIBIDL   { 4 1 0 2 4 3 9 0 - C 2 1 E - 1 1 D 3 - 8 0 F C - 0 0 5 0 0 4 A D 1 A 6 6 }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME   U I F r a m e w o r k     ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 d 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName@   G r o o v e D i s c u s s i o n T o o l D a t a D e l e g a t e       ÄLIBIDL   { 4 3 5 6 3 6 2 A - 7 8 7 B - 4 e 9 f - A A A E - 0 A 7 1 A F A 2 3 6 D 8 }   99          ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName,   G r o o v e C e r t i f i c a t e S t o r e   "   ÄLIBIDL   { 4 3 7 8 E E F 7 - F E 1 1 - 1 1 d 4 - 8 0 D A - 0 0 5 0 D A 1 C 0 4 B 5 }   d       ÄTYPELIB       ÄNAME   S H D o c V w     ÄLIBIDL   { E A B 2 2 A C 0 - 3 0 C 1 - 1 1 C F - A 7 E B - 0 0 0 0 C 0 5 B A E 0 B }                                                                                                                                                                          áê    ¥Üÿ    <ÜÏ    ‹Ö¿    pÖÿ     Ö‹    îÑ‘    $Ñ‡    ∏Éÿ    TÉƒ    ÙÇº    êÇ»    ÇÏ    ¨Åÿ    <Å‡    ‹Ä¿    tÄÃ    Ä‡      †     ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME    G r o o v e S t o r a g e M g r       ÄLIBIDL   { 4 5 8 5 3 C C 8 - 7 8 7 9 - 1 1 D 1 - A C 6 3 - 0 0 8 0 C 7 C 1 3 5 C 6 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName,   G r o o v e U I F r a m e w o r k A l p h a   F6  ÄLIBIDL   { 4 9 7 3 E 4 9 0 - 2 4 5 3 - 4 b 2 4 - B F 8 1 - 6 7 6 8 4 A 5 E 4 9 4 5 }   
      ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName&   G r o o v e D a t a L i s t A l p h a     ÄLIBIDL   { 5 6 A 5 8 8 1 1 - A E 9 9 - 1 1 d 5 - B 9 0 B - 0 0 5 0 D A C D 1 F 7 5 }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName    G r o o v e C o m p o n e n t s       ÄLIBIDL   { 5 A A 9 1 6 C 7 - B F 1 2 - 1 1 d 3 - 8 0 A 0 - 0 0 C 0 4 F A 1 1 0 0 A }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME.   G r o o v e M i s c S e r v i c e s A l p h a     ÄLIBIDL   { 5 D F 8 C B 6 1 - C 9 3 0 - 4 4 8 e - 8 0 E 9 - 2 1 9 B 5 5 9 1 3 7 0 8 }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME2   G r o o v e M i s c S e r v i c e s P r i v a t e     ÄLIBIDL   { 0 5 5 B D 5 2 2 - D 3 6 A - 4 2 8 3 - A 4 7 F - 6 D A F E 5 7 0 F 9 3 B }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME0   G r o o v e P r o j e c t T o o l s e t M i s c   	<  ÄLIBIDL   { 6 5 2 4 E 2 1 7 - E 7 F F - 4 7 9 b - 8 8 2 E - 3 2 C 0 D A E 1 F 1 2 8 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME4   G r o o v e I n t e r n a t i o n a l i z a t i o n   to  ÄLIBIDL   { 6 5 E 7 2 A E E - 3 4 C 0 - 4 7 B 4 - 9 0 0 2 - C 6 F 7 2 5 7 5 7 C 5 A }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME*   G r o o v e P r o j e c t T r a c k i n g     ÄLIBIDL   { 7 0 E F 3 7 D B - F 5 D 8 - 4 6 4 6 - B 1 4 0 - 1 A 6 9 F B 4 1 8 A D B }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName8   G r o o v e D i s c u s s i o n E n t r y P r i v a t e   7-  ÄLIBIDL   { 7 7 2 9 6 F 5 D - 5 F A A - 4 d 7 4 - A 3 9 F - A F D 3 8 C 6 D B E 2 4 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName<   G r o o v e C a l e n d a r T o o l D a t a D e l e g a t e       ÄLIBIDL   { 7 F C 0 8 5 9 C - 2 E 8 1 - 4 7 4 A - B 9 0 6 - 3 E 9 0 D D C 7 A F 4 C }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName8   G r o o v e T r a n s p o r t S e r v i c e s A l p h a   LI  ÄLIBIDL   { 8 A 2 2 4 E 8 A - 0 0 8 5 - 4 b d d - 9 4 5 6 - 3 1 7 E E 7 7 2 E 5 B 3 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME6   G r o o v e M a n a g e d O b j e c t S e r v i c e s     ÄLIBIDL   { 9 6 2 B 1 5 1 F - 1 4 D 7 - 4 4 0 0 - A 0 9 1 - 2 E B B 0 0 B 6 C 3 3 E }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME(   G r o o v e D a t a V i e w e r T o o l       ÄLIBIDL   { 9 A 2 5 D 1 2 0 - F A 0 E - 1 1 d 4 - B B A E - 0 0 0 1 0 2 4 6 B 3 E 5 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME8   G r o o v e A w a r e n e s s S e r v i c e s A l p h a   34  ÄLIBIDL   { 9 C 0 B B 9 1 6 - C A D 0 - 4 9 b 8 - B 0 1 2 - 4 6 3 F E 9 D 6 A D D 6 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME   C a l e n d a r T o o l       ÄLIBIDL   { 9 E 0 8 3 B 9 F - 8 D 3 B - 1 1 D 3 - 8 7 4 F - 0 0 8 0 C 7 A 5 7 E 6 F }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName   G r o o v e F o r m s T o o l     ÄLIBIDL   { A A E D 1 E 7 5 - D 5 D 2 - 4 3 b b - 9 2 9 8 - 1 2 1 A E F 3 E 3 E 4 B }          = 2;
        var tomHTML = 3;
        var tomWordDocument = 4;
		                                                                                                                                                                   EE    ‡Ü»    |Üƒ    Ü‰    úÖ‘    ,Ö‡    ∏Ñ‰    DÑË    –É‰    dÉ‘    ÙÇ‡    ÑÇ‹    Ç‹    ®Åÿ    @ÅÃ    ÿÄ–    lÄÿ    ÄÃ          ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName   G r o o v e W i n 3 2 U I     ÄLIBIDL   { A 7 E 8 2 5 3 5 - 2 D 6 E - 1 1 D 3 - 9 7 5 4 - 0 0 1 0 4 B 9 B 1 7 2 F }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName:   G r o o v e C r e d e n t i a l S e r v i c e s A l p h a     ÄLIBIDL   { A F 1 D 9 8 A 6 - 9 7 C E - 4 b 7 5 - 8 3 F C - 7 8 D 8 6 2 9 C 3 1 1 4 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME   S k e t c h T o o l       ÄLIBIDL   { B 1 B D 3 7 1 5 - 6 E 9 A - 1 1 d 2 - 8 8 F E - 0 0 1 0 5 A 2 7 2 D C F }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName<   G r o o v e A p p l i c a t i o n S e r v i c e s A l p h a       ÄLIBIDL   { B 2 3 D 1 C 2 1 - B 0 8 6 - 4 9 8 3 - 8 B 2 5 - 6 7 C 7 F C 3 7 6 0 A D }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName0   D o c u m e n t S h a r e T o o l P r i v a t e   67  ÄLIBIDL   { B 6 E 9 9 3 2 2 - A 0 D 0 - 4 9 6 3 - 8 4 4 F - F C B 9 D 5 6 E 8 D 1 2 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName8   G r o o v e D o c u m e n t S h a r e T o o l A l p h a   <T  ÄLIBIDL   { C 3 3 B 4 0 7 C - 2 D F A - 4 a c 0 - 8 A A 3 - 3 9 A 9 5 3 2 6 0 C E 7 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName&   G r o o v e S c r i p t P r i v a t e     ÄLIBIDL   { D C 0 C 3 C 8 3 - 8 D 9 0 - 4 d a 2 - 8 A 6 2 - D 9 1 4 6 2 E C A 4 6 1 }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName2   G r o o v e C o m p o n e n t M g r P r i v a t e     ÄLIBIDL   { E 0 1 3 8 2 7 8 - 3 E 5 7 - 4 4 E 2 - A B 6 4 - B 0 A 3 B 9 C 5 6 C D E }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME&   G r o o v e T o o l C o n t a i n e r     ÄLIBIDL   { E 0 6 B C C 2 0 - C 2 4 4 - 1 1 d 3 - 8 0 F D - 0 0 5 0 0 4 A D 1 A 6 6 }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME*   G r o o v e A c c o u n t S e r v i c e s     ÄLIBIDL   { E 0 6 B C C 2 1 - C 2 4 4 - 1 1 d 3 - 8 0 F D - 0 0 5 0 0 4 A D 1 A 6 6 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME   M i s c   n   ÄLIBIDL   { F 0 2 2 E 9 5 5 - 5 6 2 6 - 1 1 D 1 - A C 2 9 - 0 0 5 2 4 5 0 0 0 0 0 0 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME.   G r o o v e C o l l e c t i o n M a n a g e r     ÄLIBIDL   { F 2 0 E A 7 7 1 - 6 D 4 4 - 1 1 D 3 - 8 0 9 D - 0 0 5 0 D A 0 F 1 5 F B }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName2   G r o o v e D e v i c e S e r v i c e s A l p h a     ÄLIBIDL   { F 4 0 7 2 B 6 E - 8 1 A B - 4 E E E - A E D 2 - 9 1 7 9 6 6 C 3 A 2 F 6 }               ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME,   G r o o v e C o m m o n C o m p o n e n t s   om  ÄLIBIDL   { F B 1 E B A B 0 - C 1 5 9 - 1 1 D 3 - 8 0 B 6 - 0 0 5 0 0 4 8 7 8 8 7 B }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME4   G r o o v e C o l l e c t i o n C o m p o n e n t s   10  ÄLIBIDL   { F B 1 E B A B 1 - C 1 5 9 - 1 1 d 3 - 8 0 B 6 - 0 0 5 0 0 4 8 7 8 8 7 B }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName&   G r o o v e H e l p e r P r i v a t e     ÄLIBIDL   { F F C 9 B 1 C F - C A C 7 - 4 e d 4 - A 3 B 6 - 3 7 9 3 F 5 6 9 9 D A C }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName>   G r o o v e N o t i f i c a t i o n S e r v i c e s A l p h a     ÄLIBIDL   { 1 A B 3 0 8 F F - 9 7 A 0 - 4 4 e 9 - B 9 8 1 - 8 9 B E B 6 F E 2 5 D 2 }                                                                                                                                                                                                                                                                                                 ºÜË    TÜ–    ‰Ö‡    xÖÿ    Ö‹    úÑÿ    @Ñ¥    ‘É‘    lÉ–    ¸Ç‹    îÇ–     Ç‰    ∞Å‹    <ÅË    ‹Ä¿    hÄ‰    Äƒ          ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄName>   G r o o v e T o o l T e m p l a t e S e r v i c e s A l p h a     ÄLIBIDL   { F 1 7 C 8 5 5 D - 5 4 0 D - 4 0 4 6 - 8 2 F 2 - E 2 9 5 8 0 F F 2 8 C 9 }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ÄË            ÄSCRIPT          Ä
        // Copied from enum tomConstants in tom.idl
        var tomFalse = 0;
        var tomTrue = -1;
        var tomUndefined = -9999999;
        var tomToggle = -9999998;
        var tomAutoColor = -9999997;
        var tomDefault = -9999996;
        var tomBackward = -1073741823;
        var tomForward = 1073741823;
        var tomMove = 0;
        var tomExtend = 1;
        var tomNoSelection = 0;
        var tomSelectionIP = 1;
        var tomSelectionNormal = 2;
        var tomSelectionFrame = 3;
        var tomSelectionColumn = 4;
        var tomSelectionRow = 5;
        var tomSelectionBlock = 6;
        var tomSelectionInlineShape = 7;
        var tomSelectionShape = 8;
        var tomSelStartActive = 1;
        var tomSelAtEOL = 2;
        var tomSelOvertype = 4;
        var tomSelActive = 8;
        var tomSelReplace = 16;
        var tomEnd = 0;
        var tomStart = 32;
        var tomCollapseEnd = 0;
        var tomCollapseStart = 1;
        var tomNone = 0;
        var tomSingle = 1;
        var tomWords = 2;
        var tomDouble = 3;
        var tomDotted = 4;
        var tomLineSpaceSingle = 0;
        var tomLineSpace1pt5 = 1;
        var tomLineSpaceDouble = 2;
        var tomLineSpaceAtLeast = 3;
        var tomLineSpaceExactly = 4;
        var tomLineSpaceMultiple = 5;
        var tomAlignLeft = 0;
        var tomAlignCenter = 1;
        var tomAlignRight = 2;
        var tomAlignJustify = 3;
        var tomAlignDecimal = 3;
        var tomAlignBar = 4;
        var tomSpaces = 0;
        var tomDots = 1;
        var tomDashes = 2;
        var tomLines = 3;
        var tomTabBack = -3;
        var tomTabNext = -2;
        var tomTabHere = -1;
        var tomListNone = 0;
        var tomListBullet = 1;
        var tomListNumberAsArabic = 2;
        var tomListNumberAsLCLetter = 3;
        var tomListNumberAsUCLetter = 4;
        var tomListNumberAsLCRoman = 5;
        var tomListNumberAsUCRoman = 6;
        var tomListNumberAsSequence = 7;
        var tomListParentheses = 65536;
        var tomListPeriod = 131072;
        var tomListPlain = 196608;
        var tomCharacter = 1;
        var tomWord = 2;
        var tomSentence = 3;
        var tomParagraph = 4;
        var tomLine = 5;
        var tomStory = 6;
        var tomScreen = 7;
        var tomSection = 8;
        var tomColumn = 9;
        var tomRow = 10;
        var tomWindow = 11;
        var tomCell = 12;
        var tomCharFormat = 13;
        var tomParaFormat = 14;
        var tomTable = 15;
        var tomObject = 16;
        var tomMatchWord = 2;
        var tomMatchCase = 4;
        var tomMatchPattern = 8;
        var tomUnknownStory = 0;
        var tomMainTextStory = 1;
        var tomFootnotesStory = 2;
        var tomEndnotesStory = 3;
        var tomCommentsStory = 4;
        var tomTextFrameStory = 5;
        var tomEvenPagesHeaderStory = 6;
        var tomPrimaryHeaderStory = 7;
        var tomEvenPagesFooterStory = 8;
        var tomPrimaryFooterStory = 9;
        var tomFirstPageHeaderStory = 10;
        var tomFirstPageFooterStory = 11;
        var tomNoAnimation = 0;
        var tomLasVegasLights = 1;
        var tomBlinkingBackground = 2;
        var tomSparkleText = 3;
        var tomMarchingBlackAnts = 4;
        var tomMarchingRedAnts = 5;
        var tomShimmer = 6;
        var tomWipeDown = 7;
        var tomWipeRight = 8;
        var tomAnimationMax = 8;
        var tomLowerCase = 0;
        var tomUpperCase = 1;
        var tomTitleCase = 2;
        var tomSentenceCase = 4;
        var tomToggleCase = 5;
        var tomReadOnly = 256;
        var tomShareDenyRead = 512;
        var tomShareDenyWrite = 1024;
        var tomPasteFile = 4096;
        var tomCreateNew = 16;
        var tomCreateAlways = 32;
        var tomOpenExisting = 48;
        var tomOpenAlways = 64;
        var tomTruncateExisting = 80;
        var tomRTF = 1;
        var tomText                     @            ﬂ  x   ‡  ∏  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Ä                Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄNameB   G r o o v e W e b B r o w s e r D a t a M o d e l G l u e . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPT  ö  Ä//===============================================//
	//scriptinterface moved from WebBrowserForm4.grp
	//===============================================//   ÄSCRIPT     ÄSCRIPTINTERFACE  Å  Ä//=============================//																								//
	// IGrooveWebBrowserDataModel  //
	//=============================//   ÄSCRIPTINTERFACE  "  Ä// IGrooveDocumentShareCommandSink   ÄSCRIPTINTERFACE	  û  Ä//=======================================//																								//
	//	DocumentShare Command Generator	     //
	//=======================================//   ÄSCRIPTINTERFACE
  =======  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       & V  ÄSCRIPT       ÄSRC8  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . G e n e r a l . D o c u m e n t S h a r e . G r o o v e D o c u m e n t S h a r e _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   s     r s  ÄSCRIPT         T  Ä
	
	function Initialize()
	{
 
	}

	function Terminate()
	{
		
	}



	u  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       & F  ÄSCRIPTINTERFACE       ÄLIBIDL   { F 0 2 2 E 9 5 5 - 5 6 2 6 - 1 1 D 1 - A C 2 9 - 0 0 5 2 4 5 0 0 0 0 0 0 }   um  ÄIIDL   { 8 B 8 F A 2 6 9 - 8 C 2 4 - 4 2 7 2 - 9 2 8 E - E 7 B 3 E 0 4 D A 3 0 C }   3B   Ì  Ä
    function MarkAllRead ()
    {
        DocumentShareEngine.IGrooveUnreadDataContainer.MarkAllRead ();
    }
    function MarkAllUnread ()
    {
        DocumentShareEngine.IGrooveUnreadDataContainer.MarkAllUnread ();
    }
	kAllUnread ();  ÄSCRIPTINTERFACE       ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   gi  ÄIIDL   { 4 D 7 E C 5 0 1 - E 6 C C - 1 1 D 2 - 8 7 1 E - 0 0 8 0 C 7 8 6 8 F 6 F }   de   } Ä


	//===========================//																								//
	//	DocumentShare Sinks	     //
	//===========================//	
	function OnBrowseFolder(i_pEngine, i_MemberContactURL, i_FolderID)
	{
	}

	function OnCreateFolder(i_Engine, i_ParentFolder, i_FolderID)
	{
	}

	function OnFolderViewStyleChanged(i_Engine, i_ContactURL, i_FolderID, i_ViewStyle)
	{
	}

	function OnAddShareObject(i_pDocumentShare, i_ParentFolderID, i_ShareObjectID)
	{
	}

	function OnDeleteShareObject(i_pDocumentShare, i_ParentFolderID, i_ShareObjectID)
	{
	}

	function OnReplaceShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID)
	{
	}

	function OnRenameShareObject(i_Engine, i_ParentFolderID, i_ShareObjectID, i_OldFullName, i_NewFullName)
	{
	}

	function OnFolderViewSortChange(i_Engine, i_ContactURL, i_FolderID, i_SortColumn, i_SortType)
	{
	}

	function OnChangeLastModifiedTime(i_Engine, i_ParentID, i_ShareObjectID)
	{
	}

	function OnChangeFileContents(i_Engine, i_ParentFolderID, i_ShareObjectID)
	{
	}

	function OnConflict(i_Engine, i_ParentFolderID, i_ShareObjectID, i_ConflictContactURL)
	{
	}

	                                                                                                                                       ËY           ¸…   PU   o    h]   ºU     1         )      ¿    ÄSCRIPTINTERFACE       ÄLIBIDL   { B 6 E 6 2 3 9 5 - 0 1 3 3 - 4 9 4 f - A 3 B 4 - 2 1 4 3 C 1 F 3 E 5 4 A }   Ro  ÄIIDL   { F D F D 4 3 D 7 - 6 8 E 9 - 4 1 8 4 - A 9 8 3 - B C 5 C A 7 7 1 A 1 A 2 }   il   · Ä

	//=============================//																								//
	// DocumentShareEngine         //
	//=============================//	

	function SetURLFileType(i_AcceptedFileTypes, i_Disseminate)
	{	
  //  This is done via design time property on DSE
  }

	function OpenRootFolderID()
	{
		RootFolderID = DocumentShareEngine.Data.OpenRootShareFolderID();
		return RootFolderID;
	}

	function OpenParentFolderID(i_ShareObjectID)
	{
			var ParentFolderID = DocumentShareEngine.Data.OpenParentFolderID(i_ShareObjectID);
			return ParentFolderID;
	}

	function OpenURLObject(i_ID)
	{
			var SharedObjectID = DocumentShareEngine.Data.OpenShareObjectByID(i_ID);
			return SharedObjectID;
	}

	function OpenURLByteInputStream(i_ID)
	{
			var pIByteInputStream = DocumentShareEngine.Data.OpenFileContents(i_ID);
			return pIByteInputStream;
	}


	function CreateURLID()
	{
		var ID = DocumentShareEngine.CommandGenerator.CreateShareObjectID();
		return ID;
	}


	function CreateURLInFolder(i_gDelta, i_FileID, i_ParentID, i_DisplayName, i_FullName, i_ByteInputStream)
	{
		DocumentShareEngine.CommandGenerator.GenerateAddFile(i_gDelta, i_FileID, i_ParentID, i_DisplayName, i_FullName, i_ByteInputStream);
	}


	//=============================//																								//
	// WebBrowserEngine2           //
	//=============================//	

 	function NavigateToUrl(i_URL, i_Flags, i_TargetFrameName, i_Headers, i_BrowseTogether)
	{
		WebBrowserEngine2.Navigate(i_URL, i_Flags, i_TargetFrameName, i_Headers, i_BrowseTogether);
	}

 	function NavigateToFrameMap(i_pFrameMap, i_BrowseTogether)
	{
		WebBrowserEngine2.NavigateToFrameMap(i_pFrameMap, i_BrowseTogether);
	}


 	function OpenFrameMap()
	{
		var FrameMapID = WebBrowserEngine2.OpenFrameMap();
		return FrameMapID
	}

 	function GetBrowseAloneHomePage()
	{		
		return WebBrowserEngine2.BrowseAloneHomePage;
	}

 	function PutBrowseAloneHomePage(i_URLValue)
	{
		WebBrowserEngine2.BrowseAloneHomePage = i_Value;
	}

 	function GetBrowseTogetherHomePage()
	{		
		return WebBrowserEngine2.BrowseTogetherHomePage;
	}

 	function PutBrowseTogetherHomePage(i_URLValue)
	{
			WebBrowserEngine2.BrowseTogetherHomePage = i_URLValue;
	}

		     ÄSCRIPTINTERFACE       ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   gi  ÄIIDL   { 4 D 7 E C 5 0 1 - E 6 C C - 1 1 D 2 - 8 7 1 E - 0 0 8 0 C 7 8 6 8 F 6 F }   de   â  Ä


	//===========================//																								//
	//	DocumentShare Sinks	     //
	//===========================//	

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ‰Ñe   ÄΩ	     ÄSCRIPT         Ü Ä
 
	var SizeState;
	var OSize;
	var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
	var Form = PropertyList.OpenProperty(PROPERTY_FORM);
	var ComponentContainer = Form.ComponentContainer;
	var WebBrowserControl;
	var CurrentURL;
	var DocShareCode;
	var bCommandsShown = false;
	var BackCommand = false;
	var ForwardCommand = false;
	var CustomTB = false;
	var TBCommandArray = new Array();
	var TBCommandArrayIndex = new Array();
	var CustomCommands = false;
	var Splitter = WebBrowserSplitter.Splitter();
	var g_ComboboxDownState = false;
	var g_StorageMgr = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
	var COPY_AS_LINK_FRAME_MAP_NAME = "FrameMap";
	var g_pTelespaceIdentityPropertyList;
	var GlobalCommandContainer;
	var GlobalCommandContainerCookie;
	var Window;
	var SizeState = 0;
  	var UICommandContainerConnected = false;
	var pBundle = PropertyList.OpenProperty(PROPERTY_RESOURCE_BUNDLE);
	var URLOnDropDown = "";
	var g_IgnoreDocumentShareViewCallbacks = false;

	//////////////  TOOLBAR STRINGS /////////////////////////////////////
	//
	//////////////  Tool menu strings ///////////////////////
	//
	// 
	//Menu command containers
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEW_TOOLCOMMANDS="GUICC_FileNewToolCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_DOCUMENTS_TOOLCOMMANDS="GUICC_FileDocumentToolCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME="GUICC_RenameCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES="GUICC_PropertiesCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_UNDOREDO_TOOLCOMMANDS="GUICC_EditUndoRedoToolCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CLIPBOARD_TOOLCOMMANDS="GUICC_EditClipboardToolCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPYLINKS_TOOLCOMMANDS="GUICC_EditCopyLinksToolCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_TOOLCOMMANDS="GUICC_EditToolCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDE_TOOLCOMMANDS="GUICC_ViewShowHideToolCommands";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_TOOLCOMMANDS="GUICC_ViewToolCommands";

	//Menu commands 
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEWFOLDER="GUIC_WebBrowser_NewFolder";
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN="GUIC_WebBrowser_Open";
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE="GUIC_WebBrowser_AddFavorite";
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_IMPORT="GUIC_WebBrowser_Import";
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME_FAVORITE="GUIC_WebBrowser_Rename";
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_WEBPAGE="GUIC_WebBrowser_Properties";

	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_UNDO="GUIC_Undo";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_REDO="GUIC_Redo";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CUT="GUIC_Cut";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPY="GUIC_Copy";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_PASTE="GUIC_Paste";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPYCURRENTSITE="GUIC_CopyAsLink";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SELECTALL="GUIC_WebBrowser_SelectAll";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_DELETE="GUIC_Delete";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SEPARATOR1="WebBrowser_Edit_Separator1";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD="GUIC_MarkSelectedRead";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD="GUIC_MarkSelectedUnread";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLREAD="GUIC_MarkAllRead";
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD="GUIC_MarkAllUnread";

	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES="GUIC_WebBrowser_ShowHideFavorites";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SEPARATOR1="WebBrowser_View_Separator1";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL="GUIC_WebBrowser_UpOneLevel";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP="GUIC_WebBrowser_Stop";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH="GUIC_WebBrowser_Refresh";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER="GUIC_WebBrowser_BrowseTogether";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER_SEPARATOR1="WebBrowser_View_Separator1";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD="GUIC_NextUnread";
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD="GUIC_PreviousUnread";

 	// Tool menu labels
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEWFOLDER_LABEL = GetString(pBundle,"WbBrowsr_ML_Fldr");
 	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN_LABEL= GetString(pBundle,"WbBrowsr_ML_Open");
 	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE_LABEL= GetString(pBundle,"WbBrowsr_ML_AFav"); 
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_IMPORT_LABEL= GetString(pBundle,"WbBrowsr_ML_Imp");
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_LABEL= GetString(pBundle,"WbBrowsr_ML_Prop");
 	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_UNDO_LABEL= GetString(pBundle,"System_ML_UN");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_REDO_LABEL=GetString(pBundle,"System_ML_RE");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CUT_LABEL=GetString(pBundle,"System_ML_Cut");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPY_LABEL=GetString(pBundle,"System_ML_Cpy");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_PASTE_LABEL=GetString(pBundle,"System_ML_Pst");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPYCURRENTSITE_LABEL=GetString(pBundle,"WbBrowsr_ML_CCSAL");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SELECTALL_LABEL=GetString(pBundle,"WbBrowsr_ML_SAll");
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME_LABEL=GetString(pBundle,"WbBrowsr_ML_Fav");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_DELETE_LABEL=GetString(pBundle,"System_ML_DEL");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD_LABEL=GetString(pBundle,"System_ML_MSR");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD_LABEL=GetString(pBundle,"System_ML_MSU");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLREAD_LABEL=GetString(pBundle,"System_ML_MAR");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD_LABEL=GetString(pBundle,"System_ML_MAU");
	//var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES_LABEL=GetString(pBundle,"WbBrowsr_ML_HSFLP");
 	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWFAVORITES_LABEL=GetString(pBundle,"WbBrowsr_ML_SFLP");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_HIDEFAVORITES_LABEL=GetString(pBundle,"WbBrowsr_ML_HFLP");
 	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL_LABEL=GetString(pBundle,"WbBrowsr_ML_UOL");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP_LABEL=GetString(pBundle,"WbBrowsr_ML_Stp");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH_LABEL=GetString(pBundle,"WbBrowsr_ML_Refr");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER_LABEL=GetString(pBundle,"WbBrowsr_ML_BT");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD_LABEL=GetString(pBundle,"System_ML_NU"); 
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD_LABEL=GetString(pBundle,"System_ML_PU");
 
	// Tool menu mnemonics 
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN_MNEMONIC= GetString(pBundle,"WbBrowsr_MN_OPN");
	var WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE_MNEMONIC= GetString(pBundle,"WbBrowsr_MN_AddFav");

	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_UNDO_MNEMONIC= GetString(pBundle,"System_MN_UN");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_REDO_MNEMONIC= GetString(pBundle,"System_MN_RE");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CUT_MNEMONIC= GetString(pBundle,"System_MN_Cut");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPY_MNEMONIC= GetString(pBundle,"System_MN_Cpy");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_PASTE_MNEMONIC= GetString(pBundle,"System_MN_Pst");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPYCURRENTSITE_MNEMONIC= GetString(pBundle,"WbBrowsr_MN_CPYST");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SELECTALL_MNEMONIC= GetString(pBundle,"System_MN_SA");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD_MNEMONIC= GetString(pBundle,"System_MN_MSR");
	var WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLREAD_MNEMONIC= GetString(pBundle,"System_MN_MAR");

	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES_MNEMONIC= GetString(pBundle,"WbBrowsr_MN_ShwFav");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH_MNEMONIC= GetString(pBundle, "WbBrowsr_MN_Ref");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD_MNEMONIC= GetString(pBundle,"System_MN_NU");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD_MNEMONIC= GetString(pBundle,"System_MN_PU");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL_MNEMONIC= GetString(pBundle,"WbBrowsr_MN_UpLvl");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER_MNEMONIC= GetString(pBundle,"WbBrowsr_MN_BrwsT");
	var WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP_MNEMONIC= GetString(pBundle,"WbBrowsr_MN_Stp");
	
	
	//////////////  Toolbar bitmap button strings ///////////////////////
	//
	// Toolbar command array strings
	//

	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BACK="WebTool_Back";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FORWARD="WebTool_Forward";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_STOP="WebTool_Stop";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_REFRESH="WebTool_Refresh";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_COPYASLINK="WebTool_CopyAsLink";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_SEPARATOR1="WebTool_Separator1";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLIST="WebTool_FavoritesList";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_ADDFAVORITES="WebTool_AddFavorites";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_UPONEFOLDER="WebTool_UpOneFolder";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_PREVIOUSUNREAD="WebTool_PreviousUnread";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_NEXTUNREAD="WebTool_NextUnread";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_SEPARATOR2="WebTool_Separator2";
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BROWSETOGETHER="WebTool_BrowseTogether";

 	// Toolbar bitmap button tooltips
	//
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BACK_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_Bk");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FORWARD_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_For");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_STOP_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_Stp");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_REFRESH_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_Ref");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_COPYASLINK_TOOLTIP=GetString(pBundle,"System_CT_CpyLnk");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLISTCLOSED_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_SFLP");
 	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLISTOPENED_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_HFLP");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_ADDFAVORITE_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_AF");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_UPONELEVEL_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_UOL");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_PREVIOUSUNREAD_TOOLTIP=GetString(pBundle,"System_CT_NPU");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_NEXTUNREAD_TOOLTIP=GetString(pBundle,"System_CT_NNU");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BROWSETOGETHER_TOOLTIP=GetString(pBundle,"WbBrowsr_CT_BT");

 
	// Toolbar bitmap button labels
	//
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_ADDFAVORITE_LABEL=GetString(pBundle,"WbBrowsr_CL_AF");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_UPONELEVEL_LABEL=GetString(pBundle,"WbBrowsr_CL_UOL");
	var WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BROWSETOGETHER_LABEL=GetString(pBundle,"WbBrowsr_CL_BT");


    // Format strings
    var WEBBROWSER_TOOL_URL_NAVIGATION_FORMAT=GetString(pBundle,"WbBrowsr_FMT_URLNAV");
 

	////////////  HTMLTableLayoutControl URLS///////////////
	//
	var WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_URL="URL";
	var WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BACK="Back";
	var WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_FORWARD="Forward";
	var WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_OK="OK";
	var WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BROWSETOGETHER="BrowseTogether";
	var WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STOP="Stop";
	var WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STATUSBAR="StatusBar";


	//App.GrooveInputBox & like
	//
	//Message
	var WEBBROWSER_TOOL_GROOVEINPUTBOX_MESSAGE_URL_TO_OPEN=GetString(pBundle,"WbBrowsr_IB_EUO");

 	//Window Caption
	var WEBBROWSER_TOOL_GROOVEINPUTBOX_CAPTION_OPEN_URL=GetString(pBundle,"WbBrowsr_IB_OUrlC");

	//PropertyList.SetProperty
	//
	var WEBBROWSER_TOOL_SETPROPERTYNAME_WEBBROWSERHISTORY="WebBrowserHistory";

	//WindowProperties
	//
	var WEBBROWSER_TOOL_WINDOWPROPERTIES_CAPTION_ADDFAVORITE=GetString(pBundle,"WbBrowsr_WC_AF");
	var WEBBROWSER_TOOL_WINDOWPROPERTIES_STYLE_POPUPWINDOW="PopupWindow";


	// Miscellaneous 
	//
	var WEBBROWSER_TOOL_URLTEXT_BLANK_URL="about:blank";
	var WEBBROWSER_TOOL_TEXT_UNTITLED_WEB_PAGE=GetString(pBundle,"WbBrowsr_S_UWP");
	var WEBBROWSER_TOOL_TEXT_FILE="File";
	var WEBBROWSER_TOOL_TEXT_FRIENDLYNAME=GetString(pBundle,"WbBrowsr_S_NPD");


 	function Initialize()
	{
		ConnectObject(WebBrowserDataModelDelegate, "DataModelDelegate_");
		OSize = WebBrowserSplitter.GetLayoutState();

		if (PropertyList.PropertyExists("SplitterSizeState"))
			SizeState = PropertyList.OpenProperty("SplitterSizeState");
		else
			SizeState = 1;
	
		if (SizeState == 1)
		{
			//HideShowFavorites() does the opposite of the SizeState condition
			//so set SizeState the opposite way to get the proper action.
			SizeState = 0;
			HideShowFavorites();
		}
		else
		{
			//Hide the WebBrowser Splitter
			Splitter.Size = GrooveSplitterSize_Zero;
		}
		
		//this requires a disconnect because there is a hidden auto connect associated with it
		g_pTelespaceIdentityPropertyList = CreateOrOpenPropertyList(PropertyList, Telespace, 0, 1, ScriptHostComponent, "TelespaceIdentityPropertyList", true);

		//Set Document Share properties
		DocShareCode = DocumentShareCode.GetScriptDispatch();
		DocShareCode.SetShowShareObjectVerbs(false);
		DocShareCode.SetDisplayBrowsedFolderName(false);
		DocShareCode.SetDisplayFolderTreeView(false);
		DocShareCode.SetShowSelectionAlways(true);
		DocShareCode.SetShowToolbarMenu(false);
		DocShareCode.SetShowColumn(GrooveFolderViewColumn_Type, false);
		DocShareCode.SetShowColumn(GrooveFolderViewColumn_Size, false);
		DocShareCode.SetShowColumn(GrooveFolderViewColumn_LastModifiedDate, false);
		DocShareCode.SetShowColumn(GrooveFolderViewColumn_LastModifiedBy, false);
		DocShareCode.SetShowColumnHeaders(false);
		DocShareCode.SetAutoResizeLastColumn(true);

		// Advise to get the CommandSink events off of the view
		ScriptHostComponent.Advise(DocumentShareView, "{4D7EC501-E6CC-11d2-871E-0080C7868F6F}");

		//Initialize the toolbar command array for default behaviour of tool
		TBCommandArray[0] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BACK;
		TBCommandArray[1] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FORWARD;
		TBCommandArray[2] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_STOP;
		TBCommandArray[3] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_REFRESH;
		TBCommandArray[4] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_COPYASLINK;
		TBCommandArray[5] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_SEPARATOR1;
		TBCommandArray[6] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLIST;
		TBCommandArray[7] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_ADDFAVORITES;
		TBCommandArray[8] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_UPONEFOLDER;
		TBCommandArray[9] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_PREVIOUSUNREAD;
		TBCommandArray[10] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_NEXTUNREAD;
		TBCommandArray[11] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_SEPARATOR2;
		TBCommandArray[12] = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BROWSETOGETHER;

		if (PropertyList.PropertyExists(WEBBROWSER_TOOL_SETPROPERTYNAME_WEBBROWSERHISTORY))
			InitHistory();
			
		// Set the unread time interval
		var Account = OpenAccountFromPropertyList(PropertyList);
		UnreadTimer.Interval = GrooveScriptFunctions.CreateNewObject("Groove.MiscHelperObject").IGroovePreferencesHelper.UnreadTimeInterval(Account);
	}

	function SplitterState(i_SizeState)
	{
		SizeState = i_SizeState;
		PropertyList.SetProperty("SplitterSizeState", i_SizeState, GroovePropertyFlag_Private);
	}

	function Terminate()
	{
		// Unadvise to get the CommandSink events off of the view
		ScriptHostComponent.Unadvise(DocumentShareView, "{4D7EC501-E6CC-11d2-871E-0080C7868F6F}");

		UpdateHistory();
		//Disconnect from Initialize
		DisconnectObject(g_pTelespaceIdentityPropertyList);
		DisconnectObject(WebBrowserDataModelDelegate);

	}

	function OnSetUIProperties()
	{
		WebBrowserControl = WebBrowserView.WebBrowserControl;
		ConnectObject(WebBrowserControl, "WebBrowserControl");

		UpdateURLCtrl(WebBrowserView.TopLevelURL);
		BrowseTogether.CheckState = WebBrowserView.BrowseTogether;
 
		//sets for the grooveinputbox
		Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);

		// Set initial state for UpFolderButton from the Grp (there are 2 upfolder buttons here..)
		if (DocumentShareView.OpenBrowsedFolderID() == WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenRootFolderID())
			UpFolderButton.Enabled = false;
		else
			UpFolderButton.Enabled = true;	
	}

	function OnRevokeUIProperties()
	{
		if (typeof WebBrowserControl != "undefined")
			DisconnectObject(WebBrowserControl);
	}
	
	function UpdateURLCtrl(i_URL)
	{
		URL.Text=i_URL;
	}

	function OnTranslateAccelerator(i_Msg, i_KeyCode, i_KeyState, i_KeyModifiers)
	{
		if (i_Msg == GROOVE_WM_KEYDOWN && i_KeyCode == GROOVE_VK_ENTER && !g_ComboboxDownState)
		{
			// See if the combobox has focus. If it does, then we need to browse
 			var pFocusComponent = null;
			try
			{
				pFocusComponent = UIPropertyList.OpenProperty(UI_PROPERTY_UIACTIVE_COMPONENT);
				if ("URL" == pFocusComponent.Component().OpenName())
				{
					// Ctrl+Enter fills in "http://www." and ".com" where necessary
					if (i_KeyModifiers == GROOVE_KEYMOD_CONTROL)
					{
						var FinalURL = URL.Text;

						// Add ".net" if the user typed "groove" (search for beginning of line, "groove", EOL, case insensitive)
						if (-1 != FinalURL.search(/^groove$/i))
							FinalURL += ".net";

						// Add ".com" if there's no top level domain (search for "." followed by any alpha chars, optional /, and EOL).
						if (-1 == FinalURL.search(/\.\w*\/?$/))
							FinalURL += ".com";

						// Add http:// if there's no protocol (search for non-colon chars followed by :// at beginning of line)
						if (-1 == FinalURL.search(/^[^:]*:\/\//i))
							{
							// Add "www." if it's not already there (search for "www." at beginning of line)
							if (-1 == FinalURL.search(/^www\./i))
								FinalURL = "www." + FinalURL;

							// Add "http://"
							FinalURL = "http://" + FinalURL;
							}

						URL.Text = FinalURL;
					}
					OnBrowse();
					return true;
				}
				else if (pFocusComponent.Component().OpenName() == "DocumentShareView")
				{
					if (1 == DocShareCode.OpenShareObjectSelectionCount())
					{
						var ShareObjectEnum = DocShareCode.OpenShareObjectSelectionEnum();
						while (ShareObjectEnum.HasMore())
						{
							var ShareObject = ShareObjectEnum.OpenNext();
							if (GetShareObjectType(ShareObject) == "File")
							{
								ExecuteFavorite(ShareObject);
							return true;
							}
						}
					}
					else
					{
						GrooveScriptFunctions.Beep();
						return true;
					}
				}
			}
			catch(e)
			{
				return false;
			}
		}

		return false;
	}

	function OnConnectToExternalObject(i_Object, i_ConnectionID)
	{
		if (0 == i_ConnectionID)
		{
			if (CustomTB == false)
			{
				UICommandContainer = i_Object;

				// We want to sink the events of the UI command container.
				ConnectObject(UICommandContainer, "UICommandContainer");
			}

			ShowUICommands();
			//for button icon update usage
			UICommandContainerConnected = true;

		}
		else if (1 == i_ConnectionID)
		{
			GlobalCommandContainer = i_Object.UICommandContainer3;
			GlobalCommandContainerCookie = GlobalCommandContainer.MergeUICommandContainer(
				WebBrowserMenu.UICommandContainer3, 
				ScriptHostComponent.IGrooveUICommandListener,
				GrooveScriptFunctions.CreateNewObject("")
				);
            ShowMenuCommands();
		}		
		
	}
	
	function OnUnconnectFromExternalObjects()
	{
			// Unconnect all sinks

		if (CustomTB == false)
		{
			// Unconnect all sinks
			
			if (typeof UICommandContainer != "undefined")
			{
				HideUICommands();
				DisconnectObject(UICommandContainer);
				//for button icon update usage
				UICommandContainerConnected = false;

			}
		}

		if (typeof GlobalCommandContainer != "undefined")
		{
			HideMenuCommands();
 			if (GlobalCommandContainerCookie != 0)
				GlobalCommandContainer.RemoveMergedUICommandContainer(GlobalCommandContainerCookie);
			GlobalCommandContainer = null;
		}
	}

	function OnViewContainerHide()
	{
		// Stop the timer
		UnreadTimer.Stop();
	}
	
	function SetDefaultCommandIndex()
	{

		for (i=0; i<=TBCommandArray.length; i++)
			TBCommandArrayIndex[i] = i;

	}


	// Include this function if you want to allow the consumer of this delegate
	// to pass in their own toolbar which this delegate will use instead of the 
	// global one.  Note that the consumer must pass in their toolbar in their
	// OnSetUIProperties call, NOT in their Initialize since we are not sited yet
	// and will fail when trying to insert the commands.

	function SetCustomToolBar(i_ToolBarComponent)
	{

		if (typeof UICommandContainer != "undefined")
		{
			HideUICommands();
			DisconnectObject(UICommandContainer);
		}

		CustomTB = true;
		UICommandContainer = i_ToolBarComponent;
		ConnectObject(UICommandContainer, "UICommandContainer");

		ShowUICommands();
		
	}
	
	function SetCustomCommands(i_CommandArrayIndex)
	{

	//We need to hide the commands if they are currently being shown because we are getting a new set

		if (bCommandsShown)
			HideUICommands();

	// Set the index array to only the one's that the user wants displayed
	
	//Clear out the current command index

		delete TBCommandArrayIndex;
		TBCommandArrayIndex = new Array();
	
		for (i=0; i<i_CommandArrayIndex.length; i++)
		{

		TBCommandArrayIndex[i] = i_CommandArrayIndex[i];
		CustomCommands = true;

		}

		ShowUICommands();
	
	}

	function GetCommands()
	{

		return TBCommandArray;

	}



	function ShowUICommands()
	{
		if (!bCommandsShown)
		{
			bCommandsShown = true;

			var pCommand;
			var ImagesURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImages.jpg");
			var ImagesMaskURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImagesMask.bmp");
			var Position = 0;
			var Offset = 0;
			var Width = 16;
			var Height = 16;

			if (!CustomCommands)
				SetDefaultCommandIndex();

			for (i=0; i<TBCommandArrayIndex.length; i++)
			{
				
				switch(TBCommandArrayIndex[i].toString())
				{
				
				case "0":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[0], Position);
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BACK_TOOLTIP;
					Offset = Width * 0;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;

				case "1":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[1], Position);
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FORWARD_TOOLTIP;
					Offset = Width * 1;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;

				case "2":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[2], Position);
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_STOP_TOOLTIP;
					Offset = Width * 2;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;

				case "3":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[3], Position);
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_REFRESH_TOOLTIP;
					ImagePosition = 8;				
					Offset = Width * ImagePosition;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;


				case "4":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[4], Position);
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_COPYASLINK_TOOLTIP;
					ImagePosition = 9;				
					Offset = Width * ImagePosition;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;


				case "5":
					UICommandContainer.InsertSeparator(TBCommandArray[5], Position);
					Position++;
					break;

				case "6":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[6], Position);
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLISTCLOSED_TOOLTIP;
					Offset = Width * 3;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;

				case "7":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[7], Position);
					pCommand.Label = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_ADDFAVORITE_LABEL;
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_ADDFAVORITE_TOOLTIP;
					Offset = Width * 4;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;

				case "8":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[8], Position);
					pCommand.Label = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_UPONELEVEL_LABEL;
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_UPONELEVEL_TOOLTIP;
					Offset = Width * 6;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;

				case "9":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[9], Position);
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_PREVIOUSUNREAD_TOOLTIP;
					Offset = Width * 11;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;

				case "10":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[10], Position);
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_NEXTUNREAD_TOOLTIP;
					Offset = Width * 12;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++;
					break;	

				case "11":
					UICommandContainer.InsertSeparator(TBCommandArray[11], Position);
					Position++;
					break;

				case "12":
					pCommand = UICommandContainer.InsertUICommand(TBCommandArray[12], Position);
                    pCommand.Label = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BROWSETOGETHER_LABEL;
					pCommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BROWSETOGETHER_TOOLTIP;
					ImagePosition = 15;
					Offset = Width * ImagePosition;
					pCommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
					Position++
					break;

				}
			}
		}
	}

	function ShowMenuCommands()
	{
		var ImagesURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImages.jpg");
		var ImagesMaskURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImagesMask.bmp");
		var CommonImagesURL = GetString(pBundle, "System_IU_CTII");
		var CommonImagesMaskURL = GetString(pBundle, "System_IMU_CTII");

		// Get all of the Tool specific Command Containers (even if we don't use them all)
		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEW_TOOLCOMMANDS))
			g_FileNewCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEW_TOOLCOMMANDS);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_DOCUMENTS_TOOLCOMMANDS))
			g_FileDocumentCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_DOCUMENTS_TOOLCOMMANDS);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME))
			g_FileRenameCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES))
			g_FilePropertiesCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_UNDOREDO_TOOLCOMMANDS))
			g_EditUndoRedoCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_UNDOREDO_TOOLCOMMANDS);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CLIPBOARD_TOOLCOMMANDS))
			g_EditClipboardCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CLIPBOARD_TOOLCOMMANDS);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPYLINKS_TOOLCOMMANDS))
			g_EditCopyLinksCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPYLINKS_TOOLCOMMANDS);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_TOOLCOMMANDS))
			g_EditCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_TOOLCOMMANDS);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDE_TOOLCOMMANDS))
			g_ViewShowHideCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDE_TOOLCOMMANDS);

		if (GlobalCommandContainer.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_TOOLCOMMANDS))
			g_ViewCC = GlobalCommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_TOOLCOMMANDS);

		// Note that all commands the tool supports appear on one of the menus above

		if (typeof g_FileNewCC != "undefined")
		{
			// On the FileNew menu we add Folder
			var UICommand = g_FileNewCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEWFOLDER, g_FileNewCC.GetNumberOfUICommands());
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEWFOLDER_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}
		
		if (typeof g_FileDocumentCC != "undefined")
		{
			// File Document Menu
			var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN, 0);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN_LABEL;
			UICommand.Mnemonic = WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			var Position = g_FileDocumentCC.GetNumberOfUICommands();

			var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE, Position++);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE_LABEL;
			UICommand.Mnemonic = WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(ImagesURL, ImagesMaskURL, 16*4, 16, 16);

			var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_IMPORT, Position++);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_FILE_IMPORT_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}

		if (typeof g_FileRenameCC != "undefined")
		{
			var UICommand = g_FileRenameCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME_FAVORITE, 0);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}

		if (typeof g_FilePropertiesCC != "undefined")
		{
			// Insert "Properties" sub-menu option
			var UICommand = g_FilePropertiesCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_WEBPAGE, 0);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}

		if (typeof g_EditCC != "undefined")
		{
			var Position = g_EditCC.GetNumberOfUICommands();
			// Edit Menu

			/* Single Select at the Favorites like in IE for now
			var UICommand = g_EditCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SELECTALL, Position++);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SELECTALL_LABEL;
			UICommand.Mnemonic = WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SELECTALL_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			*/
		}

		if (typeof g_ViewShowHideCC != "undefined")
		{
			var Position = g_ViewShowHideCC.GetNumberOfUICommands();

			// View Show/Hide Menu
			var UICommand = g_ViewShowHideCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES, Position++);
			//UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES_LABEL;
			UICommand.Mnemonic = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}

		if (typeof g_ViewCC != "undefined")
		{
			var Position = g_ViewCC.GetNumberOfUICommands();
			
			// View Menu
			g_ViewCC.UICommandContainer.InsertSeparator(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SEPARATOR1, Position++);

			var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL, Position++);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL_LABEL;
			UICommand.Mnemonic = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(ImagesURL, ImagesMaskURL, 16*6, 16, 16);

			var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP, Position++);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP_LABEL;
			UICommand.Mnemonic = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(ImagesURL, ImagesMaskURL, 16*2, 16, 16);

			var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH, Position++);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH_LABEL;
			UICommand.Mnemonic = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(ImagesURL, ImagesMaskURL, 16*8, 16, 16);

			var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER, Position++);
			UICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER_LABEL;
			UICommand.Mnemonic = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}
	}

	function HideUICommands()
	{
		if (bCommandsShown)
		{
			//GrooveScriptFunctions.DoMessageBox("break - Hide");
			bCommandsShown = false;

			// Remove all top-level commands/separators owned by web browser.
			// -------------------------------------------------------------------------------
			// This needs to be improved!
			// Today we can remove UICommands AND Separators by using RemoveUICommand,
			// because RemoveUICommand and RemoveSeparator work identical.
			// This of course might change in the future.
			// In order to fix this UICommands and Separators shouldn't be mixed in one array.
			// -------------------------------------------------------------------------------

			for (var i = 0; i < TBCommandArray.length; i++)
			{
				if (UICommandContainer.UICommandExists(TBCommandArray[i]))
					UICommandContainer.RemoveUICommand(TBCommandArray[i]);
			}
		}
	}

	function HideMenuCommands()
	{		
		if (typeof g_FileNewCC != "undefined" && g_FileNewCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEWFOLDER))
			g_FileNewCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEWFOLDER);

		if (typeof g_FileDocumentCC != "undefined")
		{
			if (g_FileDocumentCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN))
				g_FileDocumentCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN);

			if (g_FileDocumentCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE))
				g_FileDocumentCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE);

			if (g_FileDocumentCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_IMPORT))
				g_FileDocumentCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_IMPORT);
		}

		if (typeof g_FileRenameCC != "undefined")
		{
			if (g_FileRenameCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME_FAVORITE))
				g_FileRenameCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME_FAVORITE);
		}

		if (typeof g_FilePropertiesCC != "undefined")
		{
			if (g_FilePropertiesCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_WEBPAGE))
				g_FilePropertiesCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_WEBPAGE);
		}

		if (typeof g_EditCC != "undefined")
		{	
			/* Single Select at the Favorites like in IE for now
			if (g_EditCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SELECTALL))
				g_EditCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_EDIT_SELECTALL);
			*/
		}

		if (typeof g_ViewShowHideCC != "undefined")
		{
			if (g_ViewShowHideCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES))
				g_ViewShowHideCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES);
		}
			
		if (typeof g_ViewCC != "undefined")
		{
			if (g_ViewCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SEPARATOR1))
				g_ViewCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SEPARATOR1);
				
			if (g_ViewCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL))
				g_ViewCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL);

			if (g_ViewCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP))
				g_ViewCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP);

			if (g_ViewCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH))
				g_ViewCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH);

			if (g_ViewCC.UICommandExists(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER))
				g_ViewCC.RemoveUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER);
		}
	}

	// ----------------------------------------------------------------------------
	// IGrooveUICommandContainerSink implementation
	// ----------------------------------------------------------------------------

	function UICommandContainerOnCommand(i_UICommand)
	{
		if (typeof UICommandContainer == "undefined")
			return;

		var CommandURL = i_UICommand.CommandURL;
		if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BACK)
			OnBack();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FORWARD)
			OnForward();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_STOP)
			OnStop();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_ADDFAVORITES)
			OnAddFavorites();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLIST)
		{	
			OnFavoritesList();
			
			if (SizeState == 0)
			{
				i_UICommand.CheckState = GrooveCheckState_UnChecked;
			}
			else if (SizeState == 1)
			{	
				i_UICommand.CheckState = GrooveCheckState_Checked;
			}
 			ReplaceIcon();
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_REFRESH)
			OnRefresh();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_COPYASLINK)
			OnCopyAsLink();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_UPONEFOLDER)
			UpOneFolderCommandBar();
 		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_PREVIOUSUNREAD)
		{
			DocShareCode.NavigateToPreviousShareObject(GrooveShareObjectNavigationType_Unread);
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_NEXTUNREAD)
		{
			DocShareCode.NavigateToNextShareObject(GrooveShareObjectNavigationType_Unread);
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BROWSETOGETHER)
		{
			WebBrowserView.ForceBrowseTogether(!i_UICommand.CheckState);
 			ReplaceIcon();

		}
	}

	function UICommandContainerOnUpdateCommandState(i_UICommand)
    {
		if (typeof UICommandContainer == "undefined" || bCommandsShown == false)
			return;

		var CommandURL = i_UICommand.CommandURL;
		if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BACK)
			i_UICommand.Enabled = BackCommand;
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FORWARD)
			i_UICommand.Enabled = ForwardCommand;
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_ADDFAVORITES)
		{
			if (URL.Text == WEBBROWSER_TOOL_URLTEXT_BLANK_URL || URL.Text == "")
				i_UICommand.Enabled = false;
			else
				i_UICommand.Enabled = true;
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLIST)
		{	
			 
			if (SizeState == 0)
			{
				i_UICommand.CheckState = GrooveCheckState_UnChecked;
			}
			else if (SizeState == 1)
			{
				i_UICommand.CheckState = GrooveCheckState_Checked;
			}
			 
 			ReplaceIcon();

		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_UPONEFOLDER)
		{
			if (DocumentShareView.OpenBrowsedFolderID() == WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenRootFolderID())

				i_UICommand.Enabled = false;
			else
				i_UICommand.Enabled = true;
		}

		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_PREVIOUSUNREAD)
		{
			if (DocShareCode.DoesShareObjectInNavigationExist(GrooveShareObjectNavigationType_Unread))
				i_UICommand.Enabled = true;
			else
				i_UICommand.Enabled = false;
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_NEXTUNREAD)
		{
			if (DocShareCode.DoesShareObjectInNavigationExist(GrooveShareObjectNavigationType_Unread))
				i_UICommand.Enabled = true;
			else
				i_UICommand.Enabled = false;
		}

		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_BROWSETOGETHER)
		{
			i_UICommand.Checkstate = WebBrowserView.BrowseTogether;
 			ReplaceIcon();

		}

    }

	function UICommandContainerOnUpdateContainerState(i_pContainer)
    {
		// Nothing to do.
    }

	// ----------------------------------------------------------------------------
	// End IGrooveUICommandContainerSink implementation
	// ----------------------------------------------------------------------------
	// ----------------------------------------------------------------------------
	// Begin IGrooveSplitter Sink implementation
	// ----------------------------------------------------------------------------
	
	function WebBrowserSplitter_OnSplitterDragEnd(i_Name, i_Pane1SizeValue, i_Pane1LayoutSizeType, i_Pane2SizeValue, i_Pane2SizeStyle)
	{
		if (i_Pane1SizeValue > 0)
			SplitterState(1);
		else
			SplitterState(0);
	}

	// ----------------------------------------------------------------------------
	// End IGrooveSplitter Sink implementation
	// ----------------------------------------------------------------------------
	function OpenEngine()
	{
		return WebBrowserEngine;
	}

	function OpenView()
	{
		return WebBrowserView;
	}
	function OK_OnCommand(i_UICommand)
	{
		OnBrowse();
	}

	function BrowseTogether_OnCommand(i_UICommand)
	{
		WebBrowserView.ForceBrowseTogether(i_UICommand.CheckState);
	}

	function OnBrowse(i_URL)
	{
		if (typeof i_URL == "undefined")
			WebBrowserView.Navigate(URL.Text);
		else
			WebBrowserView.Navigate(i_URL);
	}

	function OnStop()
	{
		WebBrowserView.Stop();
	}

	function OnBack()
	{
		WebBrowserView.GoBack();
	}

	function OnForward()
	{
		WebBrowserView.GoForward();
	}

	function OnFavoritesList()
	{
		HideShowFavorites();
	}
	
	function OpenUrl(i_UICommand)
	{		
		var Account = OpenAccountFromPropertyList(PropertyList);
		var UrlName = App.GrooveInputBox(Window, Account, WEBBROWSER_TOOL_GROOVEINPUTBOX_MESSAGE_URL_TO_OPEN, GrooveInputBoxStyle_None, "", WEBBROWSER_TOOL_GROOVEINPUTBOX_CAPTION_OPEN_URL);	
		UrlName = UrlName.Data;
		NavigateToURL(UrlName);
	}

	function OnRefresh()
	{
		WebBrowserView.WebBrowserControl.Refresh();
	}

	function AddToHistory(i_URL)
	{
		var Index = URL.FindStringExact(-1, i_URL);

		var tmpURL = i_URL;
		if (Index != -1)
			URL.RemoveItemByIndex(Index);
		URL.InsertItem(0, tmpURL);
		if (URL.Count > 20)
			URL.RemoveItemByIndex(21);
		URL.Text = tmpURL;
	}

	function UpdateHistory()
	{
		var HistoryString = "";
		for (var i = 0; i < URL.Count; i++)
		{
			HistoryString += (URL.GetItemText(i) + "~!@");
		}

		PropertyList.SetProperty(WEBBROWSER_TOOL_SETPROPERTYNAME_WEBBROWSERHISTORY, TrimEnds(HistoryString), GroovePropertyFlag_Private);
	}

	function InitHistory()
	{
		var HistoryString = PropertyList.OpenProperty(WEBBROWSER_TOOL_SETPROPERTYNAME_WEBBROWSERHISTORY);
		var HistoryArray = HistoryString.split("~!@");
		for (var i = 0; i < HistoryArray.length; i++)
		{
			if (HistoryArray[i] != "")
				URL.InsertItem(i, HistoryArray[i]);
		}
	}

	function URL_OnDropDown(i_Name)
	{
		// Store the URL before the combobox is shown
		URLOnDropDown = URL.Text;

		// Set combobox down state to true
		g_ComboboxDownState = true;
	}

	function URL_OnComboBoxCloseUp(i_Name)
	{
		// Set combobox down state to false
		g_ComboboxDownState = false;
		
		// if the combobox closes and changed content then navigate to it
		if (URLOnDropDown != URL.GetSelectionText())
 			OnBrowse(URL.GetSelectionText());

		// clear the URL	
		URLOnDropDown = "";
	}

	function HideShowFavorites()
	{
		var LayoutSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.SplitterLayoutControlInfo");
		var LayoutCellObj = LayoutSizeObj.Cell();

		if (SizeState == 0)
		{
			LayoutCellObj.SetCell(0);
			LayoutSizeObj.SetSize(142, GrooveLayoutSizeType_Pixels);
			Splitter.Size = GrooveSplitterSize_Small;
			WebBrowserSplitter.AdjustCellLayout(LayoutCellObj, LayoutSizeObj);
			SplitterState(1);
		}
		else
		{
			//Set Splitter size to zero & type to none when hiding favorites
			WebBrowserSplitter.RestoreLayoutState(OSize);
			Splitter.Size = GrooveSplitterSize_Zero;
			LayoutSizeObj.SetSize(0, GrooveLayoutSizeType_None);
			SplitterState(0);
		}
	}

	function OnCopyAsLink()
	{
		// Serialize the frame map into an element
		var ContainerElement = CreateNewElement("FrameMapHolder");
		ContainerElement.SetDeleteOnRelease();
		WebBrowserView.OpenFrameMap().SerializableToElement.SerializeToContentElement(ContainerElement);

		// Serialize the element into a string
		var FrameMapElementStr = ContainerElement.OpenContentElement(0).DumpToString();

		// Build the link URL and stick it on the clipboard
		var URL = PropertyList.OpenProperty(PROPERTY_CANONICAL_URL);
		var pURI = GROOVE_GLOBAL_MISC_POINTER.OpenURI(URL);
		pURI.SetQueryPart(COPY_AS_LINK_FRAME_MAP_NAME, escape(FrameMapElementStr))
		var FriendlyName="";
		try
		{
			FriendlyName = WebBrowserView.window.document.title;
		}
		catch(Error)
		{
		}	
		if (FriendlyName == "")
			FriendlyName = WEBBROWSER_TOOL_TEXT_UNTITLED_WEB_PAGE;
		SetClipboardEmpty();
		CopyAsLinkToClipboard(pURI.String, FriendlyName);
	}



	function DocumentShareView_OnSelectionChange(i_pGlue, i_ID, i_GainSelection, i_UISelection)
	{
		// Since we reuse the documentshareengine in the add favorite code we need to ignore some
		// events while the initial setup is happening
		if (g_IgnoreDocumentShareViewCallbacks)
			return;

		if (i_GainSelection == true)
		{
			var DocEngineShareObj = WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenURLObject(i_ID);

			var FavoriteSelectedCount = DocShareCode.OpenShareObjectSelectionCount();

			if (GetShareObjectType(DocEngineShareObj) == WEBBROWSER_TOOL_TEXT_FILE)
			{
				//Do not execute URL if multiselected is performed by user 
				if (FavoriteSelectedCount < 2)
				{
					ExecuteFavorite(DocEngineShareObj); 
					UnreadTimer.Stop();
					UnreadTimer.Start();
					return;
				}
			}
			else
			{
				return;
			}
		}
		else
		{
			return;
		}
	}

	function DocumentShareView_OnLDoubleClick(i_pView, i_ID, i_pEventResult)
	{	
		// Since we reuse the documentshareengine in the add favorite code we need to ignore some
		// events while the initial setup is happening
		if (g_IgnoreDocumentShareViewCallbacks)
			return;

		var tmpFileName;
		var DocEngineShareObj = WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenURLObject(i_ID);
		if (GetShareObjectType(DocEngineShareObj) == WEBBROWSER_TOOL_TEXT_FILE)
		{
			
			ExecuteFavorite(DocEngineShareObj);
			i_pEventResult.Result=true;
			return;
		
		}
		else
		{
			i_pEventResult.Result=false;
			return;
		}
	}

	function ExecuteFavorite(DocEngineShareObj)
	{
		//Get the ByteInputStream from the engine
		var BIS = WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenURLByteInputStream(DocEngineShareObj.ShareObject.ID);
				
		//Convert into a CharInputStream so that we can deal with the contents as strings
		var CIS = BIS.OpenCharInputStream(GrooveCharEncodingType_UTF8);
				
		//Read all of the chars in the input stream
		var strFileContents = CIS.ReadChars(-1);

		var URL;
		
		if(strFileContents.search("InternetShortcut]\n") != -1)
		{
			// Handle old internet shortcut format

			// Read past the section header and carriage return
			//var strURL = strFileContents.replace("[InternetShortcut]\n", "");

			var start = strFileContents.search("InternetShortcut]\n");
			var offset = start + 18;
			var end = strFileContents.indexOf("\n", offset);
			var length = end - offset;
			var urlString = strFileContents.substr(offset, length);


			// Now get the url
			URL = urlString.replace("URL=","");
			URL = URL.replace("\n", "");	
		}
		else if(strFileContents.search("InternetShortcut]\r\n") != -1)
		{	
			// Read past the section header and carriage return
			//var strURL = strFileContents.replace("[InternetShortcut]\r\n", "");
			var start = strFileContents.search("InternetShortcut]\r\n");
			var offset = start + 19;
			var end = strFileContents.indexOf("\r\n", offset);
			var length = end - offset;
			var urlString = strFileContents.substr(offset, length);

			// Now get the url
			URL = urlString.replace("URL=","");
			URL = URL.replace("\r\n", "");	
		}
		else
		{
			URL = strFileContents;
		}

		WebBrowserView.Navigate(URL);
		PutURL(URL);
	}

	function UnreadTimer_OnTimer(i_TimerName)
	{
		UnreadTimer.Stop();
		try
		{
			MarkRead();
		}
		catch(error)
		{
			return;
		}
	}


	function OnAddFavorites()
	{
		var Window = null;
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);
		var AddFavoriteSubForm = ComponentContainer.OpenComponentByName("AddFavoriteSubForm");

		//Set window properties
		WindowProperties.Style = WEBBROWSER_TOOL_WINDOWPROPERTIES_STYLE_POPUPWINDOW;
		WindowProperties.ParentWindow = ParentWindow;
		WindowProperties.Caption = WEBBROWSER_TOOL_WINDOWPROPERTIES_CAPTION_ADDFAVORITE;
		WindowProperties.CaptionVisible = true;
		WindowProperties.CloseButton = false;
		WindowProperties.BorderVisible = false;
		WindowProperties.HelpButton = false;
		WindowProperties.Resizable = false;

		try
		{
			//Open window for subform
			Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount,"", WindowProperties, AddFavoriteSubForm);

			Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore |
										GrooveWindowMenuCommand_Size |
										GrooveWindowMenuCommand_Minimize |
										GrooveWindowMenuCommand_Maximize,
										false);
			
			//Stop if not connected to delegate
			if (Window.DoesDelegateComponentExist())
			{
				var AddFavoriteCode = Window.OpenDelegateComponent().GetScriptDispatch();

				// Ignore any callbacks while the favorites glue is connecting to the document share engine
				g_IgnoreDocumentShareViewCallbacks = true;

				// Pass in our DocumentShareEngine to the delegate
				// the delegate needs to call on the component interface to issue a connect call on the engine we pass in
				// this way the same data will be shared between the tool and the dialog.
				// This means that we don't have to add files/folders/links that are created in the window to the tool
				// because the engine is the same.
				AddFavoriteCode.PutDocShareEngine(DocumentShareEngine);
				AddFavoriteCode.PutDocShareViewSessionName(DocumentShareView.OpenUIUndoRedoSessionName());

				//Always navigate to root folder when opening Add to Favorites dialog
				//AddFavoriteCode.NavigateToRootFolder();
				
				//Get the currently displayed URL
				CurrentURL= GetURL();
				
				// Use try/catch to make sure that the window object doesn't return an error and set the
				// FriendlyName accordingly.  The window.document.title will fail for a local drive url.
				var FriendlyName="";
				try
				{
					FriendlyName = WebBrowserView.window.document.title;
				}
				catch(Error)
				{
					FriendlyName = WEBBROWSER_TOOL_TEXT_FRIENDLYNAME;
				}	
				
				//Prepopulate the AddToFavorites window with the friendly name
				AddFavoriteCode.SetFriendlyName(FriendlyName);

				//Check if Add button is clicked & add URL to favorites if it is
				if (GrooveMessageBoxResultCode_OK == Window.DoModal())
				{
					var FriendlyName = AddFavoriteCode.GetFriendlyName();
					if (FriendlyName != "")
					{
						AddFavorite(CurrentURL, FriendlyName, AddFavoriteCode.GetCurrentFolder());
					}
				}

				// Listen to callbacks
				g_IgnoreDocumentShareViewCallbacks = false;
			}

			// Destory the window
			Window.Destroy();
		}
		catch(Error)
		{
			if (Window)
				Window.Destroy();

			// Listen to callbacks
			g_IgnoreDocumentShareViewCallbacks = false;
		}	
	 }

	function AddFavorite(i_URL, i_FriendlyName, i_CurFolderID)
	{
		var FullName = i_FriendlyName + ".url";
		var DisplayName = i_FriendlyName;
		var FileID = WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.CreateURLID();
		var MemByteStore = CreateMemoryByteStore();
		var ByteOutputStream = MemByteStore.OpenByteOutputStream(false);
		var CharOutputStream = ByteOutputStream.OpenCharOutputStream(0);
		CharOutputStream.WriteString("[InternetShortcut]\r\n");
		CharOutputStream.WriteString("URL="+i_URL+"\r\n");
		var ByteInputStream = MemByteStore.OpenByteInputStream();
		var dynMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var SessionName = DocShareCode.OpenUIUndoRedoSessionName();
		var gDelta = dynMgr.CreateDelta(SessionName);
				
		//i_CurFolderID is "" then URL will be added to root
		if (typeof i_CurFolderID == "undefined" || i_CurFolderID == "")
		{
			var RootID = WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenRootFolderID();
			var ParentID = RootID;
			WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.CreateURLInFolder(gDelta, FileID, ParentID, DisplayName, FullName, ByteInputStream);
			dynMgr.DoDelta(gDelta);
		}
		else
		{
			//we're in some other folder, determine it and add to it
			ParentID = i_CurFolderID;
			WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.CreateURLInFolder(gDelta, FileID, ParentID, DisplayName, FullName, ByteInputStream);
			dynMgr.DoDelta(gDelta);
		}
	}

	function WebBrowserView_OnUserNavigateBegin(i_URL, i_IsTopLevel)
	{
		if (i_IsTopLevel == true)
			UpdateURLCtrl(i_URL);
	}

	function WebBrowserView_OnUserNavigateEnd(i_URL, i_IsTopLevel)
	{
		if (i_IsTopLevel == true)
		{
			UpdateURLCtrl(i_URL);
			AddToHistory(URL.Text);
		}
	}

	function WebBrowserView_OnBrowseTogetherChanged(i_BrowseTogether)
	{
		BrowseTogether.CheckState = i_BrowseTogether;
	}

	function WebBrowserControlStatusTextChange(i_Status)
	{
		StatusBar.SetText(i_Status);
	}


	function WebBrowserControlCommandStateChange(i_Command, i_Enable)
	{
		switch (i_Command)
		{
		case CSC_NAVIGATEBACK:    BackCommand = i_Enable; break;
		case CSC_NAVIGATEFORWARD: ForwardCommand = i_Enable; break;
		}
	}
	
	function WebBrowserControlProgressChange(Progress, ProgressMax)
	{
		// IE reports progress in this unusual way:
		// - Normal progress indications
		// - Called with Progress == ProgressMax
		// - Called with Progress == -1
		// - Called with Progress == ProgressMax
		// - Called with Progress == 0 & ProgressMax == 0

		if (ProgressMax == 0)
			ProgressBar.SetText("");

		else if (Progress >= 0)
			ProgressBar.SetText(Math.min(100, Math.round(Progress * 100 / ProgressMax)) + "%");
	}

	function ShowNavigationControls(i_bShow)
	{
		if (i_bShow == true)
			ShowAllControls();
		else if (i_bShow == false)
			RemoveAllControls();
	}

	function PutURL(i_URL)
	{
		UpdateURLCtrl(i_URL);
	}

	function GetURL()
	{
		return URL.Text;
	}

	function NavigateToURL(i_URL)
	{
		if (i_URL == "")
			WebBrowserView.Navigate(URL.Text);
		else
			WebBrowserView.Navigate(i_URL);
	}

	function ShowAllControls()
	{
		var TableSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.HTMLTableLayoutControlInfo");
		var TableCellObj = TableSizeObj.Cell();

		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_URL;
		WebLayout.AddControlByName(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_URL, TableCellObj);

		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BACK;
		WebLayout.AddControlByName(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BACK, TableCellObj);

		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_FORWARD;
		WebLayout.AddControlByName(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_FORWARD, TableCellObj);

		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_OK;
		WebLayout.AddControlByName(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_OK, TableCellObj);

		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BROWSETOGETHER;
		WebLayout.AddControlByName(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BROWSETOGETHER, TableCellObj);

		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STOP;
		WebLayout.AddControlByName(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STOP, TableCellObj);

		TableSizeObj.SetHeight(25, GrooveLayoutSizeType_Pixels);
		WebLayout.AdjustCellLayout(TableCellObj, TableSizeObj);

		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STATUSBAR;
		WebLayout.AddControlByName(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STATUSBAR, TableCellObj);
		TableSizeObj.SetHeight(25, PIXELS);
		WebLayout.AdjustCellLayout(TableCellObj, TableSizeObj);
	}

	function RemoveAllControls()
	{
		var TableSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.HTMLTableLayoutControlInfo");
		var TableCellObj = TableSizeObj.Cell();

		if (WebLayout.IsControlInLayout(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_URL) == true)
			WebLayout.RemoveControl(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_URL);

		if (WebLayout.IsControlInLayout(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BACK) == true)
			WebLayout.RemoveControl(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BACK);

		if (WebLayout.IsControlInLayout(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_FORWARD) == true)
			WebLayout.RemoveControl(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_FORWARD);

		if (WebLayout.IsControlInLayout(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_OK) == true)
			WebLayout.RemoveControl(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_OK);

		if (WebLayout.IsControlInLayout(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BROWSETOGETHER) == true)
			WebLayout.RemoveControl(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_BROWSETOGETHER);

		if (WebLayout.IsControlInLayout(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STOP) == true)
			WebLayout.RemoveControl(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STOP);

		TableSizeObj.SetHeight(1, GrooveLayoutSizeType_Pixels);
		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_URL;
		Layout.AdjustCellLayout(TableCellObj, TableSizeObj);

		if (WebLayout.IsControlInLayout(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STATUSBAR) == true)
			WebLayout.RemoveControl(WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STATUSBAR);

		TableSizeObj.SetHeight(1, PIXELS);
		TableCellObj.Name=WEBBROWSER_TOOL_HTML_TABLE_LAYOUT_CONTROL_STATUSBAR;
		Layout.AdjustCellLayout(TableCellObj, TableSizeObj);
	}
	
	function UpFolderButton_OnCommand(i_UICommand)
	{
		DocShareCode.BrowseParentFolder();
	}

	function UpOneFolderCommandBar(i_UICommand)
	{
		DocShareCode.BrowseParentFolder();
	}

	function OptionsButton_OnCommand(i_UICommand)
	{
	}


	function ExecuteMenuCommand(i_UICommand)
	{
		var CommandURL= i_UICommand.CommandURL;

		if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_NEWFOLDER)
		{	
			if (SizeState == 0)
			{
				OnFavoritesList();
				CreateNewFolder();
				SizeState = 1;
			}
			else CreateNewFolder();
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN)
		{
			OpenUrl();
			//var ShareObjectEnum = DocShareCode.OpenShareObjectSelectionEnum();
			//while (ShareObjectEnum.HasMore())
			//{
			//	ExecuteFavorite(ShareObjectEnum.OpenNext());
			//}
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE)
			OnAddFavorites();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_IMPORT)
			DocShareCode.DisplayAddFileDialog(DocumentShareView.OpenBrowsedFolderID(),true);
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_WEBPAGE)
			DocShareCode.DisplayPropertiesForSelection();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_UNDO)
			DocShareCode.Undo();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_REDO)
			DocShareCode.Redo();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CUT)
		{
			DocShareCode.CopySelectionToClipboard();
			DocShareCode.DeleteSelection(true);
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPY)
			DocShareCode.CopySelectionToClipboard();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_PASTE)
		{
			var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
			DocShareCode.PasteFromClipboardToFolder(BrowsedFolderID);
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPYCURRENTSITE)
			OnCopyAsLink();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME_FAVORITE)
			RenameFavorites();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_DELETE)
			DocShareCode.DeleteSelection(true);
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD)
		{
			MarkRead();
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD)
		{
			DocShareCode.MarkShareObjectSelectionRead(false);
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLREAD)
		{
			DocShareCode.MarkAllShareObjectsRead(true);
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD)
		{
			DocShareCode.MarkAllShareObjectsRead(false);
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES)
		{	
			OnFavoritesList();
			ReplaceIcon();
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL)
			DocShareCode.BrowseParentFolder();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_STOP)
			OnStop();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_REFRESH)
			OnRefresh();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER)
		{	
			WebBrowserView.ForceBrowseTogether(!i_UICommand.CheckState);
 			ReplaceIcon();

		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD)
			DocShareCode.NavigateToNextShareObject(GrooveShareObjectNavigationType_Unread);
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD)
			DocShareCode.NavigateToPreviousShareObject(GrooveShareObjectNavigationType_Unread);
	}

	function UpdateMenuCommand(i_UICommand)
	{
		var CommandURL = i_UICommand.CommandURL;
		var FavoritesPaneHasFocus = false;
		if (UIPropertyList.PropertyExists(UI_PROPERTY_UIACTIVE_COMPONENT))
		{
			var pFocusComponent = UIPropertyList.OpenProperty(UI_PROPERTY_UIACTIVE_COMPONENT);
			FavoritesPaneHasFocus = (pFocusComponent.Component().OpenName() == "DocumentShareView");
		}
		
		//if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN || CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_WEBPAGE ||	CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CUT || CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPY || CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD || CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD)
		//	i_UICommand.Enabled = FavoriteSelected();
		if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_PROPERTIES_WEBPAGE ||	CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_CUT || CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPY)
			i_UICommand.Enabled = FavoritesPaneHasFocus && FavoriteSelected();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_OPEN)
			i_UICommand.Enabled = true; 
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_ADDFAVORITE || CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_COPYCURRENTSITE)
		{
			if (URL.Text == WEBBROWSER_TOOL_URLTEXT_BLANK_URL || URL.Text == "")
				i_UICommand.Enabled = false;
			else
				i_UICommand.Enabled = true;
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_UNDO)
			i_UICommand.Enabled = FavoritesPaneHasFocus && DocShareCode.IsUndoAvailable();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_REDO)
			i_UICommand.Enabled = FavoritesPaneHasFocus && DocShareCode.IsRedoAvailable();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_PASTE)
			i_UICommand.Enabled = FavoritesPaneHasFocus && DocShareCode.IsClipboardPasteAvailable();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_FILE_RENAME_FAVORITE)
			i_UICommand.Enabled = FavoritesPaneHasFocus && FavoriteSelected();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_DELETE)
			i_UICommand.Enabled = FavoritesPaneHasFocus && FavoriteSelected();
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD)
		{
			i_UICommand.Enabled = false;
			if(FavoritesPaneHasFocus && DocShareCode.OpenShareObjectSelectionCount() > 0)
			{
				// Enumerate selected share objects and find read state
				var IShareObjectEnum = DocShareCode.OpenShareObjectSelectionEnum();

				while(IShareObjectEnum.HasMore())
				{
					var IShareObject = IShareObjectEnum.OpenNext();

					if(DocShareCode.IsShareObjectUnread(IShareObject.ShareObject.ID))
					{
						i_UICommand.Enabled = true;
						break;
					}
				}
			}
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD)
		{
			// Need to wait for implementation
			i_UICommand.Enabled = false;
			if(FavoritesPaneHasFocus && DocShareCode.OpenShareObjectSelectionCount() > 0)
			{
				// Enumerate selected share objects and find read state
				var IShareObjectEnum = DocShareCode.OpenShareObjectSelectionEnum();

				while(IShareObjectEnum.HasMore())
				{
					var IShareObject = IShareObjectEnum.OpenNext();

					if(!DocShareCode.IsShareObjectUnread(IShareObject.ShareObject.ID))
					{
						i_UICommand.Enabled = true;
						break;
					}
				}
			}
 
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLREAD)
		{
			if (DocShareCode.IsShareObjectUnread(WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenRootFolderID()))
				i_UICommand.Enabled = true;
			else
				i_UICommand.Enabled = false;
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD)
		{
			if (DocShareCode.IsShareObjectRead(WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenRootFolderID()))
				i_UICommand.Enabled = true;
			else
				i_UICommand.Enabled = false;
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_UPONELEVEL)
			i_UICommand.Enabled = FavoritesPaneHasFocus && !(WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenRootFolderID() == DocumentShareView.OpenBrowsedFolderID());
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_BROWSETOGETHER)
		{	
			i_UICommand.CheckState = WebBrowserView.BrowseTogether;
 			ReplaceIcon();
		}
		else if (CommandURL == WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES)
		{
			/*
			if (SizeState == 0)
			{
				i_UICommand.CheckState = GrooveCheckState_Unchecked;
			}
			else if (SizeState == 1)
			{
				i_UICommand.CheckState = GrooveCheckState_Checked;
			}
			*/
 			ReplaceIcon();
		}
	}


	function MarkRead()
	{
		DocShareCode.MarkShareObjectSelectionRead(true);
	}

	function CreateNewFolder()
	{
		Pane1ViewContainer.SetFocus("DocumentShareView");
		DocShareCode.CreateNewFolder(DocumentShareView.OpenBrowsedFolderID(), true);
	}

	function RenameFavorites()
	{
		var ShareObjectEnum = DocShareCode.OpenShareObjectSelectionEnum();
		while (ShareObjectEnum.HasMore())
		{
			var ShareObjectID = ShareObjectEnum.OpenNext().ShareObject.ID;
			Pane1ViewContainer.SetFocus("DocumentShareView");
			DocShareCode.DisplayRenameEditPrompt(ShareObjectID);
		}
	}

	function FavoriteSelected()
	{
		if (DocShareCode.OpenShareObjectSelectionCount() <= 0)
			var FavoriteSelected = false;
		else
			var FavoriteSelected = true;

		return FavoriteSelected;
	}

 	function ReplaceIcon()
	{	//need to set and test for this else 
		//we try to call UICommandContainer
		//before we're conneted and it fails
		if (UICommandContainerConnected)
		{
			if (WebBrowserView.BrowseTogether)
			{
				// if true browsing together
				BrowseTogetherOn();
			}
			else
			{
 				//once stops browsing together make sure we have the default
				BrowseTogetherOff();
			}
 			
			if (SizeState == 1)
			{
				FavoriteListOpened();
			}					
			else //if (SizeState == 0)
			{
				FavoriteListClosed();
			}
		}

		else
		{
 			return;
		}
	}
	
	
	
	function BrowseTogetherOff()
	{
		if (!UICommandContainer.UICommandExists(TBCommandArray[12]))
			return;

		//this is the default icon
 		var ImagesURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImages.jpg");
		var ImagesMaskURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImagesMask.bmp");
 		var Width = 16;
		var Height = 16;
 		var ImagePosition = 15;
		Offset = Width * ImagePosition;
 		var UICommand = UICommandContainer.OpenUICommand(TBCommandArray[12]);
 		UICommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
	}


	function BrowseTogetherOn()
	{
		if (!UICommandContainer.UICommandExists(TBCommandArray[12]))
			return;

		//this is the replaced icon
 		var ImagesURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImages.jpg");
		var ImagesMaskURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImagesMask.bmp");
 		var Width = 16;
		var Height = 16;
 		var ImagePosition = 14;
		Offset = Width * ImagePosition;
 		var UICommand = UICommandContainer.OpenUICommand(TBCommandArray[12]);
 		UICommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
	}

	
	function FavoriteListClosed()
	{
		if (UICommandContainer.UICommandExists(TBCommandArray[6]))
		{
 			var ImagesURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImages.jpg");
			var ImagesMaskURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImagesMask.bmp");
 			var Width = 16;
			var Height = 16;
 			var ImagePosition = 3;
			Offset = Width * ImagePosition;
 			var UICommand = UICommandContainer.OpenUICommand(TBCommandArray[6]);
			UICommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLISTCLOSED_TOOLTIP;
 			UICommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
		}

		// Here we will update the Menu
 		var menuUICommand = g_ViewShowHideCC.UICommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES);
		menuUICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWFAVORITES_LABEL;
	}

	function FavoriteListOpened()
	{
		if (UICommandContainer.UICommandExists(TBCommandArray[6]))
		{
 			var ImagesURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImages.jpg");
			var ImagesMaskURL = CreateURLFromSchemeAndPath("grooveFile", "ToolBMPs\\WebToolIconImagesMask.bmp");
 			var Width = 16;
			var Height = 16;
 			var ImagePosition = 16;
			Offset = Width * ImagePosition;
 			var UICommand = UICommandContainer.OpenUICommand(TBCommandArray[6]);
			UICommand.Tooltip = WEBBROWSER_TOOL_COMMAND_TOOLBAR_WEBTOOL_FAVORITESLISTOPENED_TOOLTIP;
 			UICommand.SetImage(ImagesURL, ImagesMaskURL, Offset, Width, Height);
		}

 		var menuUICommand = g_ViewShowHideCC.UICommandContainer.OpenUICommand(WEBBROWSER_TOOL_COMMAND_MENU_VIEW_SHOWHIDEFAVORITES);
		menuUICommand.Label = WEBBROWSER_TOOL_COMMAND_MENU_VIEW_HIDEFAVORITES_LABEL;
	}

 
 	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @           ı  @   ˆ  X  ˜                    ·     °  °                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                H                Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   L   ÄName2   G r o o v e W e b B r o w s e r G l u e 4 . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPT   
  ÄIMPLEMENTS     ÄSCRIPTINTERFACE   
  ÄIMPLEMENTS	   
  ÄIMPLEMENTS  
  Ä  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       i o  ÄSCRIPT       ÄSRC8  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . G e n e r a l . D o c u m e n t S h a r e . G r o o v e D o c u m e n t S h a r e _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   r     e _
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }   =   ÄIIDL   { 5 1 B F 8 1 E 1 - 6 D E 7 - 1 1 D 2 - 9 4 6 1 - 0 0 8 0 C 7 D E 3 2 C 6 }   s       ÄSCRIPT   0 8 0   ÄSCRIPTINTERFACE       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 d 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }   a   ÄIIDL   { C 6 8 0 0 A 8 4 - 8 7 3 D - 4 1 b 5 - A 3 D 9 - 6 8 3 6 F D B 9 1 E 7 D }   y     Ä

			function OnUpdateContainerState2 (i_Container)
			{
			}

			function OnCommand2 (i_Container, i_UICommand)
			{
				ExecuteMenuCommand(i_UICommand);
			}

			function OnUpdateCommandState2 (i_Container, i_UICommand)
			{
				UpdateMenuCommand(i_UICommand);
			}

		omman
  ÄIMPLEMENTS       ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }   S   ÄIIDL   { 4 D 7 E C 5 0 1 - E 6 C C - 1 1 d 2 - 8 7 1 E - 0 0 8 0 C 7 8 6 8 F 6 F }           ÄSCRIPT
          ÄSCRIPT	         m Ä
		// ----------------------------------------------------------------------------
		// Begin IGrooveDocumentShareCommandSink Events implementation
		// ----------------------------------------------------------------------------
		function OnAddShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID)
		{
		}
		function OnBrowseFolder(i_pEngine, i_UserURL, i_FolderID)
		{
			if (i_FolderID == WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenRootFolderID())
				UpFolderButton.Enabled = false;
			else
				UpFolderButton.Enabled = true;			
		}
		function OnChangeFileContents(i_pEngine, i_ParentID, i_ShareObjectID)
		{
		}
		function OnChangeLastModifiedTime(i_pEngine, i_ParentID, i_ShareObjectID)
		{
		}
		function OnCreateFolder(i_pEngine, i_ParentFolderID, i_FolderID)
		{
		}
		function OnDeleteShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID)
		{
		}
		function OnFolderViewSortChange(i_pEngine, i_UserURL, i_FolderID, i_SortColumn, i_SortType)
		{
		}
		function OnFolderViewStyleChange(i_pEngine, i_UserURL, i_FolderID, i_ViewStyle)
		{
		}
		function OnRenameShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID, i_OldFullName, i_NewFullName)
		{
		}
		function OnReplaceShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID)
		{
		}
		function OnConflict(i_pEngine, i_ParentID, i_FileID, i_ConflictMemberContactURL)
		{
		}

		// ----------------------------------------------------------------------------
		// End IGrooveDocumentShareCommandSink Events implementation
		// ----------------------------------------------------------------------------
		--------
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }   =   ÄIIDL   { D B 8 2 1 8 2 2 - 5 C 7 6 - 4 2 1 5 - A 5 B 4 - 4 0 8 D 2 9 F 9 C 5 5 2 }   t       ÄSCRIPT                                                                                 8·    à   |·    |˚           ·            X]   ¨ U              )      `    ÄSCRIPT         n Ä
			function OnNavigate(i_pURLNavigator, i_URL, i_bAddToHistory)
			{
				var pURI = GROOVE_GLOBAL_MISC_POINTER.OpenURI(i_URL);
				if (pURI.DoesQueryPartExist(COPY_AS_LINK_FRAME_MAP_NAME))
				{
					// Deserialize the string into an element
					var FrameMapStr = pURI.OpenQueryPart(COPY_AS_LINK_FRAME_MAP_NAME);
					var MemByteStore = CreateMemoryByteStore();
					var ByteOutputStream = MemByteStore.OpenByteOutputStream(false);
					var CharOutputStream = ByteOutputStream.OpenCharOutputStream(0);
					CharOutputStream.WriteString(unescape(FrameMapStr));
					var ByteInputStream = MemByteStore.OpenByteInputStream();
					var pFrameMapElement = g_StorageMgr.TemporaryXMLDocument.CreateElementFromStream(ByteInputStream, GrooveParseOption_Default);
					pFrameMapElement.SetDeleteOnRelease();

					// Deserialize element into a frame map
					var pFrameMapFactory = GrooveScriptFunctions.CreateNewObject("Groove.FrameMapStrToStrFactory");
					var pFrameMap = pFrameMapFactory.CreateFromElement(pFrameMapElement);

					// Turn off browse together if we're not navigating together.
					if (g_pTelespaceIdentityPropertyList.PropertyExists("ToolNavigationMode"))
					{
						var NavigatingTogether = g_pTelespaceIdentityPropertyList.OpenPropertyAsLong("ToolNavigationMode");
						if (!NavigatingTogether)
							WebBrowserView.ForceBrowseTogether(false);
					}

					WebBrowserView.NavigateToFrameMap(pFrameMap);
				}
				else if (pURI.DoesQueryPartExist("Unread"))
				{
					var Value = pURI.OpenQueryPart("Unread");
					if (Value == "Any")
						DocShareCode.NavigateToNextShareObject(GrooveShareObjectNavigationType_Unread);
					else if (Value == "Next")
						DocShareCode.NavigateToNextShareObject(GrooveShareObjectNavigationType_Unread);
					else if (Value == "Previous")
						DocShareCode.NavigateToPreviousShareObject(GrooveShareObjectNavigationType_Unread);
				}
				else
				{
					var BrowseFolderID;
					if (DocShareCode.IsBindableShareObjectURL(i_URL))
					{
						// Let document share engine bind to the share object
						var pURLManager = GrooveScriptFunctions.CreateNewObject("Groove.URLManager");

						try {
							var URLBindResult = pURLManager.BindToURL2(i_URL);
							var pShareObject = URLBindResult.Object;

							var ShareObjectID = pShareObject.ShareObject.ID;
							if(pShareObject.ShareObject.Type == "Folder")
							{
								BrowseFolderID = ShareObjectID;
							}
							else
							{
								BrowseFolderID = WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenParentFolderID(ShareObjectID);
							}

							// Browse to appropriate folder
							DocumentShareView.Commands.BrowseFolder(BrowseFolderID);

							// Select file (if file)
							if(pShareObject.ShareObject.Type == WEBBROWSER_TOOL_TEXT_FILE)
							{
								ExecuteFavorite(pShareObject);
							}
						}
						catch(Error)
						{
							// Display warning that cannot find share object to
							// navigate to
							DocShareCode.DisplayNavigateShareObjectWarning();

							// Navigate to root share folder by default
							BrowseFolderID = WebBrowserDataModelDelegate.IGrooveWebBrowserToolDataModel.OpenRootFolderID();
						}

					}
				}
				WebBrowserSplitter.ViewContainer.SetDefaultFocus();
				var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
				var Tool = PropertyList.OpenProperty(PROPERTY_TOOL);
				var Name = Tool.DisplayName;
				var URLDisplay = SubstituteArrayValuesInString(WEBBROWSER_TOOL_URL_NAVIGATION_FORMAT, [Telespace.DisplayName, Name]);
				i_pURLNavigator.SetCurrentURL(i_URL, URLDisplay, Name, i_bAddToHistory);
			}
		                                                                                                                                                                                                                                                                                                                                                                       Äâ         ÄSCRIPT         æ  Ä

			function OnCommand(i_UICommand)
			{
				ExecuteMenuCommand(i_UICommand);
			}

			function OnUpdateCommandState(i_UICommand)
			{
				UpdateMenuCommand(i_UICommand);
			}
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ÄŸ      ÄSCRIPT         ÍÄ
					
		function Initialize()
		{
	//		GrooveDebugFunctions.DisplayAssert(false, "");

			GrooveRunTimeData.SetItem("TaskNumberThreshold", 250);

			// From MSProject IDL...

			GrooveRunTimeData.SetItem("pjResourceTypeWork", 0);
			GrooveRunTimeData.SetItem("pjResourceTypeMaterial", 1);

			GrooveRunTimeData.SetItem("pjPriorityDoNotLevel", 1000); 
			GrooveRunTimeData.SetItem("pjPriorityHighest", 900); 
			GrooveRunTimeData.SetItem("pjPriorityVeryHigh", 800); 
			GrooveRunTimeData.SetItem("pjPriorityHigher", 700); 
			GrooveRunTimeData.SetItem("pjPriorityHigh", 600);
			GrooveRunTimeData.SetItem("pjPriorityMedium", 500); 
			GrooveRunTimeData.SetItem("pjPriorityLow", 400);
			GrooveRunTimeData.SetItem("pjPriorityLower", 300); 
			GrooveRunTimeData.SetItem("pjPriorityVeryLow", 200); 
			GrooveRunTimeData.SetItem("pjPriorityLowest", 100); 

	/*		same constants are different in Project'98

			pjPriorityDoNotLevel = 9,
			pjPriorityHighest = 8,
			pjPriorityVeryHigh = 7,
			pjPriorityHigher = 6,
			pjPriorityHigh = 5,
			pjPriorityMedium = 4,
			pjPriorityLow = 3,
			pjPriorityLower = 2,
			pjPriorityVeryLow = 1,
			pjPriorityLowest = 0

			Groove project currently supports pjASAP and pjSNET only.

			pjASAP = 0,
			pjALAP = 1,
			pjFNET = 6,
			pjFNLT = 7,
			pjMFO = 3,
			pjMSO = 2,
			pjSNET = 4,
			pjSNLT = 5
	*/
			GrooveRunTimeData.SetItem("pjSNET", 4);
			GrooveRunTimeData.SetItem("pjASAP", 0);

			GrooveRunTimeData.SetItem("pjCopyCurrent", 0);
			GrooveRunTimeData.SetItem("pjIntoBaseline", 0);

			GrooveRunTimeData.SetItem("pjDoNotSave", 0); 
			GrooveRunTimeData.SetItem("pjSave", 1); 
			GrooveRunTimeData.SetItem("pjPromptSave", 2); 

			GrooveRunTimeData.SetItem("pjFinishToStart", 1); 

			// Email related stuff
			GrooveRunTimeData.SetItem("X400", "X400");
			GrooveRunTimeData.SetItem("pref", "pref");

			//Defaults
			GrooveRunTimeData.SetItem("IID_DGroovePropertyChangeListener", "{C3A7FC22-FA8B-11d3-94EB-0050DAD881E4}");
			GrooveRunTimeData.SetItem("IID_IGroovePropertyChangeListener", "{8DD8FFD4-C75D-11d3-80D5-00500487878E}");

			//  Indicate that we want to receive events fired by
			//  our own property list
			ScriptHostComponent.Advise
				(
				PropertyList, 
				GrooveRunTimeData.GetItem("IID_IGroovePropertyChangeListener")
				);

		}

		function Terminate()
		{
			ScriptHostComponent.Unadvise
				(
				PropertyList, 
				GrooveRunTimeData.GetItem("IID_IGroovePropertyChangeListener")
				);
		}

//--------------------------------------------------------------------------------
// Helper to determine if we are going to import predecessors
//--------------------------------------------------------------------------------
		function AreWeImportingPredecessors()
		{
			//We cannot import predecessors if it is MSProject98
			//because the type of dependency is not exposed.
			//We want to be as silent as possible, so we check if 
			//we have at least one task with predecessor.
			try
			{
				var pMSProjectTasks = GrooveRunTimeData.GetItem("pMSProjectTasks");
				var count = pMSProjectTasks.Count;
				if(count)
				{
					var i;
					for(i = 0; i < count; i++)
					{
						var pTask = pMSProjectTasks(i + 1);
						if(pTask)
						{
							var predecessorTasksCount = pTask.PredecessorTasks.Count;
							if(predecessorTasksCount)
							{
								if("undefined" == typeof pTask.TaskDependencies) // MSProject98!!!
									return "DontImportWarnUser";
								else 
									return "Import";
							}
						}
					}
				}
			}
			catch(e)
			{
				return "Error";
			}

			return "DontImport";
		}

//--------------------------------------------------------------------------------
// Trims string containing non-displayable symbols only - to empty
//--------------------------------------------------------------------------------
		function TrimNonVisibleStringToEmpty(i_InputString)
		{
/* 
			This is non-ECMA version of the same thing
			var re = /[^\b\f\n\r\t\v ]/;
			if(!ResultString.match(re))
				ResultString = "";
*/
			var ResultString = i_InputString;
			var length = ResultString.length;
			if(length)
			{
				var bNoVisibleCharacters = true;
				var theChar;
				for(i = 0; i < length; i++)
				{
					theChar = ResultString.charAt(i);

					if( theChar != '\b' && //backspace
						theChar != '\f' && //formfeed
						theChar != '\n' && //linefeed
						theChar != '\r' && //carriage return
						theChar != '\t' && //horisontaltab
						theChar != '\v' && //vertical tab
						theChar != ' '	   //blank 	
					  )
					{
						bNoVisibleCharacters = false;
						break;
					}
				}

				if(true == bNoVisibleCharacters)
					ResultString = "";
			}

			return ResultString;
		}

//--------------------------------------------------------------------------------
// Helpers to get some project statistics
//--------------------------------------------------------------------------------

		function GetMSProjectResourceCount()
		{
			// MSProject has NumberOfResources property
			// but we need to weed out material resources
			var WorkResourceCount = 0;
			try
			{
				if(true == GrooveRunTimeData.HasItem("pMSProjectResources")) 
				{
					var pResources = GrooveRunTimeData.GetItem("pMSProjectResources");
					var count = pResources.Count;
					var i;
					for(i = 0; i < count; i++)
					{
						var pResource = pResources( i + 1 );
						if(pResource) // it may be sparse array
						{
							// Project 98 does not have resource type
							var ResourceType;
							try
							{
								ResourceType = pResource.Type;
							}
							catch(e)
							{
								//
							}

							// If it fails once it will fail for all:
							if("undefined" == typeof ResourceType ||
								ResourceType == GrooveRunTimeData.GetItem("pjResourceTypeWork")) 
								WorkResourceCount++;
						}
					}
				}
			}
			catch(e)
			{
				WorkResourceCount = -1;
			}

			return WorkResourceCount;
		}

		function GetMSProjectTaskCount()
		{
			var TaskCount = 0;

			try
			{
				// Project summary task is not counted here
				if(true == GrooveRunTimeData.HasItem("pMSProjectTasks"))
				{
					var pTasks = GrooveRunTimeData.GetItem("pMSProjectTasks");

					if(pTasks)
					{
						var AllTasksCount = pTasks.Count;
						var j;
						for(j = 0; j < AllTasksCount; j++)
						{
							//It may be sparse array
							var pTask = pTasks( j + 1 );

							if(pTask)
								TaskCount++;
						}
					}
				}
			}
			catch(e)
			{
				TaskCount = -1;
			}

			return TaskCount;
		}


		function GetGrooveContactCount()
		{
			var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var pTransaction;
			var ContactCount = 0;
			try
			{
				pTransaction = pTelespace.OpenTransaction(true);

				var ContactEnum = ContactProvider.OpenContactEnum();
				while(ContactEnum.HasMore())
				{
					ContactCount++;
					ContactEnum.OpenNext();
				}

				ContactEnum.Reset();

				pTransaction.EndRead();
			}
			catch(e)
			{
				if(pTransaction)
					pTransaction.Abort();

				ContactCount = -1;
			}

			return ContactCount;
		}

		function GetGrooveTaskCount()
		{
			var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var pTransaction;
			var TaskCount =  0;
			try
			{
				pTransaction = pTelespace.OpenTransaction(true);

				var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");	
				var pGrooveProject = pTaskProvider.GetProject();
				var ProjectID = pGrooveProject.ID;

				var ChildEnum = pTaskProvider.GetChildIDEnum(ProjectID, -1);

				while(ChildEnum.HasMore())
				{
					TaskCount++;
					ChildEnum.OpenNext();
				}

				ChildEnum.Reset();

				pTransaction.EndRead();
			}
			catch(e)
			{
				if(pTransaction)
					pTransaction.Abort();

				TaskCount = -1;
			}

			return TaskCount;
		}

		//---------------------------------------------------------------------
//	MSProjectPumpMap - object with a bunch of run-time data maps
//---------------------------------------------------------------------
	function MSProjectPumpMap()
	{
		this.GrooveProjectKeyWorkResourceMap = new CommonMap();

		this.MSProjectKeyWorkResourceMap = new CommonMap();
		this.MSProjectKeyTaskMap = new CommonMap();

		this.MSProjectTaskWithGroovePredecessorsMap = new CommonMap();
		this.MSProjectTaskByGrooveTaskIDMap = new CommonMap();

		this.GrooveProjectKeyGrooveNameMap = new CommonMap();

		this.HasWorkResourceByMSProjectID = raw_HasWorkResourceByMSProjectID;
		this.GetWorkResourceGrooveProjectID = raw_GetWorkResourceGrooveProjectID;
		this.HasWorkResourceByGrooveProjectID = raw_HasWorkResourceByGrooveProjectID;
		this.GetWorkResourceMSProjectID = raw_GetWorkResourceMSProjectID;
		this.AddWorkResourceIDs = raw_AddWorkResourceIDs;

		this.HasMSProjectTaskID = raw_HasMSProjectTaskID;
		this.GetGrooveTaskIDEnumByMSProjectTaskID = raw_GetGrooveTaskIDEnumByMSProjectTaskID;
		this.AddMSProjectTaskID = raw_AddMSProjectTaskID;

		this.AddGroovePredecessorEnumByMSProjectTask = raw_AddGroovePredecessorEnumByMSProjectTask;
		this.AddMSProjectTaskByGrooveTaskID = raw_AddMSProjectTaskByGrooveTaskID;
		this.GetMSProjectTaskWithGroovePredecessorsMap = raw_GetMSProjectTaskWithGroovePredecessorsMap;
		this.GetMSProjectTaskByGrooveTaskID = raw_GetMSProjectTaskByGrooveTaskID;

		this.FindMatchInGrooveContacts = raw_FindMatchInGrooveContacts;
		this.PopulateMapsFromGrooveContacts = raw_PopulateMapsFromGrooveContacts;
		this.GetGrooveNameFromContactURL =  raw_GetGrooveNameFromContactURL;

		this.Clear = raw_Clear;
    }

	function raw_HasWorkResourceByMSProjectID(i_MSProjectID)
	{
		return this.MSProjectKeyWorkResourceMap.KeyExists(i_MSProjectID);
	}

	function raw_GetWorkResourceGrooveProjectID(i_MSProjectID)
	{
		return this.MSProjectKeyWorkResourceMap.FindByKey(i_MSProjectID);
	}

	function raw_HasWorkResourceByGrooveProjectID(i_GrooveProjectID)
	{
		return this.GrooveProjectKeyWorkResourceMap.KeyExists(i_GrooveProjectID);
	}

	function raw_GetWorkResourceMSProjectID(i_GrooveProjectID)
	{
		return this.GrooveProjectKeyWorkResourceMap.FindByKey(i_GrooveProjectID);
	}

	function raw_AddWorkResourceIDs(i_GrooveProjectID, i_MSProjectID)
	{
		this.GrooveProjectKeyWorkResourceMap.Add(i_GrooveProjectID, i_MSProjectID); 
		this.MSProjectKeyWorkResourceMap.Add(i_MSProjectID, i_GrooveProjectID); 
	}

	function raw_HasMSProjectTaskID(i_MSProjectID)
	{
		return this.MSProjectKeyTaskMap.KeyExists(i_MSProjectID);
	}

	function raw_GetGrooveTaskIDEnumByMSProjectTaskID(i_MSProjectTaskID)
	{
		var pDoubleEnumFactory = CreateDoubleEnum();
		var count = this.MSProjectTaskByGrooveTaskIDMap.GetCount();
		for(var i = 0; i < count; i++)
		{
			var pData = this.MSProjectTaskByGrooveTaskIDMap.GetAt(i);
			if(pData.Value.UniqueID == i_MSProjectTaskID)
				pDoubleEnumFactory.Add(pData.Key);
		}

		return pDoubleEnumFactory.DoubleEnum;
	}

	function raw_AddMSProjectTaskID(i_MSProjectID)
	{
		this.MSProjectKeyTaskMap.Add(i_MSProjectID, ""); 
	}

	function raw_AddGroovePredecessorEnumByMSProjectTask(i_pMSProjectTask, i_pGroovePredecessorEnum)
	{
		this.MSProjectTaskWithGroovePredecessorsMap.Add(i_pMSProjectTask, i_pGroovePredecessorEnum);
	}

	function raw_AddMSProjectTaskByGrooveTaskID(i_GrooveTaskID, i_pMSProjectTask)
	{
		this.MSProjectTaskByGrooveTaskIDMap.Add(i_GrooveTaskID, i_pMSProjectTask);
	}

	function raw_GetMSProjectTaskWithGroovePredecessorsMap()
	{
		return this.MSProjectTaskWithGroovePredecessorsMap;
	}

	function raw_GetMSProjectTaskByGrooveTaskID(i_GrooveTaskID)
	{
		return this.MSProjectTaskByGrooveTaskIDMap.FindByKey(i_GrooveTaskID);
	}

	// this function loooks up matching full name in the list
	// provided by ContactProvider and returns its ContactURL 
	// or "" if there is no match. 
	function raw_FindMatchInGrooveContacts(i_FullName)
	{
		// This is a standard way of enumerating a dictionary
		var NormalizedFullName = Normalize(i_FullName);
		var RetVal = this.GrooveProjectKeyGrooveNameMap.FindByValue(NormalizedFullName);
		if(!RetVal)
			RetVal = "";

		return RetVal;
	}

	// Populates dictionary Full Names from the list of contacts
	// with ContactURL as the key  
	function raw_PopulateMapsFromGrooveContacts()
	{
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			var pContactEnum = ContactProvider.OpenContactEnum();
			pContactEnum.Reset();

			while(pContactEnum.HasMore())
			{
				var pContact = pContactEnum.OpenNext();
				var ContactURL = pContact.OpenURL();
				var FullName = Normalize(OpenFullNameFromContact(pContact));
				this.GrooveProjectKeyGrooveNameMap.Add(ContactURL, FullName);	
			}

			pTransaction.EndRead();
		}
		catch(error)
		{
			if(pTransaction)
				pTransaction.Abort();
		}
	}

	function raw_GetGrooveNameFromContactURL(i_ContactURL)
	{
		var Result = this.GrooveProjectKeyGrooveNameMap.FindByKey(i_ContactURL);
		if(!RetVal)
			RetVal = "";

		return RetVal;
	}

	function raw_Clear()
	{
		ClearMapContent(this.GrooveProjectKeyWorkResourceMap);
		delete this.GrooveProjectKeyWorkResourceMap;

		ClearMapContent(this.MSProjectKeyWorkResourceMap);
		delete this.MSProjectKeyWorkResourceMap;

		ClearMapContent(this.MSProjectKeyTaskMap);
		delete this.MSProjectKeyTaskMap;

		ClearMapContent(this.MSProjectTaskWithGroovePredecessorsMap);
		delete this.MSProjectTaskWithGroovePredecessorsMap;

		ClearMapContent(this.MSProjectTaskByGrooveTaskIDMap);
		delete this.MSProjectTaskByGrooveTaskIDMap;

		ClearMapContent(this.GrooveProjectKeyGrooveNameMap);
		delete this.GrooveProjectKeyGrooveNameMap;
	}

	function ClearMapContent(i_CommonMap)
	{
		var length = i_CommonMap.length;
		var i;
		for(i = 0;  i < length; i++)
		{
			var temp = i_CommonMap.GetAt(i);
			try
			{
				if(temp)
					delete temp;
			}
			catch(e)
			{
				//
			}
		}
	}

//=============================================================================
// Startup/Shutdown
//=============================================================================

	// Launches MS Project app, caches pointers, prepare run-time map
	// which holds information about the items being imported
	function StartImport(i_FilePath)
	{
		var bResult = true;

		try
		{
			if(!i_FilePath || "" == i_FilePath)
				throw "";

			var pMSProject = OpenMSProject(i_FilePath);

			if(!pMSProject)
				throw "";

			if(false == CacheMSProject(pMSProject))
				throw "";

			// Prepare run-time maps.
			CreateRunTimeMaps();

			GrooveRunTimeData.SetItem("UI_Cancel", false);

		}
		catch(error)
		{
			bResult = false;
			ClearRunTimeMaps();
		}

		return bResult;
	}

	// Launches MS Project app, caches pointers, prepare run-time map
	// which holds information about the items being exported
	function StartExport(i_FilePath)
	{
		var bResult = true;

		try
		{
			var pMSProject = CreateMSProject();

			if(!pMSProject)
				throw "";

			if(false == CacheMSProject(pMSProject))
				throw "";

			if(!i_FilePath || "" == i_FilePath)
				throw "";

			// Prepare run-time maps
			CreateRunTimeMaps();

			GrooveRunTimeData.SetItem("UI_Cancel", false);

		}
		catch(error)
		{
			ClearRunTimeMaps();
			bResult = false;
		}

		return bResult;
	}

	// Clears run-time map, shuts down MS Project application
	function ShutDown()
	{
		// This may be called in the ultimate catch block
		try
		{
			// Clear maps
			ClearRunTimeMaps();

			ReleaseMSProject();
			ShutDownMSProjectApp();

			ReleaseProviders();
		}
		catch(e)
		{
			// do nothing
		}
	}

	// Caches Task Provider interface. Also caches Task Provider tool to keep it
	// from unloading. Loading of Contacts tool is provided by ContactHelper component.
	function CacheProviders()
	{
		var bResult = true;

		// Cache tools
		try
		{
			var pTaskProvider = DHF_GetToolAndDelegateComponentForSupportedType("urn:solutions.groove.net:TaskProvider");
			if(pTaskProvider)
			{
				GrooveRunTimeData.SetItem("pTaskProvider", pTaskProvider.pIDelegate.IGrooveProjectTrackingDataDelegate);
            }
			else
				throw "";

		}
		catch(error)
		{
			ReleaseProviders();
			bResult = false;
		}

		return bResult;
	}

	function ReleaseProviders()
	{
		if(true == GrooveRunTimeData.HasItem("pTaskProvider"))
		{
			GrooveRunTimeData.SetItem("pTaskProvider", null);
			GrooveRunTimeData.RemoveItem("pTaskProvider");
		}
	}

//----------------------------------------------------------------------
// MSProject Application handling functions
//----------------------------------------------------------------------
	function LaunchMSProjectApp()
	{
		var pMSProject = null;
		var pMSApp = null;
		if(GrooveRunTimeData.HasItem("pMSApp"))
			pMSApp = GrooveRunTimeData.GetItem("pMSApp");

		try
		{
			if(!pMSApp)
			{
				pMSApp = GrooveScriptFunctions.CreateNewObject("MSProject.Application");
				pMSApp.Visible = false;
				GrooveRunTimeData.SetItem("pMSApp", pMSApp);
			}
		}
		catch(error)
		{
			ShutDownMSProjectApp(pMSApp);
			pMSApp = null;
		}

		return pMSApp;
	}

	function OpenMSProject(i_FilePath)
	{
		var pMSApp = LaunchMSProjectApp();
		var pMSProject = null;

		if(pMSApp)
		{
			try
			{
				pMSApp.FileOpen(i_FilePath);
				pMSProject = pMSApp.ActiveProject();
			}
			catch(error)
			{
				ShutDownMSProjectApp(pMSApp);
				pMSProject = null;	
			}
		}

		if(GrooveRunTimeData.HasItem("pMSProject"))
			GrooveRunTimeData.RemoveItem("pMSProject");

		if(pMSProject)
			GrooveRunTimeData.SetItem("pMSProject", pMSProject);

		return pMSProject;
	}

	function CreateMSProject()
	{
		var pMSApp = LaunchMSProjectApp();
		var pMSProject = null;

		if(pMSApp)
		{
			try
			{
				// Hide it and create a new file
				pMSApp.Visible = false;
				pMSApp.FileNew();
				
				pMSProject = pMSApp.ActiveProject();

				// We don't want Prompt for Summary Info to appear
				// because it may be obscured by Groove and it appears
				// that Groove is hanging. We also want to save
				// original property value to restore it on shutdown
				GrooveRunTimeData.SetItem("bPromptForSummaryInfo", pMSApp.PromptForSummaryInfo);
				pMSApp.PromptForSummaryInfo = false;
			}
			catch(error)
			{
				ShutDownMSProjectApp(pMSApp);
				pMSProject = null;
			}
		}
		
		return pMSProject;
	}
    
	function SaveMSProject(FilePath)
	{
		if(true == GrooveRunTimeData.HasItem("pMSApp"))
		{
			var pMSApp = GrooveRunTimeData.GetItem("pMSApp");
			if(pMSApp)
			{
				pMSApp.BaselineSave(
					true, 
					GrooveRunTimeData.GetItem("pjCopyCurrent"),
					GrooveRunTimeData.GetItem("pjIntoBaseline")
					);

				pMSApp.FileSaveAs(FilePath);
			}
        }
	}

	function ShutDownMSProjectApp(i_pMSApp)
	{
		var pMSApp;
		if(!i_pMSApp)
		{
			if(true == GrooveRunTimeData.HasItem("pMSApp"))
			{
				pMSApp = GrooveRunTimeData.GetItem("pMSApp");
				GrooveRunTimeData.RemoveItem("pMSApp");
			}
		}
		else
			pMSApp = i_pMSApp;

		if(pMSApp)
		{
			// Restore App properties
			try
			{
				if(GrooveRunTimeData.HasItem("bPromptForSummaryInfo"))
				{
					pMSApp.PromptForSummaryInfo = GrooveRunTimeData.GetItem("bPromptForSummaryInfo");
					GrooveRunTimeData.RemoveItem("bPromptForSummaryInfo");
				}
			}
			catch(e)
			{
				//
			}

			// Quit
			try
			{
				//	If we're not the only window open, don't quit
				if (pMSApp.Windows.Count == 1)
					pMSApp.Quit(GrooveRunTimeData.GetItem("pjDoNotSave"));
			}
			catch(error)
			{
				//do nothing
			}
		}
	}	

	function CacheMSProject(i_pMSProject)
	{
		var bResult = true;

		try
		{
			ReleaseMSProject();
			if(i_pMSProject)
				GrooveRunTimeData.SetItem("pMSProject", i_pMSProject);
			else
				throw "";

			var pResources = i_pMSProject.Resources;
			if(pResources)
				GrooveRunTimeData.SetItem("pMSProjectResources", i_pMSProject.Resources);

			var pProjectSummaryTask = i_pMSProject.ProjectSummaryTask;
			if(pProjectSummaryTask)
				GrooveRunTimeData.SetItem("pMSProjectSummaryTask", pProjectSummaryTask);

			var pTasks = i_pMSProject.Tasks;
			if(pTasks)
				GrooveRunTimeData.SetItem("pMSProjectTasks", pTasks);

        }
		catch(error)
		{
			ReleaseMSProject();
			bResult = false;
        }

		return bResult;
	}

	function ReleaseMSProject()
	{
		if(true == GrooveRunTimeData.HasItem("pMSProject"))
			GrooveRunTimeData.RemoveItem("pMSProject");

		if(true == GrooveRunTimeData.HasItem("pMSProjectResources"))
			GrooveRunTimeData.RemoveItem("pMSProjectResources");

		if(true == GrooveRunTimeData.HasItem("pMSProjectSummaryTask"))
			GrooveRunTimeData.RemoveItem("pMSProjectSummaryTask");

		if(true == GrooveRunTimeData.HasItem("pMSProjectTasks"))
			GrooveRunTimeData.RemoveItem("pMSProjectTasks");
	}

//-------------------------------------------------------------------
// Import
//-------------------------------------------------------------------

	// Contacts

	function ImportInContactTool()
	{
		try
		{
			var RetVal;
			var pResources = GrooveRunTimeData.GetItem("pMSProjectResources"); 
			var count = pResources.Count;
			if(count)
			{
				var pResource;

				for(var i = 0; i < count; i++)
				{
					pResource = pResources(i + 1)
					if(pResource)
					{
						var ResourceType;
						try
						{
							// This will fail for Project 98
							ResourceType = pResource.Type;
						}
						catch(e)
						{
							//
						}

						if(typeof ResourceType == "undefined" || GrooveRunTimeData.GetItem("pjResourceTypeWork") == ResourceType)
						{
							if("Success" != (RetVal = ImportContact(pResource)))
								throw RetVal;
						}

						// Update progress
						NotifySubscriber("DMD_UpdateProgress", 0);

						// Check if we want to cancel
						if(GrooveRunTimeData.HasItem("UI_Cancel") &&
							true == GrooveRunTimeData.GetItem("UI_Cancel"))
								throw "UI_Cancel"
					}
				}
			}
		}
		catch(error)
		{
			if("UI_Cancel" == error)
				return "UI_Cancel";
			else
				return "Error";
		}

		return "Success";
	}

	function ImportContact(i_pResource)
	{
		var ResourceUniqueID = i_pResource.UniqueID;
		var ContactURL;
		var pContact;
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;

		// We never import contacts which have match in Groove contacts
		ContactURL = GrooveRunTimeData.GetItem("pMSProjectPumpMap").FindMatchInGrooveContacts(i_pResource.Name);
		if("" != ContactURL)
			GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddWorkResourceIDs(ContactURL, ResourceUniqueID);
		else
		{
			if("ImportAndReconcile" == GrooveRunTimeData.GetItem("ResourceImportMode"))
			{
				try
				{
					pTransaction = pTelespace.OpenTransaction(false);

					pContact = BuildGrooveContactFromMSProjectWorkResource(i_pResource);
					ContactProvider.AddContact(pContact);

					ContactURL = pContact.OpenURL();
					GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddWorkResourceIDs(ContactURL, ResourceUniqueID);

					pTransaction.Commit();
				}
				catch(error)
				{
					if(pTransaction)
						pTransaction.Abort();

					return "Error";
				}
			}
		}

		return "Success"
	}

	// Tasks 

	function ImportInProjectTool(i_ProjectDetailsEnumCreate)
	{
		if(false == GrooveRunTimeData.HasItem("pMSProject"))
			return "Error";

		var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");
		var GrooveProjectID;

		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(false);

			var pMSProject = GrooveRunTimeData.GetItem("pMSProject");
			var pProjectSummaryTask = pMSProject.ProjectSummaryTask;

			var pGrooveProject = pTaskProvider.GetProject();
			GrooveProjectID = pGrooveProject.ID;

			//Set some project information

			// Name
			var Name = "";
			if(pProjectSummaryTask && "" != pProjectSummaryTask.Name)
				Name = pProjectSummaryTask.Name;
			else if("" != pMSProject.Name)
				Name = pMSProject.Name;

			if("" != Name)
				pGrooveProject.Name = Name;

			// Objective
			var ObjectiveText = "";
			if(pProjectSummaryTask && "" != pProjectSummaryTask.Notes)
				ObjectiveText = TrimNonVisibleStringToEmpty(pProjectSummaryTask.Notes);
			else if("" != pMSProject.ProjectNotes)
				ObjectiveText = TrimNonVisibleStringToEmpty(pMSProject.ProjectNotes);

			var pObjectiveElement = CreateNewElement("urn:groove.net:RichText");
			var pDoc = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");

			pDoc.TextContent.PlainText = ObjectiveText;
			pDoc.ComplexCellContent.WriteContentToElement(pObjectiveElement);

			pGrooveProject.Objective = pObjectiveElement;
			var ScheduledStart;

			// Start and finish
			if(pProjectSummaryTask)
			{
				ScheduledStart = MSProjectDateToGrooveDate(pProjectSummaryTask.Start);
			}
			else
			{
				ScheduledStart = MSProjectDateToGrooveDate(pMSProject.ProjectStart);
			}

			pGrooveProject.ScheduledStart = pTaskProvider.GetStartDateInWorkWeek(ScheduledStart);

			pTaskProvider.ReplaceProject(pGrooveProject, GrooveScriptFunctions.CreateNewObject(""));
			GrooveRunTimeData.GetItem("pDoubleEnumFactory").Add(GrooveProjectID);

			pTransaction.Commit();

		}
		catch(error)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		try
		{
			// pProjectSummaryTask is not included here
			var pTasks = pMSProject.Tasks;
			if(pTasks)
				ImportTasks(pTasks, 1, GrooveProjectID, i_ProjectDetailsEnumCreate);
		}
		catch(error)
		{
			if("UI_Cancel" == error)
				return "UI_Cancel";
			else
				return "Error";
		}

		return "Success";
	}

	function ImportPredecessors(i_pITaskDetailsEnum)
	{
		//Add predecessors
//		GrooveDebugFunctions.DisplayAssert(false, "");

		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);

		try
		{

			//Add predecessors
			var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");
			var pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			var pGrooveProject = pTaskProvider.GetProject();
			var pMSProjectTaskByGrooveTaskIDMap = pMSProjectPumpMap.MSProjectTaskByGrooveTaskIDMap;
			var importedGrooveTaskCount = pMSProjectTaskByGrooveTaskIDMap.GetCount();

/*// __SZ keep it here for debugging 
			var DebugCount = 0;
			var m = 20;
*/
			i_pITaskDetailsEnum.Reset();
			while(i_pITaskDetailsEnum.HasMore())
			{
/*// __SZ keep it here for debugging 
				GrooveDebugFunctions.DisplayAssert(((DebugCount++) % m), "");
*/
				var pICurrentTaskDetailsObject = i_pITaskDetailsEnum.OpenNext();
				var GrooveTaskID = pICurrentTaskDetailsObject.ID;

				// We are not adding predecessors to summary tasks
				if(true == pICurrentTaskDetailsObject.IsSummary)
					continue;

				var pMSProjectTask = pMSProjectPumpMap.GetMSProjectTaskByGrooveTaskID(GrooveTaskID);

				var pMSProjectTaskPredecessors = pMSProjectTask.PredecessorTasks;

				var count = pMSProjectTaskPredecessors.Count;
				if(count)
				{
					// GrooveDebugFunctions.DisplayAssert(false, "");

					// we loop through all MSProject predecessors, collect those of the
					// type FinishToStart and build ID enum of the corresponding Groove tasks
					var pGroovePredecessorIDEnumFactory = CreateDoubleEnum();
					var pIPredecessorNameValueEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum().NameValueEnumCreate;

					var pMSProjectTaskDependencies = pMSProjectTask.TaskDependencies;
					if("undefined" == typeof pMSProjectTaskDependencies)
						return "Success";

					var dependencyCount = pMSProjectTaskDependencies.Count;
					var j;
					for(j = 0; j < count; j++)
					{
						var pPredecessorTask = pMSProjectTaskPredecessors(j + 1);

						// does this predecessor task has correct type of dependency?
						var bCorrectType = false;
						var k;
						for(k = 0; k < dependencyCount; k++)
						{
							pMSProjectTaskDependency = pMSProjectTaskDependencies(k + 1);
							if(pMSProjectTaskDependency.From.UniqueID == pPredecessorTask.UniqueID &&
							GrooveRunTimeData.GetItem("pjFinishToStart") == pMSProjectTaskDependency.Type)
							{
								bCorrectType = true;
								break;
							}
						}

						// Find all Groove tasks generated during the import of pPredecessorTask

						if(true == bCorrectType)
						{
							var pGroovePredecessorTaskIDEnum = pMSProjectPumpMap.GetGrooveTaskIDEnumByMSProjectTaskID(pPredecessorTask.UniqueID);
							pGroovePredecessorTaskIDEnum.Reset();
							while(pGroovePredecessorTaskIDEnum.HasMore())
							{
								var GroovePredecessorTaskID = pGroovePredecessorTaskIDEnum.OpenNext();
								pIPredecessorNameValueEnum.Add("UnusedName", GroovePredecessorTaskID);
							}
						}
					}

					if(pIPredecessorNameValueEnum.NameValueEnum.HasMore())
						pICurrentTaskDetailsObject.SetPredecessorEnum(pIPredecessorNameValueEnum.NameValueEnum);
				}
			}

		}
		catch(e)
		{
			return "Error";
		}

		return "Success";
	}

	function ImportTasks(i_pTasks, i_OutlineLevel, i_GrooveParentID, i_ProjectDetailsEnumCreate)
	{
		try
		{
			var pTask;
			var count = i_pTasks.Count;
			var i;	
			for(i = 0; i < count; i++)
			{
				pTask = i_pTasks( i + 1 );
				if(pTask)
				{
					if(i_OutlineLevel == pTask.OutlineLevel)
						ImportTask(pTask, i_GrooveParentID, i_ProjectDetailsEnumCreate);
				} 
			}
		}
		catch(error)
		{
			throw error;
		}
	}

	function ImportTask(i_pTask, i_GrooveTaskParentID, i_ProjectDetailsEnumCreate)
	{
		var pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");

		if(true == pMSProjectPumpMap.HasMSProjectTaskID(i_pTask.UniqueID))
			return;

		try
		{
			var ParentID;
			var TaskName;
			var AssignedToContactURL = ""; 
			
			var pResources = i_pTask.Resources;
			var pWorkResources = new Array();

			// Count work resources
			if(pResources)
			{
				var ResourceCount = pResources.Count;

				// Get count of work resources
				var WorkResourceIndex = 0;
				var pResource;
				for(var i = 0; i < ResourceCount; i++)
				{
					pResource = pResources( i + 1 );
					if(pResource)
					{
						var ResourceType;
						try
						{
							// This will fail for Project 98
							ResourceType = pResource.Type;
						}
						catch(e)
						{
							//
						}

						if(typeof ResourceType == "undefined" || GrooveRunTimeData.GetItem("pjResourceTypeWork") == ResourceType)
						{
							pWorkResources[WorkResourceIndex] = pResource;
							WorkResourceIndex++;
						}
					} 
				}
			}

			var WorkResourceCount = pWorkResources.length;

			var ResourceUniqueID;

			switch(WorkResourceCount)
			{
				case 0:
					TaskName = i_pTask.Name;
					ParentID = i_GrooveTaskParentID;
					ImportTaskWithParameters(i_pTask, ParentID, TaskName, AssignedToContactURL, i_ProjectDetailsEnumCreate);
					break;
				case 1:
					TaskName = i_pTask.Name;
					ParentID = i_GrooveTaskParentID;
					pResource = pWorkResources[ 0 ] ;
					if(true == pMSProjectPumpMap.HasWorkResourceByMSProjectID(pResource.UniqueID))
						AssignedToContactURL = pMSProjectPumpMap.GetWorkResourceGrooveProjectID(pResource.UniqueID);

					if(!AssignedToContactURL)
						AssignedToContactURL = "";

					ImportTaskWithParameters(i_pTask, ParentID, TaskName, AssignedToContactURL, i_ProjectDetailsEnumCreate);
					break;
				default:
					ParentID = i_GrooveTaskParentID;
					if(true == i_pTask.Summary)
					{	// List all the names, don't duplicate and assign to the first name
						var pFirstResource = pWorkResources[ 0 ];
						TaskName = i_pTask.Name + "(" + pFirstResource.Name;
						for(var i = 1; i < WorkResourceCount; i++)
							TaskName += ", " + pWorkResources[ i ].Name;

						TaskName += ")";

						if(true == pMSProjectPumpMap.HasWorkResourceByMSProjectID(pFirstResource.UniqueID))
							AssignedToContactURL = pMSProjectPumpMap.GetWorkResourceGrooveProjectID(pFirstResource.UniqueID);

						if(!AssignedToContactURL)
							AssignedToContactURL = "";

						ImportTaskWithParameters(i_pTask, ParentID, TaskName, AssignedToContactURL, i_ProjectDetailsEnumCreate);
					}
					else // it's a leaf. Duplicate tasks
					{
						var pResource;
						for(var i = 0; i < WorkResourceCount; i++)
						{
							pResource = pWorkResources[ i ];
							TaskName = i_pTask.Name + "(" + pResource.Name + ")";

							if(true == pMSProjectPumpMap.HasWorkResourceByMSProjectID(pResource.UniqueID))
								AssignedToContactURL = pMSProjectPumpMap.GetWorkResourceGrooveProjectID(pResource.UniqueID);

							if(!AssignedToContactURL)
								AssignedToContactURL = "";

							ImportTaskWithParameters(i_pTask, ParentID, TaskName, AssignedToContactURL, i_ProjectDetailsEnumCreate);
						}
					}
					break;
			}

			pMSProjectPumpMap.AddMSProjectTaskID(i_pTask.UniqueID);

			if(pWorkResources)
			{
				var count = pWorkResources.length;
				for(var j = 0; j < count; j++)
					pWorkResources[ j ] = null;
			
				delete pWorkResources;
			}
		}
		catch(error)
		{
			throw error;
		}

		// Notify that we are returning from ImportTask function
		NotifySubscriber("DMD_UpdateProgress", 0);
	}

	function ImportTaskWithParameters(i_pTask, i_ParentID, i_TaskName, i_AssignedToContactURL, i_pITaskDetailsEnumCreate)
	{
//		GrooveDebugFunctions.DisplayAssert(false, "");
		try
		{
			var Status = MSTaskPercentCompleteToGrooveTaskStatus(i_pTask.PercentComplete);

			var MSTaskPriority = i_pTask.Priority;

			// Is it Project'98?
			if(MSTaskPriority < 100)
				MSTaskPriority = 100 * (MSTaskPriority + 1);

			var Priority = MSTaskPriorityToGrooveTaskPriority(MSTaskPriority);

			var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");

			var ScheduledStart = pTaskProvider.GetStartDateInWorkWeek(MSProjectDateToGrooveDate(i_pTask.Start));
			// MSProject duration is in minutes. 1 day = 8 hours = 480 min
			// Groove project duration is in milliseconds. 1 day = 24 hours = 86400000 ms
			// Duration in Groove also should be in integer number of days.
			// Fraction of a day is rounded up to one day.
			var DurationInFullDays;
			if(0 == i_pTask.Duration)
				DurationInFullDays = 0;
			else
			{
				DurationInFullDays = Math.round(i_pTask.Duration/480);
				if(0 == DurationInFullDays)
					DurationInFullDays = 1;
			}
			var ScheduledDuration = DurationInFullDays * 86400000;
			var ScheduledFinish = 0; // Currently ignored by Project tool's DMD
			var TargetFinish = 0; // Currently ignored by Project tool's DMD

			// In MS Project ActualStart = Start, if the task has started.
			// We adjust it here the way we've adjusted Start
			var ActualStart = 0;
			if(GrooveProjectToolsetStatusType_NotStarted != Status)
					ActualStart = ScheduledStart;
			
			var ActualFinish = 0;

			if(GrooveProjectToolsetStatusType_Complete == Status)
				ActualFinish = ActualStart + ScheduledDuration;

			var IsPrivate = false;

			var pDescriptionElement = CreateNewElement("urn:groove.net:RichText");
			var pDoc = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");
			var DescriptionText = TrimNonVisibleStringToEmpty(i_pTask.Notes);

			pDoc.TextContent.PlainText = DescriptionText;
			pDoc.ComplexCellContent.WriteContentToElement(pDescriptionElement);

			var ConstraintType;
			var bConstrainStartDate = true;

			ConstraintType = i_pTask.ConstraintType;
			bConstrainStartDate = (GrooveRunTimeData.GetItem("pjASAP") != ConstraintType);

			if(true == i_pTask.Summary)
			{
				var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
				var GrooveSummaryTaskID;
				try
				{

					var pITaskDetailsObject = CreateTaskDetailsObject(
								i_ParentID,
								i_TaskName,
								i_AssignedToContactURL,
								Status,
								Priority,
								ScheduledStart, //user start constraint
								bConstrainStartDate, // constraint start date
								ScheduledDuration,
								ActualStart,
								ActualFinish,
								pDescriptionElement,
								true // summary task
								);

					i_pITaskDetailsEnumCreate.Add(pITaskDetailsObject);
					GrooveSummaryTaskID = pITaskDetailsObject.ID;
					GrooveRunTimeData.GetItem("pDoubleEnumFactory").Add(GrooveSummaryTaskID);
					GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddMSProjectTaskByGrooveTaskID(GrooveSummaryTaskID, i_pTask);
				}
				catch(e)
				{
					throw e;
				}

				// Check if we want to cancel
				if(GrooveRunTimeData.HasItem("UI_Cancel"))
				{
					if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
					{
						throw "UI_Cancel"
					}
				}

				var pChildrenTasks = i_pTask.OutlineChildren;
				var OutlineLevel = i_pTask.OutlineLevel + 1;

				// Recursion !!!
				if(pChildrenTasks)
					ImportTasks(pChildrenTasks, OutlineLevel, GrooveSummaryTaskID, i_pITaskDetailsEnumCreate);
			}
			else
			{
				var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
				var GrooveTaskID;
				try
				{

					var pITaskDetailsObject = CreateTaskDetailsObject(
								i_ParentID,
								i_TaskName,
								i_AssignedToContactURL,
								Status,
								Priority,
								ScheduledStart, //user start constraint
								bConstrainStartDate, // constraint start date
								ScheduledDuration,
								ActualStart,
								ActualFinish,
								pDescriptionElement,
								false // not a summary task
								);

					i_pITaskDetailsEnumCreate.Add(pITaskDetailsObject);
					GrooveTaskID = pITaskDetailsObject.ID;
					GrooveRunTimeData.GetItem("pDoubleEnumFactory").Add(GrooveTaskID);
					GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddMSProjectTaskByGrooveTaskID(GrooveTaskID, i_pTask);
				}
				catch(e)
				{
					throw e;
				}

				// Check if we want to cancel
				if(GrooveRunTimeData.HasItem("UI_Cancel"))
				{
					if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
					{
						throw "UI_Cancel"
					}
				}
			}
		}
		catch(error)
		{
			throw error;
		}
	}

	// Takes MS Project date returns day and date in milliseconds
	// In case something goes wrong returns 0;
	function MSProjectDateToGrooveDate(i_MSProjectDate)
	{
		var Result;
		try
		{
			var Temp = new Date(i_MSProjectDate);
			Result = Temp.valueOf();
			delete Temp;

			if(true == isNaN(Result))
			{
				Temp = new Date(0);
				Result = Temp.valueOf();
				delete Temp;
			}
        }
		catch(error)
		{
			Temp = new Date(0);
			Result = Temp.valueOf();
			delete Temp;
		}

		return Result;
	}

	function MSTaskPriorityToGrooveTaskPriority(i_MSTaskPriority)
	{
		var Result;
		try
		{
			if(i_MSTaskPriority <= GrooveRunTimeData.GetItem("pjPriorityLow"))
				Result = GrooveProjectToolsetPriorityType_Low;
			else if(i_MSTaskPriority > GrooveRunTimeData.GetItem("pjPriorityLow") && i_MSTaskPriority < GrooveRunTimeData.GetItem("pjPriorityHigh"))
				Result = GrooveProjectToolsetPriorityType_Normal;
			else if(i_MSTaskPriority >= GrooveRunTimeData.GetItem("pjPriorityHigh") && i_MSTaskPriority < GrooveRunTimeData.GetItem("pjPriorityVeryHigh"))
				Result = GrooveProjectToolsetPriorityType_Important;
			else if(i_MSTaskPriority >= GrooveRunTimeData.GetItem("pjPriorityVeryHigh"))
				Result = GrooveProjectToolsetPriorityType_Critical;
			else
				Result = GrooveProjectToolsetPriorityType_Normal;
        }
		catch(error)
		{
			throw error;
		}

        return Result;
	}

	function MSTaskPercentCompleteToGrooveTaskStatus(i_MSTaskPercentComplete)
	{
		var Result;
		 
		if(0 == i_MSTaskPercentComplete)
			Result = GrooveProjectToolsetStatusType_NotStarted;
        else if(100 == i_MSTaskPercentComplete)
			Result = GrooveProjectToolsetStatusType_Complete;
        else
			Result = GrooveProjectToolsetStatusType_InProgress;

        return Result;
	}

//---------------------------------------------------------------------------------
// Export
//---------------------------------------------------------------------------------
	function ExportFromContactsTool()
	{
		var Result = "Success";
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		var pGrooveContactEnum;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			pGrooveContactEnum = ContactProvider.OpenContactEnum();

			pTransaction.EndRead();

		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		while(pGrooveContactEnum.HasMore())
		{
			var pGrooveContact = pGrooveContactEnum.OpenNext();
			Result = ExportContact(pGrooveContact);

			if("Success" == Result)
				NotifySubscriber("DMD_UpdateProgress", 0);
			else
				break;

			//Check if we don't want to cancel
			if(GrooveRunTimeData.HasItem("UI_Cancel") &&
				true == GrooveRunTimeData.GetItem("UI_Cancel"))
			{
				Result = "UI_Cancel";
				break;
			}
		}

		return Result;
	}

	function ExportContact(i_pContact)
	{
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		var ResourceUniqueID;
		var ContactURL = i_pContact.OpenURL();
		var Resource;

		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			var pResource = GrooveRunTimeData.GetItem("pMSProject").Resources.Add();

			// MSProject'98 does not have resource types
			var ResourceType;
			try
			{
				ResourceType = pResource.Type;
			}
			catch(e)
			{
				//
			}

			if(typeof ResourceType != "undefined") // Meaning it is not Project'98
				pResource.Type = GrooveRunTimeData.GetItem("pjResourceTypeWork");

			ResourceUniqueID = pResource.UniqueID;

			UpdateNamesInMSProject(i_pContact, pResource);
			UpdateTelecommunicationsInMSProject(i_pContact, pResource);

			GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddWorkResourceIDs(ContactURL, ResourceUniqueID);

			pTransaction.EndRead();
		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		return "Success";
	}

	function UpdateNamesInMSProject(i_pContact, i_pResource)
	{
		var bDirty = false;

		var FullName = OpenFullNameFromContact(i_pContact);
		if(i_pResource.Name != FullName)
		{
			i_pResource.Name = FullName;
			bDirty = true;
		}

        return bDirty;
	}

	function UpdateTelecommunicationsInMSProject(i_pContact, i_pResource)
	{
		var bDirty = false;
		var pTelecommunications = i_pContact.OpenVCard().OpenTelecommunications();
		var EmailString = BuildEmailString(pTelecommunications);

		if(EmailString != i_pResource.EmailAddress)
		{
			i_pResource.EmailAddress = EmailString;
			bDirty = true;
		}

		return bDirty;
	}

	function ExportFromProjectTool()
	{
		var bResult = true;

		if(false == GrooveRunTimeData.HasItem("pMSProject"))
			return "Error";

		var pMSProject = GrooveRunTimeData.GetItem("pMSProject");

		if(!pMSProject)
			return "Error";

		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		var pGrooveProject;
		var pMSTopParentTask;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			var pProjectSummaryTask = pMSProject.ProjectSummaryTask;
			pGrooveProject = GrooveRunTimeData.GetItem("pTaskProvider").GetProject();

			//Set some project information
			if(pProjectSummaryTask)
				pProjectSummaryTask.Name = pGrooveProject.Name;

			pMSProject.Name = pGrooveProject.Name;

			// Objective
			var pObjectiveElement = pGrooveProject.Objective;
			var pDoc = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");
			pDoc.ComplexCellContent.ReadContentFromElement(pObjectiveElement);
			var ObjectiveText = TrimNonVisibleStringToEmpty(pDoc.TextContent.PlainText);

			pMSProject.ProjectNotes = ObjectiveText;

			if(pProjectSummaryTask)
				pProjectSummaryTask.Notes = ObjectiveText;
			
			// We don't support ScheduleFromFinish currently
			pMSProject.ScheduleFromStart = true;

			// Warning: do not specify ProjectFinish, otherwise MS Project will recalculate ProjectStart.
			pMSProject.ProjectStart = GrooveDateToMSProjectDate(pGrooveProject.ScheduledStart);

			pMSTopParentTask = pMSProject;

			pTransaction.EndRead();
		}
		catch(error)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		// Check if we want to cancel
		if(GrooveRunTimeData.HasItem("UI_Cancel"))
		{
			if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
			{
				return "UI_Cancel"
			}
		}

		var RetVal = ExportTasks(pGrooveProject, pMSTopParentTask);

		if("Success" != RetVal)
		{
			if("UI_Cancel" == RetVal)
				return "UI_Cancel";
			else
				return "Error";
		}

		RetVal = ExportPredecessors(); 

		if("Success" != RetVal)
			return "Error";

		return AdjustConstraints();
	}

	function ExportPredecessors()
	{
//		GrooveDebugFunctions.DisplayAssert(false, "");
		var RetVal = "Success";
		try
		{
			var pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			var pMSProjectTaskWithGroovePredecessorsMap = pMSProjectPumpMap.GetMSProjectTaskWithGroovePredecessorsMap();
			var count = pMSProjectTaskWithGroovePredecessorsMap.GetCount();
			for(var i = 0; i < count; i++)
			{
				var pMSProjectTaskWithGroovePredecessorsEntry = pMSProjectTaskWithGroovePredecessorsMap.GetAt(i);
				var pMSProjectTaskWithGroovePredecessors = pMSProjectTaskWithGroovePredecessorsEntry.Key;
				if(pMSProjectTaskWithGroovePredecessors)
				{
					var pGroovePredecessorEnum = pMSProjectTaskWithGroovePredecessorsEntry.Value;
					if(pGroovePredecessorEnum && pGroovePredecessorEnum.HasMore())
					{
						while(pGroovePredecessorEnum.HasMore())
						{
							var pGroovePredecessorPair = pGroovePredecessorEnum.OpenNextPair();
							var GroovePredecessorID = pGroovePredecessorPair.Second;
							var pMSProjectTask = pMSProjectPumpMap.GetMSProjectTaskByGrooveTaskID(GroovePredecessorID);
							if(pMSProjectTask)
								pMSProjectTaskWithGroovePredecessors.LinkPredecessors(pMSProjectTask, GrooveRunTimeData.GetItem("pjFinishToStart"));
						}
					}
				}
			}
		}
		catch(e)
		{
			RetVal = "Error";
		}

		return RetVal;
	}

	function AdjustConstraints()
	{
//		GrooveDebugFunctions.DisplayAssert(false, "");
		var RetVal = "Success";
		try
		{
			var pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			var pMSProjectKeyTaskMap = pMSProjectPumpMap.MSProjectKeyTaskMap;
			var count = pMSProjectKeyTaskMap.GetCount();
			for(var i = 0; i < count; i++)
			{
				var pMSProjectTask = pMSProjectKeyTaskMap.GetAt(i).Key;
				pMSProjectTask.ConstraintType = GrooveRunTimeData.GetItem("pjASAP"); 
			}
		}
		catch(e)
		{
			RetVal = "Error";
		}

		return RetVal;
	}

	function ExportTasks(i_GrooveParentTask, i_MSParentTask)
	{
		var Result = "Success";
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");
			var pTaskIDEnum = pTaskProvider.GetChildIDEnum(i_GrooveParentTask.ID, 1);
			pTaskIDEnum.Reset();
			
			pTransaction.EndRead();
		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		var TaskID;
		var bResult;
		while(pTaskIDEnum.HasMore())
		{
			try
			{
				pTransaction = pTelespace.OpenTransaction(true);

				TaskID = pTaskIDEnum.OpenNext();
				var pGrooveTask = GrooveRunTimeData.GetItem("pTaskProvider").GetTask(TaskID);

				bResult = pTaskProvider.HasChildren(TaskID);

				pTransaction.EndRead();
			}
			catch(e)
			{
				if(pTransaction)
					pTransaction.Abort();

				return "Error";
			}

			// Does it have children?
			if(true == bResult)
				Result = ExportPhase(pGrooveTask, i_MSParentTask);
			else
				Result = ExportTask(pGrooveTask, i_MSParentTask);

			if("Success" != Result)
				break;
		}

		return Result;
	}

	function ExportPhase(i_pGroovePhase, i_MSParentTask)
	{
//		GrooveDebugFunctions.DisplayAssert(false, "");

		var pChildTask = i_MSParentTask.OutlineChildren.Add();

		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			UpdateMSTaskFromGrooveTask(pChildTask, i_pGroovePhase, true);

			pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			pMSProjectPumpMap.AddMSProjectTaskByGrooveTaskID(i_pGroovePhase.ID, pChildTask);

			//Save predecessor information in a map
			var pPredecessorEnum = i_pGroovePhase.OpenPredecessorEnum();
			if(pPredecessorEnum.HasMore())
				pMSProjectPumpMap.AddGroovePredecessorEnumByMSProjectTask(pChildTask, pPredecessorEnum);

			pTransaction.EndRead();
		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		NotifySubscriber("DMD_UpdateProgress", 0);

		var RequiredOutlineLevel = i_MSParentTask.OutlineLevel + 1;
		var CurrentChildTaskOutlineLevel = pChildTask.OutlineLevel;
		AdjustOutlineLevel(pChildTask, CurrentChildTaskOutlineLevel, RequiredOutlineLevel);

		//Check if we don't want to cancel
		if(GrooveRunTimeData.HasItem("UI_Cancel"))
		{
			if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
			{
				return "UI_Cancel"
			}
		}

		return ExportTasks(i_pGroovePhase, pChildTask);
    }

	function ExportTask(i_pGrooveTask, i_MSParentTask)
	{
//		GrooveDebugFunctions.DisplayAssert(false, "");

		var pChildTask = i_MSParentTask.OutlineChildren.Add();
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			UpdateMSTaskFromGrooveTask(pChildTask, i_pGrooveTask, false);

			pMSProjectPumpMap.AddMSProjectTaskByGrooveTaskID(i_pGrooveTask.ID, pChildTask);

			//Save predecessor information in a map
			var pPredecessorEnum = i_pGrooveTask.OpenPredecessorEnum();
			if(pPredecessorEnum.HasMore())
				pMSProjectPumpMap.AddGroovePredecessorEnumByMSProjectTask(pChildTask, pPredecessorEnum);

			pTransaction.EndRead();
		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		NotifySubscriber("DMD_UpdateProgress", 0);

		var RequiredOutlineLevel = i_MSParentTask.OutlineLevel + 1;
		var CurrentChildTaskOutlineLevel = pChildTask.OutlineLevel;
		AdjustOutlineLevel(pChildTask, CurrentChildTaskOutlineLevel, RequiredOutlineLevel);

		//Check if we don't want to cancel
		if(GrooveRunTimeData.HasItem("UI_Cancel"))
		{
			if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
			{
				return "UI_Cancel"
			}
		}

		return "Success";
    }

	function AdjustOutlineLevel(i_pMSTask, i_CurrentLevel, i_RequiredLevel)
	{
		if(i_RequiredLevel != i_CurrentLevel)
		{
			if(i_RequiredLevel > i_CurrentLevel)
			{
				while(i_pMSTask.OutlineLevel < i_RequiredLevel)
					i_pMSTask.OutlineIndent();
			}
			else
			{
				while(i_pMSTask.OutlineLevel > i_RequiredLevel)
					i_pMSTask.OutlineOutdent();
			} 
		}
	}

	function UpdateMSTaskFromGrooveTask(i_pMSTask, i_pGrooveTask, i_bSummaryMSTask)
	{
//		GrooveDebugFunctions.DisplayAssert(false,"");

		// Assigning MSProject task properties watch out: interdependency
		// may cause recalculation of already assigned values. Order is important.

		var bDirty = false;

		if(i_pMSTask.Name != i_pGrooveTask.Name)
		{
			bDirty = true;
			i_pMSTask.Name = i_pGrooveTask.Name;
		}

		var MSTaskPriority = GrooveTaskPriorityToMSTaskPriority(i_pGrooveTask.Priority);

		// Is it Project'98?
		if(i_pMSTask.Priority < 100)
		{
			MSTaskPriority = Math.round(MSTaskPriority/100)
			if(MSTaskPriority)
				MSTaskPriority--;
		}

		if(i_pMSTask.Priority != MSTaskPriority)
		{
			bDirty = true;
			i_pMSTask.Priority = MSTaskPriority;
		}

		// For summary tasks dates are calculated by MS Project
		if(false == i_bSummaryMSTask)
		{
			// Save this task to relieve constraint later
			if(false == i_pGrooveTask.ConstrainStartDate)
				GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddMSProjectTaskID(i_pMSTask);

			// 1. Another Project'98 thing: point zero is Sun 01/01/84 instead
			// of Wed 12/31/69
			//
			// 2. Setting of MSTask.Start
			//    sets ConstraintType to SNET
			//    we saved tasks which should be ASAP
			//    to relieve constraint later, after the 
			//    export of predecessors. It turned out 
			//    that adding predecessor to ASAP task
			//    does not spawn date adjustment in MS Project
			//
			// 3. If a task is ASAP in Groove, we don't need to set
			//    Start date but we do need to set duration.
			
			var ScheduledStart = GrooveDateToMSProjectDate(i_pGrooveTask.ScheduledStart);
			if(i_pMSTask.Start != ScheduledStart)
			{
				bDirty = true;
				i_pMSTask.Start = ScheduledStart;

				//	By default, if the tasks' start date is equal to the project
				//	start date, then MSProject won't set the constraint type (it will be ASAP).
				//	So, let's be explicit and set the property.
				if (true == i_pGrooveTask.ConstrainStartDate)
					i_pMSTask.ConstraintType = GrooveRunTimeData.GetItem("pjSNET");
			}

			// MSProject duration is in minutes. 1 day = 8 hours = 480 min
			// Groove project duration is in milliseconds. 1 day = 24 hours = 86400000 ms

			if(i_pGrooveTask.ScheduledDuration != (i_pMSTask.Duration * 180000))
			{
				bDirty = true;
				if(i_pGrooveTask.ScheduledDuration)
					i_pMSTask.Duration = Math.round(i_pGrooveTask.ScheduledDuration / 180000);
				else
					i_pMSTask.Duration = 0;
				
				// Project'98 does not have Estimated property
				var Estimated;
				try
				{
					Estimated = i_pMSTask.Estimated;
				}
				catch(e)
				{
					//
				}

				if(typeof Estimated != "undefined")
					i_pMSTask.Estimated = false;
			}

			// Percent complete should be set for non-summary tasks only
			var PercentComplete = GrooveTaskStatusToMSTaskPercentComplete(i_pGrooveTask.Status);
			if(i_pMSTask.PercentComplete != PercentComplete)
			{
				bDirty = true;
				i_pMSTask.PercentComplete = PercentComplete;
			}

		}

		var pDescriptionElement = i_pGrooveTask.Description;
		var doc = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");
		doc.ComplexCellContent.ReadContentFromElement(pDescriptionElement);
		var DescriptionText = TrimNonVisibleStringToEmpty(doc.TextContent.PlainText);

		if(i_pMSTask.Notes != DescriptionText)
		{
			bDirty = true;
			i_pMSTask.Notes = DescriptionText;
		}

		//Assignment
		if(true == GrooveRunTimeData.GetItem("pMSProjectPumpMap").HasWorkResourceByGrooveProjectID(i_pGrooveTask.AssignedToContactURL))
		{
			// Later we need to check if assignment is already made
			bDitry = true;
			var MSProjectResourceUniqueID = GrooveRunTimeData.GetItem("pMSProjectPumpMap").GetWorkResourceMSProjectID(i_pGrooveTask.AssignedToContactURL);
			var pAssignment = i_pMSTask.Assignments.Add(i_pMSTask.UniqueID, MSProjectResourceUniqueID);
        } 
		
		return bDirty; 
	}

	function GrooveTaskStatusToMSTaskPercentComplete(i_GrooveTaskStatus)
	{
		var Result;
		
		if(GrooveProjectToolsetStatusType_NotStarted == i_GrooveTaskStatus)
			Result = 0;
        else if(GrooveProjectToolsetStatusType_Complete == i_GrooveTaskStatus)
			Result = 100;
        else
			Result = 50;

        return Result;
	}

	function GrooveTaskPriorityToMSTaskPriority(i_GroovePriority)
	{
		var Result;
		try
		{
			if(GrooveProjectToolsetPriorityType_Low == i_GroovePriority)
				Result = GrooveRunTimeData.GetItem("pjPriorityLow");
            else if(GrooveProjectToolsetPriorityType_Normal == i_GroovePriority)
				Result = GrooveRunTimeData.GetItem("pjPriorityMedium");
            else if(GrooveProjectToolsetPriorityType_Important == i_GroovePriority)
				Result = GrooveRunTimeData.GetItem("pjPriorityHigh");
            else if(GrooveProjectToolsetPriorityType_Critical == i_GroovePriority)
				Result = GrooveRunTimeData.GetItem("pjPriorityVeryHigh");
			else
				Result = GrooveRunTimeData.GetItem("pjPriorityMedium");
        }
		catch(error)
		{
			throw error;
		}

        return Result;

	}


	function GrooveDateToMSProjectDate(i_GrooveDate)
	{
		var Result;

		if(i_GrooveDate)
			Result = FormatDayAndDate(i_GrooveDate, GrooveIntlDateFormatStyle_Short);
		else // return 'now' time
			Result = FormatDayAndDate(new Date.valueOf(), GrooveIntlDateFormatStyle_Short);
			
		return Result;
	}

// =======================================================================
// Helpers
// =======================================================================
	function CreateRunTimeMaps()
	{
		// ID maps
		if(GrooveRunTimeData.HasItem("pMSProjectPumpMap"))
		{
			var pMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			GrooveRunTimeData.RemoveItem("pMSProjectPumpMap");
			pMap.Clear();
			delete pMap;
			pMap = null;
		}

		var pMSProjectPumpMap = new MSProjectPumpMap();
		pMSProjectPumpMap.PopulateMapsFromGrooveContacts();
		GrooveRunTimeData.SetItem("pMSProjectPumpMap", pMSProjectPumpMap);
	}

	function ClearRunTimeMaps()
	{
		// ID maps
		if(GrooveRunTimeData.HasItem("pMSProjectPumpMap"))
		{
			var pMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			GrooveRunTimeData.RemoveItem("pMSProjectPumpMap");
			pMap.Clear();
			delete pMap;
			pMap = null;
		}
	}

	function Pause(i_Interval)
	{
		var date = new Date();
		var startTime = date.getTime();
		var currentTime = startTime;
		var currentDate;
		while(currentTime < startTime + i_Interval)
		{
			currentDate = new Date();
			currentTime = currentDate.getTime();
			delete currentDate;
		}
	}

//-------------------------------------------------------------------------------------
// NamesHelper object
//-------------------------------------------------------------------------------------

	function NamesHelper(i_FirstName, i_LastName, i_Alias, i_FullName)
	{
		var FirstName = Normalize(i_FirstName);
		var LastName = Normalize(i_LastName);
		var Alias = Normalize(i_Alias);
		var FullName = Normalize(i_FullName);

		this.NormalizedOriginalFirstName = FirstName;
		this.NomalizedOriginalLastName = LastName;
		this.NormalizedOriginalAlias = Alias;
		this.NormalizedOriginalFullName = FullName;

		if(("" == FirstName) && ("" == LastName) && ((Alias && "" != Alias) || (FullName && "" != FullName)))
		{
			// Try Alias first
			if(Alias && "" != Alias)
			{
				//Parse alias to extract first and last
				//We assume that first token is the first name, and the rest is the last name
				var TempFirstName;
				var TempLastName;

				TempLastName = Right(Alias, " ");

				//If there is a single token we consider it to be last name
				if(TempLastName == Alias)
					TempFirstName = "";
				else
					TempFirstName = Left(Alias, " ");

				if(TempFirstName && "" != TempFirstName)
					FirstName = TempFirstName;

				if(TempLastName && "" != TempLastName)
					LastName = TempLastName;
			}
			else
			{
				//Parse full name to extract first and last
				//We assume that first token is the first name, and the rest is the last name
				var TempFirstName;
				var TempLastName;

				TempLastName = Right(FullName, " ");

				//If there is a single token we consider it to be last name
				if(TempLastName == FullName)
					TempFirstName = "";
				else
					TempFirstName = Left(FullName, " ");

				if(TempFirstName && "" != TempFirstName)
					FirstName = TempFirstName;

				if(TempLastName && "" != TempLastName)
					LastName = TempLastName;
			}
		}

		this.FirstName = FirstName;
		this.LastName = LastName;
		this.LastNameFirstFullName = BuildFullName(FirstName, LastName, true);
		this.FirstNameFirstFullName = BuildFullName(FirstName, LastName, false);

	}

	// Names object helper

	function BuildFullName(i_FirstName, i_LastName, i_bLastNameFirst)
	{
		// Normalize input
		var FirstName = Normalize(i_FirstName);
		var LastName = Normalize(i_LastName);

		var FullName = "";

		if(false == i_bLastNameFirst)
			FullName = FirstName + " " + LastName;
        else
		{
			FullName = LastName;
			if("" == FullName)
				FullName = "(?)";

            FullName += ", ";

            if("" != FirstName)
				FullName += FirstName
			else
				FullName += "(?)";
		}
		
		return FullName;		 	 	 
	}

	function BuildGrooveContactFromMSProjectWorkResource(i_pResource)
	{
		var pVCard = BuildVCardFromMSProjectWorkResource(i_pResource);

		var pContactServices = GrooveScriptFunctions.CreateNewObject("Groove.ContactServices");
		var pContactFactory = pContactServices.ContactFactory;
		ContactURI = pContactFactory.CreateUniqueURL();

		var pNullObject = GrooveScriptFunctions.CreateNewObject("");
		var pContact = pContactFactory.Create
			(ContactURI, 
			pVCard,
			pNullObject,
			pNullObject,
			pNullObject,
			pNullObject,
			pNullObject,
			pNullObject,
			pNullObject,
			-1,
			false);

		return pContact;
	}

	function UpdateGrooveContactFromMSProjectWorkResource(i_pResource, i_pContact)
	{
		var pVCard = i_pContact.OpenVCard();
		return UpdateVCardFromMSProjectWorkResource(i_pResource, pVCard);
	}

	function BuildVCardFromMSProjectWorkResource(i_pResource)
	{
		var pContactServices = GrooveScriptFunctions.CreateNewObject("Groove.ContactServices");

		var pVCardFactory = pContactServices.VCardFactory;
        var pVCard = pVCardFactory.Create(GrooveScriptFunctions.CreateNewObject(""));

		UpdateVCardFromMSProjectWorkResource(i_pResource, pVCard);

		return pVCard;
	}


	function UpdateVCardFromMSProjectWorkResource(i_pResource, i_pVCard)
	{
		var bNamesDirty = UpdateNamesInGrooveProject(i_pVCard, i_pResource);
		var bEmailDirty = UpdateTelecommunicationsInGrooveProject(i_pVCard, i_pResource);

		return bNamesDirty || bEmailDirty;
	}

	function UpdateNamesInGrooveProject(i_pVCard, i_pResource)
	{
		var bDirty = false;

		var FullName = i_pResource.Name;

		var Names = new NamesHelper("", "", "", FullName);

		var FirstName = Names.FirstName;
		var LastName = Names.LastName;

		var pIdentification = i_pVCard.OpenIdentification();
		
		var pName = pIdentification.OpenName();
		var ContactFirstName = pName.OpenGiven();
		var ContactLastName = pName.OpenFamily(); 

		if(ContactFirstName != FirstName)
		{
			pName.SetGiven(FirstName);
			bDirty = true;
		}
		
		if(ContactLastName != LastName)
		{
			pName.SetFamily(LastName);
			bDirty = true;
		}

		if(true == bDirty)
		{
			pIdentification.SetName(pName);
			pIdentification.SetFullName(Names.FirstNameFirstFullName);
		}

        return bDirty;
	}

	function UpdateTelecommunicationsInGrooveProject(i_pVCard, i_pResource)
	{
		var bDirty = false;

		var pTelecommunications = i_pVCard.OpenTelecommunications();
		var EmailString = BuildEmailString(pTelecommunications);

		if(EmailString != i_pResource.EmailAddress)
		{
			SetEmails(pTelecommunications, i_pResource.EmailAddress);
			bDirty = true;
		}

		return bDirty;
	}

	function BuildEmailString(i_pTelecommunications)
	{
		// Get email info
		var pEmailEnum = i_pTelecommunications.OpenEmail();

		if(false == pEmailEnum.HasMore())
			return "";

		var pEmail;
		var EmailType;
		var EmailAddress;
		var Type;
		var Preference;
		var EmailResultString = "";

		while(pEmailEnum.HasMore())
		{
			if("" != EmailResultString)
				EmailResultString += ";";

			pEmail = pEmailEnum.OpenNext();
			EmailType = pEmail.OpenEmailType();
			EmailAddress = pEmail.OpenEmail();

            Type = ""; 

			//First find out if type is specified)
			if(EmailType & GrooveEmailType_X400)
				Type = GrooveRunTimeData.GetItem("X400");

            Preference = "";

			if(pEmailEnum.HasMore() && (EmailType & GrooveEmailType_Pref))
				Preference = GrooveRunTimeData.GetItem("pref");

			EmailResultString += EmailAddress;

			if("" != Type)
				EmailResultString += " [" + Type + "]";

			if("" != Preference)
				EmailResultString += " [" + Preference + "]";

		}

		return EmailResultString;
    }

	function SetEmails(i_pTelecommunications, i_EmailString)
	{
		// Email string may be from original MS Project - and in
		// this case it is free-style, or a result of previous export 
		// of a groove project - in this case it has format:
		// Address1 [X400][pref]; Address2;.... 
		if(!i_EmailString || "" == i_EmailString)
		return i_pTelecommunications;

		var Emails = i_EmailString.split(";")
		var i;
		var pEmail;
		var pEmailInfo;
		var EmailAddress;
		var EmailType;
		var EmailCount = Emails.length;
		for(i = 0; i < EmailCount; i++)
		{
			pEmail = GrooveScriptFunctions.CreateNewObject("Groove.Email");
			EmailAddress = "";
			EmailType = "";

			pEmailInfo = Emails[ i ].split(/\[|\]/);
			if(0 < 	pEmailInfo.length)
			{
				EmailAddress = pEmailInfo[ 0 ];
				if("" != EmailAddress)
					pEmail.SetEmail(EmailAddress);
			}

			if(1 < pEmailInfo.length)
			{
				var j;
				var Type = GrooveEmailType_None;
				for(j = 1; j < pEmailInfo.length; j++)
				{
					EmailType = pEmailInfo[ j ];
					if(EmailType == GrooveRunTimeData.GetItem("X400"))
						Type = Type | GrooveEmailType_X400;
					else if(EmailType == GrooveRunTimeData.GetItem("pref"))
						Type = Type | GrooveEmailType_Pref;
				}

				if(!(Type & GrooveEmailType_X400))
					Type = Type | GrooveEmailType_Internet;

				pEmail.SetEmailType(Type);
			}
			else
				pEmail.SetEmailType(GrooveEmailType_Internet);

			i_pTelecommunications.AddEmail(pEmail);
		}

		return i_pTelecommunications;
	}

// This function:
// Trim string and remove extra blanks between words
// Use some policy towards capitalization
// Currently: first letter of each word should be capital letter

	function Normalize(i_String)
	{
		// Validate parameter
		if(typeof i_String == "undefined" || "" == i_String)
			return "";

		// First letter of each word is turned to upper case and
		// spaces between words are reduced to 1 space

		var tempString = TrimEnds(i_String);
		var resultString = "";
		var i;
		var length = tempString.length;
		if(length)
		{
			var bInWord = false;
			var bInSpace = true;
			var j = 0;
			var char;
			for(i = 0; i < length; i++)
			{
				char = tempString.charAt(i);

				if(false == bInWord && " " != char)
				{
					char = char.toUpperCase();

					resultString += char;
					j++;

					bInWord = true;
					bInSpace = false;
				}
				else if(false == bInSpace && " " == char)
				{
					resultString += char;
					j++;
				
					bInWord = false;
					bInSpace = true;
				}
				else if(true == bInWord)
				{
					resultString += char;
					j++;
				}
			}

			//After the loop j equals to resultString length
			resultString = resultString.substr(0, j);
		}

		return resultString;
	}

	function NotifySubscriber(i_Key, i_Value)
	{
		ScriptHostComponent.FireEvent
			(
			GrooveRunTimeData.GetItem("IID_DGroovePropertyChangeListener"),
			"OnPropertyChanged",
			 i_Key, 
			 i_Value, 
			 true
			);

	}

	function CreateTaskDetailsObject
		(
			i_ParentID,
			i_Name,
			i_AssignedToContactURL,
			i_Status,
			i_Priority,
			i_UserStartConstraint,
			i_ConstrainStartDate,
			i_ScheduledDuration,
			i_ActualStart,
			i_ActualFinish,
			i_Description,
			i_IsSummary
		)
	{
		var NewID = GrooveRunTimeData.GetItem("pTaskProvider").GenerateUniqueID();
		var pIProjectItemDetailsFactory = GrooveScriptFunctions.CreateNewObject("Groove.ProjectItemDetailsFactory");
		GrooveDebugFunctions.DisplayAssert(null != pIProjectItemDetailsFactory, "Null item factory");

		var pITask = pIProjectItemDetailsFactory.CreateTaskItem
					(
						i_ParentID,
						NewID,
						-1,		// MUST always append 
						i_Name,
						i_AssignedToContactURL,
						i_Status,
						i_Priority,
						i_UserStartConstraint,
						i_ConstrainStartDate,
						0,		// ScheduledStart is calculated 
						i_ScheduledDuration,
						0,		// ScheduledFinish is calculated 
						0,		// TargetFinish is unused
						i_ActualStart,
						i_ActualFinish,
						false,	// IsPrivate is unused
						true,	// IsRead
						i_Description,
						GrooveScriptFunctions.CreateNewObject(""),	// AttachmentEnum
						i_IsSummary,
						GrooveScriptFunctions.CreateNewObject("")	// PredecessorEnum
					);

		return pITask;
	}

	function CreateTaskDetailsEnum()
	{
		var IProjectDetailsEnumGUID = "{7F8EA9AB-047C-471f-A889-454D91B77060}";
		var IProjectDetailsGUID = "{824A19D3-AA4D-4134-A51F-35C4BF3DC2BB}";

		var pIProjectDetailsEnum =  GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs
											(
												IProjectDetailsEnumGUID,
												IProjectDetailsGUID
											);

		var pIProjectDetailsEnumCreate = pIProjectDetailsEnum.UnknownEnumCreate;
		return pIProjectDetailsEnumCreate;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @             à                X
        ¯                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ê               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   1   ÄName"   M S P r o j e c t P u m p . g s l   	      ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄEVENT     ÄSCRIPTINTERFACE	     ÄSCRIPTINTERFACE
     ÄSCRIPT  EV  ÄSCRIPT       ÄSRC   h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e C a l e n d a r H e l p e r _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   \     r _  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       & V  ÄSCRIPT       ÄSRC^  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t D e l e g a t e H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       e r s i  ÄSCRIPT       ÄSRCN  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . C o n t a c t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       o n = 0  ÄSCRIPT       ÄSRCV  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t M i s c H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       & F a c  ÄEVENT       ÄLIBIDL   { 5 A A 9 1 6 C 7 - B F 1 2 - 1 1 d 3 - 8 0 A 0 - 0 0 C 0 4 F A 1 1 0 0 A }       ÄIIDL   { C 3 A 7 F C 2 2 - F A 8 B - 1 1 d 3 - 9 4 E B - 0 0 5 0 D A D 8 8 1 E 4 }       ÄDefault   1         ÄSCRIPTINTERFACE       ÄLIBIDL   { 1 9 7 E A E 0 4 - D E 8 5 - 4 7 9 a - 9 E D 6 - 9 D F 6 3 0 7 9 4 7 2 3 }       ÄIIDL   { F 0 E 2 A D E 6 - B 8 1 7 - 4 2 0 6 - B E 5 2 - C 4 1 E 4 3 3 1 9 5 6 A }        ∫ Ä

		function SetProperty(i_Key, i_Value)
		{
			if("UI_Cancel" == i_Key)
				GrooveRunTimeData.SetItem("UI_Cancel", true);
			else if("UI_ProjectDataDelegate" == i_Key)
			{
				var pTaskProvider = i_Value.IGrooveProjectTrackingDataDelegate;
				GrooveRunTimeData.SetItem("pTaskProvider", pTaskProvider);
			}
			else
				PropertyList.SetProperty(i_Key, i_Value, GroovePropertyFlag_Runtime | GroovePropertyFlag_Private);
		}

	vate);
		             å                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ∞ñ   @‡    Äy   ƒq    Å   TU   ∞ E              )            ÄSCRIPTINTERFACE       ÄLIBIDL   { 5 A A 9 1 6 C 7 - B F 1 2 - 1 1 d 3 - 8 0 A 0 - 0 0 C 0 4 F A 1 1 0 0 A }       ÄIIDL   { 8 D D 8 F F D 4 - C 7 5 D - 1 1 d 3 - 8 0 D 5 - 0 0 5 0 0 4 8 7 8 7 8 E }        ê$ Ä

		function OnPropertyChanged(i_Key, i_pValue, i_LocallyGenerated)
		{
			if(false == i_LocallyGenerated)
				return;

			if("UI_StartImport" == i_Key)
			{
	//			GrooveDebugFunctions.DisplayAssert(false, "");
				try
				{
					var Tokens = i_pValue.split(";");
					var FilePath = Tokens[ 0 ];
					var ResourceImportMode = Tokens[ 1 ];
					GrooveRunTimeData.SetItem("ResourceImportMode", ResourceImportMode);

					NotifySubscriber("DMD_SetLayoutForImport", 0); 
					NotifySubscriber("DMD_Message", "Starting Microsoft Project application...");
					NotifySubscriber("DMD_SetRange", 100);
					NotifySubscriber("DMD_StartTimerProgress", 100);

					if(false == StartImport(FilePath))
					{
						ShutDown();
						NotifySubscriber("DMD_EndTimerProgress", 0);
						NotifySubscriber("DMD_Abort", 0);
						return;
					}

					NotifySubscriber("DMD_EndTimerProgress", 0);
					NotifySubscriber("DMD_Message", "Microsoft Project application started.");
					Pause(500);

					// We need to warn user that his project is too big
					var MSProjectTaskCount = GetMSProjectTaskCount();
					if(-1 == MSProjectTaskCount)
						throw "";

					if(MSProjectTaskCount > GrooveRunTimeData.GetItem("TaskNumberThreshold"))
					{
						NotifySubscriber("DMD_BigProject", 0);
						if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
						{
							NotifySubscriber("DMD_Message", "Import cancelled.");
							ShutDown();
							NotifySubscriber("DMD_Done", 0);

							return;
						}
					}
					
					// We need to warn user if we are not importing predecessors
					var retValPredecessors = AreWeImportingPredecessors();
					if("Error" == retValPredecessors)
						throw "";

					GrooveRunTimeData.SetItem("ImportPredecessors", retValPredecessors);

					if("DontImportWarnUser" == retValPredecessors)
					{
						NotifySubscriber("DMD_NoPredecessors", 0);
						if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
						{
							NotifySubscriber("DMD_Message", "Import cancelled.");
							ShutDown();
							NotifySubscriber("DMD_Done", 0);

							return;
						}
					}

					if("ImportAndReconcile" == ResourceImportMode  || "DontImportReconcile" == ResourceImportMode)
					{
//						GrooveDebugFunctions.DisplayAssert(false, "");

						var Message = "Processing resources";
						if("DontImportReconcile" == ResourceImportMode)
							Message = "Reconciling resources";
						else if("ImportAndReconcile" == ResourceImportMode)
							Message = "Importing and reconciling resources";

						NotifySubscriber("DMD_Message", Message);
						
						var MSProjectResourceCount = GetMSProjectResourceCount();
						if(-1 == MSProjectResourceCount)
							throw "";

						NotifySubscriber("DMD_SetRange", MSProjectResourceCount);
						if(0 == MSProjectResourceCount)
							NotifySubscriber("DMD_UpdateProgress", 0);

						var Result = ImportInContactTool();

						if("Success" != Result)
						{
							ShutDown();
							NotifySubscriber("DMD_Done", 0);
							if("Error" == Result)
								NotifySubscriber("DMD_Message", "Resource processing failed.");
							else if("UI_Cancel" == Result)
								NotifySubscriber("DMD_Message", "Resource processing cancelled.");

							return;
						}

						Message = "Resources were processed successfully.";
						if("DontImportReconcile" == ResourceImportMode)
							Message = "Resources were reconciled successfully.";
						else if("ImportAndReconcile" == ResourceImportMode)
							Message = "Resources were imported and reconciled successfully.";

						NotifySubscriber("DMD_Message", Message);
						Pause(500);
					}

					// MSProjectTaskCount was computed upfront
					NotifySubscriber("DMD_SetRange", MSProjectTaskCount);

					NotifySubscriber("DMD_Message", "Importing tasks")          ;

					if(0 == MSProjectTaskCount)
						NotifySubscriber("DMD_UpdateProgress", 0);

					var pDoubleEnumFactory = CreateDoubleEnum();
					GrooveRunTimeData.SetItem("pDoubleEnumFactory", pDoubleEnumFactory);

					var pEmptyDoubleEnum = CreateDoubleEnum().DoubleEnum;
					GrooveRunTimeData.SetItem("pEmptyDoubleEnum", pEmptyDoubleEnum);

					// GrooveDebugFunctions.DisplayAssert(0, "debug");

					var pITaskDetailsEnumCreate = CreateTaskDetailsEnum();
					var Result = ImportInProjectTool(pITaskDetailsEnumCreate);
					var pITaskDetailsEnum = pITaskDetailsEnumCreate.UnknownEnum;

					NotifySubscriber("DMD_EndTaskImport", 0);
					if("Success" == Result)
					{
						Pause(500);
						NotifySubscriber("DMD_Message", "Recalculating imported task dates. Please wait.");

						var pDynamicsManager = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
						var pDelta = pDynamicsManager.CreateDelta();
						try
						{
							if("Import" == GrooveRunTimeData.GetItem("ImportPredecessors") &&
								"Success" != ImportPredecessors(pITaskDetailsEnum))
									throw "";

							pITaskDetailsEnum.Reset();
							GrooveRunTimeData.GetItem("pTaskProvider").
								AppendMultipleTasks(
									false,	/* no cycle check needed */
									pITaskDetailsEnum,
									GrooveScriptFunctions.CreateNewObject(""));
							pDelta.Commit();
						}
						catch(e)
						{
							if(pDelta)
								pDelta.Abort();

							ShutDown();

							NotifySubscriber("DMD_Message", "Task import failed.");
							NotifySubscriber("DMD_Done", 0);

							return;
						}

						NotifySubscriber("DMD_Message", "The project was imported successfully.");
					}
					else if("UI_Cancel" == Result)
					{
						NotifySubscriber("DMD_Message", "Import cancelled.");
					}
					else
					{
						NotifySubscriber("DMD_Message", "Task import failed.");
					}

					ShutDown();

					NotifySubscriber("DMD_Done", 0);

					return;
				}
				catch(e)
				{
					NotifySubscriber("DMD_Message", "Project export failed.");
					ShutDown();
					NotifySubscriber("DMD_Done", 0);
				}

				return;
			}

			// We save with Baseline always, and replace file if it 
			// exists without prompting. User was asked about his choice
			// while in FileSave dialog (see MSProjectPump.grp).

			if("UI_StartExport" == i_Key)
			{
	//				GrooveDebugFunctions.DisplayAssert(false, "");
				try
				{
					NotifySubscriber("DMD_Message", "Starting Microsoft Project application...");
					NotifySubscriber("DMD_SetRange", 100);
					NotifySubscriber("DMD_StartTimerProgress", 100);

					if(false == StartExport(i_pValue))
					{
						ShutDown();
						NotifySubscriber("DMD_EndTimerProgress", 0);
						NotifySubscriber("DMD_Abort", 0);
						return;
					}

					NotifySubscriber("DMD_EndTimerProgress", 0);
					NotifySubscriber("DMD_Message", "Microsoft Project started.");
					Pause(500);

					NotifySubscriber("DMD_Message", "Exporting contacts");

					var GrooveContactCount = GetGrooveContactCount();
					if(-1 == GrooveContactCount)
						throw "";

					NotifySubscriber("DMD_SetRange", GrooveContactCount);

					if(0 == GrooveContactCount)
						NotifySubscriber("DMD_UpdateProgress", 0);

					var Result = ExportFromContactsTool();

					if("Success" == Result)
					{
						NotifySubscriber("DMD_Message", "Contacts exported successfully.");
						Pause(500);
					}
					else if("UI_Cancel" == Result)
					{
						ShutDown();
						NotifySubscriber("DMD_Done", 0);
						NotifySubscriber("DMD_Message", "Export cancelled.");
						return;
					}
					else
					{
						ShutDown();
						NotifySubscriber("DMD_Done", 0);
						NotifySubscriber("DMD_Message", "Contact export failed.");
						return;
					}

					var GrooveTaskCount = GetGrooveTaskCount();
					if(-1 == GrooveTaskCount)
						throw "";

					NotifySubscriber("DMD_SetRange", GrooveTaskCount);

					if(0 == GrooveTaskCount)
						NotifySubscriber("DMD_UpdateProgress      `
  ", 0);

					NotifySubscriber("DMD_Message", "Exporting tasks");

					var Result = ExportFromProjectTool();

					if("Success" == Result)
					{
						NotifySubscriber("DMD_Message", "The project was exported successfully.");
					}
					else if("UI_Cancel" == Result)
					{
						ShutDown();
						NotifySubscriber("DMD_Done", 0);
						NotifySubscriber("DMD_Message", "Task export cancelled.");
						return;
					}
					else
					{
						ShutDown();
						NotifySubscriber("DMD_Done", 0);
						NotifySubscriber("DMD_Message", "Task export failed.");
						return;
					}

					NotifySubscriber("DMD_Done", 0);

					// If file exists - remove it here to prevent MSProject dialog box
					// we will never get here if file is read-only. This choice will be rejected
					// by FileSave dialog box
					var fso = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

					if(true == fso.DoesFileExist(i_pValue))
						fso.DeleteFile(i_pValue);

					SaveMSProject(i_pValue);
					ShutDown();

					return;
				}
				catch(e)
				{
					NotifySubscriber("DMD_Message", "Project export failed.");
					ShutDown();
					NotifySubscriber("DMD_Done", 0);
				}

				return;
			}

			//  Raise event for the rest of it
			NotifySubscriber(i_Key, i_pValue);
		}

		function OnPropertyRemoved(i_Key, i_LocallyGenerated)
		{
			// do nothing
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     å     ÄSCRIPT         Ä
					
		function Initialize()
		{
			GrooveRunTimeData.SetItem("TaskNumberThreshold", 250);

			// From MSProject IDL...

			GrooveRunTimeData.SetItem("pjResourceTypeWork", 0);
			GrooveRunTimeData.SetItem("pjResourceTypeMaterial", 1);

			GrooveRunTimeData.SetItem("pjPriorityDoNotLevel", 1000); 
			GrooveRunTimeData.SetItem("pjPriorityHighest", 900); 
			GrooveRunTimeData.SetItem("pjPriorityVeryHigh", 800); 
			GrooveRunTimeData.SetItem("pjPriorityHigher", 700); 
			GrooveRunTimeData.SetItem("pjPriorityHigh", 600);
			GrooveRunTimeData.SetItem("pjPriorityMedium", 500); 
			GrooveRunTimeData.SetItem("pjPriorityLow", 400);
			GrooveRunTimeData.SetItem("pjPriorityLower", 300); 
			GrooveRunTimeData.SetItem("pjPriorityVeryLow", 200); 
			GrooveRunTimeData.SetItem("pjPriorityLowest", 100); 

	/*		same constants are different in Project'98

			pjPriorityDoNotLevel = 9,
			pjPriorityHighest = 8,
			pjPriorityVeryHigh = 7,
			pjPriorityHigher = 6,
			pjPriorityHigh = 5,
			pjPriorityMedium = 4,
			pjPriorityLow = 3,
			pjPriorityLower = 2,
			pjPriorityVeryLow = 1,
			pjPriorityLowest = 0

			Groove project currently supports pjASAP and pjSNET only.

			pjASAP = 0,
			pjALAP = 1,
			pjFNET = 6,
			pjFNLT = 7,
			pjMFO = 3,
			pjMSO = 2,
			pjSNET = 4,
			pjSNLT = 5
	*/
			GrooveRunTimeData.SetItem("pjSNET", 4);
			GrooveRunTimeData.SetItem("pjASAP", 0);

			GrooveRunTimeData.SetItem("pjCopyCurrent", 0);
			GrooveRunTimeData.SetItem("pjIntoBaseline", 0);

			GrooveRunTimeData.SetItem("pjDoNotSave", 0); 
			GrooveRunTimeData.SetItem("pjSave", 1); 
			GrooveRunTimeData.SetItem("pjPromptSave", 2); 

			GrooveRunTimeData.SetItem("pjFinishToStart", 1); 

			// Email related stuff
			GrooveRunTimeData.SetItem("X400", "X400");
			GrooveRunTimeData.SetItem("pref", "pref");

			//Defaults
			GrooveRunTimeData.SetItem("IID_DGroovePropertyChangeListener", "{C3A7FC22-FA8B-11d3-94EB-0050DAD881E4}");
			GrooveRunTimeData.SetItem("IID_IGroovePropertyChangeListener", "{8DD8FFD4-C75D-11d3-80D5-00500487878E}");

			//  Indicate that we want to receive events fired by
			//  our own property list
			ScriptHostComponent.Advise
				(
				PropertyList, 
				GrooveRunTimeData.GetItem("IID_IGroovePropertyChangeListener")
				);

		}

		function Terminate()
		{
			ScriptHostComponent.Unadvise
				(
				PropertyList, 
				GrooveRunTimeData.GetItem("IID_IGroovePropertyChangeListener")
				);
		}

//--------------------------------------------------------------------------------
// Helper to determine if we are going to import predecessors
//--------------------------------------------------------------------------------
		function AreWeImportingPredecessors()
		{
			//We cannot import predecessors if it is MSProject98
			//because the type of dependency is not exposed.
			//We want to be as silent as possible, so we check if 
			//we have at least one task with predecessor.
			try
			{
				var pMSProjectTasks = GrooveRunTimeData.GetItem("pMSProjectTasks");
				var count = pMSProjectTasks.Count;
				if(count)
				{
					var i;
					for(i = 0; i < count; i++)
					{
						var pTask = pMSProjectTasks(i + 1);
						if(pTask)
						{
							var predecessorTasksCount = pTask.PredecessorTasks.Count;
							if(predecessorTasksCount)
							{
								if("undefined" == typeof pTask.TaskDependencies) // MSProject98!!!
									return "DontImportWarnUser";
								else 
									return "Import";
							}
						}
					}
				}
			}
			catch(e)
			{
				return "Error";
			}

			return "DontImport";
		}

//--------------------------------------------------------------------------------
// Trims string containing non-displayable symbols only - to empty
//--------------------------------------------------------------------------------
		function TrimNonVisibleStringToEmpty(i_InputString)
		{
/* 
			This is non-ECMA version of the same thing
			var re = /[^\b\f\n\r\t\v ]/;
			if(!ResultString.match(re))
				ResultString = "";
*/
			var ResultString = i_InputString;
			var length = ResultString.length;
			if(length)
			{
				var bNoVisibleCharacters = true;
				var theChar;
				for(i = 0; i < length; i++)
				{
					theChar = ResultString.charAt(i);

					if( theChar != '\b' && //backspace
						theChar != '\f' && //formfeed
						theChar != '\n' && //linefeed
						theChar != '\r' && //carriage return
						theChar != '\t' && //horisontaltab
						theChar != '\v' && //vertical tab
						theChar != ' '	   //blank 	
					  )
					{
						bNoVisibleCharacters = false;
						break;
					}
				}

				if(true == bNoVisibleCharacters)
					ResultString = "";
			}

			return ResultString;
		}

//--------------------------------------------------------------------------------
// Helpers to get some project statistics
//--------------------------------------------------------------------------------

		function GetMSProjectResourceCount()
		{
			// MSProject has NumberOfResources property
			// but we need to weed out material resources
			var WorkResourceCount = 0;
			try
			{
				if(true == GrooveRunTimeData.HasItem("pMSProjectResources")) 
				{
					var pResources = GrooveRunTimeData.GetItem("pMSProjectResources");
					var count = pResources.Count;
					var i;
					for(i = 0; i < count; i++)
					{
						var pResource = pResources( i + 1 );
						if(pResource) // it may be sparse array
						{
							// Project 98 does not have resource type
							var ResourceType;
							try
							{
								ResourceType = pResource.Type;
							}
							catch(e)
							{
								//
							}

							// If it fails once it will fail for all:
							if("undefined" == typeof ResourceType ||
								ResourceType == GrooveRunTimeData.GetItem("pjResourceTypeWork")) 
								WorkResourceCount++;
						}
					}
				}
			}
			catch(e)
			{
				WorkResourceCount = -1;
			}

			return WorkResourceCount;
		}

		function GetMSProjectTaskCount()
		{
			var TaskCount = 0;

			try
			{
				// Project summary task is not counted here
				if(true == GrooveRunTimeData.HasItem("pMSProjectTasks"))
				{
					var pTasks = GrooveRunTimeData.GetItem("pMSProjectTasks");

					if(pTasks)
					{
						var AllTasksCount = pTasks.Count;
						var j;
						for(j = 0; j < AllTasksCount; j++)
						{
							// It may be sparse array
							var pTask = pTasks( j + 1 );

							if(pTask)
								TaskCount++;
						}
					}
				}
			}
			catch(e)
			{
				TaskCount = -1;
			}

			return TaskCount;
		}


		function GetGrooveContactCount()
		{
			var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var pTransaction;
			var ContactCount = 0;
			try
			{
				pTransaction = pTelespace.OpenTransaction(true);

				var ContactEnum = ContactProvider.OpenContactEnum();
				while(ContactEnum.HasMore())
				{
					ContactCount++;
					ContactEnum.OpenNext();
				}

				ContactEnum.Reset();

				pTransaction.EndRead();
			}
			catch(e)
			{
				if(pTransaction)
					pTransaction.Abort();

				ContactCount = -1;
			}

			return ContactCount;
		}

		function GetGrooveTaskCount()
		{
			var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var pTransaction;
			var TaskCount =  0;
			try
			{
				pTransaction = pTelespace.OpenTransaction(true);

				var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");	
				var pGrooveProject = pTaskProvider.GetProject();
				var ProjectID = pGrooveProject.ID;

				var ChildEnum = pTaskProvider.GetChildIDEnum(ProjectID, -1);

				while(ChildEnum.HasMore())
				{
					TaskCount++;
					ChildEnum.OpenNext();
				}

				ChildEnum.Reset();

				pTransaction.EndRead();
			}
			catch(e)
			{
				if(pTransaction)
					pTransaction.Abort();

				TaskCount = -1;
			}

			return TaskCount;
		}

//---------------------------------------------------------------------
//	MSProjectPumpMap - object with a bunch of run-time data maps
//---------------------------------------------------------------------
	function MSProjectPumpMap()
	{
		this.GrooveProjectKeyWorkResourceMap = new CommonMap();

		this.MSProjectKeyWorkResourceMap = new CommonMap();
		this.MSProjectKeyTaskMap = new CommonMap();

		this.MSProjectTaskWithGroovePredecessorsMap = new CommonMap();
		this.MSProjectTaskByGrooveTaskIDMap = new CommonMap();

		this.GrooveProjectKeyGrooveNameMap = new CommonMap();

		this.HasWorkResourceByMSProjectID = raw_HasWorkResourceByMSProjectID;
		this.GetWorkResourceGrooveProjectID = raw_GetWorkResourceGrooveProjectID;
		this.HasWorkResourceByGrooveProjectID = raw_HasWorkResourceByGrooveProjectID;
		this.GetWorkResourceMSProjectID = raw_GetWorkResourceMSProjectID;
		this.AddWorkResourceIDs = raw_AddWorkResourceIDs;

		this.HasMSProjectTaskID = raw_HasMSProjectTaskID;
		this.GetGrooveTaskIDEnumByMSProjectTaskID = raw_GetGrooveTaskIDEnumByMSProjectTaskID;
		this.AddMSProjectTaskID = raw_AddMSProjectTaskID;

		this.AddGroovePredecessorEnumByMSProjectTask = raw_AddGroovePredecessorEnumByMSProjectTask;
		this.AddMSProjectTaskByGrooveTaskID = raw_AddMSProjectTaskByGrooveTaskID;
		this.GetMSProjectTaskWithGroovePredecessorsMap = raw_GetMSProjectTaskWithGroovePredecessorsMap;
		this.GetMSProjectTaskByGrooveTaskID = raw_GetMSProjectTaskByGrooveTaskID;

		this.FindMatchInGrooveContacts = raw_FindMatchInGrooveContacts;
		this.PopulateMapsFromGrooveContacts = raw_PopulateMapsFromGrooveContacts;
		this.GetGrooveNameFromContactURL =  raw_GetGrooveNameFromContactURL;

		this.Clear = raw_Clear;
    }

	function raw_HasWorkResourceByMSProjectID(i_MSProjectID)
	{
		return this.MSProjectKeyWorkResourceMap.KeyExists(i_MSProjectID);
	}

	function raw_GetWorkResourceGrooveProjectID(i_MSProjectID)
	{
		return this.MSProjectKeyWorkResourceMap.FindByKey(i_MSProjectID);
	}

	function raw_HasWorkResourceByGrooveProjectID(i_GrooveProjectID)
	{
		return this.GrooveProjectKeyWorkResourceMap.KeyExists(i_GrooveProjectID);
	}

	function raw_GetWorkResourceMSProjectID(i_GrooveProjectID)
	{
		return this.GrooveProjectKeyWorkResourceMap.FindByKey(i_GrooveProjectID);
	}

	function raw_AddWorkResourceIDs(i_GrooveProjectID, i_MSProjectID)
	{
		this.GrooveProjectKeyWorkResourceMap.Add(i_GrooveProjectID, i_MSProjectID); 
		this.MSProjectKeyWorkResourceMap.Add(i_MSProjectID, i_GrooveProjectID); 
	}

	function raw_HasMSProjectTaskID(i_MSProjectID)
	{
		return this.MSProjectKeyTaskMap.KeyExists(i_MSProjectID);
	}

	function raw_GetGrooveTaskIDEnumByMSProjectTaskID(i_MSProjectTaskID)
	{
		var pDoubleEnumFactory = CreateDoubleEnum();
		var count = this.MSProjectTaskByGrooveTaskIDMap.GetCount();
		for(var i = 0; i < count; i++)
		{
			var pData = this.MSProjectTaskByGrooveTaskIDMap.GetAt(i);
			if(pData.Value.UniqueID == i_MSProjectTaskID)
				pDoubleEnumFactory.Add(pData.Key);
		}

		return pDoubleEnumFactory.DoubleEnum;
	}

	function raw_AddMSProjectTaskID(i_MSProjectID)
	{
		this.MSProjectKeyTaskMap.Add(i_MSProjectID, ""); 
	}

	function raw_AddGroovePredecessorEnumByMSProjectTask(i_pMSProjectTask, i_pGroovePredecessorEnum)
	{
		this.MSProjectTaskWithGroovePredecessorsMap.Add(i_pMSProjectTask, i_pGroovePredecessorEnum);
	}

	function raw_AddMSProjectTaskByGrooveTaskID(i_GrooveTaskID, i_pMSProjectTask)
	{
		this.MSProjectTaskByGrooveTaskIDMap.Add(i_GrooveTaskID, i_pMSProjectTask);
	}

	function raw_GetMSProjectTaskWithGroovePredecessorsMap()
	{
		return this.MSProjectTaskWithGroovePredecessorsMap;
	}

	function raw_GetMSProjectTaskByGrooveTaskID(i_GrooveTaskID)
	{
		return this.MSProjectTaskByGrooveTaskIDMap.FindByKey(i_GrooveTaskID);
	}

	// this function loooks up matching full name in the list
	// provided by ContactProvider and returns its ContactURL 
	// or "" if there is no match. 
	function raw_FindMatchInGrooveContacts(i_FullName)
	{
		// This is a standard way of enumerating a dictionary
		var NormalizedFullName = Normalize(i_FullName);
		var RetVal = this.GrooveProjectKeyGrooveNameMap.FindByValue(NormalizedFullName);
		if(!RetVal)
			RetVal = "";

		return RetVal;
	}

	// Populates dictionary Full Names from the list of contacts
	// with ContactURL as the key  
	function raw_PopulateMapsFromGrooveContacts()
	{
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			var pContactEnum = ContactProvider.OpenContactEnum();
			pContactEnum.Reset();

			while(pContactEnum.HasMore())
			{
				var pContact = pContactEnum.OpenNext();
				var ContactURL = pContact.OpenURL();

				var FullName = OpenFullNameFromContact(pContact);
				this.GrooveProjectKeyGrooveNameMap.Add(ContactURL, FullName);	
			}

			pTransaction.EndRead();
		}
		catch(error)
		{
			if(pTransaction)
				pTransaction.Abort();
		}
	}

	function raw_GetGrooveNameFromContactURL(i_ContactURL)
	{
		var Result = this.GrooveProjectKeyGrooveNameMap.FindByKey(i_ContactURL);
		if(!RetVal)
			RetVal = "";

		return RetVal;
	}

	function raw_Clear()
	{
		ClearMapContent(this.GrooveProjectKeyWorkResourceMap);
		delete this.GrooveProjectKeyWorkResourceMap;

		ClearMapContent(this.MSProjectKeyWorkResourceMap);
		delete this.MSProjectKeyWorkResourceMap;

		ClearMapContent(this.MSProjectKeyTaskMap);
		delete this.MSProjectKeyTaskMap;

		ClearMapContent(this.MSProjectTaskWithGroovePredecessorsMap);
		delete this.MSProjectTaskWithGroovePredecessorsMap;

		ClearMapContent(this.MSProjectTaskByGrooveTaskIDMap);
		delete this.MSProjectTaskByGrooveTaskIDMap;

		ClearMapContent(this.GrooveProjectKeyGrooveNameMap);
		delete this.GrooveProjectKeyGrooveNameMap;
	}

	function ClearMapContent(i_CommonMap)
	{
		var length = i_CommonMap.length;
		var i;
		for(i = 0;  i < length; i++)
		{
			var temp = i_CommonMap.GetAt(i);
			try
			{
				if(temp)
					delete temp;
			}
			catch(e)
			{
				//
			}
		}
	}

//=============================================================================
// Startup/Shutdown
//=============================================================================

	// Launches MS Project app, caches pointers, prepare run-time map
	// which holds information about the items being imported
	function StartMSProject(i_FilePath, i_OpenExisting)
	{
		if (!i_FilePath || "" == i_FilePath)
			return false;

		//----- Set default value.
		if (null == i_OpenExisting)
			i_OpenExisting = true;
		
		var bResult = false;
		try
		{
			var pMSProject = i_OpenExisting ? OpenMSProject(i_FilePath) : CreateMSProject();
			if (pMSProject && CacheMSProject(pMSProject))
			{
				// Prepare run-time maps.
				CreateRunTimeMaps();
				GrooveRunTimeData.SetItem("UI_Cancel", false);
				bResult = true;
			}
		}
		catch(error)
		{
			ClearRunTimeMaps();
		}

		return bResult;
	}

	// Clears run-time map, shuts down MS Project application
	function ShutDown()
	{
		// This may be called in the ultimate catch block
		try
		{
			// Clear maps
			ClearRunTimeMaps();

			ReleaseMSProject();
			ShutDownMSProjectApp();

			ReleaseProviders();
		}
		catch(e)
		{
			// do nothing
		}
	}

	// Caches Task Provider interface. Also caches Task Provider tool to keep it
	// from unloading. Loading of Contacts tool is provided by ContactHelper component.
	function CacheProviders()
	{
		var bResult = true;

		// Cache tools
		try
		{
			var pTaskProvider = DHF_GetToolAndDelegateComponentForSupportedType("urn:solutions.groove.net:TaskProvider");
			if(pTaskProvider)
			{
				GrooveRunTimeData.SetItem("pTaskProvider", pTaskProvider.pIDelegate.IGrooveProjectTrackingDataDelegate);
            }
			else
				throw "";

		}
		catch(error)
		{
			ReleaseProviders();
			bResult = false;
		}

		return bResult;
	}

	function ReleaseProviders()
	{
		if(true == GrooveRunTimeData.HasItem("pTaskProvider"))
		{
			GrooveRunTimeData.SetItem("pTaskProvider", null);
			GrooveRunTimeData.RemoveItem("pTaskProvider");
		}
	}

//----------------------------------------------------------------------
// MSProject Application handling functions
//----------------------------------------------------------------------
	function LaunchMSProjectApp()
	{
		var pMSApp = null;
		if(GrooveRunTimeData.HasItem("pMSApp"))
			pMSApp = GrooveRunTimeData.GetItem("pMSApp");

		try
		{
			if (!pMSApp)
			{
				pMSApp = GrooveScriptFunctions.CreateNewObject("MSProject.Application");
				pMSApp.Visible = false;
				GrooveRunTimeData.SetItem("pMSApp", pMSApp);
			}
		}
		catch(error)
		{
			// MS project could be busy, try again
			if (-2147417846 == error.number)
			{
				pMSApp = GrooveScriptFunctions.CreateNewObject("MSProject.Application");
				pMSApp.Visible = false;
				GrooveRunTimeData.SetItem("pMSApp", pMSApp);
			}
			else
			{
				ShutDownMSProjectApp(pMSApp);
				pMSApp = null;
			}
		}

		return pMSApp;
	}

	function OpenMSProject(i_FilePath)
	{
		var pMSApp = LaunchMSProjectApp();
		var pMSProject = null;

		if (pMSApp)
		{
			try
			{
				pMSApp.FileOpen(i_FilePath);
				pMSProject = pMSApp.ActiveProject();
			}
			catch(error)
			{
				ShutDownMSProjectApp(pMSApp);
				pMSProject = null;	
			}
		}

		return pMSProject;
	}

	function CreateMSProject()
	{
		var pMSApp = LaunchMSProjectApp();
		var pMSProject = null;

		if (pMSApp)
		{
			try
			{
				// Hide it and create a new file
				pMSApp.FileNew();
				pMSProject = pMSApp.ActiveProject();

				// We don't want Prompt for Summary Info to appear
				// because it may be obscured by Groove and it appears
				// that Groove is hanging. We also want to save
				// original property value to restore it on shutdown
				GrooveRunTimeData.SetItem("bPromptForSummaryInfo", pMSApp.PromptForSummaryInfo);
				pMSApp.PromptForSummaryInfo = false;
			}
			catch(error)
			{
				ShutDownMSProjectApp(pMSApp);
				pMSProject = null;
			}
		}
		
		return pMSProject;
	}
    
	function SaveMSProject(FilePath)
	{
		if (true == GrooveRunTimeData.HasItem("pMSApp"))
		{
			var pMSApp = GrooveRunTimeData.GetItem("pMSApp");
			if (pMSApp)
			{
				pMSApp.BaselineSave(true, GrooveRunTimeData.GetItem("pjCopyCurrent"),
									GrooveRunTimeData.GetItem("pjIntoBaseline"));

				pMSApp.FileSaveAs(FilePath);
			}
        }
	}

	function ShutDownMSProjectApp(i_pMSApp)
	{
		if (!i_pMSApp)
		{
			if (true == GrooveRunTimeData.HasItem("pMSApp"))
			{
				i_pMSApp = GrooveRunTimeData.GetItem("pMSApp");
				GrooveRunTimeData.RemoveItem("pMSApp");
			}
		}
		
		if (i_pMSApp)
		{
			// Restore App properties
			try
			{
				if (GrooveRunTimeData.HasItem("bPromptForSummaryInfo"))
				{
					i_pMSApp.PromptForSummaryInfo = GrooveRunTimeData.GetItem("bPromptForSummaryInfo");
					GrooveRunTimeData.RemoveItem("bPromptForSummaryInfo");
				}
			}
			catch(e)
			{
				// do nothing
			}

			// Quit
			try
			{
				//	If we're not the only window open, don't quit
				if (i_pMSApp.Windows.Count == 1)
					i_pMSApp.Quit(GrooveRunTimeData.GetItem("pjDoNotSave"));
			}
			catch(error)
			{
				// do nothing
			}
		}
	}	

	function CacheMSProject(i_pMSProject)
	{
		var bResult = false;
		try
		{
			ReleaseMSProject();
			if (i_pMSProject)
			{
				GrooveRunTimeData.SetItem("pMSProject", i_pMSProject);

				var pResources = i_pMSProject.Resources;
				if (pResources)
					GrooveRunTimeData.SetItem("pMSProjectResources", i_pMSProject.Resources);

				var pProjectSummaryTask = i_pMSProject.ProjectSummaryTask;
				if (pProjectSummaryTask)
					GrooveRunTimeData.SetItem("pMSProjectSummaryTask", pProjectSummaryTask);

				var pTasks = i_pMSProject.Tasks;
				if (pTasks)
					GrooveRunTimeData.SetItem("pMSProjectTasks", pTasks);
			}

			bResult = true;
        }
		catch(error)
		{
			ReleaseMSProject();
        }

		return bResult;
	}

	function ReleaseMSProject()
	{
		if(true == GrooveRunTimeData.HasItem("pMSProject"))
			GrooveRunTimeData.RemoveItem("pMSProject");

		if(true == GrooveRunTimeData.HasItem("pMSProjectResources"))
			GrooveRunTimeData.RemoveItem("pMSProjectResources");

		if(true == GrooveRunTimeData.HasItem("pMSProjectSummaryTask"))
			GrooveRunTimeData.RemoveItem("pMSProjectSummaryTask");

		if(true == GrooveRunTimeData.HasItem("pMSProjectTasks"))
			GrooveRunTimeData.RemoveItem("pMSProjectTasks");
	}

//-------------------------------------------------------------------
// Import
//-------------------------------------------------------------------

	// Contacts

	function ImportInContactTool()
	{
		try
		{
			var RetVal;
			var pResources = GrooveRunTimeData.GetItem("pMSProjectResources"); 
			var count = pResources.Count;
			if(count)
			{
				var pResource;

				for(var i = 0; i < count; i++)
				{
					pResource = pResources(i + 1)
					if(pResource)
					{
						var ResourceType;
						try
						{
							// This will fail for Project 98
							ResourceType = pResource.Type;
						}
						catch(e)
						{
							//
						}

						if(typeof ResourceType == "undefined" || GrooveRunTimeData.GetItem("pjResourceTypeWork") == ResourceType)
						{
							if("Success" != (RetVal = ImportContact(pResource)))
								throw RetVal;
						}

						// Update progress
						NotifySubscriber("DMD_UpdateProgress", 0);

						// Check if we want to cancel
						if(GrooveRunTimeData.HasItem("UI_Cancel") &&
							true == GrooveRunTimeData.GetItem("UI_Cancel"))
								throw "UI_Cancel"
					}
				}
			}
		}
		catch(error)
		{
			if("UI_Cancel" == error)
				return "UI_Cancel";
			else
				return "Error";
		}

		return "Success";
	}

	function ImportContact(i_pResource)
	{
		var ResourceUniqueID = i_pResource.UniqueID;
		var ContactURL;
		var pContact;
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;

		// We never import contacts which have match in Groove contacts
		ContactURL = GrooveRunTimeData.GetItem("pMSProjectPumpMap").FindMatchInGrooveContacts(i_pResource.Name);
		if("" != ContactURL)
			GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddWorkResourceIDs(ContactURL, ResourceUniqueID);
		else
		{
			if("ImportAndReconcile" == GrooveRunTimeData.GetItem("ResourceImportMode"))
			{
				try
				{
					pTransaction = pTelespace.OpenTransaction(false);

					pContact = BuildGrooveContactFromMSProjectWorkResource(i_pResource);
					ContactProvider.AddContact(pContact);

					ContactURL = pContact.OpenURL();
					GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddWorkResourceIDs(ContactURL, ResourceUniqueID);

					pTransaction.Commit();
				}
				catch(error)
				{
					if(pTransaction)
						pTransaction.Abort();

					return "Error";
				}
			}
		}

		return "Success"
	}

	// Import all tasks into Task Manager tool.
	function ImportInProjectTool(i_ProjectDetailsEnumCreate)
	{
		if (false == GrooveRunTimeData.HasItem("pMSProject"))
			return false;

		var pMSProject = GrooveRunTimeData.GetItem("pMSProject");
		var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");
		var GrooveProjectID = null;

		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction = null;
		try
		{
			// Start transaction
			pTransaction = pTelespace.OpenTransaction(false);

			// Get project data.
			var pProjectSummaryTask = pMSProject.ProjectSummaryTask;
			var pGrooveProject = pTaskProvider.GetProject();
			GrooveProjectID = pGrooveProject.ID;

			// Set project task description
			if(pProjectSummaryTask && "" != pProjectSummaryTask.Name)
				pGrooveProject.Name = pProjectSummaryTask.Name;
			else if("" != pMSProject.Name)
				pGrooveProject.Name = pMSProject.Name;

			// Get project objective.
			var ObjectiveText = "";
			if(pProjectSummaryTask && "" != pProjectSummaryTask.Notes)
				ObjectiveText = TrimNonVisibleStringToEmpty(pProjectSummaryTask.Notes);
			else if("" != pMSProject.ProjectNotes)
				ObjectiveText = TrimNonVisibleStringToEmpty(pMSProject.ProjectNotes);

			// Set project objective as RTF element
			var pObjectiveElement = CreateNewElement("urn:groove.net:RichText");
			var pDoc = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");
			pDoc.TextContent.PlainText = ObjectiveText;
			pDoc.ComplexCellContent.WriteContentToElement(pObjectiveElement);
			pGrooveProject.Objective = pObjectiveElement;

			// Set the project start dates
			var ScheduledStart = (pProjectSummaryTask) ? MSProjectDateToGrooveDate(pProjectSummaryTask.Start)
													   : MSProjectDateToGrooveDate(pMSProject.ProjectStart);
			pGrooveProject.ScheduledStart = pTaskProvider.GetStartDateInWorkWeek(ScheduledStart);

			// Replace the project record.
			pTaskProvider.ReplaceProject(pGrooveProject, GrooveScriptFunctions.CreateNewObject(""));
			GrooveRunTimeData.GetItem("pDoubleEnumFactory").Add(GrooveProjectID);

			// End transaction.
			pTransaction.Commit();

		}
		catch(error)
		{
			if (pTransaction)
				pTransaction.Abort();

			throw error;
		}

		// pProjectSummaryTask is not included here
		if (pMSProject.Tasks && GrooveProjectID)
			ImportTasks(pMSProject.Tasks, 1, GrooveProjectID, i_ProjectDetailsEnumCreate);

		return true;
	}

	function ImportPredecessors(i_pITaskDetailsEnum)
	{
		var pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
		if (!pMSProjectPumpMap)
			return false;

		// Add predecessors
		try
		{
			// Add predecessors
			i_pITaskDetailsEnum.Reset();
			while(i_pITaskDetailsEnum.HasMore())
			{
				// Get next task.
				var pICurrentTaskDetailsObject = i_pITaskDetailsEnum.OpenNext();
				
				// Do not add predecessors to summary tasks
				if(true == pICurrentTaskDetailsObject.IsSummary)
					continue;

				var pMSProjectTask = pMSProjectPumpMap.GetMSProjectTaskByGrooveTaskID(pICurrentTaskDetailsObject.ID);
				var pMSProjectTaskPredecessors = pMSProjectTask.PredecessorTasks;
				var count = pMSProjectTaskPredecessors.Count;
				if (count)
				{
					// Loop through all MSProject predecessors, collect those of the
					// type FinishToStart and build ID enum of the corresponding Groove tasks.
					var pGroovePredecessorIDEnumFactory = CreateDoubleEnum();
					var pIPredecessorNameValueEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum().NameValueEnumCreate;

					var pMSProjectTaskDependencies = pMSProjectTask.TaskDependencies;
					if("undefined" == typeof pMSProjectTaskDependencies)
						return true;

					var dependencyCount = pMSProjectTaskDependencies.Count;
					for(var j = 1; j <= count; j++)
					{
						var pPredecessorTask = pMSProjectTaskPredecessors(j);

						// Does this predecessor task has correct type of dependency?
						var bCorrectType = false;
						for (var k = 1; k <= dependencyCount; k++)
						{
							pMSProjectTaskDependency = pMSProjectTaskDependencies(k);
							if (pMSProjectTaskDependency.From.UniqueID == pPredecessorTask.UniqueID &&
							    GrooveRunTimeData.GetItem("pjFinishToStart") == pMSProjectTaskDependency.Type)
							{
								bCorrectType = true;
								break;
							}
						}

						// Find all Groove tasks generated during the import of pPredecessorTask
						if (true == bCorrectType)
						{
							var pGroovePredecessorTaskIDEnum = pMSProjectPumpMap.GetGrooveTaskIDEnumByMSProjectTaskID(pPredecessorTask.UniqueID);
							pGroovePredecessorTaskIDEnum.Reset();
							while (pGroovePredecessorTaskIDEnum.HasMore())
								pIPredecessorNameValueEnum.Add("UnusedName", pGroovePredecessorTaskIDEnum.OpenNext());
						}
					}

					if (pIPredecessorNameValueEnum.NameValueEnum.HasMore())
						pICurrentTaskDetailsObject.SetPredecessorEnum(pIPredecessorNameValueEnum.NameValueEnum);
				}
			}

		}
		catch(e)
		{
			throw e;
		}

		return true;
	}

	function ImportTasks(i_pTasks, i_OutlineLevel, i_GrooveParentID, i_ProjectDetailsEnumCreate)
	{
		try
		{
			var count = i_pTasks.Count;
			for (var i = 1; i <= count; i++)
			{
				var pTask = i_pTasks(i);
				if (pTask && i_OutlineLevel == pTask.OutlineLevel)
					ImportTask(pTask, i_GrooveParentID, i_ProjectDetailsEnumCreate);
			}
		}
		catch(error)
		{
			throw error;
		}
	}

	function ImportTask(i_pTask, i_GrooveTaskParentID, i_ProjectDetailsEnumCreate)
	{
		var pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");

		if(true == pMSProjectPumpMap.HasMSProjectTaskID(i_pTask.UniqueID))
			return;

		try
		{
			var ParentID;
			var TaskName;
			var AssignedToContactURL = ""; 
			
			var pResources = i_pTask.Resources;
			var pWorkResources = new Array();

			// Count work resources
			if(pResources)
			{
				var ResourceCount = pResources.Count;

				// Get count of work resources
				var WorkResourceIndex = 0;
				var pResource;
				for(var i = 0; i < ResourceCount; i++)
				{
					pResource = pResources( i + 1 );
					if(pResource)
					{
						var ResourceType;
						try
						{
							// This will fail for Project 98
							ResourceType = pResource.Type;
						}
						catch(e)
						{
							//
						}

						if(typeof ResourceType == "undefined" || GrooveRunTimeData.GetItem("pjResourceTypeWork") == ResourceType)
						{
							pWorkResources[WorkResourceIndex] = pResource;
							WorkResourceIndex++;
						}
					} 
				}
			}

			var WorkResourceCount = pWorkResources.length;

			var ResourceUniqueID;

			switch(WorkResourceCount)
			{
				case 0:
					TaskName = i_pTask.Name;
					ParentID = i_GrooveTaskParentID;
					ImportTaskWithParameters(i_pTask, ParentID, TaskName, AssignedToContactURL, i_ProjectDetailsEnumCreate);
					break;
				case 1:
					TaskName = i_pTask.Name;
					ParentID = i_GrooveTaskParentID;
					pResource = pWorkResources[ 0 ] ;
					if(true == pMSProjectPumpMap.HasWorkResourceByMSProjectID(pResource.UniqueID))
						AssignedToContactURL = pMSProjectPumpMap.GetWorkResourceGrooveProjectID(pResource.UniqueID);

					if(!AssignedToContactURL)
						AssignedToContactURL = "";

					ImportTaskWithParameters(i_pTask, ParentID, TaskName, AssignedToContactURL, i_ProjectDetailsEnumCreate);
					break;
				default:
					ParentID = i_GrooveTaskParentID;
					if(true == i_pTask.Summary)
					{	// List all the names, don't duplicate and assign to the first name
						var pFirstResource = pWorkResources[ 0 ];
						TaskName = i_pTask.Name + "(" + pFirstResource.Name;
						for(var i = 1; i < WorkResourceCount; i++)
							TaskName += ", " + pWorkResources[ i ].Name;

						TaskName += ")";

						if(true == pMSProjectPumpMap.HasWorkResourceByMSProjectID(pFirstResource.UniqueID))
							AssignedToContactURL = pMSProjectPumpMap.GetWorkResourceGrooveProjectID(pFirstResource.UniqueID);

						if(!AssignedToContactURL)
							AssignedToContactURL = "";

						ImportTaskWithParameters(i_pTask, ParentID, TaskName, AssignedToContactURL, i_ProjectDetailsEnumCreate);
					}
					else // it's a leaf. Duplicate tasks
					{
						var pResource;
						for(var i = 0; i < WorkResourceCount; i++)
						{
							pResource = pWorkResources[ i ];
							TaskName = i_pTask.Name + "(" + pResource.Name + ")";

							if(true == pMSProjectPumpMap.HasWorkResourceByMSProjectID(pResource.UniqueID))
								AssignedToContactURL = pMSProjectPumpMap.GetWorkResourceGrooveProjectID(pResource.UniqueID);

							if(!AssignedToContactURL)
								AssignedToContactURL = "";

							ImportTaskWithParameters(i_pTask, ParentID, TaskName, AssignedToContactURL, i_ProjectDetailsEnumCreate);
						}
					}
					break;
			}

			pMSProjectPumpMap.AddMSProjectTaskID(i_pTask.UniqueID);

			if(pWorkResources)
			{
				var count = pWorkResources.length;
				for(var j = 0; j < count; j++)
					pWorkResources[ j ] = null;
			
				delete pWorkResources;
			}
		}
		catch(error)
		{
			throw error;
		}

		// Notify that we are returning from ImportTask function
		NotifySubscriber("DMD_UpdateProgress", 0);
	}

	function ImportTaskWithParameters(i_pTask, i_ParentID, i_TaskName, i_AssignedToContactURL, i_pITaskDetailsEnumCreate)
	{
		try
		{
			// Get status
			var Status = MSTaskPercentCompleteToGrooveTaskStatus(i_pTask.PercentComplete);

			// Get priority, special handling for Project 98
			var MSTaskPriority = (i_pTask.Priority < 100) ? (100 * (i_pTask.Priority + 1)) : i_pTask.Priority;
			var Priority = MSTaskPriorityToGrooveTaskPriority(MSTaskPriority);

			//
			var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");

			// Get Start date
			var ScheduledStart = pTaskProvider.GetStartDateInWorkWeek(MSProjectDateToGrooveDate(i_pTask.Start));


			// MSProject duration is in minutes. 1 day = 8 hours = 480 min
			// Groove project duration is in milliseconds. 1 day = 24 hours = 86400000 ms
			// Duration in Groove also should be in integer number of days.
			// Fraction of a day is rounded up to one day.
			var DurationInFullDays;
			if(0 == i_pTask.Duration)
				DurationInFullDays = 0;
			else
			{
				DurationInFullDays = Math.round(i_pTask.Duration/480);
				if(0 == DurationInFullDays)
					DurationInFullDays = 1;
			}
			var ScheduledDuration = DurationInFullDays * 86400000;
			var ScheduledFinish = 0; // Currently ignored by Project tool's DMD

			// In MS Project ActualStart = Start, if the task has started.
			// We adjust it here the way we've adjusted Start
			var ActualStart = 0;
			if(GrooveProjectToolsetStatusType_NotStarted != Status)
					ActualStart = ScheduledStart;
			
			// Get actual finish date
			var ActualFinish = (GrooveProjectToolsetStatusType_Complete == Status)
							 ? (ActualStart + ScheduledDuration) : 0;

			// Get description
			var pDescriptionElement = CreateNewElement("urn:groove.net:RichText");
			var pDoc = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");
			var DescriptionText = TrimNonVisibleStringToEmpty(i_pTask.Notes);
			pDoc.TextContent.PlainText = DescriptionText;
			pDoc.ComplexCellContent.WriteContentToElement(pDescriptionElement);

			// Do we have a constraint date.
			var ConstraintType = i_pTask.ConstraintType;
			var bConstrainStartDate = (GrooveRunTimeData.GetItem("pjASAP") != ConstraintType);

			// What is the constraint date?
			// Groove project currently supports pjASAP and pjSNET only.
			var ConstraintStartDate = ScheduledStart;
			if (GrooveRunTimeData.GetItem("pjSNET") == ConstraintType && i_pTask.ConstraintDate != "NA" &&
			    i_pTask.ConstraintDate != "")
				ConstraintStartDate = pTaskProvider.GetStartDateInWorkWeek(MSProjectDateToGrooveDate(i_pTask.ConstraintDate));

			// Create task or summary.
			if (true == i_pTask.Summary)
			{
				var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
				var GrooveSummaryTaskID;
				try
				{

					var pITaskDetailsObject = CreateTaskDetailsObject(
								i_ParentID,
								i_TaskName,
								i_AssignedToContactURL,
								Status,
								Priority,
								ConstraintStartDate, // Constraint start date
								bConstrainStartDate, // Constraint start date flag
								ScheduledStart,		 // Start Date
								ScheduledDuration,
								ActualStart,
								ActualFinish,
								pDescriptionElement,
								true // summary task
								);

					i_pITaskDetailsEnumCreate.Add(pITaskDetailsObject);
					GrooveSummaryTaskID = pITaskDetailsObject.ID;
					GrooveRunTimeData.GetItem("pDoubleEnumFactory").Add(GrooveSummaryTaskID);
					GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddMSProjectTaskByGrooveTaskID(GrooveSummaryTaskID, i_pTask);
				}
				catch(e)
				{
					throw e;
				}

				// Check if we want to cancel
				if(GrooveRunTimeData.HasItem("UI_Cancel"))
				{
					if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
					{
						throw "UI_Cancel"
					}
				}

				var pChildrenTasks = i_pTask.OutlineChildren;
				var OutlineLevel = i_pTask.OutlineLevel + 1;

				// Recursion !!!
				if(pChildrenTasks)
					ImportTasks(pChildrenTasks, OutlineLevel, GrooveSummaryTaskID, i_pITaskDetailsEnumCreate);
			}
			else
			{
				var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
				var GrooveTaskID;
				try
				{

					var pITaskDetailsObject = CreateTaskDetailsObject(
								i_ParentID,
								i_TaskName,
								i_AssignedToContactURL,
								Status,
								Priority,
								ConstraintStartDate, // Constraint start date
								bConstrainStartDate, // Constraint start date flag
								ScheduledStart,		 // Start Date
								ScheduledDuration,
								ActualStart,
								ActualFinish,
								pDescriptionElement,
								false // not a summary task
								);

					i_pITaskDetailsEnumCreate.Add(pITaskDetailsObject);
					GrooveTaskID = pITaskDetailsObject.ID;
					GrooveRunTimeData.GetItem("pDoubleEnumFactory").Add(GrooveTaskID);
					GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddMSProjectTaskByGrooveTaskID(GrooveTaskID, i_pTask);
				}
				catch(e)
				{
					throw e;
				}

				// Check if we want to cancel
				if(GrooveRunTimeData.HasItem("UI_Cancel"))
				{
					if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
					{
						throw "UI_Cancel"
					}
				}
			}
		}
		catch(error)
		{
			throw error;
		}
	}

	// Takes MS Project date returns day and date in milliseconds
	// In case something goes wrong returns 0;
	function MSProjectDateToGrooveDate(i_MSProjectDate)
	{
		var Result;
		try
		{
			var Temp = new Date(i_MSProjectDate);
			Result = Temp.valueOf();
			delete Temp;

			if(true == isNaN(Result))
			{
				Temp = new Date(0);
				Result = Temp.valueOf();
				delete Temp;
			}
        }
		catch(error)
		{
			Temp = new Date(0);
			Result = Temp.valueOf();
			delete Temp;
		}

		return Result;
	}

	function MSTaskPriorityToGrooveTaskPriority(i_MSTaskPriority)
	{
		var Result;
		try
		{
			if(i_MSTaskPriority <= GrooveRunTimeData.GetItem("pjPriorityLow"))
				Result = GrooveProjectToolsetPriorityType_Low;
			else if(i_MSTaskPriority > GrooveRunTimeData.GetItem("pjPriorityLow") && i_MSTaskPriority < GrooveRunTimeData.GetItem("pjPriorityHigh"))
				Result = GrooveProjectToolsetPriorityType_Normal;
			else if(i_MSTaskPriority >= GrooveRunTimeData.GetItem("pjPriorityHigh") && i_MSTaskPriority < GrooveRunTimeData.GetItem("pjPriorityVeryHigh"))
				Result = GrooveProjectToolsetPriorityType_Important;
			else if(i_MSTaskPriority >= GrooveRunTimeData.GetItem("pjPriorityVeryHigh"))
				Result = GrooveProjectToolsetPriorityType_Critical;
			else
				Result = GrooveProjectToolsetPriorityType_Normal;
        }
		catch(error)
		{
			throw error;
		}

        return Result;
	}

	function MSTaskPercentCompleteToGrooveTaskStatus(i_MSTaskPercentComplete)
	{
		var Result;
		 
		if(0 == i_MSTaskPercentComplete)
			Result = GrooveProjectToolsetStatusType_NotStarted;
        else if(100 == i_MSTaskPercentComplete)
			Result = GrooveProjectToolsetStatusType_Complete;
        else
			Result = GrooveProjectToolsetStatusType_InProgress;

        return Result;
	}

//---------------------------------------------------------------------------------
// Export
//---------------------------------------------------------------------------------
	function ExportFromContactsTool()
	{
		var Result = "Success";
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		var pGrooveContactEnum;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			pGrooveContactEnum = ContactProvider.OpenContactEnum();

			pTransaction.EndRead();

		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		while(pGrooveContactEnum.HasMore())
		{
			var pGrooveContact = pGrooveContactEnum.OpenNext();
			Result = ExportContact(pGrooveContact);

			if("Success" == Result)
				NotifySubscriber("DMD_UpdateProgress", 0);
			else
				break;

			//Check if we don't want to cancel
			if(GrooveRunTimeData.HasItem("UI_Cancel") &&
				true == GrooveRunTimeData.GetItem("UI_Cancel"))
			{
				Result = "UI_Cancel";
				break;
			}
		}

		return Result;
	}

	function ExportContact(i_pContact)
	{
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		var ResourceUniqueID;
		var ContactURL = i_pContact.OpenURL();
		var Resource;

		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			var pResource = GrooveRunTimeData.GetItem("pMSProject").Resources.Add();

			// MSProject'98 does not have resource types
			var ResourceType;
			try
			{
				ResourceType = pResource.Type;
			}
			catch(e)
			{
				//
			}

			if(typeof ResourceType != "undefined") // Meaning it is not Project'98
				pResource.Type = GrooveRunTimeData.GetItem("pjResourceTypeWork");

			ResourceUniqueID = pResource.UniqueID;

			UpdateNamesInMSProject(i_pContact, pResource);
			UpdateTelecommunicationsInMSProject(i_pContact, pResource);

			GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddWorkResourceIDs(ContactURL, ResourceUniqueID);

			pTransaction.EndRead();
		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		return "Success";
	}

	function UpdateNamesInMSProject(i_pContact, i_pResource)
	{
		var bDirty = false;

		var FullName = OpenFullNameFromContact(i_pContact);
		if(i_pResource.Name != FullName)
		{
			i_pResource.Name = FullName;
			bDirty = true;
		}

        return bDirty;
	}

	function UpdateTelecommunicationsInMSProject(i_pContact, i_pResource)
	{
		var bDirty = false;
		var pTelecommunications = i_pContact.OpenVCard().OpenTelecommunications();
		var EmailString = BuildEmailString(pTelecommunications);

		if(EmailString != i_pResource.EmailAddress)
		{
			i_pResource.EmailAddress = EmailString;
			bDirty = true;
		}

		return bDirty;
	}

	function ExportFromProjectTool()
	{
		var bResult = true;

		if(false == GrooveRunTimeData.HasItem("pMSProject"))
			return "Error";

		var pMSProject = GrooveRunTimeData.GetItem("pMSProject");

		if(!pMSProject)
			return "Error";

		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		var pGrooveProject;
		var pMSTopParentTask;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			var pProjectSummaryTask = pMSProject.ProjectSummaryTask;
			pGrooveProject = GrooveRunTimeData.GetItem("pTaskProvider").GetProject();

			//Set some project information
			if(pProjectSummaryTask)
				pProjectSummaryTask.Name = pGrooveProject.Name;

			pMSProject.Name = pGrooveProject.Name;

			// Objective
			var pObjectiveElement = pGrooveProject.Objective;
			var pDoc = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");
			pDoc.ComplexCellContent.ReadContentFromElement(pObjectiveElement);
			var ObjectiveText = TrimNonVisibleStringToEmpty(pDoc.TextContent.PlainText);

			pMSProject.ProjectNotes = ObjectiveText;

			if(pProjectSummaryTask)
				pProjectSummaryTask.Notes = ObjectiveText;
			
			// We don't support ScheduleFromFinish currently
			pMSProject.ScheduleFromStart = true;

			// Warning: do not specify ProjectFinish, otherwise MS Project will recalculate ProjectStart.
			pMSProject.ProjectStart = GrooveDateToMSProjectDate(pGrooveProject.ScheduledStart);

			pMSTopParentTask = pMSProject;

			pTransaction.EndRead();
		}
		catch(error)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		// Check if we want to cancel
		if(GrooveRunTimeData.HasItem("UI_Cancel"))
		{
			if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
			{
				return "UI_Cancel"
			}
		}

		var RetVal = ExportTasks(pGrooveProject, pMSTopParentTask);

		if("Success" != RetVal)
		{
			if("UI_Cancel" == RetVal)
				return "UI_Cancel";
			else
				return "Error";
		}

		RetVal = ExportPredecessors(); 

		if("Success" != RetVal)
			return "Error";

		return AdjustConstraints();
	}

	function ExportPredecessors()
	{
		var RetVal = "Success";
		try
		{
			var pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			var pMSProjectTaskWithGroovePredecessorsMap = pMSProjectPumpMap.GetMSProjectTaskWithGroovePredecessorsMap();
			var count = pMSProjectTaskWithGroovePredecessorsMap.GetCount();
			for(var i = 0; i < count; i++)
			{
				var pMSProjectTaskWithGroovePredecessorsEntry = pMSProjectTaskWithGroovePredecessorsMap.GetAt(i);
				var pMSProjectTaskWithGroovePredecessors = pMSProjectTaskWithGroovePredecessorsEntry.Key;
				if(pMSProjectTaskWithGroovePredecessors)
				{
					var pGroovePredecessorEnum = pMSProjectTaskWithGroovePredecessorsEntry.Value;
					if(pGroovePredecessorEnum && pGroovePredecessorEnum.HasMore())
					{
						while(pGroovePredecessorEnum.HasMore())
						{
							var pGroovePredecessorPair = pGroovePredecessorEnum.OpenNextPair();
							var GroovePredecessorID = pGroovePredecessorPair.Second;
							var pMSProjectTask = pMSProjectPumpMap.GetMSProjectTaskByGrooveTaskID(GroovePredecessorID);
							if(pMSProjectTask)
								pMSProjectTaskWithGroovePredecessors.LinkPredecessors(pMSProjectTask, GrooveRunTimeData.GetItem("pjFinishToStart"));
						}
					}
				}
			}
		}
		catch(e)
		{
			RetVal = "Error";
		}

		return RetVal;
	}

	function AdjustConstraints()
	{
		var RetVal = "Success";
		try
		{
			var pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			var pMSProjectKeyTaskMap = pMSProjectPumpMap.MSProjectKeyTaskMap;
			var count = pMSProjectKeyTaskMap.GetCount();
			for(var i = 0; i < count; i++)
			{
				var pMSProjectTask = pMSProjectKeyTaskMap.GetAt(i).Key;
				pMSProjectTask.ConstraintType = GrooveRunTimeData.GetItem("pjASAP"); 
			}
		}
		catch(e)
		{
			RetVal = "Error";
		}

		return RetVal;
	}

	function ExportTasks(i_GrooveParentTask, i_MSParentTask)
	{
		var Result = "Success";
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");
			var pTaskIDEnum = pTaskProvider.GetChildIDEnum(i_GrooveParentTask.ID, 1);
			pTaskIDEnum.Reset();
			
			pTransaction.EndRead();
		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		var TaskID;
		var bResult;
		while(pTaskIDEnum.HasMore())
		{
			try
			{
				pTransaction = pTelespace.OpenTransaction(true);

				TaskID = pTaskIDEnum.OpenNext();
				var pGrooveTask = GrooveRunTimeData.GetItem("pTaskProvider").GetTask(TaskID);

				bResult = pTaskProvider.HasChildren(TaskID);

				pTransaction.EndRead();
			}
			catch(e)
			{
				if(pTransaction)
					pTransaction.Abort();

				return "Error";
			}

			// Does it have children?
			if(true == bResult)
				Result = ExportPhase(pGrooveTask, i_MSParentTask);
			else
				Result = ExportTask(pGrooveTask, i_MSParentTask);

			if("Success" != Result)
				break;
		}

		return Result;
	}

	function ExportPhase(i_pGroovePhase, i_MSParentTask)
	{
		var pChildTask = i_MSParentTask.OutlineChildren.Add();

		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			UpdateMSTaskFromGrooveTask(pChildTask, i_pGroovePhase, true);

			pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			pMSProjectPumpMap.AddMSProjectTaskByGrooveTaskID(i_pGroovePhase.ID, pChildTask);

			//Save predecessor information in a map
			var pPredecessorEnum = i_pGroovePhase.OpenPredecessorEnum();
			if(pPredecessorEnum.HasMore())
				pMSProjectPumpMap.AddGroovePredecessorEnumByMSProjectTask(pChildTask, pPredecessorEnum);

			pTransaction.EndRead();
		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		NotifySubscriber("DMD_UpdateProgress", 0);

		var RequiredOutlineLevel = i_MSParentTask.OutlineLevel + 1;
		var CurrentChildTaskOutlineLevel = pChildTask.OutlineLevel;
		AdjustOutlineLevel(pChildTask, CurrentChildTaskOutlineLevel, RequiredOutlineLevel);

		//Check if we don't want to cancel
		if(GrooveRunTimeData.HasItem("UI_Cancel"))
		{
			if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
			{
				return "UI_Cancel"
			}
		}

		return ExportTasks(i_pGroovePhase, pChildTask);
    }

	function ExportTask(i_pGrooveTask, i_MSParentTask)
	{
		var pChildTask = i_MSParentTask.OutlineChildren.Add();
		var pTelespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var pTransaction;
		try
		{
			pTransaction = pTelespace.OpenTransaction(true);

			pMSProjectPumpMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			UpdateMSTaskFromGrooveTask(pChildTask, i_pGrooveTask, false);

			pMSProjectPumpMap.AddMSProjectTaskByGrooveTaskID(i_pGrooveTask.ID, pChildTask);

			//Save predecessor information in a map
			var pPredecessorEnum = i_pGrooveTask.OpenPredecessorEnum();
			if(pPredecessorEnum.HasMore())
				pMSProjectPumpMap.AddGroovePredecessorEnumByMSProjectTask(pChildTask, pPredecessorEnum);

			pTransaction.EndRead();
		}
		catch(e)
		{
			if(pTransaction)
				pTransaction.Abort();

			return "Error";
		}

		NotifySubscriber("DMD_UpdateProgress", 0);

		var RequiredOutlineLevel = i_MSParentTask.OutlineLevel + 1;
		var CurrentChildTaskOutlineLevel = pChildTask.OutlineLevel;
		AdjustOutlineLevel(pChildTask, CurrentChildTaskOutlineLevel, RequiredOutlineLevel);

		//Check if we don't want to cancel
		if(GrooveRunTimeData.HasItem("UI_Cancel"))
		{
			if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
			{
				return "UI_Cancel"
			}
		}

		return "Success";
    }

	function AdjustOutlineLevel(i_pMSTask, i_CurrentLevel, i_RequiredLevel)
	{
		if(i_RequiredLevel != i_CurrentLevel)
		{
			if(i_RequiredLevel > i_CurrentLevel)
			{
				while(i_pMSTask.OutlineLevel < i_RequiredLevel)
					i_pMSTask.OutlineIndent();
			}
			else
			{
				while(i_pMSTask.OutlineLevel > i_RequiredLevel)
					i_pMSTask.OutlineOutdent();
			} 
		}
	}

	function UpdateMSTaskFromGrooveTask(i_pMSTask, i_pGrooveTask, i_bSummaryMSTask)
	{
		// Assigning MSProject task properties watch out: interdependency
		// may cause recalculation of already assigned values. Order is important.

		var bDirty = false;

		if(i_pMSTask.Name != i_pGrooveTask.Name)
		{
			bDirty = true;
			i_pMSTask.Name = i_pGrooveTask.Name;
		}

		var MSTaskPriority = GrooveTaskPriorityToMSTaskPriority(i_pGrooveTask.Priority);

		// Is it Project'98?
		if(i_pMSTask.Priority < 100)
		{
			MSTaskPriority = Math.round(MSTaskPriority/100)
			if(MSTaskPriority)
				MSTaskPriority--;
		}

		if(i_pMSTask.Priority != MSTaskPriority)
		{
			bDirty = true;
			i_pMSTask.Priority = MSTaskPriority;
		}

		// For summary tasks dates are calculated by MS Project
		if(false == i_bSummaryMSTask)
		{
			// Save this task to relieve constraint later
			if(false == i_pGrooveTask.ConstrainStartDate)
				GrooveRunTimeData.GetItem("pMSProjectPumpMap").AddMSProjectTaskID(i_pMSTask);

			// 1. Another Project'98 thing: point zero is Sun 01/01/84 instead
			// of Wed 12/31/69
			//
			// 2. Setting of MSTask.Start
			//    sets ConstraintType to SNET
			//    we saved tasks which should be ASAP
			//    to relieve constraint later, after the 
			//    export of predecessors. It turned out 
			//    that adding predecessor to ASAP task
			//    does not spawn date adjustment in MS Project
			//
			// 3. If a task is ASAP in Groove, we don't need to set
			//    Start date but we do need to set duration.
			
			var ScheduledStart = GrooveDateToMSProjectDate(i_pGrooveTask.ScheduledStart);
			if(i_pMSTask.Start != ScheduledStart)
			{
				bDirty = true;
				i_pMSTask.Start = ScheduledStart;

				//	By default, if the tasks' start date is equal to the project
				//	start date, then MSProject won't set the constraint type (it will be ASAP).
				//	So, let's be explicit and set the property.
				if (true == i_pGrooveTask.ConstrainStartDate)
					i_pMSTask.ConstraintType = GrooveRunTimeData.GetItem("pjSNET");
			}

			// MSProject duration is in minutes. 1 day = 8 hours = 480 min
			// Groove project duration is in milliseconds. 1 day = 24 hours = 86400000 ms

			if(i_pGrooveTask.ScheduledDuration != (i_pMSTask.Duration * 180000))
			{
				bDirty = true;
				if(i_pGrooveTask.ScheduledDuration)
					i_pMSTask.Duration = Math.round(i_pGrooveTask.ScheduledDuration / 180000);
				else
					i_pMSTask.Duration = 0;
				
				// Project'98 does not have Estimated property
				var Estimated;
				try
				{
					Estimated = i_pMSTask.Estimated;
				}
				catch(e)
				{
					//
				}

				if(typeof Estimated != "undefined")
					i_pMSTask.Estimated = false;
			}

			// Percent complete should be set for non-summary tasks only
			var PercentComplete = GrooveTaskStatusToMSTaskPercentComplete(i_pGrooveTask.Status);
			if(i_pMSTask.PercentComplete != PercentComplete)
			{
				bDirty = true;
				i_pMSTask.PercentComplete = PercentComplete;
			}

		}

		var pDescriptionElement = i_pGrooveTask.Description;
		var doc = GrooveScriptFunctions.CreateNewObject("Groove.TextDocument");
		doc.ComplexCellContent.ReadContentFromElement(pDescriptionElement);
		var DescriptionText = TrimNonVisibleStringToEmpty(doc.TextContent.PlainText);

		if(i_pMSTask.Notes != DescriptionText)
		{
			bDirty = true;
			i_pMSTask.Notes = DescriptionText;
		}

		//Assignment
		if(true == GrooveRunTimeData.GetItem("pMSProjectPumpMap").HasWorkResourceByGrooveProjectID(i_pGrooveTask.AssignedToContactURL))
		{
			// Later we need to check if assignment is already made
			bDitry = true;
			var MSProjectResourceUniqueID = GrooveRunTimeData.GetItem("pMSProjectPumpMap").GetWorkResourceMSProjectID(i_pGrooveTask.AssignedToContactURL);
			var pAssignment = i_pMSTask.Assignments.Add(i_pMSTask.UniqueID, MSProjectResourceUniqueID);
        } 
		
		return bDirty; 
	}

	function GrooveTaskStatusToMSTaskPercentComplete(i_GrooveTaskStatus)
	{
		var Result;
		
		if(GrooveProjectToolsetStatusType_NotStarted == i_GrooveTaskStatus)
			Result = 0;
        else if(GrooveProjectToolsetStatusType_Complete == i_GrooveTaskStatus)
			Result = 100;
        else
			Result = 50;

        return Result;
	}

	function GrooveTaskPriorityToMSTaskPriority(i_GroovePriority)
	{
		var Result;
		try
		{
			if(GrooveProjectToolsetPriorityType_Low == i_GroovePriority)
				Result = GrooveRunTimeData.GetItem("pjPriorityLow");
            else if(GrooveProjectToolsetPriorityType_Normal == i_GroovePriority)
				Result = GrooveRunTimeData.GetItem("pjPriorityMedium");
            else if(GrooveProjectToolsetPriorityType_Important == i_GroovePriority)
				Result = GrooveRunTimeData.GetItem("pjPriorityHigh");
            else if(GrooveProjectToolsetPriorityType_Critical == i_GroovePriority)
				Result = GrooveRunTimeData.GetItem("pjPriorityVeryHigh");
			else
				Result = GrooveRunTimeData.GetItem("pjPriorityMedium");
        }
		catch(error)
		{
			throw error;
		}

        return Result;

	}


	function GrooveDateToMSProjectDate(i_GrooveDate)
	{
		if(i_GrooveDate)
			return FormatDayAndDate(i_GrooveDate, GrooveIntlDateFormatStyle_Short);
		else // return 'now' time
			return FormatDayAndDate(new Date.valueOf(), GrooveIntlDateFormatStyle_Short);
	}

// =======================================================================
// Helpers
// =======================================================================
	function CreateRunTimeMaps()
	{
		// ID maps
		if(GrooveRunTimeData.HasItem("pMSProjectPumpMap"))
		{
			var pMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			GrooveRunTimeData.RemoveItem("pMSProjectPumpMap");
			pMap.Clear();
			delete pMap;
			pMap = null;
		}

		var pMSProjectPumpMap = new MSProjectPumpMap();
		pMSProjectPumpMap.PopulateMapsFromGrooveContacts();
		GrooveRunTimeData.SetItem("pMSProjectPumpMap", pMSProjectPumpMap);
	}

	function ClearRunTimeMaps()
	{
		// ID maps
		if(GrooveRunTimeData.HasItem("pMSProjectPumpMap"))
		{
			var pMap = GrooveRunTimeData.GetItem("pMSProjectPumpMap");
			GrooveRunTimeData.RemoveItem("pMSProjectPumpMap");
			pMap.Clear();
			delete pMap;
			pMap = null;
		}
	}

	function Pause(i_Interval)
	{
		var date = new Date();
		var startTime = date.getTime();
		var currentTime = startTime;
		var currentDate;
		while(currentTime < startTime + i_Interval)
		{
			currentDate = new Date();
			currentTime = currentDate.getTime();
			delete currentDate;
		}
	}

//-------------------------------------------------------------------------------------
// NamesHelper object
//-------------------------------------------------------------------------------------

	function NamesHelper(i_FirstName, i_LastName, i_Alias, i_FullName)
	{
		var FirstName = Normalize(i_FirstName);
		var LastName = Normalize(i_LastName);
		var Alias = Normalize(i_Alias);
		var FullName = Normalize(i_FullName);

		this.NormalizedOriginalFirstName = FirstName;
		this.NomalizedOriginalLastName = LastName;
		this.NormalizedOriginalAlias = Alias;
		this.NormalizedOriginalFullName = FullName;

		if(("" == FirstName) && ("" == LastName) && ((Alias && "" != Alias) || (FullName && "" != FullName)))
		{
			// Try Alias first
			if(Alias && "" != Alias)
			{
				// Parse alias to extract first and last
				// We assume that first token is the first name, and the rest is the last name
				var TempFirstName;
				var TempLastName;

				TempLastName = Right(Alias, " ");

				// If there is a single token we consider it to be last name
				if(TempLastName == Alias)
					TempFirstName = "";
				else
					TempFirstName = Left(Alias, " ");

				if(TempFirstName && "" != TempFirstName)
					FirstName = TempFirstName;

				if(TempLastName && "" != TempLastName)
					LastName = TempLastName;
			}
			else
			{
				// Parse full name to extract first and last
				// We assume that first token is the first name, and the rest is the last name
				var TempFirstName;
				var TempLastName;

				TempLastName = Right(FullName, " ");

				//If there is a single token we consider it to be last name
				if(TempLastName == FullName)
					TempFirstName = "";
				else
					TempFirstName = Left(FullName, " ");

				if(TempFirstName && "" != TempFirstName)
					FirstName = TempFirstName;

				if(TempLastName && "" != TempLastName)
					LastName = TempLastName;
			}
		}

		this.FirstName = FirstName;
		this.LastName = LastName;
		this.LastNameFirstFullName = BuildFullName(FirstName, LastName, true);
		this.FirstNameFirstFullName = BuildFullName(FirstName, LastName, false);

	}

	// Names object helper

	function BuildFullName(i_FirstName, i_LastName, i_bLastNameFirst)
	{
		// Normalize input
		var FirstName = Normalize(i_FirstName);
		var LastName = Normalize(i_LastName);

		var FullName = "";

		if(false == i_bLastNameFirst)
			FullName = FirstName + " " + LastName;
        else
		{
			FullName = LastName;
			if("" == FullName)
				FullName = "(?)";

            FullName += ", ";

            if("" != FirstName)
				FullName += FirstName
			else
				FullName += "(?)";
		}
		
		return FullName;		 	 	 
	}

	function BuildGrooveContactFromMSProjectWorkResource(i_pResource)
	{
		var pVCard = BuildVCardFromMSProjectWorkResource(i_pResource);

		var pContactServices = GrooveScriptFunctions.CreateNewObject("Groove.ContactServices");
		var pContactFactory = pContactServices.ContactFactory;
		ContactURI = pContactFactory.CreateUniqueURL();

		var pNullObject = GrooveScriptFunctions.CreateNewObject("");
		var pContact = pContactFactory.Create
			(ContactURI, 
			pVCard,
			pNullObject,
			pNullObject,
			pNullObject,
			pNullObject,
			pNullObject,
			pNullObject,
			pNullObject,
			-1,
			false);

		return pContact;
	}

	function UpdateGrooveContactFromMSProjectWorkResource(i_pResource, i_pContact)
	{
		var pVCard = i_pContact.OpenVCard();
		return UpdateVCardFromMSProjectWorkResource(i_pResource, pVCard);
	}

	function BuildVCardFromMSProjectWorkResource(i_pResource)
	{
		var pContactServices = GrooveScriptFunctions.CreateNewObject("Groove.ContactServices");

		var pVCardFactory = pContactServices.VCardFactory;
        var pVCard = pVCardFactory.Create(GrooveScriptFunctions.CreateNewObject(""));

		UpdateVCardFromMSProjectWorkResource(i_pResource, pVCard);

		return pVCard;
	}


	function UpdateVCardFromMSProjectWorkResource(i_pResource, i_pVCard)
	{
		var bNamesDirty = UpdateNamesInGrooveProject(i_pVCard, i_pResource);
		var bEmailDirty = UpdateTelecommunicationsInGrooveProject(i_pVCard, i_pResource);

		return bNamesDirty || bEmailDirty;
	}

	function UpdateNamesInGrooveProject(i_pVCard, i_pResource)
	{
		var bDirty = false;

		var FullName = i_pResource.Name;

		var Names = new NamesHelper("", "", "", FullName);

		var FirstName = Names.FirstName;
		var LastName = Names.LastName;

		var pIdentification = i_pVCard.OpenIdentification();
		
		var pName = pIdentification.OpenName();
		var ContactFirstName = pName.OpenGiven();
		var ContactLastName = pName.OpenFamily(); 

		if(ContactFirstName != FirstName)
		{
			pName.SetGiven(FirstName);
			bDirty = true;
		}
		
		if(ContactLastName != LastName)
		{
			pName.SetFamily(LastName);
			bDirty = true;
		}

		if(true == bDirty)
		{
			pIdentification.SetName(pName);
			pIdentification.SetFullName(Names.FirstNameFirstFullName);
		}

        return bDirty;
	}

	function UpdateTelecommunicationsInGrooveProject(i_pVCard, i_pResource)
	{
		var bDirty = false;

		var pTelecommunications = i_pVCard.OpenTelecommunications();
		var EmailString = BuildEmailString(pTelecommunications);

		if(EmailString != i_pResource.EmailAddress)
		{
			SetEmails(pTelecommunications, i_pResource.EmailAddress);
			bDirty = true;
		}

		return bDirty;
	}

	function BuildEmailString(i_pTelecommunications)
	{
		// Get email info
		var pEmailEnum = i_pTelecommunications.OpenEmail();

		if(false == pEmailEnum.HasMore())
			return "";

		var pEmail;
		var EmailType;
		var EmailAddress;
		var Type;
		var Preference;
		var EmailResultString = "";

		while(pEmailEnum.HasMore())
		{
			if("" != EmailResultString)
				EmailResultString += ";";

			pEmail = pEmailEnum.OpenNext();
			EmailType = pEmail.OpenEmailType();
			EmailAddress = pEmail.OpenEmail();

            Type = ""; 

			//First find out if type is specified)
			if(EmailType & GrooveEmailType_X400)
				Type = GrooveRunTimeData.GetItem("X400");

            Preference = "";

			if(pEmailEnum.HasMore() && (EmailType & GrooveEmailType_Pref))
				Preference = GrooveRunTimeData.GetItem("pref");

			EmailResultString += EmailAddress;

			if("" != Type)
				EmailResultString += " [" + Type + "]";

			if("" != Preference)
				EmailResultString += " [" + Preference + "]";

		}

		return EmailResultString;
    }

	function SetEmails(i_pTelecommunications, i_EmailString)
	{
		// Email string may be from original MS Project - and in
		// this case it is free-style, or a result of previous export 
		// of a groove project - in this case it has format:
		// Address1 [X400][pref]; Address2;.... 
		if(!i_EmailString || "" == i_EmailString)
		return i_pTelecommunications;

		var Emails = i_EmailString.split(";")
		var i;
		var pEmail;
		var pEmailInfo;
		var EmailAddress;
		var EmailType;
		var EmailCount = Emails.length;
		for(i = 0; i < EmailCount; i++)
		{
			pEmail = GrooveScriptFunctions.CreateNewObject("Groove.Email");
			EmailAddress = "";
			EmailType = "";

			pEmailInfo = Emails[ i ].split(/\[|\]/);
			if(0 < 	pEmailInfo.length)
			{
				EmailAddress = pEmailInfo[ 0 ];
				if("" != EmailAddress)
					pEmail.SetEmail(EmailAddress);
			}

			if(1 < pEmailInfo.length)
			{
				var j;
				var Type = GrooveEmailType_None;
				for(j = 1; j < pEmailInfo.length; j++)
				{
					EmailType = pEmailInfo[ j ];
					if(EmailType == GrooveRunTimeData.GetItem("X400"))
						Type = Type | GrooveEmailType_X400;
					else if(EmailType == GrooveRunTimeData.GetItem("pref"))
						Type = Type | GrooveEmailType_Pref;
				}

				if(!(Type & GrooveEmailType_X400))
					Type = Type | GrooveEmailType_Internet;

				pEmail.SetEmailType(Type);
			}
			else
				pEmail.SetEmailType(GrooveEmailType_Internet);

			i_pTelecommunications.AddEmail(pEmail);
		}

		return i_pTelecommunications;
	}

// This function:
// Trim string and remove extra blanks between words
// Use some policy towards capitalization
// Currently: first letter of each word should be capital letter

	function Normalize(i_String)
	{
		// Validate parameter
		if(typeof i_String == "undefined" || "" == i_String)
			return "";

		// First letter of each word is turned to upper case and
		// spaces between words are reduced to 1 space

		var tempString = TrimEnds(i_String);
		var resultString = "";
		var i;
		var length = tempString.length;
		if(length)
		{
			var bInWord = false;
			var bInSpace = true;
			var j = 0;
			var char;
			for(i = 0; i < length; i++)
			{
				char = tempString.charAt(i);

				if(false == bInWord && " " != char)
				{
					char = char.toUpperCase();

					resultString += char;
					j++;

					bInWord = true;
					bInSpace = false;
				}
				else if(false == bInSpace && " " == char)
				{
					resultString += char;
					j++;
				
					bInWord = false;
					bInSpace = true;
				}
				else if(true == bInWord)
				{
					resultString += char;
					j++;
				}
			}

			//After the loop j equals to resultString length
			resultString = resultString.substr(0, j);
		}

		return resultString;
	}

	function NotifySubscriber(i_Key, i_Value)
	{
		ScriptHostComponent.FireEvent
			(
			GrooveRunTimeData.GetItem("IID_DGroovePropertyChangeListener"),
			"OnPropertyChanged",
			 i_Key, 
			 i_Value, 
			 true
			);

	}

	function CreateTaskDetailsObject
		(
			i_ParentID,
			i_Name,
			i_AssignedToContactURL,
			i_Status,
			i_Priority,
			i_StartDateConstraint,
			i_bConstrainStartDate,
			i_ScheduledStart,
			i_ScheduledDuration,
			i_ActualStart,
			i_ActualFinish,
			i_Description,
			i_IsSummary
		)
	{
		var NewID = GrooveRunTimeData.GetItem("pTaskProvider").GenerateUniqueID();
		var pIProjectItemDetailsFactory = GrooveScriptFunctions.CreateNewObject("Groove.ProjectItemDetailsFactory");
		GrooveDebugFunctions.DisplayAssert(null != pIProjectItemDetailsFactory, "Null item factory");

		var pITask = pIProjectItemDetailsFactory.CreateTaskItem
					(
						i_ParentID,
						NewID,
						-1,		// MUST always append 
						i_Name,
						i_AssignedToContactURL,
						i_Status,
						i_Priority,
						i_StartDateConstraint,
						i_bConstrainStartDate,
						i_ScheduledStart,		// ScheduledStart is calculated 
						i_ScheduledDuration,
						0,						// ScheduledFinish is calculated 
						0,
						i_ActualStart,
						i_ActualFinish,
						false,	// IsPrivate is unused
						true,	// IsRead
						i_Description,
						GrooveScriptFunctions.CreateNewObject(""),	// AttachmentEnum
						i_IsSummary,
						GrooveScriptFunctions.CreateNewObject("")	// PredecessorEnum
					);

		return pITask;
	}

	function CreateTaskDetailsEnum()
	{
		var IProjectDetailsEnumGUID = "{7F8EA9AB-047C-471f-A889-454D91B77060}";
		var IProjectDetailsGUID = "{824A19D3-AA4D-4134-A51F-35C4BF3DC2BB}";

		var pIProjectDetailsEnum =  GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs
											(
												IProjectDetailsEnumGUID,
												IProjectDetailsGUID
											);

		var pIProjectDetailsEnumCreate = pIProjectDetailsEnum.UnknownEnumCreate;
		return pIProjectDetailsEnumCreate;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           @           !     "      #      $  ‡             7 7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   e   ÄName$   M S P r o j e c t P u m p 2 . g s l    
      ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄEVENT	     ÄSCRIPTINTERFACE
     ÄSCRIPTINTERFACE     ÄSCRIPT         ÄSCRIPT       ÄSRC@  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t M i s c G l u e _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n         c G  ÄSCRIPT       ÄSRC   h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e C a l e n d a r H e l p e r _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   ar    r _  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       & V  ÄSCRIPT       ÄSRC^  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t D e l e g a t e H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       e r s i  ÄSCRIPT       ÄSRCN  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . C o n t a c t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       o n = 0  ÄSCRIPT       ÄSRCV  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t M i s c H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       & F a c  ÄEVENT       ÄLIBIDL   { 5 A A 9 1 6 C 7 - B F 1 2 - 1 1 d 3 - 8 0 A 0 - 0 0 C 0 4 F A 1 1 0 0 A }   "   ÄIIDL   { C 3 A 7 F C 2 2 - F A 8 B - 1 1 d 3 - 9 4 E B - 0 0 5 0 D A D 8 8 1 E 4 }   a   ÄDefault   1         ÄSCRIPTINTERFACE       ÄLIBIDL   { 1 9 7 E A E 0 4 - D E 8 5 - 4 7 9 a - 9 E D 6 - 9 D F 6 3 0 7 9 4 7 2 3 }   o   ÄIIDL   { F 0 E 2 A D E 6 - B 8 1 7 - 4 2 0 6 - B E 5 2 - C 4 1 E 4 3 3 1 9 5 6 A }   o    ∫ Ä

		function SetProperty(i_Key, i_Value)
		{
			if("UI_Cancel" == i_Key)
				GrooveRunTimeData.SetItem("UI_Cancel", true);
			else if("UI_ProjectDataDelegate" == i_Key)
			{
				var pTaskProvider = i_Value.IGrooveProjectTrackingDataDelegate;
				GrooveRunTimeData.SetItem("pTaskProvider", pTaskProvider);
			}
			else
				PropertyList.SetProperty(i_Key, i_Value, GroovePropertyFlag_Runtime | GroovePropertyFlag_Private);
		}

	vate);
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ¬    pñ    ‡    @y   Ñq   ¿Å   U   pE   º e     1         )            ÄSCRIPTINTERFACE       ÄLIBIDL   { 5 A A 9 1 6 C 7 - B F 1 2 - 1 1 d 3 - 8 0 A 0 - 0 0 C 0 4 F A 1 1 0 0 A }   "   ÄIIDL   { 8 D D 8 F F D 4 - C 7 5 D - 1 1 d 3 - 8 0 D 5 - 0 0 5 0 0 4 8 7 8 7 8 E }        	& Ä

		function OnPropertyChanged(i_Key, i_pValue, i_LocallyGenerated)
		{
			if(false == i_LocallyGenerated)
				return;

			if("UI_StartImport" == i_Key)
			{
				try
				{
					var Tokens = i_pValue.split(";");
					var FilePath = Tokens[ 0 ];
					var ResourceImportMode = Tokens[ 1 ];
					GrooveRunTimeData.SetItem("ResourceImportMode", ResourceImportMode);

					NotifySubscriber("DMD_SetLayoutForImport", 0); 
					NotifySubscriber("DMD_Message", "Starting Microsoft Project application...");
					NotifySubscriber("DMD_SetRange", 100);
					NotifySubscriber("DMD_StartTimerProgress", 100);

					if (false == StartMSProject(FilePath))
					{
						ShutDown();
						NotifySubscriber("DMD_EndTimerProgress", 0);
						NotifySubscriber("DMD_Abort", 0);
						return;
					}

					NotifySubscriber("DMD_EndTimerProgress", 0);
					NotifySubscriber("DMD_Message", "Microsoft Project application started.");
					Pause(500);

					// We need to warn user that his project is too big
					var MSProjectTaskCount = GetMSProjectTaskCount();
					if (-1 == MSProjectTaskCount)
						throw "";

					if (MSProjectTaskCount > GrooveRunTimeData.GetItem("TaskNumberThreshold"))
					{
						NotifySubscriber("DMD_BigProject", 0);
						if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
						{
							NotifySubscriber("DMD_Message", "Import cancelled.");
							ShutDown();
							NotifySubscriber("DMD_Done", 0);
							return;
						}
					}
					
					// We need to warn user if we are not importing predecessors
					var retValPredecessors = AreWeImportingPredecessors();
					if ("Error" == retValPredecessors)
						throw "";

					GrooveRunTimeData.SetItem("ImportPredecessors", retValPredecessors);

					if ("DontImportWarnUser" == retValPredecessors)
					{
						NotifySubscriber("DMD_NoPredecessors", 0);
						if(true == GrooveRunTimeData.GetItem("UI_Cancel"))
						{
							NotifySubscriber("DMD_Message", "Import cancelled.");
							ShutDown();
							NotifySubscriber("DMD_Done", 0);

							return;
						}
					}

					if ("ImportAndReconcile" == ResourceImportMode  || "DontImportReconcile" == ResourceImportMode)
					{
						var Message = "Processing resources";
						if("DontImportReconcile" == ResourceImportMode)
							Message = "Reconciling resources";
						else if("ImportAndReconcile" == ResourceImportMode)
							Message = "Importing and reconciling resources";

						NotifySubscriber("DMD_Message", Message);
						
						var MSProjectResourceCount = GetMSProjectResourceCount();
						if(-1 == MSProjectResourceCount)
							throw "";

						NotifySubscriber("DMD_SetRange", MSProjectResourceCount);
						if(0 == MSProjectResourceCount)
							NotifySubscriber("DMD_UpdateProgress", 0);

						var Result = ImportInContactTool();

						if("Success" != Result)
						{
							ShutDown();
							NotifySubscriber("DMD_Done", 0);
							if("Error" == Result)
								NotifySubscriber("DMD_Message", "Resource processing failed.");
							else if("UI_Cancel" == Result)
								NotifySubscriber("DMD_Message", "Resource processing cancelled.");

							return;
						}

						Message = "Resources were processed successfully.";
						if("DontImportReconcile" == ResourceImportMode)
							Message = "Resources were reconciled successfully.";
						else if("ImportAndReconcile" == ResourceImportMode)
							Message = "Resources were imported and reconciled successfully.";

						NotifySubscriber("DMD_Message", Message);
						Pause(500);
					}

					// MSProjectTaskCount was computed upfront
					NotifySubscriber("DMD_SetRange", MSProjectTaskCount);

					NotifySubscriber("DMD_Message", "Importing tasks");

					if(0 == MSProjectTaskCount)
						NotifySubscriber("DMD_UpdateProgress", 0);

					var pDoub          leEnumFactory = CreateDoubleEnum();
					GrooveRunTimeData.SetItem("pDoubleEnumFactory", pDoubleEnumFactory);

					var pEmptyDoubleEnum = CreateDoubleEnum().DoubleEnum;
					GrooveRunTimeData.SetItem("pEmptyDoubleEnum", pEmptyDoubleEnum);

					// Extract tasks from Microsoft Project.
					var pITaskDetailsEnumCreate = CreateTaskDetailsEnum();
					var bResult = false;
					try
					{
						bResult = ImportInProjectTool(pITaskDetailsEnumCreate);
						var pITaskDetailsEnum = pITaskDetailsEnumCreate.UnknownEnum;
					}
					catch(e)
					{
						NotifySubscriber("DMD_EndTaskImport", 0);
						if ("UI_Cancel" == e)
							NotifySubscriber("DMD_Message", "Import cancelled.");
						else
							NotifySubscriber("DMD_Message", "Unable to extract task from Microsoft Project.");
						Pause(500);
					}

					// Extract predecessors from Microsoft Project.
					if (bResult && 
						"Import" == GrooveRunTimeData.GetItem("ImportPredecessors"))
					{
						try
						{
							bResult = ImportPredecessors(pITaskDetailsEnum);
						}
						catch(e)
						{
							bResult = false;
							NotifySubscriber("DMD_Message", "Unable to extract predecessor information from Microsoft Project.");
							Pause(500);
						}
					}
					
					// Now import all tasks into Groove and recalculate the dates
					if (bResult)
					{
						NotifySubscriber("DMD_Message", "Recalculating imported task dates. Please wait.");
						Pause(500);

						var pDynamicsManager = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
						var pDelta = pDynamicsManager.CreateDelta();
						try
						{
							// Import all the tasks into Groove.
							bResult = false;
							pITaskDetailsEnum.Reset();
							var pTaskProvider = GrooveRunTimeData.GetItem("pTaskProvider");
							pTaskProvider.AppendMultipleTasks(false, /* no cycle check needed */
															  pITaskDetailsEnum,
															  GrooveScriptFunctions.CreateNewObject(""));

							pDelta.Commit();
							bResult = true;
						}
						catch(e)
						{
							pDelta.Abort();
							NotifySubscriber("DMD_Message", "Task import failed.");
						}
					}

					// Done with import.
					ShutDown();
				
					// Report success
					if (bResult)
						NotifySubscriber("DMD_Message", "The project was imported successfully.");

					NotifySubscriber("DMD_Done", 0);
					return;
				}
				catch(e)
				{
					NotifySubscriber("DMD_Message", "Project export failed.");
					ShutDown();
					NotifySubscriber("DMD_Done", 0);
				}

				return;
			}

			// We save with Baseline always, and replace file if it 
			// exists without prompting. User was asked about his choice
			// while in FileSave dialog (see MSProjectPump2.grp).

			if("UI_StartExport" == i_Key)
			{
				try
				{
					NotifySubscriber("DMD_Message", "Starting Microsoft Project application...");
					NotifySubscriber("DMD_SetRange", 100);
					NotifySubscriber("DMD_StartTimerProgress", 100);

					if(false == StartMSProject(i_pValue, false))
					{
						ShutDown();
						NotifySubscriber("DMD_EndTimerProgress", 0);
						NotifySubscriber("DMD_Abort", 0);
						return;
					}

					NotifySubscriber("DMD_EndTimerProgress", 0);
					NotifySubscriber("DMD_Message", "Microsoft Project started.");
					Pause(500);

					NotifySubscriber("DMD_Message", "Exporting contacts");

					var GrooveContactCount = GetGrooveContactCount();
					if(-1 == GrooveContactCount)
						throw "";

					NotifySubscriber("DMD_SetRange", GrooveContactCount);

					if(0 == GrooveContactCount)
						NotifySubscriber("DMD_UpdateProgress", 0);

					var Result = ExportFromContactsTool();

					if("Success" == Result)
					{
						NotifySubscriber("DMD_Message", "Contacts exported successfully.");
						Pause(500);
					}
					else if("UI_Cancel" == Result)
					{
						ShutDown();
						NotifySubscriber("DMD_Done", 0);
						NotifySubscriber("DMD_Message", "Export cancelled.");
						return;
					}
					else
					{
						      Ë  ShutDown();
						NotifySubscriber("DMD_Done", 0);
						NotifySubscriber("DMD_Message", "Contact export failed.");
						return;
					}

					var GrooveTaskCount = GetGrooveTaskCount();
					if(-1 == GrooveTaskCount)
						throw "";

					NotifySubscriber("DMD_SetRange", GrooveTaskCount);

					if(0 == GrooveTaskCount)
						NotifySubscriber("DMD_UpdateProgress", 0);

					NotifySubscriber("DMD_Message", "Exporting tasks");

					var Result = ExportFromProjectTool();

					if("Success" == Result)
					{
						NotifySubscriber("DMD_Message", "The project was exported successfully.");
					}
					else if("UI_Cancel" == Result)
					{
						ShutDown();
						NotifySubscriber("DMD_Done", 0);
						NotifySubscriber("DMD_Message", "Task export cancelled.");
						return;
					}
					else
					{
						ShutDown();
						NotifySubscriber("DMD_Done", 0);
						NotifySubscriber("DMD_Message", "Task export failed.");
						return;
					}

					NotifySubscriber("DMD_Done", 0);

					// If file exists - remove it here to prevent MSProject dialog box
					// we will never get here if file is read-only. This choice will be rejected
					// by FileSave dialog box
					var fso = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

					if(true == fso.DoesFileExist(i_pValue))
						fso.DeleteFile(i_pValue);

					SaveMSProject(i_pValue);
					ShutDown();

					return;
				}
				catch(e)
				{
					NotifySubscriber("DMD_Message", "Project export failed.");
					ShutDown();
					NotifySubscriber("DMD_Done", 0);
				}

				return;
			}

			//  Raise event for the rest of it
			NotifySubscriber(i_Key, i_pValue);
		}

		function OnPropertyRemoved(i_Key, i_LocallyGenerated)
		{
			// do nothing
		}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 @            &  p  '      (  à                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        x               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName0   P e o p l e P r o v i d e r H e l p e r . g s l   -       ÄSCRIPT     ÄSCRIPT       ÄSCRIPT       ÄSRC,  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e A r r a y H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   is      is           Z                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          *    | Q     ¥          )            ÄSCRIPT         / Ä

		//
		// Return a snapshot of contact names + URLs
		// Caller is responsible for opening a READ transaction
		//
		// Returns: ContactNameURLMap object, may be empty
		//			if null provider is received
		//
		function PPH_GetContactNameURLMap(i_PeopleProvider)
		{
			var Map = new ContactNameURLMap();

			if(null != i_PeopleProvider)
			{
				// get a people enum
				var ContactEnum = i_PeopleProvider.OpenContactEnum();
				if(ContactEnum)
				{
					// populate cache and combo box
					while(ContactEnum.HasMore())
					{
						var Contact = ContactEnum.OpenNext();
						var ContactURL = Contact.OpenURL();
						Map.Add(CHF_GetDisplayNameForContact(Contact), ContactURL);
					}
				}
			}

			return Map;
		}


		//////////////////////////////////////////////////////////////////
		//////////////////////////////////////////////////////////////////
		///
		/// ContactNameURLMap
		///
		///
		function ContactNameURLMap()
		{
			// Data
			this.Map = new Array();
			this.Map.length = 0;

			// Methods
			this.Add = ContactNameURLMap_Add;
			this.FindInsertionPoint =  ContactNameURLMap_FindInsertionPoint;
			this.Insert = ContactNameURLMap_Insert;
			this.FindByName = ContactNameURLMap_FindByName;
			this.FindByURL = ContactNameURLMap_FindByURL;
			this.GetCount = ContactNameURLMap_GetCount;
			this.GetAt = ContactNameURLMap_GetAt;
			this.URLExists = ContactNameURLMap_URLExists;
			this.NameExists = ContactNameURLMap_NameExists;
			this.RemoveByURL = ContactNameURLMap_RemoveByURL;
		}

		function ContactNameURLMap_GetCount()
		{
			return this.Map.length;
		}

		//
		// returns ContactNameURLTuple object
		//
		function ContactNameURLMap_GetAt(i_Index)
		{
			return this.Map[i_Index];
		}

		function ContactNameURLMap_Add(i_Name, i_ContactURL)
		{
			// What to insert.
			var item = new ContactNameURLTuple(i_ContactURL, i_Name);

			// Find insertion point.
			var index = this.FindInsertionPoint(item);

			// Insert sorted
			this.Map.splice(index, 0, item);
			return index;
		}

		//
		// Returns the index in a sorted array where the specified item
		// should be inserted. If same item found, will return the index
		// of that item.
		//
		function ContactNameURLMap_FindInsertionPoint(i_Item)
		{
			// If ary is indexed from 0 to 9, high will be 10
			var ptr, low = 0, high = this.Map.length;

			var ItemName = i_Item.Name.toLowerCase();
			ptr = Math.floor((high-low)/2);
			while (this.Map[ptr] && this.Map[ptr].Name != ItemName && high-low > 1)
			{
				var ArrayItemName = this.Map[ptr].Name.toLowerCase();
				if (ArrayItemName > ItemName)
					high = ptr;
				else
					low = ptr;
				ptr = Math.floor((high-low)/2+low);
			}

			var ArrayItemName = (this.Map[ptr]) ? this.Map[ptr].Name.toLowerCase() : "";
			if (ArrayItemName == ItemName)
				return ptr;
			else if (ArrayItemName > ItemName)
				return low;
			else if (ArrayItemName < ItemName)
				return high;
			else	
				return 0;
		}

		function ContactNameURLMap_Insert(i_InsertAfter, i_Name, i_ContactURL)
		{
			var Item = new ContactNameURLTuple(i_ContactURL, i_Name);
			this.Map.splice(i_InsertAfter, 0, Item);
		}

		function ContactNameURLMap_FindByName(i_ContactName)
		{
			for(var i = 0; i < this.Map.length; ++i)
			{
				if(this.Map[i].Name == i_ContactName)
				{
					return this.Map[i].ContactURL;
				}
			}

			return ""; //Missing contact has no URL
		}

		function ContactNameURLMap_FindByURL(i_ContactURL)
		{
			for(var i = 0; i < this.Map.length; ++i)
			{
				if(this.Map[i].ContactURL == i_ContactURL)
				{
					return this.Map[i].Name;
				}
			}

			return GPT_S_MISSINGCONTACT;
		}

		function ContactNameURLTuple(i_ContactURL, i_Name)
		{
			// Data
			this.Name = i_Name;
			this.ContactURL = i_ContactURL;
		}

		function ContactNameURLMap_URLExists(i_ContactURL)
		{
			for(var i = 0; i < this.Map.length; ++i)
			{
				if(this.Map[i].ContactURL == i_Co      ê  ntactURL)
				{
					return true;
				}
			}

			return false;
		}

		function ContactNameURLMap_NameExists(i_ContactName)
		{
			for(var i = 0; i < this.Map.length; ++i)
			{
				if(this.Map[i].Name == i_ContactName)
				{
					return true;
				}
			}

			return false;
		}
		
		function ContactNameURLMap_RemoveByURL(i_ContactURL)
		{
			for (var i = 0; i < this.Map.length; ++i)
			{
				if (this.Map[i].ContactURL == i_ContactURL)
				{
					this.Map = (this.Map.slice(0, i)).concat(this.Map.slice(i+1));
					return true;
				}
			}

			return false;
		}

		
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Z                     @            *  8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @               Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName*   P r o j e c t A t t a c h m e n t . g s l         ÄSCRIPT   
  ÄIMPLEMENTS    ÄSCRIPT         .  Ä

		function FinalConstruct()
		{
		}

	)
		{
  ÄIMPLEMENTS       ÄDefault   1     ÄLIBIDL   { 4 6 B 1 A C C 9 - F 1 B 6 - 4 3 9 8 - 9 A A 7 - 0 F 3 6 8 F 8 A F 9 F 4 }       ÄIIDL   { 8 4 5 8 C B 8 A - 9 1 2 C - 4 8 7 0 - 9 D 1 5 - E 1 3 9 B 6 C D 8 8 0 9 }           ÄSCRIPT  RIPT  ÄSCRIPT         6 Ä

			function GetID()
			{
				return GrooveRunTimeData.g_ID;
			}

			function PutID(i_ID)
			{
				GrooveRunTimeData.g_ID = i_ID;
			}

			function GetName()
			{
				return GrooveRunTimeData.g_Name;
			}

			function PutName(i_Name)
			{
				GrooveRunTimeData.g_Name = i_Name;
			}

		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Q   † Ù    x I      ∞          )                      @            ,  Ë                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName0   P r o j e c t C o m m o n S t r i n g s . g s l           ÄSCRIPTMODULE  SCRIP  ÄSCRIPTMODULE            ÄSCRIPT  RIPT  ÄSCRIPT         © Ä

//
// Common strings used in the Project Toolset
//
// Please use naming convention consistent with that defined in
// "String Resource Naming Conventions"
//	
var GPT_S_UNASSIGNED = "<Unassigned>";
var GPT_S_MISSINGCONTACT = "<Missing Contact>";

var GPT_S_STATUS_NOTSTARTED = "Not Started";
var GPT_S_STATUS_INPROGRESS = "In Progress";
var GPT_S_STATUS_COMPLETE = "Complete";
var GPT_S_STATUS_ALL = "All";

var GPT_S_PRIORITY_CRITICAL = "Critical";
var GPT_S_PRIORITY_IMPORTANT = "Important";
var GPT_S_PRIORITY_NORMAL = "Normal";
var GPT_S_PRIORITY_LOW = "Low";

// Tag to identify the project task; for display only
var GPT_S_PROJECTNAME_LABEL = "Project Summary";
var GPT_S_PROJECTNAME_TAG = "["+GPT_S_PROJECTNAME_LABEL+"]";


// Session name prefix.
var GPT_S_PROJECT_SESSION_NAME_PREFIX = "ProjectManager_";

//
// Programmatic strings that do not need to be localized
//
var GPT_SUPPORTEDTYPE_PENDINGITEMPROVIDER = "urn:solutions.groove.net:PendingItemProvider";
var GPT_SUPPORTEDTYPE_TASKPROVIDER = "urn:solutions.groove.net:TaskProvider";
var GPT_SUPPORTEDTYPE_MEETINGPROVIDER = "urn:solutions.groove.net:MeetingProvider";
var GPT_SUPPORTEDTYPE_MSPROJECTPUMPPROVIDER = "urn:solutions.groove.net:MSProjectPumpProvider";
var GPT_SUPPORTEDTYPE_PEOPLEPROVIDER = "urn:solutions.groove.net:PeopleProvider";
var GPT_SUPPORTEDTYPE_PEOPLEDETAILSPROVIDER = "urn:solutions.groove.net:PeopleDetailsProvider";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ê ƒ   x +      ´          )      ÄSCRIPT         1áÄ


	function PDHF_XPathConstructSimpleQuery(strItemName,Key)
	{
		return ("@" + strItemName + "='" + Key + "'");
	}

	function PDHF_RSEToProjectChangeType(i_RSEChangeType)
	{
		var TaskChangeMethod;

		switch (i_RSEChangeType)
		{
			case GrooveRecordSetChangeType_Added:
			{
				TaskChangeMethod = "OnProjectItemAdded";
				break;
			}

			case GrooveRecordSetChangeType_Replaced:
			{
				TaskChangeMethod = "OnProjectItemReplaced";
				break;
			}

			case GrooveRecordSetChangeType_Removed:
			{
				TaskChangeMethod = "OnProjectItemRemoved";
				break;
			}
			default:
			{
				GrooveDebugFunctions.DisplayAssert(false, "Invalid change type encountered");
			}
		}

		return TaskChangeMethod;
	}

	function PDHF_RSEToPendingChangeType(i_RSEChangeType)
	{
		var PendingItemChangeMethod;

		switch (i_RSEChangeType)
		{
			case GrooveRecordSetChangeType_Added:
			{
				PendingItemChangeMethod = "OnPendingItemAdded";
				break;
			}

			case GrooveRecordSetChangeType_Replaced:
			{
				PendingItemChangeMethod = "OnPendingItemReplaced";
				break;
			}

			case GrooveRecordSetChangeType_Removed:
			{
				PendingItemChangeMethod = "OnPendingItemRemoved";
				break;
			}
			default:
			{
				GrooveDebugFunctions.DisplayAssert(false, "Invalid change type encountered");
			}
		}

		return PendingItemChangeMethod;
	}

	//
	//
	// Internal helper routines
	//
	//
	function PDHF_UpdateFieldIfChanged(i_Record, i_FieldName, i_NewFieldValue)
	{
		if(i_NewFieldValue != i_Record.OpenField(i_FieldName))
		{
			i_Record.SetField(i_FieldName, i_NewFieldValue);
			return true;
		}

		return false;
	}

	function PDHF_UpdateDoubleFieldIfChanged(i_Record, i_FieldName, i_NewFieldValue)
	{
		if(i_NewFieldValue != i_Record.OpenField(i_FieldName))
		{
			i_Record.SetFieldAsDouble(i_FieldName, i_NewFieldValue);
			return true;
		}

		return false;
	}

	function PDHF_UpdateElementFieldIfChanged(i_Record, i_FieldName, i_NewFieldValue)
	{
		if(!i_NewFieldValue.Equals(i_Record.OpenFieldAsElement(i_FieldName)))
		{
			i_Record.SetFieldAsElement(i_FieldName, i_NewFieldValue);
			return true;
		}

		return false;
	}

	function PDHF_DeleteMultipleItems(i_IDEnum)
	{
		// RSE does not behave well when called with an empty enum
		if(i_IDEnum.HasMore())
		{
			RecordSetEngine.RemoveMultipleRecords(i_IDEnum);
		}
	}

	// returns the current version of our serialization format
	function PDHF_GetCurrentSerializationVersion()
	{
		return 3; // post 2.0 1189
	}


	//
	// TRANSACTION REQUIREMENTS: WRITE
	//
	function PDHF_SerializeItemsToStream(i_pIItemIDEnum, i_IncludeChildren, i_pByteOutputStream, i_Flags)
	{
		var pIElement = PDHF_SerializeItemsToElement(i_pIItemIDEnum, i_IncludeChildren, i_Flags);
		var SerializeFormat = GrooveSerializeType_XML;

		// include attachments?
		if(0 != (GrooveProjectTrackingSerializeFlags_Attachments & i_Flags))
		{
			// must use auto-format (currently MIME) to save binary content
			SerializeFormat = GrooveSerializeType_Auto;
		}
		
		pIElement.SerializeToStream(i_pByteOutputStream, SerializeFormat, GrooveCharEncodingType_UTF8, GrooveSerializeOption_EnableXlinkCompression);
	}

	//
	// TRANSACTION REQUIREMENTS: WRITE
	//
	// Implementation note:  RSE will save the current record IDs during serialization.
	// During restore, it will generate new record IDs for all of the records and will
	// automatically replace any occurences of the old record IDs with the new record IDs.
	// Records that are referenced but are not included in serialization become dangling
	// references 
	//
	function PDHF_SerializeItemsToElement(i_pIItemIDEnum, i_IncludeChildren, i_Flags)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");
		var NSP = "urn:groove.net:";
		var pIStorageManager = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
		var pIHeaderElement = pIStorageManager.CreateTemporaryElement(NSP + "ProjectItemsHeader");

		// delete when done
		pIHeaderElement.SetDeleteOnRelease();

		// top level items
		pIHeaderElement.SetAttributeAsLong("Version", PDHF_GetCurrentSerializationVersion());
		var pIProjectInfo = pIHeaderElement.CreateElement(NSP + "Project", pIHeaderElement);
		var pIParents = pIHeaderElement.CreateElement(NSP+ "Parents", pIHeaderElement);
		var pIFirstItem = pIHeaderElement.CreateElement(NSP + "FirstItem", pIHeaderElement);

		// optional items
		var pIRecord = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("PROJECT_ID"));

		if(GrooveProjectTrackingSerializeFlags_ProjectName & i_Flags)
		{
			pIProjectInfo.SetAttribute("ProjectName", pIRecord.OpenField("Name"));
		}

		if(GrooveProjectTrackingSerializeFlags_ProjectObjective & i_Flags)
		{
			var pIProjectObjective = pIProjectInfo.CreateElement(NSP + "Objective", pIProjectInfo);
			pIProjectObjective.CreateElementCopy(pIRecord.OpenField("Objective"), pIProjectObjective, false /* deep */, GrooveXLinkCopyOption_Default);
		}

		if(GrooveProjectTrackingSerializeFlags_ProjectStart & i_Flags)
		{
			pIProjectInfo.SetAttributeAsDouble("ProjectStart", pIRecord.OpenFieldAsDouble("ScheduledStart"));
		}

		// remove any redundantly specified decendants from the enum
		if(true == i_IncludeChildren)
		{
			i_pIItemIDEnum = PDHF_RemoveRedundantDecendants(i_pIItemIDEnum);
		}

		// serialize top-level parent IDs so they can be fixed-up during restore
		i_pIItemIDEnum.Reset();
		while(i_pIItemIDEnum.HasMore())
		{
			var ItemID = i_pIItemIDEnum.OpenNext();
			var ParentID = PDHF_GetParentID(ItemID);
			var pIParent = pIParents.CreateElement(NSP + "Parent", pIParents);
			pIParent.SetAttributeAsDouble("ID", ParentID);
		}

		// expand children?
		var pISerializeIDEnum = CreateDoubleEnum(); 
		if(true == i_IncludeChildren)
		{
			// push all the top level items
			i_pIItemIDEnum.Reset();
			while(i_pIItemIDEnum.HasMore())
			{
				pISerializeIDEnum.Add(i_pIItemIDEnum.OpenNext());
			}
			
			// now push all the children
			i_pIItemIDEnum.Reset();
			while(i_pIItemIDEnum.HasMore())
			{
				var pIChildEnum = Collection.OpenCollection().Collection2.OpenDescendantRecordIDEnum(i_pIItemIDEnum.OpenNext(), -1, GrooveDescendantEnumerationOrder_DepthFirst);
				while(pIChildEnum.HasMore())
				{
					pISerializeIDEnum.Add(pIChildEnum.OpenNext());
				}
			}
			pISerializeIDEnum = pISerializeIDEnum.DoubleEnum;
		}
		else
		{
			// AM - make a deep copy so we can add to SerializeIDEnum without
			// worrying about side effects of modifying pIItemIDEnum
			i_pIItemIDEnum.Reset();
			while(i_pIItemIDEnum.HasMore())
			{
				pISerializeIDEnum.Add(i_pIItemIDEnum.OpenNext());
			}
			i_pIItemIDEnum.Reset();
		}

		// include predecessors?
		// AMLATER - this needs to be reworked to be more efficient in the future
		if(GrooveProjectTrackingSerializeFlags_Predecessors & i_Flags)
		{
			var pIPredecessorRelationshipIDEnumCreate = CreateDoubleEnum();
			pISerializeIDEnum.Reset();
			
			// find predecessors for the current task
			while(pISerializeIDEnum.HasMore())
			{
				var CurrentTaskID = pISerializeIDEnum.OpenNext();
				var pIPredecessorIDEnum = PDHF_GetPredecessorIDEnum(CurrentTaskID);
				
				// get the ID of the relationship record for the current predecessor
				while(pIPredecessorIDEnum.HasMore())
				{
					var CurrentPredecessorID = pIPredecessorIDEnum.OpenNext();
					var RelationshipID = RelationshipManager.FindRelationship("Predecessor", CurrentPredecessorID, CurrentTaskID);
					pIPredecessorRelationshipIDEnumCreate.Add(RelationshipID);
				}
			}

			// include the relationship records in the enum of items to be serialized
			var pIPredecessorRelationshipIDEnum = pIPredecessorRelationshipIDEnumCreate.DoubleEnum;
			while(pIPredecessorRelationshipIDEnum.HasMore())
			{
				pISerializeIDEnum.DoubleEnumCreate.Add(pIPredecessorRelationshipIDEnum.OpenNext());
			}

			pISerializeIDEnum.Reset();
		}

		// push the requested items into the element for export
		var pIItems = pIHeaderElement.CreateElement(NSP + "Items", pIHeaderElement);
		var pIElement = RecordSetEngine.ExportToElement(pISerializeIDEnum);
		pIItems.AppendContentElement(pIElement);

		// this totally sucks
		//
		// we need a way to mark the record that is "first" so that we can fix up it's prev sibling reference
		// on deserialization.  We also need to link all the top-level items together so that they are
		// contiguous when restored
		i_pIItemIDEnum.Reset();
		PDHF_FixupPrevSiblingReferences(i_pIItemIDEnum, pIItems);

		// include attachments?
		if(0 == (GrooveProjectTrackingSerializeFlags_Attachments & i_Flags))
		{
			// gag - sqaush any attachments that are referenced
			PDHF_SquashAttachments(pIItems);
		}

		return pIHeaderElement;
	}

	//
	// TRANSACTION REQUIREMENTS: READ
	//
	// Given a list of IDs in a hierarchical collection, return a list that only 
	// contains the top-most nodes so that items are not redundantly specified
	// for hierarchial operaions such as copy and paste.
	//
	function PDHF_RemoveRedundantDecendants(i_pIItemIDEnum)
	{
		i_pIItemIDEnum.Reset();

		var pIReturnEnum = CreateDoubleEnum();
		var SparseItemArray = PDHF_SparseArrayFromEnum(i_pIItemIDEnum);

		// treat every item as a possible decendant
		i_pIItemIDEnum.Reset();
		while(i_pIItemIDEnum.HasMore())
		{
			var IsChildRedundant = false;
			var CurrentChildID = i_pIItemIDEnum.OpenNext();

			// start from the item and trace a path to the root, search for items
			// at each node
			var ParentID = PDHF_GetParentID(CurrentChildID);
			while(-1 != ParentID)
			{
				if(SparseItemArray.Contains(ParentID))
				{
					// child is redundant, stop searching
					IsChildRedundant = true;
					break;
				}
				
				// continue moving toward root
				ParentID = PDHF_GetParentID(ParentID);
			}

			// include in enum?
			if(false == IsChildRedundant)
			{
				pIReturnEnum.Add(CurrentChildID);
			}
		}

		return pIReturnEnum.DoubleEnum;
	}


	//
	// AMHACK - MAJOR ENCAPSULATION VIOLATION - DEPENDENT ON RSE ELEMENT FORMAT!!!
	// (and this is soooo expensive...)
	function PDHF_FixupPrevSiblingReferences(i_pIItemIDEnum, i_pIItemElement)
	{
		var pIExportedRecords = i_pIItemElement.OpenContentElement(0);
		var PreviousItemID = 0; // !! use special value 0 to indicate the first item !!

		i_pIItemIDEnum.Reset();
		while(i_pIItemIDEnum.HasMore())
		{
			var CurrentID = i_pIItemIDEnum.OpenNext();
			var pIRecordElement = null;

			// find the element containing the current item
			for(var i = 0; i < pIExportedRecords.GetContentCount(); ++i)
			{
				var pICurrentRecordElement= pIExportedRecords.OpenContentElement(i);
				var ItemID = pICurrentRecordElement.OpenAttributeAsDouble("_RecordID");

				if(ItemID == CurrentID)
				{
					pIRecordElement = pICurrentRecordElement;
					break;
				}
			}
			GrooveDebugFunctions.DisplayAssert(null != pIRecordElement, "Missing element!");

			// relink siblings
			pIRecordElement.SetAttributeAsDouble("_PreviousSiblingID", PreviousItemID);
			PreviousItemID = CurrentID;
		}
	}

	function PDHF_SquashAttachments(i_pIItemElement)
	{
		var pIExportedRecords = i_pIItemElement.OpenContentElement(0);

		// find the element containing the current item
		for(var i = 0; i < pIExportedRecords.GetContentCount(); ++i)
		{
			var pICurrentRecordElement= pIExportedRecords.OpenContentElement(i);
			if(pICurrentRecordElement.ContentElementWithNameExists("Attachments"))
			{
				var pIAttachmentElement = pICurrentRecordElement.OpenContentElementByName("Attachments");
				
				pIAttachmentElement.DetachFromParent();
				pIAttachmentElement.Delete();
			}
		}
	}

	//
	// Requires DELTA
	//
	function PDHF_GetHeaderElementFromStream(i_BIS)
	{
		var TelespaceDatabase = PropertyList.OpenProperty(PROPERTY_TELESPACE_DATABASE);
		var pIXMLDoc = DHF_CreateScratchDocument(TelespaceDatabase);
		var pIHeaderElement = pIXMLDoc.CreateElementFromStream(i_BIS, GrooveParseOption_Default, pIXMLDoc.OpenRootElement());
		
		return pIHeaderElement;
	}


	//
	// Requires DELTA
	//
	// i_PreviousSibling of -1 means insert as first child of parent
	// Returns a IGrooveDoubleEnum of the newly added items, or null if an error occurs
	// 
	function PDHF_ImportFromHeaderElement(i_ParentID, i_PreviousSiblingID, i_pIHeaderElement)
	{
		var NSP = "urn:groove.net:";
		var pOldParentIDCreateEnum = CreateDoubleEnum();

		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		if(NSP + "ProjectItemsHeader" != i_pIHeaderElement.OpenName() ||
			PDHF_GetCurrentSerializationVersion() != i_pIHeaderElement.OpenAttributeAsLong("Version"))
		{
			GrooveDebugFunctions.DisplayAssert(0, "Unsupported serialization format");
			return;
		}

		var pIRecord = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("PROJECT_ID"));

		// ProjectInfo
		if(i_pIHeaderElement.ContentElementWithNameExists(NSP + "Project"))
		{
			var pIProjectInfo = i_pIHeaderElement.OpenContentElementByName(NSP + "Project");

			if(pIProjectInfo.DoesAttributeExist("ProjectName"))
			{
				pIRecord.SetField("Name", pIProjectInfo.OpenAttribute("ProjectName"));
			}

			if(pIProjectInfo.ContentElementWithNameExists(NSP + "Objective"))
			{
				var pIProjectObjective = pIProjectInfo.OpenContentElementByName(NSP + "Objective");
				pIRecord.SetField("Objective", pIProjectObjective.OpenContentElement(0));
			}

			if(pIProjectInfo.DoesAttributeExist("ProjectStart"))
			{
				pIRecord.SetFieldAsDouble("ScheduledStart", pIProjectInfo.OpenAttributeAsDouble("ProjectStart"));
			}
		}

		// ParentIDs
		if(i_pIHeaderElement.ContentElementWithNameExists(NSP + "Parents"))
		{
			var pIParents = i_pIHeaderElement.OpenContentElementByName(NSP + "Parents");

			for(var i = 0; i < pIParents.GetContentCount(); ++i)
			{
				var pIParent = pIParents.OpenContentElement(i);
				var ID = pIParent.OpenAttributeAsDouble("ID");
				pOldParentIDCreateEnum.Add(ID);
			}
		}

		// Items
		if(i_pIHeaderElement.ContentElementWithNameExists(NSP + "Items"))
		{
			var pIItems = i_pIHeaderElement.OpenContentElementByName(NSP + "Items");
			var pIRecordElements = pIItems.OpenContentElement(0);

			var pIRecordEnum = RecordSetEngine.ImportFromElement(pIRecordElements);

			// reparent records, as necessary
			var pIOldParentIDEnum = pOldParentIDCreateEnum.DoubleEnum;
			pIOldParentIDEnum.Reset();

			if(pIOldParentIDEnum.HasMore())
			{
				var OldParentSparseArray = PDHF_SparseArrayFromEnum(pIOldParentIDEnum);
				while(pIRecordEnum.HasMore())
				{
					var pIRecord = pIRecordEnum.OpenNext();
					if("urn:groove.net:ProjectTaskRecord" == pIRecord.Type)
					{
						var SerializedParentID = pIRecord.OpenFieldAsDouble("_ParentID");
						
						// it this item is a top level item, fix up it's parent ID
						// otherwise, 
						if(OldParentSparseArray.Contains(SerializedParentID))
						{
							pIRecord.SetFieldAsDouble("_ParentID", i_ParentID);
						}
					}
				}
			}

			// find the first item (for insertion) --it has special prev sibling id of 0
			pIRecordEnum.Reset();
			while(pIRecordEnum.HasMore())
			{
				var pIRecord = pIRecordEnum.OpenNext();
				if("urn:groove.net:ProjectTaskRecord" == pIRecord.Type &&
				   (0 == pIRecord.OpenFieldAsDouble("_PreviousSiblingID")))
				{
					pIRecord.SetFieldAsDouble("_PreviousSiblingID", i_PreviousSiblingID);
					break;
				}
			}

			// verify that each record has an attachments element
			// and fix up the creator to be the current user
			pIRecordEnum.Reset();
			while(pIRecordEnum.HasMore())
			{
				var pIRecord = pIRecordEnum.OpenNext();
				if(("urn:groove.net:ProjectTaskRecord" == pIRecord.Type || "urn:groove.net:ProjectProjectRecord" == pIRecord.Type) &&
					false == pIRecord.HasField("Attachments"))
				{
					PDHF_InitializeRecordAttachments(pIRecord);
				}

				// make current user the creator of these records
				pIRecord.SetField("_CreatedByURL", CHF_GetUserURL());
				pIRecord.SetField("_CreatedBy", CHF_GetUserName());
			}

			// finally, we're ready to add the records
			pIRecordEnum.Reset();
			if(pIRecordEnum.HasMore())
			{
				RecordSetEngine.AddMultipleRecords(pIRecordEnum);
			}

			// return the IDs of the newly created tasks
			// and tell the relationship manager about the new relationships
			pIRecordEnum.Reset();
			if(pIRecordEnum.HasMore())
			{
				var pIIDEnum = CreateDoubleEnum();
				while(pIRecordEnum.HasMore())
				{
					var pIRecord = pIRecordEnum.OpenNext();
					if("urn:groove.net:ProjectTaskRecord" == pIRecord.Type)
					{
						var ID = pIRecord.RecordID;
						var ParentID = pIRecord.OpenField("_ParentID");
						
						pIIDEnum.Add(ID);
						PDHF_CreateParentChildRelationship(ParentID, ID);
					}
				}
				return pIIDEnum.DoubleEnum;
			}
		}
		
		return null;
	}


	//
	// Return an IGrooveProjectAttachmentEnum for the specified item
	// requires READ transaction
	//
	function PDHF_GetAttachmentEnum(i_OwnerID)
	{
		var IProjectAttachmentEnumGUID = "{6C0971C7-8211-4d90-BFD1-21099C398723}";
		var IProjectAttachmentGUID = "{8458CB8A-912C-4870-9D15-E139B6CD8809}";

		var pIAttachmentEnum =  GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs
											(
												IProjectAttachmentEnumGUID,
												IProjectAttachmentGUID
											);

		var pIAttachmentEnumCreate = pIAttachmentEnum.UnknownEnumCreate;

		try
		{
			var pIRecord = RecordSetEngine.OpenRecord(i_OwnerID);
			var pIAttachmentElement = PDHF_OpenAttachmentsElement(pIRecord);
			var AttachmentCount = pIAttachmentElement.GetContentCount();
			
			for(var i = 0; i < AttachmentCount; ++i)
			{
				var pIFileLinkElement = pIAttachmentElement.OpenContentElement(i);
				var pIAttachment = GrooveScriptFunctions.CreateNewObject("Groove.ProjectAttachment");

				GrooveDebugFunctions.DisplayAssert(null != pIAttachment, "Null attachment");

				pIAttachment.ID = PDHF_NumberFromElementName(pIFileLinkElement.OpenName());
				pIAttachment.Name = pIFileLinkElement.OpenAttribute("Name");
				
				pIAttachmentEnumCreate.Add(pIAttachment);
			}
		}
		catch(e)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Error getting attachment enum");
		}

		return pIAttachmentEnum;
	}


	//
	// Returns an IGrooveNameValueEnum containing the names and IDs of
	// the predecessor's for the specified items.
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetPredecessorNameValueEnum(i_TaskID)
	{
		var pINameValueEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum().NameValueEnumCreate;
		var pIPredecessorEnum = PDHF_GetPredecessorIDEnum(i_TaskID);

		while(pIPredecessorEnum.HasMore())
		{
			var pIRecord= RecordSetEngine.OpenRecord(pIPredecessorEnum.OpenNext());
			var Name = pIRecord.OpenField("Name");
			pINameValueEnum.Add(Name, pIRecord.RecordID);
		}

		return pINameValueEnum.NameValueEnum;
	}

	//
	// Returns an IGrooveDoubleEnum containing the predecessor ID's for the specified item.
	// An empty enum is returned if no predecessors exist.
	//
	// TRANSACTION REQUIREMENTS: READ
	//
	function PDHF_GetPredecessorIDEnum(i_TaskID)
	{
		return RelationshipManager.FindRecordsByRelationship("Predecessor", GrooveRelationshipSide_Right, i_TaskID);
	}


	function PDHF_InitializeRecordAttachments(i_pIRecord)
	{
		var pIAttachmentLinks = CreateNewElement("Attachments");
		i_pIRecord.SetFieldAsElement("Attachments", pIAttachmentLinks);
	}

	function PDHF_OpenAttachmentsElement(i_pIRecord)
	{
		return i_pIRecord.OpenFieldAsElement("Attachments");
	}

	function PDHF_UpdateAttachmentsElement(i_pIRecord, i_pIElement)
	{
		i_pIRecord.SetFieldAsElement("Attachments", i_pIElement);
	}

	function PDHF_ElementNameFromNumber(i_Number)
	{
		var ElementName = "_" + i_Number;
		GrooveDebugFunctions.DisplayAssert("_" != ElementName, "Invalid number");
		return ElementName;
	}

	function PDHF_NumberFromElementName(i_String)
	{
		GrooveDebugFunctions.DisplayAssert(i_String.length != 0, "Invalid Element Name");
		GrooveDebugFunctions.DisplayAssert("_" == i_String.charAt(0), "Invalid Element Name");
		var NumberValue = new Number(i_String.substring(1, i_String.length));
		return NumberValue.valueOf();
	}

	//
	// Notify listeners on IGrooveProjectTrackingDataDelegateListener
	// If the operation is a remove, we notify listeners, regardless
	// of the type of item that was changed.  If the operation is not a remove,
	// we inform the listeners when the item is of type project or task.
	//
	function PDHF_NotifyProjectTrackingListeners
				(
					i_pRecordSetEngine, 
					i_RecordSetChangeType, 
					i_pIRecordIDEnum
				)
	{
		var pIIDEnumCreate = CreateDoubleEnum();
		var pIIDEnum = pIIDEnumCreate.DoubleEnum;

		i_pIRecordIDEnum.Reset();

		if(GrooveRecordSetChangeType_Removed == i_RecordSetChangeType)
		{
			pIIDEnum = i_pIRecordIDEnum;
		}
		else
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);

			try
			{
				while(i_pIRecordIDEnum.HasMore())
				{
					var RecordID = i_pIRecordIDEnum.OpenNext();
					
					if(false == RecordSetEngine.HasRecord(RecordID))
					{
						continue;
					}

					var pIRecord = RecordSetEngine.OpenRecord(RecordID);
					switch(pIRecord.Type)
					{
						case "urn:groove.net:ProjectProjectRecord":
						case "urn:groove.net:ProjectTaskRecord":
							pIIDEnumCreate.Add(RecordID);
							break;
						default:
							break;
					}

				}

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Error finding pending task");
			}
		}

		if(pIIDEnum.HasMore())
		{
			ScriptHostComponent.FireEvent
				(
					GrooveRunTimeData.GetItem("IID_IGrooveProjectTrackingDataDelegateListener"),
					PDHF_RSEToProjectChangeType(i_RecordSetChangeType),
					ScriptHostComponent,
					pIIDEnum
				);
		}
	}


	//
	// AMLATER - FILTER OUT SUMMARY TASKS
	//
	function PDHF_NotifyPendingItemListeners
				(
					i_pRecordSetEngine, 
					i_RecordSetChangeType, 
					i_pIRecordIDEnum
				)
	{
		var pIPendingItemIDEnum = null;

		//
		// notify listeners on IGrooveProjectDashboardPendingItemDataDelegateListener
		// If the operation is a remove, we notify pending item listeners, regardless
		// of the type of item that was changed.  If the operation is not a remove,
		// we only inform the listeners when the item is of type "task".
		//
		// We do not notify pending item listeners when attachments are added/removed
		//

		i_pIRecordIDEnum.Reset();

		if(GrooveRecordSetChangeType_Removed == i_RecordSetChangeType)
		{
			pIPendingItemIDEnum = i_pIRecordIDEnum;
		}
		else
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);

			try
			{
				pIPendingItemIDEnum = RSHP_RecordIDEnumFindType
											(
												i_pIRecordIDEnum,
												i_pRecordSetEngine,
												"urn:groove.net:ProjectTaskRecord"
											);

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Error finding pending task");
			}
		}

		if(null != pIPendingItemIDEnum && pIPendingItemIDEnum.HasMore())
		{
			ScriptHostComponent.FireEvent
				(
					GrooveRunTimeData.GetItem("IID_IGrooveProjectDashboardPendingItemDataDelegateListener"),
					PDHF_RSEToPendingChangeType(i_RecordSetChangeType),
					ScriptHostComponent,
					pIPendingItemIDEnum
				);
		}
	}


	function PDHF_BuildTaskRecord
				(
					i_ParentID,
					i_TaskName,
					i_AssignedToContactURL,
					i_Status,
					i_Priority,
					i_UserStartConstraint,
					i_ConstrainStartDate,
					i_ScheduledStart,
					i_ScheduledDuration,
					i_TargetFinish,
					i_ActualStart,
					i_ActualFinish,
					i_IsPrivate,
					i_pIDescription
				)
	{
		var pIRecord = RecordSetEngine.RecordFactory.CreateRecord("urn:groove.net:ProjectTaskRecord");

		//  Set the fields in the record
		pIRecord.SetField("Version", GrooveRunTimeData.GetItem("TASKRECORD_VERSION"));
		pIRecord.SetFieldAsDouble("_ParentID", i_ParentID);
		pIRecord.SetField("Name", i_TaskName);
		pIRecord.SetField("AssignedToContactURL", i_AssignedToContactURL);
		pIRecord.SetField("Status", i_Status);
		pIRecord.SetField("Priority", i_Priority);
		pIRecord.SetFieldAsDouble("TargetFinish", i_TargetFinish);
		pIRecord.SetFieldAsDouble("ActualStart", i_ActualStart);
		pIRecord.SetFieldAsDouble("ActualFinish", i_ActualFinish);
		pIRecord.SetFieldAsBool("IsPrivate", i_IsPrivate);
		pIRecord.SetFieldAsElement("Description", i_pIDescription);

		// new tasks are not summary tasks by convention, so it's ok to set the dates
		pIRecord.SetFieldAsDouble("UserStartConstraint", i_UserStartConstraint);
		pIRecord.SetFieldAsBool("ConstrainStartDate", i_ConstrainStartDate);
		pIRecord.SetFieldAsDouble("ScheduledStart", i_ScheduledStart);
		pIRecord.SetFieldAsDouble("ScheduledDuration", i_ScheduledDuration);
		pIRecord.SetFieldAsDouble("ScheduledFinish", i_ScheduledStart + i_ScheduledDuration);

		// init attachments 
		PDHF_InitializeRecordAttachments(pIRecord);

		return pIRecord;
	}

	//
	// returns true if the specified item has children
	//
	function PDHF_HasChildren(i_ID)
	{
		return 0 != Collection.OpenCollection().Collection2.GetNumChildren(i_ID);
	}





	////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////
	//
	// Pseudo-command functions
	//



	function PDHF_BuildAddTaskCmdRecord(i_AddedIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("ADDTASK_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskIDs", PDHF_StringFromIDEnum(i_AddedIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildDeleteTasksCmdRecord(i_DeleteIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("DELETEITEMS_CMDID"));
		
		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskIDs", PDHF_StringFromIDEnum(i_DeleteIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildRescheduleProjectCmdRecord(i_StartDate)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("RESCHEDULEPROJECT_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetFieldAsDouble("ScheduledStart", i_StartDate);

		return pIPseudoCommand;
	}


	//
	// generate a command to update schedule/status info for a task
	//
	function PDHF_BuildChangeTaskScheduleCmdRecord(i_pIGrooveTaskDetails, i_StatusOnly /* false */)
	{
		var pITaskList = PDHF_CreateTaskList();
		var StatusOnly = false;

		if("undefined" != typeof(i_StatusOnly))
		{
			StatusOnly = i_StatusOnly;
		}

		PDHF_AppendToTaskList(pITaskList,
							  StatusOnly,
							  i_pIGrooveTaskDetails.ID,
							  i_pIGrooveTaskDetails.Status,
							  i_pIGrooveTaskDetails.ActualStart,
							  i_pIGrooveTaskDetails.ActualFinish,
							  i_pIGrooveTaskDetails.UserStartConstraint,
							  i_pIGrooveTaskDetails.ConstrainStartDate,
							  i_pIGrooveTaskDetails.ScheduledDuration,
							  i_pIGrooveTaskDetails.Priority);

		return PDHF_BuildChangeTaskScheduleCmdRecordFromTaskList(StatusOnly, pITaskList);
	}


	//
	// generate a command to recalculate the tasks specified in the ID enum
	//
	function PDHF_BuildRecalculateMultipleCmdRecord(i_ItemIDEnum, i_StatusOnly /* false */)
	{
		var pITaskList = PDHF_CreateTaskList();
		var StatusOnly = false;

		if("undefined" != typeof(i_StatusOnly))
		{
			StatusOnly = i_StatusOnly;
		}

		i_ItemIDEnum.Reset();
		while(i_ItemIDEnum.HasMore())
		{
			PDHF_AppendToTaskList(pITaskList, StatusOnly, i_ItemIDEnum.OpenNext());
		}

		return PDHF_BuildChangeTaskScheduleCmdRecordFromTaskList(StatusOnly, pITaskList);
	}


	//
	// generate a command to update schedule/status info for multiple tasks
	// using information built up from PDHF_CreateTaskList/PDHF_AppendToTaskList
	//
	function PDHF_BuildChangeTaskScheduleCmdRecordFromTaskList(i_StatusOnly, i_pITaskListElement)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("RECALCULATE_CMDID"));
		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetFieldAsBool("StatusOnly", i_StatusOnly);
		pIPseudoCommand.SetFieldAsElement("TaskList", i_pITaskListElement);

		return pIPseudoCommand;
	}


	function PDHF_CreateTaskList()
	{
		return CreateNewElement("TaskList");
	}

	function PDHF_AppendToTaskList
				(
					i_pITaskListElement,
					i_StatusOnly,
					i_ID,
					i_Status,				// optional
					i_ActualStart,			// optional
					i_ActualFinish,			// optional
					i_UserStartConstraint,	// optional
					i_ConstrainStartDate,	// optional
					i_ScheduledDuration,	// optional
					i_Priority				// optional
				)
	{
		var pITaskElement = i_pITaskListElement.CreateElement("Task", i_pITaskListElement);

		try
		{
			// add scheduled info
			pITaskElement.SetAttributeAsDouble("ID", i_ID);

			if("undefined" != typeof(i_Status))
			{
				pITaskElement.SetAttributeAsLong("Status", i_Status);
			}

			if("undefined" != typeof(i_ActualStart))
			{
				pITaskElement.SetAttributeAsDouble("ActualStart", i_ActualStart);
			}

			if("undefined" != typeof(i_ActualFinish))
			{
				pITaskElement.SetAttributeAsDouble("ActualFinish", i_ActualFinish);
			}

			if(false == i_StatusOnly)
			{
				if("undefined" != typeof(i_UserStartConstraint))
				{
					pITaskElement.SetAttributeAsDouble("UserStartConstraint", i_UserStartConstraint);
				}

				if("undefined" != typeof(i_ConstrainStartDate))
				{
					pITaskElement.SetAttributeAsBool("ConstrainStartDate", i_ConstrainStartDate);
				}
				
				if("undefined" != typeof(i_ScheduledDuration))
				{
					pITaskElement.SetAttributeAsDouble("ScheduledDuration", i_ScheduledDuration);
				}

				if("undefined" != typeof(i_Priority))
				{
					pITaskElement.SetAttributeAsLong("Priority", i_Priority);
				}
			}
		}
		catch(e)
		{
			pITaskElement.DetachFromParent();
			pITaskElement.Destroy();

			throw e;
		}
	}


	function PDHF_BuildDemoteCmdRecord(i_ItemIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("DEMOTEITEMS_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskIDs", PDHF_StringFromIDEnum(i_ItemIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildPromoteCmdRecord(i_ItemIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("PROMOTEITEMS_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskIDs", PDHF_StringFromIDEnum(i_ItemIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildAddPredecessorsCmdRecord(i_ID, i_PredecessorIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("ADDPREDECESSOR_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskID", i_ID);
		pIPseudoCommand.SetField("PredecessorIDs", PDHF_StringFromIDEnum(i_PredecessorIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildRemovePredecessorsCmdRecord(i_ID, i_PredecessorIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("REMOVEPREDECESSOR_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskID", i_ID);
		pIPseudoCommand.SetField("PredecessorIDs", PDHF_StringFromIDEnum(i_PredecessorIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildImportCmdRecord(i_pIImportCmdElement)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("IMPORTITEMS_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetFieldAsElement("ImportList", i_pIImportCmdElement);

		return pIPseudoCommand;
	}

	//
	// Transaction requirements: WRITE
	// Returns true if this is a pseudo command, false if something else
	function PDHF_ExcutePseudoCommand(i_pIPseudoCommandRecord)
	{
		// dispatch command
		switch(i_pIPseudoCommandRecord.Type)
		{
			case "urn:groove.net:ProjectAddTasksCmdRecord":
				PDHF_ExecuteAddTaskPseudoCommand(i_pIPseudoCommandRecord);
				return true;
			case "urn:groove.net:ProjectRecalculateCmdRecord":
				PDHF_ExecuteRecalculateCommand(i_pIPseudoCommandRecord);
				return true;
			case "urn:groove.net:ProjectAddPredecessorsCmdRecord":
				PDHF_ExecuteAddPredecessorsCommand(i_pIPseudoCommandRecord);
				return true;
			case "urn:groove.net:ProjectRemovePredecessorsCmdRecord":
				PDHF_ExecuteRemovePredecessorsCommand(i_pIPseudoCommandRecord);
				return true;
			case "urn:groove.net:ProjectDeleteItemsCmdRecord":
				PDHF_ExecuteDeleteItemsCommand(i_pIPseudoCommandRecord);
				return true;
			case "urn:groove.net:ProjectDemoteItemsCmdRecord":
				PDHF_ExecuteDemoteItemsCommand(i_pIPseudoCommandRecord);
				break;
			case "urn:groove.net:ProjectPromoteItemsCmdRecord":
				PDHF_ExecutePromoteItemsCommand(i_pIPseudoCommandRecord);
				return true;
			case "urn:groove.net:ProjectRescheduleProjectCmdRecord":
				PDHF_ExecuteRescheduleProjectCommand(i_pIPseudoCommandRecord);
				return true;
			case "urn:groove.net:ProjectImportItemsCmdRecord":
				PDHF_ExecuteImportItemsCommand(i_pIPseudoCommandRecord);
				return true;
			default:
				return false;
		}
	}

	//
	// Assumptions: the Project record is never created through a pseudo command
	//
	// Note about validating relationships:  when calculation is deferred,
	// we ask the relationship manager to skip cycle detection (and other checks
	// added for robustness) for tasks added by this endpoint to improve performance 
	// (on this endpoint only) during bulk adds.  This really should be addressed via an 
	// AddMultipleTasks/Relationships API in the future.
	//
	function PDHF_ExecuteAddTaskPseudoCommand(i_pIProjectAddTaskCmdRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var pIAddedIDEnum = PDHF_IDEnumFromString(i_pIProjectAddTaskCmdRecord.OpenField("TaskIDs"));
		var pIUpdateEnum = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecuteAddTaskCommand())
		{
			PDHF_SetAccessDeniedError("Cannot add new items");
			return;
		}

		while(pIAddedIDEnum.HasMore())
		{
			var ID = pIAddedIDEnum.OpenNext();
			if(true == RecordSetEngine.HasRecord(ID) && false == PDHF_HasChildren(ID))
			{
				var pIRecord = RecordSetEngine.OpenRecord(ID);
				var ParentID = pIRecord.OpenField("_ParentID");

				// if parent was deleted, remove the record and re-add it with 
				// the project singleton item (which always exists) as it's parent
				// we can't just call SetField because the collection did not add the
				// record to any of it's hierarchical indexes because the parent did not
				// exist at add time
				if(false == RecordSetEngine.HasRecord(ParentID))
				{
					ParentID = GrooveRunTimeData.GetItem("PROJECT_ID");
					pIRecord = pIRecord.Clone();

					RecordSetEngine.RemoveRecord(ID);
					
					pIRecord.SetFieldAsDouble("_ParentID", ParentID);
					RecordSetEngine.AddRecord(pIRecord);
				}

				// remove any predecessors from the parent, since summary tasks
				// cannot have predecessors
				RelationshipManager.DeleteRelationshipsWithRecord("Predecessor", GrooveRelationshipSide_Right, ParentID);

				var ValidateRelationships = (false == PDHF_IsCalculationDeferred() ||
											 false == PDHF_IsLocalDelta()); // see comment above

				// create new parent/child relationship
				PDHF_CreateParentChildRelationship(ParentID, pIRecord.RecordID, ValidateRelationships);

				// remember what we have actually processed
				pIUpdateEnum.Add(ID);
			}
		}

		if(PDHF_IsDebugEnabled())
		{
			DebugValidateParentChildRelationships();
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdateEnum.DoubleEnum);
		}
	}

	function PDHF_ExecuteRescheduleProjectCommand(i_pIRescheduleProjectCmdRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		// check permission
		var pIRecalculateIDEnum = CreateDoubleEnum();
		pIRecalculateIDEnum.Add(GrooveRunTimeData.GetItem("PROJECT_ID"));

		if(false == PDHF_CanExecuteRescheduleProjectCommand())
		{
			PDHF_SetAccessDeniedError("Cannot change project schedule info");
			return;
		}

		var ProjectID = GrooveRunTimeData.GetItem("PROJECT_ID");
		var NewStart = i_pIRescheduleProjectCmdRecord.OpenField("ScheduledStart");
		var pIProjectRecord = RecordSetEngine.OpenRecord(ProjectID);
		var OrigStart = pIProjectRecord.OpenField("ScheduledStart");
		var StartChange;
		var pIAllItems;

		// determine duration in work days (function requires start
		// to be earlier than finish)
		if(NewStart > OrigStart)
		{
			StartChange = PDHF_GetWorkWeekDuration(OrigStart, NewStart);
		}
		else
		{
			StartChange = -PDHF_GetWorkWeekDuration(NewStart, OrigStart);
		}


		// update the project start date
		pIProjectRecord.SetFieldAsDouble("ScheduledStart", NewStart);


		// if the start date changed, we need to offset all start constraint
		// by the same amount the project start date has changed
		if(true == PDHF_HasChildren(ProjectID))
		{
			pIAllItems = Collection.OpenCollection().Collection2.OpenDescendantRecordIDEnum(ProjectID, -1, GrooveDescendantEnumerationOrder_DepthFirst);
		}
		else
		{
			pIProjectRecord.SetFieldAsDouble("ScheduledFinish", NewStart);
			return;
		}
		
		while(pIAllItems.HasMore())
		{
			var CurrentID = pIAllItems.OpenNext();
			var pICurrentRecord = RecordSetEngine.OpenRecord(CurrentID);

			var CurrentUserStart = pICurrentRecord.OpenField("UserStartConstraint");
			var NewUserStart = PDHF_WorkWeekAddDuration(CurrentUserStart, StartChange);
			pICurrentRecord.SetFieldAsDouble("UserStartConstraint", NewUserStart);
		}

		pIAllItems.Reset();
		PDHF_UpdateChangedItems(pIAllItems);
	}

	function PDHF_ExecuteRecalculateCommand(i_pIProjectRecalculateCmdRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var pITaskListElement = i_pIProjectRecalculateCmdRecord.OpenFieldAsElement("TaskList");
		var StatusOnly = i_pIProjectRecalculateCmdRecord.OpenField("StatusOnly");
		var pIUpdatedIDEnum = CreateDoubleEnum();

		// extract ID enum
		var pIRecalculateIDEnum = CreateDoubleEnum();
		for(var i = 0; i < pITaskListElement.GetContentCount(); ++i)
		{
			var pITaskElement = pITaskListElement.OpenContentElement(i);
			pIRecalculateIDEnum.Add(pITaskElement.OpenAttributeAsDouble("ID"));
		}
		pIRecalculateIDEnum = pIRecalculateIDEnum.DoubleEnum;

		// check permission
		if(false == PDHF_CanExecuteRecalculateCommand(pIRecalculateIDEnum, StatusOnly))
		{
			PDHF_SetAccessDeniedError("Cannot change item schedule info");
			return;
		}

		// change dates, priority, status, according to supplied command
		PDHF_ProcessRecalculateElement(StatusOnly, pITaskListElement);

		// perform the recalc
		pIRecalculateIDEnum.Reset();
		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			while(pIRecalculateIDEnum.HasMore())
			{
				var ID = pIRecalculateIDEnum.OpenNext();
				if(true == RecordSetEngine.HasRecord(ID) && false == PDHF_HasChildren(ID))
				{
					pIUpdatedIDEnum.Add(ID);
				}
			}

			PDHF_UpdateChangedItems(pIUpdatedIDEnum.DoubleEnum, StatusOnly);
		}
	}


	function PDHF_ExecuteAddPredecessorsCommand(i_pIProjectAddPredecessorsCmdRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var DependantID = i_pIProjectAddPredecessorsCmdRecord.OpenField("TaskID");
		var pIPredecessorIDEnum = PDHF_IDEnumFromString(i_pIProjectAddPredecessorsCmdRecord.OpenField("PredecessorIDs"));
		var pIUpdateIDEnum = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecuteAddRemovePredecessorsCommand(DependantID))
		{
			PDHF_SetAccessDeniedError("Cannot add predecessors");
			return;
		}

		// do nothing if dependant has been deleted
		if(false == RecordSetEngine.HasRecord(DependantID))
		{
			return;
		}

		// if the task is a summary task, it cannot have predecessors, so do nothing
		if(PDHF_HasChildren(DependantID))
		{
			return;
		}

		// add the new predecessors
		while(pIPredecessorIDEnum.HasMore())
		{
			var CurrentPredecessorID = pIPredecessorIDEnum.OpenNext();
			
			// if the predecessor exists and adding it will not cause a cycle
			// in the realationship graph, add it

			// Note about validating relationships:  when calculation is deferred,
			// we ask the relationship manager to skip cycle detection (and other checks
			// added for robustness) for tasks added by this endpoint to improve performance 
			// (on this endpoint only) during bulk adds.  This really should be addressed via an 
			// AddMultipleTasks/Relationships API in the future.

			var bValidate = (false == PDHF_IsCalculationDeferred() ||
							 false == PDHF_IsLocalDelta());
			if(true == RecordSetEngine.HasRecord(CurrentPredecessorID) &&
				(false == bValidate || false == RelationshipManager.DetectRelationshipCycle("Predecessor", CurrentPredecessorID, DependantID)))
			{
				RelationshipManager.CreateRelationship("Predecessor", CurrentPredecessorID, DependantID, bValidate);
				pIUpdateIDEnum.Add(DependantID); // remember that the dependant needs a recalc
			}
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdateIDEnum.DoubleEnum);
		}
	}

	function PDHF_ExecuteRemovePredecessorsCommand(i_pIProjectRemovePredecessorsCmdRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var DependantID = i_pIProjectRemovePredecessorsCmdRecord.OpenField("TaskID");
		var pIPredecessorIDEnum = PDHF_IDEnumFromString(i_pIProjectRemovePredecessorsCmdRecord.OpenField("PredecessorIDs"));
		var pIValidPredecessorEnum = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecuteAddRemovePredecessorsCommand(DependantID))
		{
			PDHF_SetAccessDeniedError("Cannot remove predecessors");
			return;
		}

		// first determine which predecessors actually exist
		while(pIPredecessorIDEnum.HasMore())
		{
			var PredecessorID = pIPredecessorIDEnum.OpenNext();

			if(RecordSetEngine.HasRecord(PredecessorID) && RecordSetEngine.HasRecord(DependantID))
			{
				var RelationshipID = RelationshipManager.FindRelationship("Predecessor", PredecessorID, DependantID);
				if(0 != RelationshipID)
				{
					pIValidPredecessorEnum.Add(PredecessorID);
				}
			}
		}
		pIValidPredecessorEnum = pIValidPredecessorEnum.DoubleEnum;

		// determine which items need to be recalculated (note that we 
		// do not need to recalculate the predecessors being removed)
		var pIUpdateIDEnum = PDHF_GetDependantRecordsForUpdate(pIValidPredecessorEnum);

		// delete the predecessor relationships
		while(pIValidPredecessorEnum.HasMore())
		{
			var PredecessorID = pIValidPredecessorEnum.OpenNext();
			var RelationshipID = RelationshipManager.FindRelationship("Predecessor", PredecessorID, DependantID);

			// remove the realtionship
			RelationshipManager.DeleteRelationship(RelationshipID);
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			// recalc effected items
			pIUpdateIDEnum.Reset();
			PDHF_RecalculateItems(pIUpdateIDEnum.DoubleEnum);
		}
	}


	function PDHF_ExecuteDeleteItemsCommand(i_pIProjectDeleteItemsCmdRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var pIDeleteIDEnum = PDHF_IDEnumFromString(i_pIProjectDeleteItemsCmdRecord.OpenField("TaskIDs"));
		var DeleteList = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecuteDeleteCommand(pIDeleteIDEnum))
		{
			PDHF_SetAccessDeniedError("Cannot delete the specified items");
			return;
		}

		pIDeleteIDEnum.Reset();
		while(pIDeleteIDEnum.HasMore())
		{
			var ID = pIDeleteIDEnum.OpenNext();

			if(GrooveRunTimeData.GetItem("PROJECT_ID") == ID)
			{
				GrooveDebugFunctions.DisplayAssert(0, "Attempt to delete project item");
				return;
			}

			// only try to delete records that exist
			if(RecordSetEngine.HasRecord(ID))
			{
				// remove the specified item
				DeleteList.Add(ID);
			}
		}

		// If the delete list contains children of nodes that are going to be deleted,
		// take them out of the list so that the list of dependant records does not
		// include any of those that have just been deleted.  Also, convert the interface
		// to IGrooveDoubleEnum in the process
		DeleteList = PDHF_RemoveRedundantDecendants(DeleteList.DoubleEnum);
		DeleteList.Reset();

		// find the records that need to be recalculated before we perform the delete
		// note that we cannot include the deleted items in the list
		var pIUpdateIDEnum = PDHF_GetDependantRecordsForUpdate(DeleteList);

		// delete the items -- relationships with the items are automatically destroyed
		// AM - we MUST delete the hierarchical items in depth first order to ensure that
		// when an UNDO operation is performed, the parent items are re-done (added) before the
		// children.  This is important because the collection will ignore items that
		// are added with an invalid parent, which would cause the collection to get out
		// of sync.
		DeleteList.Reset();
		while(DeleteList.HasMore())
		{
			var ID = DeleteList.OpenNext();
			var pIChildIDEnum = RecordSetEngine.HierarchicalRecordSetEngine.OpenDescendantRecordIDEnum
																				(
																					ID,
																					-1,
																					GrooveDescendantEnumerationOrder_DepthFirst
																				);
			PDHF_DeleteMultipleItems(pIChildIDEnum);
			RecordSetEngine.RemoveRecord(ID);
		}

		if(PDHF_IsDebugEnabled())
		{
			DebugValidateParentChildRelationships();
		}

		// AM - the trick that we use above (prune redundant decendants BEFORE
		// running the topographical sort) to avoid recalculating items that have 
		// just been deleted does not cover all bases.  In the case where we have:
		//
		//	Root
		//		A
		//		B
		//		  C
		//
		// and A is a predecessor of C, we only ask the relationship manager for the
		// ordered sort based on [A, B] changing (since C was pruned as a redundant
		// descendant).  The resulting update list will then be [C, Root], which will
		// cause a problem when we try to recalculate, since C has just been deleted.
		// To plug this hole, we need to fix up the list here by removing items that
		// no longer exist.
		var pIExistingUpdateIDEnum = CreateDoubleEnum();
		while(pIUpdateIDEnum.HasMore())
		{
			var CurrentID = pIUpdateIDEnum.OpenNext();
			if(RecordSetEngine.HasRecord(CurrentID))
			{
				pIExistingUpdateIDEnum.Add(CurrentID);
			}
		}
		pIUpdateIDEnum = pIExistingUpdateIDEnum.DoubleEnum;

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_RecalculateItems(pIUpdateIDEnum);
		}
	}

	//
	// Demoting an item (indent) has the following impact on the data model:
	// 1) The demoted item becomes a child of it's previous sibling
	//
	function PDHF_ExecuteDemoteItemsCommand(i_pIProjectDemoteItemsCmdRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var pIDemoteIDEnum = PDHF_IDEnumFromString(i_pIProjectDemoteItemsCmdRecord.OpenField("TaskIDs"));
		var pIUpdateEnum = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecutePromoteDemoteCommand(pIDemoteIDEnum))
		{
			PDHF_SetAccessDeniedError("Cannot demote items");
			return;
		}

		// adjust relationships for items that can be demoted --order of operations
		// is important for searching
		pIDemoteIDEnum.Reset();
		while(pIDemoteIDEnum.HasMore())
		{
			var CurrentDemoteID = pIDemoteIDEnum.OpenNext();

			// only perform the demote if it will not generate a cycle
			// (for example, when the new parent is a predecessor of the item being demoted)
			// and when the item is not the first child of the parent
			// Note that we must perform the check inside of this loop since the previous
			// sibling of the demotee will change as we go
			if(-1 != PDHF_GetPreviousSiblingID(CurrentDemoteID) &&
			   false == PDHF_DoesDemoteCreateCycle(CurrentDemoteID))
			{
				var NewParentID = PDHF_GetPreviousSiblingID(CurrentDemoteID);

				GrooveDebugFunctions.DisplayAssert(-1 != NewParentID, "Invalid parent id");

				// remove existing parent/child relationship
				PDHF_DeleteParentChildRelationship(CurrentDemoteID);

				// create new parent/child relationship
				PDHF_CreateParentChildRelationship(NewParentID, CurrentDemoteID);

				// make RSE reparent the items
				RecordSetEngine.HierarchicalRecordSetEngine.DemoteRecord(CurrentDemoteID);

				// the NewParent may have become a parent as a result of the demote
				// so we need to make sure it does not have any predecessors since
				// parent's cant have predecessors (this also deletes any child-to-parent
				// predecessor dependencies)
				RelationshipManager.DeleteRelationshipsWithRecord("Predecessor", GrooveRelationshipSide_Right, NewParentID);

				// no need to look for the case where the parent is the predecessor
				// of the child because this generates a dependency cycle and so it
				// was trapped in the code above
				
				// we do not need to update the old parent because, by definition,
				// it is the grandparent of the item being demoted
				pIUpdateEnum.Add(NewParentID);

				// if the item was a task, the dates are unchanged
				// if the item was a parent, the start/duration/finish that were
				// calculated now become static and we only need to recalculate the 
				// date for our new ancestors
				//  ==> the demoted item does not need to be recalculated
			}
		}


		if(PDHF_IsDebugEnabled())
		{
			DebugValidateParentChildRelationships();
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdateEnum.DoubleEnum);
		}
	}

	//
	// Promoting an item (outdent) has the following impact on the data model:
	// 1) The promoted item's grandparent becomes it's new parent
	//
	function PDHF_ExecutePromoteItemsCommand(i_ProjectPromoteItemsCmdRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var pIPromoteIDEnum = PDHF_IDEnumFromString(i_ProjectPromoteItemsCmdRecord.OpenField("TaskIDs"));
		var pIUpdateEnum = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecutePromoteDemoteCommand(pIPromoteIDEnum))
		{
			PDHF_SetAccessDeniedError("Cannot promote items");
			return;
		}

		pIPromoteIDEnum.Reset();
		while(pIPromoteIDEnum.HasMore())
		{
			var CurrentPromoteID = pIPromoteIDEnum.OpenNext();

			// ignore deleted records
			if(RecordSetEngine.HasRecord(CurrentPromoteID))
			{
				var WasParent = PDHF_HasChildren(CurrentPromoteID);
				var OldParentID = PDHF_GetParentID(CurrentPromoteID);

				// ignore the promote command if the collection is hosed
				if(-1 == OldParentID)
				{
					GrooveDebugFunctions.DisplayAssert(0, "Invalid parent");
					continue;
				}

				// do not allow item to be promoted past the root
				if(GrooveRunTimeData.GetItem("PROJECT_ID") == OldParentID)
				{
					continue;
				}

				// remove relationship with old parent
				PDHF_DeleteParentChildRelationship(CurrentPromoteID);
				
				// make the RSE reparent the item
				RecordSetEngine.HierarchicalRecordSetEngine.PromoteRecord(CurrentPromoteID);

				// create realtionship with new parent
				var NewParentID = PDHF_GetParentID(CurrentPromoteID);
				PDHF_CreateParentChildRelationship(NewParentID, CurrentPromoteID);

				// promote has no effect on the dates of the promoted item, 
				// only on the dates of it's new and old parents
				pIUpdateEnum.Add(NewParentID)
				pIUpdateEnum.Add(OldParentID);
			}
		}

		if(PDHF_IsDebugEnabled())
		{
			DebugValidateParentChildRelationships();
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdateEnum.DoubleEnum);
		}
	}


	function PDHF_ExecuteImportItemsCommand(i_pIPseudoCommandRecord)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var pIImportElement = i_pIPseudoCommandRecord.OpenFieldAsElement("ImportList");
		var CheckForCycles = pIImportElement.OpenAttributeAsBool("NeedsCycleCheck");
		var pIUpdateEnum = CreateDoubleEnum();

		if(false == PDHF_CanExecuteAddTaskCommand())
		{
			PDHF_SetAccessDeniedError("Cannot add new items");
			return;
		}

		for(var i = 0; i < pIImportElement.GetContentCount(); ++i)
		{
			var pITaskElement = pIImportElement.OpenContentElement(i);
			var ID = pITaskElement.OpenAttributeAsDouble("ID");

			if(true == RecordSetEngine.HasRecord(ID))
			{
				var pIRecord = RecordSetEngine.OpenRecord(ID);
				var ParentID = pIRecord.OpenField("_ParentID");

				// if parent was deleted, remove the record and re-add it with 
				// the project singleton item (which always exists) as it's parent
				// we can't just call SetField because the collection did not add the
				// record to any of it's hierarchical indexes because the parent did not
				// exist at add time
				if(false == RecordSetEngine.HasRecord(ParentID))
				{
					ParentID = GrooveRunTimeData.GetItem("PROJECT_ID");
					pIRecord = pIRecord.Clone();

					RecordSetEngine.RemoveRecord(ID);
					
					pIRecord.SetFieldAsDouble("_ParentID", ParentID);
					RecordSetEngine.AddRecord(pIRecord);
				}

				// remove any predecessors from the parent, since summary tasks
				// cannot have predecessors
				RelationshipManager.DeleteRelationshipsWithRecord("Predecessor", GrooveRelationshipSide_Right, ParentID);

				// create new parent/child relationship
				PDHF_CreateParentChildRelationship(ParentID, pIRecord.RecordID, CheckForCycles);

				// 
				// We only include the leaf nodes that do not have predecessors 
				// in our update list to reduce the work that the relationship 
				// manager has to perform.  
				//
				if(true != PDHF_HasChildren(ID))
				{
					if(0 == pITaskElement.GetContentCount())
					{
						// remember what we have actually processed
						pIUpdateEnum.Add(ID);
					}
					
					// add predecessors for leaves (not supported for summary tasks)
					for(var j = 0; j < pITaskElement.GetContentCount(); ++j)
					{
						var pIPredecessorElement = pITaskElement.OpenContentElement(j);
						var PredecessorID = pIPredecessorElement.OpenAttributeAsDouble("ID");

						RelationshipManager.CreateRelationship("Predecessor", PredecessorID, ID, CheckForCycles);
					}
				}
			}
			else
			{
				GrooveDebugFunctions.DisplayAssert(0, "Missing record");
			}
		}

		if(PDHF_IsDebugEnabled())
		{
			DebugValidateParentChildRelationships();
		}

		PDHF_UpdateChangedItems(pIUpdateEnum.DoubleEnum);
	}

	////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////
	//
	// Calculation functions
	//


	
	//
	// Recalculate all changed items and any items dependant on them
	//
	function PDHF_UpdateChangedItems(i_pIChangedItemsIDEnum, i_StatusOnly)
	{
		var pIUpdateIDEnum = PDHF_GetEffectedRecordsForUpdate(i_pIChangedItemsIDEnum);
		PDHF_RecalculateItems(pIUpdateIDEnum, i_StatusOnly);
	}


	//
	// Recalculate the items specified in the provided ID enum
	//
	function PDHF_RecalculateItems(i_pIEffectedIDEnum, i_StatusOnly)
	{
		var ProgressRefreshMS = 250; // 4 per second

		// start asynch progress notification
		PDHF_BeginProgress();

		try
		{
			// how many recalcs?
			var NumCalculations = 0;
			while(i_pIEffectedIDEnum.HasMore())
			{
				var CurrentID = i_pIEffectedIDEnum.OpenNext();
				++NumCalculations;				
			}
			i_pIEffectedIDEnum.Reset();

			var CalculationNumber = 0;
			var LastProgressEvent = new Date();
			while(i_pIEffectedIDEnum.HasMore())
			{
				var CurrentID = i_pIEffectedIDEnum.OpenNext();
				PDHF_RecalculateItem(CurrentID, i_StatusOnly);

				// don't give too many progress updates
				var CurrentEvent = new Date();
				var PercentComplete = Math.round(++CalculationNumber * 100 / NumCalculations);
				if(100 == PercentComplete ||
				   ProgressRefreshMS < CurrentEvent.valueOf() - LastProgressEvent.valueOf())
				{
					PDHF_UpdateProgress(PercentComplete);
					LastProgressEvent = CurrentEvent;
				}
			}

			PDHF_EndProgress();
		}
		catch(e)
		{
			PDHF_EndProgress();
			throw e;
		}
	}


	//
	// Recalculate the item according to it's type
	// If we are only recalculating the status, we can
	// skip task items.
	//
	function PDHF_RecalculateItem(i_Item, i_StatusOnly)
	{
		var StatusOnly = false;
		if("undefined" != typeof(i_StatusOnly))
		{
			StatusOnly = i_StatusOnly;
		}

		if(true == PDHF_HasChildren(i_Item) || i_Item == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			PDHF_CalculateSummaryDates(i_Item, StatusOnly);
		}
		else
		{
			if(false == StatusOnly)
			{
				PDHF_CalculateTaskDates(i_Item);
			}
		}
	}


	//
	// Return an ordered list of items that need to be recalculated
	// given the provided set of items that have just changed.  The
	// returned list contains the input items.
	//
	// Assumptions: all records in i_pIChangedItemsIDEnum exist
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetEffectedRecordsForUpdate(i_pIChangedItemsIDEnum)
	{
		return RelationshipManager.FindSortedRecordsByRelationships("DependencyGraph", i_pIChangedItemsIDEnum);
	}


	//
	// Return an ordered list of items that need to be recalculated
	// given the provided set of items that have just changed.  The
	// returned list does not contain any of the input items.
	//
	// Assumptions: all records in i_pIChangedItemsIDEnum exist
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetDependantRecordsForUpdate(i_pIChangedItemsIDEnum)
	{
		var pIUpdateEnum = CreateDoubleEnum();
		var SparseArray = PDHF_SparseArrayFromEnum(i_pIChangedItemsIDEnum);
		var pIOrderedChangeEnum = RelationshipManager.FindSortedRecordsByRelationships("DependencyGraph", i_pIChangedItemsIDEnum);

		i_pIChangedItemsIDEnum.Reset();
		while(pIOrderedChangeEnum.HasMore())
		{
			var CurrentID = pIOrderedChangeEnum.OpenNext();
			if(false == SparseArray.Contains(CurrentID))
			{
				// ID not in the input list so include it in the result set
				pIUpdateEnum.Add(CurrentID);
			}
		}

		return pIUpdateEnum.DoubleEnum;
	}


	//
	// Assumptions: i_TaskID exists and does not have any children
	//
	// If possible, we leave the scheduled start date untouched to allow 
	// user entered dates to persist until something forces them to change
	//
	// TRANSACTION_REQUIREMENTS: WRITE
	function PDHF_CalculateTaskDates(i_TaskID)
	{		
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var pIProjectRecord = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("PROJECT_ID"));
		var pITaskRecord = RecordSetEngine.OpenRecord(i_TaskID);
		var pIPredecessorEnum = RelationshipManager.FindRecordsByRelationship("Predecessor", GrooveRelationshipSide_Right, i_TaskID);

		// get current start and duration
		var Start = pITaskRecord.OpenField("ScheduledStart");
		var ProjectStart = pIProjectRecord.OpenField("ScheduledStart");
		var ConstrainStartDate = pITaskRecord.OpenField("ConstrainStartDate");
		var Duration = pITaskRecord.OpenField("ScheduledDuration");
		var CalculatedStart = ProjectStart;

		// start date can be constrained by the user
		if(true == ConstrainStartDate)
		{
			var UserStart = pITaskRecord.OpenField("UserStartConstraint");
			if(UserStart > CalculatedStart)
			{
				CalculatedStart = UserStart;	
			}
		}

		// the start date cannot be earlier than the project start date
		if(ProjectStart > CalculatedStart)
		{
			CalculatedStart = ProjectStart;
		}

		// calculate the start date based on the predecessors and user-start date constraint
		if(pIPredecessorEnum.HasMore())
		{
			var LatestPredecessorFinish = CalculatedStart;
			while(pIPredecessorEnum.HasMore())
			{
				var CurrentPredecessorID = pIPredecessorEnum.OpenNext();
				var pIRecord = RecordSetEngine.OpenRecord(CurrentPredecessorID);
				var PredecessorFinish = pIRecord.OpenField("ScheduledFinish");

				if(PredecessorFinish > LatestPredecessorFinish)
				{
					LatestPredecessorFinish = PredecessorFinish;
				}
			}

			CalculatedStart = LatestPredecessorFinish;
		}

		// determine the work week start and finish dates
		CalculatedStart = PDHF_GetStartInWorkWeek(CalculatedStart);
		var CalculatedFinish = PDHF_GetFinishInWorkWeek(CalculatedStart, Duration);

		pITaskRecord.SetField("ScheduledStart", CalculatedStart);
		pITaskRecord.SetField("ScheduledFinish", CalculatedFinish);
	}


	//
	// Assumptions: i_SummaryTaskID exists
	//
	// TRANSACTION_REQUIREMENTS: WRITE
	//
	// A note about calculations:
	//	ScheduledStart is the earliest of all children start dates
	//  ScheduledFinish is the latest of all children end dates
	//  ScheduledDuration is the difference of these two
	//	Status is InProgress if at least one item is not "NotStarted" and is
	//		"Complete" if all children are complete
	//	Priority is the highest priority of all children
	//
	function PDHF_CalculateSummaryDates(i_SummaryTaskID, i_StatusOnly)
	{
		var EarliestScheduledStart = Number.MAX_VALUE;
		var LatestScheduledFinish = 0;
		var EarliestActualStart = Number.MAX_VALUE;
		var LatestActualFinish = 0;
		var StatusStarted = false;
		var StatusCompleted = true;
		var HighestPriority = GrooveProjectToolsetPriorityType_Low;
		var MSPERDAY = 1000 * 60 * 60 * 24;

		var pISummaryTaskRecord = RecordSetEngine.OpenRecord(i_SummaryTaskID);
		var pIChildEnum = PDHF_GetChildrenFromRelationships(i_SummaryTaskID);
		pIChildEnum.Reset();

		if(false == pIChildEnum.HasMore() && i_SummaryTaskID != GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			GrooveDebugFunctions.DisplayAssert(0, "This is not a summary task!");
			return;
		}

		// if the project does not contain any items, mark it as "not started"
		if(i_SummaryTaskID == GrooveRunTimeData.GetItem("PROJECT_ID") && false == pIChildEnum.HasMore())
		{
			StatusStarted = false;
			StatusCompleted = false;	
		}

		while(pIChildEnum.HasMore())
		{
			var ChildID = pIChildEnum.OpenNext();
			var pIChildRecord = RecordSetEngine.OpenRecord(ChildID);
			var ScheduledStart = pIChildRecord.OpenField("ScheduledStart");
			var ScheduledFinish = pIChildRecord.OpenField("ScheduledFinish");
			var Status = pIChildRecord.OpenField("Status");
			var Priority = pIChildRecord.OpenField("Priority");

			// scheduled start
			if(ScheduledStart < EarliestScheduledStart)
			{
				EarliestScheduledStart = ScheduledStart;
			}

			// scheduled finish
			if(ScheduledFinish > LatestScheduledFinish)
			{
				LatestScheduledFinish = ScheduledFinish;
			}

			// status
			StatusStarted |= (Status == GrooveProjectToolsetStatusType_InProgress || Status == GrooveProjectToolsetStatusType_Complete);
			StatusCompleted &= (Status == GrooveProjectToolsetStatusType_Complete);

			// priority
			if(Priority > HighestPriority)
			{
				HighestPriority = Priority;
			}

			// actual start
			if(GrooveProjectToolsetStatusType_InProgress == Status || 
			   GrooveProjectToolsetStatusType_Complete == Status)
			{
				var ActualStart = pIChildRecord.OpenField("ActualStart");
				if(ActualStart < EarliestActualStart)
				{
					EarliestActualStart = ActualStart;
				}
			}

			// actual finish
			if(GrooveProjectToolsetStatusType_Complete == Status)
			{
				var ActualFinish = pIChildRecord.OpenField("ActualFinish");
				if(ActualFinish > LatestActualFinish)
				{
					LatestActualFinish = ActualFinish;
				}
			}
		}

		// scheduled start/finish/duration 
		// -- scheduled start is NOT calculated for the project item, as it is a
		// fixed point in time.  
		// -- since the project start date is fixed in time, make sure we calculate
		// the duration appropriately
		if(i_SummaryTaskID != GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			if(LatestScheduledFinish < EarliestScheduledStart)
			{
				GrooveDebugFunctions.DisplayAssert(0, "Ruh-ro");
				LatestScheduledFinish = EarliestScheduledStart;
			}

			var Duration = PDHF_GetWorkWeekDuration(EarliestScheduledStart, LatestScheduledFinish);

			pISummaryTaskRecord.SetField("ScheduledStart", EarliestScheduledStart);
			pISummaryTaskRecord.SetFieldAsDouble("ScheduledDuration", Duration);
		}
		else
		{
			var ProjectStart = pISummaryTaskRecord.OpenField("ScheduledStart");
			
			// if the project is empty, LastScheduledFinish will still be uninitialized
			if(0 == LatestScheduledFinish)
			{
				LatestScheduledFinish = ProjectStart;
			}

			var Duration = PDHF_GetWorkWeekDuration(ProjectStart, LatestScheduledFinish);

			pISummaryTaskRecord.SetFieldAsDouble("ScheduledDuration", Duration);
		}

		pISummaryTaskRecord.SetField("ScheduledFinish", LatestScheduledFinish);

		// status
		var NewStatus;
		if(true == StatusCompleted)
		{
			NewStatus = GrooveProjectToolsetStatusType_Complete;
		}
		else if(true == StatusStarted)
		{
			NewStatus = GrooveProjectToolsetStatusType_InProgress;
		}
		else
		{
			NewStatus = GrooveProjectToolsetStatusType_NotStarted;
		}

		pISummaryTaskRecord.SetField("Status", NewStatus);

		// actual start
		if(GrooveProjectToolsetStatusType_InProgress == NewStatus || 
		   GrooveProjectToolsetStatusType_Complete == NewStatus)
		{
			pISummaryTaskRecord.SetFieldAsDouble("ActualStart", EarliestActualStart);
		}

		// actual finish
		if(GrooveProjectToolsetStatusType_Complete == Status)
		{
			pISummaryTaskRecord.SetFieldAsDouble("ActualFinish", LatestActualFinish);
		}

		// priority
		pISummaryTaskRecord.SetField("Priority", HighestPriority);
	}


	//
	// return a date (in ms) of the first work day occuring on or
	// after i_Start
	//
	function PDHF_GetStartInWorkWeek(i_Start)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pIDate = pIIntl.CreateDateFromRawDateTime(i_Start);
		var pICalendar = pIIntl.CreateCalendar();
		
		pICalendar.DateTime = pIDate;
		
		// begin at the start of the day
		var Year = pICalendar.Get(GrooveIntlCalendarField_Year);
		var Month = pICalendar.Get(GrooveIntlCalendarField_Month);
		var Day = pICalendar.Get(GrooveIntlCalendarField_DayOfMonth);
		pICalendar.Clear();
		pICalendar.SetDate(Year, Month, Day);
		
		var DayOfWeek = pICalendar.Get(GrooveIntlCalendarField_DayOfWeek);

		if(DayOfWeek == GrooveIntlCalendarDayOfWeek_Sunday)
		{
			pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, 1);
		}
		else if(DayOfWeek == GrooveIntlCalendarDayOfWeek_Saturday)
		{
			pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, 2);
		}

		return pICalendar.DateTime.RawDateTime;
	}

	//
	// return the finish date (in ms) given the specified start
	// and duration and work-week
	//
	function PDHF_GetFinishInWorkWeek(i_Start, i_Duration)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var NUMWORKDAYS = 5;
		var DAYSPERWEEK = 7;
		var DAYSOFF = DAYSPERWEEK - NUMWORKDAYS;
		var MSPERDAY = 1000 * 60 * 60 * 24;

		var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pIDate = pIIntl.CreateDateFromRawDateTime(i_Start);
		var pICalendar = pIIntl.CreateCalendar();

		pICalendar.DateTime = pIDate;

		var StartDayOfWeek = pICalendar.Get(GrooveIntlCalendarField_DayOfWeek);
		var DurationDays = i_Duration / MSPERDAY;
		var FullWorkWeeks = Math.floor(DurationDays / NUMWORKDAYS);
		var PartialWorkWeekDays = DurationDays % NUMWORKDAYS;

		GrooveDebugFunctions.DisplayAssert(StartDayOfWeek != GrooveIntlCalendarDayOfWeek_Saturday &&
									StartDayOfWeek != GrooveIntlCalendarDayOfWeek_Sunday,
									"Invalid start day of week");

		// weeks
		pICalendar.Add(GrooveIntlCalendarField_WeekOfYear, FullWorkWeeks);

		// days
		// wrap the weekend, if necessary
		if(StartDayOfWeek + PartialWorkWeekDays > GrooveIntlCalendarDayOfWeek_Friday)
		{
			pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, DAYSOFF);
		}

		pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, PartialWorkWeekDays);

		return pICalendar.DateTime.RawDateTime;
	}

	//
	// return the duration in work-week days (in ms)
	// assumptions: i_Start and i_Finish are work days
	function PDHF_GetWorkWeekDuration(i_Start, i_Finish)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var NUMWORKDAYS = 5;
		var DAYSPERWEEK = 7;
		var DAYSOFF = DAYSPERWEEK - NUMWORKDAYS;
		var MSPERDAY = 1000 * 60 * 60 * 24;

		var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pIStartDate = pIIntl.CreateDateFromRawDateTime(i_Start);
		var pIFinishDate = pIIntl.CreateDateFromRawDateTime(i_Finish);

		var DurationMS = pIFinishDate.GetElapsedTime(pIStartDate);
		
		// AMLATER - HACK
		// if this task spans a switch of daylight savings time,
		// we will lose an hour -- to work around this problem, we
		// round the duration to the closest integer when calculating
		// number of days
		var DurationDays = Math.round(DurationMS / MSPERDAY);
		var DurationWeeks = Math.floor(DurationDays / DAYSPERWEEK);
		var PartialWeekDays = DurationDays % DAYSPERWEEK;

		// account for wrap around a weekend
		var pIStartCalendar = pIIntl.CreateCalendar();
		pIStartCalendar.DateTime = pIStartDate;
		var pIFinishCalendar = pIIntl.CreateCalendar();
		pIFinishCalendar.DateTime = pIFinishDate;

		var StartDayOfWeek = pIStartCalendar.Get(GrooveIntlCalendarField_DayOfWeek);
		var FinishDayOfWeek = pIFinishCalendar.Get(GrooveIntlCalendarField_DayOfWeek);

		// PartialWeekDays is a number less than DAYSPERWEEK
		// but we need to account for a wrap around a weekend
		if(FinishDayOfWeek < StartDayOfWeek)
		{
			PartialWeekDays -= DAYSOFF;
		}

		return ((DurationWeeks * NUMWORKDAYS) + PartialWeekDays) * MSPERDAY;
	}

	function PDHF_WorkWeekAddDuration(i_DateMS, i_WorkWeekDuration)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "Debug");

		var NUMWORKDAYS = 5;
		var DAYSPERWEEK = 7;
		var DAYSOFF = DAYSPERWEEK - NUMWORKDAYS;
		var MSPERDAY = 1000 * 60 * 60 * 24;

		var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pIDate = pIIntl.CreateDateFromRawDateTime(i_DateMS);
		var pICalendar = pIIntl.CreateCalendar();

		pICalendar.DateTime = pIDate;

		var StartDayOfWeek = pICalendar.Get(GrooveIntlCalendarField_DayOfWeek);
		var DurationDays = i_WorkWeekDuration / MSPERDAY;
		var FullWorkWeeks = Math.floor(Math.abs(DurationDays) / NUMWORKDAYS);
		var PartialWorkWeekDays = Math.abs(DurationDays) % NUMWORKDAYS;

		// account for negative duration
		if(i_WorkWeekDuration < 0)
		{
			FullWorkWeeks = -FullWorkWeeks;
			PartialWorkWeekDays = -PartialWorkWeekDays;
		}

		GrooveDebugFunctions.DisplayAssert(StartDayOfWeek != GrooveIntlCalendarDayOfWeek_Saturday &&
									StartDayOfWeek != GrooveIntlCalendarDayOfWeek_Sunday,
									"Invalid start day of week");

		// weeks
		pICalendar.Add(GrooveIntlCalendarField_WeekOfYear, FullWorkWeeks);

		// days
		// wrap the weekend, if necessary
		if(i_WorkWeekDuration >= 0)
		{
			if(StartDayOfWeek + PartialWorkWeekDays > GrooveIntlCalendarDayOfWeek_Friday)
			{
				pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, DAYSOFF);
			}
		}
		else
		{
			// PartialWorkDays is negative -- determine if we wrap around the weekend
			if(StartDayOfWeek + PartialWorkWeekDays < GrooveIntlCalendarDayOfWeek_Monday)
			{
				pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, -DAYSOFF);
			}
		}

		pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, PartialWorkWeekDays);

		return pICalendar.DateTime.RawDateTime;
	}

	//
	// build up a space delimited string of IDs
	//
	function PDHF_IDEnumFromString(i_String)
	{
		var CurrentStart=0;
		var pIIDEnum = CreateDoubleEnum();

		if(0 == i_String.length)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Empty ID string");
			return pIIDEnum.DoubleEnum;
		}

		while(CurrentStart <= i_String.length-1)
		{
			var NextSeparator = i_String.indexOf(" ", CurrentStart);

			// if we're at the end of the list there's no trailing space
			if(-1 == NextSeparator)
			{
				NextSeparator = i_String.length;
			}

			var IDString = i_String.substr(CurrentStart, NextSeparator-CurrentStart);
			pIIDEnum.Add(IDString);
			CurrentStart = NextSeparator+1;
		}

		return pIIDEnum.DoubleEnum;
	}


	//
	// extract an IDenum from a string of space delimited IDs
	//
	function PDHF_StringFromIDEnum(i_pIDoubleEnum)
	{
		var String = "";
		i_pIDoubleEnum.Reset();
		if(false == i_pIDoubleEnum.HasMore())
		{
			return String;
		}

		String = i_pIDoubleEnum.OpenNext().toString();
		while(i_pIDoubleEnum.HasMore())
		{
			String += " ";
			String += i_pIDoubleEnum.OpenNext().toString();
		}

		return String;
	}

	function PDHF_IncrementCalculationDeferCount()
	{
		if(false == GrooveRunTimeData.HasItem("DeferCalculationCount"))
		{
			GrooveRunTimeData.SetItem("DeferCalculationCount", 0);
		}

		GrooveRunTimeData.SetItem("DeferCalculationCount", GrooveRunTimeData.GetItem("DeferCalculationCount") + 1);
	}

	function PDHF_DecrementCalculationDeferCount()
	{
		var DeferCount;
		if(false == GrooveRunTimeData.HasItem("DeferCalculationCount") ||
			0 == (DeferCount = GrooveRunTimeData.GetItem("DeferCalculationCount")))
		{
			GrooveErrorFunctions.SetCurrentError(PROJECTTRACKING_E_INVALID_OPERATION, "Unmatched call to Begin/EndMulitpleModifications.");
			return;
		}
		else
			GrooveRunTimeData.SetItem("DeferCalculationCount", --DeferCount);
	}

	function PDHF_IsCalculationDeferred()
	{
		if(GrooveRunTimeData.HasItem("DeferCalculationCount"))
		{
			return 0 != GrooveRunTimeData.GetItem("DeferCalculationCount");
		}
		return false;
	}


	function PDHF_AddListener(i_pIListener)
	{
		// AMLATER - add support for multiple listeners
		if(null != GrooveRunTimeData.GetItem("SYNCHPROGRESSCALLBACK"))
		{
			GrooveDebugFunctions.DisplayAssert(0, "Already have a listener");
			return;
		}

		GrooveRunTimeData.SetItem("SYNCHPROGRESSCALLBACK", i_pIListener);
	}

	function PDHF_RemoveListener(i_pIListener)
	{
		// AMLATER - add support for multiple listeners
		GrooveRunTimeData.SetItem("SYNCHPROGRESSCALLBACK", null);
	}

	//
	// return the progress listener if there is one and we can fire a progress
	// message for the current execution of this delta
	//
	function PDHF_GetProgressListener()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var FirstExecution = DynamicsMgr.CommandContext.FirstExecution;
		var LocallyGenerated = DynamicsMgr.CommandContext.LocallyGenerated;
		
		// if this is the first execution of the current delta and it was generated
		// on this endpoint, we are on the same thread as the UI so we can send
		// synchronous progress messages
		if(FirstExecution && LocallyGenerated)
		{
			return GrooveRunTimeData.GetItem("SYNCHPROGRESSCALLBACK");
		}

		// not on the same thread as the UI
		return null;

	}

	
	function PDHF_BeginProgress()
	{
		var pISynchronousProgress = PDHF_GetProgressListener()
		if(null != pISynchronousProgress)
		{
			pISynchronousProgress.OnProjectCalculationStartSynchronous();
		}
	}

	function PDHF_UpdateProgress(i_Progress)
	{
		var pISynchronousProgress = PDHF_GetProgressListener()
		if(null != pISynchronousProgress)
		{
			pISynchronousProgress.OnProjectCalculationUpdateSynchronous(i_Progress);
		}
	}

	function PDHF_EndProgress()
	{
		var pISynchronousProgress = PDHF_GetProgressListener()
		if(null != pISynchronousProgress)
		{
			pISynchronousProgress.OnProjectCalculationEndSynchronous();
		}
	}


	//
	// Assumptions: i_RecordID exists in a hierarchical index
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetParentID(i_RecordID)
	{
		return Collection.OpenCollection().OpenRecordID(i_RecordID, GrooveCollectionNavigationOp_PriorParent);
	}


	//
	// Return the previous sibling for the specified record
	// Assumptions: i_RecordID exists in a hierarchical index
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetPreviousSiblingID(i_RecordID)
	{
		return Collection.OpenCollection().OpenRecordID(i_RecordID, GrooveCollectionNavigationOp_PriorPeer);
	}

	//
	// Find the ID of the parent/child relationship for the specified items
	//
	function PDHF_FindParentChildRelationship(i_ParentID, i_ChildID)
	{
		var RelationshipID = 0;

		RelationshipID = RelationshipManager.FindRelationship("TaskParentChild", i_ParentID, i_ChildID);
		if(0 != RelationshipID)
		{
			return RelationshipID;
		}

		RelationshipID = RelationshipManager.FindRelationship("ProjectParentChild", i_ParentID, i_ChildID);
		if(0 != RelationshipID)
		{
			return RelationshipID;
		}

		GrooveDebugFunctions.DisplayAssert(0, "Missing ParentChild relationship");
		return RelationshipID;
	}


	//
	// create new parent/child relationship
	// 
	function PDHF_CreateParentChildRelationship(i_ParentID, i_ChildID, i_ValidateRelationships /* true */)
	{
		var ValidateRelationships = true;

		// perform validation?
		if("undefined" != typeof(i_ValidateRelationships))
		{
			ValidateRelationships = i_ValidateRelationships;
		}

		if(GrooveRunTimeData.GetItem("PROJECT_ID") == i_ParentID)
		{
			RelationshipName = "ProjectParentChild";
		}
		else
		{
			RelationshipName = "TaskParentChild";
		}

		RelationshipManager.CreateRelationship(RelationshipName, i_ParentID, i_ChildID, ValidateRelationships);
	}

	//
	// Delete the parent/child relationship with the specified child
	//
	function PDHF_DeleteParentChildRelationship(i_Child)
	{
		RelationshipManager.DeleteRelationshipsWithRecord("ProjectParentChild", GrooveRelationshipSide_Right, i_Child);
		RelationshipManager.DeleteRelationshipsWithRecord("TaskParentChild", GrooveRelationshipSide_Right, i_Child);
	}


	//
	// Return the children for a specified parent
	//
	function PDHF_GetChildrenFromRelationships(i_ParentID)
	{
		var pITaskIDEnum = RelationshipManager.FindRecordsByRelationship("TaskParentChild", GrooveRelationshipSide_Left, i_ParentID);
		pITaskIDEnum.Reset();
		if(pITaskIDEnum.HasMore())
		{
			return pITaskIDEnum;
		}

		var pIProjectIDEnum = RelationshipManager.FindRecordsByRelationship("ProjectParentChild", GrooveRelationshipSide_Left, i_ParentID);
		pIProjectIDEnum.Reset();
		if(pIProjectIDEnum.HasMore())
		{
			return pIProjectIDEnum;
		}

		// no children, return empty enum
		return CreateDoubleEnum().DoubleEnum;
	}


	// 
	// Debugging aid
	//
	function DebugValidateParentChildRelationships()
	{
		// start at the root and verify that each item has the same set of children as
		// the hierarchical collection recordset
		RecursiveDebugValidateParentChildRelationships(GrooveRunTimeData.GetItem("PROJECT_ID"));
	}

	function RecursiveDebugValidateParentChildRelationships(i_ItemID)
	{
		var pICollectionChildrenEnum;

		if(PDHF_HasChildren(i_ItemID))
		{
			pICollectionChildrenEnum = Collection.OpenCollection().Collection2.OpenDescendantRecordIDEnum(i_ItemID, 1, GrooveDescendantEnumerationOrder_DepthFirst);
		}
		else
		{
			pICollectionChildrenEnum = CreateDoubleEnum().DoubleEnum;
		}

		var pIRelationshipMgrChildrenEnum = PDHF_GetChildrenFromRelationships(i_ItemID);

		if(pIRelationshipMgrChildrenEnum.HasMore() != pICollectionChildrenEnum.HasMore())
		{
			GrooveDebugFunctions.DisplayAssert(0, "Relationship mismatch");
			return;
		}

		// make sure every child in the collection in in the RM
		while(pICollectionChildrenEnum.HasMore())
		{
			var CurrentChildID = pICollectionChildrenEnum.OpenNext();
			if(false == RSHP_ContainsID(pIRelationshipMgrChildrenEnum, CurrentChildID))
			{
				GrooveDebugFunctions.DisplayAssert(0, "Relationship mismatch");
				return;
			}
		}

		// make sure every child in the RM is in the collection
		pIRelationshipMgrChildrenEnum.Reset();
		pICollectionChildrenEnum.Reset();
		while(pIRelationshipMgrChildrenEnum.HasMore())
		{
			var CurrentChildID = pIRelationshipMgrChildrenEnum.OpenNext();
			if(false == RSHP_ContainsID(pICollectionChildrenEnum, CurrentChildID))
			{
				GrooveDebugFunctions.DisplayAssert(0, "Relationship mismatch");
				return;
			}
		}

		// we know this level has the same children, recurse and verify the next level
		pICollectionChildrenEnum.Reset();
		while(pICollectionChildrenEnum.HasMore())
		{
			RecursiveDebugValidateParentChildRelationships(pICollectionChildrenEnum.OpenNext());
		}
	}

/*  AMLATER - REMOVE THIS

	//
	// Remove any of the Parent node's predecessors if they appear as children
	// of the node.
	//
	// (a child/decendant cannot be specified as a predecessor by its parent)
	//
	// TRANSACTION_REQUIREMENTS: WRITE
	function PDHF_RemoveDecendantsFromPredecessorList(i_ParentNodeID, i_ChildNodeID)
	{
		var pIPredecessorList = PDHF_GetPredecessorIDEnum(i_ParentNodeID);

		if(pIPredecessorList.HasMore())
		{
			// get sparse array of i_ChildNode and its descendants
			var pIDescendantEnum = CreateDoubleEnum();
			pIDescendantEnum.Add(i_ChildNodeID);
			PDHF_GetDescendantsFromRelationships(i_ChildNodeID, pIDescendantEnum);
			var DescendantSparseArray = PDHF_SparseArrayFromEnum(pIDescendantEnum.DoubleEnum);

			// look for the parent's predecessors in the descendant list and when they're
			// found, remove them from the parent's predecessor list
			while(pIPredecessorList.HasMore())
			{
				var CurrentPredecessorID = pIPredecessorList.OpenNext();
				if(DescendantSparseArray.Contains(CurrentPredecessorID))
				{
					var RelationshipID = RelationshipManager.FindRelationship("Predecessor", CurrentPredecessorID, i_ParentNodeID);
					GrooveDebugFunctions.DisplayAssert(0 != RelationshipID, "Missing relatinship");

					RelationshipManager.DeleteRelationship(RelationshipID);
				}
			}
		}
	}

    //
	// Recursively build a list of all descendants of i_NodeID using the parent/child
	// relationships established via the relationship manager
	//
	// TRANSACTION_REQUIREMENTS: READ
	function PDHF_GetDescendantsFromRelationships(i_NodeID, i_pIDescendantIDEnumCreate)
	{
		var pIChildIDEnum = PDHF_GetChildrenFromRelationships(i_NodeID);
		while(pIChildIDEnum.HasMore())
		{
			var CurrentID = pIChildIDEnum.OpenNext();
			i_pIDescendantIDEnumCreate.Add(CurrentID);

			// recurse
			PDHF_GetDescendantsFromRelationships(CurrentID, i_pIDescendantIDEnumCreate);
		}
	}
*/

	function SparseArrayClass()
	{
		this.Add = SparseArrayClass_Add;
		this.Contains = SparseArrayClass_Contains;

		this.sparsearray = new Array;
	}

	function SparseArrayClass_Add(i_Item)
	{
		this.sparsearray[i_Item] = true;;
	}

	function SparseArrayClass_Contains(i_Item)
	{
		return "undefined" != typeof(this.sparsearray[i_Item]);
	}

	function PDHF_SparseArrayFromEnum(i_pIEnum)
	{
		var SparseArray = new SparseArrayClass();

		i_pIEnum.Reset();
		while(i_pIEnum.HasMore())
		{
			SparseArray.Add(i_pIEnum.OpenNext());
		}

		return SparseArray;
	}

	//
	// returns true if demoting the item would generate a dependency cycle
	//
	function PDHF_DoesDemoteCreateCycle(i_DemoteID)
	{
		// the new parent will be the item's previous sibling
		var NewParentID = PDHF_GetPreviousSiblingID(i_DemoteID);

		// note: the RM will use two parents for this item when it 
		// performs the cycle detection.  Because they are 
		// parent/children themselves, it's ok
		return RelationshipManager.DetectRelationshipCycle("TaskParentChild", NewParentID, i_DemoteID);
	}


	//
	// returns true if adding the specified predecessors to the specified task would
	// generate a cycle
	//
	function PDHF_DoesAddPredecessorsCreateCycle(i_TaskID, i_pIPredecessorIDEnum)
	{
		var IID_IGrooveRelationshipEnum = "{54A7ED0F-03D0-4145-BBDB-D5FF4ADE4B60}";
		var IID_IGrooveRelationship = "{824C0AE8-84B7-4CBA-BD42-FBBCD8B8797C}";
		var pIRelationshipEnum = CreateUnknownEnumFromStringIIDs(IID_IGrooveRelationshipEnum, IID_IGrooveRelationship);

		i_pIPredecessorIDEnum.Reset();
		while(i_pIPredecessorIDEnum.HasMore())
		{
			var CurrentPredecessorID = i_pIPredecessorIDEnum.OpenNext();
			var pINewRelationship = RelationshipManager.PackRelationshipAttributes("Predecessor", CurrentPredecessorID, i_TaskID);
			pIRelationshipEnum.Add(pINewRelationship);
		}
		
		return RelationshipManager.DetectRelationshipCycleWithEnum(pIRelationshipEnum);
	}


	// change dates, priority, status, according to supplied command element
	function PDHF_ProcessRecalculateElement(i_StatusOnly, i_pITaskListElement)
	{
		// now that we have verified permission, change field values, if supplied
		for(var i = 0; i < i_pITaskListElement.GetContentCount(); ++i)
		{
			var pITaskElement = i_pITaskListElement.OpenContentElement(i);
			var ID = pITaskElement.OpenAttributeAsDouble("ID");

			if(true == RecordSetEngine.HasRecord(ID) && false == PDHF_HasChildren(ID))
			{
				var pIRecord = RecordSetEngine.OpenRecord(ID);

				// change status
				if(pITaskElement.DoesAttributeExist("Status"))
				{
					PDHF_UpdateFieldIfChanged
								(
									pIRecord, 
									"Status", 
									pITaskElement.OpenAttributeAsLong("Status")
								);
				}

				if(pITaskElement.DoesAttributeExist("ActualStart"))
				{
					PDHF_UpdateDoubleFieldIfChanged
								(
									pIRecord, 
									"ActualStart", 
									pITaskElement.OpenAttributeAsDouble("ActualStart")
								);
				}

				if(pITaskElement.DoesAttributeExist("ActualFinish"))
				{
					PDHF_UpdateDoubleFieldIfChanged
								(
									pIRecord, 
									"ActualFinish", 
									pITaskElement.OpenAttributeAsDouble("ActualFinish")
								);
				}

				// change schedule?
				if(false == i_StatusOnly)
				{
					if(pITaskElement.DoesAttributeExist("UserStartConstraint"))
					{
						PDHF_UpdateDoubleFieldIfChanged
									(
										pIRecord, 
										"UserStartConstraint", 
										pITaskElement.OpenAttributeAsDouble("UserStartConstraint")
									);
					}

					if(pITaskElement.DoesAttributeExist("ConstrainStartDate"))
					{
						PDHF_UpdateFieldIfChanged
									(
										pIRecord,
										"ConstrainStartDate", 
										pITaskElement.OpenAttributeAsBool("ConstrainStartDate")
									);
					}

					if(pITaskElement.DoesAttributeExist("ScheduledDuration"))
					{
						PDHF_UpdateDoubleFieldIfChanged
									(
										pIRecord,
										"ScheduledDuration",
										pITaskElement.OpenAttributeAsDouble("ScheduledDuration")
									);
					}

					if(pITaskElement.DoesAttributeExist("Priority"))
					{
						PDHF_UpdateFieldIfChanged
									(
										pIRecord,
										"Priority",
										pITaskElement.OpenAttributeAsLong("Priority")
									);
					}
				}
			}
		}
	}



	////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////
	//
	// Access control helper functions
	//


	//
	// returns true if the user has CreateAnyItem permission
	//
	function PDHF_CanUserAddAnyItem(i_ContactURL)
	{
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.CreateAnyItem")
	}


	//
	// returns true if the user has EditOwnItem permission
	//
	function PDHF_CanUserEditOwnItem(i_ContactURL, i_ID)
	{
		// this permission only applied to tasks
		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			return false;
		}

		var pIRecord = RecordSetEngine.OpenRecord(i_ID);
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditOwnTasks") &&
			   pIRecord.OpenField("_CreatedByURL") == i_ContactURL;
	}

	//
	// returns true if the user has EditAnyItem permission
	function PDHF_CanUserEditAnyItem(i_ContactURL)
	{
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditAnyItem")
	}

	//
	// returns true if the user has EditAssignedItemStatus permission
	// (this only operates on tasks)
	function PDHF_CanUserEditAssignedItemStatus(i_ContactURL, i_ID)
	{
		// this permission only applied to tasks
		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			return false;
		}

		var pIRecord = RecordSetEngine.OpenRecord(i_ID);

		// the status for the project is _always_ calculated
		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			return false;
		}

		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditAssignedItemStatus") &&
			   pIRecord.OpenField("AssignedToContactURL") == i_ContactURL;
	}

	//
	// returns true if the user has EditAssignedItemSchedule permission
	// (this operations on tasks and the project item)
	function PDHF_CanUserEditAssignedItemSchedule(i_ContactURL, i_ID)
	{
		// this permission only applied to tasks
		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			return false;
		}

		var pIRecord = RecordSetEngine.OpenRecord(i_ID);
		var FieldName;

		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			FieldName = "TeamLeaderContactURL";
		}
		else
		{
			FieldName = "AssignedToContactURL";
		}

		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditAssignedItemSchedule") &&
			   pIRecord.OpenField(FieldName) == i_ContactURL;
	}

	function PDHF_CanUserRemoveAnyItem(i_ContactURL)
	{
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.RemoveAnyItem");
	}

	function PDHF_CanUserRemoveOwnItem(i_ContactURL, i_ID)
	{
		var pIRecord = RecordSetEngine.OpenRecord(i_ID);
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.RemoveOwnTasks") &&
		 	   pIRecord.OpenField("_CreatedByURL") == i_ContactURL;
	}

	//
	// Returns true if the user can remove the specified item and all of it's children.  
	//
	function PDHF_CanUserRemoveTaskAndChildren(i_ContactURL, i_ID)
	{
		var pIItemAndChildEnum = Collection.OpenCollection().Collection2.OpenDescendantRecordIDEnum(i_ID, -1, GrooveDescendantEnumerationOrder_DepthFirst);
		pIItemAndChildEnum.DoubleEnumCreate.Add(i_ID);

		while(pIItemAndChildEnum.HasMore())
		{
			var CurrentID = pIItemAndChildEnum.OpenNext();

			if(false == PDHF_CanUserRemoveAnyItem(i_ContactURL) &&
			   false == PDHF_CanUserRemoveOwnItem(i_ContactURL, CurrentID))
			{
				return false;
			}
		}

		return true;
	}

	//
	// returns true if the delta creator has permission to add a new task
	//
	function PDHF_CanExecuteAddTaskCommand()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var CreatorContactURL = DynamicsMgr.CommandContext.CreatorContactURL;

		return PDHF_CanUserAddAnyItem(CreatorContactURL);

	}

	//
	// Returns true if the delta creator has permission to change the schedule dates for
	// the specified items.  
	//
	function PDHF_CanExecuteRecalculateCommand(pIRecalculateIDEnum, i_StatusOnly /* false */)
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var CreatorContactURL = DynamicsMgr.CommandContext.CreatorContactURL;
		var StatusOnly = false;

		if("undefined" != typeof(i_StatusOnly))
		{
			StatusOnly = i_StatusOnly;
		}

		while(pIRecalculateIDEnum.HasMore())
		{
			if(StatusOnly)
			{
				if(false == PDHF_CanUserReplaceItemStatusInfo(CreatorContactURL, pIRecalculateIDEnum.OpenNext()))
				{
					return false;
				}
			}
			else
			{
				if(false == PDHF_CanUserReplaceItemScheduleInfo(CreatorContactURL, pIRecalculateIDEnum.OpenNext()))
				{
					return false;
				}
			}
		}

		return true;
	}

	//
	// Returns true if the delta creator has permission to delete the specified items
	// and all of their children
	//
	// If any of the items do not exist, we pretend that
	// the user could remove them so that they are skipped during syncronous processing
	// instead of triggering an access denied error	
	function PDHF_CanExecuteDeleteCommand(pIDeleteIDEnum)
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var CreatorContactURL = DynamicsMgr.CommandContext.CreatorContactURL;

		while(pIDeleteIDEnum.HasMore())
		{
			var DeleteID = pIDeleteIDEnum.OpenNext();
			if(RecordSetEngine.HasRecord(DeleteID))
			{
				if(false == PDHF_CanUserRemoveTaskAndChildren(CreatorContactURL, DeleteID))
				{
					return false;
				}
			}
		}

		return true;
	}


	//
	// Adding and removing predecessors requires the ability to change the schedule
	//
	function PDHF_CanExecuteAddRemovePredecessorsCommand(i_ID)
	{
		var pIIDEnum = CreateDoubleEnum();
		pIIDEnum.Add(i_ID);

		return PDHF_CanExecuteRecalculateCommand(pIIDEnum.DoubleEnum);
	}


	//
	// Promote and demote require the ability to change the schedule
	//
	function PDHF_CanExecutePromoteDemoteCommand(pIDEnum)
	{
		return PDHF_CanExecuteRecalculateCommand(pIDEnum);
	}

	//
	// returns true if we can execute the reschedule project command
	//
	function PDHF_CanExecuteRescheduleProjectCommand()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var CreatorContactURL = DynamicsMgr.CommandContext.CreatorContactURL;

		return PDHF_CanUserEditProjectInformation(CreatorContactURL);
	}

	//
	// returns true if the user can change the dates for the specified item
	//
	// If any of the items do not exist, we pretend that
	// the user could update them so that they are skipped during syncronous processing
	// instead of triggering an access denied error	
	function PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "debug");

		if(RecordSetEngine.HasRecord(i_ID))
		{
			var CanExecute = false;

			CanExecute |= PDHF_CanUserEditOwnItem(i_ContactURL, i_ID);
			CanExecute |= PDHF_CanUserEditAnyItem(i_ContactURL);
			CanExecute |= PDHF_CanUserEditAssignedItemSchedule(i_ContactURL, i_ID);

			if(false == CanExecute)
			{
				return false;
			}
		}

		return true;
	}


	//
	// returns true if the user can replace the status for the specified
	// item.
	//
	//
	// If any of the items do not exist, we pretend that
	// the user could update them so that they are skipped during syncronous processing
	// instead of triggering an access denied error	
	function PDHF_CanUserReplaceItemStatusInfo(i_ContactURL, i_ID)
	{
		// GrooveDebugFunctions.DisplayAssert(0, "debug");

		if(RecordSetEngine.HasRecord(i_ID))
		{
			var CanExecute = false;

			CanExecute |= PDHF_CanUserEditOwnItem(i_ContactURL, i_ID);
			CanExecute |= PDHF_CanUserEditAnyItem(i_ContactURL);
			CanExecute |= PDHF_CanUserEditAssignedItemStatus(i_ContactURL, i_ID);

			if(false == CanExecute)
			{
				return false;
			}
		}

		return true;
	}

	//
	// returns true if the user can demote the item
	//
	function PDHF_CanUserDemoteItem(i_ContactURL, i_ID)
	{
		return PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID);
	}

	//
	// returns true if the user can promote the item
	//
	function PDHF_CanUserPromoteItem(i_ContactURL, i_ID)
	{
		return PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID);
	}

	//
	// returns true if the user can move the item
	//
	function PDHF_CanUserMoveItem(i_ContactURL, i_ID)
	{
		return PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID);
	}

	//
	// returns true if the user can add attachments
	//
	function PDHF_CanUserAddAttachmentsToItem(i_ContactURL, i_ID)
	{
		return PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID) ||
			   PDHF_CanUserReplaceItemStatusInfo(i_ContactURL, i_ID);
	}

	//
	// returns true if the user can edit the project item
	//
	function PDHF_CanUserEditProjectInformation(i_ContactURL)
	{
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditProjectItem") ||
			   PDHF_CanUserEditAnyItem(i_ContactURL);
	}

	////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////
	//
	// Misc helper functions
	//



	function PDHF_IsDebugEnabled()
	{
		return GrooveRunTimeData.GetItem("DEBUG_ENABLED");
	}

	function PDHF_SetAccessDeniedError(i_Message)
	{
		GrooveDebugFunctions.DisplayAssert(0, "Access denied");
		GrooveErrorFunctions.SetCurrentError(GrooveRunTimeData.GetItem("ACCESS_DENIED"), i_Message);
	}

	function PDHF_SetError(i_Error, i_Message)
	{
		GrooveDebugFunctions.DisplayAssert(0, i_Message);
		GrooveErrorFunctions.SetCurrentError(i_Error, i_Message);
	}

	// Finish date is diplayed as Finish - 1 day for tasks
	// of duration 1 day or more (this is consistent with other
	// leading project tracking applications)
	// for tasks with 0 duration or summary tasks, we show the actual
	// finish date
	function PDHF_GetActualFinishDateMS(i_DurationMS, i_FinishDateMS)
	{
		var finishDateMS = i_FinishDateMS;
		var MSPERDAY = 24 * 60 * 60 * 1000;  // Milliseconds per day.

		if(0 != i_DurationMS)
		{
			finishDateMS -= MSPERDAY;

			// when subtracting one day from "Monday", we need to skip the weekend
			var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
			var pIDate = pIIntl.CreateDateFromRawDateTime(finishDateMS);
			var pICalendar = pIIntl.CreateCalendar();

			pICalendar.DateTime = pIDate;
			var DayOfWeek = pICalendar.Get(GrooveIntlCalendarField_DayOfWeek);

			if(GrooveIntlCalendarDayOfWeek_Sunday == DayOfWeek)
			{
				finishDateMS -= (2 * MSPERDAY);
			}
		}

		return finishDateMS;
	}

	function PDHF_IsLocalDelta()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		return DynamicsMgr.CommandContext.LocallyGenerated;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      @           G  ÿ        -     Lá Lá                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ‡               Ä(null),0               Ä(nul                 Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   L   ÄNameF   P r o j e c t D a t a M o d e l H e l p e r F u n c t i o n s . g s l         ÄSCRIPT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         $ π          )      ÄSCRIPT         ~tÄ

	// Millisecords per day
	var g_MSPERDAY = 86400000;			// 1000 * 60 * 60 * 24;

	// Number of days in work week
	var g_NUMWORKDAYS = 5;

	// Number of days per week
	var g_DAYSPERWEEK = 7;

	// Number of days off per week
	var g_DAYSOFF = g_DAYSPERWEEK - g_NUMWORKDAYS;

	//
	var g_NSP = "urn:groove.net:";

	//
	var g_TASKLISTELEMENTNAME = "TaskList";

	function PDHF_XPathConstructSimpleQuery(strItemName,Key)
	{
		return ("@" + strItemName + "='" + Key + "'");
	}

	function PDHF_RSEToProjectChangeType(i_RSEChangeType)
	{
		switch (i_RSEChangeType)
		{
			case GrooveRecordSetChangeType_Added:
			{
				return "OnProjectItemAdded";
			}

			case GrooveRecordSetChangeType_Replaced:
			{
				return "OnProjectItemReplaced";
			}

			case GrooveRecordSetChangeType_Removed:
			{
				return "OnProjectItemRemoved";
			}
			default:
			{
				GrooveDebugFunctions.DisplayAssert(false, "Invalid change type encountered");
			}
		}

		return null;
	}

	function PDHF_RSEToPendingChangeType(i_RSEChangeType)
	{
		switch (i_RSEChangeType)
		{
			case GrooveRecordSetChangeType_Added:
			{
				return "OnPendingItemAdded";
			}

			case GrooveRecordSetChangeType_Replaced:
			{
				return "OnPendingItemReplaced";
			}

			case GrooveRecordSetChangeType_Removed:
			{
				return "OnPendingItemRemoved";
			}
			default:
			{
				GrooveDebugFunctions.DisplayAssert(false, "Invalid change type encountered");
			}
		}

		return null;
	}

	//
	//
	// Internal helper routines
	//
	//
	function PDHF_UpdateFieldIfChanged(i_Record, i_FieldName, i_NewFieldValue)
	{
		if(i_NewFieldValue != i_Record.OpenField(i_FieldName))
		{
			i_Record.SetField(i_FieldName, i_NewFieldValue);
			return true;
		}

		return false;
	}

	function PDHF_UpdateDoubleFieldIfChanged(i_Record, i_FieldName, i_NewFieldValue)
	{
		if(i_NewFieldValue != i_Record.OpenField(i_FieldName))
		{
			i_Record.SetFieldAsDouble(i_FieldName, i_NewFieldValue);
			return true;
		}

		return false;
	}

	function PDHF_UpdateElementFieldIfChanged(i_Record, i_FieldName, i_NewFieldValue)
	{
		if(!i_NewFieldValue.Equals(i_Record.OpenFieldAsElement(i_FieldName)))
		{
			i_Record.SetFieldAsElement(i_FieldName, i_NewFieldValue);
			return true;
		}

		return false;
	}

	// returns the current version of our serialization format
	function PDHF_GetCurrentSerializationVersion()
	{
		return 3; // post 2.0 1189
	}


	//
	// TRANSACTION REQUIREMENTS: WRITE
	//
	// Implementation note:  RSE will save the current record IDs during serialization.
	// During restore, it will generate new record IDs for all of the records and will
	// automatically replace any occurences of the old record IDs with the new record IDs.
	// Records that are referenced but are not included in serialization become dangling
	// references 
	//
	function PDHF_SerializeItemsToElement(i_pIItemIDEnum, i_IncludeChildren, i_Flags)
	{
		var pIStorageManager = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
		var pIHeaderElement = pIStorageManager.CreateTemporaryElement(g_NSP + "ProjectItemsHeader");

		// Delete when done
		pIHeaderElement.SetDeleteOnRelease();

		// Top level items
		pIHeaderElement.SetAttributeAsLong("Version", PDHF_GetCurrentSerializationVersion());
		var pIProjectInfo = pIHeaderElement.CreateElement(g_NSP + "Project", pIHeaderElement);
		var pIParents = pIHeaderElement.CreateElement(g_NSP+ "Parents", pIHeaderElement);
		var pIFirstItem = pIHeaderElement.CreateElement(g_NSP + "FirstItem", pIHeaderElement);
		var pIAttachmentsElement = pIHeaderElement.CreateElement(g_NSP + ATTACHMENT_ELEMENT_NAME,  pIHeaderElement);

		// Optional items
		var pIRecord = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("PROJECT_ID"));

		if(GrooveProjectTrackingSerializeFlags_ProjectName & i_Flags)
		{
			pIProjectInfo.SetAttribute("ProjectName", pIRecord.OpenField("Name"));
		}

		if(GrooveProjectTrackingSerializeFlags_ProjectObjective & i_Flags)
		{
			var pIProjectObjective = pIProjectInfo.CreateElement(g_NSP + "Objective", pIProjectInfo);
			pIProjectObjective.CreateElementCopy(pIRecord.OpenField("Objective"), pIProjectObjective, false /* deep */, GrooveXLinkCopyOption_Default);
		}

		if(GrooveProjectTrackingSerializeFlags_ProjectStart & i_Flags)
		{
			pIProjectInfo.SetAttributeAsDouble("ProjectStart", pIRecord.OpenFieldAsDouble("ScheduledStart"));
		}

		// Remove any redundantly specified decendants from the enum.
		if(true == i_IncludeChildren)
		{
			i_pIItemIDEnum = PDHF_RemoveRedundantDecendants(i_pIItemIDEnum);
		}

		// Serialize top-level parent IDs so they can be fixed-up during restore
		i_pIItemIDEnum.Reset();
		while(i_pIItemIDEnum.HasMore())
		{
			var ItemID = i_pIItemIDEnum.OpenNext();
			var ParentID = PDHF_GetParentID(ItemID);
			var pIParent = pIParents.CreateElement(g_NSP + "Parent", pIParents);
			pIParent.SetAttributeAsDouble("ID", ParentID);
		}

		// Expand children?
		var pISerializeIDEnum = CreateDoubleEnum(); 
		if(true == i_IncludeChildren)
		{
			// Push all the top level items
			i_pIItemIDEnum.Reset();
			while(i_pIItemIDEnum.HasMore())
			{
				pISerializeIDEnum.Add(i_pIItemIDEnum.OpenNext());
			}

			// Now push all the children
			i_pIItemIDEnum.Reset();
			while(i_pIItemIDEnum.HasMore())
			{
				var pIChildEnum = Collection.OpenCollection().Collection2.OpenDescendantRecordIDEnum(i_pIItemIDEnum.OpenNext(), -1, GrooveDescendantEnumerationOrder_DepthFirst);
				while(pIChildEnum.HasMore())
				{
					pISerializeIDEnum.Add(pIChildEnum.OpenNext());
				}
			}
			pISerializeIDEnum = pISerializeIDEnum.DoubleEnum;
		}
		else
		{
			// AM - make a deep copy so we can add to SerializeIDEnum without
			// worrying about side effects of modifying pIItemIDEnum
			i_pIItemIDEnum.Reset();
			while(i_pIItemIDEnum.HasMore())
			{
				pISerializeIDEnum.Add(i_pIItemIDEnum.OpenNext());
			}
			i_pIItemIDEnum.Reset();
		}

		// Include predecessors?
		// xxx AMLATER - this needs to be reworked to be more efficient in the future
		if(GrooveProjectTrackingSerializeFlags_Predecessors & i_Flags)
		{
			var pIPredecessorRelationshipIDEnumCreate = CreateDoubleEnum();
			pISerializeIDEnum.Reset();
			
			// Find predecessors for the current task
			while(pISerializeIDEnum.HasMore())
			{
				var CurrentTaskID = pISerializeIDEnum.OpenNext();
				var pIPredecessorIDEnum = PDHF_GetPredecessorIDEnum(CurrentTaskID);
				
				// Get the ID of the relationship record for the current predecessor
				while(pIPredecessorIDEnum.HasMore())
				{
					var CurrentPredecessorID = pIPredecessorIDEnum.OpenNext();
					var RelationshipID = RelationshipManager.FindRelationship("Predecessor", CurrentPredecessorID, CurrentTaskID);
					pIPredecessorRelationshipIDEnumCreate.Add(RelationshipID);
				}
			}

			// include the relationship records in the enum of items to be serialized
			var pIPredecessorRelationshipIDEnum = pIPredecessorRelationshipIDEnumCreate.DoubleEnum;
			while(pIPredecessorRelationshipIDEnum.HasMore())
			{
				pISerializeIDEnum.DoubleEnumCreate.Add(pIPredecessorRelationshipIDEnum.OpenNext());
			}

			pISerializeIDEnum.Reset();
		}

		// Push the requested items into the element for export
		var pIItems = pIHeaderElement.CreateElement(g_NSP + "Items", pIHeaderElement);
		var pIElement = RecordSetEngine.ExportToElement(pISerializeIDEnum);
		pIItems.AppendContentElement(pIElement);

		// Include attachments?
		if(0 != (GrooveProjectTrackingSerializeFlags_Attachments & i_Flags))
		{
			pISerializeIDEnum.Reset();
			while(pISerializeIDEnum.HasMore())
			{
				var pIRecord = RecordSetEngine.OpenRecord(pISerializeIDEnum.OpenNext());

				// Add attachments for this record.
				MHF_AddAttachmentsToElement(DocShareEngine, pIRecord, pIAttachmentsElement);
			}
		}

		// xxx this totally sucks
		//
		// we need a way to mark the record that is "first" so that we can fix up it's prev sibling reference
		// on deserialization.  We also need to link all the top-level items together so that they are
		// contiguous when restored
		i_pIItemIDEnum.Reset();
		PDHF_FixupPrevSiblingReferences(i_pIItemIDEnum, pIItems);

		return pIHeaderElement;
	}

	//
	// TRANSACTION REQUIREMENTS: READ
	//
	// Given a list of IDs in a hierarchical collection, return a list that only 
	// contains the top-most nodes so that items are not redundantly specified
	// for hierarchial operaions such as copy and paste.
	//
	function PDHF_RemoveRedundantDecendants(i_pIItemIDEnum)
	{
		i_pIItemIDEnum.Reset();

		var pIReturnEnum = CreateDoubleEnum();
		var SparseItemArray = PDHF_SparseArrayFromEnum(i_pIItemIDEnum);

		// treat every item as a possible decendant
		i_pIItemIDEnum.Reset();
		while(i_pIItemIDEnum.HasMore())
		{
			var IsChildRedundant = false;
			var CurrentChildID = i_pIItemIDEnum.OpenNext();

			// start from the item and trace a path to the root, search for items
			// at each node
			var ParentID = PDHF_GetParentID(CurrentChildID);
			while(-1 != ParentID)
			{
				if(SparseItemArray.Contains(ParentID))
				{
					// child is redundant, stop searching
					IsChildRedundant = true;
					break;
				}
				
				// continue moving toward root
				ParentID = PDHF_GetParentID(ParentID);
			}

			// include in enum?
			if(false == IsChildRedundant)
			{
				pIReturnEnum.Add(CurrentChildID);
			}
		}

		return pIReturnEnum.DoubleEnum;
	}


	//
	// AMHACK - MAJOR ENCAPSULATION VIOLATION - DEPENDENT ON RSE ELEMENT FORMAT!!!
	// (and this is soooo expensive...)
	function PDHF_FixupPrevSiblingReferences(i_pIItemIDEnum, i_pIItemElement)
	{
		var pIExportedRecords = i_pIItemElement.OpenContentElement(0);
		var PreviousItemID = 0; // !! use special value 0 to indicate the first item !!

		i_pIItemIDEnum.Reset();
		while(i_pIItemIDEnum.HasMore())
		{
			var CurrentID = i_pIItemIDEnum.OpenNext();
			var pIRecordElement = null;

			// find the element containing the current item
			for(var i = 0; i < pIExportedRecords.GetContentCount(); ++i)
			{
				var pICurrentRecordElement= pIExportedRecords.OpenContentElement(i);
				var ItemID = pICurrentRecordElement.OpenAttributeAsDouble("_RecordID");

				if(ItemID == CurrentID)
				{
					pIRecordElement = pICurrentRecordElement;
					break;
				}
			}
			GrooveDebugFunctions.DisplayAssert(null != pIRecordElement, "Missing element!");

			// relink siblings
			pIRecordElement.SetAttributeAsDouble("_PreviousSiblingID", PreviousItemID);
			PreviousItemID = CurrentID;
		}
	}

	//
	// Requires DELTA
	//
	function PDHF_GetHeaderElementFromStream(i_BIS)
	{
		var TelespaceDatabase = PropertyList.OpenProperty(PROPERTY_TELESPACE_DATABASE);
		var pIXMLDoc = DHF_CreateScratchDocument(TelespaceDatabase);
		var pIHeaderElement = pIXMLDoc.CreateElementFromStream(i_BIS, GrooveParseOption_Default, pIXMLDoc.OpenRootElement());
		
		return pIHeaderElement;
	}


	//
	// Requires DELTA
	//
	// i_PreviousSibling of -1 means insert as first child of parent
	// Returns a IGrooveDoubleEnum of the newly added items, or null if an error occurs
	// 
	function PDHF_ImportFromHeaderElement(i_ParentID, i_PreviousSiblingID, i_pIHeaderElement)
	{
		var pOldParentIDCreateEnum = CreateDoubleEnum();

		if(g_NSP + "ProjectItemsHeader" != i_pIHeaderElement.OpenName() ||
			PDHF_GetCurrentSerializationVersion() != i_pIHeaderElement.OpenAttributeAsLong("Version"))
		{
			GrooveDebugFunctions.DisplayAssert(0, "Unsupported serialization format");
			return;
		}

		var pIRecord = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("PROJECT_ID"));

		// ProjectInfo
		if(i_pIHeaderElement.ContentElementWithNameExists(g_NSP + "Project"))
		{
			var pIProjectInfo = i_pIHeaderElement.OpenContentElementByName(g_NSP + "Project");

			if(pIProjectInfo.DoesAttributeExist("ProjectName"))
			{
				pIRecord.SetField("Name", pIProjectInfo.OpenAttribute("ProjectName"));
			}

			if(pIProjectInfo.ContentElementWithNameExists(g_NSP + "Objective"))
			{
				var pIProjectObjective = pIProjectInfo.OpenContentElementByName(g_NSP + "Objective");
				pIRecord.SetField("Objective", pIProjectObjective.OpenContentElement(0));
			}

			if(pIProjectInfo.DoesAttributeExist("ProjectStart"))
			{
				pIRecord.SetFieldAsDouble("ScheduledStart", pIProjectInfo.OpenAttributeAsDouble("ProjectStart"));
			}
		}

		// ParentIDs
		if(i_pIHeaderElement.ContentElementWithNameExists(g_NSP + "Parents"))
		{
			var pIParents = i_pIHeaderElement.OpenContentElementByName(g_NSP + "Parents");

			for(var i = 0; i < pIParents.GetContentCount(); ++i)
			{
				var pIParent = pIParents.OpenContentElement(i);
				var ID = pIParent.OpenAttributeAsDouble("ID");
				pOldParentIDCreateEnum.Add(ID);
			}
		}

		// Items
		if(i_pIHeaderElement.ContentElementWithNameExists(g_NSP + "Items"))
		{
			var pIItems = i_pIHeaderElement.OpenContentElementByName(g_NSP + "Items");
			var pIRecordElements = pIItems.OpenContentElement(0);

			var pIRecordEnum = RecordSetEngine.ImportFromElement(pIRecordElements);

			// reparent records, as necessary
			var pIOldParentIDEnum = pOldParentIDCreateEnum.DoubleEnum;
			pIOldParentIDEnum.Reset();

			if(pIOldParentIDEnum.HasMore())
			{
				var OldParentSparseArray = PDHF_SparseArrayFromEnum(pIOldParentIDEnum);
				while(pIRecordEnum.HasMore())
				{
					var pIRecord = pIRecordEnum.OpenNext();
					if(g_NSP + "ProjectTaskRecord" == pIRecord.Type)
					{
						var SerializedParentID = pIRecord.OpenFieldAsDouble("_ParentID");
						
						// it this item is a top level item, fix up it's parent ID
						// otherwise, 
						if(OldParentSparseArray.Contains(SerializedParentID))
						{
							pIRecord.SetFieldAsDouble("_ParentID", i_ParentID);
						}
					}
				}
			}

			// Find the first item (for insertion) --it has special prev sibling id of 0
			pIRecordEnum.Reset();
			while(pIRecordEnum.HasMore())
			{
				var pIRecord = pIRecordEnum.OpenNext();
				if(g_NSP + "ProjectTaskRecord" == pIRecord.Type &&
				   (0 == pIRecord.OpenFieldAsDouble("_PreviousSiblingID")))
				{
					pIRecord.SetFieldAsDouble("_PreviousSiblingID", i_PreviousSiblingID);
					break;
				}
			}

			// Get the attachments element
			var pIAttachmentElement = null;
			if(i_pIHeaderElement.ContentElementWithNameExists(g_NSP + ATTACHMENT_ELEMENT_NAME))
			{
				pIAttachmentElement = i_pIHeaderElement.OpenContentElementByName(g_NSP + ATTACHMENT_ELEMENT_NAME);
			}

			// Verify that each record has an attachments element
			// and fix up the creator to be the current user
			pIRecordEnum.Reset();
			while(pIRecordEnum.HasMore())
			{
				var pIRecord = pIRecordEnum.OpenNext();

				// Add attachments to newly created tasks.
				MHF_ReattachAttachmentsFromElement(DocShareEngine, pIRecord, pIAttachmentElement);

				// Make current user the creator of these records
				pIRecord.SetField("_CreatedByURL", CHF_GetUserURL());
				pIRecord.SetField("_CreatedBy", CHF_GetUserName());
			}

			// Finally, we're ready to add the records
			pIRecordEnum.Reset();
			if(pIRecordEnum.HasMore())
			{
				RecordSetEngine.AddMultipleRecords(pIRecordEnum);
			}

			// Return the IDs of the newly created tasks.
			// Tell the relationship manager about the new relationships.
			// Add attachments to newly created tasks.
			pIRecordEnum.Reset();
			if(pIRecordEnum.HasMore())
			{
				var pIIDEnum = CreateDoubleEnum();
				while(pIRecordEnum.HasMore())
				{
					var pIRecord = pIRecordEnum.OpenNext();
					if(g_NSP + "ProjectTaskRecord" == pIRecord.Type)
					{
						var ID = pIRecord.RecordID;
						var ParentID = pIRecord.OpenField("_ParentID");
						
						pIIDEnum.Add(ID);
						PDHF_CreateParentChildRelationship(ParentID, ID);
					}
				}
				return pIIDEnum.DoubleEnum;
			}
		}

		return null;
	}

	//
	// Returns an IGrooveNameValueEnum containing the names and IDs of
	// the predecessor's for the specified items.
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetPredecessorNameValueEnum(i_TaskID)
	{
		var pINameValueEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateNameValueEnum().NameValueEnumCreate;
		var pIPredecessorEnum = PDHF_GetPredecessorIDEnum(i_TaskID);

		while(pIPredecessorEnum.HasMore())
		{
			var pIRecord= RecordSetEngine.OpenRecord(pIPredecessorEnum.OpenNext());
			var Name = pIRecord.OpenField("Name");
			pINameValueEnum.Add(Name, pIRecord.RecordID);
		}

		return pINameValueEnum.NameValueEnum;
	}

	//
	// Returns an IGrooveDoubleEnum containing the predecessor ID's for the specified item.
	// An empty enum is returned if no predecessors exist.
	//
	// TRANSACTION REQUIREMENTS: READ
	//
	function PDHF_GetPredecessorIDEnum(i_TaskID)
	{
		return RelationshipManager.FindRecordsByRelationship("Predecessor", GrooveRelationshipSide_Right, i_TaskID);
	}

	function PDHF_InitializeRecordAttachments(i_pIRecord)
	{
		var pIAttachmentLinks = CreateNewElement("Attachments");
		i_pIRecord.SetFieldAsElement("Attachments", pIAttachmentLinks);
	}

	function PDHF_ElementNameFromNumber(i_Number)
	{
		var ElementName = "_" + i_Number;
		GrooveDebugFunctions.DisplayAssert("_" != ElementName, "Invalid number");
		return ElementName;
	}

	function PDHF_NumberFromElementName(i_String)
	{
		GrooveDebugFunctions.DisplayAssert(i_String.length != 0, "Invalid Element Name");
		GrooveDebugFunctions.DisplayAssert("_" == i_String.charAt(0), "Invalid Element Name");
		var NumberValue = new Number(i_String.substring(1, i_String.length));
		return NumberValue.valueOf();
	}

	//
	// Notify listeners on IGrooveProjectTrackingDataDelegateListener
	// If the operation is a remove, we notify listeners, regardless
	// of the type of item that was changed.  If the operation is not a remove,
	// we inform the listeners when the item is of type project or task.
	//
	function PDHF_NotifyProjectTrackingListeners
				(
					i_pRecordSetEngine, 
					i_RecordSetChangeType, 
					i_pIRecordIDEnum
				)
	{
		i_pIRecordIDEnum.Reset();

		var pIIDEnum = null;
		if(GrooveRecordSetChangeType_Removed == i_RecordSetChangeType)
		{
			pIIDEnum = i_pIRecordIDEnum;
		}
		else
		{
			// Create a new enum
			var pIIDEnumCreate = CreateDoubleEnum();
			var pIIDEnum = pIIDEnumCreate.DoubleEnum;

			// Enter transaction.
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				// BUild enum of record to notify.
				while(i_pIRecordIDEnum.HasMore())
				{
					// Make sure the record still exists.
					var RecordID = i_pIRecordIDEnum.OpenNext();
					if(RecordSetEngine.HasRecord(RecordID))
					{
						// Make sure the record is of correct type.
						var pIRecord = RecordSetEngine.OpenRecord(RecordID);
						if (g_NSP + "ProjectTaskRecord" == pIRecord.Type ||
							g_NSP + "ProjectProjectRecord" == pIRecord.Type)
						{
							pIIDEnumCreate.Add(RecordID);
						}
					}
				}

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Error finding pending task");
			}
		}

		if (pIIDEnum.HaPK
     zäcO∏(ˆ      	   1/1.z4067sMore())
		{
			ScriptHostComponent.FireEvent
				( GrooveRunTimeData.GetItem("IID_IGrooveProjectTrackingDataDelegateListener"),
				  PDHF_RSEToProjectChangeType(i_RecordSetChangeType),
				  ScriptHostComponent, pIIDEnum);
		}
	}

	//
	// AMLATER - FILTER OUT SUMMARY TASKS
	//
	function PDHF_NotifyPendingItemListeners
				(	i_pRecordSetEngine, 
					i_RecordSetChangeType, 
					i_pIRecordIDEnum
				)
	{
		//
		// notify listeners on IGrooveProjectDashboardPendingItemDataDelegateListener
		// If the operation is a remove, we notify pending item listeners, regardless
		// of the type of item that was changed.  If the operation is not a remove,
		// we only inform the listeners when the item is of type "task".
		//

		i_pIRecordIDEnum.Reset();

		var pIPendingItemIDEnum = null;
		if(GrooveRecordSetChangeType_Removed == i_RecordSetChangeType)
		{
			pIPendingItemIDEnum = i_pIRecordIDEnum;
		}
		else
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);

			try
			{
				pIPendingItemIDEnum = RSHP_RecordIDEnumFindType
											(i_pIRecordIDEnum,
											 i_pRecordSetEngine,
											 g_NSP + "ProjectTaskRecord");
				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Error finding pending task");
			}
		}

		if(null != pIPendingItemIDEnum && pIPendingItemIDEnum.HasMore())
		{
			ScriptHostComponent.FireEvent
				(GrooveRunTimeData.GetItem("IID_IGrooveProjectDashboardPendingItemDataDelegateListener"),
				 PDHF_RSEToPendingChangeType(i_RecordSetChangeType),
				 ScriptHostComponent,
				 pIPendingItemIDEnum);
		}
	}


	function PDHF_BuildTaskRecord
				(
					i_ParentID,
					i_TaskName,
					i_AssignedToContactURL,
					i_Status,
					i_Priority,
					i_UserStartConstraint,
					i_ConstrainStartDate,
					i_ScheduledStart,
					i_ScheduledDuration,
					i_DisplayFinish,
					i_ActualStart,
					i_ActualFinish,
					i_IsPrivate,
					i_pIDescription
				)
	{
		var pIRecord = RecordSetEngine.RecordFactory.CreateRecord(g_NSP + "ProjectTaskRecord");

		//  Set the fields in the record
		pIRecord.SetField("Version", GrooveRunTimeData.GetItem("TASKRECORD_VERSION"));
		pIRecord.SetFieldAsDouble("_ParentID", i_ParentID);
		pIRecord.SetField("Name", i_TaskName);
		pIRecord.SetField("AssignedToContactURL", i_AssignedToContactURL);
		pIRecord.SetField("Status", i_Status);
		pIRecord.SetField("Priority", i_Priority);
		pIRecord.SetFieldAsDouble("DisplayFinish", i_DisplayFinish);
		pIRecord.SetFieldAsDouble("ActualStart", i_ActualStart);
		pIRecord.SetFieldAsDouble("ActualFinish", i_ActualFinish);
		pIRecord.SetFieldAsBool("IsPrivate", i_IsPrivate);
		pIRecord.SetFieldAsElement("Description", i_pIDescription);

		// New tasks are not summary tasks by convention, so it's ok to set the dates
		pIRecord.SetFieldAsDouble("UserStartConstraint", i_UserStartConstraint);
		pIRecord.SetFieldAsBool("ConstrainStartDate", i_ConstrainStartDate);
		pIRecord.SetFieldAsDouble("ScheduledStart", i_ScheduledStart);
		pIRecord.SetFieldAsDouble("ScheduledDuration", i_ScheduledDuration);
		pIRecord.SetFieldAsDouble("ScheduledFinish", i_ScheduledStart + i_ScheduledDuration);

		// Init attachments 
		PDHF_InitializeRecordAttachments(pIRecord);

		return pIRecord;
	}

	//
	// returns true if the specified item has children
	//
	function PDHF_HasChildren(i_ID)
	{
		return 0 != Collection.OpenCollection().Collection2.GetNumChildren(i_ID);
	}





	////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////
	//
	// Pseudo-command functions
	//

	function PDHF_BuildAddTaskCmdRecord(i_AddedIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("ADDTASK_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskIDs", PDHF_StringFromIDEnum(i_AddedIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildDeleteTasksCmdRecord(i_DeleteIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("DELETEITEMS_CMDID"));
		
		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskIDs", PDHF_StringFromIDEnum(i_DeleteIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildRescheduleProjectCmdRecord(i_StartDate)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("RESCHEDULEPROJECT_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetFieldAsDouble("ScheduledStart", i_StartDate);

		return pIPseudoCommand;
	}


	//
	// generate a command to update schedule/status info for a task
	//
	function PDHF_BuildChangeTaskScheduleCmdRecord(i_pIGrooveTaskDetails, i_StatusOnly)
	{
		// 
		var StatusOnly = (null == i_StatusOnly) ? false : i_StatusOnly;

		var pITaskList = CreateNewElement(g_TASKLISTELEMENTNAME);
		PDHF_AppendToTaskList(pITaskList,
							  StatusOnly,
							  i_pIGrooveTaskDetails.ID,
							  i_pIGrooveTaskDetails.Status,
							  i_pIGrooveTaskDetails.ActualStart,
							  i_pIGrooveTaskDetails.ActualFinish,
							  i_pIGrooveTaskDetails.UserStartConstraint,
							  i_pIGrooveTaskDetails.ConstrainStartDate,
							  i_pIGrooveTaskDetails.ScheduledDuration,
							  i_pIGrooveTaskDetails.Priority);

		return PDHF_BuildChangeTaskScheduleCmdRecordFromTaskList(pITaskList, StatusOnly);
	}


	//
	// generate a command to recalculate the tasks specified in the ID enum
	//
	function PDHF_BuildRecalculateMultipleCmdRecord(i_ItemIDEnum)
	{
		// Create new element and fill with changed data.
		i_ItemIDEnum.Reset();
		try
		{
			var pITaskElement = null;
			var pITaskList = CreateNewElement(g_TASKLISTELEMENTNAME);
			while(i_ItemIDEnum.HasMore())
			{
				pITaskElement = pITaskList.CreateElement("Task", pITaskList);
				pITaskElement.SetAttributeAsDouble("ID", i_ItemIDEnum.OpenNext());
			}
		}
		catch(e)
		{
			if (null != pITaskElement)
			{
				pITaskElement.DetachFromParent();
				pITaskElement.Destroy();
			}

			throw e;
		}

		return PDHF_BuildChangeTaskScheduleCmdRecordFromTaskList(pITaskList, false, true);
	}


	//
	// Generate a command to update schedule/status info for multiple tasks
	//
	function PDHF_BuildChangeTaskScheduleCmdRecordFromTaskList(i_pITaskListElement, i_StatusOnly, i_IDOnly)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("RECALCULATE_CMDID"));
		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetFieldAsBool("StatusOnly", (null == i_StatusOnly) ? false : i_StatusOnly);
		pIPseudoCommand.SetFieldAsElement(g_TASKLISTELEMENTNAME, i_pITaskListElement);
		pIPseudoCommand.SetFieldAsBool("IDOnly", (null == i_IDOnly) ? false : i_IDOnly);
		return pIPseudoCommand;
	}

	function PDHF_AppendToTaskList
				(
					i_pITaskListElement,
					i_StatusOnly,
					i_ID,
					i_Status,				// optional
					i_ActualStart,			// optional
					i_ActualFinish,			// optional
					i_UserStartConstraint,	// optional
					i_ConstrainStartDate,	// optional
					i_ScheduledDuration,	// optional
					i_Priority				// optional
				)
	{
		var pITaskElement = i_pITaskListElement.CreateElement("Task", i_pITaskListElement);

		try
		{
			// add scheduled info
			pITaskElement.SetAttributeAsDouble("ID", i_ID);

			if (null != i_Status)
			{
				pITaskElement.SetAttributeAsLong("Status", i_Status);
			}

			if (null != i_ActualStart)
			{
				pITaskElement.SetAttributeAsDouble("ActualStart", i_ActualStart);
			}

			if (null != i_ActualFinish)
			{
				pITaskElement.SetAttributeAsDouble("ActualFinish", i_ActualFinish);
			}

			if (false == i_StatusOnly)
			{
				if (null != i_UserStartConstraint)
				{
					pITaskElement.SetAttributeAsDouble("UserStartConstraint", i_UserStartConstraint);
				}

				if (null != i_ConstrainStartDate)
				{
					pITaskElement.SetAttributeAsBool("ConstrainStartDate", i_ConstrainStartDate);
				}
				
				if (null != i_ScheduledDuration)
				{
					pITaskElement.SetAttributeAsDouble("ScheduledDuration", i_ScheduledDuration);
				}

				if (null != i_Priority)
				{
					pITaskElement.SetAttributeAsLong("Priority", i_Priority);
				}
			}
		}
		catch(e)
		{
			pITaskElement.DetachFromParent();
			pITaskElement.Destroy();

			throw e;
		}
	}


	function PDHF_BuildDemoteCmdRecord(i_ItemIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("DEMOTEITEMS_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskIDs", PDHF_StringFromIDEnum(i_ItemIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildPromoteCmdRecord(i_ItemIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("PROMOTEITEMS_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskIDs", PDHF_StringFromIDEnum(i_ItemIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildAddPredecessorsCmdRecord(i_ID, i_PredecessorIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("ADDPREDECESSOR_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskID", i_ID);
		pIPseudoCommand.SetField("PredecessorIDs", PDHF_StringFromIDEnum(i_PredecessorIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildRemovePredecessorsCmdRecord(i_ID, i_PredecessorIDEnum)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("REMOVEPREDECESSOR_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetField("TaskID", i_ID);
		pIPseudoCommand.SetField("PredecessorIDs", PDHF_StringFromIDEnum(i_PredecessorIDEnum));

		return pIPseudoCommand;
	}

	function PDHF_BuildImportCmdRecord(i_pIImportCmdElement)
	{
		var pIPseudoCommand = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("IMPORTITEMS_CMDID"));

		pIPseudoCommand = pIPseudoCommand.Clone();
		pIPseudoCommand.SetField("Version", GrooveRunTimeData.GetItem("PSEUDOCOMMAND_VERSION"));
		pIPseudoCommand.SetFieldAsElement("ImportList", i_pIImportCmdElement);

		return pIPseudoCommand;
	}

	//
	// Transaction requirements: WRITE
	// Returns true if this is a pseudo command, false if something else
	function PDHF_ExcutePseudoCommand(i_pIPseudoCommandRecord)
	{
		// dispatch command
		switch(i_pIPseudoCommandRecord.Type)
		{
			case g_NSP + "ProjectAddTasksCmdRecord":
				PDHF_ExecuteAddTaskPseudoCommand(i_pIPseudoCommandRecord);
				return true;
			case g_NSP + "ProjectRecalculateCmdRecord":
				PDHF_ExecuteRecalculateCommand(i_pIPseudoCommandRecord);
				return true;
			case g_NSP + "ProjectAddPredecessorsCmdRecord":
				PDHF_ExecuteAddPredecessorsCommand(i_pIPseudoCommandRecord);
				return true;
			case g_NSP + "ProjectRemovePredecessorsCmdRecord":
				PDHF_ExecuteRemovePredecessorsCommand(i_pIPseudoCommandRecord);
				return true;
			case g_NSP + "ProjectDeleteItemsCmdRecord":
				PDHF_ExecuteDeleteItemsCommand(i_pIPseudoCommandRecord);
				return true;
			case g_NSP + "ProjectDemoteItemsCmdRecord":
				PDHF_ExecuteDemoteItemsCommand(i_pIPseudoCommandRecord);
				break;
			case g_NSP + "ProjectPromoteItemsCmdRecord":
				PDHF_ExecutePromoteItemsCommand(i_pIPseudoCommandRecord);
				return true;
			case g_NSP + "ProjectRescheduleProjectCmdRecord":
				PDHF_ExecuteRescheduleProjectCommand(i_pIPseudoCommandRecord);
				return true;
			case g_NSP + "ProjectImportItemsCmdRecord":
				PDHF_ExecuteImportItemsCommand(i_pIPseudoCommandRecord);
				return true;
			default:
				return false;
		}
	}

	//
	// Assumptions: the Project record is never created through a pseudo command
	//
	// Note about validating relationships:  when calculation is deferred,
	// we ask the relationship manager to skip cycle detection (and other checks
	// added for robustness) for tasks added by this endpoint to improve performance 
	// (on this endpoint only) during bulk adds.  This really should be addressed via an 
	// AddMultipleTasks/Relationships API in the future.
	//
	function PDHF_ExecuteAddTaskPseudoCommand(i_pIProjectAddTaskCmdRecord)
	{
		var pIAddedIDEnum = PDHF_IDEnumFromString(i_pIProjectAddTaskCmdRecord.OpenField("TaskIDs"));
		var pIUpdateEnum = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecuteAddTaskCommand())
		{
			PDHF_SetAccessDeniedError("Cannot add new items");
			return;
		}

		while(pIAddedIDEnum.HasMore())
		{
			var ID = pIAddedIDEnum.OpenNext();
			if(true == RecordSetEngine.HasRecord(ID) && false == PDHF_HasChildren(ID))
			{
				var pIRecord = RecordSetEngine.OpenRecord(ID);
				var ParentID = pIRecord.OpenField("_ParentID");

				// if parent was deleted, remove the record and re-add it with 
				// the project singleton item (which always exists) as it's parent
				// we can't just call SetField because the collection did not add the
				// record to any of it's hierarchical indexes because the parent did not
				// exist at add time
				if(false == RecordSetEngine.HasRecord(ParentID))
				{
					ParentID = GrooveRunTimeData.GetItem("PROJECT_ID");
					pIRecord = pIRecord.Clone();

					RecordSetEngine.RemoveRecord(ID);
					
					pIRecord.SetFieldAsDouble("_ParentID", ParentID);
					RecordSetEngine.AddRecord(pIRecord);
				}

				// remove any predecessors from the parent, since summary tasks
				// cannot have predecessors
				RelationshipManager.DeleteRelationshipsWithRecord("Predecessor", GrooveRelationshipSide_Right, ParentID);

				var ValidateRelationships = (false == PDHF_IsCalculationDeferred() ||
											 false == PDHF_IsLocalDelta()); // see comment above

				// create new parent/child relationship
				PDHF_CreateParentChildRelationship(ParentID, pIRecord.RecordID, ValidateRelationships);

				// remember what we have actually processed
				pIUpdateEnum.Add(ID);
			}
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdateEnum.DoubleEnum);
		}
	}

	function PDHF_ExecuteRescheduleProjectCommand(i_pIRescheduleProjectCmdRecord)
	{
		// Check permission
		var pIRecalculateIDEnum = CreateDoubleEnum();
		pIRecalculateIDEnum.Add(GrooveRunTimeData.GetItem("PROJECT_ID"));

		if(false == PDHF_CanExecuteRescheduleProjectCommand())
		{
			PDHF_SetAccessDeniedError("Cannot change project schedule info");
			return;
		}

		var ProjectID = GrooveRunTimeData.GetItem("PROJECT_ID");
		var NewStart = i_pIRescheduleProjectCmdRecord.OpenField("ScheduledStart");
		var pIProjectRecord = RecordSetEngine.OpenRecord(ProjectID);
		var OrigStart = pIProjectRecord.OpenField("ScheduledStart");
		var StartChange;
		var pIAllItems;

		// Determine duration in work days (function requires start
		// to be earlier than finish)
		if(NewStart > OrigStart)
		{
			StartChange = PDHF_GetWorkWeekDuration(OrigStart, NewStart);
		}
		else
		{
			StartChange = -PDHF_GetWorkWeekDuration(NewStart, OrigStart);
		}

		// Update the project start date
		pIProjectRecord.SetFieldAsDouble("ScheduledStart", NewStart);

		// Check if finish date needs adjustment.
		if (pIProjectRecord.OpenField("ScheduledFinish") < NewStart)
		{
			pIProjectRecord.SetFieldAsDouble("ScheduledFinish", NewStart);
			pIProjectRecord.SetFieldAsDouble("DisplayFinish", NewStart);
		}

		// If the start date changed, we need to offset all start constraint
		// by the same amount the project start date has changed
		if(true == PDHF_HasChildren(ProjectID))
		{
			pIAllItems = Collection.OpenCollection().Collection2.OpenDescendantRecordIDEnum(ProjectID, -1, GrooveDescendantEnumerationOrder_DepthFirst);
		}
		else
		{
			pIProjectRecord.SetFieldAsDouble("ScheduledFinish", NewStart);
			pIProjectRecord.SetFieldAsDouble("DisplayFinish", NewStart);
			return;
		}
		
		while(pIAllItems.HasMore())
		{
			var pICurrentRecord = RecordSetEngine.OpenRecord(pIAllItems.OpenNext());
			var CurrentUserStart = pICurrentRecord.OpenField("UserStartConstraint");
			var NewUserStart = PDHF_WorkWeekAddDuration(CurrentUserStart, StartChange);
			pICurrentRecord.SetFieldAsDouble("UserStartConstraint", NewUserStart);
		}

		pIAllItems.Reset();
		PDHF_UpdateChangedItems(pIAllItems);
	}

	function PDHF_ExecuteRecalculateCommand(i_pIProjectRecalculateCmdRecord)
	{
		var pITaskListElement = i_pIProjectRecalculateCmdRecord.OpenFieldAsElement(g_TASKLISTELEMENTNAME);
		var StatusOnly = i_pIProjectRecalculateCmdRecord.OpenField("StatusOnly");

		try
		{
			// Older version of tool did not set this element.
			// Therefore to be absolutely safe catch all errors.
			var IDOnly = i_pIProjectRecalculateCmdRecord.OpenField("IDOnly");
		}
		catch(e)
		{
			IDOnly = false;
		}

		// Get creator URL
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var CreatorContactURL = DynamicsMgr.CommandContext.CreatorContactURL;

		// Prepare eunum of changed ID
		var pIUpdatedIDEnum = CreateDoubleEnum();
		for (var i = 0; i < pITaskListElement.GetContentCount(); ++i)
		{
			var pITaskElement = pITaskListElement.OpenContentElement(i);
			var ID = pITaskElement.OpenAttributeAsDouble("ID");

			// Check permissions
			if (false == ((StatusOnly && PDHF_CanUserReplaceItemStatusInfo(CreatorContactURL, ID)) || 
				PDHF_CanUserReplaceItemScheduleInfo(CreatorContactURL, ID)))
			{
				PDHF_SetAccessDeniedError("Cannot change item task information");
				return;
			}

			// Make sure the record still exisits and do not add leaf nodes.
			if (true == RecordSetEngine.HasRecord(ID) && false == PDHF_HasChildren(ID))
			{
				pIUpdatedIDEnum.Add(ID);
			}
		}

		// Change dates, priority, status, according to supplied command
		if (false == IDOnly)
		{
			PDHF_ProcessRecalculateElement(StatusOnly, pITaskListElement);
		}

		// Perform the recalc
		if (false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdatedIDEnum.DoubleEnum, StatusOnly);
		}
	}


	function PDHF_ExecuteAddPredecessorsCommand(i_pIProjectAddPredecessorsCmdRecord)
	{
		var DependantID = i_pIProjectAddPredecessorsCmdRecord.OpenField("TaskID");
		var pIPredecessorIDEnum = PDHF_IDEnumFromString(i_pIProjectAddPredecessorsCmdRecord.OpenField("PredecessorIDs"));
		var pIUpdateIDEnum = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecuteAddRemovePredecessorsCommand(DependantID))
		{
			PDHF_SetAccessDeniedError("Cannot add predecessors");
			return;
		}

		// do nothing if dependant has been deleted
		if(false == RecordSetEngine.HasRecord(DependantID))
		{
			return;
		}

		// if the task is a summary task, it cannot have predecessors, so do nothing
		if(PDHF_HasChildren(DependantID))
		{
			return;
		}

		// add the new predecessors
		while(pIPredecessorIDEnum.HasMore())
		{
			var CurrentPredecessorID = pIPredecessorIDEnum.OpenNext();
			
			// if the predecessor exists and adding it will not cause a cycle
			// in the realationship graph, add it

			// Note about validating relationships:  when calculation is deferred,
			// we ask the relationship manager to skip cycle detection (and other checks
			// added for robustness) for tasks added by this endpoint to improve performance 
			// (on this endpoint only) during bulk adds.  This really should be addressed via an 
			// AddMultipleTasks/Relationships API in the future.

			var bValidate = (false == PDHF_IsCalculationDeferred() ||
							 false == PDHF_IsLocalDelta());
			if(true == RecordSetEngine.HasRecord(CurrentPredecessorID) &&
				(false == bValidate || false == RelationshipManager.DetectRelationshipCycle("Predecessor", CurrentPredecessorID, DependantID)))
			{
				RelationshipManager.CreateRelationship("Predecessor", CurrentPredecessorID, DependantID, bValidate);
				pIUpdateIDEnum.Add(DependantID); // remember that the dependant needs a recalc
			}
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdateIDEnum.DoubleEnum);
		}
	}

	function PDHF_ExecuteRemovePredecessorsCommand(i_pIProjectRemovePredecessorsCmdRecord)
	{
		var DependantID = i_pIProjectRemovePredecessorsCmdRecord.OpenField("TaskID");
		var pIPredecessorIDEnum = PDHF_IDEnumFromString(i_pIProjectRemovePredecessorsCmdRecord.OpenField("PredecessorIDs"));
		var pIValidPredecessorEnum = CreateDoubleEnum();

		// Check permission
		if(false == PDHF_CanExecuteAddRemovePredecessorsCommand(DependantID))
		{
			PDHF_SetAccessDeniedError("Cannot remove predecessors");
			return;
		}

		// First determine which predecessors actually exist
		while(pIPredecessorIDEnum.HasMore())
		{
			var PredecessorID = pIPredecessorIDEnum.OpenNext();

			if(RecordSetEngine.HasRecord(PredecessorID) && RecordSetEngine.HasRecord(DependantID))
			{
				var RelationshipID = RelationshipManager.FindRelationship("Predecessor", PredecessorID, DependantID);
				if(0 != RelationshipID)
				{
					pIValidPredecessorEnum.Add(PredecessorID);
				}
			}
		}
		pIValidPredecessorEnum = pIValidPredecessorEnum.DoubleEnum;

		// Determine which items need to be recalculated (note that we 
		// do not need to recalculate the predecessors being removed)
		var pIUpdateIDEnum = PDHF_GetDependantRecordsForUpdate(pIValidPredecessorEnum);

		// Delete the predecessor relationships
		pIValidPredecessorEnum.Reset();
		while(pIValidPredecessorEnum.HasMore())
		{
			var PredecessorID = pIValidPredecessorEnum.OpenNext();
			var RelationshipID = RelationshipManager.FindRelationship("Predecessor", PredecessorID, DependantID);

			// Remove the realtionship
			RelationshipManager.DeleteRelationship(RelationshipID);
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			// recalc effected items
			pIUpdateIDEnum.Reset();
			PDHF_RecalculateItems(pIUpdateIDEnum.DoubleEnum);
		}
	}


	function PDHF_ExecuteDeleteItemsCommand(i_pIProjectDeleteItemsCmdRecord)
	{
		// Get enum from command string.
		var pIDeleteIDEnum = PDHF_IDEnumFromString(i_pIProjectDeleteItemsCmdRecord.OpenField("TaskIDs"));
		var DeleteList = CreateDoubleEnum();

		// Check permission: Can Execute Delete Command?
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var CreatorContactURL = DynamicsMgr.CommandContext.CreatorContactURL;

		var ProjectID = GrooveRunTimeData.GetItem("PROJECT_ID");
		while(pIDeleteIDEnum.HasMore())
		{
			var DeleteID = pIDeleteIDEnum.OpenNext();

			// Make sure we're not trying to delete project record
			if(ProjectID == DeleteID)
			{
				GrooveDebugFunctions.DisplayAssert(0, "Attempt to delete project item");
				return;
			}

			if(RecordSetEngine.HasRecord(DeleteID))
			{
				if(false == PDHF_CanUserRemoveTaskAndChildren(CreatorContactURL, DeleteID))
				{
					PDHF_SetAccessDeniedError("Cannot delete the specified items");
					return;
				}

				// Remove all attachments and folders associated with this object.
				var ItemRecord = RecordSetEngine.OpenRecord(DeleteID);
				MHF_DeleteAllDocShareObjectsAttachedToRecord(DocShareEngine, ItemRecord);
				MHF_DeleteShareFolderByName(DocShareEngine, ItemRecord.ID)

				// Add specified item to deletion list.
				DeleteList.Add(DeleteID);
			}
		}

		// If the delete list contains children of nodes that are going to be deleted,
		// take them out of the list so that the list of dependant records does not
		// include any of those that have just been deleted.  Also, convert the interface
		// to IGrooveDoubleEnum in the process
		DeleteList = PDHF_RemoveRedundantDecendants(DeleteList.DoubleEnum);
		DeleteList.Reset();

		// Find the records that need to be recalculated before we perform the delete
		// note that we cannot include the deleted items in the list
		var pIUpdateIDEnum = PDHF_GetDependantRecordsForUpdate(DeleteList);

		// Delete the items -- relationships with the items are automatically destroyed
		// AM - we MUST delete the hierarchical items in depth first order to ensure that
		// when an UNDO operation is performed, the parent items are re-done (added) before the
		// children.  This is important because the collection will ignore items that
		// are added with an invalid parent, which would cause the collection to get out
		// of sync.
		DeleteList.Reset();
		while(DeleteList.HasMore())
		{
			var ID = DeleteList.OpenNext();
			var pIChildIDEnum = RecordSetEngine.HierarchicalRecordSetEngine.OpenDescendantRecordIDEnum
																	(
																		ID,
																		-1,
																		GrooveDescendantEnumerationOrder_DepthFirst
																	);
			// RSE does not behave well when called with an empty enum
			if(pIChildIDEnum.HasMore())
			{
				RecordSetEngine.RemoveMultipleRecords(pIChildIDEnum);
			}

			RecordSetEngine.RemoveRecord(ID);
		}

		// AM - the trick that we use above (prune redundant decendants BEFORE
		// running the topographical sort) to avoid recalculating items that have 
		// just been deleted does not cover all bases.  In the case where we have:
		//
		//	Root
		//		A
		//		B
		//		  C
		//
		// and A is a predecessor of C, we only ask the relationship manager for the
		// ordered sort based on [A, B] changing (since C was pruned as a redundant
		// descendant).  The resulting update list will then be [C, Root], which will
		// cause a problem when we try to recalculate, since C has just been deleted.
		// To plug this hole, we need to fix up the list here by removing items that
		// no longer exist.
		var pIExistingUpdateIDEnum = CreateDoubleEnum();
		while(pIUpdateIDEnum.HasMore())
		{
			var CurrentID = pIUpdateIDEnum.OpenNext();
			if(RecordSetEngine.HasRecord(CurrentID))
			{
				pIExistingUpdateIDEnum.Add(CurrentID);
			}
		}
		pIUpdateIDEnum = pIExistingUpdateIDEnum.DoubleEnum;

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_RecalculateItems(pIUpdateIDEnum);
		}
	}


	//
	// Demoting an item (indent) has the following impact on the data model:
	// 1) The demoted item becomes a child of it's previous sibling
	//
	function PDHF_ExecuteDemoteItemsCommand(i_pIProjectDemoteItemsCmdRecord)
	{
		var pIDemoteIDEnum = PDHF_IDEnumFromString(i_pIProjectDemoteItemsCmdRecord.OpenField("TaskIDs"));
		var pIUpdateEnum = CreateDoubleEnum();

		// Check permission
		if(false == PDHF_CanExecutePromoteDemoteCommand(pIDemoteIDEnum))
		{
			PDHF_SetAccessDeniedError("Cannot demote items");
			return;
		}

		// Adjust relationships for items that can be demoted --order of operations
		// is important for searching
		pIDemoteIDEnum.Reset();
		while(pIDemoteIDEnum.HasMore())
		{
			var CurrentDemoteID = pIDemoteIDEnum.OpenNext();

			// Only perform the demote if it will not generate a cycle
			// (for example, when the new parent is a predecessor of the item being demoted)
			// and when the item is not the first child of the parent
			// Note that we must perform the check inside of this loop since the previous
			// sibling of the demotee will change as we go
			var PreviousSiblingID = PDHF_GetPreviousSiblingID(CurrentDemoteID);
			var CreatesCycle = false;
			if(-1 != PreviousSiblingID &&
			   false == (CreatesCycle = PDHF_DoesDemoteCreateCycle(CurrentDemoteID, PreviousSiblingID)))
			{
				// Remove existing parent/child relationship
				PDHF_DeleteParentChildRelationship(CurrentDemoteID);

				// Create new parent/child relationship
				PDHF_CreateParentChildRelationship(PreviousSiblingID, CurrentDemoteID);

				// Make RSE reparent the items
				RecordSetEngine.HierarchicalRecordSetEngine.DemoteRecord(CurrentDemoteID);

				// The NewParent may have become a parent as a result of the demote
				// so we need to make sure it does not have any predecessors since
				// parent's cant have predecessors (this also deletes any child-to-parent
				// predecessor dependencies)
				RelationshipManager.DeleteRelationshipsWithRecord("Predecessor", GrooveRelationshipSide_Right,
																  PreviousSiblingID);

				// No need to look for the case where the parent is the predecessor
				// of the child because this generates a dependency cycle and so it
				// was trapped in the code above
				
				// we do not need to update the old parent because, by definition,
				// it is the grandparent of the item being demoted
				pIUpdateEnum.Add(PreviousSiblingID);

				// If the item was a task, the dates are unchanged
				// if the item was a parent, the start/duration/finish that were
				// calculated now become static and we only need to recalculate the 
				// date for our new ancestors
				//  ==> the demoted item does not need to be recalculated
			}
/* xxx Unfortunately there is no good way to display a user message
	   from here.
			else if (CreatesCycle) 
			{
				// Generate an exception.
				var e = new Error;
				e.number = PROJECTTRACKING_E_CYCLE_CHECK_FAILED;
				e.description = "Cycle Check Failed";

				// Get task name
				var pIRecord = RecordSetEngine.OpenRecord(CurrentDemoteID);
				var Name = pIRecord.OpenField("Name"); 
				e.message = "Selected tasks were not demoted, because demoting task \"" + Name + "\" creates circular dependency.";

				// Throw			
				throw(e);
				return;
			}
*/
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdateEnum.DoubleEnum);
		}
	}

	//
	// Promoting an item (outdent) has the following impact on the data model:
	// 1) The promoted item's grandparent becomes it's new parent
	//
	function PDHF_ExecutePromoteItemsCommand(i_ProjectPromoteItemsCmdRecord)
	{
		var pIPromoteIDEnum = PDHF_IDEnumFromString(i_ProjectPromoteItemsCmdRecord.OpenField("TaskIDs"));
		var pIUpdateEnum = CreateDoubleEnum();

		// check permission
		if(false == PDHF_CanExecutePromoteDemoteCommand(pIPromoteIDEnum))
		{
			PDHF_SetAccessDeniedError("Cannot promote items");
			return;
		}

		pIPromoteIDEnum.Reset();
		var ProjectID = GrooveRunTimeData.GetItem("PROJECT_ID");
		while(pIPromoteIDEnum.HasMore())
		{
			var CurrentPromoteID = pIPromoteIDEnum.OpenNext();

			// ignore deleted records
			if(RecordSetEngine.HasRecord(CurrentPromoteID))
			{
				var WasParent = PDHF_HasChildren(CurrentPromoteID);
				var OldParentID = PDHF_GetParentID(CurrentPromoteID);

				// ignore the promote command if the collection is hosed
				if(-1 == OldParentID)
				{
					GrooveDebugFunctions.DisplayAssert(0, "Invalid parent");
					continue;
				}

				// do not allow item to be promoted past the root
				if(ProjectID == OldParentID)
				{
					continue;
				}

				// remove relationship with old parent
				PDHF_DeleteParentChildRelationship(CurrentPromoteID);
				
				// make the RSE reparent the item
				RecordSetEngine.HierarchicalRecordSetEngine.PromoteRecord(CurrentPromoteID);

				// create realtionship with new parent
				var NewParentID = PDHF_GetParentID(CurrentPromoteID);
				PDHF_CreateParentChildRelationship(NewParentID, CurrentPromoteID);

				// promote has no effect on the dates of the promoted item, 
				// only on the dates of it's new and old parents
				pIUpdateEnum.Add(NewParentID)
				pIUpdateEnum.Add(OldParentID);
			}
		}

		if(false == PDHF_IsCalculationDeferred() || false == PDHF_IsLocalDelta())
		{
			PDHF_UpdateChangedItems(pIUpdateEnum.DoubleEnum);
		}
	}


	function PDHF_ExecuteImportItemsCommand(i_pIPseudoCommandRecord)
	{
		var pIImportElement = i_pIPseudoCommandRecord.OpenFieldAsElement("ImportList");
		var CheckForCycles = pIImportElement.OpenAttributeAsBool("NeedsCycleCheck");
		var pIUpdateEnum = CreateDoubleEnum();

		if(false == PDHF_CanExecuteAddTaskCommand())
		{
			PDHF_SetAccessDeniedError("Cannot add new items");
			return;
		}

		// Create relationship enum
		var IID_IGrooveRelationshipEnum = "{54A7ED0F-03D0-4145-BBDB-D5FF4ADE4B60}";
		var IID_IGrooveRelationship = "{824C0AE8-84B7-4CBA-BD42-FBBCD8B8797C}";
		var pIRelationshipEnum = CreateUnknownEnumFromStringIIDs(IID_IGrooveRelationshipEnum, IID_IGrooveRelationship);

		// Loop through all elements and build a relationship enum
		var ProjectID = GrooveRunTimeData.GetItem("PROJECT_ID");
		for(var i = 0; i < pIImportElement.GetContentCount(); ++i)
		{
			var pITaskElement = pIImportElement.OpenContentElement(i);
			var ID = pITaskElement.OpenAttributeAsDouble("ID");

			if(true == RecordSetEngine.HasRecord(ID))
			{
				var pIRecord = RecordSetEngine.OpenRecord(ID);
				var ParentID = pIRecord.OpenField("_ParentID");

				// If parent was deleted, remove the record and re-add it with 
				// the project singleton item (which always exists) as it's parent
				// we can't just call SetField because the collection did not add the
				// record to any of it's hierarchical indexes because the parent did not
				// exist at add time
				if(false == RecordSetEngine.HasRecord(ParentID))
				{
					ParentID = ProjectID;
					pIRecord = pIRecord.Clone();

					RecordSetEngine.RemoveRecord(ID);
					
					pIRecord.SetFieldAsDouble("_ParentID", ParentID);
					RecordSetEngine.AddRecord(pIRecord);
				}

				// Add parent/child relationship to enum.
				if(ParentID == ProjectID)
				{
					pIRelationshipEnum.Add(RelationshipManager.PackRelationshipAttributes("ProjectParentChild", ParentID, pIRecord.RecordID));
				}
				else
				{
					pIRelationshipEnum.Add(RelationshipManager.PackRelationshipAttributes("TaskParentChild", ParentID, pIRecord.RecordID));
				}

				// Is this a leaf node?  It is if expression evaluates to false.
				if(false == PDHF_HasChildren(ID))
				{
					if(0 == pITaskElement.GetContentCount())
					{
						// Remember what we have actually processed
						pIUpdateEnum.Add(ID);
					}
					
					// Add predecessors for leaves (not supported for summary tasks)
					for(var j = 0; j < pITaskElement.GetContentCount(); ++j)
					{
						var pIPredecessorElement = pITaskElement.OpenContentElement(j);
						var PredecessorID = pIPredecessorElement.OpenAttributeAsDouble("ID");

						pIRelationshipEnum.Add(RelationshipManager.PackRelationshipAttributes("Predecessor", PredecessorID, ID));
					}
				}
			}
			else
			{
				GrooveDebugFunctions.DisplayAssert(0, "Missing record");
			}
		}

		// Create all relationships
		RelationshipManager.CreateMultipleRelationships(pIRelationshipEnum, CheckForCycles);

		// Update all the changed items.
		PDHF_UpdateChangedItems(pIUpdateEnum.DoubleEnum);
	}

	////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////
	//
	// Calculation functions
	//


	//
	// Recalculate all changed items and any items dependant on them
	//
	// Assumptions: all records in i_pIChangedItemsIDEnum exist
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_UpdateChangedItems(i_pIChangedItemsIDEnum, i_StatusOnly)
	{
		// Return an ordered list of items that need to be recalculated
		// given the provided set of items that have just changed.  The
		// returned list contains the input items.
		var pIUpdateIDEnum = RelationshipManager.FindSortedRecordsByRelationships("DependencyGraph", i_pIChangedItemsIDEnum);

		//
		PDHF_RecalculateItems(pIUpdateIDEnum, i_StatusOnly);
	}

	//
	// Recalculate the items specified in the provided ID enum
	//
	function PDHF_RecalculateItems(i_pIEffectedIDEnum, i_StatusOnly)
	{
		try
		{
			// Start asynch progress notification
			var bShowProgress = PDHF_BeginProgress();
			if (!bShowProgress)
			{
				// Don't show progress
				while(i_pIEffectedIDEnum.HasMore())
				{
					PDHF_RecalculateItem(i_pIEffectedIDEnum.OpenNext(), i_StatusOnly);
				}
			}
			else // Show progress
			{
				// How many recalcs?
				var ProgressRefreshMS = 250; // 4 per second
				var NumCalculations = 0;

				i_pIEffectedIDEnum.Reset();
				while(i_pIEffectedIDEnum.HasMore())
				{
					var CurrentID = i_pIEffectedIDEnum.OpenNext();
					++NumCalculations;				
				}
				i_pIEffectedIDEnum.Reset();

				var CalculationNumber = 0;
				var LastProgressEvent = new Date();
				while(i_pIEffectedIDEnum.HasMore())
				{
					var CurrentID = i_pIEffectedIDEnum.OpenNext();
					PDHF_RecalculateItem(CurrentID, i_StatusOnly);

					// don't give too many progress updates
					var CurrentEvent = new Date();
					var PercentComplete = Math.round(++CalculationNumber * 100 / NumCalculations);
					if(100 == PercentComplete ||
					   ProgressRefreshMS < CurrentEvent.valueOf() - LastProgressEvent.valueOf())
					{
						PDHF_UpdateProgress(PercentComplete);
						LastProgressEvent = CurrentEvent;
					}
				}

				PDHF_EndProgress();
			}

		}
		catch(e)
		{
			if (bShowProgress)
				PDHF_EndProgress();
			throw e;
		}
	}

	//
	// Recalculate the item according to it's type
	// If we are only recalculating the status, we can
	// skip task items.
	//
	function PDHF_RecalculateItem(i_Item, i_StatusOnly)
	{
		if(true == PDHF_HasChildren(i_Item) || i_Item == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			PDHF_CalculateSummaryDates(i_Item);
		}
		else if (null == i_StatusOnly || false == i_StatusOnly)
		{
			PDHF_CalculateTaskDates(i_Item);
		}
	}

	//
	// Return an ordered list of items that need to be recalculated
	// given the provided set of items that have just changed.  The
	// returned list does not contain any of the input items.
	//
	// Assumptions: all records in i_pIChangedItemsIDEnum exist
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetDependantRecordsForUpdate(i_pIChangedItemsIDEnum)
	{
		var pIUpdateEnum = CreateDoubleEnum();
		var SparseArray = PDHF_SparseArrayFromEnum(i_pIChangedItemsIDEnum);
		var pIOrderedChangeEnum = RelationshipManager.FindSortedRecordsByRelationships("DependencyGraph", i_pIChangedItemsIDEnum);

		while(pIOrderedChangeEnum.HasMore())
		{
			var CurrentID = pIOrderedChangeEnum.OpenNext();
			if(false == SparseArray.Contains(CurrentID))
			{
				// ID not in the input list so include it in the result set
				pIUpdateEnum.Add(CurrentID);
			}
		}

		return pIUpdateEnum.DoubleEnum;
	}


	//
	// Assumptions: i_TaskID exists and does not have any children
	//
	// If possible, we leave the scheduled start date untouched to allow 
	// user entered dates to persist until something forces them to change
	//
	// TRANSACTION_REQUIREMENTS: WRITE
	function PDHF_CalculateTaskDates(i_TaskID)
	{	
		var pIProjectRecord = RecordSetEngine.OpenRecord(GrooveRunTimeData.GetItem("PROJECT_ID"));
		var pITaskRecord = RecordSetEngine.OpenRecord(i_TaskID);
		var pIPredecessorEnum = RelationshipManager.FindRecordsByRelationship("Predecessor", GrooveRelationshipSide_Right, i_TaskID);

		// Get current start and duration
		var Start = pITaskRecord.OpenField("ScheduledStart");
		var ProjectStart = pIProjectRecord.OpenField("ScheduledStart");
		var ConstrainStartDate = pITaskRecord.OpenField("ConstrainStartDate");
		var Duration = pITaskRecord.OpenField("ScheduledDuration");
		var CalculatedStart = ProjectStart;

		// Start date can be constrained by the user
		if(true == ConstrainStartDate)
		{
			var UserStart = pITaskRecord.OpenField("UserStartConstraint");
			if(UserStart > CalculatedStart)
			{
				CalculatedStart = UserStart;	
			}
		}

		// Start date cannot be earlier than the project start date
		if(ProjectStart > CalculatedStart)
		{
			CalculatedStart = ProjectStart;
		}

		// Calculate the start date based on the predecessors and user-start date constraint
		if(pIPredecessorEnum.HasMore())
		{
			var LatestPredecessorFinish = CalculatedStart;
			while(pIPredecessorEnum.HasMore())
			{
				var pIRecord = RecordSetEngine.OpenRecord(pIPredecessorEnum.OpenNext());
				var PredecessorFinish = pIRecord.OpenField("ScheduledFinish");

				if(PredecessorFinish > LatestPredecessorFinish)
				{
					LatestPredecessorFinish = PredecessorFinish;
				}
			}

			CalculatedStart = LatestPredecessorFinish;
		}

		// Determine the work week start and finish dates
		CalculatedStart = PDHF_GetStartInWorkWeek(CalculatedStart);
		var CalculatedFinish = PDHF_GetFinishInWorkWeek(CalculatedStart, Duration);
		pITaskRecord.SetFieldAsDouble("ScheduledStart", CalculatedStart);
		pITaskRecord.SetFieldAsDouble("ScheduledFinish", CalculatedFinish);

		// Calculate display date
		var DisplayFinish = MHF_GetDisplayFinishDateMS(Duration, CalculatedFinish)
		pITaskRecord.SetFieldAsDouble("DisplayFinish", DisplayFinish);
	}


	//
	// Assumptions: i_SummaryTaskID exists
	//
	// TRANSACTION_REQUIREMENTS: WRITE
	//
	// A note about calculations:
	//	ScheduledStart is the earliest of all children start dates
	//  ScheduledFinish is the latest of all children end dates
	//  ScheduledDuration is the difference of these two
	//	Status is InProgress if at least one item is not "NotStarted" and is
	//		"Complete" if all children are complete
	//	Priority is the highest priority of all children
	//
	// NOTE: Caller must make sure this is a summary task.  That is, this task 
	//		 has children and is not a Project Task.
	//
	function PDHF_CalculateSummaryDates(i_SummaryTaskID)
	{
		var EarliestScheduledStart = Number.MAX_VALUE;
		var LatestScheduledFinish = 0;
		var EarliestActualStart = Number.MAX_VALUE;
		var LatestActualFinish = 0;
		var StatusStarted = false;
		var StatusCompleted = true;
		var HighestPriority = GrooveProjectToolsetPriorityType_Low;
		var LatestDisplayFinish = 0;

		var pISummaryTaskRecord = RecordSetEngine.OpenRecord(i_SummaryTaskID);
		var pIChildEnum = PDHF_GetChildrenFromRelationships(i_SummaryTaskID);
		pIChildEnum.Reset();

		if(false == pIChildEnum.HasMore() && i_SummaryTaskID != GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			GrooveDebugFunctions.DisplayAssert(0, "This is not a summary task!");
			return;
		}

		// If the project does not contain any items, mark it as "not started"
		var bIsProjectTask = (i_SummaryTaskID == GrooveRunTimeData.GetItem("PROJECT_ID"));
		if(bIsProjectTask && false == pIChildEnum.HasMore())
		{
			StatusStarted = false;
			StatusCompleted = false;	
		}

		while(pIChildEnum.HasMore())
		{
			var ChildID = pIChildEnum.OpenNext();
			var pIChildRecord = RecordSetEngine.OpenRecord(ChildID);
			var ScheduledStart = pIChildRecord.OpenField("ScheduledStart");
			var ScheduledFinish = pIChildRecord.OpenField("ScheduledFinish");
			var DisplayFinish = pIChildRecord.OpenField("DisplayFinish");
			var Status = pIChildRecord.OpenField("Status");
			var Priority = pIChildRecord.OpenField("Priority");

			// Scheduled start
			if(ScheduledStart < EarliestScheduledStart)
			{
				EarliestScheduledStart = ScheduledStart;
			}

			// Scheduled finish
			if(ScheduledFinish > LatestScheduledFinish)
			{
				LatestScheduledFinish = ScheduledFinish;
			}

			// Display finish
			if(DisplayFinish > LatestDisplayFinish)
			{
				LatestDisplayFinish = DisplayFinish;
			}

			// Status
			StatusStarted |= (Status == GrooveProjectToolsetStatusType_InProgress || Status == GrooveProjectToolsetStatusType_Complete);
			StatusCompleted &= (Status == GrooveProjectToolsetStatusType_Complete);

			// Priority
			if(Priority > HighestPriority)
			{
				HighestPriority = Priority;
			}

			// Actual start
			if(GrooveProjectToolsetStatusType_InProgress == Status || 
			   GrooveProjectToolsetStatusType_Complete == Status)
			{
				var ActualStart = pIChildRecord.OpenField("ActualStart");
				if(ActualStart < EarliestActualStart)
				{
					EarliestActualStart = ActualStart;
				}
			}

			// Actual finish
			if(GrooveProjectToolsetStatusType_Complete == Status)
			{
				var ActualFinish = pIChildRecord.OpenField("ActualFinish");
				if(ActualFinish > LatestActualFinish)
				{
					LatestActualFinish = ActualFinish;
				}
			}
		}

		// Scheduled start/finish/duration 
		//
		// Scheduled start is NOT calculated for the project item, as it is a
		// fixed point in time.  
		//
		// Since the project start date is fixed in time, make sure we calculate
		// the duration appropriately
		var ScheduledStart = 0;
		if(bIsProjectTask)
		{
			ScheduledStart = pISummaryTaskRecord.OpenField("ScheduledStart");
			
			// If the project is empty, LastScheduledFinish will still be uninitialized
			if(0 == LatestScheduledFinish)
			{
				LatestScheduledFinish = ScheduledStart;
			}
		}
		else
		{
			ScheduledStart = EarliestScheduledStart;
			if(LatestScheduledFinish < ScheduledStart)
			{
				GrooveDebugFunctions.DisplayAssert(0, "Ruh-ro");
				LatestScheduledFinish = ScheduledStart;
			}

			pISummaryTaskRecord.SetFieldAsDouble("ScheduledStart", ScheduledStart);
		}

		// Display date
		if (0 == LatestDisplayFinish)
			LatestDisplayFinish = LatestScheduledFinish;
		pISummaryTaskRecord.SetFieldAsDouble("DisplayFinish", LatestDisplayFinish);

		// Duration
		var	Duration = PDHF_GetWorkWeekDuration(ScheduledStart, LatestScheduledFinish);
		pISummaryTaskRecord.SetFieldAsDouble("ScheduledDuration", Duration);

		// Scheduled Finish date
		pISummaryTaskRecord.SetFieldAsDouble("ScheduledFinish", LatestScheduledFinish);

		// Status
		var NewStatus;
		if(true == StatusCompleted)
		{
			NewStatus = GrooveProjectToolsetStatusType_Complete;
		}
		else if(true == StatusStarted)
		{
			NewStatus = GrooveProjectToolsetStatusType_InProgress;
		}
		else
		{
			NewStatus = GrooveProjectToolsetStatusType_NotStarted;
		}

		pISummaryTaskRecord.SetField("Status", NewStatus);

		// Actual start
		if(GrooveProjectToolsetStatusType_InProgress == NewStatus || 
		   GrooveProjectToolsetStatusType_Complete == NewStatus)
		{
			pISummaryTaskRecord.SetFieldAsDouble("ActualStart", EarliestActualStart);
		}

		// Actual finish
		if(GrooveProjectToolsetStatusType_Complete == Status)
		{
			pISummaryTaskRecord.SetFieldAsDouble("ActualFinish", LatestActualFinish);
		}

		// Priority
		// Project task is a special kind of Summary task that does not have a priority field.
		if (!bIsProjectTask)
		{
			pISummaryTaskRecord.SetField("Priority", HighestPriority);
		}
	}


	//
	// return a date (in ms) of the first work day occuring on or
	// after i_Start
	//
	function PDHF_GetStartInWorkWeek(i_Start)
	{
		var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pIDate = pIIntl.CreateDateFromRawDateTime(i_Start);
		var pICalendar = pIIntl.CreateCalendar();
		pICalendar.DateTime = pIDate;
		
		// begin at the start of the day
		var Year = pICalendar.Get(GrooveIntlCalendarField_Year);
		var Month = pICalendar.Get(GrooveIntlCalendarField_Month);
		var Day = pICalendar.Get(GrooveIntlCalendarField_DayOfMonth);
		pICalendar.Clear();
		pICalendar.SetDate(Year, Month, Day);
		
		var DayOfWeek = pICalendar.Get(GrooveIntlCalendarField_DayOfWeek);

		if(DayOfWeek == GrooveIntlCalendarDayOfWeek_Sunday)
		{
			pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, 1);
		}
		else if(DayOfWeek == GrooveIntlCalendarDayOfWeek_Saturday)
		{
			pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, 2);
		}

		return pICalendar.DateTime.RawDateTime;
	}

	//
	// return the finish date (in ms) given the specified start
	// and duration and work-week
	//
	function PDHF_GetFinishInWorkWeek(i_Start, i_Duration)
	{
		var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pIDate = pIIntl.CreateDateFromRawDateTime(i_Start);
		var pICalendar = pIIntl.CreateCalendar();

		pICalendar.DateTime = pIDate;

		var StartDayOfWeek = pICalendar.Get(GrooveIntlCalendarField_DayOfWeek);
		var DurationDays = i_Duration / g_MSPERDAY;
		var FullWorkWeeks = Math.floor(DurationDays / g_NUMWORKDAYS);
		var PartialWorkWeekDays = DurationDays % g_NUMWORKDAYS;

		GrooveDebugFunctions.DisplayAssert(StartDayOfWeek != GrooveIntlCalendarDayOfWeek_Saturday &&
									StartDayOfWeek != GrooveIntlCalendarDayOfWeek_Sunday,
									"Invalid start day of week");

		// Weeks
		pICalendar.Add(GrooveIntlCalendarField_WeekOfYear, FullWorkWeeks);

		// Days
		// wrap the weekend, if necessary
		if (StartDayOfWeek + PartialWorkWeekDays > GrooveIntlCalendarDayOfWeek_Friday)
		{
			pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, g_DAYSOFF);
		}

		pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, PartialWorkWeekDays);

		return pICalendar.DateTime.RawDateTime;
	}

	//
	// return the duration in work-week days (in ms)
	// assumptions: i_Start and i_Finish are work days
	function PDHF_GetWorkWeekDuration(i_Start, i_Finish)
	{
		var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pIStartDate = pIIntl.CreateDateFromRawDateTime(i_Start);
		var pIFinishDate = pIIntl.CreateDateFromRawDateTime(i_Finish);

		var DurationMS = pIFinishDate.GetElapsedTime(pIStartDate);
		
		// AMLATER - HACK
		// if this task spans a switch of daylight savings time,
		// we will lose an hour -- to work around this problem, we
		// round the duration to the closest integer when calculating
		// number of days
		var DurationDays = Math.round(DurationMS / g_MSPERDAY);
		var DurationWeeks = Math.floor(DurationDays / g_DAYSPERWEEK);
		var PartialWeekDays = DurationDays % g_DAYSPERWEEK;

		// account for wrap around a weekend
		var pIStartCalendar = pIIntl.CreateCalendar();
		pIStartCalendar.DateTime = pIStartDate;
		var pIFinishCalendar = pIIntl.CreateCalendar();
		pIFinishCalendar.DateTime = pIFinishDate;

		var StartDayOfWeek = pIStartCalendar.Get(GrooveIntlCalendarField_DayOfWeek);
		var FinishDayOfWeek = pIFinishCalendar.Get(GrooveIntlCalendarField_DayOfWeek);

		// PartialWeekDays is a number less than g_DAYSPERWEEK
		// but we need to account for a wrap around a weekend
		if(FinishDayOfWeek < StartDayOfWeek)
		{
			PartialWeekDays -= g_DAYSOFF;
		}

		return ((DurationWeeks * g_NUMWORKDAYS) + PartialWeekDays) * g_MSPERDAY;
	}

	function PDHF_WorkWeekAddDuration(i_DateMS, i_WorkWeekDuration)
	{
		var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var pIDate = pIIntl.CreateDateFromRawDateTime(i_DateMS);
		var pICalendar = pIIntl.CreateCalendar();
		pICalendar.DateTime = pIDate;

		var StartDayOfWeek = pICalendar.Get(GrooveIntlCalendarField_DayOfWeek);
		var DurationDays = i_WorkWeekDuration / g_MSPERDAY;
		var FullWorkWeeks = Math.floor(Math.abs(DurationDays) / g_NUMWORKDAYS);
		var PartialWorkWeekDays = Math.abs(DurationDays) % g_NUMWORKDAYS;

		// account for negative duration
		if(i_WorkWeekDuration < 0)
		{
			FullWorkWeeks = -FullWorkWeeks;
			PartialWorkWeekDays = -PartialWorkWeekDays;
		}

		GrooveDebugFunctions.DisplayAssert(StartDayOfWeek != GrooveIntlCalendarDayOfWeek_Saturday &&
									StartDayOfWeek != GrooveIntlCalendarDayOfWeek_Sunday,
									"Invalid start day of week");

		// weeks
		pICalendar.Add(GrooveIntlCalendarField_WeekOfYear, FullWorkWeeks);

		// days
		// wrap the weekend, if necessary
		if(i_WorkWeekDuration >= 0)
		{
			if(StartDayOfWeek + PartialWorkWeekDays > GrooveIntlCalendarDayOfWeek_Friday)
			{
				pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, g_DAYSOFF);
			}
		}
		else
		{
			// PartialWorkDays is negative -- determine if we wrap around the weekend
			if(StartDayOfWeek + PartialWorkWeekDays < GrooveIntlCalendarDayOfWeek_Monday)
			{
				pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, -g_DAYSOFF);
			}
		}

		pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, PartialWorkWeekDays);

		return pICalendar.DateTime.RawDateTime;
	}

	//
	// build up a space delimited string of IDs
	//
	function PDHF_IDEnumFromString(i_String)
	{
		var CurrentStart=0;
		var pIIDEnum = CreateDoubleEnum();

		if(0 == i_String.length)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Empty ID string");
			return pIIDEnum.DoubleEnum;
		}

		while(CurrentStart <= i_String.length-1)
		{
			var NextSeparator = i_String.indexOf(" ", CurrentStart);

			// if we're at the end of the list there's no trailing space
			if(-1 == NextSeparator)
			{
				NextSeparator = i_String.length;
			}

			var IDString = i_String.substr(CurrentStart, NextSeparator-CurrentStart);
			pIIDEnum.Add(IDString);
			CurrentStart = NextSeparator+1;
		}

		return pIIDEnum.DoubleEnum;
	}


	//
	// extract an IDenum from a string of space delimited IDs
	//
	function PDHF_StringFromIDEnum(i_pIDoubleEnum)
	{
		var String = "";
		i_pIDoubleEnum.Reset();
		if(false == i_pIDoubleEnum.HasMore())
		{
			return String;
		}

		String = i_pIDoubleEnum.OpenNext().toString();
		while(i_pIDoubleEnum.HasMore())
		{
			String += " ";
			String += i_pIDoubleEnum.OpenNext().toString();
		}

		return String;
	}

	function PDHF_IncrementCalculationDeferCount()
	{
		if(false == GrooveRunTimeData.HasItem("DeferCalculationCount"))
		{
			GrooveRunTimeData.SetItem("DeferCalculationCount", 0);
		}

		GrooveRunTimeData.SetItem("DeferCalculationCount", GrooveRunTimeData.GetItem("DeferCalculationCount") + 1);
	}

	function PDHF_DecrementCalculationDeferCount()
	{
		var DeferCount;
		if(false == GrooveRunTimeData.HasItem("DeferCalculationCount") ||
			0 == (DeferCount = GrooveRunTimeData.GetItem("DeferCalculationCount")))
		{
			GrooveErrorFunctions.SetCurrentError(PROJECTTRACKING_E_INVALID_OPERATION, "Unmatched call to Begin/EndMulitpleModifications.");
			return;
		}
		else
			GrooveRunTimeData.SetItem("DeferCalculationCount", --DeferCount);
	}

	function PDHF_IsCalculationDeferred()
	{
		if(GrooveRunTimeData.HasItem("DeferCalculationCount"))
		{
			return 0 != GrooveRunTimeData.GetItem("DeferCalculationCount");
		}
		return false;
	}


	function PDHF_AddListener(i_pIListener)
	{
		// AMLATER - add support for multiple listeners
		if(null != GrooveRunTimeData.GetItem("SYNCHPROGRESSCALLBACK"))
		{
			GrooveDebugFunctions.DisplayAssert(0, "Already have a listener");
			return;
		}

		GrooveRunTimeData.SetItem("SYNCHPROGRESSCALLBACK", i_pIListener);
	}

	function PDHF_RemoveListener(i_pIListener)
	{
		// AMLATER - add support for multiple listeners
		GrooveRunTimeData.SetItem("SYNCHPROGRESSCALLBACK", null);
	}

	//
	// return the progress listener if there is one and we can fire a progress
	// message for the current execution of this delta
	//
	function PDHF_GetProgressListener()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var FirstExecution = DynamicsMgr.CommandContext.FirstExecution;
		var LocallyGenerated = DynamicsMgr.CommandContext.LocallyGenerated;
		
		// if this is the first execution of the current delta and it was generated
		// on this endpoint, we are on the same thread as the UI so we can send
		// synchronous progress messages
		if(FirstExecution && LocallyGenerated)
		{
			return GrooveRunTimeData.GetItem("SYNCHPROGRESSCALLBACK");
		}

		// not on the same thread as the UI
		return null;

	}

	
	function PDHF_BeginProgress()
	{
		var pISynchronousProgress = PDHF_GetProgressListener()
		if(null != pISynchronousProgress)
		{
			pISynchronousProgress.OnProjectCalculationStartSynchronous();
			return true;
		}
		return false;
	}

	function PDHF_UpdateProgress(i_Progress)
	{
		var pISynchronousProgress = PDHF_GetProgressListener()
		if(null != pISynchronousProgress)
		{
			pISynchronousProgress.OnProjectCalculationUpdateSynchronous(i_Progress);
		}
	}

	function PDHF_EndProgress()
	{
		var pISynchronousProgress = PDHF_GetProgressListener()
		if(null != pISynchronousProgress)
		{
			pISynchronousProgress.OnProjectCalculationEndSynchronous();
		}
	}


	//
	// Assumptions: i_RecordID exists in a hierarchical index
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetParentID(i_RecordID)
	{
		return Collection.OpenCollection().OpenRecordID(i_RecordID, GrooveCollectionNavigationOp_PriorParent);
	}


	//
	// Return the previous sibling for the specified record
	// Assumptions: i_RecordID exists in a hierarchical index
	//
	// TRANSACTION_REQUIREMENTS: READ
	//
	function PDHF_GetPreviousSiblingID(i_RecordID)
	{
		return Collection.OpenCollection().OpenRecordID(i_RecordID, GrooveCollectionNavigationOp_PriorPeer);
	}

	//
	// Find the ID of the parent/child relationship for the specified items
	//
	function PDHF_FindParentChildRelationship(i_ParentID, i_ChildID)
	{
		var RelationshipID = 0;

		RelationshipID = RelationshipManager.FindRelationship("TaskParentChild", i_ParentID, i_ChildID);
		if(0 != RelationshipID)
		{
			return RelationshipID;
		}

		RelationshipID = RelationshipManager.FindRelationship("ProjectParentChild", i_ParentID, i_ChildID);
		if(0 != RelationshipID)
		{
			return RelationshipID;
		}

		GrooveDebugFunctions.DisplayAssert(0, "Missing ParentChild relationship");
		return RelationshipID;
	}


	//
	// create new parent/child relationship
	// 
	function PDHF_CreateParentChildRelationship(i_ParentID, i_ChildID, i_ValidateRelationships /* true */)
	{
		var ValidateRelationships = true;

		// perform validation?
		if("undefined" != typeof(i_ValidateRelationships))
		{
			ValidateRelationships = i_ValidateRelationships;
		}

		if(GrooveRunTimeData.GetItem("PROJECT_ID") == i_ParentID)
		{
			RelationshipName = "ProjectParentChild";
		}
		else
		{
			RelationshipName = "TaskParentChild";
		}

		RelationshipManager.CreateRelationship(RelationshipName, i_ParentID, i_ChildID, ValidateRelationships);
	}

	//
	// Delete the parent/child relationship with the specified child
	//
	function PDHF_DeleteParentChildRelationship(i_Child)
	{
		RelationshipManager.DeleteRelationshipsWithRecord("ProjectParentChild", GrooveRelationshipSide_Right, i_Child);
		RelationshipManager.DeleteRelationshipsWithRecord("TaskParentChild", GrooveRelationshipSide_Right, i_Child);
	}


	//
	// Return the children for a specified parent
	//
	function PDHF_GetChildrenFromRelationships(i_ParentID)
	{
		var pITaskIDEnum = RelationshipManager.FindRecordsByRelationship("TaskParentChild", GrooveRelationshipSide_Left, i_ParentID);
		pITaskIDEnum.Reset();
		if(pITaskIDEnum.HasMore())
		{
			return pITaskIDEnum;
		}

		var pIProjectIDEnum = RelationshipManager.FindRecordsByRelationship("ProjectParentChild", GrooveRelationshipSide_Left, i_ParentID);
		pIProjectIDEnum.Reset();
		if(pIProjectIDEnum.HasMore())
		{
			return pIProjectIDEnum;
		}

		// no children, return empty enum
		return CreateDoubleEnum().DoubleEnum;
	}


	// 
	// Debugging aid
	//
	// Usage:
	//
	//	if(PDHF_IsDebugEnabled())
	//	{
	//		DebugValidateParentChildRelationships();
	//	}
	//
	function DebugValidateParentChildRelationships()
	{
		// start at the root and verify that each item has the same set of children as
		// the hierarchical collection recordset
		RecursiveDebugValidateParentChildRelationships(GrooveRunTimeData.GetItem("PROJECT_ID"));
	}

	function RecursiveDebugValidateParentChildRelationships(i_ItemID)
	{
		var pICollectionChildrenEnum;

		if(PDHF_HasChildren(i_ItemID))
		{
			pICollectionChildrenEnum = Collection.OpenCollection().Collection2.OpenDescendantRecordIDEnum(i_ItemID, 1, GrooveDescendantEnumerationOrder_DepthFirst);
		}
		else
		{
			pICollectionChildrenEnum = CreateDoubleEnum().DoubleEnum;
		}

		var pIRelationshipMgrChildrenEnum = PDHF_GetChildrenFromRelationships(i_ItemID);

		if(pIRelationshipMgrChildrenEnum.HasMore() != pICollectionChildrenEnum.HasMore())
		{
			GrooveDebugFunctions.DisplayAssert(0, "Relationship mismatch");
			return;
		}

		// make sure every child in the collection in in the RM
		while(pICollectionChildrenEnum.HasMore())
		{
			var CurrentChildID = pICollectionChildrenEnum.OpenNext();
			if(false == RSHP_ContainsID(pIRelationshipMgrChildrenEnum, CurrentChildID))
			{
				GrooveDebugFunctions.DisplayAssert(0, "Relationship mismatch");
				return;
			}
		}

		// make sure every child in the RM is in the collection
		pIRelationshipMgrChildrenEnum.Reset();
		pICollectionChildrenEnum.Reset();
		while(pIRelationshipMgrChildrenEnum.HasMore())
		{
			var CurrentChildID = pIRelationshipMgrChildrenEnum.OpenNext();
			if(false == RSHP_ContainsID(pICollectionChildrenEnum, CurrentChildID))
			{
				GrooveDebugFunctions.DisplayAssert(0, "Relationship mismatch");
				return;
			}
		}

		// we know this level has the same children, recurse and verify the next level
		pICollectionChildrenEnum.Reset();
		while(pICollectionChildrenEnum.HasMore())
		{
			RecursiveDebugValidateParentChildRelationships(pICollectionChildrenEnum.OpenNext());
		}
	}

	function SparseArrayClass()
	{
		this.Add = SparseArrayClass_Add;
		this.Contains = SparseArrayClass_Contains;
		this.Map = new Object();
	}

	function SparseArrayClass_Add(i_Item)
	{
		this.Map[i_Item] = true;
	}

	function SparseArrayClass_Contains(i_Item)
	{
		return null != this.Map[i_Item];
	}

	function PDHF_SparseArrayFromEnum(i_pIEnum)
	{
		var SparseArray = new SparseArrayClass();

		i_pIEnum.Reset();
		while(i_pIEnum.HasMore())
		{
			SparseArray.Add(i_pIEnum.OpenNext());
		}

		return SparseArray;
	}

	//
	// Returns true if demoting the item would generate a dependency cycle
	//
	function PDHF_DoesDemoteCreateCycle(i_DemoteID, i_NewParentID)
	{
		// The RM will use two parents for this item when it performs the cycle
		// detection. Because they are parent/children themselves, it's ok.
		return RelationshipManager.DetectRelationshipCycle("TaskParentChild", i_NewParentID, i_DemoteID);
	}

	//
	// Returns true if adding the specified predecessors to the specified task would
	// generate a cycle
	//
	function PDHF_DoesAddPredecessorsCreateCycle(i_TaskID, i_pIPredecessorIDEnum)
	{
		var IID_IGrooveRelationshipEnum = "{54A7ED0F-03D0-4145-BBDB-D5FF4ADE4B60}";
		var IID_IGrooveRelationship = "{824C0AE8-84B7-4CBA-BD42-FBBCD8B8797C}";
		var pIRelationshipEnum = CreateUnknownEnumFromStringIIDs(IID_IGrooveRelationshipEnum, IID_IGrooveRelationship);

		i_pIPredecessorIDEnum.Reset();
		while(i_pIPredecessorIDEnum.HasMore())
		{
			var CurrentPredecessorID = i_pIPredecessorIDEnum.OpenNext();
			var pINewRelationship = RelationshipManager.PackRelationshipAttributes("Predecessor", CurrentPredecessorID, i_TaskID);
			pIRelationshipEnum.Add(pINewRelationship);
		}
		
		return RelationshipManager.DetectRelationshipCycleWithEnum(pIRelationshipEnum);
	}


	// Change dates, priority, status, according to supplied command element
	function PDHF_ProcessRecalculateElement(i_StatusOnly, i_pITaskListElement)
	{
		// Now that we have verified permission, change field values, if supplied
		for (var i = 0; i < i_pITaskListElement.GetContentCount(); ++i)
		{
			var pITaskElement = i_pITaskListElement.OpenContentElement(i);
			var ID = pITaskElement.OpenAttributeAsDouble("ID");

			if (true == RecordSetEngine.HasRecord(ID) && false == PDHF_HasChildren(ID))
			{
				var pIRecord = RecordSetEngine.OpenRecord(ID);

				// change status
				if (pITaskElement.DoesAttributeExist("Status"))
				{
					PDHF_UpdateFieldIfChanged
								(
									pIRecord, 
									"Status", 
									pITaskElement.OpenAttributeAsLong("Status")
								);
				}

				if (pITaskElement.DoesAttributeExist("ActualStart"))
				{
					PDHF_UpdateDoubleFieldIfChanged
								(
									pIRecord, 
									"ActualStart", 
									pITaskElement.OpenAttributeAsDouble("ActualStart")
								);
				}

				if (pITaskElement.DoesAttributeExist("ActualFinish"))
				{
					PDHF_UpdateDoubleFieldIfChanged
								(
									pIRecord, 
									"ActualFinish", 
									pITaskElement.OpenAttributeAsDouble("ActualFinish")
								);
				}

				// change schedule?
				if (false == i_StatusOnly)
				{
					if(pITaskElement.DoesAttributeExist("UserStartConstraint"))
					{
						PDHF_UpdateDoubleFieldIfChanged
									(
										pIRecord, 
										"UserStartConstraint", 
										pITaskElement.OpenAttributeAsDouble("UserStartConstraint")
									);
					}

					if (pITaskElement.DoesAttributeExist("ConstrainStartDate"))
					{
						PDHF_UpdateFieldIfChanged
									(
										pIRecord,
										"ConstrainStartDate", 
										pITaskElement.OpenAttributeAsBool("ConstrainStartDate")
									);
					}

					if (pITaskElement.DoesAttributeExist("ScheduledDuration"))
					{
						PDHF_UpdateDoubleFieldIfChanged
									(
										pIRecord,
										"ScheduledDuration",
										pITaskElement.OpenAttributeAsDouble("ScheduledDuration")
									);
					}

					if (pITaskElement.DoesAttributeExist("Priority"))
					{
						PDHF_UpdateFieldIfChanged
									(
										pIRecord,
										"Priority",
										pITaskElement.OpenAttributeAsLong("Priority")
									);
					}
				}
			}
		}
	}



	////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////
	//
	// Access control helper functions
	//


	//
	// returns true if the user has CreateAnyItem permission
	//
	function PDHF_CanUserAddAnyItem(i_ContactURL)
	{
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.CreateAnyItem")
	}


	//
	// returns true if the user has EditOwnItem permission
	//
	function PDHF_CanUserEditOwnItem(i_ContactURL, i_ID)
	{
		// this permission only applied to tasks
		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			return false;
		}

		var pIRecord = RecordSetEngine.OpenRecord(i_ID);
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditOwnTasks") &&
			   pIRecord.OpenField("_CreatedByURL") == i_ContactURL;
	}

	//
	// returns true if the user has EditAnyItem permission
	function PDHF_CanUserEditAnyItem(i_ContactURL)
	{
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditAnyItem")
	}

	//
	// returns true if the user has EditAssignedItemStatus permission
	// (this only operates on tasks)
	function PDHF_CanUserEditAssignedItemStatus(i_ContactURL, i_ID)
	{
		// this permission only applied to tasks
		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			return false;
		}

		var pIRecord = RecordSetEngine.OpenRecord(i_ID);

		// the status for the project is _always_ calculated
		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			return false;
		}

		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditAssignedItemStatus") &&
			   pIRecord.OpenField("AssignedToContactURL") == i_ContactURL;
	}

	//
	// returns true if the user has EditAssignedItemSchedule permission
	// (this operations on tasks and the project item)
	function PDHF_CanUserEditAssignedItem(i_ContactURL, i_ID)
	{
		// this permission only applied to tasks
		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			return false;
		}

		var pIRecord = RecordSetEngine.OpenRecord(i_ID);
		var FieldName;

		if(i_ID == GrooveRunTimeData.GetItem("PROJECT_ID"))
		{
			FieldName = "TeamLeaderContactURL";
		}
		else
		{
			FieldName = "AssignedToContactURL";
		}

		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditAssignedItemSchedule") &&
			   pIRecord.OpenField(FieldName) == i_ContactURL;
	}

	function PDHF_CanUserRemoveOwnItem(i_ContactURL, i_ID)
	{
		var pIRecord = RecordSetEngine.OpenRecord(i_ID);
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.RemoveOwnTasks") &&
		 	   pIRecord.OpenField("_CreatedByURL") == i_ContactURL;
	}

	//
	// Returns true if the user can remove the specified item and all of it's children.  
	//
	function PDHF_CanUserRemoveTaskAndChildren(i_ContactURL, i_ID)
	{
		var pIItemAndChildEnum = Collection.OpenCollection().Collection2.OpenDescendantRecordIDEnum(i_ID, -1, GrooveDescendantEnumerationOrder_DepthFirst);
		pIItemAndChildEnum.DoubleEnumCreate.Add(i_ID);

		while(pIItemAndChildEnum.HasMore())
		{
			var CurrentID = pIItemAndChildEnum.OpenNext();

			if (false == PDHF_CanUserRemoveTask(i_ContactURL, CurrentID))
			{
				return false;
			}
		}

		return true;
	}

	//
	// Returns true if the user can remove the specified task.
	//
	function PDHF_CanUserRemoveTask(i_ContactURL, i_ID)
	{
		// Can user remove any task?
		if(true == CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.RemoveAnyItem"))
			return true;

		// Can user remove own tasks.
		else if (true == CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.RemoveOwnTasks"))
		{
			// Does this task belong to user?
			var pIRecord = RecordSetEngine.OpenRecord(i_ID);
			if (i_ContactURL == pIRecord.OpenField("_CreatedByURL"))
				return true;
		}

		// Cannot remove task.
		return false;
	}

	//
	// Returns true if the delta creator has permission to add a new task
	//
	function PDHF_CanExecuteAddTaskCommand()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);

		return CHF_DoesUserHavePermission(DynamicsMgr.CommandContext.CreatorContactURL,
										  "$ComponentGroup.CreateAnyItem");
	}

	//
	// Returns true if the delta creator has permission to change the schedule dates for
	// the specified items.  
	//
	function PDHF_CanExecuteRecalculateCommand(pIRecalculateIDEnum, i_StatusOnly)
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var CreatorContactURL = DynamicsMgr.CommandContext.CreatorContactURL;
		var StatusOnly = (null == i_StatusOnly) ? false : i_StatusOnly;

		while(pIRecalculateIDEnum.HasMore())
		{
			if(StatusOnly && 
			   false == PDHF_CanUserReplaceItemStatusInfo(CreatorContactURL, pIRecalculateIDEnum.OpenNext()))
			{
				return false;
			}
			else if (false == PDHF_CanUserReplaceItemScheduleInfo(CreatorContactURL, pIRecalculateIDEnum.OpenNext()))
			{
				return false;
			}
		}

		return true;
	}

	//
	// Adding and removing predecessors requires the ability to change the schedule
	//
	function PDHF_CanExecuteAddRemovePredecessorsCommand(i_ID)
	{
		var pIIDEnum = CreateDoubleEnum();
		pIIDEnum.Add(i_ID);

		return PDHF_CanExecuteRecalculateCommand(pIIDEnum.DoubleEnum);
	}


	//
	// Promote and demote require the ability to change the schedule
	//
	function PDHF_CanExecutePromoteDemoteCommand(pIDEnum)
	{
		return PDHF_CanExecuteRecalculateCommand(pIDEnum);
	}

	//
	// returns true if we can execute the reschedule project command
	//
	function PDHF_CanExecuteRescheduleProjectCommand()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var CreatorContactURL = DynamicsMgr.CommandContext.CreatorContactURL;

		return PDHF_CanUserEditProjectInformation(CreatorContactURL);
	}

	//
	// returns true if the user can change the dates for the specified item
	//
	// If any of the items do not exist, we pretend that
	// the user could update them so that they are skipped during syncronous processing
	// instead of triggering an access denied error	
	function PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID)
	{
		if(RecordSetEngine.HasRecord(i_ID))
		{
			var CanExecute = false;

			CanExecute |= PDHF_CanUserEditOwnItem(i_ContactURL, i_ID);
			CanExecute |= PDHF_CanUserEditAnyItem(i_ContactURL);
			CanExecute |= PDHF_CanUserEditAssignedItem(i_ContactURL, i_ID);

			if(false == CanExecute)
			{
				return false;
			}
		}

		return true;
	}


	//
	// returns true if the user can replace the status for the specified
	// item.
	//
	//
	// If any of the items do not exist, we pretend that
	// the user could update them so that they are skipped during syncronous processing
	// instead of triggering an access denied error	
	function PDHF_CanUserReplaceItemStatusInfo(i_ContactURL, i_ID)
	{
		if(RecordSetEngine.HasRecord(i_ID))
		{
			var CanExecute = false;

			CanExecute |= PDHF_CanUserEditOwnItem(i_ContactURL, i_ID);
			CanExecute |= PDHF_CanUserEditAnyItem(i_ContactURL);
			CanExecute |= PDHF_CanUserEditAssignedItem(i_ContactURL, i_ID);
			CanExecute |= PDHF_CanUserEditAssignedItemStatus(i_ContactURL, i_ID);

			if(false == CanExecute)
			{
				return false;
			}
		}

		return true;
	}

	//
	// returns true if the user can demote the item
	//
	function PDHF_CanUserDemoteItem(i_ContactURL, i_ID)
	{
		return PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID);
	}

	//
	// returns true if the user can promote the item
	//
	function PDHF_CanUserPromoteItem(i_ContactURL, i_ID)
	{
		return PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID);
	}

	//
	// returns true if the user can move the item
	//
	function PDHF_CanUserMoveItem(i_ContactURL, i_ID)
	{
		return PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID);
	}

	//
	// returns true if the user can add attachments
	//
	function PDHF_CanUserAddAttachmentsToItem(i_ContactURL, i_ID)
	{
		return PDHF_CanUserReplaceItemScheduleInfo(i_ContactURL, i_ID) ||
			   PDHF_CanUserReplaceItemStatusInfo(i_ContactURL, i_ID);
	}

	//
	// returns true if the user can edit the project item
	//
	function PDHF_CanUserEditProjectInformation(i_ContactURL)
	{
		return CHF_DoesUserHavePermission(i_ContactURL, "$ComponentGroup.EditProjectItem") ||
			   PDHF_CanUserEditAnyItem(i_ContactURL);
	}

	////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////
	//
	// Misc helper functions
	//

	function PDHF_IsDebugEnabled()
	{
		return GrooveRunTimeData.GetItem("DEBUG_ENABLED");
	}

	function PDHF_SetAccessDeniedError(i_Message)
	{
		GrooveErrorFunctions.SetCurrentError(GrooveRunTimeData.GetItem("ACCESS_DENIED"), i_Message);
	}

	function PDHF_SetError(i_Error, i_Message)
	{
		GrooveDebugFunctions.DisplayAssert(0, i_Message);
		GrooveErrorFunctions.SetCurrentError(i_Error, i_Message);
	}

	function PDHF_IsLocalDelta()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		return DynamicsMgr.CommandContext.LocallyGenerated;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         @           a  @        H     ôt ôt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               H               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   (   ÄNameH   P r o j e c t D a t a M o d e l H e l p e r F u n c t i o n s 2 . g s l   h       ÄSCRIPT     ÄSCRIPT      ÄSCRIPT  ÄSCRIPT       ÄSRCV  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t M i s c H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      å y     Ã          )                      @            c  »  d      e  ‡                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        –               Ä(null),0               Ä(nul         Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄNameD   P r o j e c t D e l e g a t e H e l p e r F u n c t i o n s . g s l           ÄSCRIPT  RIPT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Ç       π          )            ÄSCRIPT         Ÿ Ä
		//-----------------------------------------------------------------
		// Delegate helper
		//
		// Use of this file requires the inclusion of 
		// GrooveGlobalHelperFunctions.gsl
		//
		//-----------------------------------------------------------------

		//
		// Return a java script ToolDelegateContainer class that contains
		// a reference to the IGrooveTool and IGrooveComponent interface for first data 
		// model delegate found in a tool in this space that implements the specifiec 
		// supported type.
		//
		// The caller is responsible for opening a WRITE transaction
		//
		function DHF_GetToolAndDelegateComponentForSupportedType(i_SupportedType)
		{
			var pToolContainer = PropertyList.OpenProperty(PROPERTY_TOOL_CONTAINER);

			// the tool container may not exist if this function is called while a telespace
			// is being deserialized
			if(null == pToolContainer)
			{
				return null;
			}

			var pToolDescriptorEnum = pToolContainer.CreateToolDescriptorEnum();

			while(pToolDescriptorEnum.HasMore())
			{
				var pToolDescriptor = pToolDescriptorEnum.OpenNext();
				var pTemplate = pToolDescriptor .Template;
				var pToolTemplate = pTemplate.ToolTemplate;
				var pComponentGroup = pToolTemplate.ComponentGroup;
				if(pIComponentGroup.DoesSupportedTypesExist())
				{
					var pTemplateComponentGroupSupportedTypes = pComponentGroup.OpenSupportedTypes();
					if(pTemplateComponentGroupSupportedTypes.DoesExist(i_SupportedType))
					{
						var pTool = pToolDescriptor.Tool;
						if(pTool)
						{
							pDelegateComponent = pTool.OpenDelegateComponent();
							return new ToolDelegateContainer(pTool, pTool.OpenDelegateComponent());
						}
					}
				}
			}

			return null;
		}

		function ToolDelegateContainer(i_pITool, i_pIDelegate)
		{
			this.pITool = i_pITool;
			this.pIDelegate = i_pIDelegate;
		}

		//
		// This is duplicate of MHF_GetStatusStringFromEnum
		// that does not reference any global string declarations
		// so that it can be called from the data model delegate
		// without needing to initialize the string globals 
		// for every call into the data model delegate.
		//
		function DHF_GetStatusStringFromEnum(i_StatusEnum)
		{
			switch(i_StatusEnum)
			{
				case GrooveProjectToolsetStatusType_NotStarted:
					return "Not Started"; // GPT_S_STATUS_NOTSTARTED
				case GrooveProjectToolsetStatusType_InProgress:
					return "In Progress"; // GPT_S_STATUS_INPROGRESS
				case GrooveProjectToolsetStatusType_Complete:
					return "Complete"; // GPT_S_STATUS_COMPLETE
				default:
					GrooveDebugFunctions.DisplayAssert(0, "Invalid status");
					return "";
			}
		}

		//
		// This is duplicate of MHF_GetPriorityStringFromEnum
		// that does not reference any global string declarations
		// so that it can be called from the data model delegate
		// without needing to initialize the string globals 
		// for every call into the data model delegate.
		//
		function DHF_GetPriorityStringFromEnum(i_PriorityEnum)
		{
			switch(i_PriorityEnum)
			{
				case GrooveProjectToolsetPriorityType_Critical:
					return "Critical";	// GPT_S_PRIORITY_CRITICAL
				case GrooveProjectToolsetPriorityType_Important:
					return "Important";	// GPT_S_PRIORITY_IMPORTANT
				case GrooveProjectToolsetPriorityType_Normal:
					return "Normal";	// GPT_S_PRIORITY_NORMAL
				case GrooveProjectToolsetPriorityType_Low:
					return "Low";		// GPT_S_PRIORITY_LOW
				default:
					GrooveDebugFunctions.DisplayAssert(0, "Invalid priority");
					return "";
			}
		}

		function DHF_CreateScratchDocument(i_TargetDatabase)
		{
			// Need to make the name of the document unique because this function can be called in a loop
			// which causes problems if the delete hasn't happened yet and you call create with the same name...
			g_CurrentGUID = DHF_CreateGUID();
			var ScratchDocument = i_TargetDatabase.CreateXMLDocument("ScratchDocument" + g_CurrentGUID, "urn:groove.net:Document");
			Scr      Ë  atchDocument.SetDeleteOnRelease(true);

			return ScratchDocument;
		}

		function DHF_CreateGUID()
		{
			var pGuidGenerator = GROOVE_GLOBAL_MISC_POINTER.OpenGUIDGenerator();	
			var GUID = pGuidGenerator.CreateGUIDBase16();
			return GUID;
		}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ÄSCRIPT         óU Ä

	// 
	// Assumes that subform named DetailsSubForm is in the template
	//
	function DetailsViewClass
		(
			i_PeopleProvider,
			i_DataModelDelegate,
			i_ProjectView
		)
	{
		//
		// class datum
		//
		this.PeopleProvider = i_PeopleProvider;
		this.DataModelDelegate = i_DataModelDelegate;
		this.ProjectView = i_ProjectView;
		this.NewTaskSubFormCode = null;
		this.NewItemWindow = null;

		// lazy eval to load subforms
		this.EditProjectScriptDispatch = null;
		this.EditItemScriptDispatch = null;
		this.ViewProjectScriptDispatch = null;
		this.ViewItemScriptDispatch = null;

		//
		// member mapping
		//
		this.ShowProject = DetailsViewClass_ShowProject;
		this.ShowTask = DetailsViewClass_ShowTask;
		this.EditProject = DetailsViewClass_EditProject;
		this.EditTask = DetailsViewClass_EditTask;
		this.CreateTask = DetailsViewClass_CreateTask;
		this.ValidateInput = DetailsViewClass_ValidateInput;
		this.HasChanged = DetailsViewClass_HasChanged;
		this.CutToClipboard = DetailsViewClass_CutToClipboard;
		this.RTFInsertTime = DetailsViewClass_RTFInsertTime;
		this.CopyToClipboard = DetailsViewClass_CopyToClipboard;
		this.PasteFromClipboard = DetailsViewClass_PasteFromClipboard;
		this.CanCutToClipboard = DetailsViewClass_CanCutToClipboard;
		this.CanCopyToClipboard = DetailsViewClass_CanCopyToClipboard;
		this.CanPasteFromClipboard = DetailsViewClass_CanPasteFromClipboard;

		this.GetItem = DetailsViewClass_GetItem;
		this.GetItemType = DetailsViewClass_GetItemType;

		this.IsNewItem = DetailsViewClass_IsNewItem;
		this.GetID = DetailsViewClass_GetID;
		this.GetParentID = DetailsViewClass_GetParentID;
		this.GetPreviousSiblingID = DetailsViewClass_GetPreviousSiblingID;
		this.GetName = DetailsViewClass_GetName;
		this.SaveOnce = DetailsViewClass_SaveOnce;
		this.UpdateButtonsState = DetailsViewClass_UpdateButtonsState;
		this.GetAssignedToContactURL = DetailsViewClass_GetAssignedToContactURL;
		this.GetStatus = DetailsViewClass_GetStatus;
		this.GetUserStartConstraint = DetailsViewClass_GetUserStartConstraint;
		this.GetConstrainStartFlag = DetailsViewClass_GetConstrainStartFlag;
		this.GetPriority = DetailsViewClass_GetPriority;
		this.GetScheduledStart = DetailsViewClass_GetScheduledStart;
		this.GetScheduledDuration = DetailsViewClass_GetScheduledDuration;
		this.GetScheduledFinish = DetailsViewClass_GetScheduledFinish;
		this.GetTargetFinish = DetailsViewClass_GetTargetFinish;
		this.GetActualStart = DetailsViewClass_GetActualStart;
		this.GetActualFinish = DetailsViewClass_GetActualFinish;
		this.GetIsPrivate = DetailsViewClass_GetIsPrivate;
		this.GetDescription = DetailsViewClass_GetDescription;

		this.GetNewAttachmentsArray = DetailsViewClass_GetNewAttachmentsArray;
		this.GetRemoveAttachmentsArray = DetailsViewClass_GetRemoveAttachmentsArray;
		this.GetNewPredecessorsArray = DetailsViewClass_GetNewPredecessorsArray;
		this.GetRemovePredecessorsArray = DetailsViewClass_GetRemovePredecessorsArray;
		this.CloseNewItemWindow = DetailsViewClass_CloseNewItemWindow;

		
		// internal methods
		this.SiteSubForm = DetailsViewClass_SiteSubForm;
		this.GetContactCacheTx = DetailsViewClass_GetContactCacheTx;
		this.GetCurrentDispatch = DetailsViewClass_GetCurrentDispatch;
		this.GetCurrentEditDispatch = DetailsViewClass_GetCurrentEditDispatch;
		this.GetEditProjectScriptDispatch = DetailsViewClass_GetEditProjectScriptDispatch;
		this.GetEditItemScriptDispatch = DetailsViewClass_GetEditItemScriptDispatch;
		this.GetViewProjectScriptDispatch = DetailsViewClass_GetViewProjectScriptDispatch;
		this.GetViewItemScriptDispatch = DetailsViewClass_GetViewItemScriptDispatch;
	}

	function DetailsViewClass_GetEditProjectScriptDispatch()
	{
		if(null == this.EditProjectScriptDispatch)
		{
			var EditProjectDelegate = EditProjectDetailsSubForm.OpenDelegateComponent();
			this.EditProjectScriptDispatch = EditProjectDelegate.GetScriptDispatch();
			this.EditProjectScriptDispatch.SetProjectDataModelDelegate(this.DataModelDelegate);
		}

		return this.EditProjectScriptDispatch;
	}

	function DetailsViewClass_GetEditItemScriptDispatch()
	{
		if(null == this.EditItemScriptDispatch)
		{
			var EditItemDelegate = EditItemDetailsSubForm.OpenDelegateComponent();
			this.EditItemScriptDispatch = EditItemDelegate.GetScriptDispatch();
			this.EditItemScriptDispatch.SetProjectDataModelDelegate(this.DataModelDelegate);
		}

		return this.EditItemScriptDispatch;
	}

	function DetailsViewClass_GetViewProjectScriptDispatch()
	{
		if(null == this.ViewProjectScriptDispatch)
		{
			var ProjectDetailsDelegate = ProjectDetailsSubForm.OpenDelegateComponent();
			this.ViewProjectScriptDispatch = ProjectDetailsDelegate.GetScriptDispatch();
			this.ViewProjectScriptDispatch.SetPeopleProvider(this.PeopleProvider); 
			this.ViewProjectScriptDispatch.SetProjectDataModelDelegate(this.DataModelDelegate);
		}

		return this.ViewProjectScriptDispatch;
	}

	function DetailsViewClass_GetViewItemScriptDispatch()
	{
		if(null == this.ViewItemScriptDispatch)
		{
			var ItemDetailsDelegate = ItemDetailsSubForm.OpenDelegateComponent();
			this.ViewItemScriptDispatch = ItemDetailsDelegate.GetScriptDispatch();
			this.ViewItemScriptDispatch.SetPeopleProvider(this.PeopleProvider);
			this.ViewItemScriptDispatch.SetProjectDataModelDelegate(this.DataModelDelegate);
		}

		return this.ViewItemScriptDispatch;
	}

	//
	// opens a read transaction
	//
	function DetailsViewClass_EditProject(i_Project)
	{
		// must get script dispatch outside of a transaction
		var pIEditProjectScriptDispatch = this.GetEditProjectScriptDispatch();

		// take a snapshot of the contacts and hand it to the subform
		// the project subform requires a transaciton
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);

		try
		{
			var Cache = PPH_GetContactNameURLMap(this.PeopleProvider);
			pIEditProjectScriptDispatch.SetContactList(Cache);
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, "Error setting contact list");
			return;
		}
		
		// set the Parent
		pIEditProjectScriptDispatch.SetParentSubForm(this.ProjectView);

		// site the subform
		this.SiteSubForm("EditProjectDetailsSubForm");

		// do edit
		pIEditProjectScriptDispatch.EditProject(i_Project);
	}

	function DetailsViewClass_CreateTask(i_SelectedItem, i_Parent, i_ParentType, i_PrevItem, i_ProjectStartTime)
	{
		if(!this.NewTaskSubFormCode)
		{
			// take a snapshot of the contacts and hand it to the subform
			// (this opens a transaction)
			var Cache = this.GetContactCacheTx();

			// Popup the New Item Dialog
			var pForm = PropertyList.OpenProperty(PROPERTY_FORM);
			var pComponentContainer = pForm.ComponentContainer;
			var WindowsManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");

			var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
			var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

			WindowProperties.Style = "PopupWindow";
			WindowProperties.ParentWindow = ParentWindow;
			WindowProperties.Resizable = true;
			WindowProperties.CaptionVisible = true;
			WindowProperties.Caption = "Project";
			WindowProperties.Visible = false;

			var Delegate = NewTaskSubForm.OpenDelegateComponent();
			this.NewTaskSubFormCode = Delegate.GetScriptDispatch();
			this.NewTaskSubFormCode.SetProjectDataModelDelegate(this.DataModelDelegate);

			//Create Status enum
			var StatusEnumCreate = CreateBSTREnum();
			var StatusArray = MHF_GetStatusArray();
			for(var i=0; i<StatusArray.length; i++)
			{
				StatusEnumCreate.Add(StatusArray[i]);
			}
			var StatusEnum = StatusEnumCreate.BSTREnum();

			//Create Priority enum
			var PriorityEnumCreate = CreateBSTREnum();
			var PriorityArray = MHF_GetPriorityArray();
			for(var i=0; i<PriorityArray.length; i++)
			{
				PriorityEnumCreate.Add(PriorityArray[i]);
			}
			var PriorityEnum = PriorityEnumCreate.BSTREnum();

			this.NewTaskSubFormCode.FillContactsCB(Cache);
			this.NewTaskSubFormCode.FillStatusCB(StatusEnum);	
			this.NewTaskSubFormCode.FillPrioritiesCB(PriorityEnum);
			this.NewTaskSubFormCode.SetDefaultStatus(MHF_GetStatusStringFromEnum(i_SelectedItem.Status));

			var Priority = GrooveProjectToolsetPriorityType_Normal;
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				if(GrooveProjectTrackingItemType_Project != this.DataModelDelegate.GetItemType(i_SelectedItem.ID))
					Priority = i_SelectedItem.Priority;

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
			}
			this.NewTaskSubFormCode.SetDefaultPriority(MHF_GetPriorityStringFromEnum(Priority));

			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var CurrentIdentity = Telespace.OpenCurrentIdentity();
			var CurrentIdentityContact = CurrentIdentity.Contact;
			var Name = CHF_GetDisplayNameForContact(CurrentIdentityContact);
			this.NewTaskSubFormCode.SetDefaultContactName(Name);

			this.NewItemWindow = WindowsManager.CreateGrooveWindowForForm
															(
																WindowAccount,
																"",
																WindowProperties,
																NewTaskSubForm
															);
		}

		this.NewTaskSubFormCode.SetProjectStartTime(i_ProjectStartTime);
		this.NewTaskSubFormCode.SetSelectedTaskName(i_SelectedItem.Name)
		if(i_ParentType == GrooveProjectTrackingItemType_Project)
			this.NewTaskSubFormCode.DisablePlaceAtSameLevel();
		else
			this.NewTaskSubFormCode.EnablePlaceAtSameLevel();

		// Set parent ID
		this.NewTaskSubFormCode.SetParentID(i_Parent.ID);

		//
		//- Set the selected item ID as parent. We need this to determine if it
		//- is being used as predecessor for the new task.
		//
		this.NewTaskSubFormCode.SetSelectionID(i_SelectedItem.ID);

		// Clear all attachments, if any.
		this.NewTaskSubFormCode.ResetAttachments();

		// Clear all predecessors, if any.
		this.NewTaskSubFormCode.ResetPredecessors();

		var Result;
		do
		{
			// Show dialog window
			Result = this.NewItemWindow.DoModal();

			//
			// Break if conditions are not met.
			// When user closed Modal dialog with "X" then a GrooveWindowResult_Cancel is returned.
			// This is a platform bug, GrooveWindowResult_Cancel != GrooveDialogBoxResultCode_Cancel
			//
			if (GrooveWindowResult_Cancel == Result || GrooveDialogBoxResultCode_Cancel == Result ||
				!this.NewTaskSubFormCode.IsSubLevelChecked() ||	null == i_PrevItem)
				break;

			// Is the new task going to be subtask?
			// If so the new parent will loose it's predecessor information; prompt user.
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				// Check if the previous item (new parent) still exists.
				if (!this.DataModelDelegate.DoesItemExist(i_PrevItem.ID))
				{
					// No it does not, exit our of loop.
					Transaction.Abort();
					break;
				}

				// Get the latest copy of this parent object.
				i_PrevItem = this.ProjectView.GetItemFromID(i_PrevItem.ID);

				// Does the parent have predecessors?
				var pIPredecessorEnum = i_PrevItem.OpenPredecessorEnum();
				if (pIPredecessorEnum.HasMore())
				{
					Transaction.Abort();

					// Prompt the user, Yes to save record.
					if (GrooveMessageBoxResultCode_No == MHF_MessageBox(GPTPROJECT_MB_DEMOTE_LOOSE_INFO,
																	    GPTPROJECT_MB_DEMOTE_TITLE,
																		GrooveMessageBoxStyle_YesNo,
																		GrooveMessageBoxIcon_Information))
						continue;

				} else Transaction.Commit();

				break;
			}
			catch(e)
			{
				Transaction.Abort();
				PHF_AlertUserOfFailure(GPTPROJECT_MB_DEMOTE_FAILURE);
				break;
			}
		} while (true); 

		if (Result >= 0)
		{
			// Set selection ID
			this.NewTaskSubFormCode.SetID(i_SelectedItem.ID);

			// Set parent ID
			if(this.NewTaskSubFormCode.IsSubLevelChecked())
				this.NewTaskSubFormCode.SetParentID(i_SelectedItem.ID);

			// Set siblings		
			this.NewTaskSubFormCode.SetPrevSiblingID(0);
			if(i_PrevItem)
				this.NewTaskSubFormCode.SetPrevSiblingID(i_PrevItem.ID);
		}

		return Result;
	}

	function DetailsViewClass_CloseNewItemWindow()
	{
		this.NewItemWindow.Close(GrooveMessageBoxResultCode_OK);
		this.NewItemWindow.Destroy(GrooveMessageBoxResultCode_OK);
		this.NewItemWindow = null;
		this.NewTaskSubFormCode = null;
	}
	
	function DetailsViewClass_EditTask(i_Task, i_CanEditScheduleInfo, i_ProjectStartTime)
	{
		// take a snapshot of the contacts and hand it to the subform
		// (this opens a transaction)
		var Cache = this.GetContactCacheTx();
		this.GetEditItemScriptDispatch().SetContactList(Cache);

		// set the Parent
		this.GetEditItemScriptDispatch().SetParentSubForm(this.ProjectView);

		// site the subform
		this.SiteSubForm("EditItemDetailsSubForm");

		// do edit
		this.GetEditItemScriptDispatch().EditTask(i_Task, i_CanEditScheduleInfo, i_ProjectStartTime);
	}

	function DetailsViewClass_Save()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			this.GetEditItemScriptDispatch().Save(this.DataModelDelegate);
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			this.GetEditProjectScriptDispatch().Save(this.DataModelDelegate);
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Must be in edit mode to save");
		}
	}

	function DetailsViewClass_ValidateInput()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return this.GetEditItemScriptDispatch().ValidateInput();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return this.GetEditProjectScriptDispatch().ValidateInput();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Must be in edit mode to validate input");
			return false;
		}
	}

	function DetailsViewClass_HasChanged()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return this.GetEditItemScriptDispatch().HasChanged();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return this.GetEditProjectScriptDispatch().HasChanged();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Must be in edit mode to validate input");
			return false;
		}
	}

	function DetailsViewClass_ShowProject(i_Project)
	{
		// set the Parent
		this.GetViewProjectScriptDispatch().SetParentSubForm(this.ProjectView);

		this.SiteSubForm("ProjectDetailsSubForm");
		this.GetViewProjectScriptDispatch().ShowProject(i_Project);
	}

	function DetailsViewClass_ShowTask(i_Task, i_TaskParent)
	{
		// set the Parent
		this.GetViewItemScriptDispatch().SetParentSubForm(this.ProjectView);

		this.SiteSubForm("ItemDetailsSubForm");
		this.GetViewItemScriptDispatch().ShowItem(i_Task, i_TaskParent, this.ProjectView.ProjectID);
	}

	function DetailsViewClass_SiteSubForm(i_SubFormName)
	{
		if(!DetailsPlaceholderLayout.IsControlInLayout(i_SubFormName))
		{
			var LayoutControlInfoObj = GrooveScriptFunctions.CreateNewObject("Groove.MultiCellLayoutControlInfo");
			var LayoutControlInfoCell = LayoutControlInfoObj.Cell;
			LayoutControlInfoCell.Name="Details";
			DetailsPlaceholderLayout.AddControlByName(i_SubFormName, LayoutControlInfoCell);
		}
	}

	function DetailsViewClass_GetContactCacheTx()
	{
		// take a snapshot of the contacts
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		var Cache = null;
		try
		{
			var Cache = PPH_GetContactNameURLMap(this.PeopleProvider);
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, "Error setting contact list");
			return null;
		}

		return Cache;
	}

	function DetailsViewClass_RTFInsertTime()
	{
		this.GetCurrentEditDispatch().RTFInsertTime();
	}

	function DetailsViewClass_CutToClipboard()
	{
		this.GetCurrentEditDispatch().CutToClipboard();
	}

	function DetailsViewClass_CopyToClipboard()
	{
		this.GetCurrentDispatch().CopyToClipboard();
	}

	function DetailsViewClass_PasteFromClipboard()
	{
		this.GetCurrentEditDispatch().PasteFromClipboard();
	}

	function DetailsViewClass_CanCutToClipboard()
	{
		return this.GetCurrentEditDispatch().CanCutToClipboard();
	}

	function DetailsViewClass_CanCopyToClipboard()
	{
		return this.GetCurrentDispatch().CanCopyToClipboard();
	}

	function DetailsViewClass_CanPasteFromClipboard()
	{
		return this.GetCurrentEditDispatch().CanPasteFromClipboard();
	}

	function DetailsViewClass_GetItem()
	{
		return this.GetCurrentEditDispatch().GetItem();
	}

	function DetailsViewClass_GetItemType()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return GrooveProjectTrackingItemType_Task;
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return GrooveProjectTrackingItemType_Project;
		}
		else
		{
			return GrooveProjectTrackingItemType_Invalid;
		}
	}

	function DetailsViewClass_IsNewItem()
	{
		return this.GetCurrentEditDispatch() == this.NewTaskSubFormCode;
	}

	function DetailsViewClass_GetID()
	{
		return this.GetCurrentEditDispatch().GetID();
	}

	function DetailsViewClass_GetParentID()
	{
		return this.GetCurrentEditDispatch().GetParentID();
	}

	function DetailsViewClass_GetPreviousSiblingID()
	{
		return this.GetCurrentEditDispatch().GetPreviousSiblingID();
	}

	function DetailsViewClass_GetName()
	{
		return this.GetCurrentEditDispatch().GetName();
	}

	function DetailsViewClass_SaveOnce()
	{
		return this.GetCurrentEditDispatch().SaveOnce();
	}

	function DetailsViewClass_UpdateButtonsState(i_CanDelete, i_CanEdit)
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("ItemDetailsSubForm") ||
		   DetailsPlaceholderLayout.IsControlInLayout("ProjectDetailsSubForm"))
		{
			return this.GetCurrentDispatch().UpdateButtonsState(i_CanDelete, i_CanEdit);
		}

		return null;
	}

	function DetailsViewClass_GetAssignedToContactURL()
	{
		return this.GetCurrentEditDispatch().GetAssignedToContactURL();
	}

	function DetailsViewClass_GetStatus()
	{
		return this.GetCurrentEditDispatch().GetStatus();
	}

	function DetailsViewClass_GetPriority()
	{
		return this.GetCurrentEditDispatch().GetPriority();
	}


	function DetailsViewClass_GetUserStartConstraint()
	{
		return this.GetCurrentEditDispatch().GetUserStartConstraint();
	}


	function DetailsViewClass_GetConstrainStartFlag()
	{
		return this.GetCurrentEditDispatch().GetConstrainStartFlag();
	}


	function DetailsViewClass_GetScheduledStart()
	{
		return this.GetCurrentEditDispatch().GetScheduledStart();
	}

	function DetailsViewClass_GetScheduledDuration()
	{
		return this.GetCurrentEditDispatch().GetScheduledDuration();
	}

	function DetailsViewClass_GetScheduledFinish()
	{
		return this.GetCurrentEditDispatch().GetScheduledFinish();
	}

	function DetailsViewClass_GetTargetFinish()
	{
		return this.GetCurrentEditDispatch().GetTargetFinish();
	}

	function DetailsViewClass_GetActualStart()
	{
		return this.GetCurrentEditDispatch().GetActualStart();
	}

	function DetailsViewClass_GetActualFinish()
	{
		return this.GetCurrentEditDispatch().GetActualFinish();
	}

	function DetailsViewClass_GetIsPrivate()
	{
		return this.GetCurrentEditDispatch().GetIsPrivate();
	}

	function DetailsViewClass_GetDescription()
	{
		return this.GetCurrentEditDispatch().GetDescription();
	}

	function DetailsViewClass_GetNewAttachmentsArray()
	{
		return this.GetCurrentEditDispatch().GetNewAttachmentsArray();
	}

	function DetailsViewClass_GetRemoveAttachmentsArray()
	{
		return this.GetCurrentEditDispatch().GetRemoveAttachmentsArray();
	}

	function DetailsViewClass_GetNewPredecessorsArray()
	{
		return this.GetCurrentEditDispatch().GetNewPredecessorsArray();
	}

	function DetailsViewClass_GetRemovePredecessorsArray()
	{
		return this.GetCurrentEditDispatch().GetRemovePredecessorsArray();
	}

	function DetailsViewClass_GetCurrentDispatch()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return this.GetEditItemScriptDispatch();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return this.GetEditProjectScriptDispatch();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("ProjectDetailsSubForm"))
		{
			return this.GetViewProjectScriptDispatch();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("ItemDetailsSubForm"))
		{
			return this.GetViewItemScriptDispatch();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Error finding active dispatch");
			return null;
		}
	}

	function DetailsViewClass_GetCurrentEditDispatch()
	{
		if(this.NewTaskSubFormCode)
		{
			return this.NewTaskSubFormCode;
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return this.GetEditItemScriptDispatch();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return this.GetEditProjectScriptDispatch();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Not in edit mode");
			return null;
		}
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @           m  ê        f     ≤U  ≤U                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ò               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   e   ÄName$   P r o j e c t D e t a i l s . g s l   e       ÄSCRIPT     ÄSCRIPT      ÄSC  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  x U     ®          )      ÄSCRIPT         ∆X Ä

	// 
	// Assumes that subform named DetailsSubForm is in the template
	//
	function DetailsViewClass
		(
			i_PeopleProvider,
			i_DataModelDelegate,
			i_ProjectView
		)
	{
		//
		// Class data
		//
		this.PeopleProvider = i_PeopleProvider;
		this.DataModelDelegate = i_DataModelDelegate;
		this.ProjectView = i_ProjectView;
		this.NewTaskSubFormCode = null;
		this.NewItemWindow = null;

		// lazy eval to load subforms
		this.EditProjectScriptDispatch = null;
		this.EditItemScriptDispatch = null;
		this.ViewProjectScriptDispatch = null;
		this.ViewItemScriptDispatch = null;

		//
		// Member mapping
		//
		this.ShowProject = DetailsViewClass_ShowProject;
		this.ShowTask = DetailsViewClass_ShowTask;
		this.ClearDetails = DetailsViewClass_ClearDetails
		this.EditProject = DetailsViewClass_EditProject;
		this.EditTask = DetailsViewClass_EditTask;
		this.CreateTask = DetailsViewClass_CreateTask;
		this.ValidateInput = DetailsViewClass_ValidateInput;
		this.HasChanged = DetailsViewClass_HasChanged;
		this.DeleteSelectedText = DetailsViewClass_DeleteSelectedText;
		this.CutToClipboard = DetailsViewClass_CutToClipboard;
		this.UndoClipboardOperation = DetailsViewClass_UndoClipboardOperation;
		this.RedoClipboardOperation = DetailsViewClass_RedoClipboardOperation,
		this.RTFInsertTime = DetailsViewClass_RTFInsertTime;
		this.CopyToClipboard = DetailsViewClass_CopyToClipboard;
		this.PasteFromClipboard = DetailsViewClass_PasteFromClipboard;
		this.CanCutToClipboard = DetailsViewClass_CanCutToClipboard;
		this.CanCopyToClipboard = DetailsViewClass_CanCopyToClipboard;
		this.DoesDescriptionHaveFocus = DetailsViewClass_DoesDescriptionHaveFocus;
		this.CanUndo = DetailsViewClass_CanUndo;
		this.CanRedo = DetailsViewClass_CanRedo;
		this.CanPasteFromClipboard = DetailsViewClass_CanPasteFromClipboard;
		this.GetItem = DetailsViewClass_GetItem;
		this.GetItemType = DetailsViewClass_GetItemType;
		this.IsNewItem = DetailsViewClass_IsNewItem;
		this.GetID = DetailsViewClass_GetID;
		this.GetParentID = DetailsViewClass_GetParentID;
		this.GetPreviousSiblingID = DetailsViewClass_GetPreviousSiblingID;
		this.GetName = DetailsViewClass_GetName;
		this.SaveOnce = DetailsViewClass_SaveOnce;
		this.UpdateButtonsState = DetailsViewClass_UpdateButtonsState;
		this.GetAssignedToContactURL = DetailsViewClass_GetAssignedToContactURL;
		this.GetStatus = DetailsViewClass_GetStatus;
		this.GetUserStartConstraint = DetailsViewClass_GetUserStartConstraint;
		this.GetConstrainStartFlag = DetailsViewClass_GetConstrainStartFlag;
		this.GetPriority = DetailsViewClass_GetPriority;
		this.GetScheduledStart = DetailsViewClass_GetScheduledStart;
		this.GetScheduledDuration = DetailsViewClass_GetScheduledDuration;
		this.GetScheduledFinish = DetailsViewClass_GetScheduledFinish;
		this.GetActualStart = DetailsViewClass_GetActualStart;
		this.GetActualFinish = DetailsViewClass_GetActualFinish;
		this.GetIsPrivate = DetailsViewClass_GetIsPrivate;
		this.GetDescription = DetailsViewClass_GetDescription;
		this.GetNewPredecessorsArray = DetailsViewClass_GetNewPredecessorsArray;
		this.GetRemovePredecessorsArray = DetailsViewClass_GetRemovePredecessorsArray;
		this.CloseNewItemWindow = DetailsViewClass_CloseNewItemWindow;

		// Internal methods
		this.SiteSubForm = DetailsViewClass_SiteSubForm;
		this.GetContactCacheTx = DetailsViewClass_GetContactCacheTx;
		this.GetCurrentDispatch = DetailsViewClass_GetCurrentDispatch;
		this.GetCurrentEditDispatch = DetailsViewClass_GetCurrentEditDispatch;
		this.GetEditProjectScriptDispatch = DetailsViewClass_GetEditProjectScriptDispatch;
		this.GetEditItemScriptDispatch = DetailsViewClass_GetEditItemScriptDispatch;
		this.GetViewProjectScriptDispatch = DetailsViewClass_GetViewProjectScriptDispatch;
		this.GetViewItemScriptDispatch = DetailsViewClass_GetViewItemScriptDispatch;
	}

	function DetailsViewClass_GetEditProjectScriptDispatch()
	{
		if(null == this.EditProjectScriptDispatch)
		{
			var EditProjectDelegate = EditProjectDetailsSubForm.OpenDelegateComponent();
			this.EditProjectScriptDispatch = EditProjectDelegate.GetScriptDispatch();
			this.EditProjectScriptDispatch.SetProjectDataModelDelegate(this.DataModelDelegate);
		}

		return this.EditProjectScriptDispatch;
	}

	function DetailsViewClass_GetEditItemScriptDispatch()
	{
		if(null == this.EditItemScriptDispatch)
		{
			var EditItemDelegate = EditItemDetailsSubForm.OpenDelegateComponent();
			this.EditItemScriptDispatch = EditItemDelegate.GetScriptDispatch();
			this.EditItemScriptDispatch.SetProjectDataModelDelegate(this.DataModelDelegate);
		}

		return this.EditItemScriptDispatch;
	}

	function DetailsViewClass_GetViewProjectScriptDispatch()
	{
		if(null == this.ViewProjectScriptDispatch)
		{
			var ProjectDetailsDelegate = ProjectDetailsSubForm.OpenDelegateComponent();
			this.ViewProjectScriptDispatch = ProjectDetailsDelegate.GetScriptDispatch();
			this.ViewProjectScriptDispatch.SetPeopleProvider(this.PeopleProvider); 
			this.ViewProjectScriptDispatch.SetProjectDataModelDelegate(this.DataModelDelegate);
		}

		return this.ViewProjectScriptDispatch;
	}

	function DetailsViewClass_GetViewItemScriptDispatch()
	{
		if(null == this.ViewItemScriptDispatch)
		{
			var ItemDetailsDelegate = ItemDetailsSubForm.OpenDelegateComponent();
			this.ViewItemScriptDispatch = ItemDetailsDelegate.GetScriptDispatch();
			this.ViewItemScriptDispatch.SetPeopleProvider(this.PeopleProvider);
			this.ViewItemScriptDispatch.SetProjectDataModelDelegate(this.DataModelDelegate);
		}

		return this.ViewItemScriptDispatch;
	}

	//
	// opens a read transaction
	//
	function DetailsViewClass_EditProject(i_Project)
	{
		// must get script dispatch outside of a transaction
		var pIEditProjectScriptDispatch = this.GetEditProjectScriptDispatch();

		// take a snapshot of the contacts and hand it to the subform
		// the project subform requires a transaciton
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);

		try
		{
			var Cache = PPH_GetContactNameURLMap(this.PeopleProvider);
			pIEditProjectScriptDispatch.SetContactList(Cache);
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, "Error setting contact list");
			return;
		}
		
		// set the Parent
		pIEditProjectScriptDispatch.SetParentSubForm(this.ProjectView);

		// site the subform
		this.SiteSubForm("EditProjectDetailsSubForm");

		// do edit
		pIEditProjectScriptDispatch.EditProject(i_Project);
	}

	function DetailsViewClass_CreateTask(i_ParentSubForm, i_SelectedItem, i_Parent, i_ParentType,
										 i_PrevItem, i_ProjectStartTime, i_NewTaskStartTime)
	{
		if(!this.NewTaskSubFormCode)
		{
			// Popup the New Item Dialog
			var pForm = PropertyList.OpenProperty(PROPERTY_FORM);
			var pComponentContainer = pForm.ComponentContainer;
			var WindowsManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");

			var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
			var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

			WindowProperties.Style = "PopupWindow";
			WindowProperties.ParentWindow = ParentWindow;
			WindowProperties.Resizable = true;
			WindowProperties.CaptionVisible = true;
			WindowProperties.Caption = "Project";
			WindowProperties.Visible = false;
			WindowProperties.HelpButton = false;

			var Delegate = NewTaskSubForm.OpenDelegateComponent();
			this.NewTaskSubFormCode = Delegate.GetScriptDispatch();
			this.NewTaskSubFormCode.SetProjectDataModelDelegate(this.DataModelDelegate);

			// Create Priority enum
			var PriorityEnumCreate = CreateBSTREnum();
			var PriorityArray = MHF_GetPriorityArray();
			for(var i=0; i<PriorityArray.length; i++)
			{
				PriorityEnumCreate.Add(PriorityArray[i]);
			}
			var PriorityEnum = PriorityEnumCreate.BSTREnum();

			// take a snapshot of the contacts and hand it to the subform
			// (this opens a transaction)
			this.NewTaskSubFormCode.FillContactsCB(this.GetContactCacheTx());

			//
			this.NewTaskSubFormCode.FillStatusCB(MHF_GetStatusArray());	
			this.NewTaskSubFormCode.FillPrioritiesCB(PriorityEnum);
			this.NewTaskSubFormCode.SetDefaultStatus(MHF_GetStatusStringFromEnum(i_SelectedItem.Status));

			var Priority = GrooveProjectToolsetPriorityType_Normal;
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				if(GrooveProjectTrackingItemType_Project != this.DataModelDelegate.GetItemType(i_SelectedItem.ID))
					Priority = i_SelectedItem.Priority;

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
			}
			this.NewTaskSubFormCode.SetDefaultPriority(MHF_GetPriorityStringFromEnum(Priority));

			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var CurrentIdentity = Telespace.OpenCurrentIdentity();
			var CurrentIdentityContact = CurrentIdentity.Contact;
			var Name = CHF_GetDisplayNameForContact(CurrentIdentityContact);
			this.NewTaskSubFormCode.SetDefaultContactName(Name);

			this.NewItemWindow = WindowsManager.CreateGrooveWindowForForm
															(
																WindowAccount,
																"",
																WindowProperties,
																NewTaskSubForm
															);
		}

		this.NewTaskSubFormCode.SetProjectStartTime(i_ProjectStartTime);
		this.NewTaskSubFormCode.SetDefaultStartTime(i_NewTaskStartTime);
		this.NewTaskSubFormCode.SetSelectedTaskName(i_SelectedItem.Name)
		if(i_ParentType == GrooveProjectTrackingItemType_Project)
			this.NewTaskSubFormCode.DisablePlaceAtSameLevel();
		else
			this.NewTaskSubFormCode.EnablePlaceAtSameLevel();

		// Set parent ID
		this.NewTaskSubFormCode.SetParentID(i_Parent.ID);

		// Provide parent of new task sub form.
		this.NewTaskSubFormCode.SetParentSubForm(i_ParentSubForm);

		// Set the selected item ID as parent. We need this to determine if it
		// is being used as predecessor for the new task.
		this.NewTaskSubFormCode.SetSelectionID(i_SelectedItem.ID);

		// Clear all predecessors, if any.
		this.NewTaskSubFormCode.ResetPredecessors();

		// Set the focus to a control in dialog
		this.NewTaskSubFormCode.SetDefaultFocus();

		// Display the dialog
		var Result;
		do
		{
			// Show new task dialog window
			Result = this.NewItemWindow.DoModal();

			//
			// Break if conditions are not met.
			// When user closed Modal dialog with "X" then a GrooveWindowResult_Cancel is returned.
			// This is a platform bug, GrooveWindowResult_Cancel != GrooveDialogBoxResultCode_Cancel
			//
			if (GrooveWindowResult_Cancel == Result || GrooveDialogBoxResultCode_Cancel == Result)
			{
				// User canceled clear out attachments
				this.ProjectView.Attachments.Abort();
				break;
			}

			if (!this.NewTaskSubFormCode.IsSubLevelChecked() ||	null == i_PrevItem)
			{
				break;
			}

			// Is the new task going to be subtask?
			// If so the new parent will loose it's predecessor information; prompt user.
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				// Check if the previous item (new parent) still exists.
				if (!this.DataModelDelegate.DoesItemExist(i_PrevItem.ID))
				{
					// No it does not, exit our of loop.
					Transaction.Abort();
					break;
				}

				// Get the latest copy of this parent object.
				i_PrevItem = this.ProjectView.GetItemFromID(i_PrevItem.ID);

				// Does the parent have predecessors?
				var pIPredecessorEnum = i_PrevItem.OpenPredecessorEnum();
				if (pIPredecessorEnum.HasMore())
				{
					Transaction.Abort();


					// Prompt the user, Yes to save record.
					if (GrooveMessageBoxResultCode_Yes != MHF_MessageBox(GPTPROJECT_MB_SUBTASK_LOOSE_INFO,
																	    GPTPROJECT_MB_SAVE_TITLE,
																		GrooveMessageBoxStyle_YesNo,
																		GrooveMessageBoxIcon_Information))
						continue;  // This handles the No case and the [X] case.

				} else Transaction.Commit();

				break;
			}
			catch(e)
			{
				Transaction.Abort();
				PHF_AlertUserOfFailure(GPTPROJECT_MB_DEMOTE_FAILURE);
				break;
			}
		} while (true); 

		if (Result >= 0)
		{
			// Set selection ID
			this.NewTaskSubFormCode.SetID(i_SelectedItem.ID);

			// Set parent ID
			if(this.NewTaskSubFormCode.IsSubLevelChecked())
				this.NewTaskSubFormCode.SetParentID(i_SelectedItem.ID);

			// Set siblings		
			this.NewTaskSubFormCode.SetPrevSiblingID(0);
			if(i_PrevItem)
				this.NewTaskSubFormCode.SetPrevSiblingID(i_PrevItem.ID);
		}

		return Result;
	}

	function DetailsViewClass_CloseNewItemWindow()
	{
		this.NewItemWindow.Close(GrooveMessageBoxResultCode_OK);
		this.NewItemWindow.Destroy(GrooveMessageBoxResultCode_OK);
		this.NewItemWindow = null;
		this.NewTaskSubFormCode = null;
	}
	
	function DetailsViewClass_EditTask(i_Task, i_CanEditScheduleInfo, i_ProjectStartTime)
	{
		// take a snapshot of the contacts and hand it to the subform
		// (this opens a transaction)
		this.GetEditItemScriptDispatch().SetContactList(this.GetContactCacheTx());

		// set the Parent
		this.GetEditItemScriptDispatch().SetParentSubForm(this.ProjectView);

		// site the subform
		this.SiteSubForm("EditItemDetailsSubForm");

		// do edit
		this.GetEditItemScriptDispatch().EditTask(i_Task, i_CanEditScheduleInfo, i_ProjectStartTime);
	}

	function DetailsViewClass_Save()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			this.GetEditItemScriptDispatch().Save(this.DataModelDelegate);
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			this.GetEditProjectScriptDispatch().Save(this.DataModelDelegate);
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Must be in edit mode to save");
		}
	}

	function DetailsViewClass_ValidateInput()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return this.GetEditItemScriptDispatch().ValidateInput();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return this.GetEditProjectScriptDispatch().ValidateInput();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Must be in edit mode to validate input");
			return false;
		}
	}

	function DetailsViewClass_HasChanged()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return this.GetEditItemScriptDispatch().HasChanged();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return this.GetEditProjectScriptDispatch().HasChanged();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Must be in edit mode to validate input");
			return false;
		}
	}

	function DetailsViewClass_ShowProject(i_Project)
	{
		// Set the Parent
		this.GetViewProjectScriptDispatch().SetParentSubForm(this.ProjectView);

		this.SiteSubForm("ProjectDetailsSubForm");
		this.GetViewProjectScriptDispatch().ShowProject(i_Project);
	}

	function DetailsViewClass_ShowTask(i_Task, i_TaskParent)
	{
		// Set the Parent
		this.GetViewItemScriptDispatch().SetParentSubForm(this.ProjectView);

		this.SiteSubForm("ItemDetailsSubForm");
		this.GetViewItemScriptDispatch().ShowItem(i_Task, i_TaskParent, this.ProjectView.ProjectID);
	}

	function DetailsViewClass_ClearDetails()
	{
		this.ShowTask(null, null); // Default shows empty layout
	}

	function DetailsViewClass_SiteSubForm(i_SubFormName)
	{
		if(!DetailsPlaceholderLayout.IsControlInLayout(i_SubFormName))
		{
			var LayoutControlInfoObj = GrooveScriptFunctions.CreateNewObject("Groove.MultiCellLayoutControlInfo");
			var LayoutControlInfoCell = LayoutControlInfoObj.Cell;
			LayoutControlInfoCell.Name="Details";
			DetailsPlaceholderLayout.AddControlByName(i_SubFormName, LayoutControlInfoCell);
		}
	}

	function DetailsViewClass_GetContactCacheTx()
	{
		// Take a snapshot of the contacts
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			var Cache = PPH_GetContactNameURLMap(this.PeopleProvider);
			Transaction.Commit();
			return Cache;
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, "Error setting contact list");
		}

		return null;
	}

	function DetailsViewClass_RTFInsertTime()
	{
		this.GetCurrentEditDispatch().RTFInsertTime();
	}

	function DetailsViewClass_DeleteSelectedText()
	{
		this.GetCurrentEditDispatch().SendClipboardCommand(GROOVE_VK_DELETE);
	}

	function DetailsViewClass_UndoClipboardOperation()
	{
		this.GetCurrentEditDispatch().SendClipboardCommand(GROOVE_VK_Z);
	}

	function DetailsViewClass_RedoClipboardOperation()
	{
		this.GetCurrentEditDispatch().SendClipboardCommand(GROOVE_VK_Y);
	}

	function DetailsViewClass_CutToClipboard()
	{
		this.GetCurrentEditDispatch().CutToClipboard();
	}

	function DetailsViewClass_CopyToClipboard()
	{
		this.GetCurrentDispatch().CopyToClipboard();
	}

	function DetailsViewClass_PasteFromClipboard()
	{
		this.GetCurrentEditDispatch().PasteFromClipboard();
	}

	function DetailsViewClass_CanCutToClipboard()
	{
		return this.GetCurrentEditDispatch().CanCutToClipboard();
	}

	function DetailsViewClass_CanCopyToClipboard()
	{
		return this.GetCurrentDispatch().CanCopyToClipboard();
	}

	function DetailsViewClass_DoesDescriptionHaveFocus()
	{
		return this.GetCurrentDispatch().DoesDescriptionHaveFocus();
	}

	function DetailsViewClass_CanUndo()
	{
		return this.GetCurrentEditDispatch().CanUndo();
	}

	function DetailsViewClass_CanRedo()
	{
		return this.GetCurrentEditDispatch().CanRedo();
	}

	function DetailsViewClass_CanPasteFromClipboard()
	{
		return this.GetCurrentEditDispatch().CanPasteFromClipboard();
	}

	function DetailsViewClass_GetItem()
	{
		return this.GetCurrentEditDispatch().GetItem();
	}

	function DetailsViewClass_GetItemType()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return GrooveProjectTrackingItemType_Task;
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return GrooveProjectTrackingItemType_Project;
		}
		else
		{
			return GrooveProjectTrackingItemType_Invalid;
		}
	}

	function DetailsViewClass_IsNewItem()
	{
		return this.GetCurrentEditDispatch() == this.NewTaskSubFormCode;
	}

	function DetailsViewClass_GetID()
	{
		return this.GetCurrentEditDispatch().GetID();
	}

	function DetailsViewClass_GetParentID()
	{
		return this.GetCurrentEditDispatch().GetParentID();
	}

	function DetailsViewClass_GetPreviousSiblingID()
	{
		return this.GetCurrentEditDispatch().GetPreviousSiblingID();
	}

	function DetailsViewClass_GetName()
	{
		return this.GetCurrentEditDispatch().GetName();
	}

	function DetailsViewClass_SaveOnce()
	{
		return this.GetCurrentEditDispatch().SaveOnce();
	}

	function DetailsViewClass_UpdateButtonsState(i_CanDelete, i_CanEdit)
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("ItemDetailsSubForm") ||
		   DetailsPlaceholderLayout.IsControlInLayout("ProjectDetailsSubForm"))
		{
			return this.GetCurrentDispatch().UpdateButtonsState(i_CanDelete, i_CanEdit);
		}

		return null;
	}

	function DetailsViewClass_GetAssignedToContactURL()
	{
		return this.GetCurrentEditDispatch().GetAssignedToContactURL();
	}

	function DetailsViewClass_GetStatus()
	{
		return this.GetCurrentEditDispatch().GetStatus();
	}

	function DetailsViewClass_GetPriority()
	{
		return this.GetCurrentEditDispatch().GetPriority();
	}


	function DetailsViewClass_GetUserStartConstraint()
	{
		return this.GetCurrentEditDispatch().GetUserStartConstraint();
	}


	function DetailsViewClass_GetConstrainStartFlag()
	{
		return this.GetCurrentEditDispatch().GetConstrainStartFlag();
	}


	function DetailsViewClass_GetScheduledStart()
	{
		return this.GetCurrentEditDispatch().GetScheduledStart();
	}

	function DetailsViewClass_GetScheduledDuration()
	{
		return this.GetCurrentEditDispatch().GetScheduledDuration();
	}

	function DetailsViewClass_GetScheduledFinish()
	{
		return this.GetCurrentEditDispatch().GetScheduledFinish();
	}

	function DetailsViewClass_GetActualStart()
	{
		return this.GetCurrentEditDispatch().GetActualStart();
	}

	function DetailsViewClass_GetActualFinish()
	{
		return this.GetCurrentEditDispatch().GetActualFinish();
	}

	function DetailsViewClass_GetIsPrivate()
	{
		return this.GetCurrentEditDispatch().GetIsPrivate();
	}

	function DetailsViewClass_GetDescription()
	{
		return this.GetCurrentEditDispatch().GetDescription();
	}

	function DetailsViewClass_GetNewPredecessorsArray()
	{
		return this.GetCurrentEditDispatch().GetNewPredecessorsArray();
	}

	function DetailsViewClass_GetRemovePredecessorsArray()
	{
		return this.GetCurrentEditDispatch().GetRemovePredecessorsArray();
	}

	function DetailsViewClass_GetCurrentDispatch()
	{
		if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return this.GetEditItemScriptDispatch();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return this.GetEditProjectScriptDispatch();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("ProjectDetailsSubForm"))
		{
			return this.GetViewProjectScriptDispatch();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("ItemDetailsSubForm"))
		{
			return this.GetViewItemScriptDispatch();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Error finding active dispatch");
			return null;
		}
	}

	function DetailsViewClass_GetCurrentEditDispatch()
	{
		if(this.NewTaskSubFormCode)
		{
			return this.NewTaskSubFormCode;
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditItemDetailsSubForm"))
		{
			return this.GetEditItemScriptDispatch();
		}
		else if(DetailsPlaceholderLayout.IsControlInLayout("EditProjectDetailsSubForm"))
		{
			return this.GetEditProjectScriptDispatch();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Not in edit mode");
			return null;
		}
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 @           u  ê        n     ·X  ·X                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ò               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   d   ÄName$   P r o j e c t D e t a i l s . g s l   l       ÄSCRIPT     ÄSCRIPT      ÄSC  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  x U     ®          )                      @            w  H  x      y      z                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  P               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   (   ÄName4   P r o j e c t H e l p e r F u n c t i o n s . g s l   f       ÄSCRIPT     ÄSCRIPT    ÄSCRIPT       ÄSRCN  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . C o n t a c t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       n                   Ÿ
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :    | q     ∏          )            ÄSCRIPT         û* Ä

	var GPTPROJECT_MB_PROJECT_NAME_REQUIRED = "You must enter a project name to continue.";
	var GPTPROJECT_MB_NAME_REQUIRED = "You must enter a name to continue.";
	var GPTPROJECT_MB_START_LATER_THAN_FINISH = "The start date cannot be later than the finish date.";
	var GPTPROJECT_MB_ENTER_VALID_START_DATE = "You must enter a valid start date.";
	var GPTPROJECT_MB_START_DATE_AFTER_PROJECT_DATE = "Task start date must be later than project start date.";
	var GPTPROJECT_MB_ENTER_VALID_FINISH_DATE = "You must enter a valid finish date.";
	var GPTPROJECT_MB_ENTER_VALID_TARGET_DATE = "You must enter a valid due date.";
	var GPTPROJECT_MB_PARENT_DELETED = "The parent task has been deleted from the project.";
	var GPTPROJECT_MB_ITEM_DELETED = "The item has been deleted from the project.";
	var GPTPROJECT_MB_ENTER_VALID_ACTUALSTART_DATE = "You must enter a valid actual start date.";
	var GPTPROJECT_MB_ENTER_VALID_ACTUALFINISH_DATE = "You must enter a valid actual finish date.";
	var GPTPROJECT_MB_ENTER_VALID_DURATION_DATE = "You must enter a valid duration.";
	var GPTPROJECT_MB_START_MOVED_TO_WORKDAY = "The start date you entered is not a work day and has been changed to ";
	var GPTPROJECT_MB_PARENT_CAUSES_CYCLE = "This task cannot be a sub-task because it would create a circular relationship with its parent.\n\nPlease update the predecessors assigned for this task."; 
	var GPTPROJECT_MB_DEMOTE_TITLE = "Demote Task";
	var GPTPROJECT_MB_DEMOTE_CAUSES_CYCLE = "This operation cannot be completed because it would create a circular relationship between tasks.\n\nPlease update the predecessors defined in your project and try again."; 
	var GPTPROJECT_MB_DEMOTE_LOOSE_INFO = "Demoting this task clears predecessor information for the parent task.\n\nClick Yes to accept this change, otherwise click No.";
	var GPTPROJECT_MB_DEMOTE_FAILURE = "An error occurred attempting to demote the selected task(s).";
	var GPTPROJECT_CONFIRMREMOVE_FILE = "Attachment(s) will be deleted after you save this task. Are you sure you want to remove the attachment(s)?";
	var GPTPROJECT_CONFIRMREMOVE_TITLE = "Confirm Remove"; 
	var GPTPROJECT_WC_TOOLNAME = "Task Manager";
	var GPTPROJECT_S_PROJECTNAME = "Project Name:";
	var GPTPROJECT_S_LEADER = "Project Leader:";
	var GPTPROJECT_S_SCHEDULED_START = "Start Date:";
	var GPTPROJECT_S_SCHEDULED_DURATION = "Duration:";
	var GPTPROJECT_S_SCHEDULED_FINISH = "Finish Date:";
	var GPTPROJECT_S_TARGET_FINISH = "Due Date:";
	var GPTPROJECT_S_OBJECTIVE = "Objective:";
	var GPTPROJECT_S_STATUS = "Status:";
	var GPTPROJECT_S_PRIORITY = "Priority:";
	var GPTPROJECT_S_OWNER = "Assigned To:";
	var GPTPROJECT_S_TASKNAME = "Task Name:";
	var GPTPROJECT_S_DESCRIPTION = "Description:";
	var GPTPROJECT_S_ATTACHMENTSLABEL = "Attachments:";
	var GPTPROJECT_S_ACTUALSTART = "Actual Start:";
	var GPTPROJECT_S_ACTUALFINISH = "Actual Finish:";
	var GPTPROJECT_S_TASK = "Task";
	var GPTPROJECT_S_SHOWATTACHMENT = "Show Attachments";
	var GPTPROJECT_S_HIDEATTACHMENT = "Hide Attachments";
	var GPTPROJECT_OF_ADDATTACHMENT = "Add Attachments";
	var GPTPROJECT_S_ATTACHMENTS = "Attachments";
	var GPTPROJECT_S_LEFTPAREN = "(";
	var GPTPROJECT_S_RIGHTPAREN = ")";
	var GPTPROJECT_BL_ADDATTACHMENT = "Add...";
	var GPTPROJECT_BL_REMOVEATTACHMENT = "Remove";
	var GPTPROJECT_BL_REMOVEALLATTACHMENTS = "Remove All";
	var GPTPROJECT_BL_VIEW = "Open";
	var GPTPROJECT_BL_EXPORTATTACHMENT = "Export...";
	var GPTPROJECT_BL_PREDECESSOR = "Predecessors";
	var GPTPROJECT_BL_ASSIGNPREDECESSOR = "Assign Predecessors";
	var GPTPROJECT_BL_ELIPSES = "...";
	var GPT_PROJECT_S_DAYS = "days";
	var GPT_PROJECT_S_DAY = "day";
	var GPT_PROJECT_S_DAY_S_IN_PAREN = "day(s)";
	var GPTPROJECT_S_CONSTRAINSTARTDATE = "No earlier than";
	var GPTPROJECT_S_STARTASAP = "As soon as possible";
	var GPTPROJECT_MB_FAILURE_INITIALIZE = "The Task Manager Tool was unable to initialize. Please close the tool and try again.";
	var GPTPROJECT_MB_FAILURE_DELETING = "An error occurred attempting to d          elete the selected task(s).";
	var GPTPROJECT_MB_FAILURE_ADDING = "An error occurred attempting to add the new task.";
	var GPTPROJECT_MB_FAILURE_MOVING = "An error occurred attempting to move the selcted task(s).";
	var GPTPROJECT_MB_FAILURE_PROMOTING = "An error occurred attempting to promote the selected task(s).";
	var GPTPROJECT_MB_FAILURE_RESPONDINGTOREPLACE = "An error occurred responding to a change made to an task in the project.  It is recommended that you restart Groove.";
	var GPTPROJECT_MB_FAILURE_CHANGESELECTIONWHILEEDITING = "An error occurred responding to a selection change that was most likely generated by another user.  It is recommended that you save your changes immediately.";
	var GPTPROJECT_MB_FAILURE_CHANGESELECTION = "An error occurred selecting the specified task.";
	var GPTPROJECT_MB_FAILURE_EDIT = "An error occurred attempting to edit the selected task.";
	var GPTPROJECT_MB_FAILURE_EXPORT = "An error occurred attempting to export the selected attachments.";
	var GPTPROJECT_MB_FAILURE_MARKCOMPLETE = "An error occurred attempting to mark the selected task as complete.";
	var GPTPROJECT_MB_FAILURE_REPLACING = "An error occurred attempting to replace the current task.";
	var GPTPROJECT_MB_FAILURE_MARKINGREAD = "An error occurred attempting to mark the selected task(s) as read.";
	var GPTPROJECT_MB_FAILURE_CONFIGURING = "An error occurred configuring the project.";
	var GPTPROJECT_MB_FAILURE_RETRIEVINGCONTACTS = "An error occurred retrieving the members of the project.";
	var GPTPROJECT_MB_FAILURE_GENERATINGREPORT = "An error occurred generating the report.";
	var GPTPROJECT_MB_FAILURE_SAVINGTEMPLATE = "An error occurred saving this space as a template.";
	var GPTPROJECT_MB_FAILURE_SHOWINGITEM = "An error occurred attempting to display the requested task.";
	var GPTPROJECT_MB_FAILURE_MSPROJECTIMPORT = "A component required to import from MS-Project is missing.";
	var GPTPROJECT_MB_FAILURE_MSPROJECTEXPORT = "A component required to export to MS-Project is missing.";
	var GPTPROJECT_MB_FAILURE_REFRESHACLCACHE = "An error occurred retrieving access control settings for the current task.";
	var GPTPROJECT_MB_FAILURE_COPY = "An error occurred attempting to copy the selected tasks to the clipboard.";
	var GPTPROJECT_MB_FAILURE_PASTE = "An error occurred attempting to paste from the clipboard.";
	var GPTPROJECT_MB_FAILURE_CUT = "An error occurred attempting to cut the selected tasks to the clipboard.";
	var GPTPROJECT_MB_DOT = ".";


	// 
	// Returns the full name of a person if a valid people manager has been provided
	// and the person exists and they have not been marked for deletion
	//
	// i_PeopleProvider may be null
	//
	// Opens a read transaction
	//
	function PHF_GetPersonNameForDisplay(i_PeopleProvider, i_ContactURL)
	{
		var ContactName = GPT_S_MISSINGCONTACT;
		
		if("" == i_ContactURL)
		{
			ContactName = GPT_S_UNASSIGNED;							
		}
		else
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);

			try
			{
				// get the person name if we have a people provider, the person exists,
				// and they have not been marked as deleted --it will default to missing contact
				// otherwise
				if(null != i_PeopleProvider && i_PeopleProvider.DoesContactExist(i_ContactURL))
				{
					var Contact = i_PeopleProvider.OpenContact(i_ContactURL);
					ContactName = CHF_GetDisplayNameForContact(Contact);
				}

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Error retriving contact");
			}
		}

		return ContactName;
	}

	function PHF_AlertUser(i_Message)
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, i_Message, GPTPROJECT_WC_TOOLNAME, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation );
	}

	function PHF_AlertUserOfFailure(i_Message)
	{
		Groov        eDebugFunctions.DisplayAssert(0, i_Message);

		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, i_Message, GPTPROJECT_WC_TOOLNAME, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Stop );
	}

	// helper class
	function TaskInfo(i_Name, i_ID, i_ParentName)
	{
		this.Name = i_Name;
		this.ID = i_ID;
		this.ParentName = i_ParentName;
	}

	//
	// TRANSACTION_REQUIREMENT: READ
	//
	// Returns an Array containing all items in the project
	//
	function PHF_GetTaskArray(i_ProjectDMD)
	{
		var pITaskInfoArray = new Array();

		var pIChildEnum = i_ProjectDMD.GetChildIDEnum(i_ProjectDMD.GetProjectID(), 1);
		PHF_PopulateListBreadthFirst(i_ProjectDMD, pITaskInfoArray, pIChildEnum);

		return pITaskInfoArray;
	}

	//
	// Populate an array with TaskInfo objects in breadth-first order
	//
	// TRANSACTION_REQUIREMENT: READ
	function PHF_PopulateListBreadthFirst(i_ProjectDMD, i_pIOutputArray, i_pIChildEnum)
	{
		if(false == i_pIChildEnum.HasMore())
		{
			return;
		}

		while(i_pIChildEnum.HasMore())
		{
			var ChildID = i_pIChildEnum.OpenNext();
			var ParentID = i_ProjectDMD.GetItemParentID(ChildID);
			var ChildName = i_ProjectDMD.GetItemName(ChildID);
			var ParentName = i_ProjectDMD.GetItemName(ParentID);

			i_pIOutputArray[i_pIOutputArray.length] = new TaskInfo(ChildName, ChildID, ParentName);
		}

		i_pIChildEnum.Reset();
		pINewChildEnum = CreateDoubleEnum();

		// build up a list of all our children's children and recurse
		while(i_pIChildEnum.HasMore())
		{
			var pISubEnum = i_ProjectDMD.GetChildIDEnum(i_pIChildEnum.OpenNext(), 1);
			while(pISubEnum.HasMore())
			{
				pINewChildEnum.Add(pISubEnum.OpenNext());
			}
		}
		
		PHF_PopulateListBreadthFirst(i_ProjectDMD, i_pIOutputArray, pINewChildEnum.DoubleEnum);
	}

	function PHF_GetFinishDateForDisplay(i_DurationMS, i_FinishMS)
	{
		var FinishDateMS = i_FinishMS;

		if(0 != i_DurationMS)
		{
			// when subtracting one day from "Monday", we need to skip the weekend
			var pIIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
			var pIDate = pIIntl.CreateDateFromRawDateTime(FinishDateMS);
			var pICalendar = pIIntl.CreateCalendar();
			pICalendar.DateTime = pIDate;

			// back up one day
			pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, -1);

			var DayOfWeek = pICalendar.Get(GrooveIntlCalendarField_DayOfWeek);

			if(GrooveIntlCalendarDayOfWeek_Sunday == DayOfWeek)
			{
				// back up over weekend
				pICalendar.Add(GrooveIntlCalendarField_DayOfWeek, -2);
			}

			FinishDateMS = pICalendar.DateTime.RawDateTime;
		}

		return FinishDateMS;
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Ÿ
                     @            |  H  }      ~        x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                P               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName6   P r o j e c t H e l p e r F u n c t i o n s 2 . g s l         ÄSCRIPT     ÄSCRIPT    ÄSCRIPT       ÄSRCN  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . C o n t a c t H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       n                   k                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :    | q     ∏          )            ÄSCRIPT         0, Ä

	var GPTPROJECT_MB_PROJECT_NAME_REQUIRED = "You must enter a project name to continue.";
	var GPTPROJECT_MB_NAME_REQUIRED = "You must enter a name to continue.";
	var GPTPROJECT_MB_START_LATER_THAN_FINISH = "The start date cannot be later than the finish date.";
	var GPTPROJECT_MB_ENTER_VALID_START_DATE = "You must enter a valid start date.";
	var GPTPROJECT_MB_START_DATE_AFTER_PROJECT_DATE = "Task start date must be later than project start date.";
	var GPTPROJECT_MB_ENTER_VALID_FINISH_DATE = "You must enter a valid finish date.";
	var GPTPROJECT_MB_ENTER_VALID_TARGET_DATE = "You must enter a valid due date.";
	var GPTPROJECT_MB_ENTER_VALID_ACTUALSTART_DATE = "You must enter a valid actual start date.";
	var GPTPROJECT_MB_ENTER_VALID_ACTUALFINISH_DATE = "You must enter a valid actual finish date.";
	var GPTPROJECT_MB_ENTER_VALID_DURATION_DATE = "You must enter a valid duration.";
	var GPTPROJECT_MB_START_MOVED_TO_WORKDAY = "The start date you entered is not a work day and has been changed to ";
	var GPTPROJECT_MB_PARENT_CAUSES_CYCLE = "This task cannot be a sub-task because it would create a circular relationship with its parent.\n\nPlease update the predecessors assigned for this task."; 
	var GPTPROJECT_MB_DEMOTE_TITLE = "Demote Task";
	var GPTPROJECT_MB_SAVE_TITLE = "Save Task";
	var GPTPROJECT_MB_DEMOTE_CAUSES_CYCLE = "This operation cannot be completed because it would create a circular relationship between tasks.\n\nPlease update the predecessors defined in your project and try again."; 
	var GPTPROJECT_MB_DEMOTE_LOOSE_INFO = "Demoting this task clears predecessor information for the parent task.\n\nClick Yes to accept this change, otherwise click No.";
	var GPTPROJECT_MB_SUBTASK_LOOSE_INFO = "Saving this task clears predecessor information for the parent task.\n\nClick Yes to accept this change, otherwise click No.";
	var GPTPROJECT_MB_DEMOTE_FAILURE = "An error occurred attempting to demote the selected task(s).";
	var GPTPROJECT_CONFIRMREMOVE_FILE = "Attachment(s) will be deleted after you save this task. Are you sure you want to remove the attachment(s)?";
	var GPTPROJECT_CONFIRMREMOVE_TITLE = "Confirm Remove"; 
	var GPTPROJECT_WC_TOOLNAME = "Task Manager";
	var GPTPROJECT_S_PROJECTNAME = "Project Name:";
	var GPTPROJECT_S_LEADER = "Project Leader:";
	var GPTPROJECT_S_SCHEDULED_START = "Start Date:";
	var GPTPROJECT_S_SCHEDULED_DURATION = "Duration:";
	var GPTPROJECT_S_SCHEDULED_FINISH = "Finish Date:";
	var GPTPROJECT_S_TARGET_FINISH = "Due Date:";
	var GPTPROJECT_S_OBJECTIVE = "Objective:";
	var GPTPROJECT_S_STATUS = "Status:";
	var GPTPROJECT_S_PRIORITY = "Priority:";
	var GPTPROJECT_S_OWNER = "Assigned To:";
	var GPTPROJECT_S_TASKNAME = "Task Name:";
	var GPTPROJECT_S_DESCRIPTION = "Description:";
	var GPTPROJECT_S_ATTACHMENTSLABEL = "Attachments:";
	var GPTPROJECT_S_ACTUALSTART = "Actual Start:";
	var GPTPROJECT_S_ACTUALFINISH = "Actual Finish:";
	var GPTPROJECT_S_TASK = "Task";
	var GPTPROJECT_S_SHOWATTACHMENT = "Show Attachments";
	var GPTPROJECT_S_HIDEATTACHMENT = "Hide Attachments";
	var GPTPROJECT_OF_ADDATTACHMENT = "Add Attachments";
	var GPTPROJECT_S_ATTACHMENTS = "Attachments";
	var GPTPROJECT_S_ATTACHMENT = "Attachment";
	var GPTPROJECT_S_LEFTPAREN = "(";
	var GPTPROJECT_S_RIGHTPAREN = ")";
	var GPTPROJECT_BL_ADDATTACHMENT = "Add...";
	var GPTPROJECT_BL_REMOVEATTACHMENT = "Remove";
	var GPTPROJECT_BL_REMOVEALLATTACHMENTS = "Remove All";
	var GPTPROJECT_BL_VIEW = "Open";
	var GPTPROJECT_BL_EXPORTATTACHMENT = "Export...";
	var GPTPROJECT_BL_PREDECESSOR = "Predecessor";
	var GPTPROJECT_BL_PREDECESSORS = "Predecessors";
	var GPTPROJECT_BL_ELIPSES = "...";
	var GPT_PROJECT_S_DAYS = "days";
	var GPT_PROJECT_S_DAY = "day";
	var GPT_PROJECT_S_DAY_S_IN_PAREN = "day(s)";
	var GPTPROJECT_S_CONSTRAINSTARTDATE = "No earlier than";
	var GPTPROJECT_S_STARTASAP = "As soon as possible";
	var GPTPROJECT_MB_FAILURE_INITIALIZE = "The Task Manager Tool was unable to initialize. Please close the tool and try again."          ;
	var GPTPROJECT_MB_FAILURE_DELETING = "An error occurred attempting to delete the selected task(s).";
	var GPTPROJECT_MB_FAILURE_ADDING = "An error occurred attempting to add the new task.";
	var GPTPROJECT_MB_FAILURE_MOVING = "An error occurred attempting to move the selcted task(s).";
	var GPTPROJECT_MB_FAILURE_PROMOTING = "An error occurred attempting to promote the selected task(s).";
	var GPTPROJECT_MB_FAILURE_RESPONDINGTOREPLACE = "An error occurred responding to a change made to an task in the project.  It is recommended that you restart Groove.";
	var GPTPROJECT_MB_FAILURE_CHANGESELECTIONWHILEEDITING = "An error occurred responding to a selection change that was most likely generated by another user.  It is recommended that you save your changes immediately.";
	var GPTPROJECT_MB_FAILURE_CHANGESELECTION = "An error occurred selecting the specified task.";
	var GPTPROJECT_MB_FAILURE_EDIT = "An error occurred attempting to edit the selected task.";
	var GPTPROJECT_MB_FAILURE_EXPORT = "An error occurred attempting to export the selected attachments.";
	var GPTPROJECT_MB_FAILURE_MARKCOMPLETE = "An error occurred attempting to mark the selected task as complete.";
	var GPTPROJECT_MB_FAILURE_REPLACING = "An error occurred attempting to replace the current task.";
	var GPTPROJECT_MB_FAILURE_MARKINGREAD = "An error occurred attempting to mark the selected task(s) as read.";
	var GPTPROJECT_MB_FAILURE_CONFIGURING = "An error occurred configuring the project.";
	var GPTPROJECT_MB_FAILURE_RETRIEVINGCONTACTS = "An error occurred retrieving the participants of the project.";
	var GPTPROJECT_MB_FAILURE_GENERATINGREPORT = "An error occurred generating the report.";
	var GPTPROJECT_MB_FAILURE_SAVINGTEMPLATE = "An error occurred saving this workspace as a template.";
	var GPTPROJECT_MB_FAILURE_SHOWINGITEM = "An error occurred attempting to display the requested task.";
	var GPTPROJECT_MB_FAILURE_MSPROJECTIMPORT = "A component required to import from MS-Project is missing.";
	var GPTPROJECT_MB_FAILURE_MSPROJECTEXPORT = "A component required to export to MS-Project is missing.";
	var GPTPROJECT_MB_FAILURE_REFRESHACLCACHE = "Cannot retrieve ACL settings for the selected task.";
	var GPTPROJECT_MB_FAILURE_COPY = "An error occurred attempting to copy the selected tasks to the clipboard.";
	var GPTPROJECT_MB_FAILURE_PASTE = "An error occurred attempting to paste from the clipboard.";
	var GPTPROJECT_MB_FAILURE_CUT = "An error occurred attempting to cut the selected tasks to the clipboard.";
	var GPTPROJECT_MB_DOT = ".";


	// 
	// Returns the full name of a person if a valid people manager has been provided
	// and the person exists and they have not been marked for deletion
	//
	// i_PeopleProvider may be null
	//
	// Opens a read transaction
	//
	function PHF_GetPersonNameForDisplay(i_PeopleProvider, i_ContactURL)
	{
		var ContactName = GPT_S_MISSINGCONTACT;
		
		if("" == i_ContactURL)
		{
			ContactName = GPT_S_UNASSIGNED;							
		}
		else
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);

			try
			{
				// get the person name if we have a people provider, the person exists,
				// and they have not been marked as deleted --it will default to missing contact
				// otherwise
				if(null != i_PeopleProvider && i_PeopleProvider.DoesContactExist(i_ContactURL))
				{
					var Contact = i_PeopleProvider.OpenContact(i_ContactURL);
					ContactName = CHF_GetDisplayNameForContact(Contact);
				}

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Error retriving contact");
			}
		}

		return ContactName;
	}

	function PHF_AlertUser(i_Message)
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, i_Message, GPTPROJECT_WC_TOOLNAME, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation );
	      Ä  }

	function PHF_AlertUserOfFailure(i_Message)
	{
		GrooveDebugFunctions.DisplayAssert(0, i_Message);

		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, i_Message, GPTPROJECT_WC_TOOLNAME, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Stop );
	}

	// helper class
	function TaskInfo(i_Name, i_ID, i_ParentName)
	{
		this.Name = i_Name;
		this.ID = i_ID;
		this.ParentName = i_ParentName;
	}

	//
	// TRANSACTION_REQUIREMENT: READ
	//
	// Returns an Array containing all items in the project
	//
	function PHF_GetTaskArray(i_ProjectDMD)
	{
		var pITaskInfoArray = new Array();

		var pIChildEnum = i_ProjectDMD.GetChildIDEnum(i_ProjectDMD.GetProjectID(), 1);
		PHF_PopulateListBreadthFirst(i_ProjectDMD, pITaskInfoArray, pIChildEnum);

		return pITaskInfoArray;
	}

	//
	// Populate an array with TaskInfo objects in breadth-first order
	//
	// TRANSACTION_REQUIREMENT: READ
	function PHF_PopulateListBreadthFirst(i_ProjectDMD, i_pIOutputArray, i_pIChildEnum)
	{
		if(false == i_pIChildEnum.HasMore())
		{
			return;
		}

		while(i_pIChildEnum.HasMore())
		{
			var ChildID = i_pIChildEnum.OpenNext();
			var ParentID = i_ProjectDMD.GetItemParentID(ChildID);
			var ChildName = i_ProjectDMD.GetItemName(ChildID);
			var ParentName = i_ProjectDMD.GetItemName(ParentID);

			i_pIOutputArray[i_pIOutputArray.length] = new TaskInfo(ChildName, ChildID, ParentName);
		}

		i_pIChildEnum.Reset();
		pINewChildEnum = CreateDoubleEnum();

		// build up a list of all our children's children and recurse
		while(i_pIChildEnum.HasMore())
		{
			var pISubEnum = i_ProjectDMD.GetChildIDEnum(i_pIChildEnum.OpenNext(), 1);
			while(pISubEnum.HasMore())
			{
				pINewChildEnum.Add(pISubEnum.OpenNext());
			}
		}
		
		PHF_PopulateListBreadthFirst(i_ProjectDMD, i_pIOutputArray, pINewChildEnum.DoubleEnum);
	}

	function PHF_GetPredecessorLabel(i_Num, i_ShowElipses)
	{
		var ELIPSES = (null == i_ShowElipses || i_ShowElipses) ? GPTPROJECT_BL_ELIPSES : "";
		Label = (i_Num == 1) ? GPTPROJECT_BL_PREDECESSOR : GPTPROJECT_BL_PREDECESSORS
		return (i_Num + " " + Label + ELIPSES);
	}

	function PHF_CreateEditPredecessorDialog(i_SubForm)
	{
		var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = ParentWindow;
		WindowProperties.Resizable = true;
		WindowProperties.CaptionVisible = true;
		WindowProperties.InitialWidth = 500;
		WindowProperties.InitialHeight = 400;
		WindowProperties.CloseButton = false;
		WindowProperties.Caption = "Predecessors";
		WindowProperties.HelpButton = false;

		return WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", 
												   WindowProperties, 
												   i_SubForm);
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      k     ÄSCRIPT         Îk Ä

	//
	// File menu
	// 

	var GPT_OPENSELECTION_URL = "GPT_OpenSelection";
	var GPT_ML_OPENSELECTION = "Open Selected Entry";
	var GPT_ML_OPENSELECTION_MNEMONIC_LABEL = "Enter";
	var GPT_OPENSELECTION_MNEMONIC = "0xD";

	// 
	// Edit menu
	//

	var GPT_UNDO_URL = "GUIC_Undo";
	var GPT_ML_UNDO = "Undo";
	var GPT_ML_UNDO_MNEMONIC_LABEL = "Ctrl+Z";
	var GPT_UNDO_MNEMONIC = "Ctrl+Z";

	var GPT_REDO_URL = "GUIC_Redo";
	var GPT_ML_REDO = "Redo";
	var GPT_ML_REDO_MNEMONIC_LABEL = "Ctrl+Y";
	var GPT_REDO_MNEMONIC = "Ctrl+Y";

	var GPT_CUT_URL = "GUIC_Cut";
	var GPT_ML_CUT = "Cu&t";
	var GPT_ML_CUT_MNEMONIC_LABEL = "Ctrl+X";
	var GPT_CT_CUT = "Cut";
	var GPT_CUT_MNEMONIC = "Ctrl+X";

	var GPT_COPY_URL = "GUIC_Copy";
	var GPT_ML_COPY = "&Copy";
	var GPT_ML_COPY_MNEMONIC_LABEL = "Ctrl+C";
	var GPT_CT_COPY = "Copy";
	var GPT_COPY_MNEMONIC = "Ctrl+C";

	var GPT_PASTE_URL = "GUIC_Paste";
	var GPT_ML_PASTE = "&Paste";
	var GPT_ML_PASTE_MNEMONIC_LABEL = "Ctrl+V";
	var GPT_CT_PASTE = "Paste";
	var GPT_PASTE_MNEMONIC = "Ctrl+V";

	// TODO: Copy as Link is currently made to be specific to the Meeting Tool.  In the future,
	// we should provide a mechanism to programatically change this.  PWL 2/26/02
	var GPT_COPYASLINK_URL = "GPT_CopyAsLink";
	var GPT_ML_COPYASLINK = "Copy as &Link";
	var GPT_ML_COPYASLINK_MNEMONIC_LABEL = "Ctrl+L";
	var GPT_CT_COPYASLINK = "Copy an item as link";
	var GPT_COPYASLINK_MNEMONIC = "Ctrl+L";

	var GPT_MEETING_COPYASLINK_URL = "GPT_CopyMeetingAsLink";
	var GPT_MEETING_COPYASLINK = "Copy M&eeting as Link";
	var GPT_MEETING_COPYASLINK_MNEMONIC_LABEL = "Ctrl+E";
	var GPT_MEETING_COPYASLINK_MNEMONIC = "Ctrl+E";

	var GPT_AGENDA_COPYASLINK_URL = "GPT_CopyAgendaAsLink";
	var GPT_AGENDA_COPYASLINK = "Copy Agenda Top&ic as Link";
	var GPT_AGENDA_COPYASLINK_MNEMONIC_LABEL = "Ctrl+I";
	var GPT_AGENDA_COPYASLINK_MNEMONIC = "Ctrl+I";

	var GPT_ACTION_COPYASLINK_URL = "GPT_CopyActionAsLink";
	var GPT_ACTION_COPYASLINK = "&Copy Action Item as Lin&k";
	var GPT_ACTION_COPYASLINK_MNEMONIC_LABEL = "Ctrl+K";
	var GPT_ACTION_COPYASLINK_MNEMONIC = "Ctrl+K";

	var GPT_DELETE_ITEM_URL = "GUIC_Delete";

	var GPT_ML_DELETE = "&Delete";
	var GPT_ML_MNEMONIC_LABEL = "Del";
	var GPT_CT_DELETE = "Delete item";
	// var GPT_DELETE_MNEMONIC = "0x2E";	Don't do this if you want to have context-sensitive delete key events.  PWL 01/09/02

	var GPT_MARKREAD_URL = "GUIC_MarkSelectedRead";
	var GPT_ML_MARKREAD = "Mark &Selected Read";
	var GPT_ML_MARKREAD_MNEMONIC_LABEL = "Ctrl+F4";
	var GPT_MARKREAD_MNEMONIC = "Ctrl+0x73";

	var GPT_MARKUNREAD_URL = "GUIC_MarkSelectedUnread";
	var GPT_ML_MARKUNREAD = "Mark Selected U&nread";

	var GPT_MARKALLREAD_URL = "GUIC_MarkAllRead";
	var GPT_ML_MARKALLREAD = "Mar&k All Read";
	var GPT_ML_MARKALLREAD_MNEMONIC_LABEL = "Ctrl+Shift+F4";
	var GPT_MARKALLREAD_MNEMONIC = "Ctrl+Shift+0x73";

	var GPT_MARKALLUNREAD_URL = "GUIC_MarkAllUnread";
	var GPT_ML_MARKALLUNREAD = "Mark All Unr&ead";

	//
	// View menu
	//
	var GPT_NEXTUNREAD_URL = "GUIC_NextUnread";
	var GPT_ML_NEXTUNREAD = "Next &Unread";
	var GPT_ML_NEXTUNREAD_MNEMONIC_LABEL = "F4";
	var GPT_CT_NEXTUNREAD = "Navigate Next Unread";
	var GPT_NEXTUNREAD_MNEMONIC = "0x73";

	var GPT_PREVUNREAD_URL = "GUIC_PreviousUnread";
	var GPT_ML_PREVUNREAD_LABEL = "P&revious Unread";
	var GPT_ML_PREVUNREAD_MNEMONIC_LABEL = "Shift+F4";
	var GPT_CT_PREVUNREAD_TOOLTIP = "Navigate Previous Unread";
	var GPT_PREVUNREAD_MNEMONIC = "Shift+0x73";

	var GPT_MOVEITEMUP_URL = "GPT_MoveItemUp";
	var GPT_ML_MOVEITEMUP = "Move &up";
	var GPT_ML_MOVEITEMUP_MNEMONIC_LABEL = "Ctrl+U";
	var GPT_CL_MOVEITEMUP = "Move up";
	var GPT_CT_MOVEITEMUP_TOOLTIP = "Move item up";
	var GPT_MOVEITEMUP_MNEMONIC = "Ctrl+U";

	var GPT_MOVEITEMDOWN_URL = "GPT_MoveItemDown";
	var GPT_ML_MOVEITEMDOWN = "Move &down";
	var GPT_ML_MOVEITEMDOWN_MNEMONIC_LABEL = "Ctrl+W";
	var GPT_CL_MOVEITEMDOWN = "Move down";
	var GPT_CT_MOVEITEMDOWN = "Move item down";
	var GPT_MOVEITEMDOWN_MNEMONIC = "Ctrl+W";

	var GPT_MOVEITEMIN_URL = "GPT_MoveItemIn";
	var GPT_ML_MOVEITEMIN = "&Indent Item";
	var GPT_CL_MOVEITEMIN = "Indent";
	var GPT_CT_MOVEITEMIN = "Indent Item";
	var GPT_MOVEITEMIN_MNEMONIC = "Tab";

	var GPT_MOVEITEMOUT_URL = "GPT_MoveItemOut";
	var GPT_ML_MOVEITEMOUT = "&Outdent Item";
	var GPT_CL_MOVEITEMOUT = "Outdent";
	var GPT_CT_MOVEITEMOUT = "Outdent Item";
	var GPT_MOVEITEMOUT_MNEMONIC = "Shift+Tab";

	var GPT_SEPARATOR1_URL = "Separator1";
	var GPT_SEPARATOR2_URL = "Separator2";
	var GPT_SEPARATOR3_URL = "Seperator3";
	var GPT_USERCOMMANDSEPARATOR_URL = "UserCommandSeparator";

	// UI Command bar 
	var GPT_UNREADOPTIONS_URL = "GPT_UnreadOptions";
	var GPT_CT_UNREADOPTIONS = "Unread Options";


	//
	// AMLATER - Constants that we SHOULD be picking up from GrooveCommonToolCategoryStrings.gsl
	//
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_DOCUMENT_TOOL_COMMANDS = "GUICC_FileDocumentToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_NEW_TOOL_COMMANDS = "GUICC_FileNewToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_TOOL_COMMANDS = "GUICC_EditToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS = "GUICC_ViewToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_TOP_LEVEL_TOOL_COMMANDS_1 = "GUICC_TopLevelToolCommands1";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_CLIPBOARD_TOOL_COMMANDS = "GUICC_EditClipboardToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_COPY_LINKS_TOOL_COMMANDS = "GUICC_EditCopyLinksSystemCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_UNDO_REDO_TOOL_COMMANDS = "GUICC_EditUndoRedoToolCommands";


	//////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////
	//
	// GPTMenu helper class
	//
	//
	// To use this class, you must implement IGrooveUICommandListener in 
	// your delegate to receive command and command update events
	//
	function GPTMenu()
	{
		// public methods
		this.SetGlobalCommandContainer = GPTMenu_SetGlobalCommandContainer;
		this.ShowMenuCommands = GPTMenu_ShowMenuCommands;
		this.HideMenuCommands = GPTMenu_HideMenuCommands;
		this.AddFileNewCommand = GPTMenu_AddFileNewCommand;
		this.AddViewCommand = GPTMenu_AddViewCommand;
		this.AddViewCommandContainer = GPTMenu_AddViewCommandContainer;
		this.IsGPTCommand = GPTMenu_IsGPTCommand;

		// private methods
		this.ShowFileMenuCommands = GPTMenu_ShowFileMenuCommands;
		this.ShowEditMenuCommands = GPTMenu_ShowEditMenuCommands;
		this.ShowViewMenuCommands = GPTMenu_ShowViewMenuCommands;
		this.HideFileMenuCommands = GPTMenu_HideFileMenuCommands;
		this.HideEditMenuCommands = GPTMenu_HideEditMenuCommands;
		this.HideViewMenuCommands = GPTMenu_HideViewMenuCommands;

		// datum
		this.GlobalCommandContainer = null;
		this.FileDocumentCC = null;
		this.EditClipboardCC = null;
		this.EditCopyLinkCC = null;
		this.EditUndoRedoCC = null;
		this.ViewCC = null;
		this.FileExportCC = null;

		// user added command
		this.FileNewCommands = new Array;
		this.ViewCommands = new Array;
		this.ViewCommandContainers = new Array;

		// version number
		this.VersionNumber = 1;		// default to 1!!!
	}

	//
	// cache the menu bar
	//
	function GPTMenu_SetGlobalCommandContainer(i_GlobalCommandContainer)
	{
		if (null != i_GlobalCommandContainer)
			this.GlobalCommandContainer = i_GlobalCommandContainer.UICommandContainer2;
		else
			this.GlobalCommandContainer = null;
	}


	// add a command to the File->New menu, it will be automatically removed when you 
	// call HideMenuCommands()
	function GPTMenu_AddFileNewCommand(i_CommandURL, i_CommandLabel, i_CommandMnemonic)
	{
		// File->New command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_NEW_TOOL_COMMANDS))
		{
			this.FileNewCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_NEW_TOOL_COMMANDS);
		}

		if(null != this.FileNewCC)
		{
			var UICommand = null;
			
			// New Task menu item
			UICommand = this.FileNewCC.InsertUICommand(i_CommandURL, this.FileNewCC.GetNumberOfUICommands());
			UICommand.Label = i_CommandLabel;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = i_CommandMnemonic;
		}

		// remember the command so we can remove it later
		this.FileNewCommands[this.FileNewCommands.length] = i_CommandURL;
	}


	// add a command the the View menu, it will automatically be removed when you 
	// cal HideMenuCommands()
	function GPTMenu_AddViewCommand(i_CommandURL, i_CommandLabel, i_CommandMnemonic)
	{
		// View command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS))
		{
			this.ViewCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS);
		}

		if(null != this.ViewCC)
		{
			var UICommand = null;

			// add a separator if this is the first user command added
			if(0 == this.ViewCommands.length && 0 == this.ViewCommandContainers.length)
			{
				this.ViewCC.InsertSeparator(GPT_USERCOMMANDSEPARATOR_URL, this.ViewCC.GetNumberOfUICommands());
			}

			UICommand = this.ViewCC.InsertUICommand(i_CommandURL, this.ViewCC.GetNumberOfUICommands());
			UICommand.Label = i_CommandLabel;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = i_CommandMnemonic;
		}

		this.ViewCommands[this.ViewCommands.length] = i_CommandURL;
	}


	// add a command the the View menu, it will automatically be removed when you 
	// call HideMenuCommands()
	function GPTMenu_AddViewCommandContainer(i_CommandContainerURL, i_CommandLabel)
	{
		var pIUICommandContainer = null;

		// View command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS))
		{
			this.ViewCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS);
		}

		if(null != this.ViewCC)
		{
			// add a separator if this is the first user command added
			if(0 == this.ViewCommands.length && 0 == this.ViewCommandContainers.length)
			{
				this.ViewCC.InsertSeparator(GPT_USERCOMMANDSEPARATOR_URL, this.ViewCC.GetNumberOfUICommands());
			}

			pIUICommandContainer = this.ViewCC.InsertUICommandContainer(i_CommandContainerURL, this.ViewCC.GetNumberOfUICommands());
			pIUICommandContainer.UICommand.Label = i_CommandLabel;
			pIUICommandContainer.UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}

		this.ViewCommandContainers[this.ViewCommandContainers.length] = i_CommandContainerURL;

		return pIUICommandContainer;
	}


	//
	// returns true if the specified command is one of the default ones the class
	// adds.  It does not include any commands added by the caller through AddNewFileCommand()
	// or AddViewCommand()
	function GPTMenu_IsGPTCommand(i_UICommand)
	{
		switch(i_UICommand.CommandURL)
		{
			case GPT_OPENSELECTION_URL:
			case GPT_UNDO_URL:
			case GPT_REDO_URL:
			case GPT_CUT_URL:
			case GPT_COPY_URL:
			case GPT_PASTE_URL:
			case GPT_COPYASLINK_URL:
			case GPT_DELETE_ITEM_URL:
			case GPT_MARKREAD_URL:
			case GPT_MARKUNREAD_URL:
			case GPT_MARKALLREAD_URL:
			case GPT_MARKALLUNREAD_URL:
			case GPT_NEXTUNREAD_URL:
			case GPT_PREVUNREAD_URL:
			case GPT_MOVEITEMUP_URL:
			case GPT_MOVEITEMDOWN_URL:
			case GPT_MOVEITEMIN_URL:
			case GPT_MOVEITEMOUT_URL:
				return true;
			default:
				return false;
		}
	}

	//
	// Display our menu commands
	//
	function GPTMenu_ShowMenuCommands()
	{
		this.ShowFileMenuCommands();
		this.ShowEditMenuCommands();
		this.ShowViewMenuCommands();
	}

	//
	// Display file menu commands
	//
	function GPTMenu_ShowFileMenuCommands()
	{
		// File command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_DOCUMENT_TOOL_COMMANDS))
		{
			this.FileDocumentCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_DOCUMENT_TOOL_COMMANDS);
		}

		if(null != this.FileDocumentCC)
		{
			var UICommand = null;

			// open selection
			UICommand = this.FileDocumentCC.InsertUICommand(GPT_OPENSELECTION_URL, 0);
			UICommand.Label = GPT_ML_OPENSELECTION + "\t" + GPT_ML_OPENSELECTION_MNEMONIC_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = GPT_OPENSELECTION_MNEMONIC;
		}
	}


	//
	// Display edit menu commands
	//
	function GPTMenu_ShowEditMenuCommands()
	{
		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		// Undo/redo command container
		if(this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_UNDO_REDO_TOOL_COMMANDS))
		{
			this.EditUndoRedoCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_UNDO_REDO_TOOL_COMMANDS);
		}

		// Clipboard commands command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_CLIPBOARD_TOOL_COMMANDS))
		{
			this.EditClipboardCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_CLIPBOARD_TOOL_COMMANDS);
		}

		// Copy links command container
		if (this.VersionNumber != 1)
		{
			if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_COPY_LINKS_TOOL_COMMANDS))
			{
				this.EditCopyLinkCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_COPY_LINKS_TOOL_COMMANDS);
			}

			if(null != this.EditCopyLinkCC)
			{
				var UICommand = null;
				var UICommandContainer = null;

				// copy as link command container
				UICommandContainer = this.EditCopyLinkCC.InsertUICommandContainer(GPT_COPYASLINK_URL, this.EditClipboardCC.GetNumberOfUICommands());
				UICommandContainer.UICommand.Label = GPT_ML_COPYASLINK ; // + "\t" + GPT_ML_COPYASLINK_MNEMONIC_LABEL;
				UICommandContainer.UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				// UICommandContainer.UICommand.Mnemonic = GPT_COPYASLINK_MNEMONIC;
				UICommandContainer.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_COPYASLINK_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

				// copy as link menu item
				UICommand = UICommandContainer.InsertUICommand(GPT_AGENDA_COPYASLINK_URL, UICommandContainer.GetNumberOfUICommands());
				UICommand.Label = GPT_AGENDA_COPYASLINK + "\t" + GPT_AGENDA_COPYASLINK_MNEMONIC_LABEL;
				UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				UICommand.Mnemonic = GPT_AGENDA_COPYASLINK_MNEMONIC;

				// copy as link menu item
				UICommand = UICommandContainer.InsertUICommand(GPT_ACTION_COPYASLINK_URL, UICommandContainer.GetNumberOfUICommands());
				UICommand.Label = GPT_ACTION_COPYASLINK + "\t" + GPT_ACTION_COPYASLINK_MNEMONIC_LABEL;
				UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				UICommand.Mnemonic = GPT_ACTION_COPYASLINK_MNEMONIC;

				// copy as link menu item
				UICommand = UICommandContainer.InsertUICommand(GPT_MEETING_COPYASLINK_URL, UICommandContainer.GetNumberOfUICommands());
				UICommand.Label = GPT_MEETING_COPYASLINK + "\t" + GPT_MEETING_COPYASLINK_MNEMONIC_LABEL;
				UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				UICommand.Mnemonic = GPT_MEETING_COPYASLINK_MNEMONIC;
			}
		}
	}


	//
	// Display view menu commands
	//
	function GPTMenu_ShowViewMenuCommands()
	{
		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		// View command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS))
		{
			this.ViewCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS);
		}
	}


	//
	// Hide our menu commands
	// 
	function GPTMenu_HideMenuCommands()
	{
		this.HideFileMenuCommands();
		this.HideEditMenuCommands();
		this.HideViewMenuCommands();
	}

	//
	// Hide file menu commands
	// 
	function GPTMenu_HideFileMenuCommands()
	{
		if(null != this.FileDocumentCC)
		{
			this.FileDocumentCC.RemoveUICommand(GPT_OPENSELECTION_URL);
			this.FileDocumentCC = null;
		}

		// remove all File->New commands we added and 
		// clear our cache
		if(null != this.FileNewCC)
		{
			for(var i = 0; i < this.FileNewCommands.length; ++i)
			{
				this.FileNewCC.RemoveUICommand(this.FileNewCommands[i]);
			}

			this.FileNewCommands = new Array();
			this.FileNewCC = null;
		}
	}


	//
	// Hide edit menu commands
	// 
	function GPTMenu_HideEditMenuCommands()
	{
		if(null != this.EditUndoRedoCC)
		{
			this.EditUndoRedoCC = null;
		}

		if(null != this.EditClipboardCC)
		{
			this.EditClipboardCC = null;
		}

		if(null != this.EditCopyLinkCC && this.VersionNumber != 1)
		{
			this.EditCopyLinkCC.RemoveUICommandContainer(GPT_COPYASLINK_URL);
			this.EditCopyLinkCC = null;
		}
	}

	//
	// Hide view menu commands
	// 
	function GPTMenu_HideViewMenuCommands()
	{
		if(null != this.ViewCC)
		{
			// Remove separator
			this.ViewCC.RemoveUICommand(GPT_USERCOMMANDSEPARATOR_URL);

			//
			for(var i = 0; i < this.ViewCommands.length; ++i)
			{
				this.ViewCC.RemoveUICommand(this.ViewCommands[i]);
			}

			this.ViewCommands = new Array();
			for(var i = 0; i < this.ViewCommandContainers.length; ++i)
			{
				this.ViewCC.RemoveUICommandContainer(this.ViewCommandContainers[i]);
			}
			this.ViewCommandContainers = new Array();
			this.ViewCC = null;
		}
	}





	//////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////
	//
	// GPTCommandBar helper class
	//
	function GPTCommandBar()
	{
		// public methods
		this.SetUICommandContainer = GPTCommandBar_SetUICommandContainer;
		this.ShowUICommands = GPTCommandBar_ShowUICommands;
		this.HideUICommands = GPTCommandBar_HideUICommands;
		this.IsGPTCommand = GPTCommandBar_IsGPTCommand;
		this.AddNewItemCommand = GPTCommandBar_AddNewItemCommand;
		this.AppendCommand = GPTCommandBar_AppendCommand;

		// datum
		this.UICommandContainer = null;
		this.NewItemPos = -1;
		this.NewItemCommandURL = null;
		this.UserCommandURLs = new Array;
	}


	//
	// cache the icon bar
	//
	function GPTCommandBar_SetUICommandContainer(i_UICommandContainer)
	{
		this.UICommandContainer = i_UICommandContainer;
	}


	//
	// Sets the command for the "NewItem" commmand buttonon the command bar.  
	// It will automatically be removed when hide is called.
	//
	// must be called AFTER ShowUICommands()
	//
	function GPTCommandBar_AddNewItemCommand(i_CommandURL, 
											 i_CommandBarLabel, 
											 i_CommandBarToolTip,
											 i_IconOrdinal)
	{
		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		pIUICommand = this.UICommandContainer.InsertUICommand(i_CommandURL, this.NewItemPos);
		pIUICommand.UICommand.ToolTip= i_CommandBarToolTip;
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, i_IconOrdinal * IconWidth, IconWidth, IconHeight);
		pIUICommand.UICommand.Label = i_CommandBarLabel;

		this.NewItemCommandURL = i_CommandURL
	}


	//
	// Appends the specified command to the command bar.  It will automatically be removed
	// when hide is called.
	//
	// must be called AFTER ShowUICommands()
	//
	function GPTCommandBar_AppendCommand(i_CommandURL, 
										 i_CommandBarToolTip,
										 i_IconOrdinal)
	{
		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		// if this is the 1st user command, add a seperator
		if(0 == this.UserCommandURLs.length)
		{
			this.UICommandContainer.InsertSeparator(GPT_USERCOMMANDSEPARATOR_URL, this.UICommandContainer.GetNumberOfUICommands());
		}

		pIUICommand = this.UICommandContainer.InsertUICommand(i_CommandURL, this.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.UICommand.ToolTip= i_CommandBarToolTip;
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, i_IconOrdinal * IconWidth, IconWidth, IconHeight);

		this.UserCommandURLs[this.UserCommandURLs.length] = i_CommandURL
	}

	//
	// returns true if the specified command is one of the default ones the class
	// adds.  It does not include any commands added by the caller through AddNewFileCommand()
	// or AddViewCommand()
	function GPTCommandBar_IsGPTCommand(i_UICommand)
	{
		switch(i_UICommand.CommandURL)
		{
			case GPT_DELETE_ITEM_URL:
			case GPT_CUT_URL:
			case GPT_COPY_URL:
			case GPT_COPYASLINK_URL:
			case GPT_MEETING_COPYASLINK_URL:
			case GPT_AGENDA_COPYASLINK_URL:
			case GPT_ACTION_COPYASLINK_URL:
			case GPT_PASTE_URL:
			case GPT_PREVUNREAD_URL:
			case GPT_NEXTUNREAD_URL:
			case GPT_UNREADOPTIONS_URL:
			case GPT_MARKREAD_URL:
			case GPT_MARKUNREAD_URL:
			case GPT_MARKALLREAD_URL:
			case GPT_MARKALLUNREAD_URL:
				return true;
			default :
				return false;
		}
	}


	function GPTCommandBar_ShowUICommands()
	{
		var Pos = this.UICommandContainer.GetNumberOfUICommands();
		var pIUICommand;

		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		// remember the position to store the new item button
		this.NewItemPos = Pos++;

		pIUICommand = this.UICommandContainer.InsertUICommand(GPT_DELETE_ITEM_URL, Pos++);
		pIUICommand.UICommand.ToolTip= GPT_CT_DELETE + " (" + GPT_ML_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_DELETE_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		this.UICommandContainer.InsertSeparator(GPT_SEPARATOR1_URL, Pos++);

		// clipboard functions
		pIUICommand = this.UICommandContainer.InsertUICommand(GPT_CUT_URL, Pos++);
		pIUICommand.UICommand.ToolTip= GPT_CT_CUT + " (" + GPT_ML_CUT_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_CUT_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(GPT_COPY_URL, Pos++);
		pIUICommand.UICommand.ToolTip= GPT_CT_COPY + " (" + GPT_ML_COPY_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_COPY_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(GPT_PASTE_URL, Pos++);
		pIUICommand.UICommand.ToolTip= GPT_CT_PASTE + " (" + GPT_ML_PASTE_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_PASTE_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		// read/unread functions
		this.UICommandContainer.InsertSeparator(GPT_SEPARATOR2_URL, Pos++);

		pIUICommand = this.UICommandContainer.InsertUICommand(GPT_PREVUNREAD_URL, Pos++);
		pIUICommand.UICommand.ToolTip= GPT_CT_PREVUNREAD_TOOLTIP + " (" + GPT_ML_PREVUNREAD_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_PREVUNREAD_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(GPT_NEXTUNREAD_URL, Pos++);
		pIUICommand.UICommand.ToolTip= GPT_CT_NEXTUNREAD + " (" + GPT_ML_NEXTUNREAD_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_NEXTUNREAD_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		// unread command container
		// AMLATER - GET ICON 
		var pIUICommandContainer = this.UICommandContainer.InsertUICommandContainer(GPT_UNREADOPTIONS_URL, Pos++);
		pIUICommandContainer.UICommand.ToolTip= GPT_CT_UNREADOPTIONS;
		pIUICommandContainer.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_UNREADFOLDER_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_MARKREAD_URL, pIUICommandContainer.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = GPT_ML_MARKREAD + "\t" + GPT_ML_MARKREAD_MNEMONIC_LABEL;
		pIUICommand.Mnemonic = GPT_MARKREAD_MNEMONIC;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_MARKUNREAD_URL, pIUICommandContainer.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = GPT_ML_MARKUNREAD;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_MARKALLREAD_URL, pIUICommandContainer.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = GPT_ML_MARKALLREAD + "\t" + GPT_ML_MARKALLREAD_MNEMONIC_LABEL;
		pIUICommand.Mnemonic = GPT_MARKALLREAD_MNEMONIC;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_MARKALLUNREAD_URL, pIUICommandContainer.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = GPT_ML_MARKALLUNREAD;
	}

	function GPTCommandBar_HideUICommands()
	{
		// remove user-specified new-item command
		if(null != this.NewItemCommandURL)
		{
			this.UICommandContainer.RemoveUICommand(this.NewItemCommandURL);
			this.NewItemCommandURL = null;
		}

		// remove user commands and seperator
		if(0 != this.UserCommandURLs.length)
		{
			this.UICommandContainer.RemoveSeparator(GPT_USERCOMMANDSEPARATOR_URL);
		}

		for(var i = 0; i < this.UserCommandURLs.length; ++i)
		{
			this.UICommandContainer.RemoveUICommand(this.UserCommandURLs[i]);
		}
		this.UserCommandURLs = new Array;


		if(this.UICommandContainer.UICommandExists(GPT_DELETE_ITEM_URL))
		{
			this.UICommandContainer.RemoveUICommand(GPT_DELETE_ITEM_URL);
		}

		// clipboard functions
		this.UICommandContainer.RemoveSeparator(GPT_SEPARATOR1_URL);

		if(this.UICommandContainer.UICommandExists(GPT_ML_CUT))
		{
			this.UICommandContainer.RemoveUICommand(GPT_ML_CUT);
		}

		if(this.UICommandContainer.UICommandExists(GPT_COPY_URL))
		{
			this.UICommandContainer.RemoveUICommand(GPT_COPY_URL);
		}

		if(this.UICommandContainer.UICommandExists(GPT_COPYASLINK_URL))
		{
			this.UICommandContainer.RemoveUICommandContainer(GPT_COPYASLINK_URL);
		}

		if(this.UICommandContainer.UICommandExists(GPT_PASTE_URL))
		{
			this.UICommandContainer.RemoveUICommand(GPT_PASTE_URL);
		}

		// unread functions
		this.UICommandContainer.RemoveSeparator(GPT_SEPARATOR2_URL);

		if(this.UICommandContainer.UICommandExists(GPT_PREVUNREAD_URL))
		{
			this.UICommandContainer.RemoveUICommand(GPT_PREVUNREAD_URL);
		}

		if(this.UICommandContainer.UICommandExists(GPT_NEXTUNREAD_URL))
		{
			this.UICommandContainer.RemoveUICommand(GPT_NEXTUNREAD_URL);
		}

		if(this.UICommandContainer.UICommandContainerExists(GPT_UNREADOPTIONS_URL))
		{
			this.UICommandContainer.RemoveUICommandContainer(GPT_UNREADOPTIONS_URL);
		}
	}
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            @           à  Ë        Ä     l  l                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ä(null),0               Ä(nul                 Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   m   ÄName4   G P T M e n u H e l p e r F u n c t i o n s . g s l   m       ÄSCRIPT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         $ ©          )                      @            ä  8
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      	  @
               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄName&   P r o j e c t M i s c G l u e . g s l         ÄSCRIPTMODULE     ÄSCRIPTMODULE            ÄSCRIPT     ÄTYPELIB     ÄTYPELIB     ÄTYPELIB     ÄSCRIPT  PELIB  ÄSCRIPT       ÄSRC  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T y p e L i b r a r i e s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       & F a c  ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME6   G r o o v e P r o j e c t M e e t i n g D e t a i l s     ÄLIBIDL   { B 4 C F 5 C 5 5 - D 4 D D - 4 c 4 c - A 8 B 0 - E 7 F 7 4 7 0 E 8 0 0 1 }           ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAMER   G r o o v e P r o j e c t D a s h b o a r d P e n d i n g I t e m D e l e g a t e     ÄLIBIDL   { 0 4 3 5 8 B 7 0 - 0 E A 2 - 4 a 1 f - A F 9 1 - 8 D 1 3 4 F 5 C C 0 C D }         0 C   ÄTYPELIB       ÄMINORVER   0     ÄMAJORVER   1     ÄNAME2   G r o o v e R e l a t i o n s h i p M a n a g e r     ÄLIBIDL   { B B E 8 5 6 0 1 - A 0 9 0 - 4 5 8 0 - 8 6 C 4 - 5 4 1 D C 5 6 2 3 4 0 7 }               ÄSCRIPT           Ä
			                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ¨     <‹    º¸    L‡    ® A   p j      ü          )      ÄSCRIPT         àÊ Ä

	/********************************************************************
	// Depends on the following files:
	//	GrooveGlobalHelperFunctions.gsl 
	//	CommonStrings.gsl
	//  ProjectMisc.tlb
	//
	********************************************************************/

		//
		// constants
		//

		// icon ordinals
		var MHF_ADDITEM_ICON_ORDINAL		= 0;
		var MHF_ARROW_UP_ICON_ORDINAL		= 1;
		var MHF_ARROW_DOWN_ICON_ORDINAL		= 2;
		var MHF_LEFT_ICON_ORDINAL			= 3;
		var MHF_RIGHT_ICON_ORDINAL			= 4;
		var MHF_COPY_ICON_ORDINAL			= 5;
		var MHF_COPYASLINK_ICON_ORDINAL		= 6;
		var MHF_PASTE_ICON_ORDINAL			= 7;
		var MHF_FILESAVE_ICON_ORDINAL		= 8;
		var MHF_PREVUNREAD_ICON_ORDINAL		= 9;
		var MHF_NEXTUNREAD_ICON_ORDINAL		= 10;
		var MHF_UNREADFOLDER_ICON_ORDINAL	= 11;
		var	MHF_ATTACHMENT_ICON_ORDINAL		= 12;
		var MHF_MOVE_UP_ICON_ORDINAL		= 13;
		var MHF_MOVE_DOWN_ICON_ORDINAL		= 14;
		var MHF_ARROW_ICON_ORDINAL			= 15;
		var MHF_REPORT_ICON_ORDINAL			= 16;
		var MHF_CUT_ICON_ORDINAL			= 17;
		var MHF_DELETE_ICON_ORDINAL			= 18;
		var MHF_LIST_DOWN_ICON_ORDINAL		= 19;
		var MHF_LIST_RIGHT_ICON_ORDINAL		= 20;
		var MHF_UNDO_ICON_ORDINAL			= 21;
		var MHF_REDO_ICON_ORDINAL			= 22;
		var MHF_MOVE_RIGHT_ICON_ORDINAL		= 23;
		var MHF_MOVE_LEFT_ICON_ORDINAL		= 24;
		var MHF_ZOOM_IN_ICON_ORDINAL		= 25;
		var MHF_ZOOM_OUT_ICON_ORDINAL		= 26;
		var	MHF_NEWFOLDER_ICON_ORDINAL		= 27;
		var MHF_PLUS_ICON_ORDINAL			= 28;
		var MHF_TIMELINE_ICON_ORDINAL		= 29;
		var MHF_NEWMEETING_ICON_ORDINAL		= 30;

		//
		// Strings
		//
		var STR_ATTACHMENT_TITLE = "Attachment";

		// Millisecords per day
		var g_MSPERDAY = 86400000;			// 1000 * 60 * 60 * 24;

		// Millisecords per day
		var g_MSWEEKENDLENGTH = 172800000;	// 2 * g_MSPERDAY;

		var g_Intl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
		var g_Null = GrooveScriptFunctions.CreateNewObject("");

		//
		// Convert GrooveProjectToolsetStatusType to displayable string
		//
		function MHF_GetStatusStringFromEnum(i_StatusEnum)
		{
			switch(i_StatusEnum)
			{
				case GrooveProjectToolsetStatusType_NotStarted:
					return GPT_S_STATUS_NOTSTARTED;
				case GrooveProjectToolsetStatusType_InProgress:
					return GPT_S_STATUS_INPROGRESS;
				case GrooveProjectToolsetStatusType_Complete:
					return GPT_S_STATUS_COMPLETE;
				default:
					GrooveDebugFunctions.DisplayAssert(0, "Invalid status");
					return "";
			}
		}

		//
		// Convert string to GrooveProjectToolsetStatusType
		//
		function MHF_GetStatusEnumFromString(i_StatusString)
		{
			switch(i_StatusString)
			{
				case GPT_S_STATUS_NOTSTARTED:
					return GrooveProjectToolsetStatusType_NotStarted;
				case GPT_S_STATUS_INPROGRESS:
					return GrooveProjectToolsetStatusType_InProgress;
				case GPT_S_STATUS_COMPLETE:
					return GrooveProjectToolsetStatusType_Complete;
				default:
					GrooveDebugFunctions.DisplayAssert(0, "Invalid status string");
					return GrooveProjectToolsetStatusType_NotStarted;
			}
		}

		//
		// Convert GrooveProjectToolsetStatusFilterType to displayable string
		//
		function MHF_GetStatusFilterStringFromEnum(i_StatusFilterEnum)
		{
			switch(i_StatusFilterEnum)
			{
				case GrooveProjectToolsetStatusFilterType_NotStarted:
					return GPT_S_STATUS_NOTSTARTED;
				case GrooveProjectToolsetStatusFilterType_InProgress:
					return GPT_S_STATUS_INPROGRESS;
				case GrooveProjectToolsetStatusFilterType_Complete:
					return GPT_S_STATUS_COMPLETE;
				case GrooveProjectToolsetStatusFilterType_All:
					return GPT_S_STATUS_ALL;
				default:
					GrooveDebugFunctions.DisplayAssert(0, "Invalid status");
					return "";
			}
		}

		//
		// Convert string to GrooveProjectToolsetStatusFilterType
		//
		function MHF_GetStatusFilterEnumFromString(i_StatusFilterString)
		{
			switch(i_StatusFilterString)
			{
				case GPT_S_STATUS_NOTSTARTED:
					return GrooveProjectToolsetStatusFilterType_NotStarted;
				case GPT_S_STATUS_INPROGRESS:
					return GrooveProjectToolsetStatusFilterType_InProgress;
				case GPT_S_STATUS_COMPLETE:
					return GrooveProjectToolsetStatusFilterType_Complete;
				case GPT_S_STATUS_ALL:
					return GrooveProjectToolsetStatusFilterType_All
				default:
					GrooveDebugFunctions.DisplayAssert(0, "Invalid status string");
					return GrooveProjectToolsetStatusFilterType_NotStarted;
			}
		}

		//
		// Convert GrooveProjectToolsetPriorityType to a displayable string
		//
		function MHF_GetPriorityStringFromEnum(i_PriorityEnum)
		{
			switch(i_PriorityEnum)
			{
				case GrooveProjectToolsetPriorityType_Critical:
					return GPT_S_PRIORITY_CRITICAL;
				case GrooveProjectToolsetPriorityType_Important:
					return GPT_S_PRIORITY_IMPORTANT;
				case GrooveProjectToolsetPriorityType_Normal:
					return GPT_S_PRIORITY_NORMAL;
				case GrooveProjectToolsetPriorityType_Low:
					return GPT_S_PRIORITY_LOW;
				default:
					GrooveDebugFunctions.DisplayAssert(0, "Invalid priority");
					return "";
			}
		}

		//
		// Convert string to GrooveProjectToolsetPriorityType
		//
		function MHF_GetPriorityEnumFromString(i_PriorityString)
		{
			switch(i_PriorityString)
			{
				case GPT_S_PRIORITY_CRITICAL:
					return GrooveProjectToolsetPriorityType_Critical;
				case GPT_S_PRIORITY_IMPORTANT:
					return GrooveProjectToolsetPriorityType_Important;
				case GPT_S_PRIORITY_NORMAL:
					return GrooveProjectToolsetPriorityType_Normal;
				case GPT_S_PRIORITY_LOW:
					return GrooveProjectToolsetPriorityType_Low;
				default:
					GrooveDebugFunctions.DisplayAssert(0, "Invalid priority string");
					return GrooveProjectToolsetPriorityType_Normal;
			}
		}

		// Finish date is diplayed as Finish - 1 day for tasks
		// of duration 1 day or more (this is consistent with other
		// leading project tracking applications)
		// for tasks with 0 duration or summary tasks, we show the actual
		// finish date
		function MHF_GetDisplayFinishDateMS(i_DurationMS, i_FinishDateMS)
		{
			if (0 != i_DurationMS)
			{
				// Back up one day
				var finishDateMS = i_FinishDateMS - g_MSPERDAY;

				// When subtracting one day from "Monday", we need to skip the weekend
				var pIDate = g_Intl.CreateDateFromRawDateTime(finishDateMS);
				var pICalendar = g_Intl.CreateCalendar();
				pICalendar.DateTime = pIDate;

				if(GrooveIntlCalendarDayOfWeek_Sunday
				   == pICalendar.Get(GrooveIntlCalendarField_DayOfWeek))
				{
					// Back up over weekend
					finishDateMS -= g_MSWEEKENDLENGTH;
				}
				else if (GrooveIntlCalendarDayOfWeek_Saturday ==
				         pICalendar.Get(GrooveIntlCalendarField_DayOfWeek))
				{
					// Back up over weekend
					finishDateMS -= g_MSPERDAY;
				}

				return finishDateMS;
			}

			return i_FinishDateMS;
		}

		//
		// Return a JavaScript array containing the available priority strings
		// in an order suitable for display
		//
		function MHF_GetPriorityArray()
		{
			var PriorityArray = new Array();
			
			PriorityArray[0] = GPT_S_PRIORITY_CRITICAL;
			PriorityArray[1] = GPT_S_PRIORITY_IMPORTANT;
			PriorityArray[2] = GPT_S_PRIORITY_NORMAL;
			PriorityArray[3] = GPT_S_PRIORITY_LOW;

			return PriorityArray;
		}

		//
		// Return a JavaScript array containing the available status strings
		// in an order suitable for display
		//
		function MHF_GetStatusArray(i_bIncludeAll)
		{
			var index = 0;
			var StatusArray = new Array();
		
			if(true == i_bIncludeAll)
				StatusArray[index++] = GPT_S_STATUS_ALL;

			StatusArray[index++] = GPT_S_STATUS_NOTSTARTED;
			StatusArray[index++] = GPT_S_STATUS_INPROGRESS;
			StatusArray[index] = GPT_S_STATUS_COMPLETE;

			return StatusArray;
		}

		//
		// Return the URL for the installed icon file
		//
		function MHF_GetIconFileURL()
		{
			return CreateURLFromSchemeAndPath("grooveFile", "ToolData\\groove.net\\GrooveProjectToolset\\ProjectToolsetIconImages.jpg");
		}

		//
		// Return the URL for the installed icon mask file
		//
		function MHF_GetIconMaskFileURL()
		{
			return CreateURLFromSchemeAndPath("grooveFile", "ToolData\\groove.net\\GrooveProjectToolset\\ProjectToolsetIconImagesMask.bmp");
		}

		//
		// Return the width of the icon images
		//
		function MHF_GetIconWidth()
		{
			return 16;
		}

		//
		// Return the height of the icon images
		//
		function MHF_GetIconHeight()
		{
			return 16;
		}


		//
		// Display an application modal prompt to the user
		//
		// Inputs:
		// i_Message: message to display
		// i_Title: message box title
		// i_Style: as GrooveMessageBoxStyle
		// i_Icon: as GrooveMessageBoxIcon
		//
		// Output:
		// as GrooveMessageBoxResultCode
		//
		function MHF_MessageBox(i_Message, i_Title, i_Style, i_Icon)
		{
			var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			var Account = OpenAccountFromPropertyList(PropertyList);

			return App.GrooveMessageBox(Window, 
								Account, 
								i_Message,
								i_Title,
								i_Style,
								i_Icon);
		}



		//
		// Output: reference to Window object containing the subform
		//
		function MHF_CreateDialogBox(i_pIComponent, 
									 i_Caption,
									 i_InitialWidth, 
									 i_InitialHeight,
									 i_HelpButton)
		{
			var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
			var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
			var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
			var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

			WindowProperties.Style = "PopupWindow";
			WindowProperties.ParentWindow = ParentWindow;
			WindowProperties.Resizable = false;
			WindowProperties.CaptionVisible = true;
			WindowProperties.InitialWidth = i_InitialWidth;
			WindowProperties.InitialHeight = i_InitialHeight;
			WindowProperties.CloseButton = false;
			WindowProperties.Caption = i_Caption;
			WindowProperties.HelpButton = i_HelpButton;

			return WindowMgr.CreateGrooveWindowForForm(WindowAccount, 
															 "", 
															 WindowProperties, 
															 i_pIComponent);
		}

		function MHF_BindableURLFromCanonicalURL(i_CanonicalURL)
		{
			var IdentityURL = PropertyList.OpenProperty(PROPERTY_CURRENT_IDENTITY_URL);
			var pITelespaceURLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.TelespaceURLSyntax");
			return pITelespaceURLSyntax.CreateBindableURL(i_CanonicalURL, IdentityURL);
		}

		//
		// This function displays the FileOpenDialog and defaults to the last directory
		// the user opened from or their personal documents folder if none exsts.
		// It also updates the last opened directory if a dialog is not cancelled.
		//
		// Output: IGrooveSimpleDialogResult
		//
		function MHF_CreateFileOpenDialogBox(i_Title, i_Filter, i_SelectFilter, i_MultiSelect)
		{
			var pIAccount = PropertyList.OpenProperty(PROPERTY_ACCOUNT);
			var ToolName = PropertyList.OpenProperty(PROPERTY_TOOL_DISPLAY_NAME);
			var DefaultDirectory = "";

			if (PropertyList.PropertyExists(ToolName + "LastDirectory"))
			{
				DefaultDirectory = PropertyList.OpenProperty(ToolName +"LastDirectory") + "\\";
			}

			var pIDialogResult = App.OpenFileDialog
									(
										GPTPROJECT_OF_ADDATTACHMENT,
										i_Filter,
										DefaultDirectory,
										"",
										pIAccount,
										i_SelectFilter,
										i_MultiSelect
									);

			if(GrooveDialogBoxResultCode_OK == pIDialogResult.Result)
			{
				var FileListString = pIDialogResult.Data;

				// remember selected directory
				var strPath;
				
				// when in single select or multi-select and only one item is
				// returned, the file list string is the fully qualified path of the file
				// when mutliple items are selected, the string contains the name of 
				// the directory followed by all of the filenames, seperated by '|'
				if(false == i_MultiSelect || 
				   true == i_MultiSelect && -1 == FileListString.indexOf("|"))
				{
					strPath = LeftBack(FileListString, "\\");
				}
				else
				{
					strPath = Left(FileListString, "|");
				}

				PropertyList.SetProperty(ToolName + "LastDirectory", strPath, GroovePropertyFlag_Private);
			}

			return pIDialogResult;
		}


		//
		// This function launches a file stored in the provided stream.  It uses
		// the provided filename when storing it in the Groove temporary directory.
		// The file that is generated is read-only and will overwrite any existing
		// file in the temporary directory.
		//
		function MHF_LaunchFileFromStream(i_Filename, i_pIByteInputStream)
		{
			MHF_ShowWaitCursor(true);

			try
			{
				var pIFileServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
				var TempDir = pIFileServices.OpenTempPath();

				var FilePath = pIFileServices.ExportFileToFolder(
					  i_pIByteInputStream,
					  TempDir,			// Folder Path
					  i_Filename,		// Filename
					  true,				// Read only?
					  true);			// Overwrite Existing?

				// Now launch the file.
				App.LaunchProgram(FilePath);

				// Tell Groove to delete file after app's done.
				var pITemporaryFileServices = GrooveScriptFunctions.CreateNewObject("Groove.TemporaryFileServices");
				pITemporaryFileServices.TemporaryFileServices2.DeleteTemporaryPath(FilePath, GrooveTemporaryFileDeleteFlag_TimerDelay, PropertyList.OpenProperty(PROPERTY_ACCOUNT_GUID));
			}
			catch(e)
			{
				MHF_MessageBox("Cannot launch the attachment: " + i_Filename, STR_ATTACHMENT_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			}
	
			MHF_ShowWaitCursor(false);
		}

		function MHF_ShowWaitCursor(i_bShow)
		{
			var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
			WindowMgr.ShowWaitCursor(i_bShow);
		}

		// The MHF_ParseDate function is optimized for performance.  The caller passes in a null object and an
		// internationalization object, therefore these objects don't have to be instantiated for each call.
		function MHF_ParseDate(i_DateString)
		{
			var DateFormat = null;
			var DateObj = null;

			try
			{
				DateFormat = g_Intl.CreateDateFormatForDate(GrooveIntlDateFormatStyle_Medium, g_Null);
				DateObj = DateFormat.Parse(i_DateString, g_Null);
				return DateObj.RawDateTime;
			}
			catch(error)
			{
				try
				{
					DateFormat = g_Intl.CreateDateFormatForDate(GrooveIntlDateFormatStyle_Short, g_Null);
					DateObj = DateFormat.Parse(i_DateString, g_Null);
					return DateObj.RawDateTime;
				}
				catch(error)
				{
					try
					{
						DateFormat = g_Intl.CreateDateFormatForDate(GrooveIntlDateFormatStyle_Long, g_Null);
						DateObj = DateFormat.Parse(i_DateString, g_Null);
						return DateObj.RawDateTime;
					}
					catch(error)
					{
						try
						{
							DateFormat = g_Intl.CreateDateFormatForDate(GrooveIntlDateFormatStyle_Full, g_Null);
							DateObj = DateFormat.Parse(i_DateString, g_Null);
							return DateObj.RawDateTime;
						}
						catch(error)
						{
							return Number.NaN;
						}
					}
				}
			}
		}

		//**********************************
		// Common MAP object
		//**********************************
		function CommonMap()
		{
			// datum
			this.Map = new Array();

			// methods
			this.Add = CommonMap_Add;
			this.FindByKey = CommonMap_FindByKey;
			this.FindByValue = CommonMap_FindByValue;
			this.GetCount = CommonMap_GetCount;
			this.GetAt = CommonMap_GetAt;
			this.KeyExists = CommonMap_KeyExists;
			this.ValueExists = CommonMap_ValueExists;
		}

		function CommonMap_GetCount()
		{
			return this.Map.length;
		}

		function CommonMap_GetAt(i_Index)
		{
			return this.Map[i_Index];
		}

		function CommonMap_Add(i_Key, i_Value)
		{
			this.Map[this.Map.length] = new CommonMap_Descriptor(i_Key, i_Value);
		}

		function CommonMap_FindByKey(i_Key)
		{
			for(var i = 0; i < this.Map.length; ++i)
				if(this.Map[i].Key == i_Key)
					return this.Map[i].Value;

			return null;
		}

		function CommonMap_FindByValue(i_Value)
		{
			for(var i = 0; i < this.Map.length; ++i)
				if(this.Map[i].Value == i_Value)
					return this.Map[i].Key;

			return null;
		}

		function CommonMap_Descriptor(i_Key, i_Value)
		{
			// datum
			this.Key = i_Key;
			this.Value = i_Value;
		}

		function CommonMap_KeyExists(i_Key)
		{
			for(var i = 0; i < this.Map.length; ++i)
				if(this.Map[i].Key == i_Key)
					return true;

			return false;
		}

		function CommonMap_ValueExists(i_Value)
		{
			for(var i = 0; i < this.Map.length; ++i)
				if(this.Map[i].Value == i_Value)
					return true;

			return false;
		}


		//***********************************************************
		//**  Groove Attachement Helper Classes and Variables
		//***********************************************************

		//  ---------------------------------------------------
		//  AttachmentsButtonHelper class
		//  ---------------------------------------------------
		function AttachmentsButtonHelperClass(i_DocShareEngine, i_MenuButton, i_pIUICommandContainer)
		{
			// member variables

			this.docShareEngine			= i_DocShareEngine;
			this.menuButton				= i_MenuButton;
			this.pIUICommandContainer	= i_pIUICommandContainer;

			this.newAttachmentsArray	= new Array();
			this.deleteAttachmentsArray = new Array();

			// methods

			this.Launch			= AttachmentsButtonHelperClass_LaunchAttachment;
			this.Add			= AttachmentsButtonHelperClass_AddNewAttachments;
			this.Remove			= AttachmentsButtonHelperClass_RemoveAttachment;
			this.RemoveAll		= AttachmentsButtonHelperClass_RemoveAllAttachments;
			this.SaveAll		= AttachmentsButtonHelperClass_SaveAllAttachments;
			this.Commit			= AttachmentsButtonHelperClass_CommitAttachmentChangesToRecord;
			this.Abort			= AttachmentsButtonHelperClass_AbortAttachmentChangesToRecord;

			this.RefreshButton			= AttachmentsButtonHelperClass_RefreshMenuOfAttachementsButton;
			this.ProcessMenuCommand		= AttachmentsButtonHelperClass_ProcessAttachmentsMenuCommand;
			this.GenerateLabel			= AttachmentsButtonHelperClass_GenerateAttachmentsLabel;
			this.HasChanged				= AttachmentsButtonHelperClass_HasChanged;

			this.DeleteAllFromRecord	= AttachmentsButtonHelperClass_DeleteAllDocShareObjectsAttachedToRecord;

			this.AddFromArray			= AttachmentsButtonHelperClass_AddNewAttachmentsToRecordFromAttachmentsArray;
			this.ReattachFromElement	= AttachmentsButtonHelperClass_ReattachAttachmentsFromElement;
			this.AddToElement			= AttachmentsButtonHelperClass_AddAttachmentsToElement;

			this.DeleteShareFolderByName					= AttachmentsButtonHelperClass_DeleteShareFolderByName;
			this.GetOrCreateNewDocumentShareFolderByName	= AttachmentsButtonHelperClass_GetOrCreateNewDocumentShareFolderByName;
		}

		//  ---------------------------------------------------
		//  AttachmentHelper class
		//  ---------------------------------------------------
		function AttachmentHelperClass(i_Name, i_ID, i_pIBIS, i_pLastModifiedTime, i_Size, i_FullPathAndName)
		{
			this.name = i_Name;
			this.ID = i_ID;
			this.BIS = i_pIBIS;
			this.LastModifiedTime = i_pLastModifiedTime;
			this.Size = i_Size;
			this.FullPathAndName = i_FullPathAndName;
		}

		var ATTACHMENT_FILE_NAME			= "FileName";
		var ATTACHMENT_FILE_ID				= "ShareID";
		var ATTACHMENT_ELEMENT_NAME			= "Attachments";
		var DELETE_COMMAND_PREFIX			= "DELETE_";

		// Strings that should be gotten from a resource bundle...
		var STR_NEW_ATTACHMENTS_DLG_TITLE	= "Select new attachment(s)...";
		var	STR_SAVE_ALL_DLG_TITLE			= "Save all attachments...";
		var STR_SAVE_DLG_TITLE				= "Save";
		var STR_AS_DLG_TITLE				= "As...";
		var STR_NEW							= "New";
		var STR_NEW_ATTACHMENTS				= "Add...";
		var STR_SAVE_ALL_ATTACHMENTS		= "Save all...";
		var STR_DELETE_ALL_ATTACHMENTS		= "All Attachments";
		var STR_NO_NAME						= "No Name";
		var STR_ATTACHMENT					= "Attachment";
		var STR_ATTACHMENTS					= "Attachments";
		var STR_CONFIRM_ATTACHMENT_DELETION		= "Are you sure you want to delete the selected attachment";
		var STR_CONFIRM_ALL_ATTACHMENT_DELETION = "Are you sure you want to delete all attachments?";


		//***********************************************************
		//**  AttachmentsButtonHelper Class Implementation Functions
		//***********************************************************

		function AttachmentsButtonHelperClass_GetOrCreateNewDocumentShareFolderByName(i_FolderName)
		{
			GrooveDebugFunctions.DisplayAssert(this.docShareEngine.DocumentShareEngine3 != null, "Invalid type of Document Share Engine!");

			if (!this.docShareEngine)
				return;

			var folderID;
			var docShareEngineData = this.docShareEngine.Data;
			var rootFolderID = docShareEngineData.OpenRootShareFolderID();

			if (!docShareEngineData.DoesFolderExistInFolderByFullName(rootFolderID, i_FolderName))
			{
				folderID = this.docShareEngine.DocumentShareEngine3.CreateShareObjectID();
				this.docShareEngine.AddFolder(folderID, rootFolderID, i_FolderName, i_FolderName);
			}
			else
				folderID = docShareEngineData.OpenFolderInFolderByFullName(rootFolderID, i_FolderName);

			return folderID;
		}

		function AttachmentsButtonHelperClass_LaunchAttachment(i_AttachmentID)
		{
			if (this.docShareEngine != null && this.docShareEngine.Data.DoesShareObjectExistByID(i_AttachmentID))
			{
				var strFileName = this.docShareEngine.Data.OpenShareObjectByID(i_AttachmentID).IGrooveShareObject.DisplayName;
				var pBIS = this.docShareEngine.Data.OpenFileContents(i_AttachmentID);
				MHF_LaunchFileFromStream(strFileName, pBIS);
			}
			else
			{
				// Probably an attachment that has not been comitted to the record yet. Look for it in the new attachments array.
				for (var i = 0; i < this.newAttachmentsArray.length; i++)
				{
					if (this.newAttachmentsArray[i].ID == i_AttachmentID)
					{
						var pBIS = CreateByteInputStreamFromFile(this.newAttachmentsArray[i].FullPathAndName, true);
						if (pBIS)
						{
							MHF_LaunchFileFromStream(this.newAttachmentsArray[i].name, pBIS);
						}
						return;
					}
				}

				MHF_MessageBox("Cannot launch the attachment(s).", STR_ATTACHMENT_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			}
		}

		// Requires a write transaction.
		function AttachmentsButtonHelperClass_AddNewAttachments(i_pIRecord, i_DefaultPath, i_Account)
		{
			var newAttachment = App.OpenFileDialog(STR_NEW_ATTACHMENTS_DLG_TITLE, "All Files (*.*)||", i_DefaultPath, "", i_Account, 1, true);
			if (newAttachment.Result != 1)
				return i_DefaultPath;

			MHF_ShowWaitCursor(true);

			var pathAndNameArray = newAttachment.Data.split("|");
			var defaultPath = pathAndNameArray[0];

			if (pathAndNameArray.length == 1)
			{
				var fullPathAndFileName = pathAndNameArray[0];
				var name = GetFileNameFromFullPath(fullPathAndFileName);
				AddAttachmentToNewAttachmentsArray(this.docShareEngine, name, fullPathAndFileName, this.newAttachmentsArray)
			}
			else
			{
				var index = 1;

				while (pathAndNameArray[index])
				{
					var name = pathAndNameArray[index];
					var fullPathAndFileName = GetFullFilePath(defaultPath, name);
					AddAttachmentToNewAttachmentsArray(this.docShareEngine, name, fullPathAndFileName, this.newAttachmentsArray)

					index++;
				}
			}

			MHF_ShowWaitCursor(false);

			return defaultPath;
		}

		function AttachmentsButtonHelperClass_RemoveAttachment(i_pIRecord, i_AttachmentID, i_bConfirm)
		{
			if (i_bConfirm)
			{
				if (i_pIRecord)
				{
					attachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);

					var attachmentID	= "";

					for (var i = 0; i < attachmentsElement.GetContentCount(); i++)
					{
						var pIAttachmentElement = attachmentsElement.OpenContentElement(i);

						if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
						{
							attachmentID = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);
							if (attachmentID == i_AttachmentID)
							{
								var msg = STR_CONFIRM_ATTACHMENT_DELETION;

								if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_NAME))
								{
									var attachmentName = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_NAME);
									msg += ":";
									msg = AddStringToString(msg, attachmentName);
								}
								msg +="\?";

								if (!UserConfirmsDeletion(msg))
									return;

								break;
							}
						}
					}
				}
			}

			var bIsNewAttachement = false;

			// first try to delete it from the new attachements array
			for (var i = 0; i < this.newAttachmentsArray.length; i++)
			{
				if (this.newAttachmentsArray[i].ID == i_AttachmentID)
				{
					this.newAttachmentsArray.splice(i, 1);
					bIsNewAttachement = true;
					break;
				}
			}

			if (!bIsNewAttachement)
				AddAttachmentToDeleteAttachmentsArray(i_AttachmentID, this.deleteAttachmentsArray);
		}

		function AttachmentsButtonHelperClass_RemoveAllAttachments(i_pIRecord)
		{
			if (!UserConfirmsDeletion(STR_CONFIRM_ALL_ATTACHMENT_DELETION))
				return;

			// We want to do this whether or not we are adding/removing attachments to a real record!
			this.Abort();

			if (i_pIRecord)
			{
				attachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);

				var attachmentID	= "";

				for (var i = 0; i < attachmentsElement.GetContentCount(); i++)
				{
					var pIAttachmentElement = attachmentsElement.OpenContentElement(i);

					if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
						attachmentID = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);

					this.Remove(i_pIRecord, attachmentID, false)
				}
			}
		}

		function AttachmentsButtonHelperClass_SaveAllAttachments(i_pIRecord, i_Account)
		{
			MHF_ShowWaitCursor(true);

			try
			{
				var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
				var folderPath = App.BrowseForResource(ParentWindow, STR_SAVE_ALL_DLG_TITLE, GrooveBrowseForResourceStyle_Folders);	
			
				if (folderPath == "")
					return;

				var multipleFiles = false;		// true if multiple files being saved
				var dialogResult = 0;

				// Write the attachments from the record first (don't save those about to be deleted).
				if (i_pIRecord != null && this.docShareEngine != null)
				{
					var docShareData = this.docShareEngine.Data;

					var attachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);

					var attachmentName	= "";
					var attachmentID	= "";

					//	Figure out exactly how many attachments are left in the attachment element.

					var AttachmentElementCount = 0;
					for (var i = 0; i < attachmentsElement.GetContentCount(); i++)
					{
						var pIAttachmentElement = attachmentsElement.OpenContentElement(i);
						if (pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
						{
							if (!IsAttachmentInArray(pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID), this.deleteAttachmentsArray))
								AttachmentElementCount++;
						}
					}

					multipleFiles = (AttachmentElementCount + this.newAttachmentsArray.length) > 1 ? true : false;

					for (var i = 0; i < attachmentsElement.GetContentCount(); i++)
					{
						var pIAttachmentElement = attachmentsElement.OpenContentElement(i);

						if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_NAME))
							attachmentName = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_NAME);

						if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
							attachmentID = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);

						if (!IsAttachmentInArray(attachmentID, this.deleteAttachmentsArray))
						{
							if (docShareData.DoesShareObjectExistByID(attachmentID))
							{
								var shareObject = docShareData.OpenShareObjectByID(attachmentID);
								if (shareObject)
								{
									var BIS = shareObject.File.OpenBinaryContents();
									if (typeof BIS != "undefined")
									{
										dialogResult = WriteBISToDisk(BIS, folderPath, attachmentName,
																	shareObject.ShareObject.LastModifiedTime,
																	shareObject.File.OpenBinarySize(), i_Account,
																	dialogResult,
																	multipleFiles);
										if (dialogResult == GrooveDlgResultCode_Cancel)
											return;
									}
								}
							}
							else
							{
								GrooveDebugFunctions.DisplayAssert(false, "Attachment '" + attachmentName + "' not found in the document store.");
								// fall thru to handle the remaining attachments
							}
						}
					}
				}
				
				if ((multipleFiles == false) && (this.newAttachmentsArray.length > 1))
					multipleFiles = true;

				// Now write the attachments that are just about to be added...
				for (var i = 0; i < this.newAttachmentsArray.length; i++)
				{
					dialogResult = WriteBISToDisk(this.newAttachmentsArray[i].BIS,
												  folderPath,
												  this.newAttachmentsArray[i].name,
												  this.newAttachmentsArray[i].LastModifiedTime,
												  this.newAttachmentsArray[i].Size,
												  i_Account, dialogResult, multipleFiles);
					if (dialogResult == GrooveDlgResultCode_Cancel)
						break;
				}
			}
			catch(e)
			{
				GrooveScriptFunctions.DoMessageBox("Error saving attachment(s): " + e.description);
			}
	
			MHF_ShowWaitCursor(false);
		}

		// Requires a Delta!!!
		function AttachmentsButtonHelperClass_CommitAttachmentChangesToRecord(i_Record)
		{
			// Add attachments to record
			this.AddFromArray(i_Record, this.newAttachmentsArray);
			
			// Free old attachments array and allocate a new one.
			delete this.newAttachmentsArray;
			this.newAttachmentsArray = new Array();

			// Remove delete attachments from record.
			DeleteAttachmentsFromRecord(this.docShareEngine, i_Record, this.deleteAttachmentsArray);
			
			// Free old delete attachments array and allocate a new one.
			delete this.deleteAttachmentsArray;
			this.deleteAttachmentsArray = new Array();
		}

		// Requires a Delta!!!
		function AttachmentsButtonHelperClass_AbortAttachmentChangesToRecord()
		{
			delete this.newAttachmentsArray;
			this.newAttachmentsArray = new Array();

			delete this.deleteAttachmentsArray;
			this.deleteAttachmentsArray = new Array();
		}

		// This function reqires a transaction, unless i_pIRecord is null or i_bEditingNewItem is true;
		function AttachmentsButtonHelperClass_RefreshMenuOfAttachementsButton(i_pIRecord, i_bInEditMode, i_bEditingNewItem)
		{
			var menuPos = 0;
			var numAttachments = 0;
			var pIUICommand = null;
			var attachmentsElement = null;

			this.pIUICommandContainer.RemoveAllUICommands();
			pIDeletionUICommandContainer = null;

			if (i_bInEditMode)
			{
				pIUICommand = this.pIUICommandContainer.InsertUICommand("New_Attachment", menuPos++);
				pIUICommand.Label = STR_NEW_ATTACHMENTS;
			}		

			if (i_pIRecord)
			{
				attachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);

				var attachmentName	= "";
				var attachmentID	= "";

				for (var i = 0; i < attachmentsElement.GetContentCount(); i++)
				{
					var pIAttachmentElement = attachmentsElement.OpenContentElement(i);

					if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_NAME))
						attachmentName = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_NAME);

					if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
						attachmentID = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);

					if (!IsAttachmentInArray(attachmentID, this.deleteAttachmentsArray))
					{
						pIUICommand = this.pIUICommandContainer.InsertUICommand(attachmentID, menuPos++);
						pIUICommand.Label = attachmentName;
						pIUICommand.UserData = attachmentID;
						numAttachments++;
					}
				}
			}
			
			if (i_bInEditMode)
			{
				// Also put newly added (but not yet saved) attachments in the list
				for (var i = 0; i < this.newAttachmentsArray.length; i++)
				{
					var name = this.newAttachmentsArray[i].name;
					var ID = this.newAttachmentsArray[i].ID;

					pIUICommand = this.pIUICommandContainer.InsertUICommand(ID, menuPos++);
					pIUICommand.Label = name + " (" + STR_NEW + ")";
					pIUICommand.UserData = ID;
					numAttachments++;
				}

				if (numAttachments)		// Should be 0 when we first start creating a meeting, agenda topic, or action item.
				{
					pIDeletionUICommandContainer = this.pIUICommandContainer.InsertUICommandContainer("Delete_Attachment", 1);
					pIDeletionUICommandContainer.UICommand.Label = "Delete...";
					pIUICommand = this.pIUICommandContainer.InsertSeparator("Attachment_Menu_Separator2", 2);

					menuPos = 0;

					pIUICommand = pIDeletionUICommandContainer.InsertUICommand("Delete_All_Attachments", menuPos++);
					pIUICommand.Label = STR_DELETE_ALL_ATTACHMENTS;
					pIUICommand = pIDeletionUICommandContainer.InsertSeparator("Delete_Attachment_Menu_Separator1", menuPos++);

					// It's OK if this is null, because we might be adding attachments in a wizard.	PWL 6/12/02
					if (attachmentsElement)		
					{
						for (var i = 0; i < attachmentsElement.GetContentCount(); i++)
						{
							var pIAttachmentElement = attachmentsElement.OpenContentElement(i);

							if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_NAME))
								attachmentName = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_NAME);

							if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
								attachmentID = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);

							if (!IsAttachmentInArray(attachmentID, this.deleteAttachmentsArray))
							{
								pIUICommand = pIDeletionUICommandContainer.InsertUICommand(DELETE_COMMAND_PREFIX + attachmentID, menuPos++);
								pIUICommand.Label = attachmentName;
								pIUICommand.UserData = attachmentID;
							}
						}
					}

					// Also put newly added (but not yet saved) attachments in the list
					for (var i = 0; i < this.newAttachmentsArray.length; i++)
					{
						var attachmentName =	this.newAttachmentsArray[i].name;
						var attachmentID =		this.newAttachmentsArray[i].ID;

						pIUICommand = pIDeletionUICommandContainer.InsertUICommand(DELETE_COMMAND_PREFIX + attachmentID, menuPos++);
						pIUICommand.Label = attachmentName + " (" + STR_NEW + ")";
						pIUICommand.UserData = attachmentID;
					}
				}
			}

			if (numAttachments)
			{
				if (i_bInEditMode)
				{
					pIUICommand = this.pIUICommandContainer.InsertUICommand("Save_All_Attachments", 1);
					pIUICommand.Label = STR_SAVE_ALL_ATTACHMENTS;
					pIUICommand = this.pIUICommandContainer.InsertSeparator("Attachment_Menu_Separator1", 2);
				}
				else
				{
					pIUICommand = this.pIUICommandContainer.InsertUICommand("Save_All_Attachments", 0);
					pIUICommand.Label = STR_SAVE_ALL_ATTACHMENTS;
					pIUICommand = this.pIUICommandContainer.InsertSeparator("Attachment_Menu_Separator3", 1);
				}
			}

			this.menuButton.Label = this.GenerateLabel(numAttachments);

			return numAttachments;
		}

		// Requires a Delta!!!
		function AttachmentsButtonHelperClass_DeleteAllDocShareObjectsAttachedToRecord(i_pIRecord)
		{
			MHF_DeleteAllDocShareObjectsAttachedToRecord(this.docShareEngine, i_pIRecord);
		}

		// Requires a Delta!!!
		function MHF_DeleteAllDocShareObjectsAttachedToRecord(i_DocShareEngine, i_pIRecord)
		{
			if (!i_pIRecord.HasField(ATTACHMENT_ELEMENT_NAME))
				return;

			var pIAttachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);

			for (var i = 0; i < pIAttachmentsElement.GetContentCount(); i++)
			{
				var pIAttachmentElement = pIAttachmentsElement.OpenContentElement(i);

				if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
				{
					attachmentID = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);
					if (i_DocShareEngine.Data.DoesShareObjectExistByID(attachmentID))
						i_DocShareEngine.DeleteShareObject(attachmentID, true);
				}
			}
		}

		// Requires a Delta!!!
		function AttachmentsButtonHelperClass_DeleteShareFolderByName(i_FolderName)
		{
			MHF_DeleteShareFolderByName(this.docShareEngine, i_FolderName);
		}

		// Requires a Delta!!!
		function MHF_DeleteShareFolderByName(i_DocShareEngine, i_FolderName)
		{
			var docShareEngineData = i_DocShareEngine.Data;
			if (!docShareEngineData)
				return;

			var rootFolderID = docShareEngineData.OpenRootShareFolderID();

			if (docShareEngineData.DoesFolderExistInFolderByFullName(rootFolderID, i_FolderName))
			{
				if (docShareEngineData.DoesFolderExistInFolderByFullName(rootFolderID, i_FolderName))
				{
					var folderID = docShareEngineData.OpenFolderInFolderByFullName(rootFolderID, i_FolderName);
					i_DocShareEngine.DeleteShareObject(folderID);
				}
			}
		}

		// Requires a write transaction.
		// This is used when pasting a record with attachments
		function AttachmentsButtonHelperClass_ReattachAttachmentsFromElement(i_pIRecord, i_pIElement)
		{
			MHF_ReattachAttachmentsFromElement(this.docShareEngine, i_pIRecord, i_pIElement)
		}

		// Requires a write transaction.
		// This is used when pasting a record with attachments
		function MHF_ReattachAttachmentsFromElement(i_DocShareEngine, i_pIRecord, i_pIElement)
		{
			if (!i_pIRecord.HasField(ATTACHMENT_ELEMENT_NAME))
				return;

			var pIAttachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);
			if (!pIAttachmentsElement)
				return;

			var docShareData = i_DocShareEngine.Data;

			for(var i = 0; i < pIAttachmentsElement.GetContentCount(); i++)
			{
				var pIAttachmentElement = pIAttachmentsElement.OpenContentElement(i);

				if (pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
				{
					var attachmentID = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);

					if (null == i_pIElement || !i_pIElement.ContentElementWithNameExists(attachmentID))
						continue;

					var pIOldAttachmentElement = i_pIElement.OpenContentElementByName(attachmentID);
					var name = pIOldAttachmentElement.OpenAttribute("DisplayName");
					var pIBIS = pIOldAttachmentElement.OpenAttributeAsBinary("Content");
					var folderName = i_pIRecord.RecordID;

					//	Get the last modified time (if possible) from the old attachment element.

					var pLastModifiedTime = null;
					if (docShareData)
					{
						if (pIOldAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
						{
							var attachmentID = pIOldAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);
							if (docShareData.DoesShareObjectExistByID(attachmentID))
							{
								var pIShareObject = docShareData.OpenShareObjectByID(attachmentID);
								if (pIShareObject)
									pLastModifiedTime = pIShareObject.ShareObject.LastModifiedTime;
							}
						}
					}

					var shareID = CreateNewDocShareObjectFromBIS(i_DocShareEngine, name, 0, pIBIS, folderName, pLastModifiedTime);
					pIAttachmentElement.SetAttribute(ATTACHMENT_FILE_ID, shareID);
				}
				else	// old style of attachments as XLinks
				{
					var name = null;
					if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_NAME)) // Meetings
					{
						name = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_NAME);
					}
					else if (pIAttachmentElement.DoesAttributeExist("Name")) // Task Manager
					{
						name = pIAttachmentElement.OpenAttribute("Name");
						pIAttachmentElement.DeleteAttribute("Name");
						pIAttachmentElement.SetAttribute(ATTACHMENT_FILE_NAME, name); 
					}

					if (null != name)
					{
						var pIBinaryDocument = pIAttachmentElement.OpenLinkedBinaryDocument();
						var pIBIS = pIBinaryDocument.OpenByteInputStream();
						var folderName = i_pIRecord.RecordID;

						var shareID = CreateNewDocShareObjectFromBIS(i_DocShareEngine, name, 0, pIBIS, folderName, null);

						pIAttachmentElement.DeleteLinkAttributes();
						pIAttachmentElement.SetAttribute(ATTACHMENT_FILE_ID, shareID);
					}
				}
			}

			i_pIRecord.SetFieldAsElement(ATTACHMENT_ELEMENT_NAME, pIAttachmentsElement);
		}

		// Requires a transaction.
		function AttachmentsButtonHelperClass_AddAttachmentsToElement(i_pIRecord, i_pIElement)
		{
			MHF_AddAttachmentsToElement(this.docShareEngine, i_pIRecord, i_pIElement);
		}

		// Requires a transaction.
		function MHF_AddAttachmentsToElement(i_DocShareEngine, i_pIRecord, i_pIElement)
		{
			var pIAttachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);
			if (!pIAttachmentsElement)
				return;

			var docShareData = i_DocShareEngine.Data;
			if (!docShareData)
				return;

			for(var i = 0; i < pIAttachmentsElement.GetContentCount(); i++)
			{
				var pIAttachmentElement = pIAttachmentsElement.OpenContentElement(i);

				if (pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
				{
					var attachmentID = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID);

					if (!docShareData.DoesShareObjectExistByID(attachmentID))
						continue;

					var pINewAttachmentElement = CreateNewElement(attachmentID);

					var attachmentName = STR_NO_NAME;

					if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_NAME))
						attachmentName = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_NAME);
					else	// try to get the name from the doc share object
					{
						if (docShareData.DoesShareObjectExistByID(attachmentID))
						{
							var pIShareObject = docShareData.OpenShareObjectByID(attachmentID);
							if (pIShareObject)
								attachmentName = pIShareObject.DisplayName;
						}
						else
							GrooveDebugFunctions.DisplayAssert(false, "Document share object with id: " + attachmentID + " not found in the document share engine.");
					}

					var pIBIS = docShareData.OpenFileContents(attachmentID);
				
					pINewAttachmentElement.SetAttribute("DisplayName", attachmentName);
					pINewAttachmentElement.SetAttributeAsBinary("Content", pIBIS);

					i_pIElement.AppendContentElement(pINewAttachmentElement);
				}
			}
		}

		function AttachmentsButtonHelperClass_ProcessAttachmentsMenuCommand(i_pICommand, i_pIRecord, i_DefaultPath, i_Account)
		{
			var CommandURL = i_pICommand.CommandURL;

			var bAttachmentsChanged = false;

			if (CommandURL == "New_Attachment")
			{
				this.Add(i_pIRecord, i_DefaultPath, i_Account);
				bAttachmentsChanged = true;
			}
			else if (CommandURL == "Delete_All_Attachments")
			{
				this.RemoveAll(i_pIRecord);
				bAttachmentsChanged = true;
			}
			else if (CommandURL == "Save_All_Attachments")
			{
				this.SaveAll(i_pIRecord, i_Account);
				bAttachmentsChanged = true;
			}
			else		// Must be one of our attachments!
			{
				var commandURL = i_pICommand.CommandURL;
				var attachmentID = i_pICommand.UserData;

				if (commandURL.indexOf(DELETE_COMMAND_PREFIX) == -1)
					this.Launch(attachmentID);	// The user must have requested to open the attachment.
				else
				{
					this.Remove(i_pIRecord, attachmentID, true);	// The user has requested to delete the attachment.
					bAttachmentsChanged = true;
				}
			}
			return bAttachmentsChanged;
		}

		function AttachmentsButtonHelperClass_GenerateAttachmentsLabel(i_NumAttachments)
		{
			var attachmentsLabel = "";

			if (i_NumAttachments == 1)
				attachmentsLabel = i_NumAttachments + " " + STR_ATTACHMENT;
			else
				attachmentsLabel = i_NumAttachments + " " + STR_ATTACHMENTS;

			return attachmentsLabel;
		}

		function AttachmentsButtonHelperClass_HasChanged()
		{
			return (this.newAttachmentsArray.length == 0 && this.deleteAttachmentsArray.length == 0) ? false : true;
		}

		// Requires a Delta!!!
		function AttachmentsButtonHelperClass_AddNewAttachmentsToRecordFromAttachmentsArray(i_pIRecord, i_AttachmentsArray)
		{
			if (!i_pIRecord.HasField(ATTACHMENT_ELEMENT_NAME))
				return;

			for (var i = 0; i < i_AttachmentsArray.length; i++)
			{
				var ID = this.docShareEngine.DocumentShareEngine3.CreateShareObjectID();
				AddNewAttachmentToRecord(this.docShareEngine, i_pIRecord, i_AttachmentsArray[i].name, ID, i_AttachmentsArray[i].BIS, i_AttachmentsArray[i].LastModifiedTime);
			}
		}

		//*******************************************************************
		//**          Internal Groove Attachment Helper Functions
		//**    (Not intended to be used outside of this script file!!!)
		//*******************************************************************

		function AddStringToString(i_Msg1, i_Msg2)
		{
			if (i_Msg1 == "")
				return i_Msg2;
			
			return i_Msg1 + " " + i_Msg2
		}

		function UserConfirmsDeletion(i_MSG)
		{
			var RetVal = MHF_MessageBox(i_MSG, STR_ATTACHMENT_TITLE, GrooveMessageBoxStyle_YesNo, GrooveMessageBoxIcon_Exclamation);
			if (RetVal == GrooveMessageBoxResultCode_Yes)
				return true;
			else
				return false;
		}

		function GetOrCreateNewDocumentShareFolderByName(i_DocShareEngine, i_FolderName)
		{
			GrooveDebugFunctions.DisplayAssert(i_DocShareEngine.DocumentShareEngine3 != null, "Invalid arguent sent to GetOrCreateNewDocumentShareFolderByName()");

			var folderID;
			var docShareEngineData = i_DocShareEngine.Data;
			var rootFolderID = docShareEngineData.OpenRootShareFolderID();

			if (!docShareEngineData.DoesFolderExistInFolderByFullName(rootFolderID, i_FolderName))
			{
				folderID = i_DocShareEngine.DocumentShareEngine3.CreateShareObjectID();
				i_DocShareEngine.AddFolder(folderID, rootFolderID, i_FolderName, i_FolderName);
			}
			else
				folderID = docShareEngineData.OpenFolderInFolderByFullName(rootFolderID, i_FolderName);

			return folderID;
		}

		function GetFileNameFromFullPath(i_FullPath)
		{
			var lastPos = i_FullPath.lastIndexOf("\\");
			return i_FullPath.substr(lastPos + 1, 100);  // assume a file name is no longer than 100 characters!
		}

		function GetFullFilePath(i_path, i_name)
		{
			if (i_path.lastIndexOf("\\") == (i_path.length - 1))
				return i_path + i_name;
				
			return i_path + "\\" + i_name;
		}

		// This function was pirated from ProjectDelegateHelperFunctions.gsl.  In the future, we should make sure
		// to use the shared version of it.
		function CreateGUID()
		{
			var pGuidGenerator = GROOVE_GLOBAL_MISC_POINTER.OpenGUIDGenerator();	
			var GUID = pGuidGenerator.CreateGUIDBase16();
			return GUID;
		}

		// Requires a write transaction.
		function CreateNewDocShareObjectFromBIS(i_DocShareEngine, i_name, i_ID, i_pIBIS, i_FolderName, i_pLastModifiedTime)
		{
			var docShareEngine3 = i_DocShareEngine.DocumentShareEngine3;
			var docShareEngineData = i_DocShareEngine.Data;

			if (!docShareEngine3 || !docShareEngineData)
				return;

			if (i_ID == 0)
				i_ID = docShareEngine3.CreateShareObjectID();

			var folderID = GetOrCreateNewDocumentShareFolderByName(i_DocShareEngine, i_FolderName);

			if ((typeof i_pLastModifiedTime == "undefined") || (i_pLastModifiedTime == null))
				i_pLastModifiedTime = GrooveScriptFunctions.CreateNewObject("");

			i_DocShareEngine.AddFile(i_ID, folderID, i_name, i_name, i_pIBIS, i_pLastModifiedTime);

			return i_ID;
		}

		function WriteBISToDisk(i_BIS, i_OutputFolder, i_FileName, i_pLastModifiedTime, i_Size, i_Account, i_PreviousDialogResult, i_MultipleFiles)
		{
			var pFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
			var fullFilePath = i_OutputFolder + "\\" + i_FileName;
			var resultCode = i_PreviousDialogResult;

			//	Make sure that we have a defined new time argument
			var NewLastModifiedTime = (typeof(i_pLastModifiedTime) == "undefined") ? null : i_pLastModifiedTime;

			if (pFileSystemServices.DoesFileExist(fullFilePath))
			{
				//	If we haven't already responded with "Yes to all", then continue to prompt

				if (i_PreviousDialogResult != GrooveDlgResultCode_YesToAll)
				{
					//	Setup the replace file subform & delegate

					var pSubForm = PropertyList.OpenProperty (PROPERTY_FORM).CreateFormByName ("ReplaceFileSubForm");
					var pIWindow = MHF_CreateDialogBox(pSubForm, "Replace File", 400, 350, false);
					var pDelegateHost = pIWindow.OpenDelegateComponent();
					ConnectObject(pDelegateHost, "DocShareReplaceFileCode");

					//	Get the file time & size of the file on disk

					var pFileSystemObject = pFileSystemServices.OpenFileSystemObject(fullFilePath);
					var OldLastModifiedTime = null;
					var OldSize = 0;
					if (pFileSystemObject)
					{
						OldLastModifiedTime = pFileSystemObject.LastModifiedDate;
						OldSize = pFileSystemObject.Win32File.Size;
					}

					//	Convert UTC to local for display

					var LocalOldLastModifiedTimeString = (OldLastModifiedTime == null) ? "" : OldLastModifiedTime.LocalFileTime.FormattedString;
					var LocalNewLastModifiedTimeString = (NewLastModifiedTime == null) ? "" : NewLastModifiedTime.LocalFileTime.FormattedString;

					pDelegateHost.FullName = i_FileName;
					pDelegateHost.OldLastModifiedTime = LocalOldLastModifiedTimeString;
					pDelegateHost.OldSize = FormatFileSizeString(OldSize);
					pDelegateHost.NewLastModifiedTime = LocalNewLastModifiedTimeString;
					pDelegateHost.NewSize = FormatFileSizeString(i_Size);
					pDelegateHost.ParentFolderName = i_OutputFolder;
					pDelegateHost.IsFile = true;
					pDelegateHost.MultipleReplaceMode = i_MultipleFiles;
					pDelegateHost.SetControls();

					pIWindow.DoModal();

					resultCode = pDelegateHost.ResultCode;
					DisconnectObject(pDelegateHost);
					//	The destroy needs to be synchronous, because this dialog may be called in a loop.
					pIWindow.Destroy(resultCode, false);
				}

				if ((resultCode != GrooveDlgResultCode_Cancel) && (resultCode != GrooveDlgResultCode_No))
				{
					pFileSystemServices.ExportFileToFolder(i_BIS, i_OutputFolder, i_FileName, false, true, NewLastModifiedTime);
				}
			}
			else
			{
				// The file path does not already exist, so just write the BIS to the disk.
				var ScanStatus = pFileSystemServices.Win32FileSystemServices2.CreateFile2(fullFilePath, i_BIS, false, false, NewLastModifiedTime);
				if (ScanStatus == GrooveFileFilter_Infected)
				{
					// Delete file immediately
					var pITemporaryFileServices = GrooveScriptFunctions.CreateNewObject("Groove.TemporaryFileServices");
					pITemporaryFileServices.TemporaryFileServices2.DeleteTemporaryPath(fullFilePath, GrooveTemporaryFileDeleteFlag_Immediate, PropertyList.OpenProperty(PROPERTY_ACCOUNT_GUID));

					// Abort the operation
					resultCode = GrooveDlgResultCode_Cancel;
				}
			}
			return resultCode;
		}

		function FormatFileSizeString(i_FileSize)
		{
			var FileSize = i_FileSize;

			if (FileSize != 0)
				FileSize = CalculateKB(FileSize);

			var FileSizeString = CommaSplit(FileSize) + "KB";
			return FileSizeString;
		}

		function CommaSplit(i_Number)
		{
			//	NOTE: We are assuming that i_Number is a valid number.
			var txtNumber = '' + i_Number;
			var rxSplit = new RegExp('([0-9])([0-9][0-9][0-9][,.])');
			var arrNumber = txtNumber.split('.');

			arrNumber[0] += '.';
			do
			{
				arrNumber[0] = arrNumber[0].replace(rxSplit, '$1,$2');
			} while (rxSplit.test(arrNumber[0]));

			if (arrNumber.length > 1)
			{
				return arrNumber.join('');
			}
			else
			{
				return arrNumber[0].split('.')[0];
			}
		}

		function CalculateKB(i_SizeBytes)
		{
			var SizeKB = Math.round(i_SizeBytes / 1024);

			// If KB rounds to 0 but number of bytes is not zero then
			// round up to 1K
			if ((SizeKB == 0) && (i_SizeBytes != 0))
				SizeKB = 1;
			return SizeKB;
		}

		function AddAttachmentToNewAttachmentsArray(i_DocShareEngine, i_name, i_FullPathAndName, i_AttachmentsArray)
		{
			var pIBIS = null;
			try
			{
				pIBIS = CreateByteInputStreamFromFile(i_FullPathAndName, true);
			}
			catch(e)
			{
				// The process cannot access the file because it is being used by another process.
				if (-2147024864 == e.number)
					MHF_MessageBox("Cannot access the file because it is being used by another process.",
								   STR_ATTACHMENT_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
				else
					GrooveDebugFunctions.DisplayAssert(false, e.description);

				return;
			}

			if (!pIBIS)
			{
				MHF_MessageBox("Cannot add the attachment: " + i_name, STR_ATTACHMENT_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
				return;
			}

			var ID = 0;
			if (i_DocShareEngine)
				ID = i_DocShareEngine.DocumentShareEngine3.CreateShareObjectID();
			else	// We are probably doing this in a wizard that does not have a DocShareEngine.
				ID = CreateGUID();	// Will be thrown away, because somebody else is going to create a doc share object...

			//	Get the last modified date & size of the file (used for display during export).
			var pFileSystemServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
			var pFileSystemObject = pFileSystemServices.OpenFileSystemObject(i_FullPathAndName);
			var LastModifiedTime = null;
			var Size = 0;
			if (pFileSystemObject)
			{
				LastModifiedTime = pFileSystemObject.LastModifiedDate;
				Size = pFileSystemObject.Win32File.Size;
			}

			// Make sure ampersands are treated correctly.
			i_name = i_name.replace(/\&/g, "\&\&");

			//  Add new object to array
			i_AttachmentsArray[i_AttachmentsArray.length] = new AttachmentHelperClass(i_name, ID, pIBIS, LastModifiedTime, Size, i_FullPathAndName);
		}

		function AddAttachmentToDeleteAttachmentsArray(i_ID, i_AttachmentsArray)
		{
			var name = "dummy";
			i_AttachmentsArray[i_AttachmentsArray.length] = new AttachmentHelperClass(name, i_ID, null, null, 0, null);
		}

		function IsAttachmentInArray(i_AttachmentID, i_AttachmentsArray)
		{
			for (var i = 0; i < i_AttachmentsArray.length; i++)
			{
				if (i_AttachmentsArray[i].ID == i_AttachmentID)
					return true;
			}

			return false;
		}

		// Requires a write transaction.
		function CreateNewAttachmentElementForRecord(i_pIRecord, i_name, i_ID)
		{
			if (!i_pIRecord.HasField(ATTACHMENT_ELEMENT_NAME))
				return;

			var pIOldAttachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);
			// Assume that OpenFieldAsElement always returns an element!
			pIAttachmentElement = CreateNewElement(ATTACHMENT_FILE_NAME);
			pIAttachmentElement.SetAttribute(ATTACHMENT_FILE_NAME, i_name);
			pIAttachmentElement.SetAttribute(ATTACHMENT_FILE_ID, i_ID);
			pIOldAttachmentsElement.AppendContentElement(pIAttachmentElement);

			i_pIRecord.SetFieldAsElement(ATTACHMENT_ELEMENT_NAME, pIOldAttachmentsElement);
		}

		function AddNewAttachmentToRecord(i_DocShareEngine, i_Record, i_Name, i_ID, i_pIBIS, i_pLastModifiedTime)
		{
			var folderName = i_Record.RecordID;

			CreateNewDocShareObjectFromBIS(i_DocShareEngine, i_Name, i_ID, i_pIBIS, folderName, i_pLastModifiedTime);
			CreateNewAttachmentElementForRecord(i_Record, i_Name, i_ID);
		}

		// Requires a Delta!!!
		function DeleteAttachmentsFromRecord(i_DocShareEngine, i_pIRecord, i_AttachmentsArray)
		{
			GrooveDebugFunctions.DisplayAssert(!!i_pIRecord, "Null record passed to DeleteAttachmentsFromRecord()!");

			if (!(i_pIRecord && i_pIRecord.HasField(ATTACHMENT_ELEMENT_NAME)))
				return;

			var attachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);

			for (var j = 0; j < i_AttachmentsArray.length; j++)
			{
				var attachmentID = i_AttachmentsArray[j].ID;

				for(var i = 0; i < attachmentsElement.GetContentCount(); i++)
				{
					var pIAttachmentElement = attachmentsElement.OpenContentElement(i);

					if (pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
					{
						if (pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_ID) == attachmentID)
						{
							i_DocShareEngine.DeleteShareObject(attachmentID, true);

							// Remove this attachment element.
							attachmentsElement.DeleteContent(i);
							break;
						}
					}
					else	// old style of attachments as XLinks
					{
						if (pIAttachmentElement.OpenTitle() == attachmentID)
						{
							// Remove this attachment element.
							attachmentsElement.DeleteContent(i);
							break;
						}
					}
				}
			}
			
			i_pIRecord.SetFieldAsElement(ATTACHMENT_ELEMENT_NAME, attachmentsElement);
		}

		// This function reqires a delta
		// This is a stealth function that is used externally by the Meeting Tool only.
		function UpdateAttachementsVersionIfNecessary(i_DocShareEngine, i_pIRecord)
		{
			if (!i_pIRecord)
				return;

			var numUpdated = 0;
			var bUpdated = false;

			var pIAttachmentsElement = i_pIRecord.OpenFieldAsElement(ATTACHMENT_ELEMENT_NAME);

			for(var i = 0; i < pIAttachmentsElement.GetContentCount(); i++)
			{
				var pIAttachmentElement = pIAttachmentsElement.OpenContentElement(i);

				if(!pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_ID))
				{
					var attachmentID = pIAttachmentElement.OpenTitle();
					var pIBinaryDocument = pIAttachmentElement.OpenLinkedBinaryDocument();
					var pBIS = pIBinaryDocument.OpenByteInputStream();

					var attachmentName = "";
					if(pIAttachmentElement.DoesAttributeExist(ATTACHMENT_FILE_NAME))
					{
						attachmentName = pIAttachmentElement.OpenAttribute(ATTACHMENT_FILE_NAME);

						var ID = i_DocShareEngine.DocumentShareEngine3.CreateShareObjectID();

						var folderName = i_pIRecord.RecordID;
						var folderID = GetOrCreateNewDocumentShareFolderByName(i_DocShareEngine, folderName);
						i_DocShareEngine.AddFile(ID, folderID, attachmentName, attachmentName, pBIS);

						pIAttachmentsElement.DeleteContent(i);

						pINewAttachmentElement = CreateNewElement("Attachment");
						pINewAttachmentElement.SetAttribute(ATTACHMENT_FILE_NAME, attachmentName);
						pINewAttachmentElement.SetAttribute(ATTACHMENT_FILE_ID, ID);

						pIAttachmentsElement.SetContentElement(i, pINewAttachmentElement);
						bUpdated = true;
						numUpdated++;
					}
		//			else
		//				pIAttachmentElement.DeleteContent(i);

				}
			}

			if (bUpdated)
				i_pIRecord.SetFieldAsElement(ATTACHMENT_ELEMENT_NAME, pIAttachmentsElement);

			return numUpdated;
		}


	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               @           õ  à        ã     £Ê  £Ê                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ê               Ä(null),0                           Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   r   ÄName<   P r o j e c t M i s c H e l p e r F u n c t i o n s . g s l   =       ÄSCRIPT     ÄSCRIPT      ÄSC  ÄSCRIPT       ÄSRC  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e T y p e L i b r a r i e s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Ñ A     ¿          )                      @            ù  ¿  û      ü      †  »                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                »               Ä(null),0               Ä(nul         Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   o   ÄNameF   P r o j e c t R e c o r d S e t H e l p e r F u n c t i o n s . g s l         ÄSCRIPT  RIPT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Ç       π          )            ÄSCRIPT         ‚* Ä

//-----------------------------------------------------------------
// RecordSet helpers
//
// Use of this file requires the inclusion of 
// GrooveGlobalHelperFunctions.gsl and GrooveCollectionComponents and GrooveCollectionMgr
// type libraries

//-----------------------------------------------------------------
	// This function returns enum of record ids which have specified value in 
	// the specified field. If no records found null is returned.
	// The function may be called within
	// READ transaction. 

	function RSHP_FindRecordIDEnum(
				i_pRecordSetEngine, 
				i_RecordType, 
				i_FieldName, 
				i_FieldValue)
	{
		var ResultRecordIDEnum = null;
		var RecordCount = 0;
		try
		{
			if(!i_pRecordSetEngine || !i_RecordType || !i_FieldName || "" == i_FieldName || !i_FieldValue)
				throw "";

			var RecordIDEnum = i_pRecordSetEngine.OpenRecordIDEnum();

			var Record;
			var RecordID;
			var Value;
			var bFound = false;

			var ResultRecordIDEnumFactory = CreateDoubleEnum();
			ResultRecordIDEnum = ResultRecordIDEnumFactory.DoubleEnum;	

			while(RecordIDEnum.HasMore())
			{
				RecordID = RecordIDEnum.OpenNext();
				Record = i_pRecordSetEngine.OpenRecord(RecordID);
				if(Record.Type != i_RecordType)
					continue;

				Value = Record.OpenField(i_FieldName);

				if(i_FieldValue == Value)
				{
					ResultRecordIDEnumFactory.Add(RecordID);
					RecordCount++;
				}
			}
		}
		catch(error)
		{
			GrooveDebugFunctions.DisplayAssert(false, FindRecordIDEnum.toString());
			ResultRecordIDEnum = null;
			RecordCount = 0;
		}

		if(RecordCount)
			return ResultRecordIDEnum;
		else
			return null;
	}

	// This function returns enum of records which have specified value in 
	// the specified field. If no records found null is returned.
	// The function may be called within
	// READ transaction. 

	function RSHP_FindRecordEnum(
				i_pRecordSetEngine, 
				i_RecordType, 
				i_FieldName, 
				i_FieldValue)
	{
		var RecordCount = 0;

		var RecordEnumGUID = "{B839FC20-8E46-11d3-80A2-005004D38CA2}";
		var RecordGUID = "{BD5E0420-F5AB-11d2-8D5A-0080C78F77E0}";
		var RecordEnumFactory = CreateUnknownEnumFromStringIIDs(RecordEnumGUID, RecordGUID);

		try
		{
			if(!i_pRecordSetEngine || !i_RecordType || !i_FieldName || "" == i_FieldName || !i_FieldValue)
				throw "";

			var RecordIDEnum = i_pRecordSetEngine.OpenRecordIDEnum();

			var Record;
			var RecordID;
			var Value;
			var bFound = false;

			while(RecordIDEnum.HasMore())
			{
				RecordID = RecordIDEnum.OpenNext();
				Record = i_pRecordSetEngine.OpenRecord(RecordID);
				if(Record.Type != i_RecordType)
					continue;

				Value = Record.OpenField(i_FieldName);

				if(i_FieldValue == Value)
				{
					RecordEnumFactory.Add(Record);
					RecordCount++;
				}
			}
		}
		catch(error)
		{
			GrooveDebugFunctions.DisplayAssert(false, "RSHP_FindRecordEnum: " + error.description);
			RecordCount = 0;
		}

		if(RecordCount)
			return RecordEnumFactory.UnknownEnum;
		else
			return null;
	}

	// This function returns collection of records of the specified type 
	// which have specified value in the specified field. If no records found null is returned.
	// This function assumes that the specified named sort already exists in the
	// collection. This function should be called within WRITE transaction
	// Named sort should exist in collection, but not necessarily be currently used.
	function RSHP_FindRecordSubcollection(
									i_pToolCollections,
									i_RecordType,
									i_SortName,
									i_FieldName, 
									i_FieldValue
									)
	{
		var pSubCollection = null;

		try
		{
			if(!i_FieldName || "" == i_FieldName || !i_FieldValue || !i_pToolCollections || !i_SortName)
				throw "";

			var pCollection = i_pToolCollections.CollectionManagerProxy.OpenCollection();

			var CollectionConfigure = pCollection.CollectionConfigure;

			if(i_SortName != CollectionConfigure.GetCur          rentSort())
				CollectionConfigure.UseSort(i_SortName, false);

            CollectionConfigure.AddSortConstraint(i_SortName, i_RecordType);

			var QueryString = RSHP_ConstructSimpleQuery(i_FieldName, i_FieldValue);

			pSubCollection = pCollection.Find(QueryString);

		}
		catch(error)
		{
			GrooveDebugFunctions.DisplayAssert(false, "RSHP_FindRecordSubcollection: " + error.description);
			pSubCollection = null;
		}

		return pSubCollection;
	}



	// This function returns first record id which have specified value in 
	// the specified field. If no records found GrooveCollectionRecordID_Null is returned
	// This function should be called within READ transaction

	function RSHP_FindRecordID(i_pRecordSetEngine, i_RecordType, i_FieldName, i_FieldValue)
	{
		var bFound = false;
		var ResultRecordID;
		try
		{
			if(!i_pRecordSetEngine || !i_RecordType || !i_FieldName || "" == i_FieldName || !i_FieldValue)
				throw "";

			var RecordIDEnum = i_pRecordSetEngine.OpenRecordIDEnum();
			var Record;
			var RecordID;
			var Value;

			while(RecordIDEnum.HasMore())
			{
				RecordID = RecordIDEnum.OpenNext();
				Record = i_pRecordSetEngine.OpenRecord(RecordID);
				if(Record.Type != i_RecordType)
					continue;

				Value = Record.OpenField(i_FieldName);

				if(i_FieldValue == Value)
				{
					bFound = true;
					break;
				}
			}
		}
		catch(error)
		{
			GrooveDebugFunctions.DisplayAssert(false, "FindRecordID: " + error.description);
			bFound = false;
		}

		if(true == bFound)
			ResultRecordID = RecordID;
		else
			ResultRecordID = GrooveCollectionRecordID_Null; 

		return ResultRecordID;
	}

	// This function returns first "live" record which have specified value in 
	// the specified field. If no records found null is returned. Convenient if
	// you want to change some field values.
	// This function should be called within READ transaction

	function RSHP_FindRecord(i_pRecordSetEngine, i_RecordType, i_FieldName, i_FieldValue)
	{
		var bFound = false;
		var Result;
		try
		{
			if(!i_pRecordSetEngine || !i_RecordType || !i_FieldName || "" == i_FieldName || !i_FieldValue)
				throw "";

			var RecordIDEnum = i_pRecordSetEngine.OpenRecordIDEnum();
			var Record;
			var RecordID;
			var Value;

			while(RecordIDEnum.HasMore())
			{
				RecordID = RecordIDEnum.OpenNext();
				Record = i_pRecordSetEngine.OpenRecord(RecordID);
				if(Record.Type != i_RecordType)
					continue;

				Value = Record.OpenField(i_FieldName);

				if(i_FieldValue == Value)
				{
					bFound = true;
					break;
				}
			}
		}
		catch(error)
		{
			GrooveDebugFunctions.DisplayAssert(false, "FindRecord: " + error.description);
			bFound = false;
		}

		if(true == bFound)
			Result = Record;
		else
			Result = null; 

		return Result;
	}

	// This function returns clone of the first record which have specified value in 
	// the specified field. If no records found null is returned. Convenient if
	// you want to call Replace eventually
	// This function should be called within READ transaction

	function RSHP_FindRecordClone(i_pRecordSetEngine, i_RecordType, i_FieldName, i_FieldValue)
	{
		var Record = RSHP_FindRecord(i_pRecordSetEngine, i_RecordType, i_FieldName, i_FieldValue);
		if(Record)
			return Record.Clone();
        else
			return null;
	}

	// This function returns number of records which have specified value in 
	// the specified field. If no records found 0 is returned
	// This function should be called within READ transaction

	function RSHP_GetRecordCount(i_pRecordSetEngine, i_RecordType, i_FieldName, i_FieldValue)
	{
		
		var RecordCount = 0;

		try
		{
			if(!i_pRecordSetEngine || !i_RecordType || !i_FieldName || "" == i_FieldName || !i_FieldValue)
				throw "";

			var RecordIDEnum = i_pRecordSetEngine.OpenRecordIDEnum();
			var Record;
			var RecordID;
			var Value;
			var bFound = false;

			while(RecordIDEnum.HasMore())
			{
				RecordID = RecordIDEnum.OpenNext();      –  
				Record = i_pRecordSetEngine.OpenRecord(RecordID);
				if(Record.Type != i_RecordType)
					continue;

				Value = Record.OpenField(i_FieldName);

				if(i_FieldValue == Value)
					RecordCount++;
			}
		}
		catch(error)
		{
			GrooveDebugFunctions.DisplayAssert(false, "GetRecordCount: " + error.description);
			RecordCount = 0;
		}

		return RecordCount;
	}

	// This function returns BSTR enum of all different string values in the specified field
	// The function should be called within READ transaction.

	function RSHP_FindUniqueStringFieldValues( i_pRecordSetEngine, i_RecordType, i_FieldName)
	{
		var pBSTREnumFactory = CreateBSTREnum();
		var pBSTREnum = pBSTREnumFactory.BSTREnum;
		var pRecord;
		var RecordID;
		var FieldValue;
		var bFound = false;

		var RecordIDEnum = i_pRecordSetEngine.OpenRecordIDEnum();
		while(RecordIDEnum.HasMore())
		{
			RecordID = RecordIDEnum.OpenNext();
			pRecord = i_pRecordSetEngine.OpenRecord(RecordID);
			FieldValue = pRecord.OpenFieldAsString(i_FieldName);
			if(i_RecordType == pRecord.Type)
			{ 
				pBSTREnum.Reset();
				bFound = false;
				while(pBSTREnum.HasMore())
				{
					Value = pBSTREnum.OpenNext();
					if(Value == FieldValue)
					{
						bFound = true;
						break;
					}
				}

				if(false == bFound)
					pBSTREnumFactory.Add(FieldValue);
			}
		}

		pBSTREnum.Reset();

		return pBSTREnum;
	}

	// Constructs simple XPath query string
	function RSHP_ConstructSimpleQuery(i_ItemName, i_Key)
	{
		return ("@" + i_ItemName + "='" + i_Key.toString() + "'");
	}


	//
	// This function searchs through an enum of record IDs
	// and returns a new enum containing the subset of record IDs 
	// that are of the caller specified record type.
	//
	// The caller is responisible for opening a read transaction
	//
	// Returns: IGrooveDoubleEnum
	//
	function RSHP_RecordIDEnumFindType(i_pIRecordIDEnum, 
									   i_pRecordSetEngine, 
									   i_RecordType)
	{
		var pISubsetIDEnum = CreateDoubleEnum();
		while(i_pIRecordIDEnum.HasMore())
		{
			var ID = i_pIRecordIDEnum.OpenNext();
			if(i_pRecordSetEngine.HasRecord(ID))
			{
				var Record = i_pRecordSetEngine.OpenRecord(ID);
				if(Record.Type == i_RecordType)
				{
					pISubsetIDEnum.Add(ID);
				}
			}
		}

		return pISubsetIDEnum.DoubleEnum;
	}

	//
	// This function returns true if the specified record ID
	// is in the provided enum.
	//
	// Side effects: i_pIRecordIDEnum is reset
	//
	// Returns: bool
	//
	function RSHP_ContainsID(i_pIRecordIDEnum, i_ID)
	{
		i_pIRecordIDEnum.Reset();

		while(i_pIRecordIDEnum.HasMore())
		{
			if(i_pIRecordIDEnum.OpenNext() == i_ID)
			{
				i_pIRecordIDEnum.Reset();
				return true;
			}
		}

		i_pIRecordIDEnum.Reset();
		return false;
	}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ÄSCRIPT         ÅãÄ

	var State_ViewMode = 0;
	var State_EditMode = 1;

	var EDIT_BUTTON_LABEL = "Edit";
	var EDIT_BUTTON_COMMANDURL = "Project_EditItem";
	var SAVE_BUTTON_LABEL = "OK";
	var SAVE_BUTTON_COMMANDURL = "Project_SaveChanges";
	var CANCEL_BUTTON_LABEL = "Cancel";
	var CANCEL_BUTTON_COMMANDURL = "Project_CancelChanges";
	var DELETE_BUTTON_LABEL = "Delete";

	var DEFAULT_TASK_STRING = "New Task";
	var DEFAULT_ASSIGNMENT_STRING = "Unassigned";
	var DEFAULT_STATUS_STRING = "Not Started";
	var DEFAULT_PRIORITY_STRING = "Normal";
	var DEFAULT_PRIVACY = false;

	var STR_ITEMDELETED_MESSAGE = "The selected task has been deleted from the project";
	var STR_ITEMDELETED_TITLE = "Task deleted";

	var STR_CONFIRMDELETE_MESSAGE = "Are you sure you want to delete the ";
	var STR_CONFIRMTASKDELETE_MESSAGE = "task, ";
	var STR_CONFIRMSUMMARYTASKDELETE_MESSAGE = "summary task, ";
	var STR_QUOTE = "\"";
	var STR_CONFIRMMULTIPLEDELETE_MESSAGE = " selected tasks";
	var STR_QUESTIONMARK = "?";
	var STR_CANNOTUNDO_MESSAGE = " This operation cannot be undone.";
	var STR_CONFIRMDELETE_TITLE = "Confirm Delete";
	var STR_DELETESUBTASKS_MESSAGE = " Deleting a summary task will delete all its sub-tasks.";
	var STR_SEVERALSUMMARYTASKSSELECTED_MESSAGE = " You have selected several summary tasks.";
	var STR_SUMMARYTASKSELECTED_MESSAGE = " You have a summary task selected.";

	var STR_ITEMREPLACED_MESSAGE = "The current task has been updated, saving your changes will overwrite the updates.";
	var STR_ITEMREPLACED_TITLE = "Task updated";

	var STR_UPGRADE_IE_MESSAGE = "To use the report capabilities you need to have Microsoft Internet Explorer 5.01 or later installed.";
	var STR_UPGRADE_IE_TITLE = VIEW_REPORT_TOOLTIP;

	var STR_NOPERMISSION_MESSAGE = "You do not have sufficient permissions to save this task."
	var STR_SAVETASK_TITLE = "Save Task";

	var STR_EXPORTATTACHMENT_MESSAGE = "File \"%filename\" already exits in folder \"%foldername\". Click Yes to overwrite this file with the selected attachment.";
	var STR_EXPORTATTACHMENT_TITLE = "Export Attachment";

	var STR_PROJECTNOTAVAILABLE_MESSAGE = "Microsoft Project must be installed to use this feature";
	var STR_PROJECTNOTAVAILABLE_TITLE  = "Microsoft Project Integration";

	var STR_SAVETEMPLATE_TITLE = "Save Project Template";

	var GPT_MB_SAVECHANGES = "Do you want to save your changes? Select Yes to save, No to lose any changes or Cancel to continue editing.";
	var GPT_MB_SAVEDELETEDASNEW = "The task you are editing has been deleted. Do you want to save your changes as a new item?  Select Yes to save, No to lose any changes or Cancel to continue editing.";

	//
	// Top level menu items
	//
	var PROJECT_MARK_COMPLETE_URL = "Project_MarkComplete";

	var FILE_NEW_TASK_URL = "Project_NewTask";
	var FILE_NEW_TASK_LABEL = "&Task";
	var FILE_NEW_TASK_BUTTONLABEL = "New Task";
	var FILE_NEW_TASK_TOOLTIP = "Create a new task";
	var FILE_NEW_TASK_MNEMONIC = "Ctrl+N";

	var FILE_IMPORT_MSP_URL = "Project_ImportMSProject";
	var FILE_IMPORT_MSP_LABEL = "&Import from Microsoft Project...";

	var FILE_EXPORT_CC_URL = "Project_ExportCC";
	var FILE_EXPORT_CC_LABEL = "Export to Microsoft Project...";
	var FILE_EXPORT_MSP_URL = "Project_ExportMSProject";
	var FILE_EXPORT_MSP_LABEL = "E&xport to Microsoft Project...";

	var EDIT_SELECTALL_URL = "GUIC_SelectAll";
	var EDIT_SELECTALL_LABEL = "Select &All";
	var EDIT_SELECTALL_MNEMONIC = "Ctrl+A";
	var EDIT_SELECTALL_MNEMONIC_LABEL = "Ctrl+A";

	var EDIT_DELETE_ITEM_URL = "Project_DeleteItem";
	var EDIT_DELETE_ITEM_LABEL = "&Delete";
	var EDIT_DELETE_ITEM_TOOLTIP = "Delete task";
	var EDIT_DELETE_ITEM_MNEMONIC_LABEL = "Del";

	var PROJECT_URL = "ProjectTool";
	var PROJECT_LABEL = "&Project";
	var PROJECT_MNEMONIC = "Alt+P";

	var EDIT_CUT_URL = "GUIC_Cut";
	var EDIT_CUT_LABEL = "Cu&t";
	var EDIT_CUT_TOOLTIP = "Cut";
	var EDIT_CUT_MNEMONIC = "Ctrl+X";

	var EDIT_COPY_URL = "GUIC_Copy";
	var EDIT_COPY_LABEL = "&Copy";
	var EDIT_COPY_TOOLTIP = "Copy";
	var EDIT_COPY_MNEMONIC = "Ctrl+C";

	var EDIT_PASTE_URL = "GUIC_Paste";
	var EDIT_PASTE_LABEL = "&Paste";
	var EDIT_PASTE_TOOLTIP = "Paste";
	var EDIT_PASTE_MNEMONIC = "Ctrl+V";

	var EDIT_COPYASLINK_URL = "GUIC_CopyAsLink";
	var EDIT_COPYASLINK_LABEL = "&Copy Task as Link";
	var EDIT_COPYASLINK_TOOLTIP = "Copy Task as Link";
	var EDIT_COPYASLINK_MNEMONIC = "Ctrl+L";

	var EDIT_MARKREAD_URL = "GUIC_MarkSelectedRead";
	var EDIT_MARKREAD_LABEL = "Mark &Selected Read";
	var EDIT_MARKREAD_MNEMONIC = "Ctrl+0x73";
	var EDIT_MARKREAD_MNEMONIC_LABEL = "Ctrl+F4";

	var EDIT_MARKUNREAD_URL = "GUIC_MarkSelectedUnread";
	var EDIT_MARKUNREAD_LABEL = "Mark Selected U&nread";

	var EDIT_MARKALLREAD_URL = "GUIC_MarkAllRead";
	var EDIT_MARKALLREAD_LABEL = "Mar&k All Read";
	var EDIT_MARKALLREAD_MNEMONIC = "Ctrl+Shift+0x73";
	var EDIT_MARKALLREAD_MNEMONIC_LABEL = "Ctrl+Shift+F4";

	var EDIT_MARKALLUNREAD_URL = "GUIC_MarkAllUnread";
	var EDIT_MARKALLUNREAD_LABEL = "Mark All Unr&ead";

	var VIEW_NEXTUNREAD_URL = "GUIC_NextUnread";
	var VIEW_NEXTUNREAD_LABEL = "Next &Unread";
	var VIEW_NEXTUNREAD_TOOLTIP = "Navigate Next Unread";
	var VIEW_NEXTUNREAD_MNEMONIC = "0x73";
	var VIEW_NEXTUNREAD_MNEMONIC_LABEL = "F4";

	var VIEW_PREVUNREAD_URL = "GUIC_PreviousUnread";
	var VIEW_PREVUNREAD_LABEL = "P&revious Unread";
	var VIEW_PREVUNREAD_TOOLTIP = "Navigate Previous Unread";
	var VIEW_PREVUNREAD_MNEMONIC = "Shift+0x73";
	var VIEW_PREVUNREAD_MNEMONIC_LABEL = "Shift+F4";

	var VIEW_UNREADOPTIONS_URL = "Project_UnreadOptions";
	var VIEW_UNREADOPTIONS_TOOLTIP = "Unread Options";

	var PROJECT_MOVEITEMUP_URL = "Project_MoveItemUp";
	var PROJECT_MOVEITEMUP_LABEL = "Move &up";
	var PROJECT_MOVEITEMUP_BUTTONLABEL = "Move up";
	var PROJECT_MOVEITEMUP_TOOLTIP = "Move selected task(s) up";
	var PROJECT_MOVEITEMUP_MNEMONIC = "Ctrl+U";

	var PROJECT_MOVEITEMDOWN_URL = "Project_MoveItemDown";
	var PROJECT_MOVEITEMDOWN_LABEL = "Move &down";
	var PROJECT_MOVEITEMDOWN_BUTTONLABEL = "Move down";
	var PROJECT_MOVEITEMDOWN_TOOLTIP = "Move selected task(s) down";
	var PROJECT_MOVEITEMDOWN_MNEMONIC = "Ctrl+W";

	var PROJECT_MOVEITEMIN_URL = "Project_MoveItemIn";
	var PROJECT_MOVEITEMIN_LABEL = "&Indent Task";
	var PROJECT_MOVEITEMIN_BUTTONLABEL = "Demote";
	var PROJECT_MOVEITEMIN_TOOLTIP = "Move selected task(s) right";
	var PROJECT_MOVEITEMIN_MNEMONIC = "Tab";

	var PROJECT_MOVEITEMOUT_URL = "Project_MoveItemOut";
	var PROJECT_MOVEITEMOUT_LABEL = "&Outdent Task";
	var PROJECT_MOVEITEMOUT_BUTTONLABEL = "Promote";
	var PROJECT_MOVEITEMOUT_TOOLTIP = "Move selected task(s) left";
	var PROJECT_MOVEITEMOUT_MNEMONIC = "Shift+Tab";

	var PROJECT_SAVEASTEMPLATE_URL = "Project_SaveAsTemplate";
	var PROJECT_SAVEASTEMPLATE_LABEL = "Save Project &As Template";
	var PROJECT_SAVEASTEMPLATE_MNEMONIC = "Ctrl+E";

	var VIEW_REPORT_URL = "View_Report";
	var VIEW_REPORT_LABEL = "&Report...";
	var VIEW_REPORT_TOOLTIP = "View Report";
	var VIEW_REPORT_MNEMONIC = "Ctrl+R";
	
	var PROJECT_SEPARATOR1_URL = "Separator1";
	var PROJECT_SEPARATOR2_URL = "Separator2";
	var PROJECT_SEPARATOR3_URL = "Seperator3";

	var VIEW_PARTICIPANTS_DROPDOWN_URL = "Participants_DropDown";
	var VIEW_PARTICIPANTS_DROPDOWN_TOOLTIP = "Select Participant";
	var VIEW_PARTICIPANTS_DROPDOWN_LABEL = "Participants - ";

	var VIEW_STATUS_DROPDOWN_URL = "Status_DropDown";
	var VIEW_STATUS_DROPDOWN_TOOLTIP = "Select Status";
	var VIEW_STATUS_DROPDOWN_LABEL = "Status - ";
	var VIEW_STATUS_MENU_LABEL = "&Status";

	var VIEW_STATUS_URL = "View_Staus_URL";
	var VIEW_PARTICIPANTS_URL = "View_Participants_URL";

	var DATE_STYLE = 3;

	//
	// AMLATER - Constants that we SHOULD be picking up from GrooveCommonToolCategoryStrings.gsl
	//
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_DOCUMENT_TOOL_COMMANDS = "GUICC_FileDocumentToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_NEW_TOOL_COMMANDS = "GUICC_FileNewToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_TOOL_COMMANDS = "GUICC_EditToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS = "GUICC_ViewToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_TOP_LEVEL_TOOL_COMMANDS_1 = "GUICC_TopLevelToolCommands1";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_CLIPBOARD_TOOL_COMMANDS = "GUICC_EditClipboardToolCommands";
	var STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_COPY_LINKS_TOOL_COMMANDS = "GUICC_EditCopyLinksToolCommands";


	//
	// Strings
	//
	var CONFIGURE_PROJECT_DIALOG_TITLE = "Project Wizard";
	var CONSTRAINTS_CONFIGURED_STRING = "ConstraintsConfigured";
	var GPT_CL_CALCPROGRESS = "Calculating";

	//
	// Programmatic strings that do not need localization
	//
	var PROJECTITEM_CLIPBOARDFORMAT = "ProjectTrackingItemStream";

	//
	var g_InsertedItemIDsMap = null;

	// Checked status filter menu item
	var g_StatusFilterUICommand = null;

	//
	// Acceptable values into CheckACLItem() method
	//
	var g_CAN_MOVE_UP = 1;
	var g_CAN_MOVE_DOWN = 2;
	var g_CAN_PROMOTE = 3;
	var g_CAN_DEMOTE = 4;
	var g_CAN_DELETE = 5;
	var g_CAN_CUT = 6;
	var g_CAN_EDIT = 7;
	var g_CAN_ADD_TASK = 8;


	//
	// Class ProjectViewClass
	//

	function ProjectViewClass
		(i_ContactProvider,
		 i_DataModelDelegate, 
		 i_DataViewerControl, 
		 i_ModelGlue
		)
	{
		GrooveDebugFunctions.DisplayAssert(null != i_DataModelDelegate, "Received NULL DMD");
		GrooveDebugFunctions.DisplayAssert(null != i_DataViewerControl, "Received NULL Data View");
		GrooveDebugFunctions.DisplayAssert(null != i_ModelGlue, "Received NULL Model Glue");

		//
		// class datum
		//
		this.UICommandContainer = null;
		this.GlobalCommandContainer = null;
		this.DataViewerControl = i_DataViewerControl;
		this.pIContactProvider = i_ContactProvider; 
		this.CanMoveUp = false;
		this.CanMoveDown = false;
		this.CanDelete = false;
		this.CanCreateTask = false;
		this.CanEdit = false;
		this.CanImport = false;
		this.CanCut = false;
		this.CanPromote = false;
		this.CanDemote = false;

		this.ModelGlue = i_ModelGlue;
		this.pIDataModelDelegate = i_DataModelDelegate;
		this.DetailsView = new DetailsViewClass(this.pIContactProvider, i_DataModelDelegate, this);


		// Global Command Containers
		this.FileDocumentCC = null;
		this.FileNewCC = null;
		this.EditCC = null;
		this.ViewCC = null;
		this.ProjectCC = null;
		this.EditClipboardCC = null;
		this.EditCopyLinkCC = null;
		
		//
		// application state
		// 
		this.SelectedItem = null;
		this.SelectedItemType = GrooveProjectTrackingItemType_Invalid;
		this.SelectedItemParent = null;
		this.SelectedItemParentType = GrooveProjectTrackingItemType_Invalid;
		this.CurrentMode = State_ViewMode;
		this.DataViewerInitialized = false;
		this.NavigateToItemID = -1;
		this.UINeedsACLCheck = true;
		this.ProjectID = -1;
		this.UserNotifiedOfChange = false;

		//
		// method mapping
		//

		// public
		this.ShowMenuCommands = ProjectViewClass_ShowMenuCommands;
		this.HideMenuCommands = ProjectViewClass_HideMenuCommands;
		this.ShowUICommands = ProjectViewClass_ShowUICommands;
		this.HideUICommands = ProjectViewClass_HideUICommands;
		this.OnViewContainerShow = ProjectViewClass_OnViewContainerShow;
		this.OnViewContainerHide = ProjectViewClass_OnViewContainerHide;
		this.SetGlobalCommandContainer = ProjectViewClass_SetGlobalCommandContainer;
		this.SetUICommandContainer = ProjectViewClass_SetUICommandContainer;
		this.OnCommand = ProjectViewClass_OnCommand;
		this.OnUpdateCommandState = ProjectViewClass_OnUpdateCommandState;
		this.OnItemAdded = ProjectViewClass_OnItemAdded;
		this.OnItemRemoved = ProjectViewClass_OnItemRemoved;
		this.OnEdit = ProjectViewClass_OnEdit;
		this.OnSave = ProjectViewClass_OnSave;
		this.OnCancel = ProjectViewClass_OnCancel;
		this.OnSelectAll = ProjectViewClass_OnSelectAll;
		this.OnDelete = ProjectViewClass_OnDelete;
		this.OnItemReplaced = ProjectViewClass_OnItemReplaced;
		this.OnListSelectionChanged = ProjectViewClass_OnListSelectionChanged;
		this.OnListViewDoubleClick = ProjectViewClass_OnListViewDoubleClick;
		this.OnListInitialize = ProjectViewClass_OnListInitialize;
		this.OnTranslateAccelerator = ProjectViewClass_OnTranslateAccelerator;
		this.OnMoveItemUp = ProjectViewClass_OnMoveItemUp;
		this.OnMoveItemDown = ProjectViewClass_OnMoveItemDown;
		this.OnMoveItemIn = ProjectViewClass_OnMoveItemIn;
		this.OnMoveItemOut= ProjectViewClass_OnMoveItemOut;
		this.OnPersonsAdded = ProjectViewClass_OnPersonsAdded;
		this.OnPersonsRemoved = ProjectViewClass_OnPersonsRemoved;
		this.OnPersonsChanged = ProjectViewClass_OnPersonsChanged;
		this.OnViewReport = ProjectViewClass_OnViewReport;
		this.OnSaveTemplate = ProjectViewClass_OnSaveTemplate;
		this.GetItemURL = ProjectViewClass_GetItemURL;
		this.ShowItem = ProjectViewClass_ShowItem;
		this.ShowWaitCursor = ProjectViewClass_ShowWaitCursor;
		this.OnTimerNavigateToItem = ProjectViewClass_OnTimerNavigateToItem;
		this.OnTimerItemReplaced = ProjectViewClass_OnTimerItemReplaced;
		this.OnTimerShowConfigDialog = ProjectViewClass_OnTimerShowConfigDialog;
		this.OnRoleChanged = ProjectViewClass_OnRoleChanged;
		this.OnCopyAsLink = ProjectViewClass_OnCopyAsLink;
		this.OnCopy = ProjectViewClass_OnCopy;
		this.OnPaste = ProjectViewClass_OnPaste;
		this.OnCut = ProjectViewClass_OnCut;
		this.OnUnreadTimer = ProjectViewClass_OnUnreadTimer;
		this.OnMarkComplete = ProjectViewClass_OnMarkComplete;
		this.GenerateReport = ProjectViewClass_GenerateReport;
		this.InsertItemWithParents = ProjectViewClass_InsertItemWithParents;
		this.AddSingleItemToXMLDoc = ProjectViewClass_AddSingleItemToXMLDoc;
		this.GetItemFromID = ProjectViewClass_GetItemFromID;
		this.OnCalculationStart = ProjectViewClass_OnCalculationStart;
		this.OnCalculationUpdate = ProjectViewClass_OnCalculationUpdate;
		this.OnCalculationEnd = ProjectViewClass_OnCalculationEnd;


		// internal use only
		this.SetSelectedItem = ProjectViewClass_SetSelectedItem;
		this.RefreshSelectedItem = ProjectViewClass_RefreshSelectedItem;
		this.NotifyUserOfItemRemoval = ProjectViewClass_NotifyUserOfItemRemoval;
		this.OnAddItem = ProjectViewClass_OnAddItem;
		this.EnterViewMode = ProjectViewClass_EnterViewMode;
		this.EnterEditMode = ProjectViewClass_EnterEditMode;
		this.GetItem = ProjectViewClass_GetItem;
		this.GetSelectedItem = ProjectViewClass_GetSelectedItem;
		this.GetSelectedItemType = ProjectViewClass_GetSelectedItemType;
		this.GetSelectedItemParent = ProjectViewClass_GetSelectedItemParent;
		this.GetSelectedItemParentType = ProjectViewClass_GetSelectedItemParentType;
		this.ShowConfigDialog = ProjectViewClass_ShowConfigDialog;
		this.NotifyUserOfItemChange = ProjectViewClass_NotifyUserOfItemChange;
		this.OnImportFromMSProject = ProjectViewClass_OnImportFromMSProject;
		this.OnExportToMSProject = ProjectViewClass_OnExportToMSProject;
		this.MarkSelectedRead = ProjectViewClass_MarkSelectedRead;
		this.MarkAllRead = ProjectViewClass_MarkAllRead;
		this.NavigatePrevUnread = ProjectViewClass_NavigatePrevUnread;
		this.NavigateNextUnread = ProjectViewClass_NavigateNextUnread;
		this.NavigateToDocument = ProjectViewClass_NavigateToDocument;
		this.RefreshACLCache = ProjectViewClass_RefreshACLCache;
		this.CheckACLItem = ProjectViewClass_CheckACLItem;
		this.GetSelectionEnum = ProjectViewClass_GetSelectionEnum;
		this.GetReversedSelectionEnum = ProjectViewClass_GetReversedSelectionEnum;
		this.GetClipboard = ProjectViewClass_GetClipboard;
		this.IsProjectInEnum = ProjectViewClass_IsProjectInEnum;
		this.Save = ProjectViewClass_Save;
		this.SaveExisting = ProjectViewClass_SaveExisting;
		this.SaveNewTask = ProjectViewClass_SaveNewTask;
		this.ReplaceExistingItem = ProjectViewClass_ReplaceExistingItem;
		this.SaveNewAttachments = ProjectViewClass_SaveNewAttachments;
		this.DeleteRemovedAttachments = ProjectViewClass_DeleteRemovedAttachments;
		this.PromptUserToSaveChanges = ProjectViewClass_PromptUserToSaveChanges;
		this.PromptUserToSaveDeletedAsNew = ProjectViewClass_PromptUserToSaveDeletedAsNew;
		this.UpdateParticipantsUICommands = ProjectViewClass_UpdateParticipantsUICommands;
		this.RemovePredecessors = ProjectViewClass_RemovePredecessors;
		this.AddPredecessors = ProjectViewClass_AddPredecessors;
		this.RedrawDataViewer = ProjectViewClass_RedrawDataViewer;
		this.MarkCurrentComplete = ProjectViewClass_MarkCurrentComplete;
		this.ExportAttachments = ProjectViewClass_ExportAttachments;
		this.ProcessExportTransaction = ProjectViewClass_ProcessExportTransaction;
		this.GetProgressInterface = ProjectViewClass_GetProgressInterface;
		this.SerializeToolTemplate = ProjectViewClass_SerializeToolTemplate;
		this.IsFilterOn = ProjectViewClass_IsFilterOn;
		this.ToggleUnreadMarks = ProjectViewClass_ToggleUnreadMarks;
		this.AddItemsToXMLFromCollection = ProjectViewClass_AddItemsToXMLFromCollection;

		// 
		// initialize data
		//
		var Project;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			// get project
			Project = this.pIDataModelDelegate.GetProject();
		
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			// AM - Cannot display dialog box yet because we don't have a window
			GrooveDebugFunctions.DisplayAssert(0, GPTPROJECT_MB_FAILURE_INITIALIZE);
			// PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_INITIALIZE);
			return;
		}

		GrooveDebugFunctions.DisplayAssert(null != Project, "Missing Project");
		
		// 
		// initialize UI
		//		

		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			// contstrain the record types that DataViewer will display
			// --this should only be done once per device.  Note that
			// adding constraints does not effect existing records in the
			// indexes, so we need to rebuild them
			if(!PropertyList.PropertyExists("CONSTRAINTS_CONFIGURED_STRING"))
			{
				Collection.OpenCollection().CollectionConfigure.AddSortConstraint("ByName", "urn:groove.net:ProjectProjectRecord");
				Collection.OpenCollection().CollectionConfigure.AddSortConstraint("ByName", "urn:groove.net:ProjectTaskRecord");
				Collection.OpenCollection().CollectionConfigure.AddSortConstraint("ByOrdinal", "urn:groove.net:ProjectProjectRecord");
				Collection.OpenCollection().CollectionConfigure.AddSortConstraint("ByOrdinal", "urn:groove.net:ProjectTaskRecord");
				RecordSetEngine.RecordSetEngineAdvanced.RebuildIndexes();

				PropertyList.SetProperty("CONSTRAINTS_CONFIGURED_STRING", "1", GroovePropertyFlag_Private);
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			// AM - Cannot display dialog box yet because we don't have a window
			GrooveDebugFunctions.DisplayAssert(0, GPTPROJECT_MB_FAILURE_INITIALIZE);
			// PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_INITIALIZE);
			return;
		}

		// remember the ID of the Project item for efficiency
		this.ProjectID = Project.ID;

		// initialize buttons
		MoveUpButton.Label = PROJECT_MOVEITEMUP_BUTTONLABEL;
		MoveUpButton.ToolTip = PROJECT_MOVEITEMUP_TOOLTIP;
		MoveDownButton.Label = PROJECT_MOVEITEMDOWN_BUTTONLABEL;
		MoveDownButton.ToolTip = PROJECT_MOVEITEMDOWN_TOOLTIP;
		IndentButton.Label = PROJECT_MOVEITEMIN_BUTTONLABEL;
		IndentButton.ToolTip = PROJECT_MOVEITEMIN_TOOLTIP;
		OutdentButton.Label = PROJECT_MOVEITEMOUT_BUTTONLABEL;
		OutdentButton.ToolTip = PROJECT_MOVEITEMOUT_TOOLTIP;

		// set the top level "project" item as the selected item in the UI
		this.SetSelectedItem(Project, GrooveProjectTrackingItemType_Project, null, GrooveProjectTrackingItemType_Invalid);
		this.RefreshSelectedItem();

		// go into view mode
		this.EnterViewMode();

		PropertyList.SetPropertyAsString("ParticipantSelectionText", "", GroovePropertyFlag_Private);
		PropertyList.SetPropertyAsString("ParticipantSelectionData", "", GroovePropertyFlag_Private);
		PropertyList.SetPropertyAsString("StatusSelectionText", "", GroovePropertyFlag_Private);
		PropertyList.SetPropertyAsString("StatusSelectionData", "", GroovePropertyFlag_Private);
	}


	//
	// Set the selected item
	//
	function ProjectViewClass_SetSelectedItem(i_Item, i_ItemType, i_ParentItem, i_ParentItemType)
	{
		GrooveDebugFunctions.DisplayAssert(i_Item != null, "Selected task is null");

		// multiple items selected?
		var SelectionIDEnum = this.GetSelectionEnum();
		var AreMultipleItemsSelected = false;
		if(SelectionIDEnum && SelectionIDEnum.HasMore())
		{
			SelectionIDEnum.OpenNext();
			if(SelectionIDEnum.HasMore())
			{
				AreMultipleItemsSelected = true;
			}
		}

		// remember to check access control when updatng the UI
		if(null == this.SelectedItem || 
		   true == AreMultipleItemsSelected || 
		   (null != i_Item && null != this.SelectedItem && i_Item.ID != this.SelectedItem.ID))
		{
			this.UINeedsACLCheck = true;
		}

		this.SelectedItem = i_Item;
		this.SelectedItemType = i_ItemType;
		this.SelectedItemParent = i_ParentItem;
		this.SelectedItemParentType = i_ParentItemType;

		// stop unread timer when item changes
		UnreadTimer.Stop();

		// kick off timer to mark it read
		if(null != i_Item && false == i_Item.IsRead && State_ViewMode == this.CurrentMode)
		{
			UnreadTimer.Start();
		}
	}


	//
	// Return the selected item
	//
	function ProjectViewClass_GetSelectedItem()
	{
		GrooveDebugFunctions.DisplayAssert(this.SelectedItem != null, "Selected task is null");
		return this.SelectedItem;
	}


	//
	// Return the selected item type
	//
	function ProjectViewClass_GetSelectedItemType()
	{
		return this.SelectedItemType;
	}

	//
	// Return the selected item's Parent
	//
	function ProjectViewClass_GetSelectedItemParent()
	{
		GrooveDebugFunctions.DisplayAssert(this.SelectedItem != null, "Selected task's parent is null");
		return this.SelectedItemParent;
	}

	//
	// Return the selected item's Parent
	//
	function ProjectViewClass_GetSelectedItemParentType()
	{
		return this.SelectedItemParentType;
	}


	//
	// Update the UI with the current selected item
	//
	function ProjectViewClass_RefreshSelectedItem()
	{
		switch(this.GetSelectedItemType())
		{
			case GrooveProjectTrackingItemType_Project:
			{
				this.DetailsView.ShowProject(this.GetSelectedItem());
				break;
			}
			case GrooveProjectTrackingItemType_Task:
			{
				this.DetailsView.ShowTask(this.GetSelectedItem(), this.GetSelectedItemParent());
				break;
			}
			default:
			{
				GrooveDebugFunctions.DisplayAssert(0, "Invalid type");
				break;
			}
		}
	}


	function ProjectViewClass_OnViewContainerShow()
	{
		// hide the progress indicator
		ProgressText.Visible = false;
		ProgressText.Enabled = false;
		ProgressText.Redraw();

		var ShowConfiguDialog = false;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			var pIProject = this.pIDataModelDelegate.GetProject();

			// if the project has not yet been configured and the user
			// has permission to update it, show them the configuration dialog
			if(false == g_pIDataModelDelegate.ProjectConfigured() &&
			   true == g_pIDataModelDelegate.CanReplaceItem(pIProject.ID))
			{
				ShowConfiguDialog = true;
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, "Error getting project item");
		}

		if(ShowConfiguDialog)
		{
			// AMLATER -hack to work around platform issue: we cannot display
			// modal dialogs in response to an async engine event :(
			ConfigDialogHackTimer.Stop();
			ConfigDialogHackTimer.Start();
		}

		// restart the unread timer
		if(State_ViewMode == this.CurrentMode)
		{
			// stop unread timer when item changes
			UnreadTimer.Stop();
			UnreadTimer.Start();
		}
	}


	function ProjectViewClass_OnViewContainerHide()
	{
		// Stop all of our timers
		// AM  - don't stop the item replaced timer so that we continue
		//       to inform the user of changes when the navigate out of 
		//       the tool in edit mode
		UnreadTimer.Stop();
		NavigationHackTimer.Stop();
		ConfigDialogHackTimer.Stop();
	}


	//
	// switch into edit mode, swapping UI labels
	//	
	function ProjectViewClass_EnterEditMode()
	{
		// set the state
		this.CurrentMode = State_EditMode;

		// clear notifcation flag
		this.UserNotifiedOfChange = false;
	}


	//
	// switch into view mode, swapping UI labels
	//	
	function ProjectViewClass_EnterViewMode()
	{
		// set the state
		this.CurrentMode = State_ViewMode;
	}


	//
	// Helper to get the item of the requested type
	// caller is responsible for the transaction
	function ProjectViewClass_GetItem(i_ID, i_ItemType)
	{
		switch(i_ItemType)
		{
			case GrooveProjectTrackingItemType_Project:	
			{
				return  this.pIDataModelDelegate.GetProject();
			}
			case GrooveProjectTrackingItemType_Task:
			{
				return this.pIDataModelDelegate.GetTask(i_ID);
			}
			default:
			{
				GrooveDebugFunctions.DisplayAssert(0, "Invalid item type");
				return null;
			}
		}
	}

	
	//
	// cache the menu bar
	//
	function ProjectViewClass_SetGlobalCommandContainer(i_GlobalCommandContainer)
	{
		if (null != i_GlobalCommandContainer)
			this.GlobalCommandContainer = i_GlobalCommandContainer.UICommandContainer2;
		else
			this.GlobalCommandContainer = null;
	}

	//
	// cache the icon bar
	//
	function ProjectViewClass_SetUICommandContainer(i_UICommandContainer)
	{
		this.UICommandContainer = i_UICommandContainer;
	}

	//
	// Display our menu commands
	//
	function ProjectViewClass_ShowMenuCommands()
	{
		// Get icon info
		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		// File command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_DOCUMENT_TOOL_COMMANDS))
		{
			this.FileDocumentCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_DOCUMENT_TOOL_COMMANDS);
		}

		if(null != this.FileDocumentCC)
		{
			var UICommand = null;

			this.FileDocumentCC.InsertSeparator(PROJECT_SEPARATOR1_URL, this.FileDocumentCC.GetNumberOfUICommands());

			// Save as template
			UICommand = this.FileDocumentCC.InsertUICommand(PROJECT_SAVEASTEMPLATE_URL, this.FileDocumentCC.GetNumberOfUICommands());
			UICommand.Label = PROJECT_SAVEASTEMPLATE_LABEL + "\t" + PROJECT_SAVEASTEMPLATE_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = PROJECT_SAVEASTEMPLATE_MNEMONIC;

			this.FileDocumentCC.InsertSeparator(PROJECT_SEPARATOR1_URL, this.FileDocumentCC.GetNumberOfUICommands());

			// import from MS Project
			UICommand = this.FileDocumentCC.InsertUICommand(FILE_IMPORT_MSP_URL, this.FileDocumentCC.GetNumberOfUICommands());
			UICommand.Label = FILE_IMPORT_MSP_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			UICommand = this.FileDocumentCC.InsertUICommand(FILE_EXPORT_MSP_URL, this.FileDocumentCC.GetNumberOfUICommands());
			UICommand.Label = FILE_EXPORT_MSP_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}

		// File->New command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_NEW_TOOL_COMMANDS))
		{
			this.FileNewCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_NEW_TOOL_COMMANDS);
		}

		if(null != this.FileNewCC)
		{
			var UICommand = null;
			
			// New Task menu item
			UICommand = this.FileNewCC.InsertUICommand(FILE_NEW_TASK_URL, this.FileNewCC.GetNumberOfUICommands());
			UICommand.Label = FILE_NEW_TASK_LABEL + "\t" + FILE_NEW_TASK_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = FILE_NEW_TASK_MNEMONIC;
		}

		// Clipboard commands command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_CLIPBOARD_TOOL_COMMANDS))
		{
			this.EditClipboardCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_CLIPBOARD_TOOL_COMMANDS);
		}


		// Copy links command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_COPY_LINKS_TOOL_COMMANDS))
		{
			this.EditCopyLinkCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_COPY_LINKS_TOOL_COMMANDS);
		}

			
		// Edit command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_TOOL_COMMANDS))
		{
			this.EditCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_TOOL_COMMANDS);
		}

		// View command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS))
		{
			this.ViewCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS);
		}

		if(null != this.ViewCC)
		{
			var UICommand = null;

			// Unread navigation
			var IconFileURL = MHF_GetIconFileURL();
			var IconMaskFileURL = MHF_GetIconMaskFileURL();
			var IconWidth = MHF_GetIconWidth();
			var IconHeight = MHF_GetIconHeight();

			// Insert Status Filters menu
			g_StatusFilterUICommand = InsertStatusFilterIntoUICommandContainer(this.ViewCC);

			this.ViewCC.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR1_URL, this.ViewCC.GetNumberOfUICommands());

			// Report menu item
			UICommand = this.ViewCC.InsertUICommand(VIEW_REPORT_URL, this.ViewCC.GetNumberOfUICommands());
			UICommand.Label = VIEW_REPORT_LABEL + "\t" + VIEW_REPORT_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = VIEW_REPORT_MNEMONIC;
		}
	}

	function InsertStatusFilterIntoUICommandContainer(i_CommandContainer)
	{
		// Insert the status filter menu
		var pIUICommandContainer = i_CommandContainer.InsertUICommandContainer(VIEW_STATUS_URL,
																			   i_CommandContainer.GetNumberOfUICommands());
		pIUICommandContainer.UICommand.Label = VIEW_STATUS_MENU_LABEL;
		pIUICommandContainer.UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

		// Insert the status filter menu items
		var index = 0;
		var pDefaultSelection;
		var pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_S_STATUS_ALL, index++);
		pIUICommand.Label = GPT_S_STATUS_ALL;
		pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		pIUICommand.UserData = GPT_S_STATUS_ALL;
		pIUICommand.CheckState = GrooveCheckState_Checked;
		pDefaultSelection = pIUICommand;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_S_STATUS_NOTSTARTED, index++);
		pIUICommand.Label = GPT_S_STATUS_NOTSTARTED;
		pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		pIUICommand.UserData = GPT_S_STATUS_NOTSTARTED;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_S_STATUS_INPROGRESS, index++);
		pIUICommand.Label = GPT_S_STATUS_INPROGRESS;
		pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		pIUICommand.UserData = GPT_S_STATUS_INPROGRESS;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_S_STATUS_COMPLETE, index++);
		pIUICommand.Label = GPT_S_STATUS_COMPLETE;
		pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		pIUICommand.UserData = GPT_S_STATUS_COMPLETE;

		return pDefaultSelection;
	}


	//
	// Hide our menu commands
	// 
	function ProjectViewClass_HideMenuCommands()
	{
		if(null != this.FileDocumentCC)
		{
			this.FileDocumentCC.RemoveSeparator(PROJECT_SEPARATOR1_URL);
			this.FileDocumentCC.RemoveUICommand(PROJECT_SAVEASTEMPLATE_URL);
			this.FileDocumentCC.RemoveSeparator(PROJECT_SEPARATOR1_URL);
			this.FileDocumentCC.RemoveUICommand(FILE_IMPORT_MSP_URL);
			this.FileDocumentCC.RemoveUICommand(FILE_EXPORT_MSP_URL);
			this.FileDocumentCC = null;
		}

		if(null != this.FileNewCC)
		{
			this.FileNewCC.RemoveUICommand(FILE_NEW_TASK_URL);
			this.FileNewCC = null;
		}

		if(null != this.EditClipboardCC)
		{
			this.EditClipboardCC = null;
		}

		if(null != this.EditCopyLinkCC)
		{
			this.EditCopyLinkCC = null;
		}

		if(null != this.EditCC)
		{
			this.EditCC = null;
		}

		if(null != this.ViewCC)
		{
			this.ViewCC.RemoveUICommandContainer(VIEW_STATUS_URL);
			this.ViewCC.RemoveUICommand(VIEW_REPORT_URL);
			this.ViewCC = null;
		}
	}

	function ProjectViewClass_ShowUICommands()
	{
		var Pos = this.UICommandContainer.GetNumberOfUICommands();
		var pIUICommand;

		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		pIUICommand = this.UICommandContainer.InsertUICommand(FILE_NEW_TASK_URL, Pos++);
		pIUICommand.UICommand.ToolTip= FILE_NEW_TASK_TOOLTIP + " (" + FILE_NEW_TASK_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_ADDITEM_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);
		pIUICommand.UICommand.Label = FILE_NEW_TASK_BUTTONLABEL;

		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR1_URL, Pos++);

		// clipboard functions
		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_CUT_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_CUT_TOOLTIP + " (" + EDIT_CUT_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_CUT_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_COPY_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_COPY_TOOLTIP + " (" + EDIT_COPY_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_COPY_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_COPYASLINK_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_COPYASLINK_TOOLTIP + " (" + EDIT_COPYASLINK_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_COPYASLINK_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_PASTE_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_PASTE_TOOLTIP + " (" + EDIT_PASTE_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_PASTE_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_DELETE_ITEM_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_DELETE_ITEM_TOOLTIP + " (" + EDIT_DELETE_ITEM_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_DELETE_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		// read/unread functions
		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR2_URL, Pos++);

		pIUICommand = this.UICommandContainer.InsertUICommand(VIEW_PREVUNREAD_URL, Pos++);
		pIUICommand.UICommand.ToolTip= VIEW_PREVUNREAD_TOOLTIP + " (" + VIEW_PREVUNREAD_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_PREVUNREAD_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(VIEW_NEXTUNREAD_URL, Pos++);
		pIUICommand.UICommand.ToolTip= VIEW_NEXTUNREAD_TOOLTIP + " (" + VIEW_NEXTUNREAD_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_NEXTUNREAD_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		// unread command container
		// AMLATER - GET ICON 
		var pIUICommandContainer = this.UICommandContainer.InsertUICommandContainer(VIEW_UNREADOPTIONS_URL, Pos++);
		pIUICommandContainer.UICommand.ToolTip= VIEW_UNREADOPTIONS_TOOLTIP;
		pIUICommandContainer.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_UNREADFOLDER_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(EDIT_MARKREAD_URL, pIUICommandContainer.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = EDIT_MARKREAD_LABEL + "\t" + EDIT_MARKREAD_MNEMONIC_LABEL;
		pIUICommand.Mnemonic = EDIT_MARKREAD_MNEMONIC;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(EDIT_MARKUNREAD_URL, pIUICommandContainer.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = EDIT_MARKUNREAD_LABEL;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(EDIT_MARKALLREAD_URL, pIUICommandContainer.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = EDIT_MARKALLREAD_LABEL + "\t" + EDIT_MARKALLREAD_MNEMONIC_LABEL;
		pIUICommand.Mnemonic = EDIT_MARKALLREAD_MNEMONIC;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(EDIT_MARKALLUNREAD_URL, pIUICommandContainer.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = EDIT_MARKALLUNREAD_LABEL;

		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR2_URL, Pos++);

		g_UIProjectParticipantsCC = this.UICommandContainer.InsertUICommandContainer(VIEW_PARTICIPANTS_DROPDOWN_URL, Pos++);
		g_UIProjectParticipantsCC.UICommand.ToolTip= VIEW_PARTICIPANTS_DROPDOWN_TOOLTIP;
		g_UIProjectParticipantsCC.UICommand.Label = VIEW_PARTICIPANTS_DROPDOWN_LABEL + GPT_S_STATUS_ALL;
		g_UIProjectParticipantsCC.UICommand.UserData = GPT_S_STATUS_ALL;

		if(PropertyList.PropertyExists("ParticipantSelectionText") && PropertyList.PropertyExists("ParticipantSelectionData"))
		{
			var ParticipantText = PropertyList.OpenPropertyAsString("ParticipantSelectionText");
			var ParticipantData = PropertyList.OpenPropertyAsString("ParticipantSelectionData");
			if(ParticipantText != "" && ParticipantData != "")
			{
				g_UIProjectParticipantsCC.UICommand.Label = ParticipantText;
				g_UIProjectParticipantsCC.UICommand.UserData = ParticipantData;
			}
		}
		
		this.UpdateParticipantsUICommands();

		g_UIProjectStatusCC = this.UICommandContainer.InsertUICommandContainer(VIEW_STATUS_DROPDOWN_URL, Pos++);
		g_UIProjectStatusCC.UICommand.ToolTip= VIEW_STATUS_DROPDOWN_TOOLTIP;
		g_UIProjectStatusCC.UICommand.Label = VIEW_STATUS_DROPDOWN_LABEL + GPT_S_STATUS_ALL;
		g_UIProjectStatusCC.UICommand.UserData = GPT_S_STATUS_ALL;

		if(PropertyList.PropertyExists("StatusSelectionText") && PropertyList.PropertyExists("StatusSelectionData"))
		{
			var StatusText = PropertyList.OpenPropertyAsString("StatusSelectionText");
			var StatusData = PropertyList.OpenPropertyAsString("StatusSelectionData");
			if(StatusText != "" && StatusData != "")
			{
				g_UIProjectStatusCC.UICommand.Label = StatusText;
				g_UIProjectStatusCC.UICommand.UserData = StatusData;
			}
		}

		pIUICommand = g_UIProjectStatusCC.UICommandContainer.InsertUICommand(VIEW_STATUS_URL, g_UIProjectStatusCC.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = GPT_S_STATUS_ALL;
		pIUICommand.UserData = GPT_S_STATUS_ALL;

		pIUICommand = g_UIProjectStatusCC.UICommandContainer.InsertUICommand(VIEW_STATUS_URL, g_UIProjectStatusCC.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = GPT_S_STATUS_NOTSTARTED;
		pIUICommand.UserData = GPT_S_STATUS_NOTSTARTED;

		pIUICommand = g_UIProjectStatusCC.UICommandContainer.InsertUICommand(VIEW_STATUS_URL, g_UIProjectStatusCC.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = GPT_S_STATUS_INPROGRESS;
		pIUICommand.UserData = GPT_S_STATUS_INPROGRESS;

		pIUICommand = g_UIProjectStatusCC.UICommandContainer.InsertUICommand(VIEW_STATUS_URL, g_UIProjectStatusCC.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = GPT_S_STATUS_COMPLETE;
		pIUICommand.UserData = GPT_S_STATUS_COMPLETE;

		// views
		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR3_URL, Pos++);

		pIUICommand = this.UICommandContainer.InsertUICommand(VIEW_REPORT_URL, Pos++);
		pIUICommand.UICommand.ToolTip = VIEW_REPORT_TOOLTIP + " (" + VIEW_REPORT_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_REPORT_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);
	}

	function ProjectViewClass_HideUICommands()
	{
		if(this.UICommandContainer.UICommandExists(FILE_NEW_TASK_URL))
		{
			this.UICommandContainer.RemoveUICommand(FILE_NEW_TASK_URL);
		}

		if(this.UICommandContainer.UICommandExists(EDIT_SELECTALL_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_SELECTALL_URL);
		}

		// clipboard functions
		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR1_URL);

		if(this.UICommandContainer.UICommandExists(EDIT_CUT_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_CUT_URL);
		}

		if(this.UICommandContainer.UICommandExists(EDIT_COPY_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_COPY_URL);
		}

		if(this.UICommandContainer.UICommandExists(EDIT_COPYASLINK_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_COPYASLINK_URL);
		}

		if(this.UICommandContainer.UICommandExists(EDIT_PASTE_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_PASTE_URL);
		}

		if(this.UICommandContainer.UICommandExists(EDIT_DELETE_ITEM_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_DELETE_ITEM_URL);
		}

		// unread functions
		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR2_URL);

		if(this.UICommandContainer.UICommandExists(VIEW_PREVUNREAD_URL))
		{
			this.UICommandContainer.RemoveUICommand(VIEW_PREVUNREAD_URL);
		}

		if(this.UICommandContainer.UICommandExists(VIEW_NEXTUNREAD_URL))
		{
			this.UICommandContainer.RemoveUICommand(VIEW_NEXTUNREAD_URL);
		}

		if(this.UICommandContainer.UICommandContainerExists(VIEW_UNREADOPTIONS_URL))
		{
			this.UICommandContainer.RemoveUICommandContainer(VIEW_UNREADOPTIONS_URL);
		}

		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR2_URL);

		if(this.UICommandContainer.UICommandContainerExists(VIEW_PARTICIPANTS_DROPDOWN_URL))
		{
			this.UICommandContainer.RemoveUICommandContainer(VIEW_PARTICIPANTS_DROPDOWN_URL);
		}

		if(this.UICommandContainer.UICommandContainerExists(VIEW_STATUS_DROPDOWN_URL))
		{
			this.UICommandContainer.RemoveUICommandContainer(VIEW_STATUS_DROPDOWN_URL);
		}

		// views
		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR3_URL);

		if(this.UICommandContainer.UICommandExists(VIEW_REPORT_URL))
		{
			this.UICommandContainer.RemoveUICommand(VIEW_REPORT_URL);
		}
	}


	function ProjectViewClass_OnTranslateAccelerator(i_Msg, i_KeyCode, i_KeyState, i_KeyModifiers)
	{
		if(State_ViewMode == this.CurrentMode)
		{
			if(GROOVE_WM_KEYDOWN == i_Msg && GROOVE_VK_DELETE == i_KeyCode)
			{
				if (this.CanDelete && (this.CanDelete = this.CheckACLItem(g_CAN_DELETE)))
				{
					this.OnDelete();
				}

				return true;
			}
			// Toggle unread marks when the insert key is pressed.
			else if(i_Msg == 0x100 && i_KeyCode == 0x2D)
			{
				this.ToggleUnreadMarks();
				return true;
			}
			// Handle select all (ctrl+a)
			else if(i_Msg == 0x100 && i_KeyCode == 0x41 && i_KeyModifiers == GROOVE_KEYMOD_CONTROL)
			{
				this.OnSelectAll();
			}
		}
		else if(State_EditMode == this.CurrentMode)
		{
			if(GROOVE_WM_KEYDOWN == i_Msg && GROOVE_VK_ESC == i_KeyCode)
			{
				this.OnCancel();
				return true;
			}
			else if(GROOVE_WM_KEYDOWN == i_Msg && (i_KeyModifiers & GROOVE_KEYMOD_CONTROL) && GROOVE_VK_S == i_KeyCode)
			{
				this.OnSave();
				return true;
			}
			// Put the current time in the minutes if the user presses CTRL-T.  Only do it on Keydown message.
			else if(i_Msg == 0x100 && i_KeyCode == 0x54 && i_KeyModifiers == GROOVE_KEYMOD_CONTROL)
			{
				this.DetailsView.RTFInsertTime();
			}
		}

		return false;
	}

	//
	// Handle UI command
	//
	function ProjectViewClass_OnCommand(i_UICommand)
	{
		// dispatch to handling routine
		if(FILE_NEW_TASK_URL == i_UICommand.CommandURL)
		{
			// Check if we can add a task
			if (this.CanAddTask && (this.CanAddTask = this.CheckACLItem(g_CAN_ADD_TASK)))
			{
				this.OnAddItem(i_UICommand);
			}
		}
		else if (SAVE_BUTTON_COMMANDURL == i_UICommand.CommandURL)
		{
			// Save the task.
			this.OnSave();
		}
		else if(CANCEL_BUTTON_COMMANDURL == i_UICommand.CommandURL)
		{
			this.OnCancel();
		}
		else if(EDIT_BUTTON_COMMANDURL == i_UICommand.CommandURL)
		{
			// Check if we can edit the task
			if (this.CanEdit && (this.CanEdit = this.CheckACLItem(g_CAN_EDIT)))
			{
				this.OnEdit();
			}
		}
		else if (EDIT_SELECTALL_URL == i_UICommand.CommandURL)
		{
			this.OnSelectAll();
		}
		else if (EDIT_DELETE_ITEM_URL == i_UICommand.CommandURL)
		{
			// Check if we can delete the task
			if (this.CanDelete && (this.CanDelete = this.CheckACLItem(g_CAN_DELETE)))
			{		
				this.OnDelete();
			}
		}
		else if (PROJECT_MOVEITEMUP_URL == i_UICommand.CommandURL)
		{
			// Check if we can move task up
			if (this.CanMoveUp && (this.CanMoveUp = this.CheckACLItem(g_CAN_MOVE_UP)))
			{		
				// Move task up
				this.OnMoveItemUp();
			}
		}
		else if (PROJECT_MOVEITEMDOWN_URL == i_UICommand.CommandURL)
		{
			// Check if we can move task down
			if (this.CanMoveDown && (this.CanMoveDown = this.CheckACLItem(g_CAN_MOVE_DOWN)))
			{		
				// Move task down
				this.OnMoveItemDown();
			}
		}
		else if(PROJECT_SAVEASTEMPLATE_URL == i_UICommand.CommandURL)
		{
			this.OnSaveTemplate();
		}
		else if(FILE_IMPORT_MSP_URL == i_UICommand.CommandURL)
		{
			this.OnImportFromMSProject();
		}
		else if(FILE_EXPORT_MSP_URL == i_UICommand.CommandURL)
		{
			this.OnExportToMSProject();
		}
		else if(EDIT_MARKREAD_URL == i_UICommand.CommandURL)
		{
			this.MarkSelectedRead(true);
		}
		else if(EDIT_MARKUNREAD_URL == i_UICommand.CommandURL)
		{
			this.MarkSelectedRead(false);
		}
		else if(EDIT_MARKALLREAD_URL == i_UICommand.CommandURL)
		{
			this.MarkAllRead(true);
		}
		else if(EDIT_MARKALLUNREAD_URL == i_UICommand.CommandURL)
		{
			this.MarkAllRead(false);
		}
		else if(EDIT_COPYASLINK_URL == i_UICommand.CommandURL)
		{
			if(State_ViewMode == this.CurrentMode)
			{
				this.OnCopyAsLink();
			}
		}
		else if(EDIT_COPY_URL == i_UICommand.CommandURL)
		{
			// copy text if we can
			if(this.DetailsView.CanCopyToClipboard())
			{
				this.DetailsView.CopyToClipboard()
			}
			else // otherwise, copy selected tasks(s) when in view mode
			{
				if(State_ViewMode == this.CurrentMode)
				{
					this.OnCopy();
				}
			}
		}
		else if(EDIT_PASTE_URL == i_UICommand.CommandURL)
		{
			// paste tasks when in view mode
			if(State_ViewMode == this.CurrentMode)
			{
				this.OnPaste();
			}
			else // paste text when in edit mode
			{
				if(this.DetailsView.CanPasteFromClipboard())
				{
					this.DetailsView.PasteFromClipboard();
				}
			}
		}
		else if(EDIT_CUT_URL == i_UICommand.CommandURL)
		{
			// cut tasks we're in view mode
			if(State_ViewMode == this.CurrentMode)
			{
				if (this.CanCut && (this.CanCut = this.CheckACLItem(g_CAN_CUT)))
				{
					this.OnCut();
				}
			}
			else // cut text when in edit mode
			{
				if(this.DetailsView.CanCutToClipboard())
				{
					this.DetailsView.CutToClipboard();
				}
			}
		}
		else if(PROJECT_MOVEITEMIN_URL == i_UICommand.CommandURL)
		{
			// Check if we can demote the item
			if (this.CanDemote && (this.CanDemote = this.CheckACLItem(g_CAN_DEMOTE)))
			{		
				// This take a bit of time so let's show a wait cursor
				this.ShowWaitCursor(true);
			
				// Demote the task
				this.OnMoveItemIn();

				// Remove wait cursor
				this.ShowWaitCursor(false);
			}
		}
		else if(PROJECT_MOVEITEMOUT_URL == i_UICommand.CommandURL)
		{
			// Check if we can promote the item
			if (this.CanPromote && (this.CanPromote = this.CheckACLItem(g_CAN_PROMOTE)))
			{
				// This take a bit of time so let's show a wait cursor
				this.ShowWaitCursor(true);

				// Promote task
				this.OnMoveItemOut();

				// Remove wait cursor
				this.ShowWaitCursor(false);
			}
		}
		else if (VIEW_REPORT_URL == i_UICommand.CommandURL)
		{
			this.OnViewReport();
		}
		else if(GPT_S_STATUS_ALL == i_UICommand.CommandURL ||
				GPT_S_STATUS_NOTSTARTED == i_UICommand.CommandURL ||
				GPT_S_STATUS_INPROGRESS == i_UICommand.CommandURL ||
				GPT_S_STATUS_COMPLETE == i_UICommand.CommandURL)
		{
			// Set check mark state
			if (null != g_StatusFilterUICommand && i_UICommand != g_StatusFilterUICommand)
			{
				i_UICommand.CheckState = GrooveCheckState_Checked;
				g_StatusFilterUICommand.CheckState = GrooveCheckState_Unchecked;

				// Remember menu command
				g_StatusFilterUICommand = i_UICommand;
			}

			// Update view
			if (GPT_S_STATUS_ALL == i_UICommand.UserData)
				g_UIProjectStatusCC.UICommand.Label = VIEW_STATUS_DROPDOWN_LABEL + i_UICommand.Label;
			else
				g_UIProjectStatusCC.UICommand.Label = i_UICommand.Label;

			g_UIProjectStatusCC.UICommand.UserData = i_UICommand.UserData;
			this.RedrawDataViewer();
		}
		else if(VIEW_STATUS_URL == i_UICommand.CommandURL)
		{
			// Figure out which menu item needs to be checked.
			var StatusCC = this.ViewCC.OpenUICommandContainer(VIEW_STATUS_URL);
			var MenuCommand = null;
			if (null != StatusCC)
				MenuCommand = StatusCC.OpenUICommand(i_UICommand.UserData);

			if (null != MenuCommand)
			{
				// Set check mark state
				if (null != g_StatusFilterUICommand && MenuCommand != g_StatusFilterUICommand)
				{
					MenuCommand.CheckState = GrooveCheckState_Checked;
					g_StatusFilterUICommand.CheckState = GrooveCheckState_Unchecked;

					// Remember menu command
					g_StatusFilterUICommand = MenuCommand;
				}
			}

			if (GPT_S_STATUS_ALL == i_UICommand.UserData)
				g_UIProjectStatusCC.UICommand.Label = VIEW_STATUS_DROPDOWN_LABEL + i_UICommand.Label;
			else
				g_UIProjectStatusCC.UICommand.Label = i_UICommand.Label;

			g_UIProjectStatusCC.UICommand.UserData = i_UICommand.UserData;

			PropertyList.SetPropertyAsString("StatusSelectionText", g_UIProjectStatusCC.UICommand.Label, GroovePropertyFlag_Private);
			PropertyList.SetPropertyAsString("StatusSelectionData", g_UIProjectStatusCC.UICommand.UserData, GroovePropertyFlag_Private);

			this.RedrawDataViewer();
		}
		else if(VIEW_PARTICIPANTS_URL == i_UICommand.CommandURL)
		{
			if (GPT_S_STATUS_ALL == i_UICommand.UserData)
				g_UIProjectParticipantsCC.UICommand.Label = VIEW_PARTICIPANTS_DROPDOWN_LABEL + i_UICommand.Label;
			else
			{
				//-----
				//- Unfortunately the entire name may not fit into the selected portion of the
				//- command container in 800 x 600 res. Hence, the UI team decided to restrict
				//- to a maximum of 11 characters (used W to determine how many fit).
				//- Chances are that other characters will fall into the mix so we'll allow a few more.
				//- Hence, we will truncate at 14 - 3 to allow for an elipses.
				//-----
				if (i_UICommand.Label.length > 14)
				{
					g_UIProjectParticipantsCC.UICommand.Label = i_UICommand.Label.slice(0,11) + "...";
				}
				else
				{
					g_UIProjectParticipantsCC.UICommand.Label = i_UICommand.Label;
				}
			}
			
			g_UIProjectParticipantsCC.UICommand.UserData = i_UICommand.UserData;
			PropertyList.SetPropertyAsString("ParticipantSelectionText", g_UIProjectParticipantsCC.UICommand.Label, GroovePropertyFlag_Private);
			PropertyList.SetPropertyAsString("ParticipantSelectionData", g_UIProjectParticipantsCC.UICommand.UserData, GroovePropertyFlag_Private);

			this.RedrawDataViewer();
		}
		else if(PROJECT_MARK_COMPLETE_URL == i_UICommand.CommandURL)
		{
			this.OnMarkComplete(i_UICommand);
		}
		else if(VIEW_NEXTUNREAD_URL == i_UICommand.CommandURL)
		{
			this.NavigateNextUnread();
		}
		else if(VIEW_PREVUNREAD_URL == i_UICommand.CommandURL)
		{
			this.NavigatePrevUnread();
		}
		else if(VIEW_UNREADOPTIONS_URL == i_UICommand.CommandURL)
		{
		}

		return;
	}


	//
	// Update UI command state
	//
	function ProjectViewClass_OnUpdateCommandState(i_UICommand)
	{
		// default is to not change the UI state
		var EnableCommand = i_UICommand.Enabled;

		// update the ACL cache if necessary
		if(this.UINeedsACLCheck)
		{
			this.RefreshACLCache();
			this.UINeedsACLCheck = false;
		}

		if(State_ViewMode == this.CurrentMode)
		{
			// Select all
			if(EDIT_SELECTALL_URL == i_UICommand.CommandURL)
			{
				EnableCommand = true;
			}

			// deletion
			else if(EDIT_DELETE_ITEM_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanDelete;
			}

			// add task
			else if(FILE_NEW_TASK_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanAddTask;
			}

			// edit button
			else if(EDIT_BUTTON_COMMANDURL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanEdit;
			}

			// import from MSProject
			// AMLATER - BE MORE EFFICIENT - DONT GET PROJECT
			else if(FILE_IMPORT_MSP_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanImport;
			}

			// export to MSProject
			else if(FILE_EXPORT_MSP_URL == i_UICommand.CommandURL)
			{
				EnableCommand = true;
			}

			// you can always copy as a link while in view mode
			else if(EDIT_COPYASLINK_URL == i_UICommand.CommandURL)
			{
				EnableCommand = true;
			}

			// you can always copy while in view mode
			// but you can never copy the root item
			else if(EDIT_COPY_URL == i_UICommand.CommandURL)
			{
				EnableCommand = (false == this.IsProjectInEnum(this.GetSelectionEnum()));
			}

			// cut
			else if(EDIT_CUT_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanCut;
			}

			// paste
			else if(EDIT_PASTE_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanAddTask &&
								this.GetClipboard().IsDataAvailable(PROJECTITEM_CLIPBOARDFORMAT);
			}

			// save as template
			else if(PROJECT_SAVEASTEMPLATE_URL == i_UICommand.CommandURL)
			{
				EnableCommand = true;
			}

			// unread marks
			else if(EDIT_MARKREAD_URL == i_UICommand.CommandURL  ||
			   EDIT_MARKUNREAD_URL == i_UICommand.CommandURL ||
			   EDIT_MARKALLREAD_URL == i_UICommand.CommandURL ||
			   EDIT_MARKALLUNREAD_URL == i_UICommand.CommandURL )
			{
				EnableCommand = true;
			}

			// move up
			else if(PROJECT_MOVEITEMUP_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanMoveUp && this.IsFilterOn();
			}

			// move down
			else if(PROJECT_MOVEITEMDOWN_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanMoveDown && this.IsFilterOn();
			}

			// move in
			else if(PROJECT_MOVEITEMIN_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanDemote && this.IsFilterOn();
			}

			// move out
			else if(PROJECT_MOVEITEMOUT_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.CanPromote && this.IsFilterOn();
			}

			this.DetailsView.UpdateButtonsState(this.CanDelete, this.CanEdit);
		}
		else  // edit mode
		{
			// Select all
			if(EDIT_SELECTALL_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// deletion
			if(EDIT_DELETE_ITEM_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// save button
			else if(SAVE_BUTTON_COMMANDURL == i_UICommand.CommandURL)
			{
				EnableCommand = true;
			}

			// cancel button
			else if(CANCEL_BUTTON_COMMANDURL == i_UICommand.CommandURL)
			{
				EnableCommand = true;
			}

			// add task
			else if(FILE_NEW_TASK_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// save as template
			else if(PROJECT_SAVEASTEMPLATE_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// import from MSProject
			else if(FILE_IMPORT_MSP_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// export to MSProject
			else if(FILE_EXPORT_MSP_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// unread marks
			else if(EDIT_MARKREAD_URL == i_UICommand.CommandURL ||
			   EDIT_MARKUNREAD_URL == i_UICommand.CommandURL ||
			   EDIT_MARKALLREAD_URL == i_UICommand.CommandURL ||
			   EDIT_MARKALLUNREAD_URL == i_UICommand.CommandURL )
			{
				EnableCommand = false;
			}

			// move up
			else if(PROJECT_MOVEITEMUP_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// move down
			else if(PROJECT_MOVEITEMDOWN_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// move in
			else if(PROJECT_MOVEITEMIN_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// move out
			else if(PROJECT_MOVEITEMOUT_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// you can never copy as a link while in edit mode
			else if(EDIT_COPYASLINK_URL == i_UICommand.CommandURL)
			{
				EnableCommand = false;
			}

			// copy text
			else if(EDIT_COPY_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.DetailsView.CanCopyToClipboard();
			}

			// cut text 
			else if(EDIT_CUT_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.DetailsView.CanCutToClipboard();
			}

			// paste text
			else if(EDIT_PASTE_URL == i_UICommand.CommandURL)
			{
				EnableCommand = this.DetailsView.CanPasteFromClipboard();
			}

		}

		if (i_UICommand.CommandURL == VIEW_NEXTUNREAD_URL)
			EnableCommand = this.ModelGlue.Cursor.CanMoveCursor(GrooveModelGlueCursorMove_NextUnread);
		else if (i_UICommand.CommandURL == VIEW_PREVUNREAD_URL)
			EnableCommand = ModelGlue.Cursor.CanMoveCursor(GrooveModelGlueCursorMove_PriorUnread);
		else if (i_UICommand.CommandURL == VIEW_UNREADOPTIONS_URL)
			EnableCommand = true;
		else if (VIEW_REPORT_URL == i_UICommand.CommandURL)
			EnableCommand = true;

		// update UI 
		i_UICommand.Enabled = EnableCommand;
	}

	//
	// Respond to UI SelectAll event
	//
	function ProjectViewClass_OnSelectAll()
	{
		// this should never happen
		if(State_EditMode == this.CurrentMode)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Cannot select all while in edit mode");
			return;
		}

		// Select all -- this will not fire a selection changed event
		// from the dataviewer so we need to notify ourselves
		this.DataViewerControl.SelectAll(true);
		this.OnListSelectionChanged();
	}


	//
	// Respond to UI Delete event
	//
	function ProjectViewClass_OnDelete()
	{
		// this should never happen
		if(State_EditMode == this.CurrentMode)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Cannot delete while in edit mode");
			return;
		}

		var DeleteIDEnum = CreateDoubleEnum();
		DeleteIDEnum = this.DataViewerControl.GetIDsOfSelectedRows();

		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			// How many items selected?
			var NumSelected = 0;
			var SummaryTaskSelected = 0;
			var pTask;
			while(DeleteIDEnum.HasMore())
			{
				pTask = this.GetItemFromID(DeleteIDEnum.OpenNext());

				// Is this a summary task?
				if (pTask.IsSummary)
					SummaryTaskSelected++;

				// Increment task counter.
				NumSelected++;
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
		}

		// very important!
		DeleteIDEnum.Reset();

		// Setup confirmation message.
		var Message = STR_CONFIRMDELETE_MESSAGE;
		if (1 == NumSelected)
		{
			if (SummaryTaskSelected)
				Message += STR_CONFIRMSUMMARYTASKDELETE_MESSAGE; 
			else
				Message += STR_CONFIRMTASKDELETE_MESSAGE;

			Message += STR_QUOTE;
			Message += this.GetSelectedItem().Name;
			Message += STR_QUOTE;
			Message += STR_QUESTIONMARK;
		}
		else
		{
			Message += NumSelected;
			Message += STR_CONFIRMMULTIPLEDELETE_MESSAGE;
			Message += STR_QUESTIONMARK;

			if (1 == SummaryTaskSelected)
			{
				Message += STR_SUMMARYTASKSELECTED_MESSAGE;
			}
			else if (1 < SummaryTaskSelected)
			{
				Message += STR_SEVERALSUMMARYTASKSSELECTED_MESSAGE;
			}
		}

		if (SummaryTaskSelected)
			Message += STR_DELETESUBTASKS_MESSAGE;
		
		Message += STR_CANNOTUNDO_MESSAGE;

		// Verify delete with user.
		if(GrooveMessageBoxResultCode_No == MHF_MessageBox(Message, STR_CONFIRMDELETE_TITLE, GrooveMessageBoxStyle_YesNo, GrooveMessageBoxIcon_Exclamation))
		{
			return;
		}

		// Do the delete
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			this.ShowWaitCursor(true);
			this.pIDataModelDelegate.DeleteMultipleItems(DeleteIDEnum.DoubleEnum, this.GetProgressInterface());
			pIDelta.Commit();
			this.ShowWaitCursor(false);
		}
		catch(e)
		{
			pIDelta.Abort();
			this.ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_DELETING);
		}
		
		// wait for async notification to update our UI
	}

	//
	// Respond to UI Add event
	//
	function ProjectViewClass_OnMarkComplete(i_UICommand)
	{
		GrooveDebugFunctions.DisplayAssert(i_UICommand.CommandURL == PROJECT_MARK_COMPLETE_URL,
									"Invalid command");
	}
	
	function ProjectViewClass_OnAddItem(i_UICommand)
	{
		GrooveDebugFunctions.DisplayAssert(i_UICommand.CommandURL == FILE_NEW_TASK_URL,
									"Invalid command");

		// this should never happen
		if(State_EditMode == this.CurrentMode)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Cannot add while in edit mode");
			return;
		}

		if(null == this.GetSelectedItem())
		{
			GrooveDebugFunctions.DisplayAssert(0, "No parent selected");
			return;
		}

		//
		// find the parent to add to
		//

		var pIParent = null;
		var pIInsertBefore = null;
		var ProjectStartTime = -1;

		if(GrooveProjectTrackingItemType_Project == this.GetSelectedItemType())
		{
			pIParent = this.GetSelectedItem();
			// null insertion point = append

			ProjectStartTime = pIParent.ScheduledStart;
		}
		else
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				ProjectStartTime = this.pIDataModelDelegate.GetProject().ScheduledStart;

				if(this.pIDataModelDelegate.DoesItemExist(this.GetSelectedItem().ID))
				{
					var ParentItemType = this.pIDataModelDelegate.GetItemType(this.GetSelectedItem().ParentID);
					pIParent = this.GetItem(this.GetSelectedItem().ParentID, ParentItemType);
					Transaction.Commit();
				}
				else
				{
					Transaction.Commit();
					this.NotifyUserOfItemRemoval();
					return;
				}
			}
			catch(e)
			{
				Transaction.Abort();
				PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_ADDING);
				return;
			}

			// set insertion point
			pIInsertBefore = this.GetSelectedItem();
		}

		// Set the tool state for edit mode and display the Create Task subform
		this.EnterEditMode();

		var Result = this.DetailsView.CreateTask(this.GetSelectedItem(), pIParent, this.GetSelectedItemType(), pIInsertBefore, ProjectStartTime);
		while(Result == GrooveDialogBoxResultCode_OK)
		{
			var NewItemID = this.SaveNewTask
									(
										this.DetailsView.GetParentID(),
										this.DetailsView.GetPreviousSiblingID(),
										this.DetailsView.GetName(),
										this.DetailsView.GetAssignedToContactURL(),
										MHF_GetStatusEnumFromString(this.DetailsView.GetStatus()),
										MHF_GetPriorityEnumFromString(this.DetailsView.GetPriority()),
										this.DetailsView.GetUserStartConstraint(),
										this.DetailsView.GetConstrainStartFlag(),
										this.DetailsView.GetScheduledStart(),
										this.DetailsView.GetScheduledDuration(),
										this.DetailsView.GetScheduledFinish(),
										this.DetailsView.GetTargetFinish(),
										this.DetailsView.GetActualStart(),
										this.DetailsView.GetActualFinish(),
										this.DetailsView.GetIsPrivate(),
										this.DetailsView.GetDescription(),
										this.DetailsView.GetNewAttachmentsArray(),
										this.DetailsView.GetNewPredecessorsArray()
									);
			if(this.DetailsView.SaveOnce())
				break;

			var pNewItem = null;
			var pNewItemParent = null;
			var ParentItemType;
			var NewItemType;
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				if(this.pIDataModelDelegate.DoesItemExist(NewItemID))
				{
					NewItemType = this.pIDataModelDelegate.GetItemType(NewItemID);
					pNewItem = this.GetItem(NewItemID, NewItemType);

					ParentItemType = this.pIDataModelDelegate.GetItemType(pNewItem.ParentID);
					pNewItemParent = this.GetItem(pNewItem.ParentID, ParentItemType);

					Transaction.Commit();
				}
				else
				{
					Transaction.Commit();
					this.NotifyUserOfItemRemoval();
					break;
				}
			}
			catch(e)
			{
				Transaction.Abort();
				PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_ADDING);
				break;
			}
			// set insertion point
			pIInsertBefore = pNewItem;
			Result = this.DetailsView.CreateTask(pNewItem, pNewItemParent, NewItemType, pIInsertBefore, ProjectStartTime);
		}
		this.DetailsView.CloseNewItemWindow();
		this.EnterViewMode();
	}

	function ProjectViewClass_OnMoveItemDown()
	{
		if(GrooveProjectTrackingItemType_Project == this.GetSelectedItemType())
		{
			return;
		}

		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			var SelectionIDEnum = this.GetReversedSelectionEnum();

			// If the selection contains parent and child items, we only
			// need to consider the parent items since the operation will
			// automatically be applied to the children
			// AMLATER - move this function out of datamodel helper functions
			SelectionIDEnum = PDHF_RemoveRedundantDecendants(SelectionIDEnum);

			// Loop through all items and move them.
			while(SelectionIDEnum.HasMore())
			{
				this.pIDataModelDelegate.MoveItemDown(SelectionIDEnum.OpenNext());
			}

			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MOVING);
		}

		// force refresh of ACL cache for UI command update
		this.UINeedsACLCheck = true;
	}


	function ProjectViewClass_OnMoveItemUp()
	{
		if(GrooveProjectTrackingItemType_Project == this.GetSelectedItemType())
		{
			return;
		}

		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			var SelectionIDEnum = this.GetSelectionEnum();

			// If the selection contains parent and child items, we only
			// need to consider the parent items since the operation will
			// automatically be applied to the children
			// AMLATER - move this function out of datamodel helper functions
			SelectionIDEnum = PDHF_RemoveRedundantDecendants(SelectionIDEnum);

			// Loop through all items and move them.
			while(SelectionIDEnum.HasMore())
			{
				this.pIDataModelDelegate.MoveItemUp(SelectionIDEnum.OpenNext());
			}

			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MOVING);
		}

		// force refresh of ACL cache for UI command update
		this.UINeedsACLCheck = true;
	}

	function IsItemInArray(i_Array, i_Item, i_ArraySize)
	{
		var i;
		for (i = 0; i < i_ArraySize; i++)
		{
			if (i_Item == i_Array[i])
			{
				return true;
			}
		}
		return false;
	}

	function ProjectViewClass_OnMoveItemIn()
	{
		var CheckedArray = new Array;
		var CheckedCount = 0;
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();

		try
		{
			var SelectionIDEnum = this.GetSelectionEnum();

			// If the selection contains parent and child items, we only
			// need to consider the parent items since the operation will
			// automatically be applied to the children
			// AMLATER - move this function out of datamodel helper functions
			SelectionIDEnum = PDHF_RemoveRedundantDecendants(SelectionIDEnum);

			while(SelectionIDEnum.HasMore())
			{
				// Get first selected item	
				var DemoteID = SelectionIDEnum.OpenNext();

				//-----
				//- Will there be a new parent for this task and if so will this parent 
				//- loose its predecessor information?  Only need to check the first task
				//- in an enumeration.
				//-----

				// Get the new parent for task
				var NewParentID = -1;
				if (this.pIDataModelDelegate.DoesItemExist(DemoteID))
				{
					// Get the task object
					var pItem = this.GetItemFromID(DemoteID);
					
					// The previous sibling will become the new parent.
					NewParentID = (this.pIDataModelDelegate.DoesItemExist(pItem.PreviousSiblingID)) ? pItem.PreviousSiblingID : -1;
				}

				// The new parent will be the item's previous sibling.
				if (-1 != NewParentID)
				{
					// Do not check if check previously
					if (!IsItemInArray(CheckedArray, NewParentID, CheckedCount))
					{
						// Does the new parent have predecessors?
						var pIPredecessorEnum = this.GetItemFromID(NewParentID).OpenPredecessorEnum();
						if (pIPredecessorEnum.HasMore())
						{
							pIDelta.Abort();

							// Prompt the user.
							if (GrooveMessageBoxResultCode_No == MHF_MessageBox(GPTPROJECT_MB_DEMOTE_LOOSE_INFO,
																				GPTPROJECT_MB_DEMOTE_TITLE,
																				GrooveMessageBoxStyle_YesNo,
																				GrooveMessageBoxIcon_Information))
							{
								return;
							}

							// Restart the check
							pIDelta = DynamicsMgr.CreateDelta();
							CheckedArray[CheckedCount] = NewParentID;
							CheckedCount++;
							SelectionIDEnum.Reset();
							continue;
						}
					}
				}

				// Check if demotion creates a cycle.
				if(this.pIDataModelDelegate.DoesDemoteCreateCycle(DemoteID))
				{
					pIDelta.Abort();
					PHF_AlertUser(GPTPROJECT_MB_DEMOTE_CAUSES_CYCLE);
					return;
				}
			}

			SelectionIDEnum.Reset();
			this.pIDataModelDelegate.DemoteMultipleItems(SelectionIDEnum, this.GetProgressInterface());

			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_DEMOTE_FAILURE);
		}

		// Force refresh of ACL cache for UI command update
		this.UINeedsACLCheck = true;
	}

	function ProjectViewClass_OnMoveItemOut()
	{
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			var SelectionIDEnum = this.GetReversedSelectionEnum();

			// If the selection contains parent and child items, we only
			// need to consider the parent items since the operation will
			// automatically be applied to the children
			// AMLATER - move this function out of datamodel helper functions
			SelectionIDEnum = PDHF_RemoveRedundantDecendants(SelectionIDEnum);

			this.pIDataModelDelegate.PromoteMultipleItems(SelectionIDEnum, this.GetProgressInterface());
			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_PROMOTING);
		}

		// force refresh of ACL cache for UI command update
		this.UINeedsACLCheck = true;
	}

	//
	// Respond to addition to data model
	//
	function ProjectViewClass_OnItemAdded(i_pIDEnum)
	{
		// Currently all handled by data viewer
	}


	//
	// Respond to replacement in data model
	// 
	function ProjectViewClass_OnItemReplaced(i_pIDEnum)
	{
		// Must reset enum before using it (another listener could have traversed already)
		i_pIDEnum.Reset();

		// AMLATER - do nothing if we are displaying the modal "new task" dialog --the details
		// pane will become stale if the item we are in view mode and the item being displayed
		// has changed and the user cancells the modal dialog --this will need to be addressed
		// in the future
		if(State_EditMode == this.CurrentMode && true == this.DetailsView.IsNewItem())
		{
			return;
		}

		// see if we need to refresh the details view
		var bRefresh = false;
		while(i_pIDEnum.HasMore())
		{
			var ID = i_pIDEnum.OpenNext();
			if(ID == this.GetSelectedItem().ID)
			{
				bRefresh = true;
				break;
			}
		}

		// work to do?
		if(false == bRefresh)
		{
			return;
		}

		var pIItem = null;
		var ParentItemType = GrooveProjectTrackingItemType_Invalid;
		var pIParentItem = null;
		var ItemType = GrooveProjectTrackingItemType_Invalid;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		
		try
		{
			var ID = this.GetSelectedItem().ID;
			if(this.pIDataModelDelegate.DoesItemExist(ID))
			{
				ItemType = this.pIDataModelDelegate.GetItemType(ID);
				pIItem = this.GetItem(ID, ItemType);

				if(ItemType != GrooveProjectTrackingItemType_Project)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(pIItem.ParentID);
					pIParentItem = this.GetItem(pIItem.ParentID, ParentItemType);
				}
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_RESPONDINGTOREPLACE);
			return;
		}

		// if item no longer exists, we'll refresh the UI when we receive the async removal event
		if(null == pIItem)
		{
			return;
		}

		// refresh the UI
		if(State_EditMode == this.CurrentMode)
		{
			this.SetSelectedItem(pIItem, ItemType, pIParentItem, ParentItemType);

			var bNotifyUser = false;
			i_pIDEnum.Reset();
			while(i_pIDEnum.HasMore())
			{
				var ID = i_pIDEnum.OpenNext();
				if(ID == this.GetSelectedItem().ID)
				{
					var Transaction = Telespace.OpenTransaction(true);
					try
					{
						if(this.pIDataModelDelegate.DoesItemExist(ID))
						{
							var ChangedItemType = this.pIDataModelDelegate.GetItemType(ID);
							bNotifyUser = NeedUserNotification(this.GetItem(ID, ChangedItemType),
															   this.DetailsView.GetCurrentItem(),
															   ChangedItemType);
						}
						Transaction.Commit();
					}
					catch(e)
					{
						Transaction.Abort();
					}
					break;
				}
			}

			// only notify the user once
			if(false == this.UserNotifiedOfChange && bNotifyUser)
			{
				//-----
				//- xxx BBLATER: Unfortunately due to flaw, we cannot show a message box while
				//- inside this callback. Thus, we must set state, start a timer and return. OnTimer
				//- will display the message box to the user.
				//-----
				
				// Stop & Start the timer.
				ItemReplacedHackTimer.Stop();
				ItemReplacedHackTimer.Start();
			}
		}
		else
		{
			this.SetSelectedItem(pIItem, ItemType, pIParentItem, ParentItemType);
			this.RefreshSelectedItem();
		}
	}

	//
	// Respond to removal in data model
	// 
	function ProjectViewClass_OnItemRemoved(i_pIDEnum)
	{
		// DataViewer will automatically select a new item and fire a selection
		// changed event if the one we are viewing has been removed

		// Don't notify the user that the item has been removed, even if they 
		// are in edit mode, since we could be receiving this message as the
		// result of a rollback.  Instead, we notify them when they try to save.
	}


	//
	// Notify the user that an item has been removed
	//
	function ProjectViewClass_NotifyUserOfItemRemoval()
	{
		ProjectViewGrooveMessageDialogHelper(STR_ITEMDELETED_MESSAGE, STR_ITEMDELETED_TITLE, GrooveMessageBoxIcon_Information);
	}

	//
	// Respond to a selection change in the data view control
	//
	function ProjectViewClass_OnListSelectionChanged()
	{
		// ignore data viewer until we hear that it's initialized
		// (working around a bug in dataviewer)
		if(false == this.DataViewerInitialized)
		{
			return;
		}

		// prompt the user to save changes before exiting edit mode
		if(State_EditMode == this.CurrentMode)
		{
			// if we're displaying the modal new-task dialog, do nothing
			// (the list selection is changing because another endpoint deleted or added a task)
			if(true == this.DetailsView.IsNewItem())
			{
				return;
			}

			// If we're already editing the item, do nothing
			if(this.DetailsView.GetID() == this.DataViewerControl.GetIDOfFocusRow())
			{
				return;
			}

			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				// If the data viewer goes into a state where it's displaying a deleted item,
				// then abort the trasaction and return
				if(false == this.pIDataModelDelegate.DoesItemExist(this.DataViewerControl.GetIDOfFocusRow()))
				{
					Transaction.Abort();
					return;	
				}

				// Did the selection change because the current selection was deleted?
				if(false == this.pIDataModelDelegate.DoesItemExist(this.DetailsView.GetID()))
				{
					// Yes it did. Do nothing now, we'll give the user some options
					// when they go to save.
					Transaction.Commit();
					return;
				}

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				// AM - it's not safe to display a modal box here since we may be called
				// in response to an async engine event
				GrooveDebugFunctions.DisplayAssert(0, "Error handling selection change while editing");
				// PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_CHANGESELECTIONWHILEEDITING);
				return;
			}

			// Otherwise, the selection changed due to a user guesture
			// so we want to give them the option to save
			if(this.DetailsView.HasChanged())
			{
				// AMLATER - switch to DataViewer so we get causality to WHY a change
				// is occuring.  When it's in response to a user guesture, prompt them
				// to save their changes.  When it's in response to rollback or a remove
				// do nothing
				this.DataViewerControl.SelectSingleRow(this.DetailsView.GetID(), true, true);
				return;

/*
				var Response = this.PromptUserToSaveChanges();
				if(GrooveMessageBoxResultCode_Yes == Response)
				{
					if (false == this.Save())
						return;
				}
				else if(GrooveMessageBoxResultCode_Cancel == Response)
				{
					this.DataViewerControl.SelectSingleRow(this.DetailsView.GetID(), true, true);
					return;
				}
				else if(GrooveMessageBoxResultCode_No == Response)
				{
					// keep on truckin'
				}
*/
			}
		}

		var ID = this.DataViewerControl.GetIDOfFocusRow();

		// make sure we're in view-only mode
		this.EnterViewMode();

		var Item = null;
		var ItemType;
		var ParentItemType = GrooveProjectTrackingItemType_Invalid;
		var ParentItem = null;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if(this.pIDataModelDelegate.DoesItemExist(ID))
			{
				ItemType = this.pIDataModelDelegate.GetItemType(ID);
				Item = this.GetItem(ID, ItemType);

				if(ItemType != GrooveProjectTrackingItemType_Project)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(Item.ParentID);
					ParentItem = this.GetItem(Item.ParentID, ParentItemType);
				}
				Transaction.Commit();
			}
			else
			{
				Transaction.Abort();

				// the item has changed out from under us,
				// inform the user, wait for async notification to remove it from
				// the UI -- AMLATER - can we do something better?
				
				// AM - no longer notifying the user because it causes a new notification
				// to be displayed when multiple items are simultaneously deleted from the list

				//this.NotifyUserOfItemRemoval();
				return;
			}
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_CHANGESELECTION);
			return;
		}

		this.ModelGlue.Cursor.MoveCursorToRecord(Item.ID);

		// update the selected item
		this.SetSelectedItem(Item, ItemType, ParentItem, ParentItemType);
		this.RefreshSelectedItem();
	}

	function ProjectViewClass_OnListInitialize()
	{
		// remember that the dataviewer has initialized
		this.DataViewerInitialized = true;
	}


	//
	// Respond to double click in the data view control
	// 
	function ProjectViewClass_OnListViewDoubleClick(i_RecordID)
	{
		// xxxBBLATER - If in edit mode and item has changed, keep the current selection
		// See ProjectViewClass_OnListSelectionChanged() -> why don't prompt to save there.
		if(State_EditMode == this.CurrentMode &&
		   this.DetailsView.HasChanged())
		{
			this.DataViewerControl.SelectSingleRow(this.DetailsView.GetID(), true, true);
			return;
		}

		var ParentItemType = GrooveProjectTrackingItemType_Invalid;
		var ParentItem = null;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			// ignore if user does not have access
			if (false == this.CanEdit || (false == (this.CanEdit = this.CheckACLItem(g_CAN_EDIT))))
			{
				Transaction.Abort();
				return;
			}

			if(this.pIDataModelDelegate.DoesItemExist(i_RecordID))
			{
				ItemType = this.pIDataModelDelegate.GetItemType(i_RecordID);
				Item = this.GetItem(i_RecordID, ItemType);

				if(ItemType != GrooveProjectTrackingItemType_Project)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(Item.ParentID);
					ParentItem = this.GetItem(Item.ParentID, ParentItemType);
				}

				Transaction.Commit();
			}
			else
			{
				// the open item has changed out from under us,
				// inform the user 
				Transaction.Commit();
				
				this.NotifyUserOfItemRemoval();
				return;
			}
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_EDIT);
			return;
		}

		// set the item as selected and enter edit mode
		this.SetSelectedItem(Item, ItemType, ParentItem, ParentItemType);
		this.RefreshSelectedItem();
		this.OnEdit();
	}


	//
	// Edit the selected item
	// 
	// The latest copy of the data for the selected item is used
	// without notifying the user
	//
	function ProjectViewClass_OnEdit()
	{
		var ItemType;
		var Item = null;
		var CanEditScheduleInfo = false;
		var ProjectStartTime = -1;

		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			ProjectStartTime = this.pIDataModelDelegate.GetProject().ScheduledStart;
			
			if(this.pIDataModelDelegate.DoesItemExist(this.GetSelectedItem().ID))
			{
				ItemType = this.pIDataModelDelegate.GetItemType(this.GetSelectedItem().ID);
				Item = this.GetItem(this.GetSelectedItem().ID, ItemType);
				CanEditScheduleInfo = this.pIDataModelDelegate.CanReplaceItemScheduleInfo(this.GetSelectedItem().ID);

				if(false == this.GetSelectedItem().IsRead)
				{
					this.pIDataModelDelegate.MarkRead(this.GetSelectedItem().ID, true);
				}

				Transaction.Commit();
			}
			else
			{
				Transaction.Abort();

				// the item has changed out from under us,
				// inform the user
				this.NotifyUserOfItemRemoval();
				return;
			}
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_EDIT);
			return;
		}

		GrooveDebugFunctions.DisplayAssert(null != Item, "Missing Task");

		// update UI		
		switch(ItemType)
		{
			case GrooveProjectTrackingItemType_Project:
			{
				this.EnterEditMode();
				this.DetailsView.EditProject(Item);
				break;
			}
			case GrooveProjectTrackingItemType_Task:
				this.EnterEditMode();
				this.DetailsView.EditTask(Item, CanEditScheduleInfo, ProjectStartTime);
				break;
			default:
			{
				GrooveDebugFunctions.DisplayAssert(0, "Invalid type");
				break;
			}
		}
	}


	//
	// Save the item being edited
	//
	function ProjectViewClass_OnSave()
	{
		this.Save();
	}

	
	function ProjectViewClass_Save()
	{
		GrooveDebugFunctions.DisplayAssert(State_EditMode == this.CurrentMode, "Invalid state");

		if(this.DetailsView.IsNewItem())
		{
			var ret = this.SaveNewTask
						(
							this.DetailsView.GetParentID(),
							this.DetailsView.GetPreviousSiblingID(),
							this.DetailsView.GetName(),
							this.DetailsView.GetAssignedToContactURL(),
							this.DetailsView.GetStatus(),
							this.DetailsView.GetPriority(),
							this.DetailsView.GetConstrainStartFlag(),
							this.DetailsView.GetScheduledStart(),
							this.DetailsView.GetScheduledStart(),
							this.DetailsView.GetScheduledDuration(),
							this.DetailsView.GetScheduledFinish(),
							this.DetailsView.GetTargetFinish(),
							this.DetailsView.GetActualStart(),
							this.DetailsView.GetActualFinish(),
							this.DetailsView.GetIsPrivate(),
							this.DetailsView.GetDescription(),
							this.DetailsView.GetNewAttachmentsArray(),
							this.DetailsView.GetNewPredecessorsArray()
						);
			if(ret < 0)
				return false;
			return true;
		}
		else
		{
			return this.SaveExisting();
		}
		return false;
	}

	function ProjectViewClass_ExportAttachments(i_OwnerID, i_AttachmentDetailsArray)
	{
		var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var strPath = App.BrowseForResource(ParentWindow, "", GrooveBrowseForResourceStyle_Folders);	
		if (strPath == "")
			return;

		var pIFileServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);

		try
		{
			// This is a recursive call to handle the export.
			var nArrayIndex = 0;
			var Transaction = this.ProcessExportTransaction(Telespace, pIFileServices, strPath, i_OwnerID,
								 							i_AttachmentDetailsArray, nArrayIndex);
			if (null != Transaction)
				Transaction.Commit();
		}
		catch(e)
		{
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_EXPORT);
		}

		return;
	}

	function ProjectViewClass_ProcessExportTransaction(i_Telespace, i_pIFileServices, i_strPath, i_OwnerID, i_AttachmentDetailsArray, i_nArrayIndex)
	{
		// Check for end case of recursion.
		if (i_nArrayIndex >= i_AttachmentDetailsArray.length)
		{
			// Start a trasaction.
			return i_Telespace.OpenTransaction(true);
		}

		// Handle file attachment.
		var AttachmentWrapper = i_AttachmentDetailsArray[i_nArrayIndex];
		var strFilename = (true == AttachmentWrapper.IsExistingAttachment) ? AttachmentWrapper.pIAttachment.Name : AttachmentWrapper.FullName;

		// Increment index into the array.
		i_nArrayIndex++;

		// Make fully qualified filename.
		var strFullyQualifiedFileName = i_strPath + "\\" + strFilename;

		// Check if a file with the same already exists.
		if (i_pIFileServices.DoesFileExist(strFullyQualifiedFileName))
		{
			var strMessage = String(STR_EXPORTATTACHMENT_MESSAGE);
			strMessage = strMessage.replace(/%filename/i, strFilename);
			strMessage = strMessage.replace(/%foldername/i, i_strPath);

			// Prompt user to overwrite?
			if (GrooveMessageBoxResultCode_No == MHF_MessageBox(strMessage, STR_EXPORTATTACHMENT_TITLE,
																GrooveMessageBoxStyle_YesNo,
																GrooveMessageBoxIcon_Information))
				return null;
		}

		// Process more items in array; this call is recursive.
		var Transaction = this.ProcessExportTransaction(i_Telespace, i_pIFileServices, i_strPath, i_OwnerID,
													    i_AttachmentDetailsArray, i_nArrayIndex);
		if (null == Transaction)
			return null;

		try
		{
			// Establish attachment byte stream.
			var pIBIS = (true == AttachmentWrapper.IsExistingAttachment) ? this.pIDataModelDelegate.OpenAttachmentByteInputStream(i_OwnerID, AttachmentWrapper.pIAttachment.ID)
																		 : CreateByteInputStreamFromFile(AttachmentWrapper.FilePath, true);

			// Export the file
			var pByteOutputStream = GROOVE_GLOBAL_MISC_POINTER.StreamFactory.CreateByteOutputStreamFromFile(strFullyQualifiedFileName, false, false);
			pIBIS.ReadToStream(pIBIS.GetSize(), pByteOutputStream);
			return Transaction;
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_EXPORT);
			return null;
		}
	}

	function ProjectViewClass_MarkCurrentComplete()
	{
		// this may take a while
		MHF_ShowWaitCursor(true);

		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			var SelectedIDEnum = this.DataViewerControl.GetIDsOfSelectedRows();
			while(SelectedIDEnum.HasMore())
			{
				var ID = SelectedIDEnum.OpenNext();
				if(this.pIDataModelDelegate.DoesItemExist(ID))
				{
					var ItemType = this.pIDataModelDelegate.GetItemType(ID);
					var Item = this.GetItem(ID, ItemType);
					var CurrentDate = new Date();

					// if the current item is already marked as complete, do nothing
					if(GrooveProjectToolsetStatusType_Complete == Item.Status)
					{
						continue;
					}

					// if the task hasn't been started yet, mark today as the actual start date
					if(GrooveProjectToolsetStatusType_NotStarted == Item.Status)
					{
						Item.ActualStart = StartOfDay(CurrentDate.valueOf());
					}

					// if the task hasn't been started yet or was in progress, mark today
					// as the actual finish date
					if(GrooveProjectToolsetStatusType_NotStarted == Item.Status ||
					   GrooveProjectToolsetStatusType_InProgress == Item.Status)
					{
						Item.ActualFinish = StartOfDay(CurrentDate.valueOf());
					}

					Item.Status = GrooveProjectToolsetStatusType_Complete;
					this.ReplaceExistingItem
										(
											Item, 
											ItemType,
											new Array(),
											new Array(),
											new Array(),
											new Array()
										);
				}
			}
			pIDelta.Commit();

			MHF_ShowWaitCursor(false);
		}
		catch(e)
		{
			pIDelta.Abort();
			MHF_ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKCOMPLETE);
		}
	}

	function ProjectViewClass_SaveExisting()
	{
		GrooveDebugFunctions.DisplayAssert(State_EditMode == this.CurrentMode, "Invalid state");

		// Tell details view to save its contents, it may fail if the parent
		// has been deleted while the user was editing
		if(false == this.DetailsView.ValidateInput())
		{
			return false;
		}

		// this may take a while
		MHF_ShowWaitCursor(true);

		var ItemDeleted = false;
		var ParentDeleted = false;

		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			if(GrooveProjectTrackingItemType_Project != this.DetailsView.GetItemType())
			{
				// if the item or it's parent has been deleted, notify the user
				if(false == this.pIDataModelDelegate.DoesItemExist(this.DetailsView.GetParentID()))
				{
					ParentDeleted = true;
				}
			}

			// Check if itemhas been deleted
			var ItemID = this.DetailsView.GetID();
			if(false == this.pIDataModelDelegate.DoesItemExist(ItemID))
			{
				ItemDeleted = true;
			}
			
			// Check if user can edit the item.
			if (this.CanEdit)
			{
				this.CanEdit = this.pIDataModelDelegate.CanReplaceItem(ItemID);
			}

			if(false == this.CanEdit || true == ParentDeleted || true == ItemDeleted)
			{
				pIDelta.Abort();
			}
			else  // all systems go -- replace the existing record
			{
				this.ReplaceExistingItem
							(
								this.DetailsView.GetItem(),
								this.DetailsView.GetItemType(),
								this.DetailsView.GetNewAttachmentsArray(),
								this.DetailsView.GetRemoveAttachmentsArray(),
								this.DetailsView.GetNewPredecessorsArray(),
								this.DetailsView.GetRemovePredecessorsArray()
							);
					
				pIDelta.Commit();
			}
		}
		catch(e)
		{
			pIDelta.Abort();
			ItemDeleted = false;
			if (-2147024891 == e.number)
			{
				// User does not have permissions
				this.CanEdit = false;
			}
			else PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_REPLACING);
		}

		// done
		MHF_ShowWaitCursor(false);

		// If the user cannot edit item, give a notice
		if(false == this.CanEdit)
		{
			// User does not have permissions
			MHF_MessageBox(STR_NOPERMISSION_MESSAGE, STR_SAVETASK_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
		}

		// If the item was deleted while it was being edited, give the user some options
		else if(true == ItemDeleted || true == ParentDeleted)
		{
			var Response = this.PromptUserToSaveDeletedAsNew();
			if(GrooveMessageBoxResultCode_Yes == Response)
			{
				// if the parent was deleted, save the item as the first child of the project itemm
				// if the parent was not deleted, save the item as the first child of the parent
				var ParentID = this.DetailsView.GetParentID();
				if(true == ParentDeleted)
				{
					ParentID = this.ProjectID;
				}

				this.SaveNewTask
							(
								ParentID,
								0, /* first child */
								this.DetailsView.GetName(),
								this.DetailsView.GetAssignedToContactURL(),
								this.DetailsView.GetStatus(),
								this.DetailsView.GetPriority(),
								this.DetailsView.GetUserStartConstraint(),
								this.DetailsView.GetConstrainStartFlag(),
								this.DetailsView.GetScheduledStart(),
								this.DetailsView.GetScheduledDuration(),
								this.DetailsView.GetScheduledFinish(),
								this.DetailsView.GetTargetFinish(),
								this.DetailsView.GetActualStart(),
								this.DetailsView.GetActualFinish(),
								this.DetailsView.GetIsPrivate(),
								this.DetailsView.GetDescription(),
								this.DetailsView.GetNewAttachmentsArray(),
								this.DetailsView.GetNewPredecessorsArray()
							);
				return true;
			}
			else if (GrooveMessageBoxResultCode_Cancel == Response)
			{
				return false; // stay in edit mode
			}

			// Keep going -- lose changes
			else if (GrooveMessageBoxResultCode_No == Response)
			{
				// Get the current selection
				var SelectedID = this.DataViewerControl.GetIDOfFocusRow();

				// Set new selection if the selected item is gone.
				if(SelectedID != this.DetailsView.GetID())
				{
					var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
					var Transaction = Telespace.OpenTransaction(false);

					var pItem = null;
					var pParent = null;
					var SelectedItemType = GrooveProjectTrackingItemType_Invalid;
					var ParentItemType = GrooveProjectTrackingItemType_Invalid;
					try
					{
						// If the selected item exists, set selected item object
						if(this.pIDataModelDelegate.DoesItemExist(SelectedID))
						{
							// Get selected item type and object
							SelectedItemType = this.pIDataModelDelegate.GetItemType(SelectedID);
							pItem = this.GetItem(SelectedID, SelectedItemType);

							if (GrooveProjectTrackingItemType_Project == SelectedItemType)
							{
								// Set the selection to project
								SelectedItemType = GrooveProjectTrackingItemType_Project;
								ParentItemType = GrooveProjectTrackingItemType_Invalid;
								pItem = this.pIDataModelDelegate.GetProject();
							}
							else
							{
								// Get selected item's parent type and object
								ParentItemType =  this.pIDataModelDelegate.GetItemType(pItem.ParentID);
								pParent = this.GetItem(pItem.ParentID, ParentItemType)
							}

							Transaction.Commit();
						}
						else  // point the item to root
						{
							// Set the selection to project
							SelectedItemType = GrooveProjectTrackingItemType_Project;
							ParentItemType = GrooveProjectTrackingItemType_Invalid;
							pItem = this.pIDataModelDelegate.GetProject();
							Transaction.Abort();
						}
					}
					catch (error)
					{
						Transaction.Abort();
						GrooveDebugFunctions.DisplayAssert(0, "Error getting task object.");
					}

					// Set the new selection	
	  				this.SetSelectedItem(pItem, SelectedItemType, pParent, ParentItemType);
				}
			}
		}

		// switch back to view-only mode
		this.EnterViewMode();

		// mark the ACL cache for refresh
		this.UINeedsACLCheck = true;

		// update the details view with the new info
		this.RefreshSelectedItem();
		return true;
	}


	//
	// Cancel editing of selected item
	// 
	function ProjectViewClass_OnCancel()
	{
		// switch back to view-only mode
		this.EnterViewMode();
		this.RefreshSelectedItem();

		// clear the unread flag for the item
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if(this.pIDataModelDelegate.DoesItemExist(this.GetSelectedItem().ID))
			{
				if(false == this.GetSelectedItem().IsRead)
				{
					this.pIDataModelDelegate.MarkRead(this.GetSelectedItem().ID, true);
				}
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKINGREAD);
		}
	}

	
	function ProjectViewClass_ShowConfigDialog()
	{
		var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = ParentWindow;
		WindowProperties.Resizable = false;
		WindowProperties.CaptionVisible = true;
		WindowProperties.InitialHeight = 520;
		WindowProperties.InitialWidth = 620;
		WindowProperties.CloseButton = false;
		WindowProperties.Caption = CONFIGURE_PROJECT_DIALOG_TITLE;
		WindowProperties.HelpButton = false;

		var ConfigHost = ProjectWizardSubForm.OpenDelegateComponent();
		var ConfigCode = ConfigHost.GetScriptDispatch();

		// set DMD
		ConfigCode.SetProjectDataModelDelegate(this.pIDataModelDelegate);

		// setting contact list and project requires Tx
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);

		try
		{
			// project
			ConfigCode.SetProject(this.pIDataModelDelegate.GetProject());

			// contact list
			var ContactCache = PPH_GetContactNameURLMap(this.pIContactProvider);
			ConfigCode.SetContactList(ContactCache);
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_CONFIGURING);
			return;
		}
			
		var Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, ProjectWizardSubForm);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore |
												GrooveWindowMenuCommand_Size |
												GrooveWindowMenuCommand_Minimize |
												GrooveWindowMenuCommand_Maximize |
												GrooveWindowMenuCommand_Close,
												false);


		if(GrooveDialogBoxResultCode_OK == Window.DoModal())
		{
			// if data model has changed, we just stomp it
			var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
			var pIDelta = DynamicsMgr.CreateDelta();
			try
			{
				this.pIDataModelDelegate.ReplaceProject(ConfigCode.GetProject(), this.GetProgressInterface());
				pIDelta.Commit();
			}
			catch(e)
			{
				pIDelta.Abort();
				PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_REPLACING);
			}
		}
	}

	function ProjectViewClass_UpdateParticipantsUICommands()
	{
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			g_UIProjectParticipantsCC.UICommandContainer.RemoveAllUICommands();
			var pIUICommand = g_UIProjectParticipantsCC.UICommandContainer.InsertUICommand(VIEW_PARTICIPANTS_URL, g_UIProjectParticipantsCC.UICommandContainer.GetNumberOfUICommands());
			pIUICommand.Label = GPT_S_STATUS_ALL;
			pIUICommand.UserData = GPT_S_STATUS_ALL;

			pIUICommand = g_UIProjectParticipantsCC.UICommandContainer.InsertUICommand(VIEW_PARTICIPANTS_URL, g_UIProjectParticipantsCC.UICommandContainer.GetNumberOfUICommands());
			pIUICommand.Label = GPT_S_UNASSIGNED;
			pIUICommand.UserData = GPT_S_UNASSIGNED;

			var ContactMap = PPH_GetContactNameURLMap(this.pIContactProvider);
			for(var i=0; i<ContactMap.GetCount(); i++)
			{
				pIUICommand = g_UIProjectParticipantsCC.UICommandContainer.InsertUICommand(VIEW_PARTICIPANTS_URL, g_UIProjectParticipantsCC.UICommandContainer.GetNumberOfUICommands());
				var contactName = ContactMap.Map[i].Name;
				var index = contactName.indexOf("&");
				if(index != -1)
					contactName = contactName.replace(/&/g, "&&");
				pIUICommand.Label = contactName;
				pIUICommand.UserData = ContactMap.Map[i].ContactURL;
			}
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_RETRIEVINGCONTACTS);
			return;
		}
	}

	function ProjectViewClass_OnPersonsAdded(i_PersonContactURLEnum)
	{
		this.UpdateParticipantsUICommands();
	}

	function ProjectViewClass_OnPersonsRemoved(i_PersonContactURLEnum)
	{
		// if viewing, refresh current item if necessessary
		if(State_ViewMode == this.CurrentMode)
		{
			this.RefreshSelectedItem();
		}
		else
		{
			// ignore changes while editing, we'll pick up the change next time we edit
		}
		this.UpdateParticipantsUICommands();
	}

	function ProjectViewClass_OnPersonsChanged(i_PersonContactURLEnum)
	{
		// if viewing, refresh current item if necessessary
		if(State_ViewMode == this.CurrentMode)
		{
			this.RefreshSelectedItem();
		}
		else
		{
			// ignore changes while editing, we'll pick up the change next time we edit
		}
		this.UpdateParticipantsUICommands();
	}

	//**** Reporting ****

	function ProjectViewClass_OnViewReport()
	{
		//-----
		//- "Report View" feature works with IE versions 5.01 or higher.
		//- The first instance of IE 5.01 has version 5.00.2919.xxxx
		//- Problem is with a version MS XMLParser that is installed with
		//- earlier versions of IE.  We need XML Parser 2.5a or higher.
		//- Check for version of IE and prompt to upgrade IE if lower version found.
		//-----
		var objVer = GetMSIEVersion();
		if (objVer == null || objVer.MajorVersion < 5 ||
			(objVer.MajorVersion == 5 && objVer.MinorVersion == 0 && objVer.BuildVersion < 2919))
		{
			MHF_MessageBox(STR_UPGRADE_IE_MESSAGE, STR_UPGRADE_IE_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return null;
		}

		var pForm = PropertyList.OpenProperty(PROPERTY_FORM);
		var pComponentContainer = pForm.ComponentContainer;
		var WindowsManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");

		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = ParentWindow;
		WindowProperties.Resizable = true;
		WindowProperties.CaptionVisible = true;
		WindowProperties.Caption = "Project Report";
		WindowProperties.Visible = false;
		WindowProperties.InitialWidth = 750;
		WindowProperties.InitialHeight = 550;

		var Delegate = PrintDialog.OpenDelegateComponent();
		g_PrintMgr = Delegate.GetScriptDispatch();

		var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
		var PersistRoot = pStorageURISyntax.InstallDataRootPath;
		var Path = PersistRoot + "ToolData\\Groove.net\\GrooveProjectToolset\\ProjectTool";
		g_PrintMgr.SetDefaultReportFolder(Path);
		
		// Get the subform and script code
		var Window = WindowsManager.CreateGrooveWindowForForm
														(
															WindowAccount,
															"",
															WindowProperties,
															PrintDialog
														);
		//Create participant enum that will get passed to FilterSubForm
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		var Cache = null;
		try
		{
			Cache = PPH_GetContactNameURLMap(this.pIContactProvider);
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_RETRIEVINGCONTACTS);
			return null;
		}
		Cache.Add(GPT_S_UNASSIGNED, GPT_S_UNASSIGNED);
		Cache.Add(GPT_S_STATUS_ALL, GPT_S_STATUS_ALL);

		//Create Status enum that will get passed to FilterSubForm
		var StatusEnumCreate = CreateBSTREnum();
		var StatusArray = MHF_GetStatusArray();
		for(var i=0; i<StatusArray.length; i++)
		{
			StatusEnumCreate.Add(StatusArray[i]);
		}
		StatusEnumCreate.Add(GPT_S_STATUS_ALL);
		var StatusEnum = StatusEnumCreate.BSTREnum();

		//If you don't want to provide your custom Filter subform, you need
		// to connect to g_PrintMgr's Delegate Component. Use the following code:
		//
		//			ConnectObject(Delegate, "ProjectPrintFilterSubForm_");
		//
		//If you decide to provide your custom subform use the following:

		//Create FilterSubForm, swap layouts, and connect to FilterSubForm
		var FilterSubForm = pComponentContainer.OpenComponentByName("ProjectFilterSubForm");
		g_PrintMgr.SetFilterLayout(FilterSubForm);
		var FilterSubFormDelegate = FilterSubForm.OpenDelegateComponent();
		var FilterSubFormCode = FilterSubFormDelegate.GetScriptDispatch();

		//Fill out combo boxes
		FilterSubFormCode.FillContactsCB(Cache);

		var CurrentName;
		if(g_UIProjectParticipantsCC.UICommand.Label.indexOf(VIEW_PARTICIPANTS_DROPDOWN_LABEL) != -1)
			CurrentName = RightBack(g_UIProjectParticipantsCC.UICommand.Label, VIEW_PARTICIPANTS_DROPDOWN_LABEL);
		else
			CurrentName = g_UIProjectParticipantsCC.UICommand.Label;
		FilterSubFormCode.SetParticipantComboboxCurrentSelection(CurrentName);

		FilterSubFormCode.PopulateStatusCombobox(StatusEnum);
		FilterSubFormCode.SetStatusComboboxCurrentSelection(g_UIProjectStatusCC.UICommand.UserData);
		
		//Connect to the SubForm		
		ConnectObject(FilterSubFormDelegate, "ProjectPrintFilterSubForm_");

		g_PrintMgr.SetTreeViewHeight(70);

		Window.DoModal();
		g_PrintMgr = null;
		DisconnectObject(FilterSubFormDelegate);
		CloseWindow(Window);
	}
/*
	function ProjectViewClass_GenerateReport(i_pRootXMLElem, i_ParticipantURL, i_Status)
	{
		var pCollection = null;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);

		try
		{
			pCollection = this.pIDataModelDelegate.GetCollectionOfItemIDsForParticipantAndStatus
													(
														i_ParticipantURL == GPT_S_UNASSIGNED ? "" : i_ParticipantURL,
														MHF_GetStatusFilterEnumFromString(i_Status)
													);

			if(!pCollection.CollectionConfigure.HasView("ReportView"))
			{
				pCollection.CollectionConfigure.AddView("ReportView");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Name", "Name", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "AssignedToContactURL", "AssignedToContactURL", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "TeamLeaderContactURL", "ProjectLeaderContactURL", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledStart", "ScheduledStart", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledDuration", "ScheduledDuration", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledFinish", "ScheduledFinish", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Status", "Status", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Priority", "Priority", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Description", "Description", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
			}
			pCollection.CollectionConfigure.UseView("ReportView");

			var ProjDetailsID = this.pIDataModelDelegate.GetProjectID();
			var pProjectDetails = pCollection.OpenRecord(ProjDetailsID);
			var ProjXMLElement = this.AddSingleItemToXMLDoc(i_pRootXMLElem, pProjectDetails);

			var ChildIDsEnum = this.pIDataModelDelegate.GetChildIDEnum(ProjDetailsID, 1);

			this.InsertChildrenToXMLFromEnum(pCollection, ChildIDsEnum, ProjXMLElement, i_ParticipantURL, i_Status);

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_GENERATINGREPORT);
		}
	}

	function ProjectViewClass_InsertChildrenToXMLFromEnum(i_pCollection, i_ChildIDsEnum, i_ParentXMLElement, i_ParticipantURL, i_Status)
	{
		while(i_ChildIDsEnum.HasMore())
		{
			var ItemID = i_ChildIDsEnum.OpenNext();
			var pItem = i_pCollection.OpenRecord(ItemID);
			var ParentXMLElement = this.AddSingleItemToXMLDoc(i_ParentXMLElement, pItem);

			var ChildIDsEnum = this.pIDataModelDelegate.GetChildIDEnum(ItemID, 1);
			if(ChildIDsEnum.HasMore())
				this.InsertChildrenToXMLFromEnum(i_pCollection, ChildIDsEnum, ParentXMLElement, i_ParticipantURL, i_Status);
		}
	}
*/
	function ProjectViewClass_GenerateReport(i_pRootElem, i_ParticipantURL, i_Status)
	{
		var pCollection = null;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);

		try
		{
			pCollection = this.pIDataModelDelegate.GetCollectionOfItemIDsForParticipantAndStatus
													(
														i_ParticipantURL == GPT_S_UNASSIGNED ? "" : i_ParticipantURL,
														MHF_GetStatusFilterEnumFromString(i_Status)
													);

			if(!pCollection.CollectionConfigure.HasView("ReportView"))
			{
				pCollection.CollectionConfigure.AddView("ReportView");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Name", "Name", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "AssignedToContactURL", "AssignedToContactURL", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "TeamLeaderContactURL", "ProjectLeaderContactURL", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledStart", "ScheduledStart", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledDuration", "ScheduledDuration", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledFinish", "ScheduledFinish", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Status", "Status", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Priority", "Priority", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Description", "Description", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
			}
			pCollection.CollectionConfigure.UseView("ReportView");
			g_InsertedItemIDsMap = new CommonMap();

			var ProjDetailsID = this.pIDataModelDelegate.GetProjectID();
			pCollection.MoveCursorToRecord(ProjDetailsID);
			var pProjItem = pCollection.OpenRecord(ProjDetailsID);
			if(pProjItem)
			{
				var ProjXMLElement = this.AddSingleItemToXMLDoc(i_pRootElem, pProjItem);
				this.AddItemsToXMLFromCollection(ProjXMLElement, ProjDetailsID, pCollection, i_ParticipantURL, i_Status);
			}
			else
			{
				this.AddItemsToXMLFromCollection(i_pRootElem, ProjDetailsID, pCollection, i_ParticipantURL, i_Status);
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_GENERATINGREPORT);
		}
		pCollection = 0;
	}

	function ProjectViewClass_AddItemsToXMLFromCollection(i_ProjXMLElement, i_ProjDetailsID, i_pCollection, i_ParticipantURL, i_Status)
	{
		//Loop thru all the children
		if(i_pCollection != null && 0 != i_pCollection.GetRecordCount())
		{
			var pICursor = i_pCollection.GetCursor();

			for(var i = 0; i < i_pCollection.GetRecordCount(); ++i)
			{
				var pICollectionRecord = pICursor.OpenRecord();
				if(pICollectionRecord != null)
				{
					if(GPT_S_STATUS_ALL == i_ParticipantURL && GPT_S_STATUS_ALL == i_Status)
					{
						this.InsertItemWithParents(i_pCollection, i_ProjXMLElement, pICollectionRecord, i_ProjDetailsID, i_ParticipantURL, i_Status);
					}
					else
					{
						if(i_ProjDetailsID != pICollectionRecord.RecordID)
							this.AddSingleItemToXMLDoc(i_ProjXMLElement, pICollectionRecord);
					}
				}
				// increment cursor
				pICursor.MoveAdv(GrooveCollectionCursorPosition_Current, GrooveCollectionNavigationOp_NextAny, 1, GrooveCollectionNavigationOption_IncludeCollapsedRows);
			}
		}
	}

	function ProjectViewClass_InsertItemWithParents(i_pCollection, i_pParentXMLElem, i_pItem, i_ProjDetailsID, i_ParticipantURL, i_Status)
	{
		var VerifiedParentElem = g_InsertedItemIDsMap.FindByKey(i_pItem.RecordID);
		if(VerifiedParentElem)
			return VerifiedParentElem;

		var ParentElement = i_pParentXMLElem;
		var ParentID = i_pItem.OpenField("_ParentID");
		if(ParentID != -1)
		{
			if(typeof ParentID != "undefined" && ParentID != i_ProjDetailsID)
			{
				var pItem = i_pCollection.OpenRecord(ParentID);
				if(!pItem)
				{
					GrooveDebugFunctions.DisplayAssert(0, "Error in ProjectViewClass_InsertItemWithParents");
					return null;
				}
				ParentElement = this.InsertItemWithParents(i_pCollection, i_pParentXMLElem, pItem, i_ProjDetailsID, i_ParticipantURL, i_Status);
			}
		}
		var URL;
		i_ParticipantURL == GPT_S_UNASSIGNED ? URL = "" : URL = i_ParticipantURL;

		var RecordURL = null;
		if (i_pItem.HasField("AssignedToContactURL"))
			RecordURL = i_pItem.OpenField("AssignedToContactURL");
		if ((RecordURL == null) || (typeof RecordURL == "undefined"))
			RecordURL = i_pItem.OpenField("TeamLeaderContactURL");

		if(URL == RecordURL || GPT_S_STATUS_ALL == i_ParticipantURL)
		{
			var pElem = null;
			if(GPT_S_STATUS_ALL == i_Status || MHF_GetStatusFilterEnumFromString(i_Status) == i_pItem.OpenField("Status"))
				pElem = this.AddSingleItemToXMLDoc(ParentElement, i_pItem);
			return pElem;
		}
		return ParentElement;
	}

	function ProjectViewClass_AddSingleItemToXMLDoc(i_pParentXMLElem, i_pItem)
	{
		var pElem = i_pParentXMLElem.CreateElement("Task", i_pParentXMLElem);

		var pChildElem = pElem.CreateElement("TaskName", pElem);
		pChildElem.SetContent(0, i_pItem.OpenField("Name"), GrooveContentType_Text);

		var URL = null;
		if (i_pItem.HasField("AssignedToContactURL"))
			URL = i_pItem.OpenField("AssignedToContactURL");
		if ((URL == null) || (typeof URL == "undefined"))
			URL = i_pItem.OpenField("TeamLeaderContactURL");
		
		var ContactDisplayName = PHF_GetPersonNameForDisplay(this.pIContactProvider, URL);

		pChildElem = pElem.CreateElement("AssignedTo", pElem);
		pChildElem.SetContent(0, ContactDisplayName, GrooveContentType_Text);

		pChildElem = pElem.CreateElement("StartDate", pElem);
		pChildElem.SetContent(0, FormatDayAndDate(i_pItem.OpenField("ScheduledStart"), DATE_STYLE), GrooveContentType_Text);

		pChildElem = pElem.CreateElement("FinishDate", pElem);
		var Finish = PHF_GetFinishDateForDisplay(i_pItem.OpenField("ScheduledDuration"), i_pItem.OpenField("ScheduledFinish"))
		pChildElem.SetContent(0, FormatDayAndDate(Finish, DATE_STYLE), GrooveContentType_Text);

		pChildElem = pElem.CreateElement("Status", pElem);
		pChildElem.SetContent(0, MHF_GetStatusFilterStringFromEnum(i_pItem.OpenField("Status")), GrooveContentType_Text);

		var Priority = null;
		if (i_pItem.HasField("Priority"))
			Priority = i_pItem.OpenField("Priority");
		if ((Priority != null) && (typeof Priority != "undefined"))
		{
			pChildElem = pElem.CreateElement("Priority", pElem);
			pChildElem.SetContent(0, MHF_GetPriorityStringFromEnum(Priority), GrooveContentType_Text);
		}

		var DescriptionText = "";
		var DescriptionElement = i_pItem.OpenFieldAsElement("Objective");
		if(DescriptionElement == null)
			DescriptionElement = i_pItem.OpenFieldAsElement("Description");

		if(typeof DescriptionElement != "undefined" && DescriptionElement != null && DescriptionElement.DoesAttributeExist("Text"))
			DescriptionText = DescriptionElement.OpenAttribute("Text");

		pChildElem = pElem.CreateElement("Description", pElem);
		pChildElem.SetContent(0, DescriptionText, GrooveContentType_Text);

		pChildElem = pElem.CreateElement("ID", pElem);
		pChildElem.SetContent(0, i_pItem.RecordID, GrooveContentType_Text);

		pChildElem = pElem.CreateElement("ParentID", pElem);
		pChildElem.SetContent(0, i_pItem.OpenField("_ParentID"), GrooveContentType_Text);

		g_InsertedItemIDsMap.Add(i_pItem.RecordID, pElem);

		return pElem;
	}

	function ProjectPrintFilterSubForm_OnFilter(i_XSLPath, i_Status, i_ParticipantName, i_bGenerateNewXML)
	{
		var XSLFileName = GetXSLFileNameFromPath(i_XSLPath);
		if(typeof XSLFileName != "undefined" && XSLFileName != null && XSLFileName != "")
		{
			if(!i_bGenerateNewXML)
			{
				g_PrintMgr.SetXMLDocument(null, i_XSLPath, XSLFileName);
				return;
			}

			var pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
			var pXMLDoc = pSM.CreateTemporaryXMLDocument("ProjectTool");
			var pRootElem = pXMLDoc.OpenRootElement();
			pRootElem.SetName("ProjectToolReport");

			g_CurrentView.GenerateReport(pRootElem, i_ParticipantName, i_Status);
			g_PrintMgr.SetXMLDocument(pXMLDoc, i_XSLPath, XSLFileName);
		}
	}

	function GetXSLFileNameFromPath(i_XSLPath)
	{
		var Style = RightBack(i_XSLPath, "\\");
		var Type = LeftBack(i_XSLPath, "\\");
		Type = RightBack(Type, "\\");
		var XSLFileName = g_StylesMap.FindByKey(Type + Style);
		var FSS = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
		if(XSLFileName == "" || XSLFileName == null)
		{
			if(FSS.DoesFileExist(i_XSLPath + "\\" + Style + ".xsl"))
				XSLFileName = Style + ".xsl";
			else
				if(FSS.DoesFileExist(i_XSLPath + "\\" + "Default.xsl"))
					XSLFileName = "Default.xsl";
		}
		return XSLFileName;
	}

	//**** End of Reporting ****

	function ProjectViewClass_GetItemFromID(i_ID)
	{
		var pItem = null;

		if(!this.pIDataModelDelegate.DoesItemExist(i_ID))
			return pItem;

		switch(this.pIDataModelDelegate.GetItemType(i_ID))
		{
			case GrooveProjectTrackingItemType_Invalid:
				break;
			case GrooveProjectTrackingItemType_Project:
				pItem = this.pIDataModelDelegate.GetProject();
				break;
			case GrooveProjectTrackingItemType_Task:
				pItem = this.pIDataModelDelegate.GetTask(i_ID);
				break;
		}
		return pItem;
	}

	function ProjectViewClass_NotifyUserOfItemChange()
	{
		MHF_MessageBox(STR_ITEMREPLACED_MESSAGE, STR_ITEMREPLACED_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
	}


	function ProjectViewClass_OnSaveTemplate()
	{
		// set default filename
		var SaveTemplateHost = SaveTemplateSubForm.OpenDelegateComponent();
		var SaveTemplateCode = SaveTemplateHost.GetScriptDispatch();
		var pIFileServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

		// look for last directory
		var ToolName = PropertyList.OpenProperty(PROPERTY_TOOL_DISPLAY_NAME);
		var pITelespaceElmnt = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var SpaceName = pITelespaceElmnt.DisplayName;
		var SuggestedFileName;

		if (PropertyList.PropertyExists(ToolName + "LastDirectory"))
		{
			SuggestedFileName = PropertyList.OpenProperty(ToolName +"LastDirectory") + "\\";
		}
		else
		{
			SuggestedFileName = pIFileServices.OpenPersonalFilesFolderPath() + "\\";
		}

		// strip out any invliad filename characters
		SuggestedFileName += pIFileServices.GenerateValidFilename(SpaceName);
		SuggestedFileName += ".grv";


		// pre-fill dialog
		SaveTemplateCode.PutFileName(SuggestedFileName);

		// prompt user
		var pIWindow = MHF_CreateDialogBox(SaveTemplateSubForm, STR_SAVETEMPLATE_TITLE, 500,350, false);
		if(GrooveDialogBoxResultCode_OK != pIWindow.DoModal())
		{
			pIWindow.Destroy();
			return;
		}

		// verify there's work to do
		if(false == (SaveTemplateCode.GetSaveProjectName() || SaveTemplateCode.GetSaveObjectiveName() ||
					 SaveTemplateCode.GetSaveCalcMode() || SaveTemplateCode.GetSaveMembers() ||
					 SaveTemplateCode.GetSaveTasks()))
		{
			GrooveDebugFunctions.DisplayAssert(0, "No work to do");
			return;
		}

		var OutputFileName = SaveTemplateCode.GetFileName();

		// verify extension
		if (OutputFileName.lastIndexOf(".grv") == -1) 
		{
			OutputFileName = OutputFileName + ".grv";
		}

		// remember selected directory
		var strPath = LeftBack(OutputFileName, "\\");
		PropertyList.SetProperty(ToolName + "LastDirectory", strPath, GroovePropertyFlag_Private);


		// serialize project info?
		// always include predecessor information when saving as a template
		// always include project start so user can shift the project correctly
		var SerializeFlags = GrooveProjectTrackingSerializeFlags_Predecessors | 
							 GrooveProjectTrackingSerializeFlags_ProjectStart;

		if(true == SaveTemplateCode.GetSaveProjectName())
		{
			SerializeFlags |= GrooveProjectTrackingSerializeFlags_ProjectName;
		}

		if(true == SaveTemplateCode.GetSaveObjectiveName())
		{
			SerializeFlags |= GrooveProjectTrackingSerializeFlags_ProjectObjective;
		}

		// Serialize -- this may take a while
		this.ShowWaitCursor(true);

	
		// requires WRITE transaction
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		
		try
		{
			var Time = new Date;
			var NSP = "urn:groove.net:";

			// make sure we can open the output file
			var pIByteStream = CreateByteOutputStreamFromFile(OutputFileName);

			// build the injectable fragment
			var pIInjectorWrapperElmnt = CreateNewElement(NSP + "InjectorWrapper");
			pIInjectorWrapperElmnt.SetAttribute("AccountGUID", "grooveIdentity:///DefaultIdentity");
			pIInjectorWrapperElmnt.SetAttribute("MessageID", "GPTSeededSpace");
			pIInjectorWrapperElmnt.SetAttribute("ResourceURL", "grooveIdentityMessage:///ToolMessage;Version=4,0,0,0");
			pIInjectorWrapperElmnt.SetAttribute("LocalDeviceURLs", "Injector");

			var pIIdentityMsgHeaderElmnt = pIInjectorWrapperElmnt.CreateElement(NSP + "IdentityMessageHeader", pIInjectorWrapperElmnt);
			var pIMsgHeaderElmnt = pIIdentityMsgHeaderElmnt.CreateElement(NSP + "MessageHeader", pIIdentityMsgHeaderElmnt);
			pIMsgHeaderElmnt.SetAttribute("MessageType", "ToolMessage");
			pIMsgHeaderElmnt.SetAttribute("MessageID", "GPTSeededSpace");
			pIMsgHeaderElmnt.SetAttribute("Version", "1,1,0,0");
			pIMsgHeaderElmnt.SetAttribute("CreationTime", Time.valueOf());

			var pISenderContactElmnt = pIMsgHeaderElmnt.CreateElement(NSP + "SenderContact", pIMsgHeaderElmnt);
			var pIRecipientContactElmnt = pIMsgHeaderElmnt.CreateElement(NSP + "RecipientContact", pIMsgHeaderElmnt);

			var pIMessageBodyElmnt = pIIdentityMsgHeaderElmnt.CreateElement(NSP + "MessageBody", pIIdentityMsgHeaderElmnt);
			pIMessageBodyElmnt.SetAttribute("BodyName", "MessageBody");

			var pIToolMessageElmnt = pIMessageBodyElmnt.CreateElement(NSP + "ToolMessage", pIMessageBodyElmnt);
			var pIToolMessageHeaderElmnt = pIToolMessageElmnt.CreateElement(NSP + "ToolMessageHeader", pIToolMessageElmnt);
			pIToolMessageHeaderElmnt.SetAttribute("ToolURL", "grooveAccountTool:;CategoryName=grooveToolCategory://Account/TelespaceProvider,ComponentName=Injector");

			var pIToolMessageBodyElmnt = pIToolMessageElmnt.CreateElement(NSP + "ToolMessageBody", pIToolMessageElmnt);
			var pITelespaceElmnt = pIToolMessageBodyElmnt.CreateElement(NSP + "Telespace", pIToolMessageBodyElmnt);
			pITelespaceElmnt.SetAttribute("DisplayName", PropertyList.OpenProperty(PROPERTY_TELESPACE).DisplayName);
			pITelespaceElmnt.SetAttribute("Visible", "1");
			pITelespaceElmnt.SetAttribute("DeleteOnRelease", "0");
			pITelespaceElmnt.SetAttribute("Description", PropertyList.OpenProperty(PROPERTY_TELESPACE).Description);

			var pIToolsElmnt = pITelespaceElmnt.CreateElement(NSP + "Tools", pITelespaceElmnt);
			var pIToolSetTemplateElmnt = pIToolsElmnt.CreateElement(NSP + "ToolSetTemplate", pIToolsElmnt);

			// prepare for project tool serialization
			// build a list of IDs for all items in the project
			var pIProject = this.pIDataModelDelegate.GetProject();

			// build a list containing all top-level items
			var pIRecordIDEnum = pIRecordIDEnum = this.pIDataModelDelegate.GetChildIDEnum(pIProject.ID, 1 /* one level only */);

			// serialize the template for each tool in the space
			var pIToolContainer = PropertyList.OpenProperty(PROPERTY_TOOL_CONTAINER);
			var pIToolDescriptorEnum = pIToolContainer.CreateToolDescriptorEnum();
			var NameMap = new CommonMap;

			while(pIToolDescriptorEnum.HasMore())
			{
				var pIToolDescriptor = pIToolDescriptorEnum.OpenNext();

				// if we have not yet processed a tool with this name
				if(null == NameMap.FindByValue(pIToolDescriptor.Name))
				{
					this.SerializeToolTemplate
								(
									pIToolSetTemplateElmnt, 
									pIToolDescriptor, 
									pIRecordIDEnum,
									true, // serialize all children
									SerializeFlags,
									NameMap
									);
				}
			}


			Transaction.Commit();

			// serialize the injectable
			pIInjectorWrapperElmnt.SerializeToStream
										(
											pIByteStream, 
											GrooveSerializeType_XML, 
											GrooveCharEncodingType_UTF8, 
											GrooveSerializeOption_Default
										);

			pIByteStream.Close();

		}
		catch(e)
		{
			Transaction.Abort();
			pIByteStream.Close();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_SAVINGTEMPLATE);
		}

		pIWindow.Destroy();
		this.ShowWaitCursor(false);
	}


	function ProjectViewClass_SerializeToolTemplate(i_pIParentElement, 
													i_pIToolDescriptor,
													i_pISerializeItemIDEnum,
													i_SerializeAllChildren,
													i_SerializeFlags,
													i_SerializedNameMap)
	{
		var pICurrentElement;
		var NSP = "urn:groove.net:";

		if(PropertyList.OpenProperty(PROPERTY_TOOL_NAME) == i_pIToolDescriptor.Name)
		{
			pICurrentElement = this.pIDataModelDelegate.SaveAsTemplate
															(
																i_pIParentElement, 
																i_pISerializeItemIDEnum, 
																i_SerializeAllChildren, 
																i_SerializeFlags
															);

			// AMHACK - there is a bug in the DMD which is basically that we always use
			// the tool template descriptor and not the tool descriptor of the tool container
			// This means that when the tool is used in a toolset, we get the wrong category
			// which prevents the contact provider component from hooking up to our tool,
			// which prevents us from hearing about changes to the contact tool.  As a workaround,
			// we fix them up here.  The right thing to do is (in the future), pass the tool
			// descriptor as an argument to SaveAsTemplate().
			pICurrentElement.SetAttribute("URL", i_pIToolDescriptor.TemplateDescriptor.ComponentResourceURL);
			pICurrentElement.SetAttribute("Category", i_pIToolDescriptor.Category);
			pICurrentElement.SetAttribute("DisplayType", i_pIToolDescriptor.DisplayType);
			pICurrentElement.SetAttribute("Name", i_pIToolDescriptor.Name);
			pICurrentElement.SetAttribute("DisplayName", i_pIToolDescriptor.DisplayName);
		}
		else
		{
			pICurrentElement = i_pIParentElement.CreateElement(NSP + "Template", i_pIParentElement);
			pICurrentElement.SetAttribute("URL", i_pIToolDescriptor.TemplateDescriptor.ComponentResourceURL);
			pICurrentElement.SetAttribute("Category", i_pIToolDescriptor.Category);
			pICurrentElement.SetAttribute("DisplayType", i_pIToolDescriptor.DisplayType);
			pICurrentElement.SetAttribute("Name", i_pIToolDescriptor.Name);
			pICurrentElement.SetAttribute("DisplayName", i_pIToolDescriptor.DisplayName);
		}

		// remember that we processed this one already
		i_SerializedNameMap.Add(i_SerializedNameMap.GetCount(), i_pIToolDescriptor.Name);
		
		// look for children
		var pIToolContainer = PropertyList.OpenProperty(PROPERTY_TOOL_CONTAINER);
		var pIToolDescriptorEnum = pIToolContainer.CreateToolDescriptorEnum();
		while(pIToolDescriptorEnum.HasMore())
		{
			var pIChildToolDescriptor = pIToolDescriptorEnum.OpenNext();
			if(i_pIToolDescriptor.Name == pIChildToolDescriptor.OwnerName)
			{
				this.SerializeToolTemplate
					(
						pICurrentElement, 
						pIChildToolDescriptor, 
						i_pISerializeItemIDEnum,
						i_SerializeAllChildren,
						i_SerializeFlags,
						i_SerializedNameMap
					);
			}
		}
	}

	// How to use URL Navigation
	//
	//	var ItemID = this.GetSelectedItem().ID;
	//	var IdentityURL = PropertyList.OpenProperty(PROPERTY_CURRENT_IDENTITY_URL);
	//	var ItemCanonicalURL = this.GetItemURL(ItemID);
	//	var pITelespaceElmntURLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.TelespaceURLSyntax");
	//	var ItemBindableURL = pITelespaceElmntURLSyntax.CreateBindableURL(ItemCanonicalURL, IdentityURL);
	//	
	//	var pIURLNavigator = UIPropertyList.OpenProperty(UIPROPERTY_URLNAVIGATOR);
	//	pIURLNavigator.NavigateToURL(ItemBindableURL, false);
	//
	//
	function ProjectViewClass_GetItemURL(i_ID)
	{
		var CanonicalURL = PropertyList.OpenProperty(PROPERTY_CANONICAL_URL);
		var pIURI = GROOVE_GLOBAL_MISC_POINTER.OpenURI(CanonicalURL);
		pIURI.SetQueryPart("ItemID", i_ID);
		return pIURI.String;
	}

	function ProjectViewClass_ShowItem(i_ID)
	{
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		var ItemType = GrooveProjectTrackingItemType_Invalid;
		var ParentItemType = GrooveProjectTrackingItemType_Invalid;
		var pIItem = null;
		var pIParentItem = null;
		var ContainerType = GrooveProjectTrackingItemType_Invalid;
		var pIContainer = null;

		try
		{
			if(this.pIDataModelDelegate.DoesItemExist(i_ID))
			{
				ItemType = this.pIDataModelDelegate.GetItemType(i_ID);
				pIItem = this.GetItem(i_ID, ItemType);

				if(ItemType != GrooveProjectTrackingItemType_Project)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(pIItem.ParentID);
					pIParentItem = this.GetItem(pIItem.ParentID, ParentItemType);
				}
			}
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_SHOWINGITEM);
			return;
		}

		// if the item exists, 
		if(null != pIItem)
		{
			if(State_EditMode == this.CurrentMode)
			{
				if(this.DetailsView.HasChanged())
				{
					var Response = this.PromptUserToSaveChanges();
					if(GrooveMessageBoxResultCode_Yes == Response)
					{
						if(false == this.Save())
							return;
					}
					else if(GrooveMessageBoxResultCode_Cancel == Response)
					{
						return;
					}
				}
				this.SetSelectedItem(pIItem, ItemType, pIParentItem, ParentItemType);
				this.DataViewerControl.SelectSingleRow(i_ID, true, true);
				this.RefreshSelectedItem();
				this.EnterViewMode();
				return;
			}

			// update the UI
			this.SetSelectedItem(pIItem, ItemType, pIParentItem, ParentItemType);
			this.RefreshSelectedItem();

			// navigate to the item
			// AMLATER - the navigation is handled in the OnTimerNavigateToItem
			// handler to work around a bug in DataView
			this.NavigateToItemID = pIItem.ID;
			NavigationHackTimer.Start();
		}
		else
		{
			this.NotifyUserOfItemRemoval();
		}
	}

	function IsMicrosoftProjectInstalled()
	{
		//	This is a quick registry check for the installation of MS Project.
		var ProjectCurVer = App.ReadRegistryValue (GrooveRegistryKeyValue_ClassesRoot, "MSProject.Application\\CurVer", "");
		return (typeof ProjectCurVer == "string");
	}

	function ProjectViewClass_OnImportFromMSProject()
	{
		GrooveDebugFunctions.DisplayAssert(State_ViewMode == this.CurrentMode, "Cannot import while in edit mode");

		if (!IsMicrosoftProjectInstalled())
		{
			//	MS Project is not installed.  Report and return.
			PHF_AlertUser(STR_PROJECTNOTAVAILABLE_MESSAGE);
			return;
		}

		var pIComponentContainer = PropertyList.OpenProperty(PROPERTY_COMPONENT_CONTAINER).ComponentContainer;
		if(false == pIComponentContainer.IsComponentDefined("MSProjectBridge"))
			GrooveDebugFunctions.DisplayAssert(false, "Missing MS-Project bridge");

		var pMSProjectPumpUICode;
		try
		{
			pMSProjectPumpUICode = pIComponentContainer.
				OpenComponentByName("MSProjectBridge").
				OpenDelegateComponent().
				GetScriptDispatch();
		}
		catch(e)
		{
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MSPROJECTIMPORT);
			return;
		}

		// This guy will handle his errors himself 
		var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var pITool = PropertyList.OpenProperty(PROPERTY_TOOL).Tool;
		var pDataDelegate = pITool.OpenDelegateComponent();
		
		pMSProjectPumpUICode.StartImport(pWindow, pDataDelegate);

		// force a refresh of the dataviewer
		var CurrentSort = this.ModelGlue.Collection.GetCurrentSort();
		var RefreshSort = CurrentSort == "ByOrdinal" ? "ByName" : "ByOrdinal";
		this.ModelGlue.Collection.UseNamedSort(RefreshSort, true);
		this.ModelGlue.Collection.UseNamedSort(CurrentSort, true);
	}

	function ProjectViewClass_OnExportToMSProject()
	{
		GrooveDebugFunctions.DisplayAssert(State_ViewMode == this.CurrentMode, "Cannot export while in edit mode");

		if (!IsMicrosoftProjectInstalled())
		{
			//	MS Project is not installed.  Report and return.
			PHF_AlertUser(STR_PROJECTNOTAVAILABLE_MESSAGE);
			return;
		}

		var pIComponentContainer = PropertyList.OpenProperty(PROPERTY_COMPONENT_CONTAINER).ComponentContainer;
		if(false == pIComponentContainer.IsComponentDefined("MSProjectBridge"))
			GrooveDebugFunctions.DisplayAssert(false, "Missing MS-Project bridge");

		var pMSProjectPumpUICode;
		try
		{
			pMSProjectPumpUICode = pIComponentContainer.
				OpenComponentByName("MSProjectBridge").
				OpenDelegateComponent().
				GetScriptDispatch();
		}
		catch(e)
		{
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MSPROJECTEXPORT);
			return;
		}

		// This guy will handle his errors himself 
		var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var pITool = PropertyList.OpenProperty(PROPERTY_TOOL).Tool;
		var pDataDelegate = pITool.OpenDelegateComponent();

		pMSProjectPumpUICode.StartExport(pWindow, pDataDelegate);
	}

	function ProjectViewClass_ShowWaitCursor(i_bShow)
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor(i_bShow);
	}


	function ProjectViewClass_RefreshACLCache()
	{
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		var WaitCursorThreshold = 2;
		var NeedWaitCursor = false;

		try
		{
			// Initinialize ACL cache
			this.CanMoveUp = false;
			this.CanMoveDown = false;
			this.CanDelete = false;
			this.CanPromote = false;
			this.CanDemote = false;
			this.CanCreateTask = false;
			this.CanEdit = false;
			this.CanImport = false;
			this.CanCut = false;

			// Get the currently selected ID			
			var ID = this.GetSelectedItem().ID;

			// Does the selected item exist?
			if (this.pIDataModelDelegate.DoesItemExist(ID))
			{
				// Deletion and repositioning (check all selected items)
				IDEnum = this.GetSelectionEnum();
				if (IDEnum)
				{
					// If the selection contains parent and child items, we only
					// need to consider the parent items since the operation will
					// automatically be applied to the children
					// AMLATER - move this function out of datamodel helper functions
					IDEnum = PDHF_RemoveRedundantDecendants(IDEnum);

					// enough items selected that we need a wait cursor?
					var i = 0;
					while(IDEnum.HasMore())
					{
						IDEnum.OpenNext();
						i++;
						if(i >= WaitCursorThreshold)
						{
							NeedWaitCursor = true;
							break;
						}
					}
					IDEnum.Reset();

					if(true == NeedWaitCursor)
					{
						this.ShowWaitCursor(true);
					}

					// Empty selection?
					if(true == IDEnum.HasMore())
					{
						// Setup temp values, (must be true for AND to work)
						var bCanMoveUp = true;
						var bCanMoveDown = true;
						var bCanDelete = true;
						var bCanPromote = true;
						var bCanDemote = true;

						while(IDEnum.HasMore())
						{
							var SelectedID = IDEnum.OpenNext();

							if(this.pIDataModelDelegate.DoesItemExist(SelectedID))
							{
								bCanDelete &= this.pIDataModelDelegate.CanDeleteItem(SelectedID);
								bCanMoveUp &= this.pIDataModelDelegate.CanMoveItemUp(SelectedID);
								bCanMoveDown &= this.pIDataModelDelegate.CanMoveItemDown(SelectedID);
								bCanPromote &= this.pIDataModelDelegate.CanPromoteItem(SelectedID);
								bCanDemote &= this.pIDataModelDelegate.CanDemoteItem(SelectedID);
							}
						}

						// Update 
						this.CanDelete = bCanDelete;
						this.CanMoveUp = bCanMoveUp;
						this.CanMoveDown = bCanMoveDown;
						this.CanPromote = bCanPromote;
						this.CanDemote = bCanDemote;
					}

					// Need delete priv to cut
					this.CanCut = this.CanDelete;

					// Edit button
					this.CanEdit = this.pIDataModelDelegate.CanReplaceItem(ID);
				}
			}

			// Add task
			this.CanAddTask = this.pIDataModelDelegate.CanAddItem(GrooveProjectTrackingItemType_Task);

			// Import from MSProject
			this.CanImport = this.pIDataModelDelegate.CanAddItem(GrooveProjectTrackingItemType_Task) &&
							 this.pIDataModelDelegate.CanReplaceItem(this.ProjectID);

			Transaction.Commit();

			if(true == NeedWaitCursor)
			{
				this.ShowWaitCursor(false);
			}
		}
		catch(e)
		{
			Transaction.Abort();

			if(true == NeedWaitCursor)
			{
				this.ShowWaitCursor(false);
			}

			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_REFRESHACLCACHE);
		}
	}

	function ProjectViewClass_CheckACLItem(i_AclItem)
	{
		var bReturn = false;
		var WaitCursorThreshold = 2;
		var NeedWaitCursor = false;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);

		try
		{
			if (g_CAN_ADD_TASK == i_AclItem)
			{
				bReturn = this.pIDataModelDelegate.CanAddItem(GrooveProjectTrackingItemType_Task);
				Transaction.Commit();
				return bReturn;
			}

			var ID = this.GetSelectedItem().ID;
			if(this.pIDataModelDelegate.DoesItemExist(ID))
			{
				if (g_CAN_EDIT == i_AclItem)
				{
					bReturn = this.pIDataModelDelegate.CanReplaceItem(ID);
				}
				else
				{
					// Deletion and repositioning (check all selected items)
					IDEnum = this.GetSelectionEnum();

					// If the selection contains parent and child items, we only
					// need to consider the parent items since the operation will
					// automatically be applied to the children
					// AMLATER - move this function out of datamodel helper functions
					IDEnum = PDHF_RemoveRedundantDecendants(IDEnum);

					// enough items selected that we need a wait cursor?
					var i = 0;
					while(IDEnum.HasMore())
					{
						IDEnum.OpenNext();
						i++;
						if(i >= WaitCursorThreshold)
						{
							NeedWaitCursor = true;
							break;
						}
					}
					IDEnum.Reset();

					if(true == NeedWaitCursor)
					{
						this.ShowWaitCursor(true);
					}

					// Empty selection?
					if(true == IDEnum.HasMore())
					{
						// Must be true for AND to work
						var bCanDo = true;

						while(IDEnum.HasMore())
						{
							var SelectedID = IDEnum.OpenNext();
							if(this.pIDataModelDelegate.DoesItemExist(SelectedID))
							{
								switch(i_AclItem)
								{
									case g_CAN_MOVE_UP:
										bCanDo &= this.pIDataModelDelegate.CanMoveItemUp(SelectedID);
										break;

									case g_CAN_MOVE_DOWN:
										bCanDo &= this.pIDataModelDelegate.CanMoveItemDown(SelectedID);
										break;

									case g_CAN_CUT:   // Need delete priv to cut
									case g_CAN_DELETE:
										bCanDo &= this.pIDataModelDelegate.CanDeleteItem(SelectedID);
										break;

									case g_CAN_PROMOTE:
										bCanDo &= this.pIDataModelDelegate.CanPromoteItem(SelectedID);
										break;

									case g_CAN_DEMOTE:
										bCanDo &= this.pIDataModelDelegate.CanDemoteItem(SelectedID);
										break;
								}
							}

							// If we have a negative result we can break out of the loop
							if (!bCanDo)
								break;
						}
					}
		
					// Set the return value
					bReturn = bCanDo;
				}
			}

			Transaction.Commit();

			if(true == NeedWaitCursor)
			{
				this.ShowWaitCursor(false);
			}
		}
		catch(e)
		{
			Transaction.Abort();

			if(true == NeedWaitCursor)
			{
				this.ShowWaitCursor(false);
			}

			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_REFRESHACLCACHE);
		}


		// Return result
		return bReturn;
	}

	// AMLATER - hack to work around bug in DataViewer
	function ProjectViewClass_OnTimerNavigateToItem()
	{
		NavigationHackTimer.Stop();

		if(-1 != this.NavigateToItemID)
		{
			// AMLATER - HACK - BREAKING RECORDID ENCAPSULATION
			this.ModelGlue.Cursor.MoveCursorToRecord(this.NavigateToItemID);
			this.DataViewerControl.SelectSingleRow(this.NavigateToItemID);
			DataViewContainer.SetFocus("DataViewerControl");

			// done navigating
			this.NavigateToItemID = -1;
		}

	}

	//xxx BBLATER -hack to work around platform issue: we cannot display
	// modal dialogs in response to an async engine event :(
	function ProjectViewClass_OnTimerItemReplaced()
	{
		ItemReplacedHackTimer.Stop();
		
		// Set notified state and notify the user.
		this.UserNotifiedOfChange = true;
		this.NotifyUserOfItemChange();
	}

	//
	// AMLATER - hack to work around platform issue: we cannot display
	// modal dialogs in response to an async engine event :(
	//
	function ProjectViewClass_OnTimerShowConfigDialog()
	{
		ConfigDialogHackTimer.Stop();
		this.ShowConfigDialog();
	}

	function ProjectViewClass_MarkSelectedRead(i_Read)
	{
		this.ShowWaitCursor(true);
		var IDEnum = this.GetSelectionEnum();

		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			while(IDEnum.DoubleEnum.HasMore())
			{
				var ID = IDEnum.DoubleEnum.OpenNext();
				if(this.pIDataModelDelegate.DoesItemExist(ID))
				{
					this.pIDataModelDelegate.MarkRead(ID, i_Read);
				}
			}

			pIDelta.Commit();
			this.ShowWaitCursor(false);
		}
		catch(e)
		{
			pIDelta.Abort();
			this.ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKINGREAD);
		}
	}

	function ProjectViewClass_MarkAllRead(i_Read)
	{
		this.ShowWaitCursor(true);

		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			this.pIDataModelDelegate.MarkAllRead(i_Read);
			pIDelta.Commit();
			this.ShowWaitCursor(false);
		}
		catch(e)
		{
			pIDelta.Abort();
			this.ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKINGREAD);
		}
	}


	function ProjectViewClass_NavigatePrevUnread()
	{
		this.NavigateToDocument(GrooveModelGlueCursorMove_PriorUnread);
		this.OnListSelectionChanged();
	}

	function ProjectViewClass_NavigateNextUnread()
	{
		this.NavigateToDocument(GrooveModelGlueCursorMove_NextUnread);
		this.OnListSelectionChanged();
	}

	function ProjectViewClass_NavigateToDocument(i_Direction)
	{
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			var SelectedItemID = this.GetSelectedItem().ID;
			if(this.ModelGlue.Cursor.MoveCursor(i_Direction))
			{
				var RecordID = this.ModelGlue.Cursor.GetCurrentRecordID();
				this.DataViewerControl.SelectSingleRow(RecordID);

				var Item, ItemType, ParentItem, ParentItemType;
				ItemType = this.pIDataModelDelegate.GetItemType(RecordID);
				Item = this.GetItem(RecordID, ItemType);

				if(ItemType == GrooveProjectTrackingItemType_Project)
				{
					ParentItem = null;
					ParentItemType = GrooveProjectTrackingItemType_Invalid;
				}
				else
				{
					var ParentID = Item.ParentID;
					ParentItemType = this.pIDataModelDelegate.GetItemType(ParentID);
					ParentItem = this.GetItem(ParentID, ParentItemType);
				}
				this.SetSelectedItem(Item, ItemType, ParentItem, ParentItemType);
			}
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
		}
	}

	function ProjectViewClass_OnRoleChanged(i_ScopeURL, i_ObjectID, i_ChildType, i_RoleName, i_MemberContactURLOrParentRoleName, i_ChangeType)
	{
		// remember to check access control when updatng the UI
		this.UINeedsACLCheck = true;
	}

	function ProjectViewClass_GetSelectionEnum()
	{
		return this.DataViewerControl.GetIDsOfSelectedRows();
	}


	function ProjectViewClass_GetReversedSelectionEnum()
	{
		var SelectionEnum = this.GetSelectionEnum();
		var SelectionArray = new Array;
		var i = 0;

		// store in a temp array
		while(SelectionEnum.HasMore())
		{
			SelectionArray[i++] = SelectionEnum.OpenNext();	
		}

		// push into an enum in reverse order
		var ReversedEnum = CreateDoubleEnum();
		for(i = SelectionArray.length-1; i >= 0; --i)
		{
			ReversedEnum.Add(SelectionArray[i]);
		}

		return ReversedEnum.DoubleEnum;
	}

	function ProjectViewClass_OnCopyAsLink()
	{
		SetClipboardEmpty();
		CopyAsLinkToClipboard(this.GetItemURL(this.GetSelectedItem().ID), this.GetSelectedItem().Name);
	}

	function ProjectViewClass_OnCopy()
	{
		this.GetClipboard().SetEmpty();

		var IDEnum = this.GetSelectionEnum();
		var ParentIDCreateEnum = CreateDoubleEnum();

		// be defensive, UI command state should prevent this
		if(this.IsProjectInEnum(IDEnum))
		{
			GrooveDebugFunctions.DisplayAssert(0, "Cannot copy the project item");
			return;
		}

		// requires a WRITE transaction
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		var pIByteStore = CreateMemoryByteStore();
		
		// this may take a while
		MHF_ShowWaitCursor(true);

		try
		{
			// AMLATER - VERIFY ALL ITEMS IN IDENUM EXISTS!!

			// create an in-memory byte store to hold the serialized items
			var pIBOS = pIByteStore.OpenByteOutputStream(false /* dont append */);
			this.pIDataModelDelegate.SerializeItemsToStream(IDEnum.DoubleEnum, true /* include children */, pIBOS, GrooveProjectTrackingSerializeFlags_Attachments);

			Transaction.Commit();
		}
		catch(e)
		{
			MHF_ShowWaitCursor(false)
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_COPY);
			return;
		}

		// copy the stream to the clipboard
		this.GetClipboard().SetDataAsBinary(PROJECTITEM_CLIPBOARDFORMAT, pIByteStore.OpenByteInputStream());

		// hide wait cursor
		MHF_ShowWaitCursor(false);
	}

	function ProjectViewClass_OnPaste()
	{
		var ParentID;
		var PrevSiblingID;

		// be defensive, UI command state should prevent this
		if (!this.GetClipboard().IsDataAvailable(PROJECTITEM_CLIPBOARDFORMAT))
		{
			GrooveDebugFunctions.DisplayAssert(0, "No data is available");
			return;
		}

		// if the project item is selected, paste to the beginning
		if(this.GetSelectedItemType() == GrooveProjectTrackingItemType_Project)
		{
			ParentID = this.GetSelectedItem().ID;
			PrevSiblingID = 0;
		}
		else
		{
			ParentID = this.GetSelectedItem().ParentID;
			PrevSiblingID = this.GetSelectedItem().ID;
		}

		var BIS = this.GetClipboard().OpenDataAsBinary(PROJECTITEM_CLIPBOARDFORMAT);
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();

		// show wait cursor
		MHF_ShowWaitCursor(true);

		try
		{
			this.pIDataModelDelegate.InsertItemsFromStream(ParentID, PrevSiblingID, BIS, this.GetProgressInterface());
			pIDelta.Commit();
		}
		catch(e)
		{
			MHF_ShowWaitCursor(false);
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_PASTE);
			return;
		}

		// hide wait cursor
		MHF_ShowWaitCursor(false);
	}

	function ProjectViewClass_OnCut()
	{
		var IDEnum = this.GetSelectionEnum();

		// be defensive, UI command state should prevent this
		if(this.IsProjectInEnum(IDEnum))
		{
			GrooveDebugFunctions.DisplayAssert(0, "Cannot cut the project item");
			return;
		}

		// show wait cursor
		MHF_ShowWaitCursor(true);

		// copy the items to the clipboard
		this.OnCopy();

		// delete the items
		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			this.pIDataModelDelegate.DeleteMultipleItems(IDEnum, this.GetProgressInterface());
			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_CUT);
		}

		// hide wait cursor
		MHF_ShowWaitCursor(false);
	}


	function ProjectViewClass_GetClipboard()
	{
		var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
		return pUIManager.OpenClipboard();
	}

	function ProjectViewClass_IsProjectInEnum(i_IDEnum)
	{
		if (!i_IDEnum)
			return false;

		while(i_IDEnum.HasMore())
		{
			var ID = i_IDEnum.OpenNext();
			if(this.ProjectID == ID)
			{
				i_IDEnum.Reset();
				return true;
			}
		}

		i_IDEnum.Reset();
		return false;
	}

	function ProjectViewClass_OnUnreadTimer()
	{
		UnreadTimer.Stop();

		if(false == this.GetSelectedItem().IsRead && State_ViewMode == this.CurrentMode)
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(false);
			try
			{
				var ID = this.GetSelectedItem().ID;
				if(this.pIDataModelDelegate.DoesItemExist(ID))
				{
					this.pIDataModelDelegate.MarkRead(ID, true);
				}

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Selected task does not exist.");
				return;
			}
		}
	}

	function ProjectViewClass_SaveNewTask(i_ParentID,
										  i_PreviousSiblingID,
										  i_TaskName,
										  i_AssignedToContactURL,
										  i_Status,
										  i_Priority,
										  i_UserStartConstraint,
										  i_ConstrainStart,
										  i_ScheduledStart,
										  i_ScheduledDuration,
										  i_ScheduledFinish,
										  i_TargetFinish,
										  i_ActualStart,
										  i_ActualFinish,
										  i_IsPrivate,
										  i_pIDescription,
										  i_NewAttachmentsArray,
										  i_NewPredecessorsArray)
	{
		var NewID = -1;

		// this may take a while
		MHF_ShowWaitCursor(true);

		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			// Check if user can add an item.
			if (this.CanAddTask && (this.CanAddTask = this.pIDataModelDelegate.CanAddItem(GrooveProjectTrackingItemType_Task)))
			{
				NewID = this.pIDataModelDelegate.InsertNewTask
								(
									i_ParentID,
									i_PreviousSiblingID,
									i_TaskName, 
									i_AssignedToContactURL,
									i_Status,
									i_Priority,
									i_UserStartConstraint,
									i_ConstrainStart,
									i_ScheduledStart,
									i_ScheduledDuration,
									i_ScheduledFinish,
									i_TargetFinish,
									i_ActualStart,
									i_ActualFinish,
									i_IsPrivate,
									i_pIDescription,
									this.GetProgressInterface()
								);

				// save any new attachments
				this.SaveNewAttachments(NewID, i_NewAttachmentsArray);

				// add any new predecessors
				this.AddPredecessors(NewID, i_NewPredecessorsArray);

				pIDelta.Commit();
			}
			else
			{
				pIDelta.Abort();
			}
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_ADDING);
		}

		// done
		MHF_ShowWaitCursor(false);


		// If the user cannot edit item, give a notice
		if(false == this.CanAddTask)
		{
			// User does not have permissions
			MHF_MessageBox(STR_NOPERMISSION_MESSAGE, STR_SAVETASK_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
		}

		// switch back to view-only mode
		this.EnterViewMode();

		// select the new item in the data viewer --this will trigger
		// a selection change event so that we update our details pane
		if(-1 != NewID)
		{
			this.DataViewerControl.SelectSingleRow(NewID, true, true);
		}
		return NewID;
	}



	// TRANSACTION REQUIREMENT: DELTA
	//		i_NewAttachmentsArray is an array of fully qualified file names
	//		i_RemoveAttachmentsArray is an array of IGrooveProjectAttachment interfaces
	function ProjectViewClass_ReplaceExistingItem(i_pIItem,
												  i_ItemType,
												  i_NewAttachmentsArray, 
												  i_RemoveAttachmentsArray,
												  i_NewPredecessorArray,
												  i_RemovePredecessorArray)
	{
		if(GrooveProjectTrackingItemType_Project == i_ItemType)
		{
			this.pIDataModelDelegate.ReplaceProject(i_pIItem, this.GetProgressInterface());
		}
		else
		{
			this.pIDataModelDelegate.ReplaceTask(i_pIItem, this.GetProgressInterface());
		}

		// remove any existing attachments
		this.DeleteRemovedAttachments(i_pIItem.ID, i_RemoveAttachmentsArray);

		// save any new attachments
		this.SaveNewAttachments(i_pIItem.ID, i_NewAttachmentsArray);

		// items other than the project item may have predecessors
		if(GrooveProjectTrackingItemType_Project != i_ItemType)
		{
			// remove any existing predecessors
			this.RemovePredecessors(i_pIItem.ID, i_RemovePredecessorArray);

			// add any new predecessors
			this.AddPredecessors(i_pIItem.ID, i_NewPredecessorArray);
		}
	}


	//
	// TRANSACTION REQUIREMENT: DELTA
	//		i_NewAttachmentsArray is an array of fully qualified file names
	function ProjectViewClass_SaveNewAttachments(i_ItemID, i_NewAttachmentsArray)
	{
		var pIFileNameEnumCreate = CreateBSTREnum();

		for(var i = 0; i < i_NewAttachmentsArray.length; ++i)
		{
			pIFileNameEnumCreate.Add(i_NewAttachmentsArray[i]);
		}
		
		if(pIFileNameEnumCreate.BSTREnum.HasMore())
		{
			this.pIDataModelDelegate.AddNewAttachmentsFromFiles(i_ItemID, pIFileNameEnumCreate.BSTREnum);
		}
	}


	//
	// TRANSACTION REQUIREMENT: DELTA
	//		i_RemoveAttachmentsArray is an array of IGrooveProjectAttachment interfaces
	function ProjectViewClass_DeleteRemovedAttachments(i_OwnerID, i_RemoveAttachmentsArray)
	{
		// Make sure array is valid
		if (null == i_RemoveAttachmentsArray)
			return;
		
		var pIAttachmentIDEnumCreate = CreateDoubleEnum();

		// Remove existing attachments
		for(var i = 0; i < i_RemoveAttachmentsArray.length; ++i)
		{
			pIAttachmentIDEnumCreate.Add(i_RemoveAttachmentsArray[i].ID);
		}

		if(pIAttachmentIDEnumCreate.DoubleEnum.HasMore())
		{
			this.pIDataModelDelegate.DeleteMultipleAttachments(i_OwnerID, pIAttachmentIDEnumCreate.DoubleEnum);
		}
	}


	//
	// TRANSACTION REQUIREMENT: DELTA
	//		i_RemovePredecessorArray is an array of Task IDs
	function ProjectViewClass_RemovePredecessors(i_FromID, i_RemovePredecessorArray)
	{
		if(0 != i_RemovePredecessorArray.length)
		{
			var pIRemoveEnum = CreateDoubleEnum();
			for(var i = 0; i < i_RemovePredecessorArray.length; ++i)
			{
				pIRemoveEnum.Add(i_RemovePredecessorArray[i]);
			}

			this.pIDataModelDelegate.RemovePredecessors(i_FromID, pIRemoveEnum.DoubleEnum, this.GetProgressInterface());
		}
	}

	//
	// TRANSACTION REQUIREMENT: DELTA
	//		i_NewPredecessorArray is an array of Task IDs
	function ProjectViewClass_AddPredecessors(i_ToID, i_NewPredecessorArray)
	{
		if(0 != i_NewPredecessorArray.length)
		{
			var pIAddEnum = CreateDoubleEnum();
			for(var i = 0; i < i_NewPredecessorArray.length; ++i)
			{
				pIAddEnum.Add(i_NewPredecessorArray[i]);
			}

			this.pIDataModelDelegate.AddPredecessors(i_ToID, pIAddEnum.DoubleEnum, this.GetProgressInterface());
		}
	}


	//
	// Returns:
	//	GrooveMessageBoxResultCode_Yes to save changes
	//	GrooveMessageBoxResultCode_No to abort changes
	//	GrooveMessageBoxResultCode_Cancel to continue editing
	//
	function ProjectViewClass_PromptUserToSaveChanges()
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		return  App.GrooveMessageBox(Window, Account, GPT_MB_SAVECHANGES, GPTPROJECT_WC_TOOLNAME, GrooveMessageBoxStyle_YesNoCancel, GrooveMessageBoxIcon_Exclamation );
	}


	//
	// Returns:
	//	GrooveMessageBoxResultCode_Yes to save as a new item
	//	GrooveMessageBoxResultCode_No to abort changes
	//	GrooveMessageBoxResultCode_Cancel to continue editing
	//
	function ProjectViewClass_PromptUserToSaveDeletedAsNew()
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		return  App.GrooveMessageBox(Window, Account, GPT_MB_SAVEDELETEDASNEW, GPTPROJECT_WC_TOOLNAME, GrooveMessageBoxStyle_YesNoCancel, GrooveMessageBoxIcon_Exclamation );
	}

	function ProjectViewClass_OnCalculationStart()
	{
		ProgressText.ResetContent();
		ProgressText.Visible = true;
	}

	function ProjectViewClass_OnCalculationUpdate(i_PercentComplete)
	{
		// ProgressText.SetText(GPT_CL_CALCPROGRESS + " " + i_PercentComplete + "%");
		ProgressText.ResetContent();
		ProgressText.AddItem(GPT_CL_CALCPROGRESS + " " + i_PercentComplete + "%");
		ProgressText.Redraw();
	}

	function ProjectViewClass_OnCalculationEnd()
	{
		// ProgressText.SetText("");
		ProgressText.ResetContent();
		ProgressText.Visible = false;
	}

	function ProjectViewClass_RedrawDataViewer()
	{
		var bUseFlatSort = true;
		var Status = MHF_GetStatusFilterEnumFromString(g_UIProjectStatusCC.UICommand.UserData);
		var ParticipantURL = g_UIProjectParticipantsCC.UICommand.UserData;

		var Query;
		var pIResultCollection;
		var pICollection = this.ModelGlue.Collection;

		if(ParticipantURL == GPT_S_STATUS_ALL &&
			Status == GrooveProjectToolsetStatusFilterType_All)
		{
			Query = "*";
			bUseFlatSort = false;
		}
		else if(ParticipantURL != GPT_S_STATUS_ALL &&
			Status == GrooveProjectToolsetStatusFilterType_All)
		{
			if(ParticipantURL == GPT_S_UNASSIGNED)
				Query = "/[@AssignedToContactURL='" + "" + "'] or /[@TeamLeaderContactURL='" + "" + "']";
			else
				Query = "/[@AssignedToContactURL='" + ParticipantURL + "'] or /[@TeamLeaderContactURL='" + ParticipantURL + "']";
		}
		else if(ParticipantURL == GPT_S_STATUS_ALL &&
			Status != GrooveProjectToolsetStatusFilterType_All)
		{
			Query = "/[@Status='" + Status + "']";
		}
		else if(ParticipantURL != GPT_S_STATUS_ALL &&
			Status != GrooveProjectToolsetStatusFilterType_All)
		{
			if(ParticipantURL == GPT_S_UNASSIGNED)
				Query = "/[@Status='" + Status + "'] and (/[@AssignedToContactURL='" + "" + "'] or /[@TeamLeaderContactURL='" + "" + "'])";
			else
				Query = "/[@Status='" + Status + "'] and (/[@AssignedToContactURL='" + ParticipantURL + "'] or /[@TeamLeaderContactURL='" + ParticipantURL + "'])";
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Invalid Status or ParticipantURL in GetItemIDsForParticipantAndStatus");
			return;
		}

		if(bUseFlatSort)
			pICollection.UseNamedSort("ByName", false);
		else
			pICollection.UseNamedSort("ByOrdinal", false);

		pIResultCollection = pICollection.Find(Query);
	}

	function ProjectViewGrooveMessageDialogHelper (i_Message, i_DialogTitle, i_IconType)
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, i_Message, i_DialogTitle, GrooveMessageBoxStyle_OK, i_IconType);
	}

	function ProjectViewClass_GetProgressInterface()
	{
		return ScriptHostComponent.IGrooveProjectTrackingSynchronousProgressListener;
	}
	
	function ProjectViewClass_IsFilterOn()
	{
		var ParticipantText = g_UIProjectParticipantsCC.UICommand.Label;
		var ParticipantLabelValue = Right(ParticipantText, VIEW_PARTICIPANTS_DROPDOWN_LABEL);
		var StatusText = g_UIProjectStatusCC.UICommand.Label;
		var StatusLabelValue = Right(StatusText, VIEW_STATUS_DROPDOWN_LABEL);
		if(GPT_S_STATUS_ALL == ParticipantLabelValue && GPT_S_STATUS_ALL == StatusLabelValue)
			return true;
		else
			return false;
	}

	function NeedUserNotification(i_pChangedItem, i_pSelectedItem, i_ItemType)
	{
		if(i_ItemType == GrooveProjectTrackingItemType_Project)
		{
			if(i_pChangedItem.Name == i_pSelectedItem.Name &&
				i_pChangedItem.ID == i_pSelectedItem.ID &&
				i_pChangedItem.ProjectLeaderContactURL == i_pSelectedItem.ProjectLeaderContactURL &&
				i_pChangedItem.Status == i_pSelectedItem.Status &&
				i_pChangedItem.CreationTime == i_pSelectedItem.CreationTime &&
				i_pChangedItem.ScheduledStart == i_pSelectedItem.ScheduledStart &&
				i_pChangedItem.ScheduledDuration == i_pSelectedItem.ScheduledDuration &&
				i_pChangedItem.ScheduledFinish == i_pSelectedItem.ScheduledFinish &&
				i_pChangedItem.TargetFinish == i_pSelectedItem.TargetFinish &&
				i_pChangedItem.ActualStart == i_pSelectedItem.ActualStart &&
				i_pChangedItem.ActualFinish == i_pSelectedItem.ActualFinish &&
				i_pChangedItem.ProjectCreatorContactURL == i_pSelectedItem.ProjectCreatorContactURL)
			{
				return false;
			}

			return true;
		}

		if(i_pChangedItem.Name == i_pSelectedItem.Name &&
			i_pChangedItem.ID == i_pSelectedItem.ID &&
			i_pChangedItem.ParentID == i_pSelectedItem.ParentID &&
			i_pChangedItem.PreviousSiblingID == i_pSelectedItem.PreviousSiblingID &&
			i_pChangedItem.AssignedToContactURL == i_pSelectedItem.AssignedToContactURL &&
			i_pChangedItem.Status == i_pSelectedItem.Status &&
			i_pChangedItem.Priority == i_pSelectedItem.Priority &&
			i_pChangedItem.IsSummary == i_pSelectedItem.IsSummary &&
			i_pChangedItem.UserStartConstraint == i_pSelectedItem.UserStartConstraint &&
			i_pChangedItem.ConstrainStartDate == i_pSelectedItem.ConstrainStartDate &&
			i_pChangedItem.ScheduledStart == i_pSelectedItem.ScheduledStart &&
			i_pChangedItem.ScheduledDuration == i_pSelectedItem.ScheduledDuration &&
			i_pChangedItem.ScheduledFinish == i_pSelectedItem.ScheduledFinish &&
			i_pChangedItem.TargetFinish == i_pSelectedItem.TargetFinish &&
			i_pChangedItem.ActualStart == i_pSelectedItem.ActualStart &&
			i_pChangedItem.ActualFinish == i_pSelectedItem.ActualFinish &&
			i_pChangedItem.IsPrivate == i_pSelectedItem.IsPrivate)
		{
			return false;
		}

		return true;
	}

	function CheckSystemDllsVersion()
	{
		var SysFileNamesAndVersionsMap = new CommonMap();
		SysFileNamesAndVersionsMap.Add("OLEPRO32.DLL", "5.0.4261.0");
		SysFileNamesAndVersionsMap.Add("MFC42.dll", "6.0.8168.0");
		SysFileNamesAndVersionsMap.Add("MSVCRT.DLL", "6.0.8168.0");

		try
		{
			// Get helper objects.
			var App = GrooveScriptFunctions.CreateNewObject("Groove.Application");
			var FS = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

			// Get windows system foilder.
			var WinSysDirectory = App.GetDirectoryPath(GrooveDirectoryValue_System);
			for(var i=0; i<SysFileNamesAndVersionsMap.GetCount(); i++)
			{
				var Pair = SysFileNamesAndVersionsMap.GetAt(i);
				var Version = FS.GetDllVersionString(WinSysDirectory + Pair.Key);
				if(Version != "")
				{
					if(!DoCompare(Pair.Value, Version))
						return false;
				}
				else
					return false;
			}
		}
		catch(error)
		{
			return false;
		}
		return true;
	}

	function DoCompare(i_RequiredVersion, i_InstalledVersion)
	{

		if(i_RequiredVersion <= i_InstalledVersion)
			return true;
		return false;
	}

	function ProjectViewClass_ToggleUnreadMarks()
	{
		this.ShowWaitCursor(true);
		var IDEnum = this.GetSelectionEnum();

		var DynamicsMgr = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			while(IDEnum.DoubleEnum.HasMore())
			{
				var ID = IDEnum.DoubleEnum.OpenNext();
				if(this.pIDataModelDelegate.DoesItemExist(ID))
				{
					var ItemType = this.pIDataModelDelegate.GetItemType(ID);
					var pItem = this.GetItem(ID, ItemType);
					if(null != pItem)
					{
						if(pItem.IsRead)
							this.pIDataModelDelegate.MarkRead(ID, false);
						else
							this.pIDataModelDelegate.MarkRead(ID, true);
					}
				}
			}
			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKINGREAD);
		}
		this.ShowWaitCursor(false);
	}


	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      @           À  Ë        °     úã úã                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   e   ÄName   P r o j e c t V i e w . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPT  C  ÄSCRIPT       ÄSRC   h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e C a l e n d a r H e l p e r _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   NO    O p e n   N  ÄSCRIPT       ÄSRCÄ  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t T r a c k i n g . P r o j e c t D a t a M o d e l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         •   x E     Ø          )      ÄSCRIPT         æ•Ä

	var State_ViewMode = 0;
	var State_EditMode = 1;

	var EDIT_BUTTON_COMMANDURL = "Project_EditItem";
	var SAVE_BUTTON_COMMANDURL = "Project_SaveChanges";
	var CLOSE_BUTTON_COMMANDURL = "Project_CancelChanges";

	//
	// Strings
	//
	var CONFIGURE_PROJECT_DIALOG_TITLE = "Project Wizard";
	var GPT_CL_CALCPROGRESS = "Calculating";

	var STR_ITEMDELETED_MESSAGE = "The selected task has been deleted from the project";
	var STR_ITEMDELETED_TITLE = "Task deleted";
	var STR_CONFIRMDELETE_MESSAGE = "Are you sure you want to delete the ";
	var STR_CONFIRMTASKDELETE_MESSAGE = "task, ";
	var STR_CONFIRMSUMMARYTASKDELETE_MESSAGE = "summary task, ";
	var STR_CONFIRMMULTIPLEDELETE_MESSAGE = " selected tasks";
	var STR_QUESTIONMARK = "?";
	var STR_CONFIRMDELETE_TITLE = "Confirm Delete";
	var STR_DELETESUBTASKS_MESSAGE = " Deleting a summary task will delete all its sub-tasks.";
	var STR_SEVERALSUMMARYTASKSSELECTED_MESSAGE = " You have selected several summary tasks.";
	var STR_SUMMARYTASKSELECTED_MESSAGE = " You have a summary task selected.";

	var STR_ITEMREPLACED_MESSAGE = "The current task has been updated, saving your changes will overwrite the updates.";
	var STR_ITEMREPLACED_TITLE = "Task updated";

	var STR_UPGRADE_IE_MESSAGE = "To use the report capabilities you need to have Microsoft Internet Explorer 5.01 or later installed.";
	var STR_UPGRADE_IE_TITLE = VIEW_REPORT_TOOLTIP;

	var STR_NOPERMISSION_MESSAGE = "You do not have sufficient permissions to save this task.";
	var STR_SAVETASK_TITLE = "Save Task";

	var STR_NODELETEPERMISSION_MESSAGE = "You do not have sufficient permissions to delete \"%taskname\".";
	var STR_NODELETEPROJECTTASK_MESSAGE = "Project Summary may not be deleted."
	var STR_DELETE_TITLE = "Delete";

	var STR_NOCUTUPPERMISSION_MESSAGE = "\"%taskname\" maynot be cut.";
	var STR_NOCUTORCOPYROJECTTASK_MESSAGE = "Project Summary may not be cut or copied.";
	var STR_CUT_TITLE = "Cut";

	var STR_NOADDERMISSION_MESSAGE = "You do not have sufficient permissions to add a task.";
	var STR_ADD_TITLE = "Add";

	var STR_NOMOVEUPPERMISSION_MESSAGE = "%taskname may not be moved up.";
	var STR_MOVEUP_TITLE = "Move Up";

	var STR_NOMOVEDOWNPERMISSION_MESSAGE = "%taskname may not be moved down.";
	var STR_MOVEDOWN_TITLE = "Move Down";

	var STR_NODEMOTEPERMISSION_MESSAGE = "%taskname may not be demoted.";
	var STR_DEMOTE_TITLE = "Demote";

	var STR_NOPROMOTEPERMISSION_MESSAGE = "%taskname may not be promoted.";
	var STR_PROMOTE_TITLE = "Demote";

	var STR_NOMARKCOMPLETEPERMISSION_MESSAGE = "\"%taskname\" may not be marked complete.";
	var STR_MARKCOMPLETE_TITLE = "Mark Complete";

	var STR_NOEDITPERMISSION_MESSAGE = "You do not have sufficient permissions to edit this task.";
	var STR_EDIT_TITLE = "Edit";

	var STR_EXPORTATTACHMENT_MESSAGE = "File \"%filename\" already exits in folder \"%foldername\". Click Yes to overwrite this file with the selected attachment.";
	var STR_EXPORTATTACHMENT_TITLE = "Export Attachment";

	var STR_PROJECTNOTAVAILABLE_MESSAGE = "Microsoft Project must be installed to use this feature";
	var STR_PROJECTNOTAVAILABLE_TITLE  = "Microsoft Project Integration";

	var STR_SAVETEMPLATE_TITLE = "Save Project Template";

	var GPT_MB_SAVECHANGES = "Do you want to save your changes?";
	var GPT_MB_SAVEDELETEDASNEW = "The task you are editing has been deleted. Do you want to save your changes as a new item?  Select Yes to save, No to lose any changes or Cancel to continue editing.";

	//
	// Top level menu items
	//
	var PROJECT_MARK_COMPLETE_URL = "Project_MarkComplete";

	var FILE_NEW_TASK_URL = "Project_NewTask";
	var FILE_NEW_TASK_LABEL = "&Task";
	var FILE_NEW_TASK_BUTTONLABEL = "New Task...";
	var FILE_NEW_TASK_TOOLTIP = "Create a new task";
	var FILE_NEW_TASK_MNEMONIC = "Ctrl+N";

	var FILE_IMPORT_MSP_URL = "Project_ImportMSProject";
	var FILE_IMPORT_MSP_LABEL = "I&mport from Microsoft Project...";

	var FILE_EXPORT_CC_URL = "Project_ExportCC";
	var FILE_EXPORT_CC_LABEL = "Export to Microsoft Project...";
	var FILE_EXPORT_MSP_URL = "Project_ExportMSProject";
	var FILE_EXPORT_MSP_LABEL = "&Export to Microsoft Project...";

	var EDIT_SELECTALL_URL = "GUIC_SelectAll";
	var EDIT_SELECTALL_LABEL = "Select &All";
	var EDIT_SELECTALL_MNEMONIC = "Ctrl+A";
	var EDIT_SELECTALL_MNEMONIC_LABEL = "Ctrl+A";

	var EDIT_DELETE_ITEM_URL = "GUIC_Delete"
	var EDIT_DELETE_ITEM_LABEL = "&Delete"
	var EDIT_DELETE_ITEM_TOOLTIP = "Delete task";
	var EDIT_DELETE_ITEM_MNEMONIC_LABEL = "Del";

	var PROJECT_URL = "ProjectTool"
	var PROJECT_LABEL = "&Project";
	var PROJECT_MNEMONIC = "Alt+P";

	var EDIT_CUT_URL = "GUIC_Cut";
	var EDIT_CUT_LABEL = "Cu&t";
	var EDIT_CUT_TOOLTIP = "Cut";
	var EDIT_CUT_MNEMONIC = "Ctrl+X";

	var EDIT_COPY_URL = "GUIC_Copy";
	var EDIT_COPY_LABEL = "&Copy";
	var EDIT_COPY_TOOLTIP = "Copy";
	var EDIT_COPY_MNEMONIC = "Ctrl+C";

	var EDIT_PASTE_URL = "GUIC_Paste";
	var EDIT_PASTE_LABEL = "&Paste";
	var EDIT_PASTE_TOOLTIP = "Paste";
	var EDIT_PASTE_MNEMONIC = "Ctrl+V";

	var EDIT_COPYASLINK_URL = "GUIC_CopyAsLink";
	var EDIT_COPYASLINK_LABEL = "&Copy Task as Link";
	var EDIT_COPYASLINK_TOOLTIP = "Copy Task as Link";
	var EDIT_COPYASLINK_MNEMONIC = "Ctrl+L";

	var EDIT_MARKREAD_URL = "GUIC_MarkSelectedRead";
	var EDIT_MARKREAD_LABEL = "Mark &Selected Read";
	var EDIT_MARKREAD_MNEMONIC = "Ctrl+0x73";
	var EDIT_MARKREAD_MNEMONIC_LABEL = "Ctrl+F4";

	var EDIT_MARKUNREAD_URL = "GUIC_MarkSelectedUnread";
	var EDIT_MARKUNREAD_LABEL = "Mark Selected U&nread";

	var EDIT_MARKALLREAD_URL = "GUIC_MarkAllRead";
	var EDIT_MARKALLREAD_LABEL = "Mar&k All Read";
	var EDIT_MARKALLREAD_MNEMONIC = "Ctrl+Shift+0x73";

	var EDIT_MARKALLUNREAD_URL = "GUIC_MarkAllUnread";
	var EDIT_MARKALLUNREAD_LABEL = "Mark All Unr&ead";

	var VIEW_NEXTUNREAD_URL = "GUIC_NextUnread";
	var VIEW_NEXTUNREAD_LABEL = "Next &Unread";
	var VIEW_NEXTUNREAD_TOOLTIP = "Navigate Next Unread";
	var VIEW_NEXTUNREAD_MNEMONIC = "0x73";

	var VIEW_PREVUNREAD_URL = "GUIC_PreviousUnread";
	var VIEW_PREVUNREAD_LABEL = "P&revious Unread";
	var VIEW_PREVUNREAD_TOOLTIP = "Navigate Previous Unread";
	var VIEW_PREVUNREAD_MNEMONIC = "Shift+0x73";

	var VIEW_UNREADOPTIONS_URL = "Project_UnreadOptions";
	var VIEW_UNREADOPTIONS_TOOLTIP = "Unread Options";

	var PROJECT_MOVEITEMUP_URL = "Project_MoveItemUp";
	var PROJECT_MOVEITEMUP_LABEL = "Move &up";
	var PROJECT_MOVEITEMUP_BUTTONLABEL = "Move up";
	var PROJECT_MOVEITEMUP_TOOLTIP = "Move selected task(s) up";
	var PROJECT_MOVEITEMUP_MNEMONIC = "Ctrl+U";

	var PROJECT_MOVEITEMDOWN_URL = "Project_MoveItemDown";
	var PROJECT_MOVEITEMDOWN_LABEL = "Move &down";
	var PROJECT_MOVEITEMDOWN_BUTTONLABEL = "Move down";
	var PROJECT_MOVEITEMDOWN_TOOLTIP = "Move selected task(s) down";
	var PROJECT_MOVEITEMDOWN_MNEMONIC = "Ctrl+W";

	var PROJECT_DEMOTE_URL = "Project_DemoteItem";
	var PROJECT_DEMOTE_LABEL = "&Indent Task";
	var PROJECT_DEMOTE_BUTTONLABEL = "Demote";
	var PROJECT_DEMOTE_TOOLTIP = "Move selected task(s) right";
	var PROJECT_DEMOTE_MNEMONIC = "Tab";

	var PROJECT_PROMOTE_URL = "Project_PromoteItem";
	var PROJECT_PROMOTE_LABEL = "&Outdent Task";
	var PROJECT_PROMOTE_BUTTONLABEL = "Promote";
	var PROJECT_PROMOTE_TOOLTIP = "Move selected task(s) left";
	var PROJECT_PROMOTE_MNEMONIC = "Shift+Tab";

	var PROJECT_SAVEASTEMPLATE_URL = "Project_SaveAsTemplate";
	var PROJECT_SAVEASTEMPLATE_LABEL = "Save Project &as Template";
	var PROJECT_SAVEASTEMPLATE_MNEMONIC = "Ctrl+E";

	var VIEW_REPORT_URL = "View_Report";
	var VIEW_REPORT_LABEL = "&Report...";
	var VIEW_REPORT_TOOLTIP = "View Report";
	var VIEW_REPORT_MNEMONIC = "Ctrl+R";
	
	var PROJECT_SEPARATOR1_URL = "Separator1";
	var PROJECT_SEPARATOR2_URL = "Separator2";
	var PROJECT_SEPARATOR3_URL = "Seperator3";
	var PROJECT_SEPARATOR4_URL = "Seperator4";
	var PROJECT_SEPARATOR5_URL = "Seperator5";

	var VIEW_PARTICIPANTS_DROPDOWN_URL = "View_Participants_DropDown_URL";
	var VIEW_PARTICIPANTS_DROPDOWN_TOOLTIP = "Select Participant";
	var VIEW_PARTICIPANTS_DROPDOWN_LABEL = "Participants - ";
	var VIEW_PARTICIPANTS_MENU_LABEL = "&Participants";

	var VIEW_STATUS_DROPDOWN_URL = "View_Status_DropDown_URL";
	var VIEW_STATUS_DROPDOWN_TOOLTIP = "Select Status";
	var VIEW_STATUS_DROPDOWN_LABEL = "Status - ";
	var VIEW_STATUS_MENU_LABEL = "&Status";

	//
	// Programmatic strings that do not need localization
	//
	var PROJECTITEM_CLIPBOARDFORMAT  = "ProjectTrackingItemStream";		// Version 1.0 of PM tool
	var PROJECTITEM_CLIPBOARDFORMAT2 = "ProjectTrackingItemStream2";	// Vesrion 2.0 of PM tool

	//
	var g_InsertedItemIDsMap = null;

	// Chyecked Participant menu item
	var g_CheckedParticipantMenuUICommand = null;

	// Participants filter command
	var g_ParticipantsFilterUICommand = null;
	
	// Participants filter menu item.
	var g_ParticipantsFilterMenuUICommand = null;

	// Status filter command
	var g_UIProjectStatusCC = null;

	// Checked Status menu item.
	var g_CheckedStatusMenuUICommand = null;

	// Unread options menu item
	var g_UnreadOptionsUICommand = null;

	//
	// Acceptable values into CheckACLItem() method
	//
	var g_CAN_MOVE_UP = 1;
	var g_CAN_MOVE_DOWN = 2;
	var g_CAN_PROMOTE = 3;
	var g_CAN_DEMOTE = 4;
	var g_CAN_DELETE = 5;
	var g_CAN_CUT = 6;

	//
	// Class ProjectViewClass
	//
	function ProjectViewClass
		(i_ContactProvider,
		 i_DataModelDelegate,
		 i_DataListDisplay, 
		 i_CollectionDataListDataSource,
		 i_HorizontalSplitter,
		 i_SessionName
		)
	{
		GrooveDebugFunctions.DisplayAssert(null != i_DataModelDelegate, "Received NULL DMD");
		GrooveDebugFunctions.DisplayAssert(null != i_DataListDisplay, "Received NULL Data List");
		GrooveDebugFunctions.DisplayAssert(null != i_CollectionDataListDataSource, "Received NULL DataList Data Source");

		// Class data
		this.UICommandContainer = null;
		this.GlobalCommandContainer = null;
		this.DataListDisplay = i_DataListDisplay;
		this.pIContactProvider = i_ContactProvider; 

		this.HorizontalSplitter = i_HorizontalSplitter;
		this.CollectionDataListDataSource = i_CollectionDataListDataSource;
		this.pIDataModelDelegate = i_DataModelDelegate;
		this.DetailsView = new DetailsViewClass(this.pIContactProvider, i_DataModelDelegate, this);


		// Global Command Containers
		this.FileDocumentCC = null;
		this.FileNewCC = null;
		this.EditCC = null;
		this.ViewCC = null;
		this.ProjectCC = null;
		this.EditClipboardCC = null;
		this.EditCopyLinkCC = null;

		// Dynamics manager
		this.DynamicsManager = PropertyList.OpenProperty(PROPERTY_DYNAMICS_MANAGER);
		this.SessionName = i_SessionName;

		// UI manager
		this.UIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
		
		// Application state
		this.SelectedItem = null;
		this.SelectedItemType = GrooveProjectTrackingItemType_Invalid;
		this.SelectedItemParent = null;
		this.CurrentMode = State_ViewMode;
		this.UINeedsACLCheck = true;
		this.UserNotifiedOfChange = false;

		// Attachment handlers
		this.DefaultAttachmentsPath	= "c:\\";
		this.Attachments = new AttachmentsButtonHelperClass(DocShareEngine);

		//
		// Method mapping
		//

		// Public
		this.ShowMenuCommands = ProjectViewClass_ShowMenuCommands;
		this.HideMenuCommands = ProjectViewClass_HideMenuCommands;
		this.ShowUICommands = ProjectViewClass_ShowUICommands;
		this.HideUICommands = ProjectViewClass_HideUICommands;
		this.OnViewContainerShow = ProjectViewClass_OnViewContainerShow;
		this.SetGlobalCommandContainer = ProjectViewClass_SetGlobalCommandContainer;
		this.SetUICommandContainer = ProjectViewClass_SetUICommandContainer;
		this.OnCommand = ProjectViewClass_OnCommand;
		this.OnUpdateCommandState = ProjectViewClass_OnUpdateCommandState;
		this.OnEdit = ProjectViewClass_OnEdit;
		this.OnSave = ProjectViewClass_OnSave;
		this.OnClose = ProjectViewClass_OnClose;
		this.OnDelete = ProjectViewClass_OnDelete;
		this.OnItemReplaced = ProjectViewClass_OnItemReplaced;
		this.SwitchToViewMode = ProjectViewClass_SwitchToViewMode;
		this.OnFocusRowChanged = ProjectViewClass_OnFocusRowChanged;
		this.OnSelectionChanged = ProjectViewClass_OnSelectionChanged;
		this.OnListViewDoubleClick = ProjectViewClass_OnListViewDoubleClick;
		this.OnTranslateAccelerator = ProjectViewClass_OnTranslateAccelerator;
		this.OnMoveItemUp = ProjectViewClass_OnMoveItemUp;
		this.OnMoveItemDown = ProjectViewClass_OnMoveItemDown;
		this.OnDemote = ProjectViewClass_OnDemote;
		this.OnPromote = ProjectViewClass_OnPromote;
		this.OnPersonsAdded = ProjectViewClass_OnPersonsAdded;
		this.OnPersonsRemoved = ProjectViewClass_OnPersonsRemoved;
		this.OnPersonsChanged = ProjectViewClass_OnPersonsChanged;
		this.OnViewReport = ProjectViewClass_OnViewReport;
		this.OnSaveTemplate = ProjectViewClass_OnSaveTemplate;
		this.GetItemURL = ProjectViewClass_GetItemURL;
		this.ShowItem = ProjectViewClass_ShowItem;
		this.OnTimerItemReplaced = ProjectViewClass_OnTimerItemReplaced;
		this.OnTimerShowConfigDialog = ProjectViewClass_OnTimerShowConfigDialog;
		this.OnRoleChanged = ProjectViewClass_OnRoleChanged;
		this.OnCopy = ProjectViewClass_OnCopy;
		this.OnPaste = ProjectViewClass_OnPaste;
		this.OnCut = ProjectViewClass_OnCut;
		this.OnUnreadTimer = ProjectViewClass_OnUnreadTimer;
		this.OnMarkComplete = ProjectViewClass_OnMarkComplete;
		this.GenerateReport = ProjectViewClass_GenerateReport;
		this.InsertItemWithParents = ProjectViewClass_InsertItemWithParents;
		this.AddSingleItemToXMLDoc = ProjectViewClass_AddSingleItemToXMLDoc;
		this.GetItemFromID = ProjectViewClass_GetItemFromID;
		this.OnCalculationStart = ProjectViewClass_OnCalculationStart;
		this.OnCalculationUpdate = ProjectViewClass_OnCalculationUpdate;
		this.OnCalculationEnd = ProjectViewClass_OnCalculationEnd;
		this.SaveChanges = ProjectViewClass_SaveChanges;

		// Internal use only
		this.SetSelectedItem = ProjectViewClass_SetSelectedItem;
		this.RefreshSelectedItem = ProjectViewClass_RefreshSelectedItem;
		this.NotifyUserOfItemRemoval = ProjectViewClass_NotifyUserOfItemRemoval;
		this.OnNewTask = ProjectViewClass_OnNewTask;
		this.EnterViewMode = ProjectViewClass_EnterViewMode;
		this.EnterEditMode = ProjectViewClass_EnterEditMode;
		this.GetItem = ProjectViewClass_GetItem;
		this.ShowConfigDialog = ProjectViewClass_ShowConfigDialog;
		this.OnImportFromMSProject = ProjectViewClass_OnImportFromMSProject;
		this.OnExportToMSProject = ProjectViewClass_OnExportToMSProject;
		this.MarkSelectedRead = ProjectViewClass_MarkSelectedRead;
		this.MarkAllRead = ProjectViewClass_MarkAllRead;
		this.NavigatePrevUnread = ProjectViewClass_NavigatePrevUnread;
		this.NavigateNextUnread = ProjectViewClass_NavigateNextUnread;
		this.NavigateToDocument = ProjectViewClass_NavigateToDocument;
		this.RefreshACLCache = ProjectViewClass_RefreshACLCache;
		this.CheckACLItem = ProjectViewClass_CheckACLItem;
		this.GetReversedSelectionEnum = ProjectViewClass_GetReversedSelectionEnum;
		this.GetClipboard = ProjectViewClass_GetClipboard;
		this.SaveExisting = ProjectViewClass_SaveExisting;
		this.SaveNewTask = ProjectViewClass_SaveNewTask;
		this.ReplaceExistingItem = ProjectViewClass_ReplaceExistingItem;
		this.PromptUserToSaveChanges = ProjectViewClass_PromptUserToSaveChanges;
		this.PromptUserToSaveDeletedAsNew = ProjectViewClass_PromptUserToSaveDeletedAsNew;
		this.RemovePredecessors = ProjectViewClass_RemovePredecessors;
		this.AddPredecessors = ProjectViewClass_AddPredecessors;
		this.RedrawDataViewer = ProjectViewClass_RedrawDataViewer;
		this.MarkCurrentComplete = ProjectViewClass_MarkCurrentComplete;
		this.RefreshAttachmentsMenu = ProjectViewClass_RefreshAttachmentsMenu;
		this.ProcessAttachmentsMenuCommand = ProjectViewClass_ProcessAttachmentsMenuCommand;
		this.GetProgressInterface = ProjectViewClass_GetProgressInterface;
		this.SerializeToolTemplate = ProjectViewClass_SerializeToolTemplate;
		this.IsFilterOn = ProjectViewClass_IsFilterOn;
		this.ToggleUnreadMarks = ProjectViewClass_ToggleUnreadMarks;
		this.AddItemsToXMLFromCollection = ProjectViewClass_AddItemsToXMLFromCollection;
		this.ShowDataListView = ProjectViewClass_ShowDataListView;
		this.OnSplitterDragEnd = ProjectViewClass_OnSplitterDragEnd;
		this.InitACLCache = ProjectViewClass_InitACLCache;

		// Initialize ACl cache.
		this.InitACLCache();

		// 
		// Initialize data
		//
		var Project = null;
		this.ProjectID = -1;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			// Remember the ID of the Project item for efficiency
			Project = this.pIDataModelDelegate.GetProject();
			if (null != Project)
			{
				this.ProjectID = Project.ID;
			}
		
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();

			// Cannot display dialog box yet because we don't have a window.
			GrooveDebugFunctions.DisplayAssert(0, GPTPROJECT_MB_FAILURE_INITIALIZE);
			return;
		}

		GrooveDebugFunctions.DisplayAssert(-1 != this.ProjectID, "Missing Project");

		// 
		// Initialize UI
		//		

		// Initialize buttons
		MoveUpButton.Label = PROJECT_MOVEITEMUP_BUTTONLABEL;
		MoveUpButton.ToolTip = PROJECT_MOVEITEMUP_TOOLTIP;
		MoveDownButton.Label = PROJECT_MOVEITEMDOWN_BUTTONLABEL;
		MoveDownButton.ToolTip = PROJECT_MOVEITEMDOWN_TOOLTIP;
		IndentButton.Label = PROJECT_DEMOTE_BUTTONLABEL;
		IndentButton.ToolTip = PROJECT_DEMOTE_TOOLTIP;
		OutdentButton.Label = PROJECT_PROMOTE_BUTTONLABEL;
		OutdentButton.ToolTip = PROJECT_PROMOTE_TOOLTIP;

		// Set the top level "project" item as the selected item in the UI
		this.SetSelectedItem(Project, GrooveProjectTrackingItemType_Project, null, GrooveProjectTrackingItemType_Invalid);
		this.RefreshSelectedItem();

		// Go into view mode
		this.EnterViewMode();
	}

	//
	// The tool is terminating.
	//
	function ProjectViewClass_SaveChanges()
	{
		// If we are in edit mode, prompt user to save changes.
		if (State_EditMode == this.CurrentMode && this.DetailsView.HasChanged())
		{
			var Response = this.PromptUserToSaveChanges(GrooveMessageBoxStyle_YesNo);
			if (GrooveMessageBoxResultCode_Yes == Response)
				this.OnSave();
			else  // GrooveMessageBoxResultCode_No
			{
				this.Attachments.Abort();
	
				// Restore the list view and refresh item.
				this.ShowDataListView(true);
				this.RefreshSelectedItem();
			}
		}
	}

	//
	// Set the selected item
	//
	function ProjectViewClass_SetSelectedItem(i_Item, i_ItemType, i_ParentItem, i_ParentItemType)
	{
		// Multiple items selected?
		var AreMultipleItemsSelected = false;
		if (this.DataListDisplay.SelectedRowCount > 1)
		{
			AreMultipleItemsSelected = true;
				
			// Clear ACL cache, when multiple items are selected to allow all activity.
			this.InitACLCache(true);
		}

		// Remember to check access control when updatng the UI
		// Do NOT do an ACL check for multiple items, too expensive.
		if(false == AreMultipleItemsSelected &&
		   (null == this.SelectedItem || 
		   (null != this.SelectedItem && null != i_Item && i_Item.ID != this.SelectedItem.ID)))
		{
			this.UINeedsACLCheck = true;
		}

		this.SelectedItem = i_Item;
		this.SelectedItemType = i_ItemType;
		this.SelectedItemParent = i_ParentItem;

		// Stop unread timer when item changes
		UnreadTimer.Stop();

		// Kick off timer to mark it read
		if(null != i_Item && false == i_Item.IsRead && State_ViewMode == this.CurrentMode)
		{
			UnreadTimer.Start();
		}
	}

	//
	// Update the UI with the current selected item
	//
	function ProjectViewClass_RefreshSelectedItem()
	{
		if (GrooveProjectTrackingItemType_Task == this.SelectedItemType)
		{
			this.DetailsView.ShowTask(this.SelectedItem, this.SelectedItemParent);
		}
		else if (GrooveProjectTrackingItemType_Project == this.SelectedItemType)
		{
			this.DetailsView.ShowProject(this.SelectedItem);
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Invalid task type");
		}
	}

	function ProjectViewClass_OnViewContainerShow(i_bShow)
	{
		if (false == i_bShow)
		{
			// Stop all of our timers
			// AM  - don't stop the item replaced timer so that we continue
			//       to inform the user of changes when the navigate out of 
			//       the tool in edit mode
			UnreadTimer.Stop();
			ConfigDialogHackTimer.Stop();
		}
		else
		{
			// hide the progress indicator
			ProgressText.Visible = false;
			ProgressText.Enabled = false;
			ProgressText.Redraw();

			var ShowConfiguDialog = false;
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				var pIProject = this.pIDataModelDelegate.GetProject();

				// if the project has not yet been configured and the user
				// has permission to update it, show them the configuration dialog
				if(false == g_pIDataModelDelegate.ProjectConfigured() &&
				   true == g_pIDataModelDelegate.CanReplaceItem(pIProject.ID))
				{
					ShowConfiguDialog = true;
				}

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Error getting project item");
			}

			if(ShowConfiguDialog)
			{
				// AMLATER -hack to work around platform issue: we cannot display
				// modal dialogs in response to an async engine event :(
				ConfigDialogHackTimer.Stop();
				ConfigDialogHackTimer.Start();
			}

			// restart the unread timer
			if(State_ViewMode == this.CurrentMode)
			{
				// stop unread timer when item changes
				UnreadTimer.Stop();
				UnreadTimer.Start();
			}
		}
	}

	//
	// switch into edit mode, swapping UI labels
	//	
	function ProjectViewClass_EnterEditMode()
	{
		// set the state
		this.CurrentMode = State_EditMode;

		// clear notifcation flag
		this.UserNotifiedOfChange = false;
	}


	//
	// switch into view mode, swapping UI labels
	//	
	function ProjectViewClass_EnterViewMode()
	{
		// Set the state
		this.CurrentMode = State_ViewMode;
	}


	//
	// Helper to get the item of the requested type
	// caller is responsible for the transaction
	function ProjectViewClass_GetItem(i_ID, i_ItemType)
	{
		if (GrooveProjectTrackingItemType_Task == i_ItemType)
		{
			return this.pIDataModelDelegate.GetTask(i_ID);
		}
		else if (GrooveProjectTrackingItemType_Project == i_ItemType)
		{
			return  this.pIDataModelDelegate.GetProject();
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Invalid item type");
			return null;
		}
	}

	
	//
	// cache the menu bar
	//
	function ProjectViewClass_SetGlobalCommandContainer(i_GlobalCommandContainer)
	{
		if (null != i_GlobalCommandContainer)
			this.GlobalCommandContainer = i_GlobalCommandContainer.UICommandContainer2;
		else
			this.GlobalCommandContainer = null;
	}

	//
	// cache the icon bar
	//
	function ProjectViewClass_SetUICommandContainer(i_UICommandContainer)
	{
		this.UICommandContainer = i_UICommandContainer;
	}

	//
	// Display our menu commands
	//
	function ProjectViewClass_ShowMenuCommands()
	{
		// Get icon info
		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		// File command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_DOCUMENT_TOOL_COMMANDS))
		{
			this.FileDocumentCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_DOCUMENT_TOOL_COMMANDS);
		}

		if(null != this.FileDocumentCC)
		{
			this.FileDocumentCC.InsertSeparator(PROJECT_SEPARATOR1_URL, this.FileDocumentCC.GetNumberOfUICommands());

			// Save as template
			var UICommand = this.FileDocumentCC.InsertUICommand(PROJECT_SAVEASTEMPLATE_URL, this.FileDocumentCC.GetNumberOfUICommands());
			UICommand.Label = PROJECT_SAVEASTEMPLATE_LABEL + "\t" + PROJECT_SAVEASTEMPLATE_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = PROJECT_SAVEASTEMPLATE_MNEMONIC;

			this.FileDocumentCC.InsertSeparator(PROJECT_SEPARATOR2_URL, this.FileDocumentCC.GetNumberOfUICommands());

			// Import from MS Project
			UICommand = this.FileDocumentCC.InsertUICommand(FILE_IMPORT_MSP_URL, this.FileDocumentCC.GetNumberOfUICommands());
			UICommand.Label = FILE_IMPORT_MSP_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			UICommand = this.FileDocumentCC.InsertUICommand(FILE_EXPORT_MSP_URL, this.FileDocumentCC.GetNumberOfUICommands());
			UICommand.Label = FILE_EXPORT_MSP_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}

		// File->New command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_NEW_TOOL_COMMANDS))
		{
			this.FileNewCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_FILE_NEW_TOOL_COMMANDS);
		}

		if(null != this.FileNewCC)
		{
			// New Task menu item
			var UICommand = this.FileNewCC.InsertUICommand(FILE_NEW_TASK_URL, this.FileNewCC.GetNumberOfUICommands());
			UICommand.Label = FILE_NEW_TASK_LABEL + "\t" + FILE_NEW_TASK_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = FILE_NEW_TASK_MNEMONIC;
		}

		// Clipboard commands command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_CLIPBOARD_TOOL_COMMANDS))
		{
			this.EditClipboardCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_CLIPBOARD_TOOL_COMMANDS);
		}

		// Copy links command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_COPY_LINKS_TOOL_COMMANDS))
		{
			this.EditCopyLinkCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_COPY_LINKS_TOOL_COMMANDS);
		}

		// Edit command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_TOOL_COMMANDS))
		{
			this.EditCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_EDIT_TOOL_COMMANDS);
		}

		// View command container
		if (this.GlobalCommandContainer.UICommandContainerExists(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS))
		{
			this.ViewCC = this.GlobalCommandContainer.OpenUICommandContainer(STR_GROOVE_UI_COMMAND_CONTAINER_URL_VIEW_TOOL_COMMANDS);
		}

		if(null != this.ViewCC)
		{
			// Participant filters menu.
			g_ParticipantsFilterMenuUICommand = this.ViewCC.InsertUICommandContainer(VIEW_PARTICIPANTS_DROPDOWN_URL, this.ViewCC.GetNumberOfUICommands());
			g_ParticipantsFilterMenuUICommand.UICommand.Label = VIEW_PARTICIPANTS_MENU_LABEL;
			g_ParticipantsFilterMenuUICommand.UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			// Fill in all the participants and get the default selection
			g_CheckedParticipantMenuUICommand = UpdateParticipantsInICommandContainer(g_ParticipantsFilterMenuUICommand, this.pIContactProvider);
			g_CheckedParticipantMenuUICommand.CheckState = GrooveCheckState_Checked;

			// Status filters menu
			g_CheckedStatusMenuUICommand = InsertStatusFilterIntoUICommandContainer(this.ViewCC);
				
			// Separator
			this.ViewCC.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR1_URL, this.ViewCC.GetNumberOfUICommands());

			// Unread navigation
			var IconFileURL = MHF_GetIconFileURL();
			var IconMaskFileURL = MHF_GetIconMaskFileURL();
			var IconWidth = MHF_GetIconWidth();
			var IconHeight = MHF_GetIconHeight();

			// Report menu item
			var UICommand = this.ViewCC.InsertUICommand(VIEW_REPORT_URL, this.ViewCC.GetNumberOfUICommands());
			UICommand.Label = VIEW_REPORT_LABEL + "\t" + VIEW_REPORT_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.Mnemonic = VIEW_REPORT_MNEMONIC;
			UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_REPORT_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);
		}
	}

	//
	// Hide our menu commands
	// 
	function ProjectViewClass_HideMenuCommands()
	{
		if(null != this.FileDocumentCC)
		{
			this.FileDocumentCC.RemoveSeparator(PROJECT_SEPARATOR1_URL);
			this.FileDocumentCC.RemoveUICommand(PROJECT_SAVEASTEMPLATE_URL);
			this.FileDocumentCC.RemoveSeparator(PROJECT_SEPARATOR2_URL);
			this.FileDocumentCC.RemoveUICommand(FILE_IMPORT_MSP_URL);
			this.FileDocumentCC.RemoveUICommand(FILE_EXPORT_MSP_URL);
			this.FileDocumentCC = null;
		}

		if(null != this.FileNewCC)
		{
			this.FileNewCC.RemoveUICommand(FILE_NEW_TASK_URL);
			this.FileNewCC = null;
		}

		if(null != this.EditClipboardCC)
		{
			this.EditClipboardCC = null;
		}

		if(null != this.EditCopyLinkCC)
		{
			this.EditCopyLinkCC = null;
		}

		if(null != this.EditCC)
		{
			this.EditCC = null;
		}

		if(null != this.ViewCC)
		{
			this.ViewCC.RemoveUICommandContainer(VIEW_STATUS_DROPDOWN_URL);
			this.ViewCC.RemoveUICommandContainer(VIEW_PARTICIPANTS_DROPDOWN_URL);
			this.ViewCC.RemoveUICommand(VIEW_REPORT_URL);
			this.ViewCC.RemoveUICommand(PROJECT_SEPARATOR1_URL);
			this.ViewCC = null;
		}
	}

	//
	// Insert status filters
	// 
	function InsertStatusFilterIntoUICommandContainer(i_CommandContainer)
	{
		// Insert the status filter menu
		var pIUICommandContainer = i_CommandContainer.InsertUICommandContainer(VIEW_STATUS_DROPDOWN_URL,
																			   i_CommandContainer.GetNumberOfUICommands());
		pIUICommandContainer.UICommand.Label = VIEW_STATUS_MENU_LABEL;
		pIUICommandContainer.UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		var index = pIUICommandContainer.GetNumberOfUICommands();

		// Insert the status filter sub menu items/
		var pDefaultSelection = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_S_STATUS_ALL, index++);
		pDefaultSelection.Label = GPT_S_STATUS_ALL;
		pDefaultSelection.Listener = ScriptHostComponent.IGrooveUICommandListener;
		pDefaultSelection.UserData = GPT_S_STATUS_ALL;
		pDefaultSelection.CheckState = GrooveCheckState_Checked;

		var pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_S_STATUS_NOTSTARTED, index++);
		pIUICommand.Label = GPT_S_STATUS_NOTSTARTED;
		pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		pIUICommand.UserData = GPT_S_STATUS_NOTSTARTED;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_S_STATUS_INPROGRESS, index++);
		pIUICommand.Label = GPT_S_STATUS_INPROGRESS;
		pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		pIUICommand.UserData = GPT_S_STATUS_INPROGRESS;

		pIUICommand = pIUICommandContainer.UICommandContainer.InsertUICommand(GPT_S_STATUS_COMPLETE, index++);
		pIUICommand.Label = GPT_S_STATUS_COMPLETE;
		pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		pIUICommand.UserData = GPT_S_STATUS_COMPLETE;

		return pDefaultSelection;
	}

	//
	// Update participants menu
	// 
	function UpdateParticipantsInICommandContainer(i_UICommandContainer, i_ContactProvider)
	{
		var nIndex = i_UICommandContainer.UICommandContainer.GetNumberOfUICommands();
		var pIUICommand = null;
		try
		{
			i_UICommandContainer.UICommandContainer.RemoveAllUICommands();
			var pIDefaultUICommand = i_UICommandContainer.UICommandContainer.InsertUICommand(VIEW_PARTICIPANTS_DROPDOWN_URL+GPT_S_STATUS_ALL, nIndex++);
			if (pIDefaultUICommand)
			{
				pIDefaultUICommand.Label = GPT_S_STATUS_ALL;
				pIDefaultUICommand.UserData = GPT_S_STATUS_ALL;
				pIDefaultUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			}

			pIUICommand = i_UICommandContainer.UICommandContainer.InsertUICommand(VIEW_PARTICIPANTS_DROPDOWN_URL+GPT_S_UNASSIGNED, nIndex++);
			if (pIUICommand)
			{
				pIUICommand.Label = GPT_S_UNASSIGNED;
				pIUICommand.UserData = GPT_S_UNASSIGNED;
				pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			}
		}
		catch(e)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Failed to get command container for participants menu.");
			return (pIDefaultUICommand) ? pIDefaultUICommand :  pIUICommand;
		}

		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			var ContactMap = PPH_GetContactNameURLMap(i_ContactProvider);
			for(var i = 0; i < ContactMap.GetCount(); i++)
			{
				var Contact = ContactMap.GetAt(i);
				if (Contact)
				{
					var ContactCommandURL = VIEW_PARTICIPANTS_DROPDOWN_URL+Contact.ContactURL;
					pIUICommand = i_UICommandContainer.UICommandContainer.InsertUICommand(ContactCommandURL, nIndex++);

					var strName = Contact.Name;
					if(-1 != strName.indexOf("&"))
						strName = strName.replace(/&/g, "&&");

					pIUICommand.Label = strName;
					pIUICommand.UserData = Contact.ContactURL;
					pIUICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				}
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_RETRIEVINGCONTACTS);
		}

		return pIDefaultUICommand;
	}

	function ProjectViewClass_ShowUICommands()
	{
		var Pos = this.UICommandContainer.GetNumberOfUICommands();

		var IconFileURL = MHF_GetIconFileURL();
		var IconMaskFileURL = MHF_GetIconMaskFileURL();
		var IconWidth = MHF_GetIconWidth();
		var IconHeight = MHF_GetIconHeight();

		// New task
		var pIUICommand = this.UICommandContainer.InsertUICommand(FILE_NEW_TASK_URL, Pos++);
		pIUICommand.UICommand.ToolTip= FILE_NEW_TASK_TOOLTIP + " (" + FILE_NEW_TASK_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_ADDITEM_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);
		pIUICommand.UICommand.Label = FILE_NEW_TASK_BUTTONLABEL;

		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR1_URL, Pos++);

		// View Report
		pIUICommand = this.UICommandContainer.InsertUICommand(VIEW_REPORT_URL, Pos++);
		pIUICommand.UICommand.ToolTip = VIEW_REPORT_TOOLTIP + " (" + VIEW_REPORT_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_REPORT_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR2_URL, Pos++);

		// Clipboard functions
		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_CUT_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_CUT_TOOLTIP + " (" + EDIT_CUT_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_CUT_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_COPY_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_COPY_TOOLTIP + " (" + EDIT_COPY_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_COPY_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_PASTE_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_PASTE_TOOLTIP + " (" + EDIT_PASTE_MNEMONIC + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_PASTE_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR3_URL, Pos++);

		// Delete
		pIUICommand = this.UICommandContainer.InsertUICommand(EDIT_DELETE_ITEM_URL, Pos++);
		pIUICommand.UICommand.ToolTip= EDIT_DELETE_ITEM_TOOLTIP + " (" + EDIT_DELETE_ITEM_MNEMONIC_LABEL + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_DELETE_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		// Read/unread functions
		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR4_URL, Pos++);

		pIUICommand = this.UICommandContainer.InsertUICommand(VIEW_PREVUNREAD_URL, Pos++);
		pIUICommand.UICommand.ToolTip= VIEW_PREVUNREAD_TOOLTIP + " (" + STR_COMMON_ACCELERATOR_PREVIOUS_UNREAD + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_PREVUNREAD_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		pIUICommand = this.UICommandContainer.InsertUICommand(VIEW_NEXTUNREAD_URL, Pos++);
		pIUICommand.UICommand.ToolTip= VIEW_NEXTUNREAD_TOOLTIP + " (" + STR_COMMON_ACCELERATOR_NEXT_UNREAD + ")";
		pIUICommand.UICommand.SetImage(IconFileURL, IconMaskFileURL, MHF_NEXTUNREAD_ICON_ORDINAL * IconWidth, IconWidth, IconHeight);

		// Load unread icons from common images URL.
		var UnreadIconFileURL = "grooveFile:///ToolData\\groove.net\\CommonData\\CommonToolIconImages.jpg";
		var UnreadIconMaskFileURL = "grooveFile:///ToolData\\groove.net\\CommonData\\CommonToolIconImagesMask.bmp";

		// Unread command container
		g_UnreadOptionsUICommand = this.UICommandContainer.InsertUICommandContainer(VIEW_UNREADOPTIONS_URL, Pos++);
		g_UnreadOptionsUICommand.UICommand.ToolTip = VIEW_UNREADOPTIONS_TOOLTIP;
		g_UnreadOptionsUICommand.UICommand.SetImage(UnreadIconFileURL, UnreadIconMaskFileURL, (10 * 16), 16, 16);

		pIUICommand = g_UnreadOptionsUICommand.UICommandContainer.InsertUICommand(EDIT_MARKREAD_URL, g_UnreadOptionsUICommand.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = EDIT_MARKREAD_LABEL + "\t" + EDIT_MARKREAD_MNEMONIC_LABEL;
		pIUICommand.Mnemonic = EDIT_MARKREAD_MNEMONIC;

		pIUICommand = g_UnreadOptionsUICommand.UICommandContainer.InsertUICommand(EDIT_MARKUNREAD_URL, g_UnreadOptionsUICommand.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = EDIT_MARKUNREAD_LABEL;

		pIUICommand = g_UnreadOptionsUICommand.UICommandContainer.InsertUICommand(EDIT_MARKALLREAD_URL, g_UnreadOptionsUICommand.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = EDIT_MARKALLREAD_LABEL + "\t" + STR_COMMON_ACCELERATOR_MARK_ALL_READ;
		pIUICommand.Mnemonic = EDIT_MARKALLREAD_MNEMONIC;

		pIUICommand = g_UnreadOptionsUICommand.UICommandContainer.InsertUICommand(EDIT_MARKALLUNREAD_URL, g_UnreadOptionsUICommand.UICommandContainer.GetNumberOfUICommands());
		pIUICommand.Label = EDIT_MARKALLUNREAD_LABEL;

		this.UICommandContainer.InsertSeparator(PROJECT_SEPARATOR5_URL, Pos++);

		// Participant filter.
		g_ParticipantsFilterUICommand = this.UICommandContainer.InsertUICommandContainer(VIEW_PARTICIPANTS_DROPDOWN_URL, Pos++);
		g_ParticipantsFilterUICommand.UICommand.ToolTip= VIEW_PARTICIPANTS_DROPDOWN_TOOLTIP;
		g_ParticipantsFilterUICommand.UICommand.Label = VIEW_PARTICIPANTS_DROPDOWN_LABEL + GPT_S_STATUS_ALL;
		g_ParticipantsFilterUICommand.UICommand.UserData = GPT_S_STATUS_ALL;

		// Populate command with all participants.
		UpdateParticipantsInICommandContainer(g_ParticipantsFilterUICommand, this.pIContactProvider);

		// Recall last participant filter used.
		var bParticipantFilterOn = false;
		if(PropertyList.PropertyExists("ParticipantSelectionText") && PropertyList.PropertyExists("ParticipantSelectionData"))
		{
			var ParticipantText = PropertyList.OpenPropertyAsString("ParticipantSelectionText");
			var ParticipantData = PropertyList.OpenPropertyAsString("ParticipantSelectionData");
			if(ParticipantText && ParticipantText != "" && ParticipantData && ParticipantData != "")
			{
				g_ParticipantsFilterUICommand.UICommand.Label = ParticipantText;
				g_ParticipantsFilterUICommand.UICommand.UserData = ParticipantData;
				bParticipantFilterOn = true;
			}
		}
		
		// Status filter.
		g_UIProjectStatusCC = this.UICommandContainer.InsertUICommandContainer(VIEW_STATUS_DROPDOWN_URL, Pos++);
		g_UIProjectStatusCC.UICommand.ToolTip = VIEW_STATUS_DROPDOWN_TOOLTIP;
		g_UIProjectStatusCC.UICommand.Label = VIEW_STATUS_DROPDOWN_LABEL + GPT_S_STATUS_ALL;
		g_UIProjectStatusCC.UICommand.UserData = GPT_S_STATUS_ALL;

		// Populate status command with status options.
		pIUICommand = g_UIProjectStatusCC.UICommandContainer.InsertUICommand(VIEW_STATUS_DROPDOWN_URL, 0);
		pIUICommand.Label = GPT_S_STATUS_ALL;
		pIUICommand.UserData = GPT_S_STATUS_ALL;

		pIUICommand = g_UIProjectStatusCC.UICommandContainer.InsertUICommand(VIEW_STATUS_DROPDOWN_URL, 1);
		pIUICommand.Label = GPT_S_STATUS_NOTSTARTED;
		pIUICommand.UserData = GPT_S_STATUS_NOTSTARTED;

		pIUICommand = g_UIProjectStatusCC.UICommandContainer.InsertUICommand(VIEW_STATUS_DROPDOWN_URL, 2);
		pIUICommand.Label = GPT_S_STATUS_INPROGRESS;
		pIUICommand.UserData = GPT_S_STATUS_INPROGRESS;

		pIUICommand = g_UIProjectStatusCC.UICommandContainer.InsertUICommand(VIEW_STATUS_DROPDOWN_URL, 3);
		pIUICommand.Label = GPT_S_STATUS_COMPLETE;
		pIUICommand.UserData = GPT_S_STATUS_COMPLETE;

		// Recall last status filter used.
		var bStatusFilterOn = false;
		if(PropertyList.PropertyExists("StatusSelectionText") && PropertyList.PropertyExists("StatusSelectionData"))
		{
			var StatusText = PropertyList.OpenPropertyAsString("StatusSelectionText");
			var StatusData = PropertyList.OpenPropertyAsString("StatusSelectionData");
			if(StatusText && StatusText != "" && StatusData && StatusData != "")
			{
				g_UIProjectStatusCC.UICommand.Label = StatusText;
				g_UIProjectStatusCC.UICommand.UserData = StatusData;
				bStatusFilterOn = true;
			}
		}

		if (bParticipantFilterOn || bStatusFilterOn)
			this.RedrawDataViewer();
	}

	function ProjectViewClass_HideUICommands()
	{
		// New task
		if(this.UICommandContainer.UICommandExists(FILE_NEW_TASK_URL))
		{
			this.UICommandContainer.RemoveUICommand(FILE_NEW_TASK_URL);
		}

		// Clipboard functions
		if(this.UICommandContainer.UICommandExists(EDIT_CUT_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_CUT_URL);
		}

		if(this.UICommandContainer.UICommandExists(EDIT_COPY_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_COPY_URL);
		}

		if(this.UICommandContainer.UICommandExists(EDIT_PASTE_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_PASTE_URL);
		}

		// Delete
		if(this.UICommandContainer.UICommandExists(EDIT_DELETE_ITEM_URL))
		{
			this.UICommandContainer.RemoveUICommand(EDIT_DELETE_ITEM_URL);
		}

		// Unread functions
		if(this.UICommandContainer.UICommandExists(VIEW_PREVUNREAD_URL))
		{
			this.UICommandContainer.RemoveUICommand(VIEW_PREVUNREAD_URL);
		}

		if(this.UICommandContainer.UICommandExists(VIEW_NEXTUNREAD_URL))
		{
			this.UICommandContainer.RemoveUICommand(VIEW_NEXTUNREAD_URL);
		}

		if(this.UICommandContainer.UICommandContainerExists(VIEW_UNREADOPTIONS_URL))
		{
			this.UICommandContainer.RemoveUICommandContainer(VIEW_UNREADOPTIONS_URL);
		}

		// Participants
		if(this.UICommandContainer.UICommandContainerExists(VIEW_PARTICIPANTS_DROPDOWN_URL))
		{
			this.UICommandContainer.RemoveUICommandContainer(VIEW_PARTICIPANTS_DROPDOWN_URL);
		}

		// Status
		if(this.UICommandContainer.UICommandContainerExists(VIEW_STATUS_DROPDOWN_URL))
		{
			this.UICommandContainer.RemoveUICommandContainer(VIEW_STATUS_DROPDOWN_URL);
		}

		// Report View
		if(this.UICommandContainer.UICommandExists(VIEW_REPORT_URL))
		{
			this.UICommandContainer.RemoveUICommand(VIEW_REPORT_URL);
		}

		// Remove separatords
		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR1_URL);
		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR2_URL);
		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR3_URL);
		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR4_URL);
		this.UICommandContainer.RemoveSeparator(PROJECT_SEPARATOR5_URL);
	}


	function ProjectViewClass_OnTranslateAccelerator(i_Msg, i_KeyCode, i_KeyState, i_KeyModifiers)
	{
		if(State_ViewMode == this.CurrentMode)
		{
			if(GROOVE_WM_KEYDOWN == i_Msg && GROOVE_VK_DELETE == i_KeyCode)
			{
				if (State_ViewMode == this.CurrentMode && this.CanDelete &&
				    !this.DetailsView.DoesDescriptionHaveFocus())
				{
					this.OnDelete();
				}
				return true;
			}
			// Toggle unread marks when the insert key is pressed.
			else if(i_Msg == 0x100 && i_KeyCode == 0x2D)
			{
				this.ToggleUnreadMarks();
				return true;
			}
			// Handle select all (ctrl+a)
			else if(i_Msg == 0x100 && i_KeyCode == 0x41 && i_KeyModifiers == GROOVE_KEYMOD_CONTROL)
			{
				// Select all rows in data list.
				this.DataListDisplay.SelectAllRows();

				if (this.DataListDisplay.SelectedRowCount > 1)
				{
					// Clear ACL cache, when multiple items are selected to allow all activity.
					this.InitACLCache(true);
				}
				return true;
			}
		}
		else if(State_EditMode == this.CurrentMode)
		{
			if(GROOVE_WM_KEYDOWN == i_Msg && GROOVE_VK_ESC == i_KeyCode)
			{
				this.OnClose();
				return true;
			}
			else if(GROOVE_WM_KEYDOWN == i_Msg && (i_KeyModifiers & GROOVE_KEYMOD_CONTROL) && GROOVE_VK_S == i_KeyCode)
			{
				this.OnSave();
				return true;
			}
			// Put the current time in the minutes if the user presses CTRL-T.  Only do it on Keydown message.
			else if(i_Msg == 0x100 && i_KeyCode == 0x54 && i_KeyModifiers == GROOVE_KEYMOD_CONTROL)
			{
				this.DetailsView.RTFInsertTime();
				return true;
			}
		}

		return false;
	}


	//
	// Handle UI command
	//
	function ProjectViewClass_OnCommand(i_UICommand)
	{
		// Dispatch to handling routine
		switch(i_UICommand.CommandURL)
		{
			case GPT_REDO_URL:
			{
				// Redo tasks when we're in view mode
				if(State_ViewMode == this.CurrentMode)
				{
					MHF_ShowWaitCursor(true);
					try
					{
						if (this.DynamicsManager.DoesDeltaToRedoExist(this.SessionName))
							this.DynamicsManager.RedoDelta(this.SessionName);
					}
					catch(e)
					{
						// Do nothing
					}
					MHF_ShowWaitCursor(false);
				}

				// Redo clipboard operation
				else if (this.DetailsView.CanRedo())
				{
					this.DetailsView.RedoClipboardOperation();
				}
				break;
			}

			case GPT_UNDO_URL:
			{
				// Undo tasks when we're in view mode
				if(State_ViewMode == this.CurrentMode)
				{
					MHF_ShowWaitCursor(true);

					try
					{
						if (this.DynamicsManager.DoesDeltaToUndoExist(this.SessionName))
							this.DynamicsManager.UndoDelta(this.SessionName);
					}
					catch(e)
					{
						// Do nothing
					}

					MHF_ShowWaitCursor(false);
				}

				// Undo
				else if (this.DetailsView.CanUndo())
				{
					this.DetailsView.UndoClipboardOperation();
				}
				break;
			}

			case FILE_NEW_TASK_URL:
			{
				// Add new task
				this.OnNewTask();
				break;
			}

			case SAVE_BUTTON_COMMANDURL:
			{
				// Save the task.
				this.OnSave();
				break;
			}

			case CLOSE_BUTTON_COMMANDURL:
			{
				this.OnClose();
				break;
			}
			
			case EDIT_BUTTON_COMMANDURL:
			{
				this.OnEdit();
				break;
			}

			case EDIT_SELECTALL_URL:
			{
				// Select all rows in data list.
				this.DataListDisplay.SelectAllRows();
				break;
			}

			case EDIT_DELETE_ITEM_URL:
			{
				// Cut tasks we're in view mode
				if(State_ViewMode == this.CurrentMode)
				{
					this.OnDelete();
				}

				// Cut text when in edit mode
				else if(this.DetailsView.CanCutToClipboard())
				{
					this.DetailsView.DeleteSelectedText();
				}

				break;
			}

			case PROJECT_MOVEITEMUP_URL:
			{
				// Move task up
				this.OnMoveItemUp();
				break;
			}

			case PROJECT_MOVEITEMDOWN_URL:
			{
				// Move task down
				this.OnMoveItemDown();
				break;
			}

			case PROJECT_SAVEASTEMPLATE_URL:
			{
				this.OnSaveTemplate();
				break;
			}

			case FILE_IMPORT_MSP_URL:
			{
				this.OnImportFromMSProject();
				break;
			}

			case FILE_EXPORT_MSP_URL:
			{
				this.OnExportToMSProject();
				break;
			}
			
			case EDIT_MARKREAD_URL:
			{
				this.MarkSelectedRead(true);
				break;
			}

			case EDIT_MARKUNREAD_URL:
			{
				this.MarkSelectedRead(false);
				break;
			}

			case EDIT_MARKALLREAD_URL:
			{
				this.MarkAllRead(true);
				break;
			}

			case EDIT_MARKALLUNREAD_URL:
			{
				this.MarkAllRead(false);
				break;
			}

			case EDIT_COPYASLINK_URL:
			{
				if(State_ViewMode == this.CurrentMode)
				{
					SetClipboardEmpty();
					CopyAsLinkToClipboard(this.GetItemURL(this.SelectedItem.ID), this.SelectedItem.Name);
				}
				break;
			}

			case EDIT_COPY_URL:
			{
				// Does the description field have focus?
				var bView = this.DetailsView.DoesDescriptionHaveFocus();

				// Copy selected tasks(s) when in view mode
				if(State_ViewMode == this.CurrentMode && !bView)
				{
					this.OnCopy();
				}
				
				// Copy text if we can
				else if (this.DetailsView.CanCopyToClipboard())
				{
					this.DetailsView.CopyToClipboard()
				}

				break;
			}

			case EDIT_PASTE_URL:
			{
				// Paste tasks when in view mode
				if(State_ViewMode == this.CurrentMode)
				{
					this.OnPaste();
				}

				// Paste text when in edit mode
				else if (this.DetailsView.CanPasteFromClipboard())
				{
					this.DetailsView.PasteFromClipboard();
				}
				break;
			}
			
			case EDIT_CUT_URL:
			{
				// Cut tasks we're in view mode
				if(State_ViewMode == this.CurrentMode)
				{
					this.OnCut();
				}

				// Cut text when in edit mode
				else if(this.DetailsView.CanCutToClipboard())
				{
					this.DetailsView.CutToClipboard();
				}
				break;
			}

			case PROJECT_DEMOTE_URL:
			{
				// Demote the task
				this.OnDemote();
				break;
			}

			case PROJECT_PROMOTE_URL:
			{
				// Promote task
				this.OnPromote();
				break;
			}

			case VIEW_REPORT_URL:
			{
				this.OnViewReport();
				break;
			}

			case GPT_S_STATUS_ALL:
			case GPT_S_STATUS_NOTSTARTED:
			case GPT_S_STATUS_INPROGRESS:
			case GPT_S_STATUS_COMPLETE:
			{
				// If we are in edit mode, do nothing
				if (State_EditMode == this.CurrentMode)
					return;

				// Set check mark state
				if (null != g_CheckedStatusMenuUICommand && i_UICommand != g_CheckedStatusMenuUICommand)
				{
					i_UICommand.CheckState = GrooveCheckState_Checked;
					g_CheckedStatusMenuUICommand.CheckState = GrooveCheckState_Unchecked;

					// Remember menu command
					g_CheckedStatusMenuUICommand = i_UICommand;
				}

				// Update view
				if (GPT_S_STATUS_ALL == i_UICommand.UserData)
					g_UIProjectStatusCC.UICommand.Label = VIEW_STATUS_DROPDOWN_LABEL + i_UICommand.Label;
				else
					g_UIProjectStatusCC.UICommand.Label = i_UICommand.Label;

				g_UIProjectStatusCC.UICommand.UserData = i_UICommand.UserData;
				this.RedrawDataViewer();
				break;
			}

			case VIEW_STATUS_DROPDOWN_URL:
			{
				// If we are in edit mode, do nothing
				if (State_EditMode == this.CurrentMode)
					return;

				// Figure out which menu item needs to be checked.
				var StatusCC = this.ViewCC.OpenUICommandContainer(VIEW_STATUS_DROPDOWN_URL);
				var MenuCommand = null;
				if (null != StatusCC)
					MenuCommand = StatusCC.OpenUICommand(i_UICommand.UserData);

				// Set check mark state
				if (null != MenuCommand &&
					null != g_CheckedStatusMenuUICommand &&
					MenuCommand != g_CheckedStatusMenuUICommand)
				{
					MenuCommand.CheckState = GrooveCheckState_Checked;
					g_CheckedStatusMenuUICommand.CheckState = GrooveCheckState_Unchecked;

					// Remember menu command
					g_CheckedStatusMenuUICommand = MenuCommand;
				}

				if (GPT_S_STATUS_ALL == i_UICommand.UserData)
					g_UIProjectStatusCC.UICommand.Label = VIEW_STATUS_DROPDOWN_LABEL + i_UICommand.Label;
				else
					g_UIProjectStatusCC.UICommand.Label = i_UICommand.Label;

				g_UIProjectStatusCC.UICommand.UserData = i_UICommand.UserData;

				PropertyList.SetPropertyAsString("StatusSelectionText", g_UIProjectStatusCC.UICommand.Label, GroovePropertyFlag_Private);
				PropertyList.SetPropertyAsString("StatusSelectionData", g_UIProjectStatusCC.UICommand.UserData, GroovePropertyFlag_Private);

				this.RedrawDataViewer();
				break;
			}

			case PROJECT_MARK_COMPLETE_URL:
			{
				this.OnMarkComplete(i_UICommand);
				break;
			}

			case VIEW_NEXTUNREAD_URL:
			{
				this.NavigateNextUnread();
				break;
			}

			case VIEW_PREVUNREAD_URL:
			{
				this.NavigatePrevUnread();
				break;
			}
		}

		// Special processing for Participants filter commands:
		// Does command URL start with VIEW_PARTICIPANTS_DROPDOWN_URL
		var Command = i_UICommand.CommandURL;
		if (0 == Command.search(VIEW_PARTICIPANTS_DROPDOWN_URL))
		{
			// If we are in edit mode, do nothing.
			if (State_EditMode == this.CurrentMode)
				return;

			// Figure out which menu item needs to be checked.
			var ParticipantCC = this.ViewCC.OpenUICommandContainer(VIEW_PARTICIPANTS_DROPDOWN_URL);
			var MenuCommand = null;
			if (null != ParticipantCC)
			{
				MenuCommand = ParticipantCC.OpenUICommand(VIEW_PARTICIPANTS_DROPDOWN_URL+i_UICommand.UserData);
			}

			// Set check mark state
			if (null != MenuCommand &&
				null != g_CheckedParticipantMenuUICommand &&
				MenuCommand != g_CheckedParticipantMenuUICommand)
			{
				MenuCommand.CheckState = GrooveCheckState_Checked;
				g_CheckedParticipantMenuUICommand.CheckState = GrooveCheckState_Unchecked;

				// Remember menu command
				g_CheckedParticipantMenuUICommand = MenuCommand;
			}

			if (GPT_S_STATUS_ALL == i_UICommand.UserData)
				g_ParticipantsFilterUICommand.UICommand.Label = VIEW_PARTICIPANTS_DROPDOWN_LABEL + i_UICommand.Label;
			else
			{
				//-----
				//- Unfortunately the entire name may not fit into the selected portion of the
				//- command container in 800 x 600 res. Hence, the UI team decided to restrict
				//- to a maximum of 11 characters (used W to determine how many fit).
				//- Chances are that other characters will fall into the mix so we'll allow a few more.
				//- Hence, we will truncate at 14 - 3 to allow for an elipses.
				//-----
				if (i_UICommand.Label.length > 14)
				{
					g_ParticipantsFilterUICommand.UICommand.Label = i_UICommand.Label.slice(0,11) + "...";
				}
				else
				{
					g_ParticipantsFilterUICommand.UICommand.Label = i_UICommand.Label;
				}
			}
			
			g_ParticipantsFilterUICommand.UICommand.UserData = i_UICommand.UserData;

			PropertyList.SetPropertyAsString("ParticipantSelectionText", g_ParticipantsFilterUICommand.UICommand.Label, GroovePropertyFlag_Private);
			PropertyList.SetPropertyAsString("ParticipantSelectionData", g_ParticipantsFilterUICommand.UICommand.UserData, GroovePropertyFlag_Private);

			this.RedrawDataViewer();
		}

		return;
	}

	//
	// Update UI command state
	// Default is to not change the UI state
	//
	function ProjectViewClass_OnUpdateCommandState(i_UICommand)
	{
		// Update the ACL cache if necessary
		if (this.UINeedsACLCheck)
		{
			this.RefreshACLCache();
			this.UINeedsACLCheck = false;
		}

		switch(i_UICommand.CommandURL)
		{
			case GPT_REDO_URL:
			{
				if (State_ViewMode == this.CurrentMode)
					i_UICommand.Enabled = this.DynamicsManager.DoesDeltaToRedoExist(this.SessionName);
				else
					i_UICommand.Enabled = this.DetailsView.CanRedo();

				break;
			}

			case GPT_UNDO_URL:
			{
				if (State_ViewMode == this.CurrentMode)
					i_UICommand.Enabled = this.DynamicsManager.DoesDeltaToUndoExist(this.SessionName);
				else
					i_UICommand.Enabled = this.DetailsView.CanUndo();

				break;
			}

			case SAVE_BUTTON_COMMANDURL:
			{
				i_UICommand.Enabled = true;
				break;
			}

			case CLOSE_BUTTON_COMMANDURL:
			{
				i_UICommand.Enabled = false;
				break;
			}

			// Deletion
			case EDIT_DELETE_ITEM_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode)
										? (this.CanDelete && (false == this.DataListDisplay.IsRowSelected(this.ProjectID)) &&
										   !this.DetailsView.DoesDescriptionHaveFocus())
										: this.DetailsView.CanCutToClipboard();
				break;
			}

			// Add task
			case FILE_NEW_TASK_URL:
			{
				i_UICommand.Enabled = this.CanAdd;
				break;
			}

			// Edit button
			case EDIT_BUTTON_COMMANDURL:
			{
				i_UICommand.Enabled = this.CanEdit;
				break;
			}

			// Import from MSProject
			case FILE_IMPORT_MSP_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? this.CanImport : false;
				break;
			}

			// Export to MSProject
			case FILE_EXPORT_MSP_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? true : false;
				break;
			}

			// You can always copy while in view mode
			// but you can never copy the root item
			case EDIT_COPY_URL:
			{
				// Does the description field have focus?
				var bEnable = this.DetailsView.DoesDescriptionHaveFocus()
				if (State_ViewMode == this.CurrentMode && !bEnable)
				{
					// Copy task
					bEnable = (false == this.DataListDisplay.IsRowSelected(this.ProjectID));
				}
				else
				{
					bEnable = this.DetailsView.CanCopyToClipboard();
				}

				i_UICommand.Enabled = bEnable;
				break;
			}

			// Cut
			case EDIT_CUT_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode)
										 ? (this.CanCut && false == this.DataListDisplay.IsRowSelected(this.ProjectID) &&
											!this.DetailsView.DoesDescriptionHaveFocus())
										 : this.DetailsView.CanCutToClipboard();
				break;
			}

			// Paste
			case EDIT_PASTE_URL:
			{
				if (State_ViewMode == this.CurrentMode)
				{
					i_UICommand.Enabled = this.CanAdd &&
									(this.GetClipboard().IsDataAvailable(PROJECTITEM_CLIPBOARDFORMAT) ||
									 this.GetClipboard().IsDataAvailable(PROJECTITEM_CLIPBOARDFORMAT2));
				}
				else
				{
					i_UICommand.Enabled = this.DetailsView.CanPasteFromClipboard();
				}

				break;
			}

			// Participants filter command and menu command
			case VIEW_PARTICIPANTS_DROPDOWN_URL:
			{
				if (g_ParticipantsFilterUICommand)
				{
					g_ParticipantsFilterUICommand.UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? true : false;
				}

				if (g_ParticipantsFilterMenuUICommand)
				{
					g_ParticipantsFilterMenuUICommand.UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? true : false;
				}
			}

			// Status filter command
			case VIEW_STATUS_DROPDOWN_URL:
			{
				if (g_CheckedStatusMenuUICommand)
				{
					g_CheckedStatusMenuUICommand.UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? true : false;
				}
			}

			// Unread options.
			case VIEW_UNREADOPTIONS_URL:
			{
				g_UnreadOptionsUICommand.UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? true : false;
			}

			// Commands that are enabled in view mode, but disabled in edit mode.
			case EDIT_SELECTALL_URL:
			case EDIT_COPYASLINK_URL:
			case PROJECT_SAVEASTEMPLATE_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? true : false;
				break;
			}

			// Move up
			case PROJECT_MOVEITEMUP_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? (this.CanMoveUp && this.IsFilterOn()) : false;
				break;
			}

			// Move down
			case PROJECT_MOVEITEMDOWN_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? (this.CanMoveDown && this.IsFilterOn()) : false;
				break;
			}

			// Move in
			case PROJECT_DEMOTE_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? (this.CanDemote && this.IsFilterOn()) : false;
				break;
			}

			// Move out
			case PROJECT_PROMOTE_URL:
			{
				i_UICommand.Enabled = (State_ViewMode == this.CurrentMode) ? (this.CanPromote && this.IsFilterOn()) : false;
				break;
			}

			case VIEW_NEXTUNREAD_URL:
			{
				i_UICommand.Enabled = this.CollectionDataListDataSource.Rows.IGrooveDataListRows.CanMoveCursor(GrooveDataListRowNavigation_NextUnread);
				break;
			}

			case VIEW_PREVUNREAD_URL:
			{
				i_UICommand.Enabled = this.CollectionDataListDataSource.Rows.IGrooveDataListRows.CanMoveCursor(GrooveDataListRowNavigation_PriorUnread);
				break;
			}

			case VIEW_UNREADOPTIONS_URL:
			{
				i_UICommand.Enabled = true;
				break;
			}

			case VIEW_REPORT_URL:
			{
				i_UICommand.Enabled = true;
				break;
			}
		}

		if (State_ViewMode == this.CurrentMode ||
			(State_EditMode == this.CurrentMode && this.DetailsView.IsNewItem()))
		{
			this.DetailsView.UpdateButtonsState(this.CanDelete, this.CanEdit);
		}
	}

	//
	// Respond to UI Delete event
	//
	function ProjectViewClass_OnDelete()
	{
		// This should never happen
		if(State_EditMode == this.CurrentMode)
		{
			GrooveDebugFunctions.DisplayAssert(0, "Cannot delete while in edit mode");
			return;
		}

		// Project task may not be deleted.
		if (this.DataListDisplay.IsRowSelected(this.ProjectID))
		{
			// Display user message and return.
			MHF_MessageBox(STR_NODELETEPROJECTTASK_MESSAGE, STR_DELETE_TITLE,
						   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return;
		}

		// Show wait cursor if we have more than  two items selected
		var bShowWaitCursor = false;
		if (this.DataListDisplay.SelectedRowCount > 2)
		{
			bShowWaitCursor = true;
			MHF_ShowWaitCursor(true);
		}

		// Figure out how many tasks and summary tasks we have.
		var DeleteIDEnum = this.DataListDisplay.CreateSelectedRowEnum(GrooveDataListSelectionFlags_Ordered);
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			// How many items selected?
			var pTask = null;
			var NumSelected = 0;
			var SummaryTaskSelected = 0;
			while(DeleteIDEnum.HasMore())
			{
				// Get next item.
				var ItemID = DeleteIDEnum.OpenNext();

				// Ignore items that do not exist?
				if (false == this.pIDataModelDelegate.DoesItemExist(ItemID))
				{
					continue;
				}

				// Check permissions
				pTask = this.GetItemFromID(ItemID);
				if (false == this.pIDataModelDelegate.CanDeleteItem(ItemID, false))
				{
					// Abort transaction.
					Transaction.Abort();
					
					var strMessage = String(STR_NODELETEPERMISSION_MESSAGE);
					strMessage = strMessage.replace(/%taskname/i, pTask.Name);

					// Display user message and return.
					MHF_MessageBox(strMessage, STR_DELETE_TITLE,
								   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
					return;
				}

				// Is this a summary task?
				if (pTask.IsSummary)
					SummaryTaskSelected++;

				// Increment task counter.
				NumSelected++;
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
		}

		// Setup confirmation message.
		var Message = STR_CONFIRMDELETE_MESSAGE;
		if (1 == NumSelected)
		{
			if (SummaryTaskSelected)
				Message += STR_CONFIRMSUMMARYTASKDELETE_MESSAGE; 
			else
				Message += STR_CONFIRMTASKDELETE_MESSAGE;

			Message += "\"";
			Message += pTask.Name;
			Message += "\"";
			Message += STR_QUESTIONMARK;
		}
		else
		{
			Message += NumSelected;
			Message += STR_CONFIRMMULTIPLEDELETE_MESSAGE;
			Message += STR_QUESTIONMARK;

			if (1 == SummaryTaskSelected)
			{
				Message += STR_SUMMARYTASKSELECTED_MESSAGE;
			}
			else if (1 < SummaryTaskSelected)
			{
				Message += STR_SEVERALSUMMARYTASKSSELECTED_MESSAGE;
			}
		}

		if (SummaryTaskSelected)
			Message += STR_DELETESUBTASKS_MESSAGE;
		
		// Remove wait cursor before displaying a message
		if (bShowWaitCursor)
		{
			MHF_ShowWaitCursor(false);
		}

		// Verify delete with user.
		if(GrooveMessageBoxResultCode_Yes == MHF_MessageBox(Message, STR_CONFIRMDELETE_TITLE, GrooveMessageBoxStyle_YesNo, GrooveMessageBoxIcon_Exclamation))
		{
			// Do the delete
			var DynamicsMgr = this.DynamicsManager;
			var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
			try
			{
				if (bShowWaitCursor)
				{
					MHF_ShowWaitCursor(true);
				}

				// Delete selected items
				this.pIDataModelDelegate.DeleteMultipleItems(DeleteIDEnum, this.GetProgressInterface());
				pIDelta.Commit();
				if (bShowWaitCursor)
				{
					MHF_ShowWaitCursor(false);
				}
			}
			catch(e)
			{
				pIDelta.Abort();
				if (bShowWaitCursor)
				{
					MHF_ShowWaitCursor(false);
				}

				if (-2147024891 == e.number)
				{
					// User does not have permission
					this.CanDelete = false;
				}
				else PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_DELETING);
			}
		}
				
		// wait for async notification to update our UI
	}

	//
	// Respond to UI Add event
	//
	function ProjectViewClass_OnMarkComplete(i_UICommand)
	{
		GrooveDebugFunctions.DisplayAssert(i_UICommand.CommandURL == PROJECT_MARK_COMPLETE_URL,
									"Invalid command");
	}
	
	function ProjectViewClass_OnNewTask()
	{
		//xxx BBLATER - do we really need this check?
		if(null == this.SelectedItem)
		{
			GrooveDebugFunctions.DisplayAssert(0, "No task selected");
			return;
		}

		// Prompt the user to save changes before exiting edit mode
		// and switch to view mode.
		if (State_EditMode == this.CurrentMode)
		{
			// Get ID of focus row.
			var ID = this.DataListDisplay.FocusRow;

			if (!this.SwitchToViewMode(ID, true))
				return;

			this.RefreshSelectedItem();
		}

		// Find the parent to add to.
		var pIParent = null;
		var pIInsertBefore = null;
		var ProjectStartTime = -1;
		var NewTaskStartTime = -1;

		if (GrooveProjectTrackingItemType_Project == this.SelectedItemType)
		{
			pIParent = this.SelectedItem;
			// null insertion point == append

			// Need project start time for validation
			ProjectStartTime = pIParent.ScheduledStart;

			// Use projects start time as default for new task
			NewTaskStartTime = ProjectStartTime;
		}
		else
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				// Need project start time for validation
				var pProjectItem = this.pIDataModelDelegate.GetProject();
				ProjectStartTime = pProjectItem.ScheduledStart;

				if (this.pIDataModelDelegate.DoesItemExist(this.SelectedItem.ID))
				{
					// Check Add permission.
					if (false == this.CanAdd || false == this.pIDataModelDelegate.CanAddItem(GrooveProjectTrackingItemType_Task))
					{
						// Abort transaction.
						Transaction.Abort();
						
						// Display user message and return.
						MHF_MessageBox(STR_NOADDERMISSION_MESSAGE, STR_ADD_TITLE,
									   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
						return;
					}

					// Use selected tasks start time as default for new task.
					NewTaskStartTime = this.SelectedItem.ScheduledStart;

					var ParentItemType = this.pIDataModelDelegate.GetItemType(this.SelectedItem.ParentID);
					pIParent = this.GetItem(this.SelectedItem.ParentID, ParentItemType);
					Transaction.Commit();
				}
				else
				{
					// Use projects start time as default for new task
					NewTaskStartTime = pProjectItem.ScheduledStart;

					Transaction.Abort();
					this.NotifyUserOfItemRemoval();
					return;
				}
			}
			catch(e)
			{
				Transaction.Abort();

				if (-2147024891 == e.number)
				{
					// User does not have permission
					this.CanAdd = false;
				}
				else PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_ADDING);

				return;
			}

			// Set insertion point
			pIInsertBefore = this.SelectedItem;
		}

		// Set the tool state for edit mode and display the Create Task subform
		this.EnterEditMode();

		var Result = this.DetailsView.CreateTask(this, this.SelectedItem, pIParent,
												 this.SelectedItemType,
												 pIInsertBefore, ProjectStartTime, NewTaskStartTime);
									
		while(Result == GrooveDialogBoxResultCode_OK)
		{
			var ScheduledFinish = this.DetailsView.GetScheduledFinish();
			var Duration = this.DetailsView.GetScheduledDuration();
			var NewItemID = this.SaveNewTask
									(
										this.DetailsView.GetParentID(),
										this.DetailsView.GetPreviousSiblingID(),
										this.DetailsView.GetName(),
										this.DetailsView.GetAssignedToContactURL(),
										MHF_GetStatusEnumFromString(this.DetailsView.GetStatus()),
										MHF_GetPriorityEnumFromString(this.DetailsView.GetPriority()),
										this.DetailsView.GetUserStartConstraint(),
										this.DetailsView.GetConstrainStartFlag(),
										this.DetailsView.GetScheduledStart(), Duration,
										ScheduledFinish,
										MHF_GetDisplayFinishDateMS(Duration, ScheduledFinish),
										this.DetailsView.GetActualStart(),
										this.DetailsView.GetActualFinish(),
										this.DetailsView.GetIsPrivate(),
										this.DetailsView.GetDescription(),
										this.DetailsView.GetNewPredecessorsArray()
									);

			if (this.DetailsView.SaveOnce())
				break;

			var pNewItem = null;
			var pNewItemParent = null;
			var ParentItemType;
			var NewItemType;
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(true);
			try
			{
				if (this.pIDataModelDelegate.DoesItemExist(NewItemID))
				{
					NewItemType = this.pIDataModelDelegate.GetItemType(NewItemID);
					pNewItem = this.GetItem(NewItemID, NewItemType);

					ParentItemType = this.pIDataModelDelegate.GetItemType(pNewItem.ParentID);
					pNewItemParent = this.GetItem(pNewItem.ParentID, ParentItemType);

					// Use last new task start time as default for new task.
					NewTaskStartTime = pNewItem.ScheduledStart;

					Transaction.Commit();
				}
				else
				{
					// Use project start time as default for new task.
					NewTaskStartTime = this.pIDataModelDelegate.GetProject().ScheduledStart;

					Transaction.Commit();
					this.NotifyUserOfItemRemoval();
					break;
				}
			}
			catch(e)
			{
				Transaction.Abort();
				PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_ADDING);
				break;
			}

			// Set insertion point
			pIInsertBefore = pNewItem;
			Result = this.DetailsView.CreateTask(this, pNewItem, pNewItemParent,
												 NewItemType, pIInsertBefore,
												 ProjectStartTime,
												 NewTaskStartTime);
		}

		this.DetailsView.CloseNewItemWindow();
		this.EnterViewMode();
	}

	function ProjectViewClass_OnMoveItemDown()
	{
		// Check if we can move task up
		var ResultItem = null;
		if (this.DataListDisplay.IsRowSelected(this.ProjectID) ||
		    null != (ResultItem = this.CheckACLItem(g_CAN_MOVE_DOWN)))
		{		
			var Name = (null == ResultItem || this.ProjectID == ResultItem.ID) ? GPT_S_PROJECTNAME_LABEL : "\""+ResultItem.Name+"\"";

			// Display user message and return.
			var strMessage = String(STR_NOMOVEDOWNPERMISSION_MESSAGE);
			strMessage = strMessage.replace(/%taskname/i, Name);

			MHF_MessageBox(strMessage, STR_MOVEDOWN_TITLE,
						   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return;
		}

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
		try
		{
			var SelectionIDEnum = this.GetReversedSelectionEnum();

			// If the selection contains parent and child items, we only
			// need to consider the parent items since the operation will
			// automatically be applied to the children
			// AMLATER - move this function out of datamodel helper functions
			SelectionIDEnum = PDHF_RemoveRedundantDecendants(SelectionIDEnum);

			// Loop through all items and move them.
			while(SelectionIDEnum.HasMore())
			{
				this.pIDataModelDelegate.MoveItemDown(SelectionIDEnum.OpenNext());
			}

			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();

			if (-2147024891 == e.number)
			{
				// User does not have permission
				this.CanDelete = false;
			}
			else PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MOVING);
		}

		// Force refresh of ACL cache for UI command update
		if (this.DataListDisplay.SelectedRowCount == 1)
			this.UINeedsACLCheck = true;
	}


	function ProjectViewClass_OnMoveItemUp()
	{
		// Check if we can move task up
		var ResultItem = null;
		if (this.DataListDisplay.IsRowSelected(this.ProjectID) ||
		    null != (ResultItem = this.CheckACLItem(g_CAN_MOVE_UP)))
		{
			var Name = (null == ResultItem || this.ProjectID == ResultItem.ID) ? GPT_S_PROJECTNAME_LABEL : "\""+ResultItem.Name+"\"";

			// Display user message and return.
			var strMessage = String(STR_NOMOVEUPPERMISSION_MESSAGE);
			strMessage = strMessage.replace(/%taskname/i, Name);

			MHF_MessageBox(strMessage, STR_MOVEUP_TITLE,
						   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return;
		}

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
		try
		{
			var SelectionIDEnum = this.DataListDisplay.CreateSelectedRowEnum(GrooveDataListSelectionFlags_Ordered);

			// If the selection contains parent and child items, we only
			// need to consider the parent items since the operation will
			// automatically be applied to the children
			// AMLATER - move this function out of datamodel helper functions
			SelectionIDEnum = PDHF_RemoveRedundantDecendants(SelectionIDEnum);

			// Loop through all items and move them.
			while(SelectionIDEnum.HasMore())
			{
				this.pIDataModelDelegate.MoveItemUp(SelectionIDEnum.OpenNext());
			}

			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();

			if (-2147024891 == e.number)
			{
				// User does not have permission
				this.CanDelete = false;
			}
			else PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MOVING);
		}

		// Force refresh of ACL cache for UI command update
		if (this.DataListDisplay.SelectedRowCount == 1)
			this.UINeedsACLCheck = true;
	}

	function IsItemInArray(i_Array, i_Item, i_ArraySize)
	{
		var i;
		for (i = 0; i < i_ArraySize; i++)
		{
			if (i_Item == i_Array[i])
			{
				return true;
			}
		}
		return false;
	}

	function ProjectViewClass_OnDemote()
	{
		// Check if we can demote selection.
		var ResultItem = null;
		if (this.DataListDisplay.IsRowSelected(this.ProjectID) ||
			null != (ResultItem = this.CheckACLItem(g_CAN_DEMOTE)))
		{		
			var Name = (null == ResultItem || this.ProjectID == ResultItem.ID) ? GPT_S_PROJECTNAME_LABEL : "\""+ResultItem.Name+"\"";

			// Display user message and return.
			var strMessage = String(STR_NODEMOTEPERMISSION_MESSAGE);
			strMessage = strMessage.replace(/%taskname/i, Name);

			MHF_MessageBox(strMessage, STR_DEMOTE_TITLE,
						   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return;
		}

		// This may take a bit of time so let's show a wait cursor
		MHF_ShowWaitCursor(true);
				
		var CheckedArray = new Array;
		var CheckedCount = 0;
		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);

		try
		{
			// Get ordered selection because this is a requirement for RSE to work correctly
			// (sorted enum is slower)
			var SelectionIDEnum = this.DataListDisplay.CreateSelectedRowEnum(GrooveDataListSelectionFlags_Ordered);

			// If the selection contains parent and child items, we only
			// need to consider the parent items since the operation will
			// automatically be applied to the children
			// AMLATER - move this function out of datamodel helper functions
			SelectionIDEnum = PDHF_RemoveRedundantDecendants(SelectionIDEnum);

			var NewParentID = null;
			var PreviousDemoteID = null;
			while(SelectionIDEnum.HasMore())
			{
				// Get a selected item	
				var DemoteID = SelectionIDEnum.OpenNext();
				
				//-----
				//- Will there be a new parent for this task and if so will this parent 
				//- loose its predecessor information?  Only need to check the first task
				//- in an enumeration.
				//-----
				
				// Get the new parent for task
				if (this.pIDataModelDelegate.DoesItemExist(DemoteID))
				{
					// Get the task object
					var pItem = this.GetItemFromID(DemoteID);
					
					// The previous sibling will become the new parent.
					var PreviousSiblingID = (this.pIDataModelDelegate.DoesItemExist(pItem.PreviousSiblingID)) ? pItem.PreviousSiblingID : null;

					// If the last item to be demoted is not the previous sibling of the new item
					// to be demoted then we have a new parent for cycle check.
					if (PreviousDemoteID != PreviousSiblingID)
						NewParentID = PreviousSiblingID;
				}

				// Check if parent's predecessor info will be lost.
				// Do not check if checked previously
				if (null != NewParentID && !IsItemInArray(CheckedArray, NewParentID, CheckedCount))
				{
					// Does the new parent have predecessors?
					var pIPredecessorEnum = this.GetItemFromID(NewParentID).OpenPredecessorEnum();
					if (pIPredecessorEnum.HasMore())
					{
						pIDelta.Abort();

						// Prompt the user.
						var nResult = MHF_MessageBox(GPTPROJECT_MB_DEMOTE_LOOSE_INFO, GPTPROJECT_MB_DEMOTE_TITLE,
													GrooveMessageBoxStyle_YesNo, GrooveMessageBoxIcon_Information);
						if (GrooveMessageBoxResultCode_Yes == nResult)
						{
							// Restart the check
							pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
							CheckedArray[CheckedCount] = NewParentID;
							CheckedCount++;
							SelectionIDEnum.Reset();
							continue;
						}
						else
						{
							// Remove wait cursor and return.
							MHF_ShowWaitCursor(false);
							return;
						}

					}
				}

				// Check if demotion creates a cycle.
				if (this.pIDataModelDelegate.DoesDemoteCreateCycle(DemoteID, NewParentID))
				{
					pIDelta.Abort();

					// Remove wait cursor
					MHF_ShowWaitCursor(false);

					PHF_AlertUser(GPTPROJECT_MB_DEMOTE_CAUSES_CYCLE);
					return;
				}

				// Remember the ID of the item 
				PreviousDemoteID = DemoteID;
			}

			this.pIDataModelDelegate.DemoteMultipleItems(SelectionIDEnum, this.GetProgressInterface());

			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			if (-2147024891 == e.number)
			{
				// User does not have permission
				this.CanDemote = false;
			}
			else PHF_AlertUserOfFailure(GPTPROJECT_MB_DEMOTE_FAILURE);
		}

		// Force refresh of ACL cache for UI command update
		if (this.DataListDisplay.SelectedRowCount == 1)
			this.UINeedsACLCheck = true;

		// Parent has changed update display.
		this.OnFocusRowChanged();

		// Remove wait cursor
		MHF_ShowWaitCursor(false);
	}

	function ProjectViewClass_OnPromote()
	{
		// Check if we can promote selection.
		var ResultItem = null;
		if (this.DataListDisplay.IsRowSelected(this.ProjectID) ||
		    null != (ResultItem = this.CheckACLItem(g_CAN_PROMOTE)))
		{		
			var Name = (null == ResultItem || this.ProjectID == ResultItem.ID) ? GPT_S_PROJECTNAME_LABEL : "\""+ResultItem.Name+"\"";

			// Display user message and return.
			var strMessage = String(STR_NOPROMOTEPERMISSION_MESSAGE);
			strMessage = strMessage.replace(/%taskname/i, Name);

			MHF_MessageBox(strMessage, STR_PROMOTE_TITLE,
						   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return;
		}

		// This take a bit of time so let's show a wait cursor
		MHF_ShowWaitCursor(true);

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
		try
		{
			var SelectionIDEnum = this.GetReversedSelectionEnum();

			// If the selection contains parent and child items, we only
			// need to consider the parent items since the operation will
			// automatically be applied to the children
			// AMLATER - move this function out of datamodel helper functions
			SelectionIDEnum = PDHF_RemoveRedundantDecendants(SelectionIDEnum);

			this.pIDataModelDelegate.PromoteMultipleItems(SelectionIDEnum, this.GetProgressInterface());
			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();

			if (-2147024891 == e.number)
			{
				// User does not have permission
				this.CanPromote = false;
			}
			else PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_PROMOTING);
		}


		// Parent has changed update display.
		this.OnFocusRowChanged();

		// Remove wait cursor
		MHF_ShowWaitCursor(false);

		// Force refresh of ACL cache for UI command update
		if (this.DataListDisplay.SelectedRowCount == 1)
			this.UINeedsACLCheck = true;
	}

	//
	// Respond to replacement in data model
	// 
	function ProjectViewClass_OnItemReplaced(i_pIDEnum, i_bMoved)
	{
		// See if we need to refresh the details view
		var bRefresh = false;
		i_pIDEnum.Reset();
		while (i_pIDEnum.HasMore())
		{
			var ID = i_pIDEnum.OpenNext();
			if (ID == this.SelectedItem.ID)
			{
				bRefresh = true;
				break;
			}
		}

		// Work to do?
		if (false == bRefresh)
		{
			return;
		}

		var pIItem = null;
		var ParentItemType = GrooveProjectTrackingItemType_Invalid;
		var pIParentItem = null;
		var ItemType = GrooveProjectTrackingItemType_Invalid;

		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if(this.pIDataModelDelegate.DoesItemExist(this.SelectedItem.ID))
			{
				ItemType = this.pIDataModelDelegate.GetItemType(this.SelectedItem.ID);
				pIItem = this.GetItem(ID, ItemType);

				if(ItemType != GrooveProjectTrackingItemType_Project)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(pIItem.ParentID);
					pIParentItem = this.GetItem(pIItem.ParentID, ParentItemType);
				}
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_RESPONDINGTOREPLACE);
			return;
		}

		// If item no longer exists, we'll refresh the UI when we receive the async removal event
		if(null == pIItem)
		{
			return;
		}

		// Notify user of change. Do not notify the user when in new task dialog.
		var bRefreshDetailsView = true;
		if(State_EditMode == this.CurrentMode && false == this.DetailsView.IsNewItem())
		{
			// Do not refresh the UI.
			bRefreshDetailsView = false;

			var bNotifyUser = false;
			i_pIDEnum.Reset();
			while(i_pIDEnum.HasMore())
			{
				var ID = i_pIDEnum.OpenNext();
				if(ID == this.SelectedItem.ID)
				{
					var Transaction = Telespace.OpenTransaction(true);
					try
					{
						if(this.pIDataModelDelegate.DoesItemExist(ID))
						{
							var ChangedItemType = this.pIDataModelDelegate.GetItemType(ID);
							var ChangeItem = this.GetItem(ID, ChangedItemType);
							bNotifyUser = NeedUserNotification(ChangeItem, this.SelectedItem, ChangedItemType);

							// Update parent id incase item was moved.
							if (ChangeItem.ParentID != this.SelectedItem.ParentID)
							{
								this.SelectedItem.ParentID = ChangeItem.ParentID;
							}
						}
						Transaction.Commit();
					}
					catch(e)
					{
						Transaction.Abort();
					}
					break;
				}
			}

			// Only notify the user once
			if(false == this.UserNotifiedOfChange && bNotifyUser)
			{
				//-----
				//- xxx BBLATER: Unfortunately due to flaw, we cannot show a message box while
				//- inside this callback. Thus, we must set state, start a timer and return. OnTimer
				//- will display the message box to the user.
				//-----
				
				// Stop & Start the timer.
				ItemReplacedHackTimer.Stop();
				ItemReplacedHackTimer.Start();
			}
		}

		// Set the new selection.
		this.SetSelectedItem(pIItem, ItemType, pIParentItem, ParentItemType);

		// Refresh the UI, unless we simply moved items.
		if (bRefreshDetailsView)
		{
			this.UINeedsACLCheck = true;
			this.RefreshSelectedItem();
		}
	}


	//
	// Notify the user that an item has been removed
	//
	function ProjectViewClass_NotifyUserOfItemRemoval()
	{
		ProjectViewGrooveMessageDialogHelper(STR_ITEMDELETED_MESSAGE, STR_ITEMDELETED_TITLE, GrooveMessageBoxIcon_Information);
	}

	function ProjectViewClass_SwitchToViewMode(i_ID, i_bNewTask)
	{
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			// If the data viewer goes into a state where it's displaying a deleted item,
			// then abort the trasaction and return
			if (false == this.pIDataModelDelegate.DoesItemExist(i_ID))
			{
				Transaction.Abort();
				return false;
			}

			// Did the selection change because the current selection was deleted?
			if (false == this.pIDataModelDelegate.DoesItemExist(this.DetailsView.GetID()))
			{
				// Yes it did. Do nothing now, we'll give the user some options
				// when they go to save.
				Transaction.Abort();
				return false;
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();

			// It is not safe to display a modal box here since we may be called
			// in response to an async engine event.
			GrooveDebugFunctions.DisplayAssert(0, "Error handling selection change while editing");
			return false;
		}

		// Otherwise, the selection changed due to a user guesture
		// so we want to give them the option to save
		if (this.DetailsView.HasChanged())
		{
			// Set the focus back on the currently seleted item.
			this.DataListDisplay.SetFocusRow(this.DetailsView.GetID());

			// xxxBBLATER - DataList should provide causality to WHY a change
			// is occuring.  When it's in response to a user guesture, prompt them
			// to save their changes.  When it's in response to rollback or a remove
			// do nothing
			if (true == i_bNewTask)
			{
				var Response = this.PromptUserToSaveChanges();
				if (GrooveMessageBoxResultCode_Yes == Response)
				{
					if (false == this.OnSave())
						return false;
				}
				else  if(GrooveMessageBoxResultCode_No == Response)
				{
					this.Attachments.Abort();
				}
				else if(GrooveMessageBoxResultCode_Cancel == Response)
				{
					return false;
				}
			}
			else return false;
		}

		// Restore the list view
		this.ShowDataListView(true);
		return true;
	}

	//
	// Respond to a selection change in the data list control
	//
	function ProjectViewClass_OnFocusRowChanged()
	{
		// Get ID of focus row.
		var ID = this.DataListDisplay.FocusRow;

		// Prompt the user to save changes before exiting edit mode
		// and switch to view mode.
		if(State_EditMode == this.CurrentMode)
		{
			// If we're displaying the modal new-task dialog, do nothing
			// (the list selection is changing because another endpoint deleted or added a task)
			if (true == this.DetailsView.IsNewItem())
			{
				return;
			}

			// If we're already editing the item, do nothing
			if (ID == this.DetailsView.GetID())
			{
				return;
			}

			if (!this.SwitchToViewMode(ID))
				return;
		}

		var Item = null;
		var ItemType = GrooveProjectTrackingItemType_Invalid;
		var ParentItem = null;
		var ParentItemType = GrooveProjectTrackingItemType_Invalid;

		// Not more items in the view and focus is lost.
		if (-1 == ID)
		{
			// Clear the details view.
			this.DetailsView.ClearDetails();
			return;
		}

		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if(this.pIDataModelDelegate.DoesItemExist(ID))
			{
				ItemType = this.pIDataModelDelegate.GetItemType(ID);
				Item = this.GetItem(ID, ItemType);

				if (ID != this.ProjectID)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(Item.ParentID);
					ParentItem = this.GetItem(Item.ParentID, ParentItemType);
				}
				Transaction.Commit();
			}
			else
			{
				Transaction.Abort();
				return;
			}
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_CHANGESELECTION);
			return;
		}

		// Update the selected item
		this.SetSelectedItem(Item, ItemType, ParentItem, ParentItemType);
		this.RefreshSelectedItem();
	}

	//
	// Respond to a selection change in the data list control
	//
	function ProjectViewClass_OnSelectionChanged()
	{
		var SelectedCount = this.DataListDisplay.SelectedRowCount;

		// Clear ACL cache, when multiple items are selected to allow all activity.
		if (SelectedCount > 1)
			this.InitACLCache(true);
		else if (SelectedCount == 1)
			this.UINeedsACLCheck = true;
	}

	//
	// Respond to double click in the data list control
	// 
	function ProjectViewClass_OnListViewDoubleClick(i_RecordID)
	{
		// xxx BBLATER - If in edit mode and item has changed, keep the current selection
		// See ProjectViewClass_OnFocusRowChanged() -> why we don't prompt to save there.
		// We now use data list, does this still apply?
		if(State_EditMode == this.CurrentMode &&
		   this.DetailsView.HasChanged())
		{
			this.DataListDisplay.SetFocusRow(this.DetailsView.GetID());
			return;
		}

		var	ItemType = GrooveProjectTrackingItemType_Invalid;
		var	Item = null;
		var ParentItemType = GrooveProjectTrackingItemType_Invalid;
		var ParentItem = null;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if(this.pIDataModelDelegate.DoesItemExist(i_RecordID))
			{
				// Check Edit permission
				if (false == this.pIDataModelDelegate.CanReplaceItem(i_RecordID))
				{
					// Abort transaction.
					Transaction.Abort();

					// Display user message and return.
					MHF_MessageBox(STR_NOEDITPERMISSION_MESSAGE, STR_EDIT_TITLE,
								   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
					return;
				}

				ItemType = this.pIDataModelDelegate.GetItemType(i_RecordID);
				Item = this.GetItem(i_RecordID, ItemType);

				if(ItemType != GrooveProjectTrackingItemType_Project)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(Item.ParentID);
					ParentItem = this.GetItem(Item.ParentID, ParentItemType);
				}

				Transaction.Commit();
			}
			else
			{
				// The open item has changed out from under us, inform the user.
				Transaction.Abort();
				
				this.NotifyUserOfItemRemoval();
				return;
			}
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_EDIT);
			return;
		}

		// Set the item as selected and enter edit mode
		this.SetSelectedItem(Item, ItemType, ParentItem, ParentItemType);
		this.RefreshSelectedItem();
		this.OnEdit();

		// Hide the list view
		this.ShowDataListView(false);
	}

	function ProjectViewClass_ShowDataListView(i_bShow)
	{
		var SplitterLayoutSizeObj = GrooveScriptFunctions.CreateNewObject("Groove.SplitterLayoutControlInfo");
		var SplitterLayoutCellObj = SplitterLayoutSizeObj.Cell();
		SplitterLayoutCellObj.SetCell(GrooveSplitterCellValue_Pane1);

		if (undefined == i_bShow || false == i_bShow)
		{
			if (undefined == this.CurrentSplitterSize)
			{
				// Rememeber current splitter size.
				var pCellInfo = this.HorizontalSplitter.OpenControlInfo("DataViewContainer");
				this.CurrentSplitterSize = pCellInfo.Size.CurrentHeightInPixels;
			}

			// Set size to 0 to hide list view.
			SplitterLayoutSizeObj.SetSize(0, GrooveLayoutSizeType_Pixels);
		}
		else
		{
			// Switch back to view-only mode
			this.EnterViewMode();

			// Restore size to original
			if (undefined != this.CurrentSplitterSize)
			{
				SplitterLayoutSizeObj.SetSize(this.CurrentSplitterSize, GrooveLayoutSizeType_Pixels);
			}
		}

		this.HorizontalSplitter.AdjustCellLayout(SplitterLayoutCellObj, SplitterLayoutSizeObj);
	}


	function ProjectViewClass_OnSplitterDragEnd(i_Pane1SizeValue,
											    i_Pane1LayoutSizeType,
											    i_Pane2SizeValue,
											    i_Pane2LayoutSizeType)
	{
		// Remember the current height of list view
		this.CurrentSplitterSize = i_Pane1SizeValue;
	}

	//
	// Edit the selected item
	// 
	function ProjectViewClass_OnEdit()
	{
		GrooveDebugFunctions.DisplayAssert(null != this.SelectedItem, "Missing Task");

		var CanEditScheduleInfo = false;
		var ProjectStartTime = -1;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if(this.pIDataModelDelegate.DoesItemExist(this.SelectedItem.ID))
			{
				// Check Edit permission
				if (false == this.pIDataModelDelegate.CanReplaceItem(this.SelectedItem.ID))
				{
					// Abort transaction.
					Transaction.Abort();

					// Display user message and return.
					MHF_MessageBox(STR_NOEDITPERMISSION_MESSAGE, STR_EDIT_TITLE,
								   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
					return;
				}

				// Check permission to edit schedule info.
				CanEditScheduleInfo = this.pIDataModelDelegate.CanReplaceItemScheduleInfo(this.SelectedItem.ID);

				// Get the project start date.
				ProjectStartTime = this.pIDataModelDelegate.GetProject().ScheduledStart;

				// Mark item as read.
				if (false == this.SelectedItem.IsRead)
				{
					this.pIDataModelDelegate.MarkRead(this.SelectedItem.ID, true);
				}

				Transaction.Commit();
			}
			else
			{
				Transaction.Abort();

				// The item has changed out from under us, inform the user.
				this.NotifyUserOfItemRemoval();
				return;
			}
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_EDIT);
			return;
		}

		// Update UI
		if (GrooveProjectTrackingItemType_Task == this.SelectedItemType)
		{
			this.EnterEditMode();
			this.DetailsView.EditTask(this.SelectedItem, CanEditScheduleInfo, ProjectStartTime);
		}
		else if (GrooveProjectTrackingItemType_Project == this.SelectedItemType)
		{
			this.EnterEditMode();
			this.DetailsView.EditProject(this.SelectedItem);
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Invalid type");
		}
	}

	//
	// Save the item being edited
	//
	function ProjectViewClass_OnSave()
	{
		GrooveDebugFunctions.DisplayAssert(State_EditMode == this.CurrentMode, "Invalid state");

		if(this.DetailsView.IsNewItem())
		{
			var ScheduledFinish = this.DetailsView.GetScheduledFinish();
			var ScheduledStart = this.DetailsView.GetScheduledStart();
			var Duration = this.DetailsView.GetScheduledDuration();
			if (-1 != this.SaveNewTask
						(this.DetailsView.GetParentID(),
						 this.DetailsView.GetPreviousSiblingID(),
						 this.DetailsView.GetName(),
						 this.DetailsView.GetAssignedToContactURL(),
						 this.DetailsView.GetStatus(),
						 this.DetailsView.GetPriority(),
						 this.DetailsView.GetConstrainStartFlag(),
						 ScheduledStart, ScheduledStart, Duration, ScheduledFinish,
						 MHF_GetDisplayFinishDateMS(Duration, ScheduledFinish),
						 this.DetailsView.GetActualStart(),
						 this.DetailsView.GetActualFinish(),
						 this.DetailsView.GetIsPrivate(),
						 this.DetailsView.GetDescription(),
						 this.DetailsView.GetNewPredecessorsArray()))
			{
				return true;
			}
		}
		else
		{
			return this.SaveExisting();
		}

		return false;
	}

	function ProjectViewClass_RefreshAttachmentsMenu(i_ProjectID, i_UICommandContainer, i_Button, i_bMode)
	{
		// Has to be a write transaction, because we may add an attachment.
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		var AttachmentCount = 0;
		try
		{
			var ProjRecord = null;
			if (null != i_ProjectID && RecordSetEngine.HasRecord(i_ProjectID))
			{
				// Get the record.
				ProjRecord = RecordSetEngine.OpenRecord(i_ProjectID);
			}
			
			// Refresh our attachement button's attachments.  
			this.Attachments.menuButton	= i_Button;
			this.Attachments.pIUICommandContainer = i_UICommandContainer;
			AttachmentCount = this.Attachments.RefreshButton(ProjRecord, i_bMode);

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(false, "Error caught in ProjectViewClass_RefreshAttachmentsMenu: " + e.description);
		}

		return AttachmentCount;
	}

	function ProjectViewClass_ProcessAttachmentsMenuCommand(i_pICommand, i_ProjectID)
	{
		var bAttachmentsChanged = false;
		try
		{
			// Has to be a write transaction, because we may add an attachment.
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(false);

			// Get item from collection.
			var pProjItem = (null != i_ProjectID) ? RecordSetEngine.OpenRecord(i_ProjectID) : null;

			// Process menu commands.
			var Account = OpenAccountFromPropertyList(PropertyList);
			bAttachmentsChanged = this.Attachments.ProcessMenuCommand
											(i_pICommand, pProjItem, this.DefaultAttachmentsPath, Account);

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(false, "Error caught in ProjectViewClass_ProcessAttachmentsMenuCommand: " + e.description);
		}

		return bAttachmentsChanged;
	}

	function ProjectViewClass_MarkCurrentComplete()
	{
		// This may take a while
		MHF_ShowWaitCursor(true);

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta();
		try
		{
			var SelectedIDEnum = this.DataListDisplay.CreateSelectedRowEnum(GrooveDataListSelectionFlags_Ordered);
			while(SelectedIDEnum.HasMore())
			{
				var ID = SelectedIDEnum.OpenNext();
				if(this.pIDataModelDelegate.DoesItemExist(ID))
				{
					// Get selected item object.
					var ItemType = this.pIDataModelDelegate.GetItemType(ID);
					var Item = this.GetItem(ID, ItemType);

					// Check permission.
					if (false == this.CanEdit || false == this.pIDataModelDelegate.CanReplaceItem(ID))
					{
						pIDelta.Abort();
						MHF_ShowWaitCursor(false);

						// Display user message and return.
						var strMessage = String(STR_NOMARKCOMPLETEPERMISSION_MESSAGE);
						strMessage = strMessage.replace(/%taskname/i, Item.Name);

						MHF_MessageBox(strMessage, STR_MARKCOMPLETE_TITLE,
									   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
						return;
					}

					var CurrentDate = new Date();

					// If the current item is already marked as complete, do nothing
					if(GrooveProjectToolsetStatusType_Complete == Item.Status)
					{
						continue;
					}

					// If the task hasn't been started yet, mark today as the actual start date
					if(GrooveProjectToolsetStatusType_NotStarted == Item.Status)
					{
						Item.ActualStart = StartOfDay(CurrentDate.valueOf());
					}

					// If the task hasn't been started yet or was in progress, mark today
					// as the actual finish date
					if(GrooveProjectToolsetStatusType_NotStarted == Item.Status ||
					   GrooveProjectToolsetStatusType_InProgress == Item.Status)
					{
						Item.ActualFinish = StartOfDay(CurrentDate.valueOf());
					}

					Item.Status = GrooveProjectToolsetStatusType_Complete;
					this.ReplaceExistingItem(Item, ItemType, new Array(), new Array());
				}
			}
			pIDelta.Commit();

			MHF_ShowWaitCursor(false);
		}
		catch(e)
		{
			pIDelta.Abort();
			MHF_ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKCOMPLETE);
		}
	}

	function ProjectViewClass_SaveExisting()
	{
		GrooveDebugFunctions.DisplayAssert(State_EditMode == this.CurrentMode, "Invalid state");

		// Tell details view to save its contents, it may fail if the parent
		// has been deleted while the user was editing
		if(false == this.DetailsView.ValidateInput())
		{
			return false;
		}

		// This may take a while
		MHF_ShowWaitCursor(true);

		var ItemDeleted = false;
		var ParentDeleted = false;

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta();  // Should not undo/redo saves
		try
		{
			if(GrooveProjectTrackingItemType_Project != this.DetailsView.GetItemType())
			{
				// If the item or it's parent has been deleted, notify the user
				if(false == this.pIDataModelDelegate.DoesItemExist(this.SelectedItem.ParentID))
				{
					ParentDeleted = true;
				}
			}

			// Check if item has been deleted
			var CurrentItem = this.DetailsView.GetItem();
			if(false == this.pIDataModelDelegate.DoesItemExist(CurrentItem.ID))
			{
				ItemDeleted = true;
			}
			
			// Check if user can edit the item.
			if (this.CanEdit)
			{
				this.CanEdit = this.pIDataModelDelegate.CanReplaceItem(CurrentItem.ID);
			}

			if(false == this.CanEdit || true == ParentDeleted || true == ItemDeleted)
			{
				pIDelta.Abort();
			}
			else  // All systems go -- replace the existing record
			{
				// The parent may have changed due to a promote or demote.
				// When doing a replace we must use the correct parent for the task
				// or RSE will throw. "this.SelectedItem.ParentID" should always
				// have the correct parent.
				if (CurrentItem.ParentID)
					CurrentItem.ParentID = this.SelectedItem.ParentID;

				// Get predecessors list
				var arrNewPredecessor = this.DetailsView.GetNewPredecessorsArray();
				var arrRemovePredecessor = this.DetailsView.GetRemovePredecessorsArray();

				// Update task
				this.ReplaceExistingItem(CurrentItem,
										 this.DetailsView.GetItemType(),
										 arrNewPredecessor, arrRemovePredecessor);

				// Save any new attachments
				this.Attachments.Commit(RecordSetEngine.OpenRecord(CurrentItem.ID));

				// Update the currently selected item.
				// Need this to refresh predecessor count correctly.
				// Item used in RefreshSelectedItem() is now stale.
				if (0 < arrNewPredecessor.length ||
					0 < arrRemovePredecessor.length)
				{
					this.SelectedItem = this.GetItemFromID(CurrentItem.ID);
				}
					
				pIDelta.Commit();
			}
		}
		catch(e)
		{
			this.Attachments.Abort();
			pIDelta.Abort();

			ItemDeleted = false;
			if (-2147024891 == e.number)
			{
				// User does not have permission
				this.CanEdit = false;
			}
			else PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_REPLACING);
		}

		// Done
		MHF_ShowWaitCursor(false);

		// If the user cannot edit item, give a notice
		if(false == this.CanEdit)
		{
			// User does not have permissions
			MHF_MessageBox(STR_NOPERMISSION_MESSAGE, STR_SAVETASK_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
		}

		// If the item was deleted while it was being edited, give the user some options
		else if(true == ItemDeleted || true == ParentDeleted)
		{
			var Response = this.PromptUserToSaveDeletedAsNew();
			if(GrooveMessageBoxResultCode_Yes == Response)
			{
				// If the parent was deleted, save the item as the first child of the project item.
				// If the parent was not deleted, save the item as the first child of the parent.
				var ParentID = this.DetailsView.GetParentID();
				if(true == ParentDeleted)
				{
					ParentID = this.ProjectID;
				}

				var ScheduledFinish = this.DetailsView.GetScheduledFinish();
				this.SaveNewTask(ParentID,
								 0, /* first child */
								 this.DetailsView.GetName(),
								 this.DetailsView.GetAssignedToContactURL(),
								 this.DetailsView.GetStatus(),
								 this.DetailsView.GetPriority(),
								 this.DetailsView.GetUserStartConstraint(),
								 this.DetailsView.GetConstrainStartFlag(),
								 this.DetailsView.GetScheduledStart(),
								 this.DetailsView.GetScheduledDuration(),
								 ScheduledFinish,
								 ScheduledFinish,	// Display Date
								 this.DetailsView.GetActualStart(),
								 this.DetailsView.GetActualFinish(),
								 this.DetailsView.GetIsPrivate(),
								 this.DetailsView.GetDescription(),
								 this.DetailsView.GetNewPredecessorsArray());
			}
			else if (GrooveMessageBoxResultCode_Cancel == Response)
			{
				return false; // stay in edit mode
			}

			// Keep going -- lose changes
			else if (GrooveMessageBoxResultCode_No == Response)
			{
				this.Attachments.Abort();

				// Get the current selection
				var SelectedID = this.DataListDisplay.FocusRow;

				// Set new selection if the selected item is gone.
				if(SelectedID != this.DetailsView.GetID())
				{
					var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
					var Transaction = Telespace.OpenTransaction(false);

					var pItem = null;
					var pParent = null;
					var SelectedItemType = GrooveProjectTrackingItemType_Invalid;
					var ParentItemType = GrooveProjectTrackingItemType_Invalid;
					try
					{
						// If the selected item exists, set selected item object
						if(this.pIDataModelDelegate.DoesItemExist(SelectedID))
						{
							// Get selected item type and object
							SelectedItemType = this.pIDataModelDelegate.GetItemType(SelectedID);
							pItem = this.GetItem(SelectedID, SelectedItemType);

							if (GrooveProjectTrackingItemType_Project == SelectedItemType)
							{
								// Set the selection to project
								SelectedItemType = GrooveProjectTrackingItemType_Project;
								ParentItemType = GrooveProjectTrackingItemType_Invalid;
								pItem = this.pIDataModelDelegate.GetProject();
							}
							else
							{
								// Get selected item's parent type and object
								ParentItemType =  this.pIDataModelDelegate.GetItemType(pItem.ParentID);
								pParent = this.GetItem(pItem.ParentID, ParentItemType)
							}

							Transaction.Commit();
						}
						else  // point the item to root
						{
							// Set the selection to project
							SelectedItemType = GrooveProjectTrackingItemType_Project;
							ParentItemType = GrooveProjectTrackingItemType_Invalid;
							pItem = this.pIDataModelDelegate.GetProject();
							Transaction.Abort();
						}
					}
					catch (error)
					{
						Transaction.Abort();
						GrooveDebugFunctions.DisplayAssert(0, "Error getting task object.");
					}

					// Set the new selection	
	  				this.SetSelectedItem(pItem, SelectedItemType, pParent, ParentItemType);
				}
			}
		}

		// Restore the list view
		this.ShowDataListView(true);

		// Mark the ACL cache for refresh
		this.UINeedsACLCheck = true;

		// Update the details view with the new info
		this.RefreshSelectedItem();
		return true;
	}


	//
	// Close editing of selected item.
	// 
	function ProjectViewClass_OnClose()
	{
		// If data changed prompt the user to save.
		if (this.DetailsView.HasChanged())
		{
			var Response = this.PromptUserToSaveChanges();
			if (GrooveMessageBoxResultCode_Yes == Response)
			{
				if (false == this.OnSave())
					return;
			}
			else if (GrooveMessageBoxResultCode_No == Response)
			{
				this.Attachments.Abort();
			}
			else if (GrooveMessageBoxResultCode_Cancel == Response)
			{
				return;
			}
		}

		// Clear the unread flag for the item
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if (this.pIDataModelDelegate.DoesItemExist(this.SelectedItem.ID))
			{
				if (false == this.SelectedItem.IsRead)
				{
					this.pIDataModelDelegate.MarkRead(this.SelectedItem.ID, true);
				}
			}
			else
			{
				// Set new current selection
				var ID = this.DataListDisplay.FocusRow;
				var ParentItemType = GrooveProjectTrackingItemType_Invalid;
				var pIParentItem = null;
				var ItemType = this.pIDataModelDelegate.GetItemType(ID);
				var pIItem = this.GetItem(ID, ItemType);
				if(ItemType != GrooveProjectTrackingItemType_Project)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(pIItem.ParentID);
					pIParentItem = this.GetItem(pIItem.ParentID, ParentItemType);
				}
				this.SetSelectedItem(pIItem, ItemType, pIParentItem, ParentItemType);
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKINGREAD);
		}

		// Refresh selected item
		this.RefreshSelectedItem();

		// Restore the list view
		this.ShowDataListView(true);
	}

	
	function ProjectViewClass_ShowConfigDialog()
	{
		var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = ParentWindow;
		WindowProperties.Resizable = false;
		WindowProperties.CaptionVisible = true;
		WindowProperties.InitialHeight = 520;
		WindowProperties.InitialWidth = 620;
		WindowProperties.CloseButton = false;
		WindowProperties.Caption = CONFIGURE_PROJECT_DIALOG_TITLE;
		WindowProperties.HelpButton = false;

		var ConfigHost = ProjectWizardSubForm.OpenDelegateComponent();
		var ConfigCode = ConfigHost.GetScriptDispatch();

		// Set DMD
		ConfigCode.SetProjectDataModelDelegate(this.pIDataModelDelegate);

		// Setting contact list and project requires Tx
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);

		try
		{
			// Project
			ConfigCode.SetProject(this.pIDataModelDelegate.GetProject());

			// Contact list
			var ContactCache = PPH_GetContactNameURLMap(this.pIContactProvider);
			ConfigCode.SetContactList(ContactCache);
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_CONFIGURING);
			return;
		}
			
		var Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, ProjectWizardSubForm);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore |
									  GrooveWindowMenuCommand_Size |
									  GrooveWindowMenuCommand_Minimize |
									  GrooveWindowMenuCommand_Maximize |
									  GrooveWindowMenuCommand_Close,
									  false);


		if(GrooveDialogBoxResultCode_OK == Window.DoModal())
		{
			// If data model has changed, we just stomp it
			var DynamicsMgr = this.DynamicsManager;
			var pIDelta = DynamicsMgr.CreateDelta(); // Do not undo/redo
			try
			{
				this.pIDataModelDelegate.ReplaceProject(ConfigCode.GetProject(), this.GetProgressInterface());
				pIDelta.Commit();
			}
			catch(e)
			{
				pIDelta.Abort();
				PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_REPLACING);
			}
		}
	}

	function ProjectViewClass_OnPersonsAdded(i_PersonContactURLEnum)
	{
		UpdateParticipantsInICommandContainer(g_ParticipantsFilterUICommand, this.pIContactProvider);
		UpdateParticipantsInICommandContainer(g_ParticipantsFilterMenuUICommand, this.pIContactProvider);
	}

	function ProjectViewClass_OnPersonsRemoved(i_PersonContactURLEnum)
	{
		// If viewing, refresh current item if necessessary
		if(State_ViewMode == this.CurrentMode)
		{
			this.RefreshSelectedItem();
		}

		UpdateParticipantsInICommandContainer(g_ParticipantsFilterUICommand, this.pIContactProvider);
		UpdateParticipantsInICommandContainer(g_ParticipantsFilterMenuUICommand, this.pIContactProvider)
	}

	function ProjectViewClass_OnPersonsChanged(i_PersonContactURLEnum)
	{
		// If viewing, refresh current item if necessessary
		if(State_ViewMode == this.CurrentMode)
		{
			this.RefreshSelectedItem();
		}

		UpdateParticipantsInICommandContainer(g_ParticipantsFilterUICommand, this.pIContactProvider);
		UpdateParticipantsInICommandContainer(g_ParticipantsFilterMenuUICommand, this.pIContactProvider);
	}

	//
	// Display Reporting Window for printing
	//
	function ProjectViewClass_OnViewReport()
	{
		//-----
		//- "Report View" feature works with IE versions 5.01 or higher.
		//- The first instance of IE 5.01 has version 5.00.2919.????
		//- Problem is with a version MS XMLParser that is installed with
		//- earlier versions of IE.  We need XML Parser 2.5a or higher.
		//- Check for version of IE and prompt to upgrade IE if lower version found.
		//-----
		var objVer = GetMSIEVersion();
		if (objVer == null || objVer.MajorVersion < 5 ||
			(objVer.MajorVersion == 5 && objVer.MinorVersion == 0 && objVer.BuildVersion < 2919))
		{
			MHF_MessageBox(STR_UPGRADE_IE_MESSAGE, STR_UPGRADE_IE_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return null;
		}

		var pForm = PropertyList.OpenProperty(PROPERTY_FORM);
		var pComponentContainer = pForm.ComponentContainer;
		var WindowsManager = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");

		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		var ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = ParentWindow;
		WindowProperties.Resizable = true;
		WindowProperties.CaptionVisible = true;
		WindowProperties.Caption = "Project Report";
		WindowProperties.Visible = false;
		WindowProperties.InitialWidth = 750;
		WindowProperties.InitialHeight = 550;
		WindowProperties.HelpButton = false;

		var Delegate = PrintDialog.OpenDelegateComponent();
		g_PrintMgr = Delegate.GetScriptDispatch();

		var pStorageURISyntax = GrooveScriptFunctions.CreateNewObject("Groove.StorageURISyntax");
		var PersistRoot = pStorageURISyntax.InstallDataRootPath;
		var Path = PersistRoot + "ToolData\\Groove.net\\GrooveProjectToolset\\ProjectTool\\Project Report Type";
		g_PrintMgr.SetDefaultReportFolder(Path);
		
		// Get the subform and script code
		var Window = WindowsManager.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, PrintDialog);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Maximize |
									  GrooveWindowMenuCommand_Restore |
									  GrooveWindowMenuCommand_Close,
									  true);

		// Create participant array that will get passed to FilterSubForm
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);
		var ParticipantArray = null;
		try
		{
			ParticipantArray = PPH_GetContactNameURLMap(this.pIContactProvider);
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_RETRIEVINGCONTACTS);
			return null;
		}
		
		ParticipantArray.Insert(0, GPT_S_STATUS_ALL, GPT_S_STATUS_ALL);
		ParticipantArray.Insert(1, GPT_S_UNASSIGNED, GPT_S_UNASSIGNED);

		// If you don't want to provide your custom Filter subform, you need
		// to connect to g_PrintMgr's Delegate Component. Use the following code:
		//
		//			ConnectObject(Delegate, "ProjectPrintFilterSubForm_");
		//
		// If you decide to provide your custom subform use the following:

		// Create FilterSubForm, swap layouts, and connect to FilterSubForm
		var FilterSubForm = pComponentContainer.OpenComponentByName("ProjectFilterSubForm");
		g_PrintMgr.SetFilterLayout(FilterSubForm);
		var FilterSubFormDelegate = FilterSubForm.OpenDelegateComponent();
		var FilterSubFormCode = FilterSubFormDelegate.GetScriptDispatch();

		// Fill out combo boxes
		FilterSubFormCode.FillContactsCB(ParticipantArray);

		var CurrentName;
		if(g_ParticipantsFilterUICommand.UICommand.Label.indexOf(VIEW_PARTICIPANTS_DROPDOWN_LABEL) != -1)
			CurrentName = RightBack(g_ParticipantsFilterUICommand.UICommand.Label, VIEW_PARTICIPANTS_DROPDOWN_LABEL);
		else
			CurrentName = g_ParticipantsFilterUICommand.UICommand.Label;
		FilterSubFormCode.SetParticipantComboboxCurrentSelection(CurrentName);

		// Get Status enum and populate combobox
		FilterSubFormCode.PopulateStatusCombobox(MHF_GetStatusArray(true));
		FilterSubFormCode.SetStatusComboboxCurrentSelection(g_UIProjectStatusCC.UICommand.UserData);
		
		// Connect to the SubForm		
		ConnectObject(FilterSubFormDelegate, "ProjectPrintFilterSubForm_");

		// Show print window
		Window.DoModal();

		g_PrintMgr = null;
		DisconnectObject(FilterSubFormDelegate);
		CloseWindow(Window);
	}

	//
	// Generate the report
	//
	function ProjectViewClass_GenerateReport(i_pRootElem, i_ParticipantURL, i_Status)
	{
		var pCollection = null;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);

		try
		{
			// This may take a long time.
			MHF_ShowWaitCursor(true);

			// Get filtered collection.
			pCollection = this.pIDataModelDelegate.GetCollectionOfItemIDsForParticipantAndStatus
													((GPT_S_UNASSIGNED == i_ParticipantURL || null == i_ParticipantURL) ? "" : i_ParticipantURL,
													 MHF_GetStatusFilterEnumFromString(i_Status));

			if(!pCollection.CollectionConfigure.HasView("ReportView"))
			{
				pCollection.CollectionConfigure.AddView("ReportView");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Name", "Name", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "AssignedToContactURL", "AssignedToContactURL", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "TeamLeaderContactURL", "ProjectLeaderContactURL", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledStart", "ScheduledStart", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledDuration", "ScheduledDuration", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "ScheduledFinish", "ScheduledFinish", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Status", "Status", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Priority", "Priority", GrooveSortDataType_LONG, "MultiValueOnlyFirst", "/");
				pCollection.CollectionConfigure.AddColumn("ReportView", "Description", "Description", GrooveSortDataType_String, "MultiValueOnlyFirst", "/");
			}

			g_InsertedItemIDsMap = new CommonMap();

			pCollection.CollectionConfigure.UseView("ReportView");
			pCollection.MoveCursorToRecord(this.ProjectID);

			var pProjItem = pCollection.OpenRecord(this.ProjectID);
			if (pProjItem)
			{
				this.AddItemsToXMLFromCollection(this.AddSingleItemToXMLDoc(i_pRootElem, pProjItem),
												 pCollection, i_ParticipantURL, i_Status);
			}
			else
			{
				this.AddItemsToXMLFromCollection(i_pRootElem, pCollection, i_ParticipantURL, i_Status);
			}

			Transaction.Commit();
			MHF_ShowWaitCursor(true);
		}
		catch(e)
		{
			Transaction.Abort();
			MHF_ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_GENERATINGREPORT);
		}

		// Go back and use the main view.
		if(pCollection.CollectionConfigure.HasView("Main"))
		{
			pCollection.CollectionConfigure.UseView("Main");
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Error in ProjectViewClass_GenerateReport");
		}
	}

	function ProjectViewClass_AddItemsToXMLFromCollection(i_ProjXMLElement, i_pCollection, i_ParticipantURL, i_Status)
	{
		// Loop thru all the children
		if(i_pCollection != null && 0 != i_pCollection.GetRecordCount())
		{
			var pICursor = i_pCollection.GetCursor();

			for(var i = 0; i < i_pCollection.GetRecordCount(); ++i)
			{
				var pICollectionRecord = pICursor.OpenRecord();
				if(pICollectionRecord != null)
				{
					if (GPT_S_STATUS_ALL == i_ParticipantURL && GPT_S_STATUS_ALL == i_Status)
					{
						this.InsertItemWithParents(i_pCollection, i_ProjXMLElement, pICollectionRecord, this.ProjectID, i_ParticipantURL, i_Status);
					}
					else if (this.ProjectID != pICollectionRecord.RecordID)
					{
						this.AddSingleItemToXMLDoc(i_ProjXMLElement, pICollectionRecord);
					}
				}

				// Increment cursor
				pICursor.MoveAdv(GrooveCollectionCursorPosition_Current, GrooveCollectionNavigationOp_NextAny, 1, GrooveCollectionNavigationOption_IncludeCollapsedRows);
			}
		}
	}

	function ProjectViewClass_InsertItemWithParents(i_pCollection, i_pParentXMLElem, i_pItem, i_ProjDetailsID, i_ParticipantURL, i_Status)
	{
		var VerifiedParentElem = g_InsertedItemIDsMap.FindByKey(i_pItem.RecordID);
		if(VerifiedParentElem)
			return VerifiedParentElem;

		var ParentElement = i_pParentXMLElem;
		var ParentID = i_pItem.OpenField("_ParentID");
		if (ParentID != -1)
		{
			if(typeof ParentID != "undefined" && ParentID != i_ProjDetailsID)
			{
				var pItem = i_pCollection.OpenRecord(ParentID);
				if(!pItem)
				{
					GrooveDebugFunctions.DisplayAssert(0, "Error in ProjectViewClass_InsertItemWithParents");
					return null;
				}
				ParentElement = this.InsertItemWithParents(i_pCollection, i_pParentXMLElem, pItem, i_ProjDetailsID, i_ParticipantURL, i_Status);
			}
		}
		var URL;
		i_ParticipantURL == GPT_S_UNASSIGNED ? URL = "" : URL = i_ParticipantURL;

		var RecordURL = null;
		if (i_pItem.HasField("AssignedToContactURL"))
			RecordURL = i_pItem.OpenField("AssignedToContactURL");
		if ((RecordURL == null) || (typeof RecordURL == "undefined"))
			RecordURL = i_pItem.OpenField("TeamLeaderContactURL");

		if(URL == RecordURL || GPT_S_STATUS_ALL == i_ParticipantURL)
		{
			var pElem = null;
			if(GPT_S_STATUS_ALL == i_Status || MHF_GetStatusFilterEnumFromString(i_Status) == i_pItem.OpenField("Status"))
				pElem = this.AddSingleItemToXMLDoc(ParentElement, i_pItem);
			return pElem;
		}
		return ParentElement;
	}

	function ProjectViewClass_AddSingleItemToXMLDoc(i_pParentXMLElem, i_pItem)
	{
		var pElem = i_pParentXMLElem.CreateElement("Task", i_pParentXMLElem);

		var URL = null;
		if (i_pItem.HasField("AssignedToContactURL"))
			URL = i_pItem.OpenField("AssignedToContactURL");
		if ((URL == null) || (typeof URL == "undefined"))
			URL = i_pItem.OpenField("TeamLeaderContactURL");
		
		var ContactDisplayName = PHF_GetPersonNameForDisplay(this.pIContactProvider, URL);

		var Name = i_pItem.OpenField("Name");
		if (this.ProjectID == i_pItem.RecordID)
		{
			Name = Name + " " + GPT_S_PROJECTNAME_TAG;

			// Create a special element for project task id
			var pChildElem = pElem.CreateElement("ProjectTaskId", pElem);
			pChildElem.SetContent(0, this.ProjectID, GrooveContentType_Text);

			// Create a special element for project task owner
			var pChildElem = pElem.CreateElement("ProjectTaskLeader", pElem);
			pChildElem.SetContent(0, ContactDisplayName, GrooveContentType_Text);
		}

		var pChildElem = pElem.CreateElement("TaskName", pElem);
		pChildElem.SetContent(0, Name, GrooveContentType_Text);

		// Is this a summary task?
		var bSummaryTask = this.pIDataModelDelegate.HasChildren(i_pItem.RecordID);

		if (bSummaryTask == false)
		{
			pChildElem = pElem.CreateElement("AssignedTo", pElem);
			pChildElem.SetContent(0, ContactDisplayName, GrooveContentType_Text);
		}

		pChildElem = pElem.CreateElement("StartDate", pElem);
		pChildElem.SetContent(0,
							  FormatDayAndDate(i_pItem.OpenField("ScheduledStart"),
											   GrooveIntlDateFormatStyle_Short),
							  GrooveContentType_Text);

		pChildElem = pElem.CreateElement("FinishDate", pElem);
		var Finish = i_pItem.OpenField("DisplayFinish");
		pChildElem.SetContent(0,
							  FormatDayAndDate(Finish,
											   GrooveIntlDateFormatStyle_Short),
											   GrooveContentType_Text);

		pChildElem = pElem.CreateElement("Status", pElem);
		pChildElem.SetContent(0, MHF_GetStatusFilterStringFromEnum(i_pItem.OpenField("Status")), GrooveContentType_Text);

		var RecordURL = null;
		if (i_pItem.HasField("AssignedToContactURL"))
			RecordURL = i_pItem.OpenField("AssignedToContactURL");
		if ((RecordURL == null) || (typeof RecordURL == "undefined"))
			RecordURL = i_pItem.OpenField("TeamLeaderContactURL");

		var Priority = null;
		if (i_pItem.HasField("Priority"))
			Priority = i_pItem.OpenField("Priority");
		if (((Priority != null) && (typeof Priority != "undefined")) && (bSummaryTask == false))
		{
			pChildElem = pElem.CreateElement("Priority", pElem);
			pChildElem.SetContent(0, MHF_GetPriorityStringFromEnum(Priority), GrooveContentType_Text);
		}

		var DescriptionText = "";
		var DescriptionElement = i_pItem.OpenFieldAsElement("Objective");
		if(DescriptionElement == null)
			DescriptionElement = i_pItem.OpenFieldAsElement("Description");

		if(typeof DescriptionElement != "undefined" && DescriptionElement != null && DescriptionElement.DoesAttributeExist("Text"))
			DescriptionText = DescriptionElement.OpenAttribute("Text");

		pChildElem = pElem.CreateElement("Description", pElem);
		pChildElem.SetContent(0, DescriptionText, GrooveContentType_Text);

		pChildElem = pElem.CreateElement("ID", pElem);
		pChildElem.SetContent(0, i_pItem.RecordID, GrooveContentType_Text);

		pChildElem = pElem.CreateElement("ParentID", pElem);
		pChildElem.SetContent(0, i_pItem.OpenField("_ParentID"), GrooveContentType_Text);

		g_InsertedItemIDsMap.Add(i_pItem.RecordID, pElem);

		return pElem;
	}

	function ProjectPrintFilterSubForm_OnFilter(i_XSLPath, i_Status, i_ParticipantName, i_bGenerateNewXML)
	{
		MHF_ShowWaitCursor(true);
		var XSLFileName = GetXSLFileNameFromPath(i_XSLPath);
		if(typeof XSLFileName != "undefined" && XSLFileName != null && XSLFileName != "")
		{
			var pXMLDoc = null;
			if (i_bGenerateNewXML)
			{
				var pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				pXMLDoc = pSM.CreateTemporaryXMLDocument("ProjectTool");
				var pRootElem = pXMLDoc.OpenRootElement();
				pRootElem.SetName("ProjectToolReport");

				g_CurrentView.GenerateReport(pRootElem, i_ParticipantName, i_Status);
			}

			g_PrintMgr.SetXMLDocument(pXMLDoc, i_XSLPath, XSLFileName);
		}
		MHF_ShowWaitCursor(false);
	}

	function GetXSLFileNameFromPath(i_XSLPath)
	{
		var Style = RightBack(i_XSLPath, "\\");
		var Type = LeftBack(i_XSLPath, "\\");
		Type = RightBack(Type, "\\");
		var XSLFileName = g_StylesMap.FindByKey(Type + Style);
		var FSS = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");
		if(XSLFileName == "" || XSLFileName == null)
		{
			if(FSS.DoesFileExist(i_XSLPath + "\\" + Style + ".xsl"))
				XSLFileName = Style + ".xsl";
			else
				if(FSS.DoesFileExist(i_XSLPath + "\\" + "Default.xsl"))
					XSLFileName = "Default.xsl";
		}
		return XSLFileName;
	}

	//**** End of Reporting ****

	function ProjectViewClass_GetItemFromID(i_ID)
	{
		var Type = this.pIDataModelDelegate.GetItemType(i_ID);
		if (GrooveProjectTrackingItemType_Task == Type)
		{
			return this.pIDataModelDelegate.GetTask(i_ID);
		}
		else if (GrooveProjectTrackingItemType_Project == Type)
		{
			return this.pIDataModelDelegate.GetProject();
		}
		return null;
	}

	function ProjectViewClass_OnSaveTemplate()
	{
		// set default filename
		var SaveTemplateHost = SaveTemplateSubForm.OpenDelegateComponent();
		var SaveTemplateCode = SaveTemplateHost.GetScriptDispatch();
		var pIFileServices = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

		// look for last directory
		var ToolName = PropertyList.OpenProperty(PROPERTY_TOOL_DISPLAY_NAME);
		var pITelespaceElmnt = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var SpaceName = pITelespaceElmnt.DisplayName;
		var SuggestedFileName;

		if (PropertyList.PropertyExists(ToolName + "LastDirectory"))
		{
			SuggestedFileName = PropertyList.OpenProperty(ToolName +"LastDirectory") + "\\";
		}
		else
		{
			SuggestedFileName = pIFileServices.OpenPersonalFilesFolderPath() + "\\";
		}

		// strip out any invliad filename characters
		SuggestedFileName += pIFileServices.GenerateValidFilename(SpaceName);
		SuggestedFileName += ".grv";


		// pre-fill dialog
		SaveTemplateCode.PutFileName(SuggestedFileName);

		// prompt user
		var pIWindow = MHF_CreateDialogBox(SaveTemplateSubForm, STR_SAVETEMPLATE_TITLE, 500,350, false);
		if(GrooveDialogBoxResultCode_OK != pIWindow.DoModal())
		{
			pIWindow.Destroy();
			return;
		}

		// verify there's work to do
		if(false == (SaveTemplateCode.GetSaveProjectName() || SaveTemplateCode.GetSaveObjectiveName() ||
					 SaveTemplateCode.GetSaveCalcMode() || SaveTemplateCode.GetSaveMembers() ||
					 SaveTemplateCode.GetSaveTasks()))
		{
			GrooveDebugFunctions.DisplayAssert(0, "No work to do");
			return;
		}

		var OutputFileName = SaveTemplateCode.GetFileName();

		// verify extension
		if (OutputFileName.lastIndexOf(".grv") == -1) 
		{
			OutputFileName = OutputFileName + ".grv";
		}

		// remember selected directory
		var strPath = LeftBack(OutputFileName, "\\");
		PropertyList.SetProperty(ToolName + "LastDirectory", strPath, GroovePropertyFlag_Private);


		// serialize project info?
		// always include predecessor information when saving as a template
		// always include project start so user can shift the project correctly
		var SerializeFlags = GrooveProjectTrackingSerializeFlags_Predecessors | 
							 GrooveProjectTrackingSerializeFlags_ProjectStart;

		if(true == SaveTemplateCode.GetSaveProjectName())
		{
			SerializeFlags |= GrooveProjectTrackingSerializeFlags_ProjectName;
		}

		if(true == SaveTemplateCode.GetSaveObjectiveName())
		{
			SerializeFlags |= GrooveProjectTrackingSerializeFlags_ProjectObjective;
		}

		// Serialize -- this may take a while
		MHF_ShowWaitCursor(true);

	
		// requires WRITE transaction
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		
		try
		{
			var Time = new Date;
			var NSP = "urn:groove.net:";

			// Make sure we can open the output file
			var pIByteStream = CreateByteOutputStreamFromFile(OutputFileName);

			// Build the injectable fragment
			var pIInjectorWrapperElmnt = CreateNewElement(NSP + "InjectorWrapper");
			pIInjectorWrapperElmnt.SetAttribute("AccountGUID", "grooveIdentity:///DefaultIdentity");
			pIInjectorWrapperElmnt.SetAttribute("MessageID", "GPTSeededSpace");
			pIInjectorWrapperElmnt.SetAttribute("ResourceURL", "grooveIdentityMessage:///ToolMessage;Version=4,0,0,0");
			pIInjectorWrapperElmnt.SetAttribute("LocalDeviceURLs", "Injector");

			var pIIdentityMsgHeaderElmnt = pIInjectorWrapperElmnt.CreateElement(NSP + "IdentityMessageHeader", pIInjectorWrapperElmnt);
			var pIMsgHeaderElmnt = pIIdentityMsgHeaderElmnt.CreateElement(NSP + "MessageHeader", pIIdentityMsgHeaderElmnt);
			pIMsgHeaderElmnt.SetAttribute("MessageType", "ToolMessage");
			pIMsgHeaderElmnt.SetAttribute("MessageID", "GPTSeededSpace");
			pIMsgHeaderElmnt.SetAttribute("Version", "1,1,0,0");
			pIMsgHeaderElmnt.SetAttribute("CreationTime", Time.valueOf());

			var pISenderContactElmnt = pIMsgHeaderElmnt.CreateElement(NSP + "SenderContact", pIMsgHeaderElmnt);
			var pIRecipientContactElmnt = pIMsgHeaderElmnt.CreateElement(NSP + "RecipientContact", pIMsgHeaderElmnt);

			var pIMessageBodyElmnt = pIIdentityMsgHeaderElmnt.CreateElement(NSP + "MessageBody", pIIdentityMsgHeaderElmnt);
			pIMessageBodyElmnt.SetAttribute("BodyName", "MessageBody");

			var pIToolMessageElmnt = pIMessageBodyElmnt.CreateElement(NSP + "ToolMessage", pIMessageBodyElmnt);
			var pIToolMessageHeaderElmnt = pIToolMessageElmnt.CreateElement(NSP + "ToolMessageHeader", pIToolMessageElmnt);
			pIToolMessageHeaderElmnt.SetAttribute("ToolURL", "grooveAccountTool:;CategoryName=grooveToolCategory://Account/TelespaceProvider,ComponentName=Injector");

			var pIToolMessageBodyElmnt = pIToolMessageElmnt.CreateElement(NSP + "ToolMessageBody", pIToolMessageElmnt);
			var pITelespaceElmnt = pIToolMessageBodyElmnt.CreateElement(NSP + "Telespace", pIToolMessageBodyElmnt);
			pITelespaceElmnt.SetAttribute("DisplayName", PropertyList.OpenProperty(PROPERTY_TELESPACE).DisplayName);
			pITelespaceElmnt.SetAttribute("Visible", "1");
			pITelespaceElmnt.SetAttribute("DeleteOnRelease", "0");
			pITelespaceElmnt.SetAttribute("Description", PropertyList.OpenProperty(PROPERTY_TELESPACE).Description);

			var pIToolsElmnt = pITelespaceElmnt.CreateElement(NSP + "Tools", pITelespaceElmnt);
			var pIToolSetTemplateElmnt = pIToolsElmnt.CreateElement(NSP + "ToolSetTemplate", pIToolsElmnt);

			// Prepare for project tool serialization
			// build a list of IDs for all items in the project
			var pIProject = this.pIDataModelDelegate.GetProject();

			// Build a list containing all top-level items
			var pIRecordIDEnum = pIRecordIDEnum = this.pIDataModelDelegate.GetChildIDEnum(pIProject.ID, 1 /* one level only */);

			// Serialize the template for each tool in the space
			var pIToolContainer = PropertyList.OpenProperty(PROPERTY_TOOL_CONTAINER);
			var pIToolDescriptorEnum = pIToolContainer.CreateToolDescriptorEnum();
			var NameMap = new CommonMap;

			while(pIToolDescriptorEnum.HasMore())
			{
				var pIToolDescriptor = pIToolDescriptorEnum.OpenNext();

				// If we have not yet processed a tool with this name
				if(null == NameMap.FindByValue(pIToolDescriptor.Name))
				{
					this.SerializeToolTemplate
								(
									pIToolSetTemplateElmnt, 
									pIToolDescriptor, 
									pIRecordIDEnum,
									true, // serialize all children
									SerializeFlags,
									NameMap
									);
				}
			}


			Transaction.Commit();

			// Serialize the injectable
			pIInjectorWrapperElmnt.SerializeToStream
										(
											pIByteStream, 
											GrooveSerializeType_XML, 
											GrooveCharEncodingType_UTF8, 
											GrooveSerializeOption_Default
										);

			pIByteStream.Close();

		}
		catch(e)
		{
			Transaction.Abort();
			pIByteStream.Close();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_SAVINGTEMPLATE);
		}

		pIWindow.Destroy();
		MHF_ShowWaitCursor(false);
	}

	function ProjectViewClass_SerializeToolTemplate(i_pIParentElement, 
													i_pIToolDescriptor,
													i_pISerializeItemIDEnum,
													i_SerializeAllChildren,
													i_SerializeFlags,
													i_SerializedNameMap)
	{
		var pICurrentElement;
		var NSP = "urn:groove.net:";

		if(PropertyList.OpenProperty(PROPERTY_TOOL_NAME) == i_pIToolDescriptor.Name)
		{
			pICurrentElement = this.pIDataModelDelegate.SaveAsTemplate
															(
																i_pIParentElement, 
																i_pISerializeItemIDEnum, 
																i_SerializeAllChildren, 
																i_SerializeFlags
															);

			// AMHACK - there is a bug in the DMD which is basically that we always use
			// the tool template descriptor and not the tool descriptor of the tool container
			// This means that when the tool is used in a toolset, we get the wrong category
			// which prevents the contact provider component from hooking up to our tool,
			// which prevents us from hearing about changes to the contact tool.  As a workaround,
			// we fix them up here.  The right thing to do is (in the future), pass the tool
			// descriptor as an argument to SaveAsTemplate().
			pICurrentElement.SetAttribute("URL", i_pIToolDescriptor.TemplateDescriptor.ComponentResourceURL);
			pICurrentElement.SetAttribute("Category", i_pIToolDescriptor.Category);
			pICurrentElement.SetAttribute("DisplayType", i_pIToolDescriptor.DisplayType);
			pICurrentElement.SetAttribute("Name", i_pIToolDescriptor.Name);
			pICurrentElement.SetAttribute("DisplayName", i_pIToolDescriptor.DisplayName);
		}
		else
		{
			pICurrentElement = i_pIParentElement.CreateElement(NSP + "Template", i_pIParentElement);
			pICurrentElement.SetAttribute("URL", i_pIToolDescriptor.TemplateDescriptor.ComponentResourceURL);
			pICurrentElement.SetAttribute("Category", i_pIToolDescriptor.Category);
			pICurrentElement.SetAttribute("DisplayType", i_pIToolDescriptor.DisplayType);
			pICurrentElement.SetAttribute("Name", i_pIToolDescriptor.Name);
			pICurrentElement.SetAttribute("DisplayName", i_pIToolDescriptor.DisplayName);
		}

		// Remember that we processed this one already
		i_SerializedNameMap.Add(i_SerializedNameMap.GetCount(), i_pIToolDescriptor.Name);
		
		// Look for children
		var pIToolContainer = PropertyList.OpenProperty(PROPERTY_TOOL_CONTAINER);
		var pIToolDescriptorEnum = pIToolContainer.CreateToolDescriptorEnum();
		while(pIToolDescriptorEnum.HasMore())
		{
			var pIChildToolDescriptor = pIToolDescriptorEnum.OpenNext();
			if(i_pIToolDescriptor.Name == pIChildToolDescriptor.OwnerName)
			{
				this.SerializeToolTemplate( pICurrentElement, 
											pIChildToolDescriptor, 
											i_pISerializeItemIDEnum,
											i_SerializeAllChildren,
											i_SerializeFlags,
											i_SerializedNameMap
											);
			}
		}
	}

	// How to use URL Navigation
	//
	//	var ItemID = this.SelectedItem.ID;
	//	var IdentityURL = PropertyList.OpenProperty(PROPERTY_CURRENT_IDENTITY_URL);
	//	var ItemCanonicalURL = this.GetItemURL(ItemID);
	//	var pITelespaceElmntURLSyntax = GrooveScriptFunctions.CreateNewObject("Groove.TelespaceURLSyntax");
	//	var ItemBindableURL = pITelespaceElmntURLSyntax.CreateBindableURL(ItemCanonicalURL, IdentityURL);
	//	
	//	var pIURLNavigator = UIPropertyList.OpenProperty(UIPROPERTY_URLNAVIGATOR);
	//	pIURLNavigator.NavigateToURL(ItemBindableURL, false);
	//
	function ProjectViewClass_GetItemURL(i_ID)
	{
		var CanonicalURL = PropertyList.OpenProperty(PROPERTY_CANONICAL_URL);
		var pIURI = GROOVE_GLOBAL_MISC_POINTER.OpenURI(CanonicalURL);
		pIURI.SetQueryPart("ItemID", i_ID);
		return pIURI.String;
	}

	function ProjectViewClass_ShowItem(i_ID)
	{
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);

		var ItemType = GrooveProjectTrackingItemType_Invalid;
		var ParentItemType = GrooveProjectTrackingItemType_Invalid;
		var pIItem = null;
		var pIParentItem = null;
		try
		{
			if (this.pIDataModelDelegate.DoesItemExist(i_ID))
			{
				ItemType = this.pIDataModelDelegate.GetItemType(i_ID);
				pIItem = this.GetItem(i_ID, ItemType);

				if(ItemType != GrooveProjectTrackingItemType_Project)
				{
					ParentItemType = this.pIDataModelDelegate.GetItemType(pIItem.ParentID);
					pIParentItem = this.GetItem(pIItem.ParentID, ParentItemType);
				}
			}
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_SHOWINGITEM);
			return;
		}

		// If the item exists, 
		if(null != pIItem)
		{
			if(State_EditMode == this.CurrentMode)
			{
				if(this.DetailsView.HasChanged())
				{
					var Response = this.PromptUserToSaveChanges();
					if (GrooveMessageBoxResultCode_Yes == Response)
					{
						if(false == this.OnSave())
							return;
					}
					else if(GrooveMessageBoxResultCode_No == Response)
					{
						this.Attachments.Abort();
					}
					else if (GrooveMessageBoxResultCode_Cancel == Response)
					{
						return;
					}
				}
				this.SetSelectedItem(pIItem, ItemType, pIParentItem, ParentItemType);
				this.DataListDisplay.SetFocusRow(i_ID);
				this.DataListDisplay.ScrollToRow(pIItem.ID);
				this.RefreshSelectedItem();
				this.EnterViewMode();
				return;
			}

			// Update the UI
			this.SetSelectedItem(pIItem, ItemType, pIParentItem, ParentItemType);
			this.RefreshSelectedItem();

			// Navigate to the item
			this.DataListDisplay.SetFocusRow(pIItem.ID);
			this.DataListDisplay.ScrollToRow(pIItem.ID);

			// If the item is not in current view, then remove filter and try again.
			if (!this.DataListDisplay.IsRowSelected(pIItem.ID))
			{
				// Reset participant filter to All
				g_ParticipantsFilterUICommand.UICommand.Label = VIEW_PARTICIPANTS_DROPDOWN_LABEL + GPT_S_STATUS_ALL;
				g_ParticipantsFilterUICommand.UICommand.UserData = GPT_S_STATUS_ALL;

				// Reset the status filter to All
				g_UIProjectStatusCC.UICommand.Label = GPT_S_STATUS_ALL;
				g_UIProjectStatusCC.UICommand.UserData = GPT_S_STATUS_ALL;

				// Redraw the data list with all items.
				this.RedrawDataViewer();

				// Set focus to on item.
				this.DataListDisplay.SetFocusRow(pIItem.ID);
				this.DataListDisplay.ScrollToRow(pIItem.ID);
			}
		}
		else
		{
			this.NotifyUserOfItemRemoval();
		}
	}

	function IsMicrosoftProjectInstalled()
	{
		//	This is a quick registry check for the installation of MS Project.
		var ProjectCurVer = App.ReadRegistryValue (GrooveRegistryKeyValue_ClassesRoot, "MSProject.Application\\CurVer", "");
		return (typeof ProjectCurVer == "string");
	}

	function ProjectViewClass_OnImportFromMSProject()
	{
		GrooveDebugFunctions.DisplayAssert(State_ViewMode == this.CurrentMode, "Cannot import while in edit mode");

		if (!IsMicrosoftProjectInstalled())
		{
			//	MS Project is not installed.  Report and return.
			PHF_AlertUser(STR_PROJECTNOTAVAILABLE_MESSAGE);
			return;
		}

		var pIComponentContainer = PropertyList.OpenProperty(PROPERTY_COMPONENT_CONTAINER).ComponentContainer;
		if(false == pIComponentContainer.IsComponentDefined("MSProjectBridge"))
			GrooveDebugFunctions.DisplayAssert(false, "Missing MS-Project bridge");

		var pMSProjectPumpUICode;
		try
		{
			pMSProjectPumpUICode = pIComponentContainer.
				OpenComponentByName("MSProjectBridge").
				OpenDelegateComponent().
				GetScriptDispatch();
		}
		catch(e)
		{
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MSPROJECTIMPORT);
			return;
		}

		// This guy will handle his errors himself 
		var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var pITool = PropertyList.OpenProperty(PROPERTY_TOOL).Tool;
		var pDataDelegate = pITool.OpenDelegateComponent();
		
		pMSProjectPumpUICode.StartImport(pWindow, pDataDelegate);
	}

	function ProjectViewClass_OnExportToMSProject()
	{
		GrooveDebugFunctions.DisplayAssert(State_ViewMode == this.CurrentMode, "Cannot export while in edit mode");

		if (!IsMicrosoftProjectInstalled())
		{
			//	MS Project is not installed.  Report and return.
			PHF_AlertUser(STR_PROJECTNOTAVAILABLE_MESSAGE);
			return;
		}

		var pIComponentContainer = PropertyList.OpenProperty(PROPERTY_COMPONENT_CONTAINER).ComponentContainer;
		if(false == pIComponentContainer.IsComponentDefined("MSProjectBridge"))
			GrooveDebugFunctions.DisplayAssert(false, "Missing MS-Project bridge");

		var pMSProjectPumpUICode;
		try
		{
			pMSProjectPumpUICode = pIComponentContainer.
				OpenComponentByName("MSProjectBridge").
				OpenDelegateComponent().
				GetScriptDispatch();
		}
		catch(e)
		{
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MSPROJECTEXPORT);
			return;
		}

		// This guy will handle his errors himself 
		var pWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var pITool = PropertyList.OpenProperty(PROPERTY_TOOL).Tool;
		var pDataDelegate = pITool.OpenDelegateComponent();

		pMSProjectPumpUICode.StartExport(pWindow, pDataDelegate);
	}

	function ProjectViewClass_InitACLCache(i_bState)
	{
		if (null == i_bState)
			i_bState = false;

		this.CanMoveUp = i_bState;
		this.CanMoveDown = i_bState;
		this.CanDelete = i_bState;
		this.CanPromote = i_bState;
		this.CanDemote = i_bState;
		this.CanCreateTask = i_bState;
		this.CanEdit = i_bState;
		this.CanImport = i_bState;
		this.CanCut = i_bState;
	}

	function ProjectViewClass_RefreshACLCache()
	{
		var bShowWaitCursor = false;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);

		try
		{
			// Initinialize ACL cache
			this.InitACLCache();

			// Does the selected item exist?
			if (this.SelectedItem &&
			    this.pIDataModelDelegate.DoesItemExist(this.SelectedItem.ID))
			{
				// Deletion and repositioning (check all selected items)
				var IDEnum = this.DataListDisplay.CreateSelectedRowEnum();

				// If the selection contains parent and child items, we only
				// need to consider the parent items since the operation will
				// automatically be applied to the children
				// AMLATER - move this function out of datamodel helper functions
				IDEnum = PDHF_RemoveRedundantDecendants(IDEnum);

				// Enough items selected that we need a wait cursor?
				if (this.DataListDisplay.SelectedRowCount > 2)
				{
					bShowWaitCursor = true;
					MHF_ShowWaitCursor(true);
				}

				// Empty selection?
				if(true == IDEnum.HasMore())
				{
					// Setup temp values, (must be true for AND to work)
					var bCanMoveUp = true;
					var bCanMoveDown = true;
					var bCanDelete = true;
					var bCanPromote = true;
					var bCanDemote = true;

					while(IDEnum.HasMore())
					{
						var SelectedID = IDEnum.OpenNext();

						if(this.pIDataModelDelegate.DoesItemExist(SelectedID))
						{
							bCanDelete &= this.pIDataModelDelegate.CanDeleteItem(SelectedID);
							bCanMoveUp &= this.pIDataModelDelegate.CanMoveItemUp(SelectedID);
							bCanMoveDown &= this.pIDataModelDelegate.CanMoveItemDown(SelectedID);
							bCanPromote &= this.pIDataModelDelegate.CanPromoteItem(SelectedID);
							bCanDemote &= this.pIDataModelDelegate.CanDemoteItem(SelectedID);
						}
					}

					// Update 
					this.CanDelete = bCanDelete;
					this.CanMoveUp = bCanMoveUp;
					this.CanMoveDown = bCanMoveDown;
					this.CanPromote = bCanPromote;
					this.CanDemote = bCanDemote;
				}

				// Need delete priv to cut
				this.CanCut = this.CanDelete;

				// Add task
				this.CanAdd = this.pIDataModelDelegate.CanAddItem(GrooveProjectTrackingItemType_Task);

				// Edit button
				this.CanEdit = this.pIDataModelDelegate.CanReplaceItem(this.SelectedItem.ID);

				// Import from MSProject
				this.CanImport = this.pIDataModelDelegate.CanAddItem(GrooveProjectTrackingItemType_Task) &&
								 this.pIDataModelDelegate.CanReplaceItem(this.ProjectID);

			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, GPTPROJECT_MB_FAILURE_REFRESHACLCACHE + "\n\nError:\n" + e.message);
		}

		// Hide wait cursor
		if (true == bShowWaitCursor)
			MHF_ShowWaitCursor(false);
	}

	function ProjectViewClass_CheckACLItem(i_AclItem)
	{
		var pIReturnFailedItem = null;
		var bShowWaitCursor = false;
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(true);

		try
		{
			if (this.SelectedItem &&
			    this.pIDataModelDelegate.DoesItemExist(this.SelectedItem.ID))
			{
				// If the selection contains parent and child items, we only
				// need to consider the parent items since the operation will
				// automatically be applied to the children
				var IDEnum = PDHF_RemoveRedundantDecendants(this.DataListDisplay.CreateSelectedRowEnum(GrooveDataListSelectionFlags_Ordered));

				// Enough items selected that we need a wait cursor?
				if (this.DataListDisplay.SelectedRowCount > 2)
				{
					bShowWaitCursor = true;
					MHF_ShowWaitCursor(true);
				} 

				// Empty selection?
				if(true == IDEnum.HasMore())
				{
					// Must be true for AND to work
					var bCanDo = true;

					while(IDEnum.HasMore())
					{
						var SelectedID = IDEnum.OpenNext();
						if(this.pIDataModelDelegate.DoesItemExist(SelectedID))
						{
							switch(i_AclItem)
							{
								case g_CAN_MOVE_UP:
									bCanDo &= this.pIDataModelDelegate.CanMoveItemUp(SelectedID);
									break;

								case g_CAN_MOVE_DOWN:
									bCanDo &= this.pIDataModelDelegate.CanMoveItemDown(SelectedID);
									break;

								case g_CAN_CUT:   // Need delete priv to cut
								case g_CAN_DELETE:
									bCanDo &= this.pIDataModelDelegate.CanDeleteItem(SelectedID);
									break;

								case g_CAN_PROMOTE:
									bCanDo &= this.pIDataModelDelegate.CanPromoteItem(SelectedID);
									break;

								case g_CAN_DEMOTE:
									bCanDo &= this.pIDataModelDelegate.CanDemoteItem(SelectedID);
									break;
							}
						}

						// If we have a negative result we can break out of the loop
						// Set the return value.
						if (!bCanDo)
						{
							pIReturnFailedItem = this.GetItemFromID(SelectedID);
							break;
						}
					}
				}
			}

			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			GrooveDebugFunctions.DisplayAssert(0, GPTPROJECT_MB_FAILURE_REFRESHACLCACHE + "\n\nError:\n" + e.message);
		}

		// Hide wait cursor
		if (true == bShowWaitCursor)
			MHF_ShowWaitCursor(false);

		// Return result
		return pIReturnFailedItem;
	}

	//xxx BBLATER -hack to work around platform issue: we cannot display
	// modal dialogs in response to an async engine event :(
	function ProjectViewClass_OnTimerItemReplaced()
	{
		ItemReplacedHackTimer.Stop();
		
		// Set notified state and notify the user.
		this.UserNotifiedOfChange = true;
		MHF_MessageBox(STR_ITEMREPLACED_MESSAGE, STR_ITEMREPLACED_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
	}

	//
	// AMLATER - hack to work around platform issue: we cannot display
	// modal dialogs in response to an async engine event :(
	//
	function ProjectViewClass_OnTimerShowConfigDialog()
	{
		ConfigDialogHackTimer.Stop();
		this.ShowConfigDialog();
	}

	function ProjectViewClass_MarkSelectedRead(i_Read)
	{
		// If we are in edit mode, do nothing
		if (State_EditMode == this.CurrentMode)
			return;

		MHF_ShowWaitCursor(true);
		var IDEnum = this.DataListDisplay.CreateSelectedRowEnum();

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
		try
		{
			while(IDEnum.DoubleEnum.HasMore())
			{
				var ID = IDEnum.DoubleEnum.OpenNext();
				if(this.pIDataModelDelegate.DoesItemExist(ID))
				{
					this.pIDataModelDelegate.MarkRead(ID, i_Read);
				}
			}

			pIDelta.Commit();
			MHF_ShowWaitCursor(false);
		}
		catch(e)
		{
			pIDelta.Abort();
			MHF_ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKINGREAD);
		}
	}

	function ProjectViewClass_MarkAllRead(i_Read)
	{
		// If we are in edit mode, do nothing
		if (State_EditMode == this.CurrentMode)
			return;

		MHF_ShowWaitCursor(true);

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
		try
		{
			this.pIDataModelDelegate.MarkAllRead(i_Read);
			pIDelta.Commit();
			MHF_ShowWaitCursor(false);
		}
		catch(e)
		{
			pIDelta.Abort();
			MHF_ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKINGREAD);
		}
	}

	function ProjectViewClass_NavigatePrevUnread()
	{
		this.NavigateToDocument(GrooveDataListRowNavigation_PriorUnread);
	}

	function ProjectViewClass_NavigateNextUnread()
	{
		this.NavigateToDocument(GrooveDataListRowNavigation_NextUnread);
	}

	function ProjectViewClass_NavigateToDocument(i_Direction)
	{
		// Prompt the user to save changes before exiting edit mode
		// and switch to view mode.
		if (State_EditMode == this.CurrentMode)
		{
			// Get ID of focus row.
			var ID = this.DataListDisplay.FocusRow;

			if (!this.SwitchToViewMode(ID, true))
				return;

			this.RefreshSelectedItem();
		}

		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if (this.DataListDisplay.MoveFocusRow(i_Direction))
			{
				var FocusRow = this.DataListDisplay.FocusRow;
				this.DataListDisplay.SelectRow(FocusRow);
				this.DataListDisplay.ScrollToRow(FocusRow);

				var Item, ItemType, ParentItem, ParentItemType;
				ItemType = this.pIDataModelDelegate.GetItemType(FocusRow);
				Item = this.GetItem(FocusRow, ItemType);

				if(ItemType == GrooveProjectTrackingItemType_Project)
				{
					ParentItem = null;
					ParentItemType = GrooveProjectTrackingItemType_Invalid;
				}
				else
				{
					var ParentID = Item.ParentID;
					ParentItemType = this.pIDataModelDelegate.GetItemType(ParentID);
					ParentItem = this.GetItem(ParentID, ParentItemType);
				}
				this.SetSelectedItem(Item, ItemType, ParentItem, ParentItemType);
			}
			Transaction.Commit();
		}
		catch (error)
		{
			Transaction.Abort();
		}

		this.OnFocusRowChanged();
	}

	function ProjectViewClass_OnRoleChanged(i_ScopeURL, i_ObjectID, i_ChildType, i_RoleName, i_MemberContactURLOrParentRoleName, i_ChangeType)
	{
		// remember to check access control when updatng the UI
		this.UINeedsACLCheck = true;
	}

	function ProjectViewClass_GetReversedSelectionEnum()
	{
		var SelectionEnum = this.DataListDisplay.CreateSelectedRowEnum(GrooveDataListSelectionFlags_Ordered);

		// Reverse the enum.
		var ReversedEnum = CreateDoubleEnum();
		ReverseSelectionEnum(SelectionEnum, ReversedEnum);

		return ReversedEnum.DoubleEnum;
	}

	function ReverseSelectionEnum(i_OldSelectionEnum, i_NewSelectionEnum)
	{
		var ID = i_OldSelectionEnum.OpenNext();
		if (i_OldSelectionEnum.HasMore())
		{
			ReverseSelectionEnum(i_OldSelectionEnum, i_NewSelectionEnum);
		}

		i_NewSelectionEnum.Add(ID);
	}

	function ProjectViewClass_OnCopy(i_IDEnum)
	{
		var IDEnum = i_IDEnum;
		if (null == IDEnum)
		{
			// Do not allow copying of project task
			if (this.DataListDisplay.IsRowSelected(this.ProjectID))
			{
				MHF_MessageBox(STR_NOCUTORCOPYROJECTTASK_MESSAGE, STR_CUT_TITLE,
							   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
				return;
			}

			// Get selection enum.
			IDEnum = this.DataListDisplay.CreateSelectedRowEnum(GrooveDataListSelectionFlags_Ordered);
		}

		// Flush clipboard.
		this.GetClipboard().SetEmpty();

		// This may take a while
		MHF_ShowWaitCursor(true);

		// Requires a WRITE transaction
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var Transaction = Telespace.OpenTransaction(false);
		var pIByteStore = CreateMemoryByteStore();

		try
		{
			// Create an in-memory byte store to hold the serialized items
			this.pIDataModelDelegate.SerializeItemsToStream(IDEnum.DoubleEnum, true,  // Include children
	  														pIByteStore.OpenByteOutputStream(false),  // Dont append 
															GrooveProjectTrackingSerializeFlags_Attachments);
			Transaction.Commit();
		}
		catch(e)
		{
			Transaction.Abort();
			MHF_ShowWaitCursor(false);
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_COPY);
			return;
		}

		// Copy the stream to the clipboard
		this.GetClipboard().SetDataAsBinary(PROJECTITEM_CLIPBOARDFORMAT2, pIByteStore.OpenByteInputStream());

		// Hide wait cursor
		MHF_ShowWaitCursor(false);
	}

	function ProjectViewClass_OnPaste()
	{
		// Determine which data format we have
		var bVersion1 = this.GetClipboard().IsDataAvailable(PROJECTITEM_CLIPBOARDFORMAT);
		var bVersion2 = this.GetClipboard().IsDataAvailable(PROJECTITEM_CLIPBOARDFORMAT2);

		// Be defensive, UI command state should prevent this
		// Support all clipboard format versions.
		if (!bVersion1 && !bVersion2)
		{
			GrooveDebugFunctions.DisplayAssert(0, "No data is available");
			return;
		}

		// If the project item is selected, paste to the beginning
		var ParentID;
		var PrevSiblingID;
		if(this.SelectedItemType == GrooveProjectTrackingItemType_Project)
		{
			ParentID = this.SelectedItem.ID;
			PrevSiblingID = 0;
		}
		else
		{
			ParentID = this.SelectedItem.ParentID;
			PrevSiblingID = this.SelectedItem.ID;
		}

		var BIS = null;
		if (bVersion1)
			BIS = this.GetClipboard().OpenDataAsBinary(PROJECTITEM_CLIPBOARDFORMAT);
		else
			BIS = this.GetClipboard().OpenDataAsBinary(PROJECTITEM_CLIPBOARDFORMAT2);

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta();

		// Show wait cursor
		MHF_ShowWaitCursor(true);

		try
		{
			this.pIDataModelDelegate.InsertItemsFromStream(ParentID, PrevSiblingID, BIS, this.GetProgressInterface());
			pIDelta.Commit();
		}
		catch(e)
		{
			MHF_ShowWaitCursor(false);
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_PASTE);
			return;
		}

		// Hide wait cursor
		MHF_ShowWaitCursor(false);
	}

	function ProjectViewClass_OnCut()
	{
		// Do not allow copying of project task
		if (this.DataListDisplay.IsRowSelected(this.ProjectID))
		{
			MHF_MessageBox(STR_NOCUTORCOPYROJECTTASK_MESSAGE, STR_CUT_TITLE,
						   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return;
		}

		// Check if we can cut task.
		var ResultItem = null;
		if (this.CanCut && null != (ResultItem = this.CheckACLItem(g_CAN_CUT)))
		{		
			// Display user message and return.
			var strMessage = String(STR_NOCUTUPPERMISSION_MESSAGE);
			strMessage = strMessage.replace(/%taskname/i, ResultItem.Name);

			MHF_MessageBox(strMessage, STR_CUT_TITLE,
						   GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
			return;
		}

		// Like in Microsoft Project, if only one item is selected for Cut, let's prompt
		// the user if it is a summary task.
		if (this.DataListDisplay.SelectedRowCount == 1)
		{
			var ItemID = this.DataListDisplay.FocusRow;
			if (-1 != ItemID &&
			    this.pIDataModelDelegate.HasChildren(ItemID))
			{
				var pTask = null;
				var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
				var Transaction = Telespace.OpenTransaction(true);
				try
				{
					// Get task base don id.
					pTask = this.GetItemFromID(ItemID);
					Transaction.Abort();
				}
				catch(e)
				{
					Transaction.Abort();
					return;
				}

				if (!pTask)
					return;

				// Format message and prompt user.
				var strMessage = (STR_CONFIRMDELETE_MESSAGE + STR_CONFIRMSUMMARYTASKDELETE_MESSAGE);
				strMessage += ("\"" + pTask.Name + "\"" + STR_QUESTIONMARK + STR_DELETESUBTASKS_MESSAGE);
				var Response = MHF_MessageBox(strMessage, STR_CUT_TITLE,
											  GrooveMessageBoxStyle_OKCancel, GrooveMessageBoxIcon_Information);

				if (GrooveMessageBoxResultCode_Cancel == Response)
					return;
				// else  GrooveMessageBoxResultCode_Yes
			}
		}

		// Get selection enum.
		var IDEnum = this.DataListDisplay.CreateSelectedRowEnum(GrooveDataListSelectionFlags_Ordered);

		// Copy the items to the clipboard
		this.OnCopy(IDEnum);

		// Show wait cursor
		MHF_ShowWaitCursor(true);

		// Delete the items
		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
		try
		{
 			this.pIDataModelDelegate.DeleteMultipleItems(IDEnum, this.GetProgressInterface());
			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_CUT);
		}

		// Hide wait cursor
		MHF_ShowWaitCursor(false);
	}


	function ProjectViewClass_GetClipboard()
	{
		return this.UIManager.OpenClipboard();
	}

	function ProjectViewClass_OnUnreadTimer()
	{
		UnreadTimer.Stop();

		if(false == this.SelectedItem.IsRead && State_ViewMode == this.CurrentMode)
		{
			var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
			var Transaction = Telespace.OpenTransaction(false);
			try
			{
				var ID = this.SelectedItem.ID;
				if(this.pIDataModelDelegate.DoesItemExist(ID))
				{
					this.pIDataModelDelegate.MarkRead(ID, true);
				}

				Transaction.Commit();
			}
			catch(e)
			{
				Transaction.Abort();
				GrooveDebugFunctions.DisplayAssert(0, "Selected task does not exist.");
				return;
			}
		}
	}

	function ProjectViewClass_SaveNewTask(i_ParentID,
										  i_PreviousSiblingID,
										  i_TaskName,
										  i_AssignedToContactURL,
										  i_Status,
										  i_Priority,
										  i_UserStartConstraint,
										  i_ConstrainStart,
										  i_ScheduledStart,
										  i_ScheduledDuration,
										  i_ScheduledFinish,
										  i_DisplayFinish,
										  i_ActualStart,
										  i_ActualFinish,
										  i_IsPrivate,
										  i_pIDescription,
										  i_NewPredecessorsArray)
	{
		var NewID = -1;

		// This may take a while
		MHF_ShowWaitCursor(true);

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta();  // Do not undo/redo new tasks
		try
		{
			// Check if user can add an item.
			if (this.CanAdd && (this.CanAdd = this.pIDataModelDelegate.CanAddItem(GrooveProjectTrackingItemType_Task)))
			{
				NewID = this.pIDataModelDelegate.InsertNewTask
									(	i_ParentID,
										i_PreviousSiblingID,
									    i_TaskName, 
										i_AssignedToContactURL,
										i_Status,
										i_Priority,
										i_UserStartConstraint,
										i_ConstrainStart,
										i_ScheduledStart,
										i_ScheduledDuration,
										i_ScheduledFinish,
										i_DisplayFinish,
										i_ActualStart,
										i_ActualFinish,
										i_IsPrivate,
										i_pIDescription,
										this.GetProgressInterface()
									);

				// Save any new attachments
				this.Attachments.Commit(RecordSetEngine.OpenRecord(NewID));

				// Add any new predecessors
				this.AddPredecessors(NewID, i_NewPredecessorsArray);

				pIDelta.Commit();
			}
			else
			{
				pIDelta.Abort();
			}
		}
		catch(e)
		{
			this.Attachments.Abort();
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_ADDING);
		}

		// Done
		MHF_ShowWaitCursor(false);

		// If the user cannot edit item, give a notice
		if(false == this.CanAdd)
		{
			// User does not have permissions
			MHF_MessageBox(STR_NOPERMISSION_MESSAGE, STR_SAVETASK_TITLE, GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Information);
		}

		// Switch back to view-only mode
		this.EnterViewMode();

		// Select the new item in the data list. This will trigger
		// a selection change event so that we update our details pane.
		if(-1 != NewID)
		{
			this.DataListDisplay.SetFocusRow(NewID);
			this.DataListDisplay.ScrollToRow(NewID);
		}
		return NewID;
	}


	// TRANSACTION REQUIREMENT: DELTA
	function ProjectViewClass_ReplaceExistingItem(i_pIItem,
												  i_ItemType,
												  i_NewPredecessorArray,
												  i_RemovePredecessorArray)
	{
		if(GrooveProjectTrackingItemType_Project == i_ItemType)
		{
			this.pIDataModelDelegate.ReplaceProject(i_pIItem, this.GetProgressInterface());
		}
		else
		{
			this.pIDataModelDelegate.ReplaceTask(i_pIItem, this.GetProgressInterface());
		}

		// Items other than the project item may have predecessors
		if(GrooveProjectTrackingItemType_Project != i_ItemType)
		{
			// Remove any existing predecessors
			this.RemovePredecessors(i_pIItem.ID, i_RemovePredecessorArray);

			// Add any new predecessors
			this.AddPredecessors(i_pIItem.ID, i_NewPredecessorArray);
		}
	}

	//
	// TRANSACTION REQUIREMENT: DELTA
	//		i_RemovePredecessorArray is an array of Task IDs
	function ProjectViewClass_RemovePredecessors(i_FromID, i_RemovePredecessorArray)
	{
		if(0 != i_RemovePredecessorArray.length)
		{
			var pIRemoveEnum = CreateDoubleEnum();
			for(var i = 0; i < i_RemovePredecessorArray.length; ++i)
			{
				pIRemoveEnum.Add(i_RemovePredecessorArray[i]);
			}

			this.pIDataModelDelegate.RemovePredecessors(i_FromID, pIRemoveEnum.DoubleEnum, this.GetProgressInterface());
		}
	}

	//
	// TRANSACTION REQUIREMENT: DELTA
	//		i_NewPredecessorArray is an array of Task IDs
	function ProjectViewClass_AddPredecessors(i_ToID, i_NewPredecessorArray)
	{
		if(0 != i_NewPredecessorArray.length)
		{
			var pIAddEnum = CreateDoubleEnum();
			for(var i = 0; i < i_NewPredecessorArray.length; ++i)
			{
				pIAddEnum.Add(i_NewPredecessorArray[i]);
			}

			this.pIDataModelDelegate.AddPredecessors(i_ToID, pIAddEnum.DoubleEnum, this.GetProgressInterface());
		}
	}


	//
	// Returns:
	//	GrooveMessageBoxResultCode_Yes to save changes
	//	GrooveMessageBoxResultCode_No to abort changes
	//	GrooveMessageBoxResultCode_Cancel to continue editing
	//
	function ProjectViewClass_PromptUserToSaveChanges(dlgStyle)
	{
		if (null == dlgStyle)
			dlgStyle = GrooveMessageBoxStyle_YesNoCancel;
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		return  App.GrooveMessageBox(Window, Account, GPT_MB_SAVECHANGES, GPTPROJECT_WC_TOOLNAME, dlgStyle, GrooveMessageBoxIcon_Exclamation);
	}

	//
	// Returns:
	//	GrooveMessageBoxResultCode_Yes to save as a new item
	//	GrooveMessageBoxResultCode_No to abort changes
	//	GrooveMessageBoxResultCode_Cancel to continue editing
	//
	function ProjectViewClass_PromptUserToSaveDeletedAsNew()
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		return  App.GrooveMessageBox(Window, Account, GPT_MB_SAVEDELETEDASNEW, GPTPROJECT_WC_TOOLNAME, GrooveMessageBoxStyle_YesNoCancel, GrooveMessageBoxIcon_Exclamation);
	}

	function ProjectViewClass_OnCalculationStart()
	{
		ProgressText.ResetContent();
		ProgressText.Visible = true;
	}

	function ProjectViewClass_OnCalculationUpdate(i_PercentComplete)
	{
		// ProgressText.SetText(GPT_CL_CALCPROGRESS + " " + i_PercentComplete + "%");
		ProgressText.ResetContent();
		ProgressText.AddItem(GPT_CL_CALCPROGRESS + " " + i_PercentComplete + "%");
		ProgressText.Redraw();
	}

	function ProjectViewClass_OnCalculationEnd()
	{
		// ProgressText.SetText("");
		ProgressText.ResetContent();
		ProgressText.Visible = false;
	}

	function ProjectViewClass_RedrawDataViewer()
	{
		var Query;
		var bUseFlatSort = true;
		var Status = MHF_GetStatusFilterEnumFromString(g_UIProjectStatusCC.UICommand.UserData);
		var ParticipantURL = g_ParticipantsFilterUICommand.UICommand.UserData;
		if(ParticipantURL == GPT_S_STATUS_ALL &&
			Status == GrooveProjectToolsetStatusFilterType_All)
		{
			Query = "*";
			bUseFlatSort = false;

		}
		else if(ParticipantURL != GPT_S_STATUS_ALL &&
			Status == GrooveProjectToolsetStatusFilterType_All)
		{
			if(ParticipantURL == GPT_S_UNASSIGNED)
				Query = "/[@AssignedToContactURL='" + "" + "'] or /[@TeamLeaderContactURL='" + "" + "']";
			else
				Query = "/[@AssignedToContactURL='" + ParticipantURL + "'] or /[@TeamLeaderContactURL='" + ParticipantURL + "']";
		}
		else if(ParticipantURL == GPT_S_STATUS_ALL &&
			Status != GrooveProjectToolsetStatusFilterType_All)
		{
			Query = "/[@Status='" + Status + "']";
		}
		else if(ParticipantURL != GPT_S_STATUS_ALL &&
			Status != GrooveProjectToolsetStatusFilterType_All)
		{
			if(ParticipantURL == GPT_S_UNASSIGNED)
				Query = "/[@Status='" + Status + "'] and (/[@AssignedToContactURL='" + "" + "'] or /[@TeamLeaderContactURL='" + "" + "'])";
			else
				Query = "/[@Status='" + Status + "'] and (/[@AssignedToContactURL='" + ParticipantURL + "'] or /[@TeamLeaderContactURL='" + ParticipantURL + "'])";
		}
		else
		{
			GrooveDebugFunctions.DisplayAssert(0, "Invalid Status or ParticipantURL in GetItemIDsForParticipantAndStatus");
			return;
		}

		// Specify which view to use: hierarchical or flat
		if(bUseFlatSort)
		{
			this.DataListDisplay.ShowHierarchy = false;
		}
		else
		{
			this.DataListDisplay.ShowHierarchy = true;
		}

		// Do query
		var pIFilteredCollection = Collection.OpenCollection().Collection.Find(Query);

		// Assign query to data list
		this.CollectionDataListDataSource.IGrooveCollectionDataListDataSource.Collection = pIFilteredCollection;
	}

	function ProjectViewGrooveMessageDialogHelper (i_Message, i_DialogTitle, i_IconType)
	{
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, i_Message, i_DialogTitle, GrooveMessageBoxStyle_OK, i_IconType);
	}

	function ProjectViewClass_GetProgressInterface()
	{
		return ScriptHostComponent.IGrooveProjectTrackingSynchronousProgressListener;
	}
	
	function ProjectViewClass_IsFilterOn()
	{
		var ParticipantText = g_ParticipantsFilterUICommand.UICommand.Label;
		var ParticipantLabelValue = Right(ParticipantText, VIEW_PARTICIPANTS_DROPDOWN_LABEL);
		var StatusText = g_UIProjectStatusCC.UICommand.Label;
		var StatusLabelValue = Right(StatusText, VIEW_STATUS_DROPDOWN_LABEL);
		if(GPT_S_STATUS_ALL == ParticipantLabelValue && GPT_S_STATUS_ALL == StatusLabelValue)
			return true;
		else
			return false;
	}

	function NeedUserNotification(i_pChangedItem, i_pSelectedItem, i_ItemType)
	{
		if(i_ItemType == GrooveProjectTrackingItemType_Project)
		{
			if(i_pChangedItem.Name == i_pSelectedItem.Name &&
				i_pChangedItem.ID == i_pSelectedItem.ID &&
				i_pChangedItem.ProjectLeaderContactURL == i_pSelectedItem.ProjectLeaderContactURL &&
				i_pChangedItem.Status == i_pSelectedItem.Status &&
				i_pChangedItem.CreationTime == i_pSelectedItem.CreationTime &&
				i_pChangedItem.ScheduledStart == i_pSelectedItem.ScheduledStart &&
				i_pChangedItem.ScheduledDuration == i_pSelectedItem.ScheduledDuration &&
				i_pChangedItem.ScheduledFinish == i_pSelectedItem.ScheduledFinish &&
				i_pChangedItem.ActualStart == i_pSelectedItem.ActualStart &&
				i_pChangedItem.ActualFinish == i_pSelectedItem.ActualFinish &&
				i_pChangedItem.ProjectCreatorContactURL == i_pSelectedItem.ProjectCreatorContactURL)
			{
				return false;
			}

			return true;
		}

		if(i_pChangedItem.Name == i_pSelectedItem.Name &&
			i_pChangedItem.ID == i_pSelectedItem.ID &&
			i_pChangedItem.AssignedToContactURL == i_pSelectedItem.AssignedToContactURL &&
			i_pChangedItem.Status == i_pSelectedItem.Status &&
			i_pChangedItem.Priority == i_pSelectedItem.Priority &&
			i_pChangedItem.IsSummary == i_pSelectedItem.IsSummary &&
			i_pChangedItem.UserStartConstraint == i_pSelectedItem.UserStartConstraint &&
			i_pChangedItem.ConstrainStartDate == i_pSelectedItem.ConstrainStartDate &&
			i_pChangedItem.ScheduledStart == i_pSelectedItem.ScheduledStart &&
			i_pChangedItem.ScheduledDuration == i_pSelectedItem.ScheduledDuration &&
			i_pChangedItem.ScheduledFinish == i_pSelectedItem.ScheduledFinish &&
			i_pChangedItem.ActualStart == i_pSelectedItem.ActualStart &&
			i_pChangedItem.ActualFinish == i_pSelectedItem.ActualFinish &&
			i_pChangedItem.IsPrivate == i_pSelectedItem.IsPrivate)
		{
			return false;
		}

		return true;
	}

	function CheckSystemDllsVersion()
	{
		var SysFileNamesAndVersionsMap = new CommonMap();
		SysFileNamesAndVersionsMap.Add("OLEPRO32.DLL", "5.0.4261.0");
		SysFileNamesAndVersionsMap.Add("MFC42.dll", "6.0.8168.0");
		SysFileNamesAndVersionsMap.Add("MSVCRT.DLL", "6.0.8168.0");

		try
		{
			// Get helper objects.
			var App = GrooveScriptFunctions.CreateNewObject("Groove.Application");
			var FS = GrooveScriptFunctions.CreateNewObject("Groove.Win32FileSystemServices");

			// Get windows system foilder.
			var WinSysDirectory = App.GetDirectoryPath(GrooveDirectoryValue_System);
			for(var i=0; i<SysFileNamesAndVersionsMap.GetCount(); i++)
			{
				var Pair = SysFileNamesAndVersionsMap.GetAt(i);
				var Version = FS.GetDllVersionString(WinSysDirectory + Pair.Key);
				if(Version != "")
				{
					if(!DoCompare(Pair.Value, Version))
						return false;
				}
				else
					return false;
			}
		}
		catch(error)
		{
			return false;
		}
		return true;
	}

	function DoCompare(i_RequiredVersion, i_InstalledVersion)
	{
		if(i_RequiredVersion <= i_InstalledVersion)
			return true;
		return false;
	}

	function ProjectViewClass_ToggleUnreadMarks()
	{
		MHF_ShowWaitCursor(true);
		var IDEnum = this.DataListDisplay.CreateSelectedRowEnum();

		var DynamicsMgr = this.DynamicsManager;
		var pIDelta = DynamicsMgr.CreateDelta(this.SessionName);
		try
		{
			while(IDEnum.DoubleEnum.HasMore())
			{
				var ID = IDEnum.DoubleEnum.OpenNext();
				if(this.pIDataModelDelegate.DoesItemExist(ID))
				{
					var ItemType = this.pIDataModelDelegate.GetItemType(ID);
					var pItem = this.GetItem(ID, ItemType);
					if(null != pItem)
					{
						if(pItem.IsRead)
							this.pIDataModelDelegate.MarkRead(ID, false);
						else
							this.pIDataModelDelegate.MarkRead(ID, true);
					}
				}
			}
			pIDelta.Commit();
		}
		catch(e)
		{
			pIDelta.Abort();
			PHF_AlertUserOfFailure(GPTPROJECT_MB_FAILURE_MARKINGREAD);
		}
		MHF_ShowWaitCursor(false);
	}


	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         @           ¯  P  
      Ã     Ÿ• Ÿ•                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               X               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   r   ÄName    P r o j e c t V i e w 2 . g s l   f       ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT	     ÄSCRIPT
    ÄSCRIPT       ÄSRC@  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t M i s c G l u e _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n    "    L &  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       s i  ÄSCRIPT       ÄSRC   h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e C a l e n d a r H e l p e r _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   ff    n =  ÄSCRIPT       ÄSRC6  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e C o m m o n T o o l C a t e g o r y S t r i n g s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       & F a c  ÄSCRIPT       ÄSRCV  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t M i s c H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       t o r y  ÄSCRIPT       ÄSRCV  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t M e n u H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n       = O p e n        ÄSCRIPT       ÄSRCÄ  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . B u s i n e s s . G r o o v e P r o j e c t T o o l s e t . P r o j e c t T r a c k i n g . P r o j e c t D a t a M o d e l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 2 & F a c t o r y = O p e n   i                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ÿ•   y   Ty   §Y    E   TU   † e     ˛          )      ÄSCRIPT         ï{ Ä

	var GrooveCalendarCommand_Import         = 201;
	var GrooveCalendarCommand_ExportSelected = 202;
	var GrooveCalendarCommand_ExportAll      = 203;

	//---------------
	// Public Methods
	//---------------

	function CreateCalendarRecord()
	{
		return CalendarEngine.RecordFactory.CreateRecord(GetSchemaName());
	}

	function AddCalendarRecord(i_CalendarRecord)
	{
		CalendarEngine.AddRecord(i_CalendarRecord);
	}

	function ReplaceCalendarRecord(i_Record)
	{
		// Begin the read/write transaction
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if (CalendarEngine.HasRecord(i_Record.RecordID))
				CalendarEngine.ReplaceRecord(i_Record.RecordID, i_Record);
			else
				CalendarEngine.AddRecord(i_Record);

			Transaction.Commit();
		}
		catch (e)
		{
			Transaction.Abort();
		}
	}

	function RemoveCalendarRecord(i_RecordID)
	{										
		// Begin the read/write transaction
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if (CalendarEngine.HasRecord(i_RecordID))
			{
				CalendarEngine.RemoveRecord(i_RecordID);
				Transaction.Commit();
				return true;
			}
			else
			{
				Transaction.Abort();
				return false;
			}
		}
		catch(e)
		{
			Transaction.Abort();
			return false;
		}
	}

	function GetCurrentTimeZoneID()
	{
		return CalendarView.TimeZoneID;
	}

	function GetVersion()
	{
		return g_TemplateVersion;
	}

	function GetRecordEnum()
	{
		return CalendarEngine.OpenRecordEnum();
	}

	function OpenRecordEnumForRange(i_Start, i_End)
	{
		var RecordEnumGUID = "{B839FC20-8E46-11d3-80A2-005004D38CA2}";
		var RecordGUID = "{BD5E0420-F5AB-11d2-8D5A-0080C78F77E0}";

		var pRecordEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs(RecordEnumGUID, RecordGUID);
		var pRecordsInRange = pRecordEnum.UnknownEnumCreate;

		var pAllRecords = GetRecordEnum();
		while (pAllRecords.HasMore())
		{
			var pRecord = pAllRecords.OpenNext();
			var RecordStart = pRecord.OpenField("Start");
			var RecordEnd   = pRecord.OpenField("End");
			
			if (RecordStart <= i_End && RecordEnd >= i_Start)
				pRecordsInRange.Add(pRecord);
		}

		return pRecordsInRange;
	}

	//----------------------
	// Common Initialization
	//----------------------

	// will hold components
	var CalendarView, CalendarEngine, CalendarSubFormCode, Telespace;

	var g_pTelespaceIdentityPropertyList;
	var g_InFollowMode;
	var g_UIActive;
	var g_TemplateVersion;

	function CommonInitialize(i_TemplateVersion)
	{
		g_TemplateVersion = i_TemplateVersion;

		// Get and connect to Calendar View and Engine
		var CalendarSubFormHost = CalendarSubForm.OpenDelegateComponent();
		CalendarSubFormCode = CalendarSubFormHost.GetScriptDispatch();
		CalendarView = CalendarSubFormCode.OpenCalendarView();
		CalendarEngine = CalendarSubFormCode.OpenCalendarEngine();
		ConnectObject(CalendarView,"CalendarView_");
		ConnectObject(CalendarEngine,"CalendarEngine_");

		Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);

		// Open and connect to our various property list
		g_pTelespaceIdentityPropertyList = CreateOrOpenPropertyList(PropertyList, Telespace, 0, 1, 
																	ScriptHostComponent,
																	"TelespaceIdentityPropertyList", true);

		// Is follow mode on?
		if (g_pTelespaceIdentityPropertyList.PropertyExists("ToolNavigationMode"))
		{
			g_InFollowMode = g_pTelespaceIdentityPropertyList.OpenPropertyAsLong("ToolNavigationMode");
		}
		else
		{
			var TelespacePropertyList = CreateOrOpenPropertyList(PropertyList, Telespace, 0, 3, ScriptHostComponent, "", false);
			if (TelespacePropertyList != null)
			{
				if (TelespacePropertyList.PropertyExists("ToolNavigationMode"))
					g_InFollowMode = TelespacePropertyList.OpenPropertyAsLong("ToolNavigationMode");
			}		
		}

		if (PropertyList.PropertyExists("CalendarLastDirectory") == false)
			PropertyList.SetProperty("CalendarLastDirectory", "c:\\", 0);
	}

	function CommonTerminate()
	{
		DisconnectObject(CalendarView);
		DisconnectObject(CalendarEngine);
		DisconnectObject(g_pTelespaceIdentityPropertyList);
	}

	function CommonSetUIProperties()
	{
		UpdateCalendarTitle();

		g_UIActive = true;

		if (g_InFollowMode)
		{
			// Navigate to the follow mode properties
			if (PropertyList.PropertyExists("FollowMode_ViewType"))
				ProcessViewTypeFromPropertyList(PropertyList.OpenProperty("FollowMode_ViewType"));
			if (PropertyList.PropertyExists("FollowMode_StartDate"))
				ProcessStartDateFromPropertyList(PropertyList.OpenProperty("FollowMode_StartDate"));
		}

		CalendarSubFormCode.SetFocus();
	}

	function CommonRevokeUIProperties()
	{
		g_UIActive = false;
	}

	function CommonPropertyChanged(i_Key, i_Value, i_LocallyGenerated)
	{
		if (i_Key == "FollowMode_ViewType")
		{
			if (g_InFollowMode && g_UIActive && !i_LocallyGenerated)
				ProcessViewTypeFromPropertyList(i_Value);
		}
		else if (i_Key == "FollowMode_StartDate")
		{
			if (g_InFollowMode && g_UIActive && !i_LocallyGenerated)
				ProcessStartDateFromPropertyList(i_Value);
		}
	}

	function OnCommand(i_CalendarCommand)
	{
		switch (i_CalendarCommand)
		{
			case GrooveCalendarCommand_NewEntry:
				AddCalendarEvent();
				break;
			case GrooveCalendarCommand_ScrollNext:
				HandleScrollNext();
				break;
			case GrooveCalendarCommand_ScrollPrev:
				HandleScrollPrev();
				break;
			case GrooveCalendarCommand_ScrollToday:
				HandleScrollToToday();
				break;
			case GrooveCalendarCommand_DayView:
				HandleViewChange(GrooveCalendarViewType_Day);
				break;
			case GrooveCalendarCommand_WeekView:
				HandleViewChange(GrooveCalendarViewType_FamilyWeek);
				break;
			case GrooveCalendarCommand_MonthView:
				HandleViewChange(GrooveCalendarViewType_Month);
				break;
			case GrooveCalendarCommand_BusinessWeekView:
				HandleViewChange(GrooveCalendarViewType_NormalWeek);
				break;
			case GrooveCalendarCommand_BusinessMonthView:
				HandleViewChange(GrooveCalendarViewType_MonthWithStackedWeekends);
				break;
  			case GrooveCalendarCommand_Paste:
				Paste();
				break;
			case GrooveCalendarCommand_OpenDetail:
				EditCalendarEvent(CalendarView.SelectedEntry);
				break;
			case GrooveCalendarCommand_Copy:
				Copy();
				break;
			case GrooveCalendarCommand_CopyAsLink:
				CopyAsLink();
				break;
			case GrooveCalendarCommand_Delete:
				DeleteSelectedEvent();
				break;
			case GrooveCalendarCommand_Cut:
				Cut();
				break;
			case GrooveCalendarCommand_MarkRead:
				if (g_TemplateVersion >= 3)
					MarkRecordRead(CalendarView.SelectedEntry, true);
				break;
			case GrooveCalendarCommand_MarkUnread:
				if (g_TemplateVersion >= 3)
					MarkRecordRead(CalendarView.SelectedEntry, false);
				break;
			case GrooveCalendarCommand_MarkAllRead:
				if (g_TemplateVersion >= 3)
					MarkAllRead(true);
				break;
			case GrooveCalendarCommand_MarkAllUnread:
				if (g_TemplateVersion >= 3)
					MarkAllRead(false);
				break;

			case GrooveCalendarCommand_Import:
				if (g_TemplateVersion >= 3)
					Import();
				break;

			case GrooveCalendarCommand_ExportSelected:
				Export(false);
				break;

			case GrooveCalendarCommand_ExportAll:
				Export(true);
				break;

			case GrooveCalendarCommand_GoToDate:
				GotoDate();
				break;

			// Not implemented
			//case GrooveCalendarCommand_SaveAs:
			//case GrooveCalendarCommand_Undo:
			//case GrooveCalendarCommand_Redo:
		}

		CalendarSubFormCode.SetFocus();
	}

	//------------------
	// Clipboard Support
	//------------------

	function Cut()
	{
		if (CalendarView.IsSelectionADate)
			return;

		Copy();

		if (CanDeleteRecord(CalendarView.SelectedEntry))
			RemoveCalendarRecord(CalendarView.SelectedEntry);
		else
			DisplayNoCutPermissionsWindow();
	}

	function Copy()
	{
		if (CalendarView.IsSelectionADate)
			return;

		SetClipboardEmpty();
		var RecordIDEnum = CreateDoubleEnum();
		RecordIDEnum.Add(CalendarView.SelectedEntry);

		CopyRecordsToClipboard(RecordIDEnum, CalendarEngine, GetSchemaName(), "Error: ");
		CopySelectedEntryAsText();
	}

	function CopyAsLink()
	{
		if (CalendarView.IsSelectionADate)
			return;

		var Subject = GetSelectedEntrySubject();
		if (Subject != "")
		{
			var CanonicalURL = PropertyList.OpenProperty(PROPERTY_CANONICAL_URL);
			var pURL = GROOVE_GLOBAL_MISC_POINTER.OpenURI(CanonicalURL);
			pURL.SetQueryPart("RecordID", CalendarView.SelectedEntry);
			SetClipboardEmpty();
			CopyAsLinkToClipboard(pURL.String, Subject);
		}
	}

	function Paste()
	{
		var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
		var pClipboard = pUIManager.OpenClipboard();
		if (pClipboard.IsDataAvailable(GetSchemaName()))
		{
			if (CanAddRecord())
			{
				var RecordEnum = PasteRecordsFromClipboard(GetSchemaName(), CalendarEngine, false);
				PrepareEnumForPaste(RecordEnum);
				CalendarEngine.AddMultipleRecords(RecordEnum);
			}
			else
			{
				DisplayNoAddPermissionsWindow();
			}
		}
	}

	function CopySelectedEntryAsText()
	{
		var RecordID = CalendarView.SelectedEntry;

		// Begin read-only Transaction
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if (CalendarEngine.HasRecord(RecordID))
			{
				var CalendarRecord = CalendarEngine.OpenRecord(RecordID);
				var ClipboardText = CalendarRecordToText(CalendarRecord);
				SetClipboardEmpty();
				CopyTextToClipboard(ClipboardText);
			}
		}
		catch (error)
		{
		}

		Transaction.Commit();
	}

	function CalendarRecordToText(i_CalendarRecord)
	{
		var Text = i_CalendarRecord.OpenField("Subject");
		Text += "\r\n";

		var Start = i_CalendarRecord.OpenField("Start");
		var End = i_CalendarRecord.OpenField("End");
		var SpansDays = SpansDays(Start, End);
		var IsAllDay = i_CalendarRecord.OpenField("IsAllDay");

		Text += FormatDate(Start, GrooveIntlDateFormatStyle_Full);

		if (!IsAllDay)
		{
			Text += " " + FormatTime(Start) + " - ";

			// Include the end date as well
			if (SpansDays)
				Text += FormatDate(End, GrooveIntlDateFormatStyle_Full) + " ";

			Text += FormatTime(End);
		}
		
		else if (SpansDays)
		{
			Text += " - " + FormatDate(End, GrooveIntlDateFormatStyle_Full);
		}

		return Text;
	}

	function PrepareEnumForPaste(i_RecordEnum)
	{
		while (i_RecordEnum.HasMore())
		{
			var Record = i_RecordEnum.OpenNext();
			SetPasteDate(Record);
			TakeOwnership(Record);
		}
		i_RecordEnum.Reset();
	}

	function SetPasteDate(i_Record)
	{
		var Start = i_Record.OpenField("Start");
		var End = i_Record.OpenField("End");

		var Length = End - Start;
		if (CalendarView.IsSelectionAllDay)
		{
			var SelectionCal = CreateCalendar(CalendarView.SelectionStart);
			var Year = SelectionCal.Get(GrooveIntlCalendarField_Year);
			var Month = SelectionCal.Get(GrooveIntlCalendarField_Month);
			var Day = SelectionCal.Get(GrooveIntlCalendarField_DayOfMonth);

			var EntryCal = CreateCalendar(Start);
			EntryCal.SetDate(Year, Month, Day);

			Start = EntryCal.DateTime.RawDateTime;
		}
		else
		{
			Start = CalendarView.SelectionStart;
		}

		End = Start + Length;
	
		i_Record.SetField("Start", Start);
		i_Record.SetField("End", End);
	}

	function TakeOwnership(i_Record)
	{
		var pCurrIdent = Telespace.OpenCurrentIdentity();
		var UserName = OpenFullNameFromContact(pCurrIdent.Contact);
		var UserURL = pCurrIdent.URL();

		i_Record.SetField("_CreatedBy", UserName);
		i_Record.SetField("_CreatedByURL", UserURL);
		if (GetVersion() >= 3)
			i_Record.SetField("TimeZone", CalendarView.TimeZoneID);
	}

	function Export(i_AllRecords)
	{
		var RecordIDEnum;

		if (i_AllRecords)
		{
			RecordIDEnum = CalendarEngine.OpenRecordIDEnum();
		}
		else
		{
			var RecordIDEnum = CreateDoubleEnum();
			RecordIDEnum.Add(CalendarView.SelectedEntry);
		}

		ExportRecordsToFile(RecordIDEnum, CalendarEngine, PropertyList, "Calendar");
	}


	function Import()
	{
		// Don't import until version 3
		if (g_TemplateVersion < 3)
			return;

		var FileResult;

		try
		{
			var Account = OpenAccountFromPropertyList(PropertyList);
			var strLastDirectory = PropertyList.OpenProperty("CalendarLastDirectory");
			FileResult = App.OpenFileDialog("Import File", "XML File (*.xml)|*.xml|", strLastDirectory, "", Account, 1, false);
		}
		catch (error)
		{
			DisplayError("import", error);
			return;
		}

		if (GrooveDialogBoxResultCode_OK == FileResult.Result)
		{
			try
			{
				// Parse the filename
				var FileArray = FileResult.Data.split("|");
				var FilePath = FileArray[0];
				PropertyList.SetProperty("CalendarLastDirectory", LeftBack(FilePath, "\\"), 0);

				// Read the file into an element
				var pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				var XMLDoc = pSM.CreateTemporaryXMLDocument("Import");			
				var pBIS = CreateByteInputStreamFromFile(FilePath);
				var ImportElement = XMLDoc.CreateElementFromStream(pBIS, 0, XMLDoc.OpenRootElement());
				ImportElement.SetDeleteOnRelease();

				var RecordEnum = RecordEnumFromElement(ImportElement);

				// None to add
				if (!RecordEnum.HasMore())
					return;

				// Find out which schema version these records are
				var RecordVersion = 2;
				var TestRecord = RecordEnum.OpenNext();
				if (TestRecord.HasField("_IsRead"))
					RecordVersion = 3;
				RecordEnum.Reset();
				
				if (RecordVersion == 3)
				{			
					CalendarEngine.AddMultipleRecords(RecordEnum);
				}
				else
				{
					var RecordEnumGUID = "{B839FC20-8E46-11d3-80A2-005004D38CA2}";
					var RecordGUID = "{BD5E0420-F5AB-11d2-8D5A-0080C78F77E0}";
					var NewRecordEnumCreate = CreateUnknownEnumFromStringIIDs(RecordEnumGUID, RecordGUID);
					var TimeZoneID = CalendarView.TimeZoneID;

					while (RecordEnum.HasMore())
					{
						var OldRecord = RecordEnum.OpenNext();
						var NewRecord = CalendarEngine.RecordFactory.CreateRecord(GetSchemaName());
						NewRecord.SetField("_CreatedBy", OldRecord.OpenField("_CreatedBy"));
						NewRecord.SetField("_CreatedByURL", OldRecord.OpenField("_CreatedByURL"));
						NewRecord.SetField("Subject", OldRecord.OpenField("Subject"));
						NewRecord.SetField("Category", "");
						NewRecord.SetField("TimeZone", TimeZoneID);
						NewRecord.SetFieldAsDouble("Start", OldRecord.OpenFieldAsDouble("Start"));
						NewRecord.SetFieldAsDouble("End", OldRecord.OpenFieldAsDouble("End"));
						NewRecord.SetFieldAsElement("Description", OldRecord.OpenFieldAsElement("Description"));
						NewRecord.SetFieldAsBool("IsAllDay", OldRecord.OpenFieldAsBool("IsAllDay"));
						NewRecordEnumCreate.Add(NewRecord);
					}

					CalendarEngine.AddMultipleRecords(NewRecordEnumCreate);
				}
			}
			catch (error)
			{
				var Account = OpenAccountFromPropertyList(PropertyList);
				var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
				App.GrooveMessageBox(Window, Account, "Unable to import the specified file.  Please specify a file that has been exported from a Groove calendar tool.", "Unable to import", GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Error);	
			}
		}
	}

	function RecordEnumFromElement(i_Element)
	{
		var RecordEnumGUID = "{B839FC20-8E46-11d3-80A2-005004D38CA2}";
		var RecordGUID = "{BD5E0420-F5AB-11d2-8D5A-0080C78F77E0}";
		var RecordEnumCreate = CreateUnknownEnumFromStringIIDs(RecordEnumGUID, RecordGUID);

		var ElementEnum = i_Element.OpenContentElementEnum();

		while (ElementEnum.HasMore())
		{
			var Element = ElementEnum.OpenNext();

			var Record = GrooveScriptFunctions.CreateNewObject("Groove.Record");
			Record.CollectibleRecord.SetElement(Element);

			Element.DetachFromParent();
			Element.SetDeleteOnRelease();

			// I know there are no record relationships in the calendar, so I'll just gen a new ID
			Record.RecordID = CalendarEngine.RecordFactory.GenerateUniqueID();

			if (Record.HasField("_IsRead"))
				Record.SetField("_IsRead", false);

			RecordEnumCreate.Add(Record);
		}

		var RecordEnum = RecordEnumCreate.UnknownEnum;
		RecordEnum.Reset();

		return RecordEnum;
	}

	function DisplayError(ActionName, error)
	{
		var Account = OpenAccountFromPropertyList(PropertyList);
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		App.GrooveMessageBox(Window, Account, "Unable to " + ActionName + " because of the following error: \n" + error.description, "Error", GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Error);	
	}

	function GotoDate()
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();

		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		// set the window properties
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		WindowProperties.Resizable = false;
		WindowProperties.Caption = "Calendar";
		WindowProperties.CaptionVisible = true;
		WindowProperties.Visible = false;
		WindowProperties.CloseButton = true;
		WindowProperties.HelpButton = true;
		WindowProperties.BorderVisible = false;

		// Create the window
		var Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, GotoDateSubForm);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore | GrooveWindowMenuCommand_Size | GrooveWindowMenuCommand_Minimize | GrooveWindowMenuCommand_Maximize, false);

		// get the dispatch
		var GotoHost = Window.OpenDelegateComponent();
		var GotoCode = GotoHost.GetScriptDispatch();

		GotoCode.PutDate(CalendarView.SelectionStart);
		GotoCode.PutView(CalendarView.ViewType);

		WindowMgr.ShowWaitCursor(false);
		Window.Show(GrooveWindowShowCommand_Show);
		if (GrooveMessageBoxResultCode_OK == Window.DoModal())
		{
			HandleViewChange(GotoCode.GetView());
			var DateToGoTo = GotoCode.GetDate();
			CalendarView.SetSelection(DateToGoTo, DateToGoTo);
			CalendarView.ScrollToSelectionStart();
		}
	}

	//----------------
	// Private Helpers
	//----------------

	function GetSchemaName()
	{
		return "urn:groove.net:CalendarEntry" + g_TemplateVersion;
	}

	function DeleteSelectedEvent()
	{
		if (CalendarView.IsSelectionADate)
			return;

		if (CanDeleteRecord(CalendarView.SelectedEntry))
		{
			if (ConfirmDeleteSelectedEntry())
				RemoveCalendarRecord(CalendarView.SelectedEntry);
		}
		else
		{
			DisplayNoDeletePermissionsWindow();
		}
	}

	function ConfirmDeleteSelectedEntry()
	{
		var EntrySubject = GetSelectedEntrySubject();
		var ConfirmStr = "Are you sure you want to delete \"" + EntrySubject + "\"?  ";
		ConfirmStr += "This operation cannot be undone.";
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		var RetVal = App.GrooveMessageBox(Window, Account, ConfirmStr, "Delete Calendar Entry", GrooveMessageBoxStyle_YesNo, 256);
		if (RetVal == GrooveMessageBoxResultCode_Yes)
			return true;
		else
			return false;
	}

	function GetSelectedEntrySubject()
	{
		if (CalendarView.IsSelectionADate)
			return "";

		var SubjectStr = "";
		var RecordID = CalendarView.SelectedEntry;

		// Begin read-only Transaction
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if (CalendarEngine.HasRecord(RecordID))
			{
				var CalendarRecord = CalendarEngine.OpenRecord(RecordID);
				SubjectStr = CalendarRecord.OpenField("Subject");
			}
		}
		catch (error)
		{
		}

		Transaction.Commit();

		return SubjectStr;
	}


	// Opens a dialog prompting the user to fill out calendar entry info.
	// Fills a calendar record with that info, and adds it to the engine.
	function AddCalendarEvent()
	{
		if (!CanAddRecord())
		{
			DisplayNoAddPermissionsWindow();
			return;
		}

		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();

		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		// set the window properties
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		WindowProperties.Resizable = false;
		WindowProperties.Caption = "Calendar";
		WindowProperties.CaptionVisible = true;
		WindowProperties.Visible = false;
		WindowProperties.CloseButton = true;
		WindowProperties.HelpButton = true;
		WindowProperties.BorderVisible = false;

		// Create the window
		var Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, CalendarAddEntryDialogSubForm);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore | GrooveWindowMenuCommand_Size | GrooveWindowMenuCommand_Minimize | GrooveWindowMenuCommand_Maximize, false);

		// get the dispatch
		var AddEntryHost = Window.OpenDelegateComponent();
		var AddEntryCode = AddEntryHost.GetScriptDispatch();

		// prefill the add event form
		var Start, End, IsAllDay, UseDefaultTime;

		Start = CalendarView.SelectionStart;
		End = CalendarView.SelectionEnd;
		IsAllDay = SpansDays(Start, End);

		if (CalendarView.IsSelectionADate)
		{
			UseDefaultTime = CalendarView.IsSelectionAllDay;
			if (!UseDefaultTime)
				End += 1;
		}
		else
		{
			UseDefaultTime = true;

			var Transaction = Telespace.OpenTransaction(true);	// read only
			try
			{
				var RecordID = CalendarView.SelectedEntry;
				if (CalendarEngine.HasRecord(RecordID))
				{
					var SelectedEntryRecord = CalendarEngine.OpenRecord(RecordID);
					IsAllDay = SelectedEntryRecord.OpenField("IsAllDay");
					Start = SelectedEntryRecord.OpenField("Start");
					End = SelectedEntryRecord.OpenField("End");
					UseDefaultTime = false;
				}
			}
			catch (e) { }
			Transaction.Commit();
		}

		if (UseDefaultTime)
		{
			AddEntryCode.FillStartWithDefaultTime(Start);
			AddEntryCode.FillEndWithDefaultTime(End);
		}
		else
		{
			AddEntryCode.FillStartDateAndTime(Start);
			AddEntryCode.FillEndDateAndTime(End);			
		}

		AddEntryCode.PutIsAllDay(IsAllDay);
		AddEntryCode.CalculateEventLength();

		if (g_TemplateVersion >= 3)
		{
			AddEntryCode.ShowAuthor(GetUserName());
			AddEntryCode.HideTimeZone();
		}

		WindowMgr.ShowWaitCursor(false);

		Window.Show(GrooveWindowShowCommand_Show);
		if (GrooveMessageBoxResultCode_OK == Window.DoModal())
		{
			var AddedRecordID = -1;

			// Begin the read/write transaction
			var Transaction = Telespace.OpenTransaction(false);
			try
			{
				var CalendarRecord = CalendarEngine.RecordFactory.CreateRecord(GetSchemaName());
				var TimeZoneID = CalendarView.TimeZoneID;
				AddEntryCode.FillCalendarRecord(CalendarRecord, TimeZoneID);
				CalendarRecord.SetField("TimeZone", TimeZoneID);

				CalendarEngine.AddRecord(CalendarRecord);

				AddedRecordID = CalendarRecord.RecordID;

				Transaction.Commit();
			}
			catch (e)
			{
				Transaction.Abort();
			}

			if (AddedRecordID != -1)
				CalendarView.ScrollToEntry(AddedRecordID);
		}
		Window.Destroy();
	}

	function GetUserName()
	{
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var CurrentIdentity = Telespace.OpenCurrentIdentity();
		var CurrentIdentityContact = CurrentIdentity.Contact;
		return OpenFullNameFromContact(CurrentIdentityContact);
	}

	function DisplayNoAddPermissionsWindow()
	{
		var MessageStr = "You do not have permission to add entries to this calendar.";
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, MessageStr, "Unable to Add Entry", GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
	}

	function DisplayNoDeletePermissionsWindow()
	{
		var MessageStr = "You do not have permission to delete this entry from the calendar.";
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, MessageStr, "Unable to Delete Entry", GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
	}

	function DisplayNoCutPermissionsWindow()
	{
		var MessageStr = "You do not have permission to delete this entry from the calendar, but the it has been copied to the clipboard.";
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, MessageStr, "Unable to Cut Entry", GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
	}

	// Opens a dialog prompting the user to fill out calendar entry info.
	// Fills a calendar record with that info, and adds it to the engine.
	function EditCalendarEvent(i_RecordID)
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();

		if (g_TemplateVersion >= 3)
			MarkRecordRead(i_RecordID, true);

		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		// set the window properties
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		WindowProperties.Resizable = false;
		WindowProperties.Caption = "Calendar";
		WindowProperties.CaptionVisible = true;
		WindowProperties.Visible = false;
		WindowProperties.CloseButton = true;
		WindowProperties.HelpButton = true;
		WindowProperties.BorderVisible = false;

		// Create the window
		var Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, CalendarAddEntryDialogSubForm);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore | GrooveWindowMenuCommand_Size | GrooveWindowMenuCommand_Minimize | GrooveWindowMenuCommand_Maximize, false);

		// get the dispatch
		var AddEntryHost = Window.OpenDelegateComponent();
		var AddEntryCode = AddEntryHost.GetScriptDispatch();

		var Failed = false;
		var ClonedRecord = null;

		// Begin the read only transaction
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if (CalendarEngine.HasRecord(i_RecordID))
			{
				var CalendarRecord = CalendarEngine.OpenRecord(i_RecordID);
				ClonedRecord = CalendarRecord.Clone();
				Transaction.Commit();
			}
			else
			{
				Transaction.Abort();
				Failed = true;
			}
		}
		catch (e)
		{
			Transaction.Abort();
			Failed = true;
		}
		
		if (Failed)
		{
			// Asynchronously destroy the window
			Window.Destroy(GrooveWindowResult_Cancel, true);
			WindowMgr.ShowWaitCursor(false);
			return;
		}

		AddEntryCode.PrefillFormFromRecord(ClonedRecord, CalendarView.TimeZoneID);

		var Editing = CanEditRecord(i_RecordID);

		if (Editing)
			AddEntryCode.EnableAll();
		else
			AddEntryCode.DisableAll();

		if (g_TemplateVersion >= 3)
			AddEntryCode.ShowAuthor(ClonedRecord.OpenField("_CreatedBy"));

		WindowMgr.ShowWaitCursor(false);

		Window.Show(GrooveWindowShowCommand_Show);
		if (GrooveMessageBoxResultCode_OK == Window.DoModal())
		{
			if (Editing)
			{
				AddEntryCode.FillCalendarRecord(ClonedRecord, CalendarView.TimeZoneID);
				ReplaceCalendarRecord(ClonedRecord);
			}
		}
		Window.Destroy();
	}

	// Updates the text title of the calendar. i.e. "July 2000"
	function UpdateCalendarTitle()
	{	
		var View = CalendarView.ViewType;
		var TitleType;
		
		switch (CalendarView.ViewType)
		{
		case GrooveCalendarViewType_Day:
			// show single date
			var TitleText = FormatDate(CalendarView.StartDate, GrooveIntlDateFormatStyle_Full);
			CalendarTitle.SetText(TitleText);
			break;

		case GrooveCalendarViewType_Month:
		case GrooveCalendarViewType_MonthWithStackedWeekends:
			// show month and year
			CalendarTitle.SetText(CalendarView.GridMonthName + " " + CalendarView.GridYearNum);
			break;

		case GrooveCalendarViewType_TwoDay:
		case GrooveCalendarViewType_NormalWeek:
		case GrooveCalendarViewType_FamilyWeek:
		case GrooveCalendarViewType_WideWeek:
		case GrooveCalendarViewType_TwoRowWorkWeek:
		case GrooveCalendarViewType_WorkWeek:
		default:
			// show date range
			var TitleText = FormatDate(CalendarView.StartDate, GrooveIntlDateFormatStyle_Medium);
			TitleText += " - " + FormatDate(CalendarView.EndDate, GrooveIntlDateFormatStyle_Medium);
			CalendarTitle.SetText(TitleText);
			break;
		}
	}

	//---------------------------------------------------------
	// FollowMe Helpers
	//---------------------------------------------------------

	function HandleScrollPrev()
	{
		CalendarSubFormCode.SetFocus();
		CalendarView.ScrollPrev();

		if (g_InFollowMode)
			PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
	}

	function HandleScrollToToday()
	{
		CalendarSubFormCode.SetFocus();
		CalendarView.ScrollToToday();

		if (g_InFollowMode)
			PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
	}

	function HandleScrollNext()
	{
		CalendarSubFormCode.SetFocus();
		CalendarView.ScrollNext();

		if (g_InFollowMode)
			PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
	}

	function HandleViewChange(i_ViewType)
	{
		if (g_TemplateVersion >= 3)
			EnablePreviewForView(i_ViewType);

		CalendarSubFormCode.SetFocus();
		CalendarView.ViewType = i_ViewType;

		if (g_InFollowMode)
		{
			PropertyList.SetProperty("FollowMode_ViewType", i_ViewType);
			PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
		}
	}

	function ProcessViewTypeFromPropertyList(i_ViewType)
	{
		CalendarView.ViewType = new Number(i_ViewType);
	}

	function ProcessStartDateFromPropertyList(i_ScrollPosition)
	{
		CalendarView.ScrollPosition = i_ScrollPosition;
	}

	//-----------------------------------------------------------
	// TelespaceIdentityPropertyList
	//-----------------------------------------------------------

	function TelespaceIdentityPropertyListOnPropertyChanged(i_Key, i_Value, i_LocallyGenerated)
	{
		// Is this the follow mode state changing?
		if (i_Key == "ToolNavigationMode")
		{
			g_InFollowMode = (i_Value == "0") ? false : true;

			if (g_InFollowMode)
			{
				// We are going into follow mode; navigate to the current month/view format if we are ui active
				if (PropertyList.PropertyExists("FollowMode_ViewType"))
				{
					if (g_UIActive)
						ProcessViewTypeFromPropertyList(PropertyList.OpenProperty("FollowMode_ViewType"));
				}
				else
					PropertyList.SetProperty("FollowMode_ViewType", CalendarView.ViewType);
					
				if (PropertyList.PropertyExists("FollowMode_StartDate"))
				{
					if (g_UIActive)
						ProcessStartDateFromPropertyList(PropertyList.OpenProperty("FollowMode_StartDate"));
				}
				else
					PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
			}								
		}
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  @             †        ˘     ∞{  ∞{                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ®               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   i   ÄName,   G r o o v e C a l e n d a r G l u e . g s l   r       ÄSCRIPT     ÄSCRIPT     ÄSCRIPT   
  ÄIMPLEMENTS  PT    ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       & F  ÄSCRIPT       ÄSRC   h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e C a l e n d a r H e l p e r _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   rd    o r
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }   =   ÄIIDL   { 5 1 B F 8 1 E 1 - 6 D E 7 - 1 1 D 2 - 9 4 6 1 - 0 0 8 0 C 7 D E 3 2 C 6 }   e       ÄSCRIPT  RIPT   ÄSCRIPT         [ Ä
			function OnNavigate(i_pIURLNavigator, i_URL, i_bAddToHistory)
			{
				var pURL = GROOVE_GLOBAL_MISC_POINTER.OpenURI(i_URL);
				if (pURL.DoesQueryPartExist("RecordID"))
				{
					var RecordID = pURL.OpenQueryPart("RecordID");
					CalendarView.ScrollToEntry(RecordID);
				}
				ActivateDefaultView(PropertyList);
				var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
				var Tool = PropertyList.OpenProperty(PROPERTY_TOOL);
				var Name = Tool.DisplayName;
				i_pIURLNavigator.SetCurrentURL(i_URL, Telespace.DisplayName + " - " + Name, Name, i_bAddToHistory);
			}
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Pv   ‹·            8E   å U     “          )      ÄSCRIPT         b} Ä

	var GrooveCalendarCommand_Import            = 201;
	var GrooveCalendarCommand_ExportSelected    = 202;
	var GrooveCalendarCommand_ExportAll         = 203;
	var GrooveCalendarCommand_TogglePreviewPane = 204;

	var pBundle = PropertyList.OpenProperty(PROPERTY_RESOURCE_BUNDLE);

	//---------------
	// Public Methods
	//---------------

	function CreateCalendarRecord()
	{
		return CalendarEngine.RecordFactory.CreateRecord(GetSchemaName());
	}

	function AddCalendarRecord(i_CalendarRecord)
	{
		CalendarEngine.AddRecord(i_CalendarRecord);
	}

	function ReplaceCalendarRecord(i_Record)
	{
		// Begin the read/write transaction
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if (CalendarEngine.HasRecord(i_Record.RecordID))
				CalendarEngine.ReplaceRecord(i_Record.RecordID, i_Record);
			else
				CalendarEngine.AddRecord(i_Record);

			Transaction.Commit();
		}
		catch (e)
		{
			Transaction.Abort();
		}
	}

	function RemoveCalendarRecord(i_RecordID)
	{										
		// Begin the read/write transaction
		var Transaction = Telespace.OpenTransaction(false);
		try
		{
			if (CalendarEngine.HasRecord(i_RecordID))
			{
				CalendarEngine.RemoveRecord(i_RecordID);
				Transaction.Commit();
				return true;
			}
			else
			{
				Transaction.Abort();
				return false;
			}
		}
		catch(e)
		{
			Transaction.Abort();
			return false;
		}
	}

	function GetCurrentTimeZoneID()
	{
		return CalendarView.TimeZoneID;
	}

	function GetVersion()
	{
		return g_TemplateVersion;
	}

	function GetRecordEnum()
	{
		return CalendarEngine.OpenRecordEnum();
	}

	function OpenRecordEnumForRange(i_Start, i_End)
	{
		var RecordEnumGUID = "{B839FC20-8E46-11d3-80A2-005004D38CA2}";
		var RecordGUID = "{BD5E0420-F5AB-11d2-8D5A-0080C78F77E0}";

		var pRecordEnum = GROOVE_GLOBAL_MISC_POINTER.EnumFactory.CreateUnknownEnumFromStringIIDs(RecordEnumGUID, RecordGUID);
		var pRecordsInRange = pRecordEnum.UnknownEnumCreate;

		var pAllRecords = GetRecordEnum();
		while (pAllRecords.HasMore())
		{
			var pRecord = pAllRecords.OpenNext();
			var RecordStart = pRecord.OpenField("Start");
			var RecordEnd   = pRecord.OpenField("End");
			
			if (RecordStart <= i_End && RecordEnd >= i_Start)
				pRecordsInRange.Add(pRecord);
		}

		return pRecordsInRange;
	}

	//----------------------
	// Common Initialization
	//----------------------

	// will hold components
	var CalendarView, CalendarEngine, CalendarSubFormCode, Telespace;

	var g_pTelespaceIdentityPropertyList;
	var g_InFollowMode;
	var g_UIActive;
	var g_TemplateVersion;

	function CommonInitialize(i_TemplateVersion)
	{
		g_TemplateVersion = i_TemplateVersion;

		// Get and connect to Calendar View and Engine
		var CalendarSubFormHost = CalendarSubForm.OpenDelegateComponent();
		CalendarSubFormCode = CalendarSubFormHost.GetScriptDispatch();
		CalendarView = CalendarSubFormCode.OpenCalendarView();
		CalendarEngine = CalendarSubFormCode.OpenCalendarEngine();
		ConnectObject(CalendarView,"CalendarView_");
		ConnectObject(CalendarEngine,"CalendarEngine_");

		Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);

		// Open and connect to our various property list
		g_pTelespaceIdentityPropertyList = CreateOrOpenPropertyList(PropertyList, Telespace, 0, 1, 
																	ScriptHostComponent,
																	"TelespaceIdentityPropertyList", true);

		// Is follow mode on?
		if (g_pTelespaceIdentityPropertyList.PropertyExists("ToolNavigationMode"))
		{
			g_InFollowMode = g_pTelespaceIdentityPropertyList.OpenPropertyAsLong("ToolNavigationMode");
		}
		else
		{
			var TelespacePropertyList = CreateOrOpenPropertyList(PropertyList, Telespace, 0, 3, ScriptHostComponent, "", false);
			if (TelespacePropertyList != null)
			{
				if (TelespacePropertyList.PropertyExists("ToolNavigationMode"))
					g_InFollowMode = TelespacePropertyList.OpenPropertyAsLong("ToolNavigationMode");
			}		
		}

		if (PropertyList.PropertyExists("CalendarLastDirectory") == false)
			PropertyList.SetProperty("CalendarLastDirectory", "c:\\", 0);
	}

	function CommonTerminate()
	{
		DisconnectObject(CalendarView);
		DisconnectObject(CalendarEngine);
		DisconnectObject(g_pTelespaceIdentityPropertyList);
	}

	function CommonSetUIProperties()
	{
		UpdateCalendarTitle();

		g_UIActive = true;

		if (g_InFollowMode)
		{
			// Navigate to the follow mode properties
			if (PropertyList.PropertyExists("FollowMode_ViewType"))
				ProcessViewTypeFromPropertyList(PropertyList.OpenProperty("FollowMode_ViewType"));
			if (PropertyList.PropertyExists("FollowMode_StartDate"))
				ProcessStartDateFromPropertyList(PropertyList.OpenProperty("FollowMode_StartDate"));
		}

		CalendarSubFormCode.SetFocus();
	}

	function CommonRevokeUIProperties()
	{
		g_UIActive = false;
	}

	function CommonPropertyChanged(i_Key, i_Value, i_LocallyGenerated)
	{
		if (i_Key == "FollowMode_ViewType")
		{
			if (g_InFollowMode && g_UIActive && !i_LocallyGenerated)
				ProcessViewTypeFromPropertyList(i_Value);
		}
		else if (i_Key == "FollowMode_StartDate")
		{
			if (g_InFollowMode && g_UIActive && !i_LocallyGenerated)
				ProcessStartDateFromPropertyList(i_Value);
		}
	}

	function OnCalendarCommand(i_CalendarCommand)
	{
		switch (i_CalendarCommand)
		{
			case GrooveCalendarCommand_NewEntry:
				AddCalendarEvent();
				break;
			case GrooveCalendarCommand_ScrollNext:
				HandleScrollNext();
				break;
			case GrooveCalendarCommand_ScrollPrev:
				HandleScrollPrev();
				break;
			case GrooveCalendarCommand_ScrollToday:
				HandleScrollToToday();
				break;
			case GrooveCalendarCommand_DayView:
				HandleViewChange(GrooveCalendarViewType_Day);
				break;
			case GrooveCalendarCommand_WeekView:
				HandleViewChange(GrooveCalendarViewType_FamilyWeek);
				break;
			case GrooveCalendarCommand_MonthView:
				HandleViewChange(GrooveCalendarViewType_Month);
				break;
			case GrooveCalendarCommand_BusinessWeekView:
				HandleViewChange(GrooveCalendarViewType_NormalWeek);
				break;
			case GrooveCalendarCommand_BusinessMonthView:
				HandleViewChange(GrooveCalendarViewType_MonthWithStackedWeekends);
				break;
  			case GrooveCalendarCommand_Paste:
				Paste();
				break;
			case GrooveCalendarCommand_OpenDetail:
				EditCalendarEvent(CalendarView.SelectedEntry);
				break;
			case GrooveCalendarCommand_Copy:
				Copy();
				break;
			case GrooveCalendarCommand_CopyAsLink:
				CopyAsLink();
				break;
			case GrooveCalendarCommand_Delete:
				DeleteSelectedEvent();
				break;
			case GrooveCalendarCommand_Cut:
				Cut();
				break;
			case GrooveCalendarCommand_MarkRead:
				if (g_TemplateVersion >= 3)
					MarkRecordRead(CalendarView.SelectedEntry, true);
				break;
			case GrooveCalendarCommand_MarkUnread:
				if (g_TemplateVersion >= 3)
					MarkRecordRead(CalendarView.SelectedEntry, false);
				break;
			case GrooveCalendarCommand_MarkAllRead:
				if (g_TemplateVersion >= 3)
					MarkAllRead(true);
				break;
			case GrooveCalendarCommand_MarkAllUnread:
				if (g_TemplateVersion >= 3)
					MarkAllRead(false);
				break;

			case GrooveCalendarCommand_Import:
				if (g_TemplateVersion >= 3)
					Import();
				break;

			case GrooveCalendarCommand_ExportSelected:
				Export(false);
				break;

			case GrooveCalendarCommand_ExportAll:
				Export(true);
				break;

			case GrooveCalendarCommand_GoToDate:
				GotoDate();
				break;

			case GrooveCalendarCommand_TogglePreviewPane:
				if (g_TemplateVersion >= 3)
					TogglePreviewPane();
				break;

			// Not implemented
			//case GrooveCalendarCommand_SaveAs:
			//case GrooveCalendarCommand_Undo:
			//case GrooveCalendarCommand_Redo:
		}

		CalendarSubFormCode.SetFocus();
	}

	//------------------
	// Clipboard Support
	//------------------

	function Cut()
	{
		if (CalendarView.IsSelectionADate)
			return;

		Copy();

		if (CanDeleteRecord(CalendarView.SelectedEntry))
			RemoveCalendarRecord(CalendarView.SelectedEntry);
		else
			DisplayNoCutPermissionsWindow();
	}

	function Copy()
	{
		if (CalendarView.IsSelectionADate)
			return;

		SetClipboardEmpty();
		var RecordIDEnum = CreateDoubleEnum();
		RecordIDEnum.Add(CalendarView.SelectedEntry);

		CopyRecordsToClipboard(RecordIDEnum, CalendarEngine, GetSchemaName(), GetString(pBundle, "Cal_MB_ERR"));
		CopySelectedEntryAsText();
	}

	function CopyAsLink()
	{
		if (CalendarView.IsSelectionADate)
			return;

		var Subject = GetSelectedEntrySubject();
		if (Subject != "")
		{
			var CanonicalURL = PropertyList.OpenProperty(PROPERTY_CANONICAL_URL);
			var pURL = GROOVE_GLOBAL_MISC_POINTER.OpenURI(CanonicalURL);
			pURL.SetQueryPart("RecordID", CalendarView.SelectedEntry);
			SetClipboardEmpty();
			CopyAsLinkToClipboard(pURL.String, Subject);
		}
	}

	function Paste()
	{
		var pUIManager = GrooveScriptFunctions.CreateNewObject("Groove.UIManager");
		var pClipboard = pUIManager.OpenClipboard();
		if (pClipboard.IsDataAvailable(GetSchemaName()))
		{
			if (CanAddRecord())
			{
				var RecordEnum = PasteRecordsFromClipboard(GetSchemaName(), CalendarEngine, false);
				PrepareEnumForPaste(RecordEnum);
				CalendarEngine.AddMultipleRecords(RecordEnum);
			}
			else
			{
				DisplayNoAddPermissionsWindow();
			}
		}
	}

	function CopySelectedEntryAsText()
	{
		var RecordID = CalendarView.SelectedEntry;

		// Begin read-only Transaction
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if (CalendarEngine.HasRecord(RecordID))
			{
				var CalendarRecord = CalendarEngine.OpenRecord(RecordID);
				var ClipboardText = CalendarRecordToText(CalendarRecord);
				SetClipboardEmpty();
				CopyTextToClipboard(ClipboardText);
			}
		}
		catch (error)
		{
		}

		Transaction.Commit();
	}

	function CalendarRecordToText(i_CalendarRecord)
	{
		var Text = i_CalendarRecord.OpenField("Subject");
		Text += "\r\n";

		var Start = i_CalendarRecord.OpenField("Start");
		var End = i_CalendarRecord.OpenField("End");
		var SpansDays = SpansDays(Start, End);
		var IsAllDay = i_CalendarRecord.OpenField("IsAllDay");

		Text += FormatDate(Start, GrooveIntlDateFormatStyle_Full);

		if (!IsAllDay)
		{
			Text += " " + FormatTime(Start) + " - ";

			// Include the end date as well
			if (SpansDays)
				Text += FormatDate(End, GrooveIntlDateFormatStyle_Full) + " ";

			Text += FormatTime(End);
		}
		
		else if (SpansDays)
		{
			Text += " - " + FormatDate(End, GrooveIntlDateFormatStyle_Full);
		}

		return Text;
	}

	function PrepareEnumForPaste(i_RecordEnum)
	{
		while (i_RecordEnum.HasMore())
		{
			var Record = i_RecordEnum.OpenNext();
			SetPasteDate(Record);
			TakeOwnership(Record);
		}
		i_RecordEnum.Reset();
	}

	function SetPasteDate(i_Record)
	{
		var Start = i_Record.OpenField("Start");
		var End = i_Record.OpenField("End");

		var Length = End - Start;
		if (CalendarView.IsSelectionAllDay)
		{
			var SelectionCal = CreateCalendar(CalendarView.SelectionStart);
			var Year = SelectionCal.Get(GrooveIntlCalendarField_Year);
			var Month = SelectionCal.Get(GrooveIntlCalendarField_Month);
			var Day = SelectionCal.Get(GrooveIntlCalendarField_DayOfMonth);

			var EntryCal = CreateCalendar(Start);
			EntryCal.SetDate(Year, Month, Day);

			Start = EntryCal.DateTime.RawDateTime;
		}
		else
		{
			Start = CalendarView.SelectionStart;
		}

		End = Start + Length;
	
		i_Record.SetField("Start", Start);
		i_Record.SetField("End", End);
	}

	function TakeOwnership(i_Record)
	{
		var pCurrIdent = Telespace.OpenCurrentIdentity();
		var UserName = OpenFullNameFromContact(pCurrIdent.Contact);
		var UserURL = pCurrIdent.URL();

		i_Record.SetField("_CreatedBy", UserName);
		i_Record.SetField("_CreatedByURL", UserURL);
		if (GetVersion() >= 3)
			i_Record.SetField("TimeZone", CalendarView.TimeZoneID);
	}

	function Export(i_AllRecords)
	{
		var RecordIDEnum;

		if (i_AllRecords)
		{
			RecordIDEnum = CalendarEngine.OpenRecordIDEnum();
		}
		else
		{
			var RecordIDEnum = CreateDoubleEnum();
			RecordIDEnum.Add(CalendarView.SelectedEntry);
		}

		ExportRecordsToFile(RecordIDEnum, CalendarEngine, PropertyList, "Calendar");
	}


	function Import()
	{
		// Don't import until version 3
		if (g_TemplateVersion < 3)
			return;

		var FileResult;

		try
		{
			var Account = OpenAccountFromPropertyList(PropertyList);
			var strLastDirectory = PropertyList.OpenProperty("CalendarLastDirectory");
			FileResult = App.OpenFileDialog(GetString(pBundle, "Cal_MB_IMPTTL"), GetString(pBundle, "System_XMLFILTER"), strLastDirectory, "", Account, 1, false);
		}
		catch (error)
		{
			DisplayError("import", error);
			return;
		}

		if (GrooveDialogBoxResultCode_OK == FileResult.Result)
		{
			try
			{
				// Parse the filename
				var FileArray = FileResult.Data.split("|");
				var FilePath = FileArray[0];
				PropertyList.SetProperty("CalendarLastDirectory", LeftBack(FilePath, "\\"), 0);

				// Read the file into an element
				var pSM = GrooveScriptFunctions.CreateNewObject("Groove.StorageManager");
				var XMLDoc = pSM.CreateTemporaryXMLDocument("Import");			
				var pBIS = CreateByteInputStreamFromFile(FilePath);
				var ImportElement = XMLDoc.CreateElementFromStream(pBIS, 0, XMLDoc.OpenRootElement());
				ImportElement.SetDeleteOnRelease();

				var RecordEnum = RecordEnumFromElement(ImportElement);

				// None to add
				if (!RecordEnum.HasMore())
					return;

				// Find out which schema version these records are
				var RecordVersion = 2;
				var TestRecord = RecordEnum.OpenNext();
				if (TestRecord.HasField("_IsRead"))
					RecordVersion = 3;
				RecordEnum.Reset();
				
				if (RecordVersion == 3)
				{			
					CalendarEngine.AddMultipleRecords(RecordEnum);
				}
				else
				{
					var RecordEnumGUID = "{B839FC20-8E46-11d3-80A2-005004D38CA2}";
					var RecordGUID = "{BD5E0420-F5AB-11d2-8D5A-0080C78F77E0}";
					var NewRecordEnumCreate = CreateUnknownEnumFromStringIIDs(RecordEnumGUID, RecordGUID);
					var TimeZoneID = CalendarView.TimeZoneID;

					while (RecordEnum.HasMore())
					{
						var OldRecord = RecordEnum.OpenNext();
						var NewRecord = CalendarEngine.RecordFactory.CreateRecord(GetSchemaName());
						NewRecord.SetField("_CreatedBy", OldRecord.OpenField("_CreatedBy"));
						NewRecord.SetField("_CreatedByURL", OldRecord.OpenField("_CreatedByURL"));
						NewRecord.SetField("Subject", OldRecord.OpenField("Subject"));
						NewRecord.SetField("Category", "");
						NewRecord.SetField("TimeZone", TimeZoneID);
						NewRecord.SetFieldAsDouble("Start", OldRecord.OpenFieldAsDouble("Start"));
						NewRecord.SetFieldAsDouble("End", OldRecord.OpenFieldAsDouble("End"));
						NewRecord.SetFieldAsElement("Description", OldRecord.OpenFieldAsElement("Description"));
						NewRecord.SetFieldAsBool("IsAllDay", OldRecord.OpenFieldAsBool("IsAllDay"));
						NewRecordEnumCreate.Add(NewRecord);
					}

					CalendarEngine.AddMultipleRecords(NewRecordEnumCreate);
				}
			}
			catch (error)
			{
				var Account = OpenAccountFromPropertyList(PropertyList);
				var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
				App.GrooveMessageBox(Window, Account, GetString(pBundle, "Cal_MB_UNADSC"), GetString(pBundle, "Cal_MB_UNATTL"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Error);	
			}
		}
	}

	function RecordEnumFromElement(i_Element)
	{
		var RecordEnumGUID = "{B839FC20-8E46-11d3-80A2-005004D38CA2}";
		var RecordGUID = "{BD5E0420-F5AB-11d2-8D5A-0080C78F77E0}";
		var RecordEnumCreate = CreateUnknownEnumFromStringIIDs(RecordEnumGUID, RecordGUID);

		var ElementEnum = i_Element.OpenContentElementEnum();

		while (ElementEnum.HasMore())
		{
			var Element = ElementEnum.OpenNext();

			var Record = GrooveScriptFunctions.CreateNewObject("Groove.Record");
			Record.CollectibleRecord.SetElement(Element);

			Element.DetachFromParent();
			Element.SetDeleteOnRelease();

			// I know there are no record relationships in the calendar, so I'll just gen a new ID
			Record.RecordID = CalendarEngine.RecordFactory.GenerateUniqueID();

			if (Record.HasField("_IsRead"))
				Record.SetField("_IsRead", false);

			RecordEnumCreate.Add(Record);
		}

		var RecordEnum = RecordEnumCreate.UnknownEnum;
		RecordEnum.Reset();

		return RecordEnum;
	}

	function DisplayError(ActionName, error)
	{
		var Account = OpenAccountFromPropertyList(PropertyList);
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		App.GrooveMessageBox(Window, Account, SubstituteArrayValuesInString(GetString(pBundle, "Cal_MB_UNADSC"), new Array(ActionName, error.description)), GetString(pBundle, "Cal_MB_UNETTL"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Error);	
	}

	function GotoDate()
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();

		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		// set the window properties
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		WindowProperties.Resizable = false;
		WindowProperties.Caption = "Calendar";
		WindowProperties.CaptionVisible = true;
		WindowProperties.Visible = false;
		WindowProperties.CloseButton = true;
		WindowProperties.HelpButton = true;
		WindowProperties.BorderVisible = false;

		// Create the window
		var Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, GotoDateSubForm);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore | GrooveWindowMenuCommand_Size | GrooveWindowMenuCommand_Minimize | GrooveWindowMenuCommand_Maximize, false);

		// get the dispatch
		var GotoHost = Window.OpenDelegateComponent();
		var GotoCode = GotoHost.GetScriptDispatch();

		GotoCode.PutDate(CalendarView.SelectionStart);
		GotoCode.PutView(CalendarView.ViewType);

		WindowMgr.ShowWaitCursor(false);
		Window.Show(GrooveWindowShowCommand_Show);
		if (GrooveMessageBoxResultCode_OK == Window.DoModal())
		{
			HandleViewChange(GotoCode.GetView());
			var DateToGoTo = GotoCode.GetDate();
			CalendarView.SetSelection(DateToGoTo, DateToGoTo);
			CalendarView.ScrollToSelectionStart();
		}
		Window.Destroy();
	}

	//----------------
	// Private Helpers
	//----------------

	function GetSchemaName()
	{
		return "urn:groove.net:CalendarEntry" + g_TemplateVersion;
	}

	function DeleteSelectedEvent()
	{
		if (CalendarView.IsSelectionADate)
			return;

		if (CanDeleteRecord(CalendarView.SelectedEntry))
		{
			if (ConfirmDeleteSelectedEntry())
				RemoveCalendarRecord(CalendarView.SelectedEntry);
		}
		else
		{
			DisplayNoDeletePermissionsWindow();
		}
	}

	function ConfirmDeleteSelectedEntry()
	{
		var EntrySubject = GetSelectedEntrySubject();
		var ConfirmStr = SubstituteArrayValuesInString(GetString(pBundle, "Cal_MB_DELDSC"), new Array(EntrySubject));
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		var RetVal = App.GrooveMessageBox(Window, Account, ConfirmStr, GetString(pBundle, "Cal_MB_DELTTL"), GrooveMessageBoxStyle_YesNo, 256);
		if (RetVal == GrooveMessageBoxResultCode_Yes)
			return true;
		else
			return false;
	}

	function GetSelectedEntrySubject()
	{
		if (CalendarView.IsSelectionADate)
			return "";

		var SubjectStr = "";
		var RecordID = CalendarView.SelectedEntry;

		// Begin read-only Transaction
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if (CalendarEngine.HasRecord(RecordID))
			{
				var CalendarRecord = CalendarEngine.OpenRecord(RecordID);
				SubjectStr = CalendarRecord.OpenField("Subject");
			}
		}
		catch (error)
		{
		}

		Transaction.Commit();

		return SubjectStr;
	}


	// Opens a dialog prompting the user to fill out calendar entry info.
	// Fills a calendar record with that info, and adds it to the engine.
	function AddCalendarEvent()
	{
		if (!CanAddRecord())
		{
			DisplayNoAddPermissionsWindow();
			return;
		}

		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();

		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		// set the window properties
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		WindowProperties.Resizable = false;
		WindowProperties.Caption = "Calendar";
		WindowProperties.CaptionVisible = true;
		WindowProperties.Visible = false;
		WindowProperties.CloseButton = true;
		WindowProperties.HelpButton = true;
		WindowProperties.BorderVisible = false;

		// Create the window
		var Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, CalendarAddEntryDialogSubForm);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore | GrooveWindowMenuCommand_Size | GrooveWindowMenuCommand_Minimize | GrooveWindowMenuCommand_Maximize, false);

		// get the dispatch
		var AddEntryHost = Window.OpenDelegateComponent();
		var AddEntryCode = AddEntryHost.GetScriptDispatch();

		// prefill the add event form
		var Start, End, IsAllDay, UseDefaultTime;

		Start = CalendarView.SelectionStart;
		End = CalendarView.SelectionEnd;
		IsAllDay = SpansDays(Start, End);

		if (CalendarView.IsSelectionADate)
		{
			UseDefaultTime = CalendarView.IsSelectionAllDay;
			if (!UseDefaultTime)
				End += 1;
		}
		else
		{
			UseDefaultTime = true;

			var Transaction = Telespace.OpenTransaction(true);	// read only
			try
			{
				var RecordID = CalendarView.SelectedEntry;
				if (CalendarEngine.HasRecord(RecordID))
				{
					var SelectedEntryRecord = CalendarEngine.OpenRecord(RecordID);
					IsAllDay = SelectedEntryRecord.OpenField("IsAllDay");
					Start = SelectedEntryRecord.OpenField("Start");
					End = SelectedEntryRecord.OpenField("End");
					UseDefaultTime = false;
				}
			}
			catch (e) { }
			Transaction.Commit();
		}

		if (UseDefaultTime)
		{
			AddEntryCode.FillStartWithDefaultTime(Start);
			AddEntryCode.FillEndWithDefaultTime(End);
		}
		else
		{
			AddEntryCode.FillStartDateAndTime(Start);
			AddEntryCode.FillEndDateAndTime(End);			
		}

		AddEntryCode.PutIsAllDay(IsAllDay);
		AddEntryCode.CalculateEventLength();

		if (g_TemplateVersion >= 3)
		{
			AddEntryCode.ShowAuthor(GetUserName());
			AddEntryCode.HideTimeZone();
		}

		WindowMgr.ShowWaitCursor(false);

		Window.Show(GrooveWindowShowCommand_Show);
		if (GrooveMessageBoxResultCode_OK == Window.DoModal())
		{
			var AddedRecordID = -1;

			// Begin the read/write transaction
			var Transaction = Telespace.OpenTransaction(false);
			try
			{
				var CalendarRecord = CalendarEngine.RecordFactory.CreateRecord(GetSchemaName());
				var TimeZoneID = CalendarView.TimeZoneID;
				AddEntryCode.FillCalendarRecord(CalendarRecord, TimeZoneID);
				CalendarRecord.SetField("TimeZone", TimeZoneID);

				CalendarEngine.AddRecord(CalendarRecord);

				AddedRecordID = CalendarRecord.RecordID;

				Transaction.Commit();
			}
			catch (e)
			{
				Transaction.Abort();
			}

			if (AddedRecordID != -1)
				CalendarView.ScrollToEntry(AddedRecordID);
		}
		Window.Destroy();
	}

	function GetUserName()
	{
		var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
		var CurrentIdentity = Telespace.OpenCurrentIdentity();
		var CurrentIdentityContact = CurrentIdentity.Contact;
		return OpenFullNameFromContact(CurrentIdentityContact);
	}

	function DisplayNoAddPermissionsWindow()
	{
		var MessageStr = GetString(pBundle, "Cal_MB_APMDSC");
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, MessageStr, GetString(pBundle, "Cal_MB_APMTTL"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
	}

	function DisplayNoDeletePermissionsWindow()
	{
		var MessageStr = GetString(pBundle, "Cal_MB_DPMDSC");
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, MessageStr, GetString(pBundle, "Cal_MB_DPMTTL"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
	}

	function DisplayNoCutPermissionsWindow()
	{
		var MessageStr = GetString(pBundle, "Cal_MB_CPMDSC");
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var Account = OpenAccountFromPropertyList(PropertyList);
		App.GrooveMessageBox(Window, Account, MessageStr, GetString(pBundle, "Cal_MB_CPMTTL"), GrooveMessageBoxStyle_OK, GrooveMessageBoxIcon_Exclamation);
	}

	// Opens a dialog prompting the user to fill out calendar entry info.
	// Fills a calendar record with that info, and adds it to the engine.
	function EditCalendarEvent(i_RecordID)
	{
		var WindowMgr = GrooveScriptFunctions.CreateNewObject("Groove.WindowManager");
		WindowMgr.ShowWaitCursor();

		if (g_TemplateVersion >= 3)
			MarkRecordRead(i_RecordID, true);

		var WindowAccount = UIPropertyList.OpenProperty(UIPROPERTY_WINDOW_ACCOUNT);

		// set the window properties
		var WindowProperties = GrooveScriptFunctions.CreateNewObject("Groove.WindowProperties");
		WindowProperties.Style = "PopupWindow";
		WindowProperties.ParentWindow = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		WindowProperties.Resizable = false;
		WindowProperties.Caption = "Calendar";
		WindowProperties.CaptionVisible = true;
		WindowProperties.Visible = false;
		WindowProperties.CloseButton = true;
		WindowProperties.HelpButton = true;
		WindowProperties.BorderVisible = false;

		// Create the window
		var Window = WindowMgr.CreateGrooveWindowForForm(WindowAccount, "", WindowProperties, CalendarAddEntryDialogSubForm);
		Window.ShowWindowMenuCommands(GrooveWindowMenuCommand_Restore | GrooveWindowMenuCommand_Size | GrooveWindowMenuCommand_Minimize | GrooveWindowMenuCommand_Maximize, false);

		// get the dispatch
		var AddEntryHost = Window.OpenDelegateComponent();
		var AddEntryCode = AddEntryHost.GetScriptDispatch();

		var Failed = false;
		var ClonedRecord = null;

		// Begin the read only transaction
		var Transaction = Telespace.OpenTransaction(true);
		try
		{
			if (CalendarEngine.HasRecord(i_RecordID))
			{
				var CalendarRecord = CalendarEngine.OpenRecord(i_RecordID);
				ClonedRecord = CalendarRecord.Clone();
				Transaction.Commit();
			}
			else
			{
				Transaction.Abort();
				Failed = true;
			}
		}
		catch (e)
		{
			Transaction.Abort();
			Failed = true;
		}
		
		if (Failed)
		{
			// Asynchronously destroy the window
			Window.Destroy(GrooveWindowResult_Cancel, true);
			WindowMgr.ShowWaitCursor(false);
			return;
		}

		var NullObj = GrooveScriptFunctions.CreateNewObject("");
		var PreEditDigest = ClonedRecord.Record2.OpenDigest(NullObj);
		AddEntryCode.PrefillFormFromRecord(ClonedRecord, CalendarView.TimeZoneID);

		var Editing = CanEditRecord(i_RecordID);

		if (Editing)
			AddEntryCode.EnableAll();
		else
			AddEntryCode.DisableAll();

		if (g_TemplateVersion >= 3)
			AddEntryCode.ShowAuthor(ClonedRecord.OpenField("_CreatedBy"));

		WindowMgr.ShowWaitCursor(false);

		Window.Show(GrooveWindowShowCommand_Show);
		if (GrooveMessageBoxResultCode_OK == Window.DoModal())
		{
			if (Editing)
			{
				AddEntryCode.FillCalendarRecord(ClonedRecord, CalendarView.TimeZoneID);
				var PostEditDigest = ClonedRecord.Record2.OpenDigest(NullObj);
				if (PreEditDigest != PostEditDigest)
					ReplaceCalendarRecord(ClonedRecord);
			}
		}
		Window.Destroy();
	}

	// Updates the text title of the calendar. i.e. "July 2000"
	function UpdateCalendarTitle()
	{	
		var View = CalendarView.ViewType;
		var TitleType;
		
		switch (CalendarView.ViewType)
		{
		case GrooveCalendarViewType_Day:
			// show single date
			var TitleText = FormatDate(CalendarView.StartDate, GrooveIntlDateFormatStyle_Full);
			CalendarTitle.SetText(TitleText);
			break;

		case GrooveCalendarViewType_Month:
		case GrooveCalendarViewType_MonthWithStackedWeekends:
			// show month and year
			CalendarTitle.SetText(CalendarView.GridMonthName + " " + CalendarView.GridYearNum);
			break;

		case GrooveCalendarViewType_TwoDay:
		case GrooveCalendarViewType_NormalWeek:
		case GrooveCalendarViewType_FamilyWeek:
		case GrooveCalendarViewType_WideWeek:
		case GrooveCalendarViewType_TwoRowWorkWeek:
		case GrooveCalendarViewType_WorkWeek:
		default:
			// show date range
			var TitleText = FormatDate(CalendarView.StartDate, GrooveIntlDateFormatStyle_Medium);
			TitleText += " - " + FormatDate(CalendarView.EndDate, GrooveIntlDateFormatStyle_Medium);
			CalendarTitle.SetText(TitleText);
			break;
		}
	}

	//---------------------------------------------------------
	// FollowMe Helpers
	//---------------------------------------------------------

	function HandleScrollPrev()
	{
		CalendarSubFormCode.SetFocus();
		CalendarView.ScrollPrev();

		if (g_InFollowMode)
			PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
	}

	function HandleScrollToToday()
	{
		CalendarSubFormCode.SetFocus();
		CalendarView.ScrollToToday();

		if (g_InFollowMode)
			PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
	}

	function HandleScrollNext()
	{
		CalendarSubFormCode.SetFocus();
		CalendarView.ScrollNext();

		if (g_InFollowMode)
			PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
	}

	function HandleViewChange(i_ViewType)
	{
		if (g_TemplateVersion >= 3)
			EnablePreviewForView(i_ViewType);

		CalendarSubFormCode.SetFocus();
		CalendarView.ViewType = i_ViewType;

		if (g_InFollowMode)
		{
			PropertyList.SetProperty("FollowMode_ViewType", i_ViewType);
			PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
		}
	}

	function ProcessViewTypeFromPropertyList(i_ViewType)
	{
		CalendarView.ViewType = new Number(i_ViewType);
	}

	function ProcessStartDateFromPropertyList(i_ScrollPosition)
	{
		CalendarView.ScrollPosition = i_ScrollPosition;
	}

	//-----------------------------------------------------------
	// TelespaceIdentityPropertyList
	//-----------------------------------------------------------

	function TelespaceIdentityPropertyListOnPropertyChanged(i_Key, i_Value, i_LocallyGenerated)
	{
		// Is this the follow mode state changing?
		if (i_Key == "ToolNavigationMode")
		{
			g_InFollowMode = (i_Value == "0") ? false : true;

			if (g_InFollowMode)
			{
				// We are going into follow mode; navigate to the current month/view format if we are ui active
				if (PropertyList.PropertyExists("FollowMode_ViewType"))
				{
					if (g_UIActive)
						ProcessViewTypeFromPropertyList(PropertyList.OpenProperty("FollowMode_ViewType"));
				}
				else
					PropertyList.SetProperty("FollowMode_ViewType", CalendarView.ViewType);
					
				if (PropertyList.PropertyExists("FollowMode_StartDate"))
				{
					if (g_UIActive)
						ProcessStartDateFromPropertyList(PropertyList.OpenProperty("FollowMode_StartDate"));
				}
				else
					PropertyList.SetProperty("FollowMode_StartDate", CalendarView.ScrollPosition);
			}								
		}
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     @             †             }}  }}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ®               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   o   ÄName.   G r o o v e C a l e n d a r G l u e 2 . g s l         ÄSCRIPT     ÄSCRIPT     ÄSCRIPT   
  ÄIMPLEMENTS  PT    ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       & F  ÄSCRIPT       ÄSRC   h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e C a l e n d a r H e l p e r _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   0     o r
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }   i   ÄIIDL   { 5 1 B F 8 1 E 1 - 6 D E 7 - 1 1 D 2 - 9 4 6 1 - 0 0 8 0 C 7 D E 3 2 C 6 }   l       ÄSCRIPT  RIPT   ÄSCRIPT         [ Ä
			function OnNavigate(i_pIURLNavigator, i_URL, i_bAddToHistory)
			{
				var pURL = GROOVE_GLOBAL_MISC_POINTER.OpenURI(i_URL);
				if (pURL.DoesQueryPartExist("RecordID"))
				{
					var RecordID = pURL.OpenQueryPart("RecordID");
					CalendarView.ScrollToEntry(RecordID);
				}
				ActivateDefaultView(PropertyList);
				var Telespace = PropertyList.OpenProperty(PROPERTY_TELESPACE);
				var Tool = PropertyList.OpenProperty(PROPERTY_TOOL);
				var Name = Tool.DisplayName;
				i_pIURLNavigator.SetCurrentURL(i_URL, Telespace.DisplayName + " - " + Name, Name, i_bAddToHistory);
			}
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Pv   ‹·            8E   å U     “          )                      @              ò                      ò                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       †               Ä(null),0                            Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t       ÄNameP   G r o o v e D o c u m e n t S h a r e C o m m o n E v e n t s G l u e 4 . g s l           ÄSCRIPT   
  ÄIMPLEMENTS                    	  
  ÄIMPLEMENTS       ÄLIBIDL   { 0 D 0 1 2 A B 3 - C E E D - 1 1 D 2 - 9 C 7 6 - 0 0 1 0 5 A A 7 3 0 3 3 }       ÄIIDL   { 4 D 7 E C 5 0 1 - E 6 C C - 1 1 d 2 - 8 7 1 E - 0 0 8 0 C 7 8 6 8 F 6 F }           ÄSCRIPT  RIPT        0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ú ·    é        ÿ          )            ÄSCRIPT         ∆8 Ä

	function Initialize()
	{
		// Advise to get the CommandSink events off of the view
		ScriptHostComponent.Advise(DocumentShareView, "{4D7EC501-E6CC-11d2-871E-0080C7868F6F}");
	
		// Connect to tool rename events from tool container
		var pToolContainer = PropertyList.OpenProperty(PROPERTY_TOOL_CONTAINER);
		ConnectObject(pToolContainer, "ToolContainer_");

		// Connect to tree control view events
		ConnectObject(FolderTreeView, "FolderTreeView_", true);

		// Register with splitter for drag resizing events
		ConnectObject(FilesSplitter, "FilesSplitter_");

		//////////
		// Delegate to common glue
		//////////

		CommonGlue_Initialize()

		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_Initialize();

		//////////
		// Delegate to browsed folder display glue
		//////////

		BrowsedFolderDisplayGlue_Initialize();

		//////////
		// Delegate to main glue
		//////////

		MainUIGlue_Initialize();
	}

	function Terminate()
	{
		// Disconnect from receiving tool rename events from tool container
		var pToolContainer = PropertyList.OpenProperty(PROPERTY_TOOL_CONTAINER);
		DisconnectObject(pToolContainer);

		// Disconnect from receiving folder tree view events
		DisconnectObject(FolderTreeView);

		// Disconnect from events from splitter
		DisconnectObject(FilesSplitter);

		// Unadvise to get the CommandSink events off of the view
		ScriptHostComponent.Unadvise(DocumentShareView, "{4D7EC501-E6CC-11d2-871E-0080C7868F6F}");
	
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_Terminate();

		//////////
		// Delegate to main glue
		//////////

		MainUIGlue_Terminate();
	}

	function OnSetUIProperties()
	{

		//////////
		// Delegate to main glue
		//////////

		MainUIGlue_OnSetUIProperties();
	}
	
	function OnViewContainerShow()
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_OnViewContainerShow();
	}

	function OnViewContainerHide()
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_OnViewContainerHide();
	}

	// ----------------------------------------------------------------------------
	// Begin IGrooveDocumentShareView Events implementation
	// ----------------------------------------------------------------------------

	//
	// --------  IGrooveDocumentShareDragDropTargetEvents ----------------
	//
	function DocumentShareView_OnDragEnter(i_pView, i_ParentFolderID, i_RightMouseDown)
	{
		//////////
		// Fire event
		//////////

		FireOnDragEnter(i_pView, i_ParentFolderID, i_RightMouseDown);
	}
	function DocumentShareView_OnDragLeave(i_pView, i_RightMouseDown)
	{
		//////////
		// Fire event
		//////////

		FireOnDragLeave(i_pView, i_RightMouseDown);
	}
	function DocumentShareView_OnDrop(i_pView, i_TargetID, i_RightMouseDown)
	{
		//////////
		// Fire event
		//////////

		FireOnDrop(i_pView, i_TargetID, i_RightMouseDown);
	}
	function DocumentShareView_HandleQueryFileTransferType(i_pView, i_TargetID, i_RightMouseDown, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireHandleQueryFileTransferType(i_pView, i_TargetID, i_RightMouseDown, i_pEventResult);
	}
	function DocumentShareView_HandleQueryValidDropTarget(i_pView, i_TargetID, i_RightMouseDown, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireHandleQueryValidDropTarget(i_pView, i_TargetID, i_RightMouseDown, i_pEventResult);
	}
	function DocumentShareView_OnQueryFileTransferType(i_pView, i_TargetID, i_KeyState, i_RightMouseDown, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQueryFileTransferType(i_pView, i_TargetID, i_KeyState, i_RightMouseDown, i_pEventResult);
	}
	function DocumentShareView_OnQueryValidDropTarget(i_pView, i_TargetID, i_RightMouseDown, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQueryValidDropTarget(i_pView, i_TargetID, i          _RightMouseDown, i_pEventResult);
	}	

	//
	// --------  IGrooveDocumentShareClipboardTargetEvents ----------------
	//
	function DocumentShareView_OnQueryPaste(i_pView, i_TargetID, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQueryPaste(i_pView, i_TargetID, i_pEventResult);
	}
	function DocumentShareView_OnQueryPasteAsLink(i_pView, i_TargetID, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQueryPasteAsLink(i_pView, i_TargetID, i_pEventResult);
	}
	function DocumentShareView_OnPasteComplete(i_pView, i_TargetID)
	{
		//////////
		// Fire event
		//////////

		FireOnPasteComplete(i_pView, i_TargetID);
	}
	function DocumentShareView_OnPasteAsLinkComplete(i_pView, i_TargetID)
	{
		//////////
		// Fire event
		//////////

		FireOnPasteAsLinkComplete(i_pView, i_TargetID);
	}

	//
	// --------  IGrooveDocumentShareFileTransferEvents ----------------
	//
	function DocumentShareView_OnFileTransferBegin(i_pView, i_TransferTargetID, i_NumberFiles)
	{
		//////////
		// Fire event
		//////////

		FireOnFileTransferBegin(i_pView, i_TransferTargetID, i_NumberFiles);
	}
	function DocumentShareView_OnFileTransfer(i_pView, i_TransferTargetID, i_Path, i_FileSystemObjectType, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnFileTransfer(i_pView, i_TransferTargetID, i_Path, i_FileSystemObjectType, i_pEventResult);
	}
	function DocumentShareView_OnFileTransferEnd(i_pView)
	{
		//////////
		// Fire event
		//////////

		FireOnFileTransferEnd(i_pView);
	}	
	
	//
	// --------  IGrooveDocumentShareUIEvents ----------------
	//
	// Mouse Button Events
	function DocumentShareView_OnLDoubleClick(i_pView, i_ID, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnLDoubleClick(i_pView, i_ID, i_pEventResult);
	}
	function DocumentShareView_OnLButtonDown(i_pView, i_ID, i_KeyStateMap)
	{
		//////////
		// Fire event
		//////////

		FireOnLButtonDown(i_pView, i_ID, i_KeyStateMap);
	}

	// Focus Events
	function DocumentShareView_OnQueryFocusChange(i_pView, i_ID, i_GainFocus, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQueryFocusChange(i_pView, i_ID, i_GainFocus, i_pEventResult);
	}
	function DocumentShareView_OnFocusChange(i_pView, i_ID, i_GainFocus)
	{
		//////////
		// Fire event
		//////////

		FireOnFocusChange(i_pView, i_ID, i_GainFocus);
	}
	
	// Selection Events
	function DocumentShareView_OnQuerySelectionChange(i_pView, i_ID, i_GainSelection, i_UISelection, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQuerySelectionChange(i_pView, i_ID, i_GainSelection, i_UISelection, i_pEventResult);
	}
	function DocumentShareView_OnSelectionChange(i_pView, i_ID, i_GainSelection, i_UISelection)
	{

		//////////
		// Fire event
		//////////

		FireOnSelectionChange(i_pView, i_ID, i_GainSelection, i_UISelection);
	}

	// Browse Events
	function DocumentShareView_OnQueryBrowseFolder(i_pView, i_NewBrowsedFolderID, i_CurrentBrowsedFolderID, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQueryBrowseFolder(i_pView, i_NewBrowsedFolderID, i_CurrentBrowsedFolderID, i_pEventResult);
	}

	// Rename Events
	function DocumentShareView_OnQueryRenameShareObject(i_pView, i_ShareObjectID, i_NewFullName, i_OldFullName, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQueryRenameShareObject(i_pView, i_ShareObjectID, i_NewFullName, i_OldFullName, i_pEventResult);
	}
	
	// Delete Events
	function DocumentShareView_OnQueryDeleteShareObject(i_pView, i_ShareObjectID, i_pEventResult)
	{
		//////////
		// Fire event
		//////////

		FireOnQueryDeleteShareObject(i_pView, i_ShareObjectID, i_pEventResult);
	}
	function DocumentShareView_OnQueryShowRenameEditControl(i_pView, i_ShareObjectID, i_pEventResult)
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_DocumentShareView_OnQueryShowRenameEditControl(i_          pView, i_ShareObjectID, i_pEventResult);

		//////////
		// Fire event
		//////////

		FireOnQueryShowRenameEditControl(i_pView, i_ShareObjectID, i_pEventResult);
	}

	// ----------------------------------------------------------------------------
	// End IGrooveDocumentShareView Events implementation
	// ----------------------------------------------------------------------------


	// ----------------------------------------------------------------------------
	// Begin IGrooveDocumentShareCommandSink2 Events implementation
	// ----------------------------------------------------------------------------
	function DocumentShareEngine_OnChangeFileContents2(i_pEngine, i_ParentID, i_ShareObjectID, i_LocallyGenerated)
	{
	}

	// ----------------------------------------------------------------------------
	// End IGrooveDocumentShareCommandSink2 Events implementation
	// ----------------------------------------------------------------------------

	// ----------------------------------------------------------------------------
	// Begin IGroovePropertyListListener Events implementation
	// ----------------------------------------------------------------------------

	function OnPropertyChanged(i_Key, i_Value, i_LocallyGenerated)
	{

		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_OnPropertyChanged(i_Key, i_Value, i_LocallyGenerated);

		//////////
		// Delegate to browsed folder display glue
		//////////

		BrowsedFolderDisplayGlue_OnPropertyChanged(i_Key, i_Value, i_LocallyGenerated);

		//////////
		// Delegate to main glue
		//////////

		MainUIGlue_OnPropertyChanged(i_Key, i_Value, i_LocallyGenerated);

	}

	// ----------------------------------------------------------------------------
	// End IGroovePropertyListListener Events implementation
	// ----------------------------------------------------------------------------

	// ----------------------------------------------------------------------------
	// Begin IGrooveToolContainerListener Events
	// ----------------------------------------------------------------------------

	function ToolContainer_OnToolChanged(i_pIToolContainer, i_UpdateCode, i_UpdateFlag, i_ToolName)
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_ToolContainer_OnToolChanged(i_pIToolContainer, i_UpdateCode, i_UpdateFlag, i_ToolName);

		//////////
		// Delegate to browsed folder display glue
		//////////

		BrowsedFolderDisplayGlue_ToolContainer_OnToolChanged(i_pIToolContainer, i_UpdateCode, i_UpdateFlag, i_ToolName);
	}

	// ----------------------------------------------------------------------------
	// End IGrooveToolContainerListener Events
	// ----------------------------------------------------------------------------

	// ----------------------------------------------------------------------------
	// Begin IGrooveSplitterSink Events
	// ----------------------------------------------------------------------------

	function FilesSplitter_OnSplitterDragEnd(i_Name, i_Pane1SizeValue, i_Pane1LayoutSizeType, i_Pane2SizeValue, i_Pane2LayoutSizeType)
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_FilesSplitter_OnSplitterDragEnd(i_Name, i_Pane1SizeValue, i_Pane1LayoutSizeType, i_Pane2SizeValue, i_Pane2LayoutSizeType);
	}


	function DocumentShareMainSplitter_OnSplitterDragEnd(i_Name, i_Pane1SizeValue, i_Pane1LayoutSizeType, i_Pane2SizeValue, i_Pane2LayoutSizeType)
	{
	}

	// ----------------------------------------------------------------------------
	// End IGrooveSplitterSink Events
	// ----------------------------------------------------------------------------

	// ----------------------------------------------------------------------------
	// Begin IGrooveUnreadMarkListener Events
	// ----------------------------------------------------------------------------

	function UnreadMarkEngine_OnUnreadMarksChanged(i_pItemIDEnum, i_Unread, i_Triggered)
	{
	      †   	//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_UnreadMarkEngine_OnUnreadMarksChanged(i_pItemIDEnum, i_Unread, i_Triggered);
	}

	// ----------------------------------------------------------------------------
	// End IGrooveUnreadMarkListener Events
	// ----------------------------------------------------------------------------


	// ----------------------------------------------------------------------------
	// Begin IGrooveTreeViewListener Events
	// ----------------------------------------------------------------------------

	function FolderTreeView_OnTreeViewItemExpansionEnd(i_pIComponent, i_ID, i_Order)
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_FolderTreeView_OnTreeViewItemExpansionEnd(i_pIComponent, i_ID, i_Order);
	}

	function FolderTreeView_OnTreeViewLabelEditBegin(i_pIComponent, i_ID, i_Text, i_pEventResult)
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_FolderTreeView_OnTreeViewLabelEditBegin(i_pIComponent, i_ID, i_Text, i_pEventResult);
	}


	function FolderTreeView_OnTreeViewLabelEditEnd(i_pIComponent, i_ID, i_Text, i_pEventResult)
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_FolderTreeView_OnTreeViewLabelEditEnd(i_pIComponent, i_ID, i_Text, i_pEventResult);
	}

	function FolderTreeView_OnTreeViewSelectionChangeBegin(i_pIComponent, i_IDItemOld, i_IDItemNew, i_Trigger, i_pEventResult)
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_FolderTreeView_OnTreeViewSelectionChangeBegin(i_pIComponent, i_IDItemOld, i_IDItemNew, i_Trigger, i_pEventResult);
	}

	function FolderTreeView_OnTreeViewDeleteItem(i_pIComponent, i_IDItem)
	{

	}

	function FolderTreeView_OnTreeViewContextMenu(i_pIComponent, i_IDItem, i_XPos, i_YPos)
	{
		//////////
		// Delegate to folder tree view glue
		//////////

		FolderTreeViewGlue_FolderTreeView_OnTreeViewContextMenu(i_pIComponent, i_IDItem, i_XPos, i_YPos);
	}

	// ----------------------------------------------------------------------------
	// End IGrooveTreeViewListener Events
	// ----------------------------------------------------------------------------


	       			FolderTreeViewGlue_DocumentShareEngine_OnRenameShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID, i_OldFullName, i_NewFullName);

			//////////
			// Delegate to browsed folder display glue
			//////////

			BrowsedFolderDisplayGlue_DocumentShareEngine_OnRenameShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID, i_OldFullName, i_NewFullName);

			//////////
			// Delegate to main glue
			//////////

			MainUIGlue_DocumentShareEngine_OnRenameShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID, i_OldFullName, i_NewFullName);

			//////////
			// Fire event
			//////////

			FireOnRenameShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID, i_OldFullName, i_NewFullName);
		}
		function OnReplaceShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID)
		{
			//////////
			// Delegate to folder tree view glue
			//////////

			FolderTreeViewGlue_DocumentShareEngine_OnReplaceShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID);

			//////////
			// Fire event
			//////////

			FireOnReplaceShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID);
		}
		function OnConflict(i_pEngine, i_ParentID, i_FileID, i_ConflictMemberContactURL)
		{
			//////////
			// Fire event
			//////////

			FireOnConflict(i_pEngine, i_ParentID, i_FileID, i_ConflictMemberContactURL);
		}

		// ----------------------------------------------------------------------------
		// End IGrooveDocumentShareCommandSink Events implementation
		// ----------------------------------------------------------------------------
		                                                                                                                                                                ë0    	           ÄSCRIPT          Ä

		// ----------------------------------------------------------------------------
		// Begin IGrooveDocumentShareCommandSink Events implementation
		// ----------------------------------------------------------------------------
		// GSKLATER
		// VERY IMPORTANT NOTE - HACK
		// The document share view is temporarily forwarding all engine command events in order
		// to synchronize these events through the view.  Needed to do this to avoid
		// potential race conditions between the glue code and view sinking of these engine events.
		// In the future, the Document Share View should be a thin list view that the 
		// Document Share Glue code manipulates while alone sinking the engine events.

		// NEED TO CONVERT BACK TO SINKING ENGINE EVENTS WHEN VIEW LOGIC HAS BEEN MOVED TO GLUE CODE
		function OnAddShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID)
		{

			//////////
			// Delegate to folder tree view glue
			//////////

			FolderTreeViewGlue_DocumentShareEngine_OnAddShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID);

			//////////
			// Delegate to main glue
			//////////

			MainUIGlue_DocumentShareEngine_OnAddShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID);

			//////////
			// Fire event
			//////////

			FireOnAddShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID);
		}
		function OnBrowseFolder(i_pEngine, i_UserURL, i_FolderID)
		{

			//////////
			// Delegate to folder tree view glue
			//////////

			FolderTreeViewGlue_DocumentShareEngine_OnBrowseFolder(i_pEngine, i_UserURL, i_FolderID);

			//////////
			// Delegate to browsed folder display glue
			//////////

			BrowsedFolderDisplayGlue_DocumentShareEngine_OnBrowseFolder(i_pEngine, i_UserURL, i_FolderID);

			//////////
			// Delegate to main glue
			//////////

			MainUIGlue_DocumentShareEngine_OnBrowseFolder(i_pEngine, i_UserURL, i_FolderID);

			//////////
			// Fire event
			//////////

			FireOnBrowseFolder(i_pEngine, i_UserURL, i_FolderID);
		}
		function OnChangeFileContents(i_pEngine, i_ParentID, i_ShareObjectID)
		{

			//////////
			// Fire event
			//////////

			FireOnChangeFileContents(i_pEngine, i_ParentID, i_ShareObjectID);
		}
		function OnChangeLastModifiedTime(i_pEngine, i_ParentID, i_ShareObjectID)
		{
			//////////
			// Fire event
			//////////

			FireOnChangeLastModifiedTime(i_pEngine, i_ParentID, i_ShareObjectID);
		}
		function OnCreateFolder(i_pEngine, i_ParentFolderID, i_FolderID)
		{
			//////////
			// Delegate to folder tree view glue
			//////////

			FolderTreeViewGlue_DocumentShareEngine_OnCreateFolder(i_pEngine, i_ParentFolderID, i_FolderID);

			//////////
			// Fire event
			//////////

			FireOnCreateFolder(i_pEngine, i_ParentFolderID, i_FolderID);
		}
		function OnDeleteShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID)
		{

			//////////
			// Delegate to folder tree view glue
			//////////

			FolderTreeViewGlue_DocumentShareEngine_OnDeleteShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID);

			//////////
			// Fire event
			//////////

			FireOnDeleteShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID);
		}
		function OnFolderViewSortChange(i_pEngine, i_UserURL, i_FolderID, i_SortColumn, i_SortType)
		{
			//////////
			// Fire event
			//////////

			FireOnFolderViewSortChange(i_pEngine, i_UserURL, i_FolderID, i_SortColumn, i_SortType);
		}
		function OnFolderViewStyleChange(i_pEngine, i_UserURL, i_FolderID, i_ViewStyle)
		{
			//////////
			// Delegate to main glue
			//////////

			MainUIGlue_DocumentShareEngine_OnFolderViewStyleChange(i_pEngine, i_UserURL, i_FolderID, i_ViewStyle);

			//////////
			// Fire event
			//////////

			FireOnFolderViewStyleChange(i_pEngine, i_UserURL, i_FolderID, i_ViewStyle)
		}
		function OnRenameShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID, i_OldFullName, i_NewFullName)
		{

			//////////
			// Delegate to folder tree view glue
			//////////

      ÄSCRIPT         fAÄ

	var g_ShowCommandBar = true;
	
	var GlobalCommandContainer;
	var UICommandContainer;
	var bCommandsShown=false;
	var CustomTB = false;

	var TBCommandArray = new Array();
	var TBCommandArrayIndex = new Array();
	var CustomCommands = false;

	// Selected share object operations
	var g_SelectedShareObjectOperations;

	// Pending navigation folder browse
	var g_PendingNavigationFolder = "";
	var g_PendingNavigationSelectionID = "";

	// Created file IDs
	var g_CreatedFilesEnum;

	// Image URLs
	var g_ImagesURL;
	var g_ImagesMaskURL;

	//	Enumeration of ShellNew descriptors
	var g_pShellNewDescriptorEnum;
	var g_ShellNewDescriptorsOpened = false;


	// Icon size constants
	var ICON_WIDTH = 16;
	var ICON_HEIGHT = 16;

	// Command states
	var g_IsUpFolderCmdEnabled = false;
	var g_CurrentFolderViewStyle = GrooveFolderViewStyle_Details;
				
	function MainUIGlue_Initialize()
	{
		//Initialize the toolbar command array for default behaviour of tool
		TBCommandArray[0] = DOCUMENT_SHARE_TOOL_COMMAND_ADDFILE;
		TBCommandArray[1] = DOCUMENT_SHARE_TOOL_COMMAND_UPFOLDER;
		TBCommandArray[2] = DOCUMENT_SHARE_TOOL_COMMAND_SEPARATOR1;
		TBCommandArray[3] = DOCUMENT_SHARE_TOOL_COMMAND_CUT;
		TBCommandArray[4] = DOCUMENT_SHARE_TOOL_COMMAND_COPY;
		TBCommandArray[5] = DOCUMENT_SHARE_TOOL_COMMAND_PASTE;
		TBCommandArray[6] = DOCUMENT_SHARE_TOOL_COMMAND_SEPARATOR2;
		TBCommandArray[7] = DOCUMENT_SHARE_TOOL_COMMAND_UNDO;
		TBCommandArray[8] = DOCUMENT_SHARE_TOOL_COMMAND_REDO;
		TBCommandArray[9] = DOCUMENT_SHARE_TOOL_COMMAND_SEPARATOR3;
		TBCommandArray[10] = DOCUMENT_SHARE_TOOL_COMMAND_DELETE;
		TBCommandArray[11] = DOCUMENT_SHARE_TOOL_COMMAND_PROPERTIES;
		TBCommandArray[12] = DOCUMENT_SHARE_TOOL_COMMAND_SEPARATOR4;	
		TBCommandArray[13] = DOCUMENT_SHARE_TOOL_COMMAND_PREVIOUSUNREAD;
		TBCommandArray[14] = DOCUMENT_SHARE_TOOL_COMMAND_NEXTUNREAD;

		// Create Images URLs
		g_ImagesURL = GetString(pBundle, "System_IU_CTII");
		g_ImagesMaskURL= GetString(pBundle, "System_IMU_CTII");

	}

	function MainUIGlue_Terminate()
	{
		if (CustomTB == true)
			DisconnectObject(UICommandContainer);
	}

	function MainUIGlue_OnSetUIProperties()
	{
	}

	function OnConnectToExternalObject(i_Object, i_ConnectionID)
	{
		if (0 == i_ConnectionID)
		{
			if (CustomTB == false)
			{
				UICommandContainer = i_Object;

				// We want to sink the events of the UI command container.
				ConnectObject(UICommandContainer, "UICommandContainer");
			}

			ShowUICommands();
		}
		else if (1 == i_ConnectionID)
		{
			GlobalCommandContainer = i_Object;
			ShowMenuCommands();
		}		
	}
	
	function OnUnconnectFromExternalObjects()
	{
		if (CustomTB == false)
		{
			// Unconnect all sinks
			
			if (typeof UICommandContainer != "undefined")
			{
				HideUICommands();
				DisconnectObject(UICommandContainer);
			}
		}

		if (typeof GlobalCommandContainer != "undefined")
		{
			HideMenuCommands();
		}
	}

	function OnTranslateAccelerator(i_Msg, i_KeyCode, i_KeyState, i_KeyModifiers)
	{
		if (i_Msg == GROOVE_WM_KEYDOWN && ComponentHasFocus(GetFolderTreeViewComponentName()))
		{
			switch(i_KeyCode)
			{
				case GROOVE_VK_ENTER:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_ALT)
					{
						// Display wait cursor
						g_pWindowsManager.ShowWaitCursor();

						DisplayPropertiesForSelection();

						// Hide wait cursor
						g_pWindowsManager.ShowWaitCursor(false);

						return true;
					}
					break;
				}
				case GROOVE_VK_DELETE:
				{
					if(GetFolderTreeViewSelectionID() != "")
					{
						if((GetFolderTreeViewSelectionID() != g_RootFolderID) &&
								DocumentShareEngine.DocumentShareEngine.CanDeleteShareObject(GetFolderTreeViewSelectionID()))
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							var pIDEnum = CreateBSTREnum();

							pIDEnum.Add(GetFolderTreeViewSelectionID());
							SafeDeleteShareObjects(pIDEnum, true);

							// Hide wait cursor
							g_pWindowsManager.ShowWaitCursor(false);

							return true;
						}
					}
					break;
				}
				case GROOVE_VK_D:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						if(GetFolderTreeViewSelectionID() != "")
						{
							if((GetFolderTreeViewSelectionID() != g_RootFolderID) &&
									DocumentShareEngine.DocumentShareEngine.CanDeleteShareObject(GetFolderTreeViewSelectionID()))
							{
								// Display wait cursor
								g_pWindowsManager.ShowWaitCursor();

								var pIDEnum = CreateBSTREnum();

								pIDEnum.Add(GetFolderTreeViewSelectionID());
								SafeDeleteShareObjects(pIDEnum, true);

								// Hide wait cursor
								g_pWindowsManager.ShowWaitCursor(false);

								return true;
							}
						}
					}
					break;
				}
				case GROOVE_VK_F2:
				{
					if(GetFolderTreeViewSelectionID() != "")
					{
						if((GetFolderTreeViewSelectionID() != g_RootFolderID) &&
								DocumentShareEngine.DocumentShareEngine.CanRenameShareObject(GetFolderTreeViewSelectionID()))
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							DisplayFolderTreeViewLabelEdit(GetFolderTreeViewSelectionID());

							// Hide wait cursor
							g_pWindowsManager.ShowWaitCursor(false);

							return true;
						}
					}
					break;
				}
				case GROOVE_VK_V:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						if(GetFolderTreeViewSelectionID() != "")
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							DocumentShareView.Commands.PasteFromClipboardToFolder(GetFolderTreeViewSelectionID());

							// Hide wait cursor
							g_pWindowsManager.ShowWaitCursor(false);

							return true;
						}
					}
					break;
				}
				case GROOVE_VK_C:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						if((GetFolderTreeViewSelectionID() != "") &&
							(GetFolderTreeViewSelectionID() != g_RootFolderID))
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							var pIDEnum = CreateBSTREnum();

							pIDEnum.Add(GetFolderTreeViewSelectionID());
							DocumentShareView.Commands.CopyShareObjectsToClipboard(pIDEnum);

							// Hide wait cursor
							g_pWindowsManager.ShowWaitCursor(false);

							return true;
						}
					}
					break;
				}
				case GROOVE_VK_INSERT:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						if((GetFolderTreeViewSelectionID() != "") &&
							(GetFolderTreeViewSelectionID() != g_RootFolderID))
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							var pIDEnum = CreateBSTREnum();

							pIDEnum.Add(GetFolderTreeViewSelectionID());
							DocumentShareView.Commands.CopyShareObjectsToClipboard(pIDEnum);

							// Hide wait cursor
							g_pWindowsManager.ShowWaitCursor(false);

							return true;
						}
					}
					else if(i_KeyModifiers & GROOVE_KEYMOD_SHIFT)
					{
						if(DocumentShareEngine.DocumentShareEngine.CanAddFile(GetFolderTreeViewSelectionID()) || 
							(DocumentShareEngine.DocumentShareEngine.CanAddFolder(GetFolderTreeViewSelectionID()) && DocumentShareEngine.Properties.GetSupportFolders()))
							{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							DocumentShareView.Commands.PasteFromClipboardToFolder(GetFolderTreeViewSelectionID());

							// Hide wait cursor
							g_pWindowsManager.ShowWaitCursor(false);

							return true;
							}
					}
					break;
				}
				case GROOVE_VK_BACK:
				{
					if((GetFolderTreeViewSelectionID() != "") &&
						(GetFolderTreeViewSelectionID() != g_RootFolderID))
					{
						// Display wait cursor
						g_pWindowsManager.ShowWaitCursor();

						DocumentShareView.Commands.BrowseParentFolder();

						// Hide wait cursor
						g_pWindowsManager.ShowWaitCursor(false);

						return true;
					}
					break;
				}
				case GROOVE_VK_Z:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						// Display wait cursor
						g_pWindowsManager.ShowWaitCursor();

						SafeUndo();

						// Hide wait cursor
						g_pWindowsManager.ShowWaitCursor(false);

						return true;
					}
					break;
				}
				case GROOVE_VK_Y:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						// Display wait cursor
						g_pWindowsManager.ShowWaitCursor();

						SafeRedo();

						// Hide wait cursor
						g_pWindowsManager.ShowWaitCursor(false);

						return true;
					}
					break;
				}
				case GROOVE_VK_A:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						// Display wait cursor
						g_pWindowsManager.ShowWaitCursor();

						// Select all share objects in view
						DocumentShareView.Focus = true;
						DocumentShareView.Commands.SelectAllShareObjects();

						// Hide wait cursor
						g_pWindowsManager.ShowWaitCursor(false);

						return true;
					}
					break;
				}
				case GROOVE_VK_U:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						g_pWindowsManager.ShowWaitCursor();
						DocumentShareView.Commands.BrowseParentFolder();
						g_pWindowsManager.ShowWaitCursor(false);

						return true;
					}
					break;
				}
				case GROOVE_VK_M:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						// If folder is not already browsed, browse it
						var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();

						if(DocumentShareEngine.DocumentShareEngine.CanAddFile(BrowsedFolderID))
						{
							// Select all share objects in view
							g_pWindowsManager.ShowWaitCursor();
							try
							{
								DocumentShareView.Commands.DisplayAddFileDialog(BrowsedFolderID, true);
							}
							catch(error)
							{
								if(DocumentShareEngine.DocumentShareEngine.CanAddFile(BrowsedFolderID))
								{
									// Display warning dialog about reaching limit of adding files
									DisplayAddFileLimitWarningDlg();		
								}
								else
								{
									// Display warning dialog about permission
									DisplayAddFilePermissionsWarningDlg();		
								}
							}
							g_pWindowsManager.ShowWaitCursor(false);
						}
						else
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							// Display warning dialog about permission
							DisplayAddFilePermissionsWarningDlg();		
												
							g_pWindowsManager.ShowWaitCursor(false);
						}

						return true;
					}
					break;
				}
				case GROOVE_VK_F4:
				{
					if(i_KeyModifiers & GROOVE_KEYMOD_CONTROL)
					{
						if(i_KeyModifiers & GROOVE_KEYMOD_SHIFT)
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							DocumentShareView.Commands.MarkAllShareObjectsRead(true);
												
							g_pWindowsManager.ShowWaitCursor(false);

							return true;
						}
						else
						{
							if(GetFolderTreeViewSelectionID() != "")
							{
								// Display wait cursor
								g_pWindowsManager.ShowWaitCursor();

								MarkShareObjectSelectionRead(true);
												
								g_pWindowsManager.ShowWaitCursor(false);

								return true;
							}
						}
					}
					else
					{
						if(i_KeyModifiers & GROOVE_KEYMOD_SHIFT)
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							DocumentShareView.Commands.NavigateToPreviousShareObject(GrooveShareObjectNavigationType_Unread);
												
							g_pWindowsManager.ShowWaitCursor(false);

						}
						else
						{
							// Display wait cursor
							g_pWindowsManager.ShowWaitCursor();

							DocumentShareView.Commands.NavigateToNextShareObject(GrooveShareObjectNavigationType_Unread);
												
							g_pWindowsManager.ShowWaitCursor(false);
						}

						return true;
					}
					break;
				}
			}
		}

		// If we made it this far, we did not handle it
		return false;
	}


	function SetDefaultCommandIndex()
	{

		for (i=0; i<TBCommandArray.length; i++)
			TBCommandArrayIndex[i] = i;

	}

	function GetCommands()
	{
		return TBCommandArray;
	}

	function ShowUICommands()
	{
		if (g_ShowCommandBar == false)
			return;
		if (!bCommandsShown)
		{
			bCommandsShown = true;

			//UICommandContainer.ToolBar.DisplayAsMenu = true;

			// Show command bar buttons
			ShowCommandBarButtons();
		}
	
	}

	function IsShellNewURL(i_URL)
	{
		var Identifier = Right(i_URL, "DocumentShareToolMenu_File_");
		var ShellIdentifier = Left(Identifier, "_");
		if (ShellIdentifier == "ShellNewDynMenu")
		{
			return true;
		}
		else
		{
			return false;
		}
	}

	function GetShellNewIndex(i_URL)
	{
		var Identifier = Right(i_URL, "DocumentShareToolMenu_File_");
		return Right(Identifier, "_");
	}

	function ShowMenuCommands()
	{
		if (g_ShowCommandBar == false)
			return;

		/*EMOC: For dynamic menu support
		if (GlobalCommandContainer.UICommandContainerExists("GUICC_File"))
		{	
			g_FileCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_File");
			g_FileCC.UICommandContainer2.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;
		}
		*/

		// Get all of the Tool specific Command Containers (even if we don't use them all)
		if (GlobalCommandContainer.UICommandContainerExists("GUICC_FileNewToolCommands"))
		{
			g_FileNewCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_FileNewToolCommands");
			g_FileNewCC.UICommandContainer2.Listener = ScriptHostComponent.IGrooveUICommandContainerListener2;
		}

		if (GlobalCommandContainer.UICommandContainerExists("GUICC_FileDocumentToolCommands"))
			g_FileDocumentCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_FileDocumentToolCommands");

		if (GlobalCommandContainer.UICommandContainerExists("GUICC_EditUndoRedoToolCommands"))
			g_EditUndoRedoCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_EditUndoRedoToolCommands");

		if (GlobalCommandContainer.UICommandContainerExists("GUICC_EditClipboardToolCommands"))
			g_EditClipboardCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_EditClipboardToolCommands");

		if (GlobalCommandContainer.UICommandContainerExists("GUICC_EditCopyLinksToolCommands"))
			g_EditCopyLinksCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_EditCopyLinksToolCommands");

		if (GlobalCommandContainer.UICommandContainerExists("GUICC_EditToolCommands"))
			g_EditCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_EditToolCommands");

		if (GlobalCommandContainer.UICommandContainerExists("GUICC_ViewShowHideToolCommands"))
			g_ViewShowHideCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_ViewShowHideToolCommands");

		if (GlobalCommandContainer.UICommandContainerExists("GUICC_ViewToolCommands"))
			g_ViewCC = GlobalCommandContainer.OpenUICommandContainer("GUICC_ViewToolCommands");

		// Note that all commands the tool supports appear on one of the menus above

		if (g_FileNewCC)
		{
			// On the FileNew menu we add Folder
			var UICommand = g_FileNewCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_FOLDER, g_FileNewCC.GetNumberOfUICommands());
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_FOLDER_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			if(g_ShellNewDescriptorsOpened)
				BuildDynamicNewFileMenuItems(g_FileNewCC.UICommandContainer);
		}
		
		if (g_FileDocumentCC)
		{
			var Position = g_FileDocumentCC.GetNumberOfUICommands();
			
			// Insert "Add Files..." option
			var UICommand = g_FileDocumentCC.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ADD, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ADD_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ADD_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
            UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 18, ICON_WIDTH, ICON_HEIGHT);

			// Insert "Properties" sub-menu option
			var UICommand = g_FileDocumentCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PROPERTIES, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PROPERTIES_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
            UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 91, ICON_WIDTH, ICON_HEIGHT);

			//BuildDynamicFileMenuItems();
		}

		if (g_EditUndoRedoCC)
		{
			var Position = g_EditUndoRedoCC.GetNumberOfUICommands();
			// Edit Undo/Redo Menu
			var UICommand = g_EditUndoRedoCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO, Position++ );
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 24, ICON_WIDTH, ICON_HEIGHT);

			var UICommand = g_EditUndoRedoCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 25, ICON_WIDTH, ICON_HEIGHT);
		}

		if (g_EditClipboardCC)
		{
			
			var Position = g_EditClipboardCC.GetNumberOfUICommands();
			//DocShare does not yet support cut
			// Edit Clipboard Menu
			//var UICommand = g_EditClipboardCC.UICommandContainer.InsertUICommand("GUIC_Files_Cut", g_EditClipboardCC.GetNumberOfUICommands());
			//UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_CUT_LABEL;
			//UICommand.Mnemonic = "Ctrl+X";
			//UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			var UICommand = g_EditClipboardCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY, Position++ );
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 3, ICON_WIDTH, ICON_HEIGHT);

			var UICommand = g_EditClipboardCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 5, ICON_WIDTH, ICON_HEIGHT);
		}

		if (g_EditCopyLinksCC)
		{
			// Edit Copy Links Menu
			var UICommand = g_EditCopyLinksCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK, g_EditCopyLinksCC.GetNumberOfUICommands());
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 4, ICON_WIDTH, ICON_HEIGHT);
		}

		if (g_EditCC)
		{
			var Position = g_EditCC.GetNumberOfUICommands();

			// Edit Menu
			var UICommand = g_EditCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SELECTALL, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SELECTALL_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SELECTALL_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			var UICommand = g_EditCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_RENAME, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_RENAME_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			var UICommand = g_EditCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_DELETE, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_DELETE_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 16, ICON_WIDTH, ICON_HEIGHT);

			g_EditCC.UICommandContainer.InsertSeparator(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SEPARATOR1, Position++);

			var UICommand = g_EditCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
			
			var UICommand = g_EditCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			var UICommand = g_EditCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLREAD, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLREAD_LABEL;
			UICommand.Mnemonic = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLREAD_MNEMONIC;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;

			var UICommand = g_EditCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}


		if (g_ViewShowHideCC)
		{
			// Show/Hide Folders 
			var UICommand = g_ViewShowHideCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_FOLDERS, g_ViewShowHideCC.GetNumberOfUICommands());
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_FOLDERS_LABEL;
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
		}
		
		var bShowNameColumn = DocumentShareView.Properties.GetShowColumn(GrooveFolderViewColumn_Name);
		var bShowSizeColumn = DocumentShareView.Properties.GetShowColumn(GrooveFolderViewColumn_Size);
		var bShowTypeColumn = DocumentShareView.Properties.GetShowColumn(GrooveFolderViewColumn_Type);
		var bShowLastModifiedDate = DocumentShareView.Properties.GetShowColumn(GrooveFolderViewColumn_LastModifiedDate);
		var bShowLastModifiedBy = DocumentShareView.Properties.GetShowColumn(GrooveFolderViewColumn_LastModifiedBy);
		if(DocumentShareView.Properties.GetEnableSorting() && 
				(bShowNameColumn || bShowSizeColumn || bShowTypeColumn || bShowLastModifiedDate || bShowLastModifiedBy))
		{
			// Insert "Arrange Icons" sub-menu option
			var pArrangeIconsCommandContainer = g_ViewCC.
							InsertUICommandContainer(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS, g_ViewCC.GetNumberOfUICommands()).UICommandContainer;
			pArrangeIconsCommandContainer.UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_LABEL;
			pArrangeIconsCommandContainer.UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
	
			// Populate "Arrange Icons" sub-menu option
			var ArrangeIconsMenuPosition = pArrangeIconsCommandContainer.GetNumberOfUICommands();

			if(bShowNameColumn)
			{
				// Insert "Name" sub-menu option
				pCommand = pArrangeIconsCommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_NAME, ArrangeIconsMenuPosition);
				pCommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_NAME_LABEL;
				pCommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				ArrangeIconsMenuPosition++;
			}

			if(bShowTypeColumn)
			{
				// Insert "Type" sub-menu option
				pCommand = pArrangeIconsCommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_TYPE, ArrangeIconsMenuPosition);
				pCommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_TYPE_LABEL;
				pCommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				ArrangeIconsMenuPosition++;
			}

			if(bShowSizeColumn)
			{
				// Insert "Size" sub-menu option
				pCommand = pArrangeIconsCommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_SIZE, ArrangeIconsMenuPosition);
				pCommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_SIZE_LABEL;
				pCommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				ArrangeIconsMenuPosition++;
			}

			if(bShowLastModifiedDate)
			{
				// Insert "Modified Date" sub-menu option
				pCommand = pArrangeIconsCommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_MODIFIEDDATE, ArrangeIconsMenuPosition);
				pCommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_MODIFIEDDATE_LABEL;
				pCommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				ArrangeIconsMenuPosition++;
			}

			if(bShowLastModifiedBy)
			{
				// Insert "Modified By" sub-menu option
				pCommand = pArrangeIconsCommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_MODIFIEDBY, ArrangeIconsMenuPosition);
				pCommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_MODIFIEDBY_LABEL;
				pCommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
				ArrangeIconsMenuPosition++;
			}

			if(bShowNameColumn ||
				bShowSizeColumn ||
				bShowTypeColumn ||
				bShowLastModifiedDate ||
				bShowLastModifiedBy)
				{
				// Insert separator
				pArrangeIconsCommandContainer.InsertSeparator(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_SEPARATOR3, ArrangeIconsMenuPosition);
				ArrangeIconsMenuPosition++;
				}
		}

		if (g_ViewCC)
		{
			var Position = g_ViewCC.GetNumberOfUICommands();
			// View Menu
			g_ViewCC.UICommandContainer.InsertSeparator(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_SEPARATOR1, Position++);

			var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_NEXT_UNREAD_LABEL;
			UICommand.Mnemonic = GetString(pBundle, "System_MN_NU");
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
            UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 7, ICON_WIDTH, ICON_HEIGHT);

			var UICommand = g_ViewCC.UICommandContainer.InsertUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD, Position++);
			UICommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_PREVIOUS_UNREAD_LABEL;
			UICommand.Mnemonic = GetString(pBundle, "System_MN_PU");
			UICommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
            UICommand.SetImage(g_ImagesURL, g_ImagesMaskURL, ICON_WIDTH * 6, ICON_WIDTH, ICON_HEIGHT);
		}

	}

	function HideUICommands()
	{
		if (bCommandsShown)
		{
			bCommandsShown = false;			

			// Remove File, Edit, View menus and their commands.
			if (UICommandContainer.UICommandContainerExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE))
				{
				var pFileCommandContainer = UICommandContainer.OpenUICommandContainer(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE).UICommandContainer;
				pFileCommandContainer.RemoveAllUICommands();
				UICommandContainer.RemoveUICommandContainer(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE);
				}

			if (UICommandContainer.UICommandContainerExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT))
				{
				var pEditCommandContainer = UICommandContainer.OpenUICommandContainer(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT).UICommandContainer;
				pEditCommandContainer.RemoveAllUICommands();
				UICommandContainer.RemoveUICommandContainer(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT);
				}

			if (UICommandContainer.UICommandContainerExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW))
				{
				var pViewCommandContainer = UICommandContainer.OpenUICommandContainer(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW).UICommandContainer;
				pViewCommandContainer.RemoveAllUICommands();
				UICommandContainer.RemoveUICommandContainer(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW);
				}

			//	Remove the Separator between the menus and other commands.
			if (UICommandContainer.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_SEPARATOR))
				UICommandContainer.RemoveSeparator(DOCUMENT_SHARE_TOOL_COMMAND_MENU_SEPARATOR);
			
			// Remove other commands from TBCommandArray.		
			for (i=0; i<TBCommandArray.length; i++)
				{
				if (UICommandContainer.UICommandExists(TBCommandArray[i]))
					UICommandContainer.RemoveUICommand(TBCommandArray[i]);
				}
		}
	
	}

	function HideMenuCommands()
	{		
		
		if (typeof g_FileNewCC != "undefined")
		{
			if (g_FileNewCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_FOLDER))
				g_FileNewCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_FOLDER);

			//	Look for the ShellNew URLs and remove them
			var FileNewEnum = g_FileNewCC.OpenUICommandURLEnum();
			while (FileNewEnum.HasMore())
			{
				var URL = FileNewEnum.OpenNext();
				if (IsShellNewURL(URL))
					g_FileNewCC.RemoveUICommand(URL);
			}

			// Remove listener
			g_FileNewCC.UICommandContainer2.Listener = GrooveScriptFunctions.CreateNewObject("");
		}

		if (typeof g_FileDocumentCC != "undefined")
		{
			if (g_FileDocumentCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ADD))
				g_FileDocumentCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ADD);

			if (g_FileDocumentCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_SEPARATOR1))
				g_FileDocumentCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_SEPARATOR1);

			if (g_FileDocumentCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PROPERTIES))
				g_FileDocumentCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PROPERTIES);
		}

		if (typeof g_EditUndoRedoCC != "undefined")
		{
			if (g_EditUndoRedoCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO))
				g_EditUndoRedoCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO);

			if (g_EditUndoRedoCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO))
				g_EditUndoRedoCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO);
		}

		
		if (typeof g_EditClipboardCC != "undefined")
		{
			//if (g_EditClipboardCC.UICommandExists("GUIC_Files_Cut"))
				//g_EditClipboardCC.RemoveUICommand("GUIC_Files_Cut");

			if (g_EditClipboardCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY))
				g_EditClipboardCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY);

			if (g_EditClipboardCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE))
				g_EditClipboardCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE);
		}

		if (typeof g_EditCopyLinksCC != "undefined" && g_EditCopyLinksCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK))
			g_EditCopyLinksCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK);

		if (typeof g_EditCC != "undefined")
		{
			if (g_EditCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SELECTALL))
				g_EditCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SELECTALL);

			if (g_EditCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_RENAME))
				g_EditCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_RENAME);

			if (g_EditCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_DELETE))
				g_EditCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_DELETE);

			if (g_EditCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SEPARATOR1))
				g_EditCC.RemoveSeparator(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SEPARATOR1);

			if (g_EditCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD))
				g_EditCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD);

			if (g_EditCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD))
				g_EditCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD);

			if (g_EditCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLREAD))
				g_EditCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLREAD);

			if (g_EditCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD))
				g_EditCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD);
		}

		if (typeof g_ViewShowHideCC != "undefined")
		{
			if(g_ViewShowHideCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_FOLDERS))
				g_ViewShowHideCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_FOLDERS);
		}

		if (typeof g_ViewCC != "undefined")
		{
			if (g_ViewCC.UICommandContainerExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS))
				g_ViewCC.RemoveUICommandContainer(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS);

			if (g_ViewCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD))
				g_ViewCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD);

			if (g_ViewCC.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD))
				g_ViewCC.RemoveUICommand(DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD);
		}
	}

	function ExecuteShellNew(i_ShellNewIndex)
	{
		var pShellNewDescriptor;
		var DisplayName;
		var ShellNewCount = 0;

		//	Enumerate descriptors

		g_pShellNewDescriptorEnum.Reset();
		while (g_pShellNewDescriptorEnum.HasMore())
		{
			pShellNewDescriptor = g_pShellNewDescriptorEnum.OpenNext();	

			//	Get the extension name and see if it's one of our accepted types.

			if (DocumentShareEngine.Properties.IsAcceptedFileType(pShellNewDescriptor.Extension))
			{
				if (ShellNewCount == i_ShellNewIndex)
				{
					//	We found our descriptor.  Add the file.

					var Transaction = g_pTelespace.OpenTransaction(false);
					try
					{
						var BIS = g_pFileSystemServices.CreateByteInputStreamFromShellNewDescriptor(pShellNewDescriptor);
						var FileID = DocumentShareEngine.CommandGenerator.CreateShareObjectID();
						var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
						var DisplayName = "New " + pShellNewDescriptor.DisplayName;
						var FullName = DisplayName + pShellNewDescriptor.Extension;
					
						DocumentShareEngine.DocumentShareEngine.AddFile(FileID, BrowsedFolderID, DisplayName, FullName, BIS);
						Transaction.Commit();

						//	Subscribe for post-processing of this object (select and rename).
						g_CreatedFilesEnum = CreateBSTREnum();
						g_CreatedFilesEnum.Add (FileID);
					}
					catch (error)
					{
						Transaction.Abort();
						GrooveDebugFunctions.DisplayAssert(0, error.description);
						// GrooveErrorFunctions.ErrorCode = error.number;
					}

					//	We're done.  Bail out of this loop.

					break;
				}
				else
				{
					//	Keep looking for it.

					ShellNewCount++;
				}
			}
		}
	}

	// ----------------------------------------------------------------------------
	// IGrooveUICommandContainerSink implementation
	// ----------------------------------------------------------------------------

	function UICommandContainerOnCommand(i_pUICommand)
	{
		if (typeof UICommandContainer == "undefined" || g_ShowCommandBar == false)
			return;


		// Execute command
		ExecuteCommand(i_pUICommand);
	}

	function ExecuteCommand(i_pUICommand)
	{
		var pViewCommands = DocumentShareView.Commands;

		var CommandURL= i_pUICommand.CommandURL;

		if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_FOLDER)
		{
			g_pWindowsManager.ShowWaitCursor();
			DocumentShareView.Focus = true;
			var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
			pViewCommands.CreateNewFolder(BrowsedFolderID, true);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_UPFOLDER)
		{
			g_pWindowsManager.ShowWaitCursor();
			pViewCommands.BrowseParentFolder();
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_ADDFILE) ||
			 (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ADD))
		{
			g_pWindowsManager.ShowWaitCursor();
			var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
			try
			{
				pViewCommands.DisplayAddFileDialog(BrowsedFolderID, true);
			}
			catch(error)
			{
				if(DocumentShareEngine.DocumentShareEngine.CanAddFile(BrowsedFolderID))
				{
					// Display warning dialog about reaching limit of adding files
					DisplayAddFileLimitWarningDlg();		
				}
				else
				{
					// Display warning dialog about permission
					DisplayAddFilePermissionsWarningDlg();		
				}
			}
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_PROPERTIES) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PROPERTIES))
		{
			// Display wait cursor
			g_pWindowsManager.ShowWaitCursor();

			DisplayPropertiesForSelection();

			// Hide wait cursor
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_UNDO) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO))
		{
			g_pWindowsManager.ShowWaitCursor();
			SafeUndo();
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_REDO) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO))
		{
			g_pWindowsManager.ShowWaitCursor();
			SafeRedo();
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == "GUIC_Files_Cut")
		{

		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_COPY) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY))
		{
			// Display wait cursor
			g_pWindowsManager.ShowWaitCursor();

			// Copy selection to clipboard
			CopySelectionToClipboard();
	
			// Hide wait cursor
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_PASTE) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE))
		{
			// Display wait cursor
			g_pWindowsManager.ShowWaitCursor();

			// Get browsed folder ID
			var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
			pViewCommands.PasteFromClipboardToFolder(BrowsedFolderID);
	
			// Hide wait cursor
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK)
		{
			// Display wait cursor
			g_pWindowsManager.ShowWaitCursor();

			var ShareObjectID = GetRepresentativeShareObjectID();

			if((typeof ShareObjectID != "undefined") &&
					(ShareObjectID != ""))
				{
				// Copy-as-link representative selection to clipboard
				pViewCommands.CopyAsLinkShareObjectToClipboard(ShareObjectID);
				}
	
			// Hide wait cursor
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SELECTALL)
		{
			// Display wait cursor
			g_pWindowsManager.ShowWaitCursor();

			DocumentShareView.Focus = true;
			pViewCommands.SelectAllShareObjects();

			// Hide wait cursor
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_RENAME)
		{
			if(DoesComponentHaveFocus() ||
				(!DoesComponentHaveFocus() && !GetDisplayFolderTreeView()))
			{
				g_pWindowsManager.ShowWaitCursor();
				if(GetDisplayFolderTreeView() && ComponentHasFocus(GetFolderTreeViewComponentName()))
				{
					if(GetFolderTreeViewSelectionID() != "")
					{
						// Display rename edit in folder tree view
						DisplayFolderTreeViewLabelEdit(GetFolderTreeViewSelectionID());
					}
				}
				else
				{
					var ShareObjectID = GetRepresentativeShareObjectID();
					if((typeof ShareObjectID != "undefined") &&
							(ShareObjectID != ""))
					{
						// Display rename edit for representative share object ID
						pViewCommands.DisplayRenameEditPrompt(ShareObjectID);
					}
				}		
				g_pWindowsManager.ShowWaitCursor(false);
			}
		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_DELETE) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_DELETE))
		{
			// Display wait cursor
			g_pWindowsManager.ShowWaitCursor();

			SafeDeleteSelection(true);

			// Hide wait cursor
			g_pWindowsManager.ShowWaitCursor(false);
		}	
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD)
		{
			g_pWindowsManager.ShowWaitCursor();
			// Mark selected share objects read
			MarkShareObjectSelectionRead(true);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD)
		{
			g_pWindowsManager.ShowWaitCursor();
			// Mark selected share objects unread
			MarkShareObjectSelectionRead(false);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLREAD)
		{
			g_pWindowsManager.ShowWaitCursor();
			// Mark selected share objects read
			pViewCommands.MarkAllShareObjectsRead(true);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD)
		{
			g_pWindowsManager.ShowWaitCursor();
			// Mark selected share objects read
			pViewCommands.MarkAllShareObjectsRead(false);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_FOLDERS)
		{
			g_pWindowsManager.ShowWaitCursor();
			if(GetDisplayFolderTreeView())
				SetDisplayFolderTreeView(false);
			else
				SetDisplayFolderTreeView(true);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_NAME)
		{
			g_pWindowsManager.ShowWaitCursor();
			SortBrowsedFolder(GrooveFolderViewColumn_Name);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_TYPE)
		{
			g_pWindowsManager.ShowWaitCursor();
			SortBrowsedFolder(GrooveFolderViewColumn_Type);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_SIZE)
		{
			g_pWindowsManager.ShowWaitCursor();
			SortBrowsedFolder(GrooveFolderViewColumn_Size);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_MODIFIEDDATE)
		{
			g_pWindowsManager.ShowWaitCursor();
			SortBrowsedFolder(GrooveFolderViewColumn_LastModifiedDate);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_MODIFIEDBY)
		{
			g_pWindowsManager.ShowWaitCursor();
			SortBrowsedFolder(GrooveFolderViewColumn_LastModifiedBy);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_FOLDERS)
		{
			g_pWindowsManager.ShowWaitCursor();
			if(GetDisplayFolderTreeView())
				SetDisplayFolderTreeView(false);
			else
				SetDisplayFolderTreeView(true);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_NEXTUNREAD))
		{
			g_pWindowsManager.ShowWaitCursor();
			// Navigate to next unread
			pViewCommands.NavigateToNextShareObject(GrooveShareObjectNavigationType_Unread);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else if ((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_PREVIOUSUNREAD))
		{
			g_pWindowsManager.ShowWaitCursor();
			// Navigate to previous unread
			pViewCommands.NavigateToPreviousShareObject(GrooveShareObjectNavigationType_Unread);
			g_pWindowsManager.ShowWaitCursor(false);
		}
		else
		{
			g_pWindowsManager.ShowWaitCursor();

			if (IsShellNewURL(CommandURL))
			{
				ExecuteShellNew(GetShellNewIndex(CommandURL));
			}
			else if (g_SelectedShareObjectOperations)
			{
				while(g_SelectedShareObjectOperations.HasMore())
				{
					var pShareObjectOperation = g_SelectedShareObjectOperations.OpenNext();

					if(CommandURL == pShareObjectOperation.Action)
					{
						DocumentShareView.Commands2.ExecuteActionOnSelection2(pShareObjectOperation.Action);
					}
				}
			g_pWindowsManager.ShowWaitCursor(false);
			}
		}
	}

	function UpdateCommandState(i_pUICommand)
	{
		var CommandURL = i_pUICommand.CommandURL;

		if(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_FOLDER)
		{
			// Do permissions settings on menu options
			var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();

			if(!DocumentShareEngine.DocumentShareEngine.CanAddFolder(BrowsedFolderID))
			{
				// Disable "New...Folder" menu option
				i_pUICommand.Enabled = false;
			}
			else
			{
				// Enable "New...Folder" menu option (if available)
				i_pUICommand.Enabled = true;
			}
		}
		else if(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_UPFOLDER)
		{
			i_pUICommand.Enabled = g_IsUpFolderCmdEnabled;
		}
		else if((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ADD) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_ADDFILE) ||
				IsShellNewURL(CommandURL))
		{
			// Do permissions settings on menu options
			var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();

			if(!DocumentShareEngine.DocumentShareEngine.CanAddFile(BrowsedFolderID))
			{
				// Disable "Add..." menu option
				i_pUICommand.Enabled = false;
			}
			else
			{
				// Enable "Add..." menu option
				i_pUICommand.Enabled = true;
			}
		}
		else if((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_DELETE) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_DELETE))
		{
			var ShareObjectID = GetRepresentativeShareObjectID();

			if(ShareObjectID && 
				(ShareObjectID != "") && 
				(ShareObjectID != g_RootFolderID))
			{
				if(DocumentShareEngine.DocumentShareEngine.CanDeleteShareObject(ShareObjectID))
					i_pUICommand.Enabled = true;
				else
					i_pUICommand.Enabled = false;
			}
			else
				i_pUICommand.Enabled = false;

		}
		else if((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PROPERTIES) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_PROPERTIES) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK))
		{
			var ShareObjectID = GetRepresentativeShareObjectID();

			if(ShareObjectID && 
				(ShareObjectID != ""))
				i_pUICommand.Enabled = true;
			else
				i_pUICommand.Enabled = false;
		}
		else if((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_COPY) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_CUT))
		{
			var ShareObjectID = GetRepresentativeShareObjectID();

			if(ShareObjectID && 
				(ShareObjectID != "") &&
				(ShareObjectID != g_RootFolderID))
				i_pUICommand.Enabled = true;
			else
				i_pUICommand.Enabled = false;
		}
		else if(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_RENAME)
		{
			var ShareObjectID = GetRepresentativeShareObjectID();

			if(ShareObjectID && 
				(ShareObjectID != "") &&
				(ShareObjectID != g_RootFolderID))
			{
				if(DocumentShareEngine.DocumentShareEngine.CanRenameShareObject(ShareObjectID))
					i_pUICommand.Enabled = true;
				else
					i_pUICommand.Enabled = false;
			}
			else
				i_pUICommand.Enabled = false;
		}
		else if((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_UNDO) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO))
		{
			i_pUICommand.Enabled = g_pDynamicsMgr.DoesDeltaToUndoExist(DocumentShareView.DocumentShareView.OpenUIUndoRedoSessionName());
		}
		else if((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_REDO) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO))
		{
			i_pUICommand.Enabled = g_pDynamicsMgr.DoesDeltaToRedoExist(DocumentShareView.DocumentShareView.OpenUIUndoRedoSessionName());
		}	
 		else if (CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE)
		{
 			var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
 				if(DocumentShareView.DocumentShareView.DoesFolderAllowClipboardPaste(BrowsedFolderID))
 				i_pUICommand.Enabled = true;
 			else
				i_pUICommand.Enabled = false;
		}
		else if(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_FOLDERS)
 		{	
 			if(GetDisplayFolderTreeView())
 				i_pUICommand.CheckState = GrooveCheckState_Checked;
 			else
 				i_pUICommand.CheckState = GrooveCheckState_Unchecked;
 		}
		else if((CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_PREVIOUSUNREAD) ||
				(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_NEXTUNREAD))
		{
			//i_pUICommand.Enabled = DocumentShareView.DocumentShareView.DoesShareObjectInNavigationExist(GrooveShareObjectNavigationType_Unread);
			//i_pUICommand.Enabled = DocumentShareView.DocumentShareView.IsShareObjectUnread(g_RootFolderID);
		}
		else if(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLREAD)
		{
			i_pUICommand.Enabled = DocumentShareView.DocumentShareView.IsShareObjectUnread(g_RootFolderID);
		}
		else if(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD)
		{
			i_pUICommand.Enabled = DocumentShareView.DocumentShareView.IsShareObjectRead(g_RootFolderID);
		}
		else if(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD)
		{
			// Initialize to false
			i_pUICommand.Enabled = false;
			if(OpenShareObjectSelectionCount() > 0)
			{
				// Enumerate selected share objects and find read state
				var pIShareObjectEnum = OpenShareObjectSelectionEnum();

				while(pIShareObjectEnum.HasMore())
				{
					var pIShareObject = pIShareObjectEnum.OpenNext();

					if(DocumentShareView.DocumentShareView.IsShareObjectUnread(pIShareObject.ShareObject.ID))
					{
						i_pUICommand.Enabled = true;
						break;
					}
				}
				
			}
		}
		else if(CommandURL == DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD)
		{
			// Initialize to false
			i_pUICommand.Enabled = false;
			if(OpenShareObjectSelectionCount() > 0)
			{
				// Enumerate selected share objects and find read state
				var pIShareObjectEnum = OpenShareObjectSelectionEnum();

				while(pIShareObjectEnum.HasMore())
				{
					var pIShareObject = pIShareObjectEnum.OpenNext();

					if(DocumentShareView.DocumentShareView.IsShareObjectRead(pIShareObject.ShareObject.ID))
					{
						i_pUICommand.Enabled = true;
						break;
					}
				}
				
			}
		}
	}

	function UICommandContainerOnUpdateCommandState(i_pUICommand)
    {

		if (typeof UICommandContainer == "undefined" || bCommandsShown == false || g_ShowCommandBar == false)
			return;

		// Update command state
		UpdateCommandState(i_pUICommand);
    }


	// ----------------------------------------------------------------------------
	// End IGrooveUICommandContainerSink implementation
	// ----------------------------------------------------------------------------


	function SetDisplayBrowsedFolderName(i_DisplayBrowsedFolderName)
	{
		SetDisplayBrowsedFolderName(i_DisplayBrowsedFolderName);
	}

	function GetDisplayBrowsedFolderName()
	{
		return GetDisplayBrowsedFolderName();
	}

	function SetDisplayFolderTreeView(i_DisplayFolderTreeView)
	{
		SetDisplayFolderTreeView(i_DisplayFolderTreeView);
	}

	function GetDisplayFolderTreeView()
	{
		return GetDisplayFolderTreeView();
	}


	// ----------------------------------------------------------------------------
	// Begin IGrooveDocumentShareCommandSink Events implementation
	// ----------------------------------------------------------------------------
	// GSKLATER
	// VERY IMPORTANT NOTE - HACK
	// The document share view is temporarily forwarding all engine command events in order
	// to synchronize these events through the view.  Needed to do this to avoid
	// potential race conditions between the glue code and view sinking of these engine events.
	// In the future, the Document Share View should be a thin list view that the 
	// Document Share Glue code manipulates while alone sinking the engine events.

	// NEED TO CONVERT BACK TO SINKING ENGINE EVENTS WHEN VIEW LOGIC HAS BEEN MOVED TO GLUE CODE
	function MainUIGlue_DocumentShareEngine_OnAddShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID)
	{
		//	Check if newly created file (then prompt for rename)

		if (typeof g_CreatedFilesEnum != "undefined")
		{
			var CreatedEnum = g_CreatedFilesEnum.BSTREnum();
			while (CreatedEnum.HasMore())
			{
				var FileID = CreatedEnum.OpenNext();
				if (i_ShareObjectID == FileID)
				{
					DocumentShareView.Focus = true;
					DocumentShareView.Commands.DisplayRenameEditPrompt(i_ShareObjectID);
					delete g_CreatedFilesEnum;
					break;
				}
			}
		}
	}

	function MainUIGlue_DocumentShareEngine_OnBrowseFolder(i_pEngine, i_UserURL, i_FolderID)
	{
		if(DocumentShareEngine.Data.DoesShareObjectExistByID(i_FolderID))
		{	
			if(g_PendingNavigationFolder == i_FolderID)
			{
				if(DocumentShareEngine.Data.DoesShareObjectExistByID(g_PendingNavigationSelectionID))
					{
					var pIDEnum = CreateBSTREnum();
					pIDEnum.Add(g_PendingNavigationSelectionID);

					DocumentShareView.DocumentShareView.SetShareObjectSelection(pIDEnum, true);
					DocumentShareView.Focus = true;
					}

				// Clear pending navigation information
				g_PendingNavigationFolder = "";
				g_PendingNavigationSelectionID = "";
			}
			
			// Register folder browse with URL navigator
			SetNavigateURL(i_FolderID, false);

			// Update command bar state
			UpdateCommandStateInformation(COMMAND_BAR_BUTTON_UPFOLDER | COMMAND_BAR_BUTTON_ALL_VIEW_STYLE);
		}
	}

	function MainUIGlue_DocumentShareEngine_OnFolderViewStyleChange(i_pEngine, i_UserURL, i_FolderID, i_ViewStyle)
	{
		// Update command bar state
		UpdateCommandStateInformation(COMMAND_BAR_BUTTON_ALL_VIEW_STYLE);
	}
	function MainUIGlue_DocumentShareEngine_OnRenameShareObject(i_pEngine, i_ParentFolderID, i_ShareObjectID, i_OldFullName, i_NewFullName)
	{
		var bUpdateDisplayedPathInfo = false;

		// Update browsed folder info (if necessary)
		var FolderID = DocumentShareView.OpenBrowsedFolderID();

		do
		{
			if(i_ShareObjectID == FolderID)
			{
				bUpdateDisplayedPathInfo = true;
				break;
			}

			if(FolderID != g_RootFolderID)
				FolderID = DocumentShareEngine.Data.OpenParentFolderID(FolderID);

		}while(FolderID != g_RootFolderID)
		
		if(bUpdateDisplayedPathInfo)
		{
			// Update navigation URL
			SetNavigateURL(DocumentShareView.OpenBrowsedFolderID(), false);
		}
	}

	// ----------------------------------------------------------------------------
	// End IGrooveDocumentShareCommandSink Events implementation
	// ----------------------------------------------------------------------------

	// ----------------------------------------------------------------------------
	// Helpers
	// ----------------------------------------------------------------------------
	

	function MainUIGlue_OnPropertyChanged(i_Key, i_Value, i_LocallyGenerated)
	{
		if(i_Key == DOCUMENT_SHARE_TOOL_PROPERTY_SHOW_TOOLBAR_MENU)
		{
			if(typeof UICommandContainer != "undefined")
			{
				// Refresh UI Commands by hiding and showing
				HideUICommands();
				ShowUICommands();
			}
		}
	}

	function GetFolderViewStyle()
	{
		// Update view style command bar buttons with current view style
		var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
		var pShareObject;

		var pTransaction = g_pTelespace.OpenTransaction(true);

		try
		{
			if(DocumentShareEngine.Data.DoesShareObjectExistByID(BrowsedFolderID))
				pShareObject = DocumentShareEngine.Data.OpenShareObjectByID(BrowsedFolderID);
		}
		finally
		{
			pTransaction.Commit();
		}
		
		var ViewStyle = GrooveFolderViewStyle_Details;

		if(pShareObject)
		{
			if (GetShareObjectType(pShareObject) == "Folder")
			{
				if(pShareObject.Folder.DoesViewStyleExistByMemberContactURL(g_ContactURL) == false)
				{
					ViewStyle = DocumentShareView.Properties.GetDefaultViewStyle();
				}
				else
				{
					ViewStyle = pShareObject.Folder.OpenViewStyleByMemberContactURL(g_ContactURL);
				}
			}
		}

		return ViewStyle;
	}



	function UpdateCommandStateInformation(i_CommandTypes)
	{

		if (typeof UICommandContainer == "undefined" || bCommandsShown == false)
			return;

		if (i_CommandTypes & COMMAND_BAR_BUTTON_UPFOLDER)
		{	
			if(UICommandContainer.UICommandExists(DOCUMENT_SHARE_TOOL_COMMAND_UPFOLDER))
			{
				var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
				var pShareObject;

				var pTransaction = g_pTelespace.OpenTransaction(true);

				try
				{
					if(DocumentShareEngine.Data.DoesShareObjectExistByID(BrowsedFolderID))
						pShareObject = DocumentShareEngine.Data.OpenShareObjectByID(BrowsedFolderID);
				}
				finally
				{
					pTransaction.Commit();
				}


				if (BrowsedFolderID != "")
				{
					if (BrowsedFolderID == g_RootFolderID)
						g_IsUpFolderCmdEnabled = false;
					else
						g_IsUpFolderCmdEnabled = true;
				}
				else
					g_IsUpFolderCmdEnabled = false;
			}
		}
	}


	function SetCommandBarButtonStateBasedOnSelection(i_CommandBarButtonURL)
	{
		if(UICommandContainer.UICommandExists(i_CommandBarButtonURL))
		{
			// Get command bar button
			var pCommand = UICommandContainer.OpenUICommand(i_CommandBarButtonURL);

			// Set enabled state of command bar button
			if (DocumentShareView.DocumentShareView.OpenShareObjectSelectionCount() > 0)
				pCommand.Enabled = true;
			else
				pCommand.Enabled = false;
		}
	}

	function SetViewStyleCommandBarButtonState(i_CommandBarButtonURL, i_FolderViewStyle)
	{
		if(UICommandContainer.UICommandExists(i_CommandBarButtonURL))
		{
			// Get command bar button
			var pCommand = UICommandContainer.OpenUICommand(i_CommandBarButtonURL);

			if (g_CurrentFolderViewStyle == i_FolderViewStyle)
				pCommand.CheckState = GrooveCheckState_Checked;
			else
				pCommand.CheckState = GrooveCheckState_Unchecked;
		}
	}

	function ShowCommandBarButtons()
	{
		var pCommand;
		var Position = UICommandContainer.GetNumberOfUICommands();
		var Offset = 0;
		var Width = ICON_WIDTH;
		var Height = ICON_HEIGHT;


		if (!CustomCommands)
			SetDefaultCommandIndex();

		for (i=0; i<TBCommandArrayIndex.length; i++)

		{
			switch(TBCommandArrayIndex[i].toString())

			{
			case "0":
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[0], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_ADDFILE_TOOLTIP;
				pCommand.Label = DOCUMENT_SHARE_TOOL_COMMAND_ADDFILE_LABEL;
				Offset = Width * 18;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				// Default to disabled
				pCommand.Enabled = false;
				Position++;
				break
			
			case "1":
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[1], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_UPFOLDER_TOOLTIP;
				Offset = Width * 19;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				Position++;
				break

			case "2":
				// Add "Separator"
				UICommandContainer.InsertSeparator(TBCommandArray[2], Position);
				Position++
				break	
				
			case "3":
				break

			case "4":
				// Add "Copy" command to command bar
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[4], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_COPY_TOOLTIP;
				Offset = Width * 3;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				Position++;
				break
				

				
			case "5":
				// Add "Paste" command to command bar
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[5], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_PASTE_TOOLTIP;
				Offset = Width * 5;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				Position++;
				break
				

			case "6":
				// Add "Separator"
				UICommandContainer.InsertSeparator(TBCommandArray[6], Position);
				Position++
				break
				

			case "7":
				// Add "Undo" command to command bar
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[7], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_UNDO_TOOLTIP;
				Offset = Width * 24;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				// Default to disabled
				pCommand.Enabled = false;
				Position++;
				break					
				

			case "8":
				// Add "Redo" command to command bar			
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[8], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_REDO_TOOLTIP;
				Offset = Width * 25;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				// Default to disabled
				pCommand.Enabled = false;
				Position++;
				break
				
				
			case "9":
				// Add "Separator"
				UICommandContainer.InsertSeparator(TBCommandArray[9], Position);
				Position++
				break

				
				
			case "10":
				// Add "Delete" command to command bar
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[10], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_DELETE_TOOLTIP;
				Offset = Width * 16;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				// Default to disabled
				pCommand.Enabled = false;
				Position++;
				break
				
				
			case "11":
			// Add "Properties" command to command bar
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[11], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_PROPERTIES_TOOLTIP;
				Offset = Width * 91;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				Position++;
				break
				
			
			case "12":
			// Add "Separator"
				UICommandContainer.InsertSeparator(TBCommandArray[12], Position);
				Position++
				break
		
			case "13":
			// Add "Previous unread" command to command bar
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[13], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_PREVIOUSUNREAD_TOOLTIP;
				Offset = Width * 6;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				Position++;
				break

			case "14":
			// Add "Next unread" command to command bar
				pCommand = UICommandContainer.InsertUICommand(TBCommandArray[14], Position);
				pCommand.Tooltip = DOCUMENT_SHARE_TOOL_COMMAND_NEXTUNREAD_TOOLTIP;
				Offset = Width * 7;
				pCommand.SetImage(g_ImagesURL, g_ImagesMaskURL, Offset, Width, Height);
				Position++;
				break
			}

		}
					
		// Update command bar buttons
		UpdateCommandStateInformation(COMMAND_BAR_BUTTON_UPFOLDER | 
							COMMAND_BAR_BUTTON_ALL_VIEW_STYLE);
	}


	
	//EMOC: For dyanamic menu support
	function BuildDynamicFileMenuItems(i_CommandContainer)
	{
		if (i_CommandContainer)
		{
			if((DoesComponentHaveFocus() && !(GetDisplayFolderTreeView() && ComponentHasFocus(GetFolderTreeViewComponentName()))) ||
				(!DoesComponentHaveFocus() && !GetDisplayFolderTreeView()))
			{
				if(DocumentShareView.DocumentShareView.OpenShareObjectSelectionCount() > 0)
				{
					var RepresentativeShareObjectID = GetRepresentativeShareObjectID();
					if((typeof RepresentativeShareObjectID != "undefined") &&
							(RepresentativeShareObjectID != ""))
					{
						// Get selected share object operations
						g_SelectedShareObjectOperations = DocumentShareView.DocumentShareView.OpenShareObjectOperations(RepresentativeShareObjectID);
						
						while(g_SelectedShareObjectOperations.HasMore())
						{
							var pShareObjectOperation = g_SelectedShareObjectOperations.OpenNext();

							pCommand = i_CommandContainer.InsertUICommand("DocumentShareToolMenu_File_DynMenu_"+pShareObjectOperation.Action, g_FileDocumentCC.GetNumberOfUICommands());
							pCommand.Label = pShareObjectOperation.MenuDisplayName;
							pCommand.Default = pShareObjectOperation.IsDefault;
							pCommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
						}

						g_SelectedShareObjectOperations.Reset();
					}
				}
			}
		}
	}

	function BuildDynamicNewFileMenuItems(i_CommandContainer)
	{
		if (i_CommandContainer)
		{
			//	If we have the permission to add files, then show the ShellNew documents.

			var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
			//if (DocumentShareEngine.DocumentShareEngine.CanAddFile(BrowsedFolderID))
			//{
				//	Filter the list for accepted file types.

				var pShellNewDescriptor;
				var DisplayName;
				var ShellNewCount = 0;

				//	Enumerate descriptors and add menu items.

				g_pShellNewDescriptorEnum.Reset();
				while (g_pShellNewDescriptorEnum.HasMore())
				{
					pShellNewDescriptor = g_pShellNewDescriptorEnum.OpenNext();	

					//	Get the extension name and see if it's one of our accepted types.

					if (DocumentShareEngine.Properties.IsAcceptedFileType(pShellNewDescriptor.Extension))
					{
						//	It's an accepted type.  If it's the first time, add a separator.

						if (ShellNewCount == 0)
						{
							//	Insert separator

							i_CommandContainer.InsertSeparator(DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_SEPARATOR1, i_CommandContainer.GetNumberOfUICommands());
						}

						//	Get the display name and append the item.

						pCommand = i_CommandContainer.InsertUICommand("DocumentShareToolMenu_File_ShellNewDynMenu_"+ShellNewCount, i_CommandContainer.GetNumberOfUICommands());
						pCommand.Label = pShellNewDescriptor.DisplayName;
						pCommand.Listener = ScriptHostComponent.IGrooveUICommandListener;
						ShellNewCount++;
					}
			//	}
			}
		}
	}

	function GetRepresentativeShareObjectID()
	{
		var ShareObjectID = "";

		if(DoesComponentHaveFocus() ||
			(!DoesComponentHaveFocus() && !GetDisplayFolderTreeView()))
		{
			if(GetDisplayFolderTreeView() && ComponentHasFocus(GetFolderTreeViewComponentName()))
			{
				ShareObjectID = GetFolderTreeViewSelectionID();
			}
			else
			{
				if(DocumentShareView.DocumentShareView.DoesShareObjectHaveFocus())
				{
					// Open share object ID with focus
					var ShareObjectIDWithFocus = DocumentShareView.DocumentShareView.OpenShareObjectWithFocus();

					if(DocumentShareView.DocumentShareView.IsShareObjectSelected(ShareObjectIDWithFocus))
					{
						// Use share object with focus as representative share object
						ShareObjectID = ShareObjectIDWithFocus;
					}
					else
					{
						var pShareObjectSelection = DocumentShareView.DocumentShareView.OpenShareObjectSelectionEnum();

						if(pShareObjectSelection.HasMore())
						{
							// Use first share object in selection as representative
							var pShareObject = pShareObjectSelection.OpenNext();
							ShareObjectID = pShareObject.ShareObject.ID;
						}
					}
				}
				else
				{
					var pShareObjectSelection = DocumentShareView.DocumentShareView.OpenShareObjectSelectionEnum();

					if(pShareObjectSelection.HasMore())
					{
						// Use first share object in selection as representative
						var pShareObject = pShareObjectSelection.OpenNext();
						ShareObjectID = pShareObject.ShareObject.ID;
					}
				}
			}
		}

		return ShareObjectID;
	}

	function SortBrowsedFolder(i_SortInfo)
	{
		// Create new folder in currently browsed folder
		var BrowsedFolderID = DocumentShareView.OpenBrowsedFolderID();
		var SessionName = DocumentShareView.DocumentShareView.OpenUIUndoRedoSessionName();
		var ConflictRegion = DocumentShareEngine.DocumentShareEngine.OpenConflictRegion();

		var PrevSortType;
		var NewSortType = GrooveFolderViewSortType_Ascending;
		var pTransaction = g_pTelespace.OpenTransaction(false);

		try
		{
			if(DocumentShareEngine.Data.DoesShareObjectExistByID(BrowsedFolderID))
			{
				var pShareObject = DocumentShareEngine.Data.OpenShareObjectByID(BrowsedFolderID);

				if(pShareObject.Folder.DoesSortInformationExistByMemberContactURL(g_ContactURL))
				{
					var PrevSortColumn = pShareObject.Folder.OpenSortColumnByMemberContactURL(g_ContactURL);
					PrevSortType = pShareObject.Folder.OpenSortTypeByMemberContactURL(g_ContactURL);

					if(PrevSortColumn == i_SortInfo)
					{
						if(PrevSortType == GrooveFolderViewSortType_Ascending)
							NewSortType = GrooveFolderViewSortType_Descending;
						else
							NewSortType = GrooveFolderViewSortType_Ascending;
					}

				}

				DocumentShareEngine.DocumentShareEngine.SetFolderViewSort(BrowsedFolderID, 
								i_SortInfo, 
								NewSortType);
			}
		}
		finally
		{
			pTransaction.Commit();
		}
	}

	function SafeDeleteShareObjects(i_pIDEnum, i_ShowConfirmDialog)
	{
		try
		{
			DocumentShareView.Commands.DeleteShareObjects(i_pIDEnum, i_ShowConfirmDialog);
		}
		catch(Error)
		{
			//if(Error == 0x80070005L)
			//{
				// Display delete warning dialog box
				DisplayDeleteWarningDlg();
			//}
			//else
			//	throw Error;
		}
			

	}


	function DisplayAddFileLimitWarningDlg()
	{
		// Display dialog box 
		var pApp = GrooveScriptFunctions.CreateNewObject("Groove.Application");
		var pAccount = PropertyList.OpenProperty(PROPERTY_TELESPACE_PROVIDER);
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var RetVal = pApp.GrooveMessageBox(Window, 
						pAccount, 
						DOCUMENT_SHARE_TOOL_ADD_FILE_LIMIT_MSG, 
						DOCUMENT_SHARE_TOOL_ADD_FILE_LIMIT_TITLE,
						GrooveMessageBoxStyle_OK, 
						GrooveMessageBoxIcon_Warning);
	}

	function DisplayAddFilePermissionsWarningDlg()
	{
		// Display dialog box 
		var pApp = GrooveScriptFunctions.CreateNewObject("Groove.Application");
		var pAccount = PropertyList.OpenProperty(PROPERTY_TELESPACE_PROVIDER);
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var RetVal = pApp.GrooveMessageBox(Window, 
						pAccount, 
						DOCUMENT_SHARE_TOOL_ADD_FILE_PERMISSIONS_MSG, 
						DOCUMENT_SHARE_TOOL_ADD_FILE_PERMISSIONS_TITLE,
						GrooveMessageBoxStyle_OK, 
						GrooveMessageBoxIcon_Warning);
	}

	function DisplayDeleteWarningDlg()
	{
		// Display dialog box 
		var pApp = GrooveScriptFunctions.CreateNewObject("Groove.Application");
		var pAccount = PropertyList.OpenProperty(PROPERTY_TELESPACE_PROVIDER);
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var RetVal = pApp.GrooveMessageBox(Window, 
						pAccount, 
						DOCUMENT_SHARE_TOOL_DELETE_WARNING_MSG, 
						DOCUMENT_SHARE_TOOL_DELETE_TITLE,
						GrooveMessageBoxStyle_OK, 
						GrooveMessageBoxIcon_Warning);
	}
	function DisplayUndoPermissionsWarningDlg()
	{
		// Display dialog box 
		var pApp = GrooveScriptFunctions.CreateNewObject("Groove.Application");
		var pAccount = PropertyList.OpenProperty(PROPERTY_TELESPACE_PROVIDER);
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var RetVal = pApp.GrooveMessageBox(Window, 
						pAccount, 
						DOCUMENT_SHARE_TOOL_UNDO_WARNING_MSG, 
						DOCUMENT_SHARE_TOOL_UNDO_TITLE,
						GrooveMessageBoxStyle_OK, 
						GrooveMessageBoxIcon_Warning);
	}
	function DisplayRedoPermissionsWarningDlg()
	{
		// Display dialog box 
		var pApp = GrooveScriptFunctions.CreateNewObject("Groove.Application");
		var pAccount = PropertyList.OpenProperty(PROPERTY_TELESPACE_PROVIDER);
		var Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		var RetVal = pApp.GrooveMessageBox(Window, 
						pAccount, 
						DOCUMENT_SHARE_TOOL_REDO_WARNING_MSG, 
						DOCUMENT_SHARE_TOOL_REDO_TITLE,
						GrooveMessageBoxStyle_OK, 
						GrooveMessageBoxIcon_Warning);
	}
	function SetNavigateURL(i_BrowsedFolderID, i_bAddToHistory)
	{
		if(typeof UIPropertyList != "undefined")
		{
			var TelespaceName = g_pTelespace.DisplayName;
			var ToolName = OpenToolDisplayName();
			var DisplayPath = DocumentShareView.DocumentShareView.OpenShareObjectDisplayPath(i_BrowsedFolderID, false);
			var URL = DocumentShareEngine.Data.OpenBindableShareObjectURL(i_BrowsedFolderID);


			var LongName;
			if((typeof DisplayPath != "undefined") &&
					(DisplayPath != ""))
			{
				LongName = TelespaceName + " - " + ToolName + " : " + DisplayPath;
			}
			else
			{
				LongName = TelespaceName + " - " + ToolName;
			}


			var ShortName;
			if((typeof DisplayPath != "undefined") &&
					(DisplayPath != ""))
			{
				ShortName = ToolName + " : " + DisplayPath;
			}
			else
			{
				ShortName = ToolName;
			}

			if(UIPropertyList.PropertyExists(UIPROPERTY_URLNAVIGATOR))
			{
				var pURLNavigator = UIPropertyList.OpenProperty(UIPROPERTY_URLNAVIGATOR);
				pURLNavigator.SetCurrentURL(URL, LongName, ShortName, i_bAddToHistory);
			}
		}
	}

	function OpenToolDisplayName()
		{
		var pTool = PropertyList.OpenProperty(PROPERTY_TOOL);

		var ToolDisplayName = pTool.DisplayName;

		return ToolDisplayName;

		}

	function IsBindableShareObjectURL(i_URL)
	{
		var pURL = GROOVE_GLOBAL_MISC_POINTER.OpenURI(i_URL);
		
		// Should have FindPathSegment() call on IGrooveURI
		var PathSegmentEnum = pURL.PathSegments;
		var PathSegment;

		// HACK - Check all path segments until find "_ComponentData" segment
		while(PathSegmentEnum.HasMore())
		{
			// Open path segment
			PathSegment = PathSegmentEnum.OpenNext();
			
			if(PathSegment == "_ComponentData")
				return true;

		}

		return false;
	}


	function int_OnNavigate(i_pURLNavigator, i_URL, i_bAddToHistory, i_bExecuteFile)
	{
		var BrowseFolderID;
		if (IsBindableShareObjectURL(i_URL))
		{
			// Let document share engine bind to the share object
			var pURLManager = GrooveScriptFunctions.CreateNewObject("Groove.URLManager");

			try {
				var URLBindResult = pURLManager.BindToURL2(i_URL);
				var pShareObject = URLBindResult.Object;

				var ShareObjectID = pShareObject.ShareObject.ID;
				if(pShareObject.ShareObject.Type == "Folder")
				{
					BrowseFolderID = ShareObjectID;
				}
				else
				{
					BrowseFolderID = DocumentShareEngine.Data.OpenParentFolderID(ShareObjectID);
					// Select file (if file)
					if(pShareObject.ShareObject.Type == "File")
					{
						// HACK - Setting these globals to indicate when
						// navigation occurs
						g_PendingNavigationFolder = BrowseFolderID;
						g_PendingNavigationSelectionID = ShareObjectID;
					}
				}

				// Browse to appropriate folder
				DocumentShareView.Commands.BrowseFolder(BrowseFolderID);

				if(pShareObject.ShareObject.Type == "File")
				{
					// Execute file
					if (i_bExecuteFile)
						DocumentShareView.Commands2.ExecuteActionOnShareObject2(ShareObjectID);

					// Select file
					var pIDEnum = CreateBSTREnum();
					pIDEnum.Add(ShareObjectID);

					DocumentShareView.DocumentShareView.ClearAllShareObjectSelections();
					DocumentShareView.DocumentShareView.SetShareObjectSelection(pIDEnum, true);
				}
			}
			catch(Error)
			{
				// Display warning that cannot find share object to
				// navigate to
				DisplayNavigateShareObjectWarning();

				// Navigate to root share folder by default
				BrowseFolderID = DocumentShareEngine.Data.OpenRootShareFolderID();
			}

		}
		else
			BrowseFolderID = DocumentShareView.OpenBrowsedFolderID();
		
		ActivateDefaultView(PropertyList);
		SetNavigateURL(BrowseFolderID, i_bAddToHistory)
	}

	// ----------------------------------------------------------------------------
	// Public methods
	// ----------------------------------------------------------------------------
	// Include this function if you want to allow the consumer of this delegate
	// to pass in their own toolbar which this delegate will use instead of the 
	// global one.  Note that the consumer must pass in their toolbar in their
	// OnSetUIProperties call, NOT in their Initialize since we are not sited yet
	// and will fail when trying to insert the commands.

	function SetCustomToolBar(i_ToolBarComponent)
	{
		if (typeof UICommandContainer != "undefined")
		{
			HideUICommands();
			DisconnectObject(UICommandContainer);
		}
	
		CustomTB = true;
		UICommandContainer = i_ToolBarComponent;
		ConnectObject(UICommandContainer, "UICommandContainer");

		ShowUICommands();		
	}

	function SetShowCommandBar(i_bShowCommandBar)
	{
		g_ShowCommandBar = i_bShowCommandBar;
	}

	function GetShowCommandBar()
	{
		return g_ShowCommandBar;
	}


	function SetShowToolbarMenu(i_ShowToolbarMenu)
	{
		var Value;

		if(i_ShowToolbarMenu)
			Value = "true";
		else
			Value = "false";

		PropertyList.SetProperty(DOCUMENT_SHARE_TOOL_PROPERTY_SHOW_TOOLBAR_MENU, Value, GroovePropertyFlag_Private);
	}

	function GetShowToolbarMenu()
	{
		var TrueValue = "true";
		var FalseValue = "false";

		if(PropertyList.PropertyExists(DOCUMENT_SHARE_TOOL_PROPERTY_SHOW_TOOLBAR_MENU))
		{
			var ShowToolbarMenu = PropertyList.OpenProperty(DOCUMENT_SHARE_TOOL_PROPERTY_SHOW_TOOLBAR_MENU);

			if(ShowToolbarMenu.toLowerCase() == TrueValue.toLowerCase())
			{
				return true;
			}
			else
			{
				return false;
			}
		}
		else
		{
			// Default to displaying toolbar menu
			return true;
		}
	}

	function SafeDeleteSelection(i_ShowConfirmDialog)
	{
		try
		{
			if(DoesComponentHaveFocus() ||
				(!DoesComponentHaveFocus() && !GetDisplayFolderTreeView()))
			{
				if(GetDisplayFolderTreeView() && ComponentHasFocus(GetFolderTreeViewComponentName()))
				{
					// Delete selection in the folder tree view
					var pIDEnum = CreateBSTREnum();
					pIDEnum.Add(GetFolderTreeViewSelectionID());
					DocumentShareView.Commands.DeleteShareObjects(pIDEnum, i_ShowConfirmDialog);
				}
				else
				{
					// Delete selection in the document share view
					DocumentShareView.Commands.DeleteSelection(i_ShowConfirmDialog);
				}
			}		
		}
		catch(Error)
		{
			//if(Error == 0x80070005L)
			//{
				// Display delete warning dialog box
				DisplayDeleteWarningDlg();
			//}
			//else
			//	throw Error;
		}
			

	}

	function SafeUndo()
	{
		try
		{
			DocumentShareView.Commands.Undo();
		}
		catch(Error)
		{
			//if(Error == 0x80070005L)
			//{
				// Display undo warning dialog box
				DisplayUndoPermissionsWarningDlg()
			//}
			//else
			//	throw Error;
		}
			

	}

	function SafeRedo()
	{
		try
		{
			DocumentShareView.Commands.Redo();
		}
		catch(Error)
		{
			//if(Error == 0x80070005L)
			//{
				// Display redo warning dialog box
				DisplayRedoPermissionsWarningDlg()
			//}
			//else
			//	throw Error;
		}
			

	}

	function DisplayNavigateShareObjectWarning()
	{
		// Display navigate share object warning
		var pApp = GrooveScriptFunctions.CreateNewObject("Groove.Application");
		var pAccount = PropertyList.OpenProperty(PROPERTY_TELESPACE_PROVIDER);
		var Window;
		if (UIPropertyList.PropertyExists(UIPROPERTY_TOP_LEVEL_WINDOW))
			Window = UIPropertyList.OpenProperty(UIPROPERTY_TOP_LEVEL_WINDOW);
		else
			Window = GrooveScriptFunctions.CreateNewObject("");
		var RetVal = pApp.GrooveMessageBox(Window, 
						pAccount, 
						DOCUMENT_SHARE_TOOL_FILE_NOT_FOUND_WARNING_MSG, 
						DOCUMENT_SHARE_TOOL_FILE_NOT_FOUND_TITLE,
						GrooveMessageBoxStyle_OK, 
						GrooveMessageBoxIcon_Warning);
	}


	function SetComponentFocus(i_pUIActiveUnknown)
	{
		UIPropertyList.SetProperty(UI_PROPERTY_UIACTIVE_COMPONENT, i_pUIActiveUnknown, false);
	}

	function ComponentHasFocus(i_Name)
	{
		// See if the specified control currently has focus
		if (UIPropertyList.PropertyExists(UI_PROPERTY_UIACTIVE_COMPONENT))
		{
			var UIActiveUnknown = UIPropertyList.OpenProperty(UI_PROPERTY_UIACTIVE_COMPONENT);
			var UIActiveComponent = UIActiveUnknown.Component;
			if(typeof UIActiveComponent != "undefined")
			{
				if (UIActiveComponent.OpenName() == i_Name)
					return true;
				else
					return false;
			}
			else
				return false;
		}
		else
			return false;
	}

	function DoesComponentHaveFocus()
	{
		// See if a component currently has focus
		if (UIPropertyList.PropertyExists(UI_PROPERTY_UIACTIVE_COMPONENT))
		{
			var UIActiveUnknown = UIPropertyList.OpenProperty(UI_PROPERTY_UIACTIVE_COMPONENT);
			var UIActiveComponent = UIActiveUnknown.Component;
			if(typeof UIActiveComponent != "undefined")
				return true;
			else
				return false;
		}
		else
			return false;
	}


	function SetCustomCommands(i_CommandArrayIndex)
	{

		//We need to hide the commands if they are currently being shown because we are getting a new set

		if (bCommandsShown)
			HideUICommands();

		// Set the index array to only the one's that the user wants displayed
	
		//Clear out the current command index

		delete TBCommandArrayIndex;
		TBCommandArrayIndex = new Array();
	
		for (i=0; i<i_CommandArrayIndex.length; i++)
		{

		TBCommandArrayIndex[i] = i_CommandArrayIndex[i];
		CustomCommands = true;

		}

		ShowUICommands();
	}

	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 @           *  8  +      ,      -      .  »  	           ÅA ÅA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              @               Ä(null),0                             Äurn:groove.net:Document       Äxmlns:g   u r n : g r o o v e . n e t   U   ÄName@   G r o o v e D o c u m e n t S h a r e T o o l G l u e 4 . g s l   E 	      ÄSCRIPTMODULE     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT     ÄSCRIPT	   
  ÄIMPLEMENTS
     ÄSCRIPTINTERFACE   
  ÄIMPLEMENTS     Ä//EMOC: For dynamic menu support ÄIMPL  ÄSCRIPTMODULE            ÄSCRIPT     ÄSCRIPT  //EMOC  ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       u n                      ÄSCRIPT       ÄSRC2  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e G l o b a l H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 , 1 & F a c t o r y = O p e n       _ G  ÄSCRIPT       ÄSRC8  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l s . G e n e r a l . D o c u m e n t S h a r e . G r o o v e D o c u m e n t S h a r e _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   n     L &  ÄSCRIPT       ÄSRC,  h t t p : / / c o m p o n e n t s . g r o o v e . n e t / G r o o v e / C o m p o n e n t s / R o o t . o s d ? P a c k a g e = n e t . g r o o v e . G r o o v e . T o o l C o m p o n e n t s . G r o o v e A r r a y H e l p e r F u n c t i o n s _ G S L & V e r s i o n = 0 & F a c t o r y = O p e n   D     r s i o
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }   n   ÄIIDL   { 5 1 B F 8 1 E 1 - 6 D E 7 - 1 1 D 2 - 9 4 6 1 - 0 0 8 0 C 7 D E 3 2 C 6 }   E       ÄSCRIPT   2 C 6   ÄSCRIPT
         ñ  Ä
			function OnNavigate(i_pURLNavigator, i_URL, i_bAddToHistory)
			{
				int_OnNavigate(i_pURLNavigator, i_URL, i_bAddToHistory, false);
			}
		story,   ÄSCRIPTINTERFACE       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 d 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }   h   ÄIIDL   { C 6 8 0 0 A 8 4 - 8 7 3 D - 4 1 b 5 - A 3 D 9 - 6 8 3 6 F D B 9 1 E 7 D }   C    ° Ä

			function OnUpdateContainerState2 (i_Container)
			{
				if ((i_Container.CommandURL == "GUICC_FileNewToolCommands")
					&& !g_ShellNewDescriptorsOpened 
					&& DocumentShareView.Properties.GetShowParentFolderContextMenu())
				{
					g_pShellNewDescriptorEnum = DocumentShareView.DocumentShareViewPrivate.OpenShellNewDescriptors();
					g_ShellNewDescriptorsOpened = true;


					BuildDynamicNewFileMenuItems(i_Container);
				}
			}

			function OnCommand2 (i_Container, i_UICommand)
			{
				ExecuteCommand(i_UICommand);
			}

			function OnUpdateCommandState2 (i_Container, i_UICommand)
			{
				UpdateCommandState(i_UICommand);
			}

		nd)
  ÄIMPLEMENTS       ÄLIBIDL   { 4 2 5 3 A 6 4 1 - 5 F A 3 - 1 1 D 2 - 9 8 C 2 - 0 0 8 0 C 7 E 3 0 B A 4 }   n   ÄIIDL   { D B 8 2 1 8 2 2 - 5 C 7 6 - 4 2 1 5 - A 5 B 4 - 4 0 8 D 2 9 F 9 C 5 5 2 }   D       ÄSCRIPT  RIPT   ÄSCRIPT         Ω  Ä

			function OnCommand(i_UICommand)
			{
				ExecuteCommand(i_UICommand);
			}

			function OnUpdateCommandState(i_UICommand)
			{
				UpdateCommandState(i_UICommand);
			}

		                                                                                                                                                                                                                                                                                                                                ∏ÿ    D·    Ñ}   (±    ¥·            Q   X]   ¨U   û      U   – :      Z         )            ÄSCRIPT         ‘0 Ä
	
			var pIntl = GrooveScriptFunctions.CreateNewObject("Groove.Internationalization");
			var pBundle = pIntl.CreateResourceBundle("http://components.groove.net/Groove/Components/Root.osd?Package=net.groove.Groove.Tools.General.DocumentShare.DocumentShareTool_RBD&Version=0", pIntl.DefaultLocale);

			//
			//////////////  TOOLBAR STRINGS /////////////////////////////////////
			//
			//////////////  Toolbar menu strings ///////////////////////
			//
			// Static menu IDs
			//
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE="DocumentShareToolMenu_File";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ACTION="DocumentShareToolMenu_File_Action_";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_SEPARATOR1="DocumentShareToolMenu_File_Separator1";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_ADD="DocumentShareToolMenu_File_Add";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW="DocumentShareToolMenu_File_New";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_FOLDER="DocumentShareToolMenu_File_New_Folder";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PERMISSIONS="DocumentShareToolMenu_File_Permissions";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PROPERTIES="DocumentShareToolMenu_File_Properties";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT="DocumentShareToolMenu_Edit";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO="DocumentShareToolMenu_Edit_Undo";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO="DocumentShareToolMenu_Edit_Redo";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SEPARATOR1="DocumentShareToolMenu_Edit_Separator1";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY="DocumentShareToolMenu_Edit_Copy";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK="DocumentShareToolMenu_Edit_CopyAsLink";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE="DocumentShareToolMenu_Edit_Paste";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SEPARATOR2="DocumentShareToolMenu_Edit_Separator2";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SELECTALL="DocumentShareToolMenu_Edit_SelectAll";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_DELETE="DocumentShareToolMenu_Edit_Delete";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_RENAME="DocumentShareToolMenu_Edit_Rename";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLREAD = "DocumentShareTool_Edit_MarkAllRead";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKALLUNREAD = "DocumentShareTool_Edit_MarkAllUnRead";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDUNREAD = "DocumentShareTool_Edit_MarkSelectedUnRead";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_MARKSELECTEDREAD = "DocumentShareTool_Edit_MarkSelectedRead";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW="DocumentShareToolMenu_View";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_FOLDERS="DocumentShareToolMenu_View_Folders";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_SEPARATOR1="DocumentShareToolMenu_View_Separator1";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS="DocumentShareToolMenu_View_ArrangeIcons";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_NAME="DocumentShareToolMenu_View_ArrangeIcons_Name";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_TYPE="DocumentShareToolMenu_View_ArrangeIcons_Type";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_SIZE="DocumentShareToolMenu_View_ArrangeIcons_Size";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_MODIFIEDDATE="DocumentShareToolMenu_View_ArrangeIcons_ModifiedDate";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_ARRANGEICONS_MODIFIEDBY="DocumentShareToolMenu_View_ArrangeIcons_ModifiedBy";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_SEPARATOR3="DocumentShareToolMenu_View_Separator3";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_NEXTUNREAD = "DocumentShareToolMenu_View_NextUnread";
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_VIEW_PREVIOUSUNREAD = "DocumentShareToolMenu_View_PreviousUnread";
			//
			// Static menu labels
			//
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_LABEL = GetString(pBundle, "DocShare_ML_FILE");
			var DOCUMENT_SHARE          _TOOL_COMMAND_MENU_FILE_ADD_LABEL = GetString(pBundle, "DocShare_ML_ADDFLS");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_LABEL = GetString(pBundle, "DocShare_ML_NEW");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_NEW_FOLDER_LABEL = GetString(pBundle, "DocShare_ML_FLD");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_DELETE_LABEL = GetString(pBundle, "DocShare_ML_DEL");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_RENAME_LABEL = GetString(pBundle, "DocShare_ML_RNM");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PERMISSIONS_LABEL = GetString(pBundle, "DocShare_ML_PRM");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_FILE_PROPERTIES_LABEL = GetString(pBundle, "DocShare_ML_PRP");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_LABEL = GetString(pBundle, "DocShare_ML_EDT");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_UNDO_LABEL = GetString(pBundle, "DocShare_ML_UNDO");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_REDO_LABEL = GetString(pBundle, "DocShare_ML_REDO");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_CUT_LABEL = GetString(pBundle, "DocShare_ML_CUT");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPY_LABEL = GetString(pBundle, "DocShare_ML_CPY");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_COPYASLINK_LABEL = GetString(pBundle, "DocShare_ML_CLNK");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_PASTE_LABEL = GetString(pBundle, "DocShare_ML_PST");
			var DOCUMENT_SHARE_TOOL_COMMAND_MENU_EDIT_SELECTALL_LABEL = GetString(pBundle, "DocShar