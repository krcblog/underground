e;}else{div.createChild('div','background-service-metadata-value background-service-empty-value').textContent=ls`empty`;}
preview.element.appendChild(div);}
if(!preview.element.children.length){const div=createElementWithClass('div','background-service-metadata-entry');div.createChild('div','background-service-metadata-name').textContent=ls`No metadata for this event`;preview.element.appendChild(div);}
return preview;}};Resources.BackgroundServiceView.ActionDelegate=class{handleAction(context,actionId){const view=context.flavor(Resources.BackgroundServiceView);switch(actionId){case'background-service.toggle-recording':view._toggleRecording();return true;}
return false;}};;Resources.ClearStorageView=class extends UI.ThrottledWidget{constructor(){super(true,1000);const types=Protocol.Storage.StorageType;this._pieColors=new Map([[types.Appcache,'rgb(110, 161, 226)'],[types.Cache_storage,'rgb(229, 113, 113)'],[types.Cookies,'rgb(239, 196, 87)'],[types.Indexeddb,'rgb(155, 127, 230)'],[types.Local_storage,'rgb(116, 178, 102)'],[types.Service_workers,'rgb(255, 167, 36)'],[types.Websql,'rgb(203, 220, 56)'],]);this._reportView=new UI.ReportView(Common.UIString('Clear storage'));this._reportView.registerRequiredCSS('resources/clearStorageView.css');this._reportView.element.classList.add('clear-storage-header');this._reportView.show(this.contentElement);this._target=null;this._securityOrigin=null;this._settings=new Map();for(const type of Resources.ClearStorageView.AllStorageTypes)
this._settings.set(type,Common.settings.createSetting('clear-storage-'+type,true));const quota=this._reportView.appendSection(Common.UIString('Usage'));this._quotaRow=quota.appendSelectableRow();const learnMoreRow=quota.appendRow();const learnMore=UI.DisabledXLink.create('https://aka.ms/docs-landing-page',ls`Learn more`,true);learnMoreRow.appendChild(learnMore);this._quotaUsage=null;this._pieChart=new PerfUI.PieChart({chartName:ls`Storage Usage`,size:110,formatter:Number.bytesToString,showLegend:true});const usageBreakdownRow=quota.appendRow();usageBreakdownRow.classList.add('usage-breakdown-row');usageBreakdownRow.appendChild(this._pieChart.element);const clearButtonSection=this._reportView.appendSection('','clear-storage-button').appendRow();this._clearButton=UI.createTextButton(ls`Clear site data`,this._clear.bind(this));clearButtonSection.appendChild(this._clearButton);const application=this._reportView.appendSection(Common.UIString('Application'));this._appendItem(application,Common.UIString('Unregister service workers'),'service_workers');application.markFieldListAsGroup();const storage=this._reportView.appendSection(Common.UIString('Storage'));this._appendItem(storage,Common.UIString('Local and session storage'),'local_storage');this._appendItem(storage,Common.UIString('IndexedDB'),'indexeddb');this._appendItem(storage,Common.UIString('Web SQL'),'websql');this._appendItem(storage,Common.UIString('Cookies'),'cookies');storage.markFieldListAsGroup();const caches=this._reportView.appendSection(Common.UIString('Cache'));this._appendItem(caches,Common.UIString('Cache storage'),'cache_storage');this._appendItem(caches,Common.UIString('Application cache'),'appcache');caches.markFieldListAsGroup();SDK.targetManager.observeTargets(this);}
_appendItem(section,title,settingName){const row=section.appendRow();row.appendChild(UI.SettingsUI.createSettingCheckbox(title,this._settings.get(settingName),true));}
targetAdded(target){if(this._target)
return;this._target=target;const securityOriginManager=target.model(SDK.SecurityOriginManager);this._updateOrigin(securityOriginManager.mainSecurityOrigin(),securityOriginManager.unreachableMainSecurityOrigin());securityOriginManager.addEventListener(SDK.SecurityOriginManager.Events.MainSecurityOriginChanged,this._originChanged,this);}
targetRemoved(target){if(this._target!==target)
return;const securityOriginManager=target.model(SDK.SecurityOriginManager);securityOriginManager.removeEventListener(SDK.SecurityOriginManager.Events.MainSecurityOriginChanged,this._originChanged,this);}
_originChanged(event){const mainOrigin=(event.data.mainSecurityOrigin);const unreachableMainOrigin=(event.data.unreachableMainSecurityOrigin);this._updateOrigin(mainOrigin,unreachableMainOrigin);}
_updateOrigin(mainOrigin,unreachableMainOrigin){if(unreachableMainOrigin){this._securityOrigin=unreachableMainOrigin;this._reportView.setSubtitle(ls`${unreachableMainOrigin} (failed to load)`);}else{this._securityOrigin=mainOrigin;this._reportView.setSubtitle(mainOrigin);}
this.doUpdate();}
_clear(){if(!this._securityOrigin)
return;const selectedStorageTypes=[];for(const type of this._settings.keys()){if(this._settings.get(type).get())
selectedStorageTypes.push(type);}
if(this._target)
Resources.ClearStorageView.clear(this._target,this._securityOrigin,selectedStorageTypes);this._clearButton.disabled=true;const label=this._clearButton.textContent;this._clearButton.textContent=Common.UIString('Clearing...');setTimeout(()=>{this._clearButton.disabled=false;this._clearButton.textContent=label;},500);}
static clear(target,securityOrigin,selectedStorageTypes){target.storageAgent().clearDataForOrigin(securityOrigin,selectedStorageTypes.join(','));const set=new Set(selectedStorageTypes);const hasAll=set.has(Protocol.Storage.StorageType.All);if(set.has(Protocol.Storage.StorageType.Cookies)||hasAll){const cookieModel=target.model(SDK.CookieModel);if(cookieModel)
cookieModel.clear();}
if(set.has(Protocol.Storage.StorageType.Indexeddb)||hasAll){for(const target of SDK.targetManager.targets()){const indexedDBModel=target.model(Resources.IndexedDBModel);if(indexedDBModel)
indexedDBModel.clearForOrigin(securityOrigin);}}
if(set.has(Protocol.Storage.StorageType.Local_storage)||hasAll){const storageModel=target.model(Resources.DOMStorageModel);if(storageModel)
storageModel.clearForOrigin(securityOrigin);}
if(set.has(Protocol.Storage.StorageType.Websql)||hasAll){const databaseModel=target.model(Resources.DatabaseModel);if(databaseModel){databaseModel.disable();databaseModel.enable();}}
if(set.has(Protocol.Storage.StorageType.Cache_storage)||hasAll){const target=SDK.targetManager.mainTarget();const model=target&&target.model(SDK.ServiceWorkerCacheModel);if(model)
model.clearForOrigin(securityOrigin);}
if(set.has(Protocol.Storage.StorageType.Appcache)||hasAll){const appcacheModel=target.model(Resources.ApplicationCacheModel);if(appcacheModel)
appcacheModel.reset();}}
async doUpdate(){if(!this._securityOrigin)
return;const securityOrigin=(this._securityOrigin);const response=await this._target.storageAgent().invoke_getUsageAndQuota({origin:securityOrigin});if(response[Protocol.Error]){this._quotaRow.textContent='';this._resetPieChart(0);return;}
this._quotaRow.textContent=Common.UIString('%s used out of %s storage quota.\u00a0',Number.bytesToString(response.usage),Number.bytesToString(response.quota));if(response.quota<125829120){this._quotaRow.title=ls`Storage quota is limited in InPrivate mode`;this._quotaRow.appendChild(UI.Icon.create('smallicon-info'));}
if(!this._quotaUsage||this._quotaUsage!==response.usage){this._quotaUsage=response.usage;this._resetPieChart(response.usage);for(const usageForType of response.usageBreakdown.sort((a,b)=>b.usage-a.usage)){const value=usageForType.usage;if(!value)
continue;const title=this._getStorageTypeName(usageForType.storageType);const color=this._pieColors.get(usageForType.storageType)||'#ccc';this._pieChart.addSlice(value,color,title);}}
this._usageUpdatedForTest(response.usage,response.quota,response.usageBreakdown);this.update();}
_resetPieChart(total){this._pieChart.setTotal(total);}
_getStorageTypeName(type){switch(type){case Protocol.Storage.StorageType.File_systems:return Common.UIString('File System');case Protocol.Storage.StorageType.Websql:return Common.UIString('Web SQL');case Protocol.Storage.StorageType.Appcache:return Common.UIString('Application Cache');case Protocol.Storage.StorageType.Indexeddb:return Common.UIString('IndexedDB');case Protocol.Storage.StorageType.Cache_storage:return Common.UIString('Cache Storage');case Protocol.Storage.StorageType.Service_workers:return Common.UIString('Service Workers');default:return Common.UIString('Other');}}
_usageUpdatedForTest(usage,quota,usageBreakdown){}};Resources.ClearStorageView.AllStorageTypes=[Protocol.Storage.StorageType.Appcache,Protocol.Storage.StorageType.Cache_storage,Protocol.Storage.StorageType.Cookies,Protocol.Storage.StorageType.Indexeddb,Protocol.Storage.StorageType.Local_storage,Protocol.Storage.StorageType.Service_workers,Protocol.Storage.StorageType.Websql];Resources.ClearStorageView.ActionDelegate=class{handleAction(context,actionId){switch(actionId){case'resources.clear':return this._handleClear();}
return false;}
_handleClear(){const target=SDK.targetManager.mainTarget();if(!target)
return false;const resourceTreeModel=target.model(SDK.ResourceTreeModel);if(!resourceTreeModel)
return false;const securityOrigin=resourceTreeModel.getMainSecurityOrigin();if(!securityOrigin)
return false;Resources.ClearStorageView.clear(target,securityOrigin,Resources.ClearStorageView.AllStorageTypes);return true;}};;Resources.StorageItemsView=class extends UI.VBox{constructor(title,filterName){super(false);this._filterRegex=null;this._refreshButton=this._addButton(Common.UIString('Refresh'),'largeicon-refresh',this.refreshItems);this._mainToolbar=new UI.Toolbar('top-resources-toolbar',this.element);this._filterItem=new UI.ToolbarInput(Common.UIString('Filter'),0.4);this._filterItem.addEventListener(UI.ToolbarInput.Event.TextChanged,this._filterChanged,this);const toolbarSeparator=new UI.ToolbarSeparator();this._deleteAllButton=this._addButton(Common.UIString('Clear All'),'largeicon-clear',this.deleteAllItems);this._deleteSelectedButton=this._addButton(Common.UIString('Delete Selected'),'largeicon-delete',this.deleteSelectedItem);const toolbarItems=[this._refreshButton,this._filterItem,toolbarSeparator,this._deleteAllButton,this._deleteSelectedButton];for(const item of toolbarItems)
this._mainToolbar.appendToolbarItem(item);}
_addButton(label,glyph,callback){const button=new UI.ToolbarButton(label,glyph);button.addEventListener(UI.ToolbarButton.Events.Click,callback,this);return button;}
_filterChanged(event){const text=(event.data);this._filterRegex=text?new RegExp(text.escapeForRegExp(),'i'):null;this.refreshItems();}
filter(items,keyFunction){if(!this._filterRegex)
return items;return items.filter(item=>this._filterRegex.test(keyFunction(item)));}
wasShown(){this.refreshItems();}
setCanDeleteAll(enabled){this._deleteAllButton.setEnabled(enabled);}
setCanDeleteSelected(enabled){this._deleteSelectedButton.setEnabled(enabled);}
setCanRefresh(enabled){this._refreshButton.setEnabled(enabled);}
setCanFilter(enabled){this._filterItem.setEnabled(enabled);}
deleteAllItems(){}
deleteSelectedItem(){}
refreshItems(){}};;Resources.CookieItemsView=class extends Resources.StorageItemsView{constructor(model,cookieDomain){super(Common.UIString('Cookies'),'cookiesPanel');this.element.classList.add('storage-view');this._model=model;this._cookieDomain=cookieDomain;this._totalSize=0;this._cookiesTable=null;this._refreshThrottler=new Common.Throttler(300);this._eventDescriptors=[];this.setCookiesDomain(model,cookieDomain);}
setCookiesDomain(model,domain){this._model=model;this._cookieDomain=domain;this.refreshItems();Common.EventTarget.removeEventListeners(this._eventDescriptors);const networkManager=model.target().model(SDK.NetworkManager);this._eventDescriptors=[networkManager.addEventListener(SDK.NetworkManager.Events.ResponseReceived,this._onResponseReceived,this)];}
_saveCookie(newCookie,oldCookie){if(!this._model)
return Promise.resolve(false);if(oldCookie&&(newCookie.name()!==oldCookie.name()||newCookie.url()!==oldCookie.url()))
this._model.deleteCookie(oldCookie);return this._model.saveCookie(newCookie);}
_deleteCookie(cookie,callback){this._model.deleteCookie(cookie,callback);}
_updateWithCookies(allCookies){this._totalSize=allCookies.reduce((size,cookie)=>size+cookie.size(),0);if(!this._cookiesTable){this._cookiesTable=new CookieTable.CookiesTable(this._saveCookie.bind(this),this.refreshItems.bind(this),()=>this.setCanDeleteSelected(!!this._cookiesTable.selectedCookie()),this._deleteCookie.bind(this));}
const parsedURL=this._cookieDomain.asParsedURL();const host=parsedURL?parsedURL.host:'';this._cookiesTable.setCookieDomain(host);const shownCookies=this.filter(allCookies,cookie=>`${cookie.name()} ${cookie.value()} ${cookie.domain()}`);this._cookiesTable.setCookies(shownCookies);this._cookiesTable.show(this.element);this.setCanFilter(true);this.setCanDeleteAll(true);this.setCanDeleteSelected(!!this._cookiesTable.selectedCookie());}
deleteAllItems(){this._model.clear(this._cookieDomain,()=>this.refreshItems());}
deleteSelectedItem(){const selectedCookie=this._cookiesTable.selectedCookie();if(selectedCookie)
this._model.deleteCookie(selectedCookie,()=>this.refreshItems());}
refreshItems(){this._model.getCookiesForDomain(this._cookieDomain).then(this._updateWithCookies.bind(this));}
_onResponseReceived(){this._refreshThrottler.schedule(()=>Promise.resolve(this.refreshItems()));}};;Resources.Database=class{constructor(model,id,domain,name,version){this._model=model;this._id=id;this._domain=domain;this._name=name;this._version=version;}
get id(){return this._id;}
get name(){return this._name;}
set name(x){this._name=x;}
get version(){return this._version;}
set version(x){this._version=x;}
get domain(){return this._domain;}
set domain(x){this._domain=x;}
async tableNames(){const names=await this._model._agent.getDatabaseTableNames(this._id)||[];return names.sort();}
async executeSql(query,onSuccess,onError){const response=await this._model._agent.invoke_executeSQL({'databaseId':this._id,'query':query});const error=response[Protocol.Error];if(error){onError(error);return;}
const sqlError=response.sqlError;if(!sqlError){onSuccess(response.columnNames,response.values);return;}
let message;if(sqlError.message)
message=sqlError.message;else if(sqlError.code===2)
message=Common.UIString('Database no longer has expected version.');else
message=Common.UIString('An unexpected error %s occurred.',sqlError.code);onError(message);}};Resources.DatabaseModel=class extends SDK.SDKModel{constructor(target){super(target);this._databases=[];this._agent=target.databaseAgent();this.target().registerDatabaseDispatcher(new Resources.DatabaseDispatcher(this));}
enable(){if(this._enabled)
return;this._agent.enable();this._enabled=true;}
disable(){if(!this._enabled)
return;this._enabled=false;this._databases=[];this._agent.disable();this.dispatchEventToListeners(Resources.DatabaseModel.Events.DatabasesRemoved);}
databases(){const result=[];for(const database of this._databases)
result.push(database);return result;}
_addDatabase(database){this._databases.push(database);this.dispatchEventToListeners(Resources.DatabaseModel.Events.DatabaseAdded,database);}};SDK.SDKModel.register(Resources.DatabaseModel,SDK.Target.Capability.DOM,false);Resources.DatabaseModel.Events={DatabaseAdded:Symbol('DatabaseAdded'),DatabasesRemoved:Symbol('DatabasesRemoved'),};Resources.DatabaseDispatcher=class{constructor(model){this._model=model;}
addDatabase(payload){this._model._addDatabase(new Resources.Database(this._model,payload.id,payload.domain,payload.name,payload.version));}};Resources.DatabaseModel._symbol=Symbol('DatabaseModel');;Resources.DOMStorage=class extends Common.Object{constructor(model,securityOrigin,isLocalStorage){super();this._model=model;this._securityOrigin=securityOrigin;this._isLocalStorage=isLocalStorage;}
static storageId(securityOrigin,isLocalStorage){return{securityOrigin:securityOrigin,isLocalStorage:isLocalStorage};}
get id(){return Resources.DOMStorage.storageId(this._securityOrigin,this._isLocalStorage);}
get securityOrigin(){return this._securityOrigin;}
get isLocalStorage(){return this._isLocalStorage;}
getItems(){return this._model._agent.getDOMStorageItems(this.id);}
setItem(key,value){this._model._agent.setDOMStorageItem(this.id,key,value);}
removeItem(key){this._model._agent.removeDOMStorageItem(this.id,key);}
clear(){this._model._agent.clear(this.id);}};Resources.DOMStorage.Events={DOMStorageItemsCleared:Symbol('DOMStorageItemsCleared'),DOMStorageItemRemoved:Symbol('DOMStorageItemRemoved'),DOMStorageItemAdded:Symbol('DOMStorageItemAdded'),DOMStorageItemUpdated:Symbol('DOMStorageItemUpdated')};Resources.DOMStorageModel=class extends SDK.SDKModel{constructor(target){super(target);this._securityOriginManager=target.model(SDK.SecurityOriginManager);this._storages={};this._agent=target.domstorageAgent();}
enable(){if(this._enabled)
return;this.target().registerDOMStorageDispatcher(new Resources.DOMStorageDispatcher(this));this._securityOriginManager.addEventListener(SDK.SecurityOriginManager.Events.SecurityOriginAdded,this._securityOriginAdded,this);this._securityOriginManager.addEventListener(SDK.SecurityOriginManager.Events.SecurityOriginRemoved,this._securityOriginRemoved,this);for(const securityOrigin of this._securityOriginManager.securityOrigins())
this._addOrigin(securityOrigin);this._agent.enable();this._enabled=true;}
clearForOrigin(origin){if(!this._enabled)
return;for(const isLocal of[true,false]){const key=this._storageKey(origin,isLocal);const storage=this._storages[key];storage.clear();}
this._removeOrigin(origin);this._addOrigin(origin);}
_securityOriginAdded(event){this._addOrigin((event.data));}
_addOrigin(securityOrigin){const parsed=new Common.ParsedURL(securityOrigin);if(!parsed.isValid||parsed.scheme==='data'||parsed.scheme==='about'||parsed.scheme==='javascript')
return;for(const isLocal of[true,false]){const key=this._storageKey(securityOrigin,isLocal);console.assert(!this._storages[key]);const storage=new Resources.DOMStorage(this,securityOrigin,isLocal);this._storages[key]=storage;this.dispatchEventToListeners(Resources.DOMStorageModel.Events.DOMStorageAdded,storage);}}
_securityOriginRemoved(event){this._removeOrigin((event.data));}
_removeOrigin(securityOrigin){for(const isLocal of[true,false]){const key=this._storageKey(securityOrigin,isLocal);const storage=this._storages[key];if(!storage)
continue;delete this._storages[key];this.dispatchEventToListeners(Resources.DOMStorageModel.Events.DOMStorageRemoved,storage);}}
_storageKey(securityOrigin,isLocalStorage){return JSON.stringify(Resources.DOMStorage.storageId(securityOrigin,isLocalStorage));}
_domStorageItemsCleared(storageId){const domStorage=this.storageForId(storageId);if(!domStorage)
return;const eventData={};domStorage.dispatchEventToListeners(Resources.DOMStorage.Events.DOMStorageItemsCleared,eventData);}
_domStorageItemRemoved(storageId,key){const domStorage=this.storageForId(storageId);if(!domStorage)
return;const eventData={key:key};domStorage.dispatchEventToListeners(Resources.DOMStorage.Events.DOMStorageItemRemoved,eventData);}
_domStorageItemAdded(storageId,key,value){const domStorage=this.storageForId(storageId);if(!domStorage)
return;const eventData={key:key,value:value};domStorage.dispatchEventToListeners(Resources.DOMStorage.Events.DOMStorageItemAdded,eventData);}
_domStorageItemUpdated(storageId,key,oldValue,value){const domStorage=this.storageForId(storageId);if(!domStorage)
return;const eventData={key:key,oldValue:oldValue,value:value};domStorage.dispatchEventToListeners(Resources.DOMStorage.Events.DOMStorageItemUpdated,eventData);}
storageForId(storageId){return this._storages[JSON.stringify(storageId)];}
storages(){const result=[];for(const id in this._storages)
result.push(this._storages[id]);return result;}};SDK.SDKModel.register(Resources.DOMStorageModel,SDK.Target.Capability.DOM,false);Resources.DOMStorageModel.Events={DOMStorageAdded:Symbol('DOMStorageAdded'),DOMStorageRemoved:Symbol('DOMStorageRemoved')};Resources.DOMStorageDispatcher=class{constructor(model){this._model=model;}
domStorageItemsCleared(storageId){this._model._domStorageItemsCleared(storageId);}
domStorageItemRemoved(storageId,key){this._model._domStorageItemRemoved(storageId,key);}
domStorageItemAdded(storageId,key,value){this._model._domStorageItemAdded(storageId,key,value);}
domStorageItemUpdated(storageId,key,oldValue,value){this._model._domStorageItemUpdated(storageId,key,oldValue,value);}};Resources.DOMStorageModel._symbol=Symbol('DomStorage');;Resources.DOMStorageItemsView=class extends Resources.StorageItemsView{constructor(domStorage){super(Common.UIString('DOM Storage'),'domStoragePanel');this._domStorage=domStorage;this.element.classList.add('storage-view','table');const columns=([{id:'key',title:Common.UIString('Key'),sortable:false,editable:true,longText:true,weight:50},{id:'value',title:Common.UIString('Value'),sortable:false,editable:true,longText:true,weight:50}]);this._dataGrid=new DataGrid.DataGrid(columns,this._editingCallback.bind(this),this._deleteCallback.bind(this),this.refreshItems.bind(this));this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SelectedNode,event=>this._previewEntry((event.data)));this._dataGrid.addEventListener(DataGrid.DataGrid.Events.DeselectedNode,event=>this._previewEntry(null));this._dataGrid.setStriped(true);this._dataGrid.setName('DOMStorageItemsView');this._splitWidget=new UI.SplitWidget(false,false);this._splitWidget.show(this.element);this._splitWidget.setSecondIsSidebar(true);this._previewPanel=new UI.VBox();const resizer=this._previewPanel.element.createChild('div','preview-panel-resizer');const dataGridWidget=this._dataGrid.asWidget();dataGridWidget.setMinimumSize(0,50);this._splitWidget.setMainWidget(dataGridWidget);this._splitWidget.setSidebarWidget(this._previewPanel);this._splitWidget.installResizer(resizer);this._preview=null;this._previewValue=null;this._showPreview(null,null);this._eventListeners=[];this.setStorage(domStorage);}
setStorage(domStorage){Common.EventTarget.removeEventListeners(this._eventListeners);this._domStorage=domStorage;this._eventListeners=[this._domStorage.addEventListener(Resources.DOMStorage.Events.DOMStorageItemsCleared,this._domStorageItemsCleared,this),this._domStorage.addEventListener(Resources.DOMStorage.Events.DOMStorageItemRemoved,this._domStorageItemRemoved,this),this._domStorage.addEventListener(Resources.DOMStorage.Events.DOMStorageItemAdded,this._domStorageItemAdded,this),this._domStorage.addEventListener(Resources.DOMStorage.Events.DOMStorageItemUpdated,this._domStorageItemUpdated,this),];this.refreshItems();}
_domStorageItemsCleared(){if(!this.isShowing()||!this._dataGrid)
return;this._dataGrid.rootNode().removeChildren();this._dataGrid.addCreationNode(false);this.setCanDeleteSelected(false);}
_domStorageItemRemoved(event){if(!this.isShowing()||!this._dataGrid)
return;const storageData=event.data;const rootNode=this._dataGrid.rootNode();const children=rootNode.children;for(let i=0;i<children.length;++i){const childNode=children[i];if(childNode.data.key===storageData.key){rootNode.removeChild(childNode);this.setCanDeleteSelected(children.length>1);return;}}}
_domStorageItemAdded(event){if(!this.isShowing()||!this._dataGrid)
return;const storageData=event.data;const rootNode=this._dataGrid.rootNode();const children=rootNode.children;for(let i=0;i<children.length;++i){if(children[i].data.key===storageData.key)
return;}
const childNode=new DataGrid.DataGridNode({key:storageData.key,value:storageData.value},false);rootNode.insertChild(childNode,children.length-1);}
_domStorageItemUpdated(event){if(!this.isShowing()||!this._dataGrid)
return;const storageData=event.data;const childNode=this._dataGrid.rootNode().children.find(child=>child.data.key===storageData.key);if(!childNode||childNode.data.value===storageData.value)
return;childNode.data.value=storageData.value;childNode.refresh();if(!childNode.selected)
return;this._previewEntry(childNode);this.setCanDeleteSelected(true);}
_showDOMStorageItems(items){const rootNode=this._dataGrid.rootNode();let selectedKey=null;for(const node of rootNode.children){if(!node.selected)
continue;selectedKey=node.data.key;break;}
rootNode.removeChildren();let selectedNode=null;const filteredItems=item=>`${item[0]} ${item[1]}`;for(const item of this.filter(items,filteredItems)){const key=item[0];const value=item[1];const node=new DataGrid.DataGridNode({key:key,value:value},false);node.selectable=true;rootNode.appendChild(node);if(!selectedNode||key===selectedKey)
selectedNode=node;}
if(selectedNode)
selectedNode.selected=true;this._dataGrid.addCreationNode(false);this.setCanDeleteSelected(!!selectedNode);}
deleteSelectedItem(){if(!this._dataGrid||!this._dataGrid.selectedNode)
return;this._deleteCallback(this._dataGrid.selectedNode);}
refreshItems(){this._domStorage.getItems().then(items=>items&&this._showDOMStorageItems(items));}
deleteAllItems(){this._domStorage.clear();this._domStorageItemsCleared();}
_editingCallback(editingNode,columnIdentifier,oldText,newText){const domStorage=this._domStorage;if(columnIdentifier==='key'){if(typeof oldText==='string')
domStorage.removeItem(oldText);domStorage.setItem(newText,editingNode.data.value||'');this._removeDupes(editingNode);}else{domStorage.setItem(editingNode.data.key||'',newText);}}
_removeDupes(masterNode){const rootNode=this._dataGrid.rootNode();const children=rootNode.children;for(let i=children.length-1;i>=0;--i){const childNode=children[i];if((childNode.data.key===masterNode.data.key)&&(masterNode!==childNode))
rootNode.removeChild(childNode);}}
_deleteCallback(node){if(!node||node.isCreationNode)
return;if(this._domStorage)
this._domStorage.removeItem(node.data.key);}
_showPreview(preview,value){if(this._preview&&this._previewValue===value)
return;if(this._preview)
this._preview.detach();if(!preview)
preview=new UI.EmptyWidget(Common.UIString('Select a value to preview'));this._previewValue=value;this._preview=preview;preview.show(this._previewPanel.contentElement);}
async _previewEntry(entry){const value=entry&&entry.data&&entry.data.value;if(!value){this._showPreview(null,value);return;}
const protocol=this._domStorage.isLocalStorage?'localstorage':'sessionstorage';const url=`${protocol}://${entry.key}`;const provider=Common.StaticContentProvider.fromString(url,Common.resourceTypes.XHR,(value));const preview=await SourceFrame.PreviewFactory.createPreview(provider,'text/plain');if(!entry.selected)
return;this._showPreview(preview,value);}};;Resources.DatabaseQueryView=class extends UI.VBox{constructor(database){super();this.database=database;this.element.classList.add('storage-view','query','monospace');this.element.addEventListener('selectstart',this._selectStart.bind(this),false);this._promptContainer=this.element.createChild('div','database-query-prompt-container');this._promptContainer.appendChild(UI.Icon.create('smallicon-text-prompt','prompt-icon'));this._promptElement=this._promptContainer.createChild('div');this._promptElement.className='database-query-prompt';this._promptElement.addEventListener('keydown',this._promptKeyDown.bind(this));this._prompt=new UI.TextPrompt();this._prompt.initialize(this.completions.bind(this),' ');this._proxyElement=this._prompt.attach(this._promptElement);this.element.addEventListener('click',this._messagesClicked.bind(this),true);this.element.addEventListener('keydown',this._onKeyDown.bind(this));this._queryResultsWithDataGrids=[];this._selectedQueryIndex=-1;}
_messagesClicked(){this._prompt.focus();this._selectedQueryIndex=-1;if(!this._prompt.isCaretInsidePrompt()&&!this.element.hasSelection())
this._prompt.moveCaretToEndOfPrompt();}
_onKeyDown(e){let index;if(e.key==='ArrowUp'){index=this._selectedQueryIndex-1;if(this._selectedQueryIndex===-1)
index=this._queryResultsWithDataGrids.length-1;else if(this._selectedQueryIndex===0)
index=0;this._selectQuery(index);e.consume();}else if(e.key==='ArrowDown'){if(this._selectedQueryIndex!==-1){index=this._selectedQueryIndex+1;if(index>=this._queryResultsWithDataGrids.length){this._prompt.focus();index=-1;}
this._selectQuery(index);e.consume();}}}
_selectQuery(index){this._selectedQueryIndex=index;if(index>=0)
this._queryResultsWithDataGrids[index].focus();}
async completions(expression,prefix,force){if(!prefix)
return[];prefix=prefix.toLowerCase();const tableNames=await this.database.tableNames();return tableNames.map(name=>name+' ').concat(Resources.DatabaseQueryView._SQL_BUILT_INS).filter(proposal=>proposal.toLowerCase().startsWith(prefix)).map(completion=>({text:completion}));}
_selectStart(event){if(this._selectionTimeout)
clearTimeout(this._selectionTimeout);this._prompt.clearAutocomplete();function moveBackIfOutside(){delete this._selectionTimeout;if(!this._prompt.isCaretInsidePrompt()&&!this.element.hasSelection())
this._prompt.moveCaretToEndOfPrompt();this._prompt.autoCompleteSoon();}
this._selectionTimeout=setTimeout(moveBackIfOutside.bind(this),100);}
_promptKeyDown(event){if(isEnterKey(event)){this._enterKeyPressed(event);return;}}
async _enterKeyPressed(event){event.consume(true);const query=this._prompt.textWithCurrentSuggestion();this._prompt.clearAutocomplete();if(!query.length)
return;this._prompt.setEnabled(false);try{const result=await new Promise((resolve,reject)=>{this.database.executeSql(query,(columnNames,values)=>resolve({columnNames,values}),errorText=>reject(errorText));});this._queryFinished(query,result.columnNames,result.values);}catch(e){this._appendErrorQueryResult(query,e);}
this._prompt.setEnabled(true);this._prompt.setText('');this._prompt.focus();}
_queryFinished(query,columnNames,values){const dataGrid=DataGrid.SortableDataGrid.create(columnNames,values);const trimmedQuery=query.trim();let view=null;if(dataGrid){dataGrid.setStriped(true);dataGrid.renderInline();dataGrid.autoSizeColumns(5);view=dataGrid.asWidget();dataGrid.element.tabIndex=-1;}
this._appendViewQueryResult(trimmedQuery,view);if(trimmedQuery.match(/^create /i)||trimmedQuery.match(/^drop table /i))
this.dispatchEventToListeners(Resources.DatabaseQueryView.Events.SchemaUpdated,this.database);}
_appendViewQueryResult(query,view){const resultElement=this._appendQueryResult(query);if(view){view.show(resultElement);resultElement.tabIndex=-1;UI.ARIAUtils.setAccessibleName(resultElement,ls`Result for query: ${query}, selected table`);this._queryResultsWithDataGrids.push(resultElement);}else{resultElement.remove();}
this._promptElement.scrollIntoView(false);}
_appendErrorQueryResult(query,errorText){const resultElement=this._appendQueryResult(query);resultElement.classList.add('error');resultElement.appendChild(UI.Icon.create('smallicon-error','prompt-icon'));resultElement.createTextChild(errorText);this._promptElement.scrollIntoView(false);}
_appendQueryResult(query){const element=createElement('div');element.className='database-user-query';element.appendChild(UI.Icon.create('smallicon-user-command','prompt-icon'));this.element.insertBefore(element,this._promptContainer);const commandTextElement=createElement('span');commandTextElement.className='database-query-text';commandTextElement.textContent=query;element.appendChild(commandTextElement);const resultElement=createElement('div');resultElement.className='database-query-result';element.appendChild(resultElement);return resultElement;}};Resources.DatabaseQueryView.Events={SchemaUpdated:Symbol('SchemaUpdated')};Resources.DatabaseQueryView._SQL_BUILT_INS=['SELECT ','FROM ','WHERE ','LIMIT ','DELETE FROM ','CREATE ','DROP ','TABLE ','INDEX ','UPDATE ','INSERT INTO ','VALUES ('];;Resources.DatabaseTableView=class extends UI.SimpleView{constructor(database,tableName){super(Common.UIString('Database'));this.database=database;this.tableName=tableName;this.element.classList.add('storage-view','table');this._visibleColumnsSetting=Common.settings.createSetting('databaseTableViewVisibleColumns',{});this.refreshButton=new UI.ToolbarButton(Common.UIString('Refresh'),'largeicon-refresh');this.refreshButton.addEventListener(UI.ToolbarButton.Events.Click,this._refreshButtonClicked,this);this._visibleColumnsInput=new UI.ToolbarInput(Common.UIString('Visible columns'),1);this._visibleColumnsInput.addEventListener(UI.ToolbarInput.Event.TextChanged,this._onVisibleColumnsChanged,this);}
wasShown(){this.update();}
syncToolbarItems(){return[this.refreshButton,this._visibleColumnsInput];}
_escapeTableName(tableName){return tableName.replace(/\"/g,'""');}
update(){this.database.executeSql('SELECT rowid, * FROM "'+this._escapeTableName(this.tableName)+'"',this._queryFinished.bind(this),this._queryError.bind(this));}
_queryFinished(columnNames,values){this.detachChildWidgets();this.element.removeChildren();this._dataGrid=DataGrid.SortableDataGrid.create(columnNames,values);this._visibleColumnsInput.setVisible(!!this._dataGrid);if(!this._dataGrid){this._emptyWidget=new UI.EmptyWidget(ls`The "${this.tableName}"\ntable is empty.`);this._emptyWidget.show(this.element);return;}
this._dataGrid.setStriped(true);this._dataGrid.asWidget().show(this.element);this._dataGrid.autoSizeColumns(5);this._columnsMap=new Map();for(let i=1;i<columnNames.length;++i)
this._columnsMap.set(columnNames[i],String(i));this._lastVisibleColumns='';const visibleColumnsText=this._visibleColumnsSetting.get()[this.tableName]||'';this._visibleColumnsInput.setValue(visibleColumnsText);this._onVisibleColumnsChanged();}
_onVisibleColumnsChanged(){if(!this._dataGrid)
return;const text=this._visibleColumnsInput.value();const parts=text.split(/[\s,]+/);const matches=new Set();const columnsVisibility={};columnsVisibility['0']=true;for(let i=0;i<parts.length;++i){const part=parts[i];if(this._columnsMap.has(part)){matches.add(part);columnsVisibility[this._columnsMap.get(part)]=true;}}
const newVisibleColumns=matches.valuesArray().sort().join(', ');if(newVisibleColumns.length===0){for(const v of this._columnsMap.values())
columnsVisibility[v]=true;}
if(newVisibleColumns===this._lastVisibleColumns)
return;const visibleColumnsRegistry=this._visibleColumnsSetting.get();visibleColumnsRegistry[this.tableName]=text;this._visibleColumnsSetting.set(visibleColumnsRegistry);this._dataGrid.setColumnsVisiblity(columnsVisibility);this._lastVisibleColumns=newVisibleColumns;}
_queryError(error){this.detachChildWidgets();this.element.removeChildren();const errorMsgElement=createElement('div');errorMsgElement.className='storage-table-error';errorMsgElement.textContent=ls`An error occurred trying to\nread the "${this.tableName}" table.`;this.element.appendChild(errorMsgElement);}
_refreshButtonClicked(event){this.update();}};;Resources.IndexedDBModel=class extends SDK.SDKModel{constructor(target){super(target);target.registerStorageDispatcher(this);this._securityOriginManager=target.model(SDK.SecurityOriginManager);this._indexedDBAgent=target.indexedDBAgent();this._storageAgent=target.storageAgent();this._databases=new Map();this._databaseNamesBySecurityOrigin={};this._originsUpdated=new Set();this._throttler=new Common.Throttler(1000);}
static keyFromIDBKey(idbKey){if(typeof(idbKey)==='undefined'||idbKey===null)
return undefined;let type;const key={};switch(typeof(idbKey)){case'number':key.number=idbKey;type=Resources.IndexedDBModel.KeyTypes.NumberType;break;case'string':key.string=idbKey;type=Resources.IndexedDBModel.KeyTypes.StringType;break;case'object':if(idbKey instanceof Date){key.date=idbKey.getTime();type=Resources.IndexedDBModel.KeyTypes.DateType;}else if(Array.isArray(idbKey)){key.array=[];for(let i=0;i<idbKey.length;++i)
key.array.push(Resources.IndexedDBModel.keyFromIDBKey(idbKey[i]));type=Resources.IndexedDBModel.KeyTypes.ArrayType;}
break;default:return undefined;}
key.type=(type);return key;}
static _keyRangeFromIDBKeyRange(idbKeyRange){const keyRange={};keyRange.lower=Resources.IndexedDBModel.keyFromIDBKey(idbKeyRange.lower);keyRange.upper=Resources.IndexedDBModel.keyFromIDBKey(idbKeyRange.upper);keyRange.lowerOpen=!!idbKeyRange.lowerOpen;keyRange.upperOpen=!!idbKeyRange.upperOpen;return keyRange;}
static idbKeyPathFromKeyPath(keyPath){let idbKeyPath;switch(keyPath.type){case Resources.IndexedDBModel.KeyPathTypes.NullType:idbKeyPath=null;break;case Resources.IndexedDBModel.KeyPathTypes.StringType:idbKeyPath=keyPath.string;break;case Resources.IndexedDBModel.KeyPathTypes.ArrayType:idbKeyPath=keyPath.array;break;}
return idbKeyPath;}
static keyPathStringFromIDBKeyPath(idbKeyPath){if(typeof idbKeyPath==='string')
return'"'+idbKeyPath+'"';if(idbKeyPath instanceof Array)
return'["'+idbKeyPath.join('", "')+'"]';return null;}
enable(){if(this._enabled)
return;this._indexedDBAgent.enable();this._securityOriginManager.addEventListener(SDK.SecurityOriginManager.Events.SecurityOriginAdded,this._securityOriginAdded,this);this._securityOriginManager.addEventListener(SDK.SecurityOriginManager.Events.SecurityOriginRemoved,this._securityOriginRemoved,this);for(const securityOrigin of this._securityOriginManager.securityOrigins())
this._addOrigin(securityOrigin);this._enabled=true;}
clearForOrigin(origin){if(!this._enabled||!this._databaseNamesBySecurityOrigin[origin])
return;this._removeOrigin(origin);this._addOrigin(origin);}
async deleteDatabase(databaseId){if(!this._enabled)
return;await this._indexedDBAgent.deleteDatabase(databaseId.securityOrigin,databaseId.name);this._loadDatabaseNames(databaseId.securityOrigin);}
async refreshDatabaseNames(){for(const securityOrigin in this._databaseNamesBySecurityOrigin)
await this._loadDatabaseNames(securityOrigin);this.dispatchEventToListeners(Resources.IndexedDBModel.Events.DatabaseNamesRefreshed);}
refreshDatabase(databaseId){this._loadDatabase(databaseId,true);}
clearObjectStore(databaseId,objectStoreName){return this._indexedDBAgent.clearObjectStore(databaseId.securityOrigin,databaseId.name,objectStoreName);}
deleteEntries(databaseId,objectStoreName,idbKeyRange){const keyRange=Resources.IndexedDBModel._keyRangeFromIDBKeyRange(idbKeyRange);return this._indexedDBAgent.deleteObjectStoreEntries(databaseId.securityOrigin,databaseId.name,objectStoreName,keyRange);}
_securityOriginAdded(event){const securityOrigin=(event.data);this._addOrigin(securityOrigin);}
_securityOriginRemoved(event){const securityOrigin=(event.data);this._removeOrigin(securityOrigin);}
_addOrigin(securityOrigin){console.assert(!this._databaseNamesBySecurityOrigin[securityOrigin]);this._databaseNamesBySecurityOrigin[securityOrigin]=[];this._loadDatabaseNames(securityOrigin);if(this._isValidSecurityOrigin(securityOrigin))
this._storageAgent.trackIndexedDBForOrigin(securityOrigin);}
_removeOrigin(securityOrigin){console.assert(this._databaseNamesBySecurityOrigin[securityOrigin]);for(let i=0;i<this._databaseNamesBySecurityOrigin[securityOrigin].length;++i)
this._databaseRemoved(securityOrigin,this._databaseNamesBySecurityOrigin[securityOrigin][i]);delete this._databaseNamesBySecurityOrigin[securityOrigin];if(this._isValidSecurityOrigin(securityOrigin))
this._storageAgent.untrackIndexedDBForOrigin(securityOrigin);}
_isValidSecurityOrigin(securityOrigin){const parsedURL=securityOrigin.asParsedURL();return!!parsedURL&&parsedURL.scheme.startsWith('http');}
_updateOriginDatabaseNames(securityOrigin,databaseNames){const newDatabaseNames=new Set(databaseNames);const oldDatabaseNames=new Set(this._databaseNamesBySecurityOrigin[securityOrigin]);this._databaseNamesBySecurityOrigin[securityOrigin]=databaseNames;for(const databaseName of oldDatabaseNames){if(!newDatabaseNames.has(databaseName))
this._databaseRemoved(securityOrigin,databaseName);}
for(const databaseName of newDatabaseNames){if(!oldDatabaseNames.has(databaseName))
this._databaseAdded(securityOrigin,databaseName);}}
databases(){const result=[];for(const securityOrigin in this._databaseNamesBySecurityOrigin){const databaseNames=this._databaseNamesBySecurityOrigin[securityOrigin];for(let i=0;i<databaseNames.length;++i)
result.push(new Resources.IndexedDBModel.DatabaseId(securityOrigin,databaseNames[i]));}
return result;}
_databaseAdded(securityOrigin,databaseName){const databaseId=new Resources.IndexedDBModel.DatabaseId(securityOrigin,databaseName);this.dispatchEventToListeners(Resources.IndexedDBModel.Events.DatabaseAdded,{model:this,databaseId:databaseId});}
_databaseRemoved(securityOrigin,databaseName){const databaseId=new Resources.IndexedDBModel.DatabaseId(securityOrigin,databaseName);this.dispatchEventToListeners(Resources.IndexedDBModel.Events.DatabaseRemoved,{model:this,databaseId:databaseId});}
async _loadDatabaseNames(securityOrigin){const databaseNames=await this._indexedDBAgent.requestDatabaseNames(securityOrigin);if(!databaseNames)
return[];if(!this._databaseNamesBySecurityOrigin[securityOrigin])
return[];this._updateOriginDatabaseNames(securityOrigin,databaseNames);return databaseNames;}
async _loadDatabase(databaseId,entriesUpdated){const databaseWithObjectStores=await this._indexedDBAgent.requestDatabase(databaseId.securityOrigin,databaseId.name);if(!databaseWithObjectStores)
return;if(!this._databaseNamesBySecurityOrigin[databaseId.securityOrigin])
return;const databaseModel=new Resources.IndexedDBModel.Database(databaseId,databaseWithObjectStores.version);this._databases.set(databaseId,databaseModel);for(const objectStore of databaseWithObjectStores.objectStores){const objectStoreIDBKeyPath=Resources.IndexedDBModel.idbKeyPathFromKeyPath(objectStore.keyPath);const objectStoreModel=new Resources.IndexedDBModel.ObjectStore(objectStore.name,objectStoreIDBKeyPath,objectStore.autoIncrement);for(let j=0;j<objectStore.indexes.length;++j){const index=objectStore.indexes[j];const indexIDBKeyPath=Resources.IndexedDBModel.idbKeyPathFromKeyPath(index.keyPath);const indexModel=new Resources.IndexedDBModel.Index(index.name,indexIDBKeyPath,index.unique,index.multiEntry);objectStoreModel.indexes[indexModel.name]=indexModel;}
databaseModel.objectStores[objectStoreModel.name]=objectStoreModel;}
this.dispatchEventToListeners(Resources.IndexedDBModel.Events.DatabaseLoaded,{model:this,database:databaseModel,entriesUpdated:entriesUpdated});}
loadObjectStoreData(databaseId,objectStoreName,idbKeyRange,skipCount,pageSize,callback){this._requestData(databaseId,databaseId.name,objectStoreName,'',idbKeyRange,skipCount,pageSize,callback);}
loadIndexData(databaseId,objectStoreName,indexName,idbKeyRange,skipCount,pageSize,callback){this._requestData(databaseId,databaseId.name,objectStoreName,indexName,idbKeyRange,skipCount,pageSize,callback);}
async _requestData(databaseId,databaseName,objectStoreName,indexName,idbKeyRange,skipCount,pageSize,callback){const keyRange=idbKeyRange?Resources.IndexedDBModel._keyRangeFromIDBKeyRange(idbKeyRange):undefined;const response=await this._indexedDBAgent.invoke_requestData({securityOrigin:databaseId.securityOrigin,databaseName,objectStoreName,indexName,skipCount,pageSize,keyRange});if(response[Protocol.Error]){console.error('IndexedDBAgent error: '+response[Protocol.Error]);return;}
const runtimeModel=this.target().model(SDK.RuntimeModel);if(!runtimeModel||!this._databaseNamesBySecurityOrigin[databaseId.securityOrigin])
return;const dataEntries=response.objectStoreDataEntries;const entries=[];for(const dataEntry of dataEntries){const key=runtimeModel.createRemoteObject(dataEntry.key);const primaryKey=runtimeModel.createRemoteObject(dataEntry.primaryKey);const value=runtimeModel.createRemoteObject(dataEntry.value);entries.push(new Resources.IndexedDBModel.Entry(key,primaryKey,value));}
callback(entries,response.hasMore);}
async getMetadata(databaseId,objectStore){const databaseOrigin=databaseId.securityOrigin;const databaseName=databaseId.name;const objectStoreName=objectStore.name;const response=await this._indexedDBAgent.invoke_getMetadata({securityOrigin:databaseOrigin,databaseName,objectStoreName});if(response[Protocol.Error]){console.error('IndexedDBAgent error: '+response[Protocol.Error]);return null;}
return{entriesCount:response.entriesCount,keyGeneratorValue:response.keyGeneratorValue};}
async _refreshDatabaseList(securityOrigin){const databaseNames=await this._loadDatabaseNames(securityOrigin);for(const databaseName of databaseNames)
this._loadDatabase(new Resources.IndexedDBModel.DatabaseId(securityOrigin,databaseName),false);}
indexedDBListUpdated(securityOrigin){this._originsUpdated.add(securityOrigin);this._throttler.schedule(()=>{const promises=Array.from(this._originsUpdated,securityOrigin=>{this._refreshDatabaseList(securityOrigin);});this._originsUpdated.clear();return Promise.all(promises);});}
indexedDBContentUpdated(securityOrigin,databaseName,objectStoreName){const databaseId=new Resources.IndexedDBModel.DatabaseId(securityOrigin,databaseName);this.dispatchEventToListeners(Resources.IndexedDBModel.Events.IndexedDBContentUpdated,{databaseId:databaseId,objectStoreName:objectStoreName,model:this});}
cacheStorageListUpdated(securityOrigin){}
cacheStorageContentUpdated(securityOrigin){}};SDK.SDKModel.register(Resources.IndexedDBModel,SDK.Target.Capability.Storage,false);Resources.IndexedDBModel.KeyTypes={NumberType:'number',StringType:'string',DateType:'date',ArrayType:'array'};Resources.IndexedDBModel.KeyPathTypes={NullType:'null',StringType:'string',ArrayType:'array'};Resources.IndexedDBModel.Events={DatabaseAdded:Symbol('DatabaseAdded'),DatabaseRemoved:Symbol('DatabaseRemoved'),DatabaseLoaded:Symbol('DatabaseLoaded'),DatabaseNamesRefreshed:Symbol('DatabaseNamesRefreshed'),IndexedDBContentUpdated:Symbol('IndexedDBContentUpdated')};Resources.IndexedDBModel.Entry=class{constructor(key,primaryKey,value){this.key=key;this.primaryKey=primaryKey;this.value=value;}};Resources.IndexedDBModel.DatabaseId=class{constructor(securityOrigin,name){this.securityOrigin=securityOrigin;this.name=name;}
equals(databaseId){return this.name===databaseId.name&&this.securityOrigin===databaseId.securityOrigin;}};Resources.IndexedDBModel.Database=class{constructor(databaseId,version){this.databaseId=databaseId;this.version=version;this.objectStores={};}};Resources.IndexedDBModel.ObjectStore=class{constructor(name,keyPath,autoIncrement){this.name=name;this.keyPath=keyPath;this.autoIncrement=autoIncrement;this.indexes={};}
get keyPathString(){return(Resources.IndexedDBModel.keyPathStringFromIDBKeyPath((this.keyPath)));}};Resources.IndexedDBModel.ObjectStoreMetadata;Resources.IndexedDBModel.Index=class{constructor(name,keyPath,unique,multiEntry){this.name=name;this.keyPath=keyPath;this.unique=unique;this.multiEntry=multiEntry;}
get keyPathString(){return(Resources.IndexedDBModel.keyPathStringFromIDBKeyPath((this.keyPath)));}};;Resources.IDBDatabaseView=class extends UI.VBox{constructor(model,database){super();this._model=model;const databaseName=database?database.databaseId.name:ls`Loading\u2026`;this._reportView=new UI.ReportView(databaseName);this._reportView.show(this.contentElement);const bodySection=this._reportView.appendSection('');this._securityOriginElement=bodySection.appendField(ls`Security origin`);this._versionElement=bodySection.appendField(ls`Version`);this._objectStoreCountElement=bodySection.appendField(ls`Object stores`);const footer=this._reportView.appendSection('').appendRow();this._clearButton=UI.createTextButton(ls`Delete database`,()=>this._deleteDatabase(),ls`Delete database`);footer.appendChild(this._clearButton);this._refreshButton=UI.createTextButton(ls`Refresh database`,()=>this._refreshDatabaseButtonClicked(),ls`Refresh database`);footer.appendChild(this._refreshButton);if(database)
this.update(database);}
_refreshDatabase(){this._securityOriginElement.textContent=this._database.databaseId.securityOrigin;this._versionElement.textContent=this._database.version;this._objectStoreCountElement.textContent=Object.keys(this._database.objectStores).length;}
_refreshDatabaseButtonClicked(){this._model.refreshDatabase(this._database.databaseId);}
update(database){this._database=database;this._reportView.setTitle(this._database.databaseId.name);this._refreshDatabase();this._updatedForTests();}
_updatedForTests(){}
async _deleteDatabase(){const ok=await UI.ConfirmDialog.show(Common.UIString('Please confirm delete of "%s" database.',this._database.databaseId.name),this.element);if(ok)
this._model.deleteDatabase(this._database.databaseId);}};Resources.IDBDataView=class extends UI.SimpleView{constructor(model,databaseId,objectStore,index,refreshObjectStoreCallback){super(Common.UIString('IDB'));this.registerRequiredCSS('resources/indexedDBViews.css');this._model=model;this._databaseId=databaseId;this._isIndex=!!index;this._refreshObjectStoreCallback=refreshObjectStoreCallback;this.element.classList.add('indexed-db-data-view','storage-view');this._refreshButton=new UI.ToolbarButton(Common.UIString('Refresh'),'largeicon-refresh');this._refreshButton.addEventListener(UI.ToolbarButton.Events.Click,this._refreshButtonClicked,this);this._deleteSelectedButton=new UI.ToolbarButton(Common.UIString('Delete selected'),'largeicon-delete');this._deleteSelectedButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this._deleteButtonClicked(null));this._clearButton=new UI.ToolbarButton(Common.UIString('Clear object store'),'largeicon-clear');this._clearButton.addEventListener(UI.ToolbarButton.Events.Click,this._clearButtonClicked,this);this._needsRefresh=new UI.ToolbarItem(UI.createIconLabel(Common.UIString('Data may be stale'),'smallicon-warning'));this._needsRefresh.setVisible(false);this._needsRefresh.setTitle(Common.UIString('Some entries may have been modified'));this._createEditorToolbar();this._pageSize=50;this._skipCount=0;this.update(objectStore,index);this._entries=[];}
_createDataGrid(){const keyPath=this._isIndex?this._index.keyPath:this._objectStore.keyPath;const columns=([]);columns.push({id:'number',title:Common.UIString('#'),sortable:false,width:'50px'});columns.push({id:'key',titleDOMFragment:this._keyColumnHeaderFragment(Common.UIString('Key'),keyPath),sortable:false});if(this._isIndex){columns.push({id:'primaryKey',titleDOMFragment:this._keyColumnHeaderFragment(Common.UIString('Primary key'),this._objectStore.keyPath),sortable:false});}
columns.push({id:'value',title:Common.UIString('Value'),sortable:false});const dataGrid=new DataGrid.DataGrid(columns,undefined,this._deleteButtonClicked.bind(this),this._updateData.bind(this,true));dataGrid.setStriped(true);dataGrid.addEventListener(DataGrid.DataGrid.Events.SelectedNode,event=>this._updateToolbarEnablement(),this);return dataGrid;}
_keyColumnHeaderFragment(prefix,keyPath){const keyColumnHeaderFragment=createDocumentFragment();keyColumnHeaderFragment.createTextChild(prefix);if(keyPath===null)
return keyColumnHeaderFragment;keyColumnHeaderFragment.createTextChild(' ('+Common.UIString('Key path: '));if(Array.isArray(keyPath)){keyColumnHeaderFragment.createTextChild('[');for(let i=0;i<keyPath.length;++i){if(i!==0)
keyColumnHeaderFragment.createTextChild(', ');keyColumnHeaderFragment.appendChild(this._keyPathStringFragment(keyPath[i]));}
keyColumnHeaderFragment.createTextChild(']');}else{const keyPathString=(keyPath);keyColumnHeaderFragment.appendChild(this._keyPathStringFragment(keyPathString));}
keyColumnHeaderFragment.createTextChild(')');return keyColumnHeaderFragment;}
_keyPathStringFragment(keyPathString){const keyPathStringFragment=createDocumentFragment();keyPathStringFragment.createTextChild('"');const keyPathSpan=keyPathStringFragment.createChild('span','source-code indexed-db-key-path');keyPathSpan.textContent=keyPathString;keyPathStringFragment.createTextChild('"');return keyPathStringFragment;}
_createEditorToolbar(){const editorToolbar=new UI.Toolbar('data-view-toolbar',this.element);editorToolbar.appendToolbarItem(this._refreshButton);editorToolbar.appendToolbarItem(new UI.ToolbarSeparator());this._pageBackButton=new UI.ToolbarButton(Common.UIString('Show previous page'),'largeicon-play-back');this._pageBackButton.addEventListener(UI.ToolbarButton.Events.Click,this._pageBackButtonClicked,this);editorToolbar.appendToolbarItem(this._pageBackButton);this._pageForwardButton=new UI.ToolbarButton(Common.UIString('Show next page'),'largeicon-play');this._pageForwardButton.setEnabled(false);this._pageForwardButton.addEventListener(UI.ToolbarButton.Events.Click,this._pageForwardButtonClicked,this);editorToolbar.appendToolbarItem(this._pageForwardButton);this._keyInput=new UI.ToolbarInput(ls`Start from key`,0.5);this._keyInput.addEventListener(UI.ToolbarInput.Event.TextChanged,this._updateData.bind(this,false));editorToolbar.appendToolbarItem(this._keyInput);editorToolbar.appendToolbarItem(new UI.ToolbarSeparator());editorToolbar.appendToolbarItem(this._clearButton);editorToolbar.appendToolbarItem(this._deleteSelectedButton);editorToolbar.appendToolbarItem(this._needsRefresh);}
_pageBackButtonClicked(event){this._skipCount=Math.max(0,this._skipCount-this._pageSize);this._updateData(false);}
_pageForwardButtonClicked(event){this._skipCount=this._skipCount+this._pageSize;this._updateData(false);}
_populateContextMenu(contextMenu,gridNode){const node=(gridNode);if(node.valueObjectPresentation){contextMenu.revealSection().appendItem(ls`Expand Recursively`,()=>{node.valueObjectPresentation.objectTreeElement().expandRecursively();});contextMenu.revealSection().appendItem(ls`Collapse`,()=>{node.valueObjectPresentation.objectTreeElement().collapse();});}}
refreshData(){this._updateData(true);}
update(objectStore,index){this._objectStore=objectStore;this._index=index;if(this._dataGrid)
this._dataGrid.asWidget().detach();this._dataGrid=this._createDataGrid();this._dataGrid.setRowContextMenuCallback(this._populateContextMenu.bind(this));this._dataGrid.asWidget().show(this.element);this._skipCount=0;this._updateData(true);}
_parseKey(keyString){let result;try{result=JSON.parse(keyString);}catch(e){result=keyString;}
return result;}
_updateData(force){const key=this._parseKey(this._keyInput.value());const pageSize=this._pageSize;let skipCount=this._skipCount;let selected=this._dataGrid.selectedNode?this._dataGrid.selectedNode.data['number']:0;selected=Math.max(selected,this._skipCount);this._refreshButton.setEnabled(false);this._clearButton.setEnabled(!this._isIndex);if(!force&&this._lastKey===key&&this._lastPageSize===pageSize&&this._lastSkipCount===skipCount)
return;if(this._lastKey!==key||this._lastPageSize!==pageSize){skipCount=0;this._skipCount=0;}
this._lastKey=key;this._lastPageSize=pageSize;this._lastSkipCount=skipCount;function callback(entries,hasMore){this._refreshButton.setEnabled(true);this.clear();this._entries=entries;let selectedNode=null;for(let i=0;i<entries.length;++i){const data={};data['number']=i+skipCount;data['key']=entries[i].key;data['primaryKey']=entries[i].primaryKey;data['value']=entries[i].value;const node=new Resources.IDBDataGridNode(data);this._dataGrid.rootNode().appendChild(node);if(data['number']<=selected)
selectedNode=node;}
if(selectedNode)
selectedNode.select();this._pageBackButton.setEnabled(!!skipCount);this._pageForwardButton.setEnabled(hasMore);this._needsRefresh.setVisible(false);this._updateToolbarEnablement();this._updatedDataForTests();}
const idbKeyRange=key?window.IDBKeyRange.lowerBound(key):null;if(this._isIndex){this._model.loadIndexData(this._databaseId,this._objectStore.name,this._index.name,idbKeyRange,skipCount,pageSize,callback.bind(this));}else{this._model.loadObjectStoreData(this._databaseId,this._objectStore.name,idbKeyRange,skipCount,pageSize,callback.bind(this));}
this._model.getMetadata(this._databaseId,this._objectStore).then(this._updateSummaryBar.bind(this));}
_updateSummaryBar(metadata){if(!this._summaryBarElement)
this._summaryBarElement=this.element.createChild('div','object-store-summary-bar');this._summaryBarElement.removeChildren();if(!metadata)
return;const separator='\u2002\u2758\u2002';const span=this._summaryBarElement.createChild('span');span.textContent=ls`Total entries: ${String(metadata.entriesCount)}`;if(this._objectStore.autoIncrement){span.textContent+=separator;span.textContent+=ls`Key generator value: ${String(metadata.keyGeneratorValue)}`;}}
_updatedDataForTests(){}
_refreshButtonClicked(event){this._updateData(true);}
async _clearButtonClicked(event){this._clearButton.setEnabled(false);await this._model.clearObjectStore(this._databaseId,this._objectStore.name);this._clearButton.setEnabled(true);this._updateData(true);}
markNeedsRefresh(){this._needsRefresh.setVisible(true);}
async _deleteButtonClicked(node){if(!node){node=this._dataGrid.selectedNode;if(!node)
return;}
const key=(this._isIndex?node.data.primaryKey:node.data.key);const keyValue=(key.value);await this._model.deleteEntries(this._databaseId,this._objectStore.name,window.IDBKeyRange.only(keyValue));this._refreshObjectStoreCallback();}
clear(){this._dataGrid.rootNode().removeChildren();this._entries=[];}
_updateToolbarEnablement(){const empty=!this._dataGrid||this._dataGrid.rootNode().children.length===0;this._clearButton.setEnabled(!empty);this._deleteSelectedButton.setEnabled(!empty&&this._dataGrid.selectedNode!==null);}};Resources.IDBDataGridNode=class extends DataGrid.DataGridNode{constructor(data){super(data,false);this.selectable=true;this.valueObjectPresentation=null;}
createCell(columnIdentifier){const cell=super.createCell(columnIdentifier);const value=(this.data[columnIdentifier]);switch(columnIdentifier){case'value':cell.removeChildren();const objectPropSection=ObjectUI.ObjectPropertiesSection.defaultObjectPropertiesSection(value,undefined,true,true);cell.appendChild(objectPropSection.element);this.valueObjectPresentation=objectPropSection;break;case'key':case'primaryKey':cell.removeChildren();const objectElement=ObjectUI.ObjectPropertiesSection.defaultObjectPresentation(value,undefined,true,true);cell.appendChild(objectElement);break;default:}
return cell;}};;Resources.ResourcesPanel=class extends UI.PanelWithSidebar{constructor(){super('resources');this.registerRequiredCSS('resources/resourcesPanel.css');this._resourcesLastSelectedItemSetting=Common.settings.createSetting('resourcesLastSelectedElementPath',[]);this.visibleView=null;this._pendingViewPromise=null;this._categoryView=null;const mainContainer=new UI.VBox();this.storageViews=mainContainer.element.createChild('div','vbox flex-auto');this._storageViewToolbar=new UI.Toolbar('resources-toolbar',mainContainer.element);this.splitWidget().setMainWidget(mainContainer);this._domStorageView=null;this._cookieView=null;this._emptyWidget=null;this._sidebar=new Resources.ApplicationPanelSidebar(this);this._sidebar.show(this.panelSidebarElement());}
static _instance(){return(self.runtime.sharedInstance(Resources.ResourcesPanel));}
static _shouldCloseOnReset(view){const viewClassesToClose=[SourceFrame.ResourceSourceFrame,SourceFrame.ImageView,SourceFrame.FontView,Resources.StorageItemsView,Resources.DatabaseQueryView,Resources.DatabaseTableView];return viewClassesToClose.some(type=>view instanceof type);}
focus(){this._sidebar.focus();}
lastSelectedItemPath(){return this._resourcesLastSelectedItemSetting.get();}
setLastSelectedItemPath(path){this._resourcesLastSelectedItemSetting.set(path);}
resetView(){if(this.visibleView&&Resources.ResourcesPanel._shouldCloseOnReset(this.visibleView))
this.showView(null);}
showView(view){this._pendingViewPromise=null;if(this.visibleView===view)
return;if(this.visibleView)
this.visibleView.detach();if(view)
view.show(this.storageViews);this.visibleView=view;this._storageViewToolbar.removeToolbarItems();const toolbarItems=(view instanceof UI.SimpleView&&view.syncToolbarItems())||[];for(let i=0;i<toolbarItems.length;++i)
this._storageViewToolbar.appendToolbarItem(toolbarItems[i]);this._storageViewToolbar.element.classList.toggle('hidden',!toolbarItems.length);}
async scheduleShowView(viewPromise){this._pendingViewPromise=viewPromise;const view=await viewPromise;if(this._pendingViewPromise!==viewPromise)
return null;this.showView(view);return view;}
showCategoryView(categoryName,categoryLink){if(!this._categoryView)
this._categoryView=new Resources.StorageCategoryView();this._categoryView.setText(categoryName);this._categoryView.setLink(categoryLink);this.showView(this._categoryView);}
showDOMStorage(domStorage){if(!domStorage)
return;if(!this._domStorageView)
this._domStorageView=new Resources.DOMStorageItemsView(domStorage);else
this._domStorageView.setStorage(domStorage);this.showView(this._domStorageView);}
showCookies(cookieFrameTarget,cookieDomain){const model=cookieFrameTarget.model(SDK.CookieModel);if(!model)
return;if(!this._cookieView)
this._cookieView=new Resources.CookieItemsView(model,cookieDomain);else
this._cookieView.setCookiesDomain(model,cookieDomain);this.showView(this._cookieView);}
clearCookies(target,cookieDomain){const model=target.model(SDK.CookieModel);if(!model)
return;model.clear(cookieDomain,()=>{if(this._cookieView)
this._cookieView.refreshItems();});}};Resources.ResourcesPanel.ResourceRevealer=class{async reveal(resource){if(!(resource instanceof SDK.Resource))
return Promise.reject(new Error('Internal error: not a resource'));const sidebar=Resources.ResourcesPanel._instance()._sidebar;await UI.viewManager.showView('resources');await sidebar.showResource(resource);}};;Resources.ApplicationPanelSidebar=class extends UI.VBox{constructor(panel){super();this._panel=panel;this._sidebarTree=new UI.TreeOutlineInShadow();this._sidebarTree.element.classList.add('resources-sidebar');this._sidebarTree.registerRequiredCSS('resources/resourcesSidebar.css');this._sidebarTree.element.classList.add('filter-all');this._sidebarTree.addEventListener(UI.TreeOutline.Events.ElementAttached,this._treeElementAdded,this);this.contentElement.appendChild(this._sidebarTree.element);this._applicationTreeElement=this._addSidebarSection(Common.UIString('Application'));const manifestTreeElement=new Resources.AppManifestTreeElement(panel);this._applicationTreeElement.appendChild(manifestTreeElement);this.serviceWorkersTreeElement=new Resources.ServiceWorkersTreeElement(panel);this._applicationTreeElement.appendChild(this.serviceWorkersTreeElement);const clearStorageTreeElement=new Resources.ClearStorageTreeElement(panel);this._applicationTreeElement.appendChild(clearStorageTreeElement);const storageTreeElement=this._addSidebarSection(Common.UIString('Storage'));this.localStorageListTreeElement=new Resources.StorageCategoryTreeElement(panel,Common.UIString('Local Storage'),'LocalStorage');const localStorageIcon=UI.Icon.create('mediumicon-table','resource-tree-item');this.localStorageListTreeElement.setLeadingIcons([localStorageIcon]);storageTreeElement.appendChild(this.localStorageListTreeElement);this.sessionStorageListTreeElement=new Resources.StorageCategoryTreeElement(panel,Common.UIString('Session Storage'),'SessionStorage');const sessionStorageIcon=UI.Icon.create('mediumicon-table','resource-tree-item');this.sessionStorageListTreeElement.setLeadingIcons([sessionStorageIcon]);storageTreeElement.appendChild(this.sessionStorageListTreeElement);this.indexedDBListTreeElement=new Resources.IndexedDBTreeElement(panel);storageTreeElement.appendChild(this.indexedDBListTreeElement);this.databasesListTreeElement=new Resources.StorageCategoryTreeElement(panel,Common.UIString('Web SQL'),'Databases');const databaseIcon=UI.Icon.create('mediumicon-database','resource-tree-item');this.databasesListTreeElement.setLeadingIcons([databaseIcon]);storageTreeElement.appendChild(this.databasesListTreeElement);this.cookieListTreeElement=new Resources.StorageCategoryTreeElement(panel,Common.UIString('Cookies'),'Cookies');const cookieIcon=UI.Icon.create('mediumicon-cookie','resource-tree-item');this.cookieListTreeElement.setLeadingIcons([cookieIcon]);storageTreeElement.appendChild(this.cookieListTreeElement);const cacheTreeElement=this._addSidebarSection(Common.UIString('Cache'));this.cacheStorageListTreeElement=new Resources.ServiceWorkerCacheTreeElement(panel);cacheTreeElement.appendChild(this.cacheStorageListTreeElement);this.applicationCacheListTreeElement=new Resources.StorageCategoryTreeElement(panel,Common.UIString('Application Cache'),'ApplicationCache');const applicationCacheIcon=UI.Icon.create('mediumicon-table','resource-tree-item');this.applicationCacheListTreeElement.setLeadingIcons([applicationCacheIcon]);cacheTreeElement.appendChild(this.applicationCacheListTreeElement);if(Runtime.experiments.isEnabled('backgroundServices')){const backgroundServiceTreeElement=this._addSidebarSection(ls`Background Services`);this.backgroundFetchTreeElement=new Resources.BackgroundServiceTreeElement(panel,Protocol.BackgroundService.ServiceName.BackgroundFetch);backgroundServiceTreeElement.appendChild(this.backgroundFetchTreeElement);this.backgroundSyncTreeElement=new Resources.BackgroundServiceTreeElement(panel,Protocol.BackgroundService.ServiceName.BackgroundSync);backgroundServiceTreeElement.appendChild(this.backgroundSyncTreeElement);if(Runtime.experiments.isEnabled('backgroundServicesNotifications')){this.notificationsTreeElement=new Resources.BackgroundServiceTreeElement(panel,Protocol.BackgroundService.ServiceName.Notifications);backgroundServiceTreeElement.appendChild(this.notificationsTreeElement);}
if(Runtime.experiments.isEnabled('backgroundServicesPaymentHandler')){this.paymentHandlerTreeElement=new Resources.BackgroundServiceTreeElement(panel,Protocol.BackgroundService.ServiceName.PaymentHandler);backgroundServiceTreeElement.appendChild(this.paymentHandlerTreeElement);}
if(Runtime.experiments.isEnabled('backgroundServicesPeriodicBackgroundSync')){this.periodicBackgroundSyncTreeElement=new Resources.BackgroundServiceTreeElement(panel,Protocol.BackgroundService.ServiceName.PeriodicBackgroundSync);backgroundServiceTreeElement.appendChild(this.periodicBackgroundSyncTreeElement);}
if(Runtime.experiments.isEnabled('backgroundServicesPushMessaging')){this.pushMessagingTreeElement=new Resources.BackgroundServiceTreeElement(panel,Protocol.BackgroundService.ServiceName.PushMessaging);backgroundServiceTreeElement.appendChild(this.pushMessagingTreeElement);}}
this._resourcesSection=new Resources.ResourcesSection(panel,this._addSidebarSection(Common.UIString('Frames')));this._databaseTableViews=new Map();this._databaseQueryViews=new Map();this._databaseTreeElements=new Map();this._domStorageTreeElements=new Map();this._domains={};this._sidebarTree.contentElement.addEventListener('mousemove',this._onmousemove.bind(this),false);this._sidebarTree.contentElement.addEventListener('mouseleave',this._onmouseleave.bind(this),false);SDK.targetManager.observeTargets(this);SDK.targetManager.addModelListener(SDK.ResourceTreeModel,SDK.ResourceTreeModel.Events.FrameNavigated,this._frameNavigated,this);const selection=this._panel.lastSelectedItemPath();if(!selection.length)
manifestTreeElement.select();}
_addSidebarSection(title){const treeElement=new UI.TreeElement(title,true);treeElement.listItemElement.classList.add('storage-group-list-item');treeElement.setCollapsible(false);treeElement.selectable=false;this._sidebarTree.appendChild(treeElement);return treeElement;}
targetAdded(target){if(this._target)
return;this._target=target;this._databaseModel=target.model(Resources.DatabaseModel);if(this._databaseModel){this._databaseModel.addEventListener(Resources.DatabaseModel.Events.DatabaseAdded,this._databaseAdded,this);this._databaseModel.addEventListener(Resources.DatabaseModel.Events.DatabasesRemoved,this._resetWebSQL,this);}
const resourceTreeModel=target.model(SDK.ResourceTreeModel);if(!resourceTreeModel)
return;if(resourceTreeModel.cachedResourcesLoaded())
this._initialize();resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.CachedResourcesLoaded,this._initialize,this);resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.WillLoadCachedResources,this._resetWithFrames,this);}
targetRemoved(target){if(target!==this._target)
return;delete this._target;const resourceTreeModel=target.model(SDK.ResourceTreeModel);if(resourceTreeModel){resourceTreeModel.removeEventListener(SDK.ResourceTreeModel.Events.CachedResourcesLoaded,this._initialize,this);resourceTreeModel.removeEventListener(SDK.ResourceTreeModel.Events.WillLoadCachedResources,this._resetWithFrames,this);}
if(this._databaseModel){this._databaseModel.removeEventListener(Resources.DatabaseModel.Events.DatabaseAdded,this._databaseAdded,this);this._databaseModel.removeEventListener(Resources.DatabaseModel.Events.DatabasesRemoved,this._resetWebSQL,this);this._databaseModel=null;}
this._resetWithFrames();}
focus(){this._sidebarTree.focus();}
_initialize(){for(const frame of SDK.ResourceTreeModel.frames())
this._addCookieDocument(frame);if(this._databaseModel)
this._databaseModel.enable();const cacheStorageModel=this._target.model(SDK.ServiceWorkerCacheModel);if(cacheStorageModel)
cacheStorageModel.enable();const resourceTreeModel=this._target.model(SDK.ResourceTreeModel);if(resourceTreeModel)
this._populateApplicationCacheTree(resourceTreeModel);SDK.targetManager.observeModels(Resources.DOMStorageModel,({modelAdded:model=>this._domStorageModelAdded(model),modelRemoved:model=>this._domStorageModelRemoved(model)}));this.indexedDBListTreeElement._initialize();SDK.targetManager.observeModels(Resources.IndexedDBModel,({modelAdded:model=>model.enable(),modelRemoved:model=>this.indexedDBListTreeElement.removeIndexedDBForModel(model)}));const serviceWorkerCacheModel=this._target.model(SDK.ServiceWorkerCacheModel);this.cacheStorageListTreeElement._initialize(serviceWorkerCacheModel);const backgroundServiceModel=this._target.model(Resources.BackgroundServiceModel);if(Runtime.experiments.isEnabled('backgroundServices')){this.backgroundFetchTreeElement._initialize(backgroundServiceModel);this.backgroundSyncTreeElement._initialize(backgroundServiceModel);if(Runtime.experiments.isEnabled('backgroundServicesNotifications'))
this.notificationsTreeElement._initialize(backgroundServiceModel);if(Runtime.experiments.isEnabled('backgroundServicesPaymentHandler'))
this.paymentHandlerTreeElement._initialize(backgroundServiceModel);if(Runtime.experiments.isEnabled('backgroundServicesPeriodicBackgroundSync'))
this.periodicBackgroundSyncTreeElement._initialize(backgroundServiceModel);if(Runtime.experiments.isEnabled('backgroundServicesPushMessaging'))
this.pushMessagingTreeElement._initialize(backgroundServiceModel);}}
_domStorageModelAdded(model){model.enable();model.storages().forEach(this._addDOMStorage.bind(this));model.addEventListener(Resources.DOMStorageModel.Events.DOMStorageAdded,this._domStorageAdded,this);model.addEventListener(Resources.DOMStorageModel.Events.DOMStorageRemoved,this._domStorageRemoved,this);}
_domStorageModelRemoved(model){model.storages().forEach(this._removeDOMStorage.bind(this));model.removeEventListener(Resources.DOMStorageModel.Events.DOMStorageAdded,this._domStorageAdded,this);model.removeEventListener(Resources.DOMStorageModel.Events.DOMStorageRemoved,this._domStorageRemoved,this);}
_resetWithFrames(){this._resourcesSection.reset();this._reset();}
_resetWebSQL(){const queryViews=this._databaseQueryViews.valuesArray();for(let i=0;i<queryViews.length;++i){queryViews[i].removeEventListener(Resources.DatabaseQueryView.Events.SchemaUpdated,this._updateDatabaseTables,this);}
this._databaseTableViews.clear();this._databaseQueryViews.clear();this._databaseTreeElements.clear();this.databasesListTreeElement.removeChildren();this.databasesListTreeElement.setExpandable(false);}
_resetAppCache(){for(const frameId of Object.keys(this._applicationCacheFrameElements))
this._applicationCacheFrameManifestRemoved({data:frameId});this.applicationCacheListTreeElement.setExpandable(false);}
_treeElementAdded(event){const selection=this._panel.lastSelectedItemPath();if(!selection.length)
return;const element=event.data;const index=selection.indexOf(element.itemURL);if(index<0)
return;for(let parent=element.parent;parent;parent=parent.parent)
parent.expand();if(index>0)
element.expand();element.select();}
_reset(){this._domains={};this._resetWebSQL();this.cookieListTreeElement.removeChildren();}
_frameNavigated(event){const frame=(event.data);if(frame.isTopFrame())
this._reset();const applicationCacheFrameTreeElement=this._applicationCacheFrameElements[frame.id];if(applicationCacheFrameTreeElement)
applicationCacheFrameTreeElement.frameNavigated(frame);this._addCookieDocument(frame);}
_databaseAdded(event){const database=(event.data);const databaseTreeElement=new Resources.DatabaseTreeElement(this,database);this._databaseTreeElements.set(database,databaseTreeElement);this.databasesListTreeElement.appendChild(databaseTreeElement);}
_addCookieDocument(frame){const parsedURL=frame.url.asParsedURL();if(!parsedURL||(parsedURL.scheme!=='http'&&parsedURL.scheme!=='https'&&parsedURL.scheme!=='file'))
return;const domain=parsedURL.securityOrigin();if(!this._domains[domain]){this._domains[domain]=true;const cookieDomainTreeElement=new Resources.CookieTreeElement(this._panel,frame,domain);this.cookieListTreeElement.appendChild(cookieDomainTreeElement);}}
_domStorageAdded(event){const domStorage=(event.data);this._addDOMStorage(domStorage);}
_addDOMStorage(domStorage){console.assert(!this._domStorageTreeElements.get(domStorage));const domStorageTreeElement=new Resources.DOMStorageTreeElement(this._panel,domStorage);this._domStorageTreeElements.set(domStorage,domStorageTreeElement);if(domStorage.isLocalStorage)
this.localStorageListTreeElement.appendChild(domStorageTreeElement);else
this.sessionStorageListTreeElement.appendChild(domStorageTreeElement);}
_domStorageRemoved(event){const domStorage=(event.data);this._removeDOMStorage(domStorage);}
_removeDOMStorage(domStorage){const treeElement=this._domStorageTreeElements.get(domStorage);if(!treeElement)
return;const wasSelected=treeElement.selected;const parentListTreeElement=treeElement.parent;parentListTreeElement.removeChild(treeElement);if(wasSelected)
parentListTreeElement.select();this._domStorageTreeElements.remove(domStorage);}
selectDatabase(database){if(database){this._showDatabase(database);this._databaseTreeElements.get(database).select();}}
async showResource(resource,line,column){await this._resourcesSection.revealResource(resource,line,column);}
_showDatabase(database,tableName){if(!database)
return;let view;if(tableName){let tableViews=this._databaseTableViews.get(database);if(!tableViews){tableViews=({});this._databaseTableViews.set(database,tableViews);}
view=tableViews[tableName];if(!view){view=new Resources.DatabaseTableView(database,tableName);tableViews[tableName]=view;}}else{view=this._databaseQueryViews.get(database);if(!view){view=new Resources.DatabaseQueryView(database);this._databaseQueryViews.set(database,view);view.addEventListener(Resources.DatabaseQueryView.Events.SchemaUpdated,this._updateDatabaseTables,this);}}
this._innerShowView(view);}
_showApplicationCache(frameId){if(!this._applicationCacheViews[frameId]){this._applicationCacheViews[frameId]=new Resources.ApplicationCacheItemsView(this._applicationCacheModel,frameId);}
this._innerShowView(this._applicationCacheViews[frameId]);}
showFileSystem(view){this._innerShowView(view);}
_innerShowView(view){this._panel.showView(view);}
_updateDatabaseTables(event){const database=event.data;if(!database)
return;const databasesTreeElement=this._databaseTreeElements.get(database);if(!databasesTreeElement)
return;databasesTreeElement.invalidateChildren();const tableViews=this._databaseTableViews.get(database);if(!tableViews)
return;const tableNamesHash={};const panel=this._panel;function tableNamesCallback(tableNames){const tableNamesLength=tableNames.length;for(let i=0;i<tableNamesLength;++i)
tableNamesHash[tableNames[i]]=true;for(const tableName in tableViews){if(!(tableName in tableNamesHash)){if(panel.visibleView===tableViews[tableName])
panel.showView(null);delete tableViews[tableName];}}}
database.getTableNames(tableNamesCallback);}
_populateApplicationCacheTree(resourceTreeModel){this._applicationCacheModel=this._target.model(Resources.ApplicationCacheModel);this._applicationCacheViews={};this._applicationCacheFrameElements={};this._applicationCacheManifestElements={};this._applicationCacheModel.addEventListener(Resources.ApplicationCacheModel.Events.FrameManifestAdded,this._applicationCacheFrameManifestAdded,this);this._applicationCacheModel.addEventListener(Resources.ApplicationCacheModel.Events.FrameManifestRemoved,this._applicationCacheFrameManifestRemoved,this);this._applicationCacheModel.addEventListener(Resources.ApplicationCacheModel.Events.FrameManifestsReset,this._resetAppCache,this);this._applicationCacheModel.addEventListener(Resources.ApplicationCacheModel.Events.FrameManifestStatusUpdated,this._applicationCacheFrameManifestStatusChanged,this);this._applicationCacheModel.addEventListener(Resources.ApplicationCacheModel.Events.NetworkStateChanged,this._applicationCacheNetworkStateChanged,this);}
_applicationCacheFrameManifestAdded(event){const frameId=event.data;const manifestURL=this._applicationCacheModel.frameManifestURL(frameId);let manifestTreeElement=this._applicationCacheManifestElements[manifestURL];if(!manifestTreeElement){manifestTreeElement=new Resources.ApplicationCacheManifestTreeElement(this._panel,manifestURL);this.applicationCacheListTreeElement.appendChild(manifestTreeElement);this._applicationCacheManifestElements[manifestURL]=manifestTreeElement;}
const model=this._target.model(SDK.ResourceTreeModel);const frameTreeElement=new Resources.ApplicationCacheFrameTreeElement(this,model.frameForId(frameId),manifestURL);manifestTreeElement.appendChild(frameTreeElement);manifestTreeElement.expand();this._applicationCacheFrameElements[frameId]=frameTreeElement;}
_applicationCacheFrameManifestRemoved(event){const frameId=event.data;const frameTreeElement=this._applicationCacheFrameElements[frameId];if(!frameTreeElement)
return;const manifestURL=frameTreeElement.manifestURL;delete this._applicationCacheFrameElements[frameId];delete this._applicationCacheViews[frameId];frameTreeElement.parent.removeChild(frameTreeElement);const manifestTreeElement=this._applicationCacheManifestElements[manifestURL];if(manifestTreeElement.childCount())
return;delete this._applicationCacheManifestElements[manifestURL];manifestTreeElement.parent.removeChild(manifestTreeElement);}
_applicationCacheFrameManifestStatusChanged(event){const frameId=event.data;const status=this._applicationCacheModel.frameManifestStatus(frameId);if(this._applicationCacheViews[frameId])
this._applicationCacheViews[frameId].updateStatus(status);}
_applicationCacheNetworkStateChanged(event){const isNowOnline=event.data;for(const manifestURL in this._applicationCacheViews)
this._applicationCacheViews[manifestURL].updateNetworkState(isNowOnline);}
showView(view){if(view)
this.showResource(view.resource);}
_onmousemove(event){const nodeUnderMouse=event.target;if(!nodeUnderMouse)
return;const listNode=nodeUnderMouse.enclosingNodeOrSelfWithNodeName('li');if(!listNode)
return;const element=listNode.treeElement;if(this._previousHoveredElement===element)
return;if(this._previousHoveredElement){this._previousHoveredElement.hovered=false;delete this._previousHoveredElement;}
if(element instanceof Resources.FrameTreeElement){this._previousHoveredElement=element;element.hovered=true;}}
_onmouseleave(event){if(this._previousHoveredElement){this._previousHoveredElement.hovered=false;delete this._previousHoveredElement;}}};Resources.BaseStorageTreeElement=class extends UI.TreeElement{constructor(storagePanel,title,expandable){super(title,expandable);this._storagePanel=storagePanel;}
onselect(selectedByUser){if(!selectedByUser)
return false;const path=[];for(let el=this;el;el=el.parent){const url=el.itemURL;if(!url)
break;path.push(url);}
this._storagePanel.setLastSelectedItemPath(path);return false;}
showView(view){this._storagePanel.showView(view);}};Resources.StorageCategoryTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,categoryName,settingsKey){super(storagePanel,categoryName,false);this._expandedSetting=Common.settings.createSetting('resources'+settingsKey+'Expanded',settingsKey==='Frames');this._categoryName=categoryName;this._categoryLink=null;}
get itemURL(){return'category://'+this._categoryName;}
setLink(link){this._categoryLink=link;}
onselect(selectedByUser){super.onselect(selectedByUser);this._storagePanel.showCategoryView(this._categoryName,this._categoryLink);return false;}
onattach(){super.onattach();if(this._expandedSetting.get())
this.expand();}
onexpand(){this._expandedSetting.set(true);}
oncollapse(){this._expandedSetting.set(false);}};Resources.BackgroundServiceTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,serviceName){super(storagePanel,Resources.BackgroundServiceView.getUIString(serviceName),false);this._serviceName=serviceName;this._selected=false;this._view=null;this._model=null;const backgroundServiceIcon=UI.Icon.create(this._getIconType(),'resource-tree-item');this.setLeadingIcons([backgroundServiceIcon]);}
_getIconType(){switch(this._serviceName){case Protocol.BackgroundService.ServiceName.BackgroundFetch:return'mediumicon-fetch';case Protocol.BackgroundService.ServiceName.BackgroundSync:return'mediumicon-sync';case Protocol.BackgroundService.ServiceName.PushMessaging:return'mediumicon-cloud';case Protocol.BackgroundService.ServiceName.Notifications:return'mediumicon-bell';case Protocol.BackgroundService.ServiceName.PaymentHandler:return'mediumicon-payment';case Protocol.BackgroundService.ServiceName.PeriodicBackgroundSync:return'mediumicon-schedule';default:console.error(`Service ${this._serviceName} does not have a dedicated icon`);return'mediumicon-table';}}
_initialize(model){this._model=model;if(this._selected&&!this._view)
this.onselect(false);}
get itemURL(){return`background-service://${this._serviceName}`;}
onselect(selectedByUser){super.onselect(selectedByUser);this._selected=true;if(!this._model)
return false;if(!this._view)
this._view=new Resources.BackgroundServiceView(this._serviceName,this._model);this.showView(this._view);UI.context.setFlavor(Resources.BackgroundServiceView,this._view);return false;}};Resources.DatabaseTreeElement=class extends Resources.BaseStorageTreeElement{constructor(sidebar,database){super(sidebar._panel,database.name,true);this._sidebar=sidebar;this._database=database;const icon=UI.Icon.create('mediumicon-database','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'database://'+encodeURI(this._database.name);}
onselect(selectedByUser){super.onselect(selectedByUser);this._sidebar._showDatabase(this._database);return false;}
onexpand(){this._updateChildren();}
async _updateChildren(){const tableNames=await this._database.tableNames();for(const tableName of tableNames)
this.appendChild(new Resources.DatabaseTableTreeElement(this._sidebar,this._database,tableName));}};Resources.DatabaseTableTreeElement=class extends Resources.BaseStorageTreeElement{constructor(sidebar,database,tableName){super(sidebar._panel,tableName,false);this._sidebar=sidebar;this._database=database;this._tableName=tableName;const icon=UI.Icon.create('mediumicon-table','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'database://'+encodeURI(this._database.name)+'/'+encodeURI(this._tableName);}
onselect(selectedByUser){super.onselect(selectedByUser);this._sidebar._showDatabase(this._database,this._tableName);return false;}};Resources.ServiceWorkerCacheTreeElement=class extends Resources.StorageCategoryTreeElement{constructor(storagePanel){super(storagePanel,Common.UIString('Cache Storage'),'CacheStorage');const icon=UI.Icon.create('mediumicon-database','resource-tree-item');this.setLeadingIcons([icon]);this._swCacheModel=null;}
_initialize(model){this._swCacheTreeElements=[];this._swCacheModel=model;if(model){for(const cache of model.caches())
this._addCache(model,cache);}
SDK.targetManager.addModelListener(SDK.ServiceWorkerCacheModel,SDK.ServiceWorkerCacheModel.Events.CacheAdded,this._cacheAdded,this);SDK.targetManager.addModelListener(SDK.ServiceWorkerCacheModel,SDK.ServiceWorkerCacheModel.Events.CacheRemoved,this._cacheRemoved,this);}
onattach(){super.onattach();this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),true);}
_handleContextMenuEvent(event){const contextMenu=new UI.ContextMenu(event);contextMenu.defaultSection().appendItem(Common.UIString('Refresh Caches'),this._refreshCaches.bind(this));contextMenu.show();}
_refreshCaches(){if(this._swCacheModel)
this._swCacheModel.refreshCacheNames();}
_cacheAdded(event){const cache=(event.data.cache);const model=(event.data.model);this._addCache(model,cache);}
_addCache(model,cache){const swCacheTreeElement=new Resources.SWCacheTreeElement(this._storagePanel,model,cache);this._swCacheTreeElements.push(swCacheTreeElement);this.appendChild(swCacheTreeElement);}
_cacheRemoved(event){const cache=(event.data.cache);const model=(event.data.model);const swCacheTreeElement=this._cacheTreeElement(model,cache);if(!swCacheTreeElement)
return;this.removeChild(swCacheTreeElement);this._swCacheTreeElements.remove(swCacheTreeElement);this.setExpandable(this.childCount()>0);}
_cacheTreeElement(model,cache){let index=-1;let i;for(i=0;i<this._swCacheTreeElements.length;++i){if(this._swCacheTreeElements[i]._cache.equals(cache)&&this._swCacheTreeElements[i]._model===model){index=i;break;}}
if(index!==-1)
return this._swCacheTreeElements[i];return null;}};Resources.SWCacheTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,model,cache){super(storagePanel,cache.cacheName+' - '+cache.securityOrigin,false);this._model=model;this._cache=cache;this._view=null;const icon=UI.Icon.create('mediumicon-table','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'cache://'+this._cache.cacheId;}
onattach(){super.onattach();this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),true);}
_handleContextMenuEvent(event){const contextMenu=new UI.ContextMenu(event);contextMenu.defaultSection().appendItem(Common.UIString('Delete'),this._clearCache.bind(this));contextMenu.show();}
_clearCache(){this._model.deleteCache(this._cache);}
update(cache){this._cache=cache;if(this._view)
this._view.update(cache);}
onselect(selectedByUser){super.onselect(selectedByUser);if(!this._view)
this._view=new Resources.ServiceWorkerCacheView(this._model,this._cache);this.showView(this._view);return false;}};Resources.ServiceWorkersTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel){super(storagePanel,Common.UIString('Service Workers'),false);const icon=UI.Icon.create('mediumicon-service-worker','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'service-workers://';}
onselect(selectedByUser){super.onselect(selectedByUser);if(!this._view)
this._view=new Resources.ServiceWorkersView();this.showView(this._view);return false;}};Resources.AppManifestTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel){super(storagePanel,Common.UIString('Manifest'),false);const icon=UI.Icon.create('mediumicon-manifest','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'manifest://';}
onselect(selectedByUser){super.onselect(selectedByUser);if(!this._view)
this._view=new Resources.AppManifestView();this.showView(this._view);return false;}};Resources.ClearStorageTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel){super(storagePanel,Common.UIString('Clear storage'),false);const icon=UI.Icon.create('mediumicon-clear-storage','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'clear-storage://';}
onselect(selectedByUser){super.onselect(selectedByUser);if(!this._view)
this._view=new Resources.ClearStorageView();this.showView(this._view);return false;}};Resources.IndexedDBTreeElement=class extends Resources.StorageCategoryTreeElement{constructor(storagePanel){super(storagePanel,Common.UIString('IndexedDB'),'IndexedDB');const icon=UI.Icon.create('mediumicon-database','resource-tree-item');this.setLeadingIcons([icon]);}
_initialize(){SDK.targetManager.addModelListener(Resources.IndexedDBModel,Resources.IndexedDBModel.Events.DatabaseAdded,this._indexedDBAdded,this);SDK.targetManager.addModelListener(Resources.IndexedDBModel,Resources.IndexedDBModel.Events.DatabaseRemoved,this._indexedDBRemoved,this);SDK.targetManager.addModelListener(Resources.IndexedDBModel,Resources.IndexedDBModel.Events.DatabaseLoaded,this._indexedDBLoaded,this);SDK.targetManager.addModelListener(Resources.IndexedDBModel,Resources.IndexedDBModel.Events.IndexedDBContentUpdated,this._indexedDBContentUpdated,this);this._idbDatabaseTreeElements=[];for(const indexedDBModel of SDK.targetManager.models(Resources.IndexedDBModel)){const databases=indexedDBModel.databases();for(let j=0;j<databases.length;++j)
this._addIndexedDB(indexedDBModel,databases[j]);}}
removeIndexedDBForModel(model){const idbDatabaseTreeElements=this._idbDatabaseTreeElements.filter(element=>element._model===model);for(const idbDatabaseTreeElement of idbDatabaseTreeElements)
this._removeIDBDatabaseTreeElement(idbDatabaseTreeElement);}
onattach(){super.onattach();this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),true);}
_handleContextMenuEvent(event){const contextMenu=new UI.ContextMenu(event);contextMenu.defaultSection().appendItem(Common.UIString('Refresh IndexedDB'),this.refreshIndexedDB.bind(this));contextMenu.show();}
refreshIndexedDB(){for(const indexedDBModel of SDK.targetManager.models(Resources.IndexedDBModel))
indexedDBModel.refreshDatabaseNames();}
_indexedDBAdded(event){const databaseId=(event.data.databaseId);const model=(event.data.model);this._addIndexedDB(model,databaseId);}
_addIndexedDB(model,databaseId){const idbDatabaseTreeElement=new Resources.IDBDatabaseTreeElement(this._storagePanel,model,databaseId);this._idbDatabaseTreeElements.push(idbDatabaseTreeElement);this.appendChild(idbDatabaseTreeElement);model.refreshDatabase(databaseId);}
_indexedDBRemoved(event){const databaseId=(event.data.databaseId);const model=(event.data.model);const idbDatabaseTreeElement=this._idbDatabaseTreeElement(model,databaseId);if(!idbDatabaseTreeElement)
return;this._removeIDBDatabaseTreeElement(idbDatabaseTreeElement);}
_removeIDBDatabaseTreeElement(idbDatabaseTreeElement){idbDatabaseTreeElement.clear();this.removeChild(idbDatabaseTreeElement);this._idbDatabaseTreeElements.remove(idbDatabaseTreeElement);this.setExpandable(this.childCount()>0);}
_indexedDBLoaded(event){const database=(event.data.database);const model=(event.data.model);const entriesUpdated=(event.data.entriesUpdated);const idbDatabaseTreeElement=this._idbDatabaseTreeElement(model,database.databaseId);if(!idbDatabaseTreeElement)
return;idbDatabaseTreeElement.update(database,entriesUpdated);this._indexedDBLoadedForTest();}
_indexedDBLoadedForTest(){}
_indexedDBContentUpdated(event){const databaseId=(event.data.databaseId);const objectStoreName=(event.data.objectStoreName);const model=(event.data.model);const idbDatabaseTreeElement=this._idbDatabaseTreeElement(model,databaseId);if(!idbDatabaseTreeElement)
return;idbDatabaseTreeElement.indexedDBContentUpdated(objectStoreName);}
_idbDatabaseTreeElement(model,databaseId){return this._idbDatabaseTreeElements.find(x=>x._databaseId.equals(databaseId)&&x._model===model)||null;}};Resources.IDBDatabaseTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,model,databaseId){super(storagePanel,databaseId.name+' - '+databaseId.securityOrigin,false);this._model=model;this._databaseId=databaseId;this._idbObjectStoreTreeElements={};const icon=UI.Icon.create('mediumicon-database','resource-tree-item');this.setLeadingIcons([icon]);this._model.addEventListener(Resources.IndexedDBModel.Events.DatabaseNamesRefreshed,this._refreshIndexedDB,this);}
get itemURL(){return'indexedDB://'+this._databaseId.securityOrigin+'/'+this._databaseId.name;}
onattach(){super.onattach();this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),true);}
_handleContextMenuEvent(event){const contextMenu=new UI.ContextMenu(event);contextMenu.defaultSection().appendItem(Common.UIString('Refresh IndexedDB'),this._refreshIndexedDB.bind(this));contextMenu.show();}
_refreshIndexedDB(){this._model.refreshDatabase(this._databaseId);}
indexedDBContentUpdated(objectStoreName){if(this._idbObjectStoreTreeElements[objectStoreName])
this._idbObjectStoreTreeElements[objectStoreName].markNeedsRefresh();}
update(database,entriesUpdated){this._database=database;const objectStoreNames={};const objectStoreNamesSorted=Object.keys(this._database.objectStores).sort();for(const objectStoreName of objectStoreNamesSorted){const objectStore=this._database.objectStores[objectStoreName];objectStoreNames[objectStore.name]=true;if(!this._idbObjectStoreTreeElements[objectStore.name]){const idbObjectStoreTreeElement=new Resources.IDBObjectStoreTreeElement(this._storagePanel,this._model,this._databaseId,objectStore);this._idbObjectStoreTreeElements[objectStore.name]=idbObjectStoreTreeElement;this.appendChild(idbObjectStoreTreeElement);}
this._idbObjectStoreTreeElements[objectStore.name].update(objectStore,entriesUpdated);}
for(const objectStoreName in this._idbObjectStoreTreeElements){if(!objectStoreNames[objectStoreName])
this._objectStoreRemoved(objectStoreName);}
if(this._view)
this._view.update(database);this._updateTooltip();}
_updateTooltip(){if(Object.keys(this._idbObjectStoreTreeElements).length===0)
this.tooltip=ls`Version: ${this._database.version} (empty)`;else
this.tooltip=ls`Version: ${this._database.version}`;}
onselect(selectedByUser){super.onselect(selectedByUser);if(!this._view)
this._view=new Resources.IDBDatabaseView(this._model,this._database);this.showView(this._view);return false;}
_objectStoreRemoved(objectStoreName){const objectStoreTreeElement=this._idbObjectStoreTreeElements[objectStoreName];objectStoreTreeElement.clear();this.removeChild(objectStoreTreeElement);delete this._idbObjectStoreTreeElements[objectStoreName];this._updateTooltip();}
clear(){for(const objectStoreName in this._idbObjectStoreTreeElements)
this._objectStoreRemoved(objectStoreName);}};Resources.IDBObjectStoreTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,model,databaseId,objectStore){super(storagePanel,objectStore.name,false);this._model=model;this._databaseId=databaseId;this._idbIndexTreeElements={};this._objectStore=objectStore;this._view=null;const icon=UI.Icon.create('mediumicon-table','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'indexedDB://'+this._databaseId.securityOrigin+'/'+this._databaseId.name+'/'+
this._objectStore.name;}
onattach(){super.onattach();this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),true);}
markNeedsRefresh(){if(this._view)
this._view.markNeedsRefresh();for(const indexName in this._idbIndexTreeElements)
this._idbIndexTreeElements[indexName].markNeedsRefresh();}
_handleContextMenuEvent(event){const contextMenu=new UI.ContextMenu(event);contextMenu.defaultSection().appendItem(Common.UIString('Clear'),this._clearObjectStore.bind(this));contextMenu.show();}
_refreshObjectStore(){if(this._view)
this._view.refreshData();for(const indexName in this._idbIndexTreeElements)
this._idbIndexTreeElements[indexName].refreshIndex();}
async _clearObjectStore(){await this._model.clearObjectStore(this._databaseId,this._objectStore.name);this.update(this._objectStore,true);}
update(objectStore,entriesUpdated){this._objectStore=objectStore;const indexNames={};for(const indexName in this._objectStore.indexes){const index=this._objectStore.indexes[indexName];indexNames[index.name]=true;if(!this._idbIndexTreeElements[index.name]){const idbIndexTreeElement=new Resources.IDBIndexTreeElement(this._storagePanel,this._model,this._databaseId,this._objectStore,index,this._refreshObjectStore.bind(this));this._idbIndexTreeElements[index.name]=idbIndexTreeElement;this.appendChild(idbIndexTreeElement);}
this._idbIndexTreeElements[index.name].update(this._objectStore,index,entriesUpdated);}
for(const indexName in this._idbIndexTreeElements){if(!indexNames[indexName])
this._indexRemoved(indexName);}
for(const indexName in this._idbIndexTreeElements){if(!indexNames[indexName]){this.removeChild(this._idbIndexTreeElements[indexName]);delete this._idbIndexTreeElements[indexName];}}
if(this.childCount())
this.expand();if(this._view&&entriesUpdated)
this._view.update(this._objectStore,null);this._updateTooltip();}
_updateTooltip(){const keyPathString=this._objectStore.keyPathString;let tooltipString=keyPathString!==null?ls`Key path: ${keyPathString}`:'';if(this._objectStore.autoIncrement)
tooltipString+='\n'+Common.UIString('autoIncrement');this.tooltip=tooltipString;}
onselect(selectedByUser){super.onselect(selectedByUser);if(!this._view){this._view=new Resources.IDBDataView(this._model,this._databaseId,this._objectStore,null,this._refreshObjectStore.bind(this));}
this.showView(this._view);return false;}
_indexRemoved(indexName){const indexTreeElement=this._idbIndexTreeElements[indexName];indexTreeElement.clear();this.removeChild(indexTreeElement);delete this._idbIndexTreeElements[indexName];}
clear(){for(const indexName in this._idbIndexTreeElements)
this._indexRemoved(indexName);if(this._view)
this._view.clear();}};Resources.IDBIndexTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,model,databaseId,objectStore,index,refreshObjectStore){super(storagePanel,index.name,false);this._model=model;this._databaseId=databaseId;this._objectStore=objectStore;this._index=index;this._refreshObjectStore=refreshObjectStore;}
get itemURL(){return'indexedDB://'+this._databaseId.securityOrigin+'/'+this._databaseId.name+'/'+
this._objectStore.name+'/'+this._index.name;}
markNeedsRefresh(){if(this._view)
this._view.markNeedsRefresh();}
refreshIndex(){if(this._view)
this._view.refreshData();}
update(objectStore,index,entriesUpdated){this._objectStore=objectStore;this._index=index;if(this._view&&entriesUpdated)
this._view.update(this._objectStore,this._index);this._updateTooltip();}
_updateTooltip(){const tooltipLines=[];const keyPathString=this._index.keyPathString;tooltipLines.push(ls`Key path: ${keyPathString}`);if(this._index.unique)
tooltipLines.push(Common.UIString('unique'));if(this._index.multiEntry)
tooltipLines.push(Common.UIString('multiEntry'));this.tooltip=tooltipLines.join('\n');}
onselect(selectedByUser){super.onselect(selectedByUser);if(!this._view){this._view=new Resources.IDBDataView(this._model,this._databaseId,this._objectStore,this._index,this._refreshObjectStore);}
this.showView(this._view);return false;}
clear(){if(this._view)
this._view.clear();}};Resources.DOMStorageTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,domStorage){super(storagePanel,domStorage.securityOrigin?domStorage.securityOrigin:Common.UIString('Local Files'),false);this._domStorage=domStorage;const icon=UI.Icon.create('mediumicon-table','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'storage://'+this._domStorage.securityOrigin+'/'+
(this._domStorage.isLocalStorage?'local':'session');}
onselect(selectedByUser){super.onselect(selectedByUser);this._storagePanel.showDOMStorage(this._domStorage);return false;}
onattach(){super.onattach();this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),true);}
_handleContextMenuEvent(event){const contextMenu=new UI.ContextMenu(event);contextMenu.defaultSection().appendItem(Common.UIString('Clear'),()=>this._domStorage.clear());contextMenu.show();}};Resources.CookieTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,frame,cookieDomain){super(storagePanel,cookieDomain?cookieDomain:Common.UIString('Local Files'),false);this._target=frame.resourceTreeModel().target();this._cookieDomain=cookieDomain;this.tooltip=ls`cookies used by frames from ${cookieDomain}`;const icon=UI.Icon.create('mediumicon-cookie','resource-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'cookies://'+this._cookieDomain;}
onattach(){super.onattach();this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),true);}
_handleContextMenuEvent(event){const contextMenu=new UI.ContextMenu(event);contextMenu.defaultSection().appendItem(Common.UIString('Clear'),()=>this._storagePanel.clearCookies(this._target,this._cookieDomain));contextMenu.show();}
onselect(selectedByUser){super.onselect(selectedByUser);this._storagePanel.showCookies(this._target,this._cookieDomain);return false;}};Resources.ApplicationCacheManifestTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,manifestURL){const title=new Common.ParsedURL(manifestURL).displayName;super(storagePanel,title,false);this.tooltip=manifestURL;this._manifestURL=manifestURL;}
get itemURL(){return'appcache://'+this._manifestURL;}
get manifestURL(){return this._manifestURL;}
onselect(selectedByUser){super.onselect(selectedByUser);this._storagePanel.showCategoryView(this._manifestURL,null);return false;}};Resources.ApplicationCacheFrameTreeElement=class extends Resources.BaseStorageTreeElement{constructor(sidebar,frame,manifestURL){super(sidebar._panel,'',false);this._sidebar=sidebar;this._frameId=frame.id;this._manifestURL=manifestURL;this._refreshTitles(frame);const icon=UI.Icon.create('largeicon-navigator-folder','navigator-tree-item');icon.classList.add('navigator-folder-tree-item');this.setLeadingIcons([icon]);}
get itemURL(){return'appcache://'+this._manifestURL+'/'+encodeURI(this.titleAsText());}
get frameId(){return this._frameId;}
get manifestURL(){return this._manifestURL;}
_refreshTitles(frame){this.title=frame.displayName();}
frameNavigated(frame){this._refreshTitles(frame);}
onselect(selectedByUser){super.onselect(selectedByUser);this._sidebar._showApplicationCache(this._frameId);return false;}};Resources.StorageCategoryView=class extends UI.VBox{constructor(){super();this.element.classList.add('storage-view');this._emptyWidget=new UI.EmptyWidget('');this._linkElement=null;this._emptyWidget.show(this.element);}
setText(text){this._emptyWidget.text=text;}
setLink(link){if(link&&!this._linkElement)
this._linkElement=this._emptyWidget.appendLink(link);if(!link&&this._linkElement)
this._linkElement.classList.add('hidden');if(link&&this._linkElement){this._linkElement.setAttribute('href',link);this._linkElement.classList.remove('hidden');}}};;Resources.ResourcesSection=class{constructor(storagePanel,treeElement){this._panel=storagePanel;this._treeElement=treeElement;this._treeElementForFrameId=new Map();function addListener(eventType,handler,target){SDK.targetManager.addModelListener(SDK.ResourceTreeModel,eventType,event=>handler.call(target,event.data));}
addListener(SDK.ResourceTreeModel.Events.FrameAdded,this._frameAdded,this);addListener(SDK.ResourceTreeModel.Events.FrameNavigated,this._frameNavigated,this);addListener(SDK.ResourceTreeModel.Events.FrameDetached,this._frameDetached,this);addListener(SDK.ResourceTreeModel.Events.ResourceAdded,this._resourceAdded,this);const mainTarget=SDK.targetManager.mainTarget();const resourceTreeModel=mainTarget&&mainTarget.model(SDK.ResourceTreeModel);const mainFrame=resourceTreeModel&&resourceTreeModel.mainFrame;if(mainFrame)
this._frameAdded(mainFrame);}
static _getParentFrame(frame){const parentFrame=frame.parentFrame;if(parentFrame)
return parentFrame;const parentTarget=frame.resourceTreeModel().target().parentTarget();if(!parentTarget)
return null;return parentTarget.model(SDK.ResourceTreeModel).mainFrame;}
_expandFrame(frame){if(!frame)
return false;let treeElement=this._treeElementForFrameId.get(frame.id);if(!treeElement&&!this._expandFrame(Resources.ResourcesSection._getParentFrame(frame)))
return false;treeElement=this._treeElementForFrameId.get(frame.id);if(!treeElement)
return false;treeElement.expand();return true;}
async revealResource(resource,line,column){if(!this._expandFrame(resource.frame()))
return;const resourceTreeElement=Resources.FrameResourceTreeElement.forResource(resource);if(resourceTreeElement)
await resourceTreeElement.revealResource(line,column);}
_frameAdded(frame){const parentFrame=Resources.ResourcesSection._getParentFrame(frame);const parentTreeElement=parentFrame?this._treeElementForFrameId.get(parentFrame.id):this._treeElement;if(!parentTreeElement)
return;const frameTreeElement=new Resources.FrameTreeElement(this,frame);this._treeElementForFrameId.set(frame.id,frameTreeElement);parentTreeElement.appendChild(frameTreeElement);}
_frameDetached(frame){const frameTreeElement=this._treeElementForFrameId.get(frame.id);if(!frameTreeElement)
return;this._treeElementForFrameId.remove(frame.id);if(frameTreeElement.parent)
frameTreeElement.parent.removeChild(frameTreeElement);}
_frameNavigated(frame){const frameTreeElement=this._treeElementForFrameId.get(frame.id);if(frameTreeElement)
frameTreeElement.frameNavigated(frame);}
_resourceAdded(resource){const frameTreeElement=this._treeElementForFrameId.get(resource.frameId);if(!frameTreeElement){return;}
frameTreeElement.appendResource(resource);}
reset(){this._treeElement.removeChildren();this._treeElementForFrameId.clear();}};Resources.FrameTreeElement=class extends Resources.BaseStorageTreeElement{constructor(section,frame){super(section._panel,'',false);this._populated=false;this._section=section;this._frame=frame;this._frameId=frame.id;this._categoryElements={};this._treeElementForResource={};this.setExpandable(true);this.frameNavigated(frame);const icon=UI.Icon.create('largeicon-navigator-frame','navigator-tree-item');icon.classList.add('navigator-frame-tree-item');this.setLeadingIcons([icon]);}
frameNavigated(frame){this.invalidateChildren();this._frameId=frame.id;this.title=frame.displayName();this._categoryElements={};this._treeElementForResource={};}
get itemURL(){return'frame://'+encodeURI(this.titleAsText());}
onselect(selectedByUser){super.onselect(selectedByUser);this._section._panel.showCategoryView(this.titleAsText(),null);this.listItemElement.classList.remove('hovered');SDK.OverlayModel.hideDOMNodeHighlight();return false;}
set hovered(hovered){if(hovered){this.listItemElement.classList.add('hovered');this._frame.resourceTreeModel().domModel().overlayModel().highlightFrame(this._frameId);}else{this.listItemElement.classList.remove('hovered');SDK.OverlayModel.hideDOMNodeHighlight();}}
appendResource(resource){if(!this._populated)
return;const statusCode=resource['statusCode'];if(statusCode>=301&&statusCode<=303)
return;const resourceType=resource.resourceType();const categoryName=resourceType.name();let categoryElement=resourceType===Common.resourceTypes.Document?this:this._categoryElements[categoryName];if(!categoryElement){categoryElement=new Resources.StorageCategoryTreeElement(this._section._panel,resource.resourceType().category().title,categoryName);this._categoryElements[resourceType.name()]=categoryElement;this._insertInPresentationOrder(this,categoryElement);}
const resourceTreeElement=new Resources.FrameResourceTreeElement(this._section._panel,resource);this._insertInPresentationOrder(categoryElement,resourceTreeElement);this._treeElementForResource[resource.url]=resourceTreeElement;}
resourceByURL(url){const treeElement=this._treeElementForResource[url];return treeElement?treeElement._resource:null;}
appendChild(treeElement){if(!this._populated)
return;this._insertInPresentationOrder(this,treeElement);}
_insertInPresentationOrder(parentTreeElement,childTreeElement){function typeWeight(treeElement){if(treeElement instanceof Resources.StorageCategoryTreeElement)
return 2;if(treeElement instanceof Resources.FrameTreeElement)
return 1;return 3;}
function compare(treeElement1,treeElement2){const typeWeight1=typeWeight(treeElement1);const typeWeight2=typeWeight(treeElement2);let result;if(typeWeight1>typeWeight2)
result=1;else if(typeWeight1<typeWeight2)
result=-1;else
result=treeElement1.titleAsText().localeCompare(treeElement2.titleAsText());return result;}
const childCount=parentTreeElement.childCount();let i;for(i=0;i<childCount;++i){if(compare(childTreeElement,parentTreeElement.childAt(i))<0)
break;}
parentTreeElement.insertChild(childTreeElement,i);}
async onpopulate(){this._populated=true;for(const child of this._frame.childFrames)
this._section._frameAdded(child);for(const resource of this._frame.resources())
this.appendResource(resource);}};Resources.FrameResourceTreeElement=class extends Resources.BaseStorageTreeElement{constructor(storagePanel,resource){super(storagePanel,resource.displayName,false);this._panel=storagePanel;this._resource=resource;this._previewPromise=null;this.tooltip=resource.url;this._resource[Resources.FrameResourceTreeElement._symbol]=this;const icon=UI.Icon.create('largeicon-navigator-file','navigator-tree-item');icon.classList.add('navigator-file-tree-item');icon.classList.add('navigator-'+resource.resourceType().name()+'-tree-item');this.setLeadingIcons([icon]);}
static forResource(resource){return resource[Resources.FrameResourceTreeElement._symbol];}
get itemURL(){return this._resource.url;}
_preparePreview(){if(this._previewPromise)
return this._previewPromise;const viewPromise=SourceFrame.PreviewFactory.createPreview(this._resource,this._resource.mimeType);this._previewPromise=viewPromise.then(view=>{if(view)
return view;return new UI.EmptyWidget(this._resource.url);});return this._previewPromise;}
onselect(selectedByUser){super.onselect(selectedByUser);this._panel.scheduleShowView(this._preparePreview());return false;}
ondblclick(event){InspectorFrontendHost.openInNewTab(this._resource.url);return false;}
onattach(){super.onattach();this.listItemElement.draggable=true;this.listItemElement.addEventListener('dragstart',this._ondragstart.bind(this),false);this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),true);}
_ondragstart(event){event.dataTransfer.setData('text/plain',this._resource.content||'');event.dataTransfer.effectAllowed='copy';return true;}
_handleContextMenuEvent(event){const contextMenu=new UI.ContextMenu(event);contextMenu.appendApplicableItems(this._resource);contextMenu.show();}
async revealResource(line,column){this.revealAndSelect(true);const view=await this._panel.scheduleShowView(this._preparePreview());if(!(view instanceof SourceFrame.ResourceSourceFrame)||typeof line!=='number')
return;view.revealPosition(line,column,true);}};Resources.FrameResourceTreeElement._symbol=Symbol('treeElement');;Resources.ServiceWorkerCacheView=class extends UI.SimpleView{constructor(model,cache){super(Common.UIString('Cache'));this.registerRequiredCSS('resources/serviceWorkerCacheViews.css');this._model=model;this._entriesForTest=null;this.element.classList.add('service-worker-cache-data-view');this.element.classList.add('storage-view');const editorToolbar=new UI.Toolbar('data-view-toolbar',this.element);this._splitWidget=new UI.SplitWidget(false,false);this._splitWidget.show(this.element);this._previewPanel=new UI.VBox();const resizer=this._previewPanel.element.createChild('div','cache-preview-panel-resizer');this._splitWidget.setMainWidget(this._previewPanel);this._splitWidget.installResizer(resizer);this._preview=null;this._cache=cache;this._dataGrid=null;this._lastPageSize=null;this._lastSkipCount=null;this._refreshThrottler=new Common.Throttler(300);this._pageBackButton=new UI.ToolbarButton(Common.UIString('Show previous page'),'largeicon-play-back');this._pageBackButton.addEventListener(UI.ToolbarButton.Events.Click,this._pageBackButtonClicked,this);editorToolbar.appendToolbarItem(this._pageBackButton);this._pageForwardButton=new UI.ToolbarButton(Common.UIString('Show next page'),'largeicon-play');this._pageForwardButton.setEnabled(false);this._pageForwardButton.addEventListener(UI.ToolbarButton.Events.Click,this._pageForwardButtonClicked,this);editorToolbar.appendToolbarItem(this._pageForwardButton);this._refreshButton=new UI.ToolbarButton(Common.UIString('Refresh'),'largeicon-refresh');this._refreshButton.addEventListener(UI.ToolbarButton.Events.Click,this._refreshButtonClicked,this);editorToolbar.appendToolbarItem(this._refreshButton);this._deleteSelectedButton=new UI.ToolbarButton(Common.UIString('Delete Selected'),'largeicon-delete');this._deleteSelectedButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this._deleteButtonClicked(null));editorToolbar.appendToolbarItem(this._deleteSelectedButton);const entryPathFilterBox=new UI.ToolbarInput(ls`Filter by Path`,1);editorToolbar.appendToolbarItem(entryPathFilterBox);const entryPathFilterThrottler=new Common.Throttler(300);this._entryPathFilter='';entryPathFilterBox.addEventListener(UI.ToolbarInput.Event.TextChanged,()=>{entryPathFilterThrottler.schedule(()=>{this._entryPathFilter=entryPathFilterBox.value();this._skipCount=0;return this._updateData(true);});});this._pageSize=50;this._skipCount=0;this._returnCount=(null);this._summaryBarElement=(null);this.update(cache);}
_resetDataGrid(){if(this._dataGrid)
this._dataGrid.asWidget().detach();this._dataGrid=this._createDataGrid();const dataGridWidget=this._dataGrid.asWidget();this._splitWidget.setSidebarWidget(dataGridWidget);dataGridWidget.setMinimumSize(0,250);this._skipCount=0;}
wasShown(){this._model.addEventListener(SDK.ServiceWorkerCacheModel.Events.CacheStorageContentUpdated,this._cacheContentUpdated,this);this._updateData(true);}
willHide(){this._model.removeEventListener(SDK.ServiceWorkerCacheModel.Events.CacheStorageContentUpdated,this._cacheContentUpdated,this);}
_showPreview(preview){if(preview&&this._preview===preview)
return;if(this._preview)
this._preview.detach();if(!preview)
preview=new UI.EmptyWidget(Common.UIString('Select a cache entry above to preview'));this._preview=preview;this._preview.show(this._previewPanel.element);}
_createDataGrid(){const columns=([{id:'number',title:'#',sortable:false,width:'3px'},{id:'name',title:Common.UIString('Name'),weight:4,sortable:true},{id:'responseType',title:ls`Response-Type`,weight:1,align:DataGrid.DataGrid.Align.Right,sortable:true},{id:'contentType',title:Common.UIString('Content-Type'),weight:1,sortable:true},{id:'contentLength',title:Common.UIString('Content-Length'),weight:1,align:DataGrid.DataGrid.Align.Right,sortable:true},{id:'responseTime',title:Common.UIString('Time Cached'),width:'12em',weight:1,align:DataGrid.DataGrid.Align.Right,sortable:true}]);const dataGrid=new DataGrid.DataGrid(columns,undefined,this._deleteButtonClicked.bind(this),this._updateData.bind(this,true));dataGrid.addEventListener(DataGrid.DataGrid.Events.SortingChanged,this._sortingChanged,this);dataGrid.addEventListener(DataGrid.DataGrid.Events.SelectedNode,event=>this._previewCachedResponse(event.data.data),this);dataGrid.setStriped(true);return dataGrid;}
_sortingChanged(){if(!this._dataGrid)
return;const accending=this._dataGrid.isSortOrderAscending();const columnId=this._dataGrid.sortColumnId();let comparator;if(columnId==='name')
comparator=(a,b)=>a._name.localeCompare(b._name);else if(columnId==='contentType')
comparator=(a,b)=>a.data.mimeType.localeCompare(b.data.mimeType);else if(columnId==='contentLength')
comparator=(a,b)=>a.data.resourceSize-b.data.resourceSize;else if(columnId==='responseTime')
comparator=(a,b)=>a.data.endTime-b.data.endTime;else if(columnId==='responseType')
comparator=(a,b)=>a._responseType.localeCompare(b._responseType);const children=this._dataGrid.rootNode().children.slice();this._dataGrid.rootNode().removeChildren();children.sort((a,b)=>{const result=comparator(a,b);return accending?result:-result;});children.forEach(child=>this._dataGrid.rootNode().appendChild(child));}
_pageBackButtonClicked(event){this._skipCount=Math.max(0,this._skipCount-this._pageSize);this._updateData(false);}
_pageForwardButtonClicked(event){this._skipCount=this._skipCount+this._pageSize;this._updateData(false);}
async _deleteButtonClicked(node){if(!node){node=this._dataGrid&&this._dataGrid.selectedNode;if(!node)
return;}
await this._model.deleteCacheEntry(this._cache,(node.data.url()));node.remove();}
update(cache){this._cache=cache;this._resetDataGrid();this._updateData(true);}
_updateSummaryBar(){if(!this._summaryBarElement)
this._summaryBarElement=this.element.createChild('div','cache-storage-summary-bar');this._summaryBarElement.removeChildren();const span=this._summaryBarElement.createChild('span');if(this._entryPathFilter)
span.textContent=ls`Matching entries: ${this._returnCount}`;else
span.textContent=ls`Total entries: ${this._returnCount}`;}
_updateDataCallback(skipCount,entries,returnCount){const selected=this._dataGrid.selectedNode&&this._dataGrid.selectedNode.data.url();this._refreshButton.setEnabled(true);this._entriesForTest=entries;this._returnCount=returnCount;this._updateSummaryBar();const hasMore=(this._skipCount+this._pageSize)<returnCount;const oldEntries=new Map();const rootNode=this._dataGrid.rootNode();for(const node of rootNode.children)
oldEntries.set(node.data.url,node);rootNode.removeChildren();let selectedNode=null;for(let i=0;i<entries.length;++i){const entry=entries[i];let node=oldEntries.get(entry.requestURL);if(!node||node.data.responseTime!==entry.responseTime){node=new Resources.ServiceWorkerCacheView.DataGridNode(i+this._skipCount,this._createRequest(entry),entry.responseType);node.selectable=true;}else{node.data.number=i+this._skipCount;}
rootNode.appendChild(node);if(entry.requestURL===selected)
selectedNode=node;}
this._pageBackButton.setEnabled(!!skipCount);this._pageForwardButton.setEnabled(hasMore);if(!selectedNode)
this._showPreview(null);else
selectedNode.revealAndSelect();this._updatedForTest();}
_updateData(force){const pageSize=this._pageSize;let skipCount=this._skipCount;if(!force&&this._lastPageSize===pageSize&&this._lastSkipCount===skipCount)
return;this._refreshButton.setEnabled(false);if(this._lastPageSize!==pageSize){skipCount=0;this._skipCount=0;}
this._lastPageSize=pageSize;this._lastSkipCount=skipCount;return new Promise(resolve=>{this._model.loadCacheData(this._cache,skipCount,pageSize,this._entryPathFilter,(entries,returnCount)=>{this._updateDataCallback(skipCount,entries,returnCount);resolve();});});}
_refreshButtonClicked(event){this._updateData(true);}
_cacheContentUpdated(event){const nameAndOrigin=event.data;if(this._cache.securityOrigin!==nameAndOrigin.origin||this._cache.cacheName!==nameAndOrigin.cacheName)
return;this._refreshThrottler.schedule(()=>Promise.resolve(this._updateData(true)),true);}
async _previewCachedResponse(request){let preview=request[Resources.ServiceWorkerCacheView._previewSymbol];if(!preview){preview=new Resources.ServiceWorkerCacheView.RequestView(request);request[Resources.ServiceWorkerCacheView._previewSymbol]=preview;}
if(request===this._dataGrid.selectedNode.data)
this._showPreview(preview);}
_createRequest(entry){const request=new SDK.NetworkRequest('cache-storage-'+entry.requestURL,entry.requestURL,'','','',null);request.requestMethod=entry.requestMethod;request.setRequestHeaders(entry.requestHeaders);request.statusCode=entry.responseStatus;request.statusText=entry.responseStatusText;request.protocol=new Common.ParsedURL(entry.requestURL).scheme;request.responseHeaders=entry.responseHeaders;request.setRequestHeadersText('');request.endTime=entry.responseTime;let header=entry.responseHeaders.find(header=>header.name.toLowerCase()==='content-type');const contentType=header?header.value:'text/plain';request.mimeType=contentType;header=entry.responseHeaders.find(header=>header.name.toLowerCase()==='content-length');request.resourceSize=(header&&header.value)|0;let resourceType=Common.ResourceType.fromMimeType(contentType);if(!resourceType)
resourceType=Common.ResourceType.fromURL(entry.requestURL)||Common.resourceTypes.Other;request.setResourceType(resourceType);request.setContentDataProvider(this._requestContent.bind(this,request));return request;}
async _requestContent(request){const isText=request.resourceType().isTextType();const contentData={error:null,content:null,encoded:!isText};const response=await this._cache.requestCachedResponse(request.url(),request.requestHeaders());if(response)
contentData.content=isText?window.atob(response.body):response.body;return contentData;}
_updatedForTest(){}};Resources.ServiceWorkerCacheView._previewSymbol=Symbol('preview');Resources.ServiceWorkerCacheView._RESPONSE_CACHE_SIZE=10;Resources.ServiceWorkerCacheView.DataGridNode=class extends DataGrid.DataGridNode{constructor(number,request,responseType){super(request);this._number=number;const parsed=new Common.ParsedURL(request.url());if(parsed.isValid)
this._name=request.url().trimURL(parsed.domain());else
this._name=request.url();this._request=request;this._responseType=responseType;}
createCell(columnId){const cell=this.createTD(columnId);let value;if(columnId==='number'){value=String(this._number);}else if(columnId==='name'){value=this._name;}else if(columnId==='responseType'){if(this._responseType==='opaqueResponse')
value='opaque';else if(this._responseType==='opaqueRedirect')
value='opaqueredirect';else
value=this._responseType;}else if(columnId==='contentType'){value=this._request.mimeType;}else if(columnId==='contentLength'){value=(this._request.resourceSize|0).toLocaleString('en-US');}else if(columnId==='responseTime'){value=new Date(this._request.endTime*1000).toLocaleString();}
DataGrid.DataGrid.setElementText(cell,value||'',true);cell.title=this._request.url();return cell;}};Resources.ServiceWorkerCacheView.RequestView=class extends UI.VBox{constructor(request){super();this._tabbedPane=new UI.TabbedPane();this._tabbedPane.addEventListener(UI.TabbedPane.Events.TabSelected,this._tabSelected,this);this._resourceViewTabSetting=Common.settings.createSetting('cacheStorageViewTab','preview');this._tabbedPane.appendTab('headers',Common.UIString('Headers'),new Network.RequestHeadersView(request));this._tabbedPane.appendTab('preview',Common.UIString('Preview'),new Network.RequestPreviewView(request));this._tabbedPane.show(this.element);}
wasShown(){super.wasShown();this._selectTab();}
_selectTab(tabId){if(!tabId)
tabId=this._resourceViewTabSetting.get();if(!this._tabbedPane.selectTab(tabId))
this._tabbedPane.selectTab('headers');}
_tabSelected(event){if(!event.data.isUserGesture)
return;this._resourceViewTabSetting.set(event.data.tabId);}};;Resources.ServiceWorkersView=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS('resources/serviceWorkersView.css');this._currentWorkersView=new UI.ReportView(Common.UIString('Service Workers'));this._currentWorkersView.setBodyScrollable(false);this.contentElement.classList.add('service-worker-list');this._currentWorkersView.show(this.contentElement);this._currentWorkersView.element.classList.add('service-workers-this-origin');this._toolbar=this._currentWorkersView.createToolbar();this._toolbar.makeWrappable(true);this._sections=new Map();this._registrationSymbol=Symbol('Resources.ServiceWorkersView');this._manager=null;this._securityOriginManager=null;this._filterThrottler=new Common.Throttler(300);this._otherWorkers=this.contentElement.createChild('div','service-workers-other-origin');this._otherSWFilter=this._otherWorkers.createChild('div','service-worker-filter');this._otherSWFilter.setAttribute('tabindex',0);this._otherSWFilter.setAttribute('role','switch');this._otherSWFilter.setAttribute('aria-checked',false);const filterLabel=this._otherSWFilter.createChild('label','service-worker-filter-label');filterLabel.textContent=Common.UIString('Service workers from other origins');onInvokeElement(this._otherSWFilter,event=>{if(event.target===this._otherSWFilter||event.target===filterLabel)
this._toggleFilter();});const toolbar=new UI.Toolbar('service-worker-filter-toolbar',this._otherSWFilter);this._filter=new UI.ToolbarInput(ls`Filter service worker`,1);this._filter.addEventListener(UI.ToolbarInput.Event.TextChanged,()=>this._filterChanged());toolbar.appendToolbarItem(this._filter);this._otherWorkersView=new UI.ReportView();this._otherWorkersView.setBodyScrollable(false);this._otherWorkersView.show(this._otherWorkers);this._otherWorkersView.element.classList.add('service-workers-for-other-origins');this._updateCollapsedStyle();this._toolbar.appendToolbarItem(MobileThrottling.throttlingManager().createOfflineToolbarCheckbox());const updateOnReloadSetting=Common.settings.createSetting('serviceWorkerUpdateOnReload',false);updateOnReloadSetting.setTitle(Common.UIString('Update on refresh'));const forceUpdate=new UI.ToolbarSettingCheckbox(updateOnReloadSetting,Common.UIString('Force update Service Worker on page refresh'));this._toolbar.appendToolbarItem(forceUpdate);const bypassServiceWorkerSetting=Common.settings.createSetting('bypassServiceWorker',false);bypassServiceWorkerSetting.setTitle(Common.UIString('Bypass for network'));const fallbackToNetwork=new UI.ToolbarSettingCheckbox(bypassServiceWorkerSetting,ls`Bypass the service worker and load resources from the network`);this._toolbar.appendToolbarItem(fallbackToNetwork);this._eventListeners=new Map();SDK.targetManager.observeModels(SDK.ServiceWorkerManager,this);this._updateListVisibility();}
modelAdded(serviceWorkerManager){if(this._manager)
return;this._manager=serviceWorkerManager;this._securityOriginManager=serviceWorkerManager.target().model(SDK.SecurityOriginManager);for(const registration of this._manager.registrations().values())
this._updateRegistration(registration);this._eventListeners.set(serviceWorkerManager,[this._manager.addEventListener(SDK.ServiceWorkerManager.Events.RegistrationUpdated,this._registrationUpdated,this),this._manager.addEventListener(SDK.ServiceWorkerManager.Events.RegistrationDeleted,this._registrationDeleted,this),this._securityOriginManager.addEventListener(SDK.SecurityOriginManager.Events.SecurityOriginAdded,this._updateSectionVisibility,this),this._securityOriginManager.addEventListener(SDK.SecurityOriginManager.Events.SecurityOriginRemoved,this._updateSectionVisibility,this),]);}
modelRemoved(serviceWorkerManager){if(!this._manager||this._manager!==serviceWorkerManager)
return;Common.EventTarget.removeEventListeners(this._eventListeners.get(serviceWorkerManager));this._eventListeners.delete(serviceWorkerManager);this._manager=null;this._securityOriginManager=null;}
_getTimeStamp(registration){const versions=registration.versionsByMode();let timestamp=0;const active=versions.get(SDK.ServiceWorkerVersion.Modes.Active);const installing=versions.get(SDK.ServiceWorkerVersion.Modes.Installing);const waiting=versions.get(SDK.ServiceWorkerVersion.Modes.Waiting);const redundant=versions.get(SDK.ServiceWorkerVersion.Modes.Redundant);if(active)
timestamp=active.scriptResponseTime;else if(waiting)
timestamp=waiting.scriptResponseTime;else if(installing)
timestamp=installing.scriptResponseTime;else if(redundant)
timestamp=redundant.scriptResponseTime;return timestamp;}
_updateSectionVisibility(){let hasOthers=false;let hasThis=false;const movedSections=[];for(const section of this._sections.values()){const expectedView=this._getReportViewForOrigin(section._registration.securityOrigin);hasOthers|=expectedView===this._otherWorkersView;hasThis|=expectedView===this._currentWorkersView;if(section._section.parentWidget()!==expectedView)
movedSections.push(section);}
for(const section of movedSections){const registration=section._registration;this._removeRegistrationFromList(registration);this._updateRegistration(registration,true);}
this._currentWorkersView.sortSections((a,b)=>{const aTimestamp=this._getTimeStamp(a[this._registrationSymbol]);const bTimestamp=this._getTimeStamp(b[this._registrationSymbol]);return bTimestamp-aTimestamp;});const scorer=new Sources.FilePathScoreFunction(this._filter.value());this._otherWorkersView.sortSections((a,b)=>{const cmp=scorer.score(b.title(),null)-scorer.score(a.title(),null);return cmp===0?a.title().localeCompare(b.title()):cmp;});for(const section of this._sections.values()){if(section._section.parentWidget()===this._currentWorkersView||this._isRegistrationVisible(section._registration))
section._section.showWidget();else
section._section.hideWidget();}
this.contentElement.classList.toggle('service-worker-has-current',hasThis);this._otherWorkers.classList.toggle('hidden',!hasOthers);this._updateListVisibility();}
_registrationUpdated(event){const registration=(event.data);this._updateRegistration(registration);this._gcRegistrations();}
_gcRegistrations(){let hasNonDeletedRegistrations=false;const securityOrigins=new Set(this._securityOriginManager.securityOrigins());for(const registration of this._manager.registrations().values()){if(!securityOrigins.has(registration.securityOrigin)&&!this._isRegistrationVisible(registration))
continue;if(!registration.canBeRemoved()){hasNonDeletedRegistrations=true;break;}}
if(!hasNonDeletedRegistrations)
return;for(const registration of this._manager.registrations().values()){const visible=securityOrigins.has(registration.securityOrigin)||this._isRegistrationVisible(registration);if(!visible&&registration.canBeRemoved())
this._removeRegistrationFromList(registration);}}
_getReportViewForOrigin(origin){if(this._securityOriginManager.securityOrigins().includes(origin)||this._securityOriginManager.unreachableMainSecurityOrigin()===origin)
return this._currentWorkersView;else
return this._otherWorkersView;}
_updateRegistration(registration,skipUpdate){let section=this._sections.get(registration);if(!section){const title=registration.scopeURL;const uiSection=this._getReportViewForOrigin(registration.securityOrigin).appendSection(title);uiSection[this._registrationSymbol]=registration;section=new Resources.ServiceWorkersView.Section((this._manager),uiSection,registration);this._sections.set(registration,section);}
if(skipUpdate)
return;this._updateSectionVisibility();section._scheduleUpdate();}
_registrationDeleted(event){const registration=(event.data);this._removeRegistrationFromList(registration);}
_removeRegistrationFromList(registration){const section=this._sections.get(registration);if(section)
section._section.detach();this._sections.delete(registration);this._updateSectionVisibility();}
_isRegistrationVisible(registration){const filterString=this._filter.value();if(!filterString||!registration.scopeURL)
return true;const regex=String.filterRegex(filterString);return registration.scopeURL.match(regex);}
_filterChanged(){this._updateCollapsedStyle();this._filterThrottler.schedule(()=>Promise.resolve(this._updateSectionVisibility()));}
_updateCollapsedStyle(){const expanded=this._otherSWFilter.getAttribute('aria-checked')==='true';this._otherWorkers.classList.toggle('service-worker-filter-collapsed',!expanded);if(expanded)
this._otherWorkersView.showWidget();else
this._otherWorkersView.hideWidget();this._otherWorkersView.setHeaderVisible(false);}
_updateListVisibility(){this.contentElement.classList.toggle('service-worker-list-empty',this._sections.size===0);}
_toggleFilter(){const expanded=this._otherSWFilter.getAttribute('aria-checked')==='true';this._otherSWFilter.setAttribute('aria-checked',!expanded);this._filterChanged();}};Resources.ServiceWorkersView.Section=class{constructor(manager,section,registration){this._manager=manager;this._section=section;this._registration=registration;this._fingerprint=null;this._pushNotificationDataSetting=Common.settings.createLocalSetting('pushData',Common.UIString('Test push message from DevTools.'));this._syncTagNameSetting=Common.settings.createLocalSetting('syncTagName','test-tag-from-devtools');this._periodicSyncTagNameSetting=Common.settings.createLocalSetting('periodicSyncTagName','test-tag-from-devtools');this._toolbar=section.createToolbar();this._toolbar.renderAsLinks();this._updateButton=new UI.ToolbarButton(Common.UIString('Update'),undefined,Common.UIString('Update'));this._updateButton.addEventListener(UI.ToolbarButton.Events.Click,this._updateButtonClicked,this);this._toolbar.appendToolbarItem(this._updateButton);this._deleteButton=new UI.ToolbarButton(Common.UIString('Unregister service worker'),undefined,Common.UIString('Unregister'));this._deleteButton.addEventListener(UI.ToolbarButton.Events.Click,this._unregisterButtonClicked,this);this._toolbar.appendToolbarItem(this._deleteButton);this._sourceField=this._wrapWidget(this._section.appendField(Common.UIString('Source')));this._statusField=this._wrapWidget(this._section.appendField(Common.UIString('Status')));this._clientsField=this._wrapWidget(this._section.appendField(Common.UIString('Clients')));this._createSyncNotificationField(Common.UIString('Push'),this._pushNotificationDataSetting.get(),Common.UIString('Push data'),this._push.bind(this));this._createSyncNotificationField(Common.UIString('Sync'),this._syncTagNameSetting.get(),Common.UIString('Sync tag'),this._sync.bind(this));if(Runtime.experiments.isEnabled('backgroundServicesPeriodicBackgroundSync')){this._createSyncNotificationField(ls`Periodic Sync`,this._periodicSyncTagNameSetting.get(),ls`Periodic Sync tag`,tag=>this._periodicSync(tag));}
this._linkifier=new Components.Linkifier();this._clientInfoCache=new Map();this._throttler=new Common.Throttler(500);}
_createSyncNotificationField(label,initialValue,placeholder,callback){const form=this._wrapWidget(this._section.appendField(label)).createChild('form','service-worker-editor-with-button');const editor=form.createChild('input','source-code service-worker-notification-editor');const button=UI.createTextButton(label);button.type='submit';form.appendChild(button);editor.value=initialValue;editor.placeholder=placeholder;UI.ARIAUtils.setAccessibleName(editor,label);form.addEventListener('submit',e=>{callback(editor.value||'');e.consume(true);});}
_scheduleUpdate(){if(Resources.ServiceWorkersView._noThrottle){this._update();return;}
this._throttler.schedule(this._update.bind(this));}
_targetForVersionId(versionId){const version=this._manager.findVersion(versionId);if(!version||!version.targetId)
return null;return SDK.targetManager.targetById(version.targetId);}
_addVersion(versionsStack,icon,label){const installingEntry=versionsStack.createChild('div','service-worker-version');installingEntry.createChild('div',icon);installingEntry.createChild('span').textContent=label;return installingEntry;}
_updateClientsField(version){this._clientsField.removeChildren();this._section.setFieldVisible(Common.UIString('Clients'),version.controlledClients.length);for(const client of version.controlledClients){const clientLabelText=this._clientsField.createChild('div','service-worker-client');if(this._clientInfoCache.has(client)){this._updateClientInfo(clientLabelText,(this._clientInfoCache.get(client)));}
this._manager.target().targetAgent().getTargetInfo(client).then(this._onClientInfo.bind(this,clientLabelText));}}
_updateSourceField(version){this._sourceField.removeChildren();const fileName=Common.ParsedURL.extractName(version.scriptURL);const name=this._sourceField.createChild('div','report-field-value-filename');const link=Components.Linkifier.linkifyURL(version.scriptURL,{text:fileName});link.tabIndex=0;name.appendChild(link);if(this._registration.errors.length){const errorsLabel=UI.createIconLabel(String(this._registration.errors.length),'smallicon-error');errorsLabel.classList.add('link');errorsLabel.tabIndex=0;UI.ARIAUtils.setAccessibleName(errorsLabel,ls`${this._registration.errors.length} registration errors`);onInvokeElement(errorsLabel,()=>Common.console.show());name.appendChild(errorsLabel);}
this._sourceField.createChild('div','report-field-value-subtitle').textContent=Common.UIString('Received %s',new Date(version.scriptResponseTime*1000).toLocaleString());}
_update(){const fingerprint=this._registration.fingerprint();if(fingerprint===this._fingerprint)
return Promise.resolve();this._fingerprint=fingerprint;this._toolbar.setEnabled(!this._registration.isDeleted);const versions=this._registration.versionsByMode();const scopeURL=this._registration.scopeURL;const title=this._registration.isDeleted?Common.UIString('%s - deleted',scopeURL):scopeURL;this._section.setTitle(title);const active=versions.get(SDK.ServiceWorkerVersion.Modes.Active);const waiting=versions.get(SDK.ServiceWorkerVersion.Modes.Waiting);const installing=versions.get(SDK.ServiceWorkerVersion.Modes.Installing);const redundant=versions.get(SDK.ServiceWorkerVersion.Modes.Redundant);this._statusField.removeChildren();const versionsStack=this._statusField.createChild('div','service-worker-version-stack');versionsStack.createChild('div','service-worker-version-stack-bar');if(active){this._updateSourceField(active);const activeEntry=this._addVersion(versionsStack,'service-worker-active-circle',Common.UIString('#%s activated and is %s',active.id,active.runningStatus));if(active.isRunning()||active.isStarting()){this._createLink(activeEntry,Common.UIString('stop'),this._stopButtonClicked.bind(this,active.id));if(!this._targetForVersionId(active.id))
this._createLink(activeEntry,Common.UIString('inspect'),this._inspectButtonClicked.bind(this,active.id));}else if(active.isStartable()){this._createLink(activeEntry,Common.UIString('start'),this._startButtonClicked.bind(this));}
this._updateClientsField(active);}else if(redundant){this._updateSourceField(redundant);this._addVersion(versionsStack,'service-worker-redundant-circle',Common.UIString('#%s is redundant',redundant.id));this._updateClientsField(redundant);}
if(waiting){const waitingEntry=this._addVersion(versionsStack,'service-worker-waiting-circle',Common.UIString('#%s waiting to activate',waiting.id));this._createLink(waitingEntry,Common.UIString('skipWaiting'),this._skipButtonClicked.bind(this));waitingEntry.createChild('div','service-worker-subtitle').textContent=Common.UIString('Received %s',new Date(waiting.scriptResponseTime*1000).toLocaleString());if(!this._targetForVersionId(waiting.id)&&(waiting.isRunning()||waiting.isStarting()))
this._createLink(waitingEntry,Common.UIString('inspect'),this._inspectButtonClicked.bind(this,waiting.id));}
if(installing){const installingEntry=this._addVersion(versionsStack,'service-worker-installing-circle',Common.UIString('#%s trying to install',installing.id));installingEntry.createChild('div','service-worker-subtitle').textContent=Common.UIString('Received %s',new Date(installing.scriptResponseTime*1000).toLocaleString());if(!this._targetForVersionId(installing.id)&&(installing.isRunning()||installing.isStarting())){this._createLink(installingEntry,Common.UIString('inspect'),this._inspectButtonClicked.bind(this,installing.id));}}
return Promise.resolve();}
_createLink(parent,title,listener,className,useCapture){const button=parent.createChild('button',className);button.classList.add('link');button.textContent=title;button.tabIndex=0;button.addEventListener('click',listener,useCapture);return button;}
_unregisterButtonClicked(event){this._manager.deleteRegistration(this._registration.id);}
_updateButtonClicked(event){this._manager.updateRegistration(this._registration.id);}
_push(data){this._pushNotificationDataSetting.set(data);this._manager.deliverPushMessage(this._registration.id,data);}
_sync(tag){this._syncTagNameSetting.set(tag);this._manager.dispatchSyncEvent(this._registration.id,tag,true);}
_periodicSync(tag){this._periodicSyncTagNameSetting.set(tag);this._manager.dispatchPeriodicSyncEvent(this._registration.id,tag);}
_onClientInfo(element,targetInfo){if(!targetInfo)
return;this._clientInfoCache.set(targetInfo.targetId,targetInfo);this._updateClientInfo(element,targetInfo);}
_updateClientInfo(element,targetInfo){if(targetInfo.type!=='page'&&targetInfo.type==='iframe'){const clientString=element.createChild('span','service-worker-client-string');clientString.createTextChild(ls`Worker: ${targetInfo.url}`);return;}
element.removeChildren();const clientString=element.createChild('span','service-worker-client-string');clientString.createTextChild(targetInfo.url);this._createLink(element,ls`focus`,this._activateTarget.bind(this,targetInfo.targetId),'service-worker-client-focus-link');}
_activateTarget(targetId){this._manager.target().targetAgent().activateTarget(targetId);}
_startButtonClicked(){this._manager.startWorker(this._registration.scopeURL);}
_skipButtonClicked(){this._manager.skipWaiting(this._registration.scopeURL);}
_stopButtonClicked(versionId){this._manager.stopWorker(versionId);}
_inspectButtonClicked(versionId){this._manager.inspectWorker(versionId);}
_wrapWidget(container){const shadowRoot=UI.createShadowRootWithCoreStyles(container);UI.appendStyle(shadowRoot,'resources/serviceWorkersView.css');const contentElement=createElement('div');shadowRoot.appendChild(contentElement);return contentElement;}};;Runtime.cachedResources["resources/appManifestView.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n/*# sourceURL=resources/appManifestView.css */";Runtime.cachedResources["resources/backgroundServiceView.css"]=".background-service-toolbar {\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.data-grid {\n    flex: auto;\n    border: none;\n}\n\n.background-service-preview {\n    position: absolute;\n    background-color: white;\n    justify-content: center;\n    align-items: center;\n    overflow: auto;\n    font-size: 13px;\n    color: #777;\n}\n\n.background-service-preview > div {\n    max-width: 450px;\n    margin: 10px;\n    text-align: center;\n}\n\n.background-service-preview > div > p {\n    flex: none;\n    white-space: pre-line;\n}\n\n.background-service-shortcut {\n    color: hsla(0, 0%, 50%, 1);\n}\n\n.background-service-metadata {\n    padding-left: 5px;\n    padding-top: 10px;\n}\n\n.background-service-metadata-entry {\n    padding-left: 10px;\n    padding-bottom: 5px;\n}\n\n.background-service-metadata-name {\n    color: rgb(33%, 33%, 33%);\n    display: inline-block;\n    margin-right: 0.25em;\n    font-weight: bold;\n}\n\n.background-service-metadata-value {\n    display: inline;\n    margin-right: 1em;\n    white-space: pre-wrap;\n    word-break: break-all;\n    user-select: text;\n}\n\n.background-service-empty-value {\n    color: #888;\n    font-style: italic;\n}\n\n.background-service-record-inline-button {\n    margin-bottom: 6px;\n}\n\n/*# sourceURL=resources/backgroundServiceView.css */";Runtime.cachedResources["resources/clearStorageView.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.report-row {\n    display: flex;\n    align-items: center;\n}\n\n.clear-storage-button .report-row {\n    margin: 0 0 0 17px;\n    display: flex;\n}\n\n.link {\n    margin-left: 10px;\n    display: none;\n}\n\n.report-row:hover .link {\n    display: inline;\n}\n\n.usage-breakdown-row {\n    min-width: fit-content;\n}\n\n/*# sourceURL=resources/clearStorageView.css */";Runtime.cachedResources["resources/indexedDBViews.css"]="/*\n * Copyright (C) 2012 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.indexed-db-data-view .data-view-toolbar {\n    position: relative;\n    background-color: #eee;\n    border-bottom: 1px solid #ccc;\n}\n\n.indexed-db-data-view .data-grid {\n    flex: auto;\n}\n\n.indexed-db-data-view .data-grid .data-container tr:nth-last-child(1) {\n    background-color: white;\n}\n\n.indexed-db-data-view .data-grid .data-container tr:nth-last-child(1) td {\n    border: 0;\n}\n\n.indexed-db-data-view .data-grid .data-container tr:nth-last-child(2) td {\n    border-bottom: 1px solid #aaa;\n}\n\n.indexed-db-data-view .data-grid:focus .data-container tr.selected {\n    background-color: #cdddf5;\n    color: inherit;\n}\n\n.indexed-db-data-view .section,\n.indexed-db-data-view .section > .header,\n.indexed-db-data-view .section > .header .title {\n    margin: 0;\n    min-height: inherit;\n    line-height: inherit;\n}\n\n.indexed-db-data-view .data-grid .data-container td .section .header .title {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.indexed-db-key-path {\n    color: rgb(196, 26, 22);\n    white-space: pre-wrap;\n    unicode-bidi: -webkit-isolate;\n}\n\n.source-code.indexed-db-key-path {\n    font-size: unset !important;\n}\n\n.resources-toolbar {\n    padding-right: 10px;\n}\n\n.object-store-summary-bar {\n    flex: 0 0 27px;\n    line-height: 27px;\n    padding-left: 5px;\n    background-color: #eee;\n    border-top: 1px solid #ccc;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n/*# sourceURL=resources/indexedDBViews.css */";Runtime.cachedResources["resources/resourcesPanel.css"]="/*\n * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.resources-toolbar {\n    border-top: 1px solid #ccc;\n    background-color: var(--toolbar-bg-color);\n}\n\n.top-resources-toolbar {\n    border-bottom: 1px solid #ccc;\n    background-color: var(--toolbar-bg-color);\n}\n\n.resources.panel .status {\n    float: right;\n    height: 16px;\n    margin-top: 1px;\n    margin-left: 4px;\n    line-height: 1em;\n}\n\n.storage-view {\n    display: flex;\n    overflow: hidden;\n}\n\n.storage-view {\n    overflow: hidden;\n}\n\n.storage-view .data-grid:not(.inline) {\n    border: none;\n    flex: auto;\n}\n\n.storage-view .storage-table-error {\n    color: rgb(66%, 33%, 33%);\n    font-size: 24px;\n    font-weight: bold;\n    padding: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.storage-view.query {\n    padding: 2px 0;\n    overflow-y: overlay;\n    overflow-x: hidden;\n}\n\n.storage-view .filter-bar {\n    border-top: none;\n    border-bottom: var(--divider-border);\n}\n\n.database-query-prompt-container {\n    position: relative;\n    padding: 1px 22px 1px 24px;\n}\n\n.database-query-prompt {\n    min-height: 16px;\n    white-space: pre-wrap;\n}\n\n.prompt-icon {\n    position: absolute;\n    display: block;\n    left: 7px;\n    top: 9px;\n    margin-top: -7px;\n    -webkit-user-select: none;\n}\n\n.database-query-prompt-container .prompt-icon {\n    top: 10px;\n}\n\n.database-user-query {\n    position: relative;\n    border-bottom: 1px solid rgb(245, 245, 245);\n    padding: 1px 22px 1px 24px;\n    min-height: 16px;\n    flex-shrink: 0;\n}\n\n.database-query-text {\n    color: rgb(0, 128, 255);\n    -webkit-user-select: text;\n}\n\n.database-query-result {\n    position: relative;\n    padding: 1px 22px 1px 22px;\n    min-height: 16px;\n    margin-left: -22px;\n    padding-right: 0;\n}\n\n.database-query-result[data-keyboard-focus=\"true\"]:focus {\n    outline: 1px solid var(--accent-color-hover);\n}\n\n.database-query-result.error {\n    color: red;\n    -webkit-user-select: text;\n}\n\n.resources-sidebar {\n    padding: 0;\n}\n\n/*# sourceURL=resources/resourcesPanel.css */";Runtime.cachedResources["resources/resourcesSidebar.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.tree-outline {\n    padding-left: 0;\n    color: rgb(90, 90, 90);\n}\n\n.tree-outline > ol {\n    padding-bottom: 10px;\n}\n\n.tree-outline li {\n    min-height: 20px;\n}\n\nli.storage-group-list-item {\n    padding: 10px 8px 6px 8px;\n}\n\nli.storage-group-list-item:not(:first-child) {\n    border-top: 1px solid rgb(230, 230, 230);\n}\n\nli.storage-group-list-item::before {\n    display: none;\n}\n\n.navigator-tree-item {\n    margin: -3px -7px -3px -7px;\n}\n\n.navigator-file-tree-item {\n    background: linear-gradient(45deg, hsl(0, 0%, 50%), hsl(0, 0%, 70%));\n}\n\n.navigator-folder-tree-item {\n    background: linear-gradient(45deg, hsl(210, 82%, 65%), hsl(210, 82%, 80%));\n}\n\n.navigator-frame-tree-item {\n    background-color: #5a5a5a;\n}\n\n.navigator-script-tree-item {\n    background: linear-gradient(45deg, hsl(48, 70%, 50%), hsl(48, 70%, 70%));\n}\n\n.navigator-stylesheet-tree-item {\n    background: linear-gradient(45deg, hsl(256, 50%, 50%), hsl(256, 50%, 70%));\n}\n\n.navigator-image-tree-item,\n.navigator-font-tree-item {\n    background: linear-gradient(45deg, hsl(109, 33%, 50%), hsl(109, 33%, 70%));\n}\n\n.resource-tree-item {\n    background: rgba(90, 90, 90, .7);\n}\n\n/*# sourceURL=resources/resourcesSidebar.css */";Runtime.cachedResources["resources/serviceWorkerCacheViews.css"]="/*\n * Copyright 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.service-worker-cache-data-view .data-view-toolbar {\n    position: relative;\n    background-color: #eee;\n    border-bottom: 1px solid #ccc;\n    padding-right: 10px;\n}\n\n.service-worker-cache-data-view .data-grid {\n    flex: auto;\n}\n\n.service-worker-cache-data-view .data-grid .data-container tr:nth-last-child(1) td {\n    border: 0;\n}\n\n.service-worker-cache-data-view .data-grid .data-container tr:nth-last-child(2) td {\n    border-bottom: 1px solid #aaa;\n}\n\n.service-worker-cache-data-view .data-grid .data-container tr.selected {\n    background-color: rgb(212, 212, 212);\n    color: inherit;\n}\n\n.service-worker-cache-data-view .data-grid:focus .data-container tr.selected {\n    background-color: var(--selection-bg-color);\n    color: white;\n}\n\n.service-worker-cache-data-view .section,\n.service-worker-cache-data-view .section > .header,\n.service-worker-cache-data-view .section > .header .title {\n    margin: 0;\n    min-height: inherit;\n    line-height: inherit;\n}\n\n.service-worker-cache-data-view .data-grid .data-container td .section .header .title {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.cache-preview-panel-resizer {\n    background-color: #eee;\n    height: 4px;\n    border-bottom: 1px solid rgb(64%, 64%, 64%);\n}\n\n.cache-storage-summary-bar {\n    flex: 0 0 27px;\n    line-height: 27px;\n    padding-left: 5px;\n    background-color: #eee;\n    border-top: 1px solid #ccc;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n/*# sourceURL=resources/serviceWorkerCacheViews.css */";Runtime.cachedResources["resources/serviceWorkersView.css"]="/*\n * Copyright 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.service-worker-version-stack {\n    position: relative;\n}\n\n.service-worker-version-stack-bar {\n    position: absolute;\n    top: 10px;\n    bottom: 20px;\n    left: 4px;\n    content: \"\";\n    border-left: 1px solid #888;\n    z-index: 0;\n}\n\n.service-worker-version:not(:last-child) {\n    margin-bottom: 7px;\n}\n\n.service-worker-active-circle,\n.service-worker-redundant-circle,\n.service-worker-waiting-circle,\n.service-worker-installing-circle {\n    position: relative;\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    z-index: 10;\n    margin-right: 5px;\n    border-radius: 50%;\n    border: 1px solid #555;\n}\n\n.service-worker-active-circle {\n    background-color: #50B04F;\n}\n.service-worker-waiting-circle {\n    background-color: #F38E24;\n\n}\n.service-worker-installing-circle {\n    background-color: white;\n}\n\n.service-worker-redundant-circle {\n    background-color: gray;\n}\n\n.service-worker-subtitle {\n    padding-left: 14px;\n    line-height: 14px;\n    color: #888;\n}\n\n.link {\n    margin-left: 7px;\n}\n\n.service-worker-editor-with-button {\n    align-items: baseline;\n    display: flex;\n}\n\n.service-worker-notification-editor {\n    border: solid 1px #d8d8d8;\n    display: flex;\n    flex: auto;\n    margin-right: 4px;\n    max-width: 400px;\n    min-width: 80px;\n}\n\n.report-field-value-filename,\n.service-worker-client-string {\n    max-width: 400px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.service-worker-client {\n    display: flex;\n}\n\n.service-worker-client-focus-link {\n    flex: none;\n    margin-right: 2px;\n    align-self: center;\n}\n\n.service-worker-notification-editor.source-code {\n    /** Simulate CodeMirror that is shown above */\n    padding: 4px;\n}\n\n.service-worker-list {\n    background-color: #f9f9f9;\n    overflow: auto;\n}\n\n.service-workers-this-origin {\n    flex-shrink: 0;\n    flex-grow: 0;\n}\n\n.service-worker-has-current .service-workers-other-origin {\n    margin-top: 16px;\n    border-top: 1px solid rgb(230, 230, 230)\n}\n\n.service-worker-list-empty .service-workers-other-origin {\n    display: none;\n}\n\n.service-workers-this-origin,\n.service-worker-filter,\n.service-workers-other-origin {\n    min-width: 400px;\n}\n\n.service-worker-filter {\n    padding: 16px 20px 12px 12px;\n    flex-grow: 0;\n    flex-shrink: 0;\n    background-color: white;\n    border-bottom: solid 1px rgb(230, 230, 230);\n}\n\n.service-worker-filter-label {\n    cursor: pointer;\n    margin-left: 4px;\n}\n\n.service-worker-filter[data-keyboard-focus=\"true\"]:focus {\n    background-color: var(--toolbar-bg-color);\n}\n\n.service-worker-filter-label::before {\n    -webkit-user-select: none;\n    -webkit-mask-image: url(Images/treeoutlineTriangles.svg);\n    -webkit-mask-size: 32px 24px;\n    content: '';\n    color: transparent;\n    background-color: rgb(110, 110, 110);\n    text-shadow: none;\n    height: 12px;\n    width: 10px;\n    display: inline-block;\n}\n\n.service-worker-filter[aria-checked=\"true\"] .service-worker-filter-label::before {\n    -webkit-mask-position: -16px 0;\n}\n\n.service-worker-filter-toolbar {\n    margin: 8px 10px 0 12px;\n    max-width: 530px;\n}\n\n.service-worker-filter-collapsed .service-worker-filter-toolbar {\n    display: none;\n}\n\n/*# sourceURL=resources/serviceWorkersView.css */";Search.SearchView=class extends UI.VBox{constructor(settingKey){super(true);this.setMinimumSize(0,40);this.registerRequiredCSS('search/searchView.css');this._focusOnShow=false;this._isIndexing=false;this._searchId=1;this._searchMatchesCount=0;this._searchResultsCount=0;this._nonEmptySearchResultsCount=0;this._searchingView=null;this._notFoundView=null;this._searchConfig=null;this._pendingSearchConfig=null;this._searchResultsPane=null;this._progressIndicator=null;this._visiblePane=null;this.contentElement.classList.add('search-view');this._searchPanelElement=this.contentElement.createChild('div','search-drawer-header');this._searchPanelElement.addEventListener('keydown',this._onKeyDown.bind(this),false);this._searchResultsElement=this.contentElement.createChild('div');this._searchResultsElement.className='search-results';const searchContainer=createElement('div');searchContainer.style.flex='auto';searchContainer.style.justifyContent='start';searchContainer.style.maxWidth='300px';this._search=UI.HistoryInput.create();searchContainer.appendChild(this._search);this._search.placeholder=Common.UIString('Search');this._search.setAttribute('type','text');this._search.setAttribute('results','0');this._search.setAttribute('size',42);const searchItem=new UI.ToolbarItem(searchContainer);const toolbar=new UI.Toolbar('search-toolbar',this._searchPanelElement);this._matchCaseButton=Search.SearchView._appendToolbarToggle(toolbar,'Aa',Common.UIString('Match Case'));this._regexButton=Search.SearchView._appendToolbarToggle(toolbar,'.*',Common.UIString('Use Regular Expression'));toolbar.appendToolbarItem(searchItem);const refreshButton=new UI.ToolbarButton(Common.UIString('Refresh'),'largeicon-refresh');const clearButton=new UI.ToolbarButton(Common.UIString('Clear'),'largeicon-clear');toolbar.appendToolbarItem(refreshButton);toolbar.appendToolbarItem(clearButton);refreshButton.addEventListener(UI.ToolbarButton.Events.Click,this._onAction.bind(this));clearButton.addEventListener(UI.ToolbarButton.Events.Click,()=>{this._resetSearch();this._onSearchInputClear();});const searchStatusBarElement=this.contentElement.createChild('div','search-toolbar-summary');this._searchMessageElement=searchStatusBarElement.createChild('div','search-message');this._searchProgressPlaceholderElement=searchStatusBarElement.createChild('div','flex-centered');this._searchResultsMessageElement=searchStatusBarElement.createChild('div','search-message');this._advancedSearchConfig=Common.settings.createLocalSetting(settingKey+'SearchConfig',new Search.SearchConfig('',true,false).toPlainObject());this._load();this._searchScope=null;}
static _appendToolbarToggle(toolbar,text,tooltip){const toggle=new UI.ToolbarToggle(tooltip);toggle.setText(text);toggle.addEventListener(UI.ToolbarButton.Events.Click,()=>toggle.setToggled(!toggle.toggled()));toolbar.appendToolbarItem(toggle);return toggle;}
_buildSearchConfig(){return new Search.SearchConfig(this._search.value,!this._matchCaseButton.toggled(),this._regexButton.toggled());}
async toggle(queryCandidate,searchImmediately){if(queryCandidate)
this._search.value=queryCandidate;if(this.isShowing())
this.focus();else
this._focusOnShow=true;this._initScope();if(searchImmediately)
this._onAction();else
this._startIndexing();}
createScope(){throw new Error('Not implemented');}
_initScope(){this._searchScope=this.createScope();}
wasShown(){if(this._focusOnShow){this.focus();this._focusOnShow=false;}}
_onIndexingFinished(){const finished=!this._progressIndicator.isCanceled();this._progressIndicator.done();this._progressIndicator=null;this._isIndexing=false;this._indexingFinished(finished);if(!finished)
this._pendingSearchConfig=null;if(!this._pendingSearchConfig)
return;const searchConfig=this._pendingSearchConfig;this._pendingSearchConfig=null;this._innerStartSearch(searchConfig);}
_startIndexing(){this._isIndexing=true;if(this._progressIndicator)
this._progressIndicator.done();this._progressIndicator=new UI.ProgressIndicator();this._searchMessageElement.textContent=Common.UIString('Indexing\u2026');this._progressIndicator.show(this._searchProgressPlaceholderElement);this._searchScope.performIndexing(new Common.ProgressProxy(this._progressIndicator,this._onIndexingFinished.bind(this)));}
_onSearchInputClear(){this._search.value='';this.focus();}
_onSearchResult(searchId,searchResult){if(searchId!==this._searchId||!this._progressIndicator)
return;if(this._progressIndicator&&this._progressIndicator.isCanceled()){this._onIndexingFinished();return;}
this._addSearchResult(searchResult);if(!searchResult.matchesCount())
return;if(!this._searchResultsPane){this._searchResultsPane=new Search.SearchResultsPane((this._searchConfig));this._showPane(this._searchResultsPane);}
this._searchResultsPane.addSearchResult(searchResult);}
_onSearchFinished(searchId,finished){if(searchId!==this._searchId||!this._progressIndicator)
return;if(!this._searchResultsPane)
this._nothingFound();this._searchFinished(finished);this._searchConfig=null;}
async _startSearch(searchConfig){this._resetSearch();++this._searchId;this._initScope();if(!this._isIndexing)
this._startIndexing();this._pendingSearchConfig=searchConfig;}
_innerStartSearch(searchConfig){this._searchConfig=searchConfig;if(this._progressIndicator)
this._progressIndicator.done();this._progressIndicator=new UI.ProgressIndicator();this._searchStarted(this._progressIndicator);this._searchScope.performSearch(searchConfig,this._progressIndicator,this._onSearchResult.bind(this,this._searchId),this._onSearchFinished.bind(this,this._searchId));}
_resetSearch(){this._stopSearch();this._showPane(null);this._searchResultsPane=null;}
_stopSearch(){if(this._progressIndicator&&!this._isIndexing)
this._progressIndicator.cancel();if(this._searchScope)
this._searchScope.stopSearch();this._searchConfig=null;}
_searchStarted(progressIndicator){this._resetCounters();if(!this._searchingView)
this._searchingView=new UI.EmptyWidget(Common.UIString('Searching\u2026'));this._showPane(this._searchingView);this._searchMessageElement.textContent=Common.UIString('Searching\u2026');progressIndicator.show(this._searchProgressPlaceholderElement);this._updateSearchResultsMessage();}
_indexingFinished(finished){this._searchMessageElement.textContent=finished?'':Common.UIString('Indexing interrupted.');}
_updateSearchResultsMessage(){if(this._searchMatchesCount&&this._searchResultsCount){if(this._searchMatchesCount===1&&this._nonEmptySearchResultsCount===1){this._searchResultsMessageElement.textContent=Common.UIString('Found 1 matching line in 1 file.');}else if(this._searchMatchesCount>1&&this._nonEmptySearchResultsCount===1){this._searchResultsMessageElement.textContent=Common.UIString('Found %d matching lines in 1 file.',this._searchMatchesCount);}else{this._searchResultsMessageElement.textContent=Common.UIString('Found %d matching lines in %d files.',this._searchMatchesCount,this._nonEmptySearchResultsCount);}}else{this._searchResultsMessageElement.textContent='';}}
_showPane(panel){if(this._visiblePane)
this._visiblePane.detach();if(panel)
panel.show(this._searchResultsElement);this._visiblePane=panel;}
_resetCounters(){this._searchMatchesCount=0;this._searchResultsCount=0;this._nonEmptySearchResultsCount=0;}
_nothingFound(){if(!this._notFoundView)
this._notFoundView=new UI.EmptyWidget(Common.UIString('No matches found.'));this._showPane(this._notFoundView);this._searchResultsMessageElement.textContent=Common.UIString('No matches found.');}
_addSearchResult(searchResult){const matchesCount=searchResult.matchesCount();this._searchMatchesCount+=matchesCount;this._searchResultsCount++;if(matchesCount)
this._nonEmptySearchResultsCount++;this._updateSearchResultsMessage();}
_searchFinished(finished){this._searchMessageElement.textContent=finished?Common.UIString('Search finished.'):Common.UIString('Search interrupted.');}
focus(){this._search.focus();this._search.select();}
willHide(){this._stopSearch();}
_onKeyDown(event){switch(event.keyCode){case UI.KeyboardShortcut.Keys.Enter.code:this._onAction();break;}}
_save(){this._advancedSearchConfig.set(this._buildSearchConfig().toPlainObject());}
_load(){const searchConfig=Search.SearchConfig.fromPlainObject(this._advancedSearchConfig.get());this._search.value=searchConfig.query();this._matchCaseButton.setToggled(!searchConfig.ignoreCase());this._regexButton.setToggled(searchConfig.isRegex());}
_onAction(){const searchConfig=this._buildSearchConfig();if(!searchConfig.query()||!searchConfig.query().length)
return;this._save();this._startSearch(searchConfig);}};;Search.SearchConfig=class{constructor(query,ignoreCase,isRegex){this._query=query;this._ignoreCase=ignoreCase;this._isRegex=isRegex;this._parse();}
static fromPlainObject(object){return new Search.SearchConfig(object.query,object.ignoreCase,object.isRegex);}
query(){return this._query;}
ignoreCase(){return this._ignoreCase;}
isRegex(){return this._isRegex;}
toPlainObject(){return{query:this.query(),ignoreCase:this.ignoreCase(),isRegex:this.isRegex()};}
_parse(){const quotedPattern=/"([^\\"]|\\.)+"/;const unquotedWordPattern=/(\s*(?!-?f(ile)?:)[^\\ ]|\\.)+/;const unquotedPattern=unquotedWordPattern.source+'(\\s+'+unquotedWordPattern.source+')*';const pattern=['(\\s*'+Search.SearchConfig.FilePatternRegex.source+'\\s*)','('+quotedPattern.source+')','('+unquotedPattern+')',].join('|');const regexp=new RegExp(pattern,'g');const queryParts=this._query.match(regexp)||[];this._fileQueries=[];this._queries=[];for(let i=0;i<queryParts.length;++i){const queryPart=queryParts[i];if(!queryPart)
continue;const fileQuery=this._parseFileQuery(queryPart);if(fileQuery){this._fileQueries.push(fileQuery);this._fileRegexQueries=this._fileRegexQueries||[];this._fileRegexQueries.push({regex:new RegExp(fileQuery.text,this.ignoreCase?'i':''),isNegative:fileQuery.isNegative});continue;}
if(this._isRegex){this._queries.push(queryPart);continue;}
if(queryPart.startsWith('"')){if(!queryPart.endsWith('"'))
continue;this._queries.push(this._parseQuotedQuery(queryPart));continue;}
this._queries.push(this._parseUnquotedQuery(queryPart));}}
filePathMatchesFileQuery(filePath){if(!this._fileRegexQueries)
return true;for(let i=0;i<this._fileRegexQueries.length;++i){if(!!filePath.match(this._fileRegexQueries[i].regex)===this._fileRegexQueries[i].isNegative)
return false;}
return true;}
queries(){return this._queries;}
_parseUnquotedQuery(query){return query.replace(/\\(.)/g,'$1');}
_parseQuotedQuery(query){return query.substring(1,query.length-1).replace(/\\(.)/g,'$1');}
_parseFileQuery(query){const match=query.match(Search.SearchConfig.FilePatternRegex);if(!match)
return null;const isNegative=!!match[1];query=match[3];let result='';for(let i=0;i<query.length;++i){const char=query[i];if(char==='*'){result+='.*';}else if(char==='\\'){++i;const nextChar=query[i];if(nextChar===' ')
result+=' ';}else{if(String.regexSpecialCharacters().indexOf(query.charAt(i))!==-1)
result+='\\';result+=query.charAt(i);}}
return new Search.SearchConfig.QueryTerm(result,isNegative);}};Search.SearchConfig.FilePatternRegex=/(-)?f(ile)?:((?:[^\\ ]|\\.)+)/;Search.SearchConfig.RegexQuery;Search.SearchConfig.QueryTerm=class{constructor(text,isNegative){this.text=text;this.isNegative=isNegative;}};Search.SearchResult=function(){};Search.SearchResult.prototype={label(){},description(){},matchesCount(){},matchLabel(index){},matchLineContent(index){},matchRevealable(index){}};Search.SearchScope=function(){};Search.SearchScope.prototype={performSearch(searchConfig,progress,searchResultCallback,searchFinishedCallback){},performIndexing(progress){},stopSearch(){}};;Search.SearchResultsPane=class extends UI.VBox{constructor(searchConfig){super(true);this._searchConfig=searchConfig;this._searchResults=[];this._treeOutline=new UI.TreeOutlineInShadow();this._treeOutline.hideOverflow();this._treeOutline.registerRequiredCSS('search/searchResultsPane.css');this.contentElement.appendChild(this._treeOutline.element);this._matchesExpandedCount=0;}
addSearchResult(searchResult){this._searchResults.push(searchResult);this._addTreeElement(searchResult);}
_addTreeElement(searchResult){const treeElement=new Search.SearchResultsPane.SearchResultsTreeElement(this._searchConfig,searchResult);this._treeOutline.appendChild(treeElement);if(this._matchesExpandedCount<Search.SearchResultsPane._matchesExpandedByDefault)
treeElement.expand();this._matchesExpandedCount+=searchResult.matchesCount();}};Search.SearchResultsPane._matchesExpandedByDefault=20;Search.SearchResultsPane._matchesShownAtOnce=20;Search.SearchResultsPane.SearchResultsTreeElement=class extends UI.TreeElement{constructor(searchConfig,searchResult){super('',true);this._searchConfig=searchConfig;this._searchResult=searchResult;this._initialized=false;this.toggleOnClick=true;this.selectable=false;}
onexpand(){if(this._initialized)
return;this._updateMatchesUI();this._initialized=true;}
_updateMatchesUI(){this.removeChildren();const toIndex=Math.min(this._searchResult.matchesCount(),Search.SearchResultsPane._matchesShownAtOnce);if(toIndex<this._searchResult.matchesCount()){this._appendSearchMatches(0,toIndex-1);this._appendShowMoreMatchesElement(toIndex-1);}else{this._appendSearchMatches(0,toIndex);}}
onattach(){this._updateSearchMatches();}
_updateSearchMatches(){this.listItemElement.classList.add('search-result');const fileNameSpan=span(this._searchResult.label(),'search-result-file-name');fileNameSpan.appendChild(span('\u2014','search-result-dash'));fileNameSpan.appendChild(span(this._searchResult.description(),'search-result-qualifier'));this.tooltip=this._searchResult.description();this.listItemElement.appendChild(fileNameSpan);const matchesCountSpan=createElement('span');matchesCountSpan.className='search-result-matches-count';matchesCountSpan.textContent=`${this._searchResult.matchesCount()}`;this.listItemElement.appendChild(matchesCountSpan);if(this.expanded)
this._updateMatchesUI();function span(text,className){const span=createElement('span');span.className=className;span.textContent=text;return span;}}
_appendSearchMatches(fromIndex,toIndex){const searchResult=this._searchResult;const queries=this._searchConfig.queries();const regexes=[];for(let i=0;i<queries.length;++i)
regexes.push(createSearchRegex(queries[i],!this._searchConfig.ignoreCase(),this._searchConfig.isRegex()));for(let i=fromIndex;i<toIndex;++i){const lineContent=searchResult.matchLineContent(i).trim();let matchRanges=[];for(let j=0;j<regexes.length;++j)
matchRanges=matchRanges.concat(this._regexMatchRanges(lineContent,regexes[j]));const anchor=Components.Linkifier.linkifyRevealable(searchResult.matchRevealable(i),'');anchor.classList.add('search-match-link');const lineNumberSpan=createElement('span');lineNumberSpan.classList.add('search-match-line-number');lineNumberSpan.textContent=searchResult.matchLabel(i);anchor.appendChild(lineNumberSpan);const contentSpan=this._createContentSpan(lineContent,matchRanges);anchor.appendChild(contentSpan);const searchMatchElement=new UI.TreeElement();searchMatchElement.selectable=false;this.appendChild(searchMatchElement);searchMatchElement.listItemElement.className='search-match';searchMatchElement.listItemElement.appendChild(anchor);searchMatchElement.tooltip=lineContent;}}
_appendShowMoreMatchesElement(startMatchIndex){const matchesLeftCount=this._searchResult.matchesCount()-startMatchIndex;const showMoreMatchesText=Common.UIString('Show %d more',matchesLeftCount);const showMoreMatchesTreeElement=new UI.TreeElement(showMoreMatchesText);this.appendChild(showMoreMatchesTreeElement);showMoreMatchesTreeElement.listItemElement.classList.add('show-more-matches');showMoreMatchesTreeElement.onselect=this._showMoreMatchesElementSelected.bind(this,showMoreMatchesTreeElement,startMatchIndex);}
_createContentSpan(lineContent,matchRanges){let trimBy=0;if(matchRanges.length>0&&matchRanges[0].offset>20)
trimBy=15;lineContent=lineContent.substring(trimBy,1000+trimBy);if(trimBy){matchRanges=matchRanges.map(range=>new TextUtils.SourceRange(range.offset-trimBy+1,range.length));lineContent='\u2026'+lineContent;}
const contentSpan=createElement('span');contentSpan.className='search-match-content';contentSpan.textContent=lineContent;UI.highlightRangesWithStyleClass(contentSpan,matchRanges,'highlighted-match');return contentSpan;}
_regexMatchRanges(lineContent,regex){regex.lastIndex=0;let match;const matchRanges=[];while((regex.lastIndex<lineContent.length)&&(match=regex.exec(lineContent)))
matchRanges.push(new TextUtils.SourceRange(match.index,match[0].length));return matchRanges;}
_showMoreMatchesElementSelected(showMoreMatchesTreeElement,startMatchIndex){this.removeChild(showMoreMatchesTreeElement);this._appendSearchMatches(startMatchIndex,this._searchResult.matchesCount());return false;}};;Runtime.cachedResources["search/searchResultsPane.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n}\n\n.tree-outline {\n    padding: 0;\n}\n\n.tree-outline ol {\n    padding: 0;\n}\n\n.tree-outline li {\n    height: 16px;\n}\n\nli.search-result {\n    cursor: pointer;\n    font-size: 12px;\n    margin-top: 8px;\n    padding: 2px 0 2px 4px;\n    word-wrap: normal;\n    white-space: pre;\n}\n\nli.search-result:hover {\n    background-color: rgba(121, 121, 121, 0.1);\n}\n\nli.search-result .search-result-file-name {\n    color: #222;\n    flex: 1 1;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\nli.search-result .search-result-matches-count {\n    color: #888;\n    margin: 0 8px;\n}\n\nli.search-result.expanded .search-result-matches-count {\n    display: none;\n}\n\nli.show-more-matches {\n    color: #222;\n    cursor: pointer;\n    margin: 8px 0 0 -4px;\n}\n\nli.show-more-matches:hover {\n    text-decoration: underline;\n}\n\nli.search-match {\n    margin: 2px 0;\n    word-wrap: normal;\n    white-space: pre;\n}\n\nli.search-match::before {\n    display: none;\n}\n\nli.search-match .search-match-line-number {\n    color: rgb(128, 128, 128);\n    text-align: right;\n    vertical-align: top;\n    word-break: normal;\n    padding: 2px 4px 2px 6px;\n    margin-right: 5px;\n}\n\nli.search-match:hover {\n    background-color: var(--item-hover-color);\n}\n\nli.search-match .highlighted-match {\n    background-color: #F1EA00;\n}\n\n:host-context(.-theme-with-dark-background) li.search-match .highlighted-match {\n    background-color: hsl(133, 100%, 30%) !important;\n}\n\n.tree-outline .devtools-link {\n    text-decoration: none;\n    display: block;\n    flex: auto;\n}\n\nli.search-match .search-match-content {\n    color: #000;\n}\n\nol.children.expanded {\n    padding-bottom: 4px;\n}\n\n.search-match-link {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    margin-left: 9px;\n}\n\n.search-result-qualifier {\n    color: #AAA;\n}\n\n.search-result-dash {\n    color: #AAA;\n    margin: 0 4px;\n}\n\n/*# sourceURL=search/searchResultsPane.css */";Runtime.cachedResources["search/searchView.css"]="/*\n * Copyright 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.search-drawer-header {\n    align-items: center;\n    flex-shrink: 0;\n    overflow: hidden;\n}\n\n.search-toolbar {\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.search-toolbar-summary {\n    background-color: #eee;\n    border-top: 1px solid #ccc;\n    padding-left: 5px;\n    flex: 0 0 19px;\n    display: flex;\n    padding-right: 5px;\n}\n\n.search-toolbar-summary .search-message {\n    padding-top: 2px;\n    padding-left: 1ex;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n}\n\n.search-view .search-results {\n    overflow-y: auto;\n    display: flex;\n    flex: auto;\n}\n\n.search-view .search-results > div {\n    flex: auto;\n}\n\n/*# sourceURL=search/searchView.css */";Security.SecurityModel=class extends SDK.SDKModel{constructor(target){super(target);this._dispatcher=new Security.SecurityDispatcher(this);this._securityAgent=target.securityAgent();target.registerSecurityDispatcher(this._dispatcher);this._securityAgent.enable();}
resourceTreeModel(){return(this.target().model(SDK.ResourceTreeModel));}
networkManager(){return(this.target().model(SDK.NetworkManager));}
static SecurityStateComparator(a,b){let securityStateMap;if(Security.SecurityModel._symbolicToNumericSecurityState){securityStateMap=Security.SecurityModel._symbolicToNumericSecurityState;}else{securityStateMap=new Map();const ordering=[Protocol.Security.SecurityState.Info,Protocol.Security.SecurityState.Insecure,Protocol.Security.SecurityState.Neutral,Protocol.Security.SecurityState.Secure,Protocol.Security.SecurityState.Unknown];for(let i=0;i<ordering.length;i++)
securityStateMap.set(ordering[i],i+1);Security.SecurityModel._symbolicToNumericSecurityState=securityStateMap;}
const aScore=securityStateMap.get(a)||0;const bScore=securityStateMap.get(b)||0;return aScore-bScore;}};SDK.SDKModel.register(Security.SecurityModel,SDK.Target.Capability.Security,false);Security.SecurityModel.Events={SecurityStateChanged:Symbol('SecurityStateChanged')};Security.PageSecurityState=class{constructor(securityState,explanations,summary){this.securityState=securityState;this.explanations=explanations;this.summary=summary;}};Security.SecurityDispatcher=class{constructor(model){this._model=model;}
securityStateChanged(securityState,schemeIsCryptographic,explanations,insecureContentStatus,summary){const pageSecurityState=new Security.PageSecurityState(securityState,explanations,summary||null);this._model.dispatchEventToListeners(Security.SecurityModel.Events.SecurityStateChanged,pageSecurityState);}
certificateError(eventId,errorType,requestURL){}};;Security.SecurityPanel=class extends UI.PanelWithSidebar{constructor(){super('security');this._mainView=new Security.SecurityMainView(this);const title=createElementWithClass('span','title');title.textContent=Common.UIString('Overview');this._sidebarMainViewElement=new Security.SecurityPanelSidebarTreeElement(title,this._setVisibleView.bind(this,this._mainView),'security-main-view-sidebar-tree-item','lock-icon');this._sidebarMainViewElement.tooltip=title.textContent;this._sidebarTree=new Security.SecurityPanelSidebarTree(this._sidebarMainViewElement,this.showOrigin.bind(this));this.panelSidebarElement().appendChild(this._sidebarTree.element);this._lastResponseReceivedForLoaderId=new Map();this._origins=new Map();this._filterRequestCounts=new Map();SDK.targetManager.observeModels(Security.SecurityModel,this);}
static _instance(){return(self.runtime.sharedInstance(Security.SecurityPanel));}
static createCertificateViewerButtonForOrigin(text,origin){const certificateButton=UI.createTextButton(text,async e=>{e.consume();const names=await SDK.multitargetNetworkManager.getCertificate(origin);if(names.length>0)
InspectorFrontendHost.showCertificateViewer(names);},'origin-button');UI.ARIAUtils.markAsMenuButton(certificateButton);return certificateButton;}
static createCertificateViewerButtonForCert(text,names){const certificateButton=UI.createTextButton(text,e=>{e.consume();InspectorFrontendHost.showCertificateViewer(names);},'security-certificate-button');UI.ARIAUtils.markAsMenuButton(certificateButton);return certificateButton;}
static createHighlightedUrl(url,securityState){const schemeSeparator='://';const index=url.indexOf(schemeSeparator);if(index===-1){const text=createElement('span','');text.textContent=url;return text;}
const highlightedUrl=createElement('span');const scheme=url.substr(0,index);const content=url.substr(index+schemeSeparator.length);highlightedUrl.createChild('span','url-scheme-'+securityState).textContent=scheme;highlightedUrl.createChild('span','url-scheme-separator').textContent=schemeSeparator;highlightedUrl.createChild('span').textContent=content;return highlightedUrl;}
_updateSecurityState(newSecurityState,explanations,summary){this._sidebarMainViewElement.setSecurityState(newSecurityState);this._mainView.updateSecurityState(newSecurityState,explanations,summary);}
_onSecurityStateChanged(event){const data=(event.data);const securityState=(data.securityState);const explanations=(data.explanations);const summary=(data.summary);this._updateSecurityState(securityState,explanations,summary);}
selectAndSwitchToMainView(){this._sidebarMainViewElement.select(true);}
showOrigin(origin){const originState=this._origins.get(origin);if(!originState.originView)
originState.originView=new Security.SecurityOriginView(this,origin,originState);this._setVisibleView(originState.originView);}
wasShown(){super.wasShown();if(!this._visibleView)
this.selectAndSwitchToMainView();}
focus(){this._sidebarTree.focus();}
_setVisibleView(view){if(this._visibleView===view)
return;if(this._visibleView)
this._visibleView.detach();this._visibleView=view;if(view)
this.splitWidget().setMainWidget(view);}
_onResponseReceived(event){const request=(event.data);if(request.resourceType()===Common.resourceTypes.Document)
this._lastResponseReceivedForLoaderId.set(request.loaderId,request);}
_processRequest(request){const origin=Common.ParsedURL.extractOrigin(request.url());if(!origin){return;}
let securityState=(request.securityState());if(request.mixedContentType===Protocol.Security.MixedContentType.Blockable||request.mixedContentType===Protocol.Security.MixedContentType.OptionallyBlockable)
securityState=Protocol.Security.SecurityState.Insecure;if(this._origins.has(origin)){const originState=this._origins.get(origin);const oldSecurityState=originState.securityState;originState.securityState=this._securityStateMin(oldSecurityState,securityState);if(oldSecurityState!==originState.securityState){const securityDetails=(request.securityDetails());if(securityDetails)
originState.securityDetails=securityDetails;this._sidebarTree.updateOrigin(origin,securityState);if(originState.originView)
originState.originView.setSecurityState(securityState);}}else{const originState={};originState.securityState=securityState;const securityDetails=request.securityDetails();if(securityDetails)
originState.securityDetails=securityDetails;originState.loadedFromCache=request.cached();this._origins.set(origin,originState);this._sidebarTree.addOrigin(origin,securityState);}}
_onRequestFinished(event){const request=(event.data);this._updateFilterRequestCounts(request);this._processRequest(request);}
_updateFilterRequestCounts(request){if(request.mixedContentType===Protocol.Security.MixedContentType.None)
return;let filterKey=Network.NetworkLogView.MixedContentFilterValues.All;if(request.wasBlocked())
filterKey=Network.NetworkLogView.MixedContentFilterValues.Blocked;else if(request.mixedContentType===Protocol.Security.MixedContentType.Blockable)
filterKey=Network.NetworkLogView.MixedContentFilterValues.BlockOverridden;else if(request.mixedContentType===Protocol.Security.MixedContentType.OptionallyBlockable)
filterKey=Network.NetworkLogView.MixedContentFilterValues.Displayed;if(!this._filterRequestCounts.has(filterKey))
this._filterRequestCounts.set(filterKey,1);else
this._filterRequestCounts.set(filterKey,this._filterRequestCounts.get(filterKey)+1);this._mainView.refreshExplanations();}
filterRequestCount(filterKey){return this._filterRequestCounts.get(filterKey)||0;}
_securityStateMin(stateA,stateB){return Security.SecurityModel.SecurityStateComparator(stateA,stateB)<0?stateA:stateB;}
modelAdded(securityModel){if(this._securityModel)
return;this._securityModel=securityModel;const resourceTreeModel=securityModel.resourceTreeModel();const networkManager=securityModel.networkManager();this._eventListeners=[securityModel.addEventListener(Security.SecurityModel.Events.SecurityStateChanged,this._onSecurityStateChanged,this),resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.MainFrameNavigated,this._onMainFrameNavigated,this),resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.InterstitialShown,this._onInterstitialShown,this),resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.InterstitialHidden,this._onInterstitialHidden,this),networkManager.addEventListener(SDK.NetworkManager.Events.ResponseReceived,this._onResponseReceived,this),networkManager.addEventListener(SDK.NetworkManager.Events.RequestFinished,this._onRequestFinished,this),];if(resourceTreeModel.isInterstitialShowing())
this._onInterstitialShown();}
modelRemoved(securityModel){if(this._securityModel!==securityModel)
return;delete this._securityModel;Common.EventTarget.removeEventListeners(this._eventListeners);}
_onMainFrameNavigated(event){const frame=(event.data);const request=this._lastResponseReceivedForLoaderId.get(frame.loaderId);this.selectAndSwitchToMainView();this._sidebarTree.clearOrigins();this._origins.clear();this._lastResponseReceivedForLoaderId.clear();this._filterRequestCounts.clear();this._mainView.refreshExplanations();const origin=Common.ParsedURL.extractOrigin(request?request.url():frame.url);this._sidebarTree.setMainOrigin(origin);if(request)
this._processRequest(request);}
_onInterstitialShown(){this.selectAndSwitchToMainView();this._sidebarTree.toggleOriginsList(true);}
_onInterstitialHidden(){this._sidebarTree.toggleOriginsList(false);}};Security.SecurityPanel.Origin;Security.SecurityPanel.OriginState;Security.SecurityPanelSidebarTree=class extends UI.TreeOutlineInShadow{constructor(mainViewElement,showOriginInPanel){super();this.registerRequiredCSS('security/sidebar.css');this.registerRequiredCSS('security/lockIcon.css');this.appendChild(mainViewElement);this._showOriginInPanel=showOriginInPanel;this._mainOrigin=null;this._originGroups=new Map();this._originGroupTitles=new Map([[Security.SecurityPanelSidebarTree.OriginGroup.MainOrigin,ls`Main origin`],[Security.SecurityPanelSidebarTree.OriginGroup.NonSecure,ls`Non-secure origins`],[Security.SecurityPanelSidebarTree.OriginGroup.Secure,ls`Secure origins`],[Security.SecurityPanelSidebarTree.OriginGroup.Unknown,ls`Unknown / canceled`],]);for(const key in Security.SecurityPanelSidebarTree.OriginGroup){const group=Security.SecurityPanelSidebarTree.OriginGroup[key];const element=this._createOriginGroupElement(this._originGroupTitles.get(group));this._originGroups.set(group,element);UI.ARIAUtils.setAccessibleName(element.childrenListElement,(element.title));this.appendChild(element);}
this._clearOriginGroups();const mainViewReloadMessage=new UI.TreeElement(ls`Refresh to view details`);mainViewReloadMessage.selectable=false;mainViewReloadMessage.listItemElement.classList.add('security-main-view-reload-message');this._originGroups.get(Security.SecurityPanelSidebarTree.OriginGroup.MainOrigin).appendChild(mainViewReloadMessage);this._elementsByOrigin=new Map();}
_createOriginGroupElement(originGroupTitle){const originGroup=new UI.TreeElement(originGroupTitle,true);originGroup.selectable=false;originGroup.setCollapsible(false);originGroup.expand();originGroup.listItemElement.classList.add('security-sidebar-origins');return originGroup;}
toggleOriginsList(hidden){for(const element of this._originGroups.values())
element.hidden=hidden;}
addOrigin(origin,securityState){const originElement=new Security.SecurityPanelSidebarTreeElement(Security.SecurityPanel.createHighlightedUrl(origin,securityState),this._showOriginInPanel.bind(this,origin),'security-sidebar-tree-item','security-property');originElement.tooltip=origin;this._elementsByOrigin.set(origin,originElement);this.updateOrigin(origin,securityState);}
setMainOrigin(origin){this._mainOrigin=origin;}
updateOrigin(origin,securityState){const originElement=(this._elementsByOrigin.get(origin));originElement.setSecurityState(securityState);let newParent;if(origin===this._mainOrigin){newParent=this._originGroups.get(Security.SecurityPanelSidebarTree.OriginGroup.MainOrigin);if(securityState===Protocol.Security.SecurityState.Secure){newParent.title=ls`Main origin (secure)`;UI.ARIAUtils.setAccessibleName(newParent.childrenListElement,newParent.title);}else{newParent.title=ls`Main origin (non-secure)`;UI.ARIAUtils.setAccessibleName(newParent.childrenListElement,newParent.title);}}else{switch(securityState){case Protocol.Security.SecurityState.Secure:newParent=this._originGroups.get(Security.SecurityPanelSidebarTree.OriginGroup.Secure);break;case Protocol.Security.SecurityState.Unknown:newParent=this._originGroups.get(Security.SecurityPanelSidebarTree.OriginGroup.Unknown);break;default:newParent=this._originGroups.get(Security.SecurityPanelSidebarTree.OriginGroup.NonSecure);break;}}
const oldParent=originElement.parent;if(oldParent!==newParent){if(oldParent){oldParent.removeChild(originElement);if(oldParent.childCount()===0)
oldParent.hidden=true;}
newParent.appendChild(originElement);newParent.hidden=false;}}
_clearOriginGroups(){for(const originGroup of this._originGroups.values()){originGroup.removeChildren();originGroup.hidden=true;}
const mainOrigin=this._originGroups.get(Security.SecurityPanelSidebarTree.OriginGroup.MainOrigin);mainOrigin.title=this._originGroupTitles.get(Security.SecurityPanelSidebarTree.OriginGroup.MainOrigin);mainOrigin.hidden=false;}
clearOrigins(){this._clearOriginGroups();this._elementsByOrigin.clear();}};Security.SecurityPanelSidebarTree.OriginGroup={MainOrigin:Symbol('MainOrigin'),NonSecure:Symbol('NonSecure'),Secure:Symbol('Secure'),Unknown:Symbol('Unknown')};Security.SecurityPanelSidebarTreeElement=class extends UI.TreeElement{constructor(textElement,selectCallback,className,cssPrefix){super('',false);this._selectCallback=selectCallback;this._cssPrefix=cssPrefix;this.listItemElement.classList.add(className);this._iconElement=this.listItemElement.createChild('div','icon');this._iconElement.classList.add(this._cssPrefix);this.listItemElement.appendChild(textElement);this.setSecurityState(Protocol.Security.SecurityState.Unknown);}
static SecurityStateComparator(a,b){return Security.SecurityModel.SecurityStateComparator(a.securityState(),b.securityState());}
setSecurityState(newSecurityState){if(this._securityState)
this._iconElement.classList.remove(this._cssPrefix+'-'+this._securityState);this._securityState=newSecurityState;this._iconElement.classList.add(this._cssPrefix+'-'+newSecurityState);}
securityState(){return this._securityState;}
onselect(){this._selectCallback();return true;}};Security.SecurityMainView=class extends UI.VBox{constructor(panel){super(true);this.registerRequiredCSS('security/mainView.css');this.registerRequiredCSS('security/lockIcon.css');this.setMinimumSize(200,100);this.contentElement.classList.add('security-main-view');this._panel=panel;this._summarySection=this.contentElement.createChild('div','security-summary');this._securityExplanationsMain=this.contentElement.createChild('div','security-explanation-list security-explanations-main');this._securityExplanationsExtra=this.contentElement.createChild('div','security-explanation-list security-explanations-extra');const summaryDiv=this._summarySection.createChild('div','security-summary-section-title');summaryDiv.textContent=ls`Security overview`;UI.ARIAUtils.markAsHeading(summaryDiv,1);const lockSpectrum=this._summarySection.createChild('div','lock-spectrum');lockSpectrum.createChild('div','lock-icon lock-icon-secure').title=Common.UIString('Secure');lockSpectrum.createChild('div','lock-icon lock-icon-neutral').title=Common.UIString('Not secure');lockSpectrum.createChild('div','lock-icon lock-icon-insecure').title=Common.UIString('Not secure (broken)');this._summarySection.createChild('div','triangle-pointer-container').createChild('div','triangle-pointer-wrapper').createChild('div','triangle-pointer');this._summaryText=this._summarySection.createChild('div','security-summary-text');UI.ARIAUtils.markAsHeading(this._summaryText,2);}
_addExplanation(parent,explanation){const explanationSection=parent.createChild('div','security-explanation');explanationSection.classList.add('security-explanation-'+explanation.securityState);explanationSection.createChild('div','security-property').classList.add('security-property-'+explanation.securityState);const text=explanationSection.createChild('div','security-explanation-text');const explanationHeader=text.createChild('div','security-explanation-title');if(explanation.title){explanationHeader.createChild('span').textContent=explanation.title+' - ';explanationHeader.createChild('span','security-explanation-title-'+explanation.securityState).textContent=explanation.summary;}else{explanationHeader.textContent=explanation.summary;}
text.createChild('div').textContent=explanation.description;if(explanation.certificate.length){text.appendChild(Security.SecurityPanel.createCertificateViewerButtonForCert(Common.UIString('View certificate'),explanation.certificate));}
if(explanation.recommendations&&explanation.recommendations.length){const recommendationList=text.createChild('ul','security-explanation-recommendations');for(const recommendation of explanation.recommendations)
recommendationList.createChild('li').textContent=recommendation;}
return text;}
updateSecurityState(newSecurityState,explanations,summary){this._summarySection.classList.remove('security-summary-'+this._securityState);this._securityState=newSecurityState;this._summarySection.classList.add('security-summary-'+this._securityState);const summaryExplanationStrings={'unknown':ls`The security of this page is unknown.`,'insecure':ls`This page is not secure (broken HTTPS).`,'neutral':ls`This page is not secure.`,'secure':ls`This page is secure (valid HTTPS).`};this._summaryText.textContent=summary||summaryExplanationStrings[this._securityState];this._explanations=explanations;this.refreshExplanations();}
refreshExplanations(){this._securityExplanationsMain.removeChildren();this._securityExplanationsExtra.removeChildren();for(const explanation of this._explanations){if(explanation.securityState===Protocol.Security.SecurityState.Info){this._addExplanation(this._securityExplanationsExtra,explanation);}else{switch(explanation.mixedContentType){case Protocol.Security.MixedContentType.Blockable:this._addMixedContentExplanation(this._securityExplanationsMain,explanation,Network.NetworkLogView.MixedContentFilterValues.BlockOverridden);break;case Protocol.Security.MixedContentType.OptionallyBlockable:this._addMixedContentExplanation(this._securityExplanationsMain,explanation,Network.NetworkLogView.MixedContentFilterValues.Displayed);break;default:this._addExplanation(this._securityExplanationsMain,explanation);break;}}}
if(this._panel.filterRequestCount(Network.NetworkLogView.MixedContentFilterValues.Blocked)>0){const explanation=({securityState:Protocol.Security.SecurityState.Info,summary:Common.UIString('Blocked mixed content'),description:Common.UIString('Your page requested non-secure resources that were blocked.'),mixedContentType:Protocol.Security.MixedContentType.Blockable,certificate:[]});this._addMixedContentExplanation(this._securityExplanationsMain,explanation,Network.NetworkLogView.MixedContentFilterValues.Blocked);}}
_addMixedContentExplanation(parent,explanation,filterKey){const element=this._addExplanation(parent,explanation);const filterRequestCount=this._panel.filterRequestCount(filterKey);if(!filterRequestCount){const refreshPrompt=element.createChild('div','security-mixed-content');refreshPrompt.textContent=Common.UIString('Refresh the page to record requests for HTTP resources.');return;}
const requestsAnchor=element.createChild('div','security-mixed-content devtools-link');UI.ARIAUtils.markAsLink(requestsAnchor);requestsAnchor.tabIndex=0;if(filterRequestCount===1)
requestsAnchor.textContent=Common.UIString('View %d request in Network Panel',filterRequestCount);else
requestsAnchor.textContent=Common.UIString('View %d requests in Network Panel',filterRequestCount);requestsAnchor.addEventListener('click',this.showNetworkFilter.bind(this,filterKey));requestsAnchor.addEventListener('keydown',event=>{if(isEnterKey(event))
this.showNetworkFilter(filterKey,event);});}
showNetworkFilter(filterKey,e){e.consume();Network.NetworkPanel.revealAndFilter([{filterType:Network.NetworkLogView.FilterType.MixedContent,filterValue:filterKey}]);}};Security.SecurityOriginView=class extends UI.VBox{constructor(panel,origin,originState){super();this._panel=panel;this.setMinimumSize(200,100);this.element.classList.add('security-origin-view');this.registerRequiredCSS('security/originView.css');this.registerRequiredCSS('security/lockIcon.css');const titleSection=this.element.createChild('div','title-section');const titleDiv=titleSection.createChild('div','title-section-header');titleDiv.textContent=ls`Origin`;UI.ARIAUtils.markAsHeading(titleDiv,1);const originDisplay=titleSection.createChild('div','origin-display');this._originLockIcon=originDisplay.createChild('span','security-property');this._originLockIcon.classList.add('security-property-'+originState.securityState);originDisplay.appendChild(Security.SecurityPanel.createHighlightedUrl(origin,originState.securityState));const originNetworkDiv=titleSection.createChild('div','view-network-button');const originNetworkButton=UI.createTextButton('View requests in Network Panel',e=>{e.consume();const parsedURL=new Common.ParsedURL(origin);Network.NetworkPanel.revealAndFilter([{filterType:Network.NetworkLogView.FilterType.Domain,filterValue:parsedURL.host},{filterType:Network.NetworkLogView.FilterType.Scheme,filterValue:parsedURL.scheme}]);},'origin-button');UI.ARIAUtils.markAsLink(originNetworkButton);originNetworkDiv.appendChild(originNetworkButton);if(originState.securityDetails){const connectionSection=this.element.createChild('div','origin-view-section');const connectionDiv=connectionSection.createChild('div','origin-view-section-title');connectionDiv.textContent=ls`Connection`;UI.ARIAUtils.markAsHeading(connectionDiv,2);let table=new Security.SecurityDetailsTable();connectionSection.appendChild(table.element());table.addRow(Common.UIString('Protocol'),originState.securityDetails.protocol);if(originState.securityDetails.keyExchange)
table.addRow(Common.UIString('Key exchange'),originState.securityDetails.keyExchange);if(originState.securityDetails.keyExchangeGroup)
table.addRow(Common.UIString('Key exchange group'),originState.securityDetails.keyExchangeGroup);table.addRow(Common.UIString('Cipher'),originState.securityDetails.cipher+
(originState.securityDetails.mac?' with '+originState.securityDetails.mac:''));const certificateSection=this.element.createChild('div','origin-view-section');const certificateDiv=certificateSection.createChild('div','origin-view-section-title');certificateDiv.textContent=ls`Certificate`;UI.ARIAUtils.markAsHeading(certificateDiv,2);const sctListLength=originState.securityDetails.signedCertificateTimestampList.length;const ctCompliance=originState.securityDetails.certificateTransparencyCompliance;let sctSection;if(sctListLength||ctCompliance!==Protocol.Network.CertificateTransparencyCompliance.Unknown){sctSection=this.element.createChild('div','origin-view-section');const sctDiv=sctSection.createChild('div','origin-view-section-title');sctDiv.textContent=ls`Certificate Transparency`;UI.ARIAUtils.markAsHeading(sctDiv,2);}
const sanDiv=this._createSanDiv(originState.securityDetails.sanList);const validFromString=new Date(1000*originState.securityDetails.validFrom).toUTCString();const validUntilString=new Date(1000*originState.securityDetails.validTo).toUTCString();table=new Security.SecurityDetailsTable();certificateSection.appendChild(table.element());table.addRow(Common.UIString('Subject'),originState.securityDetails.subjectName);table.addRow(Common.UIString('SAN'),sanDiv);table.addRow(Common.UIString('Valid from'),validFromString);table.addRow(Common.UIString('Valid until'),validUntilString);table.addRow(Common.UIString('Issuer'),originState.securityDetails.issuer);table.addRow('',Security.SecurityPanel.createCertificateViewerButtonForOrigin(Common.UIString('Open full certificate details'),origin));if(!sctSection)
return;const sctSummaryTable=new Security.SecurityDetailsTable();sctSummaryTable.element().classList.add('sct-summary');sctSection.appendChild(sctSummaryTable.element());for(let i=0;i<sctListLength;i++){const sct=originState.securityDetails.signedCertificateTimestampList[i];sctSummaryTable.addRow(Common.UIString('SCT'),sct.logDescription+' ('+sct.origin+', '+sct.status+')');}
const sctTableWrapper=sctSection.createChild('div','sct-details');sctTableWrapper.classList.add('hidden');for(let i=0;i<sctListLength;i++){const sctTable=new Security.SecurityDetailsTable();sctTableWrapper.appendChild(sctTable.element());const sct=originState.securityDetails.signedCertificateTimestampList[i];sctTable.addRow(Common.UIString('Log name'),sct.logDescription);sctTable.addRow(Common.UIString('Log ID'),sct.logId.replace(/(.{2})/g,'$1 '));sctTable.addRow(Common.UIString('Validation status'),sct.status);sctTable.addRow(Common.UIString('Source'),sct.origin);sctTable.addRow(Common.UIString('Issued at'),new Date(sct.timestamp).toUTCString());sctTable.addRow(Common.UIString('Hash algorithm'),sct.hashAlgorithm);sctTable.addRow(Common.UIString('Signature algorithm'),sct.signatureAlgorithm);sctTable.addRow(Common.UIString('Signature data'),sct.signatureData.replace(/(.{2})/g,'$1 '));}
if(sctListLength){function toggleSctDetailsDisplay(){const isDetailsShown=!sctTableWrapper.classList.contains('hidden');if(isDetailsShown)
toggleSctsDetailsLink.textContent=ls`Show full details`;else
toggleSctsDetailsLink.textContent=ls`Hide full details`;sctSummaryTable.element().classList.toggle('hidden');sctTableWrapper.classList.toggle('hidden');}
const toggleSctsDetailsLink=UI.createTextButton(ls`Show full details`,toggleSctDetailsDisplay,'details-toggle');sctSection.appendChild(toggleSctsDetailsLink);}
switch(ctCompliance){case Protocol.Network.CertificateTransparencyCompliance.Compliant:sctSection.createChild('div','origin-view-section-notes').textContent=Common.UIString('This request complies with Certificate Transparency policy.');break;case Protocol.Network.CertificateTransparencyCompliance.NotCompliant:sctSection.createChild('div','origin-view-section-notes').textContent=Common.UIString('This request does not comply with Certificate Transparency policy.');break;case Protocol.Network.CertificateTransparencyCompliance.Unknown:break;}
const noteSection=this.element.createChild('div','origin-view-section origin-view-notes');if(originState.loadedFromCache){noteSection.createChild('div').textContent=Common.UIString('This response was loaded from cache. Some security details might be missing.');}
noteSection.createChild('div').textContent=Common.UIString('The security details above are from the first inspected response.');}else if(originState.securityState===Protocol.Security.SecurityState.Secure){const secureSection=this.element.createChild('div','origin-view-section');const secureDiv=secureSection.createChild('div','origin-view-section-title');secureDiv.textContent=ls`Secure`;UI.ARIAUtils.markAsHeading(secureDiv,2);secureSection.createChild('div').textContent=ls`This origin is a non-HTTPS secure origin.`;}else if(originState.securityState!==Protocol.Security.SecurityState.Unknown){const notSecureSection=this.element.createChild('div','origin-view-section');const notSecureDiv=notSecureSection.createChild('div','origin-view-section-title');notSecureDiv.textContent=ls`Not secure`;UI.ARIAUtils.markAsHeading(notSecureDiv,2);notSecureSection.createChild('div').textContent=Common.UIString('Your connection to this origin is not secure.');}else{const noInfoSection=this.element.createChild('div','origin-view-section');const noInfoDiv=noInfoSection.createChild('div','origin-view-section-title');noInfoDiv.textContent=ls`No security information`;UI.ARIAUtils.markAsHeading(noInfoDiv,2);noInfoSection.createChild('div').textContent=Common.UIString('No security details are available for this origin.');}}
_createSanDiv(sanList){const sanDiv=createElement('div');if(sanList.length===0){sanDiv.textContent=Common.UIString('(n/a)');sanDiv.classList.add('empty-san');}else{const truncatedNumToShow=2;const listIsTruncated=sanList.length>truncatedNumToShow+1;for(let i=0;i<sanList.length;i++){const span=sanDiv.createChild('span','san-entry');span.textContent=sanList[i];if(listIsTruncated&&i>=truncatedNumToShow)
span.classList.add('truncated-entry');}
if(listIsTruncated){function toggleSANTruncation(){if(sanDiv.classList.contains('truncated-san')){sanDiv.classList.remove('truncated-san');truncatedSANToggle.textContent=ls`Show less`;}else{sanDiv.classList.add('truncated-san');truncatedSANToggle.textContent=ls`Show more (${sanList.length} total)`;}}
const truncatedSANToggle=UI.createTextButton(ls`Show more (${sanList.length} total)`,toggleSANTruncation);sanDiv.appendChild(truncatedSANToggle);toggleSANTruncation();}}
return sanDiv;}
setSecurityState(newSecurityState){for(const className of Array.prototype.slice.call(this._originLockIcon.classList)){if(className.startsWith('security-property-'))
this._originLockIcon.classList.remove(className);}
this._originLockIcon.classList.add('security-property-'+newSecurityState);}};Security.SecurityDetailsTable=class{constructor(){this._element=createElement('table');this._element.classList.add('details-table');}
element(){return this._element;}
addRow(key,value){const row=this._element.createChild('div','details-table-row');row.createChild('div').textContent=key;const valueDiv=row.createChild('div');if(typeof value==='string')
valueDiv.textContent=value;else
valueDiv.appendChild(value);}};;Runtime.cachedResources["security/lockIcon.css"]="/* Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.lock-icon,\n.security-property {\n    height: 16px;\n    width: 16px;\n\n    -webkit-mask-image: url(Images/securityIcons.svg);\n    -webkit-mask-size: 80px 32px;\n\n    background-color: #888;\n}\n\n.lock-icon-secure {\n    -webkit-mask-position: 0px 0px;\n    background-color: #0B8043;\n}\n\n.lock-icon-unknown,\n.lock-icon-neutral {\n    -webkit-mask-position: -16px 0px;\n    background-color: #000000; /* Black for clarity on lower DPI screens */\n}\n\n@media (-webkit-min-device-pixel-ratio: 1.1) {\n    .lock-icon-unknown,\n    .lock-icon-neutral {\n        background-color: #5A5A5A; /* Gray for hiDPI screens */\n    }\n}\n\n.lock-icon-insecure {\n    -webkit-mask-position: -32px 0px;\n    background-color: #C63626;\n}\n\n.security-property-secure {\n    -webkit-mask-position: 0px -16px;\n    background-color: #0B8043;\n}\n\n.security-property-neutral {\n    -webkit-mask-position: -16px -16px;\n    background-color: #C63626;\n}\n\n.security-property-insecure {\n    -webkit-mask-position: -32px -16px;\n    background-color: #C63626;\n}\n\n.security-property-info {\n    -webkit-mask-position: -48px -16px;\n    background-color: rgba(0, 0, 0, 0.5);\n}\n\n.security-property-unknown {\n    -webkit-mask-position: -64px -16px;\n    background-color: rgba(0, 0, 0, 0.5);\n}\n\n.url-scheme-secure {\n    color: #0b8043;\n}\n\n.url-scheme-neutral,\n.url-scheme-insecure {\n    color: #cb3626;\n}\n\n.url-scheme-separator {\n    color: #8a8a8a;\n}\n\n/*# sourceURL=security/lockIcon.css */";Runtime.cachedResources["security/mainView.css"]="/* Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.devtools-link {\n  display: inline-block;\n}\n\n.security-main-view {\n    -webkit-user-select: text;\n    overflow-x: hidden;\n    overflow-y: auto;\n    background-color: var(--toolbar-bg-color);\n}\n\n.security-main-view > div {\n    flex-shrink: 0;\n}\n\n.security-summary-section-title {\n    font-size: 15px;\n    margin: 12px 16px;\n}\n\n.lock-spectrum {\n    margin: 8px 16px;\n    display: flex;\n    align-items: flex-start;\n}\n\n.security-summary .lock-icon {\n    flex: none;\n    width: 16px;\n    height: 16px;\n    margin: 0 0;\n}\n\n/* Separate the middle icon from the other two. */\n.security-summary .lock-icon-neutral {\n    margin: 0 16px;\n}\n\n.security-summary:not(.security-summary-secure) .lock-icon-secure,\n.security-summary:not(.security-summary-neutral) .lock-icon-neutral,\n.security-summary:not(.security-summary-insecure) .lock-icon-insecure {\n    background-color: rgba(90, 90, 90, 0.25);\n}\n\n.triangle-pointer-container {\n    margin: 8px 24px 0;\n    padding: 0 0;\n}\n\n.triangle-pointer-wrapper {\n    /* Defaults for dynamic properties. */\n    transform: translateX(0);\n    transition: transform 0.3s;\n}\n\n.triangle-pointer {\n    width: 12px;\n    height: 12px;\n    margin-bottom: -6px;\n    margin-left: -6px;\n    transform: rotate(-45deg);\n    border-style: solid;\n    border-width: 1px 1px 0 0;\n\n    background: #fff;\n    border-color: rgb(217, 217, 217);\n}\n\n.security-summary-secure .triangle-pointer-wrapper {\n    transform: translateX(0px);\n}\n\n.security-summary-neutral .triangle-pointer-wrapper {\n    transform: translateX(32px);\n}\n\n.security-summary-insecure .triangle-pointer-wrapper {\n    transform: translateX(64px);\n}\n\n.security-summary-text {\n    padding: 16px 24px;\n    border-style: solid;\n    border-width: 1px 0;\n    font-size: 15px;\n\n    background: #fff;\n    border-color: rgb(217, 217, 217);\n}\n\n.security-summary-secure .triangle-pointer,\n.security-summary-secure .security-summary-text,\n.security-explanation-title-secure {\n    color: #0b8043;\n}\n\n.security-summary-insecure .triangle-pointer,\n.security-summary-insecure .security-summary-text,\n.security-explanation-title-neutral,\n.security-explanation-title-insecure {\n    color: #cb3626;\n}\n\n.security-explanation-list {\n    padding-bottom: 16px;\n}\n\n.security-explanation-list:empty {\n    border-bottom: none;\n    padding: 0px;\n}\n\n.security-explanations-main {\n    margin-top: -5px;\n    background-color: #fff;\n    border-bottom: 1px solid rgb(230, 230, 230);\n}\n\n.security-explanations-extra {\n    background-color: transparent;\n}\n\n.security-explanation {\n    padding: 11px;\n    display: flex;\n    white-space: nowrap;\n    border: none;\n    color: rgb(90, 90, 90);\n}\n\n.security-explanation-text {\n    flex: auto;\n    white-space: normal;\n    max-width: 400px;\n}\n\n.security-certificate-button {\n    margin-top: 8px;\n}\n\n.security-explanation .security-property {\n    flex: none;\n    width: 16px;\n    height: 16px;\n    margin-right: 16px;\n}\n\n.security-explanation-title {\n    color: rgb(48, 57, 66);\n    margin-top: 1px;\n    margin-bottom: 8px;\n}\n\n.security-mixed-content {\n    margin-top: 8px;\n}\n\n.security-explanation-recommendations {\n    padding-inline-start: 16px;\n}\n\n.security-explanation-recommendations > li {\n    margin-bottom: 4px;\n}\n\n/*# sourceURL=security/mainView.css */";Runtime.cachedResources["security/originView.css"]="/* Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.title-section {\n    padding: 16px 0 24px 0;\n    border-bottom: 1px solid rgb(230, 230, 230);\n}\n\n.title-section-header {\n    padding-left: 16px;\n    padding-bottom: 10px;\n    font-size: 14px;\n}\n\n.security-origin-view {\n    overflow-x: hidden;\n    overflow-y: scroll;\n    display: block;\n    -webkit-user-select: text;\n}\n\n.security-origin-view .origin-view-section {\n    border-bottom: 1px solid rgb(230, 230, 230);\n    padding: 12px 6px 12px  24px;\n    font-size:12px;\n}\n\n.origin-view-notes {\n    margin-top: 2px;\n    color: #8c8c8c;\n}\n\n.origin-view-section-notes {\n    margin-top: 6px;\n    color: #8c8c8c;\n}\n\n.security-origin-view .origin-display {\n    font-size: 12px;\n    padding-left: 38px;\n    display: flex;\n    align-items: center;\n}\n\n.title-section > .view-network-button {\n    padding: 6px 0 0 16px\n}\n\n.security-origin-view .origin-display .security-property {\n    display: inline-block;\n    vertical-align: middle;\n    position: absolute;\n    left: 16px;\n}\n\n.security-origin-view .origin-view-section-title {\n    margin-top: 4px;\n    margin-bottom: 4px;\n    font-weight: bold;\n}\n\n.security-origin-view .details-table-row {\n    display: flex;\n    white-space: nowrap;\n    overflow: hidden;\n    line-height: 22px;\n}\n\n.security-origin-view .details-table-row > div {\n    align-items: flex-start;\n}\n\n.security-origin-view .details-table-row > div:first-child {\n    color: rgb(140, 140, 140);\n    width: 110px;\n    margin-right: 1em;\n    flex: none;\n    display: flex;\n    justify-content: flex-end;\n}\n.security-origin-view .details-table-row > div:nth-child(2) {\n    flex: auto;\n    white-space: normal;\n}\n\n.security-origin-view .sct-details .details-table .details-table-row:last-child div:last-child {\n    border-bottom: 1px solid rgb(230, 230, 230);\n    padding-bottom: 10px;\n}\n\n.security-origin-view .sct-details .details-table:last-child .details-table-row:last-child div:last-child {\n    border-bottom: none;\n    padding-bottom: 0;\n}\n\n.security-origin-view .details-toggle {\n  margin-left: 126px;\n}\n\n.security-origin-view .sct-toggle {\n    margin-left: 145px;\n    padding-top: 5px;\n}\n\n.security-origin-view .details-table .empty-san {\n    color: rgb(140, 140, 140);\n}\n\n.security-origin-view .details-table .san-entry {\n    display: block;\n}\n\n.security-origin-view .truncated-san .truncated-entry {\n    display: none;\n}\n\n.origin-button {\n    margin-top: 4px;\n}\n\n.origin-view-section:last-child  {\n    border-bottom:none;\n}\n\n/*# sourceURL=security/originView.css */";Runtime.cachedResources["security/sidebar.css"]="/* Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.tree-outline {\n    padding: 0;\n}\n\n.tree-outline li {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    padding: 2px 5px;\n    overflow: hidden;\n    margin: 2px 0;\n    border-top: 1px solid transparent;\n    white-space: nowrap;\n}\n\n.tree-outline li.selected:focus .lock-icon,\n.tree-outline .security-sidebar-tree-item.selected:focus .icon\n{\n    background-color: var(--selection-fg-color);\n}\n\n.tree-outline .security-main-view-sidebar-tree-item {\n    border-bottom: 1px solid rgb(230, 230, 230);\n    padding: 16px 0;\n}\n\n.tree-outline li.security-sidebar-origins {\n    padding: 1px 8px 1px 13px;\n    margin-top: 1em;\n    margin-bottom: 0.5em;\n    color: rgb(90, 90, 90);\n    border-top: none;\n    line-height: 16px;\n    text-shadow: rgba(255, 255, 255, 0.75) 0 1px 0;\n}\n\n.tree-outline ol {\n    padding-left: 0;\n}\n\n.tree-outline li::before {\n    content: none;\n}\n\n.tree-outline .security-main-view-sidebar-tree-item,\n.tree-outline .security-sidebar-origins,\n.tree-outline li.security-sidebar-origins + .children > li {\n    padding-left: 16px;\n}\n\n.tree-outline .lock-icon,\n.tree-outline .security-property {\n    margin-right: 4px;\n    flex: none;\n}\n\n.security-sidebar-tree-item {\n    padding: 2px 0;\n}\n\n.security-sidebar-tree-item .title {\n    overflow: hidden;\n    margin-right: 5px;\n}\n\n.security-main-view-reload-message .tree-element-title {\n    color: rgba(0, 0, 0, 0.5);\n    padding-left: 8px;\n}\n\n/*# sourceURL=security/sidebar.css */";Settings.SettingsScreen=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS('settings/settingsScreen.css');this.contentElement.classList.add('settings-window-main');this.contentElement.classList.add('vbox');const settingsLabelElement=createElement('div');const settingsTitleElement=UI.createShadowRootWithCoreStyles(settingsLabelElement,'settings/settingsScreen.css').createChild('div','settings-window-title');UI.ARIAUtils.markAsHeading(settingsTitleElement,1);settingsTitleElement.textContent=ls`Settings`;this._tabbedLocation=UI.viewManager.createTabbedLocation(()=>Settings.SettingsScreen._showSettingsScreen(),'settings-view');const tabbedPane=this._tabbedLocation.tabbedPane();tabbedPane.leftToolbar().appendToolbarItem(new UI.ToolbarItem(settingsLabelElement));tabbedPane.setShrinkableTabs(false);tabbedPane.makeVerticalTabLayout();const shortcutsView=new UI.SimpleView(ls`Shortcuts`);UI.shortcutsScreen.createShortcutsTabView().show(shortcutsView.element);this._tabbedLocation.appendView(shortcutsView);tabbedPane.show(this.contentElement);this.element.addEventListener('keydown',this._keyDown.bind(this),false);this._developerModeCounter=0;this.setDefaultFocusedElement(this.contentElement);}
static _showSettingsScreen(name){const settingsScreen=(self.runtime.sharedInstance(Settings.SettingsScreen));if(settingsScreen.isShowing())
return;const dialog=new UI.Dialog();dialog.contentElement.tabIndex=-1;dialog.addCloseButton();settingsScreen.show(dialog.contentElement);dialog.show();settingsScreen._selectTab(name||'preferences');}
resolveLocation(locationName){return this._tabbedLocation;}
_selectTab(name){UI.viewManager.showView(name);}
_keyDown(event){const shiftKeyCode=16;if(event.keyCode===shiftKeyCode&&++this._developerModeCounter>5)
this.contentElement.classList.add('settings-developer-mode');}};Settings.SettingsTab=class extends UI.VBox{constructor(name,id){super();this.element.classList.add('settings-tab-container');if(id)
this.element.id=id;const header=this.element.createChild('header');header.createChild('h1').createTextChild(name);this.containerElement=this.element.createChild('div','settings-container-wrapper').createChild('div','settings-tab settings-content settings-container');}
_appendSection(name){const block=this.containerElement.createChild('div','settings-block');if(name){UI.ARIAUtils.markAsGroup(block);const title=block.createChild('div','settings-section-title');title.textContent=name;UI.ARIAUtils.markAsHeading(title,2);UI.ARIAUtils.setAccessibleName(block,name);}
return block;}};Settings.GenericSettingsTab=class extends Settings.SettingsTab{constructor(){super(Common.UIString('Preferences'),'preferences-tab-content');const explicitSectionOrder=['','Appearance','Sources','Elements','Network','Performance','Console','Extensions'];this._nameToSection=new Map();for(const sectionName of explicitSectionOrder)
this._sectionElement(sectionName);self.runtime.extensions('setting').forEach(this._addSetting.bind(this));self.runtime.extensions(UI.SettingUI).forEach(this._addSettingUI.bind(this));this._appendSection().appendChild(UI.createTextButton(ls`Restore default and restart`,restoreAndReload));function restoreAndReload(){Common.settings.clearAll();Components.reload();}}
static isSettingVisible(extension){const descriptor=extension.descriptor();if(!('title'in descriptor))
return false;if(!('category'in descriptor))
return false;return true;}
_addSetting(extension){if(!Settings.GenericSettingsTab.isSettingVisible(extension))
return;const sectionElement=this._sectionElement(extension.descriptor()['category']);const setting=Common.moduleSetting(extension.descriptor()['settingName']);const settingControl=UI.SettingsUI.createControlForSetting(setting);if(settingControl)
sectionElement.appendChild(settingControl);}
_addSettingUI(extension){const descriptor=extension.descriptor();const sectionName=descriptor['category']||'';extension.instance().then(appendCustomSetting.bind(this));function appendCustomSetting(object){const settingUI=(object);const element=settingUI.settingElement();if(element)
this._sectionElement(sectionName).appendChild(element);}}
_sectionElement(sectionName){let sectionElement=this._nameToSection.get(sectionName);if(!sectionElement){const uiSectionName=sectionName&&Common.UIString(sectionName);sectionElement=this._appendSection(uiSectionName);this._nameToSection.set(sectionName,sectionElement);}
return sectionElement;}};Settings.ExperimentsSettingsTab=class extends Settings.SettingsTab{constructor(){super(Common.UIString('Experiments'),'experiments-tab-content');const experiments=Runtime.experiments.allConfigurableExperiments();if(experiments.length){const experimentsSection=this._appendSection();experimentsSection.appendChild(this._createExperimentsWarningSubsection());for(let i=0;i<experiments.length;++i)
experimentsSection.appendChild(this._createExperimentCheckbox(experiments[i]));}}
_createExperimentsWarningSubsection(){const subsection=createElement('div');const warning=subsection.createChild('span','settings-experiments-warning-subsection-warning');warning.textContent=Common.UIString('WARNING:');subsection.createTextChild(' ');const message=subsection.createChild('span','settings-experiments-warning-subsection-message');message.textContent=Common.UIString('These experiments could be dangerous and may require restart.');return subsection;}
_createExperimentCheckbox(experiment){const label=UI.CheckboxLabel.create(Common.UIString(experiment.title),experiment.isEnabled());const input=label.checkboxElement;input.name=experiment.name;function listener(){experiment.setEnabled(input.checked);}
input.addEventListener('click',listener,false);const p=createElement('p');p.className=experiment.hidden&&!experiment.isEnabled()?'settings-experiment-hidden':'';p.appendChild(label);return p;}};Settings.SettingsScreen.ActionDelegate=class{handleAction(context,actionId){switch(actionId){case'settings.show':Settings.SettingsScreen._showSettingsScreen();return true;case'settings.documentation':InspectorFrontendHost.openInNewTab('https://go.microsoft.com/fwlink/?linkid=2039325');return true;case'settings.shortcuts':Settings.SettingsScreen._showSettingsScreen(Common.UIString('Shortcuts'));return true;}
return false;}};Settings.SettingsScreen.Revealer=class{reveal(object){console.assert(object instanceof Common.Setting);const setting=(object);let success=false;self.runtime.extensions('setting').forEach(revealModuleSetting);self.runtime.extensions(UI.SettingUI).forEach(revealSettingUI);self.runtime.extensions('view').forEach(revealSettingsView);return success?Promise.resolve():Promise.reject();function revealModuleSetting(extension){if(!Settings.GenericSettingsTab.isSettingVisible(extension))
return;if(extension.descriptor()['settingName']===setting.name){InspectorFrontendHost.bringToFront();Settings.SettingsScreen._showSettingsScreen();success=true;}}
function revealSettingUI(extension){const settings=extension.descriptor()['settings'];if(settings&&settings.indexOf(setting.name)!==-1){InspectorFrontendHost.bringToFront();Settings.SettingsScreen._showSettingsScreen();success=true;}}
function revealSettingsView(extension){const location=extension.descriptor()['location'];if(location!=='settings-view')
return;const settings=extension.descriptor()['settings'];if(settings&&settings.indexOf(setting.name)!==-1){InspectorFrontendHost.bringToFront();Settings.SettingsScreen._showSettingsScreen(extension.descriptor()['id']);success=true;}}}};;Settings.FrameworkBlackboxSettingsTab=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS('settings/frameworkBlackboxSettingsTab.css');const header=this.contentElement.createChild('div','header');header.textContent=ls`Framework Library Code`;UI.ARIAUtils.markAsHeading(header,1);this.contentElement.createChild('div','intro').textContent=ls`Debugger will skip through the scripts and will not stop on exceptions thrown by them.`;const blackboxContentScripts=this.contentElement.createChild('div','blackbox-content-scripts');blackboxContentScripts.appendChild(UI.SettingsUI.createSettingCheckbox(ls`Mark content scripts as Library code`,Common.moduleSetting('skipContentScripts'),true));blackboxContentScripts.title=ls`Mark content scripts as Library code (extension scripts in the page)`;this._blackboxLabel=Common.UIString('Library code');this._disabledLabel=Common.UIString('Disabled');this._list=new UI.ListWidget(this);this._list.element.classList.add('blackbox-list');this._list.registerRequiredCSS('settings/frameworkBlackboxSettingsTab.css');const placeholder=createElementWithClass('div','blackbox-list-empty');placeholder.textContent=Common.UIString('No Library patterns');this._list.setEmptyPlaceholder(placeholder);this._list.show(this.contentElement);const addPatternButton=UI.createTextButton(Common.UIString('Add pattern...'),this._addButtonClicked.bind(this),'add-button');this.contentElement.appendChild(addPatternButton);this._setting=Common.moduleSetting('skipStackFramesPattern');this._setting.addChangeListener(this._settingUpdated,this);this.setDefaultFocusedElement(addPatternButton);}
wasShown(){super.wasShown();this._settingUpdated();}
_settingUpdated(){this._list.clear();const patterns=this._setting.getAsArray();for(let i=0;i<patterns.length;++i)
this._list.appendItem(patterns[i],true);}
_addButtonClicked(){this._list.addNewItem(this._setting.getAsArray().length,{pattern:'',disabled:false});}
renderItem(item,editable){const element=createElementWithClass('div','blackbox-list-item');const pattern=element.createChild('div','blackbox-pattern');pattern.textContent=item.pattern;pattern.title=ls`Mark scripts as Library code whose names match '${item.pattern}'`;element.createChild('div','blackbox-separator');element.createChild('div','blackbox-behavior').textContent=item.disabled?this._disabledLabel:this._blackboxLabel;if(item.disabled)
element.classList.add('blackbox-disabled');return element;}
removeItemRequested(item,index){const patterns=this._setting.getAsArray();patterns.splice(index,1);this._setting.setAsArray(patterns);}
commitEdit(item,editor,isNew){item.pattern=editor.control('pattern').value.trim();item.disabled=editor.control('behavior').value===this._disabledLabel;const list=this._setting.getAsArray();if(isNew)
list.push(item);this._setting.setAsArray(list);}
beginEdit(item){const editor=this._createEditor();editor.control('pattern').value=item.pattern;editor.control('behavior').value=item.disabled?this._disabledLabel:this._blackboxLabel;return editor;}
_createEditor(){if(this._editor)
return this._editor;const editor=new UI.ListWidget.Editor();this._editor=editor;const content=editor.contentElement();const titles=content.createChild('div','blackbox-edit-row');titles.createChild('div','blackbox-pattern').textContent=Common.UIString('Pattern');titles.createChild('div','blackbox-separator blackbox-separator-invisible');titles.createChild('div','blackbox-behavior').textContent=Common.UIString('Behavior');const fields=content.createChild('div','blackbox-edit-row');const pattern=editor.createInput('pattern','text','/framework\\.js$',patternValidator.bind(this));UI.ARIAUtils.setAccessibleName(pattern,ls`Pattern`);fields.createChild('div','blackbox-pattern').appendChild(pattern);fields.createChild('div','blackbox-separator blackbox-separator-invisible');const behavior=editor.createSelect('behavior',[this._blackboxLabel,this._disabledLabel],behaviorValidator);UI.ARIAUtils.setAccessibleName(behavior,ls`Behavior`);fields.createChild('div','blackbox-behavior').appendChild(behavior);return editor;function patternValidator(item,index,input){const pattern=input.value.trim();const patterns=this._setting.getAsArray();if(!pattern.length)
return{valid:false,errorMessage:ls`Pattern cannot be empty`};for(let i=0;i<patterns.length;++i){if(i!==index&&patterns[i].pattern===pattern)
return{valid:false,errorMessage:ls`Pattern already exists`};}
let regex;try{regex=new RegExp(pattern);}catch(e){}
if(!regex)
return{valid:false,errorMessage:ls`Pattern must be a valid regular expression`};else
return{valid:true};}
function behaviorValidator(item,index,input){return{valid:true};}}};;Runtime.cachedResources["settings/frameworkBlackboxSettingsTab.css"]="/*\n * Copyright 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    overflow:hidden;\n}\n\n.header {\n    padding: 0 0 6px;\n    border-bottom: 1px solid #EEEEEE;\n    font-size: 18px;\n    font-weight: normal;\n    flex: none;\n}\n\n.intro {\n    margin-top: 10px;\n}\n\n.blackbox-content-scripts {\n    margin-top: 10px;\n    flex: none;\n}\n\n.add-button {\n    margin: 10px 2px;\n    align-self: flex-start;\n    flex: none;\n}\n\n.blackbox-list {\n    margin-top: 10px;\n    max-width: 500px;\n    flex: 0 1 auto;\n    min-height: 30px;\n}\n\n.blackbox-list-empty {\n    flex: auto;\n    height: 30px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.blackbox-list-item {\n    padding: 3px 5px 3px 5px;\n    height: 30px;\n    display: flex;\n    align-items: center;\n    position: relative;\n    flex: auto 1 1;\n}\n\n .blackbox-list-item .blackbox-pattern {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    -webkit-user-select: none;\n    color: #222;\n    overflow: hidden;\n}\n\n.blackbox-pattern {\n    flex: auto;\n    min-width: 100px;\n}\n\n.blackbox-list-item.blackbox-disabled .blackbox-pattern {\n    text-decoration: line-through;\n}\n\n.blackbox-behavior {\n    flex: 0 0 100px;\n    padding-left: 10px;\n}\n\n.blackbox-behavior > select {\n    margin-left: -10px;\n}\n\n.blackbox-separator {\n    flex: 0 0 1px;\n    background-color: rgb(231, 231, 231);\n    height: 30px;\n    margin: 0 4px;\n}\n\n.blackbox-separator-invisible {\n    visibility: hidden;\n    height: 100% !important;\n}\n\n.blackbox-edit-row {\n    flex: none;\n    display: flex;\n    flex-direction: row;\n    margin: 6px 5px;\n    align-items: center;\n}\n\n.blackbox-edit-row input,\n.blackbox-edit-row select {\n    width: 100%;\n    text-align: inherit;\n}\n\n/*# sourceURL=settings/frameworkBlackboxSettingsTab.css */";Runtime.cachedResources["settings/settingsScreen.css"]="/*\n * Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.settings-window-main {\n    color: rgb(48, 57, 66);\n    background-color: white;\n    padding: 11px 0 0 0;\n}\n\n.settings-content {\n    overflow-y: auto;\n    overflow-x: hidden;\n    margin: 8px 8px 8px 0;\n    padding: 0 4px;\n    flex: auto;\n}\n\n.settings-footnote {\n    border-top: 1px solid #EEEEEE;\n    margin: 0;\n    padding: 12px;\n}\n\n.settings-container {\n    width: 100%;\n    -webkit-column-width: 288px;\n}\n\n.settings-block {\n    display: block;\n    padding-bottom: 9px;\n    width: 288px;\n    -webkit-column-break-inside: avoid;\n}\n\n.settings-tab.settings-container {\n    -webkit-column-width: 308px;\n}\n\n.settings-tab .settings-block {\n    margin-left: 20px;\n}\n\n.settings-line {\n    padding-bottom: 5px;\n    margin-bottom: 5px;\n}\n\n.settings-key-cell {\n    display: inline-block;\n    width: 153px;\n    white-space: nowrap;\n    text-align: right;\n    vertical-align: middle;\n    padding-right: 6px;\n}\n\n.settings-cell {\n    display: inline-block;\n    width: 135px;\n    vertical-align: middle;\n}\n\n.settings-section-title {\n    font-size: 120%;\n    text-align: left;\n}\n\n.settings-key {\n    padding: 0.1em 0.6em;\n    border: 1px solid #ccc;\n    font-size: 11px;\n    background-color: #f7f7f7;\n    color: #333;\n    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px #ffffff inset;\n    border-radius: 3px;\n    display: inline-block;\n    margin: 0 0.1em;\n    text-shadow: 0 1px 0 #fff;\n    line-height: 1.5;\n    white-space: nowrap;\n}\n\n.settings-combine-keys,\n.settings-key-delimiter {\n    font-size: 9px;\n}\n\n.settings-combine-keys {\n    margin: 0 0.3em;\n}\n\n.settings-key-delimiter {\n    margin: 0 0.5em;\n    display: none;\n}\n\nfieldset {\n    margin: 0;\n    padding: 0;\n    border: none;\n}\n\n.settings-tab label {\n    padding-right: 4px;\n    display: inline-flex;\n    flex-shrink: 0;\n}\n\n.settings-block p p {\n    padding-left: 30px;\n}\n\n.settings-experiments-warning-subsection-warning {\n    color: rgb(200, 0, 0);\n}\n\n.settings-experiments-warning-subsection-message {\n    color: inherit;\n}\n\n.settings-content input[type=checkbox] {\n    margin: 1px 7px 1px 2px;\n}\n\n.settings-window-title {\n    font-size: 18px;\n    color: rgb(48, 57, 66);\n    padding: 0 0 5px 13px;\n}\n\n.settings-container-wrapper {\n    position: absolute;\n    top: 31px;\n    left: 0px;\n    right: 0;\n    bottom: 0;\n    overflow: auto;\n    padding-top: 9px;\n}\n\n.settings-tab.settings-content {\n    margin: 0;\n    padding: 0;\n}\n\n.settings-tab-container {\n    flex: auto;\n    overflow: hidden;\n}\n\n.settings-tab-container header {\n    padding: 0 0 6px;\n    border-bottom: 1px solid #EEEEEE;\n}\n\n#experiments-tab-content .settings-container {\n    -webkit-column-width: 470px;\n}\n\n#experiments-tab-content .settings-block {\n    width: 470px;\n    margin-left: 0;\n}\n\n.settings-tab-container header > h1 {\n    font-size: 18px;\n    font-weight: normal;\n    margin: 0;\n    padding-bottom: 3px;\n}\n\n.settings-tab .settings-section-title {\n    margin-left: -20px;\n    color: #222;\n}\n\n.settings-tab .settings-block fieldset:disabled label:hover {\n    color: inherit;\n}\n\n.settings-tab .settings-block label:hover {\n    color: #222;\n}\n\n.settings-tab p {\n    margin: 12px 0;\n}\n\n.settings-tab select {\n    margin-left: 10px;\n}\n\n.settings-experiment-hidden {\n    display: none;\n}\n\n.settings-experiment-hidden [is=dt-checkbox] {\n    background-color: #ddd;\n}\n\n.settings-developer-mode .settings-experiment-hidden {\n    display: block;\n}\n\n/*# sourceURL=settings/settingsScreen.css */";Snippets.SnippetFileSystem=class extends Persistence.PlatformFileSystem{constructor(){super('snippet://','snippets');this._lastSnippetIdentifierSetting=Common.settings.createSetting('scriptSnippets_lastIdentifier',0);this._snippetsSetting=Common.settings.createSetting('scriptSnippets',[]);}
initialFilePaths(){const savedSnippets=this._snippetsSetting.get();return savedSnippets.map(snippet=>escape(snippet.name));}
async createFile(path,name){const nextId=this._lastSnippetIdentifierSetting.get()+1;this._lastSnippetIdentifierSetting.set(nextId);const snippetName=ls`Script snippet #${nextId}`;const snippets=this._snippetsSetting.get();snippets.push({name:snippetName,content:''});this._snippetsSetting.set(snippets);return escape(snippetName);}
async deleteFile(path){const name=unescape(path.substring(1));const allSnippets=this._snippetsSetting.get();const snippets=allSnippets.filter(snippet=>snippet.name!==name);if(allSnippets.length!==snippets.length){this._snippetsSetting.set(snippets);return true;}
return false;}
requestFileContent(path,callback){const name=unescape(path.substring(1));const snippet=this._snippetsSetting.get().find(snippet=>snippet.name===name);callback(snippet?snippet.content:null,false);}
async setFileContent(path,content,isBase64){const name=unescape(path.substring(1));const snippets=this._snippetsSetting.get();const snippet=snippets.find(snippet=>snippet.name===name);if(snippet){snippet.content=content;this._snippetsSetting.set(snippets);return true;}
return false;}
renameFile(path,newName,callback){const name=unescape(path.substring(1));const snippets=this._snippetsSetting.get();const snippet=snippets.find(snippet=>snippet.name===name);newName=newName.trim();if(!snippet||newName.length===0||snippets.find(snippet=>snippet.name===newName)){callback(false);return;}
snippet.name=newName;this._snippetsSetting.set(snippets);callback(true,newName);}
async searchInPath(query,progress){const re=new RegExp(query.escapeForRegExp(),'i');const snippets=this._snippetsSetting.get().filter(snippet=>snippet.content.match(re));return snippets.map(snippet=>escape(snippet.name));}
mimeFromPath(path){return'text/javascript';}
contentType(path){return Common.resourceTypes.Script;}
tooltipForURL(url){return ls`Linked to ${unescape(url.substring(this.path().length))}`;}
supportsAutomapping(){return true;}};Snippets.evaluateScriptSnippet=async function(uiSourceCode){if(!uiSourceCode.url().startsWith('snippet://'))
return;const executionContext=UI.context.flavor(SDK.ExecutionContext);if(!executionContext)
return;const runtimeModel=executionContext.runtimeModel;await uiSourceCode.requestContent();uiSourceCode.commitWorkingCopy();const expression=uiSourceCode.workingCopy();Common.console.show();const url=uiSourceCode.url();const result=await executionContext.evaluate({expression:`${expression}\n//# sourceURL=${url}`,objectGroup:'console',silent:false,includeCommandLineAPI:true,returnByValue:false,generatePreview:true,},false,true);if(result.exceptionDetails){SDK.consoleModel.addMessage(SDK.ConsoleMessage.fromException(runtimeModel,result.exceptionDetails,undefined,undefined,url));return;}
if(!result.object)
return;const scripts=executionContext.debuggerModel.scriptsForSourceURL(url);const scriptId=scripts[scripts.length-1].scriptId;SDK.consoleModel.addMessage(new SDK.ConsoleMessage(runtimeModel,SDK.ConsoleMessage.MessageSource.JS,SDK.ConsoleMessage.MessageLevel.Info,'',SDK.ConsoleMessage.MessageType.Result,url,undefined,undefined,[result.object],undefined,undefined,executionContext.id,scriptId));};Snippets.isSnippetsUISourceCode=function(uiSourceCode){return uiSourceCode.url().startsWith('snippet://');};Snippets.isSnippetsProject=function(project){return project.type()===Workspace.projectTypes.FileSystem&&Persistence.FileSystemWorkspaceBinding.fileSystemType(project)==='snippets';};Persistence.isolatedFileSystemManager.addPlatformFileSystem('snippet://',new Snippets.SnippetFileSystem());Snippets.project=(Workspace.workspace.projectsForType(Workspace.projectTypes.FileSystem).find(project=>Persistence.FileSystemWorkspaceBinding.fileSystemType(project)==='snippets'));;Snippets.SnippetsQuickOpen=class extends QuickOpen.FilteredListWidget.Provider{constructor(){super();this._snippets=[];}
selectItem(itemIndex,promptValue){if(itemIndex===null)
return;Snippets.evaluateScriptSnippet(this._snippets[itemIndex]);}
notFoundText(query){return Common.UIString('No snippets found.');}
attach(){this._snippets=Snippets.project.uiSourceCodes();}
detach(){this._snippets=[];}
itemCount(){return this._snippets.length;}
itemKeyAt(itemIndex){return this._snippets[itemIndex].name();}
renderItem(itemIndex,query,titleElement,subtitleElement){titleElement.textContent=unescape(this._snippets[itemIndex].name());titleElement.classList.add('monospace');QuickOpen.FilteredListWidget.highlightRanges(titleElement,query,true);}};;SourceFrame.BinaryResourceViewFactory=class{constructor(base64content,contentUrl,resourceType){this._base64content=base64content;this._contentUrl=contentUrl;this._resourceType=resourceType;this._arrayPromise=null;this._hexPromise=null;this._utf8Promise=null;}
async _fetchContentAsArray(){if(!this._arrayPromise){this._arrayPromise=new Promise(async resolve=>{const fetchResponse=await fetch('data:;base64,'+this._base64content);resolve(new Uint8Array(await fetchResponse.arrayBuffer()));});}
return await this._arrayPromise;}
async hex(){if(!this._hexPromise){this._hexPromise=new Promise(async resolve=>{const content=await this._fetchContentAsArray();const hexString=SourceFrame.BinaryResourceViewFactory.uint8ArrayToHexString(content);resolve(hexString);});}
return this._hexPromise;}
async base64(){return this._base64content;}
async utf8(){if(!this._utf8Promise){this._utf8Promise=new Promise(async resolve=>{const content=await this._fetchContentAsArray();const utf8String=new TextDecoder('utf8').decode(content);resolve(utf8String);});}
return this._utf8Promise;}
createBase64View(){return new SourceFrame.ResourceSourceFrame(Common.StaticContentProvider.fromString(this._contentUrl,this._resourceType,this._base64content),false,{lineNumbers:false,lineWrapping:true});}
createHexView(){const hexViewerContentProvider=new Common.StaticContentProvider(this._contentUrl,this._resourceType,async()=>SourceFrame.BinaryResourceViewFactory.uint8ArrayToHexViewer(await this._fetchContentAsArray()));return new SourceFrame.ResourceSourceFrame(hexViewerContentProvider,false,{lineNumbers:false,lineWrapping:false});}
createUtf8View(){const utf8fn=(this.utf8.bind(this));const utf8ContentProvider=new Common.StaticContentProvider(this._contentUrl,this._resourceType,utf8fn);return new SourceFrame.ResourceSourceFrame(utf8ContentProvider,false,{lineNumbers:true,lineWrapping:true});}
static uint8ArrayToHexString(uint8Array){let output='';for(let i=0;i<uint8Array.length;i++)
output+=SourceFrame.BinaryResourceViewFactory.numberToHex(uint8Array[i],2);return output;}
static numberToHex(number,padding){let hex=number.toString(16);while(hex.length<padding)
hex='0'+hex;return hex;}
static uint8ArrayToHexViewer(array){let output='';let line=0;while((line*16)<array.length){const lineArray=array.slice(line*16,(line+1)*16);output+=SourceFrame.BinaryResourceViewFactory.numberToHex(line,8)+':';let hexColsPrinted=0;for(let i=0;i<lineArray.length;i++){if(i%2===0){output+=' ';hexColsPrinted++;}
output+=SourceFrame.BinaryResourceViewFactory.numberToHex(lineArray[i],2);hexColsPrinted+=2;}
while(hexColsPrinted<42){output+=' ';hexColsPrinted++;}
for(let i=0;i<lineArray.length;i++){const code=lineArray[i];if(code>=32&&code<=126){output+=String.fromCharCode(code);}else{output+='.';}}
output+='\n';line++;}
return output;}};;SourceFrame.SourcesTextEditor=class extends TextEditor.CodeMirrorTextEditor{constructor(delegate,codeMirrorOptions){const defaultCodeMirrorOptions={lineNumbers:true,lineWrapping:false,bracketMatchingSetting:Common.moduleSetting('textEditorBracketMatching'),padBottom:true};if(codeMirrorOptions)
Object.assign(defaultCodeMirrorOptions,codeMirrorOptions);super(defaultCodeMirrorOptions);this.codeMirror().addKeyMap({'Enter':'smartNewlineAndIndent','Esc':'sourcesDismiss'});this._delegate=delegate;this.codeMirror().on('cursorActivity',this._cursorActivity.bind(this));this.codeMirror().on('gutterClick',this._gutterClick.bind(this));this.codeMirror().on('scroll',this._scroll.bind(this));this.codeMirror().on('focus',this._focus.bind(this));this.codeMirror().on('blur',this._blur.bind(this));this.codeMirror().on('beforeSelectionChange',this._fireBeforeSelectionChanged.bind(this));this.element.addEventListener('contextmenu',this._contextMenu.bind(this),false);this._gutterMouseMove=event=>{this.element.classList.toggle('CodeMirror-gutter-hovered',event.clientX<this.codeMirror().getGutterElement().getBoundingClientRect().right);};this._gutterMouseOut=event=>{this.element.classList.toggle('CodeMirror-gutter-hovered',false);};this.codeMirror().addKeyMap(SourceFrame.SourcesTextEditor._BlockIndentController);this._tokenHighlighter=new SourceFrame.SourcesTextEditor.TokenHighlighter(this,this.codeMirror());this._gutters=['CodeMirror-linenumbers'];this.codeMirror().setOption('gutters',this._gutters.slice());this.codeMirror().setOption('electricChars',false);this.codeMirror().setOption('smartIndent',false);function updateAnticipateJumpFlag(value){this._isHandlingMouseDownEvent=value;}
this.element.addEventListener('mousedown',updateAnticipateJumpFlag.bind(this,true),true);this.element.addEventListener('mousedown',updateAnticipateJumpFlag.bind(this,false),false);Common.moduleSetting('textEditorIndent').addChangeListener(this._onUpdateEditorIndentation,this);Common.moduleSetting('textEditorAutoDetectIndent').addChangeListener(this._onUpdateEditorIndentation,this);Common.moduleSetting('showWhitespacesInEditor').addChangeListener(this._updateWhitespace,this);Common.moduleSetting('textEditorCodeFolding').addChangeListener(this._updateCodeFolding,this);this._updateCodeFolding();this._autocompleteConfig={isWordChar:TextUtils.TextUtils.isWordChar};Common.moduleSetting('textEditorAutocompletion').addChangeListener(this._updateAutocomplete,this);this._updateAutocomplete();this._onUpdateEditorIndentation();this._setupWhitespaceHighlight();this._infoBarDiv=null;}
attachInfobar(infobar){if(!this._infoBarDiv){this._infoBarDiv=createElementWithClass('div','flex-none');UI.ARIAUtils.markAsAlert(this._infoBarDiv);this.element.insertBefore(this._infoBarDiv,this.element.firstChild);}
this._infoBarDiv.appendChild(infobar.element);infobar.setParentView(this);this.doResize();}
static _guessIndentationLevel(lines){const tabRegex=/^\t+/;let tabLines=0;const indents={};for(let lineNumber=0;lineNumber<lines.length;++lineNumber){const text=lines[lineNumber];if(text.length===0||!TextUtils.TextUtils.isSpaceChar(text[0]))
continue;if(tabRegex.test(text)){++tabLines;continue;}
let i=0;while(i<text.length&&TextUtils.TextUtils.isSpaceChar(text[i]))
++i;if(i%2!==0)
continue;indents[i]=1+(indents[i]||0);}
const linesCountPerIndentThreshold=3*lines.length/100;if(tabLines&&tabLines>linesCountPerIndentThreshold)
return'\t';let minimumIndent=Infinity;for(const i in indents){if(indents[i]<linesCountPerIndentThreshold)
continue;const indent=parseInt(i,10);if(minimumIndent>indent)
minimumIndent=indent;}
if(minimumIndent===Infinity)
return Common.moduleSetting('textEditorIndent').get();return' '.repeat(minimumIndent);}
_isSearchActive(){return!!this._tokenHighlighter.highlightedRegex();}
scrollToLine(lineNumber){super.scrollToLine(lineNumber);this._scroll();}
highlightSearchResults(regex,range){function innerHighlightRegex(){if(range){this.scrollLineIntoView(range.startLine);if(range.endColumn>TextEditor.CodeMirrorTextEditor.maxHighlightLength)
this.setSelection(range);else
this.setSelection(TextUtils.TextRange.createFromLocation(range.startLine,range.startColumn));}
this._tokenHighlighter.highlightSearchResults(regex,range);}
if(!this._selectionBeforeSearch)
this._selectionBeforeSearch=this.selection();this.codeMirror().operation(innerHighlightRegex.bind(this));}
cancelSearchResultsHighlight(){this.codeMirror().operation(this._tokenHighlighter.highlightSelectedTokens.bind(this._tokenHighlighter));if(this._selectionBeforeSearch){this._reportJump(this._selectionBeforeSearch,this.selection());delete this._selectionBeforeSearch;}}
removeHighlight(highlightDescriptor){highlightDescriptor.clear();}
highlightRange(range,cssClass){cssClass='CodeMirror-persist-highlight '+cssClass;const pos=TextEditor.CodeMirrorUtils.toPos(range);++pos.end.ch;return this.codeMirror().markText(pos.start,pos.end,{className:cssClass,startStyle:cssClass+'-start',endStyle:cssClass+'-end'});}
installGutter(type,leftToNumbers){if(this._gutters.indexOf(type)!==-1)
return;if(leftToNumbers)
this._gutters.unshift(type);else
this._gutters.push(type);this.codeMirror().setOption('gutters',this._gutters.slice());this.refresh();}
uninstallGutter(type){const index=this._gutters.indexOf(type);if(index===-1)
return;this.codeMirror().clearGutter(type);this._gutters.splice(index,1);this.codeMirror().setOption('gutters',this._gutters.slice());this.refresh();}
setGutterDecoration(lineNumber,type,element){console.assert(this._gutters.indexOf(type)!==-1,'Cannot decorate unexisting gutter.');this.codeMirror().setGutterMarker(lineNumber,type,element);}
setExecutionLocation(lineNumber,columnNumber){this.clearPositionHighlight();this._executionLine=this.codeMirror().getLineHandle(lineNumber);if(!this._executionLine)
return;this.showExecutionLineBackground();this.codeMirror().addLineClass(this._executionLine,'wrap','cm-execution-line-outline');let token=this.tokenAtTextPosition(lineNumber,columnNumber);if(token&&!token.type&&token.startColumn+1===token.endColumn){const tokenContent=this.codeMirror().getLine(lineNumber)[token.startColumn];if(tokenContent==='.'||tokenContent==='(')
token=this.tokenAtTextPosition(lineNumber,token.endColumn+1);}
let endColumn;if(token&&token.type)
endColumn=token.endColumn;else
endColumn=this.codeMirror().getLine(lineNumber).length;this._executionLineTailMarker=this.codeMirror().markText({line:lineNumber,ch:columnNumber},{line:lineNumber,ch:endColumn},{className:'cm-execution-line-tail'});}
showExecutionLineBackground(){if(this._executionLine)
this.codeMirror().addLineClass(this._executionLine,'wrap','cm-execution-line');}
hideExecutionLineBackground(){if(this._executionLine)
this.codeMirror().removeLineClass(this._executionLine,'wrap','cm-execution-line');}
clearExecutionLine(){this.clearPositionHighlight();if(this._executionLine){this.hideExecutionLineBackground();this.codeMirror().removeLineClass(this._executionLine,'wrap','cm-execution-line-outline');}
delete this._executionLine;if(this._executionLineTailMarker)
this._executionLineTailMarker.clear();delete this._executionLineTailMarker;}
toggleLineClass(lineNumber,className,toggled){if(this.hasLineClass(lineNumber,className)===toggled)
return;const lineHandle=this.codeMirror().getLineHandle(lineNumber);if(!lineHandle)
return;if(toggled){this.codeMirror().addLineClass(lineHandle,'gutter',className);this.codeMirror().addLineClass(lineHandle,'wrap',className);}else{this.codeMirror().removeLineClass(lineHandle,'gutter',className);this.codeMirror().removeLineClass(lineHandle,'wrap',className);}}
hasLineClass(lineNumber,className){const lineInfo=this.codeMirror().lineInfo(lineNumber);const wrapClass=lineInfo.wrapClass||'';const classNames=wrapClass.split(' ');return classNames.indexOf(className)!==-1;}
_gutterClick(instance,lineNumber,gutter,event){if(gutter!=='CodeMirror-linenumbers')
return;this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.GutterClick,{lineNumber:lineNumber,event:event});}
_contextMenu(event){const contextMenu=new UI.ContextMenu(event);event.consume(true);const wrapper=event.target.enclosingNodeOrSelfWithClass('CodeMirror-gutter-wrapper');const target=wrapper?wrapper.querySelector('.CodeMirror-linenumber'):null;let promise;if(target){promise=this._delegate.populateLineGutterContextMenu(contextMenu,parseInt(target.textContent,10)-1);}else{const textSelection=this.selection();promise=this._delegate.populateTextAreaContextMenu(contextMenu,textSelection.startLine,textSelection.startColumn);}
promise.then(showAsync.bind(this));function showAsync(){contextMenu.appendApplicableItems(this);contextMenu.show();}}
editRange(range,text,origin){const newRange=super.editRange(range,text,origin);if(Common.moduleSetting('textEditorAutoDetectIndent').get())
this._onUpdateEditorIndentation();return newRange;}
_onUpdateEditorIndentation(){this._setEditorIndentation(TextEditor.CodeMirrorUtils.pullLines(this.codeMirror(),SourceFrame.SourcesTextEditor.LinesToScanForIndentationGuessing));}
_setEditorIndentation(lines){const extraKeys={};let indent=Common.moduleSetting('textEditorIndent').get();if(Common.moduleSetting('textEditorAutoDetectIndent').get())
indent=SourceFrame.SourcesTextEditor._guessIndentationLevel(lines);if(indent===TextUtils.TextUtils.Indent.TabCharacter){this.codeMirror().setOption('indentWithTabs',true);this.codeMirror().setOption('indentUnit',4);}else{this.codeMirror().setOption('indentWithTabs',false);this.codeMirror().setOption('indentUnit',indent.length);extraKeys.Tab=function(codeMirror){if(codeMirror.somethingSelected())
return CodeMirror.Pass;const pos=codeMirror.getCursor('head');codeMirror.replaceRange(indent.substring(pos.ch%indent.length),codeMirror.getCursor());};}
this.codeMirror().setOption('extraKeys',extraKeys);this._indentationLevel=indent;}
indent(){return this._indentationLevel;}
_onAutoAppendedSpaces(){this._autoAppendedSpaces=this._autoAppendedSpaces||[];for(let i=0;i<this._autoAppendedSpaces.length;++i){const position=this._autoAppendedSpaces[i].resolve();if(!position)
continue;const line=this.line(position.lineNumber);if(line.length===position.columnNumber&&TextUtils.TextUtils.lineIndent(line).length===line.length){this.codeMirror().replaceRange('',new CodeMirror.Pos(position.lineNumber,0),new CodeMirror.Pos(position.lineNumber,position.columnNumber));}}
this._autoAppendedSpaces=[];const selections=this.selections();for(let i=0;i<selections.length;++i){const selection=selections[i];this._autoAppendedSpaces.push(this.textEditorPositionHandle(selection.startLine,selection.startColumn));}}
_cursorActivity(){if(!this._isSearchActive())
this.codeMirror().operation(this._tokenHighlighter.highlightSelectedTokens.bind(this._tokenHighlighter));const start=this.codeMirror().getCursor('anchor');const end=this.codeMirror().getCursor('head');this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.SelectionChanged,TextEditor.CodeMirrorUtils.toRange(start,end));}
_reportJump(from,to){if(from&&to&&from.equal(to))
return;this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.JumpHappened,{from:from,to:to});}
_scroll(){const topmostLineNumber=this.codeMirror().lineAtHeight(this.codeMirror().getScrollInfo().top,'local');this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.ScrollChanged,topmostLineNumber);}
_focus(){this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.EditorFocused);}
_blur(){this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.EditorBlurred);}
_fireBeforeSelectionChanged(codeMirror,selection){if(!this._isHandlingMouseDownEvent)
return;if(!selection.ranges.length)
return;const primarySelection=selection.ranges[0];this._reportJump(this.selection(),TextEditor.CodeMirrorUtils.toRange(primarySelection.anchor,primarySelection.head));}
dispose(){super.dispose();Common.moduleSetting('textEditorIndent').removeChangeListener(this._onUpdateEditorIndentation,this);Common.moduleSetting('textEditorAutoDetectIndent').removeChangeListener(this._onUpdateEditorIndentation,this);Common.moduleSetting('showWhitespacesInEditor').removeChangeListener(this._updateWhitespace,this);Common.moduleSetting('textEditorCodeFolding').removeChangeListener(this._updateCodeFolding,this);}
setText(text){this._setEditorIndentation(text.split('\n').slice(0,SourceFrame.SourcesTextEditor.LinesToScanForIndentationGuessing));super.setText(text);}
_updateWhitespace(){this.setMimeType(this.mimeType());}
_updateCodeFolding(){if(Common.moduleSetting('textEditorCodeFolding').get()){this.installGutter('CodeMirror-foldgutter',false);this.element.addEventListener('mousemove',this._gutterMouseMove);this.element.addEventListener('mouseout',this._gutterMouseOut);this.codeMirror().setOption('foldGutter',true);this.codeMirror().setOption('foldOptions',{minFoldSize:1});}else{this.codeMirror().execCommand('unfoldAll');this.element.removeEventListener('mousemove',this._gutterMouseMove);this.element.removeEventListener('mouseout',this._gutterMouseOut);this.uninstallGutter('CodeMirror-foldgutter');this.codeMirror().setOption('foldGutter',false);}}
rewriteMimeType(mimeType){this._setupWhitespaceHighlight();const whitespaceMode=Common.moduleSetting('showWhitespacesInEditor').get();this.element.classList.toggle('show-whitespaces',whitespaceMode==='all');if(whitespaceMode==='all')
return this._allWhitespaceOverlayMode(mimeType);else if(whitespaceMode==='trailing')
return this._trailingWhitespaceOverlayMode(mimeType);return mimeType;}
_allWhitespaceOverlayMode(mimeType){let modeName=CodeMirror.mimeModes[mimeType]?(CodeMirror.mimeModes[mimeType].name||CodeMirror.mimeModes[mimeType]):CodeMirror.mimeModes['text/plain'];modeName+='+all-whitespaces';if(CodeMirror.modes[modeName])
return modeName;function modeConstructor(config,parserConfig){function nextToken(stream){if(stream.peek()===' '){let spaces=0;while(spaces<SourceFrame.SourcesTextEditor.MaximumNumberOfWhitespacesPerSingleSpan&&stream.peek()===' '){++spaces;stream.next();}
return'whitespace whitespace-'+spaces;}
while(!stream.eol()&&stream.peek()!==' ')
stream.next();return null;}
const whitespaceMode={token:nextToken};return CodeMirror.overlayMode(CodeMirror.getMode(config,mimeType),whitespaceMode,false);}
CodeMirror.defineMode(modeName,modeConstructor);return modeName;}
_trailingWhitespaceOverlayMode(mimeType){let modeName=CodeMirror.mimeModes[mimeType]?(CodeMirror.mimeModes[mimeType].name||CodeMirror.mimeModes[mimeType]):CodeMirror.mimeModes['text/plain'];modeName+='+trailing-whitespaces';if(CodeMirror.modes[modeName])
return modeName;function modeConstructor(config,parserConfig){function nextToken(stream){if(stream.match(/^\s+$/,true))
return true?'trailing-whitespace':null;do
stream.next();while(!stream.eol()&&stream.peek()!==' ');return null;}
const whitespaceMode={token:nextToken};return CodeMirror.overlayMode(CodeMirror.getMode(config,mimeType),whitespaceMode,false);}
CodeMirror.defineMode(modeName,modeConstructor);return modeName;}
_setupWhitespaceHighlight(){const doc=this.element.ownerDocument;if(doc._codeMirrorWhitespaceStyleInjected||!Common.moduleSetting('showWhitespacesInEditor').get())
return;doc._codeMirrorWhitespaceStyleInjected=true;const classBase='.show-whitespaces .CodeMirror .cm-whitespace-';const spaceChar='';let spaceChars='';let rules='';for(let i=1;i<=SourceFrame.SourcesTextEditor.MaximumNumberOfWhitespacesPerSingleSpan;++i){spaceChars+=spaceChar;const rule=classBase+i+'::before { content: \''+spaceChars+'\';}\n';rules+=rule;}
const style=doc.createElement('style');style.textContent=rules;doc.head.appendChild(style);}
configureAutocomplete(config){this._autocompleteConfig=config;this._updateAutocomplete();}
_updateAutocomplete(){super.configureAutocomplete(Common.moduleSetting('textEditorAutocompletion').get()?this._autocompleteConfig:null);}};SourceFrame.SourcesTextEditor.GutterClickEventData;SourceFrame.SourcesTextEditor.Events={GutterClick:Symbol('GutterClick'),SelectionChanged:Symbol('SelectionChanged'),ScrollChanged:Symbol('ScrollChanged'),EditorFocused:Symbol('EditorFocused'),EditorBlurred:Symbol('EditorBlurred'),JumpHappened:Symbol('JumpHappened')};SourceFrame.SourcesTextEditorDelegate=function(){};SourceFrame.SourcesTextEditorDelegate.prototype={populateLineGutterContextMenu(contextMenu,lineNumber){},populateTextAreaContextMenu(contextMenu,lineNumber,columnNumber){},};CodeMirror.commands.smartNewlineAndIndent=function(codeMirror){codeMirror.operation(innerSmartNewlineAndIndent.bind(null,codeMirror));function innerSmartNewlineAndIndent(codeMirror){const selections=codeMirror.listSelections();const replacements=[];for(let i=0;i<selections.length;++i){const selection=selections[i];const cur=CodeMirror.cmpPos(selection.head,selection.anchor)<0?selection.head:selection.anchor;const line=codeMirror.getLine(cur.line);const indent=TextUtils.TextUtils.lineIndent(line);replacements.push('\n'+indent.substring(0,Math.min(cur.ch,indent.length)));}
codeMirror.replaceSelections(replacements);codeMirror._codeMirrorTextEditor._onAutoAppendedSpaces();}};CodeMirror.commands.sourcesDismiss=function(codemirror){if(codemirror.listSelections().length===1&&codemirror._codeMirrorTextEditor._isSearchActive())
return CodeMirror.Pass;return CodeMirror.commands.dismiss(codemirror);};SourceFrame.SourcesTextEditor._BlockIndentController={name:'blockIndentKeymap',Enter:function(codeMirror){let selections=codeMirror.listSelections();const replacements=[];let allSelectionsAreCollapsedBlocks=false;for(let i=0;i<selections.length;++i){const selection=selections[i];const start=CodeMirror.cmpPos(selection.head,selection.anchor)<0?selection.head:selection.anchor;const line=codeMirror.getLine(start.line);const indent=TextUtils.TextUtils.lineIndent(line);let indentToInsert='\n'+indent+codeMirror._codeMirrorTextEditor.indent();let isCollapsedBlock=false;if(selection.head.ch===0)
return CodeMirror.Pass;if(line.substr(selection.head.ch-1,2)==='{}'){indentToInsert+='\n'+indent;isCollapsedBlock=true;}else if(line.substr(selection.head.ch-1,1)!=='{'){return CodeMirror.Pass;}
if(i>0&&allSelectionsAreCollapsedBlocks!==isCollapsedBlock)
return CodeMirror.Pass;replacements.push(indentToInsert);allSelectionsAreCollapsedBlocks=isCollapsedBlock;}
codeMirror.replaceSelections(replacements);if(!allSelectionsAreCollapsedBlocks){codeMirror._codeMirrorTextEditor._onAutoAppendedSpaces();return;}
selections=codeMirror.listSelections();const updatedSelections=[];for(let i=0;i<selections.length;++i){const selection=selections[i];const line=codeMirror.getLine(selection.head.line-1);const position=new CodeMirror.Pos(selection.head.line-1,line.length);updatedSelections.push({head:position,anchor:position});}
codeMirror.setSelections(updatedSelections);codeMirror._codeMirrorTextEditor._onAutoAppendedSpaces();},'\'}\'':function(codeMirror){if(codeMirror.somethingSelected())
return CodeMirror.Pass;let selections=codeMirror.listSelections();let replacements=[];for(let i=0;i<selections.length;++i){const selection=selections[i];const line=codeMirror.getLine(selection.head.line);if(line!==TextUtils.TextUtils.lineIndent(line))
return CodeMirror.Pass;replacements.push('}');}
codeMirror.replaceSelections(replacements);selections=codeMirror.listSelections();replacements=[];const updatedSelections=[];for(let i=0;i<selections.length;++i){const selection=selections[i];const matchingBracket=codeMirror.findMatchingBracket(selection.head);if(!matchingBracket||!matchingBracket.match)
return;updatedSelections.push({head:selection.head,anchor:new CodeMirror.Pos(selection.head.line,0)});const line=codeMirror.getLine(matchingBracket.to.line);const indent=TextUtils.TextUtils.lineIndent(line);replacements.push(indent+'}');}
codeMirror.setSelections(updatedSelections);codeMirror.replaceSelections(replacements);}};SourceFrame.SourcesTextEditor.TokenHighlighter=class{constructor(textEditor,codeMirror){this._textEditor=textEditor;this._codeMirror=codeMirror;}
highlightSearchResults(regex,range){const oldRegex=this._highlightRegex;this._highlightRegex=regex;this._highlightRange=range;if(this._searchResultMarker){this._searchResultMarker.clear();delete this._searchResultMarker;}
if(this._highlightDescriptor&&this._highlightDescriptor.selectionStart)
this._codeMirror.removeLineClass(this._highlightDescriptor.selectionStart.line,'wrap','cm-line-with-selection');const selectionStart=this._highlightRange?new CodeMirror.Pos(this._highlightRange.startLine,this._highlightRange.startColumn):null;if(selectionStart)
this._codeMirror.addLineClass(selectionStart.line,'wrap','cm-line-with-selection');if(oldRegex&&this._highlightRegex.toString()===oldRegex.toString()){if(this._highlightDescriptor)
this._highlightDescriptor.selectionStart=selectionStart;}else{this._removeHighlight();this._setHighlighter(this._searchHighlighter.bind(this,this._highlightRegex),selectionStart);}
if(this._highlightRange){const pos=TextEditor.CodeMirrorUtils.toPos(this._highlightRange);this._searchResultMarker=this._codeMirror.markText(pos.start,pos.end,{className:'cm-column-with-selection'});}}
highlightedRegex(){return this._highlightRegex;}
highlightSelectedTokens(){delete this._highlightRegex;delete this._highlightRange;if(this._highlightDescriptor&&this._highlightDescriptor.selectionStart)
this._codeMirror.removeLineClass(this._highlightDescriptor.selectionStart.line,'wrap','cm-line-with-selection');this._removeHighlight();const selectionStart=this._codeMirror.getCursor('start');const selectionEnd=this._codeMirror.getCursor('end');if(selectionStart.line!==selectionEnd.line)
return;if(selectionStart.ch===selectionEnd.ch)
return;const selections=this._codeMirror.getSelections();if(selections.length>1)
return;const selectedText=selections[0];if(this._isWord(selectedText,selectionStart.line,selectionStart.ch,selectionEnd.ch)){if(selectionStart)
this._codeMirror.addLineClass(selectionStart.line,'wrap','cm-line-with-selection');this._setHighlighter(this._tokenHighlighter.bind(this,selectedText,selectionStart),selectionStart);}}
_isWord(selectedText,lineNumber,startColumn,endColumn){const line=this._codeMirror.getLine(lineNumber);const leftBound=startColumn===0||!TextUtils.TextUtils.isWordChar(line.charAt(startColumn-1));const rightBound=endColumn===line.length||!TextUtils.TextUtils.isWordChar(line.charAt(endColumn));return leftBound&&rightBound&&TextUtils.TextUtils.isWord(selectedText);}
_removeHighlight(){if(this._highlightDescriptor){this._codeMirror.removeOverlay(this._highlightDescriptor.overlay);delete this._highlightDescriptor;}}
_searchHighlighter(regex,stream){if(stream.column()===0)
delete this._searchMatchLength;if(this._searchMatchLength){if(this._searchMatchLength>2){for(let i=0;i<this._searchMatchLength-2;++i)
stream.next();this._searchMatchLength=1;return'search-highlight';}else{stream.next();delete this._searchMatchLength;return'search-highlight search-highlight-end';}}
const match=stream.match(regex,false);if(match){stream.next();const matchLength=match[0].length;if(matchLength===1)
return'search-highlight search-highlight-full';this._searchMatchLength=matchLength;return'search-highlight search-highlight-start';}
while(!stream.match(regex,false)&&stream.next()){}}
_tokenHighlighter(token,selectionStart,stream){const tokenFirstChar=token.charAt(0);if(stream.match(token)&&(stream.eol()||!TextUtils.TextUtils.isWordChar(stream.peek())))
return stream.column()===selectionStart.ch?'token-highlight column-with-selection':'token-highlight';let eatenChar;do
eatenChar=stream.next();while(eatenChar&&(TextUtils.TextUtils.isWordChar(eatenChar)||stream.peek()!==tokenFirstChar));}
_setHighlighter(highlighter,selectionStart){const overlayMode={token:highlighter};this._codeMirror.addOverlay(overlayMode);this._highlightDescriptor={overlay:overlayMode,selectionStart:selectionStart};}};SourceFrame.SourcesTextEditor.LinesToScanForIndentationGuessing=1000;SourceFrame.SourcesTextEditor.MaximumNumberOfWhitespacesPerSingleSpan=16;;SourceFrame.FontView=class extends UI.SimpleView{constructor(mimeType,contentProvider){super(Common.UIString('Font'));this.registerRequiredCSS('source_frame/fontView.css');this.element.classList.add('font-view');this._url=contentProvider.contentURL();UI.ARIAUtils.setAccessibleName(this.element,ls`Preview of font from ${this._url}`);this._mimeType=mimeType;this._contentProvider=contentProvider;this._mimeTypeLabel=new UI.ToolbarText(mimeType);}
syncToolbarItems(){return[this._mimeTypeLabel];}
_onFontContentLoaded(uniqueFontName,content){const url=content?Common.ContentProvider.contentAsDataURL(content,this._mimeType,true):this._url;this.fontStyleElement.textContent=String.sprintf('@font-face { font-family: "%s"; src: url(%s); }',uniqueFontName,url);}
_createContentIfNeeded(){if(this.fontPreviewElement)
return;const uniqueFontName='WebInspectorFontPreview'+(++SourceFrame.FontView._fontId);this.fontStyleElement=createElement('style');this._contentProvider.requestContent().then(this._onFontContentLoaded.bind(this,uniqueFontName));this.element.appendChild(this.fontStyleElement);const fontPreview=createElement('div');for(let i=0;i<SourceFrame.FontView._fontPreviewLines.length;++i){if(i>0)
fontPreview.createChild('br');fontPreview.createTextChild(SourceFrame.FontView._fontPreviewLines[i]);}
this.fontPreviewElement=fontPreview.cloneNode(true);UI.ARIAUtils.markAsHidden(this.fontPreviewElement);this.fontPreviewElement.style.overflow='hidden';this.fontPreviewElement.style.setProperty('font-family',uniqueFontName);this.fontPreviewElement.style.setProperty('visibility','hidden');this._dummyElement=fontPreview;this._dummyElement.style.visibility='hidden';this._dummyElement.style.zIndex='-1';this._dummyElement.style.display='inline';this._dummyElement.style.position='absolute';this._dummyElement.style.setProperty('font-family',uniqueFontName);this._dummyElement.style.setProperty('font-size',SourceFrame.FontView._measureFontSize+'px');this.element.appendChild(this.fontPreviewElement);}
wasShown(){this._createContentIfNeeded();this.updateFontPreviewSize();}
onResize(){if(this._inResize)
return;this._inResize=true;try{this.updateFontPreviewSize();}finally{delete this._inResize;}}
_measureElement(){this.element.appendChild(this._dummyElement);const result={width:this._dummyElement.offsetWidth,height:this._dummyElement.offsetHeight};this.element.removeChild(this._dummyElement);return result;}
updateFontPreviewSize(){if(!this.fontPreviewElement||!this.isShowing())
return;this.fontPreviewElement.style.removeProperty('visibility');const dimension=this._measureElement();const height=dimension.height;const width=dimension.width;const containerWidth=this.element.offsetWidth-50;const containerHeight=this.element.offsetHeight-30;if(!height||!width||!containerWidth||!containerHeight){this.fontPreviewElement.style.removeProperty('font-size');return;}
const widthRatio=containerWidth/width;const heightRatio=containerHeight/height;const finalFontSize=Math.floor(SourceFrame.FontView._measureFontSize*Math.min(widthRatio,heightRatio))-2;this.fontPreviewElement.style.setProperty('font-size',finalFontSize+'px',null);}};SourceFrame.FontView._fontPreviewLines=['ABCDEFGHIJKLM','NOPQRSTUVWXYZ','abcdefghijklm','nopqrstuvwxyz','1234567890'];SourceFrame.FontView._fontId=0;SourceFrame.FontView._measureFontSize=50;;SourceFrame.ImageView=class extends UI.SimpleView{constructor(mimeType,contentProvider){super(Common.UIString('Image'));this.registerRequiredCSS('source_frame/imageView.css');this.element.tabIndex=0;this.element.classList.add('image-view');this._url=contentProvider.contentURL();this._parsedURL=new Common.ParsedURL(this._url);this._mimeType=mimeType;this._contentProvider=contentProvider;this._uiSourceCode=contentProvider instanceof Workspace.UISourceCode?(contentProvider):null;if(this._uiSourceCode){this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._workingCopyCommitted,this);new UI.DropTarget(this.element,[UI.DropTarget.Type.ImageFile,UI.DropTarget.Type.URI],Common.UIString('Drop image file here'),this._handleDrop.bind(this));}
this._sizeLabel=new UI.ToolbarText();this._dimensionsLabel=new UI.ToolbarText();this._mimeTypeLabel=new UI.ToolbarText(mimeType);this._container=this.element.createChild('div','image');this._imagePreviewElement=this._container.createChild('img','resource-image-view');this._imagePreviewElement.addEventListener('contextmenu',this._contextMenu.bind(this),true);this._imagePreviewElement.alt=ls`Image from ${this._url}`;}
syncToolbarItems(){return[this._sizeLabel,new UI.ToolbarSeparator(),this._dimensionsLabel,new UI.ToolbarSeparator(),this._mimeTypeLabel];}
wasShown(){this._updateContentIfNeeded();}
disposeView(){if(this._uiSourceCode){this._uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._workingCopyCommitted,this);}}
_workingCopyCommitted(){this._updateContentIfNeeded();}
async _updateContentIfNeeded(){const content=await this._contentProvider.requestContent();if(this._cachedContent===content)
return;const contentEncoded=await this._contentProvider.contentEncoded();this._cachedContent=content;let imageSrc=Common.ContentProvider.contentAsDataURL(content,this._mimeType,contentEncoded);if(content===null)
imageSrc=this._url;const loadPromise=new Promise(x=>this._imagePreviewElement.onload=x);this._imagePreviewElement.src=imageSrc;const size=content&&!contentEncoded?content.length:base64ToSize(content);this._sizeLabel.setText(Number.bytesToString(size));await loadPromise;this._dimensionsLabel.setText(Common.UIString('%d  %d',this._imagePreviewElement.naturalWidth,this._imagePreviewElement.naturalHeight));}
_contextMenu(event){const contextMenu=new UI.ContextMenu(event);if(!this._parsedURL.isDataURL())
contextMenu.clipboardSection().appendItem(Common.UIString('Copy image URL'),this._copyImageURL.bind(this));if(this._imagePreviewElement.src){contextMenu.clipboardSection().appendItem(Common.UIString('Copy image as data URI'),this._copyImageAsDataURL.bind(this));}
contextMenu.clipboardSection().appendItem(Common.UIString('Open image in new tab'),this._openInNewTab.bind(this));contextMenu.clipboardSection().appendItem(Common.UIString('Save\u2026'),this._saveImage.bind(this));contextMenu.show();}
_copyImageAsDataURL(){InspectorFrontendHost.copyText(this._imagePreviewElement.src);}
_copyImageURL(){InspectorFrontendHost.copyText(this._url);}
_saveImage(){const link=createElement('a');link.download=this._parsedURL.displayName;link.href=this._url;link.click();}
_openInNewTab(){InspectorFrontendHost.openInNewTab(this._url);}
async _handleDrop(dataTransfer){const items=dataTransfer.items;if(!items.length||items[0].kind!=='file')
return;const entry=items[0].webkitGetAsEntry();const encoded=!entry.name.endsWith('.svg');entry.file(file=>{const reader=new FileReader();reader.onloadend=()=>{let result;try{result=(reader.result);}catch(e){result=null;console.error('Can\'t read file: '+e);}
if(typeof result!=='string')
return;this._uiSourceCode.setContent(encoded?btoa(result):result,encoded);};if(encoded)
reader.readAsBinaryString(file);else
reader.readAsText(file);});}};;SourceFrame.SourceFrame=class extends UI.SimpleView{constructor(lazyContent,codeMirrorOptions){super(Common.UIString('Source'));this._lazyContent=lazyContent;this._pretty=false;this._rawContent=null;this._formattedContentPromise=null;this._formattedMap=null;this._prettyToggle=new UI.ToolbarToggle(ls`Pretty print`,'largeicon-pretty-print');this._prettyToggle.addEventListener(UI.ToolbarButton.Events.Click,()=>{this._setPretty(!this._prettyToggle.toggled());});this._shouldAutoPrettyPrint=false;this._prettyToggle.setVisible(false);this._textEditor=new SourceFrame.SourcesTextEditor(this,codeMirrorOptions);this._textEditor.show(this.element);this._prettyCleanGeneration=null;this._cleanGeneration=0;this._searchConfig=null;this._delayedFindSearchMatches=null;this._currentSearchResultIndex=-1;this._searchResults=[];this._searchRegex=null;this._textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.EditorFocused,this._resetCurrentSearchResultIndex,this);this._textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.SelectionChanged,this._updateSourcePosition,this);this._textEditor.addEventListener(UI.TextEditor.Events.TextChanged,event=>{if(!this._muteChangeEventsForSetContent)
this.onTextChanged(event.data.oldRange,event.data.newRange);});this._muteChangeEventsForSetContent=false;this._sourcePosition=new UI.ToolbarText();this._searchableView=null;this._editable=false;this._textEditor.setReadOnly(true);this._positionToReveal=null;this._lineToScrollTo=null;this._selectionToSet=null;this._loaded=false;this._contentRequested=false;this._highlighterType='';this._transformer={editorToRawLocation:(editorLineNumber,editorColumnNumber=0)=>{if(!this._pretty)
return[editorLineNumber,editorColumnNumber];return this._prettyToRawLocation(editorLineNumber,editorColumnNumber);},rawToEditorLocation:(lineNumber,columnNumber=0)=>{if(!this._pretty)
return[lineNumber,columnNumber];return this._rawToPrettyLocation(lineNumber,columnNumber);}};}
setCanPrettyPrint(canPrettyPrint,autoPrettyPrint){this._shouldAutoPrettyPrint=canPrettyPrint&&!!autoPrettyPrint;this._prettyToggle.setVisible(canPrettyPrint);}
async _setPretty(value){this._pretty=value;this._prettyToggle.setEnabled(false);const wasLoaded=this.loaded;const selection=this.selection();let newSelection;if(this._pretty){const formatInfo=await this._requestFormattedContent();this._formattedMap=formatInfo.map;this.setContent(formatInfo.content);this._prettyCleanGeneration=this._textEditor.markClean();const start=this._rawToPrettyLocation(selection.startLine,selection.startColumn);const end=this._rawToPrettyLocation(selection.endLine,selection.endColumn);newSelection=new TextUtils.TextRange(start[0],start[1],end[0],end[1]);}else{this.setContent(this._rawContent);this._cleanGeneration=this._textEditor.markClean();const start=this._prettyToRawLocation(selection.startLine,selection.startColumn);const end=this._prettyToRawLocation(selection.endLine,selection.endColumn);newSelection=new TextUtils.TextRange(start[0],start[1],end[0],end[1]);}
if(wasLoaded){this.textEditor.revealPosition(newSelection.endLine,newSelection.endColumn,this._editable);this.textEditor.setSelection(newSelection);}
this._prettyToggle.setEnabled(true);this._updatePrettyPrintState();}
_updatePrettyPrintState(){this._prettyToggle.setToggled(this._pretty);this._textEditor.element.classList.toggle('pretty-printed',this._pretty);if(this._pretty){this._textEditor.setLineNumberFormatter(lineNumber=>{const line=this._prettyToRawLocation(lineNumber-1,0)[0]+1;if(lineNumber===1)
return String(line);if(line!==this._prettyToRawLocation(lineNumber-2,0)[0]+1)
return String(line);return'-';});}else{this._textEditor.setLineNumberFormatter(lineNumber=>{return String(lineNumber);});}}
transformer(){return this._transformer;}
_prettyToRawLocation(line,column){if(!this._formattedMap)
return[line,column];return this._formattedMap.formattedToOriginal(line,column);}
_rawToPrettyLocation(line,column){if(!this._formattedMap)
return[line,column];return this._formattedMap.originalToFormatted(line,column);}
setEditable(editable){this._editable=editable;if(this._loaded)
this._textEditor.setReadOnly(!editable);}
wasShown(){this._ensureContentLoaded();this._wasShownOrLoaded();}
willHide(){super.willHide();this._clearPositionToReveal();}
syncToolbarItems(){return[this._prettyToggle,this._sourcePosition];}
get loaded(){return this._loaded;}
get textEditor(){return this._textEditor;}
get pretty(){return this._pretty;}
async _ensureContentLoaded(){if(!this._contentRequested){this._contentRequested=true;const content=await this._lazyContent();this._rawContent=content||'';this._formattedContentPromise=null;this._formattedMap=null;this._prettyToggle.setEnabled(true);if(this._shouldAutoPrettyPrint&&TextUtils.isMinified(content))
await this._setPretty(true);else
this.setContent(this._rawContent);}}
_requestFormattedContent(){if(this._formattedContentPromise)
return this._formattedContentPromise;let fulfill;this._formattedContentPromise=new Promise(x=>fulfill=x);new Formatter.ScriptFormatter(this._highlighterType,this._rawContent||'',(content,map)=>{fulfill({content,map});});return this._formattedContentPromise;}
revealPosition(line,column,shouldHighlight){this._lineToScrollTo=null;this._selectionToSet=null;this._positionToReveal={line:line,column:column,shouldHighlight:shouldHighlight};this._innerRevealPositionIfNeeded();}
_innerRevealPositionIfNeeded(){if(!this._positionToReveal)
return;if(!this.loaded||!this.isShowing())
return;const[line,column]=this._transformer.rawToEditorLocation(this._positionToReveal.line,this._positionToReveal.column);this._textEditor.revealPosition(line,column,this._positionToReveal.shouldHighlight);this._positionToReveal=null;}
_clearPositionToReveal(){this._textEditor.clearPositionHighlight();this._positionToReveal=null;}
scrollToLine(line){this._clearPositionToReveal();this._lineToScrollTo=line;this._innerScrollToLineIfNeeded();}
_innerScrollToLineIfNeeded(){if(this._lineToScrollTo!==null){if(this.loaded&&this.isShowing()){this._textEditor.scrollToLine(this._lineToScrollTo);this._lineToScrollTo=null;}}}
selection(){return this.textEditor.selection();}
setSelection(textRange){this._selectionToSet=textRange;this._innerSetSelectionIfNeeded();}
_innerSetSelectionIfNeeded(){if(this._selectionToSet&&this.loaded&&this.isShowing()){this._textEditor.setSelection(this._selectionToSet,true);this._selectionToSet=null;}}
_wasShownOrLoaded(){this._innerRevealPositionIfNeeded();this._innerSetSelectionIfNeeded();this._innerScrollToLineIfNeeded();}
onTextChanged(oldRange,newRange){const wasPretty=this.pretty;this._pretty=this._prettyCleanGeneration!==null&&this.textEditor.isClean(this._prettyCleanGeneration);if(this._pretty!==wasPretty)
this._updatePrettyPrintState();this._prettyToggle.setEnabled(this.isClean());if(this._searchConfig&&this._searchableView)
this.performSearch(this._searchConfig,false,false);}
isClean(){return this.textEditor.isClean(this._cleanGeneration)||(this._prettyCleanGeneration!==null&&this.textEditor.isClean(this._prettyCleanGeneration));}
contentCommitted(){this._cleanGeneration=this._textEditor.markClean();this._prettyCleanGeneration=null;this._rawContent=this.textEditor.text();this._formattedMap=null;this._formattedContentPromise=null;if(this._pretty){this._pretty=false;this._updatePrettyPrintState();}
this._prettyToggle.setEnabled(true);}
_simplifyMimeType(content,mimeType){if(!mimeType)
return'';if(mimeType.indexOf('javascript')>=0||mimeType.indexOf('jscript')>=0||mimeType.indexOf('ecmascript')>=0)
return'text/javascript';if(mimeType==='text/x-php'&&content.match(/\<\?.*\?\>/g))
return'application/x-httpd-php';return mimeType;}
setHighlighterType(highlighterType){this._highlighterType=highlighterType;this._updateHighlighterType('');}
highlighterType(){return this._highlighterType;}
_updateHighlighterType(content){this._textEditor.setMimeType(this._simplifyMimeType(content,this._highlighterType));}
setContent(content){this._muteChangeEventsForSetContent=true;if(!this._loaded){this._loaded=true;this._textEditor.setText(content||'');this._cleanGeneration=this._textEditor.markClean();this._textEditor.setReadOnly(!this._editable);}else{const scrollTop=this._textEditor.scrollTop();const selection=this._textEditor.selection();this._textEditor.setText(content||'');this._textEditor.setScrollTop(scrollTop);this._textEditor.setSelection(selection);}
this._updateHighlighterType(content||'');this._wasShownOrLoaded();if(this._delayedFindSearchMatches){this._delayedFindSearchMatches();this._delayedFindSearchMatches=null;}
this._muteChangeEventsForSetContent=false;}
setSearchableView(view){this._searchableView=view;}
_doFindSearchMatches(searchConfig,shouldJump,jumpBackwards){this._currentSearchResultIndex=-1;this._searchResults=[];const regex=searchConfig.toSearchRegex();this._searchRegex=regex;this._searchResults=this._collectRegexMatches(regex);if(this._searchableView)
this._searchableView.updateSearchMatchesCount(this._searchResults.length);if(!this._searchResults.length)
this._textEditor.cancelSearchResultsHighlight();else if(shouldJump&&jumpBackwards)
this.jumpToPreviousSearchResult();else if(shouldJump)
this.jumpToNextSearchResult();else
this._textEditor.highlightSearchResults(regex,null);}
performSearch(searchConfig,shouldJump,jumpBackwards){if(this._searchableView)
this._searchableView.updateSearchMatchesCount(0);this._resetSearch();this._searchConfig=searchConfig;if(this.loaded)
this._doFindSearchMatches(searchConfig,shouldJump,!!jumpBackwards);else
this._delayedFindSearchMatches=this._doFindSearchMatches.bind(this,searchConfig,shouldJump,!!jumpBackwards);this._ensureContentLoaded();}
_resetCurrentSearchResultIndex(){if(!this._searchResults.length)
return;this._currentSearchResultIndex=-1;if(this._searchableView)
this._searchableView.updateCurrentMatchIndex(this._currentSearchResultIndex);this._textEditor.highlightSearchResults((this._searchRegex),null);}
_resetSearch(){this._searchConfig=null;this._delayedFindSearchMatches=null;this._currentSearchResultIndex=-1;this._searchResults=[];this._searchRegex=null;}
searchCanceled(){const range=this._currentSearchResultIndex!==-1?this._searchResults[this._currentSearchResultIndex]:null;this._resetSearch();if(!this.loaded)
return;this._textEditor.cancelSearchResultsHighlight();if(range)
this.setSelection(range);}
jumpToLastSearchResult(){this.jumpToSearchResult(this._searchResults.length-1);}
_searchResultIndexForCurrentSelection(){return this._searchResults.lowerBound(this._textEditor.selection().collapseToEnd(),TextUtils.TextRange.comparator);}
jumpToNextSearchResult(){const currentIndex=this._searchResultIndexForCurrentSelection();const nextIndex=this._currentSearchResultIndex===-1?currentIndex:currentIndex+1;this.jumpToSearchResult(nextIndex);}
jumpToPreviousSearchResult(){const currentIndex=this._searchResultIndexForCurrentSelection();this.jumpToSearchResult(currentIndex-1);}
supportsCaseSensitiveSearch(){return true;}
supportsRegexSearch(){return true;}
jumpToSearchResult(index){if(!this.loaded||!this._searchResults.length)
return;this._currentSearchResultIndex=(index+this._searchResults.length)%this._searchResults.length;if(this._searchableView)
this._searchableView.updateCurrentMatchIndex(this._currentSearchResultIndex);this._textEditor.highlightSearchResults((this._searchRegex),this._searchResults[this._currentSearchResultIndex]);}
replaceSelectionWith(searchConfig,replacement){const range=this._searchResults[this._currentSearchResultIndex];if(!range)
return;this._textEditor.highlightSearchResults((this._searchRegex),null);const oldText=this._textEditor.text(range);const regex=searchConfig.toSearchRegex();let text;if(regex.__fromRegExpQuery){text=oldText.replace(regex,replacement);}else{text=oldText.replace(regex,function(){return replacement;});}
const newRange=this._textEditor.editRange(range,text);this._textEditor.setSelection(newRange.collapseToEnd());}
replaceAllWith(searchConfig,replacement){this._resetCurrentSearchResultIndex();let text=this._textEditor.text();const range=this._textEditor.fullRange();const regex=searchConfig.toSearchRegex(true);if(regex.__fromRegExpQuery){text=text.replace(regex,replacement);}else{text=text.replace(regex,function(){return replacement;});}
const ranges=this._collectRegexMatches(regex);if(!ranges.length)
return;const currentRangeIndex=ranges.lowerBound(this._textEditor.selection(),TextUtils.TextRange.comparator);const lastRangeIndex=mod(currentRangeIndex-1,ranges.length);const lastRange=ranges[lastRangeIndex];const replacementLineEndings=replacement.computeLineEndings();const replacementLineCount=replacementLineEndings.length;const lastLineNumber=lastRange.startLine+replacementLineEndings.length-1;let lastColumnNumber=lastRange.startColumn;if(replacementLineEndings.length>1){lastColumnNumber=replacementLineEndings[replacementLineCount-1]-replacementLineEndings[replacementLineCount-2]-1;}
this._textEditor.editRange(range,text);this._textEditor.revealPosition(lastLineNumber,lastColumnNumber);this._textEditor.setSelection(TextUtils.TextRange.createFromLocation(lastLineNumber,lastColumnNumber));}
_collectRegexMatches(regexObject){const ranges=[];for(let i=0;i<this._textEditor.linesCount;++i){let line=this._textEditor.line(i);let offset=0;let match;do{match=regexObject.exec(line);if(match){const matchEndIndex=match.index+Math.max(match[0].length,1);if(match[0].length)
ranges.push(new TextUtils.TextRange(i,offset+match.index,i,offset+matchEndIndex));offset+=matchEndIndex;line=line.substring(matchEndIndex);}}while(match&&line);}
return ranges;}
populateLineGutterContextMenu(contextMenu,editorLineNumber){return Promise.resolve();}
populateTextAreaContextMenu(contextMenu,editorLineNumber,editorColumnNumber){return Promise.resolve();}
canEditSource(){return this._editable;}
_updateSourcePosition(){const selections=this._textEditor.selections();if(!selections.length)
return;if(selections.length>1){this._sourcePosition.setText(Common.UIString('%d selection regions',selections.length));return;}
let textRange=selections[0];if(textRange.isEmpty()){const location=this._prettyToRawLocation(textRange.endLine,textRange.endColumn);this._sourcePosition.setText(ls`Line ${location[0] + 1}, Column ${location[1] + 1}`);return;}
textRange=textRange.normalize();const selectedText=this._textEditor.text(textRange);if(textRange.startLine===textRange.endLine){this._sourcePosition.setText(Common.UIString('%d characters selected',selectedText.length));}else{this._sourcePosition.setText(Common.UIString('%d lines, %d characters selected',textRange.endLine-textRange.startLine+1,selectedText.length));}}};SourceFrame.LineDecorator=function(){};SourceFrame.LineDecorator.prototype={decorate(uiSourceCode,textEditor,type){}};SourceFrame.Transformer;;SourceFrame.ResourceSourceFrame=class extends SourceFrame.SourceFrame{constructor(resource,autoPrettyPrint,codeMirrorOptions){super(async()=>{let content=await resource.requestContent();if(await resource.contentEncoded())
content=window.atob(content);return content;},codeMirrorOptions);this._resource=resource;this.setCanPrettyPrint(this._resource.contentType().isDocumentOrScriptOrStyleSheet(),autoPrettyPrint);}
static createSearchableView(resource,highlighterType,autoPrettyPrint){return new SourceFrame.ResourceSourceFrame.SearchableContainer(resource,highlighterType,autoPrettyPrint);}
get resource(){return this._resource;}
populateTextAreaContextMenu(contextMenu,lineNumber,columnNumber){contextMenu.appendApplicableItems(this._resource);return Promise.resolve();}};SourceFrame.ResourceSourceFrame.SearchableContainer=class extends UI.VBox{constructor(resource,highlighterType,autoPrettyPrint){super(true);this.registerRequiredCSS('source_frame/resourceSourceFrame.css');const sourceFrame=new SourceFrame.ResourceSourceFrame(resource,autoPrettyPrint);this._sourceFrame=sourceFrame;sourceFrame.setHighlighterType(highlighterType);const searchableView=new UI.SearchableView(sourceFrame);searchableView.element.classList.add('searchable-view');searchableView.setPlaceholder(ls`Find`);sourceFrame.show(searchableView.element);sourceFrame.setSearchableView(searchableView);searchableView.show(this.contentElement);const toolbar=new UI.Toolbar('toolbar',this.contentElement);for(const item of sourceFrame.syncToolbarItems())
toolbar.appendToolbarItem(item);}
async revealPosition(lineNumber,columnNumber){this._sourceFrame.revealPosition(lineNumber,columnNumber,true);}};;SourceFrame.JSONView=class extends UI.VBox{constructor(parsedJSON){super();this._initialized=false;this.registerRequiredCSS('source_frame/jsonView.css');this._parsedJSON=parsedJSON;this.element.classList.add('json-view');this._searchableView;this._treeOutline;this._currentSearchFocusIndex=0;this._currentSearchTreeElements=[];this._searchRegex=null;}
static async createView(content){const parsedJSON=await SourceFrame.JSONView._parseJSON(content);if(!parsedJSON||typeof parsedJSON.data!=='object')
return null;const jsonView=new SourceFrame.JSONView(parsedJSON);const searchableView=new UI.SearchableView(jsonView);searchableView.setPlaceholder(Common.UIString('Find'));jsonView._searchableView=searchableView;jsonView.show(searchableView.element);return searchableView;}
static createViewSync(obj){const jsonView=new SourceFrame.JSONView(new SourceFrame.ParsedJSON(obj,'',''));const searchableView=new UI.SearchableView(jsonView);searchableView.setPlaceholder(Common.UIString('Find'));jsonView._searchableView=searchableView;jsonView.show(searchableView.element);jsonView.element.setAttribute('tabIndex',0);return searchableView;}
static _parseJSON(text){let returnObj=null;if(text)
returnObj=SourceFrame.JSONView._extractJSON((text));if(!returnObj)
return Promise.resolve((null));return Formatter.formatterWorkerPool().parseJSONRelaxed(returnObj.data).then(handleReturnedJSON);function handleReturnedJSON(data){if(!data)
return null;returnObj.data=data;return returnObj;}}
static _extractJSON(text){if(text.startsWith('<'))
return null;let inner=SourceFrame.JSONView._findBrackets(text,'{','}');const inner2=SourceFrame.JSONView._findBrackets(text,'[',']');inner=inner2.length>inner.length?inner2:inner;if(inner.length===-1||text.length-inner.length>80)
return null;const prefix=text.substring(0,inner.start);const suffix=text.substring(inner.end+1);text=text.substring(inner.start,inner.end+1);if(suffix.trim().length&&!(suffix.trim().startsWith(')')&&prefix.trim().endsWith('(')))
return null;return new SourceFrame.ParsedJSON(text,prefix,suffix);}
static _findBrackets(text,open,close){const start=text.indexOf(open);const end=text.lastIndexOf(close);let length=end-start-1;if(start===-1||end===-1||end<start)
length=-1;return{start:start,end:end,length:length};}
wasShown(){this._initialize();}
_initialize(){if(this._initialized)
return;this._initialized=true;const obj=SDK.RemoteObject.fromLocalObject(this._parsedJSON.data);const title=this._parsedJSON.prefix+obj.description+this._parsedJSON.suffix;this._treeOutline=new ObjectUI.ObjectPropertiesSection(obj,title,undefined,undefined,undefined,undefined,true);this._treeOutline.enableContextMenu();this._treeOutline.setEditable(false);this._treeOutline.expand();this.element.appendChild(this._treeOutline.element);this._treeOutline.firstChild().select(true,false);}
_jumpToMatch(index){if(!this._searchRegex)
return;const previousFocusElement=this._currentSearchTreeElements[this._currentSearchFocusIndex];if(previousFocusElement)
previousFocusElement.setSearchRegex(this._searchRegex);const newFocusElement=this._currentSearchTreeElements[index];if(newFocusElement){this._updateSearchIndex(index);newFocusElement.setSearchRegex(this._searchRegex,UI.highlightedCurrentSearchResultClassName);newFocusElement.reveal();}else{this._updateSearchIndex(0);}}
_updateSearchCount(count){if(!this._searchableView)
return;this._searchableView.updateSearchMatchesCount(count);}
_updateSearchIndex(index){this._currentSearchFocusIndex=index;if(!this._searchableView)
return;this._searchableView.updateCurrentMatchIndex(index);}
searchCanceled(){this._searchRegex=null;this._currentSearchTreeElements=[];for(let element=this._treeOutline.rootElement();element;element=element.traverseNextTreeElement(false)){if(!(element instanceof ObjectUI.ObjectPropertyTreeElement))
continue;element.revertHighlightChanges();}
this._updateSearchCount(0);this._updateSearchIndex(0);}
performSearch(searchConfig,shouldJump,jumpBackwards){let newIndex=this._currentSearchFocusIndex;const previousSearchFocusElement=this._currentSearchTreeElements[newIndex];this.searchCanceled();this._searchRegex=searchConfig.toSearchRegex(true);for(let element=this._treeOutline.rootElement();element;element=element.traverseNextTreeElement(false)){if(!(element instanceof ObjectUI.ObjectPropertyTreeElement))
continue;const hasMatch=element.setSearchRegex(this._searchRegex);if(hasMatch)
this._currentSearchTreeElements.push(element);if(previousSearchFocusElement===element){const currentIndex=this._currentSearchTreeElements.length-1;if(hasMatch||jumpBackwards)
newIndex=currentIndex;else
newIndex=currentIndex+1;}}
this._updateSearchCount(this._currentSearchTreeElements.length);if(!this._currentSearchTreeElements.length){this._updateSearchIndex(0);return;}
newIndex=mod(newIndex,this._currentSearchTreeElements.length);this._jumpToMatch(newIndex);}
jumpToNextSearchResult(){if(!this._currentSearchTreeElements.length)
return;const newIndex=mod(this._currentSearchFocusIndex+1,this._currentSearchTreeElements.length);this._jumpToMatch(newIndex);}
jumpToPreviousSearchResult(){if(!this._currentSearchTreeElements.length)
return;const newIndex=mod(this._currentSearchFocusIndex-1,this._currentSearchTreeElements.length);this._jumpToMatch(newIndex);}
supportsCaseSensitiveSearch(){return true;}
supportsRegexSearch(){return true;}};SourceFrame.ParsedJSON=class{constructor(data,prefix,suffix){this.data=data;this.prefix=prefix;this.suffix=suffix;}};;SourceFrame.XMLView=class extends UI.Widget{constructor(parsedXML){super(true);this.registerRequiredCSS('source_frame/xmlView.css');this.contentElement.classList.add('shadow-xml-view','source-code');this._treeOutline=new UI.TreeOutlineInShadow();this._treeOutline.registerRequiredCSS('source_frame/xmlTree.css');this.contentElement.appendChild(this._treeOutline.element);this._searchableView;this._currentSearchFocusIndex=0;this._currentSearchTreeElements=[];this._searchConfig;SourceFrame.XMLView.Node.populate(this._treeOutline,parsedXML,this);this._treeOutline.firstChild().select(true,false);}
static createSearchableView(parsedXML){const xmlView=new SourceFrame.XMLView(parsedXML);const searchableView=new UI.SearchableView(xmlView);searchableView.setPlaceholder(Common.UIString('Find'));xmlView._searchableView=searchableView;xmlView.show(searchableView.element);return searchableView;}
static parseXML(text,mimeType){let parsedXML;try{parsedXML=(new DOMParser()).parseFromString(text,mimeType);}catch(e){return null;}
if(parsedXML.body)
return null;return parsedXML;}
_jumpToMatch(index,shouldJump){if(!this._searchConfig)
return;const regex=this._searchConfig.toSearchRegex(true);const previousFocusElement=this._currentSearchTreeElements[this._currentSearchFocusIndex];if(previousFocusElement)
previousFocusElement.setSearchRegex(regex);const newFocusElement=this._currentSearchTreeElements[index];if(newFocusElement){this._updateSearchIndex(index);if(shouldJump)
newFocusElement.reveal(true);newFocusElement.setSearchRegex(regex,UI.highlightedCurrentSearchResultClassName);}else{this._updateSearchIndex(0);}}
_updateSearchCount(count){if(!this._searchableView)
return;this._searchableView.updateSearchMatchesCount(count);}
_updateSearchIndex(index){this._currentSearchFocusIndex=index;if(!this._searchableView)
return;this._searchableView.updateCurrentMatchIndex(index);}
_innerPerformSearch(shouldJump,jumpBackwards){if(!this._searchConfig)
return;let newIndex=this._currentSearchFocusIndex;const previousSearchFocusElement=this._currentSearchTreeElements[newIndex];this._innerSearchCanceled();this._currentSearchTreeElements=[];const regex=this._searchConfig.toSearchRegex(true);for(let element=this._treeOutline.rootElement();element;element=element.traverseNextTreeElement(false)){if(!(element instanceof SourceFrame.XMLView.Node))
continue;const hasMatch=element.setSearchRegex(regex);if(hasMatch)
this._currentSearchTreeElements.push(element);if(previousSearchFocusElement===element){const currentIndex=this._currentSearchTreeElements.length-1;if(hasMatch||jumpBackwards)
newIndex=currentIndex;else
newIndex=currentIndex+1;}}
this._updateSearchCount(this._currentSearchTreeElements.length);if(!this._currentSearchTreeElements.length){this._updateSearchIndex(0);return;}
newIndex=mod(newIndex,this._currentSearchTreeElements.length);this._jumpToMatch(newIndex,shouldJump);}
_innerSearchCanceled(){for(let element=this._treeOutline.rootElement();element;element=element.traverseNextTreeElement(false)){if(!(element instanceof SourceFrame.XMLView.Node))
continue;element.revertHighlightChanges();}
this._updateSearchCount(0);this._updateSearchIndex(0);}
searchCanceled(){this._searchConfig=null;this._currentSearchTreeElements=[];this._innerSearchCanceled();}
performSearch(searchConfig,shouldJump,jumpBackwards){this._searchConfig=searchConfig;this._innerPerformSearch(shouldJump,jumpBackwards);}
jumpToNextSearchResult(){if(!this._currentSearchTreeElements.length)
return;const newIndex=mod(this._currentSearchFocusIndex+1,this._currentSearchTreeElements.length);this._jumpToMatch(newIndex,true);}
jumpToPreviousSearchResult(){if(!this._currentSearchTreeElements.length)
return;const newIndex=mod(this._currentSearchFocusIndex-1,this._currentSearchTreeElements.length);this._jumpToMatch(newIndex,true);}
supportsCaseSensitiveSearch(){return true;}
supportsRegexSearch(){return true;}};SourceFrame.XMLView.Node=class extends UI.TreeElement{constructor(node,closeTag,xmlView){super('',!closeTag&&!!node.childElementCount);this._node=node;this._closeTag=closeTag;this.selectable=true;this._highlightChanges=[];this._xmlView=xmlView;this._updateTitle();}
static populate(root,xmlNode,xmlView){let node=xmlNode.firstChild;while(node){const currentNode=node;node=node.nextSibling;const nodeType=currentNode.nodeType;if(nodeType===3&&currentNode.nodeValue.match(/\s+/))
continue;if((nodeType!==1)&&(nodeType!==3)&&(nodeType!==4)&&(nodeType!==7)&&(nodeType!==8))
continue;root.appendChild(new SourceFrame.XMLView.Node(currentNode,false,xmlView));}}
setSearchRegex(regex,additionalCssClassName){this.revertHighlightChanges();if(!regex)
return false;if(this._closeTag&&this.parent&&!this.parent.expanded)
return false;regex.lastIndex=0;let cssClasses=UI.highlightedSearchResultClassName;if(additionalCssClassName)
cssClasses+=' '+additionalCssClassName;const content=this.listItemElement.textContent.replace(/\xA0/g,' ');let match=regex.exec(content);const ranges=[];while(match){ranges.push(new TextUtils.SourceRange(match.index,match[0].length));match=regex.exec(content);}
if(ranges.length)
UI.highlightRangesWithStyleClass(this.listItemElement,ranges,cssClasses,this._highlightChanges);return!!this._highlightChanges.length;}
revertHighlightChanges(){UI.revertDomChanges(this._highlightChanges);this._highlightChanges=[];}
_updateTitle(){const node=this._node;switch(node.nodeType){case 1:const tag=node.tagName;if(this._closeTag){this._setTitle(['</'+tag+'>','shadow-xml-view-tag']);return;}
const titleItems=['<'+tag,'shadow-xml-view-tag'];const attributes=node.attributes;for(let i=0;i<attributes.length;++i){const attributeNode=attributes.item(i);titleItems.push('\u00a0','shadow-xml-view-tag',attributeNode.name,'shadow-xml-view-attribute-name','="','shadow-xml-view-tag',attributeNode.value,'shadow-xml-view-attribute-value','"','shadow-xml-view-tag');}
if(!this.expanded){if(node.childElementCount){titleItems.push('>','shadow-xml-view-tag','\u2026','shadow-xml-view-comment','</'+tag,'shadow-xml-view-tag');}else if(this._node.textContent){titleItems.push('>','shadow-xml-view-tag',node.textContent,'shadow-xml-view-text','</'+tag,'shadow-xml-view-tag');}else{titleItems.push(' /','shadow-xml-view-tag');}}
titleItems.push('>','shadow-xml-view-tag');this._setTitle(titleItems);return;case 3:this._setTitle([node.nodeValue,'shadow-xml-view-text']);return;case 4:this._setTitle(['<![CDATA[','shadow-xml-view-cdata',node.nodeValue,'shadow-xml-view-text',']]>','shadow-xml-view-cdata']);return;case 7:this._setTitle(['<?'+node.nodeName+' '+node.nodeValue+'?>','shadow-xml-view-processing-instruction']);return;case 8:this._setTitle(['<!--'+node.nodeValue+'-->','shadow-xml-view-comment']);return;}}
_setTitle(items){const titleFragment=createDocumentFragment();for(let i=0;i<items.length;i+=2)
titleFragment.createChild('span',items[i+1]).textContent=items[i];this.title=titleFragment;this._xmlView._innerPerformSearch(false,false);}
onattach(){this.listItemElement.classList.toggle('shadow-xml-view-close-tag',this._closeTag);}
onexpand(){this._updateTitle();}
oncollapse(){this._updateTitle();}
async onpopulate(){SourceFrame.XMLView.Node.populate(this,this._node,this._xmlView);this.appendChild(new SourceFrame.XMLView.Node(this._node,true,this._xmlView));}};;SourceFrame.PreviewFactory=class{static async createPreview(provider,mimeType){let resourceType=Common.ResourceType.fromMimeType(mimeType);if(resourceType===Common.resourceTypes.Other)
resourceType=provider.contentType();switch(resourceType){case Common.resourceTypes.Image:return new SourceFrame.ImageView(mimeType,provider);case Common.resourceTypes.Font:return new SourceFrame.FontView(mimeType,provider);}
let content=await provider.requestContent();if(!content)
return new UI.EmptyWidget(Common.UIString('Nothing to preview'));if(await provider.contentEncoded())
content=window.atob(content);const parsedXML=SourceFrame.XMLView.parseXML(content,mimeType);if(parsedXML)
return SourceFrame.XMLView.createSearchableView(parsedXML);const jsonView=await SourceFrame.JSONView.createView(content);if(jsonView)
return jsonView;if(resourceType.isTextType()){const highlighterType=provider.contentType().canonicalMimeType()||mimeType.replace(/;.*/,'');return SourceFrame.ResourceSourceFrame.createSearchableView(provider,highlighterType,true);}
return null;}};;SourceFrame.SourceCodeDiff=class{constructor(textEditor){this._textEditor=textEditor;this._animatedLines=[];this._animationTimeout=null;}
highlightModifiedLines(oldContent,newContent){if(typeof oldContent!=='string'||typeof newContent!=='string')
return;const diff=SourceFrame.SourceCodeDiff.computeDiff(Diff.Diff.lineDiff(oldContent.split('\n'),newContent.split('\n')));const changedLines=[];for(let i=0;i<diff.length;++i){const diffEntry=diff[i];if(diffEntry.type===SourceFrame.SourceCodeDiff.EditType.Delete)
continue;for(let lineNumber=diffEntry.from;lineNumber<diffEntry.to;++lineNumber){const position=this._textEditor.textEditorPositionHandle(lineNumber,0);if(position)
changedLines.push(position);}}
this._updateHighlightedLines(changedLines);this._animationTimeout=setTimeout(this._updateHighlightedLines.bind(this,[]),400);}
_updateHighlightedLines(newLines){if(this._animationTimeout)
clearTimeout(this._animationTimeout);this._animationTimeout=null;this._textEditor.operation(operation.bind(this));function operation(){toggleLines.call(this,false);this._animatedLines=newLines;toggleLines.call(this,true);}
function toggleLines(value){for(let i=0;i<this._animatedLines.length;++i){const location=this._animatedLines[i].resolve();if(location)
this._textEditor.toggleLineClass(location.lineNumber,'highlight-line-modification',value);}}}
static computeDiff(diff){const result=[];let hasAdded=false;let hasRemoved=false;let blockStartLineNumber=0;let currentLineNumber=0;let isInsideBlock=false;for(let i=0;i<diff.length;++i){const token=diff[i];if(token[0]===Diff.Diff.Operation.Equal){if(isInsideBlock)
flush();currentLineNumber+=token[1].length;continue;}
if(!isInsideBlock){isInsideBlock=true;blockStartLineNumber=currentLineNumber;}
if(token[0]===Diff.Diff.Operation.Delete){hasRemoved=true;}else{currentLineNumber+=token[1].length;hasAdded=true;}}
if(isInsideBlock)
flush();if(result.length>1&&result[0].from===0&&result[1].from===0){const merged={type:SourceFrame.SourceCodeDiff.EditType.Modify,from:0,to:result[1].to};result.splice(0,2,merged);}
return result;function flush(){let type=SourceFrame.SourceCodeDiff.EditType.Insert;let from=blockStartLineNumber;let to=currentLineNumber;if(hasAdded&&hasRemoved){type=SourceFrame.SourceCodeDiff.EditType.Modify;}else if(!hasAdded&&hasRemoved&&from===0&&to===0){type=SourceFrame.SourceCodeDiff.EditType.Modify;to=1;}else if(!hasAdded&&hasRemoved){type=SourceFrame.SourceCodeDiff.EditType.Delete;from-=1;}
result.push({type:type,from:from,to:to});isInsideBlock=false;hasAdded=false;hasRemoved=false;}}};SourceFrame.SourceCodeDiff.EditType={Insert:Symbol('Insert'),Delete:Symbol('Delete'),Modify:Symbol('Modify'),};;Runtime.cachedResources["source_frame/fontView.css"]="/*\n * Copyright (c) 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.font-view {\n    font-size: 60px;\n    white-space: pre-wrap;\n    word-wrap: break-word;\n    text-align: center;\n    padding: 15px;\n}\n\n/*# sourceURL=source_frame/fontView.css */";Runtime.cachedResources["source_frame/imageView.css"]="/*\n * Copyright (c) 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.image-view {\n    overflow: auto;\n}\n\n.image-view > .image {\n    padding: 20px 20px 10px 20px;\n    text-align: center;\n}\n\n.image-view img.resource-image-view {\n    max-width: 100%;\n    max-height: 1000px;\n    background-image: url(Images/checker.png);\n    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.5);\n    -webkit-user-select: text;\n    -webkit-user-drag: auto;\n}\n\n/*# sourceURL=source_frame/imageView.css */";Runtime.cachedResources["source_frame/jsonView.css"]=".json-view {\n    padding: 2px 6px;\n    overflow: auto;\n}\n\n/*# sourceURL=source_frame/jsonView.css */";Runtime.cachedResources["source_frame/messagesPopover.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.text-editor-messages-description-container {\n    display: inline-block;\n}\n\n.text-editor-row-message:first-child {\n    border-top-width: 0;\n}\n\n.text-editor-row-message {\n    line-height: 1.2;\n    white-space: nowrap;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    margin-top: 2px;\n}\n\n.text-editor-row-message-repeat-count {\n    margin-right: 0.5em;\n}\n\n/*# sourceURL=source_frame/messagesPopover.css */";Runtime.cachedResources["source_frame/xmlTree.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.tree-outline ol {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    padding-inline-start: 16px;\n}\n\nol.tree-outline {\n    padding-inline-start: 0;\n}\n\n.tree-outline li {\n    min-height: 12px;\n}\n\n.tree-outline li.shadow-xml-view-close-tag {\n    margin-left: -16px;\n}\n\n.shadow-xml-view-tag {\n    color: rgb(136, 18, 128);\n}\n\n.shadow-xml-view-comment {\n    color: rgb(35, 110, 37);\n}\n\n.shadow-xml-view-processing-instruction {\n    color: rgb(35, 110, 37);\n}\n\n.shadow-xml-view-attribute-name {\n    color: rgb(153, 69, 0);\n}\n\n.shadow-xml-view-attribute-value {\n    color: rgb(26, 26, 166);\n}\n\n.shadow-xml-view-text {\n    color: rgb(0, 0, 0);\n    white-space: pre;\n}\n\n.shadow-xml-view-cdata {\n    color: rgb(0, 0, 0);\n}\n\n/*# sourceURL=source_frame/xmlTree.css */";Runtime.cachedResources["source_frame/xmlView.css"]="/*\n * Copyright (c) 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.shadow-xml-view {\n    -webkit-user-select: text;\n    overflow: auto;\n    padding: 2px 4px;\n}\n\n/*# sourceURL=source_frame/xmlView.css */";Runtime.cachedResources["source_frame/resourceSourceFrame.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n.searchable-view {\n  flex: 1;\n}\n\n.toolbar {\n  background-color: #eee;\n  border-top: 1px solid #ccc;\n}\n\n/*# sourceURL=source_frame/resourceSourceFrame.css */";Sources.AddSourceMapURLDialog=class extends UI.HBox{constructor(callback){super(true);this.registerRequiredCSS('sources/dialog.css');this.contentElement.createChild('label').textContent=Common.UIString('Source map URL: ');this._input=UI.createInput('add-source-map');this.contentElement.appendChild(this._input);this._input.setAttribute('type','text');this._input.addEventListener('keydown',this._onKeyDown.bind(this),false);const addButton=UI.createTextButton(ls`Add`,this._apply.bind(this));this.contentElement.appendChild(addButton);this.setDefaultFocusedElement(this._input);this._callback=callback;}
static show(callback){const dialog=new UI.Dialog();dialog.setDefaultFocusedElement(this._input);const addSourceMapURLDialog=new Sources.AddSourceMapURLDialog(done);addSourceMapURLDialog.show(dialog.contentElement);dialog.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);dialog.show();function done(value){dialog.hide();callback(value);}}
_apply(){this._callback(this._input.value);}
_onKeyDown(event){if(event.keyCode===UI.KeyboardShortcut.Keys.Enter.code){event.preventDefault();this._apply();}}};;Sources.BreakpointEditDialog=class extends UI.Widget{constructor(editorLineNumber,oldCondition,preferLogpoint,onFinish){super(true);this.registerRequiredCSS('sources/breakpointEditDialog.css');this._onFinish=onFinish;this._finished=false;this._editor=null;this.element.tabIndex=-1;const logpointPrefix=Sources.BreakpointEditDialog.LogpointPrefix;const logpointSuffix=Sources.BreakpointEditDialog._LogpointSuffix;this._isLogpoint=oldCondition.startsWith(logpointPrefix)&&oldCondition.endsWith(logpointSuffix);if(this._isLogpoint)
oldCondition=oldCondition.substring(logpointPrefix.length,oldCondition.length-logpointSuffix.length);this._isLogpoint=this._isLogpoint||preferLogpoint;this.element.classList.add('sources-edit-breakpoint-dialog');const toolbar=new UI.Toolbar('source-frame-breakpoint-toolbar',this.contentElement);toolbar.appendText(`Line ${editorLineNumber + 1}:`);this._typeSelector=new UI.ToolbarComboBox(this._onTypeChanged.bind(this));this._typeSelector.createOption(ls`Breakpoint`,'',Sources.BreakpointEditDialog.BreakpointType.Breakpoint);const conditionalOption=this._typeSelector.createOption(ls`Conditional breakpoint`,'',Sources.BreakpointEditDialog.BreakpointType.Conditional);const logpointOption=this._typeSelector.createOption(ls`Logpoint`,'',Sources.BreakpointEditDialog.BreakpointType.Logpoint);this._typeSelector.select(this._isLogpoint?logpointOption:conditionalOption);toolbar.appendToolbarItem(this._typeSelector);self.runtime.extension(UI.TextEditorFactory).instance().then(factory=>{const editorOptions={lineNumbers:false,lineWrapping:true,mimeType:'javascript',autoHeight:true};this._editor=factory.createEditor(editorOptions);this._updatePlaceholder();this._editor.widget().element.classList.add('condition-editor');this._editor.configureAutocomplete(ObjectUI.JavaScriptAutocompleteConfig.createConfigForEditor(this._editor));if(oldCondition)
this._editor.setText(oldCondition);this._editor.widget().show(this.contentElement);this._editor.setSelection(this._editor.fullRange());this._editor.widget().focus();this._editor.widget().element.addEventListener('keydown',this._onKeyDown.bind(this),true);this.contentElement.addEventListener('blur',event=>{if(event.relatedTarget&&!event.relatedTarget.isSelfOrDescendant(this.element))
this._finishEditing(true);},true);});}
static _conditionForLogpoint(condition){return`${Sources.BreakpointEditDialog.LogpointPrefix}${condition}${Sources.BreakpointEditDialog._LogpointSuffix}`;}
_onTypeChanged(){const value=this._typeSelector.selectedOption().value;this._isLogpoint=value===Sources.BreakpointEditDialog.BreakpointType.Logpoint;this._updatePlaceholder();if(value===Sources.BreakpointEditDialog.BreakpointType.Breakpoint){this._editor.setText('');this._finishEditing(true);}}
_updatePlaceholder(){const selectedValue=this._typeSelector.selectedOption().value;if(selectedValue===Sources.BreakpointEditDialog.BreakpointType.Conditional){this._editor.setPlaceholder(ls`Expression to check before pausing, e.g. x > 5`);this._typeSelector.element.title=ls`Pause only when the condition is true`;}else if(selectedValue===Sources.BreakpointEditDialog.BreakpointType.Logpoint){this._editor.setPlaceholder(ls`Log message, e.g. 'x is', x`);this._typeSelector.element.title=ls`Log a message to Console, do not break`;}}
_finishEditing(committed){if(this._finished)
return;this._finished=true;this._editor.widget().detach();let condition=this._editor.text();if(this._isLogpoint)
condition=Sources.BreakpointEditDialog._conditionForLogpoint(condition);this._onFinish({committed,condition});}
async _onKeyDown(event){if(isEnterKey(event)&&!event.shiftKey){event.consume(true);const expression=this._editor.text();if(event.ctrlKey||await ObjectUI.JavaScriptAutocomplete.isExpressionComplete(expression))
this._finishEditing(true);else
this._editor.newlineAndIndent();}
if(isEscKey(event))
this._finishEditing(false);}};Sources.BreakpointEditDialog.LogpointPrefix='/** DEVTOOLS_LOGPOINT */ console.log(';Sources.BreakpointEditDialog._LogpointSuffix=')';Sources.BreakpointEditDialog.BreakpointType={Breakpoint:'Breakpoint',Conditional:'Conditional',Logpoint:'Logpoint',};;Sources.CallStackSidebarPane=class extends UI.SimpleView{constructor(){super(Common.UIString('Call Stack'),true);this.registerRequiredCSS('sources/callStackSidebarPane.css');this._blackboxedMessageElement=this._createBlackboxedMessageElement();this.contentElement.appendChild(this._blackboxedMessageElement);this._notPausedMessageElement=this.contentElement.createChild('div','gray-info-message');this._notPausedMessageElement.textContent=Common.UIString('Not paused');this._notPausedMessageElement.tabIndex=-1;this._items=new UI.ListModel();this._list=new UI.ListControl(this._items,this,UI.ListMode.NonViewport);this.contentElement.appendChild(this._list.element);this._list.element.addEventListener('contextmenu',this._onContextMenu.bind(this),false);onInvokeElement(this._list.element,event=>{const item=this._list.itemForNode((event.target));if(item){this._activateItem(item);event.consume(true);}});this._showMoreMessageElement=this._createShowMoreMessageElement();this._showMoreMessageElement.classList.add('hidden');this.contentElement.appendChild(this._showMoreMessageElement);this._showBlackboxed=false;this._locationPool=new Bindings.LiveLocationPool();this._updateThrottler=new Common.Throttler(100);this._maxAsyncStackChainDepth=Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth;this._update();this._updateItemThrottler=new Common.Throttler(100);this._scheduledForUpdateItems=new Set();}
flavorChanged(object){this._showBlackboxed=false;this._maxAsyncStackChainDepth=Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth;this._update();}
_update(){this._updateThrottler.schedule(()=>this._doUpdate());}
async _doUpdate(){this._locationPool.disposeAll();const details=UI.context.flavor(SDK.DebuggerPausedDetails);if(!details){this.setDefaultFocusedElement(this._notPausedMessageElement);this._notPausedMessageElement.classList.remove('hidden');this._blackboxedMessageElement.classList.add('hidden');this._showMoreMessageElement.classList.add('hidden');this._items.replaceAll([]);UI.context.setFlavor(SDK.DebuggerModel.CallFrame,null);return;}
let debuggerModel=details.debuggerModel;this._notPausedMessageElement.classList.add('hidden');const items=details.callFrames.map(frame=>{const item=Sources.CallStackSidebarPane.Item.createForDebuggerCallFrame(frame,this._locationPool,this._refreshItem.bind(this));item[Sources.CallStackSidebarPane._debuggerCallFrameSymbol]=frame;return item;});let asyncStackTrace=details.asyncStackTrace;if(!asyncStackTrace&&details.asyncStackTraceId){if(details.asyncStackTraceId.debuggerId)
debuggerModel=SDK.DebuggerModel.modelForDebuggerId(details.asyncStackTraceId.debuggerId);asyncStackTrace=debuggerModel?await debuggerModel.fetchAsyncStackTrace(details.asyncStackTraceId):null;}
let peviousStackTrace=details.callFrames;let maxAsyncStackChainDepth=this._maxAsyncStackChainDepth;while(asyncStackTrace&&maxAsyncStackChainDepth>0){let title='';const isAwait=asyncStackTrace.description==='async function';if(isAwait&&peviousStackTrace.length&&asyncStackTrace.callFrames.length){const lastPreviousFrame=peviousStackTrace[peviousStackTrace.length-1];const lastPreviousFrameName=UI.beautifyFunctionName(lastPreviousFrame.functionName);title=UI.asyncStackTraceLabel('await in '+lastPreviousFrameName);}else{title=UI.asyncStackTraceLabel(asyncStackTrace.description);}
items.push(...Sources.CallStackSidebarPane.Item.createItemsForAsyncStack(title,debuggerModel,asyncStackTrace.callFrames,this._locationPool,this._refreshItem.bind(this)));--maxAsyncStackChainDepth;peviousStackTrace=asyncStackTrace.callFrames;if(asyncStackTrace.parent){asyncStackTrace=asyncStackTrace.parent;}else if(asyncStackTrace.parentId){if(asyncStackTrace.parentId.debuggerId)
debuggerModel=SDK.DebuggerModel.modelForDebuggerId(asyncStackTrace.parentId.debuggerId);asyncStackTrace=debuggerModel?await debuggerModel.fetchAsyncStackTrace(asyncStackTrace.parentId):null;}else{asyncStackTrace=null;}}
this._showMoreMessageElement.classList.toggle('hidden',!asyncStackTrace);this._items.replaceAll(items);if(this._maxAsyncStackChainDepth===Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth){this._list.selectNextItem(true,false);const selectedItem=this._list.selectedItem();if(selectedItem)
this._activateItem(selectedItem);}
this._updatedForTest();}
_updatedForTest(){}
_refreshItem(item){this._scheduledForUpdateItems.add(item);this._updateItemThrottler.schedule(innerUpdate.bind(this));function innerUpdate(){const items=Array.from(this._scheduledForUpdateItems);this._scheduledForUpdateItems.clear();this._muteActivateItem=true;if(!this._showBlackboxed&&this._items.every(item=>item.isBlackboxed)){this._showBlackboxed=true;for(let i=0;i<this._items.length;++i)
this._list.refreshItemByIndex(i);this._blackboxedMessageElement.classList.toggle('hidden',true);}else{const itemsSet=new Set(items);let hasBlackboxed=false;for(let i=0;i<this._items.length;++i){const item=this._items.at(i);if(itemsSet.has(item))
this._list.refreshItemByIndex(i);hasBlackboxed=hasBlackboxed||item.isBlackboxed;}
this._blackboxedMessageElement.classList.toggle('hidden',this._showBlackboxed||!hasBlackboxed);}
delete this._muteActivateItem;return Promise.resolve();}}
createElementForItem(item){const element=createElementWithClass('div','call-frame-item');const title=element.createChild('div','call-frame-item-title');title.createChild('div','call-frame-title-text').textContent=item.title;if(item.isAsyncHeader){element.classList.add('async-header');}else{const linkElement=element.createChild('div','call-frame-location');linkElement.textContent=item.linkText.trimMiddle(30);linkElement.title=item.linkText;element.classList.toggle('blackboxed-call-frame',item.isBlackboxed);if(item.isBlackboxed)
UI.ARIAUtils.setDescription(element,ls`blackboxed`);if(!item[Sources.CallStackSidebarPane._debuggerCallFrameSymbol])
UI.ARIAUtils.setDisabled(element,true);}
const isSelected=item[Sources.CallStackSidebarPane._debuggerCallFrameSymbol]===UI.context.flavor(SDK.DebuggerModel.CallFrame);element.classList.toggle('selected',isSelected);UI.ARIAUtils.setSelected(element,isSelected);element.classList.toggle('hidden',!this._showBlackboxed&&item.isBlackboxed);element.appendChild(UI.Icon.create('smallicon-thick-right-arrow','selected-call-frame-icon'));element.tabIndex=item===this._list.selectedItem()?0:-1;return element;}
heightForItem(item){console.assert(false);return 0;}
isItemSelectable(item){return true;}
selectedItemChanged(from,to,fromElement,toElement){if(fromElement)
fromElement.tabIndex=-1;if(toElement){this.setDefaultFocusedElement(toElement);toElement.tabIndex=0;if(this.hasFocus())
toElement.focus();}}
updateSelectedItemARIA(fromElement,toElement){return true;}
_createBlackboxedMessageElement(){const element=createElementWithClass('div','blackboxed-message');element.createChild('span');const showAllLink=element.createChild('span','link');showAllLink.textContent=Common.UIString('Show frames marked as Library code');UI.ARIAUtils.markAsLink(showAllLink);showAllLink.tabIndex=0;const showAll=()=>{this._showBlackboxed=true;for(const item of this._items)
this._refreshItem(item);this._blackboxedMessageElement.classList.toggle('hidden',true);};showAllLink.addEventListener('click',showAll);showAllLink.addEventListener('keydown',event=>isEnterKey(event)&&showAll());return element;}
_createShowMoreMessageElement(){const element=createElementWithClass('div','show-more-message');element.createChild('span');const showAllLink=element.createChild('span','link');showAllLink.textContent=Common.UIString('Show more');showAllLink.addEventListener('click',()=>{this._maxAsyncStackChainDepth+=Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth;this._update();},false);return element;}
_onContextMenu(event){const item=this._list.itemForNode((event.target));if(!item)
return;const contextMenu=new UI.ContextMenu(event);const debuggerCallFrame=item[Sources.CallStackSidebarPane._debuggerCallFrameSymbol];if(debuggerCallFrame)
contextMenu.defaultSection().appendItem(Common.UIString('Restart frame'),()=>debuggerCallFrame.restart());contextMenu.defaultSection().appendItem(Common.UIString('Copy stack trace'),this._copyStackTrace.bind(this));if(item.uiLocation)
this.appendBlackboxURLContextMenuItems(contextMenu,item.uiLocation.uiSourceCode);contextMenu.show();}
_activateItem(item){const uiLocation=item.uiLocation;if(this._muteActivateItem||!uiLocation)
return;this._list.selectItem(item);const debuggerCallFrame=item[Sources.CallStackSidebarPane._debuggerCallFrameSymbol];const oldItem=this.activeCallFrameItem();if(debuggerCallFrame&&oldItem!==item){debuggerCallFrame.debuggerModel.setSelectedCallFrame(debuggerCallFrame);UI.context.setFlavor(SDK.DebuggerModel.CallFrame,debuggerCallFrame);if(oldItem)
this._list.refreshItem(oldItem);this._list.refreshItem(item);}else{Common.Revealer.reveal(uiLocation);}}
activeCallFrameItem(){const callFrame=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(callFrame){return this._items.find(callFrameItem=>callFrameItem[Sources.CallStackSidebarPane._debuggerCallFrameSymbol]===callFrame)||null;}
return null;}
appendBlackboxURLContextMenuItems(contextMenu,uiSourceCode){const binding=Persistence.persistence.binding(uiSourceCode);if(binding)
uiSourceCode=binding.network;if(uiSourceCode.project().type()===Workspace.projectTypes.FileSystem)
return;const canBlackbox=Bindings.blackboxManager.canBlackboxUISourceCode(uiSourceCode);const isBlackboxed=Bindings.blackboxManager.isBlackboxedUISourceCode(uiSourceCode);const isContentScript=uiSourceCode.project().type()===Workspace.projectTypes.ContentScripts;const manager=Bindings.blackboxManager;if(canBlackbox){if(isBlackboxed){contextMenu.defaultSection().appendItem(Common.UIString('Mark as my code'),manager.unblackboxUISourceCode.bind(manager,uiSourceCode));}else{contextMenu.defaultSection().appendItem(Common.UIString('Mark as Library code'),manager.blackboxUISourceCode.bind(manager,uiSourceCode));}}
if(isContentScript){if(isBlackboxed){contextMenu.defaultSection().appendItem(Common.UIString('Mark all content scripts as my code'),manager.blackboxContentScripts.bind(manager));}else{contextMenu.defaultSection().appendItem(Common.UIString('Mark all content scripts as Library code'),manager.unblackboxContentScripts.bind(manager));}}}
_selectNextCallFrameOnStack(){const oldItem=this.activeCallFrameItem();const startIndex=oldItem?this._items.indexOf(oldItem)+1:0;for(let i=startIndex;i<this._items.length;i++){const newItem=this._items.at(i);if(newItem[Sources.CallStackSidebarPane._debuggerCallFrameSymbol]){this._activateItem(newItem);break;}}}
_selectPreviousCallFrameOnStack(){const oldItem=this.activeCallFrameItem();const startIndex=oldItem?this._items.indexOf(oldItem)-1:this._items.length-1;for(let i=startIndex;i>=0;i--){const newItem=this._items.at(i);if(newItem[Sources.CallStackSidebarPane._debuggerCallFrameSymbol]){this._activateItem(newItem);break;}}}
_copyStackTrace(){const text=[];for(const item of this._items){let itemText=item.title;if(item.uiLocation)
itemText+=' ('+item.uiLocation.linkText(true)+')';text.push(itemText);}
InspectorFrontendHost.copyText(text.join('\n'));}};Sources.CallStackSidebarPane._debuggerCallFrameSymbol=Symbol('debuggerCallFrame');Sources.CallStackSidebarPane._elementSymbol=Symbol('element');Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth=32;Sources.CallStackSidebarPane.ActionDelegate=class{handleAction(context,actionId){const callStackSidebarPane=self.runtime.sharedInstance(Sources.CallStackSidebarPane);switch(actionId){case'debugger.next-call-frame':callStackSidebarPane._selectNextCallFrameOnStack();return true;case'debugger.previous-call-frame':callStackSidebarPane._selectPreviousCallFrameOnStack();return true;}
return false;}};Sources.CallStackSidebarPane.Item=class{static createForDebuggerCallFrame(frame,locationPool,updateDelegate){const item=new Sources.CallStackSidebarPane.Item(UI.beautifyFunctionName(frame.functionName),updateDelegate);Bindings.debuggerWorkspaceBinding.createCallFrameLiveLocation(frame.location(),item._update.bind(item),locationPool);return item;}
static createItemsForAsyncStack(title,debuggerModel,frames,locationPool,updateDelegate){const whiteboxedItemsSymbol=Symbol('whiteboxedItems');const asyncHeaderItem=new Sources.CallStackSidebarPane.Item(title,updateDelegate);asyncHeaderItem[whiteboxedItemsSymbol]=new Set();asyncHeaderItem.isAsyncHeader=true;const asyncFrameItems=frames.map(frame=>{const item=new Sources.CallStackSidebarPane.Item(UI.beautifyFunctionName(frame.functionName),update);const rawLocation=debuggerModel?debuggerModel.createRawLocationByScriptId(frame.scriptId,frame.lineNumber,frame.columnNumber):null;if(!rawLocation){item.linkText=(frame.url||'<unknown>')+':'+(frame.lineNumber+1);item.updateDelegate(item);}else{Bindings.debuggerWorkspaceBinding.createCallFrameLiveLocation(rawLocation,item._update.bind(item),locationPool);}
return item;});updateDelegate(asyncHeaderItem);return[asyncHeaderItem,...asyncFrameItems];function update(item){updateDelegate(item);let shouldUpdate=false;const items=asyncHeaderItem[whiteboxedItemsSymbol];if(item.isBlackboxed){items.delete(item);shouldUpdate=items.size===0;}else{shouldUpdate=items.size===0;items.add(item);}
asyncHeaderItem.isBlackboxed=asyncHeaderItem[whiteboxedItemsSymbol].size===0;if(shouldUpdate)
updateDelegate(asyncHeaderItem);}}
constructor(title,updateDelegate){this.isBlackboxed=false;this.title=title;this.linkText='';this.uiLocation=null;this.isAsyncHeader=false;this.updateDelegate=updateDelegate;}
_update(liveLocation){const uiLocation=liveLocation.uiLocation();this.isBlackboxed=uiLocation?Bindings.blackboxManager.isBlackboxedUISourceCode(uiLocation.uiSourceCode):false;this.linkText=uiLocation?uiLocation.linkText():'';this.uiLocation=uiLocation;this.updateDelegate(this);}};;Sources.DebuggerPausedMessage=class{constructor(){this._element=createElementWithClass('div','paused-message flex-none');const root=UI.createShadowRootWithCoreStyles(this._element,'sources/debuggerPausedMessage.css');this._contentElement=root.createChild('div');UI.ARIAUtils.markAsPoliteLiveRegion(this._element);}
element(){return this._element;}
static _descriptionWithoutStack(description){const firstCallFrame=/^\s+at\s/m.exec(description);return firstCallFrame?description.substring(0,firstCallFrame.index-1):description.substring(0,description.lastIndexOf('\n'));}
static async _createDOMBreakpointHitMessage(details){const messageWrapper=createElement('span');const domDebuggerModel=details.debuggerModel.target().model(SDK.DOMDebuggerModel);if(!details.auxData||!domDebuggerModel)
return messageWrapper;const data=domDebuggerModel.resolveDOMBreakpointData((details.auxData));if(!data)
return messageWrapper;const mainElement=messageWrapper.createChild('div','status-main');mainElement.appendChild(UI.Icon.create('smallicon-info','status-icon'));const breakpointType=Sources.DebuggerPausedMessage.BreakpointTypeNouns.get(data.type);mainElement.appendChild(createTextNode(ls`Paused on ${breakpointType}`));const subElement=messageWrapper.createChild('div','status-sub monospace');const linkifiedNode=await Common.Linkifier.linkify(data.node);subElement.appendChild(linkifiedNode);if(data.targetNode){const targetNodeLink=await Common.Linkifier.linkify(data.targetNode);let messageElement;if(data.insertion){if(data.targetNode===data.node)
messageElement=UI.formatLocalized('Child %s added',[targetNodeLink]);else
messageElement=UI.formatLocalized('Descendant %s added',[targetNodeLink]);}else{messageElement=UI.formatLocalized('Descendant %s removed',[targetNodeLink]);}
subElement.appendChild(createElement('br'));subElement.appendChild(messageElement);}
return messageWrapper;}
async render(details,debuggerWorkspaceBinding,breakpointManager){this._contentElement.removeChildren();this._contentElement.hidden=!details;if(!details)
return;const status=this._contentElement.createChild('div','paused-status');const errorLike=details.reason===SDK.DebuggerModel.BreakReason.Exception||details.reason===SDK.DebuggerModel.BreakReason.PromiseRejection||details.reason===SDK.DebuggerModel.BreakReason.Assert||details.reason===SDK.DebuggerModel.BreakReason.OOM;let messageWrapper;if(details.reason===SDK.DebuggerModel.BreakReason.DOM){messageWrapper=await Sources.DebuggerPausedMessage._createDOMBreakpointHitMessage(details);}else if(details.reason===SDK.DebuggerModel.BreakReason.EventListener){let eventNameForUI='';if(details.auxData){eventNameForUI=SDK.domDebuggerManager.resolveEventListenerBreakpointTitle((details.auxData));}
messageWrapper=buildWrapper(Common.UIString('Paused on event listener'),eventNameForUI);}else if(details.reason===SDK.DebuggerModel.BreakReason.XHR){messageWrapper=buildWrapper(Common.UIString('Paused on XHR or fetch'),details.auxData['url']||'');}else if(details.reason===SDK.DebuggerModel.BreakReason.Exception){const description=details.auxData['description']||details.auxData['value']||'';const descriptionWithoutStack=Sources.DebuggerPausedMessage._descriptionWithoutStack(description);messageWrapper=buildWrapper(Common.UIString('Paused on exception'),descriptionWithoutStack,description);}else if(details.reason===SDK.DebuggerModel.BreakReason.PromiseRejection){const description=details.auxData['description']||details.auxData['value']||'';const descriptionWithoutStack=Sources.DebuggerPausedMessage._descriptionWithoutStack(description);messageWrapper=buildWrapper(Common.UIString('Paused on promise rejection'),descriptionWithoutStack,description);}else if(details.reason===SDK.DebuggerModel.BreakReason.Assert){messageWrapper=buildWrapper(Common.UIString('Paused on assertion'));}else if(details.reason===SDK.DebuggerModel.BreakReason.DebugCommand){messageWrapper=buildWrapper(Common.UIString('Paused on debugged function'));}else if(details.reason===SDK.DebuggerModel.BreakReason.OOM){messageWrapper=buildWrapper(Common.UIString('Paused before potential out-of-memory crash'));}else if(details.callFrames.length){const uiLocation=debuggerWorkspaceBinding.rawLocationToUILocation(details.callFrames[0].location());const breakpoint=uiLocation?breakpointManager.findBreakpoint(uiLocation):null;const defaultText=breakpoint?Common.UIString('Paused on breakpoint'):Common.UIString('Debugger paused');messageWrapper=buildWrapper(defaultText);}else{console.warn('ScriptsPanel paused, but callFrames.length is zero.');}
status.classList.toggle('error-reason',errorLike);if(messageWrapper)
status.appendChild(messageWrapper);function buildWrapper(mainText,subText,title){const messageWrapper=createElement('span');const mainElement=messageWrapper.createChild('div','status-main');const icon=UI.Icon.create(errorLike?'smallicon-error':'smallicon-info','status-icon');mainElement.appendChild(icon);mainElement.appendChild(createTextNode(mainText));if(subText){const subElement=messageWrapper.createChild('div','status-sub monospace');subElement.textContent=subText;subElement.title=title||subText;}
return messageWrapper;}}};Sources.DebuggerPausedMessage.BreakpointTypeNouns=new Map([[SDK.DOMDebuggerModel.DOMBreakpoint.Type.SubtreeModified,Common.UIString('subtree modifications')],[SDK.DOMDebuggerModel.DOMBreakpoint.Type.AttributeModified,Common.UIString('attribute modifications')],[SDK.DOMDebuggerModel.DOMBreakpoint.Type.NodeRemoved,Common.UIString('node removal')],]);;Sources.HistoryEntry=function(){};Sources.HistoryEntry.prototype={valid(){},reveal(){}};Sources.SimpleHistoryManager=class{constructor(historyDepth){this._entries=[];this._activeEntryIndex=-1;this._coalescingReadonly=0;this._historyDepth=historyDepth;}
readOnlyLock(){++this._coalescingReadonly;}
releaseReadOnlyLock(){--this._coalescingReadonly;}
readOnly(){return!!this._coalescingReadonly;}
filterOut(filterOutCallback){if(this.readOnly())
return;const filteredEntries=[];let removedBeforeActiveEntry=0;for(let i=0;i<this._entries.length;++i){if(!filterOutCallback(this._entries[i]))
filteredEntries.push(this._entries[i]);else if(i<=this._activeEntryIndex)
++removedBeforeActiveEntry;}
this._entries=filteredEntries;this._activeEntryIndex=Math.max(0,this._activeEntryIndex-removedBeforeActiveEntry);}
empty(){return!this._entries.length;}
active(){return this.empty()?null:this._entries[this._activeEntryIndex];}
push(entry){if(this.readOnly())
return;if(!this.empty())
this._entries.splice(this._activeEntryIndex+1);this._entries.push(entry);if(this._entries.length>this._historyDepth)
this._entries.shift();this._activeEntryIndex=this._entries.length-1;}
rollback(){if(this.empty())
return false;let revealIndex=this._activeEntryIndex-1;while(revealIndex>=0&&!this._entries[revealIndex].valid())
--revealIndex;if(revealIndex<0)
return false;this.readOnlyLock();this._entries[revealIndex].reveal();this.releaseReadOnlyLock();this._activeEntryIndex=revealIndex;return true;}
rollover(){let revealIndex=this._activeEntryIndex+1;while(revealIndex<this._entries.length&&!this._entries[revealIndex].valid())
++revealIndex;if(revealIndex>=this._entries.length)
return false;this.readOnlyLock();this._entries[revealIndex].reveal();this.releaseReadOnlyLock();this._activeEntryIndex=revealIndex;return true;}};;Sources.EditingLocationHistoryManager=class{constructor(sourcesView,currentSourceFrameCallback){this._sourcesView=sourcesView;this._historyManager=new Sources.SimpleHistoryManager(Sources.EditingLocationHistoryManager.HistoryDepth);this._currentSourceFrameCallback=currentSourceFrameCallback;}
trackSourceFrameCursorJumps(sourceFrame){sourceFrame.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.JumpHappened,this._onJumpHappened.bind(this));}
_onJumpHappened(event){if(event.data.from)
this._updateActiveState(event.data.from);if(event.data.to)
this._pushActiveState(event.data.to);}
rollback(){this._historyManager.rollback();}
rollover(){this._historyManager.rollover();}
updateCurrentState(){const sourceFrame=this._currentSourceFrameCallback();if(!sourceFrame)
return;this._updateActiveState(sourceFrame.textEditor.selection());}
pushNewState(){const sourceFrame=this._currentSourceFrameCallback();if(!sourceFrame)
return;this._pushActiveState(sourceFrame.textEditor.selection());}
_updateActiveState(selection){const active=this._historyManager.active();if(!active)
return;const sourceFrame=this._currentSourceFrameCallback();if(!sourceFrame)
return;const entry=new Sources.EditingLocationHistoryEntry(this._sourcesView,this,sourceFrame,selection);active.merge(entry);}
_pushActiveState(selection){const sourceFrame=this._currentSourceFrameCallback();if(!sourceFrame)
return;const entry=new Sources.EditingLocationHistoryEntry(this._sourcesView,this,sourceFrame,selection);this._historyManager.push(entry);}
removeHistoryForSourceCode(uiSourceCode){function filterOut(entry){return entry._projectId===uiSourceCode.project().id()&&entry._url===uiSourceCode.url();}
this._historyManager.filterOut(filterOut);}};Sources.EditingLocationHistoryManager.HistoryDepth=20;Sources.EditingLocationHistoryEntry=class{constructor(sourcesView,editingLocationManager,sourceFrame,selection){this._sourcesView=sourcesView;this._editingLocationManager=editingLocationManager;const uiSourceCode=sourceFrame.uiSourceCode();this._projectId=uiSourceCode.project().id();this._url=uiSourceCode.url();const position=this._positionFromSelection(selection);this._positionHandle=sourceFrame.textEditor.textEditorPositionHandle(position.lineNumber,position.columnNumber);}
merge(entry){if(this._projectId!==entry._projectId||this._url!==entry._url)
return;this._positionHandle=entry._positionHandle;}
_positionFromSelection(selection){return{lineNumber:selection.endLine,columnNumber:selection.endColumn};}
valid(){const position=this._positionHandle.resolve();const uiSourceCode=Workspace.workspace.uiSourceCode(this._projectId,this._url);return!!(position&&uiSourceCode);}
reveal(){const position=this._positionHandle.resolve();const uiSourceCode=Workspace.workspace.uiSourceCode(this._projectId,this._url);if(!position||!uiSourceCode)
return;this._editingLocationManager.updateCurrentState();this._sourcesView.showSourceLocation(uiSourceCode,position.lineNumber,position.columnNumber);}};;Sources.FilePathScoreFunction=class{constructor(query){this._query=query;this._queryUpperCase=query.toUpperCase();this._score=new Int32Array(20*100);this._sequence=new Int32Array(20*100);this._dataUpperCase='';this._fileNameIndex=0;}
score(data,matchIndexes){if(!data||!this._query)
return 0;const n=this._query.length;const m=data.length;if(!this._score||this._score.length<n*m){this._score=new Int32Array(n*m*2);this._sequence=new Int32Array(n*m*2);}
const score=this._score;const sequence=(this._sequence);this._dataUpperCase=data.toUpperCase();this._fileNameIndex=data.lastIndexOf('/');for(let i=0;i<n;++i){for(let j=0;j<m;++j){const skipCharScore=j===0?0:score[i*m+j-1];const prevCharScore=i===0||j===0?0:score[(i-1)*m+j-1];const consecutiveMatch=i===0||j===0?0:sequence[(i-1)*m+j-1];const pickCharScore=this._match(this._query,data,i,j,consecutiveMatch);if(pickCharScore&&prevCharScore+pickCharScore>=skipCharScore){sequence[i*m+j]=consecutiveMatch+1;score[i*m+j]=(prevCharScore+pickCharScore);}else{sequence[i*m+j]=0;score[i*m+j]=skipCharScore;}}}
if(matchIndexes)
this._restoreMatchIndexes(sequence,n,m,matchIndexes);const maxDataLength=256;return score[n*m-1]*maxDataLength+(maxDataLength-data.length);}
_testWordStart(data,j){if(j===0)
return true;const prevChar=data.charAt(j-1);return prevChar==='_'||prevChar==='-'||prevChar==='/'||(data[j-1]!==this._dataUpperCase[j-1]&&data[j]===this._dataUpperCase[j]);}
_restoreMatchIndexes(sequence,n,m,out){let i=n-1,j=m-1;while(i>=0&&j>=0){switch(sequence[i*m+j]){case 0:--j;break;default:out.push(j);--i;--j;break;}}
out.reverse();}
_singleCharScore(query,data,i,j){const isWordStart=this._testWordStart(data,j);const isFileName=j>this._fileNameIndex;const isPathTokenStart=j===0||data[j-1]==='/';const isCapsMatch=query[i]===data[j]&&query[i]===this._queryUpperCase[i];let score=10;if(isPathTokenStart)
score+=4;if(isWordStart)
score+=2;if(isCapsMatch)
score+=6;if(isFileName)
score+=4;if(j===this._fileNameIndex+1&&i===0)
score+=5;if(isFileName&&isWordStart)
score+=3;return score;}
_sequenceCharScore(query,data,i,j,sequenceLength){const isFileName=j>this._fileNameIndex;const isPathTokenStart=j===0||data[j-1]==='/';let score=10;if(isFileName)
score+=4;if(isPathTokenStart)
score+=5;score+=sequenceLength*4;return score;}
_match(query,data,i,j,consecutiveMatch){if(this._queryUpperCase[i]!==this._dataUpperCase[j])
return 0;if(!consecutiveMatch)
return this._singleCharScore(query,data,i,j);else
return this._sequenceCharScore(query,data,i,j-consecutiveMatch,consecutiveMatch);}};;Sources.FilteredUISourceCodeListProvider=class extends QuickOpen.FilteredListWidget.Provider{constructor(){super();this._queryLineNumberAndColumnNumber='';this._defaultScores=null;this._scorer=new Sources.FilePathScoreFunction('');}
_projectRemoved(event){const project=(event.data);this._populate(project);this.refresh();}
_populate(skipProject){this._uiSourceCodes=[];const projects=Workspace.workspace.projects().filter(this.filterProject.bind(this));for(let i=0;i<projects.length;++i){if(skipProject&&projects[i]===skipProject)
continue;const uiSourceCodes=projects[i].uiSourceCodes().filter(this._filterUISourceCode.bind(this));this._uiSourceCodes=this._uiSourceCodes.concat(uiSourceCodes);}}
_filterUISourceCode(uiSourceCode){const binding=Persistence.persistence.binding(uiSourceCode);return!binding||binding.fileSystem===uiSourceCode;}
uiSourceCodeSelected(uiSourceCode,lineNumber,columnNumber){}
filterProject(project){return true;}
itemCount(){return this._uiSourceCodes.length;}
itemKeyAt(itemIndex){return this._uiSourceCodes[itemIndex].url();}
setDefaultScores(defaultScores){this._defaultScores=defaultScores;}
itemScoreAt(itemIndex,query){const uiSourceCode=this._uiSourceCodes[itemIndex];const score=this._defaultScores?(this._defaultScores.get(uiSourceCode)||0):0;if(!query||query.length<2)
return score;if(this._query!==query){this._query=query;this._scorer=new Sources.FilePathScoreFunction(query);}
let multiplier=10;if(uiSourceCode.project().type()===Workspace.projectTypes.FileSystem&&!Persistence.persistence.binding(uiSourceCode))
multiplier=5;const fullDisplayName=uiSourceCode.fullDisplayName();return score+multiplier*this._scorer.score(fullDisplayName,null);}
renderItem(itemIndex,query,titleElement,subtitleElement){query=this.rewriteQuery(query);const uiSourceCode=this._uiSourceCodes[itemIndex];const fullDisplayName=uiSourceCode.fullDisplayName();const indexes=[];new Sources.FilePathScoreFunction(query).score(fullDisplayName,indexes);const fileNameIndex=fullDisplayName.lastIndexOf('/');titleElement.classList.add('monospace');subtitleElement.classList.add('monospace');titleElement.textContent=uiSourceCode.displayName()+(this._queryLineNumberAndColumnNumber||'');this._renderSubtitleElement(subtitleElement,fullDisplayName);subtitleElement.title=fullDisplayName;const ranges=[];for(let i=0;i<indexes.length;++i)
ranges.push({offset:indexes[i],length:1});if(indexes[0]>fileNameIndex){for(let i=0;i<ranges.length;++i)
ranges[i].offset-=fileNameIndex+1;UI.highlightRangesWithStyleClass(titleElement,ranges,'highlight');}else{UI.highlightRangesWithStyleClass(subtitleElement,ranges,'highlight');}}
_renderSubtitleElement(element,text){element.removeChildren();let splitPosition=text.lastIndexOf('/');if(text.length>55)
splitPosition=text.length-55;const first=element.createChild('div','first-part');first.textContent=text.substring(0,splitPosition);const second=element.createChild('div','second-part');second.textContent=text.substring(splitPosition);element.title=text;}
selectItem(itemIndex,promptValue){const parsedExpression=promptValue.trim().match(/^([^:]*)(:\d+)?(:\d+)?$/);if(!parsedExpression)
return;let lineNumber;let columnNumber;if(parsedExpression[2])
lineNumber=parseInt(parsedExpression[2].substr(1),10)-1;if(parsedExpression[3])
columnNumber=parseInt(parsedExpression[3].substr(1),10)-1;const uiSourceCode=itemIndex!==null?this._uiSourceCodes[itemIndex]:null;this.uiSourceCodeSelected(uiSourceCode,lineNumber,columnNumber);}
rewriteQuery(query){query=query?query.trim():'';if(!query||query===':')
return'';const lineNumberMatch=query.match(/^([^:]+)((?::[^:]*){0,2})$/);this._queryLineNumberAndColumnNumber=lineNumberMatch?lineNumberMatch[2]:'';return lineNumberMatch?lineNumberMatch[1]:query;}
_uiSourceCodeAdded(event){const uiSourceCode=(event.data);if(!this._filterUISourceCode(uiSourceCode)||!this.filterProject(uiSourceCode.project()))
return;this._uiSourceCodes.push(uiSourceCode);this.refresh();}
notFoundText(){return Common.UIString('No files found');}
attach(){Workspace.workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);Workspace.workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved,this._projectRemoved,this);this._populate();}
detach(){Workspace.workspace.removeEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);Workspace.workspace.removeEventListener(Workspace.Workspace.Events.ProjectRemoved,this._projectRemoved,this);this._queryLineNumberAndColumnNumber='';this._defaultScores=null;}};;Sources.GoToLineQuickOpen=class extends QuickOpen.FilteredListWidget.Provider{selectItem(itemIndex,promptValue){const uiSourceCode=this._currentUISourceCode();if(!uiSourceCode)
return;const position=this._parsePosition(promptValue);if(!position)
return;Common.Revealer.reveal(uiSourceCode.uiLocation(position.line-1,position.column-1));}
notFoundText(query){if(!this._currentUISourceCode())
return Common.UIString('No file selected.');const position=this._parsePosition(query);if(!position){const sourceFrame=this._currentSourceFrame();if(!sourceFrame)
return ls`Type a number to go to that line.`;const currentLineNumber=sourceFrame.textEditor.currentLineNumber()+1;const linesCount=sourceFrame.textEditor.linesCount;return ls`Current line: ${currentLineNumber}. Type a line number between 1 and ${linesCount} to navigate to.`;}
if(position.column&&position.column>1)
return ls`Go to line ${position.line} and column ${position.column}.`;return ls`Go to line ${position.line}.`;}
_parsePosition(query){const parts=query.match(/([0-9]+)(\:[0-9]*)?/);if(!parts||!parts[0]||parts[0].length!==query.length)
return null;const line=parseInt(parts[1],10);let column;if(parts[2])
column=parseInt(parts[2].substring(1),10);return{line:Math.max(line|0,1),column:Math.max(column|0,1)};}
_currentUISourceCode(){const sourcesView=UI.context.flavor(Sources.SourcesView);if(!sourcesView)
return null;return sourcesView.currentUISourceCode();}
_currentSourceFrame(){const sourcesView=UI.context.flavor(Sources.SourcesView);if(!sourcesView)
return null;return sourcesView.currentSourceFrame();}};;Sources.SourceMapNamesResolver={};Sources.SourceMapNamesResolver._cachedMapSymbol=Symbol('cache');Sources.SourceMapNamesResolver._cachedIdentifiersSymbol=Symbol('cachedIdentifiers');Sources.SourceMapNamesResolver.Identifier=class{constructor(name,lineNumber,columnNumber){this.name=name;this.lineNumber=lineNumber;this.columnNumber=columnNumber;}};Sources.SourceMapNamesResolver._scopeIdentifiers=function(scope){const startLocation=scope.startLocation();const endLocation=scope.endLocation();if(scope.type()===Protocol.Debugger.ScopeType.Global||!startLocation||!endLocation||!startLocation.script()||!startLocation.script().sourceMapURL||(startLocation.script()!==endLocation.script()))
return Promise.resolve(([]));const script=startLocation.script();return script.requestContent().then(onContent);function onContent(content){if(!content)
return Promise.resolve(([]));const text=new TextUtils.Text(content);const scopeRange=new TextUtils.TextRange(startLocation.lineNumber,startLocation.columnNumber,endLocation.lineNumber,endLocation.columnNumber);const scopeText=text.extract(scopeRange);const scopeStart=text.toSourceRange(scopeRange).offset;const prefix='function fui';return Formatter.formatterWorkerPool().javaScriptIdentifiers(prefix+scopeText).then(onIdentifiers.bind(null,text,scopeStart,prefix));}
function onIdentifiers(text,scopeStart,prefix,identifiers){const result=[];const cursor=new TextUtils.TextCursor(text.lineEndings());for(let i=0;i<identifiers.length;++i){const id=identifiers[i];if(id.offset<prefix.length)
continue;const start=scopeStart+id.offset-prefix.length;cursor.resetTo(start);result.push(new Sources.SourceMapNamesResolver.Identifier(id.name,cursor.lineNumber(),cursor.columnNumber()));}
return result;}};Sources.SourceMapNamesResolver._resolveScope=function(scope){let identifiersPromise=scope[Sources.SourceMapNamesResolver._cachedIdentifiersSymbol];if(identifiersPromise)
return identifiersPromise;const script=scope.callFrame().script;const sourceMap=Bindings.debuggerWorkspaceBinding.sourceMapForScript(script);if(!sourceMap)
return Promise.resolve(new Map());const textCache=new Map();identifiersPromise=Sources.SourceMapNamesResolver._scopeIdentifiers(scope).then(onIdentifiers);scope[Sources.SourceMapNamesResolver._cachedIdentifiersSymbol]=identifiersPromise;return identifiersPromise;function onIdentifiers(identifiers){const namesMapping=new Map();for(let i=0;i<identifiers.length;++i){const id=identifiers[i];const entry=sourceMap.findEntry(id.lineNumber,id.columnNumber);if(entry&&entry.name)
namesMapping.set(id.name,entry.name);}
const promises=[];for(let i=0;i<identifiers.length;++i){const id=identifiers[i];if(namesMapping.has(id.name))
continue;const promise=resolveSourceName(id).then(onSourceNameResolved.bind(null,namesMapping,id));promises.push(promise);}
return Promise.all(promises).then(()=>Sources.SourceMapNamesResolver._scopeResolvedForTest()).then(()=>namesMapping);}
function onSourceNameResolved(namesMapping,id,sourceName){if(!sourceName)
return;namesMapping.set(id.name,sourceName);}
function resolveSourceName(id){const startEntry=sourceMap.findEntry(id.lineNumber,id.columnNumber);const endEntry=sourceMap.findEntry(id.lineNumber,id.columnNumber+id.name.length);if(!startEntry||!endEntry||!startEntry.sourceURL||startEntry.sourceURL!==endEntry.sourceURL||!startEntry.sourceLineNumber||!startEntry.sourceColumnNumber||!endEntry.sourceLineNumber||!endEntry.sourceColumnNumber)
return Promise.resolve((null));const sourceTextRange=new TextUtils.TextRange(startEntry.sourceLineNumber,startEntry.sourceColumnNumber,endEntry.sourceLineNumber,endEntry.sourceColumnNumber);const uiSourceCode=Bindings.debuggerWorkspaceBinding.uiSourceCodeForSourceMapSourceURL(script.debuggerModel,startEntry.sourceURL,script.isContentScript());if(!uiSourceCode)
return Promise.resolve((null));return uiSourceCode.requestContent().then(onSourceContent.bind(null,sourceTextRange));}
function onSourceContent(sourceTextRange,content){if(!content)
return null;let text=textCache.get(content);if(!text){text=new TextUtils.Text(content);textCache.set(content,text);}
const originalIdentifier=text.extract(sourceTextRange).trim();return/[a-zA-Z0-9_$]+/.test(originalIdentifier)?originalIdentifier:null;}};Sources.SourceMapNamesResolver._scopeResolvedForTest=function(){};Sources.SourceMapNamesResolver._allVariablesInCallFrame=function(callFrame){const cached=callFrame[Sources.SourceMapNamesResolver._cachedMapSymbol];if(cached)
return Promise.resolve(cached);const promises=[];const scopeChain=callFrame.scopeChain();for(let i=0;i<scopeChain.length;++i)
promises.push(Sources.SourceMapNamesResolver._resolveScope(scopeChain[i]));return Promise.all(promises).then(mergeVariables);function mergeVariables(nameMappings){const reverseMapping=new Map();for(const map of nameMappings){for(const compiledName of map.keys()){const originalName=map.get(compiledName);if(!reverseMapping.has(originalName))
reverseMapping.set(originalName,compiledName);}}
callFrame[Sources.SourceMapNamesResolver._cachedMapSymbol]=reverseMapping;return reverseMapping;}};Sources.SourceMapNamesResolver.resolveExpression=function(callFrame,originalText,uiSourceCode,lineNumber,startColumnNumber,endColumnNumber){if(!uiSourceCode.contentType().isFromSourceMap())
return Promise.resolve('');return Sources.SourceMapNamesResolver._allVariablesInCallFrame(callFrame).then(reverseMapping=>findCompiledName(callFrame.debuggerModel,reverseMapping));function findCompiledName(debuggerModel,reverseMapping){if(reverseMapping.has(originalText))
return Promise.resolve(reverseMapping.get(originalText)||'');return Sources.SourceMapNamesResolver._resolveExpression(debuggerModel,uiSourceCode,lineNumber,startColumnNumber,endColumnNumber);}};Sources.SourceMapNamesResolver._resolveExpression=function(debuggerModel,uiSourceCode,lineNumber,startColumnNumber,endColumnNumber){const rawLocations=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(uiSourceCode,lineNumber,startColumnNumber);const rawLocation=rawLocations.find(location=>location.debuggerModel===debuggerModel);if(!rawLocation)
return Promise.resolve('');const script=rawLocation.script();if(!script)
return Promise.resolve('');const sourceMap=Bindings.debuggerWorkspaceBinding.sourceMapForScript(script);if(!sourceMap)
return Promise.resolve('');return script.requestContent().then(onContent);function onContent(content){if(!content)
return Promise.resolve('');const text=new TextUtils.Text(content);const textRange=sourceMap.reverseMapTextRange(uiSourceCode.url(),new TextUtils.TextRange(lineNumber,startColumnNumber,lineNumber,endColumnNumber));const originalText=text.extract(textRange);if(!originalText)
return Promise.resolve('');return Formatter.formatterWorkerPool().evaluatableJavaScriptSubstring(originalText);}};Sources.SourceMapNamesResolver.resolveThisObject=function(callFrame){if(!callFrame)
return Promise.resolve((null));if(!callFrame.scopeChain().length)
return Promise.resolve(callFrame.thisObject());return Sources.SourceMapNamesResolver._resolveScope(callFrame.scopeChain()[0]).then(onScopeResolved);function onScopeResolved(namesMapping){const thisMappings=namesMapping.inverse().get('this');if(!thisMappings||thisMappings.size!==1)
return Promise.resolve(callFrame.thisObject());const thisMapping=thisMappings.valuesArray()[0];return callFrame.evaluate({expression:thisMapping,objectGroup:'backtrace',includeCommandLineAPI:false,silent:true,returnByValue:false,generatePreview:true}).then(onEvaluated);}
function onEvaluated(result){return!result.exceptionDetails&&result.object?result.object:callFrame.thisObject();}};Sources.SourceMapNamesResolver.resolveScopeInObject=function(scope){const startLocation=scope.startLocation();const endLocation=scope.endLocation();if(scope.type()===Protocol.Debugger.ScopeType.Global||!startLocation||!endLocation||!startLocation.script()||!startLocation.script().sourceMapURL||startLocation.script()!==endLocation.script())
return scope.object();return new Sources.SourceMapNamesResolver.RemoteObject(scope);};Sources.SourceMapNamesResolver.RemoteObject=class extends SDK.RemoteObject{constructor(scope){super();this._scope=scope;this._object=scope.object();}
customPreview(){return this._object.customPreview();}
get objectId(){return this._object.objectId;}
get type(){return this._object.type;}
get subtype(){return this._object.subtype;}
get value(){return this._object.value;}
get description(){return this._object.description;}
get hasChildren(){return this._object.hasChildren;}
get preview(){return this._object.preview;}
arrayLength(){return this._object.arrayLength();}
getOwnProperties(generatePreview){return this._object.getOwnProperties(generatePreview);}
async getAllProperties(accessorPropertiesOnly,generatePreview){const allProperties=await this._object.getAllProperties(accessorPropertiesOnly,generatePreview);const namesMapping=await Sources.SourceMapNamesResolver._resolveScope(this._scope);const properties=allProperties.properties;const internalProperties=allProperties.internalProperties;const newProperties=[];if(properties){for(let i=0;i<properties.length;++i){const property=properties[i];const name=namesMapping.get(property.name)||properties[i].name;newProperties.push(new SDK.RemoteObjectProperty(name,property.value,property.enumerable,property.writable,property.isOwn,property.wasThrown,property.symbol,property.synthetic));}}
return{properties:newProperties,internalProperties:internalProperties};}
async setPropertyValue(argumentName,value){const namesMapping=await Sources.SourceMapNamesResolver._resolveScope(this._scope);let name;if(typeof argumentName==='string')
name=argumentName;else
name=(argumentName.value);let actualName=name;for(const compiledName of namesMapping.keys()){if(namesMapping.get(compiledName)===name){actualName=compiledName;break;}}
return this._object.setPropertyValue(actualName,value);}
async deleteProperty(name){return this._object.deleteProperty(name);}
callFunction(functionDeclaration,args){return this._object.callFunction(functionDeclaration,args);}
callFunctionJSON(functionDeclaration,args){return this._object.callFunctionJSON(functionDeclaration,args);}
release(){this._object.release();}
debuggerModel(){return this._object.debuggerModel();}
runtimeModel(){return this._object.runtimeModel();}
isNode(){return this._object.isNode();}};;Sources.JavaScriptBreakpointsSidebarPane=class extends UI.ThrottledWidget{constructor(){super(true);this.registerRequiredCSS('sources/javaScriptBreakpointsSidebarPane.css');this._breakpointManager=Bindings.breakpointManager;this._breakpointManager.addEventListener(Bindings.BreakpointManager.Events.BreakpointAdded,this.update,this);this._breakpointManager.addEventListener(Bindings.BreakpointManager.Events.BreakpointRemoved,this.update,this);Common.moduleSetting('breakpointsActive').addChangeListener(this.update,this);this._breakpoints=new UI.ListModel();this._list=new UI.ListControl(this._breakpoints,this,UI.ListMode.NonViewport);UI.ARIAUtils.markAsList(this._list.element);this.contentElement.appendChild(this._list.element);this._emptyElement=this.contentElement.createChild('div','gray-info-message');this._emptyElement.textContent=Common.UIString('No breakpoints');this._emptyElement.tabIndex=-1;this.update();}
doUpdate(){const hadFocus=this.hasFocus();const breakpointLocations=this._breakpointManager.allBreakpointLocations().filter(breakpointLocation=>breakpointLocation.uiLocation.uiSourceCode.project().type()!==Workspace.projectTypes.Debugger);if(!breakpointLocations.length){this._list.element.classList.add('hidden');this._emptyElement.classList.remove('hidden');this.setDefaultFocusedElement(this._emptyElement);this._didUpdateForTest();return Promise.resolve();}
this._list.element.classList.remove('hidden');this._emptyElement.classList.add('hidden');breakpointLocations.sort((item1,item2)=>item1.uiLocation.compareTo(item2.uiLocation));const breakpointEntriesForLine=new Multimap();const locationForEntry=new Multimap();for(const breakpointLocation of breakpointLocations){const uiLocation=breakpointLocation.uiLocation;const entryDescriptor=`${uiLocation.uiSourceCode.url()}:${uiLocation.lineNumber}:${uiLocation.columnNumber}`;locationForEntry.set(entryDescriptor,breakpointLocation);const lineDescriptor=`${uiLocation.uiSourceCode.url()}:${uiLocation.lineNumber}`;breakpointEntriesForLine.set(lineDescriptor,entryDescriptor);}
const details=UI.context.flavor(SDK.DebuggerPausedDetails);const selectedUILocation=details&&details.callFrames.length?Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(details.callFrames[0].location()):null;let shouldShowView=false;const promises=[];const breakpoints=[];let itemToSelect;for(const descriptor of locationForEntry.keysArray()){const locations=Array.from(locationForEntry.get(descriptor));const breakpointLocation=locations[0];const uiLocation=breakpointLocation.uiLocation;const isSelected=!!selectedUILocation&&locations.some(location=>location.uiLocation.id()===selectedUILocation.id());const showColumn=breakpointEntriesForLine.get(`${uiLocation.uiSourceCode.url()}:${uiLocation.lineNumber}`).size>1;const content=uiLocation.uiSourceCode.requestContent();promises.push(content);const item={breakpointLocation,locations,isSelected,showColumn,content};breakpoints.push(item);if(this._list.selectedItem()&&this._list.selectedItem().breakpointLocation.breakpoint===breakpointLocation.breakpoint)
itemToSelect=item;if(isSelected)
shouldShowView=true;}
if(shouldShowView)
UI.viewManager.showView('sources.jsBreakpoints');this._list.element.classList.toggle('breakpoints-list-deactivated',!Common.moduleSetting('breakpointsActive').get());this._breakpoints.replaceAll(breakpoints);this._list.selectItem(itemToSelect||this._breakpoints.at(0));if(hadFocus)
this.focus();return Promise.all(promises).then(()=>this._didUpdateForTest());}
createElementForItem(item){const element=createElementWithClass('div','breakpoint-entry');UI.ARIAUtils.markAsListitem(element);element.tabIndex=this._list.selectedItem()===item?0:-1;element.addEventListener('contextmenu',this._breakpointContextMenu.bind(this),true);element.addEventListener('click',this._revealLocation.bind(this,element),false);const checkboxLabel=UI.CheckboxLabel.create('');const uiLocation=item.locations[0].uiLocation;const hasEnabled=item.locations.some(location=>location.breakpoint.enabled());const hasDisabled=item.locations.some(location=>!location.breakpoint.enabled());checkboxLabel.textElement.textContent=uiLocation.linkText()+(item.showColumn?':'+(uiLocation.columnNumber+1):'');checkboxLabel.checkboxElement.checked=hasEnabled;checkboxLabel.checkboxElement.indeterminate=hasEnabled&&hasDisabled;checkboxLabel.checkboxElement.tabIndex=-1;checkboxLabel.addEventListener('click',this._breakpointCheckboxClicked.bind(this),false);element.appendChild(checkboxLabel);let checkedDescription=hasEnabled?ls`checked`:ls`unchecked`;if(hasEnabled&&hasDisabled)
checkedDescription=ls`mixed`;if(item.isSelected){UI.ARIAUtils.setDescription(element,ls`${checkedDescription} breakpoint hit`);element.classList.add('breakpoint-hit');this.setDefaultFocusedElement(element);}else{UI.ARIAUtils.setDescription(element,checkedDescription);}
element.addEventListener('keydown',event=>{if(event.key===' '){checkboxLabel.checkboxElement.click();event.consume(true);}});const snippetElement=element.createChild('div','source-text monospace');item.content.then(content=>{const lineNumber=uiLocation.lineNumber;const text=new TextUtils.Text(content||'');if(lineNumber<text.lineCount()){const lineText=text.lineAt(lineNumber);const maxSnippetLength=200;snippetElement.textContent=lineText.substring(item.showColumn?uiLocation.columnNumber:0).trimEnd(maxSnippetLength);}});element[Sources.JavaScriptBreakpointsSidebarPane._breakpointLocationsSymbol]=item.locations;element[Sources.JavaScriptBreakpointsSidebarPane._locationSymbol]=uiLocation;return element;}
heightForItem(item){return 0;}
isItemSelectable(item){return true;}
selectedItemChanged(from,to,fromElement,toElement){if(fromElement)
fromElement.tabIndex=-1;if(toElement){toElement.tabIndex=0;this.setDefaultFocusedElement(toElement);if(this.hasFocus())
toElement.focus();}}
updateSelectedItemARIA(fromElement,toElement){return true;}
_breakpointLocations(event){if(event.target instanceof Element)
return this._breakpointLocationsForElement(event.target);return[];}
_breakpointLocationsForElement(element){const node=element.enclosingNodeOrSelfWithClass('breakpoint-entry');if(!node)
return[];return node[Sources.JavaScriptBreakpointsSidebarPane._breakpointLocationsSymbol]||[];}
_breakpointCheckboxClicked(event){const hadFocus=this.hasFocus();const breakpoints=this._breakpointLocations(event).map(breakpointLocation=>breakpointLocation.breakpoint);const newState=event.target.checkboxElement.checked;for(const breakpoint of breakpoints){breakpoint.setEnabled(newState);const item=this._breakpoints.find(breakpointItem=>breakpointItem.breakpointLocation.breakpoint===breakpoint);if(item)
this._list.refreshItem(item);}
if(hadFocus)
this.focus();event.consume();}
_revealLocation(element){const uiLocations=this._breakpointLocationsForElement(element).map(breakpointLocation=>breakpointLocation.uiLocation);let uiLocation=null;for(const uiLocationCandidate of uiLocations){if(!uiLocation||uiLocationCandidate.columnNumber<uiLocation.columnNumber)
uiLocation=uiLocationCandidate;}
if(uiLocation)
Common.Revealer.reveal(uiLocation);}
_breakpointContextMenu(event){const breakpoints=this._breakpointLocations(event).map(breakpointLocation=>breakpointLocation.breakpoint);const contextMenu=new UI.ContextMenu(event);const removeEntryTitle=breakpoints.length>1?Common.UIString('Remove all breakpoints in line'):Common.UIString('Remove breakpoint');contextMenu.defaultSection().appendItem(removeEntryTitle,()=>breakpoints.map(breakpoint=>breakpoint.remove(false)));if(event.target instanceof Element)
contextMenu.defaultSection().appendItem(ls`Reveal location`,this._revealLocation.bind(this,event.target));const breakpointActive=Common.moduleSetting('breakpointsActive').get();const breakpointActiveTitle=breakpointActive?Common.UIString('Deactivate breakpoints'):Common.UIString('Activate breakpoints');contextMenu.defaultSection().appendItem(breakpointActiveTitle,()=>Common.moduleSetting('breakpointsActive').set(!breakpointActive));if(breakpoints.some(breakpoint=>!breakpoint.enabled())){const enableTitle=Common.UIString('Enable all breakpoints');contextMenu.defaultSection().appendItem(enableTitle,this._toggleAllBreakpoints.bind(this,true));}
if(breakpoints.some(breakpoint=>breakpoint.enabled())){const disableTitle=Common.UIString('Disable all breakpoints');contextMenu.defaultSection().appendItem(disableTitle,this._toggleAllBreakpoints.bind(this,false));}
const removeAllTitle=Common.UIString('Remove all breakpoints');contextMenu.defaultSection().appendItem(removeAllTitle,this._removeAllBreakpoints.bind(this));const removeOtherTitle=Common.UIString('Remove other breakpoints');contextMenu.defaultSection().appendItem(removeOtherTitle,this._removeOtherBreakpoints.bind(this,new Set(breakpoints)));contextMenu.show();}
_toggleAllBreakpoints(toggleState){for(const breakpointLocation of this._breakpointManager.allBreakpointLocations())
breakpointLocation.breakpoint.setEnabled(toggleState);}
_removeAllBreakpoints(){for(const breakpointLocation of this._breakpointManager.allBreakpointLocations())
breakpointLocation.breakpoint.remove(false);}
_removeOtherBreakpoints(selectedBreakpoints){for(const breakpointLocation of this._breakpointManager.allBreakpointLocations()){if(!selectedBreakpoints.has(breakpointLocation.breakpoint))
breakpointLocation.breakpoint.remove(false);}}
flavorChanged(object){this.update();}
_didUpdateForTest(){}};Sources.JavaScriptBreakpointsSidebarPane._locationSymbol=Symbol('location');Sources.JavaScriptBreakpointsSidebarPane._breakpointLocationsSymbol=Symbol('locations');Sources.JavaScriptBreakpointsSidebarPane.Breakpoint;Sources.JavaScriptBreakpointsSidebarPane.BreakpointItem;;Sources.UISourceCodeFrame=class extends SourceFrame.SourceFrame{constructor(uiSourceCode){super(workingCopy);this._uiSourceCode=uiSourceCode;if(Runtime.experiments.isEnabled('sourceDiff'))
this._diff=new SourceFrame.SourceCodeDiff(this.textEditor);this._muteSourceCodeEvents=false;this._isSettingContent=false;this._persistenceBinding=Persistence.persistence.binding(uiSourceCode);this._rowMessageBuckets=new Map();this._typeDecorationsPending=new Set();this._uiSourceCodeEventListeners=[];this._messageAndDecorationListeners=[];this._boundOnBindingChanged=this._onBindingChanged.bind(this);this.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.EditorBlurred,()=>UI.context.setFlavor(Sources.UISourceCodeFrame,null));this.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.EditorFocused,()=>UI.context.setFlavor(Sources.UISourceCodeFrame,this));Common.settings.moduleSetting('persistenceNetworkOverridesEnabled').addChangeListener(this._onNetworkPersistenceChanged,this);this._errorPopoverHelper=new UI.PopoverHelper(this.element,this._getErrorPopoverContent.bind(this));this._errorPopoverHelper.setHasPadding(true);this._errorPopoverHelper.setTimeout(100,100);this._plugins=[];this._initializeUISourceCode();function workingCopy(){if(uiSourceCode.isDirty())
return(Promise.resolve(uiSourceCode.workingCopy()));return uiSourceCode.requestContent();}}
_installMessageAndDecorationListeners(){if(this._persistenceBinding){const networkSourceCode=this._persistenceBinding.network;const fileSystemSourceCode=this._persistenceBinding.fileSystem;this._messageAndDecorationListeners=[networkSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageAdded,this._onMessageAdded,this),networkSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageRemoved,this._onMessageRemoved,this),networkSourceCode.addEventListener(Workspace.UISourceCode.Events.LineDecorationAdded,this._onLineDecorationAdded,this),networkSourceCode.addEventListener(Workspace.UISourceCode.Events.LineDecorationRemoved,this._onLineDecorationRemoved,this),fileSystemSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageAdded,this._onMessageAdded,this),fileSystemSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageRemoved,this._onMessageRemoved,this),];}else{this._messageAndDecorationListeners=[this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageAdded,this._onMessageAdded,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageRemoved,this._onMessageRemoved,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.LineDecorationAdded,this._onLineDecorationAdded,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.LineDecorationRemoved,this._onLineDecorationRemoved,this)];}}
uiSourceCode(){return this._uiSourceCode;}
setUISourceCode(uiSourceCode){this._unloadUISourceCode();this._uiSourceCode=uiSourceCode;if(uiSourceCode.contentLoaded()){if(uiSourceCode.workingCopy()!==this.textEditor.text())
this._innerSetContent(uiSourceCode.workingCopy());}else{uiSourceCode.requestContent().then(()=>{if(this._uiSourceCode!==uiSourceCode)
return;if(uiSourceCode.workingCopy()!==this.textEditor.text())
this._innerSetContent(uiSourceCode.workingCopy());});}
this._initializeUISourceCode();}
_unloadUISourceCode(){this._disposePlugins();for(const message of this._allMessages())
this._removeMessageFromSource(message);Common.EventTarget.removeEventListeners(this._messageAndDecorationListeners);Common.EventTarget.removeEventListeners(this._uiSourceCodeEventListeners);this._uiSourceCode.removeWorkingCopyGetter();Persistence.persistence.unsubscribeFromBindingEvent(this._uiSourceCode,this._boundOnBindingChanged);}
_initializeUISourceCode(){this._uiSourceCodeEventListeners=[this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._onWorkingCopyChanged,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._onWorkingCopyCommitted,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.TitleChanged,this._refreshHighlighterType,this)];Persistence.persistence.subscribeForBindingEvent(this._uiSourceCode,this._boundOnBindingChanged);for(const message of this._allMessages())
this._addMessageToSource(message);this._installMessageAndDecorationListeners();this._updateStyle();this._decorateAllTypes();this._refreshHighlighterType();if(Runtime.experiments.isEnabled('sourcesPrettyPrint')){const supportedPrettyTypes=new Set(['text/html','text/css','text/javascript']);this.setCanPrettyPrint(supportedPrettyTypes.has(this.highlighterType()),true);}
this._ensurePluginsLoaded();}
wasShown(){super.wasShown();setImmediate(this._updateBucketDecorations.bind(this));this.setEditable(this._canEditSource());for(const plugin of this._plugins)
plugin.wasShown();}
willHide(){for(const plugin of this._plugins)
plugin.willHide();super.willHide();UI.context.setFlavor(Sources.UISourceCodeFrame,null);this._uiSourceCode.removeWorkingCopyGetter();}
_refreshHighlighterType(){const binding=Persistence.persistence.binding(this._uiSourceCode);const highlighterType=binding?binding.network.mimeType():this._uiSourceCode.mimeType();if(this.highlighterType()===highlighterType)
return;this._disposePlugins();this.setHighlighterType(highlighterType);this._ensurePluginsLoaded();}
_canEditSource(){if(Persistence.persistence.binding(this._uiSourceCode))
return true;if(this._uiSourceCode.project().canSetFileContent())
return true;if(this._uiSourceCode.project().isServiceProject())
return false;if(this._uiSourceCode.project().type()===Workspace.projectTypes.Network&&Persistence.networkPersistenceManager.active())
return true;if(this.pretty&&this._uiSourceCode.contentType().hasScripts())
return false;return this._uiSourceCode.contentType()!==Common.resourceTypes.Document;}
_onNetworkPersistenceChanged(){this.setEditable(this._canEditSource());}
commitEditing(){if(!this._uiSourceCode.isDirty())
return;this._muteSourceCodeEvents=true;this._uiSourceCode.commitWorkingCopy();this._muteSourceCodeEvents=false;}
setContent(content){this._disposePlugins();this._rowMessageBuckets.clear();super.setContent(content);for(const message of this._allMessages())
this._addMessageToSource(message);this._decorateAllTypes();this._ensurePluginsLoaded();}
_allMessages(){if(this._persistenceBinding){const combinedSet=this._persistenceBinding.network.messages();combinedSet.addAll(this._persistenceBinding.fileSystem.messages());return combinedSet;}
return this._uiSourceCode.messages();}
onTextChanged(oldRange,newRange){const wasPretty=this.pretty;super.onTextChanged(oldRange,newRange);this._errorPopoverHelper.hidePopover();if(this._isSettingContent)
return;Sources.SourcesPanel.instance().updateLastModificationTime();this._muteSourceCodeEvents=true;if(this.isClean())
this._uiSourceCode.resetWorkingCopy();else
this._uiSourceCode.setWorkingCopyGetter(this.textEditor.text.bind(this.textEditor));this._muteSourceCodeEvents=false;if(wasPretty!==this.pretty){this._updateStyle();this._disposePlugins();this._ensurePluginsLoaded();}}
_onWorkingCopyChanged(event){if(this._muteSourceCodeEvents)
return;this._innerSetContent(this._uiSourceCode.workingCopy());}
_onWorkingCopyCommitted(event){if(!this._muteSourceCodeEvents)
this._innerSetContent(this._uiSourceCode.workingCopy());this.contentCommitted();this._updateStyle();}
_ensurePluginsLoaded(){if(!this.loaded||this._plugins.length)
return;const binding=Persistence.persistence.binding(this._uiSourceCode);const pluginUISourceCode=binding?binding.network:this._uiSourceCode;if(Sources.DebuggerPlugin.accepts(pluginUISourceCode))
this._plugins.push(new Sources.DebuggerPlugin(this.textEditor,pluginUISourceCode,this.transformer()));if(Sources.CSSPlugin.accepts(pluginUISourceCode))
this._plugins.push(new Sources.CSSPlugin(this.textEditor));if(!this.pretty&&Sources.JavaScriptCompilerPlugin.accepts(pluginUISourceCode))
this._plugins.push(new Sources.JavaScriptCompilerPlugin(this.textEditor,pluginUISourceCode));if(Sources.SnippetsPlugin.accepts(pluginUISourceCode))
this._plugins.push(new Sources.SnippetsPlugin(this.textEditor,pluginUISourceCode));if(Sources.ScriptOriginPlugin.accepts(pluginUISourceCode))
this._plugins.push(new Sources.ScriptOriginPlugin(this.textEditor,pluginUISourceCode));if(!this.pretty&&Runtime.experiments.isEnabled('sourceDiff')&&Sources.GutterDiffPlugin.accepts(pluginUISourceCode))
this._plugins.push(new Sources.GutterDiffPlugin(this.textEditor,pluginUISourceCode));this.dispatchEventToListeners(Sources.UISourceCodeFrame.Events.ToolbarItemsChanged);for(const plugin of this._plugins)
plugin.wasShown();}
_disposePlugins(){this.textEditor.operation(()=>{for(const plugin of this._plugins)
plugin.dispose();});this._plugins=[];}
_onBindingChanged(){const binding=Persistence.persistence.binding(this._uiSourceCode);if(binding===this._persistenceBinding)
return;this._unloadUISourceCode();this._persistenceBinding=binding;this._initializeUISourceCode();}
_updateStyle(){this.setEditable(this._canEditSource());}
_innerSetContent(content){this._isSettingContent=true;const oldContent=this.textEditor.text();if(this._diff)
this._diff.highlightModifiedLines(oldContent,content);if(oldContent!==content)
this.setContent(content);this._isSettingContent=false;}
async populateTextAreaContextMenu(contextMenu,editorLineNumber,editorColumnNumber){await super.populateTextAreaContextMenu(contextMenu,editorLineNumber,editorColumnNumber);contextMenu.appendApplicableItems(this._uiSourceCode);const location=this.transformer().editorToRawLocation(editorLineNumber,editorColumnNumber);contextMenu.appendApplicableItems(new Workspace.UILocation(this._uiSourceCode,location[0],location[1]));contextMenu.appendApplicableItems(this);for(const plugin of this._plugins)
await plugin.populateTextAreaContextMenu(contextMenu,editorLineNumber,editorColumnNumber);}
dispose(){this._errorPopoverHelper.dispose();this._unloadUISourceCode();this.textEditor.dispose();this.detach();Common.settings.moduleSetting('persistenceNetworkOverridesEnabled').removeChangeListener(this._onNetworkPersistenceChanged,this);}
_onMessageAdded(event){const message=(event.data);this._addMessageToSource(message);}
_addMessageToSource(message){if(!this.loaded)
return;const editorLocation=this.transformer().rawToEditorLocation(message.lineNumber(),message.columnNumber());let editorLineNumber=editorLocation[0];if(editorLineNumber>=this.textEditor.linesCount)
editorLineNumber=this.textEditor.linesCount-1;if(editorLineNumber<0)
editorLineNumber=0;let messageBucket=this._rowMessageBuckets.get(editorLineNumber);if(!messageBucket){messageBucket=new Sources.UISourceCodeFrame.RowMessageBucket(this,this.textEditor,editorLineNumber);this._rowMessageBuckets.set(editorLineNumber,messageBucket);}
messageBucket.addMessage(message);}
_onMessageRemoved(event){const message=(event.data);this._removeMessageFromSource(message);}
_removeMessageFromSource(message){if(!this.loaded)
return;const editorLocation=this.transformer().rawToEditorLocation(message.lineNumber(),message.columnNumber());let editorLineNumber=editorLocation[0];if(editorLineNumber>=this.textEditor.linesCount)
editorLineNumber=this.textEditor.linesCount-1;if(editorLineNumber<0)
editorLineNumber=0;const messageBucket=this._rowMessageBuckets.get(editorLineNumber);if(!messageBucket)
return;messageBucket.removeMessage(message);if(!messageBucket.uniqueMessagesCount()){messageBucket.detachFromEditor();this._rowMessageBuckets.delete(editorLineNumber);}}
_getErrorPopoverContent(event){const element=event.target.enclosingNodeOrSelfWithClass('text-editor-line-decoration-icon')||event.target.enclosingNodeOrSelfWithClass('text-editor-line-decoration-wave');if(!element)
return null;const anchor=element.enclosingNodeOrSelfWithClass('text-editor-line-decoration-icon')?element.boxInWindow():new AnchorBox(event.clientX,event.clientY,1,1);return{box:anchor,show:popover=>{const messageBucket=element.enclosingNodeOrSelfWithClass('text-editor-line-decoration')._messageBucket;const messagesOutline=messageBucket.messagesDescription();popover.contentElement.appendChild(messagesOutline);return Promise.resolve(true);}};}
_updateBucketDecorations(){for(const bucket of this._rowMessageBuckets.values())
bucket._updateDecoration();}
_onLineDecorationAdded(event){const marker=(event.data);this._decorateTypeThrottled(marker.type());}
_onLineDecorationRemoved(event){const marker=(event.data);this._decorateTypeThrottled(marker.type());}
async _decorateTypeThrottled(type){if(this._typeDecorationsPending.has(type))
return;this._typeDecorationsPending.add(type);const decorator=await self.runtime.extensions(SourceFrame.LineDecorator).find(extension=>extension.descriptor()['decoratorType']===type).instance();this._typeDecorationsPending.delete(type);this.textEditor.codeMirror().operation(()=>{decorator.decorate(this._persistenceBinding?this._persistenceBinding.network:this.uiSourceCode(),this.textEditor,type);});}
_decorateAllTypes(){if(!this.loaded)
return;for(const extension of self.runtime.extensions(SourceFrame.LineDecorator)){const type=extension.descriptor()['decoratorType'];if(this._uiSourceCode.decorationsForType(type))
this._decorateTypeThrottled(type);}}
syncToolbarItems(){const leftToolbarItems=super.syncToolbarItems();const rightToolbarItems=[];for(const plugin of this._plugins){leftToolbarItems.pushAll(plugin.leftToolbarItems());rightToolbarItems.pushAll(plugin.rightToolbarItems());}
if(!rightToolbarItems.length)
return leftToolbarItems;return[...leftToolbarItems,new UI.ToolbarSeparator(true),...rightToolbarItems];}
async populateLineGutterContextMenu(contextMenu,lineNumber){await super.populateLineGutterContextMenu(contextMenu,lineNumber);for(const plugin of this._plugins)
await plugin.populateLineGutterContextMenu(contextMenu,lineNumber);}};Sources.UISourceCodeFrame._iconClassPerLevel={};Sources.UISourceCodeFrame._iconClassPerLevel[Workspace.UISourceCode.Message.Level.Error]='smallicon-error';Sources.UISourceCodeFrame._iconClassPerLevel[Workspace.UISourceCode.Message.Level.Warning]='smallicon-warning';Sources.UISourceCodeFrame._bubbleTypePerLevel={};Sources.UISourceCodeFrame._bubbleTypePerLevel[Workspace.UISourceCode.Message.Level.Error]='error';Sources.UISourceCodeFrame._bubbleTypePerLevel[Workspace.UISourceCode.Message.Level.Warning]='warning';Sources.UISourceCodeFrame._lineClassPerLevel={};Sources.UISourceCodeFrame._lineClassPerLevel[Workspace.UISourceCode.Message.Level.Error]='text-editor-line-with-error';Sources.UISourceCodeFrame._lineClassPerLevel[Workspace.UISourceCode.Message.Level.Warning]='text-editor-line-with-warning';Sources.UISourceCodeFrame.RowMessage=class{constructor(message){this._message=message;this._repeatCount=1;this.element=createElementWithClass('div','text-editor-row-message');this._icon=this.element.createChild('label','','dt-icon-label');this._icon.type=Sources.UISourceCodeFrame._iconClassPerLevel[message.level()];this._repeatCountElement=this.element.createChild('span','text-editor-row-message-repeat-count hidden','dt-small-bubble');this._repeatCountElement.type=Sources.UISourceCodeFrame._bubbleTypePerLevel[message.level()];const linesContainer=this.element.createChild('div');const lines=this._message.text().split('\n');for(let i=0;i<lines.length;++i){const messageLine=linesContainer.createChild('div');messageLine.textContent=lines[i];}}
message(){return this._message;}
repeatCount(){return this._repeatCount;}
setRepeatCount(repeatCount){if(this._repeatCount===repeatCount)
return;this._repeatCount=repeatCount;this._updateMessageRepeatCount();}
_updateMessageRepeatCount(){this._repeatCountElement.textContent=this._repeatCount;const showRepeatCount=this._repeatCount>1;this._repeatCountElement.classList.toggle('hidden',!showRepeatCount);this._icon.classList.toggle('hidden',showRepeatCount);}};Sources.UISourceCodeFrame.RowMessageBucket=class{constructor(sourceFrame,textEditor,editorLineNumber){this._sourceFrame=sourceFrame;this.textEditor=textEditor;this._lineHandle=textEditor.textEditorPositionHandle(editorLineNumber,0);this._decoration=createElementWithClass('div','text-editor-line-decoration');this._decoration._messageBucket=this;this._wave=this._decoration.createChild('div','text-editor-line-decoration-wave');this._icon=this._wave.createChild('span','text-editor-line-decoration-icon','dt-icon-label');this._decorationStartColumn=null;this._messagesDescriptionElement=createElementWithClass('div','text-editor-messages-description-container');this._messages=[];this._level=null;}
_updateWavePosition(editorLineNumber,columnNumber){editorLineNumber=Math.min(editorLineNumber,this.textEditor.linesCount-1);const lineText=this.textEditor.line(editorLineNumber);columnNumber=Math.min(columnNumber,lineText.length);const lineIndent=TextUtils.TextUtils.lineIndent(lineText).length;const startColumn=Math.max(columnNumber-1,lineIndent);if(this._decorationStartColumn===startColumn)
return;if(this._decorationStartColumn!==null)
this.textEditor.removeDecoration(this._decoration,editorLineNumber);this.textEditor.addDecoration(this._decoration,editorLineNumber,startColumn);this._decorationStartColumn=startColumn;}
messagesDescription(){this._messagesDescriptionElement.removeChildren();UI.appendStyle(this._messagesDescriptionElement,'source_frame/messagesPopover.css');for(let i=0;i<this._messages.length;++i)
this._messagesDescriptionElement.appendChild(this._messages[i].element);return this._messagesDescriptionElement;}
detachFromEditor(){const position=this._lineHandle.resolve();if(!position)
return;const editorLineNumber=position.lineNumber;if(this._level){this.textEditor.toggleLineClass(editorLineNumber,Sources.UISourceCodeFrame._lineClassPerLevel[this._level],false);}
if(this._decorationStartColumn!==null){this.textEditor.removeDecoration(this._decoration,editorLineNumber);this._decorationStartColumn=null;}}
uniqueMessagesCount(){return this._messages.length;}
addMessage(message){for(let i=0;i<this._messages.length;++i){const rowMessage=this._messages[i];if(rowMessage.message().isEqual(message)){rowMessage.setRepeatCount(rowMessage.repeatCount()+1);return;}}
const rowMessage=new Sources.UISourceCodeFrame.RowMessage(message);this._messages.push(rowMessage);this._updateDecoration();}
removeMessage(message){for(let i=0;i<this._messages.length;++i){const rowMessage=this._messages[i];if(!rowMessage.message().isEqual(message))
continue;rowMessage.setRepeatCount(rowMessage.repeatCount()-1);if(!rowMessage.repeatCount())
this._messages.splice(i,1);this._updateDecoration();return;}}
_updateDecoration(){if(!this._sourceFrame.isShowing())
return;if(!this._messages.length)
return;const position=this._lineHandle.resolve();if(!position)
return;const editorLineNumber=position.lineNumber;let columnNumber=Number.MAX_VALUE;let maxMessage=null;for(let i=0;i<this._messages.length;++i){const message=this._messages[i].message();const editorLocation=this._sourceFrame.transformer().rawToEditorLocation(editorLineNumber,message.columnNumber());columnNumber=Math.min(columnNumber,editorLocation[1]);if(!maxMessage||Workspace.UISourceCode.Message.messageLevelComparator(maxMessage,message)<0)
maxMessage=message;}
this._updateWavePosition(editorLineNumber,columnNumber);if(this._level===maxMessage.level())
return;if(this._level){this.textEditor.toggleLineClass(editorLineNumber,Sources.UISourceCodeFrame._lineClassPerLevel[this._level],false);this._icon.type='';}
this._level=maxMessage.level();if(!this._level)
return;this.textEditor.toggleLineClass(editorLineNumber,Sources.UISourceCodeFrame._lineClassPerLevel[this._level],true);this._icon.type=Sources.UISourceCodeFrame._iconClassPerLevel[this._level];}};Workspace.UISourceCode.Message._messageLevelPriority={'Warning':3,'Error':4};Workspace.UISourceCode.Message.messageLevelComparator=function(a,b){return Workspace.UISourceCode.Message._messageLevelPriority[a.level()]-
Workspace.UISourceCode.Message._messageLevelPriority[b.level()];};Sources.UISourceCodeFrame.Plugin=class{static accepts(uiSourceCode){return false;}
wasShown(){}
willHide(){}
rightToolbarItems(){return[];}
leftToolbarItems(){return[];}
populateLineGutterContextMenu(contextMenu,lineNumber){return Promise.resolve();}
populateTextAreaContextMenu(contextMenu,lineNumber,columnNumber){return Promise.resolve();}
dispose(){}};Sources.UISourceCodeFrame.Events={ToolbarItemsChanged:Symbol('ToolbarItemsChanged')};;Sources.DebuggerPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(textEditor,uiSourceCode,transformer){super();this._textEditor=textEditor;this._uiSourceCode=uiSourceCode;this._transformer=transformer;this._executionLocation=null;this._controlDown=false;this._asyncStepInHoveredLine=0;this._asyncStepInHovered=false;this._clearValueWidgetsTimer=null;this._sourceMapInfobar=null;this._controlTimeout=null;this._scriptsPanel=Sources.SourcesPanel.instance();this._breakpointManager=Bindings.breakpointManager;if(uiSourceCode.project().type()===Workspace.projectTypes.Debugger)
this._textEditor.element.classList.add('source-frame-debugger-script');this._popoverHelper=new UI.PopoverHelper(this._scriptsPanel.element,this._getPopoverRequest.bind(this));this._popoverHelper.setDisableOnClick(true);this._popoverHelper.setTimeout(250,250);this._popoverHelper.setHasPadding(true);this._boundPopoverHelperHide=this._popoverHelper.hidePopover.bind(this._popoverHelper);this._scriptsPanel.element.addEventListener('scroll',this._boundPopoverHelperHide,true);this._boundKeyDown=(this._onKeyDown.bind(this));this._textEditor.element.addEventListener('keydown',this._boundKeyDown,true);this._boundKeyUp=(this._onKeyUp.bind(this));this._textEditor.element.addEventListener('keyup',this._boundKeyUp,true);this._boundMouseMove=(this._onMouseMove.bind(this));this._textEditor.element.addEventListener('mousemove',this._boundMouseMove,false);this._boundMouseDown=(this._onMouseDown.bind(this));this._textEditor.element.addEventListener('mousedown',this._boundMouseDown,true);this._boundBlur=this._onBlur.bind(this);this._textEditor.element.addEventListener('focusout',this._boundBlur,false);this._boundWheel=event=>{if(this._executionLocation&&UI.KeyboardShortcut.eventHasCtrlOrMeta(event))
event.preventDefault();};this._textEditor.element.addEventListener('wheel',this._boundWheel,true);this._textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.GutterClick,this._handleGutterClick,this);this._breakpointManager.addEventListener(Bindings.BreakpointManager.Events.BreakpointAdded,this._breakpointAdded,this);this._breakpointManager.addEventListener(Bindings.BreakpointManager.Events.BreakpointRemoved,this._breakpointRemoved,this);this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._workingCopyChanged,this);this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._workingCopyCommitted,this);this._breakpointDecorations=new Set();this._decorationByBreakpoint=new Map();this._possibleBreakpointsRequested=new Set();this._scriptFileForDebuggerModel=new Map();Common.moduleSetting('skipStackFramesPattern').addChangeListener(this._showBlackboxInfobarIfNeeded,this);Common.moduleSetting('skipContentScripts').addChangeListener(this._showBlackboxInfobarIfNeeded,this);this._valueWidgets=new Map();this._continueToLocationDecorations=null;UI.context.addFlavorChangeListener(SDK.DebuggerModel.CallFrame,this._callFrameChanged,this);this._liveLocationPool=new Bindings.LiveLocationPool();this._callFrameChanged();this._updateScriptFiles();if(this._uiSourceCode.isDirty()){this._muted=true;this._mutedFromStart=true;}else{this._muted=false;this._mutedFromStart=false;this._initializeBreakpoints();}
this._blackboxInfobar=null;this._showBlackboxInfobarIfNeeded();const scriptFiles=this._scriptFileForDebuggerModel.valuesArray();for(let i=0;i<scriptFiles.length;++i)
scriptFiles[i].checkMapping();this._hasLineWithoutMapping=false;this._updateLinesWithoutMappingHighlight();if(!Runtime.experiments.isEnabled('sourcesPrettyPrint')){this._prettyPrintInfobar=null;this._detectMinified();}}
static accepts(uiSourceCode){return uiSourceCode.contentType().hasScripts();}
_showBlackboxInfobarIfNeeded(){const uiSourceCode=this._uiSourceCode;if(!uiSourceCode.contentType().hasScripts())
return;const projectType=uiSourceCode.project().type();if(!Bindings.blackboxManager.isBlackboxedUISourceCode(uiSourceCode)){this._hideBlackboxInfobar();return;}
if(this._blackboxInfobar)
this._blackboxInfobar.dispose();const infobar=new UI.Infobar(UI.Infobar.Type.Warning,Common.UIString('This script is marked as Library code in the debugger'));this._blackboxInfobar=infobar;infobar.createDetailsRowMessage(Common.UIString('Debugger will skip stepping through this script, and will not stop on exceptions'));const scriptFile=this._scriptFileForDebuggerModel.size?this._scriptFileForDebuggerModel.valuesArray()[0]:null;if(scriptFile&&scriptFile.hasSourceMapURL())
infobar.createDetailsRowMessage(Common.UIString('Source map found, but ignored for file marked as Library code.'));infobar.createDetailsRowMessage();infobar.createDetailsRowMessage(Common.UIString('Possible ways to cancel this behavior are:'));infobar.createDetailsRowMessage(' - ').createTextChild(Common.UIString('Go to "%s" tab in settings',Common.UIString('Library code')));const unblackboxLink=infobar.createDetailsRowMessage(' - ').createChild('span','link');unblackboxLink.textContent=Common.UIString('Mark as my code');unblackboxLink.addEventListener('click',unblackbox,false);function unblackbox(){Bindings.blackboxManager.unblackboxUISourceCode(uiSourceCode);if(projectType===Workspace.projectTypes.ContentScripts)
Bindings.blackboxManager.unblackboxContentScripts();}
this._textEditor.attachInfobar(this._blackboxInfobar);}
_hideBlackboxInfobar(){if(!this._blackboxInfobar)
return;this._blackboxInfobar.dispose();this._blackboxInfobar=null;}
wasShown(){if(this._executionLocation){setImmediate(()=>{this._generateValuesInSource();});}}
willHide(){this._popoverHelper.hidePopover();}
populateLineGutterContextMenu(contextMenu,editorLineNumber){function populate(resolve,reject){const uiLocation=new Workspace.UILocation(this._uiSourceCode,editorLineNumber,0);this._scriptsPanel.appendUILocationItems(contextMenu,uiLocation);const breakpoints=this._lineBreakpointDecorations(editorLineNumber).map(decoration=>decoration.breakpoint).filter(breakpoint=>!!breakpoint);if(!breakpoints.length){contextMenu.debugSection().appendItem(Common.UIString('Add breakpoint'),this._createNewBreakpoint.bind(this,editorLineNumber,'',true));contextMenu.debugSection().appendItem(Common.UIString('Add conditional breakpoint\u2026'),this._editBreakpointCondition.bind(this,editorLineNumber,null,null));contextMenu.debugSection().appendItem(ls`Add logpoint\u2026`,this._editBreakpointCondition.bind(this,editorLineNumber,null,null,true));contextMenu.debugSection().appendItem(Common.UIString('Never pause here'),this._createNewBreakpoint.bind(this,editorLineNumber,'false',true));}else{const hasOneBreakpoint=breakpoints.length===1;const removeTitle=hasOneBreakpoint?Common.UIString('Remove breakpoint'):Common.UIString('Remove all breakpoints in line');contextMenu.debugSection().appendItem(removeTitle,()=>breakpoints.map(breakpoint=>breakpoint.remove()));if(hasOneBreakpoint){contextMenu.debugSection().appendItem(Common.UIString('Edit breakpoint\u2026'),this._editBreakpointCondition.bind(this,editorLineNumber,breakpoints[0],null));}
const hasEnabled=breakpoints.some(breakpoint=>breakpoint.enabled());if(hasEnabled){const title=hasOneBreakpoint?Common.UIString('Disable breakpoint'):Common.UIString('Disable all breakpoints in line');contextMenu.debugSection().appendItem(title,()=>breakpoints.map(breakpoint=>breakpoint.setEnabled(false)));}
const hasDisabled=breakpoints.some(breakpoint=>!breakpoint.enabled());if(hasDisabled){const title=hasOneBreakpoint?Common.UIString('Enable breakpoint'):Common.UIString('Enabled all breakpoints in line');contextMenu.debugSection().appendItem(title,()=>breakpoints.map(breakpoint=>breakpoint.setEnabled(true)));}}
resolve();}
return new Promise(populate.bind(this));}
populateTextAreaContextMenu(contextMenu,editorLineNumber,editorColumnNumber){function addSourceMapURL(scriptFile){Sources.AddSourceMapURLDialog.show(addSourceMapURLDialogCallback.bind(null,scriptFile));}
function addSourceMapURLDialogCallback(scriptFile,url){if(!url)
return;scriptFile.addSourceMapURL(url);}
function populateSourceMapMembers(){if(this._uiSourceCode.project().type()===Workspace.projectTypes.Network&&Common.moduleSetting('jsSourceMapsEnabled').get()&&!Bindings.blackboxManager.isBlackboxedUISourceCode(this._uiSourceCode)){if(this._scriptFileForDebuggerModel.size){const scriptFile=this._scriptFileForDebuggerModel.valuesArray()[0];const addSourceMapURLLabel=Common.UIString('Add source map\u2026');contextMenu.debugSection().appendItem(addSourceMapURLLabel,addSourceMapURL.bind(null,scriptFile));}}}
return super.populateTextAreaContextMenu(contextMenu,editorLineNumber,editorColumnNumber).then(populateSourceMapMembers.bind(this));}
_workingCopyChanged(){if(this._scriptFileForDebuggerModel.size)
return;if(this._uiSourceCode.isDirty())
this._muteBreakpointsWhileEditing();else
this._restoreBreakpointsAfterEditing();}
_workingCopyCommitted(event){this._scriptsPanel.updateLastModificationTime();if(!this._scriptFileForDebuggerModel.size)
this._restoreBreakpointsAfterEditing();}
_didMergeToVM(){this._restoreBreakpointsIfConsistentScripts();}
_didDivergeFromVM(){this._muteBreakpointsWhileEditing();}
_muteBreakpointsWhileEditing(){if(this._muted)
return;for(const decoration of this._breakpointDecorations)
this._updateBreakpointDecoration(decoration);this._muted=true;}
_restoreBreakpointsIfConsistentScripts(){const scriptFiles=this._scriptFileForDebuggerModel.valuesArray();for(let i=0;i<scriptFiles.length;++i){if(scriptFiles[i].hasDivergedFromVM()||scriptFiles[i].isMergingToVM())
return;}
this._restoreBreakpointsAfterEditing();}
_restoreBreakpointsAfterEditing(){this._muted=false;if(this._mutedFromStart){this._mutedFromStart=false;this._initializeBreakpoints();return;}
const decorations=Array.from(this._breakpointDecorations);this._breakpointDecorations.clear();this._textEditor.operation(()=>decorations.map(decoration=>decoration.hide()));for(const decoration of decorations){if(!decoration.breakpoint)
continue;const enabled=decoration.enabled;decoration.breakpoint.remove();const location=decoration.handle.resolve();if(location)
this._setBreakpoint(location.lineNumber,location.columnNumber,decoration.condition,enabled);}}
_isIdentifier(tokenType){return tokenType.startsWith('js-variable')||tokenType.startsWith('js-property')||tokenType==='js-def';}
_getPopoverRequest(event){if(UI.KeyboardShortcut.eventHasCtrlOrMeta(event))
return null;const target=UI.context.flavor(SDK.Target);const debuggerModel=target?target.model(SDK.DebuggerModel):null;if(!debuggerModel||!debuggerModel.isPaused())
return null;const textPosition=this._textEditor.coordinatesToCursorPosition(event.x,event.y);if(!textPosition)
return null;const mouseLine=textPosition.startLine;const mouseColumn=textPosition.startColumn;const textSelection=this._textEditor.selection().normalize();let anchorBox;let editorLineNumber;let startHighlight;let endHighlight;if(textSelection&&!textSelection.isEmpty()){if(textSelection.startLine!==textSelection.endLine||textSelection.startLine!==mouseLine||mouseColumn<textSelection.startColumn||mouseColumn>textSelection.endColumn)
return null;const leftCorner=this._textEditor.cursorPositionToCoordinates(textSelection.startLine,textSelection.startColumn);const rightCorner=this._textEditor.cursorPositionToCoordinates(textSelection.endLine,textSelection.endColumn);anchorBox=new AnchorBox(leftCorner.x,leftCorner.y,rightCorner.x-leftCorner.x,leftCorner.height);editorLineNumber=textSelection.startLine;startHighlight=textSelection.startColumn;endHighlight=textSelection.endColumn-1;}else{const token=this._textEditor.tokenAtTextPosition(textPosition.startLine,textPosition.startColumn);if(!token||!token.type)
return null;editorLineNumber=textPosition.startLine;const line=this._textEditor.line(editorLineNumber);const tokenContent=line.substring(token.startColumn,token.endColumn);const isIdentifier=this._isIdentifier(token.type);if(!isIdentifier&&(token.type!=='js-keyword'||tokenContent!=='this'))
return null;const leftCorner=this._textEditor.cursorPositionToCoordinates(editorLineNumber,token.startColumn);const rightCorner=this._textEditor.cursorPositionToCoordinates(editorLineNumber,token.endColumn-1);anchorBox=new AnchorBox(leftCorner.x,leftCorner.y,rightCorner.x-leftCorner.x,leftCorner.height);startHighlight=token.startColumn;endHighlight=token.endColumn-1;while(startHighlight>1&&line.charAt(startHighlight-1)==='.'){const tokenBefore=this._textEditor.tokenAtTextPosition(editorLineNumber,startHighlight-2);if(!tokenBefore||!tokenBefore.type)
return null;if(tokenBefore.type==='js-meta')
break;startHighlight=tokenBefore.startColumn;}}
let objectPopoverHelper;let highlightDescriptor;return{box:anchorBox,show:async popover=>{const selectedCallFrame=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!selectedCallFrame)
return false;const evaluationText=this._textEditor.line(editorLineNumber).substring(startHighlight,endHighlight+1);const resolvedText=await Sources.SourceMapNamesResolver.resolveExpression((selectedCallFrame),evaluationText,this._uiSourceCode,editorLineNumber,startHighlight,endHighlight);const result=await selectedCallFrame.evaluate({expression:resolvedText||evaluationText,objectGroup:'popover',includeCommandLineAPI:false,silent:true,returnByValue:false,generatePreview:false});if(!result.object)
return false;objectPopoverHelper=await ObjectUI.ObjectPopoverHelper.buildObjectPopover(result.object,popover);const potentiallyUpdatedCallFrame=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!objectPopoverHelper||selectedCallFrame!==potentiallyUpdatedCallFrame){debuggerModel.runtimeModel().releaseObjectGroup('popover');if(objectPopoverHelper)
objectPopoverHelper.dispose();return false;}
const highlightRange=new TextUtils.TextRange(editorLineNumber,startHighlight,editorLineNumber,endHighlight);highlightDescriptor=this._textEditor.highlightRange(highlightRange,'source-frame-eval-expression');return true;},hide:()=>{objectPopoverHelper.dispose();debuggerModel.runtimeModel().releaseObjectGroup('popover');this._textEditor.removeHighlight(highlightDescriptor);}};}
_onKeyDown(event){this._clearControlDown();if(event.key==='Escape'){if(this._popoverHelper.isPopoverVisible()){this._popoverHelper.hidePopover();event.consume();}
return;}
if(UI.shortcutRegistry.eventMatchesAction(event,'debugger.toggle-breakpoint')){const selection=this._textEditor.selection();if(!selection)
return;this._toggleBreakpoint(selection.startLine,false);event.consume(true);return;}
if(UI.shortcutRegistry.eventMatchesAction(event,'debugger.toggle-breakpoint-enabled')){const selection=this._textEditor.selection();if(!selection)
return;this._toggleBreakpoint(selection.startLine,true);event.consume(true);return;}
if(UI.shortcutRegistry.eventMatchesAction(event,'debugger.breakpoint-input-window')){const selection=this._textEditor.selection();if(!selection)
return;const breakpoints=this._lineBreakpointDecorations(selection.startLine).map(decoration=>decoration.breakpoint).filter(breakpoint=>!!breakpoint);let breakpoint;if(breakpoints.length)
breakpoint=breakpoints[0];const isLogpoint=breakpoint?breakpoint.condition().includes(Sources.BreakpointEditDialog.LogpointPrefix):false;this._editBreakpointCondition(selection.startLine,breakpoint,null,isLogpoint);event.consume(true);return;}
if(UI.KeyboardShortcut.eventHasCtrlOrMeta(event)&&this._executionLocation){this._controlDown=true;if(event.key===(Host.isMac()?'Meta':'Control')){this._controlTimeout=setTimeout(()=>{if(this._executionLocation&&this._controlDown)
this._showContinueToLocations();},150);}}}
_onMouseMove(event){if(this._executionLocation&&this._controlDown&&UI.KeyboardShortcut.eventHasCtrlOrMeta(event)){if(!this._continueToLocationDecorations)
this._showContinueToLocations();}
if(this._continueToLocationDecorations){const textPosition=this._textEditor.coordinatesToCursorPosition(event.x,event.y);const hovering=!!event.target.enclosingNodeOrSelfWithClass('source-frame-async-step-in');this._setAsyncStepInHoveredLine(textPosition?textPosition.startLine:null,hovering);}}
_setAsyncStepInHoveredLine(editorLineNumber,hovered){if(this._asyncStepInHoveredLine===editorLineNumber&&this._asyncStepInHovered===hovered)
return;if(this._asyncStepInHovered&&this._asyncStepInHoveredLine)
this._textEditor.toggleLineClass(this._asyncStepInHoveredLine,'source-frame-async-step-in-hovered',false);this._asyncStepInHoveredLine=editorLineNumber;this._asyncStepInHovered=hovered;if(this._asyncStepInHovered&&this._asyncStepInHoveredLine)
this._textEditor.toggleLineClass(this._asyncStepInHoveredLine,'source-frame-async-step-in-hovered',true);}
_onMouseDown(event){if(!this._executionLocation||!UI.KeyboardShortcut.eventHasCtrlOrMeta(event))
return;if(!this._continueToLocationDecorations)
return;event.consume();const textPosition=this._textEditor.coordinatesToCursorPosition(event.x,event.y);if(!textPosition)
return;for(const decoration of this._continueToLocationDecorations.keys()){const range=decoration.find();if(range.from.line!==textPosition.startLine||range.to.line!==textPosition.startLine)
continue;if(range.from.ch<=textPosition.startColumn&&textPosition.startColumn<=range.to.ch){this._continueToLocationDecorations.get(decoration)();break;}}}
_onBlur(event){if(this._textEditor.element.isAncestor((event.target)))
return;this._clearControlDown();}
_onKeyUp(event){this._clearControlDown();}
_clearControlDown(){this._controlDown=false;this._clearContinueToLocations();clearTimeout(this._controlTimeout);}
async _editBreakpointCondition(editorLineNumber,breakpoint,location,preferLogpoint){const oldCondition=breakpoint?breakpoint.condition():'';const decorationElement=createElement('div');const dialog=new Sources.BreakpointEditDialog(editorLineNumber,oldCondition,!!preferLogpoint,result=>{dialog.detach();this._textEditor.removeDecoration(decorationElement,editorLineNumber);if(!result.committed)
return;if(breakpoint)
breakpoint.setCondition(result.condition);else if(location)
this._setBreakpoint(location.lineNumber,location.columnNumber,result.condition,true);else
this._createNewBreakpoint(editorLineNumber,result.condition,true);});this._textEditor.addDecoration(decorationElement,editorLineNumber);dialog.show(decorationElement);}
_executionLineChanged(liveLocation){this._clearExecutionLine();const uiLocation=liveLocation.uiLocation();if(!uiLocation||uiLocation.uiSourceCode!==this._uiSourceCode){this._executionLocation=null;return;}
this._executionLocation=uiLocation;const editorLocation=this._transformer.rawToEditorLocation(uiLocation.lineNumber,uiLocation.columnNumber);this._textEditor.setExecutionLocation(editorLocation[0],editorLocation[1]);if(this._textEditor.isShowing()){setImmediate(()=>{if(this._controlDown)
this._showContinueToLocations();else
this._generateValuesInSource();});}}
_generateValuesInSource(){if(!Common.moduleSetting('inlineVariableValues').get())
return;const executionContext=UI.context.flavor(SDK.ExecutionContext);if(!executionContext)
return;const callFrame=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!callFrame)
return;const localScope=callFrame.localScope();const functionLocation=callFrame.functionLocation();if(localScope&&functionLocation){Sources.SourceMapNamesResolver.resolveScopeInObject(localScope).getAllProperties(false,false).then(this._prepareScopeVariables.bind(this,callFrame));}}
_showContinueToLocations(){this._popoverHelper.hidePopover();const executionContext=UI.context.flavor(SDK.ExecutionContext);if(!executionContext)
return;const callFrame=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!callFrame)
return;const start=callFrame.functionLocation()||callFrame.location();const debuggerModel=callFrame.debuggerModel;debuggerModel.getPossibleBreakpoints(start,null,true).then(locations=>this._textEditor.operation(renderLocations.bind(this,locations)));function renderLocations(locations){this._clearContinueToLocationsNoRestore();this._textEditor.hideExecutionLineBackground();this._clearValueWidgets();this._continueToLocationDecorations=new Map();locations=locations.reverse();let previousCallLine=-1;for(const location of locations){const editorLocation=this._transformer.rawToEditorLocation(location.lineNumber,location.columnNumber);let token=this._textEditor.tokenAtTextPosition(editorLocation[0],editorLocation[1]);if(!token)
continue;const line=this._textEditor.line(editorLocation[0]);let tokenContent=line.substring(token.startColumn,token.endColumn);if(!token.type&&tokenContent==='.'){token=this._textEditor.tokenAtTextPosition(editorLocation[0],token.endColumn+1);tokenContent=line.substring(token.startColumn,token.endColumn);}
if(!token.type)
continue;const validKeyword=token.type==='js-keyword'&&(tokenContent==='this'||tokenContent==='return'||tokenContent==='new'||tokenContent==='continue'||tokenContent==='break');if(!validKeyword&&!this._isIdentifier(token.type))
continue;if(previousCallLine===editorLocation[0]&&location.type!==Protocol.Debugger.BreakLocationType.Call)
continue;let highlightRange=new TextUtils.TextRange(editorLocation[0],token.startColumn,editorLocation[0],token.endColumn-1);let decoration=this._textEditor.highlightRange(highlightRange,'source-frame-continue-to-location');this._continueToLocationDecorations.set(decoration,location.continueToLocation.bind(location));if(location.type===Protocol.Debugger.BreakLocationType.Call)
previousCallLine=editorLocation[0];let isAsyncCall=(line[token.startColumn-1]==='.'&&tokenContent==='then')||tokenContent==='setTimeout'||tokenContent==='setInterval'||tokenContent==='postMessage';if(tokenContent==='new'){token=this._textEditor.tokenAtTextPosition(editorLocation[0],token.endColumn+1);tokenContent=line.substring(token.startColumn,token.endColumn);isAsyncCall=tokenContent==='Worker';}
const isCurrentPosition=this._executionLocation&&location.lineNumber===this._executionLocation.lineNumber&&location.columnNumber===this._executionLocation.columnNumber;if(location.type===Protocol.Debugger.BreakLocationType.Call&&isAsyncCall){const asyncStepInRange=this._findAsyncStepInRange(this._textEditor,editorLocation[0],line,token.endColumn);if(asyncStepInRange){highlightRange=new TextUtils.TextRange(editorLocation[0],asyncStepInRange.from,editorLocation[0],asyncStepInRange.to-1);decoration=this._textEditor.highlightRange(highlightRange,'source-frame-async-step-in');this._continueToLocationDecorations.set(decoration,this._asyncStepIn.bind(this,location,!!isCurrentPosition));}}}
this._continueToLocationRenderedForTest();}}
_continueToLocationRenderedForTest(){}
_findAsyncStepInRange(textEditor,editorLineNumber,line,column){let token;let tokenText;let from=column;let to=line.length;let position=line.indexOf('(',column);const argumentsStart=position;if(position===-1)
return null;position++;skipWhitespace();if(position>=line.length)
return null;nextToken();if(!token)
return null;from=token.startColumn;if(token.type==='js-keyword'&&tokenText==='async'){skipWhitespace();if(position>=line.length)
return{from:from,to:to};nextToken();if(!token)
return{from:from,to:to};}
if(token.type==='js-keyword'&&tokenText==='function')
return{from:from,to:to};if(token.type==='js-string')
return{from:argumentsStart,to:to};if(token.type&&this._isIdentifier(token.type))
return{from:from,to:to};if(tokenText!=='(')
return null;const closeParen=line.indexOf(')',position);if(closeParen===-1||line.substring(position,closeParen).indexOf('(')!==-1)
return{from:from,to:to};return{from:from,to:closeParen+1};function nextToken(){token=textEditor.tokenAtTextPosition(editorLineNumber,position);if(token){position=token.endColumn;to=token.endColumn;tokenText=line.substring(token.startColumn,token.endColumn);}}
function skipWhitespace(){while(position<line.length){if(line[position]===' '){position++;continue;}
const token=textEditor.tokenAtTextPosition(editorLineNumber,position);if(token.type==='js-comment'){position=token.endColumn;continue;}
break;}}}
_asyncStepIn(location,isCurrentPosition){if(!isCurrentPosition)
location.continueToLocation(asyncStepIn);else
asyncStepIn();function asyncStepIn(){location.debuggerModel.scheduleStepIntoAsync();}}
_prepareScopeVariables(callFrame,allProperties){const properties=allProperties.properties;this._clearValueWidgets();if(!properties||!properties.length||properties.length>500||!this._textEditor.isShowing())
return;const functionUILocation=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation((callFrame.functionLocation()));const executionUILocation=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(callFrame.location());if(!functionUILocation||!executionUILocation||functionUILocation.uiSourceCode!==this._uiSourceCode||executionUILocation.uiSourceCode!==this._uiSourceCode)
return;const functionEditorLocation=this._transformer.rawToEditorLocation(functionUILocation.lineNumber,functionUILocation.columnNumber);const executionEditorLocation=this._transformer.rawToEditorLocation(executionUILocation.lineNumber,executionUILocation.columnNumber);const fromLine=functionEditorLocation[0];const fromColumn=functionEditorLocation[1];const toLine=executionEditorLocation[0];if(fromLine>=toLine||toLine-fromLine>500||fromLine<0||toLine>=this._textEditor.linesCount)
return;const valuesMap=new Map();for(const property of properties)
valuesMap.set(property.name,property.value);const namesPerLine=new Map();let skipObjectProperty=false;const tokenizer=new TextEditor.CodeMirrorUtils.TokenizerFactory().createTokenizer('text/javascript');tokenizer(this._textEditor.line(fromLine).substring(fromColumn),processToken.bind(this,fromLine));for(let i=fromLine+1;i<toLine;++i)
tokenizer(this._textEditor.line(i),processToken.bind(this,i));function processToken(editorLineNumber,tokenValue,tokenType,column,newColumn){if(!skipObjectProperty&&tokenType&&this._isIdentifier(tokenType)&&valuesMap.get(tokenValue)){let names=namesPerLine.get(editorLineNumber);if(!names){names=new Set();namesPerLine.set(editorLineNumber,names);}
names.add(tokenValue);}
skipObjectProperty=tokenValue==='.';}
this._textEditor.operation(this._renderDecorations.bind(this,valuesMap,namesPerLine,fromLine,toLine));}
_renderDecorations(valuesMap,namesPerLine,fromLine,toLine){const formatter=new ObjectUI.RemoteObjectPreviewFormatter();for(let i=fromLine;i<toLine;++i){const names=namesPerLine.get(i);const oldWidget=this._valueWidgets.get(i);if(!names){if(oldWidget){this._valueWidgets.delete(i);this._textEditor.removeDecoration(oldWidget,i);}
continue;}
const widget=createElementWithClass('div','text-editor-value-decoration');const base=this._textEditor.cursorPositionToCoordinates(i,0);const offset=this._textEditor.cursorPositionToCoordinates(i,this._textEditor.line(i).length);const codeMirrorLinesLeftPadding=4;const left=offset.x-base.x+codeMirrorLinesLeftPadding;widget.style.left=left+'px';widget.__nameToToken=new Map();let renderedNameCount=0;for(const name of names){if(renderedNameCount>10)
break;if(namesPerLine.get(i-1)&&namesPerLine.get(i-1).has(name))
continue;if(renderedNameCount)
widget.createTextChild(', ');const nameValuePair=widget.createChild('span');widget.__nameToToken.set(name,nameValuePair);nameValuePair.createTextChild(name+' = ');const value=valuesMap.get(name);const propertyCount=value.preview?value.preview.properties.length:0;const entryCount=value.preview&&value.preview.entries?value.preview.entries.length:0;if(value.preview&&propertyCount+entryCount<10){formatter.appendObjectPreview(nameValuePair,value.preview,false);}else{nameValuePair.appendChild(ObjectUI.ObjectPropertiesSection.createValueElement(value,false,false));}
++renderedNameCount;}
let widgetChanged=true;if(oldWidget){widgetChanged=false;for(const name of widget.__nameToToken.keys()){const oldText=oldWidget.__nameToToken.get(name)?oldWidget.__nameToToken.get(name).textContent:'';const newText=widget.__nameToToken.get(name)?widget.__nameToToken.get(name).textContent:'';if(newText!==oldText){widgetChanged=true;UI.runCSSAnimationOnce((widget.__nameToToken.get(name)),'source-frame-value-update-highlight');}}
if(widgetChanged){this._valueWidgets.delete(i);this._textEditor.removeDecoration(oldWidget,i);}}
if(widgetChanged){this._valueWidgets.set(i,widget);this._textEditor.addDecoration(widget,i);}}}
_clearExecutionLine(){this._textEditor.operation(()=>{if(this._executionLocation)
this._textEditor.clearExecutionLine();this._executionLocation=null;if(this._clearValueWidgetsTimer){clearTimeout(this._clearValueWidgetsTimer);this._clearValueWidgetsTimer=null;}
this._clearValueWidgetsTimer=setTimeout(this._clearValueWidgets.bind(this),1000);this._clearContinueToLocationsNoRestore();});}
_clearValueWidgets(){clearTimeout(this._clearValueWidgetsTimer);this._clearValueWidgetsTimer=null;this._textEditor.operation(()=>{for(const line of this._valueWidgets.keys())
this._textEditor.removeDecoration(this._valueWidgets.get(line),line);this._valueWidgets.clear();});}
_clearContinueToLocationsNoRestore(){if(!this._continueToLocationDecorations)
return;this._textEditor.operation(()=>{for(const decoration of this._continueToLocationDecorations.keys())
this._textEditor.removeHighlight(decoration);this._continueToLocationDecorations=null;this._setAsyncStepInHoveredLine(null,false);});}
_clearContinueToLocations(){if(!this._continueToLocationDecorations)
return;this._textEditor.operation(()=>{this._textEditor.showExecutionLineBackground();this._generateValuesInSource();this._clearContinueToLocationsNoRestore();});}
_lineBreakpointDecorations(lineNumber){return Array.from(this._breakpointDecorations).filter(decoration=>(decoration.handle.resolve()||{}).lineNumber===lineNumber);}
_breakpointDecoration(editorLineNumber,editorColumnNumber){for(const decoration of this._breakpointDecorations){const location=decoration.handle.resolve();if(!location)
continue;if(location.lineNumber===editorLineNumber&&location.columnNumber===editorColumnNumber)
return decoration;}
return null;}
_updateBreakpointDecoration(decoration){if(!this._scheduledBreakpointDecorationUpdates){this._scheduledBreakpointDecorationUpdates=new Set();setImmediate(()=>this._textEditor.operation(update.bind(this)));}
this._scheduledBreakpointDecorationUpdates.add(decoration);function update(){if(!this._scheduledBreakpointDecorationUpdates)
return;const editorLineNumbers=new Set();for(const decoration of this._scheduledBreakpointDecorationUpdates){const location=decoration.handle.resolve();if(!location)
continue;editorLineNumbers.add(location.lineNumber);}
this._scheduledBreakpointDecorationUpdates=null;let waitingForInlineDecorations=false;for(const lineNumber of editorLineNumbers){const decorations=this._lineBreakpointDecorations(lineNumber);updateGutter.call(this,lineNumber,decorations);if(this._possibleBreakpointsRequested.has(lineNumber)){waitingForInlineDecorations=true;continue;}
updateInlineDecorations.call(this,lineNumber,decorations);}
if(!waitingForInlineDecorations)
this._breakpointDecorationsUpdatedForTest();}
function updateGutter(editorLineNumber,decorations){this._textEditor.toggleLineClass(editorLineNumber,'cm-breakpoint',false);this._textEditor.toggleLineClass(editorLineNumber,'cm-breakpoint-disabled',false);this._textEditor.toggleLineClass(editorLineNumber,'cm-breakpoint-conditional',false);if(decorations.length){decorations.sort(Sources.DebuggerPlugin.BreakpointDecoration.mostSpecificFirst);this._textEditor.toggleLineClass(editorLineNumber,'cm-breakpoint',true);this._textEditor.toggleLineClass(editorLineNumber,'cm-breakpoint-disabled',!decorations[0].enabled||this._muted);this._textEditor.toggleLineClass(editorLineNumber,'cm-breakpoint-conditional',!!decorations[0].condition);}}
function updateInlineDecorations(editorLineNumber,decorations){const actualBookmarks=new Set(decorations.map(decoration=>decoration.bookmark).filter(bookmark=>!!bookmark));const lineEnd=this._textEditor.line(editorLineNumber).length;const bookmarks=this._textEditor.bookmarks(new TextUtils.TextRange(editorLineNumber,0,editorLineNumber,lineEnd),Sources.DebuggerPlugin.BreakpointDecoration.bookmarkSymbol);for(const bookmark of bookmarks){if(!actualBookmarks.has(bookmark))
bookmark.clear();}
if(!decorations.length)
return;if(decorations.length>1){for(const decoration of decorations){decoration.update();if(!this._muted)
decoration.show();else
decoration.hide();}}else{decorations[0].update();decorations[0].hide();}}}
_breakpointDecorationsUpdatedForTest(){}
_inlineBreakpointClick(decoration,event){event.consume(true);if(decoration.breakpoint){if(event.shiftKey)
decoration.breakpoint.setEnabled(!decoration.breakpoint.enabled());else
decoration.breakpoint.remove();}else{const editorLocation=decoration.handle.resolve();if(!editorLocation)
return;const location=this._transformer.editorToRawLocation(editorLocation.lineNumber,editorLocation.columnNumber);this._setBreakpoint(location[0],location[1],decoration.condition,true);}}
_inlineBreakpointContextMenu(decoration,event){event.consume(true);const editorLocation=decoration.handle.resolve();if(!editorLocation)
return;const location=this._transformer.editorToRawLocation(editorLocation[0],editorLocation[1]);const contextMenu=new UI.ContextMenu(event);if(decoration.breakpoint){contextMenu.debugSection().appendItem(Common.UIString('Edit breakpoint\u2026'),this._editBreakpointCondition.bind(this,editorLocation.lineNumber,decoration.breakpoint,null));}else{contextMenu.debugSection().appendItem(Common.UIString('Add conditional breakpoint\u2026'),this._editBreakpointCondition.bind(this,editorLocation.lineNumber,null,editorLocation));contextMenu.debugSection().appendItem(ls`Add logpoint\u2026`,this._editBreakpointCondition.bind(this,editorLocation.lineNumber,null,editorLocation,true));contextMenu.debugSection().appendItem(Common.UIString('Never pause here'),this._setBreakpoint.bind(this,location[0],location[1],'false',true));}
contextMenu.show();}
_shouldIgnoreExternalBreakpointEvents(event){const uiLocation=(event.data.uiLocation);if(uiLocation.uiSourceCode!==this._uiSourceCode)
return true;if(this._muted)
return true;const scriptFiles=this._scriptFileForDebuggerModel.valuesArray();for(let i=0;i<scriptFiles.length;++i){if(scriptFiles[i].isDivergingFromVM()||scriptFiles[i].isMergingToVM())
return true;}
return false;}
_breakpointAdded(event){if(this._shouldIgnoreExternalBreakpointEvents(event))
return;const uiLocation=(event.data.uiLocation);const breakpoint=(event.data.breakpoint);this._addBreakpoint(uiLocation,breakpoint);}
_addBreakpoint(uiLocation,breakpoint){const editorLocation=this._transformer.rawToEditorLocation(uiLocation.lineNumber,uiLocation.columnNumber);const lineDecorations=this._lineBreakpointDecorations(uiLocation.lineNumber);let decoration=this._breakpointDecoration(editorLocation[0],editorLocation[1]);if(decoration){decoration.breakpoint=breakpoint;decoration.condition=breakpoint.condition();decoration.enabled=breakpoint.enabled();}else{const handle=this._textEditor.textEditorPositionHandle(editorLocation[0],editorLocation[1]);decoration=new Sources.DebuggerPlugin.BreakpointDecoration(this._textEditor,handle,breakpoint.condition(),breakpoint.enabled(),breakpoint);decoration.element.addEventListener('click',this._inlineBreakpointClick.bind(this,decoration),true);decoration.element.addEventListener('contextmenu',this._inlineBreakpointContextMenu.bind(this,decoration),true);this._breakpointDecorations.add(decoration);}
this._decorationByBreakpoint.set(breakpoint,decoration);this._updateBreakpointDecoration(decoration);if(breakpoint.enabled()&&!lineDecorations.length){this._possibleBreakpointsRequested.add(editorLocation[0]);const start=this._transformer.editorToRawLocation(editorLocation[0],0);const end=this._transformer.editorToRawLocation(editorLocation[0]+1,0);this._breakpointManager.possibleBreakpoints(this._uiSourceCode,new TextUtils.TextRange(start[0],start[1],end[0],end[1])).then(addInlineDecorations.bind(this,editorLocation[0]));}
function addInlineDecorations(editorLineNumber,possibleLocations){this._possibleBreakpointsRequested.delete(editorLineNumber);const decorations=this._lineBreakpointDecorations(editorLineNumber);for(const decoration of decorations)
this._updateBreakpointDecoration(decoration);if(!decorations.some(decoration=>!!decoration.breakpoint))
return;const columns=new Set();for(const decoration of decorations){const editorLocation=decoration.handle.resolve();if(!editorLocation)
continue;columns.add(editorLocation.columnNumber);}
for(const location of possibleLocations){const editorLocation=this._transformer.rawToEditorLocation(location.lineNumber,location.columnNumber);if(columns.has(editorLocation[1]))
continue;const handle=this._textEditor.textEditorPositionHandle(editorLocation[0],editorLocation[1]);const decoration=new Sources.DebuggerPlugin.BreakpointDecoration(this._textEditor,handle,'',false,null);decoration.element.addEventListener('click',this._inlineBreakpointClick.bind(this,decoration),true);decoration.element.addEventListener('contextmenu',this._inlineBreakpointContextMenu.bind(this,decoration),true);this._breakpointDecorations.add(decoration);this._updateBreakpointDecoration(decoration);}}}
_breakpointRemoved(event){if(this._shouldIgnoreExternalBreakpointEvents(event))
return;const uiLocation=(event.data.uiLocation);const breakpoint=(event.data.breakpoint);const decoration=this._decorationByBreakpoint.get(breakpoint);if(!decoration)
return;this._decorationByBreakpoint.delete(breakpoint);const editorLocation=this._transformer.rawToEditorLocation(uiLocation.lineNumber,uiLocation.columnNumber);decoration.breakpoint=null;decoration.enabled=false;const lineDecorations=this._lineBreakpointDecorations(editorLocation[0]);if(!lineDecorations.some(decoration=>!!decoration.breakpoint)){for(const lineDecoration of lineDecorations){this._breakpointDecorations.delete(lineDecoration);this._updateBreakpointDecoration(lineDecoration);}}else{this._updateBreakpointDecoration(decoration);}}
_initializeBreakpoints(){const breakpointLocations=this._breakpointManager.breakpointLocationsForUISourceCode(this._uiSourceCode);for(const breakpointLocation of breakpointLocations)
this._addBreakpoint(breakpointLocation.uiLocation,breakpointLocation.breakpoint);}
_updateLinesWithoutMappingHighlight(){const isSourceMapSource=!!Bindings.CompilerScriptMapping.uiSourceCodeOrigin(this._uiSourceCode);if(!isSourceMapSource)
return;const linesCount=this._textEditor.linesCount;for(let i=0;i<linesCount;++i){const lineHasMapping=Bindings.CompilerScriptMapping.uiLineHasMapping(this._uiSourceCode,i);if(!lineHasMapping)
this._hasLineWithoutMapping=true;if(this._hasLineWithoutMapping)
this._textEditor.toggleLineClass(i,'cm-line-without-source-mapping',!lineHasMapping);}}
_updateScriptFiles(){for(const debuggerModel of SDK.targetManager.models(SDK.DebuggerModel)){const scriptFile=Bindings.debuggerWorkspaceBinding.scriptFile(this._uiSourceCode,debuggerModel);if(scriptFile)
this._updateScriptFile(debuggerModel);}}
_updateScriptFile(debuggerModel){const oldScriptFile=this._scriptFileForDebuggerModel.get(debuggerModel);const newScriptFile=Bindings.debuggerWorkspaceBinding.scriptFile(this._uiSourceCode,debuggerModel);this._scriptFileForDebuggerModel.delete(debuggerModel);if(oldScriptFile){oldScriptFile.removeEventListener(Bindings.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this);oldScriptFile.removeEventListener(Bindings.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this);if(this._muted&&!this._uiSourceCode.isDirty())
this._restoreBreakpointsIfConsistentScripts();}
if(!newScriptFile)
return;this._scriptFileForDebuggerModel.set(debuggerModel,newScriptFile);newScriptFile.addEventListener(Bindings.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this);newScriptFile.addEventListener(Bindings.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this);newScriptFile.checkMapping();if(newScriptFile.hasSourceMapURL())
this._showSourceMapInfobar();}
_showSourceMapInfobar(){if(this._sourceMapInfobar)
return;this._sourceMapInfobar=UI.Infobar.create(UI.Infobar.Type.Info,Common.UIString('Source Map detected.'),Common.settings.createSetting('sourceMapInfobarDisabled',false));if(!this._sourceMapInfobar)
return;this._sourceMapInfobar.createDetailsRowMessage(Common.UIString('Associated files should be added to the file tree. You can debug these resolved source files as regular JavaScript files.'));this._sourceMapInfobar.createDetailsRowMessage(Common.UIString('Associated files are available via file tree or %s.',UI.shortcutRegistry.shortcutTitleForAction('quickOpen.show')));this._sourceMapInfobar.setCloseCallback(()=>this._sourceMapInfobar=null);this._textEditor.attachInfobar(this._sourceMapInfobar);}
_detectMinified(){const content=this._uiSourceCode.content();if(!content||!TextUtils.isMinified(content))
return;this._prettyPrintInfobar=UI.Infobar.create(UI.Infobar.Type.Info,Common.UIString('Pretty-print this minified file?'),Common.settings.createSetting('prettyPrintInfobarDisabled',false));if(!this._prettyPrintInfobar)
return;this._prettyPrintInfobar.setCloseCallback(()=>this._prettyPrintInfobar=null);const toolbar=new UI.Toolbar('');const button=new UI.ToolbarButton('','largeicon-pretty-print');toolbar.appendToolbarItem(button);toolbar.element.style.display='inline-block';toolbar.element.style.verticalAlign='middle';toolbar.element.style.marginBottom='3px';toolbar.element.style.pointerEvents='none';toolbar.element.tabIndex=-1;const element=this._prettyPrintInfobar.createDetailsRowMessage();element.appendChild(UI.formatLocalized('You can click the %s button on the bottom status bar, and continue debugging with the new formatted source.',[toolbar.element]));this._textEditor.attachInfobar(this._prettyPrintInfobar);}
_handleGutterClick(event){if(this._muted)
return;const eventData=(event.data);const editorLineNumber=eventData.lineNumber;const eventObject=eventData.event;if(eventObject.button!==0||eventObject.altKey||eventObject.ctrlKey||eventObject.metaKey)
return;this._toggleBreakpoint(editorLineNumber,eventObject.shiftKey);eventObject.consume(true);}
_toggleBreakpoint(editorLineNumber,onlyDisable){const decorations=this._lineBreakpointDecorations(editorLineNumber);if(!decorations.length){this._createNewBreakpoint(editorLineNumber,'',true);return;}
const hasDisabled=this._textEditor.hasLineClass(editorLineNumber,'cm-breakpoint-disabled');const breakpoints=decorations.map(decoration=>decoration.breakpoint).filter(breakpoint=>!!breakpoint);for(const breakpoint of breakpoints){if(onlyDisable)
breakpoint.setEnabled(hasDisabled);else
breakpoint.remove();}}
async _createNewBreakpoint(editorLineNumber,condition,enabled){Host.userMetrics.actionTaken(Host.UserMetrics.Action.ScriptsBreakpointSet);if(editorLineNumber<this._textEditor.linesCount){const lineLength=Math.min(this._textEditor.line(editorLineNumber).length,1024);const start=this._transformer.editorToRawLocation(editorLineNumber,0);const end=this._transformer.editorToRawLocation(editorLineNumber,lineLength);const locations=await this._breakpointManager.possibleBreakpoints(this._uiSourceCode,new TextUtils.TextRange(start[0],start[1],end[0],end[1]));if(locations&&locations.length){this._setBreakpoint(locations[0].lineNumber,locations[0].columnNumber,condition,enabled);return;}}
const origin=this._transformer.editorToRawLocation(editorLineNumber,0);await this._setBreakpoint(origin[0],origin[1],condition,enabled);}
toggleBreakpointOnCurrentLine(onlyDisable){if(this._muted)
return;const selection=this._textEditor.selection();if(!selection)
return;this._toggleBreakpoint(selection.startLine,onlyDisable);}
_setBreakpoint(lineNumber,columnNumber,condition,enabled){if(!Bindings.CompilerScriptMapping.uiLineHasMapping(this._uiSourceCode,lineNumber))
return;Common.moduleSetting('breakpointsActive').set(true);this._breakpointManager.setBreakpoint(this._uiSourceCode,lineNumber,columnNumber,condition,enabled);this._breakpointWasSetForTest(lineNumber,columnNumber,condition,enabled);}
_breakpointWasSetForTest(lineNumber,columnNumber,condition,enabled){}
_callFrameChanged(){this._liveLocationPool.disposeAll();const callFrame=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!callFrame){this._clearExecutionLine();return;}
Bindings.debuggerWorkspaceBinding.createCallFrameLiveLocation(callFrame.location(),this._executionLineChanged.bind(this),this._liveLocationPool);}
dispose(){for(const decoration of this._breakpointDecorations)
decoration.dispose();this._breakpointDecorations.clear();if(this._scheduledBreakpointDecorationUpdates){for(const decoration of this._scheduledBreakpointDecorationUpdates)
decoration.dispose();this._scheduledBreakpointDecorationUpdates.clear();}
this._hideBlackboxInfobar();if(this._sourceMapInfobar)
this._sourceMapInfobar.dispose();if(this._prettyPrintInfobar)
this._prettyPrintInfobar.dispose();this._scriptsPanel.element.removeEventListener('scroll',this._boundPopoverHelperHide,true);for(const script of this._scriptFileForDebuggerModel.values()){script.removeEventListener(Bindings.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this);script.removeEventListener(Bindings.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this);}
this._scriptFileForDebuggerModel.clear();this._textEditor.element.removeEventListener('keydown',this._boundKeyDown,true);this._textEditor.element.removeEventListener('keyup',this._boundKeyUp,true);this._textEditor.element.removeEventListener('mousemove',this._boundMouseMove,false);this._textEditor.element.removeEventListener('mousedown',this._boundMouseDown,true);this._textEditor.element.removeEventListener('focusout',this._boundBlur,false);this._textEditor.element.removeEventListener('wheel',this._boundWheel,true);this._textEditor.removeEventListener(SourceFrame.SourcesTextEditor.Events.GutterClick,this._handleGutterClick,this);this._popoverHelper.hidePopover();this._popoverHelper.dispose();this._breakpointManager.removeEventListener(Bindings.BreakpointManager.Events.BreakpointAdded,this._breakpointAdded,this);this._breakpointManager.removeEventListener(Bindings.BreakpointManager.Events.BreakpointRemoved,this._breakpointRemoved,this);this._uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._workingCopyChanged,this);this._uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._workingCopyCommitted,this);Common.moduleSetting('skipStackFramesPattern').removeChangeListener(this._showBlackboxInfobarIfNeeded,this);Common.moduleSetting('skipContentScripts').removeChangeListener(this._showBlackboxInfobarIfNeeded,this);super.dispose();this._clearExecutionLine();UI.context.removeFlavorChangeListener(SDK.DebuggerModel.CallFrame,this._callFrameChanged,this);this._liveLocationPool.disposeAll();}};Sources.DebuggerPlugin.BreakpointDecoration=class{constructor(textEditor,handle,condition,enabled,breakpoint){this._textEditor=textEditor;this.handle=handle;this.condition=condition;this.enabled=enabled;this.breakpoint=breakpoint;this.element=UI.Icon.create('smallicon-inline-breakpoint');this.element.classList.toggle('cm-inline-breakpoint',true);this.bookmark=null;}
static mostSpecificFirst(decoration1,decoration2){if(decoration1.enabled!==decoration2.enabled)
return decoration1.enabled?-1:1;if(!!decoration1.condition!==!!decoration2.condition)
return!!decoration1.condition?-1:1;return 0;}
update(){if(!this.condition)
this.element.setIconType('smallicon-inline-breakpoint');else
this.element.setIconType('smallicon-inline-breakpoint-conditional');this.element.classList.toggle('cm-inline-disabled',!this.enabled);}
show(){if(this.bookmark)
return;const editorLocation=this.handle.resolve();if(!editorLocation)
return;this.bookmark=this._textEditor.addBookmark(editorLocation.lineNumber,editorLocation.columnNumber,this.element,Sources.DebuggerPlugin.BreakpointDecoration.bookmarkSymbol);this.bookmark[Sources.DebuggerPlugin.BreakpointDecoration._elementSymbolForTest]=this.element;}
hide(){if(!this.bookmark)
return;this.bookmark.clear();this.bookmark=null;}
dispose(){const location=this.handle.resolve();if(location){this._textEditor.toggleLineClass(location.lineNumber,'cm-breakpoint',false);this._textEditor.toggleLineClass(location.lineNumber,'cm-breakpoint-disabled',false);this._textEditor.toggleLineClass(location.lineNumber,'cm-breakpoint-conditional',false);}
this.hide();}};Sources.DebuggerPlugin.BreakpointDecoration.bookmarkSymbol=Symbol('bookmark');Sources.DebuggerPlugin.BreakpointDecoration._elementSymbolForTest=Symbol('element');Sources.DebuggerPlugin.continueToLocationDecorationSymbol=Symbol('bookmark');;Sources.CSSPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(textEditor){super();this._textEditor=textEditor;this._swatchPopoverHelper=new InlineEditor.SwatchPopoverHelper();this._muteSwatchProcessing=false;this._hadSwatchChange=false;this._bezierEditor=null;this._editedSwatchTextRange=null;this._spectrum=null;this._currentSwatch=null;this._textEditor.configureAutocomplete({suggestionsCallback:this._cssSuggestions.bind(this),isWordChar:this._isWordChar.bind(this)});this._textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.ScrollChanged,this._textEditorScrolled,this);this._textEditor.addEventListener(UI.TextEditor.Events.TextChanged,this._onTextChanged,this);this._updateSwatches(0,this._textEditor.linesCount-1);this._shortcuts={};this._registerShortcuts();this._boundHandleKeyDown=this._handleKeyDown.bind(this);this._textEditor.element.addEventListener('keydown',this._boundHandleKeyDown,false);}
static accepts(uiSourceCode){return uiSourceCode.contentType().isStyleSheet();}
_registerShortcuts(){const shortcutKeys=UI.ShortcutsScreen.SourcesPanelShortcuts;for(const descriptor of shortcutKeys.IncreaseCSSUnitByOne)
this._shortcuts[descriptor.key]=this._handleUnitModification.bind(this,1);for(const descriptor of shortcutKeys.DecreaseCSSUnitByOne)
this._shortcuts[descriptor.key]=this._handleUnitModification.bind(this,-1);for(const descriptor of shortcutKeys.IncreaseCSSUnitByTen)
this._shortcuts[descriptor.key]=this._handleUnitModification.bind(this,10);for(const descriptor of shortcutKeys.DecreaseCSSUnitByTen)
this._shortcuts[descriptor.key]=this._handleUnitModification.bind(this,-10);}
_handleKeyDown(event){const shortcutKey=UI.KeyboardShortcut.makeKeyFromEvent((event));const handler=this._shortcuts[shortcutKey];if(handler&&handler())
event.consume(true);}
_textEditorScrolled(){if(this._swatchPopoverHelper.isShowing())
this._swatchPopoverHelper.hide(true);}
_modifyUnit(unit,change){const unitValue=parseInt(unit,10);if(isNaN(unitValue))
return null;const tail=unit.substring((unitValue).toString().length);return String.sprintf('%d%s',unitValue+change,tail);}
_handleUnitModification(change){const selection=this._textEditor.selection().normalize();let token=this._textEditor.tokenAtTextPosition(selection.startLine,selection.startColumn);if(!token){if(selection.startColumn>0)
token=this._textEditor.tokenAtTextPosition(selection.startLine,selection.startColumn-1);if(!token)
return false;}
if(token.type!=='css-number')
return false;const cssUnitRange=new TextUtils.TextRange(selection.startLine,token.startColumn,selection.startLine,token.endColumn);const cssUnitText=this._textEditor.text(cssUnitRange);const newUnitText=this._modifyUnit(cssUnitText,change);if(!newUnitText)
return false;this._textEditor.editRange(cssUnitRange,newUnitText);selection.startColumn=token.startColumn;selection.endColumn=selection.startColumn+newUnitText.length;this._textEditor.setSelection(selection);return true;}
_updateSwatches(startLine,endLine){const swatches=[];const swatchPositions=[];const regexes=[SDK.CSSMetadata.VariableRegex,SDK.CSSMetadata.URLRegex,UI.Geometry.CubicBezier.Regex,Common.Color.Regex];const handlers=new Map();handlers.set(Common.Color.Regex,this._createColorSwatch.bind(this));handlers.set(UI.Geometry.CubicBezier.Regex,this._createBezierSwatch.bind(this));for(let lineNumber=startLine;lineNumber<=endLine;lineNumber++){const line=this._textEditor.line(lineNumber).substring(0,Sources.CSSPlugin.maxSwatchProcessingLength);const results=TextUtils.TextUtils.splitStringByRegexes(line,regexes);for(let i=0;i<results.length;i++){const result=results[i];if(result.regexIndex===-1||!handlers.has(regexes[result.regexIndex]))
continue;const delimiters=/[\s:;,(){}]/;const positionBefore=result.position-1;const positionAfter=result.position+result.value.length;if(positionBefore>=0&&!delimiters.test(line.charAt(positionBefore))||positionAfter<line.length&&!delimiters.test(line.charAt(positionAfter)))
continue;const swatch=handlers.get(regexes[result.regexIndex])(result.value);if(!swatch)
continue;swatches.push(swatch);swatchPositions.push(TextUtils.TextRange.createFromLocation(lineNumber,result.position));}}
this._textEditor.operation(putSwatchesInline.bind(this));function putSwatchesInline(){const clearRange=new TextUtils.TextRange(startLine,0,endLine,this._textEditor.line(endLine).length);this._textEditor.bookmarks(clearRange,Sources.CSSPlugin.SwatchBookmark).forEach(marker=>marker.clear());for(let i=0;i<swatches.length;i++){const swatch=swatches[i];const swatchPosition=swatchPositions[i];const bookmark=this._textEditor.addBookmark(swatchPosition.startLine,swatchPosition.startColumn,swatch,Sources.CSSPlugin.SwatchBookmark);swatch[Sources.CSSPlugin.SwatchBookmark]=bookmark;}}}
_createColorSwatch(text){const color=Common.Color.parse(text);if(!color)
return null;const swatch=InlineEditor.ColorSwatch.create();swatch.setColor(color);swatch.iconElement().title=Common.UIString('Open color picker.');swatch.iconElement().addEventListener('click',this._swatchIconClicked.bind(this,swatch),false);swatch.hideText(true);return swatch;}
_createBezierSwatch(text){if(!UI.Geometry.CubicBezier.parse(text))
return null;const swatch=InlineEditor.BezierSwatch.create();swatch.setBezierText(text);swatch.iconElement().title=Common.UIString('Open cubic bezier editor.');swatch.iconElement().addEventListener('click',this._swatchIconClicked.bind(this,swatch),false);swatch.hideText(true);return swatch;}
_swatchIconClicked(swatch,event){event.consume(true);this._hadSwatchChange=false;this._muteSwatchProcessing=true;const swatchPosition=swatch[Sources.CSSPlugin.SwatchBookmark].position();this._textEditor.setSelection(swatchPosition);this._editedSwatchTextRange=swatchPosition.clone();this._editedSwatchTextRange.endColumn+=swatch.textContent.length;this._currentSwatch=swatch;if(swatch instanceof InlineEditor.ColorSwatch)
this._showSpectrum(swatch);else if(swatch instanceof InlineEditor.BezierSwatch)
this._showBezierEditor(swatch);}
_showSpectrum(swatch){if(!this._spectrum){this._spectrum=new ColorPicker.Spectrum();this._spectrum.addEventListener(ColorPicker.Spectrum.Events.SizeChanged,this._spectrumResized,this);this._spectrum.addEventListener(ColorPicker.Spectrum.Events.ColorChanged,this._spectrumChanged,this);}
this._spectrum.setColor(swatch.color(),swatch.format());this._swatchPopoverHelper.show(this._spectrum,swatch.iconElement(),this._swatchPopoverHidden.bind(this));}
_spectrumResized(event){this._swatchPopoverHelper.reposition();}
_spectrumChanged(event){const colorString=(event.data);const color=Common.Color.parse(colorString);if(!color)
return;this._currentSwatch.setColor(color);this._changeSwatchText(colorString);}
_showBezierEditor(swatch){if(!this._bezierEditor){this._bezierEditor=new InlineEditor.BezierEditor();this._bezierEditor.addEventListener(InlineEditor.BezierEditor.Events.BezierChanged,this._bezierChanged,this);}
let cubicBezier=UI.Geometry.CubicBezier.parse(swatch.bezierText());if(!cubicBezier){cubicBezier=(UI.Geometry.CubicBezier.parse('linear'));}
this._bezierEditor.setBezier(cubicBezier);this._swatchPopoverHelper.show(this._bezierEditor,swatch.iconElement(),this._swatchPopoverHidden.bind(this));}
_bezierChanged(event){const bezierString=(event.data);this._currentSwatch.setBezierText(bezierString);this._changeSwatchText(bezierString);}
_changeSwatchText(text){this._hadSwatchChange=true;this._textEditor.editRange((this._editedSwatchTextRange),text,'*swatch-text-changed');this._editedSwatchTextRange.endColumn=this._editedSwatchTextRange.startColumn+text.length;}
_swatchPopoverHidden(commitEdit){this._muteSwatchProcessing=false;if(!commitEdit&&this._hadSwatchChange)
this._textEditor.undo();}
_onTextChanged(event){if(!this._muteSwatchProcessing)
this._updateSwatches(event.data.newRange.startLine,event.data.newRange.endLine);}
_isWordChar(char){return TextUtils.TextUtils.isWordChar(char)||char==='.'||char==='-'||char==='$';}
_cssSuggestions(prefixRange,substituteRange){const prefix=this._textEditor.text(prefixRange);if(prefix.startsWith('$'))
return null;const propertyToken=this._backtrackPropertyToken(prefixRange.startLine,prefixRange.startColumn-1);if(!propertyToken)
return null;const line=this._textEditor.line(prefixRange.startLine);const tokenContent=line.substring(propertyToken.startColumn,propertyToken.endColumn);const propertyValues=SDK.cssMetadata().propertyValues(tokenContent);return Promise.resolve(propertyValues.filter(value=>value.startsWith(prefix)).map(value=>({text:value})));}
_backtrackPropertyToken(lineNumber,columnNumber){const backtrackDepth=10;let tokenPosition=columnNumber;const line=this._textEditor.line(lineNumber);let seenColon=false;for(let i=0;i<backtrackDepth&&tokenPosition>=0;++i){const token=this._textEditor.tokenAtTextPosition(lineNumber,tokenPosition);if(!token)
return null;if(token.type==='css-property')
return seenColon?token:null;if(token.type&&!(token.type.indexOf('whitespace')!==-1||token.type.startsWith('css-comment')))
return null;if(!token.type&&line.substring(token.startColumn,token.endColumn)===':'){if(!seenColon)
seenColon=true;else
return null;}
tokenPosition=token.startColumn-1;}
return null;}
dispose(){if(this._swatchPopoverHelper.isShowing())
this._swatchPopoverHelper.hide(true);this._textEditor.removeEventListener(SourceFrame.SourcesTextEditor.Events.ScrollChanged,this._textEditorScrolled,this);this._textEditor.removeEventListener(UI.TextEditor.Events.TextChanged,this._onTextChanged,this);this._textEditor.bookmarks(this._textEditor.fullRange(),Sources.CSSPlugin.SwatchBookmark).forEach(marker=>marker.clear());this._textEditor.element.removeEventListener('keydown',this._boundHandleKeyDown,false);}};Sources.CSSPlugin.maxSwatchProcessingLength=300;Sources.CSSPlugin.SwatchBookmark=Symbol('swatch');;Sources.GutterDiffPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(textEditor,uiSourceCode){super();this._textEditor=textEditor;this._uiSourceCode=uiSourceCode;this._decorations=[];this._textEditor.installGutter(Sources.GutterDiffPlugin.DiffGutterType,true);this._workspaceDiff=WorkspaceDiff.workspaceDiff();this._workspaceDiff.subscribeToDiffChange(this._uiSourceCode,this._update,this);this._update();}
static accepts(uiSourceCode){return uiSourceCode.project().type()===Workspace.projectTypes.Network;}
_updateDecorations(removed,added){this._textEditor.operation(operation);function operation(){for(const decoration of removed)
decoration.remove();for(const decoration of added)
decoration.install();}}
_update(){if(this._uiSourceCode)
this._workspaceDiff.requestDiff(this._uiSourceCode).then(this._innerUpdate.bind(this));else
this._innerUpdate(null);}
_innerUpdate(lineDiff){if(!lineDiff){this._updateDecorations(this._decorations,[]);this._decorations=[];return;}
const oldDecorations=new Map();for(let i=0;i<this._decorations.length;++i){const decoration=this._decorations[i];const lineNumber=decoration.lineNumber();if(lineNumber===-1)
continue;oldDecorations.set(lineNumber,decoration);}
const diff=SourceFrame.SourceCodeDiff.computeDiff(lineDiff);const newDecorations=new Map();for(let i=0;i<diff.length;++i){const diffEntry=diff[i];for(let lineNumber=diffEntry.from;lineNumber<diffEntry.to;++lineNumber)
newDecorations.set(lineNumber,{lineNumber:lineNumber,type:diffEntry.type});}
const decorationDiff=oldDecorations.diff(newDecorations,(e1,e2)=>e1.type===e2.type);const addedDecorations=decorationDiff.added.map(entry=>new Sources.GutterDiffPlugin.GutterDecoration(this._textEditor,entry.lineNumber,entry.type));this._decorations=decorationDiff.equal.concat(addedDecorations);this._updateDecorations(decorationDiff.removed,addedDecorations);this._decorationsSetForTest(newDecorations);}
_decorationsSetForTest(decorations){}
async populateLineGutterContextMenu(contextMenu,lineNumber){Sources.GutterDiffPlugin._appendRevealDiffContextMenu(contextMenu,this._uiSourceCode);}
async populateTextAreaContextMenu(contextMenu,lineNumber,columnNumber){Sources.GutterDiffPlugin._appendRevealDiffContextMenu(contextMenu,this._uiSourceCode);}
static _appendRevealDiffContextMenu(contextMenu,uiSourceCode){if(!WorkspaceDiff.workspaceDiff().isUISourceCodeModified(uiSourceCode))
return;contextMenu.revealSection().appendItem(ls`Local Modifications...`,()=>{Common.Revealer.reveal(new WorkspaceDiff.DiffUILocation(uiSourceCode));});}
dispose(){for(const decoration of this._decorations)
decoration.remove();WorkspaceDiff.workspaceDiff().unsubscribeFromDiffChange(this._uiSourceCode,this._update,this);}};Sources.GutterDiffPlugin.GutterDecoration=class{constructor(textEditor,lineNumber,type){this._textEditor=textEditor;this._position=this._textEditor.textEditorPositionHandle(lineNumber,0);this._className='';if(type===SourceFrame.SourceCodeDiff.EditType.Insert)
this._className='diff-entry-insert';else if(type===SourceFrame.SourceCodeDiff.EditType.Delete)
this._className='diff-entry-delete';else if(type===SourceFrame.SourceCodeDiff.EditType.Modify)
this._className='diff-entry-modify';this.type=type;}
lineNumber(){const location=this._position.resolve();if(!location)
return-1;return location.lineNumber;}
install(){const location=this._position.resolve();if(!location)
return;const element=createElementWithClass('div','diff-marker');element.textContent='\u00A0';this._textEditor.setGutterDecoration(location.lineNumber,Sources.GutterDiffPlugin.DiffGutterType,element);this._textEditor.toggleLineClass(location.lineNumber,this._className,true);}
remove(){const location=this._position.resolve();if(!location)
return;this._textEditor.setGutterDecoration(location.lineNumber,Sources.GutterDiffPlugin.DiffGutterType,null);this._textEditor.toggleLineClass(location.lineNumber,this._className,false);}};Sources.GutterDiffPlugin.DiffGutterType='CodeMirror-gutter-diff';Sources.GutterDiffPlugin.ContextMenuProvider=class{appendApplicableItems(event,contextMenu,target){let uiSourceCode=(target);const binding=Persistence.persistence.binding(uiSourceCode);if(binding)
uiSourceCode=binding.network;Sources.GutterDiffPlugin._appendRevealDiffContextMenu(contextMenu,uiSourceCode);}};;Sources.SearchSourcesView=class extends Search.SearchView{constructor(){super('sources');}
static async openSearch(query,searchImmediately){const view=UI.viewManager.view('sources.search-sources-tab');const location=await UI.viewManager.resolveLocation('drawer-view');location.appendView(view);await UI.viewManager.revealView((view));const widget=(await view.widget());widget.toggle(query,!!searchImmediately);return widget;}
createScope(){return new Sources.SourcesSearchScope();}};Sources.SearchSourcesView.ActionDelegate=class{handleAction(context,actionId){this._showSearch();return true;}
_showSearch(){const selection=UI.inspectorView.element.window().getSelection();let queryCandidate='';if(selection.rangeCount)
queryCandidate=selection.toString().replace(/\r?\n.*/,'');return Sources.SearchSourcesView.openSearch(queryCandidate);}};;Sources.NavigatorView=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS('sources/navigatorView.css');this._placeholder=null;this._scriptsTree=new UI.TreeOutlineInShadow();this._scriptsTree.registerRequiredCSS('sources/navigatorTree.css');this._scriptsTree.setComparator(Sources.NavigatorView._treeElementsCompare);this.contentElement.appendChild(this._scriptsTree.element);this.setDefaultFocusedElement(this._scriptsTree.element);this._uiSourceCodeNodes=new Multimap();this._subfolderNodes=new Map();this._rootNode=new Sources.NavigatorRootTreeNode(this);this._rootNode.populate();this._frameNodes=new Map();this.contentElement.addEventListener('contextmenu',this.handleContextMenu.bind(this),false);UI.shortcutRegistry.addShortcutListener(this.contentElement,'sources.rename',this._renameShortcut.bind(this),true);this._navigatorGroupByFolderSetting=Common.moduleSetting('navigatorGroupByFolder');this._navigatorGroupByFolderSetting.addChangeListener(this._groupingChanged.bind(this));this._initGrouping();Persistence.persistence.addEventListener(Persistence.Persistence.Events.BindingCreated,this._onBindingChanged,this);Persistence.persistence.addEventListener(Persistence.Persistence.Events.BindingRemoved,this._onBindingChanged,this);SDK.targetManager.addEventListener(SDK.TargetManager.Events.NameChanged,this._targetNameChanged,this);SDK.targetManager.observeTargets(this);this._resetWorkspace(Workspace.workspace);this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this));Bindings.networkProjectManager.addEventListener(Bindings.NetworkProjectManager.Events.FrameAttributionAdded,this._frameAttributionAdded,this);Bindings.networkProjectManager.addEventListener(Bindings.NetworkProjectManager.Events.FrameAttributionRemoved,this._frameAttributionRemoved,this);}
static _treeElementOrder(treeElement){if(treeElement._boostOrder)
return 0;if(!Sources.NavigatorView._typeOrders){const weights={};const types=Sources.NavigatorView.Types;weights[types.Root]=1;weights[types.Domain]=10;weights[types.FileSystemFolder]=1;weights[types.NetworkFolder]=1;weights[types.SourceMapFolder]=2;weights[types.File]=10;weights[types.Frame]=70;weights[types.Worker]=90;weights[types.FileSystem]=100;Sources.NavigatorView._typeOrders=weights;}
let order=Sources.NavigatorView._typeOrders[treeElement._nodeType];if(treeElement._uiSourceCode){const contentType=treeElement._uiSourceCode.contentType();if(contentType.isDocument())
order+=3;else if(contentType.isScript())
order+=5;else if(contentType.isStyleSheet())
order+=10;else
order+=15;}
return order;}
static appendSearchItem(contextMenu,path){function searchPath(){Sources.SearchSourcesView.openSearch(`file:${path.trim()}`);}
let searchLabel=Common.UIString('Search in folder');if(!path||!path.trim()){path='*';searchLabel=Common.UIString('Search in all files');}
contextMenu.viewSection().appendItem(searchLabel,searchPath);}
static _treeElementsCompare(treeElement1,treeElement2){const typeWeight1=Sources.NavigatorView._treeElementOrder(treeElement1);const typeWeight2=Sources.NavigatorView._treeElementOrder(treeElement2);if(typeWeight1>typeWeight2)
return 1;if(typeWeight1<typeWeight2)
return-1;return treeElement1.titleAsText().compareTo(treeElement2.titleAsText());}
setPlaceholder(placeholder){console.assert(!this._placeholder,'A placeholder widget was already set');this._placeholder=placeholder;placeholder.show(this.contentElement,this.contentElement.firstChild);updateVisibility.call(this);this._scriptsTree.addEventListener(UI.TreeOutline.Events.ElementAttached,updateVisibility.bind(this));this._scriptsTree.addEventListener(UI.TreeOutline.Events.ElementsDetached,updateVisibility.bind(this));function updateVisibility(){const showTree=this._scriptsTree.firstChild();if(showTree)
placeholder.hideWidget();else
placeholder.showWidget();this._scriptsTree.element.classList.toggle('hidden',!showTree);}}
_onBindingChanged(event){const binding=(event.data);const networkNodes=this._uiSourceCodeNodes.get(binding.network);for(const networkNode of networkNodes)
networkNode.updateTitle();const fileSystemNodes=this._uiSourceCodeNodes.get(binding.fileSystem);for(const fileSystemNode of fileSystemNodes)
fileSystemNode.updateTitle();const pathTokens=Persistence.FileSystemWorkspaceBinding.relativePath(binding.fileSystem);let folderPath='';for(let i=0;i<pathTokens.length-1;++i){folderPath+=pathTokens[i];const folderId=this._folderNodeId(binding.fileSystem.project(),null,null,binding.fileSystem.origin(),folderPath);const folderNode=this._subfolderNodes.get(folderId);if(folderNode)
folderNode.updateTitle();folderPath+='/';}
const fileSystemRoot=this._rootNode.child(binding.fileSystem.project().id());if(fileSystemRoot)
fileSystemRoot.updateTitle();}
focus(){this._scriptsTree.focus();}
_resetWorkspace(workspace){this._workspace=workspace;this._workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);this._workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeRemoved,this._uiSourceCodeRemoved,this);this._workspace.addEventListener(Workspace.Workspace.Events.ProjectAdded,event=>{const project=(event.data);this._projectAdded(project);if(project.type()===Workspace.projectTypes.FileSystem)
this._computeUniqueFileSystemProjectNames();});this._workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved,event=>{const project=(event.data);this._removeProject(project);if(project.type()===Workspace.projectTypes.FileSystem)
this._computeUniqueFileSystemProjectNames();});this._workspace.projects().forEach(this._projectAdded.bind(this));this._computeUniqueFileSystemProjectNames();}
workspace(){return this._workspace;}
acceptProject(project){return!project.isServiceProject();}
_frameAttributionAdded(event){const uiSourceCode=(event.data.uiSourceCode);if(!this._acceptsUISourceCode(uiSourceCode))
return;const addedFrame=(event.data.frame);this._addUISourceCodeNode(uiSourceCode,addedFrame);}
_frameAttributionRemoved(event){const uiSourceCode=(event.data.uiSourceCode);if(!this._acceptsUISourceCode(uiSourceCode))
return;const removedFrame=(event.data.frame);const node=Array.from(this._uiSourceCodeNodes.get(uiSourceCode)).find(node=>node.frame()===removedFrame);this._removeUISourceCodeNode(node);}
_acceptsUISourceCode(uiSourceCode){return this.acceptProject(uiSourceCode.project());}
_addUISourceCode(uiSourceCode){if(!this._acceptsUISourceCode(uiSourceCode))
return;const frames=Bindings.NetworkProject.framesForUISourceCode(uiSourceCode);if(frames.length){for(const frame of frames)
this._addUISourceCodeNode(uiSourceCode,frame);}else{this._addUISourceCodeNode(uiSourceCode,null);}
this.uiSourceCodeAdded(uiSourceCode);}
_addUISourceCodeNode(uiSourceCode,frame){const isFromSourceMap=uiSourceCode.contentType().isFromSourceMap();let path;if(uiSourceCode.project().type()===Workspace.projectTypes.FileSystem)
path=Persistence.FileSystemWorkspaceBinding.relativePath(uiSourceCode).slice(0,-1);else
path=Common.ParsedURL.extractPath(uiSourceCode.url()).split('/').slice(1,-1);const project=uiSourceCode.project();const target=Bindings.NetworkProject.targetForUISourceCode(uiSourceCode);const folderNode=this._folderNode(uiSourceCode,project,target,frame,uiSourceCode.origin(),path,isFromSourceMap);const uiSourceCodeNode=new Sources.NavigatorUISourceCodeTreeNode(this,uiSourceCode,frame);folderNode.appendChild(uiSourceCodeNode);this._uiSourceCodeNodes.set(uiSourceCode,uiSourceCodeNode);this._selectDefaultTreeNode();}
uiSourceCodeAdded(uiSourceCode){}
_uiSourceCodeAdded(event){const uiSourceCode=(event.data);this._addUISourceCode(uiSourceCode);}
_uiSourceCodeRemoved(event){const uiSourceCode=(event.data);this._removeUISourceCode(uiSourceCode);}
tryAddProject(project){this._projectAdded(project);project.uiSourceCodes().forEach(this._addUISourceCode.bind(this));}
_projectAdded(project){if(!this.acceptProject(project)||project.type()!==Workspace.projectTypes.FileSystem||Snippets.isSnippetsProject(project)||this._rootNode.child(project.id()))
return;this._rootNode.appendChild(new Sources.NavigatorGroupTreeNode(this,project,project.id(),Sources.NavigatorView.Types.FileSystem,project.displayName()));this._selectDefaultTreeNode();}
_selectDefaultTreeNode(){const children=this._rootNode.children();if(children.length&&!this._scriptsTree.selectedTreeElement)
children[0].treeNode().select(true,false);}
_computeUniqueFileSystemProjectNames(){const fileSystemProjects=this._workspace.projectsForType(Workspace.projectTypes.FileSystem);if(!fileSystemProjects.length)
return;const encoder=new Persistence.PathEncoder();const reversedPaths=fileSystemProjects.map(project=>{const fileSystem=(project);return encoder.encode(fileSystem.fileSystemPath()).reverse();});const reversedIndex=new Common.Trie();for(const reversedPath of reversedPaths)
reversedIndex.add(reversedPath);for(let i=0;i<fileSystemProjects.length;++i){const reversedPath=reversedPaths[i];const project=fileSystemProjects[i];reversedIndex.remove(reversedPath);const commonPrefix=reversedIndex.longestPrefix(reversedPath,false);reversedIndex.add(reversedPath);const path=encoder.decode(reversedPath.substring(0,commonPrefix.length+1).reverse());const fileSystemNode=this._rootNode.child(project.id());if(fileSystemNode)
fileSystemNode.setTitle(path);}}
_removeProject(project){const uiSourceCodes=project.uiSourceCodes();for(let i=0;i<uiSourceCodes.length;++i)
this._removeUISourceCode(uiSourceCodes[i]);if(project.type()!==Workspace.projectTypes.FileSystem)
return;const fileSystemNode=this._rootNode.child(project.id());if(!fileSystemNode)
return;this._rootNode.removeChild(fileSystemNode);}
_folderNodeId(project,target,frame,projectOrigin,path){const targetId=target?target.id():'';const projectId=project.type()===Workspace.projectTypes.FileSystem?project.id():'';const frameId=this._groupByFrame&&frame?frame.id:'';return targetId+':'+projectId+':'+frameId+':'+projectOrigin+':'+path;}
_folderNode(uiSourceCode,project,target,frame,projectOrigin,path,fromSourceMap){if(Snippets.isSnippetsUISourceCode(uiSourceCode))
return this._rootNode;if(target&&!this._groupByFolder&&!fromSourceMap)
return this._domainNode(uiSourceCode,project,target,frame,projectOrigin);const folderPath=path.join('/');const folderId=this._folderNodeId(project,target,frame,projectOrigin,folderPath);let folderNode=this._subfolderNodes.get(folderId);if(folderNode)
return folderNode;if(!path.length){if(target)
return this._domainNode(uiSourceCode,project,target,frame,projectOrigin);return(this._rootNode.child(project.id()));}
const parentNode=this._folderNode(uiSourceCode,project,target,frame,projectOrigin,path.slice(0,-1),fromSourceMap);let type=fromSourceMap?Sources.NavigatorView.Types.SourceMapFolder:Sources.NavigatorView.Types.NetworkFolder;if(project.type()===Workspace.projectTypes.FileSystem)
type=Sources.NavigatorView.Types.FileSystemFolder;const name=path[path.length-1];folderNode=new Sources.NavigatorFolderTreeNode(this,project,folderId,type,folderPath,name);this._subfolderNodes.set(folderId,folderNode);parentNode.appendChild(folderNode);return folderNode;}
_domainNode(uiSourceCode,project,target,frame,projectOrigin){const frameNode=this._frameNode(project,target,frame);if(!this._groupByDomain)
return frameNode;let domainNode=frameNode.child(projectOrigin);if(domainNode)
return domainNode;domainNode=new Sources.NavigatorGroupTreeNode(this,project,projectOrigin,Sources.NavigatorView.Types.Domain,this._computeProjectDisplayName(target,projectOrigin));if(frame&&projectOrigin===Common.ParsedURL.extractOrigin(frame.url))
domainNode.treeNode()._boostOrder=true;frameNode.appendChild(domainNode);return domainNode;}
_frameNode(project,target,frame){if(!this._groupByFrame||!frame)
return this._targetNode(project,target);let frameNode=this._frameNodes.get(frame);if(frameNode)
return frameNode;frameNode=new Sources.NavigatorGroupTreeNode(this,project,target.id()+':'+frame.id,Sources.NavigatorView.Types.Frame,frame.displayName());frameNode.setHoverCallback(hoverCallback);this._frameNodes.set(frame,frameNode);const parentFrame=frame.parentFrame||frame.crossTargetParentFrame();this._frameNode(project,parentFrame?parentFrame.resourceTreeModel().target():target,parentFrame).appendChild(frameNode);if(!parentFrame){frameNode.treeNode()._boostOrder=true;frameNode.treeNode().expand();}
function hoverCallback(hovered){if(hovered){const overlayModel=target.model(SDK.OverlayModel);if(overlayModel)
overlayModel.highlightFrame(frame.id);}else{SDK.OverlayModel.hideDOMNodeHighlight();}}
return frameNode;}
_targetNode(project,target){if(target===SDK.targetManager.mainTarget())
return this._rootNode;let targetNode=this._rootNode.child('target:'+target.id());if(!targetNode){targetNode=new Sources.NavigatorGroupTreeNode(this,project,'target:'+target.id(),target.type()===SDK.Target.Type.Frame?Sources.NavigatorView.Types.Frame:Sources.NavigatorView.Types.Worker,target.name());this._rootNode.appendChild(targetNode);}
return targetNode;}
_computeProjectDisplayName(target,projectOrigin){const runtimeModel=target.model(SDK.RuntimeModel);const executionContexts=runtimeModel?runtimeModel.executionContexts():[];for(const context of executionContexts){if(context.name&&context.origin&&projectOrigin.startsWith(context.origin))
return context.name;}
if(!projectOrigin)
return Common.UIString('(no domain)');const parsedURL=new Common.ParsedURL(projectOrigin);const prettyURL=parsedURL.isValid?parsedURL.host+(parsedURL.port?(':'+parsedURL.port):''):'';return(prettyURL||projectOrigin);}
revealUISourceCode(uiSourceCode,select){const nodes=this._uiSourceCodeNodes.get(uiSourceCode);const node=nodes.firstValue();if(!node)
return null;if(this._scriptsTree.selectedTreeElement)
this._scriptsTree.selectedTreeElement.deselect();this._lastSelectedUISourceCode=uiSourceCode;node.reveal(select);return node;}
_sourceSelected(uiSourceCode,focusSource){this._lastSelectedUISourceCode=uiSourceCode;Common.Revealer.reveal(uiSourceCode,!focusSource);}
_removeUISourceCode(uiSourceCode){const nodes=this._uiSourceCodeNodes.get(uiSourceCode);for(const node of nodes)
this._removeUISourceCodeNode(node);}
_removeUISourceCodeNode(node){const uiSourceCode=node.uiSourceCode();this._uiSourceCodeNodes.delete(uiSourceCode,node);const project=uiSourceCode.project();const target=Bindings.NetworkProject.targetForUISourceCode(uiSourceCode);const frame=node.frame();let parentNode=node.parent;parentNode.removeChild(node);node=parentNode;while(node){parentNode=node.parent;if(!parentNode||!node.isEmpty())
break;if(parentNode===this._rootNode&&project.type()===Workspace.projectTypes.FileSystem)
break;if(!(node instanceof Sources.NavigatorGroupTreeNode||node instanceof Sources.NavigatorFolderTreeNode))
break;if(node._type===Sources.NavigatorView.Types.Frame){this._discardFrame((frame));break;}
const folderId=this._folderNodeId(project,target,frame,uiSourceCode.origin(),node._folderPath);this._subfolderNodes.delete(folderId);parentNode.removeChild(node);node=parentNode;}}
reset(){for(const node of this._uiSourceCodeNodes.valuesArray())
node.dispose();this._scriptsTree.removeChildren();this._uiSourceCodeNodes.clear();this._subfolderNodes.clear();this._frameNodes.clear();this._rootNode.reset();}
handleContextMenu(event){}
_renameShortcut(){const node=this._scriptsTree.selectedTreeElement&&this._scriptsTree.selectedTreeElement._node;if(!node||!node._uiSourceCode||!node._uiSourceCode.canRename())
return false;this.rename(node,false);return true;}
_handleContextMenuCreate(project,path,uiSourceCode){if(uiSourceCode){const relativePath=Persistence.FileSystemWorkspaceBinding.relativePath(uiSourceCode);relativePath.pop();path=relativePath.join('/');}
this.create(project,path,uiSourceCode);}
_handleContextMenuRename(node){this.rename(node,false);}
_handleContextMenuExclude(project,path){const shouldExclude=window.confirm(Common.UIString('Are you sure you want to exclude this folder?'));if(shouldExclude){UI.startBatchUpdate();project.excludeFolder(Persistence.FileSystemWorkspaceBinding.completeURL(project,path));UI.endBatchUpdate();}}
_handleContextMenuDelete(uiSourceCode){const shouldDelete=window.confirm(Common.UIString('Are you sure you want to delete this file?'));if(shouldDelete)
uiSourceCode.project().deleteFile(uiSourceCode);}
handleFileContextMenu(event,node){const uiSourceCode=node.uiSourceCode();const contextMenu=new UI.ContextMenu(event);contextMenu.appendApplicableItems(uiSourceCode);const project=uiSourceCode.project();if(project.type()===Workspace.projectTypes.FileSystem){contextMenu.editSection().appendItem(Common.UIString('Rename\u2026'),this._handleContextMenuRename.bind(this,node));contextMenu.editSection().appendItem(Common.UIString('Make a copy\u2026'),this._handleContextMenuCreate.bind(this,project,'',uiSourceCode));contextMenu.editSection().appendItem(Common.UIString('Delete'),this._handleContextMenuDelete.bind(this,uiSourceCode));}
contextMenu.show();}
handleFolderContextMenu(event,node){const path=node._folderPath||'';const project=node._project;const contextMenu=new UI.ContextMenu(event);Sources.NavigatorView.appendSearchItem(contextMenu,path);const folderPath=Common.ParsedURL.urlToPlatformPath(Persistence.FileSystemWorkspaceBinding.completeURL(project,path),Host.isWin());contextMenu.revealSection().appendItem(Common.UIString('Open folder'),()=>InspectorFrontendHost.showItemInFolder(folderPath));if(project.canCreateFile()){contextMenu.defaultSection().appendItem(Common.UIString('New file'),this._handleContextMenuCreate.bind(this,project,path));}
if(project.canExcludeFolder(path)){contextMenu.defaultSection().appendItem(Common.UIString('Exclude folder'),this._handleContextMenuExclude.bind(this,project,path));}
function removeFolder(){const shouldRemove=window.confirm(Common.UIString('Are you sure you want to remove this folder?'));if(shouldRemove)
project.remove();}
if(project.type()===Workspace.projectTypes.FileSystem){contextMenu.defaultSection().appendAction('sources.add-folder-to-workspace',undefined,true);if(node instanceof Sources.NavigatorGroupTreeNode)
contextMenu.defaultSection().appendItem(Common.UIString('Remove folder from workspace'),removeFolder);}
contextMenu.show();}
rename(node,creatingNewUISourceCode){const uiSourceCode=node.uiSourceCode();node.rename(callback.bind(this));function callback(committed){if(!creatingNewUISourceCode)
return;if(!committed)
uiSourceCode.remove();else if(node._treeElement.listItemElement.hasFocus())
this._sourceSelected(uiSourceCode,true);}}
async create(project,path,uiSourceCodeToCopy){let content='';if(uiSourceCodeToCopy)
content=(await uiSourceCodeToCopy.requestContent())||'';const uiSourceCode=await project.createFile(path,null,content);if(!uiSourceCode)
return;this._sourceSelected(uiSourceCode,false);const node=this.revealUISourceCode(uiSourceCode,true);if(node)
this.rename(node,true);}
_groupingChanged(){this.reset();this._initGrouping();this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this));}
_initGrouping(){this._groupByFrame=true;this._groupByDomain=this._navigatorGroupByFolderSetting.get();this._groupByFolder=this._groupByDomain;}
_resetForTest(){this.reset();this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this));}
_discardFrame(frame){const node=this._frameNodes.get(frame);if(!node)
return;if(node.parent)
node.parent.removeChild(node);this._frameNodes.delete(frame);for(const child of frame.childFrames)
this._discardFrame(child);}
targetAdded(target){}
targetRemoved(target){const targetNode=this._rootNode.child('target:'+target.id());if(targetNode)
this._rootNode.removeChild(targetNode);}
_targetNameChanged(event){const target=(event.data);const targetNode=this._rootNode.child('target:'+target.id());if(targetNode)
targetNode.setTitle(target.name());}};Sources.NavigatorView.Types={Domain:'domain',File:'file',FileSystem:'fs',FileSystemFolder:'fs-folder',Frame:'frame',NetworkFolder:'nw-folder',Root:'root',SourceMapFolder:'sm-folder',Worker:'worker'};Sources.NavigatorFolderTreeElement=class extends UI.TreeElement{constructor(navigatorView,type,title,hoverCallback){super('',true);this.listItemElement.classList.add('navigator-'+type+'-tree-item','navigator-folder-tree-item');this._nodeType=type;this.title=title;this.tooltip=title;this._navigatorView=navigatorView;this._hoverCallback=hoverCallback;let iconType='largeicon-navigator-folder';if(type===Sources.NavigatorView.Types.Domain)
iconType='largeicon-navigator-domain';else if(type===Sources.NavigatorView.Types.Frame)
iconType='largeicon-navigator-frame';else if(type===Sources.NavigatorView.Types.Worker)
iconType='largeicon-navigator-worker';this.setLeadingIcons([UI.Icon.create(iconType,'icon')]);}
async onpopulate(){this._node.populate();}
onattach(){this.collapse();this._node.onattach();this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),false);this.listItemElement.addEventListener('mousemove',this._mouseMove.bind(this),false);this.listItemElement.addEventListener('mouseleave',this._mouseLeave.bind(this),false);}
setNode(node){this._node=node;const paths=[];while(node&&!node.isRoot()){paths.push(node._title);node=node.parent;}
paths.reverse();this.tooltip=paths.join('/');}
_handleContextMenuEvent(event){if(!this._node)
return;this.select();this._navigatorView.handleFolderContextMenu(event,this._node);}
_mouseMove(event){if(this._hovered||!this._hoverCallback)
return;this._hovered=true;this._hoverCallback(true);}
_mouseLeave(event){if(!this._hoverCallback)
return;this._hovered=false;this._hoverCallback(false);}};Sources.NavigatorSourceTreeElement=class extends UI.TreeElement{constructor(navigatorView,uiSourceCode,title,node){super('',false);this._nodeType=Sources.NavigatorView.Types.File;this._node=node;this.title=title;this.listItemElement.classList.add('navigator-'+uiSourceCode.contentType().name()+'-tree-item','navigator-file-tree-item');this.tooltip=uiSourceCode.url();this._navigatorView=navigatorView;this._uiSourceCode=uiSourceCode;this.updateIcon();}
updateIcon(){const binding=Persistence.persistence.binding(this._uiSourceCode);if(binding){const container=createElementWithClass('span','icon-stack');let iconType='largeicon-navigator-file-sync';if(Snippets.isSnippetsUISourceCode(binding.fileSystem))
iconType='largeicon-navigator-snippet';const icon=UI.Icon.create(iconType,'icon');const badge=UI.Icon.create('badge-navigator-file-sync','icon-badge');if(Persistence.networkPersistenceManager.project()===binding.fileSystem.project())
badge.style.filter='hue-rotate(160deg)';container.appendChild(icon);container.appendChild(badge);container.title=Persistence.PersistenceUtils.tooltipForUISourceCode(this._uiSourceCode);this.setLeadingIcons([container]);}else{let iconType='largeicon-navigator-file';if(Snippets.isSnippetsUISourceCode(this._uiSourceCode))
iconType='largeicon-navigator-snippet';const defaultIcon=UI.Icon.create(iconType,'icon');this.setLeadingIcons([defaultIcon]);}}
get uiSourceCode(){return this._uiSourceCode;}
onattach(){this.listItemElement.draggable=true;this.listItemElement.addEventListener('click',this._onclick.bind(this),false);this.listItemElement.addEventListener('contextmenu',this._handleContextMenuEvent.bind(this),false);this.listItemElement.addEventListener('dragstart',this._ondragstart.bind(this),false);}
_shouldRenameOnMouseDown(){if(!this._uiSourceCode.canRename())
return false;const isSelected=this===this.treeOutline.selectedTreeElement;return isSelected&&this.treeOutline.element.hasFocus()&&!UI.isBeingEdited(this.treeOutline.element);}
selectOnMouseDown(event){if(event.which!==1||!this._shouldRenameOnMouseDown()){super.selectOnMouseDown(event);return;}
setTimeout(rename.bind(this),300);function rename(){if(this._shouldRenameOnMouseDown())
this._navigatorView.rename(this._node,false);}}
_ondragstart(event){event.dataTransfer.setData('text/plain',this._uiSourceCode.url());event.dataTransfer.effectAllowed='copy';}
onspace(){this._navigatorView._sourceSelected(this.uiSourceCode,true);return true;}
_onclick(event){this._navigatorView._sourceSelected(this.uiSourceCode,false);}
ondblclick(event){const middleClick=event.button===1;this._navigatorView._sourceSelected(this.uiSourceCode,!middleClick);return false;}
onenter(){this._navigatorView._sourceSelected(this.uiSourceCode,true);return true;}
ondelete(){return true;}
_handleContextMenuEvent(event){this.select();this._navigatorView.handleFileContextMenu(event,this._node);}};Sources.NavigatorTreeNode=class{constructor(id,type){this.id=id;this._type=type;this._children=new Map();}
treeNode(){throw'Not implemented';}
dispose(){}
isRoot(){return false;}
hasChildren(){return true;}
onattach(){}
setTitle(title){throw'Not implemented';}
populate(){if(this.isPopulated())
return;if(this.parent)
this.parent.populate();this._populated=true;this.wasPopulated();}
wasPopulated(){const children=this.children();for(let i=0;i<children.length;++i)
this.treeNode().appendChild((children[i].treeNode()));}
didAddChild(node){if(this.isPopulated())
this.treeNode().appendChild((node.treeNode()));}
willRemoveChild(node){if(this.isPopulated())
this.treeNode().removeChild((node.treeNode()));}
isPopulated(){return this._populated;}
isEmpty(){return!this._children.size;}
children(){return this._children.valuesArray();}
child(id){return this._children.get(id)||null;}
appendChild(node){this._children.set(node.id,node);node.parent=this;this.didAddChild(node);}
removeChild(node){this.willRemoveChild(node);this._children.remove(node.id);delete node.parent;node.dispose();}
reset(){this._children.clear();}};Sources.NavigatorRootTreeNode=class extends Sources.NavigatorTreeNode{constructor(navigatorView){super('',Sources.NavigatorView.Types.Root);this._navigatorView=navigatorView;}
isRoot(){return true;}
treeNode(){return this._navigatorView._scriptsTree.rootElement();}};Sources.NavigatorUISourceCodeTreeNode=class extends Sources.NavigatorTreeNode{constructor(navigatorView,uiSourceCode,frame){super(uiSourceCode.project().id()+':'+uiSourceCode.url(),Sources.NavigatorView.Types.File);this._navigatorView=navigatorView;this._uiSourceCode=uiSourceCode;this._treeElement=null;this._eventListeners=[];this._frame=frame;}
frame(){return this._frame;}
uiSourceCode(){return this._uiSourceCode;}
treeNode(){if(this._treeElement)
return this._treeElement;this._treeElement=new Sources.NavigatorSourceTreeElement(this._navigatorView,this._uiSourceCode,'',this);this.updateTitle();const updateTitleBound=this.updateTitle.bind(this,undefined);this._eventListeners=[this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.TitleChanged,updateTitleBound),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,updateTitleBound),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,updateTitleBound)];return this._treeElement;}
updateTitle(ignoreIsDirty){if(!this._treeElement)
return;let titleText=this._uiSourceCode.displayName();if(!ignoreIsDirty&&this._uiSourceCode.isDirty())
titleText='*'+titleText;this._treeElement.title=titleText;this._treeElement.updateIcon();let tooltip=this._uiSourceCode.url();if(this._uiSourceCode.contentType().isFromSourceMap())
tooltip=Common.UIString('%s (from source map)',this._uiSourceCode.displayName());this._treeElement.tooltip=tooltip;}
hasChildren(){return false;}
dispose(){Common.EventTarget.removeEventListeners(this._eventListeners);}
reveal(select){this.parent.populate();this.parent.treeNode().expand();this._treeElement.reveal(true);if(select)
this._treeElement.select(true);}
rename(callback){if(!this._treeElement)
return;this._treeElement.listItemElement.focus();const treeOutlineElement=this._treeElement.treeOutline.element;UI.markBeingEdited(treeOutlineElement,true);function commitHandler(element,newTitle,oldTitle){if(newTitle!==oldTitle){this._treeElement.title=newTitle;this._uiSourceCode.rename(newTitle).then(renameCallback.bind(this));return;}
afterEditing.call(this,true);}
function renameCallback(success){if(!success){UI.markBeingEdited(treeOutlineElement,false);this.updateTitle();this.rename(callback);return;}
afterEditing.call(this,true);}
function afterEditing(committed){UI.markBeingEdited(treeOutlineElement,false);this.updateTitle();if(callback)
callback(committed);}
this.updateTitle(true);this._treeElement.startEditingTitle(new UI.InplaceEditor.Config(commitHandler.bind(this),afterEditing.bind(this,false)));}};Sources.NavigatorFolderTreeNode=class extends Sources.NavigatorTreeNode{constructor(navigatorView,project,id,type,folderPath,title){super(id,type);this._navigatorView=navigatorView;this._project=project;this._folderPath=folderPath;this._title=title;}
treeNode(){if(this._treeElement)
return this._treeElement;this._treeElement=this._createTreeElement(this._title,this);this.updateTitle();return this._treeElement;}
updateTitle(){if(!this._treeElement||this._project.type()!==Workspace.projectTypes.FileSystem)
return;const absoluteFileSystemPath=Persistence.FileSystemWorkspaceBinding.fileSystemPath(this._project.id())+'/'+this._folderPath;const hasMappedFiles=Persistence.persistence.filePathHasBindings(absoluteFileSystemPath);this._treeElement.listItemElement.classList.toggle('has-mapped-files',hasMappedFiles);}
_createTreeElement(title,node){if(this._project.type()!==Workspace.projectTypes.FileSystem){try{title=decodeURI(title);}catch(e){}}
const treeElement=new Sources.NavigatorFolderTreeElement(this._navigatorView,this._type,title);treeElement.setNode(node);return treeElement;}
wasPopulated(){if(!this._treeElement||this._treeElement._node!==this)
return;this._addChildrenRecursive();}
_addChildrenRecursive(){const children=this.children();for(let i=0;i<children.length;++i){const child=children[i];this.didAddChild(child);if(child instanceof Sources.NavigatorFolderTreeNode)
child._addChildrenRecursive();}}
_shouldMerge(node){return this._type!==Sources.NavigatorView.Types.Domain&&node instanceof Sources.NavigatorFolderTreeNode;}
didAddChild(node){function titleForNode(node){return node._title;}
if(!this._treeElement)
return;let children=this.children();if(children.length===1&&this._shouldMerge(node)){node._isMerged=true;this._treeElement.title=this._treeElement.title+'/'+node._title;node._treeElement=this._treeElement;this._treeElement.setNode(node);return;}
let oldNode;if(children.length===2)
oldNode=children[0]!==node?children[0]:children[1];if(oldNode&&oldNode._isMerged){delete oldNode._isMerged;const mergedToNodes=[];mergedToNodes.push(this);let treeNode=this;while(treeNode._isMerged){treeNode=treeNode.parent;mergedToNodes.push(treeNode);}
mergedToNodes.reverse();const titleText=mergedToNodes.map(titleForNode).join('/');const nodes=[];treeNode=oldNode;do{nodes.push(treeNode);children=treeNode.children();treeNode=children.length===1?children[0]:null;}while(treeNode&&treeNode._isMerged);if(!this.isPopulated()){this._treeElement.title=titleText;this._treeElement.setNode(this);for(let i=0;i<nodes.length;++i){delete nodes[i]._treeElement;delete nodes[i]._isMerged;}
return;}
const oldTreeElement=this._treeElement;const treeElement=this._createTreeElement(titleText,this);for(let i=0;i<mergedToNodes.length;++i)
mergedToNodes[i]._treeElement=treeElement;oldTreeElement.parent.appendChild(treeElement);oldTreeElement.setNode(nodes[nodes.length-1]);oldTreeElement.title=nodes.map(titleForNode).join('/');oldTreeElement.parent.removeChild(oldTreeElement);this._treeElement.appendChild(oldTreeElement);if(oldTreeElement.expanded)
treeElement.expand();}
if(this.isPopulated())
this._treeElement.appendChild(node.treeNode());}
willRemoveChild(node){if(node._isMerged||!this.isPopulated())
return;this._treeElement.removeChild(node._treeElement);}};Sources.NavigatorGroupTreeNode=class extends Sources.NavigatorTreeNode{constructor(navigatorView,project,id,type,title){super(id,type);this._project=project;this._navigatorView=navigatorView;this._title=title;this.populate();}
setHoverCallback(hoverCallback){this._hoverCallback=hoverCallback;}
treeNode(){if(this._treeElement)
return this._treeElement;this._treeElement=new Sources.NavigatorFolderTreeElement(this._navigatorView,this._type,this._title,this._hoverCallback);this._treeElement.setNode(this);return this._treeElement;}
onattach(){this.updateTitle();}
updateTitle(){if(!this._treeElement||this._project.type()!==Workspace.projectTypes.FileSystem)
return;const fileSystemPath=Persistence.FileSystemWorkspaceBinding.fileSystemPath(this._project.id());const wasActive=this._treeElement.listItemElement.classList.contains('has-mapped-files');const isActive=Persistence.persistence.filePathHasBindings(fileSystemPath);if(wasActive===isActive)
return;this._treeElement.listItemElement.classList.toggle('has-mapped-files',isActive);if(this._treeElement.childrenListElement.hasFocus())
return;if(isActive)
this._treeElement.expand();else
this._treeElement.collapse();}
setTitle(title){this._title=title;if(this._treeElement)
this._treeElement.title=this._title;}};;Sources.ScopeChainSidebarPane=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS('sources/scopeChainSidebarPane.css');this._treeOutline=new ObjectUI.ObjectPropertiesSectionsTreeOutline();this._treeOutline.registerRequiredCSS('sources/scopeChainSidebarPane.css');this._treeOutline.setShowSelectionOnKeyboardFocus(true);this._expandController=new ObjectUI.ObjectPropertiesSectionsTreeExpandController(this._treeOutline);this._linkifier=new Components.Linkifier();this._infoElement=createElement('div');this._infoElement.className='gray-info-message';this._infoElement.textContent=ls`Not paused`;this._infoElement.tabIndex=-1;this._update();}
flavorChanged(object){this._update();}
focus(){if(this.hasFocus())
return;if(!UI.context.flavor(SDK.DebuggerPausedDetails))
this._infoElement.focus();else
this._treeOutline.forceSelect();}
_update(){const callFrame=UI.context.flavor(SDK.DebuggerModel.CallFrame);const details=UI.context.flavor(SDK.DebuggerPausedDetails);this._linkifier.reset();Sources.SourceMapNamesResolver.resolveThisObject(callFrame).then(this._innerUpdate.bind(this,details,callFrame));}
_innerUpdate(details,callFrame,thisObject){this._treeOutline.removeChildren();this.contentElement.removeChildren();if(!details||!callFrame){this.contentElement.appendChild(this._infoElement);return;}
this.contentElement.appendChild(this._treeOutline.element);let foundLocalScope=false;const scopeChain=callFrame.scopeChain();for(let i=0;i<scopeChain.length;++i){const scope=scopeChain[i];const extraProperties=this._extraPropertiesForScope(scope,details,callFrame,thisObject,i===0);if(scope.type()===Protocol.Debugger.ScopeType.Local)
foundLocalScope=true;const section=this._createScopeSectionTreeElement(scope,extraProperties);if(scope.type()===Protocol.Debugger.ScopeType.Global)
section.collapse();else if(!foundLocalScope||scope.type()===Protocol.Debugger.ScopeType.Local)
section.expand();this._treeOutline.appendChild(section);if(i===0)
section.select(true);}
this._sidebarPaneUpdatedForTest();}
_createScopeSectionTreeElement(scope,extraProperties){let emptyPlaceholder=null;if(scope.type()===Protocol.Debugger.ScopeType.Local||Protocol.Debugger.ScopeType.Closure)
emptyPlaceholder=ls`No variables`;let title=scope.typeName();if(scope.type()===Protocol.Debugger.ScopeType.Closure){const scopeName=scope.name();if(scopeName)
title=ls`Closure (${UI.beautifyFunctionName(scopeName)})`;else
title=ls`Closure`;}
let subtitle=scope.description();if(!title||title===subtitle)
subtitle=undefined;const titleElement=createElementWithClass('div','scope-chain-sidebar-pane-section-header tree-element-title');titleElement.createChild('div','scope-chain-sidebar-pane-section-subtitle').textContent=subtitle;titleElement.createChild('div','scope-chain-sidebar-pane-section-title').textContent=title;const section=new ObjectUI.ObjectPropertiesSection.RootElement(Sources.SourceMapNamesResolver.resolveScopeInObject(scope),this._linkifier,emptyPlaceholder,true,extraProperties);section.title=titleElement;section.listItemElement.classList.add('scope-chain-sidebar-pane-section');this._expandController.watchSection(title+(subtitle?':'+subtitle:''),section);return section;}
_extraPropertiesForScope(scope,details,callFrame,thisObject,isFirstScope){if(scope.type()!==Protocol.Debugger.ScopeType.Local)
return[];const extraProperties=[];if(thisObject)
extraProperties.push(new SDK.RemoteObjectProperty('this',thisObject));if(isFirstScope){const exception=details.exception();if(exception){extraProperties.push(new SDK.RemoteObjectProperty(Common.UIString('Exception'),exception,undefined,undefined,undefined,undefined,undefined,true));}
const returnValue=callFrame.returnValue();if(returnValue){extraProperties.push(new SDK.RemoteObjectProperty(Common.UIString('Return value'),returnValue,undefined,undefined,undefined,undefined,undefined,true,callFrame.setReturnValue.bind(callFrame)));}}
return extraProperties;}
_sidebarPaneUpdatedForTest(){}};Sources.ScopeChainSidebarPane._pathSymbol=Symbol('path');;Sources.NetworkNavigatorView=class extends Sources.NavigatorView{constructor(){super();SDK.targetManager.addEventListener(SDK.TargetManager.Events.InspectedURLChanged,this._inspectedURLChanged,this);Host.userMetrics.panelLoaded('sources','DevTools.Launch.Sources');}
acceptProject(project){return project.type()===Workspace.projectTypes.Network;}
_inspectedURLChanged(event){const mainTarget=SDK.targetManager.mainTarget();if(event.data!==mainTarget)
return;const inspectedURL=mainTarget&&mainTarget.inspectedURL();if(!inspectedURL)
return;for(const uiSourceCode of this.workspace().uiSourceCodes()){if(this.acceptProject(uiSourceCode.project())&&uiSourceCode.url()===inspectedURL)
this.revealUISourceCode(uiSourceCode,true);}}
uiSourceCodeAdded(uiSourceCode){const mainTarget=SDK.targetManager.mainTarget();const inspectedURL=mainTarget&&mainTarget.inspectedURL();if(!inspectedURL)
return;if(uiSourceCode.url()===inspectedURL)
this.revealUISourceCode(uiSourceCode,true);}};Sources.FilesNavigatorView=class extends Sources.NavigatorView{constructor(){super();const placeholder=new UI.EmptyWidget('');this.setPlaceholder(placeholder);placeholder.appendParagraph().appendChild(UI.html`
      <div>${ls`Sync changes in DevTools with the local filesystem`}</div>`);const toolbar=new UI.Toolbar('navigator-toolbar');toolbar.appendItemsAtLocation('files-navigator-toolbar').then(()=>{if(!toolbar.empty())
this.contentElement.insertBefore(toolbar.element,this.contentElement.firstChild);});}
acceptProject(project){return project.type()===Workspace.projectTypes.FileSystem&&Persistence.FileSystemWorkspaceBinding.fileSystemType(project)!=='overrides'&&!Snippets.isSnippetsProject(project);}
handleContextMenu(event){const contextMenu=new UI.ContextMenu(event);contextMenu.defaultSection().appendAction('sources.add-folder-to-workspace',undefined,true);contextMenu.show();}};Sources.OverridesNavigatorView=class extends Sources.NavigatorView{constructor(){super();const placeholder=new UI.EmptyWidget('');this.setPlaceholder(placeholder);placeholder.appendParagraph().appendChild(UI.html`
      <div>${ls`Override page assets with files from a local folder`}</div>`);this._toolbar=new UI.Toolbar('navigator-toolbar');this.contentElement.insertBefore(this._toolbar.element,this.contentElement.firstChild);Persistence.networkPersistenceManager.addEventListener(Persistence.NetworkPersistenceManager.Events.ProjectChanged,this._updateProjectAndUI,this);this.workspace().addEventListener(Workspace.Workspace.Events.ProjectAdded,this._onProjectAddOrRemoved,this);this.workspace().addEventListener(Workspace.Workspace.Events.ProjectRemoved,this._onProjectAddOrRemoved,this);this._updateProjectAndUI();}
_onProjectAddOrRemoved(event){const project=(event.data);if(project&&project.type()===Workspace.projectTypes.FileSystem&&Persistence.FileSystemWorkspaceBinding.fileSystemType(project)!=='overrides')
return;this._updateUI();}
_updateProjectAndUI(){this.reset();const project=Persistence.networkPersistenceManager.project();if(project)
this.tryAddProject(project);this._updateUI();}
_updateUI(){this._toolbar.removeToolbarItems();const project=Persistence.networkPersistenceManager.project();if(project){const enableCheckbox=new UI.ToolbarSettingCheckbox(Common.settings.moduleSetting('persistenceNetworkOverridesEnabled'));this._toolbar.appendToolbarItem(enableCheckbox);this._toolbar.appendToolbarItem(new UI.ToolbarSeparator(true));const clearButton=new UI.ToolbarButton(Common.UIString('Clear configuration'),'largeicon-clear');clearButton.addEventListener(UI.ToolbarButton.Events.Click,()=>{project.remove();});this._toolbar.appendToolbarItem(clearButton);return;}
const title=Common.UIString('Select folder for overrides');const setupButton=new UI.ToolbarButton(title,'largeicon-add',title);setupButton.addEventListener(UI.ToolbarButton.Events.Click,this._setupNewWorkspace,this);this._toolbar.appendToolbarItem(setupButton);}
async _setupNewWorkspace(){const fileSystem=await Persistence.isolatedFileSystemManager.addFileSystem('overrides');if(!fileSystem)
return;Common.settings.moduleSetting('persistenceNetworkOverridesEnabled').set(true);}
acceptProject(project){return project===Persistence.networkPersistenceManager.project();}};Sources.ContentScriptsNavigatorView=class extends Sources.NavigatorView{constructor(){super();const placeholder=new UI.EmptyWidget('');this.setPlaceholder(placeholder);placeholder.appendParagraph().appendChild(UI.html`
      <div>${ls`Content scripts served by extensions appear here`}</div>`);}
acceptProject(project){return project.type()===Workspace.projectTypes.ContentScripts;}};Sources.SnippetsNavigatorView=class extends Sources.NavigatorView{constructor(){super();const placeholder=new UI.EmptyWidget('');this.setPlaceholder(placeholder);placeholder.appendParagraph().appendChild(UI.html`
      <div>${ls`Create and save code snippets for later reuse`}</div>`);const toolbar=new UI.Toolbar('navigator-toolbar');const newButton=new UI.ToolbarButton('','largeicon-add',Common.UIString('New snippet'));newButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this.create(Snippets.project,''));toolbar.appendToolbarItem(newButton);this.contentElement.insertBefore(toolbar.element,this.contentElement.firstChild);}
acceptProject(project){return Snippets.isSnippetsProject(project);}
handleContextMenu(event){const contextMenu=new UI.ContextMenu(event);contextMenu.headerSection().appendItem(Common.UIString('New'),()=>this.create(Snippets.project,''));contextMenu.show();}
handleFileContextMenu(event,node){const uiSourceCode=node.uiSourceCode();const contextMenu=new UI.ContextMenu(event);contextMenu.headerSection().appendItem(Common.UIString('Run'),()=>Snippets.evaluateScriptSnippet(uiSourceCode));contextMenu.editSection().appendItem(Common.UIString('Rename\u2026'),()=>this.rename(node,false));contextMenu.editSection().appendItem(Common.UIString('Remove'),()=>uiSourceCode.project().deleteFile(uiSourceCode));contextMenu.saveSection().appendItem(Common.UIString('Save as...'),this._handleSaveAs.bind(this,uiSourceCode));contextMenu.show();}
async _handleSaveAs(uiSourceCode){uiSourceCode.commitWorkingCopy();const content=await uiSourceCode.requestContent();Workspace.fileManager.save(uiSourceCode.url(),content,true);Workspace.fileManager.close(uiSourceCode.url());}};Sources.ActionDelegate=class{handleAction(context,actionId){switch(actionId){case'sources.create-snippet':Snippets.project.createFile('',null,'').then(uiSourceCode=>Common.Revealer.reveal(uiSourceCode));return true;case'sources.add-folder-to-workspace':Persistence.isolatedFileSystemManager.addFileSystem();return true;}
return false;}};;Sources.OutlineQuickOpen=class extends QuickOpen.FilteredListWidget.Provider{constructor(){super();this._items=[];this._active=false;}
attach(){this._items=[];this._active=false;const uiSourceCode=this._currentUISourceCode();if(uiSourceCode){this._active=Formatter.formatterWorkerPool().outlineForMimetype(uiSourceCode.workingCopy(),uiSourceCode.contentType().canonicalMimeType(),this._didBuildOutlineChunk.bind(this));}}
_didBuildOutlineChunk(isLastChunk,items){this._items.push(...items);this.refresh();}
itemCount(){return this._items.length;}
itemKeyAt(itemIndex){const item=this._items[itemIndex];return item.title+(item.subtitle?item.subtitle:'');}
itemScoreAt(itemIndex,query){const item=this._items[itemIndex];const methodName=query.split('(')[0];if(methodName.toLowerCase()===item.title.toLowerCase())
return 1/(1+item.line);return-item.line-1;}
renderItem(itemIndex,query,titleElement,subtitleElement){const item=this._items[itemIndex];titleElement.textContent=item.title+(item.subtitle?item.subtitle:'');QuickOpen.FilteredListWidget.highlightRanges(titleElement,query);subtitleElement.textContent=':'+(item.line+1);}
selectItem(itemIndex,promptValue){if(itemIndex===null)
return;const uiSourceCode=this._currentUISourceCode();if(!uiSourceCode)
return;const lineNumber=this._items[itemIndex].line;if(!isNaN(lineNumber)&&lineNumber>=0)
Common.Revealer.reveal(uiSourceCode.uiLocation(lineNumber,this._items[itemIndex].column));}
_currentUISourceCode(){const sourcesView=UI.context.flavor(Sources.SourcesView);if(!sourcesView)
return null;return sourcesView.currentUISourceCode();}
notFoundText(){if(!this._currentUISourceCode())
return Common.UIString('No file selected.');if(!this._active)
return Common.UIString('Open a JavaScript or CSS file to see symbols');return Common.UIString('No results found');}};;Sources.TabbedEditorContainerDelegate=function(){};Sources.TabbedEditorContainerDelegate.prototype={viewForFile(uiSourceCode){},recycleUISourceCodeFrame(sourceFrame,uiSourceCode){},};Sources.TabbedEditorContainer=class extends Common.Object{constructor(delegate,setting,placeholderElement,focusedPlaceholderElement){super();this._delegate=delegate;this._tabbedPane=new UI.TabbedPane();this._tabbedPane.setPlaceholderElement(placeholderElement,focusedPlaceholderElement);this._tabbedPane.setTabDelegate(new Sources.EditorContainerTabDelegate(this));this._tabbedPane.setCloseableTabs(true);this._tabbedPane.setAllowTabReorder(true,true);this._tabbedPane.addEventListener(UI.TabbedPane.Events.TabClosed,this._tabClosed,this);this._tabbedPane.addEventListener(UI.TabbedPane.Events.TabSelected,this._tabSelected,this);Persistence.persistence.addEventListener(Persistence.Persistence.Events.BindingCreated,this._onBindingCreated,this);Persistence.persistence.addEventListener(Persistence.Persistence.Events.BindingRemoved,this._onBindingRemoved,this);this._tabIds=new Map();this._files={};this._previouslyViewedFilesSetting=setting;this._history=Sources.TabbedEditorContainer.History.fromObject(this._previouslyViewedFilesSetting.get());}
_onBindingCreated(event){const binding=(event.data);this._updateFileTitle(binding.fileSystem);const networkTabId=this._tabIds.get(binding.network);let fileSystemTabId=this._tabIds.get(binding.fileSystem);const wasSelectedInNetwork=this._currentFile===binding.network;const currentSelectionRange=this._history.selectionRange(binding.network.url());const currentScrollLineNumber=this._history.scrollLineNumber(binding.network.url());this._history.remove(binding.network.url());if(!networkTabId)
return;if(!fileSystemTabId){const networkView=this._tabbedPane.tabView(networkTabId);const tabIndex=this._tabbedPane.tabIndex(networkTabId);if(networkView instanceof Sources.UISourceCodeFrame){this._delegate.recycleUISourceCodeFrame(networkView,binding.fileSystem);fileSystemTabId=this._appendFileTab(binding.fileSystem,false,tabIndex,networkView);}else{fileSystemTabId=this._appendFileTab(binding.fileSystem,false,tabIndex);const fileSystemTabView=(this._tabbedPane.tabView(fileSystemTabId));this._restoreEditorProperties(fileSystemTabView,currentSelectionRange,currentScrollLineNumber);}}
this._closeTabs([networkTabId],true);if(wasSelectedInNetwork)
this._tabbedPane.selectTab(fileSystemTabId,false);this._updateHistory();}
_onBindingRemoved(event){const binding=(event.data);this._updateFileTitle(binding.fileSystem);}
get view(){return this._tabbedPane;}
get visibleView(){return this._tabbedPane.visibleView;}
fileViews(){return(this._tabbedPane.tabViews());}
leftToolbar(){return this._tabbedPane.leftToolbar();}
rightToolbar(){return this._tabbedPane.rightToolbar();}
show(parentElement){this._tabbedPane.show(parentElement);}
showFile(uiSourceCode){this._innerShowFile(uiSourceCode,true);}
closeFile(uiSourceCode){const tabId=this._tabIds.get(uiSourceCode);if(!tabId)
return;this._closeTabs([tabId]);}
closeAllFiles(){this._closeTabs(this._tabbedPane.tabIds());}
historyUISourceCodes(){const uriToUISourceCode={};for(const id in this._files){const uiSourceCode=this._files[id];uriToUISourceCode[uiSourceCode.url()]=uiSourceCode;}
const result=[];const uris=this._history._urls();for(let i=0;i<uris.length;++i){const uiSourceCode=uriToUISourceCode[uris[i]];if(uiSourceCode)
result.push(uiSourceCode);}
return result;}
_addViewListeners(){if(!this._currentView||!this._currentView.textEditor)
return;this._currentView.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.ScrollChanged,this._scrollChanged,this);this._currentView.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.SelectionChanged,this._selectionChanged,this);}
_removeViewListeners(){if(!this._currentView||!this._currentView.textEditor)
return;this._currentView.textEditor.removeEventListener(SourceFrame.SourcesTextEditor.Events.ScrollChanged,this._scrollChanged,this);this._currentView.textEditor.removeEventListener(SourceFrame.SourcesTextEditor.Events.SelectionChanged,this._selectionChanged,this);}
_scrollChanged(event){if(this._scrollTimer)
clearTimeout(this._scrollTimer);const lineNumber=(event.data);this._scrollTimer=setTimeout(saveHistory.bind(this),100);this._history.updateScrollLineNumber(this._currentFile.url(),lineNumber);function saveHistory(){this._history.save(this._previouslyViewedFilesSetting);}}
_selectionChanged(event){const range=(event.data);this._history.updateSelectionRange(this._currentFile.url(),range);this._history.save(this._previouslyViewedFilesSetting);Extensions.extensionServer.sourceSelectionChanged(this._currentFile.url(),range);}
_innerShowFile(uiSourceCode,userGesture){const binding=Persistence.persistence.binding(uiSourceCode);uiSourceCode=binding?binding.fileSystem:uiSourceCode;if(this._currentFile===uiSourceCode)
return;this._removeViewListeners();this._currentFile=uiSourceCode;const tabId=this._tabIds.get(uiSourceCode)||this._appendFileTab(uiSourceCode,userGesture);this._tabbedPane.selectTab(tabId,userGesture);if(userGesture)
this._editorSelectedByUserAction();const previousView=this._currentView;this._currentView=this.visibleView;this._addViewListeners();const eventData={currentFile:this._currentFile,currentView:this._currentView,previousView:previousView,userGesture:userGesture};this.dispatchEventToListeners(Sources.TabbedEditorContainer.Events.EditorSelected,eventData);}
_titleForFile(uiSourceCode){const maxDisplayNameLength=30;let title=uiSourceCode.displayName(true).trimMiddle(maxDisplayNameLength);if(uiSourceCode.isDirty())
title+='*';return title;}
_maybeCloseTab(id,nextTabId){const uiSourceCode=this._files[id];const shouldPrompt=uiSourceCode.isDirty()&&uiSourceCode.project().canSetFileContent();if(!shouldPrompt||confirm(Common.UIString('Are you sure you want to close unsaved file: %s?',uiSourceCode.name()))){uiSourceCode.resetWorkingCopy();if(nextTabId)
this._tabbedPane.selectTab(nextTabId,true);this._tabbedPane.closeTab(id,true);return true;}
return false;}
_closeTabs(ids,forceCloseDirtyTabs){const dirtyTabs=[];const cleanTabs=[];for(let i=0;i<ids.length;++i){const id=ids[i];const uiSourceCode=this._files[id];if(!forceCloseDirtyTabs&&uiSourceCode.isDirty())
dirtyTabs.push(id);else
cleanTabs.push(id);}
if(dirtyTabs.length)
this._tabbedPane.selectTab(dirtyTabs[0],true);this._tabbedPane.closeTabs(cleanTabs,true);for(let i=0;i<dirtyTabs.length;++i){const nextTabId=i+1<dirtyTabs.length?dirtyTabs[i+1]:null;if(!this._maybeCloseTab(dirtyTabs[i],nextTabId))
break;}}
_onContextMenu(tabId,contextMenu){const uiSourceCode=this._files[tabId];if(uiSourceCode)
contextMenu.appendApplicableItems(uiSourceCode);}
addUISourceCode(uiSourceCode){const binding=Persistence.persistence.binding(uiSourceCode);uiSourceCode=binding?binding.fileSystem:uiSourceCode;if(this._currentFile===uiSourceCode)
return;const uri=uiSourceCode.url();const index=this._history.index(uri);if(index===-1)
return;if(!this._tabIds.has(uiSourceCode))
this._appendFileTab(uiSourceCode,false);if(!index){this._innerShowFile(uiSourceCode,false);return;}
if(!this._currentFile)
return;const currentProjectIsSnippets=Snippets.isSnippetsUISourceCode(this._currentFile);const addedProjectIsSnippets=Snippets.isSnippetsUISourceCode(uiSourceCode);if(this._history.index(this._currentFile.url())&&currentProjectIsSnippets&&!addedProjectIsSnippets)
this._innerShowFile(uiSourceCode,false);}
removeUISourceCode(uiSourceCode){this.removeUISourceCodes([uiSourceCode]);}
removeUISourceCodes(uiSourceCodes){const tabIds=[];for(let i=0;i<uiSourceCodes.length;++i){const uiSourceCode=uiSourceCodes[i];const tabId=this._tabIds.get(uiSourceCode);if(tabId)
tabIds.push(tabId);}
this._tabbedPane.closeTabs(tabIds);}
_editorClosedByUserAction(uiSourceCode){this._history.remove(uiSourceCode.url());this._updateHistory();}
_editorSelectedByUserAction(){this._updateHistory();}
_updateHistory(){const tabIds=this._tabbedPane.lastOpenedTabIds(Sources.TabbedEditorContainer.maximalPreviouslyViewedFilesCount);function tabIdToURI(tabId){return this._files[tabId].url();}
this._history.update(tabIds.map(tabIdToURI.bind(this)));this._history.save(this._previouslyViewedFilesSetting);}
_tooltipForFile(uiSourceCode){uiSourceCode=Persistence.persistence.network(uiSourceCode)||uiSourceCode;return uiSourceCode.url();}
_appendFileTab(uiSourceCode,userGesture,index,replaceView){const view=replaceView||this._delegate.viewForFile(uiSourceCode);const title=this._titleForFile(uiSourceCode);const tooltip=this._tooltipForFile(uiSourceCode);const tabId=this._generateTabId();this._tabIds.set(uiSourceCode,tabId);this._files[tabId]=uiSourceCode;if(!replaceView){const savedSelectionRange=this._history.selectionRange(uiSourceCode.url());const savedScrollLineNumber=this._history.scrollLineNumber(uiSourceCode.url());this._restoreEditorProperties(view,savedSelectionRange,savedScrollLineNumber);}
this._tabbedPane.appendTab(tabId,title,view,tooltip,userGesture,undefined,index);this._updateFileTitle(uiSourceCode);this._addUISourceCodeListeners(uiSourceCode);return tabId;}
_restoreEditorProperties(editorView,selection,firstLineNumber){const sourceFrame=editorView instanceof SourceFrame.SourceFrame?(editorView):null;if(!sourceFrame)
return;if(selection)
sourceFrame.setSelection(selection);if(typeof firstLineNumber==='number')
sourceFrame.scrollToLine(firstLineNumber);}
_tabClosed(event){const tabId=(event.data.tabId);const userGesture=(event.data.isUserGesture);const uiSourceCode=this._files[tabId];if(this._currentFile===uiSourceCode){this._removeViewListeners();delete this._currentView;delete this._currentFile;}
this._tabIds.remove(uiSourceCode);delete this._files[tabId];this._removeUISourceCodeListeners(uiSourceCode);this.dispatchEventToListeners(Sources.TabbedEditorContainer.Events.EditorClosed,uiSourceCode);if(userGesture)
this._editorClosedByUserAction(uiSourceCode);}
_tabSelected(event){const tabId=(event.data.tabId);const userGesture=(event.data.isUserGesture);const uiSourceCode=this._files[tabId];this._innerShowFile(uiSourceCode,userGesture);}
_addUISourceCodeListeners(uiSourceCode){uiSourceCode.addEventListener(Workspace.UISourceCode.Events.TitleChanged,this._uiSourceCodeTitleChanged,this);uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._uiSourceCodeWorkingCopyChanged,this);uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._uiSourceCodeWorkingCopyCommitted,this);}
_removeUISourceCodeListeners(uiSourceCode){uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.TitleChanged,this._uiSourceCodeTitleChanged,this);uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._uiSourceCodeWorkingCopyChanged,this);uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._uiSourceCodeWorkingCopyCommitted,this);}
_updateFileTitle(uiSourceCode){const tabId=this._tabIds.get(uiSourceCode);if(tabId){const title=this._titleForFile(uiSourceCode);this._tabbedPane.changeTabTitle(tabId,title);let icon=null;if(Persistence.persistence.hasUnsavedCommittedChanges(uiSourceCode)){icon=UI.Icon.create('smallicon-warning');icon.title=Common.UIString('Changes to this file were not saved to file system.');}else{icon=Persistence.PersistenceUtils.iconForUISourceCode(uiSourceCode);}
this._tabbedPane.setTabIcon(tabId,icon);}}
_uiSourceCodeTitleChanged(event){const uiSourceCode=(event.data);this._updateFileTitle(uiSourceCode);this._updateHistory();}
_uiSourceCodeWorkingCopyChanged(event){const uiSourceCode=(event.data);this._updateFileTitle(uiSourceCode);}
_uiSourceCodeWorkingCopyCommitted(event){const uiSourceCode=(event.data.uiSourceCode);this._updateFileTitle(uiSourceCode);}
_generateTabId(){return'tab_'+(Sources.TabbedEditorContainer._tabId++);}
currentFile(){return this._currentFile||null;}};Sources.TabbedEditorContainer.Events={EditorSelected:Symbol('EditorSelected'),EditorClosed:Symbol('EditorClosed')};Sources.TabbedEditorContainer._tabId=0;Sources.TabbedEditorContainer.maximalPreviouslyViewedFilesCount=30;Sources.TabbedEditorContainer.HistoryItem=class{constructor(url,selectionRange,scrollLineNumber){this.url=url;this._isSerializable=url.length<Sources.TabbedEditorContainer.HistoryItem.serializableUrlLengthLimit;this.selectionRange=selectionRange;this.scrollLineNumber=scrollLineNumber;}
static fromObject(serializedHistoryItem){const selectionRange=serializedHistoryItem.selectionRange?TextUtils.TextRange.fromObject(serializedHistoryItem.selectionRange):undefined;return new Sources.TabbedEditorContainer.HistoryItem(serializedHistoryItem.url,selectionRange,serializedHistoryItem.scrollLineNumber);}
serializeToObject(){if(!this._isSerializable)
return null;const serializedHistoryItem={};serializedHistoryItem.url=this.url;serializedHistoryItem.selectionRange=this.selectionRange;serializedHistoryItem.scrollLineNumber=this.scrollLineNumber;return serializedHistoryItem;}};Sources.TabbedEditorContainer.HistoryItem.serializableUrlLengthLimit=4096;Sources.TabbedEditorContainer.History=class{constructor(items){this._items=items;this._rebuildItemIndex();}
static fromObject(serializedHistory){const items=[];for(let i=0;i<serializedHistory.length;++i)
items.push(Sources.TabbedEditorContainer.HistoryItem.fromObject(serializedHistory[i]));return new Sources.TabbedEditorContainer.History(items);}
index(url){return this._itemsIndex.has(url)?(this._itemsIndex.get(url)):-1;}
_rebuildItemIndex(){this._itemsIndex=new Map();for(let i=0;i<this._items.length;++i){console.assert(!this._itemsIndex.has(this._items[i].url));this._itemsIndex.set(this._items[i].url,i);}}
selectionRange(url){const index=this.index(url);return index!==-1?this._items[index].selectionRange:undefined;}
updateSelectionRange(url,selectionRange){if(!selectionRange)
return;const index=this.index(url);if(index===-1)
return;this._items[index].selectionRange=selectionRange;}
scrollLineNumber(url){const index=this.index(url);return index!==-1?this._items[index].scrollLineNumber:undefined;}
updateScrollLineNumber(url,scrollLineNumber){const index=this.index(url);if(index===-1)
return;this._items[index].scrollLineNumber=scrollLineNumber;}
update(urls){for(let i=urls.length-1;i>=0;--i){const index=this.index(urls[i]);let item;if(index!==-1){item=this._items[index];this._items.splice(index,1);}else{item=new Sources.TabbedEditorContainer.HistoryItem(urls[i]);}
this._items.unshift(item);this._rebuildItemIndex();}}
remove(url){const index=this.index(url);if(index!==-1){this._items.splice(index,1);this._rebuildItemIndex();}}
save(setting){setting.set(this._serializeToObject());}
_serializeToObject(){const serializedHistory=[];for(let i=0;i<this._items.length;++i){const serializedItem=this._items[i].serializeToObject();if(serializedItem)
serializedHistory.push(serializedItem);if(serializedHistory.length===Sources.TabbedEditorContainer.maximalPreviouslyViewedFilesCount)
break;}
return serializedHistory;}
_urls(){const result=[];for(let i=0;i<this._items.length;++i)
result.push(this._items[i].url);return result;}};Sources.EditorContainerTabDelegate=class{constructor(editorContainer){this._editorContainer=editorContainer;}
closeTabs(tabbedPane,ids){this._editorContainer._closeTabs(ids);}
onContextMenu(tabId,contextMenu){this._editorContainer._onContextMenu(tabId,contextMenu);}};;Sources.WatchExpressionsSidebarPane=class extends UI.ThrottledWidget{constructor(){super(true);this.registerRequiredCSS('object_ui/objectValue.css');this.registerRequiredCSS('sources/watchExpressionsSidebarPane.css');this._watchExpressions=[];this._watchExpressionsSetting=Common.settings.createLocalSetting('watchExpressions',[]);this._addButton=new UI.ToolbarButton(ls`Add watch expression`,'largeicon-add');this._addButton.addEventListener(UI.ToolbarButton.Events.Click,this._addButtonClicked.bind(this));this._refreshButton=new UI.ToolbarButton(ls`Refresh watch expressions`,'largeicon-refresh');this._refreshButton.addEventListener(UI.ToolbarButton.Events.Click,this.update,this);this.contentElement.classList.add('watch-expressions');this.contentElement.addEventListener('contextmenu',this._contextMenu.bind(this),false);this._treeOutline=new ObjectUI.ObjectPropertiesSectionsTreeOutline();this._treeOutline.registerRequiredCSS('sources/watchExpressionsSidebarPane.css');this._treeOutline.setShowSelectionOnKeyboardFocus(true);this._expandController=new ObjectUI.ObjectPropertiesSectionsTreeExpandController(this._treeOutline);UI.context.addFlavorChangeListener(SDK.ExecutionContext,this.update,this);UI.context.addFlavorChangeListener(SDK.DebuggerModel.CallFrame,this.update,this);this._linkifier=new Components.Linkifier();this.update();}
toolbarItems(){return[this._addButton,this._refreshButton];}
focus(){if(this.hasFocus())
return;if(this._watchExpressions.length>0)
this._treeOutline.forceSelect();else
this._emptyElement.focus();}
hasExpressions(){return!!this._watchExpressionsSetting.get().length;}
_saveExpressions(){const toSave=[];for(let i=0;i<this._watchExpressions.length;i++){if(this._watchExpressions[i].expression())
toSave.push(this._watchExpressions[i].expression());}
this._watchExpressionsSetting.set(toSave);}
async _addButtonClicked(){await UI.viewManager.showView('sources.watch');this._createWatchExpression(null).startEditing();}
doUpdate(){this._linkifier.reset();this.contentElement.removeChildren();this._treeOutline.removeChildren();this._watchExpressions=[];this._emptyElement=this.contentElement.createChild('div','gray-info-message');this._emptyElement.textContent=Common.UIString('No watch expressions');this._emptyElement.tabIndex=-1;const watchExpressionStrings=this._watchExpressionsSetting.get();for(let i=0;i<watchExpressionStrings.length;++i){const expression=watchExpressionStrings[i];if(!expression)
continue;this._createWatchExpression(expression);}
return Promise.resolve();}
_createWatchExpression(expression){this._emptyElement.classList.add('hidden');this.contentElement.appendChild(this._treeOutline.element);const watchExpression=new Sources.WatchExpression(expression,this._expandController,this._linkifier);watchExpression.addEventListener(Sources.WatchExpression.Events.ExpressionUpdated,this._watchExpressionUpdated,this);this._treeOutline.appendChild(watchExpression.treeElement());this._watchExpressions.push(watchExpression);return watchExpression;}
_watchExpressionUpdated(event){const watchExpression=(event.data);if(!watchExpression.expression()){this._watchExpressions.remove(watchExpression);this._treeOutline.removeChild(watchExpression.treeElement());this._emptyElement.classList.toggle('hidden',!!this._watchExpressions.length);if(this._watchExpressions.length===0)
this._treeOutline.element.remove();}
this._saveExpressions();}
_contextMenu(event){const contextMenu=new UI.ContextMenu(event);this._populateContextMenu(contextMenu,event);contextMenu.show();}
_populateContextMenu(contextMenu,event){let isEditing=false;for(const watchExpression of this._watchExpressions)
isEditing|=watchExpression.isEditing();if(!isEditing)
contextMenu.debugSection().appendItem(Common.UIString('Add watch expression'),this._addButtonClicked.bind(this));if(this._watchExpressions.length>1){contextMenu.debugSection().appendItem(Common.UIString('Delete all watch expressions'),this._deleteAllButtonClicked.bind(this));}
const treeElement=this._treeOutline.treeElementFromEvent(event);if(!treeElement)
return;for(const watchExpression of this._watchExpressions){if(treeElement.hasAncestorOrSelf(watchExpression.treeElement())){watchExpression._populateContextMenu(contextMenu,event);break;}}}
_deleteAllButtonClicked(){this._watchExpressions=[];this._saveExpressions();this.update();}
_focusAndAddExpressionToWatch(expression){UI.viewManager.showView('sources.watch');this.doUpdate();this._addExpressionToWatch(expression);}
_addExpressionToWatch(expression){this._createWatchExpression(expression);this._saveExpressions();}
handleAction(context,actionId){const frame=UI.context.flavor(Sources.UISourceCodeFrame);if(!frame)
return false;const text=frame.textEditor.text(frame.textEditor.selection());this._focusAndAddExpressionToWatch(text);return true;}
_addPropertyPathToWatch(target){this._addExpressionToWatch(target.path());}
appendApplicableItems(event,contextMenu,target){if(target instanceof ObjectUI.ObjectPropertyTreeElement&&!target.property.synthetic){contextMenu.debugSection().appendItem(ls`Add property path to watch`,this._addPropertyPathToWatch.bind(this,target));}
const frame=UI.context.flavor(Sources.UISourceCodeFrame);if(!frame||frame.textEditor.selection().isEmpty())
return;contextMenu.debugSection().appendAction('sources.add-to-watch');}};Sources.WatchExpression=class extends Common.Object{constructor(expression,expandController,linkifier){super();this._expression=expression;this._expandController=expandController;this._element=createElementWithClass('div','watch-expression monospace');this._editing=false;this._linkifier=linkifier;this._createWatchExpression();this.update();}
treeElement(){return this._treeElement;}
expression(){return this._expression;}
update(){const currentExecutionContext=UI.context.flavor(SDK.ExecutionContext);if(currentExecutionContext&&this._expression){currentExecutionContext.evaluate({expression:this._expression,objectGroup:Sources.WatchExpression._watchObjectGroupId,includeCommandLineAPI:false,silent:true,returnByValue:false,generatePreview:false},false,false).then(result=>this._createWatchExpression(result.object,result.exceptionDetails));}}
startEditing(){this._editing=true;this._element.removeChildren();const newDiv=this._element.createChild('div');newDiv.textContent=this._nameElement.textContent;this._textPrompt=new ObjectUI.ObjectPropertyPrompt();this._textPrompt.renderAsBlock();const proxyElement=this._textPrompt.attachAndStartEditing(newDiv,this._finishEditing.bind(this));this._treeElement.listItemElement.classList.add('watch-expression-editing');proxyElement.classList.add('watch-expression-text-prompt-proxy');proxyElement.addEventListener('keydown',this._promptKeyDown.bind(this),false);this._element.getComponentSelection().selectAllChildren(newDiv);}
isEditing(){return!!this._editing;}
_finishEditing(event,canceled){if(event)
event.consume(canceled);this._editing=false;this._treeElement.listItemElement.classList.remove('watch-expression-editing');this._textPrompt.detach();const newExpression=canceled?this._expression:this._textPrompt.text();delete this._textPrompt;this._element.removeChildren();this._updateExpression(newExpression);}
_dblClickOnWatchExpression(event){event.consume();if(!this.isEditing())
this.startEditing();}
_updateExpression(newExpression){if(this._expression)
this._expandController.stopWatchSectionsWithId(this._expression);this._expression=newExpression;this.update();this.dispatchEventToListeners(Sources.WatchExpression.Events.ExpressionUpdated,this);}
_deleteWatchExpression(event){event.consume(true);this._updateExpression(null);}
_createWatchExpression(result,exceptionDetails){this._result=result||null;this._element.removeChildren();const oldTreeElement=this._treeElement;this._createWatchExpressionTreeElement(result,exceptionDetails);if(oldTreeElement&&oldTreeElement.parent){const root=oldTreeElement.parent;const index=root.indexOfChild(oldTreeElement);root.removeChild(oldTreeElement);root.insertChild(this._treeElement,index);}
this._treeElement.select();}
_createWatchExpressionHeader(expressionValue,exceptionDetails){const headerElement=this._element.createChild('div','watch-expression-header');const deleteButton=UI.Icon.create('smallicon-cross','watch-expression-delete-button');deleteButton.title=ls`Delete watch expression`;deleteButton.addEventListener('click',this._deleteWatchExpression.bind(this),false);headerElement.appendChild(deleteButton);const titleElement=headerElement.createChild('div','watch-expression-title tree-element-title');this._nameElement=ObjectUI.ObjectPropertiesSection.createNameElement(this._expression);if(!!exceptionDetails||!expressionValue){this._valueElement=createElementWithClass('span','watch-expression-error value');titleElement.classList.add('dimmed');this._valueElement.textContent=Common.UIString('<not available>');}else{this._valueElement=ObjectUI.ObjectPropertiesSection.createValueElementWithCustomSupport(expressionValue,!!exceptionDetails,false,titleElement,this._linkifier);}
const separatorElement=createElementWithClass('span','watch-expressions-separator');separatorElement.textContent=': ';titleElement.appendChildren(this._nameElement,separatorElement,this._valueElement);return headerElement;}
_createWatchExpressionTreeElement(expressionValue,exceptionDetails){const headerElement=this._createWatchExpressionHeader(expressionValue,exceptionDetails);if(!exceptionDetails&&expressionValue&&expressionValue.hasChildren&&!expressionValue.customPreview()){headerElement.classList.add('watch-expression-object-header');this._treeElement=new ObjectUI.ObjectPropertiesSection.RootElement(expressionValue,this._linkifier);this._expandController.watchSection((this._expression),this._treeElement);this._treeElement.toggleOnClick=false;this._treeElement.listItemElement.addEventListener('click',this._onSectionClick.bind(this),false);this._treeElement.listItemElement.addEventListener('dblclick',this._dblClickOnWatchExpression.bind(this));}else{headerElement.addEventListener('dblclick',this._dblClickOnWatchExpression.bind(this));this._treeElement=new UI.TreeElement();}
this._treeElement.title=this._element;this._treeElement.listItemElement.classList.add('watch-expression-tree-item');this._treeElement.listItemElement.addEventListener('keydown',event=>{if(isEnterKey(event)&&!this.isEditing()){this.startEditing();event.consume(true);}});}
_onSectionClick(event){event.consume(true);if(event.detail===1){this._preventClickTimeout=setTimeout(handleClick.bind(this),333);}else{clearTimeout(this._preventClickTimeout);delete this._preventClickTimeout;}
function handleClick(){if(!this._treeElement)
return;const objectTreeElement=this._treeElement.objectTreeElement();if(objectTreeElement.expanded)
objectTreeElement.collapse();else
objectTreeElement.expand();}}
_promptKeyDown(event){if(isEnterKey(event)||isEscKey(event))
this._finishEditing(event,isEscKey(event));}
_populateContextMenu(contextMenu,event){if(!this.isEditing()){contextMenu.editSection().appendItem(Common.UIString('Delete watch expression'),this._updateExpression.bind(this,null));}
if(!this.isEditing()&&this._result&&(this._result.type==='number'||this._result.type==='string'))
contextMenu.clipboardSection().appendItem(Common.UIString('Copy value'),this._copyValueButtonClicked.bind(this));const target=event.deepElementFromPoint();if(target&&this._valueElement.isSelfOrAncestor(target))
contextMenu.appendApplicableItems(this._result);}
_copyValueButtonClicked(){InspectorFrontendHost.copyText(this._valueElement.textContent);}};Sources.WatchExpression._watchObjectGroupId='watch-group';Sources.WatchExpression.Events={ExpressionUpdated:Symbol('ExpressionUpdated')};;Sources.ThreadsSidebarPane=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS('sources/threadsSidebarPane.css');this._items=new UI.ListModel();this._list=new UI.ListControl(this._items,this,UI.ListMode.NonViewport);const currentTarget=UI.context.flavor(SDK.Target);this._selectedModel=!!currentTarget?currentTarget.model(SDK.DebuggerModel):null;this.contentElement.appendChild(this._list.element);UI.context.addFlavorChangeListener(SDK.Target,this._targetFlavorChanged,this);SDK.targetManager.observeModels(SDK.DebuggerModel,this);}
static shouldBeShown(){return SDK.targetManager.models(SDK.DebuggerModel).length>=2;}
createElementForItem(debuggerModel){const element=createElementWithClass('div','thread-item');const title=element.createChild('div','thread-item-title');const pausedState=element.createChild('div','thread-item-paused-state');element.appendChild(UI.Icon.create('smallicon-thick-right-arrow','selected-thread-icon'));element.tabIndex=-1;onInvokeElement(element,event=>{UI.context.setFlavor(SDK.Target,debuggerModel.target());event.consume(true);});const isSelected=UI.context.flavor(SDK.Target)===debuggerModel.target();element.classList.toggle('selected',isSelected);UI.ARIAUtils.setSelected(element,isSelected);function updateTitle(){const executionContext=debuggerModel.runtimeModel().defaultExecutionContext();title.textContent=executionContext&&executionContext.label()?executionContext.label():debuggerModel.target().name();}
function updatePausedState(){pausedState.textContent=debuggerModel.isPaused()?ls`paused`:'';}
function targetNameChanged(event){const target=(event.data);if(target===debuggerModel.target())
updateTitle();}
debuggerModel.addEventListener(SDK.DebuggerModel.Events.DebuggerPaused,updatePausedState);debuggerModel.addEventListener(SDK.DebuggerModel.Events.DebuggerResumed,updatePausedState);debuggerModel.runtimeModel().addEventListener(SDK.RuntimeModel.Events.ExecutionContextChanged,updateTitle);SDK.targetManager.addEventListener(SDK.TargetManager.Events.NameChanged,targetNameChanged);updatePausedState();updateTitle();return element;}
heightForItem(debuggerModel){console.assert(false);return 0;}
isItemSelectable(debuggerModel){return true;}
selectedItemChanged(from,to,fromElement,toElement){if(fromElement)
fromElement.tabIndex=-1;if(toElement){this.setDefaultFocusedElement(toElement);toElement.tabIndex=0;if(this.hasFocus())
toElement.focus();}}
updateSelectedItemARIA(fromElement,toElement){return false;}
modelAdded(debuggerModel){this._items.insert(this._items.length,debuggerModel);const currentTarget=UI.context.flavor(SDK.Target);if(currentTarget===debuggerModel.target())
this._list.selectItem(debuggerModel);}
modelRemoved(debuggerModel){this._items.remove(this._items.indexOf(debuggerModel));}
_targetFlavorChanged(event){const hadFocus=this.hasFocus();const target=(event.data);const debuggerModel=target.model(SDK.DebuggerModel);if(debuggerModel)
this._list.refreshItem(debuggerModel);if(!!this._selectedModel)
this._list.refreshItem(this._selectedModel);this._selectedModel=debuggerModel;if(hadFocus)
this.focus();}};;Sources.ScriptFormatterEditorAction=class{constructor(){this._pathsToFormatOnLoad=new Set();}
_editorSelected(event){const uiSourceCode=(event.data);this._updateButton(uiSourceCode);if(this._isFormatableScript(uiSourceCode)&&this._pathsToFormatOnLoad.has(uiSourceCode.url())&&!Sources.sourceFormatter.hasFormatted(uiSourceCode))
this._showFormatted(uiSourceCode);}
_editorClosed(event){const uiSourceCode=(event.data.uiSourceCode);const wasSelected=(event.data.wasSelected);if(wasSelected)
this._updateButton(null);const original=Sources.sourceFormatter.discardFormattedUISourceCode(uiSourceCode);if(original)
this._pathsToFormatOnLoad.delete(original.url());}
_updateButton(uiSourceCode){this._button.element.classList.toggle('hidden',!this._isFormatableScript(uiSourceCode));}
button(sourcesView){if(this._button)
return this._button;this._sourcesView=sourcesView;this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorSelected,this._editorSelected.bind(this));this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorClosed,this._editorClosed.bind(this));this._button=new UI.ToolbarButton(Common.UIString('Pretty print'),'largeicon-pretty-print');this._button.addEventListener(UI.ToolbarButton.Events.Click,this._toggleFormatScriptSource,this);this._updateButton(sourcesView.currentUISourceCode());return this._button;}
_isFormatableScript(uiSourceCode){if(!uiSourceCode)
return false;if(uiSourceCode.project().canSetFileContent())
return false;if(uiSourceCode.project().type()===Workspace.projectTypes.Formatter)
return false;if(Persistence.persistence.binding(uiSourceCode))
return false;return uiSourceCode.contentType().hasScripts();}
_toggleFormatScriptSource(event){const uiSourceCode=this._sourcesView.currentUISourceCode();if(!this._isFormatableScript(uiSourceCode))
return;this._pathsToFormatOnLoad.add(uiSourceCode.url());this._showFormatted(uiSourceCode);}
async _showFormatted(uiSourceCode){const formatData=await Sources.sourceFormatter.format(uiSourceCode);if(uiSourceCode!==this._sourcesView.currentUISourceCode())
return;const sourceFrame=this._sourcesView.viewForFile(uiSourceCode);let start=[0,0];if(sourceFrame){const selection=sourceFrame.selection();start=formatData.mapping.originalToFormatted(selection.startLine,selection.startColumn);}
this._sourcesView.showSourceLocation(formatData.formattedSourceCode,start[0],start[1]);}};;Sources.InplaceFormatterEditorAction=class{_editorSelected(event){const uiSourceCode=(event.data);this._updateButton(uiSourceCode);}
_editorClosed(event){const wasSelected=(event.data.wasSelected);if(wasSelected)
this._updateButton(null);}
_updateButton(uiSourceCode){this._button.element.classList.toggle('hidden',!this._isFormattable(uiSourceCode));}
button(sourcesView){if(this._button)
return this._button;this._sourcesView=sourcesView;this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorSelected,this._editorSelected.bind(this));this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorClosed,this._editorClosed.bind(this));this._button=new UI.ToolbarButton(Common.UIString('Format'),'largeicon-pretty-print');this._button.addEventListener(UI.ToolbarButton.Events.Click,this._formatSourceInPlace,this);this._updateButton(sourcesView.currentUISourceCode());return this._button;}
_isFormattable(uiSourceCode){if(!uiSourceCode)
return false;if(uiSourceCode.project().canSetFileContent())
return true;if(Persistence.persistence.binding(uiSourceCode))
return true;return uiSourceCode.contentType().isStyleSheet();}
_formatSourceInPlace(event){const uiSourceCode=this._sourcesView.currentUISourceCode();if(!this._isFormattable(uiSourceCode))
return;if(uiSourceCode.isDirty())
contentLoaded.call(this,uiSourceCode.workingCopy());else
uiSourceCode.requestContent().then(contentLoaded.bind(this));function contentLoaded(content){const highlighterType=uiSourceCode.mimeType();Formatter.Formatter.format(uiSourceCode.contentType(),highlighterType,content||'',innerCallback.bind(this));}
function innerCallback(formattedContent,formatterMapping){if(uiSourceCode.workingCopy()===formattedContent)
return;const sourceFrame=this._sourcesView.viewForFile(uiSourceCode);let start=[0,0];if(sourceFrame){const selection=sourceFrame.selection();start=formatterMapping.originalToFormatted(selection.startLine,selection.startColumn);}
uiSourceCode.setWorkingCopy(formattedContent);this._sourcesView.showSourceLocation(uiSourceCode,start[0],start[1]);}}};;Sources.SourceFormatData=class{constructor(originalSourceCode,formattedSourceCode,mapping){this.originalSourceCode=originalSourceCode;this.formattedSourceCode=formattedSourceCode;this.mapping=mapping;}
originalPath(){return this.originalSourceCode.project().id()+':'+this.originalSourceCode.url();}
static _for(object){return object[Sources.SourceFormatData._formatDataSymbol];}};Sources.SourceFormatData._formatDataSymbol=Symbol('formatData');Sources.SourceFormatter=class{constructor(){this._projectId='formatter:';this._project=new Bindings.ContentProviderBasedProject(Workspace.workspace,this._projectId,Workspace.projectTypes.Formatter,'formatter',true);this._formattedSourceCodes=new Map();this._scriptMapping=new Sources.SourceFormatter.ScriptMapping();this._styleMapping=new Sources.SourceFormatter.StyleMapping();Workspace.workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeRemoved,this._onUISourceCodeRemoved,this);}
_onUISourceCodeRemoved(event){const uiSourceCode=(event.data);const cacheEntry=this._formattedSourceCodes.get(uiSourceCode);if(cacheEntry&&cacheEntry.formatData)
this._discardFormatData(cacheEntry.formatData);this._formattedSourceCodes.remove(uiSourceCode);}
discardFormattedUISourceCode(formattedUISourceCode){const formatData=Sources.SourceFormatData._for(formattedUISourceCode);if(!formatData)
return null;this._discardFormatData(formatData);this._formattedSourceCodes.remove(formatData.originalSourceCode);return formatData.originalSourceCode;}
_discardFormatData(formatData){delete formatData.formattedSourceCode[Sources.SourceFormatData._formatDataSymbol];this._scriptMapping._setSourceMappingEnabled(formatData,false);this._styleMapping._setSourceMappingEnabled(formatData,false);this._project.removeFile(formatData.formattedSourceCode.url());}
hasFormatted(uiSourceCode){return this._formattedSourceCodes.has(uiSourceCode);}
async format(uiSourceCode){const cacheEntry=this._formattedSourceCodes.get(uiSourceCode);if(cacheEntry)
return cacheEntry.promise;let fulfillFormatPromise;const resultPromise=new Promise(fulfill=>{fulfillFormatPromise=fulfill;});this._formattedSourceCodes.set(uiSourceCode,{promise:resultPromise,formatData:null});const content=await uiSourceCode.requestContent();Formatter.Formatter.format(uiSourceCode.contentType(),uiSourceCode.mimeType(),content||'',formatDone.bind(this));return resultPromise;function formatDone(formattedContent,formatterMapping){const cacheEntry=this._formattedSourceCodes.get(uiSourceCode);if(!cacheEntry||cacheEntry.promise!==resultPromise)
return;let formattedURL;let count=0;let suffix='';do{formattedURL=`${uiSourceCode.url()}:formatted${suffix}`;suffix=`:${count++}`;}while(this._project.uiSourceCodeForURL(formattedURL));const contentProvider=Common.StaticContentProvider.fromString(formattedURL,uiSourceCode.contentType(),formattedContent);const formattedUISourceCode=this._project.addContentProvider(formattedURL,contentProvider,uiSourceCode.mimeType());const formatData=new Sources.SourceFormatData(uiSourceCode,formattedUISourceCode,formatterMapping);formattedUISourceCode[Sources.SourceFormatData._formatDataSymbol]=formatData;this._scriptMapping._setSourceMappingEnabled(formatData,true);this._styleMapping._setSourceMappingEnabled(formatData,true);cacheEntry.formatData=formatData;for(const decoration of uiSourceCode.allDecorations()){const range=decoration.range();const startLocation=formatterMapping.originalToFormatted(range.startLine,range.startColumn);const endLocation=formatterMapping.originalToFormatted(range.endLine,range.endColumn);formattedUISourceCode.addDecoration(new TextUtils.TextRange(startLocation[0],startLocation[1],endLocation[0],endLocation[1]),(decoration.type()),decoration.data());}
fulfillFormatPromise(formatData);}}};Sources.SourceFormatter.ScriptMapping=class{constructor(){Bindings.debuggerWorkspaceBinding.addSourceMapping(this);}
rawLocationToUILocation(rawLocation){const script=rawLocation.script();const formatData=script&&Sources.SourceFormatData._for(script);if(!formatData)
return null;const lineNumber=rawLocation.lineNumber;const columnNumber=rawLocation.columnNumber||0;const formattedLocation=formatData.mapping.originalToFormatted(lineNumber,columnNumber);return formatData.formattedSourceCode.uiLocation(formattedLocation[0],formattedLocation[1]);}
uiLocationToRawLocations(uiSourceCode,lineNumber,columnNumber){const formatData=Sources.SourceFormatData._for(uiSourceCode);if(!formatData)
return[];const originalLocation=formatData.mapping.formattedToOriginal(lineNumber,columnNumber);const scripts=this._scriptsForUISourceCode(formatData.originalSourceCode);if(!scripts.length)
return[];return scripts.map(script=>script.debuggerModel.createRawLocation(script,originalLocation[0],originalLocation[1]));}
_setSourceMappingEnabled(formatData,enabled){const scripts=this._scriptsForUISourceCode(formatData.originalSourceCode);if(!scripts.length)
return;if(enabled){for(const script of scripts)
script[Sources.SourceFormatData._formatDataSymbol]=formatData;}else{for(const script of scripts)
delete script[Sources.SourceFormatData._formatDataSymbol];}
for(const script of scripts)
Bindings.debuggerWorkspaceBinding.updateLocations(script);}
_scriptsForUISourceCode(uiSourceCode){if(uiSourceCode.contentType()===Common.resourceTypes.Document){const target=Bindings.NetworkProject.targetForUISourceCode(uiSourceCode);const debuggerModel=target&&target.model(SDK.DebuggerModel);if(debuggerModel){const scripts=debuggerModel.scriptsForSourceURL(uiSourceCode.url()).filter(script=>script.isInlineScript()&&!script.hasSourceURL);return scripts;}}
if(uiSourceCode.contentType().isScript()){const rawLocations=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(uiSourceCode,0,0);return rawLocations.map(location=>location.script());}
return[];}};Sources.SourceFormatter.StyleMapping=class{constructor(){Bindings.cssWorkspaceBinding.addSourceMapping(this);this._headersSymbol=Symbol('Sources.SourceFormatter.StyleMapping._headersSymbol');}
rawLocationToUILocation(rawLocation){const styleHeader=rawLocation.header();const formatData=styleHeader&&Sources.SourceFormatData._for(styleHeader);if(!formatData)
return null;const formattedLocation=formatData.mapping.originalToFormatted(rawLocation.lineNumber,rawLocation.columnNumber||0);return formatData.formattedSourceCode.uiLocation(formattedLocation[0],formattedLocation[1]);}
uiLocationToRawLocations(uiLocation){const formatData=Sources.SourceFormatData._for(uiLocation.uiSourceCode);if(!formatData)
return[];const originalLocation=formatData.mapping.formattedToOriginal(uiLocation.lineNumber,uiLocation.columnNumber);const headers=formatData.originalSourceCode[this._headersSymbol];return headers.map(header=>new SDK.CSSLocation(header,originalLocation[0],originalLocation[1]));}
_setSourceMappingEnabled(formatData,enable){const original=formatData.originalSourceCode;const rawLocations=Bindings.cssWorkspaceBinding.uiLocationToRawLocations(original.uiLocation(0,0));const headers=rawLocations.map(rawLocation=>rawLocation.header()).filter(header=>!!header);if(!headers.length)
return;if(enable){original[this._headersSymbol]=headers;headers.forEach(header=>header[Sources.SourceFormatData._formatDataSymbol]=formatData);}else{original[this._headersSymbol]=null;headers.forEach(header=>delete header[Sources.SourceFormatData._formatDataSymbol]);}
headers.forEach(header=>Bindings.cssWorkspaceBinding.updateLocations(header));}};Sources.sourceFormatter=new Sources.SourceFormatter();;Sources.OpenFileQuickOpen=class extends Sources.FilteredUISourceCodeListProvider{attach(){this.setDefaultScores(Sources.SourcesView.defaultUISourceCodeScores());super.attach();}
uiSourceCodeSelected(uiSourceCode,lineNumber,columnNumber){Host.userMetrics.actionTaken(Host.UserMetrics.Action.SelectFileFromFilePicker);if(!uiSourceCode)
return;if(typeof lineNumber==='number')
Common.Revealer.reveal(uiSourceCode.uiLocation(lineNumber,columnNumber));else
Common.Revealer.reveal(uiSourceCode);}
filterProject(project){return!project.isServiceProject();}
renderAsTwoRows(){return true;}};;Sources.SourcesView=class extends UI.VBox{constructor(){super();this.registerRequiredCSS('sources/sourcesView.css');this.element.id='sources-panel-sources-view';this.setMinimumAndPreferredSizes(88,52,150,100);const workspace=Workspace.workspace;this._searchableView=new UI.SearchableView(this,'sourcesViewSearchConfig');this._searchableView.setMinimalSearchQuerySize(0);this._searchableView.show(this.element);this._sourceViewByUISourceCode=new Map();this._editorContainer=new Sources.TabbedEditorContainer(this,Common.settings.createLocalSetting('previouslyViewedFiles',[]),this._placeholderElement(),this._focusedPlaceholderElement);this._editorContainer.show(this._searchableView.element);this._editorContainer.addEventListener(Sources.TabbedEditorContainer.Events.EditorSelected,this._editorSelected,this);this._editorContainer.addEventListener(Sources.TabbedEditorContainer.Events.EditorClosed,this._editorClosed,this);this._historyManager=new Sources.EditingLocationHistoryManager(this,this.currentSourceFrame.bind(this));this._toolbarContainerElement=this.element.createChild('div','sources-toolbar');if(!Runtime.experiments.isEnabled('sourcesPrettyPrint')){this._toolbarEditorActions=new UI.Toolbar('',this._toolbarContainerElement);self.runtime.allInstances(Sources.SourcesView.EditorAction).then(appendButtonsForExtensions.bind(this));}
function appendButtonsForExtensions(actions){for(let i=0;i<actions.length;++i)
this._toolbarEditorActions.appendToolbarItem(actions[i].button(this));}
this._scriptViewToolbar=new UI.Toolbar('',this._toolbarContainerElement);this._scriptViewToolbar.element.style.flex='auto';this._bottomToolbar=new UI.Toolbar('',this._toolbarContainerElement);this._toolbarChangedListener=null;UI.startBatchUpdate();workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this));UI.endBatchUpdate();workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeRemoved,this._uiSourceCodeRemoved,this);workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved,this._projectRemoved.bind(this),this);function handleBeforeUnload(event){if(event.returnValue)
return;let unsavedSourceCodes=[];const projects=Workspace.workspace.projectsForType(Workspace.projectTypes.FileSystem);for(let i=0;i<projects.length;++i){unsavedSourceCodes=unsavedSourceCodes.concat(projects[i].uiSourceCodes().filter(sourceCode=>sourceCode.isDirty()));}
if(!unsavedSourceCodes.length)
return;event.returnValue=Common.UIString('DevTools have unsaved changes that will be permanently lost.');UI.viewManager.showView('sources');for(let i=0;i<unsavedSourceCodes.length;++i)
Common.Revealer.reveal(unsavedSourceCodes[i]);}
if(!window.opener)
window.addEventListener('beforeunload',handleBeforeUnload,true);this._shortcuts={};this.element.addEventListener('keydown',this._handleKeyDown.bind(this),false);}
_placeholderElement(){this._placeholderOptionArray=[];const shortcuts=[{actionId:'quickOpen.show',description:ls`Open file`},{actionId:'commandMenu.show',description:ls`Run command`},{actionId:'sources.add-folder-to-workspace',description:ls`Drop in a folder to add to workspace`}];const element=createElementWithClass('div');const list=element.createChild('div','tabbed-pane-placeholder');list.addEventListener('keydown',this._placeholderOnKeyDown.bind(this),false);UI.ARIAUtils.markAsList(list);UI.ARIAUtils.setAccessibleName(list,ls`Empty Source View Actions`);for(let i=0;i<shortcuts.length;i++){const shortcut=shortcuts[i];const shortcutKeyText=UI.shortcutRegistry.shortcutTitleForAction(shortcut.actionId);const listItemElement=list.createChild('div');UI.ARIAUtils.markAsListitem(listItemElement);const row=listItemElement.createChild('div','tabbed-pane-placeholder-row');row.tabIndex=-1;UI.ARIAUtils.markAsButton(row);if(shortcutKeyText){row.createChild('div','tabbed-pane-placeholder-key').textContent=shortcutKeyText;row.createChild('div','tabbed-pane-placeholder-value').textContent=shortcut.description;}else{row.createChild('div','tabbed-pane-no-shortcut').textContent=shortcut.description;}
const action=UI.actionRegistry.action(shortcut.actionId);const actionHandler=action.execute.bind(action);this._placeholderOptionArray.push({element:row,handler:actionHandler});}
const firstElement=this._placeholderOptionArray[0].element;firstElement.tabIndex=0;this._focusedPlaceholderElement=firstElement;this._selectedIndex=0;element.appendChild(UI.DisabledXLink.create('https://aka.ms/docs-landing-page',Common.UIString('Learn more'),true));return element;}
_placeholderOnKeyDown(event){if(isEnterOrSpaceKey(event)){this._placeholderOptionArray[this._selectedIndex].handler.call();return;}
let offset=0;if(event.key==='ArrowDown')
offset=1;else if(event.key==='ArrowUp')
offset=-1;const newIndex=Math.max(Math.min(this._placeholderOptionArray.length-1,this._selectedIndex+offset),0);const newElement=this._placeholderOptionArray[newIndex].element;const oldElement=this._placeholderOptionArray[this._selectedIndex].element;if(newElement!==oldElement){oldElement.tabIndex=-1;newElement.tabIndex=0;UI.ARIAUtils.setSelected(oldElement,false);UI.ARIAUtils.setSelected(newElement,true);this._selectedIndex=newIndex;newElement.focus();}}
_resetPlaceholderState(){this._placeholderOptionArray[this._selectedIndex].element.tabIndex=-1;this._placeholderOptionArray[0].element.tabIndex=0;this._selectedIndex=0;}
static defaultUISourceCodeScores(){const defaultScores=new Map();const sourcesView=UI.context.flavor(Sources.SourcesView);if(sourcesView){const uiSourceCodes=sourcesView._editorContainer.historyUISourceCodes();for(let i=1;i<uiSourceCodes.length;++i)
defaultScores.set(uiSourceCodes[i],uiSourceCodes.length-i);}
return defaultScores;}
leftToolbar(){return this._editorContainer.leftToolbar();}
rightToolbar(){return this._editorContainer.rightToolbar();}
bottomToolbar(){return this._bottomToolbar;}
_registerShortcuts(keys,handler){for(let i=0;i<keys.length;++i)
this._shortcuts[keys[i].key]=handler;}
_handleKeyDown(event){const shortcutKey=UI.KeyboardShortcut.makeKeyFromEvent(event);const handler=this._shortcuts[shortcutKey];if(handler&&handler())
event.consume(true);}
wasShown(){super.wasShown();UI.context.setFlavor(Sources.SourcesView,this);}
willHide(){UI.context.setFlavor(Sources.SourcesView,null);this._resetPlaceholderState();super.willHide();}
toolbarContainerElement(){return this._toolbarContainerElement;}
searchableView(){return this._searchableView;}
visibleView(){return this._editorContainer.visibleView;}
currentSourceFrame(){const view=this.visibleView();if(!(view instanceof Sources.UISourceCodeFrame))
return null;return(view);}
currentUISourceCode(){return this._editorContainer.currentFile();}
_onCloseEditorTab(){const uiSourceCode=this._editorContainer.currentFile();if(!uiSourceCode)
return false;this._editorContainer.closeFile(uiSourceCode);return true;}
_onJumpToPreviousLocation(){this._historyManager.rollback();}
_onJumpToNextLocation(){this._historyManager.rollover();}
_uiSourceCodeAdded(event){const uiSourceCode=(event.data);this._addUISourceCode(uiSourceCode);}
_addUISourceCode(uiSourceCode){if(uiSourceCode.project().isServiceProject())
return;if(uiSourceCode.project().type()===Workspace.projectTypes.FileSystem&&Persistence.FileSystemWorkspaceBinding.fileSystemType(uiSourceCode.project())==='overrides')
return;this._editorContainer.addUISourceCode(uiSourceCode);}
_uiSourceCodeRemoved(event){const uiSourceCode=(event.data);this._removeUISourceCodes([uiSourceCode]);}
_removeUISourceCodes(uiSourceCodes){this._editorContainer.removeUISourceCodes(uiSourceCodes);for(let i=0;i<uiSourceCodes.length;++i){this._removeSourceFrame(uiSourceCodes[i]);this._historyManager.removeHistoryForSourceCode(uiSourceCodes[i]);}}
_projectRemoved(event){const project=event.data;const uiSourceCodes=project.uiSourceCodes();this._removeUISourceCodes(uiSourceCodes);}
_updateScriptViewToolbarItems(){this._scriptViewToolbar.removeToolbarItems();const view=this.visibleView();if(view instanceof UI.SimpleView){for(const item of((view)).syncToolbarItems())
this._scriptViewToolbar.appendToolbarItem(item);}}
showSourceLocation(uiSourceCode,lineNumber,columnNumber,omitFocus,omitHighlight){this._historyManager.updateCurrentState();this._editorContainer.showFile(uiSourceCode);const currentSourceFrame=this.currentSourceFrame();if(currentSourceFrame&&typeof lineNumber==='number')
currentSourceFrame.revealPosition(lineNumber,columnNumber,!omitHighlight);this._historyManager.pushNewState();if(!omitFocus)
this.visibleView().focus();}
_createSourceView(uiSourceCode){let sourceFrame;let sourceView;const contentType=uiSourceCode.contentType();if(contentType===Common.resourceTypes.Image)
sourceView=new SourceFrame.ImageView(uiSourceCode.mimeType(),uiSourceCode);else if(contentType===Common.resourceTypes.Font)
sourceView=new SourceFrame.FontView(uiSourceCode.mimeType(),uiSourceCode);else
sourceFrame=new Sources.UISourceCodeFrame(uiSourceCode);if(sourceFrame)
this._historyManager.trackSourceFrameCursorJumps(sourceFrame);const widget=(sourceFrame||sourceView);this._sourceViewByUISourceCode.set(uiSourceCode,widget);return widget;}
_getOrCreateSourceView(uiSourceCode){return this._sourceViewByUISourceCode.get(uiSourceCode)||this._createSourceView(uiSourceCode);}
recycleUISourceCodeFrame(sourceFrame,uiSourceCode){this._sourceViewByUISourceCode.delete(sourceFrame.uiSourceCode());sourceFrame.setUISourceCode(uiSourceCode);this._sourceViewByUISourceCode.set(uiSourceCode,sourceFrame);}
viewForFile(uiSourceCode){return this._getOrCreateSourceView(uiSourceCode);}
_removeSourceFrame(uiSourceCode){const sourceView=this._sourceViewByUISourceCode.get(uiSourceCode);this._sourceViewByUISourceCode.remove(uiSourceCode);if(sourceView&&sourceView instanceof Sources.UISourceCodeFrame)
(sourceView).dispose();}
_editorClosed(event){const uiSourceCode=(event.data);this._historyManager.removeHistoryForSourceCode(uiSourceCode);let wasSelected=false;if(!this._editorContainer.currentFile())
wasSelected=true;this._removeToolbarChangedListener();this._updateScriptViewToolbarItems();this._searchableView.resetSearch();const data={};data.uiSourceCode=uiSourceCode;data.wasSelected=wasSelected;this.dispatchEventToListeners(Sources.SourcesView.Events.EditorClosed,data);}
_editorSelected(event){const previousSourceFrame=event.data.previousView instanceof Sources.UISourceCodeFrame?event.data.previousView:null;if(previousSourceFrame)
previousSourceFrame.setSearchableView(null);const currentSourceFrame=event.data.currentView instanceof Sources.UISourceCodeFrame?event.data.currentView:null;if(currentSourceFrame)
currentSourceFrame.setSearchableView(this._searchableView);this._searchableView.setReplaceable(!!currentSourceFrame&&currentSourceFrame.canEditSource());this._searchableView.refreshSearch();this._updateToolbarChangedListener();this._updateScriptViewToolbarItems();this.dispatchEventToListeners(Sources.SourcesView.Events.EditorSelected,this._editorContainer.currentFile());}
_removeToolbarChangedListener(){if(this._toolbarChangedListener)
Common.EventTarget.removeEventListeners([this._toolbarChangedListener]);this._toolbarChangedListener=null;}
_updateToolbarChangedListener(){this._removeToolbarChangedListener();const sourceFrame=this.currentSourceFrame();if(!sourceFrame)
return;this._toolbarChangedListener=sourceFrame.addEventListener(Sources.UISourceCodeFrame.Events.ToolbarItemsChanged,this._updateScriptViewToolbarItems,this);}
searchCanceled(){if(this._searchView)
this._searchView.searchCanceled();delete this._searchView;delete this._searchConfig;}
performSearch(searchConfig,shouldJump,jumpBackwards){const sourceFrame=this.currentSourceFrame();if(!sourceFrame)
return;this._searchView=sourceFrame;this._searchConfig=searchConfig;this._searchView.performSearch(this._searchConfig,shouldJump,jumpBackwards);}
jumpToNextSearchResult(){if(!this._searchView)
return;if(this._searchView!==this.currentSourceFrame()){this.performSearch(this._searchConfig,true);return;}
this._searchView.jumpToNextSearchResult();}
jumpToPreviousSearchResult(){if(!this._searchView)
return;if(this._searchView!==this.currentSourceFrame()){this.performSearch(this._searchConfig,true);if(this._searchView)
this._searchView.jumpToLastSearchResult();return;}
this._searchView.jumpToPreviousSearchResult();}
supportsCaseSensitiveSearch(){return true;}
supportsRegexSearch(){return true;}
replaceSelectionWith(searchConfig,replacement){const sourceFrame=this.currentSourceFrame();if(!sourceFrame){console.assert(sourceFrame);return;}
sourceFrame.replaceSelectionWith(searchConfig,replacement);}
replaceAllWith(searchConfig,replacement){const sourceFrame=this.currentSourceFrame();if(!sourceFrame){console.assert(sourceFrame);return;}
sourceFrame.replaceAllWith(searchConfig,replacement);}
_showOutlineQuickOpen(){QuickOpen.QuickOpen.show('@');}
_showGoToLineQuickOpen(){if(this._editorContainer.currentFile())
QuickOpen.QuickOpen.show(':');}
_save(){this._saveSourceFrame(this.currentSourceFrame());}
_saveAll(){const sourceFrames=this._editorContainer.fileViews();sourceFrames.forEach(this._saveSourceFrame.bind(this));}
_saveSourceFrame(sourceFrame){if(!(sourceFrame instanceof Sources.UISourceCodeFrame))
return;const uiSourceCodeFrame=(sourceFrame);uiSourceCodeFrame.commitEditing();}
toggleBreakpointsActiveState(active){this._editorContainer.view.element.classList.toggle('breakpoints-deactivated',!active);}};Sources.SourcesView.Events={EditorClosed:Symbol('EditorClosed'),EditorSelected:Symbol('EditorSelected'),};Sources.SourcesView.EditorAction=function(){};Sources.SourcesView.EditorAction.prototype={button(sourcesView){}};Sources.SourcesView.SwitchFileActionDelegate=class{static _nextFile(currentUISourceCode){function fileNamePrefix(name){const lastDotIndex=name.lastIndexOf('.');const namePrefix=name.substr(0,lastDotIndex!==-1?lastDotIndex:name.length);return namePrefix.toLowerCase();}
const uiSourceCodes=currentUISourceCode.project().uiSourceCodes();const candidates=[];const url=currentUISourceCode.parentURL();const name=currentUISourceCode.name();const namePrefix=fileNamePrefix(name);for(let i=0;i<uiSourceCodes.length;++i){const uiSourceCode=uiSourceCodes[i];if(url!==uiSourceCode.parentURL())
continue;if(fileNamePrefix(uiSourceCode.name())===namePrefix)
candidates.push(uiSourceCode.name());}
candidates.sort(String.naturalOrderComparator);const index=mod(candidates.indexOf(name)+1,candidates.length);const fullURL=(url?url+'/':'')+candidates[index];const nextUISourceCode=currentUISourceCode.project().uiSourceCodeForURL(fullURL);return nextUISourceCode!==currentUISourceCode?nextUISourceCode:null;}
handleAction(context,actionId){const sourcesView=UI.context.flavor(Sources.SourcesView);const currentUISourceCode=sourcesView.currentUISourceCode();if(!currentUISourceCode)
return false;const nextUISourceCode=Sources.SourcesView.SwitchFileActionDelegate._nextFile(currentUISourceCode);if(!nextUISourceCode)
return false;sourcesView.showSourceLocation(nextUISourceCode);return true;}};Sources.SourcesView.ActionDelegate=class{handleAction(context,actionId){const sourcesView=UI.context.flavor(Sources.SourcesView);if(!sourcesView)
return false;switch(actionId){case'sources.close-all':sourcesView._editorContainer.closeAllFiles();return true;case'sources.jump-to-previous-location':sourcesView._onJumpToPreviousLocation();return true;case'sources.jump-to-next-location':sourcesView._onJumpToNextLocation();return true;case'sources.close-editor-tab':return sourcesView._onCloseEditorTab();case'sources.go-to-line':sourcesView._showGoToLineQuickOpen();return true;case'sources.go-to-member':sourcesView._showOutlineQuickOpen();return true;case'sources.save':sourcesView._save();return true;case'sources.save-all':sourcesView._saveAll();return true;}
return false;}};;Sources.SourcesSearchScope=class{constructor(){this._searchId=0;this._searchResultCandidates=[];this._searchResultCallback=null;this._searchFinishedCallback=null;this._searchConfig=null;}
static _filesComparator(uiSourceCode1,uiSourceCode2){if(uiSourceCode1.isDirty()&&!uiSourceCode2.isDirty())
return-1;if(!uiSourceCode1.isDirty()&&uiSourceCode2.isDirty())
return 1;const isFileSystem1=uiSourceCode1.project().type()===Workspace.projectTypes.FileSystem&&!Persistence.persistence.binding(uiSourceCode1);const isFileSystem2=uiSourceCode2.project().type()===Workspace.projectTypes.FileSystem&&!Persistence.persistence.binding(uiSourceCode2);if(isFileSystem1!==isFileSystem2)
return isFileSystem1?1:-1;const url1=uiSourceCode1.url();const url2=uiSourceCode2.url();if(url1&&!url2)
return-1;if(!url1&&url2)
return 1;return String.naturalOrderComparator(uiSourceCode1.fullDisplayName(),uiSourceCode2.fullDisplayName());}
performIndexing(progress){this.stopSearch();const projects=this._projects();const compositeProgress=new Common.CompositeProgress(progress);for(let i=0;i<projects.length;++i){const project=projects[i];const projectProgress=compositeProgress.createSubProgress(project.uiSourceCodes().length);project.indexContent(projectProgress);}}
_projects(){const searchInAnonymousAndContentScripts=Common.moduleSetting('searchInAnonymousAndContentScripts').get();return Workspace.workspace.projects().filter(project=>{if(project.type()===Workspace.projectTypes.Service)
return false;if(!searchInAnonymousAndContentScripts&&project.isServiceProject())
return false;if(!searchInAnonymousAndContentScripts&&project.type()===Workspace.projectTypes.ContentScripts)
return false;return true;});}
performSearch(searchConfig,progress,searchResultCallback,searchFinishedCallback){this.stopSearch();this._searchResultCandidates=[];this._searchResultCallback=searchResultCallback;this._searchFinishedCallback=searchFinishedCallback;this._searchConfig=searchConfig;const promises=[];const compositeProgress=new Common.CompositeProgress(progress);const searchContentProgress=compositeProgress.createSubProgress();const findMatchingFilesProgress=new Common.CompositeProgress(compositeProgress.createSubProgress());for(const project of this._projects()){const weight=project.uiSourceCodes().length;const findMatchingFilesInProjectProgress=findMatchingFilesProgress.createSubProgress(weight);const filesMathingFileQuery=this._projectFilesMatchingFileQuery(project,searchConfig);const promise=project.findFilesMatchingSearchRequest(searchConfig,filesMathingFileQuery,findMatchingFilesInProjectProgress).then(this._processMatchingFilesForProject.bind(this,this._searchId,project,searchConfig,filesMathingFileQuery));promises.push(promise);}
Promise.all(promises).then(this._processMatchingFiles.bind(this,this._searchId,searchContentProgress,this._searchFinishedCallback.bind(this,true)));}
_projectFilesMatchingFileQuery(project,searchConfig,dirtyOnly){const result=[];const uiSourceCodes=project.uiSourceCodes();for(let i=0;i<uiSourceCodes.length;++i){const uiSourceCode=uiSourceCodes[i];if(!uiSourceCode.contentType().isTextType())
continue;const binding=Persistence.persistence.binding(uiSourceCode);if(binding&&binding.network===uiSourceCode)
continue;if(dirtyOnly&&!uiSourceCode.isDirty())
continue;if(searchConfig.filePathMatchesFileQuery(uiSourceCode.fullDisplayName()))
result.push(uiSourceCode.url());}
result.sort(String.naturalOrderComparator);return result;}
_processMatchingFilesForProject(searchId,project,searchConfig,filesMathingFileQuery,files){if(searchId!==this._searchId){this._searchFinishedCallback(false);return;}
files.sort(String.naturalOrderComparator);files=files.intersectOrdered(filesMathingFileQuery,String.naturalOrderComparator);const dirtyFiles=this._projectFilesMatchingFileQuery(project,searchConfig,true);files=files.mergeOrdered(dirtyFiles,String.naturalOrderComparator);const uiSourceCodes=[];for(const file of files){const uiSourceCode=project.uiSourceCodeForURL(file);if(!uiSourceCode)
continue;const script=Bindings.DefaultScriptMapping.scriptForUISourceCode(uiSourceCode);if(script&&!script.isAnonymousScript())
continue;uiSourceCodes.push(uiSourceCode);}
uiSourceCodes.sort(Sources.SourcesSearchScope._filesComparator);this._searchResultCandidates=this._searchResultCandidates.mergeOrdered(uiSourceCodes,Sources.SourcesSearchScope._filesComparator);}
_processMatchingFiles(searchId,progress,callback){if(searchId!==this._searchId){this._searchFinishedCallback(false);return;}
const files=this._searchResultCandidates;if(!files.length){progress.done();callback();return;}
progress.setTotalWork(files.length);let fileIndex=0;const maxFileContentRequests=20;let callbacksLeft=0;for(let i=0;i<maxFileContentRequests&&i<files.length;++i)
scheduleSearchInNextFileOrFinish.call(this);function searchInNextFile(uiSourceCode){if(uiSourceCode.isDirty())
contentLoaded.call(this,uiSourceCode,uiSourceCode.workingCopy());else
uiSourceCode.requestContent().then(contentLoaded.bind(this,uiSourceCode));}
function scheduleSearchInNextFileOrFinish(){if(fileIndex>=files.length){if(!callbacksLeft){progress.done();callback();return;}
return;}
++callbacksLeft;const uiSourceCode=files[fileIndex++];setTimeout(searchInNextFile.bind(this,uiSourceCode),0);}
function contentLoaded(uiSourceCode,content){function matchesComparator(a,b){return a.lineNumber-b.lineNumber;}
progress.worked(1);let matches=[];const queries=this._searchConfig.queries();if(content!==null){for(let i=0;i<queries.length;++i){const nextMatches=Common.ContentProvider.performSearchInContent(content,queries[i],!this._searchConfig.ignoreCase(),this._searchConfig.isRegex());matches=matches.mergeOrdered(nextMatches,matchesComparator);}}
if(matches){const searchResult=new Sources.FileBasedSearchResult(uiSourceCode,matches);this._searchResultCallback(searchResult);}
--callbacksLeft;scheduleSearchInNextFileOrFinish.call(this);}}
stopSearch(){++this._searchId;}};Sources.FileBasedSearchResult=class{constructor(uiSourceCode,searchMatches){this._uiSourceCode=uiSourceCode;this._searchMatches=searchMatches;}
label(){return this._uiSourceCode.displayName();}
description(){return this._uiSourceCode.fullDisplayName();}
matchesCount(){return this._searchMatches.length;}
matchLineContent(index){return this._searchMatches[index].lineContent;}
matchRevealable(index){const match=this._searchMatches[index];return this._uiSourceCode.uiLocation(match.lineNumber,match.columnNumber);}
matchLabel(index){return this._searchMatches[index].lineNumber+1;}};;Sources.SourcesPanel=class extends UI.Panel{constructor(){super('sources');Sources.SourcesPanel._instance=this;this.registerRequiredCSS('sources/sourcesPanel.css');new UI.DropTarget(this.element,[UI.DropTarget.Type.Folder],Common.UIString('Drop workspace folder here'),this._handleDrop.bind(this));this._workspace=Workspace.workspace;this._togglePauseAction=(UI.actionRegistry.action('debugger.toggle-pause'));this._stepOverAction=(UI.actionRegistry.action('debugger.step-over'));this._stepIntoAction=(UI.actionRegistry.action('debugger.step-into'));this._stepOutAction=(UI.actionRegistry.action('debugger.step-out'));this._stepAction=(UI.actionRegistry.action('debugger.step'));this._toggleBreakpointsActiveAction=(UI.actionRegistry.action('debugger.toggle-breakpoints-active'));this._debugToolbar=this._createDebugToolbar();this._debugToolbarDrawer=this._createDebugToolbarDrawer();this._debuggerPausedMessage=new Sources.DebuggerPausedMessage();const initialDebugSidebarWidth=225;this._splitWidget=new UI.SplitWidget(true,true,'sourcesPanelSplitViewState',initialDebugSidebarWidth);this._splitWidget.enableShowModeSaving();this._splitWidget.show(this.element);const initialNavigatorWidth=225;this.editorView=new UI.SplitWidget(true,false,'sourcesPanelNavigatorSplitViewState',initialNavigatorWidth);this.editorView.enableShowModeSaving();this.editorView.element.tabIndex=0;this._splitWidget.setMainWidget(this.editorView);this._navigatorTabbedLocation=UI.viewManager.createTabbedLocation(this._revealNavigatorSidebar.bind(this),'navigator-view',true);const tabbedPane=this._navigatorTabbedLocation.tabbedPane();tabbedPane.setMinimumSize(100,25);tabbedPane.element.classList.add('navigator-tabbed-pane');const navigatorMenuButton=new UI.ToolbarMenuButton(this._populateNavigatorMenu.bind(this),true);navigatorMenuButton.setTitle(Common.UIString('More options'));tabbedPane.rightToolbar().appendToolbarItem(navigatorMenuButton);if(UI.viewManager.hasViewsForLocation('run-view-sidebar')){const navigatorSplitWidget=new UI.SplitWidget(false,true,'sourcePanelNavigatorSidebarSplitViewState');navigatorSplitWidget.setMainWidget(tabbedPane);const runViewTabbedPane=UI.viewManager.createTabbedLocation(this._revealNavigatorSidebar.bind(this),'run-view-sidebar').tabbedPane();navigatorSplitWidget.setSidebarWidget(runViewTabbedPane);navigatorSplitWidget.installResizer(runViewTabbedPane.headerElement());this.editorView.setSidebarWidget(navigatorSplitWidget);}else{this.editorView.setSidebarWidget(tabbedPane);}
this._sourcesView=new Sources.SourcesView();this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorSelected,this._editorSelected.bind(this));this._toggleNavigatorSidebarButton=this.editorView.createShowHideSidebarButton(ls`navigator`);this._toggleDebuggerSidebarButton=this._splitWidget.createShowHideSidebarButton(ls`debugger`);this.editorView.setMainWidget(this._sourcesView);this._threadsSidebarPane=null;this._watchSidebarPane=(UI.viewManager.view('sources.watch'));this._callstackPane=self.runtime.sharedInstance(Sources.CallStackSidebarPane);Common.moduleSetting('sidebarPosition').addChangeListener(this._updateSidebarPosition.bind(this));this._updateSidebarPosition();this._updateDebuggerButtonsAndStatus();this._pauseOnExceptionEnabledChanged();Common.moduleSetting('pauseOnExceptionEnabled').addChangeListener(this._pauseOnExceptionEnabledChanged,this);this._liveLocationPool=new Bindings.LiveLocationPool();this._setTarget(UI.context.flavor(SDK.Target));Common.moduleSetting('breakpointsActive').addChangeListener(this._breakpointsActiveStateChanged,this);UI.context.addFlavorChangeListener(SDK.Target,this._onCurrentTargetChanged,this);UI.context.addFlavorChangeListener(SDK.DebuggerModel.CallFrame,this._callFrameChanged,this);SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.DebuggerWasEnabled,this._debuggerWasEnabled,this);SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.DebuggerPaused,this._debuggerPaused,this);SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.DebuggerResumed,event=>this._debuggerResumed((event.data)));SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.GlobalObjectCleared,event=>this._debuggerResumed((event.data)));Extensions.extensionServer.addEventListener(Extensions.ExtensionServer.Events.SidebarPaneAdded,this._extensionSidebarPaneAdded,this);SDK.targetManager.observeTargets(this);}
static instance(){if(Sources.SourcesPanel._instance)
return Sources.SourcesPanel._instance;return(self.runtime.sharedInstance(Sources.SourcesPanel));}
static updateResizerAndSidebarButtons(panel){panel._sourcesView.leftToolbar().removeToolbarItems();panel._sourcesView.rightToolbar().removeToolbarItems();panel._sourcesView.bottomToolbar().removeToolbarItems();const isInWrapper=Sources.SourcesPanel.WrapperView.isShowing()&&!UI.inspectorView.isDrawerMinimized();if(panel._splitWidget.isVertical()||isInWrapper)
panel._splitWidget.uninstallResizer(panel._sourcesView.toolbarContainerElement());else
panel._splitWidget.installResizer(panel._sourcesView.toolbarContainerElement());if(!isInWrapper){panel._sourcesView.leftToolbar().appendToolbarItem(panel._toggleNavigatorSidebarButton);if(panel._splitWidget.isVertical())
panel._sourcesView.rightToolbar().appendToolbarItem(panel._toggleDebuggerSidebarButton);else
panel._sourcesView.bottomToolbar().appendToolbarItem(panel._toggleDebuggerSidebarButton);}}
targetAdded(target){this._showThreadsIfNeeded();}
targetRemoved(target){}
_showThreadsIfNeeded(){if(Sources.ThreadsSidebarPane.shouldBeShown()&&!this._threadsSidebarPane){this._threadsSidebarPane=(UI.viewManager.view('sources.threads'));if(this._sidebarPaneStack&&this._threadsSidebarPane){this._sidebarPaneStack.showView(this._threadsSidebarPane,this._splitWidget.isVertical()?this._watchSidebarPane:this._callstackPane);}}}
_setTarget(target){if(!target)
return;const debuggerModel=target.model(SDK.DebuggerModel);if(!debuggerModel)
return;if(debuggerModel.isPaused()){this._showDebuggerPausedDetails((debuggerModel.debuggerPausedDetails()));}else{this._paused=false;this._clearInterface();this._toggleDebuggerSidebarButton.setEnabled(true);}}
_onCurrentTargetChanged(event){const target=(event.data);this._setTarget(target);}
paused(){return this._paused;}
wasShown(){UI.context.setFlavor(Sources.SourcesPanel,this);super.wasShown();const wrapper=Sources.SourcesPanel.WrapperView._instance;if(wrapper&&wrapper.isShowing()){UI.inspectorView.setDrawerMinimized(true);Sources.SourcesPanel.updateResizerAndSidebarButtons(this);}
this.editorView.setMainWidget(this._sourcesView);}
willHide(){super.willHide();UI.context.setFlavor(Sources.SourcesPanel,null);if(Sources.SourcesPanel.WrapperView.isShowing()){Sources.SourcesPanel.WrapperView._instance._showViewInWrapper();UI.inspectorView.setDrawerMinimized(false);Sources.SourcesPanel.updateResizerAndSidebarButtons(this);}}
resolveLocation(locationName){if(locationName==='sources.sidebar-top'||locationName==='sources.sidebar-bottom'||locationName==='sources.sidebar-tabs')
return this._sidebarPaneStack;else
return this._navigatorTabbedLocation;}
_ensureSourcesViewVisible(){if(Sources.SourcesPanel.WrapperView.isShowing())
return true;if(!UI.inspectorView.canSelectPanel('sources'))
return false;UI.viewManager.showView('sources');return true;}
onResize(){if(Common.moduleSetting('sidebarPosition').get()==='auto')
this.element.window().requestAnimationFrame(this._updateSidebarPosition.bind(this));}
searchableView(){return this._sourcesView.searchableView();}
_debuggerPaused(event){const debuggerModel=(event.data);const details=debuggerModel.debuggerPausedDetails();if(!this._paused)
this._setAsCurrentPanel();if(UI.context.flavor(SDK.Target)===debuggerModel.target())
this._showDebuggerPausedDetails((details));else if(!this._paused)
UI.context.setFlavor(SDK.Target,debuggerModel.target());}
_showDebuggerPausedDetails(details){this._paused=true;this._updateDebuggerButtonsAndStatus();UI.context.setFlavor(SDK.DebuggerPausedDetails,details);this._toggleDebuggerSidebarButton.setEnabled(false);this._revealDebuggerSidebar();window.focus();InspectorFrontendHost.bringToFront();}
_debuggerResumed(debuggerModel){const target=debuggerModel.target();if(UI.context.flavor(SDK.Target)!==target)
return;this._paused=false;this._clearInterface();this._toggleDebuggerSidebarButton.setEnabled(true);this._switchToPausedTargetTimeout=setTimeout(this._switchToPausedTarget.bind(this,debuggerModel),500);}
_debuggerWasEnabled(event){const debuggerModel=(event.data);if(UI.context.flavor(SDK.Target)!==debuggerModel.target())
return;this._updateDebuggerButtonsAndStatus();}
get visibleView(){return this._sourcesView.visibleView();}
showUISourceCode(uiSourceCode,lineNumber,columnNumber,omitFocus){if(omitFocus){const wrapperShowing=Sources.SourcesPanel.WrapperView._instance&&Sources.SourcesPanel.WrapperView._instance.isShowing();if(!this.isShowing()&&!wrapperShowing)
return;}else{this._showEditor();}
this._sourcesView.showSourceLocation(uiSourceCode,lineNumber,columnNumber,omitFocus);}
_showEditor(){if(Sources.SourcesPanel.WrapperView._instance&&Sources.SourcesPanel.WrapperView._instance.isShowing())
return;this._setAsCurrentPanel();}
showUILocation(uiLocation,omitFocus){this.showUISourceCode(uiLocation.uiSourceCode,uiLocation.lineNumber,uiLocation.columnNumber,omitFocus);}
_revealInNavigator(uiSourceCode,skipReveal){const extensions=self.runtime.extensions(Sources.NavigatorView);Promise.all(extensions.map(extension=>extension.instance())).then(filterNavigators.bind(this));function filterNavigators(objects){for(let i=0;i<objects.length;++i){const navigatorView=(objects[i]);const viewId=extensions[i].descriptor()['viewId'];if(navigatorView.acceptProject(uiSourceCode.project())){navigatorView.revealUISourceCode(uiSourceCode,true);if(skipReveal)
this._navigatorTabbedLocation.tabbedPane().selectTab(viewId);else
UI.viewManager.showView(viewId);}}}}
_populateNavigatorMenu(contextMenu){const groupByFolderSetting=Common.moduleSetting('navigatorGroupByFolder');contextMenu.appendItemsAtLocation('navigatorMenu');contextMenu.viewSection().appendCheckboxItem(Common.UIString('Group by folder'),()=>groupByFolderSetting.set(!groupByFolderSetting.get()),groupByFolderSetting.get());}
setIgnoreExecutionLineEvents(ignoreExecutionLineEvents){this._ignoreExecutionLineEvents=ignoreExecutionLineEvents;}
updateLastModificationTime(){this._lastModificationTime=window.performance.now();}
_executionLineChanged(liveLocation){const uiLocation=liveLocation.uiLocation();if(!uiLocation)
return;if(window.performance.now()-this._lastModificationTime<Sources.SourcesPanel._lastModificationTimeout)
return;this._sourcesView.showSourceLocation(uiLocation.uiSourceCode,uiLocation.lineNumber,uiLocation.columnNumber,undefined,true);}
_lastModificationTimeoutPassedForTest(){Sources.SourcesPanel._lastModificationTimeout=Number.MIN_VALUE;}
_updateLastModificationTimeForTest(){Sources.SourcesPanel._lastModificationTimeout=Number.MAX_VALUE;}
_callFrameChanged(){const callFrame=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!callFrame)
return;if(this._executionLineLocation)
this._executionLineLocation.dispose();this._executionLineLocation=Bindings.debuggerWorkspaceBinding.createCallFrameLiveLocation(callFrame.location(),this._executionLineChanged.bind(this),this._liveLocationPool);}
_pauseOnExceptionEnabledChanged(){const enabled=Common.moduleSetting('pauseOnExceptionEnabled').get();this._pauseOnExceptionButton.setToggled(enabled);this._pauseOnExceptionButton.setTitle(enabled?ls`Don't pause on exceptions`:ls`Pause on exceptions`);this._debugToolbarDrawer.classList.toggle('expanded',enabled);}
async _updateDebuggerButtonsAndStatus(){const currentTarget=UI.context.flavor(SDK.Target);const currentDebuggerModel=currentTarget?currentTarget.model(SDK.DebuggerModel):null;if(!currentDebuggerModel){this._togglePauseAction.setEnabled(false);this._stepOverAction.setEnabled(false);this._stepIntoAction.setEnabled(false);this._stepOutAction.setEnabled(false);this._stepAction.setEnabled(false);}else if(this._paused){this._togglePauseAction.setToggled(true);this._togglePauseAction.setEnabled(true);this._stepOverAction.setEnabled(true);this._stepIntoAction.setEnabled(true);this._stepOutAction.setEnabled(true);this._stepAction.setEnabled(true);}else{this._togglePauseAction.setToggled(false);this._togglePauseAction.setEnabled(!currentDebuggerModel.isPausing());this._stepOverAction.setEnabled(false);this._stepIntoAction.setEnabled(false);this._stepOutAction.setEnabled(false);this._stepAction.setEnabled(false);}
const details=currentDebuggerModel?currentDebuggerModel.debuggerPausedDetails():null;await this._debuggerPausedMessage.render(details,Bindings.debuggerWorkspaceBinding,Bindings.breakpointManager);if(details)
this._updateDebuggerButtonsAndStatusForTest();}
_updateDebuggerButtonsAndStatusForTest(){}
_clearInterface(){this._updateDebuggerButtonsAndStatus();UI.context.setFlavor(SDK.DebuggerPausedDetails,null);if(this._switchToPausedTargetTimeout)
clearTimeout(this._switchToPausedTargetTimeout);this._liveLocationPool.disposeAll();}
_switchToPausedTarget(debuggerModel){delete this._switchToPausedTargetTimeout;if(this._paused)
return;if(debuggerModel.isPaused())
return;const debuggerModels=SDK.targetManager.models(SDK.DebuggerModel);for(let i=0;i<debuggerModels.length;++i){if(debuggerModels[i].isPaused()){UI.context.setFlavor(SDK.Target,debuggerModels[i].target());break;}}}
_togglePauseOnExceptions(){Common.moduleSetting('pauseOnExceptionEnabled').set(!this._pauseOnExceptionButton.toggled());}
_runSnippet(){const uiSourceCode=this._sourcesView.currentUISourceCode();if(!uiSourceCode)
return;Snippets.evaluateScriptSnippet(uiSourceCode);}
_editorSelected(event){const uiSourceCode=(event.data);if(this.editorView.mainWidget()&&Common.moduleSetting('autoRevealInNavigator').get())
this._revealInNavigator(uiSourceCode,true);}
_togglePause(){const target=UI.context.flavor(SDK.Target);if(!target)
return true;const debuggerModel=target.model(SDK.DebuggerModel);if(!debuggerModel)
return true;if(this._paused){this._paused=false;debuggerModel.resume();}else{debuggerModel.pause();}
this._clearInterface();return true;}
_prepareToResume(){if(!this._paused)
return null;this._paused=false;this._clearInterface();const target=UI.context.flavor(SDK.Target);return target?target.model(SDK.DebuggerModel):null;}
_longResume(event){const debuggerModel=this._prepareToResume();if(!debuggerModel)
return;debuggerModel.skipAllPausesUntilReloadOrTimeout(500);debuggerModel.resume();}
_terminateExecution(event){const debuggerModel=this._prepareToResume();if(!debuggerModel)
return;debuggerModel.runtimeModel().terminateExecution();debuggerModel.resume();}
_stepOver(){const debuggerModel=this._prepareToResume();if(!debuggerModel)
return true;debuggerModel.stepOver();return true;}
_stepInto(){const debuggerModel=this._prepareToResume();if(!debuggerModel)
return true;debuggerModel.stepInto();return true;}
_stepIntoAsync(){const debuggerModel=this._prepareToResume();if(!debuggerModel)
return true;debuggerModel.scheduleStepIntoAsync();return true;}
_stepOut(){const debuggerModel=this._prepareToResume();if(!debuggerModel)
return true;debuggerModel.stepOut();return true;}
_continueToLocation(uiLocation){const executionContext=UI.context.flavor(SDK.ExecutionContext);if(!executionContext)
return;const rawLocations=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(uiLocation.uiSourceCode,uiLocation.lineNumber,0);const rawLocation=rawLocations.find(location=>location.debuggerModel===executionContext.debuggerModel);if(!rawLocation)
return;if(!this._prepareToResume())
return;rawLocation.continueToLocation();}
_toggleBreakpointsActive(){Common.moduleSetting('breakpointsActive').set(!Common.moduleSetting('breakpointsActive').get());}
_breakpointsActiveStateChanged(){const active=Common.moduleSetting('breakpointsActive').get();this._toggleBreakpointsActiveAction.setToggled(!active);this._sourcesView.toggleBreakpointsActiveState(active);}
_createDebugToolbar(){const debugToolbar=new UI.Toolbar('scripts-debug-toolbar');const longResumeButton=new UI.ToolbarButton(Common.UIString('Resume with all pauses blocked for 500 ms'),'largeicon-play');longResumeButton.addEventListener(UI.ToolbarButton.Events.Click,this._longResume,this);const terminateExecutionButton=new UI.ToolbarButton(ls`Terminate current JavaScript call`,'largeicon-terminate-execution');terminateExecutionButton.addEventListener(UI.ToolbarButton.Events.Click,this._terminateExecution,this);debugToolbar.appendToolbarItem(UI.Toolbar.createLongPressActionButton(this._togglePauseAction,[terminateExecutionButton,longResumeButton],[]));debugToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._stepOverAction));debugToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._stepIntoAction));debugToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._stepOutAction));debugToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._stepAction));debugToolbar.appendSeparator();debugToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._toggleBreakpointsActiveAction));this._pauseOnExceptionButton=new UI.ToolbarToggle('','largeicon-pause-on-exceptions');this._pauseOnExceptionButton.addEventListener(UI.ToolbarButton.Events.Click,this._togglePauseOnExceptions,this);debugToolbar.appendToolbarItem(this._pauseOnExceptionButton);return debugToolbar;}
_createDebugToolbarDrawer(){const debugToolbarDrawer=createElementWithClass('div','scripts-debug-toolbar-drawer');const label=Common.UIString('Pause on caught exceptions');const setting=Common.moduleSetting('pauseOnCaughtException');debugToolbarDrawer.appendChild(UI.SettingsUI.createSettingCheckbox(label,setting,true));return debugToolbarDrawer;}
appendApplicableItems(event,contextMenu,target){this._appendUISourceCodeItems(event,contextMenu,target);this._appendUISourceCodeFrameItems(event,contextMenu,target);this.appendUILocationItems(contextMenu,target);this._appendRemoteObjectItems(contextMenu,target);this._appendNetworkRequestItems(contextMenu,target);}
_appendUISourceCodeItems(event,contextMenu,target){if(!(target instanceof Workspace.UISourceCode))
return;const uiSourceCode=(target);if(!uiSourceCode.project().isServiceProject()&&!event.target.isSelfOrDescendant(this._navigatorTabbedLocation.widget().element)){contextMenu.revealSection().appendItem(Common.UIString('Reveal in sidebar'),this._handleContextMenuReveal.bind(this,uiSourceCode));}}
_appendUISourceCodeFrameItems(event,contextMenu,target){if(!(target instanceof Sources.UISourceCodeFrame))
return;if(target.uiSourceCode().contentType().isFromSourceMap()||target.textEditor.selection().isEmpty())
return;contextMenu.debugSection().appendAction('debugger.evaluate-selection');}
appendUILocationItems(contextMenu,object){if(!(object instanceof Workspace.UILocation))
return;const uiLocation=(object);const uiSourceCode=uiLocation.uiSourceCode;const contentType=uiSourceCode.contentType();if(contentType.hasScripts()){const target=UI.context.flavor(SDK.Target);const debuggerModel=target?target.model(SDK.DebuggerModel):null;if(debuggerModel&&debuggerModel.isPaused()){contextMenu.debugSection().appendItem(Common.UIString('Continue to here'),this._continueToLocation.bind(this,uiLocation));}
this._callstackPane.appendBlackboxURLContextMenuItems(contextMenu,uiSourceCode);}}
_handleContextMenuReveal(uiSourceCode){this.editorView.showBoth();this._revealInNavigator(uiSourceCode);}
_appendRemoteObjectItems(contextMenu,target){if(!(target instanceof SDK.RemoteObject))
return;const remoteObject=(target);const executionContext=UI.context.flavor(SDK.ExecutionContext);contextMenu.debugSection().appendItem(ls`Store as global variable`,()=>SDK.consoleModel.saveToTempVariable(executionContext,remoteObject));if(remoteObject.type==='function'){contextMenu.debugSection().appendItem(ls`Show function definition`,this._showFunctionDefinition.bind(this,remoteObject));}}
_appendNetworkRequestItems(contextMenu,target){if(!(target instanceof SDK.NetworkRequest))
return;const request=(target);const uiSourceCode=this._workspace.uiSourceCodeForURL(request.url());if(!uiSourceCode)
return;const openText=Common.UIString('Open in Sources panel');contextMenu.revealSection().appendItem(openText,this.showUILocation.bind(this,uiSourceCode.uiLocation(0,0)));}
_showFunctionDefinition(remoteObject){remoteObject.debuggerModel().functionDetailsPromise(remoteObject).then(this._didGetFunctionDetails.bind(this));}
_didGetFunctionDetails(response){if(!response||!response.location)
return;const location=response.location;if(!location)
return;const uiLocation=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(location);if(uiLocation)
this.showUILocation(uiLocation);}
_revealNavigatorSidebar(){this._setAsCurrentPanel();this.editorView.showBoth(true);}
_revealDebuggerSidebar(){this._setAsCurrentPanel();this._splitWidget.showBoth(true);}
_updateSidebarPosition(){let vertically;const position=Common.moduleSetting('sidebarPosition').get();if(position==='right')
vertically=false;else if(position==='bottom')
vertically=true;else
vertically=UI.inspectorView.element.offsetWidth<680;if(this.sidebarPaneView&&vertically===!this._splitWidget.isVertical())
return;if(this.sidebarPaneView&&this.sidebarPaneView.shouldHideOnDetach())
return;if(this.sidebarPaneView)
this.sidebarPaneView.detach();this._splitWidget.setVertical(!vertically);this._splitWidget.element.classList.toggle('sources-split-view-vertical',vertically);Sources.SourcesPanel.updateResizerAndSidebarButtons(this);const vbox=new UI.VBox();vbox.element.appendChild(this._debugToolbar.element);vbox.element.appendChild(this._debugToolbarDrawer);vbox.setMinimumAndPreferredSizes(25,25,Sources.SourcesPanel.minToolbarWidth,100);this._sidebarPaneStack=UI.viewManager.createStackLocation(this._revealDebuggerSidebar.bind(this));this._sidebarPaneStack.widget().element.classList.add('overflow-auto');this._sidebarPaneStack.widget().show(vbox.element);this._sidebarPaneStack.widget().element.appendChild(this._debuggerPausedMessage.element());this._sidebarPaneStack.appendApplicableItems('sources.sidebar-top');if(this._threadsSidebarPane)
this._sidebarPaneStack.showView(this._threadsSidebarPane);if(!vertically)
this._sidebarPaneStack.appendView(this._watchSidebarPane);this._sidebarPaneStack.showView(this._callstackPane);const jsBreakpoints=(UI.viewManager.view('sources.jsBreakpoints'));const scopeChainView=(UI.viewManager.view('sources.scopeChain'));if(this._tabbedLocationHeader){this._splitWidget.uninstallResizer(this._tabbedLocationHeader);this._tabbedLocationHeader=null;}
if(!vertically){this._sidebarPaneStack.showView(scopeChainView);this._sidebarPaneStack.showView(jsBreakpoints);this._extensionSidebarPanesContainer=this._sidebarPaneStack;this.sidebarPaneView=vbox;this._splitWidget.uninstallResizer(this._debugToolbar.gripElementForResize());}else{const splitWidget=new UI.SplitWidget(true,true,'sourcesPanelDebuggerSidebarSplitViewState',0.5);splitWidget.setMainWidget(vbox);this._sidebarPaneStack.showView(jsBreakpoints);const tabbedLocation=UI.viewManager.createTabbedLocation(this._revealDebuggerSidebar.bind(this));splitWidget.setSidebarWidget(tabbedLocation.tabbedPane());this._tabbedLocationHeader=tabbedLocation.tabbedPane().headerElement();this._splitWidget.installResizer(this._tabbedLocationHeader);this._splitWidget.installResizer(this._debugToolbar.gripElementForResize());tabbedLocation.appendView(scopeChainView);tabbedLocation.appendView(this._watchSidebarPane);tabbedLocation.appendApplicableItems('sources.sidebar-tabs');this._extensionSidebarPanesContainer=tabbedLocation;this.sidebarPaneView=splitWidget;}
this._sidebarPaneStack.appendApplicableItems('sources.sidebar-bottom');const extensionSidebarPanes=Extensions.extensionServer.sidebarPanes();for(let i=0;i<extensionSidebarPanes.length;++i)
this._addExtensionSidebarPane(extensionSidebarPanes[i]);this._splitWidget.setSidebarWidget(this.sidebarPaneView);}
_setAsCurrentPanel(){return UI.viewManager.showView('sources');}
_extensionSidebarPaneAdded(event){const pane=(event.data);this._addExtensionSidebarPane(pane);}
_addExtensionSidebarPane(pane){if(pane.panelName()===this.name)
this._extensionSidebarPanesContainer.appendView(pane);}
sourcesView(){return this._sourcesView;}
_handleDrop(dataTransfer){const items=dataTransfer.items;if(!items.length)
return;const entry=items[0].webkitGetAsEntry();if(!entry.isDirectory)
return;InspectorFrontendHost.upgradeDraggedFileSystemPermissions(entry.filesystem);}};Sources.SourcesPanel._lastModificationTimeout=200;Sources.SourcesPanel.minToolbarWidth=215;Sources.SourcesPanel.UILocationRevealer=class{reveal(uiLocation,omitFocus){if(!(uiLocation instanceof Workspace.UILocation))
return Promise.reject(new Error('Internal error: not a ui location'));Sources.SourcesPanel.instance().showUILocation(uiLocation,omitFocus);return Promise.resolve();}};Sources.SourcesPanel.DebuggerLocationRevealer=class{reveal(rawLocation,omitFocus){if(!(rawLocation instanceof SDK.DebuggerModel.Location))
return Promise.reject(new Error('Internal error: not a debugger location'));const uiLocation=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(rawLocation);if(!uiLocation)
return Promise.resolve();Sources.SourcesPanel.instance().showUILocation(uiLocation,omitFocus);return Promise.resolve();}};Sources.SourcesPanel.UISourceCodeRevealer=class{reveal(uiSourceCode,omitFocus){if(!(uiSourceCode instanceof Workspace.UISourceCode))
return Promise.reject(new Error('Internal error: not a ui source code'));Sources.SourcesPanel.instance().showUISourceCode(uiSourceCode,undefined,undefined,omitFocus);return Promise.resolve();}};Sources.SourcesPanel.DebuggerPausedDetailsRevealer=class{reveal(object){return Sources.SourcesPanel.instance()._setAsCurrentPanel();}};Sources.SourcesPanel.RevealingActionDelegate=class{handleAction(context,actionId){const panel=Sources.SourcesPanel.instance();if(!panel._ensureSourcesViewVisible())
return false;switch(actionId){case'debugger.toggle-pause':panel._togglePause();return true;}
return false;}};Sources.SourcesPanel.DebuggingActionDelegate=class{handleAction(context,actionId){const panel=Sources.SourcesPanel.instance();switch(actionId){case'debugger.step-over':panel._stepOver();return true;case'debugger.step-into':panel._stepIntoAsync();return true;case'debugger.step':panel._stepInto();return true;case'debugger.step-out':panel._stepOut();return true;case'debugger.run-snippet':panel._runSnippet();return true;case'debugger.toggle-breakpoints-active':panel._toggleBreakpointsActive();return true;case'debugger.evaluate-selection':const frame=UI.context.flavor(Sources.UISourceCodeFrame);if(frame){let text=frame.textEditor.text(frame.textEditor.selection());const executionContext=UI.context.flavor(SDK.ExecutionContext);if(executionContext){const message=SDK.consoleModel.addCommandMessage(executionContext,text);text=ObjectUI.JavaScriptREPL.wrapObjectLiteral(text);SDK.consoleModel.evaluateCommandInConsole(executionContext,message,text,true,false);}}
return true;}
return false;}};Sources.SourcesPanel.WrapperView=class extends UI.VBox{constructor(){super();this.element.classList.add('sources-view-wrapper');Sources.SourcesPanel.WrapperView._instance=this;this._view=Sources.SourcesPanel.instance()._sourcesView;}
static isShowing(){return!!Sources.SourcesPanel.WrapperView._instance&&Sources.SourcesPanel.WrapperView._instance.isShowing();}
wasShown(){if(!Sources.SourcesPanel.instance().isShowing())
this._showViewInWrapper();else
UI.inspectorView.setDrawerMinimized(true);Sources.SourcesPanel.updateResizerAndSidebarButtons(Sources.SourcesPanel.instance());}
willHide(){UI.inspectorView.setDrawerMinimized(false);setImmediate(()=>Sources.SourcesPanel.updateResizerAndSidebarButtons(Sources.SourcesPanel.instance()));}
_showViewInWrapper(){this._view.show(this.element);}};;Sources.JavaScriptCompilerPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(textEditor,uiSourceCode){super();this._textEditor=textEditor;this._uiSourceCode=uiSourceCode;this._compiling=false;this._recompileScheduled=false;this._timeout=null;this._message=null;this._disposed=false;this._textEditor.addEventListener(UI.TextEditor.Events.TextChanged,this._scheduleCompile,this);if(this._uiSourceCode.hasCommits()||this._uiSourceCode.isDirty())
this._scheduleCompile();}
static accepts(uiSourceCode){if(uiSourceCode.extension()==='js')
return true;if(Snippets.isSnippetsUISourceCode(uiSourceCode))
return true;for(const debuggerModel of SDK.targetManager.models(SDK.DebuggerModel)){if(Bindings.debuggerWorkspaceBinding.scriptFile(uiSourceCode,debuggerModel))
return true;}
return false;}
_scheduleCompile(){if(this._compiling){this._recompileScheduled=true;return;}
if(this._timeout)
clearTimeout(this._timeout);this._timeout=setTimeout(this._compile.bind(this),Sources.JavaScriptCompilerPlugin.CompileDelay);}
_findRuntimeModel(){const debuggerModels=SDK.targetManager.models(SDK.DebuggerModel);for(let i=0;i<debuggerModels.length;++i){const scriptFile=Bindings.debuggerWorkspaceBinding.scriptFile(this._uiSourceCode,debuggerModels[i]);if(scriptFile)
return debuggerModels[i].runtimeModel();}
return SDK.targetManager.mainTarget()?SDK.targetManager.mainTarget().model(SDK.RuntimeModel):null;}
async _compile(){const runtimeModel=this._findRuntimeModel();if(!runtimeModel)
return;const currentExecutionContext=UI.context.flavor(SDK.ExecutionContext);if(!currentExecutionContext)
return;const code=this._textEditor.text();if(code.length>1024*100)
return;this._compiling=true;const result=await runtimeModel.compileScript(code,'',false,currentExecutionContext.id);this._compiling=false;if(this._recompileScheduled){this._recompileScheduled=false;this._scheduleCompile();return;}
if(this._message)
this._uiSourceCode.removeMessage(this._message);if(this._disposed||!result||!result.exceptionDetails)
return;const exceptionDetails=result.exceptionDetails;const text=SDK.RuntimeModel.simpleTextFromException(exceptionDetails);this._message=this._uiSourceCode.addLineMessage(Workspace.UISourceCode.Message.Level.Error,text,exceptionDetails.lineNumber,exceptionDetails.columnNumber);this._compilationFinishedForTest();}
_compilationFinishedForTest(){}
dispose(){this._textEditor.removeEventListener(UI.TextEditor.Events.TextChanged,this._scheduleCompile,this);if(this._message)
this._uiSourceCode.removeMessage(this._message);this._disposed=true;if(this._timeout)
clearTimeout(this._timeout);}};Sources.JavaScriptCompilerPlugin.CompileDelay=1000;;Sources.SnippetsPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(textEditor,uiSourceCode){super();this._textEditor=textEditor;this._uiSourceCode=uiSourceCode;}
static accepts(uiSourceCode){return Snippets.isSnippetsUISourceCode(uiSourceCode);}
rightToolbarItems(){const runSnippet=UI.Toolbar.createActionButtonForId('debugger.run-snippet');runSnippet.setText(Host.isMac()?Common.UIString('\u2318+Enter'):Common.UIString('Ctrl+Enter'));return[runSnippet];}};;Sources.ScriptOriginPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(textEditor,uiSourceCode){super();this._textEditor=textEditor;this._uiSourceCode=uiSourceCode;}
static accepts(uiSourceCode){return uiSourceCode.contentType().hasScripts()||!!Sources.ScriptOriginPlugin._script(uiSourceCode);}
rightToolbarItems(){const originURL=Bindings.CompilerScriptMapping.uiSourceCodeOrigin(this._uiSourceCode);if(originURL){const item=UI.formatLocalized('(source mapped from %s)',[Components.Linkifier.linkifyURL(originURL)]);return[new UI.ToolbarItem(item)];}
const script=Sources.ScriptOriginPlugin._script(this._uiSourceCode);if(!script||!script.originStackTrace)
return[];const link=Sources.ScriptOriginPlugin._linkifier.linkifyStackTraceTopFrame(script.debuggerModel.target(),script.originStackTrace);return[new UI.ToolbarItem(link)];}
static _script(uiSourceCode){const locations=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(uiSourceCode,0,0);for(const location of locations){const script=location.script();if(script.originStackTrace)
return script;}
return null;}};Sources.ScriptOriginPlugin._linkifier=new Components.Linkifier();;Runtime.cachedResources["sources/breakpointEditDialog.css"]="/*\n * Copyright 2018 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n  z-index: 30;\n  padding: 4px;\n  background-color: #e6e6e6;\n  border-radius: 7px;\n  border: 2px solid #bababa;\n  width: 90%;\n  pointer-events: auto;\n}\n\n:host(.sources-edit-breakpoint-dialog) {\n  border: none;\n  border-radius: 0;\n  z-index: 30;\n  background-color: var(--toolbar-bg-color);\n  width: 555px;\n  pointer-events: auto;\n  margin: 2px 0 2px -1px;\n  padding: 0 10px 10px 5px;\n  border: 1px solid var(--divider-color);\n}\n\n:host-context(.sources-edit-breakpoint-dialog) .condition-editor {\n  background-color: #fff;\n  margin-left: 3px;\n}\n\n:host-context(.sources-edit-breakpoint-dialog) .source-frame-breakpoint-toolbar {\n  font-family: sans-serif;\n  font-size: 12px;\n}\n\n/*# sourceURL=sources/breakpointEditDialog.css */";Runtime.cachedResources["sources/callStackSidebarPane.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.blackboxed-message {\n    text-align: center;\n    font-style: italic;\n    padding: 4px;\n    color: #888;\n    background-color: #FFFFC2;\n}\n\n.blackboxed-message > .link {\n    margin-left: 5px;\n}\n\n.blackboxed-message > .link:focus {\n    outline-width: unset;\n}\n\n.show-more-message {\n    text-align: center;\n    font-style: italic;\n    padding: 4px;\n    border-top: 1px solid #d8d8d8;\n}\n\n.show-more-message > .link {\n    margin-left: 5px;\n}\n\n.call-frame-item {\n    padding: 3px 8px 3px 20px;\n    position: relative;\n    min-height: 18px;\n    line-height: 15px;\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.call-frame-item[data-keyboard-focus=\"true\"]:focus,\n.call-frame-item.async-header[data-keyboard-focus=\"true\"]:focus .call-frame-item-title {\n    background-color: var(--focus-bg-color);\n}\n\n.call-frame-title-text {\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.call-frame-item:not(.async-header) {\n    border-top: 1px solid #efefef;\n}\n\n.call-frame-item:not(.async-header):hover,\n.call-frame-item.async-header[data-keyboard-focus=\"true\"]:focus:hover,\n.call-frame-item.async-header[data-keyboard-focus=\"true\"]:focus:hover .call-frame-item-title {\n    background-color: #eee;\n}\n\n.async-header + .call-frame-item {\n    border-top: 0;\n}\n\n.call-frame-item-title,\n.call-frame-location {\n    display: flex;\n    white-space: nowrap;\n}\n\n.call-frame-location {\n    color: #888;\n    margin-left: auto;\n    padding: 0 10px 0 10px;\n}\n\n.async-header::before {\n    content: \" \";\n    width: 100%;\n    border-top: 1px solid #d8d8d8;\n    margin-top: 8px;\n    position: absolute;\n    left: 0;\n}\n\n.async-header .call-frame-item-title {\n    font-weight: bold;\n    color: #999;\n    background-color: white;\n    margin-left: -5px;\n    padding: 0 5px;\n    z-index: 1;\n}\n\n.blackboxed-call-frame {\n    opacity: 0.6;\n    font-style: italic;\n}\n\n.selected-call-frame-icon {\n    display: none;\n    position: absolute;\n    top: 5px;\n    left: 4px;\n}\n\n.call-frame-item.selected .selected-call-frame-icon {\n    display: block;\n}\n\n:host-context(.-theme-with-dark-background) .blackboxed-message {\n    background-color: hsl(46, 98%, 22%);\n    color: #aaa;\n}\n\n:host-context(.-theme-with-dark-background) .blackboxed-message > .link {\n    color: hsl(0, 0%, 67%);\n}\n\n/*# sourceURL=sources/callStackSidebarPane.css */";Runtime.cachedResources["sources/debuggerPausedMessage.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.paused-status {\n    padding: 6px;\n    border-bottom: 1px solid transparent;\n    border-top: 1px solid rgb(189, 189, 189);\n    background-color: hsl(50, 100%, 95%);\n    color: rgb(107, 97, 48);\n}\n\n.-theme-with-dark-background .paused-status {\n    background-color: hsl(46, 98%, 22%);\n    color: #ccc;\n}\n\n.paused-status.error-reason {\n    background-color: hsl(0, 100%, 97%);\n    color: #6b3b3b;\n}\n\n.status-main {\n    font-weight: bold;\n    padding-left: 15px;\n    position: relative;\n}\n\n.status-sub:not(:empty) {\n    padding-left: 15px;\n    padding-top: 5px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.paused-status.error-reason .status-sub {\n    color: red;\n    line-height: 11px;\n    max-height: 27px;\n    -webkit-user-select: text;\n}\n\n.status-icon {\n    -webkit-filter: hue-rotate(190deg);\n    position: absolute;\n    left: 0;\n    top: calc(50% - 5px);\n}\n\n.paused-status.error-reason .status-icon {\n    -webkit-filter: none;\n}\n\n/*# sourceURL=sources/debuggerPausedMessage.css */";Runtime.cachedResources["sources/javaScriptBreakpointsSidebarPane.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.breakpoint-entry {\n    padding: 3px 8px 3px 8px;\n    min-height: 18px;\n    line-height: 15px;\n    border-top: 1px solid #efefef;\n}\n\n.breakpoint-entry:focus {\n    background-color: var(--focus-bg-color);\n}\n\n.breakpoint-entry [is=dt-checkbox] {\n    max-width: 100%;\n    white-space: nowrap;\n}\n\n:not(.breakpoints-list-deactivated) > .breakpoint-entry:hover {\n    background-color: #eee;\n}\n\n.breakpoint-entry > .source-text {\n    cursor: pointer;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    margin-left: 22px;\n}\n\n.breakpoints-list-deactivated {\n    background-color: #eee;\n    opacity: 0.3;\n}\n\n.breakpoint-hit {\n    background-color: rgb(255, 255, 194);\n    border-right: 3px solid rgb(107, 97, 48);\n}\n\n:host-context(.-theme-with-dark-background) .breakpoint-hit {\n    background-color: hsl(46, 98%, 22%);\n    color: #ccc;\n}\n\n/*# sourceURL=sources/javaScriptBreakpointsSidebarPane.css */";Runtime.cachedResources["sources/navigatorTree.css"]="/*\n * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.icon, .icon-badge {\n    margin: -3px -5px -3px -5px;\n}\n\n.icon-stack {\n    position: relative;\n    display: inline-flex;\n}\n\n.icon-stack > [is=ui-icon]:not(:first-child) {\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n.navigator-file-tree-item .icon {\n    background: linear-gradient(45deg, hsl(0, 0%, 50%), hsl(0, 0%, 70%));\n}\n\n.navigator-fs-tree-item:not(.has-mapped-files):not(.selected) > :not(.selection),\n.navigator-fs-folder-tree-item:not(.has-mapped-files):not(.selected) > :not(.selection) {\n    filter: grayscale(50%);\n    opacity: 0.5;\n}\n\n.tree-outline li {\n    min-height: 20px;\n}\n\n.tree-outline li:hover:not(.selected) .selection {\n    display: block;\n    background-color: var(--item-hover-color);\n}\n\n.navigator-folder-tree-item .icon {\n    background-color: #555;\n}\n\n.navigator-sm-folder-tree-item .icon,\n.navigator-fs-tree-item .icon,\n.navigator-fs-folder-tree-item .icon {\n    background: linear-gradient(45deg, hsl(28, 75%, 50%), hsl(28, 75%, 70%));\n}\n\n.navigator-nw-folder-tree-item .icon {\n    background: linear-gradient(45deg, hsl(210, 82%, 65%), hsl(210, 82%, 80%));\n}\n\n.navigator-sm-script-tree-item .icon,\n.navigator-script-tree-item .icon,\n.navigator-snippet-tree-item .icon {\n    background: linear-gradient(45deg, hsl(48, 70%, 50%), hsl(48, 70%, 70%));\n}\n\n.navigator-sm-stylesheet-tree-item .icon,\n.navigator-stylesheet-tree-item .icon {\n    background: linear-gradient(45deg, hsl(256, 50%, 50%), hsl(256, 50%, 70%));\n}\n\n.navigator-image-tree-item .icon,\n.navigator-font-tree-item .icon {\n    background: linear-gradient(45deg, hsl(109, 33%, 50%), hsl(109, 33%, 70%));\n}\n\n.navigator-sm-folder-tree-item .tree-element-title,\n.navigator-sm-script-tree-item .tree-element-title,\n.navigator-sm-stylesheet-tree-item .tree-element-title {\n    font-style: italic;\n}\n\n:host{\n    overflow-y: auto;\n}\n\n/*# sourceURL=sources/navigatorTree.css */";Runtime.cachedResources["sources/navigatorView.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.navigator-toolbar {\n    border-bottom: 1px solid #ccc;\n    padding-left: 8px;\n}\n\n/*# sourceURL=sources/navigatorView.css */";Runtime.cachedResources["sources/scopeChainSidebarPane.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.scope-chain-sidebar-pane-section-header {\n    flex: auto;\n}\n\n.scope-chain-sidebar-pane-section-subtitle {\n    float: right;\n    margin-left: 5px;\n    max-width: 55%;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.scope-chain-sidebar-pane-section-title {\n    font-weight: normal;\n    word-wrap: break-word;\n    white-space: normal;\n}\n\n.scope-chain-sidebar-pane-section {\n    padding: 2px 4px;\n    flex: none;\n}\n\n/*# sourceURL=sources/scopeChainSidebarPane.css */";Runtime.cachedResources["sources/sourcesPanel.css"]="/*\n * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.scripts-debug-toolbar {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    background-color: var(--toolbar-bg-color);\n    border-bottom: 1px solid #ccc;\n    overflow: hidden;\n}\n\n.scripts-debug-toolbar-drawer {\n    flex: 0 0 52px;\n    -webkit-transition: margin-top 0.1s ease-in-out;\n    margin-top: -26px;\n    padding-top: 25px;\n    background-color: white;\n    overflow: hidden;\n    white-space: nowrap;\n}\n\n.scripts-debug-toolbar-drawer.expanded {\n    margin-top: 0;\n}\n\n.scripts-debug-toolbar-drawer > [is=dt-checkbox] {\n    display: none;\n    padding-left: 3px;\n    height: 28px;\n}\n\n.scripts-debug-toolbar-drawer.expanded > [is=dt-checkbox] {\n    display: flex;\n}\n\n.cursor-auto {\n    cursor: auto;\n}\n\n.navigator-tabbed-pane {\n    background-color: var(--toolbar-bg-color);\n}\n\n/*# sourceURL=sources/sourcesPanel.css */";Runtime.cachedResources["sources/sourcesView.css"]="/*\n * Copyright (C) 2013 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#sources-panel-sources-view {\n    flex: auto;\n    position: relative;\n}\n\n#sources-panel-sources-view .sources-toolbar {\n    display: flex;\n    flex: 0 0 27px;\n    background-color: var(--toolbar-bg-color);\n    border-top: var(--divider-border);\n    overflow: hidden;\n    z-index: 0;\n}\n\n.sources-toolbar .toolbar {\n    cursor: default;\n}\n\n.source-frame-debugger-script {\n    background-color: rgba(255, 255, 194, 0.5);\n}\n\n.-theme-with-dark-background .source-frame-debugger-script {\n    background-color: #444;\n}\n\n@-webkit-keyframes source-frame-value-update-highlight-animation {\n    from {\n        background-color: inherit;\n        color: inherit;\n    }\n    10% {\n        background-color: rgb(158, 54, 153);\n        color: white;\n    }\n    to {\n        background-color: inherit;\n        color: inherit;\n    }\n}\n\n.source-frame-value-update-highlight {\n    -webkit-animation: source-frame-value-update-highlight-animation 0.8s 1 cubic-bezier(0, 0, 0.2, 1);\n    border-radius: 2px;\n}\n\n.diff-entry-insert .diff-marker {\n    border-left: 4px solid hsla(144, 55%, 37%, 1);\n}\n\n.diff-entry-insert .CodeMirror-gutter-background {\n    background-color: hsla(144,55%,49%,.2);\n}\n\n.diff-entry-modify .diff-marker {\n    border-left: 4px solid #9C27B0;\n}\n\n.diff-entry-modify .CodeMirror-gutter-background {\n    background-color: rgba(186,104,200,0.2);\n}\n\n.diff-entry-delete .diff-marker {\n    width: 0;\n    height: 0;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n    border-left: 6px solid #D32F2F;\n    position: relative;\n    top: 6px;\n    cursor: pointer;\n    left: 0px;\n}\n\n.diff-entry-delete .CodeMirror-gutter-background {\n    border-bottom: 2px solid #D32F2F;\n}\n\n.CodeMirror-gutter-diff {\n    width: 4px;\n}\n\n.highlight-line-modification {\n    animation: source-line-modification-background-fadeout 0.4s 0s;\n    animation-timing-function: cubic-bezier(0, 0, 0.2, 1);\n}\n\n.highlight-line-modification span {\n    animation: source-line-modification-foreground-fadeout 0.4s 0s;\n    animation-timing-function: cubic-bezier(0, 0, 0.2, 1);\n}\n\n@keyframes source-line-modification-background-fadeout {\n    from { background-color: rgba(158, 54, 153, 0.5); }\n    50% { background-color: rgba(158, 54, 153, 0.5); }\n    90% { background-color: rgba(158, 54, 153, 0); }\n    to { background-color: transparent; }\n}\n\n@keyframes source-line-modification-foreground-fadeout {\n    from { color: white; }\n    50% { color: white; }\n    90% { color: initial; }\n    to { color: initial; }\n}\n\n/*# sourceURL=sources/sourcesView.css */";Runtime.cachedResources["sources/threadsSidebarPane.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.thread-item {\n    padding: 3px 8px 3px 20px;\n    position: relative;\n    min-height: 18px;\n    line-height: 15px;\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.thread-item + .thread-item {\n    border-top: 1px solid #efefef;\n}\n\n.thread-item:hover {\n    background-color: #eee;\n}\n\n.thread-item[data-keyboard-focus=\"true\"] {\n    background-color: var(--focus-bg-color);\n}\n\n.thread-item-title,\n.thread-item-paused-state {\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n}\n\n.thread-item-paused-state {\n    color: #888;\n    margin-left: auto;\n    padding: 0 10px 0 10px;\n}\n\n.selected-thread-icon {\n    display: none;\n    position: absolute;\n    top: 5px;\n    left: 4px;\n}\n\n.thread-item.selected .selected-thread-icon {\n    display: block;\n}\n\n\n/*# sourceURL=sources/threadsSidebarPane.css */";Runtime.cachedResources["sources/watchExpressionsSidebarPane.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.watch-expression-delete-button {\n    position: absolute;\n    top: 5px;\n    right: 6px;\n    cursor: pointer;\n    opacity: 0;\n    min-width: 20px;\n}\n\n.watch-expression-header:hover .watch-expression-delete-button {\n    opacity: 0.5;\n}\n\n.watch-expression-header:hover .watch-expression-delete-button:hover {\n    opacity: 1;\n}\n\n.watch-expressions {\n    overflow-x: hidden;\n    min-height: 26px;\n}\n\n.watch-expressions .dimmed {\n    opacity: 0.6;\n}\n\n.watch-expression-title {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    line-height: 20px;\n}\n\n.watch-expression-object-header .watch-expression-title {\n    margin-left: 1px;\n}\n\n.watch-expression {\n    position: relative;\n    flex: auto;\n    min-height: 20px;\n}\n\n.watch-expressions .name {\n    color: rgb(136, 19, 145);\n    flex: none;\n    white-space: nowrap;\n    text-overflow: ellipsis ;\n    overflow: hidden;\n}\n\n.watch-expression-error {\n    color: red;\n}\n\n:host-context(.-theme-with-dark-background) .watch-expression-error {\n    color: hsl(0, 100%, 65%);\n}\n\n.watch-expressions-separator {\n    flex: none;\n}\n\n.watch-expressions .value {\n    white-space: nowrap;\n    display: inline;\n}\n\n.watch-expression .text-prompt {\n    text-overflow: clip;\n    overflow: hidden;\n    white-space: nowrap;\n    padding-left: 4px;\n    min-height: 18px;\n    line-height: 18px;\n    -webkit-user-select: text;\n}\n\n.watch-expression-text-prompt-proxy {\n    margin: 2px 12px 2px -4px;\n    padding-bottom: 3px;\n}\n\n.watch-expression-header {\n    flex: auto;\n    margin-left: -16px;\n    padding-left: 15px;\n}\n\nli.watch-expression-tree-item:hover {\n    background-color: #F0F0F0;\n}\n\nli.watch-expression-tree-item {\n    padding-left: 4px;\n}\n\n.watch-expression-header:focus[data-keyboard-focus=\"true\"] {\n    background: var(--focus-bg-color);\n}\n\nli.watch-expression-editing::before {\n    background-color: transparent;\n}\n\n/*# sourceURL=sources/watchExpressionsSidebarPane.css */";Runtime.cachedResources["sources/dialog.css"]="/*\n * Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    padding: 10px;\n}\n\n.widget {\n    align-items: center;\n}\n\nlabel {\n    white-space: nowrap;\n}\n\ninput[type=text].add-source-map {\n    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2);\n    font-size: inherit;\n    margin: 0 8px 0 5px;\n}\n\n/*# sourceURL=sources/dialog.css */";(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";CodeMirror.defineMode("css",function(config,parserConfig){var inline=parserConfig.inline
if(!parserConfig.propertyKeywords)parserConfig=CodeMirror.resolveMode("text/css");var indentUnit=config.indentUnit,tokenHooks=parserConfig.tokenHooks,documentTypes=parserConfig.documentTypes||{},mediaTypes=parserConfig.mediaTypes||{},mediaFeatures=parserConfig.mediaFeatures||{},mediaValueKeywords=parserConfig.mediaValueKeywords||{},propertyKeywords=parserConfig.propertyKeywords||{},nonStandardPropertyKeywords=parserConfig.nonStandardPropertyKeywords||{},fontProperties=parserConfig.fontProperties||{},counterDescriptors=parserConfig.counterDescriptors||{},colorKeywords=parserConfig.colorKeywords||{},valueKeywords=parserConfig.valueKeywords||{},allowNested=parserConfig.allowNested,lineComment=parserConfig.lineComment,supportsAtComponent=parserConfig.supportsAtComponent===true;var type,override;function ret(style,tp){type=tp;return style;}
function tokenBase(stream,state){var ch=stream.next();if(tokenHooks[ch]){var result=tokenHooks[ch](stream,state);if(result!==false)return result;}
if(ch=="@"){stream.eatWhile(/[\w\\\-]/);return ret("def",stream.current());}else if(ch=="="||(ch=="~"||ch=="|")&&stream.eat("=")){return ret(null,"compare");}else if(ch=="\""||ch=="'"){state.tokenize=tokenString(ch);return state.tokenize(stream,state);}else if(ch=="#"){stream.eatWhile(/[\w\\\-]/);return ret("atom","hash");}else if(ch=="!"){stream.match(/^\s*\w*/);return ret("keyword","important");}else if(/\d/.test(ch)||ch=="."&&stream.eat(/\d/)){stream.eatWhile(/[\w.%]/);return ret("number","unit");}else if(ch==="-"){if(/[\d.]/.test(stream.peek())){stream.eatWhile(/[\w.%]/);return ret("number","unit");}else if(stream.match(/^-[\w\\\-]*/)){stream.eatWhile(/[\w\\\-]/);if(stream.match(/^\s*:/,false))
return ret("variable-2","variable-definition");return ret("variable-2","variable");}else if(stream.match(/^\w+-/)){return ret("meta","meta");}}else if(/[,+>*\/]/.test(ch)){return ret(null,"select-op");}else if(ch=="."&&stream.match(/^-?[_a-z][_a-z0-9-]*/i)){return ret("qualifier","qualifier");}else if(/[:;{}\[\]\(\)]/.test(ch)){return ret(null,ch);}else if(stream.match(/[\w-.]+(?=\()/)){if(/^(url(-prefix)?|domain|regexp)$/.test(stream.current().toLowerCase())){state.tokenize=tokenParenthesized;}
return ret("variable callee","variable");}else if(/[\w\\\-]/.test(ch)){stream.eatWhile(/[\w\\\-]/);return ret("property","word");}else{return ret(null,null);}}
function tokenString(quote){return function(stream,state){var escaped=false,ch;while((ch=stream.next())!=null){if(ch==quote&&!escaped){if(quote==")")stream.backUp(1);break;}
escaped=!escaped&&ch=="\\";}
if(ch==quote||!escaped&&quote!=")")state.tokenize=null;return ret("string","string");};}
function tokenParenthesized(stream,state){stream.next();if(!stream.match(/\s*[\"\')]/,false))
state.tokenize=tokenString(")");else
state.tokenize=null;return ret(null,"(");}
function Context(type,indent,prev){this.type=type;this.indent=indent;this.prev=prev;}
function pushContext(state,stream,type,indent){state.context=new Context(type,stream.indentation()+(indent===falsPK
     FcO2
      	   1/1.z3278e?0:indentUnit),state.context);return type;}
function popContext(state){if(state.context.prev)
state.context=state.context.prev;return state.context.type;}
function pass(type,stream,state){return states[state.context.type](type,stream,state);}
function popAndPass(type,stream,state,n){for(var i=n||1;i>0;i--)
state.context=state.context.prev;return pass(type,stream,state);}
function wordAsValue(stream){var word=stream.current().toLowerCase();if(valueKeywords.hasOwnProperty(word))
override="atom";else if(colorKeywords.hasOwnProperty(word))
override="keyword";else
override="variable";}
var states={};states.top=function(type,stream,state){if(type=="{"){return pushContext(state,stream,"block");}else if(type=="}"&&state.context.prev){return popContext(state);}else if(supportsAtComponent&&/@component/i.test(type)){return pushContext(state,stream,"atComponentBlock");}else if(/^@(-moz-)?document$/i.test(type)){return pushContext(state,stream,"documentTypes");}else if(/^@(media|supports|(-moz-)?document|import)$/i.test(type)){return pushContext(state,stream,"atBlock");}else if(/^@(font-face|counter-style)/i.test(type)){state.stateArg=type;return"restricted_atBlock_before";}else if(/^@(-(moz|ms|o|webkit)-)?keyframes$/i.test(type)){return"keyframes";}else if(type&&type.charAt(0)=="@"){return pushContext(state,stream,"at");}else if(type=="hash"){override="builtin";}else if(type=="word"){override="tag";}else if(type=="variable-definition"){return"maybeprop";}else if(type=="interpolation"){return pushContext(state,stream,"interpolation");}else if(type==":"){return"pseudo";}else if(allowNested&&type=="("){return pushContext(state,stream,"parens");}
return state.context.type;};states.block=function(type,stream,state){if(type=="word"){var word=stream.current().toLowerCase();if(propertyKeywords.hasOwnProperty(word)){override="property";return"maybeprop";}else if(nonStandardPropertyKeywords.hasOwnProperty(word)){override="string-2";return"maybeprop";}else if(allowNested){override=stream.match(/^\s*:(?:\s|$)/,false)?"property":"tag";return"block";}else{override+=" error";return"maybeprop";}}else if(type=="meta"){return"block";}else if(!allowNested&&(type=="hash"||type=="qualifier")){override="error";return"block";}else{return states.top(type,stream,state);}};states.maybeprop=function(type,stream,state){if(type==":")return pushContext(state,stream,"prop");return pass(type,stream,state);};states.prop=function(type,stream,state){if(type==";")return popContext(state);if(type=="{"&&allowNested)return pushContext(state,stream,"propBlock");if(type=="}"||type=="{")return popAndPass(type,stream,state);if(type=="(")return pushContext(state,stream,"parens");if(type=="hash"&&!/^#([0-9a-fA-f]{3,4}|[0-9a-fA-f]{6}|[0-9a-fA-f]{8})$/.test(stream.current())){override+=" error";}else if(type=="word"){wordAsValue(stream);}else if(type=="interpolation"){return pushContext(state,stream,"interpolation");}
return"prop";};states.propBlock=function(type,_stream,state){if(type=="}")return popContext(state);if(type=="word"){override="property";return"maybeprop";}
return state.context.type;};states.parens=function(type,stream,state){if(type=="{"||type=="}")return popAndPass(type,stream,state);if(type==")")return popContext(state);if(type=="(")return pushContext(state,stream,"parens");if(type=="interpolation")return pushContext(state,stream,"interpolation");if(type=="word")wordAsValue(stream);return"parens";};states.pseudo=function(type,stream,state){if(type=="meta")return"pseudo";if(type=="word"){override="variable-3";return state.context.type;}
return pass(type,stream,state);};states.documentTypes=function(type,stream,state){if(type=="word"&&documentTypes.hasOwnProperty(stream.current())){override="tag";return state.context.type;}else{return states.atBlock(type,stream,state);}};states.atBlock=function(type,stream,state){if(type=="(")return pushContext(state,stream,"atBlock_parens");if(type=="}"||type==";")return popAndPass(type,stream,state);if(type=="{")return popContext(state)&&pushContext(state,stream,allowNested?"block":"top");if(type=="interpolation")return pushContext(state,stream,"interpolation");if(type=="word"){var word=stream.current().toLowerCase();if(word=="only"||word=="not"||word=="and"||word=="or")
override="keyword";else if(mediaTypes.hasOwnProperty(word))
override="attribute";else if(mediaFeatures.hasOwnProperty(word))
override="property";else if(mediaValueKeywords.hasOwnProperty(word))
override="keyword";else if(propertyKeywords.hasOwnProperty(word))
override="property";else if(nonStandardPropertyKeywords.hasOwnProperty(word))
override="string-2";else if(valueKeywords.hasOwnProperty(word))
override="atom";else if(colorKeywords.hasOwnProperty(word))
override="keyword";else
override="error";}
return state.context.type;};states.atComponentBlock=function(type,stream,state){if(type=="}")
return popAndPass(type,stream,state);if(type=="{")
return popContext(state)&&pushContext(state,stream,allowNested?"block":"top",false);if(type=="word")
override="error";return state.context.type;};states.atBlock_parens=function(type,stream,state){if(type==")")return popContext(state);if(type=="{"||type=="}")return popAndPass(type,stream,state,2);return states.atBlock(type,stream,state);};states.restricted_atBlock_before=function(type,stream,state){if(type=="{")
return pushContext(state,stream,"restricted_atBlock");if(type=="word"&&state.stateArg=="@counter-style"){override="variable";return"restricted_atBlock_before";}
return pass(type,stream,state);};states.restricted_atBlock=function(type,stream,state){if(type=="}"){state.stateArg=null;return popContext(state);}
if(type=="word"){if((state.stateArg=="@font-face"&&!fontProperties.hasOwnProperty(stream.current().toLowerCase()))||(state.stateArg=="@counter-style"&&!counterDescriptors.hasOwnProperty(stream.current().toLowerCase())))
override="error";else
override="property";return"maybeprop";}
return"restricted_atBlock";};states.keyframes=function(type,stream,state){if(type=="word"){override="variable";return"keyframes";}
if(type=="{")return pushContext(state,stream,"top");return pass(type,stream,state);};states.at=function(type,stream,state){if(type==";")return popContext(state);if(type=="{"||type=="}")return popAndPass(type,stream,state);if(type=="word")override="tag";else if(type=="hash")override="builtin";return"at";};states.interpolation=function(type,stream,state){if(type=="}")return popContext(state);if(type=="{"||type==";")return popAndPass(type,stream,state);if(type=="word")override="variable";else if(type!="variable"&&type!="("&&type!=")")override="error";return"interpolation";};return{startState:function(base){return{tokenize:null,state:inline?"block":"top",stateArg:null,context:new Context(inline?"block":"top",base||0,null)};},token:function(stream,state){if(!state.tokenize&&stream.eatSpace())return null;var style=(state.tokenize||tokenBase)(stream,state);if(style&&typeof style=="object"){type=style[1];style=style[0];}
override=style;if(type!="comment")
state.state=states[state.state](type,stream,state);return override;},indent:function(state,textAfter){var cx=state.context,ch=textAfter&&textAfter.charAt(0);var indent=cx.indent;if(cx.type=="prop"&&(ch=="}"||ch==")"))cx=cx.prev;if(cx.prev){if(ch=="}"&&(cx.type=="block"||cx.type=="top"||cx.type=="interpolation"||cx.type=="restricted_atBlock")){cx=cx.prev;indent=cx.indent;}else if(ch==")"&&(cx.type=="parens"||cx.type=="atBlock_parens")||ch=="{"&&(cx.type=="at"||cx.type=="atBlock")){indent=Math.max(0,cx.indent-indentUnit);}}
return indent;},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",lineComment:lineComment,fold:"brace"};});function keySet(array){var keys={};for(var i=0;i<array.length;++i){keys[array[i].toLowerCase()]=true;}
return keys;}
var documentTypes_=["domain","regexp","url","url-prefix"],documentTypes=keySet(documentTypes_);var mediaTypes_=["all","aural","braille","handheld","print","projection","screen","tty","tv","embossed"],mediaTypes=keySet(mediaTypes_);var mediaFeatures_=["width","min-width","max-width","height","min-height","max-height","device-width","min-device-width","max-device-width","device-height","min-device-height","max-device-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","device-aspect-ratio","min-device-aspect-ratio","max-device-aspect-ratio","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","min-monochrome","max-monochrome","resolution","min-resolution","max-resolution","scan","grid","orientation","device-pixel-ratio","min-device-pixel-ratio","max-device-pixel-ratio","pointer","any-pointer","hover","any-hover"],mediaFeatures=keySet(mediaFeatures_);var mediaValueKeywords_=["landscape","portrait","none","coarse","fine","on-demand","hover","interlace","progressive"],mediaValueKeywords=keySet(mediaValueKeywords_);var propertyKeywords_=["align-content","align-items","align-self","alignment-adjust","alignment-baseline","anchor-point","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","float-offset","flow-from","flow-into","font","font-feature-settings","font-family","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-weight","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-gap","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-gap","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","justify-content","justify-items","justify-self","left","letter-spacing","line-break","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","mix-blend-mode","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","pitch","pitch-range","place-content","place-items","place-self","play-during","position","presentation-level","punctuation-trim","quotes","region-break-after","region-break-before","region-break-inside","region-fragment","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","shape-image-threshold","shape-inside","shape-margin","shape-outside","size","speak","speak-as","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-outline","text-overflow","text-shadow","text-size-adjust","text-space-collapse","text-transform","text-underline-position","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","user-select","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","z-index","clip-path","clip-rule","mask","enable-background","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","pointer-events","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","image-rendering","marker","marker-end","marker-mid","marker-start","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-rendering","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","text-anchor","writing-mode"],propertyKeywords=keySet(propertyKeywords_);var nonStandardPropertyKeywords_=["scrollbar-arrow-color","scrollbar-base-color","scrollbar-dark-shadow-color","scrollbar-face-color","scrollbar-highlight-color","scrollbar-shadow-color","scrollbar-3d-light-color","scrollbar-track-color","shape-inside","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","zoom"],nonStandardPropertyKeywords=keySet(nonStandardPropertyKeywords_);var fontProperties_=["font-family","src","unicode-range","font-variant","font-feature-settings","font-stretch","font-weight","font-style"],fontProperties=keySet(fontProperties_);var counterDescriptors_=["additive-symbols","fallback","negative","pad","prefix","range","speak-as","suffix","symbols","system"],counterDescriptors=keySet(counterDescriptors_);var colorKeywords_=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],colorKeywords=keySet(colorKeywords_);var valueKeywords_=["above","absolute","activeborder","additive","activecaption","afar","after-white-space","ahead","alias","all","all-scroll","alphabetic","alternate","always","amharic","amharic-abegede","antialiased","appworkspace","arabic-indic","armenian","asterisks","attr","auto","auto-flow","avoid","avoid-column","avoid-page","avoid-region","background","backwards","baseline","below","bidi-override","binary","bengali","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","bullets","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","calc","cambodian","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-decimal","cjk-earthly-branch","cjk-heavenly-stem","cjk-ideographic","clear","clip","close-quote","col-resize","collapse","color","color-burn","color-dodge","column","column-reverse","compact","condensed","contain","content","contents","content-box","context-menu","continuous","copy","counter","counters","cover","crop","cross","crosshair","currentcolor","cursive","cyclic","darken","dashed","decimal","decimal-leading-zero","default","default-button","dense","destination-atop","destination-in","destination-out","destination-over","devanagari","difference","disc","discard","disclosure-closed","disclosure-open","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic","ethiopic-abegede","ethiopic-abegede-am-et","ethiopic-abegede-gez","ethiopic-abegede-ti-er","ethiopic-abegede-ti-et","ethiopic-halehame-aa-er","ethiopic-halehame-aa-et","ethiopic-halehame-am-et","ethiopic-halehame-gez","ethiopic-halehame-om-et","ethiopic-halehame-sid-et","ethiopic-halehame-so-et","ethiopic-halehame-ti-er","ethiopic-halehame-ti-et","ethiopic-halehame-tig","ethiopic-numeric","ew-resize","exclusion","expanded","extends","extra-condensed","extra-expanded","fantasy","fast","fill","fixed","flat","flex","flex-end","flex-start","footnotes","forwards","from","geometricPrecision","georgian","graytext","grid","groove","gujarati","gurmukhi","hand","hangul","hangul-consonant","hard-light","hebrew","help","hidden","hide","higher","highlight","highlighttext","hiragana","hiragana-iroha","horizontal","hsl","hsla","hue","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-flex","inline-grid","inline-table","inset","inside","intrinsic","invert","italic","japanese-formal","japanese-informal","justify","kannada","katakana","katakana-iroha","keep-all","khmer","korean-hangul-formal","korean-hanja-formal","korean-hanja-informal","landscape","lao","large","larger","left","level","lighter","lighten","line-through","linear","linear-gradient","lines","linktext","list-item","listbox","listitem","local","logical","loud","lower","lower-alpha","lower-armenian","lower-greek","lower-hexadecimal","lower-latin","lower-norwegian","lower-roman","lowercase","ltr","luminosity","malayalam","match","matrix","matrix3d","media-controls-background","media-current-time-display","media-fullscreen-button","media-mute-button","media-play-button","media-return-to-realtime-button","media-rewind-button","media-seek-back-button","media-seek-forward-button","media-slider","media-sliderthumb","media-time-remaining-display","media-volume-slider","media-volume-slider-container","media-volume-sliderthumb","medium","menu","menulist","menulist-button","menulist-text","menulist-textfield","menutext","message-box","middle","min-intrinsic","mix","mongolian","monospace","move","multiple","multiply","myanmar","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","numbers","numeric","nw-resize","nwse-resize","oblique","octal","opacity","open-quote","optimizeLegibility","optimizeSpeed","oriya","oromo","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","persian","perspective","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radial-gradient","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeating-linear-gradient","repeating-radial-gradient","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","rotate","rotate3d","rotateX","rotateY","rotateZ","round","row","row-resize","row-reverse","rtl","run-in","running","s-resize","sans-serif","saturation","scale","scale3d","scaleX","scaleY","scaleZ","screen","scroll","scrollbar","scroll-position","se-resize","searchfield","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","self-start","self-end","semi-condensed","semi-expanded","separate","serif","show","sidama","simp-chinese-formal","simp-chinese-informal","single","skew","skewX","skewY","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","soft-light","solid","somali","source-atop","source-in","source-out","source-over","space","space-around","space-between","space-evenly","spell-out","square","square-button","start","static","status-bar","stretch","stroke","sub","subpixel-antialiased","super","sw-resize","symbolic","symbols","system-ui","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","tamil","telugu","text","text-bottom","text-top","textarea","textfield","thai","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","tibetan","tigre","tigrinya-er","tigrinya-er-abegede","tigrinya-et","tigrinya-et-abegede","to","top","trad-chinese-formal","trad-chinese-informal","transform","translate","translate3d","translateX","translateY","translateZ","transparent","ultra-condensed","ultra-expanded","underline","unset","up","upper-alpha","upper-armenian","upper-greek","upper-hexadecimal","upper-latin","upper-norwegian","upper-roman","uppercase","urdu","url","var","vertical","vertical-text","visible","visibleFill","visiblePainted","visibleStroke","visitedtext","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","words","wrap","wrap-reverse","x-large","x-small","xor","xx-large","xx-small"],valueKeywords=keySet(valueKeywords_);var allWords=documentTypes_.concat(mediaTypes_).concat(mediaFeatures_).concat(mediaValueKeywords_).concat(propertyKeywords_).concat(nonStandardPropertyKeywords_).concat(colorKeywords_).concat(valueKeywords_);CodeMirror.registerHelper("hintWords","css",allWords);function tokenCComment(stream,state){var maybeEnd=false,ch;while((ch=stream.next())!=null){if(maybeEnd&&ch=="/"){state.tokenize=null;break;}
maybeEnd=(ch=="*");}
return["comment","comment"];}
CodeMirror.defineMIME("text/css",{documentTypes:documentTypes,mediaTypes:mediaTypes,mediaFeatures:mediaFeatures,mediaValueKeywords:mediaValueKeywords,propertyKeywords:propertyKeywords,nonStandardPropertyKeywords:nonStandardPropertyKeywords,fontProperties:fontProperties,counterDescriptors:counterDescriptors,colorKeywords:colorKeywords,valueKeywords:valueKeywords,tokenHooks:{"/":function(stream,state){if(!stream.eat("*"))return false;state.tokenize=tokenCComment;return tokenCComment(stream,state);}},name:"css"});CodeMirror.defineMIME("text/x-scss",{mediaTypes:mediaTypes,mediaFeatures:mediaFeatures,mediaValueKeywords:mediaValueKeywords,propertyKeywords:propertyKeywords,nonStandardPropertyKeywords:nonStandardPropertyKeywords,colorKeywords:colorKeywords,valueKeywords:valueKeywords,fontProperties:fontProperties,allowNested:true,lineComment:"//",tokenHooks:{"/":function(stream,state){if(stream.eat("/")){stream.skipToEnd();return["comment","comment"];}else if(stream.eat("*")){state.tokenize=tokenCComment;return tokenCComment(stream,state);}else{return["operator","operator"];}},":":function(stream){if(stream.match(/\s*\{/,false))
return[null,null]
return false;},"$":function(stream){stream.match(/^[\w-]+/);if(stream.match(/^\s*:/,false))
return["variable-2","variable-definition"];return["variable-2","variable"];},"#":function(stream){if(!stream.eat("{"))return false;return[null,"interpolation"];}},name:"css",helperType:"scss"});CodeMirror.defineMIME("text/x-less",{mediaTypes:mediaTypes,mediaFeatures:mediaFeatures,mediaValueKeywords:mediaValueKeywords,propertyKeywords:propertyKeywords,nonStandardPropertyKeywords:nonStandardPropertyKeywords,colorKeywords:colorKeywords,valueKeywords:valueKeywords,fontProperties:fontProperties,allowNested:true,lineComment:"//",tokenHooks:{"/":function(stream,state){if(stream.eat("/")){stream.skipToEnd();return["comment","comment"];}else if(stream.eat("*")){state.tokenize=tokenCComment;return tokenCComment(stream,state);}else{return["operator","operator"];}},"@":function(stream){if(stream.eat("{"))return[null,"interpolation"];if(stream.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/i,false))return false;stream.eatWhile(/[\w\\\-]/);if(stream.match(/^\s*:/,false))
return["variable-2","variable-definition"];return["variable-2","variable"];},"&":function(){return["atom","atom"];}},name:"css",helperType:"less"});CodeMirror.defineMIME("text/x-gss",{documentTypes:documentTypes,mediaTypes:mediaTypes,mediaFeatures:mediaFeatures,propertyKeywords:propertyKeywords,nonStandardPropertyKeywords:nonStandardPropertyKeywords,fontProperties:fontProperties,counterDescriptors:counterDescriptors,colorKeywords:colorKeywords,valueKeywords:valueKeywords,supportsAtComponent:true,tokenHooks:{"/":function(stream,state){if(!stream.eat("*"))return false;state.tokenize=tokenCComment;return tokenCComment(stream,state);}},name:"css",helperType:"gss"});});;(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";CodeMirror.defineMode("javascript",function(config,parserConfig){var indentUnit=config.indentUnit;var statementIndent=parserConfig.statementIndent;var jsonldMode=parserConfig.jsonld;var jsonMode=parserConfig.json||jsonldMode;var isTS=parserConfig.typescript;var wordRE=parserConfig.wordCharacters||/[\w$\xa1-\uffff]/;var keywords=function(){function kw(type){return{type:type,style:"keyword"};}
var A=kw("keyword a"),B=kw("keyword b"),C=kw("keyword c"),D=kw("keyword d");var operator=kw("operator"),atom={type:"atom",style:"atom"};return{"if":kw("if"),"while":A,"with":A,"else":B,"do":B,"try":B,"finally":B,"return":D,"break":D,"continue":D,"new":kw("new"),"delete":C,"void":C,"throw":C,"debugger":kw("debugger"),"var":kw("var"),"const":kw("var"),"let":kw("var"),"function":kw("function"),"catch":kw("catch"),"for":kw("for"),"switch":kw("switch"),"case":kw("case"),"default":kw("default"),"in":operator,"typeof":operator,"instanceof":operator,"true":atom,"false":atom,"null":atom,"undefined":atom,"NaN":atom,"Infinity":atom,"this":kw("this"),"class":kw("class"),"super":kw("atom"),"yield":C,"export":kw("export"),"import":kw("import"),"extends":C,"await":C};}();var isOperatorChar=/[+\-*&%=<>!?|~^@]/;var isJsonldKeyword=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function readRegexp(stream){var escaped=false,next,inSet=false;while((next=stream.next())!=null){if(!escaped){if(next=="/"&&!inSet)return;if(next=="[")inSet=true;else if(inSet&&next=="]")inSet=false;}
escaped=!escaped&&next=="\\";}}
var type,content;function ret(tp,style,cont){type=tp;content=cont;return style;}
function tokenBase(stream,state){var ch=stream.next();if(ch=='"'||ch=="'"){state.tokenize=tokenString(ch);return state.tokenize(stream,state);}else if(ch=="."&&stream.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/)){return ret("number","number");}else if(ch=="."&&stream.match("..")){return ret("spread","meta");}else if(/[\[\]{}\(\),;\:\.]/.test(ch)){return ret(ch);}else if(ch=="="&&stream.eat(">")){return ret("=>","operator");}else if(ch=="0"&&stream.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/)){return ret("number","number");}else if(/\d/.test(ch)){stream.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/);return ret("number","number");}else if(ch=="/"){if(stream.eat("*")){state.tokenize=tokenComment;return tokenComment(stream,state);}else if(stream.eat("/")){stream.skipToEnd();return ret("comment","comment");}else if(expressionAllowed(stream,state,1)){readRegexp(stream);stream.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/);return ret("regexp","string-2");}else{stream.eat("=");return ret("operator","operator",stream.current());}}else if(ch=="`"){state.tokenize=tokenQuasi;return tokenQuasi(stream,state);}else if(ch=="#"){stream.skipToEnd();return ret("error","error");}else if(isOperatorChar.test(ch)){if(ch!=">"||!state.lexical||state.lexical.type!=">"){if(stream.eat("=")){if(ch=="!"||ch=="=")stream.eat("=")}else if(/[<>*+\-]/.test(ch)){stream.eat(ch)
if(ch==">")stream.eat(ch)}}
return ret("operator","operator",stream.current());}else if(wordRE.test(ch)){stream.eatWhile(wordRE);var word=stream.current()
if(state.lastType!="."){if(keywords.propertyIsEnumerable(word)){var kw=keywords[word]
return ret(kw.type,kw.style,word)}
if(word=="async"&&stream.match(/^(\s|\/\*.*?\*\/)*[\[\(\w]/,false))
return ret("async","keyword",word)}
return ret("variable","variable",word)}}
function tokenString(quote){return function(stream,state){var escaped=false,next;if(jsonldMode&&stream.peek()=="@"&&stream.match(isJsonldKeyword)){state.tokenize=tokenBase;return ret("jsonld-keyword","meta");}
while((next=stream.next())!=null){if(next==quote&&!escaped)break;escaped=!escaped&&next=="\\";}
if(!escaped)state.tokenize=tokenBase;return ret("string","string");};}
function tokenComment(stream,state){var maybeEnd=false,ch;while(ch=stream.next()){if(ch=="/"&&maybeEnd){state.tokenize=tokenBase;break;}
maybeEnd=(ch=="*");}
return ret("comment","comment");}
function tokenQuasi(stream,state){var escaped=false,next;while((next=stream.next())!=null){if(!escaped&&(next=="`"||next=="$"&&stream.eat("{"))){state.tokenize=tokenBase;break;}
escaped=!escaped&&next=="\\";}
return ret("quasi","string-2",stream.current());}
var brackets="([{}])";function findFatArrow(stream,state){if(state.fatArrowAt)state.fatArrowAt=null;var arrow=stream.string.indexOf("=>",stream.start);if(arrow<0)return;if(isTS){var m=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(stream.string.slice(stream.start,arrow))
if(m)arrow=m.index}
var depth=0,sawSomething=false;for(var pos=arrow-1;pos>=0;--pos){var ch=stream.string.charAt(pos);var bracket=brackets.indexOf(ch);if(bracket>=0&&bracket<3){if(!depth){++pos;break;}
if(--depth==0){if(ch=="(")sawSomething=true;break;}}else if(bracket>=3&&bracket<6){++depth;}else if(wordRE.test(ch)){sawSomething=true;}else if(/["'\/`]/.test(ch)){for(;;--pos){if(pos==0)return
var next=stream.string.charAt(pos-1)
if(next==ch&&stream.string.charAt(pos-2)!="\\"){pos--;break}}}else if(sawSomething&&!depth){++pos;break;}}
if(sawSomething&&!depth)state.fatArrowAt=pos;}
var atomicTypes={"atom":true,"number":true,"variable":true,"string":true,"regexp":true,"this":true,"jsonld-keyword":true};function JSLexical(indented,column,type,align,prev,info){this.indented=indented;this.column=column;this.type=type;this.prev=prev;this.info=info;if(align!=null)this.align=align;}
function inScope(state,varname){for(var v=state.localVars;v;v=v.next)
if(v.name==varname)return true;for(var cx=state.context;cx;cx=cx.prev){for(var v=cx.vars;v;v=v.next)
if(v.name==varname)return true;}}
function parseJS(state,style,type,content,stream){var cc=state.cc;cx.state=state;cx.stream=stream;cx.marked=null,cx.cc=cc;cx.style=style;if(!state.lexical.hasOwnProperty("align"))
state.lexical.align=true;while(true){var combinator=cc.length?cc.pop():jsonMode?expression:statement;if(combinator(type,content)){while(cc.length&&cc[cc.length-1].lex)
cc.pop()();if(cx.marked)return cx.marked;if(type=="variable"&&inScope(state,content))return"variable-2";return style;}}}
var cx={state:null,column:null,marked:null,cc:null};function pass(){for(var i=arguments.length-1;i>=0;i--)cx.cc.push(arguments[i]);}
function cont(){pass.apply(null,arguments);return true;}
function inList(name,list){for(var v=list;v;v=v.next)if(v.name==name)return true
return false;}
function register(varname){var state=cx.state;cx.marked="def";if(state.context){if(state.lexical.info=="var"&&state.context&&state.context.block){var newContext=registerVarScoped(varname,state.context)
if(newContext!=null){state.context=newContext
return}}else if(!inList(varname,state.localVars)){state.localVars=new Var(varname,state.localVars)
return}}
if(parserConfig.globalVars&&!inList(varname,state.globalVars))
state.globalVars=new Var(varname,state.globalVars)}
function registerVarScoped(varname,context){if(!context){return null}else if(context.block){var inner=registerVarScoped(varname,context.prev)
if(!inner)return null
if(inner==context.prev)return context
return new Context(inner,context.vars,true)}else if(inList(varname,context.vars)){return context}else{return new Context(context.prev,new Var(varname,context.vars),false)}}
function isModifier(name){return name=="public"||name=="private"||name=="protected"||name=="abstract"||name=="readonly"}
function Context(prev,vars,block){this.prev=prev;this.vars=vars;this.block=block}
function Var(name,next){this.name=name;this.next=next}
var defaultVars=new Var("this",new Var("arguments",null))
function pushcontext(){cx.state.context=new Context(cx.state.context,cx.state.localVars,false)
cx.state.localVars=defaultVars}
function pushblockcontext(){cx.state.context=new Context(cx.state.context,cx.state.localVars,true)
cx.state.localVars=null}
function popcontext(){cx.state.localVars=cx.state.context.vars
cx.state.context=cx.state.context.prev}
popcontext.lex=true
function pushlex(type,info){var result=function(){var state=cx.state,indent=state.indented;if(state.lexical.type=="stat")indent=state.lexical.indented;else for(var outer=state.lexical;outer&&outer.type==")"&&outer.align;outer=outer.prev)
indent=outer.indented;state.lexical=new JSLexical(indent,cx.stream.column(),type,null,state.lexical,info);};result.lex=true;return result;}
function poplex(){var state=cx.state;if(state.lexical.prev){if(state.lexical.type==")")
state.indented=state.lexical.indented;state.lexical=state.lexical.prev;}}
poplex.lex=true;function expect(wanted){function exp(type){if(type==wanted)return cont();else if(wanted==";"||type=="}"||type==")"||type=="]")return pass();else return cont(exp);};return exp;}
function statement(type,value){if(type=="var")return cont(pushlex("vardef",value),vardef,expect(";"),poplex);if(type=="keyword a")return cont(pushlex("form"),parenExpr,statement,poplex);if(type=="keyword b")return cont(pushlex("form"),statement,poplex);if(type=="keyword d")return cx.stream.match(/^\s*$/,false)?cont():cont(pushlex("stat"),maybeexpression,expect(";"),poplex);if(type=="debugger")return cont(expect(";"));if(type=="{")return cont(pushlex("}"),pushblockcontext,block,poplex,popcontext);if(type==";")return cont();if(type=="if"){if(cx.state.lexical.info=="else"&&cx.state.cc[cx.state.cc.length-1]==poplex)
cx.state.cc.pop()();return cont(pushlex("form"),parenExpr,statement,poplex,maybeelse);}
if(type=="function")return cont(functiondef);if(type=="for")return cont(pushlex("form"),forspec,statement,poplex);if(type=="class"||(isTS&&value=="interface")){cx.marked="keyword"
return cont(pushlex("form",type=="class"?type:value),className,poplex)}
if(type=="variable"){if(isTS&&value=="declare"){cx.marked="keyword"
return cont(statement)}else if(isTS&&(value=="module"||value=="enum"||value=="type")&&cx.stream.match(/^\s*\w/,false)){cx.marked="keyword"
if(value=="enum")return cont(enumdef);else if(value=="type")return cont(typename,expect("operator"),typeexpr,expect(";"));else return cont(pushlex("form"),pattern,expect("{"),pushlex("}"),block,poplex,poplex)}else if(isTS&&value=="namespace"){cx.marked="keyword"
return cont(pushlex("form"),expression,statement,poplex)}else if(isTS&&value=="abstract"){cx.marked="keyword"
return cont(statement)}else{return cont(pushlex("stat"),maybelabel);}}
if(type=="switch")return cont(pushlex("form"),parenExpr,expect("{"),pushlex("}","switch"),pushblockcontext,block,poplex,poplex,popcontext);if(type=="case")return cont(expression,expect(":"));if(type=="default")return cont(expect(":"));if(type=="catch")return cont(pushlex("form"),pushcontext,maybeCatchBinding,statement,poplex,popcontext);if(type=="export")return cont(pushlex("stat"),afterExport,poplex);if(type=="import")return cont(pushlex("stat"),afterImport,poplex);if(type=="async")return cont(statement)
if(value=="@")return cont(expression,statement)
return pass(pushlex("stat"),expression,expect(";"),poplex);}
function maybeCatchBinding(type){if(type=="(")return cont(funarg,expect(")"))}
function expression(type,value){return expressionInner(type,value,false);}
function expressionNoComma(type,value){return expressionInner(type,value,true);}
function parenExpr(type){if(type!="(")return pass()
return cont(pushlex(")"),expression,expect(")"),poplex)}
function expressionInner(type,value,noComma){if(cx.state.fatArrowAt==cx.stream.start){var body=noComma?arrowBodyNoComma:arrowBody;if(type=="(")return cont(pushcontext,pushlex(")"),commasep(funarg,")"),poplex,expect("=>"),body,popcontext);else if(type=="variable")return pass(pushcontext,pattern,expect("=>"),body,popcontext);}
var maybeop=noComma?maybeoperatorNoComma:maybeoperatorComma;if(atomicTypes.hasOwnProperty(type))return cont(maybeop);if(type=="function")return cont(functiondef,maybeop);if(type=="class"||(isTS&&value=="interface")){cx.marked="keyword";return cont(pushlex("form"),classExpression,poplex);}
if(type=="keyword c"||type=="async")return cont(noComma?expressionNoComma:expression);if(type=="(")return cont(pushlex(")"),maybeexpression,expect(")"),poplex,maybeop);if(type=="operator"||type=="spread")return cont(noComma?expressionNoComma:expression);if(type=="[")return cont(pushlex("]"),arrayLiteral,poplex,maybeop);if(type=="{")return contCommasep(objprop,"}",null,maybeop);if(type=="quasi")return pass(quasi,maybeop);if(type=="new")return cont(maybeTarget(noComma));if(type=="import")return cont(expression);return cont();}
function maybeexpression(type){if(type.match(/[;\}\)\],]/))return pass();return pass(expression);}
function maybeoperatorComma(type,value){if(type==",")return cont(expression);return maybeoperatorNoComma(type,value,false);}
function maybeoperatorNoComma(type,value,noComma){var me=noComma==false?maybeoperatorComma:maybeoperatorNoComma;var expr=noComma==false?expression:expressionNoComma;if(type=="=>")return cont(pushcontext,noComma?arrowBodyNoComma:arrowBody,popcontext);if(type=="operator"){if(/\+\+|--/.test(value)||isTS&&value=="!")return cont(me);if(isTS&&value=="<"&&cx.stream.match(/^([^>]|<.*?>)*>\s*\(/,false))
return cont(pushlex(">"),commasep(typeexpr,">"),poplex,me);if(value=="?")return cont(expression,expect(":"),expr);return cont(expr);}
if(type=="quasi"){return pass(quasi,me);}
if(type==";")return;if(type=="(")return contCommasep(expressionNoComma,")","call",me);if(type==".")return cont(property,me);if(type=="[")return cont(pushlex("]"),maybeexpression,expect("]"),poplex,me);if(isTS&&value=="as"){cx.marked="keyword";return cont(typeexpr,me)}
if(type=="regexp"){cx.state.lastType=cx.marked="operator"
cx.stream.backUp(cx.stream.pos-cx.stream.start-1)
return cont(expr)}}
function quasi(type,value){if(type!="quasi")return pass();if(value.slice(value.length-2)!="${")return cont(quasi);return cont(expression,continueQuasi);}
function continueQuasi(type){if(type=="}"){cx.marked="string-2";cx.state.tokenize=tokenQuasi;return cont(quasi);}}
function arrowBody(type){findFatArrow(cx.stream,cx.state);return pass(type=="{"?statement:expression);}
function arrowBodyNoComma(type){findFatArrow(cx.stream,cx.state);return pass(type=="{"?statement:expressionNoComma);}
function maybeTarget(noComma){return function(type){if(type==".")return cont(noComma?targetNoComma:target);else if(type=="variable"&&isTS)return cont(maybeTypeArgs,noComma?maybeoperatorNoComma:maybeoperatorComma)
else return pass(noComma?expressionNoComma:expression);};}
function target(_,value){if(value=="target"){cx.marked="keyword";return cont(maybeoperatorComma);}}
function targetNoComma(_,value){if(value=="target"){cx.marked="keyword";return cont(maybeoperatorNoComma);}}
function maybelabel(type){if(type==":")return cont(poplex,statement);return pass(maybeoperatorComma,expect(";"),poplex);}
function property(type){if(type=="variable"){cx.marked="property";return cont();}}
function objprop(type,value){if(type=="async"){cx.marked="property";return cont(objprop);}else if(type=="variable"||cx.style=="keyword"){cx.marked="property";if(value=="get"||value=="set")return cont(getterSetter);var m
if(isTS&&cx.state.fatArrowAt==cx.stream.start&&(m=cx.stream.match(/^\s*:\s*/,false)))
cx.state.fatArrowAt=cx.stream.pos+m[0].length
return cont(afterprop);}else if(type=="number"||type=="string"){cx.marked=jsonldMode?"property":(cx.style+" property");return cont(afterprop);}else if(type=="jsonld-keyword"){return cont(afterprop);}else if(isTS&&isModifier(value)){cx.marked="keyword"
return cont(objprop)}else if(type=="["){return cont(expression,maybetype,expect("]"),afterprop);}else if(type=="spread"){return cont(expressionNoComma,afterprop);}else if(value=="*"){cx.marked="keyword";return cont(objprop);}else if(type==":"){return pass(afterprop)}}
function getterSetter(type){if(type!="variable")return pass(afterprop);cx.marked="property";return cont(functiondef);}
function afterprop(type){if(type==":")return cont(expressionNoComma);if(type=="(")return pass(functiondef);}
function commasep(what,end,sep){function proceed(type,value){if(sep?sep.indexOf(type)>-1:type==","){var lex=cx.state.lexical;if(lex.info=="call")lex.pos=(lex.pos||0)+1;return cont(function(type,value){if(type==end||value==end)return pass()
return pass(what)},proceed);}
if(type==end||value==end)return cont();if(sep&&sep.indexOf(";")>-1)return pass(what)
return cont(expect(end));}
return function(type,value){if(type==end||value==end)return cont();return pass(what,proceed);};}
function contCommasep(what,end,info){for(var i=3;i<arguments.length;i++)
cx.cc.push(arguments[i]);return cont(pushlex(end,info),commasep(what,end),poplex);}
function block(type){if(type=="}")return cont();return pass(statement,block);}
function maybetype(type,value){if(isTS){if(type==":")return cont(typeexpr);if(value=="?")return cont(maybetype);}}
function maybetypeOrIn(type,value){if(isTS&&(type==":"||value=="in"))return cont(typeexpr)}
function mayberettype(type){if(isTS&&type==":"){if(cx.stream.match(/^\s*\w+\s+is\b/,false))return cont(expression,isKW,typeexpr)
else return cont(typeexpr)}}
function isKW(_,value){if(value=="is"){cx.marked="keyword"
return cont()}}
function typeexpr(type,value){if(value=="keyof"||value=="typeof"||value=="infer"){cx.marked="keyword"
return cont(value=="typeof"?expressionNoComma:typeexpr)}
if(type=="variable"||value=="void"){cx.marked="type"
return cont(afterType)}
if(value=="|"||value=="&")return cont(typeexpr)
if(type=="string"||type=="number"||type=="atom")return cont(afterType);if(type=="[")return cont(pushlex("]"),commasep(typeexpr,"]",","),poplex,afterType)
if(type=="{")return cont(pushlex("}"),commasep(typeprop,"}",",;"),poplex,afterType)
if(type=="(")return cont(commasep(typearg,")"),maybeReturnType,afterType)
if(type=="<")return cont(commasep(typeexpr,">"),typeexpr)}
function maybeReturnType(type){if(type=="=>")return cont(typeexpr)}
function typeprop(type,value){if(type=="variable"||cx.style=="keyword"){cx.marked="property"
return cont(typeprop)}else if(value=="?"||type=="number"||type=="string"){return cont(typeprop)}else if(type==":"){return cont(typeexpr)}else if(type=="["){return cont(expect("variable"),maybetypeOrIn,expect("]"),typeprop)}else if(type=="("){return pass(functiondecl,typeprop)}}
function typearg(type,value){if(type=="variable"&&cx.stream.match(/^\s*[?:]/,false)||value=="?")return cont(typearg)
if(type==":")return cont(typeexpr)
if(type=="spread")return cont(typearg)
return pass(typeexpr)}
function afterType(type,value){if(value=="<")return cont(pushlex(">"),commasep(typeexpr,">"),poplex,afterType)
if(value=="|"||type=="."||value=="&")return cont(typeexpr)
if(type=="[")return cont(typeexpr,expect("]"),afterType)
if(value=="extends"||value=="implements"){cx.marked="keyword";return cont(typeexpr)}
if(value=="?")return cont(typeexpr,expect(":"),typeexpr)}
function maybeTypeArgs(_,value){if(value=="<")return cont(pushlex(">"),commasep(typeexpr,">"),poplex,afterType)}
function typeparam(){return pass(typeexpr,maybeTypeDefault)}
function maybeTypeDefault(_,value){if(value=="=")return cont(typeexpr)}
function vardef(_,value){if(value=="enum"){cx.marked="keyword";return cont(enumdef)}
return pass(pattern,maybetype,maybeAssign,vardefCont);}
function pattern(type,value){if(isTS&&isModifier(value)){cx.marked="keyword";return cont(pattern)}
if(type=="variable"){register(value);return cont();}
if(type=="spread")return cont(pattern);if(type=="[")return contCommasep(eltpattern,"]");if(type=="{")return contCommasep(proppattern,"}");}
function proppattern(type,value){if(type=="variable"&&!cx.stream.match(/^\s*:/,false)){register(value);return cont(maybeAssign);}
if(type=="variable")cx.marked="property";if(type=="spread")return cont(pattern);if(type=="}")return pass();if(type=="[")return cont(expression,expect(']'),expect(':'),proppattern);return cont(expect(":"),pattern,maybeAssign);}
function eltpattern(){return pass(pattern,maybeAssign)}
function maybeAssign(_type,value){if(value=="=")return cont(expressionNoComma);}
function vardefCont(type){if(type==",")return cont(vardef);}
function maybeelse(type,value){if(type=="keyword b"&&value=="else")return cont(pushlex("form","else"),statement,poplex);}
function forspec(type,value){if(value=="await")return cont(forspec);if(type=="(")return cont(pushlex(")"),forspec1,poplex);}
function forspec1(type){if(type=="var")return cont(vardef,forspec2);if(type=="variable")return cont(forspec2);return pass(forspec2)}
function forspec2(type,value){if(type==")")return cont()
if(type==";")return cont(forspec2)
if(value=="in"||value=="of"){cx.marked="keyword";return cont(expression,forspec2)}
return pass(expression,forspec2)}
function functiondef(type,value){if(value=="*"){cx.marked="keyword";return cont(functiondef);}
if(type=="variable"){register(value);return cont(functiondef);}
if(type=="(")return cont(pushcontext,pushlex(")"),commasep(funarg,")"),poplex,mayberettype,statement,popcontext);if(isTS&&value=="<")return cont(pushlex(">"),commasep(typeparam,">"),poplex,functiondef)}
function functiondecl(type,value){if(value=="*"){cx.marked="keyword";return cont(functiondecl);}
if(type=="variable"){register(value);return cont(functiondecl);}
if(type=="(")return cont(pushcontext,pushlex(")"),commasep(funarg,")"),poplex,mayberettype,popcontext);if(isTS&&value=="<")return cont(pushlex(">"),commasep(typeparam,">"),poplex,functiondecl)}
function typename(type,value){if(type=="keyword"||type=="variable"){cx.marked="type"
return cont(typename)}else if(value=="<"){return cont(pushlex(">"),commasep(typeparam,">"),poplex)}}
function funarg(type,value){if(value=="@")cont(expression,funarg)
if(type=="spread")return cont(funarg);if(isTS&&isModifier(value)){cx.marked="keyword";return cont(funarg);}
if(isTS&&type=="this")return cont(maybetype,maybeAssign)
return pass(pattern,maybetype,maybeAssign);}
function classExpression(type,value){if(type=="variable")return className(type,value);return classNameAfter(type,value);}
function className(type,value){if(type=="variable"){register(value);return cont(classNameAfter);}}
function classNameAfter(type,value){if(value=="<")return cont(pushlex(">"),commasep(typeparam,">"),poplex,classNameAfter)
if(value=="extends"||value=="implements"||(isTS&&type==",")){if(value=="implements")cx.marked="keyword";return cont(isTS?typeexpr:expression,classNameAfter);}
if(type=="{")return cont(pushlex("}"),classBody,poplex);}
function classBody(type,value){if(type=="async"||(type=="variable"&&(value=="static"||value=="get"||value=="set"||(isTS&&isModifier(value)))&&cx.stream.match(/^\s+[\w$\xa1-\uffff]/,false))){cx.marked="keyword";return cont(classBody);}
if(type=="variable"||cx.style=="keyword"){cx.marked="property";return cont(isTS?classfield:functiondef,classBody);}
if(type=="number"||type=="string")return cont(isTS?classfield:functiondef,classBody);if(type=="[")
return cont(expression,maybetype,expect("]"),isTS?classfield:functiondef,classBody)
if(value=="*"){cx.marked="keyword";return cont(classBody);}
if(isTS&&type=="(")return pass(functiondecl,classBody)
if(type==";"||type==",")return cont(classBody);if(type=="}")return cont();if(value=="@")return cont(expression,classBody)}
function classfield(type,value){if(value=="?")return cont(classfield)
if(type==":")return cont(typeexpr,maybeAssign)
if(value=="=")return cont(expressionNoComma)
var context=cx.state.lexical.prev,isInterface=context&&context.info=="interface"
return pass(isInterface?functiondecl:functiondef)}
function afterExport(type,value){if(value=="*"){cx.marked="keyword";return cont(maybeFrom,expect(";"));}
if(value=="default"){cx.marked="keyword";return cont(expression,expect(";"));}
if(type=="{")return cont(commasep(exportField,"}"),maybeFrom,expect(";"));return pass(statement);}
function exportField(type,value){if(value=="as"){cx.marked="keyword";return cont(expect("variable"));}
if(type=="variable")return pass(expressionNoComma,exportField);}
function afterImport(type){if(type=="string")return cont();if(type=="(")return pass(expression);return pass(importSpec,maybeMoreImports,maybeFrom);}
function importSpec(type,value){if(type=="{")return contCommasep(importSpec,"}");if(type=="variable")register(value);if(value=="*")cx.marked="keyword";return cont(maybeAs);}
function maybeMoreImports(type){if(type==",")return cont(importSpec,maybeMoreImports)}
function maybeAs(_type,value){if(value=="as"){cx.marked="keyword";return cont(importSpec);}}
function maybeFrom(_type,value){if(value=="from"){cx.marked="keyword";return cont(expression);}}
function arrayLiteral(type){if(type=="]")return cont();return pass(commasep(expressionNoComma,"]"));}
function enumdef(){return pass(pushlex("form"),pattern,expect("{"),pushlex("}"),commasep(enummember,"}"),poplex,poplex)}
function enummember(){return pass(pattern,maybeAssign);}
function isContinuedStatement(state,textAfter){return state.lastType=="operator"||state.lastType==","||isOperatorChar.test(textAfter.charAt(0))||/[,.]/.test(textAfter.charAt(0));}
function expressionAllowed(stream,state,backUp){return state.tokenize==tokenBase&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(state.lastType)||(state.lastType=="quasi"&&/\{\s*$/.test(stream.string.slice(0,stream.pos-(backUp||0))))}
return{startState:function(basecolumn){var state={tokenize:tokenBase,lastType:"sof",cc:[],lexical:new JSLexical((basecolumn||0)-indentUnit,0,"block",false),localVars:parserConfig.localVars,context:parserConfig.localVars&&new Context(null,null,false),indented:basecolumn||0};if(parserConfig.globalVars&&typeof parserConfig.globalVars=="object")
state.globalVars=parserConfig.globalVars;return state;},token:function(stream,state){if(stream.sol()){if(!state.lexical.hasOwnProperty("align"))
state.lexical.align=false;state.indented=stream.indentation();findFatArrow(stream,state);}
if(state.tokenize!=tokenComment&&stream.eatSpace())return null;var style=state.tokenize(stream,state);if(type=="comment")return style;state.lastType=type=="operator"&&(content=="++"||content=="--")?"incdec":type;return parseJS(state,style,type,content,stream);},indent:function(state,textAfter){if(state.tokenize==tokenComment)return CodeMirror.Pass;if(state.tokenize!=tokenBase)return 0;var firstChar=textAfter&&textAfter.charAt(0),lexical=state.lexical,top
if(!/^\s*else\b/.test(textAfter))for(var i=state.cc.length-1;i>=0;--i){var c=state.cc[i];if(c==poplex)lexical=lexical.prev;else if(c!=maybeelse)break;}
while((lexical.type=="stat"||lexical.type=="form")&&(firstChar=="}"||((top=state.cc[state.cc.length-1])&&(top==maybeoperatorComma||top==maybeoperatorNoComma)&&!/^[,\.=+\-*:?[\(]/.test(textAfter))))
lexical=lexical.prev;if(statementIndent&&lexical.type==")"&&lexical.prev.type=="stat")
lexical=lexical.prev;var type=lexical.type,closing=firstChar==type;if(type=="vardef")return lexical.indented+(state.lastType=="operator"||state.lastType==","?lexical.info.length+1:0);else if(type=="form"&&firstChar=="{")return lexical.indented;else if(type=="form")return lexical.indented+indentUnit;else if(type=="stat")
return lexical.indented+(isContinuedStatement(state,textAfter)?statementIndent||indentUnit:0);else if(lexical.info=="switch"&&!closing&&parserConfig.doubleIndentSwitch!=false)
return lexical.indented+(/^(?:case|default)\b/.test(textAfter)?indentUnit:2*indentUnit);else if(lexical.align)return lexical.column+(closing?0:1);else return lexical.indented+(closing?0:indentUnit);},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:jsonMode?null:"/*",blockCommentEnd:jsonMode?null:"*/",blockCommentContinue:jsonMode?null:" * ",lineComment:jsonMode?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:jsonMode?"json":"javascript",jsonldMode:jsonldMode,jsonMode:jsonMode,expressionAllowed:expressionAllowed,skipExpression:function(state){var top=state.cc[state.cc.length-1]
if(top==expression||top==expressionNoComma)state.cc.pop()}};});CodeMirror.registerHelper("wordChars","javascript",/[\w$]/);CodeMirror.defineMIME("text/javascript","javascript");CodeMirror.defineMIME("text/ecmascript","javascript");CodeMirror.defineMIME("application/javascript","javascript");CodeMirror.defineMIME("application/x-javascript","javascript");CodeMirror.defineMIME("application/ecmascript","javascript");CodeMirror.defineMIME("application/json",{name:"javascript",json:true});CodeMirror.defineMIME("application/x-json",{name:"javascript",json:true});CodeMirror.defineMIME("application/ld+json",{name:"javascript",jsonld:true});CodeMirror.defineMIME("text/typescript",{name:"javascript",typescript:true});CodeMirror.defineMIME("application/typescript",{name:"javascript",typescript:true});});;(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";var htmlConfig={autoSelfClosers:{'area':true,'base':true,'br':true,'col':true,'command':true,'embed':true,'frame':true,'hr':true,'img':true,'input':true,'keygen':true,'link':true,'meta':true,'param':true,'source':true,'track':true,'wbr':true,'menuitem':true},implicitlyClosed:{'dd':true,'li':true,'optgroup':true,'option':true,'p':true,'rp':true,'rt':true,'tbody':true,'td':true,'tfoot':true,'th':true,'tr':true},contextGrabbers:{'dd':{'dd':true,'dt':true},'dt':{'dd':true,'dt':true},'li':{'li':true},'option':{'option':true,'optgroup':true},'optgroup':{'optgroup':true},'p':{'address':true,'article':true,'aside':true,'blockquote':true,'dir':true,'div':true,'dl':true,'fieldset':true,'footer':true,'form':true,'h1':true,'h2':true,'h3':true,'h4':true,'h5':true,'h6':true,'header':true,'hgroup':true,'hr':true,'menu':true,'nav':true,'ol':true,'p':true,'pre':true,'section':true,'table':true,'ul':true},'rp':{'rp':true,'rt':true},'rt':{'rp':true,'rt':true},'tbody':{'tbody':true,'tfoot':true},'td':{'td':true,'th':true},'tfoot':{'tbody':true},'th':{'td':true,'th':true},'thead':{'tbody':true,'tfoot':true},'tr':{'tr':true}},doNotIndent:{"pre":true},allowUnquoted:true,allowMissing:true,caseFold:true}
var xmlConfig={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:false,allowMissing:false,allowMissingTagName:false,caseFold:false}
CodeMirror.defineMode("xml",function(editorConf,config_){var indentUnit=editorConf.indentUnit
var config={}
var defaults=config_.htmlMode?htmlConfig:xmlConfig
for(var prop in defaults)config[prop]=defaults[prop]
for(var prop in config_)config[prop]=config_[prop]
var type,setStyle;function inText(stream,state){function chain(parser){state.tokenize=parser;return parser(stream,state);}
var ch=stream.next();if(ch=="<"){if(stream.eat("!")){if(stream.eat("[")){if(stream.match("CDATA["))return chain(inBlock("atom","]]>"));else return null;}else if(stream.match("--")){return chain(inBlock("comment","-->"));}else if(stream.match("DOCTYPE",true,true)){stream.eatWhile(/[\w\._\-]/);return chain(doctype(1));}else{return null;}}else if(stream.eat("?")){stream.eatWhile(/[\w\._\-]/);state.tokenize=inBlock("meta","?>");return"meta";}else{type=stream.eat("/")?"closeTag":"openTag";state.tokenize=inTag;return"tag bracket";}}else if(ch=="&"){var ok;if(stream.eat("#")){if(stream.eat("x")){ok=stream.eatWhile(/[a-fA-F\d]/)&&stream.eat(";");}else{ok=stream.eatWhile(/[\d]/)&&stream.eat(";");}}else{ok=stream.eatWhile(/[\w\.\-:]/)&&stream.eat(";");}
return ok?"atom":"error";}else{stream.eatWhile(/[^&<]/);return null;}}
inText.isInText=true;function inTag(stream,state){var ch=stream.next();if(ch==">"||(ch=="/"&&stream.eat(">"))){state.tokenize=inText;type=ch==">"?"endTag":"selfcloseTag";return"tag bracket";}else if(ch=="="){type="equals";return null;}else if(ch=="<"){state.tokenize=inText;state.state=baseState;state.tagName=state.tagStart=null;var next=state.tokenize(stream,state);return next?next+" tag error":"tag error";}else if(/[\'\"]/.test(ch)){state.tokenize=inAttribute(ch);state.stringStartCol=stream.column();return state.tokenize(stream,state);}else{stream.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/);return"word";}}
function inAttribute(quote){var closure=function(stream,state){while(!stream.eol()){if(stream.next()==quote){state.tokenize=inTag;break;}}
return"string";};closure.isInAttribute=true;return closure;}
function inBlock(style,terminator){return function(stream,state){while(!stream.eol()){if(stream.match(terminator)){state.tokenize=inText;break;}
stream.next();}
return style;}}
function doctype(depth){return function(stream,state){var ch;while((ch=stream.next())!=null){if(ch=="<"){state.tokenize=doctype(depth+1);return state.tokenize(stream,state);}else if(ch==">"){if(depth==1){state.tokenize=inText;break;}else{state.tokenize=doctype(depth-1);return state.tokenize(stream,state);}}}
return"meta";};}
function Context(state,tagName,startOfLine){this.prev=state.context;this.tagName=tagName;this.indent=state.indented;this.startOfLine=startOfLine;if(config.doNotIndent.hasOwnProperty(tagName)||(state.context&&state.context.noIndent))
this.noIndent=true;}
function popContext(state){if(state.context)state.context=state.context.prev;}
function maybePopContext(state,nextTagName){var parentTagName;while(true){if(!state.context){return;}
parentTagName=state.context.tagName;if(!config.contextGrabbers.hasOwnProperty(parentTagName)||!config.contextGrabbers[parentTagName].hasOwnProperty(nextTagName)){return;}
popContext(state);}}
function baseState(type,stream,state){if(type=="openTag"){state.tagStart=stream.column();return tagNameState;}else if(type=="closeTag"){return closeTagNameState;}else{return baseState;}}
function tagNameState(type,stream,state){if(type=="word"){state.tagName=stream.current();setStyle="tag";return attrState;}else if(config.allowMissingTagName&&type=="endTag"){setStyle="tag bracket";return attrState(type,stream,state);}else{setStyle="error";return tagNameState;}}
function closeTagNameState(type,stream,state){if(type=="word"){var tagName=stream.current();if(state.context&&state.context.tagName!=tagName&&config.implicitlyClosed.hasOwnProperty(state.context.tagName))
popContext(state);if((state.context&&state.context.tagName==tagName)||config.matchClosing===false){setStyle="tag";return closeState;}else{setStyle="tag error";return closeStateErr;}}else if(config.allowMissingTagName&&type=="endTag"){setStyle="tag bracket";return closeState(type,stream,state);}else{setStyle="error";return closeStateErr;}}
function closeState(type,_stream,state){if(type!="endTag"){setStyle="error";return closeState;}
popContext(state);return baseState;}
function closeStateErr(type,stream,state){setStyle="error";return closeState(type,stream,state);}
function attrState(type,_stream,state){if(type=="word"){setStyle="attribute";return attrEqState;}else if(type=="endTag"||type=="selfcloseTag"){var tagName=state.tagName,tagStart=state.tagStart;state.tagName=state.tagStart=null;if(type=="selfcloseTag"||config.autoSelfClosers.hasOwnProperty(tagName)){maybePopContext(state,tagName);}else{maybePopContext(state,tagName);state.context=new Context(state,tagName,tagStart==state.indented);}
return baseState;}
setStyle="error";return attrState;}
function attrEqState(type,stream,state){if(type=="equals")return attrValueState;if(!config.allowMissing)setStyle="error";return attrState(type,stream,state);}
function attrValueState(type,stream,state){if(type=="string")return attrContinuedState;if(type=="word"&&config.allowUnquoted){setStyle="string";return attrState;}
setStyle="error";return attrState(type,stream,state);}
function attrContinuedState(type,stream,state){if(type=="string")return attrContinuedState;return attrState(type,stream,state);}
return{startState:function(baseIndent){var state={tokenize:inText,state:baseState,indented:baseIndent||0,tagName:null,tagStart:null,context:null}
if(baseIndent!=null)state.baseIndent=baseIndent
return state},token:function(stream,state){if(!state.tagName&&stream.sol())
state.indented=stream.indentation();if(stream.eatSpace())return null;type=null;var style=state.tokenize(stream,state);if((style||type)&&style!="comment"){setStyle=null;state.state=state.state(type||style,stream,state);if(setStyle)
style=setStyle=="error"?style+" error":setStyle;}
return style;},indent:function(state,textAfter,fullLine){var context=state.context;if(state.tokenize.isInAttribute){if(state.tagStart==state.indented)
return state.stringStartCol+1;else
return state.indented+indentUnit;}
if(context&&context.noIndent)return CodeMirror.Pass;if(state.tokenize!=inTag&&state.tokenize!=inText)
return fullLine?fullLine.match(/^(\s*)/)[0].length:0;if(state.tagName){if(config.multilineTagIndentPastTag!==false)
return state.tagStart+state.tagName.length+2;else
return state.tagStart+indentUnit*(config.multilineTagIndentFactor||1);}
if(config.alignCDATA&&/<!\[CDATA\[/.test(textAfter))return 0;var tagAfter=textAfter&&/^<(\/)?([\w_:\.-]*)/.exec(textAfter);if(tagAfter&&tagAfter[1]){while(context){if(context.tagName==tagAfter[2]){context=context.prev;break;}else if(config.implicitlyClosed.hasOwnProperty(context.tagName)){context=context.prev;}else{break;}}}else if(tagAfter){while(context){var grabbers=config.contextGrabbers[context.tagName];if(grabbers&&grabbers.hasOwnProperty(tagAfter[2]))
context=context.prev;else
break;}}
while(context&&context.prev&&!context.startOfLine)
context=context.prev;if(context)return context.indent+indentUnit;else return state.baseIndent||0;},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:config.htmlMode?"html":"xml",helperType:config.htmlMode?"html":"xml",skipAttribute:function(state){if(state.state==attrValueState)
state.state=attrState}};});CodeMirror.defineMIME("text/xml","xml");CodeMirror.defineMIME("application/xml","xml");if(!CodeMirror.mimeModes.hasOwnProperty("text/html"))
CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:true});});;(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";var defaultTags={script:[["lang",/(javascript|babel)/i,"javascript"],["type",/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i,"javascript"],["type",/./,"text/plain"],[null,null,"javascript"]],style:[["lang",/^css$/i,"css"],["type",/^(text\/)?(x-)?(stylesheet|css)$/i,"css"],["type",/./,"text/plain"],[null,null,"css"]]};function maybeBackup(stream,pat,style){var cur=stream.current(),close=cur.search(pat);if(close>-1){stream.backUp(cur.length-close);}else if(cur.match(/<\/?$/)){stream.backUp(cur.length);if(!stream.match(pat,false))stream.match(cur);}
return style;}
var attrRegexpCache={};function getAttrRegexp(attr){var regexp=attrRegexpCache[attr];if(regexp)return regexp;return attrRegexpCache[attr]=new RegExp("\\s+"+attr+"\\s*=\\s*('|\")?([^'\"]+)('|\")?\\s*");}
function getAttrValue(text,attr){var match=text.match(getAttrRegexp(attr))
return match?/^\s*(.*?)\s*$/.exec(match[2])[1]:""}
function getTagRegexp(tagName,anchored){return new RegExp((anchored?"^":"")+"<\/\s*"+tagName+"\s*>","i");}
function addTags(from,to){for(var tag in from){var dest=to[tag]||(to[tag]=[]);var source=from[tag];for(var i=source.length-1;i>=0;i--)
dest.unshift(source[i])}}
function findMatchingMode(tagInfo,tagText){for(var i=0;i<tagInfo.length;i++){var spec=tagInfo[i];if(!spec[0]||spec[1].test(getAttrValue(tagText,spec[0])))return spec[2];}}
CodeMirror.defineMode("htmlmixed",function(config,parserConfig){var htmlMode=CodeMirror.getMode(config,{name:"xml",htmlMode:true,multilineTagIndentFactor:parserConfig.multilineTagIndentFactor,multilineTagIndentPastTag:parserConfig.multilineTagIndentPastTag});var tags={};var configTags=parserConfig&&parserConfig.tags,configScript=parserConfig&&parserConfig.scriptTypes;addTags(defaultTags,tags);if(configTags)addTags(configTags,tags);if(configScript)for(var i=configScript.length-1;i>=0;i--)
tags.script.unshift(["type",configScript[i].matches,configScript[i].mode])
function html(stream,state){var style=htmlMode.token(stream,state.htmlState),tag=/\btag\b/.test(style),tagName
if(tag&&!/[<>\s\/]/.test(stream.current())&&(tagName=state.htmlState.tagName&&state.htmlState.tagName.toLowerCase())&&tags.hasOwnProperty(tagName)){state.inTag=tagName+" "}else if(state.inTag&&tag&&/>$/.test(stream.current())){var inTag=/^([\S]+) (.*)/.exec(state.inTag)
state.inTag=null
var modeSpec=stream.current()==">"&&findMatchingMode(tags[inTag[1]],inTag[2])
var mode=CodeMirror.getMode(config,modeSpec)
var endTagA=getTagRegexp(inTag[1],true),endTag=getTagRegexp(inTag[1],false);state.token=function(stream,state){if(stream.match(endTagA,false)){state.token=html;state.localState=state.localMode=null;return null;}
return maybeBackup(stream,endTag,state.localMode.token(stream,state.localState));};state.localMode=mode;state.localState=CodeMirror.startState(mode,htmlMode.indent(state.htmlState,"",""));}else if(state.inTag){state.inTag+=stream.current()
if(stream.eol())state.inTag+=" "}
return style;};return{startState:function(){var state=CodeMirror.startState(htmlMode);return{token:html,inTag:null,localMode:null,localState:null,htmlState:state};},copyState:function(state){var local;if(state.localState){local=CodeMirror.copyState(state.localMode,state.localState);}
return{token:state.token,inTag:state.inTag,localMode:state.localMode,localState:local,htmlState:CodeMirror.copyState(htmlMode,state.htmlState)};},token:function(stream,state){return state.token(stream,state);},indent:function(state,textAfter,line){if(!state.localMode||/^\s*<\//.test(textAfter))
return htmlMode.indent(state.htmlState,textAfter,line);else if(state.localMode.indent)
return state.localMode.indent(state.localState,textAfter,line);else
return CodeMirror.Pass;},innerMode:function(state){return{state:state.localState||state.htmlState,mode:state.localMode||htmlMode};}};},"xml","javascript","css");CodeMirror.defineMIME("text/html","htmlmixed");});;(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/multiplex"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/multiplex"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";CodeMirror.defineMode("htmlembedded",function(config,parserConfig){var closeComment=parserConfig.closeComment||"--%>"
return CodeMirror.multiplexingMode(CodeMirror.getMode(config,"htmlmixed"),{open:parserConfig.openComment||"<%--",close:closeComment,delimStyle:"comment",mode:{token:function(stream){stream.skipTo(closeComment)||stream.skipToEnd()
return"comment"}}},{open:parserConfig.open||parserConfig.scriptStartRegex||"<%",close:parserConfig.close||parserConfig.scriptEndRegex||"%>",mode:CodeMirror.getMode(config,parserConfig.scriptingModeSpec)});},"htmlmixed");CodeMirror.defineMIME("application/x-ejs",{name:"htmlembedded",scriptingModeSpec:"javascript"});CodeMirror.defineMIME("application/x-aspx",{name:"htmlembedded",scriptingModeSpec:"text/x-csharp"});CodeMirror.defineMIME("application/x-jsp",{name:"htmlembedded",scriptingModeSpec:"text/x-java"});CodeMirror.defineMIME("application/x-erb",{name:"htmlembedded",scriptingModeSpec:"ruby"});});;TextEditor.CodeMirrorUtils={};TextEditor.CodeMirrorUtils.toPos=function(range){return{start:new CodeMirror.Pos(range.startLine,range.startColumn),end:new CodeMirror.Pos(range.endLine,range.endColumn)};};TextEditor.CodeMirrorUtils.toRange=function(start,end){return new TextUtils.TextRange(start.line,start.ch,end.line,end.ch);};TextEditor.CodeMirrorUtils.changeObjectToEditOperation=function(changeObject){const oldRange=TextEditor.CodeMirrorUtils.toRange(changeObject.from,changeObject.to);const newRange=oldRange.clone();const linesAdded=changeObject.text.length;if(linesAdded===0){newRange.endLine=newRange.startLine;newRange.endColumn=newRange.startColumn;}else if(linesAdded===1){newRange.endLine=newRange.startLine;newRange.endColumn=newRange.startColumn+changeObject.text[0].length;}else{newRange.endLine=newRange.startLine+linesAdded-1;newRange.endColumn=changeObject.text[linesAdded-1].length;}
return{oldRange:oldRange,newRange:newRange};};TextEditor.CodeMirrorUtils.pullLines=function(codeMirror,linesCount){const lines=[];codeMirror.eachLine(0,linesCount,onLineHandle);return lines;function onLineHandle(lineHandle){lines.push(lineHandle.text);}};TextEditor.CodeMirrorUtils.TokenizerFactory=class{createTokenizer(mimeType){const mode=CodeMirror.getMode({indentUnit:2},mimeType);const state=CodeMirror.startState(mode);function tokenize(line,callback){const stream=new CodeMirror.StringStream(line);while(!stream.eol()){const style=mode.token(stream,state);const value=stream.current();callback(value,style,stream.start,stream.start+value.length);stream.start=stream.pos;}}
return tokenize;}};;TextEditor.TextEditorAutocompleteController=class{constructor(textEditor,codeMirror,config){this._textEditor=textEditor;this._codeMirror=codeMirror;this._config=config;this._initialized=false;this._onScroll=this._onScroll.bind(this);this._onCursorActivity=this._onCursorActivity.bind(this);this._changes=this._changes.bind(this);this._blur=this._blur.bind(this);this._beforeChange=this._beforeChange.bind(this);this._mouseDown=()=>{this.clearAutocomplete();this._tooltipGlassPane.hide();};this._codeMirror.on('changes',this._changes);this._lastHintText='';this._suggestBox=null;this._currentSuggestion=null;this._hintElement=createElementWithClass('span','auto-complete-text');this._tooltipGlassPane=new UI.GlassPane();this._tooltipGlassPane.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);this._tooltipGlassPane.setOutsideClickCallback(this._tooltipGlassPane.hide.bind(this._tooltipGlassPane));this._tooltipElement=createElementWithClass('div','autocomplete-tooltip');const shadowRoot=UI.createShadowRootWithCoreStyles(this._tooltipGlassPane.contentElement,'text_editor/autocompleteTooltip.css');shadowRoot.appendChild(this._tooltipElement);}
_initializeIfNeeded(){if(this._initialized)
return;this._initialized=true;this._codeMirror.on('scroll',this._onScroll);this._codeMirror.on('cursorActivity',this._onCursorActivity);this._codeMirror.on('mousedown',this._mouseDown);this._codeMirror.on('blur',this._blur);if(this._config.isWordChar){this._codeMirror.on('beforeChange',this._beforeChange);this._dictionary=new Common.TextDictionary();this._addWordsFromText(this._codeMirror.getValue());}}
dispose(){this._codeMirror.off('changes',this._changes);if(this._initialized){this._codeMirror.off('scroll',this._onScroll);this._codeMirror.off('cursorActivity',this._onCursorActivity);this._codeMirror.off('mousedown',this._mouseDown);this._codeMirror.off('blur',this._blur);}
if(this._dictionary){this._codeMirror.off('beforeChange',this._beforeChange);this._dictionary.reset();}}
_beforeChange(codeMirror,changeObject){this._updatedLines=this._updatedLines||{};for(let i=changeObject.from.line;i<=changeObject.to.line;++i){if(this._updatedLines[i]===undefined)
this._updatedLines[i]=this._codeMirror.getLine(i);}}
_addWordsFromText(text){TextUtils.TextUtils.textToWords(text,(this._config.isWordChar),addWord.bind(this));function addWord(word){if(word.length&&(word[0]<'0'||word[0]>'9'))
this._dictionary.addWord(word);}}
_removeWordsFromText(text){TextUtils.TextUtils.textToWords(text,(this._config.isWordChar),word=>this._dictionary.removeWord(word));}
_substituteRange(lineNumber,columnNumber){let range=this._config.substituteRangeCallback?this._config.substituteRangeCallback(lineNumber,columnNumber):null;if(!range&&this._config.isWordChar)
range=this._textEditor.wordRangeForCursorPosition(lineNumber,columnNumber,this._config.isWordChar);return range;}
_wordsWithQuery(queryRange,substituteRange,force){const external=this._config.suggestionsCallback?this._config.suggestionsCallback(queryRange,substituteRange,force):null;if(external)
return external;if(!this._dictionary||(!force&&queryRange.isEmpty()))
return Promise.resolve([]);let completions=this._dictionary.wordsWithPrefix(this._textEditor.text(queryRange));const substituteWord=this._textEditor.text(substituteRange);if(this._dictionary.wordCount(substituteWord)===1)
completions=completions.filter(word=>word!==substituteWord);completions.sort((a,b)=>this._dictionary.wordCount(b)-this._dictionary.wordCount(a)||a.length-b.length);return Promise.resolve(completions.map(item=>({text:item})));}
_changes(codeMirror,changes){if(!changes.length)
return;if(this._dictionary&&this._updatedLines){for(const lineNumber in this._updatedLines)
this._removeWordsFromText(this._updatedLines[lineNumber]);delete this._updatedLines;const linesToUpdate={};for(let changeIndex=0;changeIndex<changes.length;++changeIndex){const changeObject=changes[changeIndex];const editInfo=TextEditor.CodeMirrorUtils.changeObjectToEditOperation(changeObject);for(let i=editInfo.newRange.startLine;i<=editInfo.newRange.endLine;++i)
linesToUpdate[i]=this._codeMirror.getLine(i);}
for(const lineNumber in linesToUpdate)
this._addWordsFromText(linesToUpdate[lineNumber]);}
let singleCharInput=false;let singleCharDelete=false;const cursor=this._codeMirror.getCursor('head');for(let changeIndex=0;changeIndex<changes.length;++changeIndex){const changeObject=changes[changeIndex];if(changeObject.origin==='+input'&&changeObject.text.length===1&&changeObject.text[0].length===1&&changeObject.to.line===cursor.line&&changeObject.to.ch+1===cursor.ch){singleCharInput=true;break;}
if(changeObject.origin==='+delete'&&changeObject.removed.length===1&&changeObject.removed[0].length===1&&changeObject.to.line===cursor.line&&changeObject.to.ch-1===cursor.ch){singleCharDelete=true;break;}}
if(this._queryRange){if(singleCharInput)
this._queryRange.endColumn++;else if(singleCharDelete)
this._queryRange.endColumn--;if(singleCharDelete||singleCharInput)
this._setHint(this._lastHintText);}
if(singleCharInput||singleCharDelete)
setImmediate(this.autocomplete.bind(this));else
this.clearAutocomplete();}
_blur(){this.clearAutocomplete();}
_validateSelectionsContexts(mainSelection){const selections=this._codeMirror.listSelections();if(selections.length<=1)
return true;const mainSelectionContext=this._textEditor.text(mainSelection);for(let i=0;i<selections.length;++i){const wordRange=this._substituteRange(selections[i].head.line,selections[i].head.ch);if(!wordRange)
return false;const context=this._textEditor.text(wordRange);if(context!==mainSelectionContext)
return false;}
return true;}
autocomplete(force){this._initializeIfNeeded();if(this._codeMirror.somethingSelected()){this._hideSuggestBox();return;}
const cursor=this._codeMirror.getCursor('head');const substituteRange=this._substituteRange(cursor.line,cursor.ch);if(!substituteRange||!this._validateSelectionsContexts(substituteRange)){this._hideSuggestBox();return;}
const queryRange=substituteRange.clone();queryRange.endColumn=cursor.ch;const query=this._textEditor.text(queryRange);let hadSuggestBox=false;if(this._suggestBox)
hadSuggestBox=true;this._wordsWithQuery(queryRange,substituteRange,force).then(wordsAcquired.bind(this));function wordsAcquired(wordsWithQuery){if(!wordsWithQuery.length||(wordsWithQuery.length===1&&query===wordsWithQuery[0].text)||(!this._suggestBox&&hadSuggestBox)){this._hideSuggestBox();this._onSuggestionsShownForTest([]);return;}
if(!this._suggestBox){this._suggestBox=new UI.SuggestBox(this,20);if(this._config.anchorBehavior)
this._suggestBox.setAnchorBehavior(this._config.anchorBehavior);}
const oldQueryRange=this._queryRange;this._queryRange=queryRange;if(!oldQueryRange||queryRange.startLine!==oldQueryRange.startLine||queryRange.startColumn!==oldQueryRange.startColumn)
this._updateAnchorBox();this._suggestBox.updateSuggestions(this._anchorBox,wordsWithQuery,true,!this._isCursorAtEndOfLine(),query);if(this._suggestBox.visible)
this._tooltipGlassPane.hide();this._onSuggestionsShownForTest(wordsWithQuery);}}
_setHint(hint){const query=this._textEditor.text(this._queryRange);if(!hint||!this._isCursorAtEndOfLine()||!hint.startsWith(query)){this._clearHint();return;}
const suffix=hint.substring(query.length).split('\n')[0];this._hintElement.textContent=suffix.trimEnd(10000);const cursor=this._codeMirror.getCursor('to');if(this._hintMarker){const position=this._hintMarker.position();if(!position||!position.equal(TextUtils.TextRange.createFromLocation(cursor.line,cursor.ch))){this._hintMarker.clear();this._hintMarker=null;}}
if(!this._hintMarker){this._hintMarker=this._textEditor.addBookmark(cursor.line,cursor.ch,this._hintElement,TextEditor.TextEditorAutocompleteController.HintBookmark,true);}else if(this._lastHintText!==hint){this._hintMarker.refresh();}
this._lastHintText=hint;}
_clearHint(){if(!this._hintElement.textContent)
return;this._lastHintText='';this._hintElement.textContent='';if(this._hintMarker)
this._hintMarker.refresh();}
_onSuggestionsShownForTest(suggestions){}
_onSuggestionsHiddenForTest(){}
clearAutocomplete(){this._tooltipGlassPane.hide();this._hideSuggestBox();}
_hideSuggestBox(){if(!this._suggestBox)
return;this._suggestBox.hide();this._suggestBox=null;this._queryRange=null;this._anchorBox=null;this._currentSuggestion=null;this._textEditor.dispatchEventToListeners(UI.TextEditor.Events.SuggestionChanged);this._clearHint();this._onSuggestionsHiddenForTest();}
keyDown(event){if(this._tooltipGlassPane.isShowing()&&event.keyCode===UI.KeyboardShortcut.Keys.Esc.code){this._tooltipGlassPane.hide();return true;}
if(!this._suggestBox)
return false;switch(event.keyCode){case UI.KeyboardShortcut.Keys.Tab.code:this._suggestBox.acceptSuggestion();this.clearAutocomplete();return true;case UI.KeyboardShortcut.Keys.End.code:case UI.KeyboardShortcut.Keys.Right.code:if(this._isCursorAtEndOfLine()){this._suggestBox.acceptSuggestion();this.clearAutocomplete();return true;}else{this.clearAutocomplete();return false;}
case UI.KeyboardShortcut.Keys.Left.code:case UI.KeyboardShortcut.Keys.Home.code:this.clearAutocomplete();return false;case UI.KeyboardShortcut.Keys.Esc.code:this.clearAutocomplete();return true;}
return this._suggestBox.keyPressed(event);}
_isCursorAtEndOfLine(){const cursor=this._codeMirror.getCursor('to');return cursor.ch===this._codeMirror.getLine(cursor.line).length;}
applySuggestion(suggestion,isIntermediateSuggestion){const oldSuggestion=this._currentSuggestion;this._currentSuggestion=suggestion;this._setHint(suggestion?suggestion.text:'');if((oldSuggestion?oldSuggestion.text:'')!==(suggestion?suggestion.text:''))
this._textEditor.dispatchEventToListeners(UI.TextEditor.Events.SuggestionChanged);}
acceptSuggestion(){const selections=this._codeMirror.listSelections().slice();const queryLength=this._queryRange.endColumn-this._queryRange.startColumn;const suggestion=this._currentSuggestion.text;this._codeMirror.operation(()=>{for(let i=selections.length-1;i>=0;--i){const start=selections[i].head;const end=new CodeMirror.Pos(start.line,start.ch-queryLength);this._codeMirror.replaceRange(suggestion,start,end,'+autocomplete');}});}
textWithCurrentSuggestion(){if(!this._queryRange||this._currentSuggestion===null)
return this._codeMirror.getValue();const selections=this._codeMirror.listSelections().slice();let last={line:0,column:0};let text='';const queryLength=this._queryRange.endColumn-this._queryRange.startColumn;for(const selection of selections){const range=new TextUtils.TextRange(last.line,last.column,selection.head.line,selection.head.ch-queryLength);text+=this._textEditor.text(range);text+=this._currentSuggestion.text;last={line:selection.head.line,column:selection.head.ch};}
const range=new TextUtils.TextRange(last.line,last.column,Infinity,Infinity);text+=this._textEditor.text(range);return text;}
_onScroll(){this._tooltipGlassPane.hide();if(!this._suggestBox)
return;const cursor=this._codeMirror.getCursor();const scrollInfo=this._codeMirror.getScrollInfo();const topmostLineNumber=this._codeMirror.lineAtHeight(scrollInfo.top,'local');const bottomLine=this._codeMirror.lineAtHeight(scrollInfo.top+scrollInfo.clientHeight,'local');if(cursor.line<topmostLineNumber||cursor.line>bottomLine){this.clearAutocomplete();}else{this._updateAnchorBox();this._suggestBox.setPosition(this._anchorBox);}}
async _updateTooltip(){const cursor=this._codeMirror.getCursor();const tooltip=this._config.tooltipCallback?await this._config.tooltipCallback(cursor.line,cursor.ch):null;const newCursor=this._codeMirror.getCursor();if(newCursor.line!==cursor.line&&newCursor.ch!==cursor.ch)
return;if(this._suggestBox&&this._suggestBox.visible)
return;if(!tooltip){this._tooltipGlassPane.hide();return;}
const metrics=this._textEditor.cursorPositionToCoordinates(cursor.line,cursor.ch);if(!metrics){this._tooltipGlassPane.hide();return;}
this._tooltipGlassPane.setContentAnchorBox(new AnchorBox(metrics.x,metrics.y,0,metrics.height));this._tooltipElement.removeChildren();this._tooltipElement.appendChild(tooltip);this._tooltipGlassPane.show((this._textEditor.element.ownerDocument));}
_onCursorActivity(){this._updateTooltip();if(!this._suggestBox)
return;const cursor=this._codeMirror.getCursor();let shouldCloseAutocomplete=!(cursor.line===this._queryRange.startLine&&this._queryRange.startColumn<=cursor.ch&&cursor.ch<=this._queryRange.endColumn);if(cursor.line===this._queryRange.startLine&&cursor.ch===this._queryRange.endColumn+1){const line=this._codeMirror.getLine(cursor.line);shouldCloseAutocomplete=this._config.isWordChar?!this._config.isWordChar(line.charAt(cursor.ch-1)):false;}
if(shouldCloseAutocomplete)
this.clearAutocomplete();this._onCursorActivityHandledForTest();}
_onCursorActivityHandledForTest(){}
_updateAnchorBox(){const line=this._queryRange.startLine;const column=this._queryRange.startColumn;const metrics=this._textEditor.cursorPositionToCoordinates(line,column);this._anchorBox=metrics?new AnchorBox(metrics.x,metrics.y,0,metrics.height):null;}};TextEditor.TextEditorAutocompleteController.HintBookmark=Symbol('hint');;TextEditor.CodeMirrorTextEditor=class extends UI.VBox{constructor(options){super();this._options=options;this.registerRequiredCSS('cm/codemirror.css');this.registerRequiredCSS('text_editor/cmdevtools.css');this._codeMirror=new CodeMirror(this.element,{devtoolsAccessibleName:options.devtoolsAccessibleName,lineNumbers:options.lineNumbers,matchBrackets:true,smartIndent:true,styleSelectedText:true,electricChars:true,styleActiveLine:true,indentUnit:4,lineWrapping:options.lineWrapping,lineWiseCopyCut:false,tabIndex:0,pollInterval:Math.pow(2,31)-1,inputStyle:'devToolsAccessibleTextArea'});this._codeMirrorElement=this.element.lastElementChild;this._codeMirror._codeMirrorTextEditor=this;CodeMirror.keyMap['devtools-common']={'Left':'goCharLeft','Right':'goCharRight','Up':'goLineUp','Down':'goLineDown','End':'goLineEnd','Home':'goLineStartSmart','PageUp':'goSmartPageUp','PageDown':'goSmartPageDown','Delete':'delCharAfter','Backspace':'delCharBefore','Tab':'defaultTab','Shift-Tab':'indentLessOrPass','Enter':'newlineAndIndent','Ctrl-Space':'autocomplete','Esc':'dismiss','Ctrl-M':'gotoMatchingBracket'};CodeMirror.keyMap['devtools-pc']={'Ctrl-A':'selectAll','Ctrl-Z':'undoAndReveal','Shift-Ctrl-Z':'redoAndReveal','Ctrl-Y':'redo','Ctrl-Home':'goDocStart','Ctrl-Up':'goDocStart','Ctrl-End':'goDocEnd','Ctrl-Down':'goDocEnd','Ctrl-Left':'goGroupLeft','Ctrl-Right':'goGroupRight','Alt-Left':'moveCamelLeft','Alt-Right':'moveCamelRight','Shift-Alt-Left':'selectCamelLeft','Shift-Alt-Right':'selectCamelRight','Ctrl-Backspace':'delGroupBefore','Ctrl-Delete':'delGroupAfter','Ctrl-/':'toggleComment','Ctrl-D':'selectNextOccurrence','Ctrl-U':'undoLastSelection',fallthrough:'devtools-common'};CodeMirror.keyMap['devtools-mac']={'Cmd-A':'selectAll','Cmd-Z':'undoAndReveal','Shift-Cmd-Z':'redoAndReveal','Cmd-Up':'goDocStart','Cmd-Down':'goDocEnd','Alt-Left':'goGroupLeft','Alt-Right':'goGroupRight','Ctrl-Left':'moveCamelLeft','Ctrl-Right':'moveCamelRight','Ctrl-A':'goLineLeft','Ctrl-E':'goLineRight','Ctrl-B':'goCharLeft','Ctrl-F':'goCharRight','Ctrl-Alt-B':'goGroupLeft','Ctrl-Alt-F':'goGroupRight','Ctrl-H':'delCharBefore','Ctrl-D':'delCharAfter','Ctrl-K':'killLine','Ctrl-T':'transposeChars','Shift-Ctrl-Left':'selectCamelLeft','Shift-Ctrl-Right':'selectCamelRight','Cmd-Left':'goLineStartSmart','Cmd-Right':'goLineEnd','Cmd-Backspace':'delLineLeft','Alt-Backspace':'delGroupBefore','Alt-Delete':'delGroupAfter','Cmd-/':'toggleComment','Cmd-D':'selectNextOccurrence','Cmd-U':'undoLastSelection',fallthrough:'devtools-common'};if(options.bracketMatchingSetting)
options.bracketMatchingSetting.addChangeListener(this._enableBracketMatchingIfNeeded,this);this._enableBracketMatchingIfNeeded();this._codeMirror.setOption('keyMap',Host.isMac()?'devtools-mac':'devtools-pc');this._codeMirror.setOption('flattenSpans',false);let maxHighlightLength=options.maxHighlightLength;if(typeof maxHighlightLength!=='number')
maxHighlightLength=TextEditor.CodeMirrorTextEditor.maxHighlightLength;this._codeMirror.setOption('maxHighlightLength',maxHighlightLength);this._codeMirror.setOption('mode',null);this._codeMirror.setOption('crudeMeasuringFrom',1000);this._shouldClearHistory=true;this._lineSeparator='\n';TextEditor.CodeMirrorTextEditor._fixWordMovement(this._codeMirror);this._selectNextOccurrenceController=new TextEditor.CodeMirrorTextEditor.SelectNextOccurrenceController(this,this._codeMirror);this._codeMirror.on('changes',this._changes.bind(this));this._codeMirror.on('beforeSelectionChange',this._beforeSelectionChange.bind(this));this._codeMirror.on('cursorActivity',()=>{this.dispatchEventToListeners(UI.TextEditor.Events.CursorChanged);});this.element.style.overflow='hidden';this._codeMirrorElement.classList.add('source-code');this._codeMirrorElement.classList.add('fill');this._decorations=new Multimap();this.element.addEventListener('keydown',this._handleKeyDown.bind(this),true);this.element.addEventListener('keydown',this._handlePostKeyDown.bind(this),false);this._needsRefresh=true;this._readOnly=false;this._mimeType='';if(options.mimeType)
this.setMimeType(options.mimeType);if(options.autoHeight)
this._codeMirror.setSize(null,'auto');this._placeholderElement=null;if(options.placeholder){this._placeholderElement=createElement('pre');this._placeholderElement.classList.add('placeholder-text');this._placeholderElement.textContent=options.placeholder;this._updatePlaceholder();}}
static autocompleteCommand(codeMirror){const autocompleteController=codeMirror._codeMirrorTextEditor._autocompleteController;if(autocompleteController)
autocompleteController.autocomplete(true);}
static undoLastSelectionCommand(codeMirror){codeMirror._codeMirrorTextEditor._selectNextOccurrenceController.undoLastSelection();}
static selectNextOccurrenceCommand(codeMirror){codeMirror._codeMirrorTextEditor._selectNextOccurrenceController.selectNextOccurrence();}
static moveCamelLeftCommand(shift,codeMirror){codeMirror._codeMirrorTextEditor._doCamelCaseMovement(-1,shift);}
static moveCamelRightCommand(shift,codeMirror){codeMirror._codeMirrorTextEditor._doCamelCaseMovement(1,shift);}
static _overrideModeWithPrefixedTokens(modeName,tokenPrefix){const oldModeName=modeName+'-old';if(CodeMirror.modes[oldModeName])
return;CodeMirror.defineMode(oldModeName,CodeMirror.modes[modeName]);CodeMirror.defineMode(modeName,modeConstructor);function modeConstructor(config,parserConfig){const innerConfig={};for(const i in parserConfig)
innerConfig[i]=parserConfig[i];innerConfig.name=oldModeName;const codeMirrorMode=CodeMirror.getMode(config,innerConfig);codeMirrorMode.name=modeName;codeMirrorMode.token=tokenOverride.bind(null,codeMirrorMode.token);return codeMirrorMode;}
function tokenOverride(superToken,stream,state){const token=superToken(stream,state);return token?tokenPrefix+token.split(/ +/).join(' '+tokenPrefix):token;}}
static _collectUninstalledModes(mimeType){const installed=TextEditor.CodeMirrorTextEditor._loadedMimeModeExtensions;const nameToExtension=new Map();const extensions=self.runtime.extensions(TextEditor.CodeMirrorMimeMode);for(const extension of extensions)
nameToExtension.set(extension.descriptor()['fileName'],extension);const modesToLoad=new Set();for(const extension of extensions){const descriptor=extension.descriptor();if(installed.has(extension)||descriptor['mimeTypes'].indexOf(mimeType)===-1)
continue;modesToLoad.add(extension);const deps=descriptor['dependencies']||[];for(let i=0;i<deps.length;++i){const extension=nameToExtension.get(deps[i]);if(extension&&!installed.has(extension))
modesToLoad.add(extension);}}
return Array.from(modesToLoad);}
static _installMimeTypeModes(extensions){const promises=extensions.map(extension=>extension.instance().then(installMode.bind(null,extension)));return Promise.all(promises);function installMode(extension,instance){if(TextEditor.CodeMirrorTextEditor._loadedMimeModeExtensions.has(extension))
return;const mode=(instance);mode.install(extension);TextEditor.CodeMirrorTextEditor._loadedMimeModeExtensions.add(extension);}}
static _fixWordMovement(codeMirror){function moveLeft(shift,codeMirror){codeMirror.setExtending(shift);const cursor=codeMirror.getCursor('head');codeMirror.execCommand('goGroupLeft');const newCursor=codeMirror.getCursor('head');if(newCursor.ch===0&&newCursor.line!==0){codeMirror.setExtending(false);return;}
const skippedText=codeMirror.getRange(newCursor,cursor,'#');if(/^\s+$/.test(skippedText))
codeMirror.execCommand('goGroupLeft');codeMirror.setExtending(false);}
function moveRight(shift,codeMirror){codeMirror.setExtending(shift);const cursor=codeMirror.getCursor('head');codeMirror.execCommand('goGroupRight');const newCursor=codeMirror.getCursor('head');if(newCursor.ch===0&&newCursor.line!==0){codeMirror.setExtending(false);return;}
const skippedText=codeMirror.getRange(cursor,newCursor,'#');if(/^\s+$/.test(skippedText))
codeMirror.execCommand('goGroupRight');codeMirror.setExtending(false);}
const modifierKey=Host.isMac()?'Alt':'Ctrl';const leftKey=modifierKey+'-Left';const rightKey=modifierKey+'-Right';const keyMap={};keyMap[leftKey]=moveLeft.bind(null,false);keyMap[rightKey]=moveRight.bind(null,false);keyMap['Shift-'+leftKey]=moveLeft.bind(null,true);keyMap['Shift-'+rightKey]=moveRight.bind(null,true);codeMirror.addKeyMap(keyMap);}
codeMirror(){return this._codeMirror;}
widget(){return this;}
setPlaceholder(placeholder){if(!this._placeholderElement){this._placeholderElement=createElement('pre');this._placeholderElement.classList.add('placeholder-text');}
this._placeholderElement.textContent=placeholder||'';this._updatePlaceholder();}
_normalizePositionForOverlappingColumn(lineNumber,lineLength,charNumber){const linesCount=this._codeMirror.lineCount();let columnNumber=charNumber;if(charNumber<0&&lineNumber>0){--lineNumber;columnNumber=this.line(lineNumber).length;}else if(charNumber>=lineLength&&lineNumber<linesCount-1){++lineNumber;columnNumber=0;}else{columnNumber=Number.constrain(charNumber,0,lineLength);}
return{lineNumber:lineNumber,columnNumber:columnNumber};}
_camelCaseMoveFromPosition(lineNumber,columnNumber,direction){function valid(charNumber,length){return charNumber>=0&&charNumber<length;}
function isWordStart(text,charNumber){const position=charNumber;const nextPosition=charNumber+1;return valid(position,text.length)&&valid(nextPosition,text.length)&&TextUtils.TextUtils.isWordChar(text[position])&&TextUtils.TextUtils.isWordChar(text[nextPosition])&&TextUtils.TextUtils.isUpperCase(text[position])&&TextUtils.TextUtils.isLowerCase(text[nextPosition]);}
function isWordEnd(text,charNumber){const position=charNumber;const prevPosition=charNumber-1;return valid(position,text.length)&&valid(prevPosition,text.length)&&TextUtils.TextUtils.isWordChar(text[position])&&TextUtils.TextUtils.isWordChar(text[prevPosition])&&TextUtils.TextUtils.isUpperCase(text[position])&&TextUtils.TextUtils.isLowerCase(text[prevPosition]);}
function constrainPosition(lineNumber,lineLength,columnNumber){return{lineNumber:lineNumber,columnNumber:Number.constrain(columnNumber,0,lineLength)};}
const text=this.line(lineNumber);const length=text.length;if((columnNumber===length&&direction===1)||(columnNumber===0&&direction===-1))
return this._normalizePositionForOverlappingColumn(lineNumber,length,columnNumber+direction);let charNumber=direction===1?columnNumber:columnNumber-1;while(valid(charNumber,length)&&TextUtils.TextUtils.isSpaceChar(text[charNumber]))
charNumber+=direction;if(!valid(charNumber,length))
return constrainPosition(lineNumber,length,charNumber);if(TextUtils.TextUtils.isStopChar(text[charNumber])){while(valid(charNumber,length)&&TextUtils.TextUtils.isStopChar(text[charNumber]))
charNumber+=direction;if(!valid(charNumber,length))
return constrainPosition(lineNumber,length,charNumber);return{lineNumber:lineNumber,columnNumber:direction===-1?charNumber+1:charNumber};}
charNumber+=direction;while(valid(charNumber,length)&&!isWordStart(text,charNumber)&&!isWordEnd(text,charNumber)&&TextUtils.TextUtils.isWordChar(text[charNumber]))
charNumber+=direction;if(!valid(charNumber,length))
return constrainPosition(lineNumber,length,charNumber);if(isWordStart(text,charNumber)||isWordEnd(text,charNumber))
return{lineNumber:lineNumber,columnNumber:charNumber};return{lineNumber:lineNumber,columnNumber:direction===-1?charNumber+1:charNumber};}
_doCamelCaseMovement(direction,shift){const selections=this.selections();for(let i=0;i<selections.length;++i){const selection=selections[i];const move=this._camelCaseMoveFromPosition(selection.endLine,selection.endColumn,direction);selection.endLine=move.lineNumber;selection.endColumn=move.columnNumber;if(!shift)
selections[i]=selection.collapseToEnd();}
this.setSelections(selections);}
dispose(){if(this._options.bracketMatchingSetting)
this._options.bracketMatchingSetting.removeChangeListener(this._enableBracketMatchingIfNeeded,this);}
_enableBracketMatchingIfNeeded(){this._codeMirror.setOption('autoCloseBrackets',(this._options.bracketMatchingSetting&&this._options.bracketMatchingSetting.get())?{explode:false}:false);}
wasShown(){if(this._needsRefresh)
this.refresh();}
refresh(){if(this.isShowing()){this._codeMirror.refresh();this._needsRefresh=false;return;}
this._needsRefresh=true;}
willHide(){delete this._editorSizeInSync;}
undo(){this._codeMirror.undo();}
redo(){this._codeMirror.redo();}
_handleKeyDown(e){if(e.key==='Tab'&&Common.moduleSetting('textEditorTabMovesFocus').get()){e.consume(false);return;}
if(this._autocompleteController&&this._autocompleteController.keyDown(e))
e.consume(true);}
_handlePostKeyDown(e){if(e.defaultPrevented)
e.consume(true);}
configureAutocomplete(config){if(this._autocompleteController){this._autocompleteController.dispose();delete this._autocompleteController;}
if(config)
this._autocompleteController=new TextEditor.TextEditorAutocompleteController(this,this._codeMirror,config);}
cursorPositionToCoordinates(lineNumber,column){if(lineNumber>=this._codeMirror.lineCount()||lineNumber<0||column<0||column>this._codeMirror.getLine(lineNumber).length)
return null;const metrics=this._codeMirror.cursorCoords(new CodeMirror.Pos(lineNumber,column));return{x:metrics.left,y:metrics.top,height:metrics.bottom-metrics.top};}
coordinatesToCursorPosition(x,y){const element=this.element.ownerDocument.elementFromPoint(x,y);if(!element||!element.isSelfOrDescendant(this._codeMirror.getWrapperElement()))
return null;const gutterBox=this._codeMirror.getGutterElement().boxInWindow();if(x>=gutterBox.x&&x<=gutterBox.x+gutterBox.width&&y>=gutterBox.y&&y<=gutterBox.y+gutterBox.height)
return null;const coords=this._codeMirror.coordsChar({left:x,top:y});return TextEditor.CodeMirrorUtils.toRange(coords,coords);}
visualCoordinates(lineNumber,columnNumber){const metrics=this._codeMirror.cursorCoords(new CodeMirror.Pos(lineNumber,columnNumber));return{x:metrics.left,y:metrics.top};}
tokenAtTextPosition(lineNumber,columnNumber){if(lineNumber<0||lineNumber>=this._codeMirror.lineCount())
return null;const token=this._codeMirror.getTokenAt(new CodeMirror.Pos(lineNumber,(columnNumber||0)+1));if(!token)
return null;return{startColumn:token.start,endColumn:token.end,type:token.type};}
isClean(generation){return this._codeMirror.isClean(generation);}
markClean(){return this._codeMirror.changeGeneration(true);}
_hasLongLines(){function lineIterator(lineHandle){if(lineHandle.text.length>TextEditor.CodeMirrorTextEditor.LongLineModeLineLengthThreshold)
hasLongLines=true;return hasLongLines;}
let hasLongLines=false;this._codeMirror.eachLine(lineIterator);return hasLongLines;}
_enableLongLinesMode(){this._codeMirror.setOption('styleSelectedText',false);}
_disableLongLinesMode(){this._codeMirror.setOption('styleSelectedText',true);}
setMimeType(mimeType){this._mimeType=mimeType;const modesToLoad=TextEditor.CodeMirrorTextEditor._collectUninstalledModes(mimeType);if(!modesToLoad.length)
setMode.call(this);else
TextEditor.CodeMirrorTextEditor._installMimeTypeModes(modesToLoad).then(setMode.bind(this));function setMode(){const rewrittenMimeType=this.rewriteMimeType(mimeType);if(this._codeMirror.options.mode!==rewrittenMimeType)
this._codeMirror.setOption('mode',rewrittenMimeType);}}
setHighlightMode(mode){this._mimeType='';this._codeMirror.setOption('mode',mode);}
rewriteMimeType(mimeType){return mimeType;}
mimeType(){return this._mimeType;}
setReadOnly(readOnly){if(this._readOnly===readOnly)
return;this.clearPositionHighlight();this._readOnly=readOnly;this.element.classList.toggle('CodeMirror-readonly',readOnly);this._codeMirror.setOption('readOnly',readOnly);}
readOnly(){return!!this._codeMirror.getOption('readOnly');}
setLineNumberFormatter(formatter){this._codeMirror.setOption('lineNumberFormatter',formatter);}
addKeyDownHandler(handler){this._codeMirror.on('keydown',(CodeMirror,event)=>handler(event));}
addBookmark(lineNumber,columnNumber,element,type,insertBefore){const bookmark=new TextEditor.TextEditorBookMark(this._codeMirror.setBookmark(new CodeMirror.Pos(lineNumber,columnNumber),{widget:element,insertLeft:insertBefore}),type,this);this._updateDecorations(lineNumber);return bookmark;}
bookmarks(range,type){const pos=TextEditor.CodeMirrorUtils.toPos(range);let markers=this._codeMirror.findMarksAt(pos.start);if(!range.isEmpty()){const middleMarkers=this._codeMirror.findMarks(pos.start,pos.end);const endMarkers=this._codeMirror.findMarksAt(pos.end);markers=markers.concat(middleMarkers,endMarkers);}
const bookmarks=[];for(let i=0;i<markers.length;i++){const bookmark=markers[i][TextEditor.TextEditorBookMark._symbol];if(bookmark&&(!type||bookmark.type()===type))
bookmarks.push(bookmark);}
return bookmarks;}
focus(){this._codeMirror.focus();}
hasFocus(){return this._codeMirror.hasFocus();}
operation(operation){this._codeMirror.operation(operation);}
scrollLineIntoView(lineNumber){this._innerRevealLine(lineNumber,this._codeMirror.getScrollInfo());}
_innerRevealLine(lineNumber,scrollInfo){const topLine=this._codeMirror.lineAtHeight(scrollInfo.top,'local');const bottomLine=this._codeMirror.lineAtHeight(scrollInfo.top+scrollInfo.clientHeight,'local');const linesPerScreen=bottomLine-topLine+1;if(lineNumber<topLine){const topLineToReveal=Math.max(lineNumber-(linesPerScreen/2)+1,0)|0;this._codeMirror.scrollIntoView(new CodeMirror.Pos(topLineToReveal,0));}else if(lineNumber>bottomLine){const bottomLineToReveal=Math.min(lineNumber+(linesPerScreen/2)-1,this.linesCount-1)|0;this._codeMirror.scrollIntoView(new CodeMirror.Pos(bottomLineToReveal,0));}}
addDecoration(element,lineNumber,startColumn,endColumn){const widget=this._codeMirror.addLineWidget(lineNumber,element);let update=null;if(typeof startColumn!=='undefined'){if(typeof endColumn==='undefined')
endColumn=Infinity;update=this._updateFloatingDecoration.bind(this,element,lineNumber,startColumn,endColumn);update();}
this._decorations.set(lineNumber,{element:element,update:update,widget:widget});}
_updateFloatingDecoration(element,lineNumber,startColumn,endColumn){const base=this._codeMirror.cursorCoords(new CodeMirror.Pos(lineNumber,0),'page');const start=this._codeMirror.cursorCoords(new CodeMirror.Pos(lineNumber,startColumn),'page');const end=this._codeMirror.charCoords(new CodeMirror.Pos(lineNumber,endColumn),'page');element.style.width=(end.right-start.left)+'px';element.style.left=(start.left-base.left)+'px';}
_updateDecorations(lineNumber){this._decorations.get(lineNumber).forEach(innerUpdateDecorations);function innerUpdateDecorations(decoration){if(decoration.update)
decoration.update();}}
removeDecoration(element,lineNumber){this._decorations.get(lineNumber).forEach(innerRemoveDecoration.bind(this));function innerRemoveDecoration(decoration){if(decoration.element!==element)
return;this._codeMirror.removeLineWidget(decoration.widget);this._decorations.delete(lineNumber,decoration);}}
revealPosition(lineNumber,columnNumber,shouldHighlight){lineNumber=Number.constrain(lineNumber,0,this._codeMirror.lineCount()-1);if(typeof columnNumber!=='number')
columnNumber=0;columnNumber=Number.constrain(columnNumber,0,this._codeMirror.getLine(lineNumber).length);this.clearPositionHighlight();this._highlightedLine=this._codeMirror.getLineHandle(lineNumber);if(!this._highlightedLine)
return;this.scrollLineIntoView(lineNumber);if(shouldHighlight){this._codeMirror.addLineClass(this._highlightedLine,null,this._readOnly?'cm-readonly-highlight':'cm-highlight');if(!this._readOnly)
this._clearHighlightTimeout=setTimeout(this.clearPositionHighlight.bind(this),2000);}
this.setSelection(TextUtils.TextRange.createFromLocation(lineNumber,columnNumber));}
clearPositionHighlight(){if(this._clearHighlightTimeout)
clearTimeout(this._clearHighlightTimeout);delete this._clearHighlightTimeout;if(this._highlightedLine){this._codeMirror.removeLineClass(this._highlightedLine,null,this._readOnly?'cm-readonly-highlight':'cm-highlight');}
delete this._highlightedLine;}
elementsToRestoreScrollPositionsFor(){return[];}
_updatePaddingBottom(width,height){if(!this._options.padBottom)
return;const scrollInfo=this._codeMirror.getScrollInfo();let newPaddingBottom;const linesElement=this._codeMirrorElement.querySelector('.CodeMirror-lines');const lineCount=this._codeMirror.lineCount();if(lineCount<=1){newPaddingBottom=0;}else{newPaddingBottom=Math.max(scrollInfo.clientHeight-this._codeMirror.getLineHandle(this._codeMirror.lastLine()).height,0);}
newPaddingBottom+='px';linesElement.style.paddingBottom=newPaddingBottom;this._codeMirror.setSize(width,height);}
_resizeEditor(){const parentElement=this.element.parentElement;if(!parentElement||!this.isShowing())
return;this._codeMirror.operation(()=>{const scrollLeft=this._codeMirror.doc.scrollLeft;const scrollTop=this._codeMirror.doc.scrollTop;const width=parentElement.offsetWidth;const height=parentElement.offsetHeight-this.element.offsetTop;if(this._options.autoHeight){this._codeMirror.setSize(width,'auto');}else{this._codeMirror.setSize(width,height);this._updatePaddingBottom(width,height);}
this._codeMirror.scrollTo(scrollLeft,scrollTop);});}
onResize(){if(this._autocompleteController)
this._autocompleteController.clearAutocomplete();this._resizeEditor();this._editorSizeInSync=true;if(this._selectionSetScheduled){delete this._selectionSetScheduled;this.setSelection(this._lastSelection);}}
editRange(range,text,origin){const pos=TextEditor.CodeMirrorUtils.toPos(range);this._codeMirror.replaceRange(text,pos.start,pos.end,origin);const newRange=TextEditor.CodeMirrorUtils.toRange(pos.start,this._codeMirror.posFromIndex(this._codeMirror.indexFromPos(pos.start)+text.length));this.dispatchEventToListeners(UI.TextEditor.Events.TextChanged,{oldRange:range,newRange:newRange});return newRange;}
clearAutocomplete(){if(this._autocompleteController)
this._autocompleteController.clearAutocomplete();}
wordRangeForCursorPosition(lineNumber,column,isWordChar){const line=this.line(lineNumber);let wordStart=column;if(column!==0&&isWordChar(line.charAt(column-1))){wordStart=column-1;while(wordStart>0&&isWordChar(line.charAt(wordStart-1)))
--wordStart;}
let wordEnd=column;while(wordEnd<line.length&&isWordChar(line.charAt(wordEnd)))
++wordEnd;return new TextUtils.TextRange(lineNumber,wordStart,lineNumber,wordEnd);}
_changes(codeMirror,changes){if(!changes.length)
return;this._updatePlaceholder();const hasOneLine=this._codeMirror.lineCount()===1;if(hasOneLine!==this._hasOneLine)
this._resizeEditor();this._hasOneLine=hasOneLine;this._decorations.valuesArray().forEach(decoration=>this._codeMirror.removeLineWidget(decoration.widget));this._decorations.clear();const edits=[];let currentEdit;for(let changeIndex=0;changeIndex<changes.length;++changeIndex){const changeObject=changes[changeIndex];const edit=TextEditor.CodeMirrorUtils.changeObjectToEditOperation(changeObject);if(currentEdit&&edit.oldRange.equal(currentEdit.newRange)){currentEdit.newRange=edit.newRange;}else{currentEdit=edit;edits.push(currentEdit);}}
for(let i=0;i<edits.length;i++){this.dispatchEventToListeners(UI.TextEditor.Events.TextChanged,{oldRange:edits[i].oldRange,newRange:edits[i].newRange});}}
_beforeSelectionChange(codeMirror,selection){this._selectNextOccurrenceController.selectionWillChange();}
scrollToLine(lineNumber){const pos=new CodeMirror.Pos(lineNumber,0);const coords=this._codeMirror.charCoords(pos,'local');this._codeMirror.scrollTo(0,coords.top);}
firstVisibleLine(){return this._codeMirror.lineAtHeight(this._codeMirror.getScrollInfo().top,'local');}
scrollTop(){return this._codeMirror.getScrollInfo().top;}
setScrollTop(scrollTop){this._codeMirror.scrollTo(0,scrollTop);}
lastVisibleLine(){const scrollInfo=this._codeMirror.getScrollInfo();return this._codeMirror.lineAtHeight(scrollInfo.top+scrollInfo.clientHeight,'local');}
selection(){const start=this._codeMirror.getCursor('anchor');const end=this._codeMirror.getCursor('head');return TextEditor.CodeMirrorUtils.toRange(start,end);}
selections(){const selectionList=this._codeMirror.listSelections();const result=[];for(let i=0;i<selectionList.length;++i){const selection=selectionList[i];result.push(TextEditor.CodeMirrorUtils.toRange(selection.anchor,selection.head));}
return result;}
lastSelection(){return this._lastSelection;}
setSelection(textRange,dontScroll){this._lastSelection=textRange;if(!this._editorSizeInSync){this._selectionSetScheduled=true;return;}
const pos=TextEditor.CodeMirrorUtils.toPos(textRange);this._codeMirror.setSelection(pos.start,pos.end,{scroll:!dontScroll});}
setSelections(ranges,primarySelectionIndex){const selections=[];for(let i=0;i<ranges.length;++i){const selection=TextEditor.CodeMirrorUtils.toPos(ranges[i]);selections.push({anchor:selection.start,head:selection.end});}
primarySelectionIndex=primarySelectionIndex||0;this._codeMirror.setSelections(selections,primarySelectionIndex,{scroll:false});}
_detectLineSeparator(text){this._lineSeparator=text.indexOf('\r\n')>=0?'\r\n':'\n';}
setText(text){if(text.length>TextEditor.CodeMirrorTextEditor.MaxEditableTextSize){this.configureAutocomplete(null);this.setReadOnly(true);}
this._codeMirror.setValue(text);if(this._shouldClearHistory){this._codeMirror.clearHistory();this._shouldClearHistory=false;}
this._detectLineSeparator(text);if(this._hasLongLines())
this._enableLongLinesMode();else
this._disableLongLinesMode();if(!this.isShowing())
this.refresh();}
text(textRange){if(!textRange)
return this._codeMirror.getValue(this._lineSeparator);const pos=TextEditor.CodeMirrorUtils.toPos(textRange.normalize());return this._codeMirror.getRange(pos.start,pos.end,this._lineSeparator);}
textWithCurrentSuggestion(){if(!this._autocompleteController)
return this.text();return this._autocompleteController.textWithCurrentSuggestion();}
fullRange(){const lineCount=this.linesCount;const lastLine=this._codeMirror.getLine(lineCount-1);return TextEditor.CodeMirrorUtils.toRange(new CodeMirror.Pos(0,0),new CodeMirror.Pos(lineCount-1,lastLine.length));}
currentLineNumber(){return this._codeMirror.getCursor().line;}
line(lineNumber){return this._codeMirror.getLine(lineNumber);}
get linesCount(){return this._codeMirror.lineCount();}
newlineAndIndent(){this._codeMirror.execCommand('newlineAndIndent');}
textEditorPositionHandle(lineNumber,columnNumber){return new TextEditor.CodeMirrorPositionHandle(this._codeMirror,new CodeMirror.Pos(lineNumber,columnNumber));}
_updatePlaceholder(){if(!this._placeholderElement)
return;this._placeholderElement.remove();if(this.linesCount===1&&!this.line(0)){this._codeMirror.display.lineSpace.insertBefore(this._placeholderElement,this._codeMirror.display.lineSpace.firstChild);}}};TextEditor.CodeMirrorTextEditor.maxHighlightLength=1000;CodeMirror.commands.autocomplete=TextEditor.CodeMirrorTextEditor.autocompleteCommand;CodeMirror.commands.undoLastSelection=TextEditor.CodeMirrorTextEditor.undoLastSelectionCommand;CodeMirror.commands.selectNextOccurrence=TextEditor.CodeMirrorTextEditor.selectNextOccurrenceCommand;CodeMirror.commands.moveCamelLeft=TextEditor.CodeMirrorTextEditor.moveCamelLeftCommand.bind(null,false);CodeMirror.commands.selectCamelLeft=TextEditor.CodeMirrorTextEditor.moveCamelLeftCommand.bind(null,true);CodeMirror.commands.moveCamelRight=TextEditor.CodeMirrorTextEditor.moveCamelRightCommand.bind(null,false);CodeMirror.commands.selectCamelRight=TextEditor.CodeMirrorTextEditor.moveCamelRightCommand.bind(null,true);CodeMirror.commands.indentLessOrPass=function(codeMirror){const selections=codeMirror.listSelections();if(selections.length===1){const range=TextEditor.CodeMirrorUtils.toRange(selections[0].anchor,selections[0].head);if(range.isEmpty()&&!/^\s/.test(codeMirror.getLine(range.startLine)))
return CodeMirror.Pass;}
codeMirror.execCommand('indentLess');};CodeMirror.commands.gotoMatchingBracket=function(codeMirror){const updatedSelections=[];const selections=codeMirror.listSelections();for(let i=0;i<selections.length;++i){const selection=selections[i];const cursor=selection.head;const matchingBracket=codeMirror.findMatchingBracket(cursor,false,{maxScanLines:10000});let updatedHead=cursor;if(matchingBracket&&matchingBracket.match){const columnCorrection=CodeMirror.cmpPos(matchingBracket.from,cursor)===0?1:0;updatedHead=new CodeMirror.Pos(matchingBracket.to.line,matchingBracket.to.ch+columnCorrection);}
updatedSelections.push({anchor:updatedHead,head:updatedHead});}
codeMirror.setSelections(updatedSelections);};CodeMirror.commands.undoAndReveal=function(codemirror){const scrollInfo=codemirror.getScrollInfo();codemirror.execCommand('undo');const cursor=codemirror.getCursor('start');codemirror._codeMirrorTextEditor._innerRevealLine(cursor.line,scrollInfo);const autocompleteController=codemirror._codeMirrorTextEditor._autocompleteController;if(autocompleteController)
autocompleteController.clearAutocomplete();};CodeMirror.commands.redoAndReveal=function(codemirror){const scrollInfo=codemirror.getScrollInfo();codemirror.execCommand('redo');const cursor=codemirror.getCursor('start');codemirror._codeMirrorTextEditor._innerRevealLine(cursor.line,scrollInfo);const autocompleteController=codemirror._codeMirrorTextEditor._autocompleteController;if(autocompleteController)
autocompleteController.clearAutocomplete();};CodeMirror.commands.dismiss=function(codemirror){const selections=codemirror.listSelections();const selection=selections[0];if(selections.length===1){if(TextEditor.CodeMirrorUtils.toRange(selection.anchor,selection.head).isEmpty())
return CodeMirror.Pass;codemirror.setSelection(selection.anchor,selection.anchor,{scroll:false});codemirror._codeMirrorTextEditor.scrollLineIntoView(selection.anchor.line);return;}
codemirror.setSelection(selection.anchor,selection.head,{scroll:false});codemirror._codeMirrorTextEditor.scrollLineIntoView(selection.anchor.line);};CodeMirror.commands.goSmartPageUp=function(codemirror){if(codemirror._codeMirrorTextEditor.selection().equal(TextUtils.TextRange.createFromLocation(0,0)))
return CodeMirror.Pass;codemirror.execCommand('goPageUp');};CodeMirror.commands.goSmartPageDown=function(codemirror){if(codemirror._codeMirrorTextEditor.selection().equal(codemirror._codeMirrorTextEditor.fullRange().collapseToEnd()))
return CodeMirror.Pass;codemirror.execCommand('goPageDown');};TextEditor.CodeMirrorTextEditor.LongLineModeLineLengthThreshold=2000;TextEditor.CodeMirrorTextEditor.MaxEditableTextSize=1024*1024*10;TextEditor.CodeMirrorPositionHandle=class{constructor(codeMirror,pos){this._codeMirror=codeMirror;this._lineHandle=codeMirror.getLineHandle(pos.line);this._columnNumber=pos.ch;}
resolve(){const lineNumber=this._lineHandle?this._codeMirror.getLineNumber(this._lineHandle):null;if(typeof lineNumber!=='number')
return null;return{lineNumber:lineNumber,columnNumber:this._columnNumber};}
equal(positionHandle){return positionHandle._lineHandle===this._lineHandle&&positionHandle._columnNumber===this._columnNumber&&positionHandle._codeMirror===this._codeMirror;}};TextEditor.CodeMirrorTextEditor.SelectNextOccurrenceController=class{constructor(textEditor,codeMirror){this._textEditor=textEditor;this._codeMirror=codeMirror;}
selectionWillChange(){if(!this._muteSelectionListener)
delete this._fullWordSelection;}
_findRange(selections,range){for(let i=0;i<selections.length;++i){if(range.equal(selections[i]))
return true;}
return false;}
undoLastSelection(){this._muteSelectionListener=true;this._codeMirror.execCommand('undoSelection');this._muteSelectionListener=false;}
selectNextOccurrence(){const selections=this._textEditor.selections();let anyEmptySelection=false;for(let i=0;i<selections.length;++i){const selection=selections[i];anyEmptySelection=anyEmptySelection||selection.isEmpty();if(selection.startLine!==selection.endLine)
return;}
if(anyEmptySelection){this._expandSelectionsToWords(selections);return;}
const last=selections[selections.length-1];let next=last;do
next=this._findNextOccurrence(next,!!this._fullWordSelection);while(next&&this._findRange(selections,next)&&!next.equal(last));if(!next)
return;selections.push(next);this._muteSelectionListener=true;this._textEditor.setSelections(selections,selections.length-1);delete this._muteSelectionListener;this._textEditor.scrollLineIntoView(next.startLine);}
_expandSelectionsToWords(selections){const newSelections=[];for(let i=0;i<selections.length;++i){const selection=selections[i];const startRangeWord=this._textEditor.wordRangeForCursorPosition(selection.startLine,selection.startColumn,TextUtils.TextUtils.isWordChar)||TextUtils.TextRange.createFromLocation(selection.startLine,selection.startColumn);const endRangeWord=this._textEditor.wordRangeForCursorPosition(selection.endLine,selection.endColumn,TextUtils.TextUtils.isWordChar)||TextUtils.TextRange.createFromLocation(selection.endLine,selection.endColumn);const newSelection=new TextUtils.TextRange(startRangeWord.startLine,startRangeWord.startColumn,endRangeWord.endLine,endRangeWord.endColumn);newSelections.push(newSelection);}
this._textEditor.setSelections(newSelections,newSelections.length-1);this._fullWordSelection=true;}
_findNextOccurrence(range,fullWord){range=range.normalize();let matchedLineNumber;let matchedColumnNumber;const textToFind=this._textEditor.text(range);function findWordInLine(wordRegex,lineNumber,lineText,from,to){if(typeof matchedLineNumber==='number')
return true;wordRegex.lastIndex=from;const result=wordRegex.exec(lineText);if(!result||result.index+textToFind.length>to)
return false;matchedLineNumber=lineNumber;matchedColumnNumber=result.index;return true;}
let iteratedLineNumber;function lineIterator(regex,lineHandle){if(findWordInLine(regex,iteratedLineNumber++,lineHandle.text,0,lineHandle.text.length))
return true;}
let regexSource=textToFind.escapeForRegExp();if(fullWord)
regexSource='\\b'+regexSource+'\\b';const wordRegex=new RegExp(regexSource,'g');const currentLineText=this._codeMirror.getLine(range.startLine);findWordInLine(wordRegex,range.startLine,currentLineText,range.endColumn,currentLineText.length);iteratedLineNumber=range.startLine+1;this._codeMirror.eachLine(range.startLine+1,this._codeMirror.lineCount(),lineIterator.bind(null,wordRegex));iteratedLineNumber=0;this._codeMirror.eachLine(0,range.startLine,lineIterator.bind(null,wordRegex));findWordInLine(wordRegex,range.startLine,currentLineText,0,range.startColumn);if(typeof matchedLineNumber!=='number')
return null;return new TextUtils.TextRange(matchedLineNumber,matchedColumnNumber,matchedLineNumber,matchedColumnNumber+textToFind.length);}};TextEditor.TextEditorPositionHandle=function(){};TextEditor.TextEditorPositionHandle.prototype={resolve(){},equal(positionHandle){}};TextEditor.CodeMirrorTextEditor._overrideModeWithPrefixedTokens('css','css-');TextEditor.CodeMirrorTextEditor._overrideModeWithPrefixedTokens('javascript','js-');TextEditor.CodeMirrorTextEditor._overrideModeWithPrefixedTokens('xml','xml-');TextEditor.CodeMirrorTextEditor._loadedMimeModeExtensions=new Set();TextEditor.CodeMirrorMimeMode=function(){};TextEditor.CodeMirrorMimeMode.prototype={install(extension){}};TextEditor.TextEditorBookMark=class{constructor(marker,type,editor){marker[TextEditor.TextEditorBookMark._symbol]=this;this._marker=marker;this._type=type;this._editor=editor;}
clear(){const position=this._marker.find();this._marker.clear();if(position)
this._editor._updateDecorations(position.line);}
refresh(){this._marker.changed();const position=this._marker.find();if(position)
this._editor._updateDecorations(position.line);}
type(){return this._type;}
position(){const pos=this._marker.find();return pos?TextUtils.TextRange.createFromLocation(pos.line,pos.ch):null;}};TextEditor.TextEditorBookMark._symbol=Symbol('TextEditor.TextEditorBookMark');TextEditor.CodeMirrorTextEditor.Decoration;TextEditor.CodeMirrorTextEditorFactory=class{createEditor(options){return new TextEditor.CodeMirrorTextEditor(options);}};CodeMirror.inputStyles.devToolsAccessibleTextArea=class extends CodeMirror.inputStyles.textarea{init(display){super.init(display);UI.ARIAUtils.setAccessibleName(this.textarea,this.cm.options.devtoolsAccessibleName||ls`Code editor`);this.textarea.addEventListener('compositionstart',this._onCompositionStart.bind(this));}
_onCompositionStart(){if(this.textarea.selectionEnd===this.textarea.value.length)
return;this.textarea.value=this.textarea.value.substring(0,this.textarea.selectionEnd);this.textarea.setSelectionRange(this.textarea.value.length,this.textarea.value.length);this.prevInput=this.textarea.value;}
reset(typing){if(typing||this.contextMenuPending||this.composing||this.cm.somethingSelected()){super.reset(typing);return;}
const cursor=this.cm.getCursor();let start,end;if(this.cm.options.lineWrapping){const top=this.cm.charCoords(cursor,'page').top;start=this.cm.coordsChar({left:-Infinity,top});end=this.cm.coordsChar({left:Infinity,top});}else{const offset=Math.floor(cursor.ch/1000)*1000;start={ch:offset,line:cursor.line};end={ch:offset+1000,line:cursor.line};}
this.textarea.value=this.cm.getRange(start,end);const caretPosition=cursor.ch-start.ch;this.textarea.setSelectionRange(caretPosition,caretPosition);this.prevInput=this.textarea.value;}
poll(){if(this.contextMenuPending||this.composing)
return super.poll();const text=this.textarea.value;let start=0;const length=Math.min(this.prevInput.length,text.length);while(start<length&&this.prevInput[start]===text[start])
++start;let end=0;while(end<length-start&&this.prevInput[this.prevInput.length-end-1]===text[text.length-end-1])
++end;const placeholder=this.textarea;this.textarea=(createElement('textarea'));this.textarea.value=text.substring(start,text.length-end);this.textarea.setSelectionRange(placeholder.selectionStart-start,placeholder.selectionEnd-start);this.prevInput='';const result=super.poll();this.prevInput=text;this.textarea=placeholder;return result;}};;Runtime.cachedResources["text_editor/autocompleteTooltip.css"]="/*\n * Copyright (c) 2018 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n.autocomplete-tooltip {\n  pointer-events: none;\n  margin-left: -3px;\n}\n\n.autocomplete-tooltip > div > * {\n  padding: 0px 4px;\n  white-space: nowrap;\n  vertical-align: middle;\n  line-height: 20px;\n  box-shadow: var(--drop-shadow);\n  background-color: #FFFFFF;\n  width: fit-content;\n}\n/*# sourceURL=text_editor/autocompleteTooltip.css */";Runtime.cachedResources["text_editor/cmdevtools.css"]=".CodeMirror {\n    line-height: 1.2em !important;\n    background-color: transparent !important;\n    color: #222;\n    height: 300px;\n}\n\n.CodeMirror-linewidget {\n    overflow: visible !important;\n}\n\n.CodeMirror-gutter-performance {\n    width: 60px;\n    background-color: white;\n    margin-left: 3px;\n}\n\n.CodeMirror-gutter-memory {\n    width: 48px;\n    background-color: white;\n    margin-left: 3px;\n}\n\n.CodeMirror-gutter-coverage {\n    width: 5px;\n    background-color: white;\n    margin-left: 3px;\n}\n\n.CodeMirror .source-frame-eval-expression {\n    outline: 0;\n    border: 1px solid rgb(163, 41, 34);\n    border-left-width: 0;\n    border-right-width: 0;\n    background-color: rgb(255, 255, 194);\n}\n\n.CodeMirror .source-frame-eval-expression-start {\n    border-left-width: 1px;\n    margin-left: -1px;\n}\n\n.CodeMirror .source-frame-eval-expression-end {\n    border-right-width: 1px;\n    margin-right: -1px;\n}\n\n.CodeMirror .source-frame-continue-to-location {\n    outline: 0;\n    border: 1px solid transparent;\n    border-left-width: 0;\n    border-right-width: 0;\n    background-color: rgb(230, 236, 255);\n    cursor: pointer;\n}\n\n.CodeMirror .source-frame-continue-to-location:hover {\n    border: 1px solid rgb(121, 141, 254);\n    background-color: rgb(171, 191, 254);\n}\n\n:host-context(.-theme-with-dark-background) .CodeMirror .source-frame-continue-to-location,\n.-theme-with-dark-background .CodeMirror .source-frame-continue-to-location {\n    background-color: #14522b;\n}\n\n:host-context(.-theme-with-dark-background) .CodeMirror .source-frame-continue-to-location:hover,\n.-theme-with-dark-background .CodeMirror .source-frame-continue-to-location:hover {\n    border: 1px solid #33cc6b;\n    background-color: #14522b;\n}\n\n.CodeMirror .source-frame-continue-to-location-start {\n    border-left-width: 1px;\n    margin-left: -1px;\n}\n\n.CodeMirror .source-frame-continue-to-location-end {\n    border-right-width: 1px;\n    margin-right: -1px;\n}\n\n.CodeMirror .source-frame-async-step-in {\n    outline: 0;\n    background-color: hsla(100, 46%, 80%, 1);\n    cursor: pointer;\n    border: 1px solid transparent;\n    border-left-width: 0;\n    border-right-width: 0;\n}\n\n.source-frame-async-step-in-hovered .source-frame-async-step-in {\n    background-color: hsl(96, 53%, 65%);\n    border-color: rgb(100, 154, 100);\n}\n\n.source-frame-async-step-in-hovered .source-frame-async-step-in-start {\n    border-left-width: 1px;\n    margin-left: -1px;\n}\n\n.source-frame-async-step-in-hovered .source-frame-async-step-in-end {\n    border-right-width: 1px;\n    margin-right: -1px;\n}\n\n.CodeMirror-readonly .CodeMirror-cursor {\n    display: none;\n}\n\n.CodeMirror-gutters {\n    border-right: 1px solid var(--divider-color);\n    white-space: nowrap;\n    background-color: white;\n}\n\n.CodeMirror-linenumber {\n    color: hsl(0, 0%, 46%);\n    padding: 0 3px 0 5px;\n    min-width: 22px;\n    text-align: right;\n    white-space: nowrap;\n}\n\n.pretty-printed .CodeMirror-linenumber {\n    color: var(--accent-color);\n}\n\n.cm-highlight {\n    -webkit-animation: fadeout 2s 0s;\n}\n:host-context(.-theme-with-dark-background) .cm-highlight,\n.-theme-with-dark-background .cm-highlight {\n    -webkit-animation: fadeout-dark 2s 0s;\n}\n@-webkit-keyframes fadeout {\n    from {background-color: rgb(255, 255, 120); }\n    to { background-color: white; }\n}\n@-webkit-keyframes fadeout-dark {\n    from {background-color: hsla(133, 100%, 30%, 0.5); }\n    to { background-color: transparent; }\n}\n\n.cm-readonly-highlight {\n    background-color: rgb(255, 255, 120);\n}\n:host-context(.-theme-with-dark-background) .cm-readonly-highlight,\n.-theme-with-dark-background .cm-readonly-highlight {\n    background-color: hsla(133, 100%, 30%, 0.5);\n}\n\n.cm-highlight.cm-execution-line {\n    -webkit-animation: fadeout-execution-line 1s 0s;\n}\n:host-context(.-theme-with-dark-background) .cm-highlight.cm-execution-line,\n.-theme-with-dark-background .cm-highlight.cm-execution-line {\n    -webkit-animation: fadeout-execution-line-dark 1s 0s;\n}\n\n@-webkit-keyframes fadeout-execution-line {\n    from {background-color: rgb(121, 141, 254); }\n    to { background-color: rgb(171, 191, 254); }\n}\n@-webkit-keyframes fadeout-execution-line-dark {\n    from {background-color: #208043; }\n    to { background-color: #14522b; }\n}\n\n.cm-breakpoint .CodeMirror-gutter-wrapper .CodeMirror-linenumber, -theme-preserve {\n    color: white;\n    border-width: 1px 4px 1px 1px !important;\n    -webkit-border-image: url(Images/breakpoint.svg) 1 4 1 1;\n    margin: 0 0 0 3px !important;\n    padding-right: 3px;\n    padding-left: 1px;\n    height: 11px;\n    line-height: 12px !important;\n    border-style: solid;\n}\n\n.cm-line-without-source-mapping .CodeMirror-linenumber {\n    color: rgba(128, 128, 128, 0.4);\n}\n\n.cm-breakpoint.cm-breakpoint-conditional .CodeMirror-linenumber {\n    -webkit-border-image: url(Images/breakpointConditional.svg) 1 4 1 1;\n}\n\n:host-context(.-theme-with-dark-background) .cm-breakpoint:not(.cm-breakpoint-conditional) .CodeMirror-gutter-wrapper .CodeMirror-linenumber,\n.-theme-with-dark-background .cm-breakpoint:not(.cm-breakpoint-conditional) .CodeMirror-gutter-wrapper .CodeMirror-linenumber {\n    filter: hue-rotate(-139deg);\n}\n\n.cm-breakpoint-disabled .CodeMirror-linenumber {\n    opacity: 0.5;\n}\n\n.breakpoints-deactivated .cm-breakpoint .CodeMirror-linenumber {\n    opacity: 0.5;\n}\n\n.breakpoints-deactivated .cm-breakpoint-disabled .CodeMirror-linenumber {\n    opacity: 0.3;\n}\n\n.cm-inline-breakpoint {\n    position:relative;\n    top: 2px;\n    cursor: pointer;\n}\n\n.cm-execution-line-tail + .CodeMirror-widget {\n    background-color: #abbffe;\n}\n\n.source-frame-eval-expression + .CodeMirror-widget {\n    border: 1px solid rgb(163, 41, 34);\n    border-left-width: 0;\n    border-right-width: 0;\n    background-color: rgb(255, 255, 194);\n}\n\n.cm-inline-breakpoint.cm-execution-line-tail {\n    background-color: #698cfe;\n}\n\n.cm-execution-line-tail .cm-inline-breakpoint {\n    background-color: white\n}\n\n.cm-inline-breakpoint.cm-inline-conditional {\n    background-color: #ef9d0d;\n}\n\n.cm-inline-breakpoint.cm-inline-disabled {\n    opacity: 0.5;\n}\n\n.cm-continue-to-location {\n    cursor: pointer;\n    opacity: 0.8;\n    position: relative;\n    top: 2px;\n}\n\n.cm-continue-to-location:hover {\n    opacity: 1;\n}\n\ndiv.CodeMirror:focus-within span.CodeMirror-matchingbracket {\n    background-color: rgba(0, 0, 0, 0.07);\n    border-bottom: 1px solid rgba(0, 0, 0, 0.5);\n}\n\ndiv.CodeMirror:focus-within span.CodeMirror-nonmatchingbracket {\n    background-color: rgba(255, 0, 0, 0.07);\n    border-bottom: 1px solid rgba(255, 0, 0, 0.5);\n}\n\n:host-context(.-theme-with-dark-background) div.CodeMirror:focus-within span.CodeMirror-matchingbracket,\n.-theme-with-dark-background div.CodeMirror:focus-within span.CodeMirror-matchingbracket {\n    border-bottom: 1px solid rgb(217,217,217);\n    background-color:initial;\n}\n\n:host-context(.-theme-with-dark-background) div.CodeMirror:focus-within span.CodeMirror-nonmatchingbracket,\n.-theme-with-dark-background div.CodeMirror:focus-within span.CodeMirror-nonmatchingbracket {\n    border-bottom: 1px solid rgb(255, 26, 26);\n    background-color:initial;\n}\n\n.cm-whitespace::before {\n    position: absolute;\n    pointer-events: none;\n    color: rgb(175, 175, 175);\n}\n\n.cm-tab {\n    display: inline-block;\n    text-decoration: inherit;\n    position: relative;\n}\n\n.cm-tab:before {\n    display: none;\n    content: \".\";\n    color: transparent;\n    border-bottom: 1px solid rgb(175, 175, 175);\n    position: absolute;\n    width: 90%;\n    bottom: 50%;\n    left: 5%;\n}\n\n.show-whitespaces .CodeMirror .cm-tab:before {\n    display: block !important;\n}\n\n.cm-execution-line {\n    background-color: rgba(0, 59, 255, 0.10);\n}\n\n.cm-execution-line-outline {\n    outline: 1px solid rgb(64, 115, 244);\n}\n\n.cm-execution-line-tail {\n    background-color: rgb(171, 191, 254);\n}\n\n.cm-execution-line .CodeMirror-linenumber::after {\n    position: absolute;\n    top:-1px;\n    bottom:-1px;\n    right:-1.5em;\n    content:\"\";\n    border-right: 1px solid rgb(64, 115, 244);\n}\n\n:host-context(.-theme-with-dark-background) .cm-execution-line,\n.-theme-with-dark-background .cm-execution-line {\n    background-color: #14522b;\n}\n\n:host-context(.-theme-with-dark-background) .cm-execution-line-outline,\n.-theme-with-dark-background .cm-execution-line-outline {\n    outline: 1px solid #33cc6b;\n}\n\n:host-context(.-theme-with-dark-background) .cm-execution-line-tail,\n.-theme-with-dark-background .cm-execution-line-tail {\n    background-color: #347132;\n}\n\n.cm-token-highlight {\n    position: relative;\n}\n\n.cm-token-highlight:before {\n    position: absolute;\n    border: 1px solid gray;\n    border-radius: 3px;\n    top: 0;\n    bottom: -1px;\n    left: 0;\n    right: 0;\n    content: \"\";\n}\n\n.cm-line-with-selection .cm-column-with-selection:before {\n    border: none;\n}\n\n.cm-search-highlight {\n    position: relative;\n}\n\n.cm-search-highlight:before {\n    position: absolute;\n    border-top-style: solid;\n    border-bottom-style: solid;\n    border-top-color: gray;\n    border-bottom-color: gray;\n    border-top-width: 1px;\n    border-bottom-width: 1px;\n    top: -1px;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    content: \"\";\n}\n\n.cm-search-highlight-full:before {\n    border: 1px solid gray;\n    border-radius: 3px;\n}\n\n.cm-search-highlight-start:before {\n    border-left-width: 1px;\n    border-top-left-radius: 2px;\n    border-bottom-left-radius: 2px;\n    border-left-style: solid;\n    border-left-color: gray;\n}\n\n.cm-search-highlight-end:before {\n    border-right-width: 1px;\n    border-top-right-radius: 2px;\n    border-bottom-right-radius: 2px;\n    border-right-style: solid;\n    border-right-color: gray;\n}\n\n.cm-line-with-selection .cm-column-with-selection.cm-search-highlight-full:before {\n    border-radius: 1px;\n}\n\n.cm-line-with-selection .cm-column-with-selection.cm-search-highlight-start:before {\n    border-top-left-radius: 1px;\n    border-bottom-left-radius: 1px;\n}\n\n.cm-line-with-selection .cm-column-with-selection.cm-search-highlight-end:before {\n    border-top-right-radius: 1px;\n    border-bottom-right-radius: 1px;\n}\n\n.cm-line-with-selection .cm-column-with-selection.cm-search-highlight:before {\n    margin: -1px -1px -1px -1px;\n    background-color: rgb(241, 234, 0);\n    z-index: -1;\n}\n\n:host-context(.-theme-with-dark-background) .cm-line-with-selection .cm-column-with-selection.cm-search-highlight:before,\n.-theme-with-dark-background .cm-line-with-selection .cm-column-with-selection.cm-search-highlight:before {\n    background-color: hsl(133, 100%, 30%);\n}\n\n:host-context(.-theme-with-dark-background) .cm-line-with-selection .cm-search-highlight,\n.-theme-with-dark-background .cm-line-with-selection .cm-search-highlight {\n    color: #eee;\n}\n\n.CodeMirror .text-editor-line-marker-text {\n    text-align: right;\n    padding-right: 3px;\n    height: 12px;\n}\n\n.CodeMirror .text-editor-line-marker-text span.line-marker-units {\n    color: #555;\n    font-size: 75%;\n    margin-left: 3px;\n}\n\n.CodeMirror .text-editor-coverage-unused-marker {\n    text-align: right;\n    padding-right: 2px;\n    background-color: #E57373;\n}\n\n.CodeMirror .text-editor-coverage-unused-marker::after {\n    content: \"\\200B\";\n}\n\n.CodeMirror .text-editor-coverage-used-marker {\n    text-align: right;\n    padding-right: 2px;\n    background-color: #81C784;\n}\n\n.CodeMirror .text-editor-coverage-used-marker::after {\n    content: \"\\200B\";\n}\n\n.CodeMirror .text-editor-line-decoration {\n    position: absolute;\n}\n\n.CodeMirror .text-editor-line-decoration-wave {\n    position: absolute;\n    top: -2px;\n    right: -4px;\n    left: 4px;\n    cursor: pointer;\n    height: 4px;\n}\n\n.CodeMirror .text-editor-value-decoration {\n    position: absolute;\n    bottom: 0;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 1000px;\n    opacity: 0.8;\n    background-color: #FFE3C7;\n    margin-left: 10px;\n    padding-left: 5px;\n    color: #222;\n    -webkit-user-select: text;\n}\n\n.CodeMirror .cm-execution-line .text-editor-value-decoration {\n    background-color: transparent;\n    opacity: 0.5;\n}\n\n.CodeMirror .text-editor-line-decoration-icon {\n    position: absolute;\n    cursor: pointer;\n    right: -16px;\n    top: -9px;\n}\n\n.CodeMirror .text-editor-line-with-warning:not(.cm-execution-line):not(.cm-readonly-highlight) {\n    background-color: rgba(241, 230, 0, 0.1);\n}\n\n.CodeMirror .text-editor-line-with-error:not(.cm-execution-line):not(.cm-readonly-highlight) {\n    background-color: rgba(255, 0, 0, 0.05);\n}\n\n.CodeMirror .text-editor-line-decoration-wave {\n    background-image: url(Images/errorWave.svg);\n    background-repeat: repeat-x;\n    background-size: contain;\n}\n\n/** @see crbug.com/358161 */\n.CodeMirror .CodeMirror-vscrollbar, .CodeMirror .CodeMirror-hscrollbar {\n    transform: translateZ(0);\n}\n\n.cm-trailing-whitespace {\n    background-color: rgba(255, 0, 0, 0.05);\n}\n\n.CodeMirror-activeline .cm-trailing-whitespace {\n    background-color: transparent;\n}\n\n:host-context(.-theme-with-dark-background) .CodeMirror .CodeMirror-selected,\n.-theme-with-dark-background .CodeMirror .CodeMirror-selected {\n    background-color: #454545;\n}\n\n.CodeMirror .auto-complete-text {\n    color: rgb(128,128,128);\n}\n\n.CodeMirror .placeholder-text {\n    height: 0;\n    color: rgb(128,128,128);\n}\n\n/** Prevent the codemirror textarea from stealing PageUp events **/\n.CodeMirror textarea {\n    resize: none;\n    overflow: hidden;\n}\n\n.CodeMirror-lines {\n    padding: 4px 0; /* Vertical padding around content */\n}\n\n.CodeMirror pre {\n    padding: 0 4px; /* Horizontal padding of content */\n}\n\n.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {\n    background-color: white; /* The little square between H and V scrollbars */\n}\n\n.CodeMirror-cursor {\n    border-left: 1px solid black;\n    border-right: none;\n    width: 0;\n}\n\n/* Shown when moving in bi-directional text */\n.CodeMirror div.CodeMirror-secondarycursor {\n    border-left: 1px solid silver;\n}\n\n.CodeMirror-composing {\n    border-bottom: 2px solid;\n}\n\n.pretty-printed .CodeMirror-linenumber {\n    color: var(--accent-color);\n}\n\n.CodeMirror-foldmarker {\n    cursor: pointer;\n    font-size: 0;\n    line-height: 0;\n    height:0px;\n}\n\n.CodeMirror-foldmarker::before {\n    content: '\\2026';\n    font-size: 13px;\n    color: #666;\n}\n\n.CodeMirror-foldgutter {\n    width: 1.5em;\n}\n\n.CodeMirror-gutters:hover .CodeMirror-foldgutter {\n    background-color: transparent;\n}\n\n.CodeMirror-foldgutter-open,\n.CodeMirror-foldgutter-folded {\n    cursor: pointer;\n    position: relative;\n}\n\n.CodeMirror-foldgutter-open {\n    transition: opacity .2s;\n    opacity: 0;\n}\n\n.CodeMirror-gutter-hovered .CodeMirror-foldgutter-open {\n    opacity: 1;\n}\n\n.CodeMirror-foldgutter-open::before,\n.CodeMirror-foldgutter-folded::before {\n    background-color: #727272;\n    -webkit-user-select: none;\n    -webkit-mask-image: url(Images/treeoutlineTriangles.svg);\n    -webkit-mask-size: 32px 24px;\n    content: \"\";\n    display:block;\n    width: 8px;\n    color: transparent;\n    text-shadow: none;\n    height: 12px;\n    position: absolute;\n    right: 4px;\n}\n\n.CodeMirror-foldgutter-open::before {\n    -webkit-mask-position: -16px 0;\n}\n\n.CodeMirror-foldgutter-folded::before {\n    -webkit-mask-position: 0 0;\n}\n\n.CodeMirror .CodeMirror-selected {\n    background-color: var(--item-selection-inactive-bg-color);\n}\n\n.CodeMirror-focused .CodeMirror-selected {\n    background-color: var(--item-selection-bg-color);\n}\n\n.CodeMirror .CodeMirror-line::selection,\n.CodeMirror .CodeMirror-line > span::selection,\n.CodeMirror .CodeMirror-line > span > span::selection {\n    background: var(--item-selection-bg-color);\n}\n\n/*# sourceURL=text_editor/cmdevtools.css */";TimelineModel.TimelineModelFilter=class{accept(event){return true;}};TimelineModel.TimelineVisibleEventsFilter=class extends TimelineModel.TimelineModelFilter{constructor(visibleTypes){super();this._visibleTypes=new Set(visibleTypes);}
accept(event){return this._visibleTypes.has(TimelineModel.TimelineVisibleEventsFilter._eventType(event));}
static _eventType(event){if(event.hasCategory(TimelineModel.TimelineModel.Category.Console))
return TimelineModel.TimelineModel.RecordType.ConsoleTime;if(event.hasCategory(TimelineModel.TimelineModel.Category.UserTiming))
return TimelineModel.TimelineModel.RecordType.UserTiming;if(event.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo))
return TimelineModel.TimelineModel.RecordType.LatencyInfo;return(event.name);}};TimelineModel.TimelineInvisibleEventsFilter=class extends TimelineModel.TimelineModelFilter{constructor(invisibleTypes){super();this._invisibleTypes=new Set(invisibleTypes);}
accept(event){return!this._invisibleTypes.has(TimelineModel.TimelineVisibleEventsFilter._eventType(event));}};TimelineModel.ExclusiveNameFilter=class extends TimelineModel.TimelineModelFilter{constructor(excludeNames){super();this._excludeNames=new Set(excludeNames);}
accept(event){return!this._excludeNames.has(event.name);}};;TimelineModel.TracingLayerPayload;TimelineModel.TracingLayerTile;TimelineModel.TracingLayerTree=class extends SDK.LayerTreeBase{constructor(target){super(target);this._tileById=new Map();this._paintProfilerModel=target&&target.model(SDK.PaintProfilerModel);}
async setLayers(root,layers,paints){const idsToResolve=new Set();if(root){this._extractNodeIdsToResolve(idsToResolve,{},root);}else{for(let i=0;i<layers.length;++i)
this._extractNodeIdsToResolve(idsToResolve,{},layers[i]);}
await this.resolveBackendNodeIds(idsToResolve);const oldLayersById=this._layersById;this._layersById={};this.setContentRoot(null);if(root){const convertedLayers=this._innerSetLayers(oldLayersById,root);this.setRoot(convertedLayers);}else{const processedLayers=layers.map(this._innerSetLayers.bind(this,oldLayersById));const contentRoot=this.contentRoot();this.setRoot(contentRoot);for(let i=0;i<processedLayers.length;++i){if(processedLayers[i].id()!==contentRoot.id())
contentRoot.addChild(processedLayers[i]);}}
this._setPaints(paints);}
setTiles(tiles){this._tileById=new Map();for(const tile of tiles)
this._tileById.set(tile.id,tile);}
pictureForRasterTile(tileId){const tile=this._tileById.get('cc::Tile/'+tileId);if(!tile){Common.console.error(`Tile ${tileId} is missing`);return(Promise.resolve(null));}
const layer=this.layerById(tile.layer_id);if(!layer){Common.console.error(`Layer ${tile.layer_id} for tile ${tileId} is not found`);return(Promise.resolve(null));}
return layer._pictureForRect(tile.content_rect);}
_setPaints(paints){for(let i=0;i<paints.length;++i){const layer=this._layersById[paints[i].layerId()];if(layer)
layer._addPaintEvent(paints[i]);}}
_innerSetLayers(oldLayersById,payload){let layer=(oldLayersById[payload.layer_id]);if(layer)
layer._reset(payload);else
layer=new TimelineModel.TracingLayer(this._paintProfilerModel,payload);this._layersById[payload.layer_id]=layer;if(payload.owner_node)
layer._setNode(this.backendNodeIdToNode().get(payload.owner_node)||null);if(!this.contentRoot()&&layer.drawsContent())
this.setContentRoot(layer);for(let i=0;payload.children&&i<payload.children.length;++i)
layer.addChild(this._innerSetLayers(oldLayersById,payload.children[i]));return layer;}
_extractNodeIdsToResolve(nodeIdsToResolve,seenNodeIds,payload){const backendNodeId=payload.owner_node;if(backendNodeId&&!this.backendNodeIdToNode().has(backendNodeId))
nodeIdsToResolve.add(backendNodeId);for(let i=0;payload.children&&i<payload.children.length;++i)
this._extractNodeIdsToResolve(nodeIdsToResolve,seenNodeIds,payload.children[i]);}};TimelineModel.TracingLayer=class{constructor(paintProfilerModel,payload){this._paintProfilerModel=paintProfilerModel;this._reset(payload);}
_reset(payload){this._node=null;this._layerId=String(payload.layer_id);this._offsetX=payload.position[0];this._offsetY=payload.position[1];this._width=payload.bounds.width;this._height=payload.bounds.height;this._children=[];this._parentLayerId=null;this._parent=null;this._quad=payload.layer_quad||[];this._createScrollRects(payload);this._compositingReasons=payload.compositing_reasons||[];this._drawsContent=!!payload.draws_content;this._gpuMemoryUsage=payload.gpu_memory_usage;this._paints=[];}
id(){return this._layerId;}
parentId(){return this._parentLayerId;}
parent(){return this._parent;}
isRoot(){return!this.parentId();}
children(){return this._children;}
addChild(child){if(child._parent)
console.assert(false,'Child already has a parent');this._children.push(child);child._parent=this;child._parentLayerId=this._layerId;}
_setNode(node){this._node=node;}
node(){return this._node;}
nodeForSelfOrAncestor(){for(let layer=this;layer;layer=layer._parent){if(layer._node)
return layer._node;}
return null;}
offsetX(){return this._offsetX;}
offsetY(){return this._offsetY;}
width(){return this._width;}
height(){return this._height;}
transform(){return null;}
quad(){return this._quad;}
anchorPoint(){return[0.5,0.5,0];}
invisible(){return false;}
paintCount(){return 0;}
lastPaintRect(){return null;}
scrollRects(){return this._scrollRects;}
stickyPositionConstraint(){return null;}
gpuMemoryUsage(){return this._gpuMemoryUsage;}
snapshots(){return this._paints.map(paint=>paint.snapshotPromise().then(snapshot=>{if(!snapshot)
return null;const rect={x:snapshot.rect[0],y:snapshot.rect[1],width:snapshot.rect[2],height:snapshot.rect[3]};return{rect:rect,snapshot:snapshot.snapshot};}));}
_pictureForRect(targetRect){return Promise.all(this._paints.map(paint=>paint.picturePromise())).then(pictures=>{const fragments=pictures.filter(picture=>picture&&rectsOverlap(picture.rect,targetRect)).map(picture=>({x:picture.rect[0],y:picture.rect[1],picture:picture.serializedPicture}));if(!fragments.length||!this._paintProfilerModel)
return null;const x0=fragments.reduce((min,item)=>Math.min(min,item.x),Infinity);const y0=fragments.reduce((min,item)=>Math.min(min,item.y),Infinity);const rect={x:targetRect[0]-x0,y:targetRect[1]-y0,width:targetRect[2],height:targetRect[3]};return this._paintProfilerModel.loadSnapshotFromFragments(fragments).then(snapshot=>snapshot?{rect:rect,snapshot:snapshot}:null);});function segmentsOverlap(a1,a2,b1,b2){console.assert(a1<=a2&&b1<=b2,'segments should be specified as ordered pairs');return a2>b1&&a1<b2;}
function rectsOverlap(a,b){return segmentsOverlap(a[0],a[0]+a[2],b[0],b[0]+b[2])&&segmentsOverlap(a[1],a[1]+a[3],b[1],b[1]+b[3]);}}
_scrollRectsFromParams(params,type){return{rect:{x:params[0],y:params[1],width:params[2],height:params[3]},type:type};}
_createScrollRects(payload){this._scrollRects=[];if(payload.non_fast_scrollable_region){this._scrollRects.push(this._scrollRectsFromParams(payload.non_fast_scrollable_region,SDK.Layer.ScrollRectType.NonFastScrollable.name));}
if(payload.touch_event_handler_region){this._scrollRects.push(this._scrollRectsFromParams(payload.touch_event_handler_region,SDK.Layer.ScrollRectType.TouchEventHandler.name));}
if(payload.wheel_event_handler_region){this._scrollRects.push(this._scrollRectsFromParams(payload.wheel_event_handler_region,SDK.Layer.ScrollRectType.WheelEventHandler.name));}
if(payload.scroll_event_handler_region){this._scrollRects.push(this._scrollRectsFromParams(payload.scroll_event_handler_region,SDK.Layer.ScrollRectType.RepaintsOnScroll.name));}}
_addPaintEvent(paint){this._paints.push(paint);}
requestCompositingReasons(){return Promise.resolve(this._compositingReasons);}
drawsContent(){return this._drawsContent;}};;TimelineModel.TimelineModel=class{constructor(){this._reset();}
static forEachEvent(events,onStartEvent,onEndEvent,onInstantEvent,startTime,endTime,filter){startTime=startTime||0;endTime=endTime||Infinity;const stack=[];const startEvent=TimelineModel.TimelineModel._topLevelEventEndingAfter(events,startTime);for(let i=startEvent;i<events.length;++i){const e=events[i];if((e.endTime||e.startTime)<startTime)
continue;if(e.startTime>=endTime)
break;if(SDK.TracingModel.isAsyncPhase(e.phase)||SDK.TracingModel.isFlowPhase(e.phase))
continue;while(stack.length&&stack.peekLast().endTime<=e.startTime)
onEndEvent(stack.pop());if(filter&&!filter(e))
continue;if(e.duration){onStartEvent(e);stack.push(e);}else{onInstantEvent&&onInstantEvent(e,stack.peekLast()||null);}}
while(stack.length)
onEndEvent(stack.pop());}
static _topLevelEventEndingAfter(events,time){let index=events.upperBound(time,(time,event)=>time-event.startTime)-1;while(index>0&&!SDK.TracingModel.isTopLevelEvent(events[index]))
index--;return Math.max(index,0);}
isMarkerEvent(event){const recordTypes=TimelineModel.TimelineModel.RecordType;switch(event.name){case recordTypes.TimeStamp:return true;case recordTypes.MarkFirstPaint:case recordTypes.MarkFCP:case recordTypes.MarkFMP:return this._mainFrame&&event.args.frame===this._mainFrame.frameId&&!!event.args.data;case recordTypes.MarkDOMContent:case recordTypes.MarkLoad:case recordTypes.MarkLCPCandidate:case recordTypes.MarkLCPInvalidate:return!!event.args['data']['isMainFrame'];default:return false;}}
isLCPCandidateEvent(event){return event.name===TimelineModel.TimelineModel.RecordType.MarkLCPCandidate&&!!event.args['data']['isMainFrame'];}
isLCPInvalidateEvent(event){return event.name===TimelineModel.TimelineModel.RecordType.MarkLCPInvalidate&&!!event.args['data']['isMainFrame'];}
static globalEventId(event,field){const data=event.args['data']||event.args['beginData'];const id=data&&data[field];if(!id)
return'';return`${event.thread.process().id()}.${id}`;}
static eventFrameId(event){const data=event.args['data']||event.args['beginData'];return data&&data['frame']||'';}
cpuProfiles(){return this._cpuProfiles;}
targetByEvent(event){const workerId=this._workerIdByThread.get(event.thread);const mainTarget=SDK.targetManager.mainTarget();return workerId?SDK.targetManager.targetById(workerId):mainTarget;}
setEvents(tracingModel){this._reset();this._resetProcessingState();this._tracingModel=tracingModel;this._minimumRecordTime=tracingModel.minimumRecordTime();this._maximumRecordTime=tracingModel.maximumRecordTime();this._processSyncBrowserEvents(tracingModel);if(this._browserFrameTracking){this._processThreadsForBrowserFrames(tracingModel);}else{const metadataEvents=this._processMetadataEvents(tracingModel);this._isGenericTrace=!metadataEvents;if(metadataEvents)
this._processMetadataAndThreads(tracingModel,metadataEvents);else
this._processGenericTrace(tracingModel);}
this._inspectedTargetEvents.sort(SDK.TracingModel.Event.compareStartTime);this._processAsyncBrowserEvents(tracingModel);this._buildGPUEvents(tracingModel);this._resetProcessingState();}
_processGenericTrace(tracingModel){let browserMainThread=SDK.TracingModel.browserMainThread(tracingModel);if(!browserMainThread&&tracingModel.sortedProcesses().length)
browserMainThread=tracingModel.sortedProcesses()[0].sortedThreads()[0];for(const process of tracingModel.sortedProcesses()){for(const thread of process.sortedThreads()){this._processThreadEvents(tracingModel,[{from:0,to:Infinity}],thread,thread===browserMainThread,false,true,null);}}}
_processMetadataAndThreads(tracingModel,metadataEvents){let startTime=0;for(let i=0,length=metadataEvents.page.length;i<length;i++){const metaEvent=metadataEvents.page[i];const process=metaEvent.thread.process();const endTime=i+1<length?metadataEvents.page[i+1].startTime:Infinity;if(startTime===endTime)
continue;this._legacyCurrentPage=metaEvent.args['data']&&metaEvent.args['data']['page'];for(const thread of process.sortedThreads()){let workerUrl=null;if(thread.name()===TimelineModel.TimelineModel.WorkerThreadName||thread.name()===TimelineModel.TimelineModel.WorkerThreadNameLegacy){const workerMetaEvent=metadataEvents.workers.find(e=>{if(e.args['data']['workerThreadId']!==thread.id())
return false;if(e.args['data']['sessionId']===this._sessionId)
return true;return!!this._pageFrames.get(TimelineModel.TimelineModel.eventFrameId(e));});if(!workerMetaEvent)
continue;const workerId=workerMetaEvent.args['data']['workerId'];if(workerId)
this._workerIdByThread.set(thread,workerId);workerUrl=workerMetaEvent.args['data']['url']||'';}
this._processThreadEvents(tracingModel,[{from:startTime,to:endTime}],thread,thread===metaEvent.thread,!!workerUrl,true,workerUrl);}
startTime=endTime;}}
_processThreadsForBrowserFrames(tracingModel){const processData=new Map();for(const frame of this._pageFrames.values()){for(let i=0;i<frame.processes.length;i++){const pid=frame.processes[i].processId;let data=processData.get(pid);if(!data){data=[];processData.set(pid,data);}
const to=i===frame.processes.length-1?(frame.deletedTime||Infinity):frame.processes[i+1].time;data.push({from:frame.processes[i].time,to:to,main:!frame.parent,url:frame.processes[i].url});}}
const allMetadataEvents=tracingModel.devToolsMetadataEvents();for(const process of tracingModel.sortedProcesses()){const data=processData.get(process.id());if(!data)
continue;data.sort((a,b)=>a.from-b.from||a.to-b.to);const ranges=[];let lastUrl=null;let lastMainUrl=null;let hasMain=false;for(const item of data){if(!ranges.length||item.from>ranges.peekLast().to)
ranges.push({from:item.from,to:item.to});else
ranges.peekLast().to=item.to;if(item.main)
hasMain=true;if(item.url){if(item.main)
lastMainUrl=item.url;lastUrl=item.url;}}
for(const thread of process.sortedThreads()){if(thread.name()===TimelineModel.TimelineModel.RendererMainThreadName){this._processThreadEvents(tracingModel,ranges,thread,true,false,hasMain,hasMain?lastMainUrl:lastUrl);}else if(thread.name()===TimelineModel.TimelineModel.WorkerThreadName||thread.name()===TimelineModel.TimelineModel.WorkerThreadNameLegacy){const workerMetaEvent=allMetadataEvents.find(e=>{if(e.name!==TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingSessionIdForWorker)
return false;if(e.thread.process()!==process)
return false;if(e.args['data']['workerThreadId']!==thread.id())
return false;return!!this._pageFrames.get(TimelineModel.TimelineModel.eventFrameId(e));});if(!workerMetaEvent)
continue;this._workerIdByThread.set(thread,workerMetaEvent.args['data']['workerId']||'');this._processThreadEvents(tracingModel,ranges,thread,false,true,false,workerMetaEvent.args['data']['url']||'');}else{this._processThreadEvents(tracingModel,ranges,thread,false,false,false,null);}}}}
_processMetadataEvents(tracingModel){const metadataEvents=tracingModel.devToolsMetadataEvents();const pageDevToolsMetadataEvents=[];const workersDevToolsMetadataEvents=[];for(const event of metadataEvents){if(event.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingStartedInPage){pageDevToolsMetadataEvents.push(event);if(event.args['data']&&event.args['data']['persistentIds'])
this._persistentIds=true;const frames=((event.args['data']&&event.args['data']['frames'])||[]);frames.forEach(payload=>this._addPageFrame(event,payload));this._mainFrame=this.rootFrames()[0];}else if(event.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingSessionIdForWorker){workersDevToolsMetadataEvents.push(event);}else if(event.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingStartedInBrowser){console.assert(!this._mainFrameNodeId,'Multiple sessions in trace');this._mainFrameNodeId=event.args['frameTreeNodeId'];}}
if(!pageDevToolsMetadataEvents.length)
return null;const sessionId=pageDevToolsMetadataEvents[0].args['sessionId']||pageDevToolsMetadataEvents[0].args['data']['sessionId'];this._sessionId=sessionId;const mismatchingIds=new Set();function checkSessionId(event){let args=event.args;if(args['data'])
args=args['data'];const id=args['sessionId'];if(id===sessionId)
return true;mismatchingIds.add(id);return false;}
const result={page:pageDevToolsMetadataEvents.filter(checkSessionId).sort(SDK.TracingModel.Event.compareStartTime),workers:workersDevToolsMetadataEvents.sort(SDK.TracingModel.Event.compareStartTime)};if(mismatchingIds.size){Common.console.error('Timeline recording was started in more than one page simultaneously. Session id mismatch: '+
this._sessionId+' and '+mismatchingIds.valuesArray()+'.');}
return result;}
_processSyncBrowserEvents(tracingModel){const browserMain=SDK.TracingModel.browserMainThread(tracingModel);if(browserMain)
browserMain.events().forEach(this._processBrowserEvent,this);}
_processAsyncBrowserEvents(tracingModel){const browserMain=SDK.TracingModel.browserMainThread(tracingModel);if(browserMain)
this._processAsyncEvents(browserMain,[{from:0,to:Infinity}]);}
_buildGPUEvents(tracingModel){const thread=tracingModel.threadByName('GPU Process','CrGpuMain');if(!thread)
return;const gpuEventName=TimelineModel.TimelineModel.RecordType.GPUTask;const track=this._ensureNamedTrack(TimelineModel.TimelineModel.TrackType.GPU);track.thread=thread;track.events=thread.events().filter(event=>event.name===gpuEventName);}
_resetProcessingState(){this._asyncEventTracker=new TimelineModel.TimelineAsyncEventTracker();this._invalidationTracker=new TimelineModel.InvalidationTracker();this._layoutInvalidate={};this._lastScheduleStyleRecalculation={};this._paintImageEventByPixelRefId={};this._lastPaintForLayer={};this._lastRecalculateStylesEvent=null;this._currentScriptEvent=null;this._eventStack=[];this._knownInputEvents=new Set();this._browserFrameTracking=false;this._persistentIds=false;this._legacyCurrentPage=null;}
_extractCpuProfile(tracingModel,thread){const events=thread.events();let cpuProfile;let target=null;let cpuProfileEvent=events.peekLast();if(cpuProfileEvent&&cpuProfileEvent.name===TimelineModel.TimelineModel.RecordType.CpuProfile){const eventData=cpuProfileEvent.args['data'];cpuProfile=(eventData&&eventData['cpuProfile']);target=this.targetByEvent(cpuProfileEvent);}
if(!cpuProfile){cpuProfileEvent=events.find(e=>e.name===TimelineModel.TimelineModel.RecordType.Profile);if(!cpuProfileEvent)
return null;target=this.targetByEvent(cpuProfileEvent);const profileGroup=tracingModel.profileGroup(cpuProfileEvent);if(!profileGroup){Common.console.error('Invalid CPU profile format.');return null;}
cpuProfile=({startTime:cpuProfileEvent.args['data']['startTime'],endTime:0,nodes:[],samples:[],timeDeltas:[],lines:[]});for(const profileEvent of profileGroup.children){const eventData=profileEvent.args['data'];if('startTime'in eventData)
cpuProfile.startTime=eventData['startTime'];if('endTime'in eventData)
cpuProfile.endTime=eventData['endTime'];const nodesAndSamples=eventData['cpuProfile']||{};const samples=nodesAndSamples['samples']||[];const lines=eventData['lines']||Array(samples.length).fill(0);cpuProfile.nodes.pushAll(nodesAndSamples['nodes']||[]);cpuProfile.lines.pushAll(lines);cpuProfile.samples.pushAll(samples);cpuProfile.timeDeltas.pushAll(eventData['timeDeltas']||[]);if(cpuProfile.samples.length!==cpuProfile.timeDeltas.length){Common.console.error('Failed to parse CPU profile.');return null;}}
if(!cpuProfile.endTime)
cpuProfile.endTime=cpuProfile.timeDeltas.reduce((x,y)=>x+y,cpuProfile.startTime);}
try{const jsProfileModel=new SDK.CPUProfileDataModel(cpuProfile,target);this._cpuProfiles.push(jsProfileModel);return jsProfileModel;}catch(e){Common.console.error('Failed to parse CPU profile.');}
return null;}
_injectJSFrameEvents(tracingModel,thread){const jsProfileModel=this._extractCpuProfile(tracingModel,thread);let events=thread.events();const jsSamples=jsProfileModel?TimelineModel.TimelineJSProfileProcessor.generateTracingEventsFromCpuProfile(jsProfileModel,thread):null;if(jsSamples&&jsSamples.length)
events=events.mergeOrdered(jsSamples,SDK.TracingModel.Event.orderedCompareStartTime);if(jsSamples||events.some(e=>e.name===TimelineModel.TimelineModel.RecordType.JSSample)){const jsFrameEvents=TimelineModel.TimelineJSProfileProcessor.generateJSFrameEvents(events);if(jsFrameEvents&&jsFrameEvents.length)
events=jsFrameEvents.mergeOrdered(events,SDK.TracingModel.Event.orderedCompareStartTime);}
return events;}
_processThreadEvents(tracingModel,ranges,thread,isMainThread,isWorker,forMainFrame,url){const track=new TimelineModel.TimelineModel.Track();track.name=thread.name()||ls`Thread ${thread.id()}`;track.type=TimelineModel.TimelineModel.TrackType.Other;track.thread=thread;if(isMainThread){track.type=TimelineModel.TimelineModel.TrackType.MainThread;track.url=url||null;track.forMainFrame=forMainFrame;}else if(isWorker){track.type=TimelineModel.TimelineModel.TrackType.Worker;track.url=url;}else if(thread.name().startsWith('CompositorTileWorker')){track.type=TimelineModel.TimelineModel.TrackType.Raster;}
this._tracks.push(track);const events=this._injectJSFrameEvents(tracingModel,thread);this._eventStack=[];const eventStack=this._eventStack;for(const range of ranges){let i=events.lowerBound(range.from,(time,event)=>time-event.startTime);for(;i<events.length;i++){const event=events[i];if(event.startTime>=range.to)
break;while(eventStack.length&&eventStack.peekLast().endTime<=event.startTime)
eventStack.pop();if(!this._processEvent(event))
continue;if(!SDK.TracingModel.isAsyncPhase(event.phase)&&event.duration){if(eventStack.length){const parent=eventStack.peekLast();parent.selfTime-=event.duration;if(parent.selfTime<0)
this._fixNegativeDuration(parent,event);}
event.selfTime=event.duration;if(!eventStack.length)
track.tasks.push(event);eventStack.push(event);}
if(this.isMarkerEvent(event))
this._timeMarkerEvents.push(event);track.events.push(event);this._inspectedTargetEvents.push(event);}}
this._processAsyncEvents(thread,ranges);}
_fixNegativeDuration(event,child){const epsilon=1e-3;if(event.selfTime<-epsilon){console.error(`Children are longer than parent at ${event.startTime} `+`(${(child.startTime - this.minimumRecordTime()).toFixed(3)} by ${(-event.selfTime).toFixed(3)}`);}
event.selfTime=0;}
_processAsyncEvents(thread,ranges){const asyncEvents=thread.asyncEvents();const groups=new Map();function group(type){if(!groups.has(type))
groups.set(type,[]);return groups.get(type);}
for(const range of ranges){let i=asyncEvents.lowerBound(range.from,function(time,asyncEvent){return time-asyncEvent.startTime;});for(;i<asyncEvents.length;++i){const asyncEvent=asyncEvents[i];if(asyncEvent.startTime>=range.to)
break;if(asyncEvent.hasCategory(TimelineModel.TimelineModel.Category.Console)){group(TimelineModel.TimelineModel.TrackType.Console).push(asyncEvent);continue;}
if(asyncEvent.hasCategory(TimelineModel.TimelineModel.Category.UserTiming)){group(TimelineModel.TimelineModel.TrackType.Timings).push(asyncEvent);continue;}
if(asyncEvent.name===TimelineModel.TimelineModel.RecordType.Animation){group(TimelineModel.TimelineModel.TrackType.Animation).push(asyncEvent);continue;}
if(asyncEvent.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)||asyncEvent.name===TimelineModel.TimelineModel.RecordType.ImplSideFling){const lastStep=asyncEvent.steps.peekLast();if(lastStep.phase!==SDK.TracingModel.Phase.AsyncEnd)
continue;const data=lastStep.args['data'];asyncEvent.causedFrame=!!(data&&data['INPUT_EVENT_LATENCY_RENDERER_SWAP_COMPONENT']);if(asyncEvent.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)){if(!this._knownInputEvents.has(lastStep.id))
continue;if(asyncEvent.name===TimelineModel.TimelineModel.RecordType.InputLatencyMouseMove&&!asyncEvent.causedFrame)
continue;const rendererMain=data['INPUT_EVENT_LATENCY_RENDERER_MAIN_COMPONENT'];if(rendererMain){const time=rendererMain['time']/1000;TimelineModel.TimelineData.forEvent(asyncEvent.steps[0]).timeWaitingForMainThread=time-asyncEvent.steps[0].startTime;}}
group(TimelineModel.TimelineModel.TrackType.Input).push(asyncEvent);continue;}}}
for(const[type,events]of groups){const track=this._ensureNamedTrack(type);track.thread=thread;track.asyncEvents=track.asyncEvents.mergeOrdered(events,SDK.TracingModel.Event.compareStartTime);}}
_processEvent(event){const recordTypes=TimelineModel.TimelineModel.RecordType;const eventStack=this._eventStack;if(!eventStack.length){if(this._currentTaskLayoutAndRecalcEvents&&this._currentTaskLayoutAndRecalcEvents.length){const totalTime=this._currentTaskLayoutAndRecalcEvents.reduce((time,event)=>time+event.duration,0);if(totalTime>TimelineModel.TimelineModel.Thresholds.ForcedLayout){for(const e of this._currentTaskLayoutAndRecalcEvents){const timelineData=TimelineModel.TimelineData.forEvent(e);timelineData.warning=e.name===recordTypes.Layout?TimelineModel.TimelineModel.WarningType.ForcedLayout:TimelineModel.TimelineModel.WarningType.ForcedStyle;}}}
this._currentTaskLayoutAndRecalcEvents=[];}
if(this._currentScriptEvent&&event.startTime>this._currentScriptEvent.endTime)
this._currentScriptEvent=null;const eventData=event.args['data']||event.args['beginData']||{};const timelineData=TimelineModel.TimelineData.forEvent(event);if(eventData['stackTrace'])
timelineData.stackTrace=eventData['stackTrace'];if(timelineData.stackTrace&&event.name!==recordTypes.JSSample){for(let i=0;i<timelineData.stackTrace.length;++i){--timelineData.stackTrace[i].lineNumber;--timelineData.stackTrace[i].columnNumber;}}
let pageFrameId=TimelineModel.TimelineModel.eventFrameId(event);if(!pageFrameId&&eventStack.length)
pageFrameId=TimelineModel.TimelineData.forEvent(eventStack.peekLast()).frameId;timelineData.frameId=pageFrameId||(this._mainFrame&&this._mainFrame.frameId)||'';this._asyncEventTracker.processEvent(event);if(this.isMarkerEvent(event))
this._ensureNamedTrack(TimelineModel.TimelineModel.TrackType.Timings);switch(event.name){case recordTypes.ResourceSendRequest:case recordTypes.WebSocketCreate:timelineData.setInitiator(eventStack.peekLast()||null);timelineData.url=eventData['url'];break;case recordTypes.ScheduleStyleRecalculation:this._lastScheduleStyleRecalculation[eventData['frame']]=event;break;case recordTypes.UpdateLayoutTree:case recordTypes.RecalculateStyles:this._invalidationTracker.didRecalcStyle(event);if(event.args['beginData'])
timelineData.setInitiator(this._lastScheduleStyleRecalculation[event.args['beginData']['frame']]);this._lastRecalculateStylesEvent=event;if(this._currentScriptEvent)
this._currentTaskLayoutAndRecalcEvents.push(event);break;case recordTypes.ScheduleStyleInvalidationTracking:case recordTypes.StyleRecalcInvalidationTracking:case recordTypes.StyleInvalidatorInvalidationTracking:case recordTypes.LayoutInvalidationTracking:this._invalidationTracker.addInvalidation(new TimelineModel.InvalidationTrackingEvent(event));break;case recordTypes.InvalidateLayout:{let layoutInitator=event;const frameId=eventData['frame'];if(!this._layoutInvalidate[frameId]&&this._lastRecalculateStylesEvent&&this._lastRecalculateStylesEvent.endTime>event.startTime)
layoutInitator=TimelineModel.TimelineData.forEvent(this._lastRecalculateStylesEvent).initiator();this._layoutInvalidate[frameId]=layoutInitator;break;}
case recordTypes.Layout:{this._invalidationTracker.didLayout(event);const frameId=event.args['beginData']['frame'];timelineData.setInitiator(this._layoutInvalidate[frameId]);if(event.args['endData'])
timelineData.backendNodeId=event.args['endData']['rootNode'];this._layoutInvalidate[frameId]=null;if(this._currentScriptEvent)
this._currentTaskLayoutAndRecalcEvents.push(event);break;}
case recordTypes.Task:if(event.duration>TimelineModel.TimelineModel.Thresholds.LongTask)
timelineData.warning=TimelineModel.TimelineModel.WarningType.LongTask;break;case recordTypes.EventDispatch:if(event.duration>TimelineModel.TimelineModel.Thresholds.RecurringHandler)
timelineData.warning=TimelineModel.TimelineModel.WarningType.LongHandler;break;case recordTypes.TimerFire:case recordTypes.FireAnimationFrame:if(event.duration>TimelineModel.TimelineModel.Thresholds.RecurringHandler)
timelineData.warning=TimelineModel.TimelineModel.WarningType.LongRecurringHandler;break;case recordTypes.FunctionCall:if(typeof eventData['scriptName']==='string')
eventData['url']=eventData['scriptName'];if(typeof eventData['scriptLine']==='number')
eventData['lineNumber']=eventData['scriptLine'];case recordTypes.EvaluateScript:case recordTypes.CompileScript:if(typeof eventData['lineNumber']==='number')
--eventData['lineNumber'];if(typeof eventData['columnNumber']==='number')
--eventData['columnNumber'];case recordTypes.RunMicrotasks:if(!this._currentScriptEvent)
this._currentScriptEvent=event;break;case recordTypes.SetLayerTreeId:if(this._sessionId&&eventData['sessionId']&&this._sessionId===eventData['sessionId']){this._mainFrameLayerTreeId=eventData['layerTreeId'];break;}
const frameId=TimelineModel.TimelineModel.eventFrameId(event);const pageFrame=this._pageFrames.get(frameId);if(!pageFrame||pageFrame.parent)
return false;this._mainFrameLayerTreeId=eventData['layerTreeId'];break;case recordTypes.Paint:{this._invalidationTracker.didPaint(event);timelineData.backendNodeId=eventData['nodeId'];if(!eventData['layerId'])
break;const layerId=eventData['layerId'];this._lastPaintForLayer[layerId]=event;break;}
case recordTypes.DisplayItemListSnapshot:case recordTypes.PictureSnapshot:{const layerUpdateEvent=this._findAncestorEvent(recordTypes.UpdateLayer);if(!layerUpdateEvent||layerUpdateEvent.args['layerTreeId']!==this._mainFrameLayerTreeId)
break;const paintEvent=this._lastPaintForLayer[layerUpdateEvent.args['layerId']];if(paintEvent){TimelineModel.TimelineData.forEvent(paintEvent).picture=(event);}
break;}
case recordTypes.ScrollLayer:timelineData.backendNodeId=eventData['nodeId'];break;case recordTypes.PaintImage:timelineData.backendNodeId=eventData['nodeId'];timelineData.url=eventData['url'];break;case recordTypes.DecodeImage:case recordTypes.ResizeImage:{let paintImageEvent=this._findAncestorEvent(recordTypes.PaintImage);if(!paintImageEvent){const decodeLazyPixelRefEvent=this._findAncestorEvent(recordTypes.DecodeLazyPixelRef);paintImageEvent=decodeLazyPixelRefEvent&&this._paintImageEventByPixelRefId[decodeLazyPixelRefEvent.args['LazyPixelRef']];}
if(!paintImageEvent)
break;const paintImageData=TimelineModel.TimelineData.forEvent(paintImageEvent);timelineData.backendNodeId=paintImageData.backendNodeId;timelineData.url=paintImageData.url;break;}
case recordTypes.DrawLazyPixelRef:{const paintImageEvent=this._findAncestorEvent(recordTypes.PaintImage);if(!paintImageEvent)
break;this._paintImageEventByPixelRefId[event.args['LazyPixelRef']]=paintImageEvent;const paintImageData=TimelineModel.TimelineData.forEvent(paintImageEvent);timelineData.backendNodeId=paintImageData.backendNodeId;timelineData.url=paintImageData.url;break;}
case recordTypes.FrameStartedLoading:if(timelineData.frameId!==event.args['frame'])
return false;break;case recordTypes.MarkLCPCandidate:timelineData.backendNodeId=eventData['nodeId'];break;case recordTypes.MarkDOMContent:case recordTypes.MarkLoad:{const frameId=TimelineModel.TimelineModel.eventFrameId(event);if(!this._pageFrames.has(frameId))
return false;break;}
case recordTypes.CommitLoad:{if(this._browserFrameTracking)
break;const frameId=TimelineModel.TimelineModel.eventFrameId(event);const isMainFrame=!!eventData['isMainFrame'];const pageFrame=this._pageFrames.get(frameId);if(pageFrame){pageFrame.update(event.startTime,eventData);}else{if(!this._persistentIds){if(eventData['page']&&eventData['page']!==this._legacyCurrentPage)
return false;}else if(isMainFrame){return false;}else if(!this._addPageFrame(event,eventData)){return false;}}
if(isMainFrame)
this._mainFrame=this._pageFrames.get(frameId);break;}
case recordTypes.FireIdleCallback:if(event.duration>eventData['allottedMilliseconds']+TimelineModel.TimelineModel.Thresholds.IdleCallbackAddon)
timelineData.warning=TimelineModel.TimelineModel.WarningType.IdleDeadlineExceeded;break;}
return true;}
_processBrowserEvent(event){if(event.name===TimelineModel.TimelineModel.RecordType.LatencyInfoFlow){const frameId=event.args['frameTreeNodeId'];if(typeof frameId==='number'&&frameId===this._mainFrameNodeId)
this._knownInputEvents.add(event.bind_id);return;}
if(event.hasCategory(SDK.TracingModel.DevToolsMetadataEventCategory)&&event.args['data']){const data=event.args['data'];if(event.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingStartedInBrowser){if(!data['persistentIds'])
return;this._browserFrameTracking=true;this._mainFrameNodeId=data['frameTreeNodeId'];const frames=data['frames']||[];frames.forEach(payload=>{const parent=payload['parent']&&this._pageFrames.get(payload['parent']);if(payload['parent']&&!parent)
return;let frame=this._pageFrames.get(payload['frame']);if(!frame){frame=new TimelineModel.TimelineModel.PageFrame(payload);this._pageFrames.set(frame.frameId,frame);if(parent)
parent.addChild(frame);else
this._mainFrame=frame;}
frame.update(this._minimumRecordTime,payload);});return;}
if(event.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.FrameCommittedInBrowser&&this._browserFrameTracking){let frame=this._pageFrames.get(data['frame']);if(!frame){const parent=data['parent']&&this._pageFrames.get(data['parent']);if(!parent)
return;frame=new TimelineModel.TimelineModel.PageFrame(data);this._pageFrames.set(frame.frameId,frame);parent.addChild(frame);}
frame.update(event.startTime,data);return;}
if(event.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.ProcessReadyInBrowser&&this._browserFrameTracking){const frame=this._pageFrames.get(data['frame']);if(frame)
frame.processReady(data['processPseudoId'],data['processId']);return;}
if(event.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.FrameDeletedInBrowser&&this._browserFrameTracking){const frame=this._pageFrames.get(data['frame']);if(frame)
frame.deletedTime=event.startTime;return;}}}
_ensureNamedTrack(type){if(!this._namedTracks.has(type)){const track=new TimelineModel.TimelineModel.Track();track.type=type;this._tracks.push(track);this._namedTracks.set(type,track);}
return this._namedTracks.get(type);}
_findAncestorEvent(name){for(let i=this._eventStack.length-1;i>=0;--i){const event=this._eventStack[i];if(event.name===name)
return event;}
return null;}
_addPageFrame(event,payload){const parent=payload['parent']&&this._pageFrames.get(payload['parent']);if(payload['parent']&&!parent)
return false;const pageFrame=new TimelineModel.TimelineModel.PageFrame(payload);this._pageFrames.set(pageFrame.frameId,pageFrame);pageFrame.update(event.startTime,payload);if(parent)
parent.addChild(pageFrame);return true;}
_reset(){this._isGenericTrace=false;this._tracks=[];this._namedTracks=new Map();this._inspectedTargetEvents=[];this._timeMarkerEvents=[];this._sessionId=null;this._mainFrameNodeId=null;this._cpuProfiles=[];this._workerIdByThread=new WeakMap();this._pageFrames=new Map();this._mainFrame=null;this._minimumRecordTime=0;this._maximumRecordTime=0;}
isGenericTrace(){return this._isGenericTrace;}
tracingModel(){return this._tracingModel;}
minimumRecordTime(){return this._minimumRecordTime;}
maximumRecordTime(){return this._maximumRecordTime;}
inspectedTargetEvents(){return this._inspectedTargetEvents;}
tracks(){return this._tracks;}
isEmpty(){return this.minimumRecordTime()===0&&this.maximumRecordTime()===0;}
timeMarkerEvents(){return this._timeMarkerEvents;}
rootFrames(){return Array.from(this._pageFrames.values()).filter(frame=>!frame.parent);}
pageURL(){return this._mainFrame&&this._mainFrame.url||'';}
pageFrameById(frameId){return frameId?this._pageFrames.get(frameId)||null:null;}
networkRequests(){if(this.isGenericTrace())
return[];const requests=new Map();const requestsList=[];const zeroStartRequestsList=[];const types=TimelineModel.TimelineModel.RecordType;const resourceTypes=new Set([types.ResourceSendRequest,types.ResourceReceiveResponse,types.ResourceReceivedData,types.ResourceFinish,types.ResourceMarkAsCached]);const events=this.inspectedTargetEvents();for(let i=0;i<events.length;++i){const e=events[i];if(!resourceTypes.has(e.name))
continue;const id=TimelineModel.TimelineModel.globalEventId(e,'requestId');let request=requests.get(id);if(request){request.addEvent(e);}else{request=new TimelineModel.TimelineModel.NetworkRequest(e);requests.set(id,request);if(request.startTime)
requestsList.push(request);else
zeroStartRequestsList.push(request);}}
return zeroStartRequestsList.concat(requestsList);}};TimelineModel.TimelineModel.RecordType={Task:'RunTask',Program:'Program',EventDispatch:'EventDispatch',GPUTask:'GPUTask',Animation:'Animation',RequestMainThreadFrame:'RequestMainThreadFrame',BeginFrame:'BeginFrame',NeedsBeginFrameChanged:'NeedsBeginFrameChanged',BeginMainThreadFrame:'BeginMainThreadFrame',ActivateLayerTree:'ActivateLayerTree',DrawFrame:'DrawFrame',HitTest:'HitTest',ScheduleStyleRecalculation:'ScheduleStyleRecalculation',RecalculateStyles:'RecalculateStyles',UpdateLayoutTree:'UpdateLayoutTree',InvalidateLayout:'InvalidateLayout',Layout:'Layout',UpdateLayer:'UpdateLayer',UpdateLayerTree:'UpdateLayerTree',PaintSetup:'PaintSetup',Paint:'Paint',PaintImage:'PaintImage',Rasterize:'Rasterize',RasterTask:'RasterTask',ScrollLayer:'ScrollLayer',CompositeLayers:'CompositeLayers',ScheduleStyleInvalidationTracking:'ScheduleStyleInvalidationTracking',StyleRecalcInvalidationTracking:'StyleRecalcInvalidationTracking',StyleInvalidatorInvalidationTracking:'StyleInvalidatorInvalidationTracking',LayoutInvalidationTracking:'LayoutInvalidationTracking',ParseHTML:'ParseHTML',ParseAuthorStyleSheet:'ParseAuthorStyleSheet',TimerInstall:'TimerInstall',TimerRemove:'TimerRemove',TimerFire:'TimerFire',XHRReadyStateChange:'XHRReadyStateChange',XHRLoad:'XHRLoad',CompileScript:'v8.compile',EvaluateScript:'EvaluateScript',CompileModule:'v8.compileModule',EvaluateModule:'v8.evaluateModule',WasmStreamFromResponseCallback:'v8.wasm.streamFromResponseCallback',WasmCompiledModule:'v8.wasm.compiledModule',WasmCachedModule:'v8.wasm.cachedModule',WasmModuleCacheHit:'v8.wasm.moduleCacheHit',WasmModuleCacheInvalid:'v8.wasm.moduleCacheInvalid',FrameStartedLoading:'FrameStartedLoading',CommitLoad:'CommitLoad',MarkLoad:'MarkLoad',MarkDOMContent:'MarkDOMContent',MarkFirstPaint:'firstPaint',MarkFCP:'firstContentfulPaint',MarkFMP:'firstMeaningfulPaint',MarkLCPCandidate:'largestContentfulPaint::Candidate',MarkLCPInvalidate:'largestContentfulPaint::Invalidate',TimeStamp:'TimeStamp',ConsoleTime:'ConsoleTime',UserTiming:'UserTiming',ResourceSendRequest:'ResourceSendRequest',ResourceReceiveResponse:'ResourceReceiveResponse',ResourceReceivedData:'ResourceReceivedData',ResourceFinish:'ResourceFinish',ResourceMarkAsCached:'ResourceMarkAsCached',RunMicrotasks:'RunMicrotasks',FunctionCall:'FunctionCall',GCEvent:'GCEvent',MajorGC:'MajorGC',MinorGC:'MinorGC',JSFrame:'JSFrame',JSSample:'JSSample',V8Sample:'V8Sample',JitCodeAdded:'JitCodeAdded',JitCodeMoved:'JitCodeMoved',ParseScriptOnBackground:'v8.parseOnBackground',V8Execute:'V8.Execute',UpdateCounters:'UpdateCounters',RequestAnimationFrame:'RequestAnimationFrame',CancelAnimationFrame:'CancelAnimationFrame',FireAnimationFrame:'FireAnimationFrame',RequestIdleCallback:'RequestIdleCallback',CancelIdleCallback:'CancelIdleCallback',FireIdleCallback:'FireIdleCallback',WebSocketCreate:'WebSocketCreate',WebSocketSendHandshakeRequest:'WebSocketSendHandshakeRequest',WebSocketReceiveHandshakeResponse:'WebSocketReceiveHandshakeResponse',WebSocketDestroy:'WebSocketDestroy',EmbedderCallback:'EmbedderCallback',SetLayerTreeId:'SetLayerTreeId',TracingStartedInPage:'TracingStartedInPage',TracingSessionIdForWorker:'TracingSessionIdForWorker',DecodeImage:'Decode Image',ResizeImage:'Resize Image',DrawLazyPixelRef:'Draw LazyPixelRef',DecodeLazyPixelRef:'Decode LazyPixelRef',LazyPixelRef:'LazyPixelRef',LayerTreeHostImplSnapshot:'cc::LayerTreeHostImpl',PictureSnapshot:'cc::Picture',DisplayItemListSnapshot:'cc::DisplayItemList',LatencyInfo:'LatencyInfo',LatencyInfoFlow:'LatencyInfo.Flow',InputLatencyMouseMove:'InputLatency::MouseMove',InputLatencyMouseWheel:'InputLatency::MouseWheel',ImplSideFling:'InputHandlerProxy::HandleGestureFling::started',GCCollectGarbage:'BlinkGC.AtomicPhase',CryptoDoEncrypt:'DoEncrypt',CryptoDoEncryptReply:'DoEncryptReply',CryptoDoDecrypt:'DoDecrypt',CryptoDoDecryptReply:'DoDecryptReply',CryptoDoDigest:'DoDigest',CryptoDoDigestReply:'DoDigestReply',CryptoDoSign:'DoSign',CryptoDoSignReply:'DoSignReply',CryptoDoVerify:'DoVerify',CryptoDoVerifyReply:'DoVerifyReply',CpuProfile:'CpuProfile',Profile:'Profile',AsyncTask:'AsyncTask',};TimelineModel.TimelineModel.Category={Console:'blink.console',UserTiming:'blink.user_timing',LatencyInfo:'latencyInfo'};TimelineModel.TimelineModel.WarningType={LongTask:'LongTask',ForcedStyle:'ForcedStyle',ForcedLayout:'ForcedLayout',IdleDeadlineExceeded:'IdleDeadlineExceeded',LongHandler:'LongHandler',LongRecurringHandler:'LongRecurringHandler',V8Deopt:'V8Deopt'};TimelineModel.TimelineModel.WorkerThreadName='DedicatedWorker thread';TimelineModel.TimelineModel.WorkerThreadNameLegacy='DedicatedWorker Thread';TimelineModel.TimelineModel.RendererMainThreadName='CrRendererMain';TimelineModel.TimelineModel.BrowserMainThreadName='CrBrowserMain';TimelineModel.TimelineModel.DevToolsMetadataEvent={TracingStartedInBrowser:'TracingStartedInBrowser',TracingStartedInPage:'TracingStartedInPage',TracingSessionIdForWorker:'TracingSessionIdForWorker',FrameCommittedInBrowser:'FrameCommittedInBrowser',ProcessReadyInBrowser:'ProcessReadyInBrowser',FrameDeletedInBrowser:'FrameDeletedInBrowser',};TimelineModel.TimelineModel.Thresholds={LongTask:200,Handler:150,RecurringHandler:50,ForcedLayout:30,IdleCallbackAddon:5};TimelineModel.TimelineModel.Track=class{constructor(){this.name='';this.type=TimelineModel.TimelineModel.TrackType.Other;this.forMainFrame=false;this.url='';this.events=[];this.asyncEvents=[];this.tasks=[];this._syncEvents=null;this.thread=null;}
syncEvents(){if(this.events.length)
return this.events;if(this._syncEvents)
return this._syncEvents;const stack=[];this._syncEvents=[];for(const event of this.asyncEvents){const startTime=event.startTime;const endTime=event.endTime;while(stack.length&&startTime>=stack.peekLast().endTime)
stack.pop();if(stack.length&&endTime>stack.peekLast().endTime){this._syncEvents=[];break;}
const syncEvent=new SDK.TracingModel.Event(event.categoriesString,event.name,SDK.TracingModel.Phase.Complete,startTime,event.thread);syncEvent.setEndTime(endTime);syncEvent.addArgs(event.args);this._syncEvents.push(syncEvent);stack.push(syncEvent);}
return this._syncEvents;}};TimelineModel.TimelineModel.TrackType={MainThread:Symbol('MainThread'),Worker:Symbol('Worker'),Input:Symbol('Input'),Animation:Symbol('Animation'),Timings:Symbol('Timings'),Console:Symbol('Console'),Raster:Symbol('Raster'),GPU:Symbol('GPU'),Other:Symbol('Other'),};TimelineModel.TimelineModel.PageFrame=class{constructor(payload){this.frameId=payload['frame'];this.url=payload['url']||'';this.name=payload['name'];this.children=[];this.parent=null;this.processes=[];this.deletedTime=null;this.ownerNode=null;}
update(time,payload){this.url=payload['url']||'';this.name=payload['name'];if(payload['processId']){this.processes.push({time:time,processId:payload['processId'],processPseudoId:'',url:payload['url']||''});}else{this.processes.push({time:time,processId:-1,processPseudoId:payload['processPseudoId'],url:payload['url']||''});}}
processReady(processPseudoId,processId){for(const process of this.processes){if(process.processPseudoId===processPseudoId){process.processPseudoId='';process.processId=processId;}}}
addChild(child){this.children.push(child);child.parent=this;}};TimelineModel.TimelineModel.MetadataEvents;TimelineModel.TimelineModel.NetworkRequest=class{constructor(event){this.startTime=event.name===TimelineModel.TimelineModel.RecordType.ResourceSendRequest?event.startTime:0;this.endTime=Infinity;this.encodedDataLength=0;this.decodedBodyLength=0;this.children=[];this.timing;this.mimeType;this.url;this.requestMethod;this._transferSize=0;this._maybeDiskCached=false;this._memoryCached=false;this.addEvent(event);}
addEvent(event){this.children.push(event);const recordType=TimelineModel.TimelineModel.RecordType;this.startTime=Math.min(this.startTime,event.startTime);const eventData=event.args['data'];if(eventData['mimeType'])
this.mimeType=eventData['mimeType'];if('priority'in eventData)
this.priority=eventData['priority'];if(event.name===recordType.ResourceFinish)
this.endTime=event.startTime;if(eventData['finishTime'])
this.finishTime=eventData['finishTime']*1000;if(!this.responseTime&&(event.name===recordType.ResourceReceiveResponse||event.name===recordType.ResourceReceivedData))
this.responseTime=event.startTime;const encodedDataLength=eventData['encodedDataLength']||0;if(event.name===recordType.ResourceMarkAsCached){this._memoryCached=true;}
if(event.name===recordType.ResourceReceiveResponse){if(eventData['fromCache']){this._maybeDiskCached=true;}
if(eventData['fromServiceWorker'])
this.fromServiceWorker=true;if(eventData['hasCachedResource'])
this.hasCachedResource=true;this.encodedDataLength=encodedDataLength;}
if(event.name===recordType.ResourceReceivedData)
this.encodedDataLength+=encodedDataLength;if(event.name===recordType.ResourceFinish&&encodedDataLength){this.encodedDataLength=encodedDataLength;this._transferSize=encodedDataLength;}
const decodedBodyLength=eventData['decodedBodyLength'];if(event.name===recordType.ResourceFinish&&decodedBodyLength)
this.decodedBodyLength=decodedBodyLength;if(!this.url)
this.url=eventData['url'];if(!this.requestMethod)
this.requestMethod=eventData['requestMethod'];if(!this.timing)
this.timing=eventData['timing'];if(eventData['fromServiceWorker'])
this.fromServiceWorker=true;}
cached(){return!!this._memoryCached||(!!this._maybeDiskCached&&!this._transferSize&&!this.fromServiceWorker);}
memoryCached(){return this._memoryCached;}
getSendReceiveTiming(){if(this.cached()||!this.timing){return{sendStartTime:this.startTime,headersEndTime:this.startTime};}
const requestTime=this.timing.requestTime*1000;const sendStartTime=requestTime+this.timing.sendStart;const headersEndTime=requestTime+this.timing.receiveHeadersEnd;return{sendStartTime,headersEndTime};}
getStartTime(){return Math.min(this.startTime,!this.cached()&&this.timing&&this.timing.requestTime*1000||Infinity);}
beginTime(){return Math.min(this.getStartTime(),!this.cached()&&this.timing&&this.timing.pushStart*1000||Infinity);}};TimelineModel.InvalidationTrackingEvent=class{constructor(event){this.type=event.name;this.startTime=event.startTime;this._tracingEvent=event;const eventData=event.args['data'];this.frame=eventData['frame'];this.nodeId=eventData['nodeId'];this.nodeName=eventData['nodeName'];this.invalidationSet=eventData['invalidationSet'];this.invalidatedSelectorId=eventData['invalidatedSelectorId'];this.changedId=eventData['changedId'];this.changedClass=eventData['changedClass'];this.changedAttribute=eventData['changedAttribute'];this.changedPseudo=eventData['changedPseudo'];this.selectorPart=eventData['selectorPart'];this.extraData=eventData['extraData'];this.invalidationList=eventData['invalidationList'];this.cause={reason:eventData['reason'],stackTrace:eventData['stackTrace']};if(!this.cause.reason&&this.cause.stackTrace&&this.type===TimelineModel.TimelineModel.RecordType.LayoutInvalidationTracking)
this.cause.reason='Layout forced';}};TimelineModel.InvalidationCause;TimelineModel.InvalidationTracker=class{constructor(){this._lastRecalcStyle=null;this._lastPaintWithLayer=null;this._didPaint=false;this._initializePerFrameState();}
static invalidationEventsFor(event){return event[TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol]||null;}
addInvalidation(invalidation){this._startNewFrameIfNeeded();if(!invalidation.nodeId){console.error('Invalidation lacks node information.');console.error(invalidation);return;}
const recordTypes=TimelineModel.TimelineModel.RecordType;if(invalidation.type===recordTypes.StyleRecalcInvalidationTracking&&invalidation.cause.reason==='StyleInvalidator')
return;const styleRecalcInvalidation=(invalidation.type===recordTypes.ScheduleStyleInvalidationTracking||invalidation.type===recordTypes.StyleInvalidatorInvalidationTracking||invalidation.type===recordTypes.StyleRecalcInvalidationTracking);if(styleRecalcInvalidation){const duringRecalcStyle=invalidation.startTime&&this._lastRecalcStyle&&invalidation.startTime>=this._lastRecalcStyle.startTime&&invalidation.startTime<=this._lastRecalcStyle.endTime;if(duringRecalcStyle)
this._associateWithLastRecalcStyleEvent(invalidation);}
if(this._invalidations[invalidation.type])
this._invalidations[invalidation.type].push(invalidation);else
this._invalidations[invalidation.type]=[invalidation];if(invalidation.nodeId){if(this._invalidationsByNodeId[invalidation.nodeId])
this._invalidationsByNodeId[invalidation.nodeId].push(invalidation);else
this._invalidationsByNodeId[invalidation.nodeId]=[invalidation];}}
didRecalcStyle(recalcStyleEvent){this._lastRecalcStyle=recalcStyleEvent;const types=[TimelineModel.TimelineModel.RecordType.ScheduleStyleInvalidationTracking,TimelineModel.TimelineModel.RecordType.StyleInvalidatorInvalidationTracking,TimelineModel.TimelineModel.RecordType.StyleRecalcInvalidationTracking];for(const invalidation of this._invalidationsOfTypes(types))
this._associateWithLastRecalcStyleEvent(invalidation);}
_associateWithLastRecalcStyleEvent(invalidation){if(invalidation.linkedRecalcStyleEvent)
return;const recordTypes=TimelineModel.TimelineModel.RecordType;const recalcStyleFrameId=this._lastRecalcStyle.args['beginData']['frame'];if(invalidation.type===recordTypes.StyleInvalidatorInvalidationTracking){this._addSyntheticStyleRecalcInvalidations(this._lastRecalcStyle,recalcStyleFrameId,invalidation);}else if(invalidation.type===recordTypes.ScheduleStyleInvalidationTracking){}else{this._addInvalidationToEvent(this._lastRecalcStyle,recalcStyleFrameId,invalidation);}
invalidation.linkedRecalcStyleEvent=true;}
_addSyntheticStyleRecalcInvalidations(event,frameId,styleInvalidatorInvalidation){if(!styleInvalidatorInvalidation.invalidationList){this._addSyntheticStyleRecalcInvalidation(styleInvalidatorInvalidation._tracingEvent,styleInvalidatorInvalidation);return;}
if(!styleInvalidatorInvalidation.nodeId){console.error('Invalidation lacks node information.');console.error(styleInvalidatorInvalidation);return;}
for(let i=0;i<styleInvalidatorInvalidation.invalidationList.length;i++){const setId=styleInvalidatorInvalidation.invalidationList[i]['id'];let lastScheduleStyleRecalculation;const nodeInvalidations=this._invalidationsByNodeId[styleInvalidatorInvalidation.nodeId]||[];for(let j=0;j<nodeInvalidations.length;j++){const invalidation=nodeInvalidations[j];if(invalidation.frame!==frameId||invalidation.invalidationSet!==setId||invalidation.type!==TimelineModel.TimelineModel.RecordType.ScheduleStyleInvalidationTracking)
continue;lastScheduleStyleRecalculation=invalidation;}
if(!lastScheduleStyleRecalculation){console.error('Failed to lookup the event that scheduled a style invalidator invalidation.');continue;}
this._addSyntheticStyleRecalcInvalidation(lastScheduleStyleRecalculation._tracingEvent,styleInvalidatorInvalidation);}}
_addSyntheticStyleRecalcInvalidation(baseEvent,styleInvalidatorInvalidation){const invalidation=new TimelineModel.InvalidationTrackingEvent(baseEvent);invalidation.type=TimelineModel.TimelineModel.RecordType.StyleRecalcInvalidationTracking;if(styleInvalidatorInvalidation.cause.reason)
invalidation.cause.reason=styleInvalidatorInvalidation.cause.reason;if(styleInvalidatorInvalidation.selectorPart)
invalidation.selectorPart=styleInvalidatorInvalidation.selectorPart;this.addInvalidation(invalidation);if(!invalidation.linkedRecalcStyleEvent)
this._associateWithLastRecalcStyleEvent(invalidation);}
didLayout(layoutEvent){const layoutFrameId=layoutEvent.args['beginData']['frame'];for(const invalidation of this._invalidationsOfTypes([TimelineModel.TimelineModel.RecordType.LayoutInvalidationTracking])){if(invalidation.linkedLayoutEvent)
continue;this._addInvalidationToEvent(layoutEvent,layoutFrameId,invalidation);invalidation.linkedLayoutEvent=true;}}
didPaint(paintEvent){this._didPaint=true;}
_addInvalidationToEvent(event,eventFrameId,invalidation){if(eventFrameId!==invalidation.frame)
return;if(!event[TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol])
event[TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol]=[invalidation];else
event[TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol].push(invalidation);}
_invalidationsOfTypes(types){const invalidations=this._invalidations;if(!types)
types=Object.keys(invalidations);function*generator(){for(let i=0;i<types.length;++i){const invalidationList=invalidations[types[i]]||[];for(let j=0;j<invalidationList.length;++j)
yield invalidationList[j];}}
return generator();}
_startNewFrameIfNeeded(){if(!this._didPaint)
return;this._initializePerFrameState();}
_initializePerFrameState(){this._invalidations={};this._invalidationsByNodeId={};this._lastRecalcStyle=null;this._lastPaintWithLayer=null;this._didPaint=false;}};TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol=Symbol('invalidationTrackingEvents');TimelineModel.TimelineAsyncEventTracker=class{constructor(){TimelineModel.TimelineAsyncEventTracker._initialize();this._initiatorByType=new Map();for(const initiator of TimelineModel.TimelineAsyncEventTracker._asyncEvents.keys())
this._initiatorByType.set(initiator,new Map());}
static _initialize(){if(TimelineModel.TimelineAsyncEventTracker._asyncEvents)
return;const events=new Map();let type=TimelineModel.TimelineModel.RecordType;events.set(type.TimerInstall,{causes:[type.TimerFire],joinBy:'timerId'});events.set(type.ResourceSendRequest,{causes:[type.ResourceMarkAsCached,type.ResourceReceiveResponse,type.ResourceReceivedData,type.ResourceFinish],joinBy:'requestId'});events.set(type.RequestAnimationFrame,{causes:[type.FireAnimationFrame],joinBy:'id'});events.set(type.RequestIdleCallback,{causes:[type.FireIdleCallback],joinBy:'id'});events.set(type.WebSocketCreate,{causes:[type.WebSocketSendHandshakeRequest,type.WebSocketReceiveHandshakeResponse,type.WebSocketDestroy],joinBy:'identifier'});TimelineModel.TimelineAsyncEventTracker._asyncEvents=events;TimelineModel.TimelineAsyncEventTracker._typeToInitiator=new Map();for(const entry of events){const types=entry[1].causes;for(type of types)
TimelineModel.TimelineAsyncEventTracker._typeToInitiator.set(type,entry[0]);}}
processEvent(event){let initiatorType=TimelineModel.TimelineAsyncEventTracker._typeToInitiator.get((event.name));const isInitiator=!initiatorType;if(!initiatorType)
initiatorType=(event.name);const initiatorInfo=TimelineModel.TimelineAsyncEventTracker._asyncEvents.get(initiatorType);if(!initiatorInfo)
return;const id=TimelineModel.TimelineModel.globalEventId(event,initiatorInfo.joinBy);if(!id)
return;const initiatorMap=this._initiatorByType.get(initiatorType);if(isInitiator){initiatorMap.set(id,event);return;}
const initiator=initiatorMap.get(id)||null;const timelineData=TimelineModel.TimelineData.forEvent(event);timelineData.setInitiator(initiator);if(!timelineData.frameId&&initiator)
timelineData.frameId=TimelineModel.TimelineModel.eventFrameId(initiator);}};TimelineModel.TimelineData=class{constructor(){this.warning=null;this.previewElement=null;this.url=null;this.backendNodeId=0;this.stackTrace=null;this.picture=null;this._initiator=null;this.frameId='';this.timeWaitingForMainThread;}
setInitiator(initiator){this._initiator=initiator;if(!initiator||this.url)
return;const initiatorURL=TimelineModel.TimelineData.forEvent(initiator).url;if(initiatorURL)
this.url=initiatorURL;}
initiator(){return this._initiator;}
topFrame(){const stackTrace=this.stackTraceForSelfOrInitiator();return stackTrace&&stackTrace[0]||null;}
stackTraceForSelfOrInitiator(){return this.stackTrace||(this._initiator&&TimelineModel.TimelineData.forEvent(this._initiator).stackTrace);}
static forEvent(event){let data=event[TimelineModel.TimelineData._symbol];if(!data){data=new TimelineModel.TimelineData();event[TimelineModel.TimelineData._symbol]=data;}
return data;}};TimelineModel.TimelineData._symbol=Symbol('timelineData');;TimelineModel.TimelineIRModel=class{constructor(){this.reset();}
static phaseForEvent(event){return event[TimelineModel.TimelineIRModel._eventIRPhase];}
populate(inputLatencies,animations){this.reset();if(!inputLatencies)
return;this._processInputLatencies(inputLatencies);if(animations)
this._processAnimations(animations);const range=new Common.SegmentedRange();range.appendRange(this._drags);range.appendRange(this._cssAnimations);range.appendRange(this._scrolls);range.appendRange(this._responses);this._segments=range.segments();}
_processInputLatencies(events){const eventTypes=TimelineModel.TimelineIRModel.InputEvents;const phases=TimelineModel.TimelineIRModel.Phases;const thresholdsMs=TimelineModel.TimelineIRModel._mergeThresholdsMs;let scrollStart;let flingStart;let touchStart;let firstTouchMove;let mouseWheel;let mouseDown;let mouseMove;for(let i=0;i<events.length;++i){const event=events[i];if(i>0&&events[i].startTime<events[i-1].startTime)
console.assert(false,'Unordered input events');const type=this._inputEventType(event.name);switch(type){case eventTypes.ScrollBegin:this._scrolls.append(this._segmentForEvent(event,phases.Scroll));scrollStart=event;break;case eventTypes.ScrollEnd:if(scrollStart)
this._scrolls.append(this._segmentForEventRange(scrollStart,event,phases.Scroll));else
this._scrolls.append(this._segmentForEvent(event,phases.Scroll));scrollStart=null;break;case eventTypes.ScrollUpdate:touchStart=null;this._scrolls.append(this._segmentForEvent(event,phases.Scroll));break;case eventTypes.FlingStart:if(flingStart){Common.console.error(Common.UIString('Two flings at the same time? %s vs %s',flingStart.startTime,event.startTime));break;}
flingStart=event;break;case eventTypes.FlingCancel:if(!flingStart)
break;this._scrolls.append(this._segmentForEventRange(flingStart,event,phases.Fling));flingStart=null;break;case eventTypes.ImplSideFling:this._scrolls.append(this._segmentForEvent(event,phases.Fling));break;case eventTypes.ShowPress:case eventTypes.Tap:case eventTypes.KeyDown:case eventTypes.KeyDownRaw:case eventTypes.KeyUp:case eventTypes.Char:case eventTypes.Click:case eventTypes.ContextMenu:this._responses.append(this._segmentForEvent(event,phases.Response));break;case eventTypes.TouchStart:if(touchStart){Common.console.error(Common.UIString('Two touches at the same time? %s vs %s',touchStart.startTime,event.startTime));break;}
touchStart=event;event.steps[0][TimelineModel.TimelineIRModel._eventIRPhase]=phases.Response;firstTouchMove=null;break;case eventTypes.TouchCancel:touchStart=null;break;case eventTypes.TouchMove:if(firstTouchMove){this._drags.append(this._segmentForEvent(event,phases.Drag));}else if(touchStart){firstTouchMove=event;this._responses.append(this._segmentForEventRange(touchStart,event,phases.Response));}
break;case eventTypes.TouchEnd:touchStart=null;break;case eventTypes.MouseDown:mouseDown=event;mouseMove=null;break;case eventTypes.MouseMove:if(mouseDown&&!mouseMove&&mouseDown.startTime+thresholdsMs.mouse>event.startTime){this._responses.append(this._segmentForEvent(mouseDown,phases.Response));this._responses.append(this._segmentForEvent(event,phases.Response));}else if(mouseDown){this._drags.append(this._segmentForEvent(event,phases.Drag));}
mouseMove=event;break;case eventTypes.MouseUp:this._responses.append(this._segmentForEvent(event,phases.Response));mouseDown=null;break;case eventTypes.MouseWheel:if(mouseWheel&&canMerge(thresholdsMs.mouse,mouseWheel,event))
this._scrolls.append(this._segmentForEventRange(mouseWheel,event,phases.Scroll));else
this._scrolls.append(this._segmentForEvent(event,phases.Scroll));mouseWheel=event;break;}}
function canMerge(threshold,first,second){return first.endTime<second.startTime&&second.startTime<first.endTime+threshold;}}
_processAnimations(events){for(let i=0;i<events.length;++i)
this._cssAnimations.append(this._segmentForEvent(events[i],TimelineModel.TimelineIRModel.Phases.Animation));}
_segmentForEvent(event,phase){this._setPhaseForEvent(event,phase);return new Common.Segment(event.startTime,event.endTime,phase);}
_segmentForEventRange(startEvent,endEvent,phase){this._setPhaseForEvent(startEvent,phase);this._setPhaseForEvent(endEvent,phase);return new Common.Segment(startEvent.startTime,endEvent.endTime,phase);}
_setPhaseForEvent(asyncEvent,phase){asyncEvent.steps[0][TimelineModel.TimelineIRModel._eventIRPhase]=phase;}
interactionRecords(){return this._segments;}
reset(){const thresholdsMs=TimelineModel.TimelineIRModel._mergeThresholdsMs;this._segments=[];this._drags=new Common.SegmentedRange(merge.bind(null,thresholdsMs.mouse));this._cssAnimations=new Common.SegmentedRange(merge.bind(null,thresholdsMs.animation));this._responses=new Common.SegmentedRange(merge.bind(null,0));this._scrolls=new Common.SegmentedRange(merge.bind(null,thresholdsMs.animation));function merge(threshold,first,second){return first.end+threshold>=second.begin&&first.data===second.data?first:null;}}
_inputEventType(eventName){const prefix='InputLatency::';if(!eventName.startsWith(prefix)){if(eventName===TimelineModel.TimelineIRModel.InputEvents.ImplSideFling)
return(eventName);console.error('Unrecognized input latency event: '+eventName);return null;}
return(eventName.substr(prefix.length));}};TimelineModel.TimelineIRModel.Phases={Idle:'Idle',Response:'Response',Scroll:'Scroll',Fling:'Fling',Drag:'Drag',Animation:'Animation',Uncategorized:'Uncategorized'};TimelineModel.TimelineIRModel.InputEvents={Char:'Char',Click:'GestureClick',ContextMenu:'ContextMenu',FlingCancel:'GestureFlingCancel',FlingStart:'GestureFlingStart',ImplSideFling:TimelineModel.TimelineModel.RecordType.ImplSideFling,KeyDown:'KeyDown',KeyDownRaw:'RawKeyDown',KeyUp:'KeyUp',LatencyScrollUpdate:'ScrollUpdate',MouseDown:'MouseDown',MouseMove:'MouseMove',MouseUp:'MouseUp',MouseWheel:'MouseWheel',PinchBegin:'GesturePinchBegin',PinchEnd:'GesturePinchEnd',PinchUpdate:'GesturePinchUpdate',ScrollBegin:'GestureScrollBegin',ScrollEnd:'GestureScrollEnd',ScrollUpdate:'GestureScrollUpdate',ScrollUpdateRenderer:'ScrollUpdate',ShowPress:'GestureShowPress',Tap:'GestureTap',TapCancel:'GestureTapCancel',TapDown:'GestureTapDown',TouchCancel:'TouchCancel',TouchEnd:'TouchEnd',TouchMove:'TouchMove',TouchStart:'TouchStart'};TimelineModel.TimelineIRModel._mergeThresholdsMs={animation:1,mouse:40,};TimelineModel.TimelineIRModel._eventIRPhase=Symbol('eventIRPhase');;TimelineModel.TimelineJSProfileProcessor=class{static generateTracingEventsFromCpuProfile(jsProfileModel,thread){const idleNode=jsProfileModel.idleNode;const programNode=jsProfileModel.programNode;const gcNode=jsProfileModel.gcNode;const samples=jsProfileModel.samples;const timestamps=jsProfileModel.timestamps;const jsEvents=[];const nodeToStackMap=new Map();nodeToStackMap.set(programNode,[]);for(let i=0;i<samples.length;++i){let node=jsProfileModel.nodeByIndex(i);if(!node){console.error(`Node with unknown id ${samples[i]} at index ${i}`);continue;}
if(node===gcNode||node===idleNode)
continue;let callFrames=nodeToStackMap.get(node);if(!callFrames){callFrames=(new Array(node.depth+1));nodeToStackMap.set(node,callFrames);for(let j=0;node.parent;node=node.parent)
callFrames[j++]=(node);}
const jsSampleEvent=new SDK.TracingModel.Event(SDK.TracingModel.DevToolsTimelineEventCategory,TimelineModel.TimelineModel.RecordType.JSSample,SDK.TracingModel.Phase.Instant,timestamps[i],thread);jsSampleEvent.args['data']={stackTrace:callFrames};jsEvents.push(jsSampleEvent);}
return jsEvents;}
static generateJSFrameEvents(events){function equalFrames(frame1,frame2){return frame1.scriptId===frame2.scriptId&&frame1.functionName===frame2.functionName&&frame1.lineNumber===frame2.lineNumber;}
function isJSInvocationEvent(e){switch(e.name){case TimelineModel.TimelineModel.RecordType.RunMicrotasks:case TimelineModel.TimelineModel.RecordType.FunctionCall:case TimelineModel.TimelineModel.RecordType.EvaluateScript:case TimelineModel.TimelineModel.RecordType.EvaluateModule:case TimelineModel.TimelineModel.RecordType.EventDispatch:case TimelineModel.TimelineModel.RecordType.V8Execute:return true;}
return false;}
const jsFrameEvents=[];const jsFramesStack=[];const lockedJsStackDepth=[];let ordinal=0;const showAllEvents=Runtime.experiments.isEnabled('timelineShowAllEvents');const showRuntimeCallStats=Runtime.experiments.isEnabled('timelineV8RuntimeCallStats');const showNativeFunctions=Common.moduleSetting('showNativeFunctionsInJSProfile').get();function onStartEvent(e){e.ordinal=++ordinal;extractStackTrace(e);lockedJsStackDepth.push(jsFramesStack.length);}
function onInstantEvent(e,parent){e.ordinal=++ordinal;if(parent&&isJSInvocationEvent(parent))
extractStackTrace(e);}
function onEndEvent(e){truncateJSStack(lockedJsStackDepth.pop(),e.endTime);}
function truncateJSStack(depth,time){if(lockedJsStackDepth.length){const lockedDepth=lockedJsStackDepth.peekLast();if(depth<lockedDepth){console.error(`Child stack is shallower (${depth}) than the parent stack (${lockedDepth}) at ${time}`);depth=lockedDepth;}}
if(jsFramesStack.length<depth){console.error(`Trying to truncate higher than the current stack size at ${time}`);depth=jsFramesStack.length;}
for(let k=0;k<jsFramesStack.length;++k)
jsFramesStack[k].setEndTime(time);jsFramesStack.length=depth;}
function showNativeName(name){return showRuntimeCallStats&&!!TimelineModel.TimelineJSProfileProcessor.nativeGroup(name);}
function filterStackFrames(stack){if(showAllEvents)
return;let previousNativeFrameName=null;let j=0;for(let i=0;i<stack.length;++i){const frame=stack[i];const url=frame.url;const isNativeFrame=url&&url.startsWith('native ');if(!showNativeFunctions&&isNativeFrame)
continue;const isNativeRuntimeFrame=TimelineModel.TimelineJSProfileProcessor.isNativeRuntimeFrame(frame);if(isNativeRuntimeFrame&&!showNativeName(frame.functionName))
continue;const nativeFrameName=isNativeRuntimeFrame?TimelineModel.TimelineJSProfileProcessor.nativeGroup(frame.functionName):null;if(previousNativeFrameName&&previousNativeFrameName===nativeFrameName)
continue;previousNativeFrameName=nativeFrameName;stack[j++]=frame;}
stack.length=j;}
function extractStackTrace(e){const recordTypes=TimelineModel.TimelineModel.RecordType;const callFrames=e.name===recordTypes.JSSample?e.args['data']['stackTrace'].slice().reverse():jsFramesStack.map(frameEvent=>frameEvent.args['data']);filterStackFrames(callFrames);const endTime=e.endTime||e.startTime;const minFrames=Math.min(callFrames.length,jsFramesStack.length);let i;for(i=lockedJsStackDepth.peekLast()||0;i<minFrames;++i){const newFrame=callFrames[i];const oldFrame=jsFramesStack[i].args['data'];if(!equalFrames(newFrame,oldFrame))
break;jsFramesStack[i].setEndTime(Math.max(jsFramesStack[i].endTime,endTime));}
truncateJSStack(i,e.startTime);for(;i<callFrames.length;++i){const frame=callFrames[i];const jsFrameEvent=new SDK.TracingModel.Event(SDK.TracingModel.DevToolsTimelineEventCategory,recordTypes.JSFrame,SDK.TracingModel.Phase.Complete,e.startTime,e.thread);jsFrameEvent.ordinal=e.ordinal;jsFrameEvent.addArgs({data:frame});jsFrameEvent.setEndTime(endTime);jsFramesStack.push(jsFrameEvent);jsFrameEvents.push(jsFrameEvent);}}
const firstTopLevelEvent=events.find(SDK.TracingModel.isTopLevelEvent);const startTime=firstTopLevelEvent?firstTopLevelEvent.startTime:0;TimelineModel.TimelineModel.forEachEvent(events,onStartEvent,onEndEvent,onInstantEvent,startTime);return jsFrameEvents;}
static isNativeRuntimeFrame(frame){return frame.url==='native V8Runtime';}
static nativeGroup(nativeName){if(nativeName.startsWith('Parse'))
return TimelineModel.TimelineJSProfileProcessor.NativeGroups.Parse;if(nativeName.startsWith('Compile')||nativeName.startsWith('Recompile'))
return TimelineModel.TimelineJSProfileProcessor.NativeGroups.Compile;return null;}
static buildTraceProfileFromCpuProfile(profile,tid,injectPageEvent,name){const events=[];if(injectPageEvent)
appendEvent('TracingStartedInPage',{data:{'sessionId':'1'}},0,0,'M');if(!name)
name=ls`Thread ${tid}`;appendEvent(SDK.TracingModel.MetadataEvent.ThreadName,{name},0,0,'M','__metadata');if(!profile)
return events;const idToNode=new Map();const nodes=profile['nodes'];for(let i=0;i<nodes.length;++i)
idToNode.set(nodes[i].id,nodes[i]);let programEvent=null;let functionEvent=null;let nextTime=profile.startTime;let currentTime;const samples=profile['samples'];const timeDeltas=profile['timeDeltas'];for(let i=0;i<samples.length;++i){currentTime=nextTime;nextTime+=timeDeltas[i];const node=idToNode.get(samples[i]);const name=node.callFrame.functionName;if(name==='(idle)'){closeEvents();continue;}
if(!programEvent)
programEvent=appendEvent('MessageLoop::RunTask',{},currentTime,0,'X','toplevel');if(name==='(program)'){if(functionEvent){functionEvent.dur=currentTime-functionEvent.ts;functionEvent=null;}}else{if(!functionEvent)
functionEvent=appendEvent('FunctionCall',{data:{'sessionId':'1'}},currentTime);}}
closeEvents();appendEvent('CpuProfile',{data:{'cpuProfile':profile}},profile.endTime,0,'I');return events;function closeEvents(){if(programEvent)
programEvent.dur=currentTime-programEvent.ts;if(functionEvent)
functionEvent.dur=currentTime-functionEvent.ts;programEvent=null;functionEvent=null;}
function appendEvent(name,args,ts,dur,ph,cat){const event=({cat:cat||'disabled-by-default-devtools.timeline',name,ph:ph||'X',pid:1,tid,ts,args});if(dur)
event.dur=dur;events.push(event);return event;}}};TimelineModel.TimelineJSProfileProcessor.NativeGroups={'Compile':'Compile','Parse':'Parse'};;TimelineModel.TimelineFrameModel=class{constructor(categoryMapper){this._categoryMapper=categoryMapper;this.reset();}
frames(startTime,endTime){if(!startTime&&!endTime)
return this._frames;const firstFrame=this._frames.lowerBound(startTime||0,(time,frame)=>time-frame.endTime);const lastFrame=this._frames.lowerBound(endTime||Infinity,(time,frame)=>time-frame.startTime);return this._frames.slice(firstFrame,lastFrame);}
hasRasterTile(rasterTask){const data=rasterTask.args['tileData'];if(!data)
return false;const frameId=data['sourceFrameNumber'];const frame=frameId&&this._frameById[frameId];if(!frame||!frame.layerTree)
return false;return true;}
rasterTilePromise(rasterTask){if(!this._target)
return Promise.resolve(null);const data=rasterTask.args['tileData'];const frameId=data['sourceFrameNumber'];const tileId=data['tileId']&&data['tileId']['id_ref'];const frame=frameId&&this._frameById[frameId];if(!frame||!frame.layerTree||!tileId)
return Promise.resolve(null);return frame.layerTree.layerTreePromise().then(layerTree=>layerTree&&layerTree.pictureForRasterTile(tileId));}
reset(){this._minimumRecordTime=Infinity;this._frames=[];this._frameById={};this._lastFrame=null;this._lastLayerTree=null;this._mainFrameCommitted=false;this._mainFrameRequested=false;this._framePendingCommit=null;this._lastBeginFrame=null;this._lastNeedsBeginFrame=null;this._framePendingActivation=null;this._lastTaskBeginTime=null;this._target=null;this._layerTreeId=null;this._currentTaskTimeByCategory={};}
handleBeginFrame(startTime){if(!this._lastFrame)
this._startFrame(startTime);this._lastBeginFrame=startTime;}
handleDrawFrame(startTime){if(!this._lastFrame){this._startFrame(startTime);return;}
if(this._mainFrameCommitted||!this._mainFrameRequested){if(this._lastNeedsBeginFrame){const idleTimeEnd=this._framePendingActivation?this._framePendingActivation.triggerTime:(this._lastBeginFrame||this._lastNeedsBeginFrame);if(idleTimeEnd>this._lastFrame.startTime){this._lastFrame.idle=true;this._startFrame(idleTimeEnd);if(this._framePendingActivation)
this._commitPendingFrame();this._lastBeginFrame=null;}
this._lastNeedsBeginFrame=null;}
this._startFrame(startTime);}
this._mainFrameCommitted=false;}
handleActivateLayerTree(){if(!this._lastFrame)
return;if(this._framePendingActivation&&!this._lastNeedsBeginFrame)
this._commitPendingFrame();}
handleRequestMainThreadFrame(){if(!this._lastFrame)
return;this._mainFrameRequested=true;}
handleCompositeLayers(){if(!this._framePendingCommit)
return;this._framePendingActivation=this._framePendingCommit;this._framePendingCommit=null;this._mainFrameRequested=false;this._mainFrameCommitted=true;}
handleLayerTreeSnapshot(layerTree){this._lastLayerTree=layerTree;}
handleNeedFrameChanged(startTime,needsBeginFrame){if(needsBeginFrame)
this._lastNeedsBeginFrame=startTime;}
_startFrame(startTime){if(this._lastFrame)
this._flushFrame(this._lastFrame,startTime);this._lastFrame=new TimelineModel.TimelineFrame(startTime,startTime-this._minimumRecordTime);}
_flushFrame(frame,endTime){frame._setLayerTree(this._lastLayerTree);frame._setEndTime(endTime);if(this._lastLayerTree)
this._lastLayerTree._setPaints(frame._paints);if(this._frames.length&&(frame.startTime!==this._frames.peekLast().endTime||frame.startTime>frame.endTime)){console.assert(false,`Inconsistent frame time for frame ${this._frames.length} (${frame.startTime} - ${frame.endTime})`);}
this._frames.push(frame);if(typeof frame._mainFrameId==='number')
this._frameById[frame._mainFrameId]=frame;}
_commitPendingFrame(){this._lastFrame._addTimeForCategories(this._framePendingActivation.timeByCategory);this._lastFrame._paints=this._framePendingActivation.paints;this._lastFrame._mainFrameId=this._framePendingActivation.mainFrameId;this._framePendingActivation=null;}
addTraceEvents(target,events,threadData){this._target=target;let j=0;this._currentProcessMainThread=threadData.length&&threadData[0].thread||null;for(let i=0;i<events.length;++i){while(j+1<threadData.length&&threadData[j+1].time<=events[i].startTime)
this._currentProcessMainThread=threadData[++j].thread;this._addTraceEvent(events[i]);}
this._currentProcessMainThread=null;}
_addTraceEvent(event){const eventNames=TimelineModel.TimelineModel.RecordType;if(event.startTime&&event.startTime<this._minimumRecordTime)
this._minimumRecordTime=event.startTime;if(event.name===eventNames.SetLayerTreeId){this._layerTreeId=event.args['layerTreeId']||event.args['data']['layerTreeId'];}else if(event.phase===SDK.TracingModel.Phase.SnapshotObject&&event.name===eventNames.LayerTreeHostImplSnapshot&&parseInt(event.id,0)===this._layerTreeId){const snapshot=(event);this.handleLayerTreeSnapshot(new TimelineModel.TracingFrameLayerTree(this._target,snapshot));}else{this._processCompositorEvents(event);if(event.thread===this._currentProcessMainThread)
this._addMainThreadTraceEvent(event);else if(this._lastFrame&&event.selfTime&&!SDK.TracingModel.isTopLevelEvent(event))
this._lastFrame._addTimeForCategory(this._categoryMapper(event),event.selfTime);}}
_processCompositorEvents(event){const eventNames=TimelineModel.TimelineModel.RecordType;if(event.args['layerTreeId']!==this._layerTreeId)
return;const timestamp=event.startTime;if(event.name===eventNames.BeginFrame)
this.handleBeginFrame(timestamp);else if(event.name===eventNames.DrawFrame)
this.handleDrawFrame(timestamp);else if(event.name===eventNames.ActivateLayerTree)
this.handleActivateLayerTree();else if(event.name===eventNames.RequestMainThreadFrame)
this.handleRequestMainThreadFrame();else if(event.name===eventNames.NeedsBeginFrameChanged)
this.handleNeedFrameChanged(timestamp,event.args['data']&&event.args['data']['needsBeginFrame']);}
_addMainThreadTraceEvent(event){const eventNames=TimelineModel.TimelineModel.RecordType;if(SDK.TracingModel.isTopLevelEvent(event)){this._currentTaskTimeByCategory={};this._lastTaskBeginTime=event.startTime;}
if(!this._framePendingCommit&&TimelineModel.TimelineFrameModel._mainFrameMarkers.indexOf(event.name)>=0){this._framePendingCommit=new TimelineModel.PendingFrame(this._lastTaskBeginTime||event.startTime,this._currentTaskTimeByCategory);}
if(!this._framePendingCommit){this._addTimeForCategory(this._currentTaskTimeByCategory,event);return;}
this._addTimeForCategory(this._framePendingCommit.timeByCategory,event);if(event.name===eventNames.BeginMainThreadFrame&&event.args['data']&&event.args['data']['frameId'])
this._framePendingCommit.mainFrameId=event.args['data']['frameId'];if(event.name===eventNames.Paint&&event.args['data']['layerId']&&TimelineModel.TimelineData.forEvent(event).picture&&this._target)
this._framePendingCommit.paints.push(new TimelineModel.LayerPaintEvent(event,this._target));if(event.name===eventNames.CompositeLayers&&event.args['layerTreeId']===this._layerTreeId)
this.handleCompositeLayers();}
_addTimeForCategory(timeByCategory,event){if(!event.selfTime)
return;const categoryName=this._categoryMapper(event);timeByCategory[categoryName]=(timeByCategory[categoryName]||0)+event.selfTime;}};TimelineModel.TimelineFrameModel._mainFrameMarkers=[TimelineModel.TimelineModel.RecordType.ScheduleStyleRecalculation,TimelineModel.TimelineModel.RecordType.InvalidateLayout,TimelineModel.TimelineModel.RecordType.BeginMainThreadFrame,TimelineModel.TimelineModel.RecordType.ScrollLayer];TimelineModel.TracingFrameLayerTree=class{constructor(target,snapshot){this._target=target;this._snapshot=snapshot;this._paints;}
async layerTreePromise(){const result=await this._snapshot.objectPromise();if(!result)
return null;const viewport=result['device_viewport_size'];const tiles=result['active_tiles'];const rootLayer=result['active_tree']['root_layer'];const layers=result['active_tree']['layers'];const layerTree=new TimelineModel.TracingLayerTree(this._target);layerTree.setViewportSize(viewport);layerTree.setTiles(tiles);await layerTree.setLayers(rootLayer,layers,this._paints||[]);return layerTree;}
paints(){return this._paints||[];}
_setPaints(paints){this._paints=paints;}};TimelineModel.TimelineFrame=class{constructor(startTime,startTimeOffset){this.startTime=startTime;this.startTimeOffset=startTimeOffset;this.endTime=this.startTime;this.duration=0;this.timeByCategory={};this.cpuTime=0;this.idle=false;this.layerTree=null;this._paints=[];this._mainFrameId=undefined;}
hasWarnings(){return false;}
_setEndTime(endTime){this.endTime=endTime;this.duration=this.endTime-this.startTime;}
_setLayerTree(layerTree){this.layerTree=layerTree;}
_addTimeForCategories(timeByCategory){for(const category in timeByCategory)
this._addTimeForCategory(category,timeByCategory[category]);}
_addTimeForCategory(category,time){this.timeByCategory[category]=(this.timeByCategory[category]||0)+time;this.cpuTime+=time;}};TimelineModel.LayerPaintEvent=class{constructor(event,target){this._event=event;this._target=target;}
layerId(){return this._event.args['data']['layerId'];}
event(){return this._event;}
picturePromise(){const picture=TimelineModel.TimelineData.forEvent(this._event).picture;return picture.objectPromise().then(result=>{if(!result)
return null;const rect=result['params']&&result['params']['layer_rect'];const picture=result['skp64'];return rect&&picture?{rect:rect,serializedPicture:picture}:null;});}
snapshotPromise(){const paintProfilerModel=this._target&&this._target.model(SDK.PaintProfilerModel);return this.picturePromise().then(picture=>{if(!picture||!paintProfilerModel)
return null;return paintProfilerModel.loadSnapshot(picture.serializedPicture).then(snapshot=>snapshot?{rect:picture.rect,snapshot:snapshot}:null);});}};TimelineModel.PendingFrame=class{constructor(triggerTime,timeByCategory){this.timeByCategory=timeByCategory;this.paints=[];this.mainFrameId=undefined;this.triggerTime=triggerTime;}};;TimelineModel.TimelineProfileTree={};TimelineModel.TimelineProfileTree.Node=class{constructor(id,event){this.totalTime=0;this.selfTime=0;this.id=id;this.event=event;this.parent;this._groupId='';this._isGroupNode=false;}
isGroupNode(){return this._isGroupNode;}
hasChildren(){throw'Not implemented';}
children(){throw'Not implemented';}
searchTree(matchFunction,results){results=results||[];if(this.event&&matchFunction(this.event))
results.push(this);for(const child of this.children().values())
child.searchTree(matchFunction,results);return results;}};TimelineModel.TimelineProfileTree.TopDownNode=class extends TimelineModel.TimelineProfileTree.Node{constructor(id,event,parent){super(id,event);this._root=parent&&parent._root;this._hasChildren=false;this._children=null;this.parent=parent;}
hasChildren(){return this._hasChildren;}
children(){return this._children||this._buildChildren();}
_buildChildren(){const path=[];for(let node=this;node.parent&&!node._isGroupNode;node=node.parent)
path.push((node));path.reverse();const children=new Map();const self=this;const root=this._root;const startTime=root._startTime;const endTime=root._endTime;const instantEventCallback=root._doNotAggregate?onInstantEvent:undefined;const eventIdCallback=root._doNotAggregate?undefined:TimelineModel.TimelineProfileTree._eventId;const eventGroupIdCallback=root._eventGroupIdCallback;let depth=0;let matchedDepth=0;let currentDirectChild=null;TimelineModel.TimelineModel.forEachEvent(root._events,onStartEvent,onEndEvent,instantEventCallback,startTime,endTime,root._filter);function onStartEvent(e){++depth;if(depth>path.length+2)
return;if(!matchPath(e))
return;const duration=Math.min(endTime,e.endTime)-Math.max(startTime,e.startTime);if(duration<0)
console.error('Negative event duration');processEvent(e,duration);}
function onInstantEvent(e){++depth;if(matchedDepth===path.length&&depth<=path.length+2)
processEvent(e,0);--depth;}
function processEvent(e,duration){if(depth===path.length+2){currentDirectChild._hasChildren=true;currentDirectChild.selfTime-=duration;return;}
let id;let groupId='';if(!eventIdCallback){id=Symbol('uniqueId');}else{id=eventIdCallback(e);groupId=eventGroupIdCallback?eventGroupIdCallback(e):'';if(groupId)
id+='/'+groupId;}
let node=children.get(id);if(!node){node=new TimelineModel.TimelineProfileTree.TopDownNode(id,e,self);node._groupId=groupId;children.set(id,node);}
node.selfTime+=duration;node.totalTime+=duration;currentDirectChild=node;}
function matchPath(e){if(matchedDepth===path.length)
return true;if(matchedDepth!==depth-1)
return false;if(!e.endTime)
return false;if(!eventIdCallback){if(e===path[matchedDepth].event)
++matchedDepth;return false;}
let id=eventIdCallback(e);const groupId=eventGroupIdCallback?eventGroupIdCallback(e):'';if(groupId)
id+='/'+groupId;if(id===path[matchedDepth].id)
++matchedDepth;return false;}
function onEndEvent(e){--depth;if(matchedDepth>depth)
matchedDepth=depth;}
this._children=children;return children;}};TimelineModel.TimelineProfileTree.TopDownRootNode=class extends TimelineModel.TimelineProfileTree.TopDownNode{constructor(events,filters,startTime,endTime,doNotAggregate,eventGroupIdCallback){super('',null,null);this._root=this;this._events=events;this._filter=e=>filters.every(f=>f.accept(e));this._startTime=startTime;this._endTime=endTime;this._eventGroupIdCallback=eventGroupIdCallback;this._doNotAggregate=doNotAggregate;this.totalTime=endTime-startTime;this.selfTime=this.totalTime;}
children(){return this._children||this._grouppedTopNodes();}
_grouppedTopNodes(){const flatNodes=super.children();for(const node of flatNodes.values())
this.selfTime-=node.totalTime;if(!this._eventGroupIdCallback)
return flatNodes;const groupNodes=new Map();for(const node of flatNodes.values()){const groupId=this._eventGroupIdCallback((node.event));let groupNode=groupNodes.get(groupId);if(!groupNode){groupNode=new TimelineModel.TimelineProfileTree.GroupNode(groupId,this,(node.event));groupNodes.set(groupId,groupNode);}
groupNode.addChild(node,node.selfTime,node.totalTime);}
this._children=groupNodes;return groupNodes;}};TimelineModel.TimelineProfileTree.BottomUpRootNode=class extends TimelineModel.TimelineProfileTree.Node{constructor(events,textFilter,filters,startTime,endTime,eventGroupIdCallback){super('',null);this._children=null;this._events=events;this._textFilter=textFilter;this._filter=e=>filters.every(f=>f.accept(e));this._startTime=startTime;this._endTime=endTime;this._eventGroupIdCallback=eventGroupIdCallback;this.totalTime=endTime-startTime;}
hasChildren(){return true;}
_filterChildren(children){for(const[id,child]of children){if(child.event&&!this._textFilter.accept(child.event))
children.delete((id));}
return children;}
children(){if(!this._children)
this._children=this._filterChildren(this._grouppedTopNodes());return this._children;}
_ungrouppedTopNodes(){const root=this;const startTime=this._startTime;const endTime=this._endTime;const nodeById=new Map();const selfTimeStack=[endTime-startTime];const firstNodeStack=[];const totalTimeById=new Map();TimelineModel.TimelineModel.forEachEvent(this._events,onStartEvent,onEndEvent,undefined,startTime,endTime,this._filter);function onStartEvent(e){const duration=Math.min(e.endTime,endTime)-Math.max(e.startTime,startTime);selfTimeStack[selfTimeStack.length-1]-=duration;selfTimeStack.push(duration);const id=TimelineModel.TimelineProfileTree._eventId(e);const noNodeOnStack=!totalTimeById.has(id);if(noNodeOnStack)
totalTimeById.set(id,duration);firstNodeStack.push(noNodeOnStack);}
function onEndEvent(e){const id=TimelineModel.TimelineProfileTree._eventId(e);let node=nodeById.get(id);if(!node){node=new TimelineModel.TimelineProfileTree.BottomUpNode(root,id,e,false,root);nodeById.set(id,node);}
node.selfTime+=selfTimeStack.pop();if(firstNodeStack.pop()){node.totalTime+=totalTimeById.get(id);totalTimeById.delete(id);}
if(firstNodeStack.length)
node.setHasChildren();}
this.selfTime=selfTimeStack.pop();for(const pair of nodeById){if(pair[1].selfTime<=0)
nodeById.delete((pair[0]));}
return nodeById;}
_grouppedTopNodes(){const flatNodes=this._ungrouppedTopNodes();if(!this._eventGroupIdCallback)
return flatNodes;const groupNodes=new Map();for(const node of flatNodes.values()){const groupId=this._eventGroupIdCallback((node.event));let groupNode=groupNodes.get(groupId);if(!groupNode){groupNode=new TimelineModel.TimelineProfileTree.GroupNode(groupId,this,(node.event));groupNodes.set(groupId,groupNode);}
groupNode.addChild(node,node.selfTime,node.selfTime);}
return groupNodes;}};TimelineModel.TimelineProfileTree.GroupNode=class extends TimelineModel.TimelineProfileTree.Node{constructor(id,parent,event){super(id,event);this._children=new Map();this.parent=parent;this._isGroupNode=true;}
addChild(child,selfTime,totalTime){this._children.set(child.id,child);this.selfTime+=selfTime;this.totalTime+=totalTime;child.parent=this;}
hasChildren(){return true;}
children(){return this._children;}};TimelineModel.TimelineProfileTree.BottomUpNode=class extends TimelineModel.TimelineProfileTree.Node{constructor(root,id,event,hasChildren,parent){super(id,event);this.parent=parent;this._root=root;this._depth=(parent._depth||0)+1;this._cachedChildren=null;this._hasChildren=hasChildren;}
setHasChildren(){this._hasChildren=true;}
hasChildren(){return this._hasChildren;}
children(){if(this._cachedChildren)
return this._cachedChildren;const selfTimeStack=[0];const eventIdStack=[];const eventStack=[];const nodeById=new Map();const startTime=this._root._startTime;const endTime=this._root._endTime;let lastTimeMarker=startTime;const self=this;TimelineModel.TimelineModel.forEachEvent(this._root._events,onStartEvent,onEndEvent,undefined,startTime,endTime,this._root._filter);function onStartEvent(e){const duration=Math.min(e.endTime,endTime)-Math.max(e.startTime,startTime);if(duration<0)
console.assert(false,'Negative duration of an event');selfTimeStack[selfTimeStack.length-1]-=duration;selfTimeStack.push(duration);const id=TimelineModel.TimelineProfileTree._eventId(e);eventIdStack.push(id);eventStack.push(e);}
function onEndEvent(e){const selfTime=selfTimeStack.pop();const id=eventIdStack.pop();eventStack.pop();let node;for(node=self;node._depth>1;node=node.parent){if(node.id!==eventIdStack[eventIdStack.length+1-node._depth])
return;}
if(node.id!==id||eventIdStack.length<self._depth)
return;const childId=eventIdStack[eventIdStack.length-self._depth];node=nodeById.get(childId);if(!node){const event=eventStack[eventStack.length-self._depth];const hasChildren=eventStack.length>self._depth;node=new TimelineModel.TimelineProfileTree.BottomUpNode(self._root,childId,event,hasChildren,self);nodeById.set(childId,node);}
const totalTime=Math.min(e.endTime,endTime)-Math.max(e.startTime,lastTimeMarker);node.selfTime+=selfTime;node.totalTime+=totalTime;lastTimeMarker=Math.min(e.endTime,endTime);}
this._cachedChildren=this._root._filterChildren(nodeById);return this._cachedChildren;}
searchTree(matchFunction,results){results=results||[];if(this.event&&matchFunction(this.event))
results.push(this);return results;}};TimelineModel.TimelineProfileTree.eventURL=function(event){const data=event.args['data']||event.args['beginData'];if(data&&data['url'])
return data['url'];let frame=TimelineModel.TimelineProfileTree.eventStackFrame(event);while(frame){const url=frame['url'];if(url)
return url;frame=frame.parent;}
return null;};TimelineModel.TimelineProfileTree.eventStackFrame=function(event){if(event.name===TimelineModel.TimelineModel.RecordType.JSFrame)
return(event.args['data']||null);return TimelineModel.TimelineData.forEvent(event).topFrame();};TimelineModel.TimelineProfileTree._eventId=function(event){if(event.name===TimelineModel.TimelineModel.RecordType.TimeStamp)
return`${event.name}:${event.args.data.message}`;if(event.name!==TimelineModel.TimelineModel.RecordType.JSFrame)
return event.name;const frame=event.args['data'];const location=frame['scriptId']||frame['url']||'';const functionName=frame['functionName'];const name=TimelineModel.TimelineJSProfileProcessor.isNativeRuntimeFrame(frame)?TimelineModel.TimelineJSProfileProcessor.nativeGroup(functionName)||functionName:`${functionName}:${frame['lineNumber']}:${frame['columnNumber']}`;return`f:${name}@${location}`;};;Timeline.CountersGraph=class extends UI.VBox{constructor(delegate){super();this.element.id='memory-graphs-container';this._delegate=delegate;this._calculator=new Timeline.CountersGraph.Calculator();this._header=new UI.HBox();this._header.element.classList.add('timeline-memory-header');this._header.show(this.element);this._toolbar=new UI.Toolbar('timeline-memory-toolbar');this._header.element.appendChild(this._toolbar.element);this._graphsContainer=new UI.VBox();this._graphsContainer.show(this.element);const canvasWidget=new UI.VBoxWithResizeCallback(this._resize.bind(this));canvasWidget.show(this._graphsContainer.element);this._createCurrentValuesBar();this._canvasContainer=canvasWidget.element;this._canvasContainer.id='memory-graphs-canvas-container';this._canvas=this._canvasContainer.createChild('canvas');this._canvas.id='memory-counters-graph';this._canvasContainer.addEventListener('mouseover',this._onMouseMove.bind(this),true);this._canvasContainer.addEventListener('mousemove',this._onMouseMove.bind(this),true);this._canvasContainer.addEventListener('mouseleave',this._onMouseLeave.bind(this),true);this._canvasContainer.addEventListener('click',this._onClick.bind(this),true);this._timelineGrid=new PerfUI.TimelineGrid();this._canvasContainer.appendChild(this._timelineGrid.dividersElement);this._counters=[];this._counterUI=[];this._countersByName={};this._countersByName['jsHeapSizeUsed']=this._createCounter(Common.UIString('JS Heap'),Common.UIString('JS Heap: %s'),'hsl(220, 90%, 43%)',Number.bytesToString);this._countersByName['documents']=this._createCounter(Common.UIString('Documents'),Common.UIString('Documents: %s'),'hsl(0, 90%, 43%)');this._countersByName['nodes']=this._createCounter(Common.UIString('Nodes'),Common.UIString('Nodes: %s'),'hsl(120, 90%, 43%)');this._countersByName['jsEventListeners']=this._createCounter(Common.UIString('Listeners'),Common.UIString('Listeners: %s'),'hsl(38, 90%, 43%)');this._gpuMemoryCounter=this._createCounter(Common.UIString('GPU Memory'),Common.UIString('GPU Memory [KB]: %s'),'hsl(300, 90%, 43%)',Number.bytesToString);this._countersByName['gpuMemoryUsedKB']=this._gpuMemoryCounter;}
setModel(model,track){if(this._model!==model){if(this._model)
this._model.removeEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this);this._model=model;if(this._model)
this._model.addEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this);}
this._calculator.setZeroTime(model?model.timelineModel().minimumRecordTime():0);for(let i=0;i<this._counters.length;++i){this._counters[i].reset();this._counterUI[i].reset();}
this.scheduleRefresh();this._track=track;if(!track)
return;const events=track.syncEvents();for(let i=0;i<events.length;++i){const event=events[i];if(event.name!==TimelineModel.TimelineModel.RecordType.UpdateCounters)
continue;const counters=event.args.data;if(!counters)
return;for(const name in counters){const counter=this._countersByName[name];if(counter)
counter.appendSample(event.startTime,counters[name]);}
const gpuMemoryLimitCounterName='gpuMemoryLimitKB';if(gpuMemoryLimitCounterName in counters)
this._gpuMemoryCounter.setLimit(counters[gpuMemoryLimitCounterName]);}}
_createCurrentValuesBar(){this._currentValuesBar=this._graphsContainer.element.createChild('div');this._currentValuesBar.id='counter-values-bar';}
_createCounter(uiName,uiValueTemplate,color,formatter){const counter=new Timeline.CountersGraph.Counter();this._counters.push(counter);this._counterUI.push(new Timeline.CountersGraph.CounterUI(this,uiName,uiValueTemplate,color,counter,formatter));return counter;}
resizerElement(){return this._header.element;}
_resize(){const parentElement=this._canvas.parentElement;this._canvas.width=parentElement.clientWidth*window.devicePixelRatio;this._canvas.height=parentElement.clientHeight*window.devicePixelRatio;this._calculator.setDisplayWidth(this._canvas.width);this.refresh();}
_onWindowChanged(event){const window=(event.data.window);this._calculator.setWindow(window.left,window.right);this.scheduleRefresh();}
scheduleRefresh(){UI.invokeOnceAfterBatchUpdate(this,this.refresh);}
draw(){this._clear();for(const counter of this._counters){counter._calculateVisibleIndexes(this._calculator);counter._calculateXValues(this._canvas.width);}
for(const counterUI of this._counterUI)
counterUI._drawGraph(this._canvas);}
_onClick(event){const x=event.x-this._canvasContainer.totalOffsetLeft();let minDistance=Infinity;let bestTime;for(const counterUI of this._counterUI){if(!counterUI.counter.times.length)
continue;const index=counterUI._recordIndexAt(x);const distance=Math.abs(x*window.devicePixelRatio-counterUI.counter.x[index]);if(distance<minDistance){minDistance=distance;bestTime=counterUI.counter.times[index];}}
if(bestTime!==undefined){this._delegate.selectEntryAtTime(this._track.events.length?this._track.events:this._track.asyncEvents,bestTime);}}
_onMouseLeave(event){delete this._markerXPosition;this._clearCurrentValueAndMarker();}
_clearCurrentValueAndMarker(){for(let i=0;i<this._counterUI.length;i++)
this._counterUI[i]._clearCurrentValueAndMarker();}
_onMouseMove(event){const x=event.x-this._canvasContainer.totalOffsetLeft();this._markerXPosition=x;this._refreshCurrentValues();}
_refreshCurrentValues(){if(this._markerXPosition===undefined)
return;for(let i=0;i<this._counterUI.length;++i)
this._counterUI[i].updateCurrentValue(this._markerXPosition);}
refresh(){this._timelineGrid.updateDividers(this._calculator);this.draw();this._refreshCurrentValues();}
_clear(){const ctx=this._canvas.getContext('2d');ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);}};Timeline.CountersGraph.Counter=class{constructor(){this.times=[];this.values=[];}
appendSample(time,value){if(this.values.length&&this.values.peekLast()===value)
return;this.times.push(time);this.values.push(value);}
reset(){this.times=[];this.values=[];}
setLimit(value){this._limitValue=value;}
_calculateBounds(){let maxValue;let minValue;for(let i=this._minimumIndex;i<=this._maximumIndex;i++){const value=this.values[i];if(minValue===undefined||value<minValue)
minValue=value;if(maxValue===undefined||value>maxValue)
maxValue=value;}
minValue=minValue||0;maxValue=maxValue||1;if(this._limitValue){if(maxValue>this._limitValue*0.5)
maxValue=Math.max(maxValue,this._limitValue);minValue=Math.min(minValue,this._limitValue);}
return{min:minValue,max:maxValue};}
_calculateVisibleIndexes(calculator){const start=calculator.minimumBoundary();const end=calculator.maximumBoundary();this._minimumIndex=Number.constrain(this.times.upperBound(start)-1,0,this.times.length-1);this._maximumIndex=Number.constrain(this.times.lowerBound(end),0,this.times.length-1);this._minTime=start;this._maxTime=end;}
_calculateXValues(width){if(!this.values.length)
return;const xFactor=width/(this._maxTime-this._minTime);this.x=new Array(this.values.length);for(let i=this._minimumIndex+1;i<=this._maximumIndex;i++)
this.x[i]=xFactor*(this.times[i]-this._minTime);}};Timeline.CountersGraph.CounterUI=class{constructor(countersPane,title,currentValueLabel,graphColor,counter,formatter){this._countersPane=countersPane;this.counter=counter;this._formatter=formatter||Number.withThousandsSeparator;this._setting=Common.settings.createSetting('timelineCountersGraph-'+title,true);this._setting.setTitle(title);this._filter=new UI.ToolbarSettingCheckbox(this._setting,title);this._filter.inputElement.classList.add('-theme-preserve');const color=Common.Color.parse(graphColor).setAlpha(0.5).asString(Common.Color.Format.RGBA);if(color){this._filter.element.backgroundColor=color;this._filter.element.borderColor='transparent';}
this._filter.inputElement.addEventListener('click',this._toggleCounterGraph.bind(this));countersPane._toolbar.appendToolbarItem(this._filter);this._range=this._filter.element.createChild('span','range');this._value=countersPane._currentValuesBar.createChild('span','memory-counter-value');this._value.style.color=graphColor;this.graphColor=graphColor;this.limitColor=Common.Color.parse(graphColor).setAlpha(0.3).asString(Common.Color.Format.RGBA);this.graphYValues=[];this._verticalPadding=10;this._currentValueLabel=currentValueLabel;this._marker=countersPane._canvasContainer.createChild('div','memory-counter-marker');this._marker.style.backgroundColor=graphColor;this._clearCurrentValueAndMarker();}
reset(){this._range.textContent='';}
setRange(minValue,maxValue){const min=this._formatter(minValue);const max=this._formatter(maxValue);this._range.textContent=Common.UIString('[%s\xa0\u2013\xa0%s]',min,max);}
_toggleCounterGraph(event){this._value.classList.toggle('hidden',!this._filter.checked());this._countersPane.refresh();}
_recordIndexAt(x){return this.counter.x.upperBound(x*window.devicePixelRatio,null,this.counter._minimumIndex+1,this.counter._maximumIndex+1)-
1;}
updateCurrentValue(x){if(!this.visible()||!this.counter.values.length||!this.counter.x)
return;const index=this._recordIndexAt(x);const value=Number.withThousandsSeparator(this.counter.values[index]);this._value.textContent=Common.UIString(this._currentValueLabel,value);const y=this.graphYValues[index]/window.devicePixelRatio;this._marker.style.left=x+'px';this._marker.style.top=y+'px';this._marker.classList.remove('hidden');}
_clearCurrentValueAndMarker(){this._value.textContent='';this._marker.classList.add('hidden');}
_drawGraph(canvas){const ctx=canvas.getContext('2d');const width=canvas.width;const height=canvas.height-2*this._verticalPadding;if(height<=0){this.graphYValues=[];return;}
const originY=this._verticalPadding;const counter=this.counter;const values=counter.values;if(!values.length)
return;const bounds=counter._calculateBounds();const minValue=bounds.min;const maxValue=bounds.max;this.setRange(minValue,maxValue);if(!this.visible())
return;const yValues=this.graphYValues;const maxYRange=maxValue-minValue;const yFactor=maxYRange?height/(maxYRange):1;ctx.save();ctx.lineWidth=window.devicePixelRatio;if(ctx.lineWidth%2)
ctx.translate(0.5,0.5);ctx.beginPath();let value=values[counter._minimumIndex];let currentY=Math.round(originY+height-(value-minValue)*yFactor);ctx.moveTo(0,currentY);let i=counter._minimumIndex;for(;i<=counter._maximumIndex;i++){const x=Math.round(counter.x[i]);ctx.lineTo(x,currentY);const currentValue=values[i];if(typeof currentValue!=='undefined')
value=currentValue;currentY=Math.round(originY+height-(value-minValue)*yFactor);ctx.lineTo(x,currentY);yValues[i]=currentY;}
yValues.length=i;ctx.lineTo(width,currentY);ctx.strokeStyle=this.graphColor;ctx.stroke();if(counter._limitValue){const limitLineY=Math.round(originY+height-(counter._limitValue-minValue)*yFactor);ctx.moveTo(0,limitLineY);ctx.lineTo(width,limitLineY);ctx.strokeStyle=this.limitColor;ctx.stroke();}
ctx.closePath();ctx.restore();}
visible(){return this._filter.checked();}};Timeline.CountersGraph.Calculator=class{setZeroTime(time){this._zeroTime=time;}
computePosition(time){return(time-this._minimumBoundary)/this.boundarySpan()*this._workingArea;}
setWindow(minimumBoundary,maximumBoundary){this._minimumBoundary=minimumBoundary;this._maximumBoundary=maximumBoundary;}
setDisplayWidth(clientWidth){this._workingArea=clientWidth;}
formatValue(value,precision){return Number.preciseMillisToString(value-this.zeroTime(),precision);}
maximumBoundary(){return this._maximumBoundary;}
minimumBoundary(){return this._minimumBoundary;}
zeroTime(){return this._zeroTime;}
boundarySpan(){return this._maximumBoundary-this._minimumBoundary;}};;Timeline.ExtensionTracingSession=class{constructor(provider,performanceModel){this._provider=provider;this._performanceModel=performanceModel;this._completionCallback;this._completionPromise=new Promise(fulfill=>{this._completionCallback=fulfill;});this._timeOffset=0;}
loadingStarted(){}
processingStarted(){}
loadingProgress(progress){}
loadingComplete(tracingModel){if(!tracingModel)
return;this._performanceModel.addExtensionEvents(this._provider.longDisplayName(),tracingModel,this._timeOffset);this._completionCallback();}
complete(url,timeOffsetMicroseconds){if(!url){this._completionCallback();return;}
this._timeOffset=timeOffsetMicroseconds;Timeline.TimelineLoader.loadFromURL(url,this);}
start(){this._provider.start(this);}
stop(){this._provider.stop();return this._completionPromise;}};;Timeline.PerformanceModel=class extends Common.Object{constructor(){super();this._mainTarget=null;this._tracingModel=null;this._filters=[];this._timelineModel=new TimelineModel.TimelineModel();this._frameModel=new TimelineModel.TimelineFrameModel(event=>Timeline.TimelineUIUtils.eventStyle(event).category.name);this._filmStripModel=null;this._irModel=new TimelineModel.TimelineIRModel();this._window={left:0,right:Infinity};this._extensionTracingModels=[];this._recordStartTime=undefined;}
setMainTarget(target){this._mainTarget=target;}
setRecordStartTime(time){this._recordStartTime=time;}
recordStartTime(){return this._recordStartTime;}
setFilters(filters){this._filters=filters;}
filters(){return this._filters;}
isVisible(event){return this._filters.every(f=>f.accept(event));}
setTracingModel(model){this._tracingModel=model;this._timelineModel.setEvents(model);let inputEvents=null;let animationEvents=null;for(const track of this._timelineModel.tracks()){if(track.type===TimelineModel.TimelineModel.TrackType.Input)
inputEvents=track.asyncEvents;if(track.type===TimelineModel.TimelineModel.TrackType.Animation)
animationEvents=track.asyncEvents;}
if(inputEvents||animationEvents)
this._irModel.populate(inputEvents||[],animationEvents||[]);const mainTracks=this._timelineModel.tracks().filter(track=>track.type===TimelineModel.TimelineModel.TrackType.MainThread&&track.forMainFrame&&track.events.length);const threadData=mainTracks.map(track=>{const event=track.events[0];return{thread:event.thread,time:event.startTime};});this._frameModel.addTraceEvents(this._mainTarget,this._timelineModel.inspectedTargetEvents(),threadData);for(const entry of this._extensionTracingModels){entry.model.adjustTime(this._tracingModel.minimumRecordTime()+(entry.timeOffset/1000)-this._recordStartTime);}
this._autoWindowTimes();}
addExtensionEvents(title,model,timeOffset){this._extensionTracingModels.push({model:model,title:title,timeOffset:timeOffset});if(!this._tracingModel)
return;model.adjustTime(this._tracingModel.minimumRecordTime()+(timeOffset/1000)-this._recordStartTime);this.dispatchEventToListeners(Timeline.PerformanceModel.Events.ExtensionDataAdded);}
tracingModel(){if(!this._tracingModel)
throw'call setTracingModel before accessing PerformanceModel';return this._tracingModel;}
timelineModel(){return this._timelineModel;}
filmStripModel(){if(this._filmStripModel)
return this._filmStripModel;if(!this._tracingModel)
throw'call setTracingModel before accessing PerformanceModel';this._filmStripModel=new SDK.FilmStripModel(this._tracingModel);return this._filmStripModel;}
frames(){return this._frameModel.frames();}
frameModel(){return this._frameModel;}
interactionRecords(){return this._irModel.interactionRecords();}
extensionInfo(){return this._extensionTracingModels;}
dispose(){if(this._tracingModel)
this._tracingModel.dispose();for(const extensionEntry of this._extensionTracingModels)
extensionEntry.model.dispose();}
filmStripModelFrame(frame){const screenshotTime=frame.idle?frame.startTime:frame.endTime;const filmStripFrame=this._filmStripModel.frameByTimestamp(screenshotTime);return filmStripFrame&&filmStripFrame.timestamp-frame.endTime<10?filmStripFrame:null;}
save(stream){const backingStorage=(this._tracingModel.backingStorage());return backingStorage.writeToStream(stream);}
setWindow(window,animate){this._window=window;this.dispatchEventToListeners(Timeline.PerformanceModel.Events.WindowChanged,{window,animate});}
window(){return this._window;}
_autoWindowTimes(){const timelineModel=this._timelineModel;let tasks=[];for(const track of timelineModel.tracks()){if(track.type===TimelineModel.TimelineModel.TrackType.MainThread&&track.forMainFrame)
tasks=track.tasks;}
if(!tasks.length){this.setWindow({left:timelineModel.minimumRecordTime(),right:timelineModel.maximumRecordTime()});return;}
function findLowUtilizationRegion(startIndex,stopIndex){const threshold=0.1;let cutIndex=startIndex;let cutTime=(tasks[cutIndex].startTime+tasks[cutIndex].endTime)/2;let usedTime=0;const step=Math.sign(stopIndex-startIndex);for(let i=startIndex;i!==stopIndex;i+=step){const task=tasks[i];const taskTime=(task.startTime+task.endTime)/2;const interval=Math.abs(cutTime-taskTime);if(usedTime<threshold*interval){cutIndex=i;cutTime=taskTime;usedTime=0;}
usedTime+=task.duration;}
return cutIndex;}
const rightIndex=findLowUtilizationRegion(tasks.length-1,0);const leftIndex=findLowUtilizationRegion(0,rightIndex);let leftTime=tasks[leftIndex].startTime;let rightTime=tasks[rightIndex].endTime;const span=rightTime-leftTime;const totalSpan=timelineModel.maximumRecordTime()-timelineModel.minimumRecordTime();if(span<totalSpan*0.1){leftTime=timelineModel.minimumRecordTime();rightTime=timelineModel.maximumRecordTime();}else{leftTime=Math.max(leftTime-0.05*span,timelineModel.minimumRecordTime());rightTime=Math.min(rightTime+0.05*span,timelineModel.maximumRecordTime());}
this.setWindow({left:leftTime,right:rightTime});}};Timeline.PerformanceModel.Events={ExtensionDataAdded:Symbol('ExtensionDataAdded'),WindowChanged:Symbol('WindowChanged')};Timeline.PerformanceModel.Window;;Timeline.TimelineController=class{constructor(target,client){this._target=target;this._tracingManager=target.model(SDK.TracingManager);this._performanceModel=new Timeline.PerformanceModel();this._performanceModel.setMainTarget(target);this._client=client;const backingStorage=new Bindings.TempFileBackingStorage();this._tracingModel=new SDK.TracingModel(backingStorage);this._extensionSessions=[];SDK.targetManager.observeModels(SDK.CPUProfilerModel,this);}
dispose(){SDK.targetManager.unobserveModels(SDK.CPUProfilerModel,this);}
mainTarget(){return this._target;}
async startRecording(options,providers){this._extensionTraceProviders=Extensions.extensionServer.traceProviders().slice();function disabledByDefault(category){return'disabled-by-default-'+category;}
const categoriesArray=['-*','devtools.timeline',disabledByDefault('devtools.timeline'),disabledByDefault('devtools.timeline.frame'),'v8.execute',TimelineModel.TimelineModel.Category.Console,TimelineModel.TimelineModel.Category.UserTiming];categoriesArray.push(TimelineModel.TimelineModel.Category.LatencyInfo);if(Runtime.experiments.isEnabled('timelineFlowEvents'))
categoriesArray.push('devtools.timeline.async');if(Runtime.experiments.isEnabled('timelineV8RuntimeCallStats')&&options.enableJSSampling)
categoriesArray.push(disabledByDefault('v8.runtime_stats_sampling'));if(!Runtime.queryParam('timelineTracingJSProfileDisabled')&&options.enableJSSampling){categoriesArray.push(disabledByDefault('v8.cpu_profiler'));if(Common.moduleSetting('highResolutionCpuProfiling').get())
categoriesArray.push(disabledByDefault('v8.cpu_profiler.hires'));}
categoriesArray.push(disabledByDefault('devtools.timeline.stack'));if(Runtime.experiments.isEnabled('timelineInvalidationTracking'))
categoriesArray.push(disabledByDefault('devtools.timeline.invalidationTracking'));if(options.capturePictures){categoriesArray.push(disabledByDefault('devtools.timeline.layers'),disabledByDefault('devtools.timeline.picture'),disabledByDefault('blink.graphics_context_annotations'));}
if(options.captureFilmStrip)
categoriesArray.push(disabledByDefault('devtools.screenshot'));this._extensionSessions=providers.map(provider=>new Timeline.ExtensionTracingSession(provider,this._performanceModel));this._extensionSessions.forEach(session=>session.start());this._performanceModel.setRecordStartTime(Date.now());const response=await this._startRecordingWithCategories(categoriesArray.join(','),options.enableJSSampling);if(response[Protocol.Error])
await this._waitForTracingToStop(false);return response;}
async stopRecording(){if(this._tracingManager)
this._tracingManager.stop();this._client.loadingStarted();await this._waitForTracingToStop(true);this._allSourcesFinished();return this._performanceModel;}
_waitForTracingToStop(awaitTracingCompleteCallback){const tracingStoppedPromises=[];if(this._tracingManager&&awaitTracingCompleteCallback)
tracingStoppedPromises.push(new Promise(resolve=>this._tracingCompleteCallback=resolve));tracingStoppedPromises.push(this._stopProfilingOnAllModels());const extensionCompletionPromises=this._extensionSessions.map(session=>session.stop());if(extensionCompletionPromises.length){tracingStoppedPromises.push(Promise.race([Promise.all(extensionCompletionPromises),new Promise(r=>setTimeout(r,5000))]));}
return Promise.all(tracingStoppedPromises);}
modelAdded(cpuProfilerModel){if(this._profiling)
cpuProfilerModel.startRecording();}
modelRemoved(cpuProfilerModel){}
_startProfilingOnAllModels(){this._profiling=true;const models=SDK.targetManager.models(SDK.CPUProfilerModel);return Promise.all(models.map(model=>model.startRecording()));}
_addCpuProfile(targetId,cpuProfile){if(!cpuProfile){Common.console.warn(Common.UIString('CPU profile for a target is not available.'));return;}
if(!this._cpuProfiles)
this._cpuProfiles=new Map();this._cpuProfiles.set(targetId,cpuProfile);}
_stopProfilingOnAllModels(){const models=this._profiling?SDK.targetManager.models(SDK.CPUProfilerModel):[];this._profiling=false;const promises=[];for(const model of models){const targetId=model.target().id();const modelPromise=model.stopRecording().then(this._addCpuProfile.bind(this,targetId));promises.push(modelPromise);}
return Promise.all(promises);}
async _startRecordingWithCategories(categories,enableJSSampling){SDK.targetManager.suspendAllTargets();if(enableJSSampling&&Runtime.queryParam('timelineTracingJSProfileDisabled'))
await this._startProfilingOnAllModels();if(!this._tracingManager)
return;const samplingFrequencyHz=Common.moduleSetting('highResolutionCpuProfiling').get()?10000:1000;const options='sampling-frequency='+samplingFrequencyHz;return this._tracingManager.start(this,categories,options);}
traceEventsCollected(events){this._tracingModel.addEvents(events);}
tracingComplete(){this._tracingCompleteCallback();this._tracingCompleteCallback=null;}
_allSourcesFinished(){this._client.processingStarted();setTimeout(()=>this._finalizeTrace(),0);}
async _finalizeTrace(){this._injectCpuProfileEvents();await SDK.targetManager.resumeAllTargets();this._tracingModel.tracingComplete();this._client.loadingComplete(this._tracingModel);}
_injectCpuProfileEvent(pid,tid,cpuProfile){if(!cpuProfile)
return;const cpuProfileEvent=({cat:SDK.TracingModel.DevToolsMetadataEventCategory,ph:SDK.TracingModel.Phase.Instant,ts:this._tracingModel.maximumRecordTime()*1000,pid:pid,tid:tid,name:TimelineModel.TimelineModel.RecordType.CpuProfile,args:{data:{cpuProfile:cpuProfile}}});this._tracingModel.addEvents([cpuProfileEvent]);}
_buildTargetToProcessIdMap(){const metadataEventTypes=TimelineModel.TimelineModel.DevToolsMetadataEvent;const metadataEvents=this._tracingModel.devToolsMetadataEvents();const browserMetaEvent=metadataEvents.find(e=>e.name===metadataEventTypes.TracingStartedInBrowser);if(!browserMetaEvent)
return null;const pseudoPidToFrames=new Multimap();const targetIdToPid=new Map();const frames=browserMetaEvent.args.data['frames'];for(const frameInfo of frames)
targetIdToPid.set(frameInfo.frame,frameInfo.processId);for(const event of metadataEvents){const data=event.args.data;switch(event.name){case metadataEventTypes.FrameCommittedInBrowser:if(data.processId)
targetIdToPid.set(data.frame,data.processId);else
pseudoPidToFrames.set(data.processPseudoId,data.frame);break;case metadataEventTypes.ProcessReadyInBrowser:for(const frame of pseudoPidToFrames.get(data.processPseudoId)||[])
targetIdToPid.set(frame,data.processId);break;}}
const mainFrame=frames.find(frame=>!frame.parent);const mainRendererProcessId=mainFrame.processId;const mainProcess=this._tracingModel.processById(mainRendererProcessId);if(mainProcess)
targetIdToPid.set(SDK.targetManager.mainTarget().id(),mainProcess.id());return targetIdToPid;}
_injectCpuProfileEvents(){if(!this._cpuProfiles)
return;const metadataEventTypes=TimelineModel.TimelineModel.DevToolsMetadataEvent;const metadataEvents=this._tracingModel.devToolsMetadataEvents();const targetIdToPid=this._buildTargetToProcessIdMap();if(targetIdToPid){for(const[id,profile]of this._cpuProfiles){const pid=targetIdToPid.get(id);if(!pid)
continue;const process=this._tracingModel.processById(pid);const thread=process&&process.threadByName(TimelineModel.TimelineModel.RendererMainThreadName);if(thread)
this._injectCpuProfileEvent(pid,thread.id(),profile);}}else{const mainMetaEvent=metadataEvents.filter(event=>event.name===metadataEventTypes.TracingStartedInPage).peekLast();if(mainMetaEvent){const pid=mainMetaEvent.thread.process().id();const mainCpuProfile=this._cpuProfiles.get(this._tracingManager.target().id());this._injectCpuProfileEvent(pid,mainMetaEvent.thread.id(),mainCpuProfile);}else{let tid=0;for(const pair of this._cpuProfiles){const target=SDK.targetManager.targetById(pair[0]);const name=target&&target.name();this._tracingModel.addEvents(TimelineModel.TimelineJSProfileProcessor.buildTraceProfileFromCpuProfile(pair[1],++tid,tid===1,name));}}}
const workerMetaEvents=metadataEvents.filter(event=>event.name===metadataEventTypes.TracingSessionIdForWorker);for(const metaEvent of workerMetaEvents){const workerId=metaEvent.args['data']['workerId'];const cpuProfile=this._cpuProfiles.get(workerId);this._injectCpuProfileEvent(metaEvent.thread.process().id(),metaEvent.args['data']['workerThreadId'],cpuProfile);}
this._cpuProfiles=null;}
tracingBufferUsage(usage){this._client.recordingProgress(usage);}
eventsRetrievalProgress(progress){this._client.loadingProgress(progress);}};Timeline.TimelineController.Client=function(){};Timeline.TimelineController.Client.prototype={recordingProgress(usage){},};Timeline.TimelineController.RecordingOptions;;Timeline.TimelineDetailsView=class extends UI.VBox{constructor(delegate){super();this.element.classList.add('timeline-details');this._detailsLinkifier=new Components.Linkifier();this._badgePool=new ProductRegistry.BadgePool();this._badgePool.setShowTitles(true);this._tabbedPane=new UI.TabbedPane();this._tabbedPane.show(this.element);const tabIds=Timeline.TimelineDetailsView.Tab;this._defaultDetailsWidget=new UI.VBox();this._defaultDetailsWidget.element.classList.add('timeline-details-view');this._defaultDetailsContentElement=this._defaultDetailsWidget.element.createChild('div','timeline-details-view-body vbox');this._defaultDetailsContentElement.tabIndex=0;this._appendTab(tabIds.Details,Common.UIString('Summary'),this._defaultDetailsWidget);this.setPreferredTab(tabIds.Details);this._rangeDetailViews=new Map();const bottomUpView=new Timeline.BottomUpTimelineTreeView();this._appendTab(tabIds.BottomUp,Common.UIString('Bottom-Up'),bottomUpView);this._rangeDetailViews.set(tabIds.BottomUp,bottomUpView);const callTreeView=new Timeline.CallTreeTimelineTreeView();this._appendTab(tabIds.CallTree,Common.UIString('Call Tree'),callTreeView);this._rangeDetailViews.set(tabIds.CallTree,callTreeView);const eventsView=new Timeline.EventsTimelineTreeView(delegate);this._appendTab(tabIds.EventLog,Common.UIString('Event Log'),eventsView);this._rangeDetailViews.set(tabIds.EventLog,eventsView);this._tabbedPane.addEventListener(UI.TabbedPane.Events.TabSelected,this._tabSelected,this);}
setModel(model,track){if(this._model!==model){if(this._model)
this._model.removeEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this);this._model=model;if(this._model)
this._model.addEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this);}
this._track=track;this._tabbedPane.closeTabs([Timeline.TimelineDetailsView.Tab.PaintProfiler,Timeline.TimelineDetailsView.Tab.LayerViewer],false);for(const view of this._rangeDetailViews.values())
view.setModel(model,track);this._lazyPaintProfilerView=null;this._lazyLayersView=null;this.setSelection(null);}
_setContent(node){const allTabs=this._tabbedPane.otherTabs(Timeline.TimelineDetailsView.Tab.Details);for(let i=0;i<allTabs.length;++i){if(!this._rangeDetailViews.has(allTabs[i]))
this._tabbedPane.closeTab(allTabs[i]);}
this._defaultDetailsContentElement.removeChildren();this._defaultDetailsContentElement.appendChild(node);}
_updateContents(){const view=this._rangeDetailViews.get(this._tabbedPane.selectedTabId||'');if(view){const window=this._model.window();view.updateContents(this._selection||Timeline.TimelineSelection.fromRange(window.left,window.right));}}
_appendTab(id,tabTitle,view,isCloseable){this._tabbedPane.appendTab(id,tabTitle,view,undefined,undefined,isCloseable);if(this._preferredTabId!==this._tabbedPane.selectedTabId)
this._tabbedPane.selectTab(id);}
headerElement(){return this._tabbedPane.headerElement();}
setPreferredTab(tabId){this._preferredTabId=tabId;}
_onWindowChanged(event){if(!this._selection)
this._updateContentsFromWindow();}
_updateContentsFromWindow(){if(!this._model){this._setContent(UI.html`<div/>`);return;}
const window=this._model.window();this._updateSelectedRangeStats(window.left,window.right);this._updateContents();}
setSelection(selection){this._detailsLinkifier.reset();this._badgePool.reset();this._selection=selection;if(!this._selection){this._updateContentsFromWindow();return;}
switch(this._selection.type()){case Timeline.TimelineSelection.Type.TraceEvent:const event=(this._selection.object());Timeline.TimelineUIUtils.buildTraceEventDetails(event,this._model.timelineModel(),this._detailsLinkifier,this._badgePool,true).then(fragment=>this._appendDetailsTabsForTraceEventAndShowDetails(event,fragment));break;case Timeline.TimelineSelection.Type.Frame:const frame=(this._selection.object());const filmStripFrame=this._model.filmStripModelFrame(frame);this._setContent(Timeline.TimelineUIUtils.generateDetailsContentForFrame(frame,filmStripFrame));if(frame.layerTree){const layersView=this._layersView();layersView.showLayerTree(frame.layerTree);if(!this._tabbedPane.hasTab(Timeline.TimelineDetailsView.Tab.LayerViewer))
this._appendTab(Timeline.TimelineDetailsView.Tab.LayerViewer,Common.UIString('Layers'),layersView);}
break;case Timeline.TimelineSelection.Type.NetworkRequest:const request=(this._selection.object());Timeline.TimelineUIUtils.buildNetworkRequestDetails(request,this._model.timelineModel(),this._detailsLinkifier,this._badgePool).then(this._setContent.bind(this));break;case Timeline.TimelineSelection.Type.Range:this._updateSelectedRangeStats(this._selection.startTime(),this._selection.endTime());break;}
this._updateContents();}
_tabSelected(event){if(!event.data.isUserGesture)
return;this.setPreferredTab(event.data.tabId);this._updateContents();}
_layersView(){if(this._lazyLayersView)
return this._lazyLayersView;this._lazyLayersView=new Timeline.TimelineLayersView(this._model.timelineModel(),this._showSnapshotInPaintProfiler.bind(this));return this._lazyLayersView;}
_paintProfilerView(){if(this._lazyPaintProfilerView)
return this._lazyPaintProfilerView;this._lazyPaintProfilerView=new Timeline.TimelinePaintProfilerView(this._model.frameModel());return this._lazyPaintProfilerView;}
_showSnapshotInPaintProfiler(snapshot){const paintProfilerView=this._paintProfilerView();paintProfilerView.setSnapshot(snapshot);if(!this._tabbedPane.hasTab(Timeline.TimelineDetailsView.Tab.PaintProfiler)){this._appendTab(Timeline.TimelineDetailsView.Tab.PaintProfiler,Common.UIString('Paint Profiler'),paintProfilerView,true);}
this._tabbedPane.selectTab(Timeline.TimelineDetailsView.Tab.PaintProfiler,true);}
_appendDetailsTabsForTraceEventAndShowDetails(event,content){this._setContent(content);if(event.name===TimelineModel.TimelineModel.RecordType.Paint||event.name===TimelineModel.TimelineModel.RecordType.RasterTask)
this._showEventInPaintProfiler(event);}
_showEventInPaintProfiler(event){const paintProfilerModel=SDK.targetManager.models(SDK.PaintProfilerModel)[0];if(!paintProfilerModel)
return;const paintProfilerView=this._paintProfilerView();const hasProfileData=paintProfilerView.setEvent(paintProfilerModel,event);if(!hasProfileData)
return;if(this._tabbedPane.hasTab(Timeline.TimelineDetailsView.Tab.PaintProfiler))
return;this._appendTab(Timeline.TimelineDetailsView.Tab.PaintProfiler,Common.UIString('Paint Profiler'),paintProfilerView);}
_updateSelectedRangeStats(startTime,endTime){if(!this._model||!this._track)
return;const aggregatedStats=Timeline.TimelineUIUtils.statsForTimeRange(this._track.syncEvents(),startTime,endTime);const startOffset=startTime-this._model.timelineModel().minimumRecordTime();const endOffset=endTime-this._model.timelineModel().minimumRecordTime();const contentHelper=new Timeline.TimelineDetailsContentHelper(null,null);contentHelper.addSection(ls`Range:  ${Number.millisToString(startOffset)} \u2013 ${Number.millisToString(endOffset)}`);const pieChart=Timeline.TimelineUIUtils.generatePieChart(aggregatedStats);contentHelper.appendElementRow('',pieChart);this._setContent(contentHelper.fragment);}};Timeline.TimelineDetailsView.Tab={Details:'Details',EventLog:'EventLog',CallTree:'CallTree',BottomUp:'BottomUp',PaintProfiler:'PaintProfiler',LayerViewer:'LayerViewer'};;Timeline.TimelineLoader=class{constructor(client){this._client=client;this._backingStorage=new Bindings.TempFileBackingStorage();this._tracingModel=new SDK.TracingModel(this._backingStorage);this._canceledCallback=null;this._state=Timeline.TimelineLoader.State.Initial;this._buffer='';this._firstRawChunk=true;this._firstChunk=true;this._loadedBytes=0;this._totalSize;this._jsonTokenizer=new TextUtils.TextUtils.BalancedJSONTokenizer(this._writeBalancedJSON.bind(this),true);}
static loadFromFile(file,client){const loader=new Timeline.TimelineLoader(client);const fileReader=new Bindings.ChunkedFileReader(file,Timeline.TimelineLoader.TransferChunkLengthBytes);loader._canceledCallback=fileReader.cancel.bind(fileReader);loader._totalSize=file.size;fileReader.read(loader).then(success=>{if(!success)
this._reportErrorAndCancelLoading(fileReader.error().message);});return loader;}
static loadFromEvents(events,client){const loader=new Timeline.TimelineLoader(client);setTimeout(async()=>{const eventsPerChunk=5000;client.loadingStarted();for(let i=0;i<events.length;i+=eventsPerChunk){const chunk=events.slice(i,i+eventsPerChunk);loader._tracingModel.addEvents(chunk);client.loadingProgress((i+chunk.length)/events.length);await new Promise(r=>setTimeout(r));}
loader.close();});return loader;}
static loadFromURL(url,client){const loader=new Timeline.TimelineLoader(client);Host.ResourceLoader.loadAsStream(url,null,loader);return loader;}
cancel(){this._tracingModel=null;this._backingStorage.reset();this._client.loadingComplete(null);this._client=null;if(this._canceledCallback)
this._canceledCallback();}
write(chunk){if(!this._client)
return Promise.resolve();this._loadedBytes+=chunk.length;if(this._firstRawChunk)
this._client.loadingStarted();else
this._client.loadingProgress(this._totalSize?this._loadedBytes/this._totalSize:undefined);this._firstRawChunk=false;if(this._state===Timeline.TimelineLoader.State.Initial){if(chunk.startsWith('{"nodes":[')){this._state=Timeline.TimelineLoader.State.LoadingCPUProfileFormat;}else if(chunk[0]==='{'){this._state=Timeline.TimelineLoader.State.LookingForEvents;}else if(chunk[0]==='['){this._state=Timeline.TimelineLoader.State.ReadingEvents;}else{this._reportErrorAndCancelLoading(Common.UIString('Malformed timeline data: Unknown JSON format'));return Promise.resolve();}}
if(this._state===Timeline.TimelineLoader.State.LoadingCPUProfileFormat){this._buffer+=chunk;return Promise.resolve();}
if(this._state===Timeline.TimelineLoader.State.LookingForEvents){const objectName='"traceEvents":';const startPos=this._buffer.length-objectName.length;this._buffer+=chunk;const pos=this._buffer.indexOf(objectName,startPos);if(pos===-1)
return Promise.resolve();chunk=this._buffer.slice(pos+objectName.length);this._state=Timeline.TimelineLoader.State.ReadingEvents;}
if(this._state!==Timeline.TimelineLoader.State.ReadingEvents)
return Promise.resolve();if(this._jsonTokenizer.write(chunk))
return Promise.resolve();this._state=Timeline.TimelineLoader.State.SkippingTail;if(this._firstChunk)
this._reportErrorAndCancelLoading(Common.UIString('Malformed timeline input, wrong JSON brackets balance'));return Promise.resolve();}
_writeBalancedJSON(data){let json=data+']';if(!this._firstChunk){const commaIndex=json.indexOf(',');if(commaIndex!==-1)
json=json.slice(commaIndex+1);json='['+json;}
let items;try{items=(JSON.parse(json));}catch(e){this._reportErrorAndCancelLoading(Common.UIString('Malformed timeline data: %s',e.toString()));return;}
if(this._firstChunk){this._firstChunk=false;if(this._looksLikeAppVersion(items[0])){this._reportErrorAndCancelLoading(Common.UIString('Legacy Timeline format is not supported.'));return;}}
try{this._tracingModel.addEvents(items);}catch(e){this._reportErrorAndCancelLoading(Common.UIString('Malformed timeline data: %s',e.toString()));}}
_reportErrorAndCancelLoading(message){if(message)
Common.console.error(message);this.cancel();}
_looksLikeAppVersion(item){return typeof item==='string'&&item.indexOf('Chrome')!==-1;}
close(){if(!this._client)
return;this._client.processingStarted();setTimeout(()=>this._finalizeTrace(),0);}
_finalizeTrace(){if(this._state===Timeline.TimelineLoader.State.LoadingCPUProfileFormat){this._parseCPUProfileFormat(this._buffer);this._buffer='';}
this._tracingModel.tracingComplete();this._client.loadingComplete(this._tracingModel);}
_parseCPUProfileFormat(text){let traceEvents;try{const profile=JSON.parse(text);traceEvents=TimelineModel.TimelineJSProfileProcessor.buildTraceProfileFromCpuProfile(profile,1,true);}catch(e){this._reportErrorAndCancelLoading(Common.UIString('Malformed CPU profile format'));return;}
this._tracingModel.addEvents(traceEvents);}};Timeline.TimelineLoader.TransferChunkLengthBytes=5000000;Timeline.TimelineLoader.Client=function(){};Timeline.TimelineLoader.Client.prototype={loadingStarted(){},loadingProgress(progress){},processingStarted(){},loadingComplete(tracingModel){},};Timeline.TimelineLoader.State={Initial:Symbol('Initial'),LookingForEvents:Symbol('LookingForEvents'),ReadingEvents:Symbol('ReadingEvents'),SkippingTail:Symbol('SkippingTail'),LoadingCPUProfileFormat:Symbol('LoadingCPUProfileFormat')};;Timeline.TimelineEventOverview=class extends PerfUI.TimelineOverviewBase{constructor(id,title){super();this.element.id='timeline-overview-'+id;this.element.classList.add('overview-strip');this._model=null;if(title)
this.element.createChild('div','timeline-overview-strip-title').textContent=title;}
setModel(model){this._model=model;}
_renderBar(begin,end,position,height,color){const x=begin;const width=end-begin;const ctx=this.context();ctx.fillStyle=color;ctx.fillRect(x,position,width,height);}};Timeline.TimelineEventOverviewInput=class extends Timeline.TimelineEventOverview{constructor(){super('input',null);}
update(){super.update();if(!this._model)
return;const height=this.height();const descriptors=Timeline.TimelineUIUtils.eventDispatchDesciptors();const descriptorsByType=new Map();let maxPriority=-1;for(const descriptor of descriptors){for(const type of descriptor.eventTypes)
descriptorsByType.set(type,descriptor);maxPriority=Math.max(maxPriority,descriptor.priority);}
const minWidth=2*window.devicePixelRatio;const timeOffset=this._model.timelineModel().minimumRecordTime();const timeSpan=this._model.timelineModel().maximumRecordTime()-timeOffset;const canvasWidth=this.width();const scale=canvasWidth/timeSpan;for(let priority=0;priority<=maxPriority;++priority){for(const track of this._model.timelineModel().tracks()){for(let i=0;i<track.events.length;++i){const event=track.events[i];if(event.name!==TimelineModel.TimelineModel.RecordType.EventDispatch)
continue;const descriptor=descriptorsByType.get(event.args['data']['type']);if(!descriptor||descriptor.priority!==priority)
continue;const start=Number.constrain(Math.floor((event.startTime-timeOffset)*scale),0,canvasWidth);const end=Number.constrain(Math.ceil((event.endTime-timeOffset)*scale),0,canvasWidth);const width=Math.max(end-start,minWidth);this._renderBar(start,start+width,0,height,descriptor.color);}}}}};Timeline.TimelineEventOverviewNetwork=class extends Timeline.TimelineEventOverview{constructor(){super('network',Common.UIString('NET'));}
update(){super.update();if(!this._model)
return;const timelineModel=this._model.timelineModel();const bandHeight=this.height()/2;const timeOffset=timelineModel.minimumRecordTime();const timeSpan=timelineModel.maximumRecordTime()-timeOffset;const canvasWidth=this.width();const scale=canvasWidth/timeSpan;const highPath=new Path2D();const lowPath=new Path2D();const priorities=Protocol.Network.ResourcePriority;const highPrioritySet=new Set([priorities.VeryHigh,priorities.High,priorities.Medium]);for(const request of timelineModel.networkRequests()){const path=highPrioritySet.has(request.priority)?highPath:lowPath;const s=Math.max(Math.floor((request.startTime-timeOffset)*scale),0);const e=Math.min(Math.ceil((request.endTime-timeOffset)*scale+1),canvasWidth);path.rect(s,0,e-s,bandHeight-1);}
const ctx=this.context();ctx.save();ctx.fillStyle='hsl(214, 60%, 60%)';ctx.fill((highPath));ctx.translate(0,bandHeight);ctx.fillStyle='hsl(214, 80%, 80%)';ctx.fill((lowPath));ctx.restore();}};Timeline.TimelineEventOverviewCPUActivity=class extends Timeline.TimelineEventOverview{constructor(){super('cpu-activity',Common.UIString('CPU'));this._backgroundCanvas=this.element.createChild('canvas','fill background');}
resetCanvas(){super.resetCanvas();this._backgroundCanvas.width=this.element.clientWidth*window.devicePixelRatio;this._backgroundCanvas.height=this.element.clientHeight*window.devicePixelRatio;}
update(){super.update();if(!this._model)
return;const timelineModel=this._model.timelineModel();const quantSizePx=4*window.devicePixelRatio;const width=this.width();const height=this.height();const baseLine=height;const timeOffset=timelineModel.minimumRecordTime();const timeSpan=timelineModel.maximumRecordTime()-timeOffset;const scale=width/timeSpan;const quantTime=quantSizePx/scale;const categories=Timeline.TimelineUIUtils.categories();const categoryOrder=['idle','loading','painting','rendering','scripting','other'];const otherIndex=categoryOrder.indexOf('other');const idleIndex=0;console.assert(idleIndex===categoryOrder.indexOf('idle'));for(let i=idleIndex+1;i<categoryOrder.length;++i)
categories[categoryOrder[i]]._overviewIndex=i;const backgroundContext=this._backgroundCanvas.getContext('2d');for(const track of timelineModel.tracks()){if(track.type===TimelineModel.TimelineModel.TrackType.MainThread&&track.forMainFrame)
drawThreadEvents(this.context(),track.events);else
drawThreadEvents(backgroundContext,track.events);}
applyPattern(backgroundContext);function drawThreadEvents(ctx,events){const quantizer=new Timeline.Quantizer(timeOffset,quantTime,drawSample);let x=0;const categoryIndexStack=[];const paths=[];const lastY=[];for(let i=0;i<categoryOrder.length;++i){paths[i]=new Path2D();paths[i].moveTo(0,height);lastY[i]=height;}
function drawSample(counters){let y=baseLine;for(let i=idleIndex+1;i<categoryOrder.length;++i){const h=(counters[i]||0)/quantTime*height;y-=h;paths[i].bezierCurveTo(x,lastY[i],x,y,x+quantSizePx/2,y);lastY[i]=y;}
x+=quantSizePx;}
function onEventStart(e){const index=categoryIndexStack.length?categoryIndexStack.peekLast():idleIndex;quantizer.appendInterval(e.startTime,index);categoryIndexStack.push(Timeline.TimelineUIUtils.eventStyle(e).category._overviewIndex||otherIndex);}
function onEventEnd(e){quantizer.appendInterval(e.endTime,categoryIndexStack.pop());}
TimelineModel.TimelineModel.forEachEvent(events,onEventStart,onEventEnd);quantizer.appendInterval(timeOffset+timeSpan+quantTime,idleIndex);for(let i=categoryOrder.length-1;i>0;--i){paths[i].lineTo(width,height);ctx.fillStyle=categories[categoryOrder[i]].color;ctx.fill(paths[i]);}}
function applyPattern(ctx){const step=4*window.devicePixelRatio;ctx.save();ctx.lineWidth=step/Math.sqrt(8);for(let x=0.5;x<width+height;x+=step){ctx.moveTo(x,0);ctx.lineTo(x-height,height);}
ctx.globalCompositeOperation='destination-out';ctx.stroke();ctx.restore();}}};Timeline.TimelineEventOverviewResponsiveness=class extends Timeline.TimelineEventOverview{constructor(){super('responsiveness',null);}
update(){super.update();if(!this._model)
return;const height=this.height();const timeOffset=this._model.timelineModel().minimumRecordTime();const timeSpan=this._model.timelineModel().maximumRecordTime()-timeOffset;const scale=this.width()/timeSpan;const frames=this._model.frames();const ctx=(this.context());const fillPath=new Path2D();const markersPath=new Path2D();for(let i=0;i<frames.length;++i){const frame=frames[i];if(!frame.hasWarnings())
continue;paintWarningDecoration(frame.startTime,frame.duration);}
for(const track of this._model.timelineModel().tracks()){const events=track.events;for(let i=0;i<events.length;++i){if(!TimelineModel.TimelineData.forEvent(events[i]).warning)
continue;paintWarningDecoration(events[i].startTime,events[i].duration);}}
ctx.fillStyle='hsl(0, 80%, 90%)';ctx.strokeStyle='red';ctx.lineWidth=2*window.devicePixelRatio;ctx.fill(fillPath);ctx.stroke(markersPath);function paintWarningDecoration(time,duration){const x=Math.round(scale*(time-timeOffset));const w=Math.round(scale*duration);fillPath.rect(x,0,w,height);markersPath.moveTo(x+w,0);markersPath.lineTo(x+w,height);}}};Timeline.TimelineFilmStripOverview=class extends Timeline.TimelineEventOverview{constructor(){super('filmstrip',null);this.reset();}
update(){super.update();const frames=this._model?this._model.filmStripModel().frames():[];if(!frames.length)
return;const drawGeneration=Symbol('drawGeneration');this._drawGeneration=drawGeneration;this._imageByFrame(frames[0]).then(image=>{if(this._drawGeneration!==drawGeneration)
return;if(!image||!image.naturalWidth||!image.naturalHeight)
return;const imageHeight=this.height()-2*Timeline.TimelineFilmStripOverview.Padding;const imageWidth=Math.ceil(imageHeight*image.naturalWidth/image.naturalHeight);const popoverScale=Math.min(200/image.naturalWidth,1);this._emptyImage=new Image(image.naturalWidth*popoverScale,image.naturalHeight*popoverScale);this._drawFrames(imageWidth,imageHeight);});}
_imageByFrame(frame){let imagePromise=this._frameToImagePromise.get(frame);if(!imagePromise){imagePromise=frame.imageDataPromise().then(data=>UI.loadImageFromData(data));this._frameToImagePromise.set(frame,imagePromise);}
return imagePromise;}
_drawFrames(imageWidth,imageHeight){if(!imageWidth||!this._model)
return;const filmStripModel=this._model.filmStripModel();if(!filmStripModel.frames().length)
return;const padding=Timeline.TimelineFilmStripOverview.Padding;const width=this.width();const zeroTime=filmStripModel.zeroTime();const spanTime=filmStripModel.spanTime();const scale=spanTime/width;const context=this.context();const drawGeneration=this._drawGeneration;context.beginPath();for(let x=padding;x<width;x+=imageWidth+2*padding){const time=zeroTime+(x+imageWidth/2)*scale;const frame=filmStripModel.frameByTimestamp(time);if(!frame)
continue;context.rect(x-0.5,0.5,imageWidth+1,imageHeight+1);this._imageByFrame(frame).then(drawFrameImage.bind(this,x));}
context.strokeStyle='#ddd';context.stroke();function drawFrameImage(x,image){if(this._drawGeneration!==drawGeneration||!image)
return;context.drawImage(image,x,1,imageWidth,imageHeight);}}
overviewInfoPromise(x){if(!this._model||!this._model.filmStripModel().frames().length)
return Promise.resolve((null));const time=this.calculator().positionToTime(x);const frame=this._model.filmStripModel().frameByTimestamp(time);if(frame===this._lastFrame)
return Promise.resolve(this._lastElement);const imagePromise=frame?this._imageByFrame(frame):Promise.resolve(this._emptyImage);return imagePromise.then(createFrameElement.bind(this));function createFrameElement(image){const element=createElementWithClass('div','frame');if(image)
element.createChild('div','thumbnail').appendChild(image);this._lastFrame=frame;this._lastElement=element;return element;}}
reset(){this._lastFrame=undefined;this._lastElement=null;this._frameToImagePromise=new Map();this._imageWidth=0;}};Timeline.TimelineFilmStripOverview.Padding=2;Timeline.TimelineEventOverviewFrames=class extends Timeline.TimelineEventOverview{constructor(){super('framerate',Common.UIString('FPS'));}
update(){super.update();if(!this._model)
return;const frames=this._model.frames();if(!frames.length)
return;const height=this.height();const padding=1*window.devicePixelRatio;const baseFrameDurationMs=1e3/60;const visualHeight=height-2*padding;const timeOffset=this._model.timelineModel().minimumRecordTime();const timeSpan=this._model.timelineModel().maximumRecordTime()-timeOffset;const scale=this.width()/timeSpan;const baseY=height-padding;const ctx=this.context();const bottomY=baseY+10*window.devicePixelRatio;let x=0;let y=bottomY;const lineWidth=window.devicePixelRatio;const offset=lineWidth&1?0.5:0;const tickDepth=1.5*window.devicePixelRatio;ctx.beginPath();ctx.moveTo(0,y);for(let i=0;i<frames.length;++i){const frame=frames[i];x=Math.round((frame.startTime-timeOffset)*scale)+offset;ctx.lineTo(x,y);ctx.lineTo(x,y+tickDepth);y=frame.idle?bottomY:Math.round(baseY-visualHeight*Math.min(baseFrameDurationMs/frame.duration,1))-offset;ctx.lineTo(x,y+tickDepth);ctx.lineTo(x,y);}
const lastFrame=frames.peekLast();x=Math.round((lastFrame.startTime+lastFrame.duration-timeOffset)*scale)+offset;ctx.lineTo(x,y);ctx.lineTo(x,bottomY);ctx.fillStyle='hsl(110, 50%, 88%)';ctx.strokeStyle='hsl(110, 50%, 60%)';ctx.lineWidth=lineWidth;ctx.fill();ctx.stroke();}};Timeline.TimelineEventOverviewMemory=class extends Timeline.TimelineEventOverview{constructor(){super('memory',Common.UIString('HEAP'));this._heapSizeLabel=this.element.createChild('div','memory-graph-label');}
resetHeapSizeLabels(){this._heapSizeLabel.textContent='';}
update(){super.update();const ratio=window.devicePixelRatio;if(!this._model){this.resetHeapSizeLabels();return;}
const tracks=this._model.timelineModel().tracks().filter(track=>track.type===TimelineModel.TimelineModel.TrackType.MainThread&&track.forMainFrame);const trackEvents=tracks.map(track=>track.events);const lowerOffset=3*ratio;let maxUsedHeapSize=0;let minUsedHeapSize=100000000000;const minTime=this._model.timelineModel().minimumRecordTime();const maxTime=this._model.timelineModel().maximumRecordTime();function isUpdateCountersEvent(event){return event.name===TimelineModel.TimelineModel.RecordType.UpdateCounters;}
for(let i=0;i<trackEvents.length;i++)
trackEvents[i]=trackEvents[i].filter(isUpdateCountersEvent);function calculateMinMaxSizes(event){const counters=event.args.data;if(!counters||!counters.jsHeapSizeUsed)
return;maxUsedHeapSize=Math.max(maxUsedHeapSize,counters.jsHeapSizeUsed);minUsedHeapSize=Math.min(minUsedHeapSize,counters.jsHeapSizeUsed);}
for(let i=0;i<trackEvents.length;i++)
trackEvents[i].forEach(calculateMinMaxSizes);minUsedHeapSize=Math.min(minUsedHeapSize,maxUsedHeapSize);const lineWidth=1;const width=this.width();const height=this.height()-lowerOffset;const xFactor=width/(maxTime-minTime);const yFactor=(height-lineWidth)/Math.max(maxUsedHeapSize-minUsedHeapSize,1);const histogram=new Array(width);function buildHistogram(event){const counters=event.args.data;if(!counters||!counters.jsHeapSizeUsed)
return;const x=Math.round((event.startTime-minTime)*xFactor);const y=Math.round((counters.jsHeapSizeUsed-minUsedHeapSize)*yFactor);histogram[x]=Math.max(histogram[x]||0,y);}
for(let i=0;i<trackEvents.length;i++)
trackEvents[i].forEach(buildHistogram);const ctx=this.context();const heightBeyondView=height+lowerOffset+lineWidth;ctx.translate(0.5,0.5);ctx.beginPath();ctx.moveTo(-lineWidth,heightBeyondView);let y=0;let isFirstPoint=true;let lastX=0;for(let x=0;x<histogram.length;x++){if(typeof histogram[x]==='undefined')
continue;if(isFirstPoint){isFirstPoint=false;y=histogram[x];ctx.lineTo(-lineWidth,height-y);}
const nextY=histogram[x];if(Math.abs(nextY-y)>2&&Math.abs(x-lastX)>1)
ctx.lineTo(x,height-y);y=nextY;ctx.lineTo(x,height-y);lastX=x;}
ctx.lineTo(width+lineWidth,height-y);ctx.lineTo(width+lineWidth,heightBeyondView);ctx.closePath();ctx.fillStyle='hsla(220, 90%, 70%, 0.2)';ctx.fill();ctx.lineWidth=lineWidth;ctx.strokeStyle='hsl(220, 90%, 70%)';ctx.stroke();this._heapSizeLabel.textContent=Common.UIString('%s \u2013 %s',Number.bytesToString(minUsedHeapSize),Number.bytesToString(maxUsedHeapSize));}};Timeline.Quantizer=class{constructor(startTime,quantDuration,callback){this._lastTime=startTime;this._quantDuration=quantDuration;this._callback=callback;this._counters=[];this._remainder=quantDuration;}
appendInterval(time,group){let interval=time-this._lastTime;if(interval<=this._remainder){this._counters[group]=(this._counters[group]||0)+interval;this._remainder-=interval;this._lastTime=time;return;}
this._counters[group]=(this._counters[group]||0)+this._remainder;this._callback(this._counters);interval-=this._remainder;while(interval>=this._quantDuration){const counters=[];counters[group]=this._quantDuration;this._callback(counters);interval-=this._quantDuration;}
this._counters=[];this._counters[group]=interval;this._lastTime=time;this._remainder=this._quantDuration-interval;}};;Timeline.TimelineFilters={};Timeline.TimelineFilters.IsLong=class extends TimelineModel.TimelineModelFilter{constructor(){super();this._minimumRecordDuration=0;}
setMinimumRecordDuration(value){this._minimumRecordDuration=value;}
accept(event){const duration=event.endTime?event.endTime-event.startTime:0;return duration>=this._minimumRecordDuration;}};Timeline.TimelineFilters.Category=class extends TimelineModel.TimelineModelFilter{constructor(){super();}
accept(event){return!Timeline.TimelineUIUtils.eventStyle(event).category.hidden;}};Timeline.TimelineFilters.RegExp=class extends TimelineModel.TimelineModelFilter{constructor(regExp){super();this._regExp;this.setRegExp(regExp||null);}
setRegExp(regExp){this._regExp=regExp;}
regExp(){return this._regExp;}
accept(event){return!this._regExp||Timeline.TimelineUIUtils.testContentMatching(event,this._regExp);}};;Timeline.TimelineFlameChartDataProvider=class extends Common.Object{constructor(){super();this.reset();this._font='11px '+Host.fontFamily();this._timelineData=null;this._currentLevel=0;this._performanceModel=null;this._model=null;this._minimumBoundary=0;this._maximumBoundary=0;this._timeSpan=0;this._consoleColorGenerator=new Common.Color.Generator({min:30,max:55},{min:70,max:100,count:6},50,0.7);this._extensionColorGenerator=new Common.Color.Generator({min:210,max:300},{min:70,max:100,count:6},70,0.7);this._headerLevel1=this._buildGroupStyle({shareHeaderLine:false});this._headerLevel2=this._buildGroupStyle({padding:2,nestingLevel:1,collapsible:false});this._staticHeader=this._buildGroupStyle({collapsible:false});this._framesHeader=this._buildGroupStyle({useFirstLineForOverview:true});this._timingsHeader=this._buildGroupStyle({shareHeaderLine:true,useFirstLineForOverview:true});this._screenshotsHeader=this._buildGroupStyle({useFirstLineForOverview:true,nestingLevel:1,collapsible:false,itemsHeight:150});this._interactionsHeaderLevel1=this._buildGroupStyle({useFirstLineForOverview:true});this._interactionsHeaderLevel2=this._buildGroupStyle({padding:2,nestingLevel:1});this._flowEventIndexById=new Map();}
_buildGroupStyle(extra){const defaultGroupStyle={padding:4,height:17,collapsible:true,color:UI.themeSupport.patchColorText('#222',UI.ThemeSupport.ColorUsage.Foreground),backgroundColor:UI.themeSupport.patchColorText('white',UI.ThemeSupport.ColorUsage.Background),font:this._font,nestingLevel:0,shareHeaderLine:true};return(Object.assign(defaultGroupStyle,extra));}
setModel(performanceModel){this.reset();this._performanceModel=performanceModel;this._model=performanceModel&&performanceModel.timelineModel();}
groupTrack(group){return group._track||null;}
entryTitle(entryIndex){const entryTypes=Timeline.TimelineFlameChartDataProvider.EntryType;const entryType=this._entryType(entryIndex);if(entryType===entryTypes.Event){const event=(this._entryData[entryIndex]);if(event.phase===SDK.TracingModel.Phase.AsyncStepInto||event.phase===SDK.TracingModel.Phase.AsyncStepPast)
return event.name+':'+event.args['step'];if(event._blackboxRoot)
return Common.UIString('Marked as Library code');if(this._performanceModel.timelineModel().isMarkerEvent(event))
return Timeline.TimelineUIUtils.markerShortTitle(event);return Timeline.TimelineUIUtils.eventTitle(event);}
if(entryType===entryTypes.ExtensionEvent){const event=(this._entryData[entryIndex]);return event.name;}
if(entryType===entryTypes.Screenshot)
return'';let title=this._entryIndexToTitle[entryIndex];if(!title){title=Common.UIString('Unexpected entryIndex %d',entryIndex);console.error(title);}
return title;}
textColor(index){const event=this._entryData[index];return event&&event._blackboxRoot?'#888':Timeline.FlameChartStyle.textColor;}
entryFont(index){return this._font;}
reset(){this._currentLevel=0;this._timelineData=null;this._entryData=[];this._entryParent=[];this._entryTypeByLevel=[];this._entryIndexToTitle=[];this._markers=[];this._asyncColorByCategory=new Map();this._asyncColorByInteractionPhase=new Map();this._extensionInfo=[];this._screenshotImageCache=new Map();}
maxStackDepth(){return this._currentLevel;}
timelineData(){if(this._timelineData)
return this._timelineData;this._timelineData=new PerfUI.FlameChart.TimelineData([],[],[],[]);if(!this._model)
return this._timelineData;this._flowEventIndexById.clear();this._minimumBoundary=this._model.minimumRecordTime();this._timeSpan=this._model.isEmpty()?1000:this._model.maximumRecordTime()-this._minimumBoundary;this._currentLevel=0;if(this._model.isGenericTrace())
this._processGenericTrace();else
this._processInspectorTrace();return this._timelineData;}
_processGenericTrace(){const processGroupStyle=this._buildGroupStyle({shareHeaderLine:false});const threadGroupStyle=this._buildGroupStyle({padding:2,nestingLevel:1,shareHeaderLine:false});const eventEntryType=Timeline.TimelineFlameChartDataProvider.EntryType.Event;const tracksByProcess=new Multimap();for(const track of this._model.tracks()){if(track.thread!==null){tracksByProcess.set(track.thread.process(),track);}else{console.error('Failed to process track');}}
for(const process of tracksByProcess.keysArray()){if(tracksByProcess.size>1){const name=`${process.name()} ${process.id()}`;this._appendHeader(name,processGroupStyle,false);}
for(const track of tracksByProcess.get(process)){const group=this._appendSyncEvents(track,track.events,track.name,threadGroupStyle,eventEntryType,true);if(!this._timelineData.selectedGroup||track.name===TimelineModel.TimelineModel.BrowserMainThreadName)
this._timelineData.selectedGroup=group;}}}
_processInspectorTrace(){this._appendFrames();this._appendInteractionRecords();const eventEntryType=Timeline.TimelineFlameChartDataProvider.EntryType.Event;const weight=track=>{switch(track.type){case TimelineModel.TimelineModel.TrackType.Input:return 0;case TimelineModel.TimelineModel.TrackType.Animation:return 1;case TimelineModel.TimelineModel.TrackType.Timings:return 2;case TimelineModel.TimelineModel.TrackType.Console:return 3;case TimelineModel.TimelineModel.TrackType.MainThread:return track.forMainFrame?4:5;case TimelineModel.TimelineModel.TrackType.Worker:return 6;case TimelineModel.TimelineModel.TrackType.Raster:return 7;case TimelineModel.TimelineModel.TrackType.GPU:return 8;case TimelineModel.TimelineModel.TrackType.Other:return 9;}};const tracks=this._model.tracks().slice();tracks.sort((a,b)=>weight(a)-weight(b));let rasterCount=0;for(const track of tracks){switch(track.type){case TimelineModel.TimelineModel.TrackType.Input:this._appendAsyncEventsGroup(track,ls`Input`,track.asyncEvents,this._interactionsHeaderLevel2,eventEntryType,false);break;case TimelineModel.TimelineModel.TrackType.Animation:this._appendAsyncEventsGroup(track,ls`Animation`,track.asyncEvents,this._interactionsHeaderLevel2,eventEntryType,false);break;case TimelineModel.TimelineModel.TrackType.Timings:const group=this._appendHeader(ls`Timings`,this._timingsHeader,true);group._track=track;this._appendPageMetrics();this._appendAsyncEventsGroup(track,null,track.asyncEvents,this._timingsHeader,eventEntryType,true);break;case TimelineModel.TimelineModel.TrackType.Console:this._appendAsyncEventsGroup(track,ls`Console`,track.asyncEvents,this._headerLevel1,eventEntryType,true);break;case TimelineModel.TimelineModel.TrackType.MainThread:if(track.forMainFrame){const group=this._appendSyncEvents(track,track.events,track.url?ls`Main \u2014 ${track.url}`:ls`Main`,this._headerLevel1,eventEntryType,true);if(group)
this._timelineData.selectedGroup=group;}else{this._appendSyncEvents(track,track.events,track.url?ls`Frame \u2014 ${track.url}`:ls`Subframe`,this._headerLevel1,eventEntryType,true);}
break;case TimelineModel.TimelineModel.TrackType.Worker:this._appendSyncEvents(track,track.events,track.url?ls`Worker \u2014 ${track.url}`:ls`Dedicated Worker`,this._headerLevel1,eventEntryType,true);break;case TimelineModel.TimelineModel.TrackType.Raster:if(!rasterCount)
this._appendHeader(ls`Raster`,this._headerLevel1,false);++rasterCount;this._appendSyncEvents(track,track.events,ls`Rasterizer Thread ${rasterCount}`,this._headerLevel2,eventEntryType,true);break;case TimelineModel.TimelineModel.TrackType.GPU:this._appendSyncEvents(track,track.events,ls`GPU`,this._headerLevel1,eventEntryType,true);break;case TimelineModel.TimelineModel.TrackType.Other:this._appendSyncEvents(track,track.events,track.name||ls`Thread`,this._headerLevel1,eventEntryType,true);this._appendAsyncEventsGroup(track,track.name,track.asyncEvents,this._headerLevel1,eventEntryType,true);break;}}
if(this._timelineData.selectedGroup)
this._timelineData.selectedGroup.expanded=true;for(let extensionIndex=0;extensionIndex<this._extensionInfo.length;extensionIndex++)
this._innerAppendExtensionEvents(extensionIndex);this._markers.sort((a,b)=>a.startTime()-b.startTime());this._timelineData.markers=this._markers;this._flowEventIndexById.clear();}
minimumBoundary(){return this._minimumBoundary;}
totalTime(){return this._timeSpan;}
search(startTime,endTime,filter){const result=[];const entryTypes=Timeline.TimelineFlameChartDataProvider.EntryType;this.timelineData();for(let i=0;i<this._entryData.length;++i){if(this._entryType(i)!==entryTypes.Event)
continue;const event=(this._entryData[i]);if(event.startTime>endTime)
continue;if((event.endTime||event.startTime)<startTime)
continue;if(filter.accept(event))
result.push(i);}
result.sort((a,b)=>SDK.TracingModel.Event.compareStartTime((this._entryData[a]),(this._entryData[b])));return result;}
_appendSyncEvents(track,events,title,style,entryType,selectable){if(!events.length)
return null;const isExtension=entryType===Timeline.TimelineFlameChartDataProvider.EntryType.ExtensionEvent;const openEvents=[];const flowEventsEnabled=Runtime.experiments.isEnabled('timelineFlowEvents');const blackboxingEnabled=!isExtension&&Runtime.experiments.isEnabled('blackboxJSFramesOnTimeline');let maxStackDepth=0;let group=null;if(track&&track.type===TimelineModel.TimelineModel.TrackType.MainThread){group=this._appendHeader(title,style,selectable);group._track=track;}
for(let i=0;i<events.length;++i){const e=events[i];if(!isExtension&&this._performanceModel.timelineModel().isMarkerEvent(e)){this._markers.push(new Timeline.TimelineFlameChartMarker(e.startTime,e.startTime-this._model.minimumRecordTime(),Timeline.TimelineUIUtils.markerStyleForEvent(e)));}
if(!SDK.TracingModel.isFlowPhase(e.phase)){if(!e.endTime&&e.phase!==SDK.TracingModel.Phase.Instant)
continue;if(SDK.TracingModel.isAsyncPhase(e.phase))
continue;if(!isExtension&&!this._performanceModel.isVisible(e))
continue;}
while(openEvents.length&&openEvents.peekLast().endTime<=e.startTime)
openEvents.pop();e._blackboxRoot=false;if(blackboxingEnabled&&this._isBlackboxedEvent(e)){const parent=openEvents.peekLast();if(parent&&parent._blackboxRoot)
continue;e._blackboxRoot=true;}
if(!group){group=this._appendHeader(title,style,selectable);if(selectable)
group._track=track;}
const level=this._currentLevel+openEvents.length;if(flowEventsEnabled)
this._appendFlowEvent(e,level);const index=this._appendEvent(e,level);if(openEvents.length)
this._entryParent[index]=openEvents.peekLast();if(!isExtension&&this._performanceModel.timelineModel().isMarkerEvent(e))
this._timelineData.entryTotalTimes[this._entryData.length]=undefined;maxStackDepth=Math.max(maxStackDepth,openEvents.length+1);if(e.endTime)
openEvents.push(e);}
this._entryTypeByLevel.length=this._currentLevel+maxStackDepth;this._entryTypeByLevel.fill(entryType,this._currentLevel);this._currentLevel+=maxStackDepth;return group;}
_isBlackboxedEvent(event){if(event.name!==TimelineModel.TimelineModel.RecordType.JSFrame)
return false;const url=event.args['data']['url'];return url&&this._isBlackboxedURL(url);}
_isBlackboxedURL(url){return Bindings.blackboxManager.isBlackboxedURL(url);}
_appendAsyncEventsGroup(track,header,events,style,entryType,selectable){if(!events.length)
return null;const lastUsedTimeByLevel=[];let group=null;for(let i=0;i<events.length;++i){const asyncEvent=events[i];if(!this._performanceModel.isVisible(asyncEvent))
continue;if(!group&&header){group=this._appendHeader(header,style,selectable);if(selectable)
group._track=track;}
const startTime=asyncEvent.startTime;let level;for(level=0;level<lastUsedTimeByLevel.length&&lastUsedTimeByLevel[level]>startTime;++level){}
this._appendAsyncEvent(asyncEvent,this._currentLevel+level);lastUsedTimeByLevel[level]=asyncEvent.endTime;}
this._entryTypeByLevel.length=this._currentLevel+lastUsedTimeByLevel.length;this._entryTypeByLevel.fill(entryType,this._currentLevel);this._currentLevel+=lastUsedTimeByLevel.length;return group;}
_appendInteractionRecords(){const interactionRecords=this._performanceModel.interactionRecords();if(!interactionRecords.length)
return;this._appendHeader(ls`Interactions`,this._interactionsHeaderLevel1,false);for(const segment of interactionRecords){const index=this._entryData.length;this._entryData.push((segment.data));this._entryIndexToTitle[index]=(segment.data);this._timelineData.entryLevels[index]=this._currentLevel;this._timelineData.entryTotalTimes[index]=segment.end-segment.begin;this._timelineData.entryStartTimes[index]=segment.begin;}
this._entryTypeByLevel[this._currentLevel++]=Timeline.TimelineFlameChartDataProvider.EntryType.InteractionRecord;}
_appendPageMetrics(){this._entryTypeByLevel[this._currentLevel]=Timeline.TimelineFlameChartDataProvider.EntryType.Event;const metricEvents=[];const lcpEvents=[];const timelineModel=this._performanceModel.timelineModel();for(const track of this._model.tracks()){for(const event of track.events){if(!timelineModel.isMarkerEvent(event))
continue;if(timelineModel.isLCPCandidateEvent(event)||timelineModel.isLCPInvalidateEvent(event))
lcpEvents.push(event);else
metricEvents.push(event);}}
if(lcpEvents.length>0){const winning_event=lcpEvents.reduce(function(a,b){return Number(a.args['data']['candidateIndex'])>Number(b.args['data']['candidateIndex'])?a:b;});if(timelineModel.isLCPCandidateEvent(winning_event))
metricEvents.push(winning_event);}
metricEvents.sort(SDK.TracingModel.Event.compareStartTime);const totalTimes=this._timelineData.entryTotalTimes;for(const event of metricEvents){this._appendEvent(event,this._currentLevel);totalTimes[totalTimes.length-1]=Number.NaN;}
++this._currentLevel;}
_appendFrames(){const screenshots=this._performanceModel.filmStripModel().frames();const hasFilmStrip=!!screenshots.length;this._framesHeader.collapsible=hasFilmStrip;this._appendHeader(Common.UIString('Frames'),this._framesHeader,false);this._frameGroup=this._timelineData.groups.peekLast();const style=Timeline.TimelineUIUtils.markerStyleForFrame();this._entryTypeByLevel[this._currentLevel]=Timeline.TimelineFlameChartDataProvider.EntryType.Frame;for(const frame of this._performanceModel.frames()){this._markers.push(new Timeline.TimelineFlameChartMarker(frame.startTime,frame.startTime-this._model.minimumRecordTime(),style));this._appendFrame(frame);}
++this._currentLevel;if(!hasFilmStrip)
return;this._appendHeader('',this._screenshotsHeader,false);this._entryTypeByLevel[this._currentLevel]=Timeline.TimelineFlameChartDataProvider.EntryType.Screenshot;let prevTimestamp;for(const screenshot of screenshots){this._entryData.push(screenshot);this._timelineData.entryLevels.push(this._currentLevel);this._timelineData.entryStartTimes.push(screenshot.timestamp);if(prevTimestamp)
this._timelineData.entryTotalTimes.push(screenshot.timestamp-prevTimestamp);prevTimestamp=screenshot.timestamp;}
if(screenshots.length)
this._timelineData.entryTotalTimes.push(this._model.maximumRecordTime()-prevTimestamp);++this._currentLevel;}
_entryType(entryIndex){return this._entryTypeByLevel[this._timelineData.entryLevels[entryIndex]];}
prepareHighlightedEntryInfo(entryIndex){let time='';let title;let warning;const type=this._entryType(entryIndex);if(type===Timeline.TimelineFlameChartDataProvider.EntryType.Event){const event=(this._entryData[entryIndex]);const totalTime=event.duration;const selfTime=event.selfTime;const eps=1e-6;if(typeof totalTime==='number'){time=Math.abs(totalTime-selfTime)>eps&&selfTime>eps?Common.UIString('%s (self %s)',Number.millisToString(totalTime,true),Number.millisToString(selfTime,true)):Number.millisToString(totalTime,true);}
if(this._performanceModel.timelineModel().isMarkerEvent(event))
title=Timeline.TimelineUIUtils.eventTitle(event);else
title=this.entryTitle(entryIndex);warning=Timeline.TimelineUIUtils.eventWarning(event);}else if(type===Timeline.TimelineFlameChartDataProvider.EntryType.Frame){const frame=(this._entryData[entryIndex]);time=Common.UIString('%s ~ %.0f\xa0fps',Number.preciseMillisToString(frame.duration,1),(1000/frame.duration));title=frame.idle?Common.UIString('Idle Frame'):Common.UIString('Frame');if(frame.hasWarnings()){warning=createElement('span');warning.textContent=Common.UIString('Long frame');}}else{return null;}
const element=createElement('div');const root=UI.createShadowRootWithCoreStyles(element,'timeline/timelineFlamechartPopover.css');const contents=root.createChild('div','timeline-flamechart-popover');contents.createChild('span','timeline-info-time').textContent=time;contents.createChild('span','timeline-info-title').textContent=title;if(warning){warning.classList.add('timeline-info-warning');contents.appendChild(warning);}
return element;}
entryColor(entryIndex){function patchColorAndCache(cache,key,lookupColor){let color=cache.get(key);if(color)
return color;const parsedColor=Common.Color.parse(lookupColor(key));color=parsedColor.setAlpha(0.7).asString(Common.Color.Format.RGBA)||'';cache.set(key,color);return color;}
const entryTypes=Timeline.TimelineFlameChartDataProvider.EntryType;const type=this._entryType(entryIndex);if(type===entryTypes.Event){const event=(this._entryData[entryIndex]);if(this._model.isGenericTrace())
return this._genericTraceEventColor(event);if(this._performanceModel.timelineModel().isMarkerEvent(event))
return Timeline.TimelineUIUtils.markerStyleForEvent(event).color;if(!SDK.TracingModel.isAsyncPhase(event.phase))
return this._colorForEvent(event);if(event.hasCategory(TimelineModel.TimelineModel.Category.Console)||event.hasCategory(TimelineModel.TimelineModel.Category.UserTiming))
return this._consoleColorGenerator.colorForID(event.name);if(event.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)){const phase=TimelineModel.TimelineIRModel.phaseForEvent(event)||TimelineModel.TimelineIRModel.Phases.Uncategorized;return patchColorAndCache(this._asyncColorByInteractionPhase,phase,Timeline.TimelineUIUtils.interactionPhaseColor);}
const category=Timeline.TimelineUIUtils.eventStyle(event).category;return patchColorAndCache(this._asyncColorByCategory,category,()=>category.color);}
if(type===entryTypes.Frame)
return'white';if(type===entryTypes.InteractionRecord)
return'transparent';if(type===entryTypes.ExtensionEvent){const event=(this._entryData[entryIndex]);return this._extensionColorGenerator.colorForID(event.name);}
return'';}
_genericTraceEventColor(event){const key=event.categoriesString||event.name;return key?`hsl(${String.hashCode(key) % 300 + 30}, 40%, 70%)`:'#ccc';}
_drawFrame(entryIndex,context,text,barX,barY,barWidth,barHeight){const hPadding=1;const frame=(this._entryData[entryIndex]);barX+=hPadding;barWidth-=2*hPadding;context.fillStyle=frame.idle?'white':(frame.hasWarnings()?'#fad1d1':'#d7f0d1');context.fillRect(barX,barY,barWidth,barHeight);const frameDurationText=Number.preciseMillisToString(frame.duration,1);const textWidth=context.measureText(frameDurationText).width;if(textWidth<=barWidth){context.fillStyle=this.textColor(entryIndex);context.fillText(frameDurationText,barX+(barWidth-textWidth)/2,barY+barHeight-4);}}
async _drawScreenshot(entryIndex,context,barX,barY,barWidth,barHeight){const screenshot=(this._entryData[entryIndex]);if(!this._screenshotImageCache.has(screenshot)){this._screenshotImageCache.set(screenshot,null);const data=await screenshot.imageDataPromise();const image=await UI.loadImageFromData(data);this._screenshotImageCache.set(screenshot,image);this.dispatchEventToListeners(Timeline.TimelineFlameChartDataProvider.Events.DataChanged);return;}
const image=this._screenshotImageCache.get(screenshot);if(!image)
return;const imageX=barX+1;const imageY=barY+1;const imageHeight=barHeight-2;const scale=imageHeight/image.naturalHeight;const imageWidth=Math.floor(image.naturalWidth*scale);context.save();context.beginPath();context.rect(barX,barY,barWidth,barHeight);context.clip();context.drawImage(image,imageX,imageY,imageWidth,imageHeight);context.strokeStyle='#ccc';context.strokeRect(imageX-0.5,imageY-0.5,Math.min(barWidth-1,imageWidth+1),imageHeight);context.restore();}
decorateEntry(entryIndex,context,text,barX,barY,barWidth,barHeight,unclippedBarX,timeToPixels){const data=this._entryData[entryIndex];const type=this._entryType(entryIndex);const entryTypes=Timeline.TimelineFlameChartDataProvider.EntryType;if(type===entryTypes.Frame){this._drawFrame(entryIndex,context,text,barX,barY,barWidth,barHeight);return true;}
if(type===entryTypes.Screenshot){this._drawScreenshot(entryIndex,context,barX,barY,barWidth,barHeight);return true;}
if(type===entryTypes.InteractionRecord){const color=Timeline.TimelineUIUtils.interactionPhaseColor((data));context.fillStyle=color;context.fillRect(barX,barY,barWidth-1,2);context.fillRect(barX,barY-3,2,3);context.fillRect(barX+barWidth-3,barY-3,2,3);return false;}
if(type===entryTypes.Event){const event=(data);if(event.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)){const timeWaitingForMainThread=TimelineModel.TimelineData.forEvent(event).timeWaitingForMainThread;if(timeWaitingForMainThread){context.fillStyle='hsla(0, 70%, 60%, 1)';const width=Math.floor(unclippedBarX-barX+timeWaitingForMainThread*timeToPixels);context.fillRect(barX,barY+barHeight-3,width,2);}}
if(TimelineModel.TimelineData.forEvent(event).warning)
paintWarningDecoration(barX,barWidth-1.5);}
function paintWarningDecoration(x,width){const triangleSize=8;context.save();context.beginPath();context.rect(x,barY,width,barHeight);context.clip();context.beginPath();context.fillStyle='red';context.moveTo(x+width-triangleSize,barY);context.lineTo(x+width,barY);context.lineTo(x+width,barY+triangleSize);context.fill();context.restore();}
return false;}
forceDecoration(entryIndex){const entryTypes=Timeline.TimelineFlameChartDataProvider.EntryType;const type=this._entryType(entryIndex);if(type===entryTypes.Frame)
return true;if(type===entryTypes.Screenshot)
return true;if(type===entryTypes.Event){const event=(this._entryData[entryIndex]);return!!TimelineModel.TimelineData.forEvent(event).warning;}
return false;}
appendExtensionEvents(entry){this._extensionInfo.push(entry);if(this._timelineData)
this._innerAppendExtensionEvents(this._extensionInfo.length-1);}
_innerAppendExtensionEvents(index){const entry=this._extensionInfo[index];const entryType=Timeline.TimelineFlameChartDataProvider.EntryType.ExtensionEvent;const allThreads=[].concat(...entry.model.sortedProcesses().map(process=>process.sortedThreads()));if(!allThreads.length)
return;const singleTrack=allThreads.length===1&&(!allThreads[0].events().length||!allThreads[0].asyncEvents().length);if(!singleTrack)
this._appendHeader(entry.title,this._headerLevel1,false);const style=singleTrack?this._headerLevel2:this._headerLevel1;let threadIndex=0;for(const thread of allThreads){const title=singleTrack?entry.title:thread.name()||ls`Thread ${++threadIndex}`;this._appendAsyncEventsGroup(null,title,thread.asyncEvents(),style,entryType,false);this._appendSyncEvents(null,thread.events(),title,style,entryType,false);}}
_appendHeader(title,style,selectable){const group={startLevel:this._currentLevel,name:title,style:style,selectable:selectable};this._timelineData.groups.push(group);return group;}
_appendEvent(event,level){const index=this._entryData.length;this._entryData.push(event);this._timelineData.entryLevels[index]=level;this._timelineData.entryTotalTimes[index]=event.duration||Timeline.TimelineFlameChartDataProvider.InstantEventVisibleDurationMs;this._timelineData.entryStartTimes[index]=event.startTime;event[Timeline.TimelineFlameChartDataProvider._indexSymbol]=index;return index;}
_appendAsyncEvent(asyncEvent,level){if(SDK.TracingModel.isNestableAsyncPhase(asyncEvent.phase)){this._appendEvent(asyncEvent,level);return;}
const steps=asyncEvent.steps;const eventOffset=steps.length>1&&steps[1].phase===SDK.TracingModel.Phase.AsyncStepPast?1:0;for(let i=0;i<steps.length-1;++i){const index=this._entryData.length;this._entryData.push(steps[i+eventOffset]);const startTime=steps[i].startTime;this._timelineData.entryLevels[index]=level;this._timelineData.entryTotalTimes[index]=steps[i+1].startTime-startTime;this._timelineData.entryStartTimes[index]=startTime;}}
_appendFlowEvent(event,level){const timelineData=this._timelineData;function pushStartFlow(event){const flowIndex=timelineData.flowStartTimes.length;timelineData.flowStartTimes.push(event.startTime);timelineData.flowStartLevels.push(level);return flowIndex;}
function pushEndFlow(event,flowIndex){timelineData.flowEndTimes[flowIndex]=event.startTime;timelineData.flowEndLevels[flowIndex]=level;}
switch(event.phase){case SDK.TracingModel.Phase.FlowBegin:this._flowEventIndexById.set(event.id,pushStartFlow(event));break;case SDK.TracingModel.Phase.FlowStep:pushEndFlow(event,this._flowEventIndexById.get(event.id));this._flowEventIndexById.set(event.id,pushStartFlow(event));break;case SDK.TracingModel.Phase.FlowEnd:pushEndFlow(event,this._flowEventIndexById.get(event.id));this._flowEventIndexById.delete(event.id);break;}}
_appendFrame(frame){const index=this._entryData.length;this._entryData.push(frame);this._entryIndexToTitle[index]=Number.millisToString(frame.duration,true);this._timelineData.entryLevels[index]=this._currentLevel;this._timelineData.entryTotalTimes[index]=frame.duration;this._timelineData.entryStartTimes[index]=frame.startTime;}
createSelection(entryIndex){const type=this._entryType(entryIndex);let timelineSelection=null;if(type===Timeline.TimelineFlameChartDataProvider.EntryType.Event){timelineSelection=Timeline.TimelineSelection.fromTraceEvent((this._entryData[entryIndex]));}else if(type===Timeline.TimelineFlameChartDataProvider.EntryType.Frame){timelineSelection=Timeline.TimelineSelection.fromFrame((this._entryData[entryIndex]));}
if(timelineSelection)
this._lastSelection=new Timeline.TimelineFlameChartView.Selection(timelineSelection,entryIndex);return timelineSelection;}
formatValue(value,precision){return Number.preciseMillisToString(value,precision);}
canJumpToEntry(entryIndex){return false;}
entryIndexForSelection(selection){if(!selection||selection.type()===Timeline.TimelineSelection.Type.Range)
return-1;if(this._lastSelection&&this._lastSelection.timelineSelection.object()===selection.object())
return this._lastSelection.entryIndex;const index=this._entryData.indexOf((selection.object()));if(index!==-1)
this._lastSelection=new Timeline.TimelineFlameChartView.Selection(selection,index);return index;}
buildFlowForInitiator(entryIndex){if(this._lastInitiatorEntry===entryIndex)
return false;this._lastInitiatorEntry=entryIndex;let event=this.eventByIndex(entryIndex);const td=this._timelineData;td.flowStartTimes=[];td.flowStartLevels=[];td.flowEndTimes=[];td.flowEndLevels=[];while(event){let initiator;for(;event;event=this._eventParent(event)){initiator=TimelineModel.TimelineData.forEvent(event).initiator();if(initiator)
break;}
if(!initiator)
break;const eventIndex=event[Timeline.TimelineFlameChartDataProvider._indexSymbol];const initiatorIndex=initiator[Timeline.TimelineFlameChartDataProvider._indexSymbol];td.flowStartTimes.push(initiator.endTime||initiator.startTime);td.flowStartLevels.push(td.entryLevels[initiatorIndex]);td.flowEndTimes.push(event.startTime);td.flowEndLevels.push(td.entryLevels[eventIndex]);event=initiator;}
return true;}
_eventParent(event){return this._entryParent[event[Timeline.TimelineFlameChartDataProvider._indexSymbol]]||null;}
eventByIndex(entryIndex){return entryIndex>=0&&this._entryType(entryIndex)===Timeline.TimelineFlameChartDataProvider.EntryType.Event?(this._entryData[entryIndex]):null;}
setEventColorMapping(colorForEvent){this._colorForEvent=colorForEvent;}};Timeline.TimelineFlameChartDataProvider.InstantEventVisibleDurationMs=0.001;Timeline.TimelineFlameChartDataProvider._indexSymbol=Symbol('index');Timeline.TimelineFlameChartDataProvider.Events={DataChanged:Symbol('DataChanged')};Timeline.TimelineFlameChartDataProvider.EntryType={Frame:Symbol('Frame'),Event:Symbol('Event'),InteractionRecord:Symbol('InteractionRecord'),ExtensionEvent:Symbol('ExtensionEvent'),Screenshot:Symbol('Screenshot'),};;Timeline.TimelineFlameChartNetworkDataProvider=class{constructor(){this._font='11px '+Host.fontFamily();this.setModel(null);this._style={padding:4,height:17,collapsible:true,color:UI.themeSupport.patchColorText('#222',UI.ThemeSupport.ColorUsage.Foreground),font:this._font,backgroundColor:UI.themeSupport.patchColorText('white',UI.ThemeSupport.ColorUsage.Background),nestingLevel:0,useFirstLineForOverview:false,useDecoratorsForOverview:true,shareHeaderLine:false};this._group={startLevel:0,name:Common.UIString('Network'),expanded:false,style:this._style};this._minimumBoundary=0;this._maximumBoundary=0;this._timeSpan=0;}
setModel(performanceModel){this._model=performanceModel&&performanceModel.timelineModel();this._maxLevel=0;this._timelineData=null;this._requests=[];}
isEmpty(){this.timelineData();return!this._requests.length;}
maxStackDepth(){return this._maxLevel;}
timelineData(){if(this._timelineData)
return this._timelineData;this._requests=[];this._timelineData=new PerfUI.FlameChart.TimelineData([],[],[],[]);if(this._model)
this._appendTimelineData();return this._timelineData;}
minimumBoundary(){return this._minimumBoundary;}
totalTime(){return this._timeSpan;}
setWindowTimes(startTime,endTime){this._startTime=startTime;this._endTime=endTime;this._updateTimelineData();}
createSelection(index){if(index===-1)
return null;const request=this._requests[index];this._lastSelection=new Timeline.TimelineFlameChartView.Selection(Timeline.TimelineSelection.fromNetworkRequest(request),index);return this._lastSelection.timelineSelection;}
entryIndexForSelection(selection){if(!selection)
return-1;if(this._lastSelection&&this._lastSelection.timelineSelection.object()===selection.object())
return this._lastSelection.entryIndex;if(selection.type()!==Timeline.TimelineSelection.Type.NetworkRequest)
return-1;const request=(selection.object());const index=this._requests.indexOf(request);if(index!==-1){this._lastSelection=new Timeline.TimelineFlameChartView.Selection(Timeline.TimelineSelection.fromNetworkRequest(request),index);}
return index;}
entryColor(index){const request=(this._requests[index]);const category=Timeline.TimelineUIUtils.networkRequestCategory(request);return Timeline.TimelineUIUtils.networkCategoryColor(category);}
textColor(index){return Timeline.FlameChartStyle.textColor;}
entryTitle(index){const request=(this._requests[index]);const parsedURL=new Common.ParsedURL(request.url||'');return parsedURL.isValid?`${parsedURL.displayName} (${parsedURL.host})`:request.url||null;}
entryFont(index){return this._font;}
decorateEntry(index,context,text,barX,barY,barWidth,barHeight,unclippedBarX,timeToPixelRatio){const request=(this._requests[index]);if(!request.timing)
return false;const beginTime=request.beginTime();const timeToPixel=time=>Math.floor(unclippedBarX+(time-beginTime)*timeToPixelRatio);const minBarWidthPx=2;const startTime=request.getStartTime();const endTime=request.endTime;const{sendStartTime,headersEndTime}=request.getSendReceiveTiming();const sendStart=Math.max(timeToPixel(sendStartTime),unclippedBarX);const headersEnd=Math.max(timeToPixel(headersEndTime),sendStart);const finish=Math.max(timeToPixel(request.finishTime||endTime),headersEnd+minBarWidthPx);const start=timeToPixel(startTime);const end=Math.max(timeToPixel(endTime),finish);context.fillStyle='hsla(0, 100%, 100%, 0.8)';context.fillRect(sendStart+0.5,barY+0.5,headersEnd-sendStart-0.5,barHeight-2);context.fillStyle=UI.themeSupport.patchColorText('white',UI.ThemeSupport.ColorUsage.Background);context.fillRect(barX,barY-0.5,sendStart-barX,barHeight);context.fillRect(finish,barY-0.5,barX+barWidth-finish,barHeight);if(!request.cached()&&request.timing.pushStart){const pushStart=timeToPixel(request.timing.pushStart*1000);const pushEnd=request.timing.pushEnd?timeToPixel(request.timing.pushEnd*1000):start;const dentSize=Number.constrain(pushEnd-pushStart-2,0,4);const padding=1;context.save();context.beginPath();context.moveTo(pushStart+dentSize,barY+barHeight/2);context.lineTo(pushStart,barY+padding);context.lineTo(pushEnd-dentSize,barY+padding);context.lineTo(pushEnd,barY+barHeight/2);context.lineTo(pushEnd-dentSize,barY+barHeight-padding);context.lineTo(pushStart,barY+barHeight-padding);context.closePath();if(request.timing.pushEnd){context.fillStyle=this.entryColor(index);}else{const gradient=context.createLinearGradient(pushStart,0,pushEnd,0);gradient.addColorStop(0,this.entryColor(index));gradient.addColorStop(1,'white');context.fillStyle=gradient;}
context.globalAlpha=0.3;context.fill();context.restore();}
function drawTick(begin,end,y){const tickHeightPx=6;context.moveTo(begin,y-tickHeightPx/2);context.lineTo(begin,y+tickHeightPx/2);context.moveTo(begin,y);context.lineTo(end,y);}
context.beginPath();context.lineWidth=1;context.strokeStyle='#ccc';const lineY=Math.floor(barY+barHeight/2)+0.5;const leftTick=start+0.5;const rightTick=end-0.5;drawTick(leftTick,sendStart,lineY);drawTick(rightTick,finish,lineY);context.stroke();if(typeof request.priority==='string'){const color=this._colorForPriority(request.priority);if(color){context.fillStyle=color;context.fillRect(sendStart+0.5,barY+0.5,3.5,3.5);}}
const textStart=Math.max(sendStart,0);const textWidth=finish-textStart;const minTextWidthPx=20;if(textWidth>=minTextWidthPx){text=this.entryTitle(index)||'';if(request.fromServiceWorker)
text=' '+text;if(text){const textPadding=4;const textBaseline=5;const textBaseHeight=barHeight-textBaseline;const trimmedText=UI.trimTextEnd(context,text,textWidth-2*textPadding);context.fillStyle='#333';context.fillText(trimmedText,textStart+textPadding,barY+textBaseHeight);}}
return true;}
forceDecoration(index){return true;}
prepareHighlightedEntryInfo(index){const maxURLChars=80;const request=(this._requests[index]);if(!request.url)
return null;const element=createElement('div');const root=UI.createShadowRootWithCoreStyles(element,'timeline/timelineFlamechartPopover.css');const contents=root.createChild('div','timeline-flamechart-popover');const startTime=request.getStartTime();const duration=request.endTime-startTime;if(startTime&&isFinite(duration))
contents.createChild('span','timeline-info-network-time').textContent=Number.millisToString(duration,true);if(typeof request.priority==='string'){const div=contents.createChild('span');div.textContent=PerfUI.uiLabelForNetworkPriority((request.priority));div.style.color=this._colorForPriority(request.priority)||'black';}
contents.createChild('span').textContent=request.url.trimMiddle(maxURLChars);return element;}
_colorForPriority(priority){if(!this._priorityToValue){const priorities=Protocol.Network.ResourcePriority;this._priorityToValue=new Map([[priorities.VeryLow,1],[priorities.Low,2],[priorities.Medium,3],[priorities.High,4],[priorities.VeryHigh,5]]);}
const value=this._priorityToValue.get(priority);return value?`hsla(214, 80%, 50%, ${value / 5})`:null;}
_appendTimelineData(){this._minimumBoundary=this._model.minimumRecordTime();this._maximumBoundary=this._model.maximumRecordTime();this._timeSpan=this._model.isEmpty()?1000:this._maximumBoundary-this._minimumBoundary;this._model.networkRequests().forEach(this._appendEntry.bind(this));this._updateTimelineData();}
_updateTimelineData(){if(!this._timelineData)
return;const lastTimeByLevel=[];let maxLevel=0;for(let i=0;i<this._requests.length;++i){const r=this._requests[i];const beginTime=r.beginTime();const visible=beginTime<this._endTime&&r.endTime>this._startTime;if(!visible){this._timelineData.entryLevels[i]=-1;continue;}
while(lastTimeByLevel.length&&lastTimeByLevel.peekLast()<=beginTime)
lastTimeByLevel.pop();this._timelineData.entryLevels[i]=lastTimeByLevel.length;lastTimeByLevel.push(r.endTime);maxLevel=Math.max(maxLevel,lastTimeByLevel.length);}
for(let i=0;i<this._requests.length;++i){if(this._timelineData.entryLevels[i]===-1)
this._timelineData.entryLevels[i]=maxLevel;}
this._timelineData=new PerfUI.FlameChart.TimelineData(this._timelineData.entryLevels,this._timelineData.entryTotalTimes,this._timelineData.entryStartTimes,[this._group]);this._maxLevel=maxLevel;}
_appendEntry(request){this._requests.push(request);this._timelineData.entryStartTimes.push(request.beginTime());this._timelineData.entryTotalTimes.push(request.endTime-request.beginTime());this._timelineData.entryLevels.push(this._requests.length-1);}
preferredHeight(){return this._style.height*(this._group.expanded?Number.constrain(this._maxLevel+1,4,8.5):1);}
isExpanded(){return this._group.expanded;}
formatValue(value,precision){return Number.preciseMillisToString(value,precision);}
canJumpToEntry(entryIndex){return false;}};;Timeline.TimelineFlameChartView=class extends UI.VBox{constructor(delegate){super();this.element.classList.add('timeline-flamechart');this._delegate=delegate;this._model=null;this._searchResults;this._eventListeners=[];this._showMemoryGraphSetting=Common.settings.createSetting('timelineShowMemory',false);this._networkSplitWidget=new UI.SplitWidget(false,false,'timelineFlamechartMainView',150);const mainViewGroupExpansionSetting=Common.settings.createSetting('timelineFlamechartMainViewGroupExpansion',{});this._mainDataProvider=new Timeline.TimelineFlameChartDataProvider();this._mainDataProvider.addEventListener(Timeline.TimelineFlameChartDataProvider.Events.DataChanged,()=>this._mainFlameChart.scheduleUpdate());this._mainFlameChart=new PerfUI.FlameChart(this._mainDataProvider,this,mainViewGroupExpansionSetting);this._mainFlameChart.alwaysShowVerticalScroll();this._mainFlameChart.enableRuler(false);this._networkFlameChartGroupExpansionSetting=Common.settings.createSetting('timelineFlamechartNetworkViewGroupExpansion',{});this._networkDataProvider=new Timeline.TimelineFlameChartNetworkDataProvider();this._networkFlameChart=new PerfUI.FlameChart(this._networkDataProvider,this,this._networkFlameChartGroupExpansionSetting);this._networkFlameChart.alwaysShowVerticalScroll();this._networkFlameChart.disableRangeSelection();this._networkPane=new UI.VBox();this._networkPane.setMinimumSize(23,23);this._networkFlameChart.show(this._networkPane.element);this._splitResizer=this._networkPane.element.createChild('div','timeline-flamechart-resizer');this._networkSplitWidget.hideDefaultResizer(true);this._networkSplitWidget.installResizer(this._splitResizer);this._networkSplitWidget.setMainWidget(this._mainFlameChart);this._networkSplitWidget.setSidebarWidget(this._networkPane);this._chartSplitWidget=new UI.SplitWidget(false,true,'timelineCountersSplitViewState');this._countersView=new Timeline.CountersGraph(this._delegate);this._chartSplitWidget.setMainWidget(this._networkSplitWidget);this._chartSplitWidget.setSidebarWidget(this._countersView);this._chartSplitWidget.hideDefaultResizer();this._chartSplitWidget.installResizer((this._countersView.resizerElement()));this._updateCountersGraphToggle();this._detailsSplitWidget=new UI.SplitWidget(false,true,'timelinePanelDetailsSplitViewState');this._detailsSplitWidget.element.classList.add('timeline-details-split');this._detailsView=new Timeline.TimelineDetailsView(delegate);this._detailsSplitWidget.installResizer(this._detailsView.headerElement());this._detailsSplitWidget.setMainWidget(this._chartSplitWidget);this._detailsSplitWidget.setSidebarWidget(this._detailsView);this._detailsSplitWidget.show(this.element);this._onMainEntrySelected=this._onEntrySelected.bind(this,this._mainDataProvider);this._onNetworkEntrySelected=this._onEntrySelected.bind(this,this._networkDataProvider);this._mainFlameChart.addEventListener(PerfUI.FlameChart.Events.EntrySelected,this._onMainEntrySelected,this);this._mainFlameChart.addEventListener(PerfUI.FlameChart.Events.EntryInvoked,this._onMainEntrySelected,this);this._networkFlameChart.addEventListener(PerfUI.FlameChart.Events.EntrySelected,this._onNetworkEntrySelected,this);this._networkFlameChart.addEventListener(PerfUI.FlameChart.Events.EntryInvoked,this._onNetworkEntrySelected,this);this._mainFlameChart.addEventListener(PerfUI.FlameChart.Events.EntryHighlighted,this._onEntryHighlighted,this);this._nextExtensionIndex=0;this._boundRefresh=this._refresh.bind(this);this._selectedTrack=null;this._mainDataProvider.setEventColorMapping(Timeline.TimelineUIUtils.eventColor);this._groupBySetting=Common.settings.createSetting('timelineTreeGroupBy',Timeline.AggregatedTimelineTreeView.GroupBy.None);this._groupBySetting.addChangeListener(this._updateColorMapper,this);this._updateColorMapper();ProductRegistry.instance().then(registry=>this._productRegistry=registry);}
_updateColorMapper(){this._urlToColorCache=new Map();if(!this._model)
return;const colorByProduct=this._groupBySetting.get()===Timeline.AggregatedTimelineTreeView.GroupBy.Product;this._mainDataProvider.setEventColorMapping(colorByProduct?this._colorByProductForEvent.bind(this):Timeline.TimelineUIUtils.eventColor);this._mainFlameChart.update();}
_colorByProductForEvent(event){return Timeline.TimelineUIUtils.eventColorByProduct(this._productRegistry,this._model.timelineModel(),this._urlToColorCache,event);}
_onWindowChanged(event){const window=(event.data.window);const animate=!!event.data.animate;this._mainFlameChart.setWindowTimes(window.left,window.right,animate);this._networkFlameChart.setWindowTimes(window.left,window.right,animate);this._networkDataProvider.setWindowTimes(window.left,window.right);this._updateSearchResults(false,false);}
windowChanged(windowStartTime,windowEndTime,animate){this._model.setWindow({left:windowStartTime,right:windowEndTime},animate);}
updateRangeSelection(startTime,endTime){this._delegate.select(Timeline.TimelineSelection.fromRange(startTime,endTime));}
updateSelectedGroup(flameChart,group){if(flameChart!==this._mainFlameChart)
return;const track=group?this._mainDataProvider.groupTrack(group):null;this._selectedTrack=track;this._updateTrack();}
setModel(model){if(model===this._model)
return;Common.EventTarget.removeEventListeners(this._eventListeners);this._model=model;this._selectedTrack=null;this._mainDataProvider.setModel(this._model);this._networkDataProvider.setModel(this._model);if(this._model){this._eventListeners=[this._model.addEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this),this._model.addEventListener(Timeline.PerformanceModel.Events.ExtensionDataAdded,this._appendExtensionData,this)];const window=model.window();this._mainFlameChart.setWindowTimes(window.left,window.right);this._networkFlameChart.setWindowTimes(window.left,window.right);this._networkDataProvider.setWindowTimes(window.left,window.right);this._updateSearchResults(false,false);}
this._updateColorMapper();this._updateTrack();this._nextExtensionIndex=0;this._appendExtensionData();this._refresh();}
_updateTrack(){this._countersView.setModel(this._model,this._selectedTrack);this._detailsView.setModel(this._model,this._selectedTrack);}
_refresh(){if(this._networkDataProvider.isEmpty()){this._mainFlameChart.enableRuler(true);this._networkSplitWidget.hideSidebar();}else{this._mainFlameChart.enableRuler(false);this._networkSplitWidget.showBoth();this.resizeToPreferredHeights();}
this._mainFlameChart.reset();this._networkFlameChart.reset();this._updateSearchResults(false,false);}
_appendExtensionData(){if(!this._model)
return;const extensions=this._model.extensionInfo();while(this._nextExtensionIndex<extensions.length)
this._mainDataProvider.appendExtensionEvents(extensions[this._nextExtensionIndex++]);this._mainFlameChart.scheduleUpdate();}
_onEntryHighlighted(commonEvent){SDK.OverlayModel.hideDOMNodeHighlight();const entryIndex=(commonEvent.data);const event=this._mainDataProvider.eventByIndex(entryIndex);if(!event)
return;const target=this._model&&this._model.timelineModel().targetByEvent(event);if(!target)
return;const timelineData=TimelineModel.TimelineData.forEvent(event);const backendNodeId=timelineData.backendNodeId;if(!backendNodeId)
return;new SDK.DeferredDOMNode(target,backendNodeId).highlight();}
highlightEvent(event){const entryIndex=event?this._mainDataProvider.entryIndexForSelection(Timeline.TimelineSelection.fromTraceEvent(event)):-1;if(entryIndex>=0)
this._mainFlameChart.highlightEntry(entryIndex);else
this._mainFlameChart.hideHighlight();}
willHide(){this._networkFlameChartGroupExpansionSetting.removeChangeListener(this.resizeToPreferredHeights,this);this._showMemoryGraphSetting.removeChangeListener(this._updateCountersGraphToggle,this);Bindings.blackboxManager.removeChangeListener(this._boundRefresh);}
wasShown(){this._networkFlameChartGroupExpansionSetting.addChangeListener(this.resizeToPreferredHeights,this);this._showMemoryGraphSetting.addChangeListener(this._updateCountersGraphToggle,this);Bindings.blackboxManager.addChangeListener(this._boundRefresh);if(this._needsResizeToPreferredHeights)
this.resizeToPreferredHeights();this._mainFlameChart.scheduleUpdate();this._networkFlameChart.scheduleUpdate();}
_updateCountersGraphToggle(){if(this._showMemoryGraphSetting.get())
this._chartSplitWidget.showBoth();else
this._chartSplitWidget.hideSidebar();}
setSelection(selection){let index=this._mainDataProvider.entryIndexForSelection(selection);this._mainFlameChart.setSelectedEntry(index);index=this._networkDataProvider.entryIndexForSelection(selection);this._networkFlameChart.setSelectedEntry(index);if(this._detailsView)
this._detailsView.setSelection(selection);}
_onEntrySelected(dataProvider,event){const entryIndex=(event.data);if(Runtime.experiments.isEnabled('timelineEventInitiators')&&dataProvider===this._mainDataProvider){if(this._mainDataProvider.buildFlowForInitiator(entryIndex))
this._mainFlameChart.scheduleUpdate();}
this._delegate.select(dataProvider.createSelection(entryIndex));}
resizeToPreferredHeights(){if(!this.isShowing()){this._needsResizeToPreferredHeights=true;return;}
this._needsResizeToPreferredHeights=false;this._networkPane.element.classList.toggle('timeline-network-resizer-disabled',!this._networkDataProvider.isExpanded());this._networkSplitWidget.setSidebarSize(this._networkDataProvider.preferredHeight()+this._splitResizer.clientHeight+PerfUI.FlameChart.HeaderHeight+
2);}
setSearchableView(searchableView){this._searchableView=searchableView;}
jumpToNextSearchResult(){if(!this._searchResults||!this._searchResults.length)
return;const index=typeof this._selectedSearchResult!=='undefined'?this._searchResults.indexOf(this._selectedSearchResult):-1;this._selectSearchResult(mod(index+1,this._searchResults.length));}
jumpToPreviousSearchResult(){if(!this._searchResults||!this._searchResults.length)
return;const index=typeof this._selectedSearchResult!=='undefined'?this._searchResults.indexOf(this._selectedSearchResult):0;this._selectSearchResult(mod(index-1,this._searchResults.length));}
supportsCaseSensitiveSearch(){return true;}
supportsRegexSearch(){return true;}
_selectSearchResult(index){this._searchableView.updateCurrentMatchIndex(index);this._selectedSearchResult=this._searchResults[index];this._delegate.select(this._mainDataProvider.createSelection(this._selectedSearchResult));}
_updateSearchResults(shouldJump,jumpBackwards){const oldSelectedSearchResult=this._selectedSearchResult;delete this._selectedSearchResult;this._searchResults=[];if(!this._searchRegex||!this._model)
return;const regExpFilter=new Timeline.TimelineFilters.RegExp(this._searchRegex);const window=this._model.window();this._searchResults=this._mainDataProvider.search(window.left,window.right,regExpFilter);this._searchableView.updateSearchMatchesCount(this._searchResults.length);if(!shouldJump||!this._searchResults.length)
return;let selectedIndex=this._searchResults.indexOf(oldSelectedSearchResult);if(selectedIndex===-1)
selectedIndex=jumpBackwards?this._searchResults.length-1:0;this._selectSearchResult(selectedIndex);}
searchCanceled(){if(typeof this._selectedSearchResult!=='undefined')
this._delegate.select(null);delete this._searchResults;delete this._selectedSearchResult;delete this._searchRegex;}
performSearch(searchConfig,shouldJump,jumpBackwards){this._searchRegex=searchConfig.toSearchRegex();this._updateSearchResults(shouldJump,jumpBackwards);}};Timeline.TimelineFlameChartView.Selection=class{constructor(selection,entryIndex){this.timelineSelection=selection;this.entryIndex=entryIndex;}};Timeline.FlameChartStyle={textColor:'#333'};Timeline.TimelineFlameChartMarker=class{constructor(startTime,startOffset,style){this._startTime=startTime;this._startOffset=startOffset;this._style=style;}
startTime(){return this._startTime;}
color(){return this._style.color;}
title(){if(this._style.lowPriority)
return null;const startTime=Number.millisToString(this._startOffset);return ls`${this._style.title} at ${startTime}`;}
draw(context,x,height,pixelsPerMillisecond){const lowPriorityVisibilityThresholdInPixelsPerMs=4;if(this._style.lowPriority&&pixelsPerMillisecond<lowPriorityVisibilityThresholdInPixelsPerMs)
return;context.save();if(this._style.tall){context.strokeStyle=this._style.color;context.lineWidth=this._style.lineWidth;context.translate(this._style.lineWidth<1||(this._style.lineWidth&1)?0.5:0,0.5);context.beginPath();context.moveTo(x,0);context.setLineDash(this._style.dashStyle);context.lineTo(x,context.canvas.height);context.stroke();}
context.restore();}};Timeline.TimelineFlameChartView._ColorBy={URL:'URL',Product:'Product'};;Timeline.TimelineHistoryManager=class{constructor(){this._recordings=[];this._action=(UI.actionRegistry.action('timeline.show-history'));this._nextNumberByDomain=new Map();this._button=new Timeline.TimelineHistoryManager.ToolbarButton(this._action);UI.ARIAUtils.markAsMenuButton(this._button.element);this.clear();this._allOverviews=[{constructor:Timeline.TimelineEventOverviewResponsiveness,height:3},{constructor:Timeline.TimelineEventOverviewFrames,height:16},{constructor:Timeline.TimelineEventOverviewCPUActivity,height:20},{constructor:Timeline.TimelineEventOverviewNetwork,height:8}];this._totalHeight=this._allOverviews.reduce((acc,entry)=>acc+entry.height,0);this._enabled=true;this._lastActiveModel=null;}
addRecording(performanceModel){this._lastActiveModel=performanceModel;this._recordings.unshift(performanceModel);this._buildPreview(performanceModel);const modelTitle=this._title(performanceModel);this._button.setText(modelTitle);const buttonTitle=this._action.title();UI.ARIAUtils.setAccessibleName(this._button.element,ls`Current Session: ${modelTitle}. ${buttonTitle}`);this._updateState();if(this._recordings.length<=Timeline.TimelineHistoryManager._maxRecordings)
return;const lruModel=this._recordings.reduce((a,b)=>lastUsedTime(a)<lastUsedTime(b)?a:b);this._recordings.splice(this._recordings.indexOf(lruModel),1);lruModel.dispose();function lastUsedTime(model){return Timeline.TimelineHistoryManager._dataForModel(model).lastUsed;}}
setEnabled(enabled){this._enabled=enabled;this._updateState();}
button(){return this._button;}
clear(){this._recordings.forEach(model=>model.dispose());this._recordings=[];this._lastActiveModel=null;this._updateState();this._button.setText(Common.UIString('(no recordings)'));this._nextNumberByDomain.clear();}
async showHistoryDropDown(){if(this._recordings.length<2||!this._enabled)
return null;const model=await Timeline.TimelineHistoryManager.DropDown.show(this._recordings,(this._lastActiveModel),this._button.element);if(!model)
return null;const index=this._recordings.indexOf(model);if(index<0){console.assert(false,`selected recording not found`);return null;}
this._setCurrentModel(model);return model;}
cancelIfShowing(){Timeline.TimelineHistoryManager.DropDown.cancelIfShowing();}
navigate(direction){if(!this._enabled||!this._lastActiveModel)
return null;const index=this._recordings.indexOf(this._lastActiveModel);if(index<0)
return null;const newIndex=Number.constrain(index+direction,0,this._recordings.length-1);const model=this._recordings[newIndex];this._setCurrentModel(model);return model;}
_setCurrentModel(model){Timeline.TimelineHistoryManager._dataForModel(model).lastUsed=Date.now();this._lastActiveModel=model;const modelTitle=this._title(model);const buttonTitle=this._action.title();this._button.setText(modelTitle);UI.ARIAUtils.setAccessibleName(this._button.element,ls`Current Session: ${modelTitle}. ${buttonTitle}`);}
_updateState(){this._action.setEnabled(this._recordings.length>1&&this._enabled);}
static _previewElement(performanceModel){const data=Timeline.TimelineHistoryManager._dataForModel(performanceModel);const startedAt=performanceModel.recordStartTime();data.time.textContent=startedAt?Common.UIString('(%s ago)',Timeline.TimelineHistoryManager._coarseAge(startedAt)):'';return data.preview;}
static _coarseAge(time){const seconds=Math.round((Date.now()-time)/1000);if(seconds<50)
return Common.UIString('moments');const minutes=Math.round(seconds/60);if(minutes<50)
return Common.UIString('%s m',minutes);const hours=Math.round(minutes/60);return Common.UIString('%s h',hours);}
_title(performanceModel){return Timeline.TimelineHistoryManager._dataForModel(performanceModel).title;}
_buildPreview(performanceModel){const parsedURL=performanceModel.timelineModel().pageURL().asParsedURL();const domain=parsedURL?parsedURL.host:'';const sequenceNumber=this._nextNumberByDomain.get(domain)||1;const title=Common.UIString('%s #%d',domain,sequenceNumber);this._nextNumberByDomain.set(domain,sequenceNumber+1);const timeElement=createElement('span');const preview=createElementWithClass('div','preview-item vbox');const data={preview:preview,title:title,time:timeElement,lastUsed:Date.now()};performanceModel[Timeline.TimelineHistoryManager._previewDataSymbol]=data;preview.appendChild(this._buildTextDetails(performanceModel,title,timeElement));const screenshotAndOverview=preview.createChild('div','hbox');screenshotAndOverview.appendChild(this._buildScreenshotThumbnail(performanceModel));screenshotAndOverview.appendChild(this._buildOverview(performanceModel));return data.preview;}
_buildTextDetails(performanceModel,title,timeElement){const container=createElementWithClass('div','text-details hbox');const nameSpan=container.createChild('span','name');nameSpan.textContent=title;UI.ARIAUtils.setAccessibleName(nameSpan,title);const tracingModel=performanceModel.tracingModel();const duration=Number.millisToString(tracingModel.maximumRecordTime()-tracingModel.minimumRecordTime(),false);const timeContainer=container.createChild('span','time');timeContainer.appendChild(createTextNode(duration));timeContainer.appendChild(timeElement);return container;}
_buildScreenshotThumbnail(performanceModel){const container=createElementWithClass('div','screenshot-thumb');const thumbnailAspectRatio=3/2;container.style.width=this._totalHeight*thumbnailAspectRatio+'px';container.style.height=this._totalHeight+'px';const filmStripModel=performanceModel.filmStripModel();const lastFrame=filmStripModel.frames().peekLast();if(!lastFrame)
return container;lastFrame.imageDataPromise().then(data=>UI.loadImageFromData(data)).then(image=>image&&container.appendChild(image));return container;}
_buildOverview(performanceModel){const container=createElement('div');container.style.width=Timeline.TimelineHistoryManager._previewWidth+'px';container.style.height=this._totalHeight+'px';const canvas=container.createChild('canvas');canvas.width=window.devicePixelRatio*Timeline.TimelineHistoryManager._previewWidth;canvas.height=window.devicePixelRatio*this._totalHeight;const ctx=canvas.getContext('2d');let yOffset=0;for(const overview of this._allOverviews){const timelineOverview=new overview.constructor();timelineOverview.setCanvasSize(Timeline.TimelineHistoryManager._previewWidth,overview.height);timelineOverview.setModel(performanceModel);timelineOverview.update();const sourceContext=timelineOverview.context();const imageData=sourceContext.getImageData(0,0,sourceContext.canvas.width,sourceContext.canvas.height);ctx.putImageData(imageData,0,yOffset);yOffset+=overview.height*window.devicePixelRatio;}
return container;}
static _dataForModel(model){return model[Timeline.TimelineHistoryManager._previewDataSymbol]||null;}};Timeline.TimelineHistoryManager.PreviewData;Timeline.TimelineHistoryManager._maxRecordings=5;Timeline.TimelineHistoryManager._previewWidth=450;Timeline.TimelineHistoryManager._previewDataSymbol=Symbol('previewData');Timeline.TimelineHistoryManager.DropDown=class{constructor(models){this._glassPane=new UI.GlassPane();this._glassPane.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);this._glassPane.setOutsideClickCallback(()=>this._close(null));this._glassPane.setPointerEventsBehavior(UI.GlassPane.PointerEventsBehavior.BlockedByGlassPane);this._glassPane.setAnchorBehavior(UI.GlassPane.AnchorBehavior.PreferBottom);this._glassPane.element.addEventListener('blur',()=>this._close(null));const shadowRoot=UI.createShadowRootWithCoreStyles(this._glassPane.contentElement,'timeline/timelineHistoryManager.css');const contentElement=shadowRoot.createChild('div','drop-down');const listModel=new UI.ListModel();this._listControl=new UI.ListControl(listModel,this,UI.ListMode.NonViewport);this._listControl.element.addEventListener('mousemove',this._onMouseMove.bind(this),false);listModel.replaceAll(models);UI.ARIAUtils.markAsMenu(this._listControl.element);UI.ARIAUtils.setAccessibleName(this._listControl.element,ls`Select Timeline Session`);contentElement.appendChild(this._listControl.element);contentElement.addEventListener('keydown',this._onKeyDown.bind(this),false);contentElement.addEventListener('click',this._onClick.bind(this),false);this._focusRestorer=new UI.ElementFocusRestorer(this._listControl.element);this._selectionDone=null;}
static show(models,currentModel,anchor){if(Timeline.TimelineHistoryManager.DropDown._instance)
return Promise.resolve((null));const instance=new Timeline.TimelineHistoryManager.DropDown(models);return instance._show(anchor,currentModel);}
static cancelIfShowing(){if(!Timeline.TimelineHistoryManager.DropDown._instance)
return;Timeline.TimelineHistoryManager.DropDown._instance._close(null);}
_show(anchor,currentModel){Timeline.TimelineHistoryManager.DropDown._instance=this;this._glassPane.setContentAnchorBox(anchor.boxInWindow());this._glassPane.show((this._glassPane.contentElement.ownerDocument));this._listControl.element.focus();this._listControl.selectItem(currentModel);return new Promise(fulfill=>this._selectionDone=fulfill);}
_onMouseMove(event){const node=event.target.enclosingNodeOrSelfWithClass('preview-item');const listItem=node&&this._listControl.itemForNode(node);if(!listItem)
return;this._listControl.selectItem(listItem);}
_onClick(event){if(!event.target.enclosingNodeOrSelfWithClass('preview-item'))
return;this._close(this._listControl.selectedItem());}
_onKeyDown(event){switch(event.key){case'Escape':this._close(null);break;case'Enter':this._close(this._listControl.selectedItem());break;default:return;}
event.consume(true);}
_close(model){this._selectionDone(model);this._focusRestorer.restore();this._glassPane.hide();Timeline.TimelineHistoryManager.DropDown._instance=null;}
createElementForItem(item){const element=Timeline.TimelineHistoryManager._previewElement(item);UI.ARIAUtils.markAsMenuItem(element);element.classList.remove('selected');return element;}
heightForItem(item){console.assert(false,'Should not be called');return 0;}
isItemSelectable(item){return true;}
selectedItemChanged(from,to,fromElement,toElement){if(fromElement)
fromElement.classList.remove('selected');if(toElement)
toElement.classList.add('selected');}
updateSelectedItemARIA(fromElement,toElement){return false;}};Timeline.TimelineHistoryManager.DropDown._instance=null;Timeline.TimelineHistoryManager.ToolbarButton=class extends UI.ToolbarItem{constructor(action){super(createElementWithClass('button','history-dropdown-button'));UI.appendStyle(this.element,'timeline/historyToolbarButton.css');this._contentElement=this.element.createChild('span','content');const dropdownArrowIcon=UI.Icon.create('smallicon-triangle-down');this.element.appendChild(dropdownArrowIcon);this.element.addEventListener('click',()=>void action.execute(),false);this.setEnabled(action.enabled());action.addEventListener(UI.Action.Events.Enabled,event=>this.setEnabled((event.data)));this.setTitle(action.title());}
setText(text){this._contentElement.textContent=text;}};;Timeline.TimelineTreeView=class extends UI.VBox{constructor(){super();this._model=null;this._track=null;this._tree=null;this.textFilterUI;this.element.classList.add('timeline-tree-view');}
static eventNameForSorting(event){if(event.name===TimelineModel.TimelineModel.RecordType.JSFrame){const data=event.args['data'];return data['functionName']+'@'+(data['scriptId']||data['url']||'');}
return event.name+':@'+TimelineModel.TimelineProfileTree.eventURL(event);}
setSearchableView(searchableView){this._searchableView=searchableView;}
setModel(model,track){this._model=model;this._track=track;this.refreshTree();}
model(){return this._model;}
init(){this._linkifier=new Components.Linkifier();this._taskFilter=new TimelineModel.ExclusiveNameFilter([TimelineModel.TimelineModel.RecordType.Task]);this._textFilter=new Timeline.TimelineFilters.RegExp();this._currentThreadSetting=Common.settings.createSetting('timelineTreeCurrentThread',0);this._currentThreadSetting.addChangeListener(this.refreshTree,this);const columns=([]);this.populateColumns(columns);this._splitWidget=new UI.SplitWidget(true,true,'timelineTreeViewDetailsSplitWidget');const mainView=new UI.VBox();const toolbar=new UI.Toolbar('',mainView.element);this.populateToolbar(toolbar);this._dataGrid=new DataGrid.SortableDataGrid(columns);this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SortingChanged,this._sortingChanged,this);this._dataGrid.element.addEventListener('mousemove',this._onMouseMove.bind(this),true);this._dataGrid.setResizeMethod(DataGrid.DataGrid.ResizeMethod.Last);this._dataGrid.setRowContextMenuCallback(this._onContextMenu.bind(this));this._dataGrid.asWidget().show(mainView.element);this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SelectedNode,this._updateDetailsForSelection,this);this._detailsView=new UI.VBox();this._detailsView.element.classList.add('timeline-details-view','timeline-details-view-body');this._splitWidget.setMainWidget(mainView);this._splitWidget.setSidebarWidget(this._detailsView);this._splitWidget.hideSidebar();this._splitWidget.show(this.element);this._splitWidget.addEventListener(UI.SplitWidget.Events.ShowModeChanged,this._onShowModeChanged,this);this._lastSelectedNode;}
lastSelectedNode(){return this._lastSelectedNode;}
updateContents(selection){this.setRange(selection.startTime(),selection.endTime());}
setRange(startTime,endTime){this._startTime=startTime;this._endTime=endTime;this.refreshTree();}
filters(){return[this._taskFilter,this._textFilter,...this._model.filters()];}
filtersWithoutTextFilter(){return[this._taskFilter,...this._model.filters()];}
textFilter(){return this._textFilter;}
_exposePercentages(){return false;}
populateToolbar(toolbar){this.textFilterUI=new UI.ToolbarInput(Common.UIString('Filter'));this.textFilterUI.addEventListener(UI.ToolbarInput.Event.TextChanged,textFilterChanged,this);toolbar.appendToolbarItem(this.textFilterUI);function textFilterChanged(){const searchQuery=this.textFilterUI.value();this._textFilter.setRegExp(searchQuery?createPlainTextSearchRegex(searchQuery,'i'):null);this.refreshTree();}}
_modelEvents(){return this._track?this._track.syncEvents():[];}
_onHover(node){}
_appendContextMenuItems(contextMenu,node){}
_linkifyLocation(event){const target=this._model.timelineModel().targetByEvent(event);if(!target)
return null;const frame=TimelineModel.TimelineProfileTree.eventStackFrame(event);if(!frame)
return null;return this._linkifier.maybeLinkifyConsoleCallFrame(target,frame);}
selectProfileNode(treeNode,suppressSelectedEvent){const pathToRoot=[];for(let node=treeNode;node;node=node.parent)
pathToRoot.push(node);for(let i=pathToRoot.length-1;i>0;--i){const gridNode=this.dataGridNodeForTreeNode(pathToRoot[i]);if(gridNode&&gridNode.dataGrid)
gridNode.expand();}
const gridNode=this.dataGridNodeForTreeNode(treeNode);if(gridNode.dataGrid){gridNode.reveal();gridNode.select(suppressSelectedEvent);}}
refreshTree(){this._linkifier.reset();this._dataGrid.rootNode().removeChildren();if(!this._model){this._updateDetailsForSelection();return;}
this._root=this._buildTree();const children=this._root.children();let maxSelfTime=0;let maxTotalTime=0;const totalUsedTime=this._root.totalTime-this._root.selfTime;for(const child of children.values()){maxSelfTime=Math.max(maxSelfTime,child.selfTime);maxTotalTime=Math.max(maxTotalTime,child.totalTime);}
for(const child of children.values()){const gridNode=new Timeline.TimelineTreeView.TreeGridNode(child,totalUsedTime,maxSelfTime,maxTotalTime,this);this._dataGrid.insertChild(gridNode);}
this._sortingChanged();this._updateDetailsForSelection();if(this._searchableView)
this._searchableView.refreshSearch();}
_buildTree(){throw new Error('Not Implemented');}
buildTopDownTree(doNotAggregate,groupIdCallback){return new TimelineModel.TimelineProfileTree.TopDownRootNode(this._modelEvents(),this.filters(),this._startTime,this._endTime,doNotAggregate,groupIdCallback);}
populateColumns(columns){columns.push({id:'self',title:Common.UIString('Self Time'),width:'120px',fixedWidth:true,sortable:true});columns.push({id:'total',title:Common.UIString('Total Time'),width:'120px',fixedWidth:true,sortable:true});columns.push({id:'activity',title:Common.UIString('Activity'),disclosure:true,sortable:true});}
_sortingChanged(){const columnId=this._dataGrid.sortColumnId();if(!columnId)
return;let sortFunction;switch(columnId){case'startTime':sortFunction=compareStartTime;break;case'self':sortFunction=compareNumericField.bind(null,'selfTime');break;case'total':sortFunction=compareNumericField.bind(null,'totalTime');break;case'activity':sortFunction=compareName;break;default:console.assert(false,'Unknown sort field: '+columnId);return;}
this._dataGrid.sortNodes(sortFunction,!this._dataGrid.isSortOrderAscending());function compareNumericField(field,a,b){const nodeA=(a);const nodeB=(b);return nodeA._profileNode[field]-nodeB._profileNode[field];}
function compareStartTime(a,b){const nodeA=(a);const nodeB=(b);return nodeA._profileNode.event.startTime-nodeB._profileNode.event.startTime;}
function compareName(a,b){const nodeA=(a);const nodeB=(b);const nameA=Timeline.TimelineTreeView.eventNameForSorting(nodeA._profileNode.event);const nameB=Timeline.TimelineTreeView.eventNameForSorting(nodeB._profileNode.event);return nameA.localeCompare(nameB);}}
_onShowModeChanged(){if(this._splitWidget.showMode()===UI.SplitWidget.ShowMode.OnlyMain)
return;this._lastSelectedNode=undefined;this._updateDetailsForSelection();}
_updateDetailsForSelection(){const selectedNode=this._dataGrid.selectedNode?(this._dataGrid.selectedNode)._profileNode:null;if(selectedNode===this._lastSelectedNode)
return;this._lastSelectedNode=selectedNode;if(this._splitWidget.showMode()===UI.SplitWidget.ShowMode.OnlyMain)
return;this._detailsView.detachChildWidgets();this._detailsView.element.removeChildren();if(selectedNode&&this._showDetailsForNode(selectedNode))
return;const banner=this._detailsView.element.createChild('div','full-widget-dimmed-banner');banner.createTextChild(Common.UIString('Select item for details.'));}
_showDetailsForNode(node){return false;}
_onMouseMove(event){const gridNode=event.target&&(event.target instanceof Node)?(this._dataGrid.dataGridNodeFromNode((event.target))):null;const profileNode=gridNode&&gridNode._profileNode;if(profileNode===this._lastHoveredProfileNode)
return;this._lastHoveredProfileNode=profileNode;this._onHover(profileNode);}
_onContextMenu(contextMenu,gridNode){const profileNode=gridNode._profileNode;if(!profileNode)
return;this._appendContextMenuItems(contextMenu,profileNode);}
dataGridNodeForTreeNode(treeNode){return treeNode[Timeline.TimelineTreeView.TreeGridNode._gridNodeSymbol]||null;}
searchCanceled(){this._searchResults=[];this._currentResult=0;}
performSearch(searchConfig,shouldJump,jumpBackwards){this._searchResults=[];this._currentResult=0;if(!this._root)
return;const searchRegex=searchConfig.toSearchRegex();this._searchResults=this._root.searchTree(event=>Timeline.TimelineUIUtils.testContentMatching(event,searchRegex));this._searchableView.updateSearchMatchesCount(this._searchResults.length);}
jumpToNextSearchResult(){if(!this._searchResults.length)
return;this.selectProfileNode(this._searchResults[this._currentResult],false);this._currentResult=mod(this._currentResult+1,this._searchResults.length);}
jumpToPreviousSearchResult(){if(!this._searchResults.length)
return;this.selectProfileNode(this._searchResults[this._currentResult],false);this._currentResult=mod(this._currentResult-1,this._searchResults.length);}
supportsCaseSensitiveSearch(){return true;}
supportsRegexSearch(){return true;}};Timeline.TimelineTreeView.GridNode=class extends DataGrid.SortableDataGridNode{constructor(profileNode,grandTotalTime,maxSelfTime,maxTotalTime,treeView){super(null,false);this._populated=false;this._profileNode=profileNode;this._treeView=treeView;this._grandTotalTime=grandTotalTime;this._maxSelfTime=maxSelfTime;this._maxTotalTime=maxTotalTime;}
createCell(columnId){if(columnId==='activity')
return this._createNameCell(columnId);return this._createValueCell(columnId)||super.createCell(columnId);}
_createNameCell(columnId){const cell=this.createTD(columnId);const container=cell.createChild('div','name-container');const iconContainer=container.createChild('div','activity-icon-container');const icon=iconContainer.createChild('div','activity-icon');const name=container.createChild('div','activity-name');const event=this._profileNode.event;if(this._profileNode.isGroupNode()){const treeView=(this._treeView);const info=treeView._displayInfoForGroupNode(this._profileNode);name.textContent=info.name;icon.style.backgroundColor=info.color;if(info.icon)
iconContainer.insertBefore(info.icon,icon);}else if(event){const data=event.args['data'];const deoptReason=data&&data['deoptReason'];if(deoptReason)
container.createChild('div','activity-warning').title=Common.UIString('Not optimized: %s',deoptReason);name.textContent=Timeline.TimelineUIUtils.eventTitle(event);const link=this._treeView._linkifyLocation(event);if(link)
container.createChild('div','activity-link').appendChild(link);icon.style.backgroundColor=Timeline.TimelineUIUtils.eventColor(event);}
return cell;}
_createValueCell(columnId){if(columnId!=='self'&&columnId!=='total'&&columnId!=='startTime')
return null;let showPercents=false;let value;let maxTime;switch(columnId){case'startTime':value=this._profileNode.event.startTime-this._treeView._model.timelineModel().minimumRecordTime();break;case'self':value=this._profileNode.selfTime;maxTime=this._maxSelfTime;showPercents=true;break;case'total':value=this._profileNode.totalTime;maxTime=this._maxTotalTime;showPercents=true;break;default:return null;}
const cell=this.createTD(columnId);cell.className='numeric-column';const textDiv=cell.createChild('div');textDiv.createChild('span').textContent=Common.UIString('%.1f\xa0ms',value);if(showPercents&&this._treeView._exposePercentages()){textDiv.createChild('span','percent-column').textContent=Common.UIString('%.1f\xa0%%',value/this._grandTotalTime*100);}
if(maxTime){textDiv.classList.add('background-percent-bar');cell.createChild('div','background-bar-container').createChild('div','background-bar').style.width=(value*100/maxTime).toFixed(1)+'%';}
return cell;}};Timeline.TimelineTreeView.TreeGridNode=class extends Timeline.TimelineTreeView.GridNode{constructor(profileNode,grandTotalTime,maxSelfTime,maxTotalTime,treeView){super(profileNode,grandTotalTime,maxSelfTime,maxTotalTime,treeView);this.setHasChildren(this._profileNode.hasChildren());profileNode[Timeline.TimelineTreeView.TreeGridNode._gridNodeSymbol]=this;}
populate(){if(this._populated)
return;this._populated=true;if(!this._profileNode.children)
return;for(const node of this._profileNode.children().values()){const gridNode=new Timeline.TimelineTreeView.TreeGridNode(node,this._grandTotalTime,this._maxSelfTime,this._maxTotalTime,this._treeView);this.insertChildOrdered(gridNode);}}};Timeline.TimelineTreeView.TreeGridNode._gridNodeSymbol=Symbol('treeGridNode');Timeline.AggregatedTimelineTreeView=class extends Timeline.TimelineTreeView{constructor(){super();this._groupBySetting=Common.settings.createSetting('timelineTreeGroupBy',Timeline.AggregatedTimelineTreeView.GroupBy.None);this._groupBySetting.addChangeListener(this.refreshTree.bind(this));this.init();this._stackView=new Timeline.TimelineStackView(this);this._stackView.addEventListener(Timeline.TimelineStackView.Events.SelectionChanged,this._onStackViewSelectionChanged,this);this._badgePool=new ProductRegistry.BadgePool(true);this._productByURLCache=new Map();this._colorByURLCache=new Map();ProductRegistry.instance().then(registry=>{this._productRegistry=registry;this.refreshTree();});}
setModel(model,track){this._badgePool.reset();super.setModel(model,track);}
updateContents(selection){this._updateExtensionResolver();super.updateContents(selection);const rootNode=this._dataGrid.rootNode();if(rootNode.children.length)
rootNode.children[0].revealAndSelect();}
_updateExtensionResolver(){this._executionContextNamesByOrigin=new Map();for(const runtimeModel of SDK.targetManager.models(SDK.RuntimeModel)){for(const context of runtimeModel.executionContexts())
this._executionContextNamesByOrigin.set(context.origin,context.name);}}
_beautifyDomainName(name){if(Timeline.AggregatedTimelineTreeView._isExtensionInternalURL(name))
name=Common.UIString('[extensions overhead]');else if(Timeline.AggregatedTimelineTreeView._isV8NativeURL(name))
name=Common.UIString('[V8 Runtime]');else if(name.startsWith('chrome-extension'))
name=this._executionContextNamesByOrigin.get(name)||name;return name;}
_displayInfoForGroupNode(node){const categories=Timeline.TimelineUIUtils.categories();let color=node.id?Timeline.TimelineUIUtils.eventColor((node.event)):categories['other'].color;const unattributed=Common.UIString('[unattributed]');switch(this._groupBySetting.get()){case Timeline.AggregatedTimelineTreeView.GroupBy.Category:{const category=categories[node.id]||categories['other'];return{name:category.title,color:category.color};}
case Timeline.AggregatedTimelineTreeView.GroupBy.Domain:case Timeline.AggregatedTimelineTreeView.GroupBy.Subdomain:{let domainName=this._beautifyDomainName(node.id);if(domainName){const productName=this._productByEvent((node.event));if(productName)
domainName+=' \u2014 '+productName;}
return{name:domainName||unattributed,color:color};}
case Timeline.AggregatedTimelineTreeView.GroupBy.EventName:{const name=node.event.name===TimelineModel.TimelineModel.RecordType.JSFrame?Common.UIString('JavaScript'):Timeline.TimelineUIUtils.eventTitle(node.event);return{name:name,color:node.event.name===TimelineModel.TimelineModel.RecordType.JSFrame?Timeline.TimelineUIUtils.eventStyle(node.event).category.color:color};}
case Timeline.AggregatedTimelineTreeView.GroupBy.Product:{const event=(node.event);const info=this._productAndBadgeByEvent(event);const name=info&&info.name||unattributed;color=Timeline.TimelineUIUtils.eventColorByProduct(this._productRegistry,this._model.timelineModel(),this._colorByURLCache,event);return{name:name,color:color,icon:info&&info.badge||undefined};}
case Timeline.AggregatedTimelineTreeView.GroupBy.URL:break;case Timeline.AggregatedTimelineTreeView.GroupBy.Frame:{const frame=this._model.timelineModel().pageFrameById(node.id);const frameName=frame?Timeline.TimelineUIUtils.displayNameForFrame(frame,80):Common.UIString('Page');return{name:frameName,color:color};}
default:console.assert(false,'Unexpected grouping type');}
return{name:node.id||unattributed,color:color};}
populateToolbar(toolbar){super.populateToolbar(toolbar);const groupBy=Timeline.AggregatedTimelineTreeView.GroupBy;const options=[{label:Common.UIString('No Grouping'),value:groupBy.None},{label:Common.UIString('Group by Activity'),value:groupBy.EventName},{label:Common.UIString('Group by Category'),value:groupBy.Category},{label:Common.UIString('Group by Domain'),value:groupBy.Domain},{label:Common.UIString('Group by Frame'),value:groupBy.Frame},{label:Common.UIString('Group by Product'),value:groupBy.Product},{label:Common.UIString('Group by Subdomain'),value:groupBy.Subdomain},{label:Common.UIString('Group by URL'),value:groupBy.URL},];toolbar.appendToolbarItem(new UI.ToolbarSettingComboBox(options,this._groupBySetting));toolbar.appendSpacer();toolbar.appendToolbarItem(this._splitWidget.createShowHideSidebarButton(Common.UIString('heaviest stack')));}
_buildHeaviestStack(treeNode){console.assert(!!treeNode.parent,'Attempt to build stack for tree root');let result=[];for(let node=treeNode;node&&node.parent;node=node.parent)
result.push(node);result=result.reverse();for(let node=treeNode;node&&node.children()&&node.children().size;){const children=Array.from(node.children().values());node=children.reduce((a,b)=>a.totalTime>b.totalTime?a:b);result.push(node);}
return result;}
_exposePercentages(){return true;}
_onStackViewSelectionChanged(){const treeNode=this._stackView.selectedTreeNode();if(treeNode)
this.selectProfileNode(treeNode,true);}
_showDetailsForNode(node){const stack=this._buildHeaviestStack(node);this._stackView.setStack(stack,node);this._stackView.show(this._detailsView.element);return true;}
_groupingFunction(groupBy){const GroupBy=Timeline.AggregatedTimelineTreeView.GroupBy;switch(groupBy){case GroupBy.None:return null;case GroupBy.EventName:return event=>Timeline.TimelineUIUtils.eventStyle(event).title;case GroupBy.Category:return event=>Timeline.TimelineUIUtils.eventStyle(event).category.name;case GroupBy.Subdomain:return this._domainByEvent.bind(this,false);case GroupBy.Domain:return this._domainByEvent.bind(this,true);case GroupBy.Product:return event=>this._productByEvent(event)||this._domainByEvent(true,event)||'';case GroupBy.URL:return event=>TimelineModel.TimelineProfileTree.eventURL(event)||'';case GroupBy.Frame:return event=>TimelineModel.TimelineData.forEvent(event).frameId;default:console.assert(false,`Unexpected aggregation setting: ${groupBy}`);return null;}}
_domainByEvent(groupSubdomains,event){const url=TimelineModel.TimelineProfileTree.eventURL(event);if(!url)
return'';if(Timeline.AggregatedTimelineTreeView._isExtensionInternalURL(url))
return Timeline.AggregatedTimelineTreeView._extensionInternalPrefix;if(Timeline.AggregatedTimelineTreeView._isV8NativeURL(url))
return Timeline.AggregatedTimelineTreeView._v8NativePrefix;const parsedURL=url.asParsedURL();if(!parsedURL)
return'';if(parsedURL.scheme==='chrome-extension')
return parsedURL.scheme+'://'+parsedURL.host;if(!groupSubdomains)
return parsedURL.host;if(/^[.0-9]+$/.test(parsedURL.host))
return parsedURL.host;const domainMatch=/([^.]*\.)?[^.]*$/.exec(parsedURL.host);return domainMatch&&domainMatch[0]||'';}
_productByEvent(event){const url=TimelineModel.TimelineProfileTree.eventURL(event);if(!url)
return'';if(this._productByURLCache.has(url))
return this._productByURLCache.get(url);if(!this._productRegistry)
return'';const parsedURL=url.asParsedURL();const name=parsedURL&&this._productRegistry.nameForUrl(parsedURL)||'';this._productByURLCache.set(url,name);return name;}
_productAndBadgeByEvent(event){const url=TimelineModel.TimelineProfileTree.eventURL(event);if(!url||!this._productRegistry)
return null;const parsedURL=url.asParsedURL();const name=parsedURL&&this._productRegistry.nameForUrl(parsedURL)||this._domainByEvent(true,event);if(!name)
return null;const icon=parsedURL&&this._badgePool.badgeForURL(parsedURL);return{name:this._beautifyDomainName(name),badge:icon};}
_appendContextMenuItems(contextMenu,node){if(this._groupBySetting.get()!==Timeline.AggregatedTimelineTreeView.GroupBy.Frame)
return;if(!node.isGroupNode())
return;const frame=this._model.timelineModel().pageFrameById(node.id);if(!frame||!frame.ownerNode)
return;contextMenu.appendApplicableItems(frame.ownerNode);}
static _isExtensionInternalURL(url){return url.startsWith(Timeline.AggregatedTimelineTreeView._extensionInternalPrefix);}
static _isV8NativeURL(url){return url.startsWith(Timeline.AggregatedTimelineTreeView._v8NativePrefix);}};Timeline.AggregatedTimelineTreeView._extensionInternalPrefix='extensions::';Timeline.AggregatedTimelineTreeView._v8NativePrefix='native ';Timeline.AggregatedTimelineTreeView.GroupBy={None:'None',EventName:'EventName',Category:'Category',Domain:'Domain',Subdomain:'Subdomain',Product:'Product',URL:'URL',Frame:'Frame'};Timeline.CallTreeTimelineTreeView=class extends Timeline.AggregatedTimelineTreeView{constructor(){super();this._dataGrid.markColumnAsSortedBy('total',DataGrid.DataGrid.Order.Descending);this.textFilterUI.setPlaceholder(ls`Filter`,ls`Filter call tree`);}
_buildTree(){const grouping=this._groupBySetting.get();return this.buildTopDownTree(false,this._groupingFunction(grouping));}};Timeline.BottomUpTimelineTreeView=class extends Timeline.AggregatedTimelineTreeView{constructor(){super();this._dataGrid.markColumnAsSortedBy('self',DataGrid.DataGrid.Order.Descending);this.textFilterUI.setPlaceholder(ls`Filter`,ls`Filter bottom-up`);}
_buildTree(){return new TimelineModel.TimelineProfileTree.BottomUpRootNode(this._modelEvents(),this.textFilter(),this.filtersWithoutTextFilter(),this._startTime,this._endTime,this._groupingFunction(this._groupBySetting.get()));}};Timeline.TimelineStackView=class extends UI.VBox{constructor(treeView){super();const header=this.element.createChild('div','timeline-stack-view-header');header.textContent=Common.UIString('Heaviest stack');this._treeView=treeView;const columns=([{id:'total',title:Common.UIString('Total Time'),fixedWidth:true,width:'110px'},{id:'activity',title:Common.UIString('Activity')}]);this._dataGrid=new DataGrid.ViewportDataGrid(columns);this._dataGrid.setResizeMethod(DataGrid.DataGrid.ResizeMethod.Last);this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SelectedNode,this._onSelectionChanged,this);this._dataGrid.asWidget().show(this.element);}
setStack(stack,selectedNode){const rootNode=this._dataGrid.rootNode();rootNode.removeChildren();let nodeToReveal=null;const totalTime=Math.max.apply(Math,stack.map(node=>node.totalTime));for(const node of stack){const gridNode=new Timeline.TimelineTreeView.GridNode(node,totalTime,totalTime,totalTime,this._treeView);rootNode.appendChild(gridNode);if(node===selectedNode)
nodeToReveal=gridNode;}
nodeToReveal.revealAndSelect();}
selectedTreeNode(){const selectedNode=this._dataGrid.selectedNode;return selectedNode&&(selectedNode)._profileNode;}
_onSelectionChanged(){this.dispatchEventToListeners(Timeline.TimelineStackView.Events.SelectionChanged);}};Timeline.TimelineStackView.Events={SelectionChanged:Symbol('SelectionChanged')};;Timeline.EventsTimelineTreeView=class extends Timeline.TimelineTreeView{constructor(delegate){super();this._filtersControl=new Timeline.EventsTimelineTreeView.Filters();this._filtersControl.addEventListener(Timeline.EventsTimelineTreeView.Filters.Events.FilterChanged,this._onFilterChanged,this);this.init();this._delegate=delegate;this._badgePool=new ProductRegistry.BadgePool(true);this._dataGrid.markColumnAsSortedBy('startTime',DataGrid.DataGrid.Order.Ascending);this._splitWidget.showBoth();}
filters(){return[...super.filters(),...this._filtersControl.filters()];}
updateContents(selection){this._badgePool.reset();super.updateContents(selection);if(selection.type()===Timeline.TimelineSelection.Type.TraceEvent){const event=(selection.object());this._selectEvent(event,true);}}
_buildTree(){this._currentTree=this.buildTopDownTree(true,null);return this._currentTree;}
_onFilterChanged(){const selectedEvent=this.lastSelectedNode()&&this.lastSelectedNode().event;this.refreshTree();if(selectedEvent)
this._selectEvent(selectedEvent,false);}
_findNodeWithEvent(event){const iterators=[this._currentTree.children().values()];while(iterators.length){const iterator=iterators.peekLast().next();if(iterator.done){iterators.pop();continue;}
const child=(iterator.value);if(child.event===event)
return child;iterators.push(child.children().values());}
return null;}
_selectEvent(event,expand){const node=this._findNodeWithEvent(event);if(!node)
return;this.selectProfileNode(node,false);if(expand)
this.dataGridNodeForTreeNode(node).expand();}
populateColumns(columns){columns.push({id:'startTime',title:Common.UIString('Start Time'),width:'80px',fixedWidth:true,sortable:true});super.populateColumns(columns);columns.filter(c=>c.fixedWidth).forEach(c=>c.width='80px');}
populateToolbar(toolbar){super.populateToolbar(toolbar);this.textFilterUI.setPlaceholder(ls`Filter`,ls`Filter event log`);this._filtersControl.populateToolbar(toolbar);}
_showDetailsForNode(node){const traceEvent=node.event;if(!traceEvent)
return false;Timeline.TimelineUIUtils.buildTraceEventDetails(traceEvent,this.model().timelineModel(),this._linkifier,this._badgePool,false).then(fragment=>this._detailsView.element.appendChild(fragment));return true;}
_onHover(node){this._delegate.highlightEvent(node&&node.event);}};Timeline.EventsTimelineTreeView.Filters=class extends Common.Object{constructor(){super();this._categoryFilter=new Timeline.TimelineFilters.Category();this._durationFilter=new Timeline.TimelineFilters.IsLong();this._filters=[this._categoryFilter,this._durationFilter];}
filters(){return this._filters;}
populateToolbar(toolbar){const durationFilterUI=new UI.ToolbarComboBox(durationFilterChanged.bind(this));for(const durationMs of Timeline.EventsTimelineTreeView.Filters._durationFilterPresetsMs){durationFilterUI.addOption(durationFilterUI.createOption(durationMs?Common.UIString('\u2265 %d\xa0ms',durationMs):Common.UIString('All'),durationMs?Common.UIString('Hide records shorter than %d\xa0ms',durationMs):Common.UIString('Show all records'),String(durationMs)));}
UI.ARIAUtils.setAccessibleName(durationFilterUI.selectElement(),ls`Duration filter`);toolbar.appendToolbarItem(durationFilterUI);const categoryFiltersUI={};const categories=Timeline.TimelineUIUtils.categories();for(const categoryName in categories){const category=categories[categoryName];if(!category.visible)
continue;const checkbox=new UI.ToolbarCheckbox(category.title,undefined,categoriesFilterChanged.bind(this,categoryName));checkbox.setChecked(true);checkbox.inputElement.style.backgroundColor=category.color;categoryFiltersUI[category.name]=checkbox;toolbar.appendToolbarItem(checkbox);}
function durationFilterChanged(){const duration=durationFilterUI.selectedOption().value;const minimumRecordDuration=parseInt(duration,10);this._durationFilter.setMinimumRecordDuration(minimumRecordDuration);this._notifyFiltersChanged();}
function categoriesFilterChanged(name){const categories=Timeline.TimelineUIUtils.categories();categories[name].hidden=!categoryFiltersUI[name].checked();this._notifyFiltersChanged();}}
_notifyFiltersChanged(){this.dispatchEventToListeners(Timeline.EventsTimelineTreeView.Filters.Events.FilterChanged);}};Timeline.EventsTimelineTreeView.Filters._durationFilterPresetsMs=[0,1,15];Timeline.EventsTimelineTreeView.Filters.Events={FilterChanged:Symbol('FilterChanged')};;Timeline.TimelineUIUtils=class{static _initEventStyles(){if(Timeline.TimelineUIUtils._eventStylesMap)
return Timeline.TimelineUIUtils._eventStylesMap;const type=TimelineModel.TimelineModel.RecordType;const categories=Timeline.TimelineUIUtils.categories();const rendering=categories['rendering'];const scripting=categories['scripting'];const loading=categories['loading'];const painting=categories['painting'];const other=categories['other'];const eventStyles={};eventStyles[type.Task]=new Timeline.TimelineRecordStyle(ls`Task`,other);eventStyles[type.Program]=new Timeline.TimelineRecordStyle(ls`Other`,other);eventStyles[type.Animation]=new Timeline.TimelineRecordStyle(ls`Animation`,rendering);eventStyles[type.EventDispatch]=new Timeline.TimelineRecordStyle(ls`Event`,scripting);eventStyles[type.RequestMainThreadFrame]=new Timeline.TimelineRecordStyle(ls`Request Main Thread Frame`,rendering,true);eventStyles[type.BeginFrame]=new Timeline.TimelineRecordStyle(ls`Frame Start`,rendering,true);eventStyles[type.BeginMainThreadFrame]=new Timeline.TimelineRecordStyle(ls`Frame Start (main thread)`,rendering,true);eventStyles[type.DrawFrame]=new Timeline.TimelineRecordStyle(ls`Draw Frame`,rendering,true);eventStyles[type.HitTest]=new Timeline.TimelineRecordStyle(ls`Hit Test`,rendering);eventStyles[type.ScheduleStyleRecalculation]=new Timeline.TimelineRecordStyle(ls`Schedule Style Recalculation`,rendering);eventStyles[type.RecalculateStyles]=new Timeline.TimelineRecordStyle(ls`Recalculate Style`,rendering);eventStyles[type.UpdateLayoutTree]=new Timeline.TimelineRecordStyle(ls`Recalculate Style`,rendering);eventStyles[type.InvalidateLayout]=new Timeline.TimelineRecordStyle(ls`Invalidate Layout`,rendering,true);eventStyles[type.Layout]=new Timeline.TimelineRecordStyle(ls`Layout`,rendering);eventStyles[type.PaintSetup]=new Timeline.TimelineRecordStyle(ls`Paint Setup`,painting);eventStyles[type.PaintImage]=new Timeline.TimelineRecordStyle(ls`Paint Image`,painting,true);eventStyles[type.UpdateLayer]=new Timeline.TimelineRecordStyle(ls`Update Layer`,painting,true);eventStyles[type.UpdateLayerTree]=new Timeline.TimelineRecordStyle(ls`Update Layer Tree`,rendering);eventStyles[type.Paint]=new Timeline.TimelineRecordStyle(ls`Paint`,painting);eventStyles[type.RasterTask]=new Timeline.TimelineRecordStyle(ls`Rasterize Paint`,painting);eventStyles[type.ScrollLayer]=new Timeline.TimelineRecordStyle(ls`Scroll`,rendering);eventStyles[type.CompositeLayers]=new Timeline.TimelineRecordStyle(ls`Composite Layers`,painting);eventStyles[type.ParseHTML]=new Timeline.TimelineRecordStyle(ls`Parse HTML`,loading);eventStyles[type.ParseAuthorStyleSheet]=new Timeline.TimelineRecordStyle(ls`Parse Stylesheet`,loading);eventStyles[type.TimerInstall]=new Timeline.TimelineRecordStyle(ls`Install Timer`,scripting);eventStyles[type.TimerRemove]=new Timeline.TimelineRecordStyle(ls`Remove Timer`,scripting);eventStyles[type.TimerFire]=new Timeline.TimelineRecordStyle(ls`Timer Fired`,scripting);eventStyles[type.XHRReadyStateChange]=new Timeline.TimelineRecordStyle(ls`XHR Ready State Change`,scripting);eventStyles[type.XHRLoad]=new Timeline.TimelineRecordStyle(ls`XHR Load`,scripting);eventStyles[type.CompileScript]=new Timeline.TimelineRecordStyle(ls`Compile Script`,scripting);eventStyles[type.EvaluateScript]=new Timeline.TimelineRecordStyle(ls`Evaluate Script`,scripting);eventStyles[type.CompileModule]=new Timeline.TimelineRecordStyle(ls`Compile Module`,scripting);eventStyles[type.EvaluateModule]=new Timeline.TimelineRecordStyle(ls`Evaluate Module`,scripting);eventStyles[type.ParseScriptOnBackground]=new Timeline.TimelineRecordStyle(ls`Parse Script`,scripting);eventStyles[type.WasmStreamFromResponseCallback]=new Timeline.TimelineRecordStyle(ls`Streaming Wasm Response`,scripting);eventStyles[type.WasmCompiledModule]=new Timeline.TimelineRecordStyle(ls`Compiled Wasm Module`,scripting);eventStyles[type.WasmCachedModule]=new Timeline.TimelineRecordStyle(ls`Cached Wasm Module`,scripting);eventStyles[type.WasmModuleCacheHit]=new Timeline.TimelineRecordStyle(ls`Wasm Module Cache Hit`,scripting);eventStyles[type.WasmModuleCacheInvalid]=new Timeline.TimelineRecordStyle(ls`Wasm Module Cache Invalid`,scripting);eventStyles[type.FrameStartedLoading]=new Timeline.TimelineRecordStyle(ls`Frame Started Loading`,loading,true);eventStyles[type.MarkLoad]=new Timeline.TimelineRecordStyle(ls`Onload Event`,scripting,true);eventStyles[type.MarkDOMContent]=new Timeline.TimelineRecordStyle(ls`DOMContentLoaded Event`,scripting,true);eventStyles[type.MarkFirstPaint]=new Timeline.TimelineRecordStyle(ls`First Paint`,painting,true);eventStyles[type.MarkFCP]=new Timeline.TimelineRecordStyle(ls`First Contentful Paint`,rendering,true);eventStyles[type.MarkFMP]=new Timeline.TimelineRecordStyle(ls`First Meaningful Paint`,rendering,true);eventStyles[type.MarkLCPCandidate]=new Timeline.TimelineRecordStyle(ls`Largest Contentful Paint`,rendering,true);eventStyles[type.TimeStamp]=new Timeline.TimelineRecordStyle(ls`Timestamp`,scripting);eventStyles[type.ConsoleTime]=new Timeline.TimelineRecordStyle(ls`Console Time`,scripting);eventStyles[type.UserTiming]=new Timeline.TimelineRecordStyle(ls`User Timing`,scripting);eventStyles[type.ResourceSendRequest]=new Timeline.TimelineRecordStyle(ls`Send Request`,loading);eventStyles[type.ResourceReceiveResponse]=new Timeline.TimelineRecordStyle(ls`Receive Response`,loading);eventStyles[type.ResourceFinish]=new Timeline.TimelineRecordStyle(ls`Finish Loading`,loading);eventStyles[type.ResourceReceivedData]=new Timeline.TimelineRecordStyle(ls`Receive Data`,loading);eventStyles[type.RunMicrotasks]=new Timeline.TimelineRecordStyle(ls`Run Microtasks`,scripting);eventStyles[type.FunctionCall]=new Timeline.TimelineRecordStyle(ls`Function Call`,scripting);eventStyles[type.GCEvent]=new Timeline.TimelineRecordStyle(ls`GC Event`,scripting);eventStyles[type.MajorGC]=new Timeline.TimelineRecordStyle(ls`Major GC`,scripting);eventStyles[type.MinorGC]=new Timeline.TimelineRecordStyle(ls`Minor GC`,scripting);eventStyles[type.JSFrame]=new Timeline.TimelineRecordStyle(ls`JS Frame`,scripting);eventStyles[type.RequestAnimationFrame]=new Timeline.TimelineRecordStyle(ls`Request Animation Frame`,scripting);eventStyles[type.CancelAnimationFrame]=new Timeline.TimelineRecordStyle(ls`Cancel Animation Frame`,scripting);eventStyles[type.FireAnimationFrame]=new Timeline.TimelineRecordStyle(ls`Animation Frame Fired`,scripting);eventStyles[type.RequestIdleCallback]=new Timeline.TimelineRecordStyle(ls`Request Idle Callback`,scripting);eventStyles[type.CancelIdleCallback]=new Timeline.TimelineRecordStyle(ls`Cancel Idle Callback`,scripting);eventStyles[type.FireIdleCallback]=new Timeline.TimelineRecordStyle(ls`Fire Idle Callback`,scripting);eventStyles[type.WebSocketCreate]=new Timeline.TimelineRecordStyle(ls`Create WebSocket`,scripting);eventStyles[type.WebSocketSendHandshakeRequest]=new Timeline.TimelineRecordStyle(ls`Send WebSocket Handshake`,scripting);eventStyles[type.WebSocketReceiveHandshakeResponse]=new Timeline.TimelineRecordStyle(ls`Receive WebSocket Handshake`,scripting);eventStyles[type.WebSocketDestroy]=new Timeline.TimelineRecordStyle(ls`Destroy WebSocket`,scripting);eventStyles[type.EmbedderCallback]=new Timeline.TimelineRecordStyle(ls`Embedder Callback`,scripting);eventStyles[type.DecodeImage]=new Timeline.TimelineRecordStyle(ls`Image Decode`,painting);eventStyles[type.ResizeImage]=new Timeline.TimelineRecordStyle(ls`Image Resize`,painting);eventStyles[type.GPUTask]=new Timeline.TimelineRecordStyle(ls`GPU`,categories['gpu']);eventStyles[type.LatencyInfo]=new Timeline.TimelineRecordStyle(ls`Input Latency`,scripting);eventStyles[type.GCCollectGarbage]=new Timeline.TimelineRecordStyle(ls`DOM GC`,scripting);eventStyles[type.CryptoDoEncrypt]=new Timeline.TimelineRecordStyle(ls`Encrypt`,scripting);eventStyles[type.CryptoDoEncryptReply]=new Timeline.TimelineRecordStyle(ls`Encrypt Reply`,scripting);eventStyles[type.CryptoDoDecrypt]=new Timeline.TimelineRecordStyle(ls`Decrypt`,scripting);eventStyles[type.CryptoDoDecryptReply]=new Timeline.TimelineRecordStyle(ls`Decrypt Reply`,scripting);eventStyles[type.CryptoDoDigest]=new Timeline.TimelineRecordStyle(ls`Digest`,scripting);eventStyles[type.CryptoDoDigestReply]=new Timeline.TimelineRecordStyle(ls`Digest Reply`,scripting);eventStyles[type.CryptoDoSign]=new Timeline.TimelineRecordStyle(ls`Sign`,scripting);eventStyles[type.CryptoDoSignReply]=new Timeline.TimelineRecordStyle(ls`Sign Reply`,scripting);eventStyles[type.CryptoDoVerify]=new Timeline.TimelineRecordStyle(ls`Verify`,scripting);eventStyles[type.CryptoDoVerifyReply]=new Timeline.TimelineRecordStyle(ls`Verify Reply`,scripting);eventStyles[type.AsyncTask]=new Timeline.TimelineRecordStyle(ls`Async Task`,categories['async']);Timeline.TimelineUIUtils._eventStylesMap=eventStyles;return eventStyles;}
static inputEventDisplayName(inputEventType){if(!Timeline.TimelineUIUtils._inputEventToDisplayName){const inputEvent=TimelineModel.TimelineIRModel.InputEvents;Timeline.TimelineUIUtils._inputEventToDisplayName=new Map([[inputEvent.Char,ls`Key Character`],[inputEvent.KeyDown,ls`Key Down`],[inputEvent.KeyDownRaw,ls`Key Down`],[inputEvent.KeyUp,ls`Key Up`],[inputEvent.Click,ls`Click`],[inputEvent.ContextMenu,ls`Context Menu`],[inputEvent.MouseDown,ls`Mouse Down`],[inputEvent.MouseMove,ls`Mouse Move`],[inputEvent.MouseUp,ls`Mouse Up`],[inputEvent.MouseWheel,ls`Mouse Wheel`],[inputEvent.ScrollBegin,ls`Scroll Begin`],[inputEvent.ScrollEnd,ls`Scroll End`],[inputEvent.ScrollUpdate,ls`Scroll Update`],[inputEvent.FlingStart,ls`Fling Start`],[inputEvent.FlingCancel,ls`Fling Halt`],[inputEvent.Tap,ls`Tap`],[inputEvent.TapCancel,ls`Tap Halt`],[inputEvent.ShowPress,ls`Tap Begin`],[inputEvent.TapDown,ls`Tap Down`],[inputEvent.TouchCancel,ls`Touch Cancel`],[inputEvent.TouchEnd,ls`Touch End`],[inputEvent.TouchMove,ls`Touch Move`],[inputEvent.TouchStart,ls`Touch Start`],[inputEvent.PinchBegin,ls`Pinch Begin`],[inputEvent.PinchEnd,ls`Pinch End`],[inputEvent.PinchUpdate,ls`Pinch Update`]]);}
return Timeline.TimelineUIUtils._inputEventToDisplayName.get(inputEventType)||null;}
static frameDisplayName(frame){if(!TimelineModel.TimelineJSProfileProcessor.isNativeRuntimeFrame(frame))
return UI.beautifyFunctionName(frame.functionName);const nativeGroup=TimelineModel.TimelineJSProfileProcessor.nativeGroup(frame.functionName);const groups=TimelineModel.TimelineJSProfileProcessor.NativeGroups;switch(nativeGroup){case groups.Compile:return ls`Compile`;case groups.Parse:return ls`Parse`;}
return frame.functionName;}
static testContentMatching(traceEvent,regExp){const title=Timeline.TimelineUIUtils.eventStyle(traceEvent).title;const tokens=[title];const url=TimelineModel.TimelineData.forEvent(traceEvent).url;if(url)
tokens.push(url);appendObjectProperties(traceEvent.args,2);return regExp.test(tokens.join('|'));function appendObjectProperties(object,depth){if(!depth)
return;for(const key in object){const value=object[key];const type=typeof value;if(type==='string')
tokens.push(value);else if(type==='number')
tokens.push(String(value));else if(type==='object')
appendObjectProperties(value,depth-1);}}}
static eventURL(event){const data=event.args['data']||event.args['beginData'];const url=data&&data.url;if(url)
return url;const stackTrace=data&&data['stackTrace'];const frame=stackTrace&&stackTrace.length&&stackTrace[0]||TimelineModel.TimelineData.forEvent(event).topFrame();return frame&&frame.url||null;}
static eventStyle(event){const eventStyles=Timeline.TimelineUIUtils._initEventStyles();if(event.hasCategory(TimelineModel.TimelineModel.Category.Console)||event.hasCategory(TimelineModel.TimelineModel.Category.UserTiming))
return{title:event.name,category:Timeline.TimelineUIUtils.categories()['scripting']};if(event.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)){const prefix='InputLatency::';const inputEventType=event.name.startsWith(prefix)?event.name.substr(prefix.length):event.name;const displayName=Timeline.TimelineUIUtils.inputEventDisplayName((inputEventType));return{title:displayName||inputEventType,category:Timeline.TimelineUIUtils.categories()['scripting']};}
let result=eventStyles[event.name];if(!result){result=new Timeline.TimelineRecordStyle(event.name,Timeline.TimelineUIUtils.categories()['other'],true);eventStyles[event.name]=result;}
return result;}
static eventColor(event){if(event.name===TimelineModel.TimelineModel.RecordType.JSFrame){const frame=event.args['data'];if(Timeline.TimelineUIUtils.isUserFrame(frame))
return Timeline.TimelineUIUtils.colorForId(frame.url);}
return Timeline.TimelineUIUtils.eventStyle(event).category.color;}
static eventColorByProduct(productRegistry,model,urlToColorCache,event){const url=Timeline.TimelineUIUtils.eventURL(event)||'';let color=urlToColorCache.get(url);if(color)
return color;const defaultColor='#f2ecdc';const parsedURL=url.asParsedURL();if(!parsedURL)
return defaultColor;let name=productRegistry&&productRegistry.nameForUrl(parsedURL);if(!name){name=parsedURL.host;const rootFrames=model.rootFrames();if(rootFrames.some(pageFrame=>new Common.ParsedURL(pageFrame.url).host===name))
color=defaultColor;}
if(!color)
color=name?ProductRegistry.BadgePool.colorForEntryName(name):defaultColor;urlToColorCache.set(url,color);return color;}
static eventTitle(event){const recordType=TimelineModel.TimelineModel.RecordType;const eventData=event.args['data'];if(event.name===recordType.JSFrame)
return Timeline.TimelineUIUtils.frameDisplayName(eventData);const title=Timeline.TimelineUIUtils.eventStyle(event).title;if(event.hasCategory(TimelineModel.TimelineModel.Category.Console))
return title;if(event.name===recordType.TimeStamp)
return ls`${title}: ${eventData['message']}`;if(event.name===recordType.Animation&&eventData&&eventData['name'])
return ls`${title}: ${eventData['name']}`;if(event.name===recordType.EventDispatch&&eventData&&eventData['type'])
return ls`${title}: ${eventData['type']}`;return title;}
static _interactionPhaseStyles(){let map=Timeline.TimelineUIUtils._interactionPhaseStylesMap;if(!map){map=new Map([[TimelineModel.TimelineIRModel.Phases.Idle,{color:'white',label:'Idle'}],[TimelineModel.TimelineIRModel.Phases.Response,{color:'hsl(43, 83%, 64%)',label:ls`Response`}],[TimelineModel.TimelineIRModel.Phases.Scroll,{color:'hsl(256, 67%, 70%)',label:ls`Scroll`}],[TimelineModel.TimelineIRModel.Phases.Fling,{color:'hsl(256, 67%, 70%)',label:ls`Fling`}],[TimelineModel.TimelineIRModel.Phases.Drag,{color:'hsl(256, 67%, 70%)',label:ls`Drag`}],[TimelineModel.TimelineIRModel.Phases.Animation,{color:'hsl(256, 67%, 70%)',label:ls`Animation`}],[TimelineModel.TimelineIRModel.Phases.Uncategorized,{color:'hsl(0, 0%, 87%)',label:ls`Uncategorized`}]]);Timeline.TimelineUIUtils._interactionPhaseStylesMap=map;}
return map;}
static interactionPhaseColor(phase){return Timeline.TimelineUIUtils._interactionPhaseStyles().get(phase).color;}
static interactionPhaseLabel(phase){return Timeline.TimelineUIUtils._interactionPhaseStyles().get(phase).label;}
static isUserFrame(frame){return frame.scriptId!=='0'&&!(frame.url&&frame.url.startsWith('native '));}
static networkRequestCategory(request){const categories=Timeline.TimelineUIUtils.NetworkCategory;switch(request.mimeType){case'text/html':return categories.HTML;case'application/javascript':case'application/x-javascript':case'text/javascript':return categories.Script;case'text/css':return categories.Style;case'audio/ogg':case'image/gif':case'image/jpeg':case'image/png':case'image/svg+xml':case'image/webp':case'image/x-icon':case'font/opentype':case'font/woff2':case'application/font-woff':return categories.Media;default:return categories.Other;}}
static networkCategoryColor(category){const categories=Timeline.TimelineUIUtils.NetworkCategory;switch(category){case categories.HTML:return'hsl(214, 67%, 66%)';case categories.Script:return'hsl(43, 83%, 64%)';case categories.Style:return'hsl(256, 67%, 70%)';case categories.Media:return'hsl(109, 33%, 55%)';default:return'hsl(0, 0%, 70%)';}}
static buildDetailsTextForTraceEvent(event,target){const recordType=TimelineModel.TimelineModel.RecordType;let detailsText;const eventData=event.args['data'];switch(event.name){case recordType.GCEvent:case recordType.MajorGC:case recordType.MinorGC:{const delta=event.args['usedHeapSizeBefore']-event.args['usedHeapSizeAfter'];detailsText=Common.UIString('%s collected',Number.bytesToString(delta));break;}
case recordType.FunctionCall:if(eventData){detailsText=linkifyLocationAsText(eventData['scriptId'],eventData['lineNumber'],eventData['columnNumber']);}
break;case recordType.JSFrame:detailsText=Timeline.TimelineUIUtils.frameDisplayName(eventData);break;case recordType.EventDispatch:detailsText=eventData?eventData['type']:null;break;case recordType.Paint:{const width=Timeline.TimelineUIUtils.quadWidth(eventData.clip);const height=Timeline.TimelineUIUtils.quadHeight(eventData.clip);if(width&&height)
detailsText=Common.UIString('%d\xa0\u00d7\xa0%d',width,height);break;}
case recordType.ParseHTML:{const startLine=event.args['beginData']['startLine'];const endLine=event.args['endData']&&event.args['endData']['endLine'];const url=Bindings.displayNameForURL(event.args['beginData']['url']);if(endLine>=0)
detailsText=Common.UIString('%s [%s\u2026%s]',url,startLine+1,endLine+1);else
detailsText=Common.UIString('%s [%s\u2026]',url,startLine+1);break;}
case recordType.CompileModule:detailsText=Bindings.displayNameForURL(event.args['fileName']);break;case recordType.CompileScript:case recordType.EvaluateScript:{const url=eventData&&eventData['url'];if(url)
detailsText=Bindings.displayNameForURL(url)+':'+(eventData['lineNumber']+1);break;}
case recordType.WasmCompiledModule:case recordType.WasmModuleCacheHit:{const url=event.args['url'];if(url)
detailsText=Bindings.displayNameForURL(url);break;}
case recordType.ParseScriptOnBackground:case recordType.XHRReadyStateChange:case recordType.XHRLoad:{const url=eventData['url'];if(url)
detailsText=Bindings.displayNameForURL(url);break;}
case recordType.TimeStamp:detailsText=eventData['message'];break;case recordType.WebSocketCreate:case recordType.WebSocketSendHandshakeRequest:case recordType.WebSocketReceiveHandshakeResponse:case recordType.WebSocketDestroy:case recordType.ResourceSendRequest:case recordType.ResourceReceivedData:case recordType.ResourceReceiveResponse:case recordType.ResourceFinish:case recordType.PaintImage:case recordType.DecodeImage:case recordType.ResizeImage:case recordType.DecodeLazyPixelRef:{const url=TimelineModel.TimelineData.forEvent(event).url;if(url)
detailsText=Bindings.displayNameForURL(url);break;}
case recordType.EmbedderCallback:detailsText=eventData['callbackName'];break;case recordType.Animation:detailsText=eventData&&eventData['name'];break;case recordType.AsyncTask:detailsText=eventData?eventData['name']:null;break;default:if(event.hasCategory(TimelineModel.TimelineModel.Category.Console))
detailsText=null;else
detailsText=linkifyTopCallFrameAsText();break;}
return detailsText;function linkifyLocationAsText(scriptId,lineNumber,columnNumber){const debuggerModel=target?target.model(SDK.DebuggerModel):null;if(!target||target.isDisposed()||!scriptId||!debuggerModel)
return null;const rawLocation=debuggerModel.createRawLocationByScriptId(scriptId,lineNumber,columnNumber);if(!rawLocation)
return null;const uiLocation=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(rawLocation);return uiLocation?uiLocation.linkText():null;}
function linkifyTopCallFrameAsText(){const frame=TimelineModel.TimelineData.forEvent(event).topFrame();if(!frame)
return null;let text=linkifyLocationAsText(frame.scriptId,frame.lineNumber,frame.columnNumber);if(!text){text=frame.url;if(typeof frame.lineNumber==='number')
text+=':'+(frame.lineNumber+1);}
return text;}}
static buildDetailsNodeForTraceEvent(event,target,linkifier){const recordType=TimelineModel.TimelineModel.RecordType;let details=null;let detailsText;const eventData=event.args['data'];switch(event.name){case recordType.GCEvent:case recordType.MajorGC:case recordType.MinorGC:case recordType.EventDispatch:case recordType.Paint:case recordType.Animation:case recordType.EmbedderCallback:case recordType.ParseHTML:case recordType.WasmStreamFromResponseCallback:case recordType.WasmCompiledModule:case recordType.WasmModuleCacheHit:case recordType.WasmCachedModule:case recordType.WasmModuleCacheInvalid:case recordType.WebSocketCreate:case recordType.WebSocketSendHandshakeRequest:case recordType.WebSocketReceiveHandshakeResponse:case recordType.WebSocketDestroy:detailsText=Timeline.TimelineUIUtils.buildDetailsTextForTraceEvent(event,target);break;case recordType.PaintImage:case recordType.DecodeImage:case recordType.ResizeImage:case recordType.DecodeLazyPixelRef:case recordType.XHRReadyStateChange:case recordType.XHRLoad:case recordType.ResourceSendRequest:case recordType.ResourceReceivedData:case recordType.ResourceReceiveResponse:case recordType.ResourceFinish:{const url=TimelineModel.TimelineData.forEvent(event).url;if(url)
details=Components.Linkifier.linkifyURL(url,{tabStop:true});break;}
case recordType.FunctionCall:case recordType.JSFrame:details=createElement('span');details.createTextChild(Timeline.TimelineUIUtils.frameDisplayName(eventData));const location=linkifyLocation(eventData['scriptId'],eventData['url'],eventData['lineNumber'],eventData['columnNumber']);if(location){details.createTextChild(' @ ');details.appendChild(location);}
break;case recordType.CompileModule:details=linkifyLocation('',event.args['fileName'],0,0);break;case recordType.CompileScript:case recordType.EvaluateScript:{const url=eventData['url'];if(url)
details=linkifyLocation('',url,eventData['lineNumber'],0);break;}
case recordType.ParseScriptOnBackground:{const url=eventData['url'];if(url)
details=linkifyLocation('',url,0,0);break;}
default:if(event.hasCategory(TimelineModel.TimelineModel.Category.Console))
detailsText=null;else
details=linkifyTopCallFrame();break;}
if(!details&&detailsText)
details=createTextNode(detailsText);return details;function linkifyLocation(scriptId,url,lineNumber,columnNumber){const options={columnNumber,className:'timeline-details',tabStop:true};return linkifier.linkifyScriptLocation(target,scriptId,url,lineNumber,options);}
function linkifyTopCallFrame(){const frame=TimelineModel.TimelineData.forEvent(event).topFrame();return frame?linkifier.maybeLinkifyConsoleCallFrame(target,frame,{className:'timeline-details',tabStop:true}):null;}}
static buildDetailsNodeForPerformanceEvent(event){let link='https://to-be-replaced.invalid';let name='page performance metrics';const recordType=TimelineModel.TimelineModel.RecordType;switch(event.name){case recordType.MarkLCPCandidate:link='https://web.dev/largest-contentful-paint';name='largest contentful paint';break;case recordType.MarkFCP:link='https://web.dev/first-contentful-paint';name='first contentful paint';break;case recordType.MarkFMP:link='https://web.dev/first-meaningful-paint/';name='first meaningful paint';break;default:break;}
return UI.html`<div>${UI.XLink.create(link, ls`Learn more`)} about ${name}.</div>`;}
static async buildTraceEventDetails(event,model,linkifier,badgePool,detailed){const maybeTarget=model.targetByEvent(event);let relatedNodesMap=null;if(maybeTarget){const target=(maybeTarget);if(typeof event[Timeline.TimelineUIUtils._previewElementSymbol]==='undefined'){let previewElement=null;const url=TimelineModel.TimelineData.forEvent(event).url;if(url){const parsedURL=new Common.ParsedURL(url);previewElement=await Components.ImagePreview.build(target,url,false,{imageAltText:`Image from ${parsedURL.displayName}`});}else if(TimelineModel.TimelineData.forEvent(event).picture){previewElement=await Timeline.TimelineUIUtils.buildPicturePreviewContent(event,target);}
event[Timeline.TimelineUIUtils._previewElementSymbol]=previewElement;}
const nodeIdsToResolve=new Set();const timelineData=TimelineModel.TimelineData.forEvent(event);if(timelineData.backendNodeId)
nodeIdsToResolve.add(timelineData.backendNodeId);const invalidationTrackingEvents=TimelineModel.InvalidationTracker.invalidationEventsFor(event);if(invalidationTrackingEvents)
Timeline.TimelineUIUtils._collectInvalidationNodeIds(nodeIdsToResolve,invalidationTrackingEvents);if(nodeIdsToResolve.size){const domModel=target.model(SDK.DOMModel);if(domModel)
relatedNodesMap=await domModel.pushNodesByBackendIdsToFrontend(nodeIdsToResolve);}}
const recordTypes=TimelineModel.TimelineModel.RecordType;let relatedNodeLabel;const contentHelper=new Timeline.TimelineDetailsContentHelper(model.targetByEvent(event),linkifier);const color=model.isMarkerEvent(event)?Timeline.TimelineUIUtils.markerStyleForEvent(event).color:Timeline.TimelineUIUtils.eventStyle(event).category.color;contentHelper.addSection(Timeline.TimelineUIUtils.eventTitle(event),color);const eventData=event.args['data'];const timelineData=TimelineModel.TimelineData.forEvent(event);const initiator=timelineData.initiator();let url=null;if(timelineData.warning)
contentHelper.appendWarningRow(event);if(event.name===recordTypes.JSFrame&&eventData['deoptReason'])
contentHelper.appendWarningRow(event,TimelineModel.TimelineModel.WarningType.V8Deopt);if(detailed&&!Number.isNaN(event.duration+0)){contentHelper.appendTextRow(ls`Total Time`,Number.millisToString(event.duration,true));contentHelper.appendTextRow(ls`Self Time`,Number.millisToString(event.selfTime,true));}
if(model.isGenericTrace()){for(const key in event.args){try{contentHelper.appendTextRow(key,JSON.stringify(event.args[key]));}catch(e){contentHelper.appendTextRow(key,`<${typeof event.args[key]}>`);}}
return contentHelper.fragment;}
switch(event.name){case recordTypes.GCEvent:case recordTypes.MajorGC:case recordTypes.MinorGC:const delta=event.args['usedHeapSizeBefore']-event.args['usedHeapSizeAfter'];contentHelper.appendTextRow(ls`Collected`,Number.bytesToString(delta));break;case recordTypes.JSFrame:case recordTypes.FunctionCall:const detailsNode=Timeline.TimelineUIUtils.buildDetailsNodeForTraceEvent(event,model.targetByEvent(event),linkifier);if(detailsNode)
contentHelper.appendElementRow(ls`Function`,detailsNode);break;case recordTypes.TimerFire:case recordTypes.TimerInstall:case recordTypes.TimerRemove:contentHelper.appendTextRow(ls`Timer ID`,eventData['timerId']);if(event.name===recordTypes.TimerInstall){contentHelper.appendTextRow(ls`Timeout`,Number.millisToString(eventData['timeout']));contentHelper.appendTextRow(ls`Repeats`,!eventData['singleShot']);}
break;case recordTypes.FireAnimationFrame:contentHelper.appendTextRow(ls`Callback ID`,eventData['id']);break;case recordTypes.ResourceSendRequest:case recordTypes.ResourceReceiveResponse:case recordTypes.ResourceReceivedData:case recordTypes.ResourceFinish:url=timelineData.url;if(url)
contentHelper.appendElementRow(ls`Resource`,Components.Linkifier.linkifyURL(url,{tabStop:true}));if(eventData['requestMethod'])
contentHelper.appendTextRow(ls`Request Method`,eventData['requestMethod']);if(typeof eventData['statusCode']==='number')
contentHelper.appendTextRow(ls`Status Code`,eventData['statusCode']);if(eventData['mimeType'])
contentHelper.appendTextRow(ls`MIME Type`,eventData['mimeType']);if('priority'in eventData){const priority=PerfUI.uiLabelForNetworkPriority(eventData['priority']);contentHelper.appendTextRow(ls`Priority`,priority);}
if(eventData['encodedDataLength'])
contentHelper.appendTextRow(ls`Encoded Data`,ls`${eventData['encodedDataLength']} Bytes`);if(eventData['decodedBodyLength'])
contentHelper.appendTextRow(ls`Decoded Body`,ls`${eventData['decodedBodyLength']} Bytes`);break;case recordTypes.CompileModule:contentHelper.appendLocationRow(ls`Module`,event.args['fileName'],0);break;case recordTypes.CompileScript:url=eventData&&eventData['url'];if(url)
contentHelper.appendLocationRow(ls`Script`,url,eventData['lineNumber'],eventData['columnNumber']);contentHelper.appendTextRow(ls`Streamed`,eventData['streamed']);const producedCacheSize=eventData&&eventData['producedCacheSize'];if(producedCacheSize)
contentHelper.appendTextRow(ls`Produced Cache Size`,producedCacheSize);const cacheConsumeOptions=eventData&&eventData['cacheConsumeOptions'];if(cacheConsumeOptions){contentHelper.appendTextRow(ls`Cache Consume Options`,cacheConsumeOptions);contentHelper.appendTextRow(ls`Consumed Cache Size`,eventData['consumedCacheSize']);contentHelper.appendTextRow(ls`Cache Rejected`,eventData['cacheRejected']);}
break;case recordTypes.EvaluateScript:url=eventData&&eventData['url'];if(url)
contentHelper.appendLocationRow(ls`Script`,url,eventData['lineNumber'],eventData['columnNumber']);break;case recordTypes.WasmStreamFromResponseCallback:case recordTypes.WasmCompiledModule:case recordTypes.WasmCachedModule:case recordTypes.WasmModuleCacheHit:case recordTypes.WasmModuleCacheInvalid:if(eventData){url=event.args['url'];if(url)
contentHelper.appendTextRow(ls`Url`,url);const producedCachedSize=event.args['producedCachedSize'];if(producedCachedSize)
contentHelper.appendTextRow(ls`Produced Cache Size`,producedCachedSize);const consumedCachedSize=event.args['consumedCachedSize'];if(consumedCachedSize)
contentHelper.appendTextRow(ls`Consumed Cache Size`,consumedCachedSize);}
break;case recordTypes.Paint:const clip=eventData['clip'];contentHelper.appendTextRow(ls`Location`,ls`(${clip[0]}, ${clip[1]})`);const clipWidth=Timeline.TimelineUIUtils.quadWidth(clip);const clipHeight=Timeline.TimelineUIUtils.quadHeight(clip);contentHelper.appendTextRow(ls`Dimensions`,ls`${clipWidth}  ${clipHeight}`);case recordTypes.PaintSetup:case recordTypes.Rasterize:case recordTypes.ScrollLayer:relatedNodeLabel=ls`Layer Root`;break;case recordTypes.PaintImage:case recordTypes.DecodeLazyPixelRef:case recordTypes.DecodeImage:case recordTypes.ResizeImage:case recordTypes.DrawLazyPixelRef:relatedNodeLabel=ls`Owner Element`;url=timelineData.url;if(url)
contentHelper.appendElementRow(ls`Image URL`,Components.Linkifier.linkifyURL(url,{tabStop:true}));break;case recordTypes.ParseAuthorStyleSheet:url=eventData['styleSheetUrl'];if(url)
contentHelper.appendElementRow(ls`Stylesheet URL`,Components.Linkifier.linkifyURL(url,{tabStop:true}));break;case recordTypes.UpdateLayoutTree:case recordTypes.RecalculateStyles:contentHelper.appendTextRow(ls`Elements Affected`,event.args['elementCount']);break;case recordTypes.Layout:const beginData=event.args['beginData'];contentHelper.appendTextRow(ls`Nodes That Need Layout`,ls`${beginData['dirtyObjects']} of ${beginData['totalObjects']}`);relatedNodeLabel=ls`Layout root`;break;case recordTypes.ConsoleTime:contentHelper.appendTextRow(ls`Message`,event.name);break;case recordTypes.WebSocketCreate:case recordTypes.WebSocketSendHandshakeRequest:case recordTypes.WebSocketReceiveHandshakeResponse:case recordTypes.WebSocketDestroy:const initiatorData=initiator?initiator.args['data']:eventData;if(typeof initiatorData['webSocketURL']!=='undefined')
contentHelper.appendTextRow(ls`URL`,initiatorData['webSocketURL']);if(typeof initiatorData['webSocketProtocol']!=='undefined')
contentHelper.appendTextRow(ls`WebSocket Protocol`,initiatorData['webSocketProtocol']);if(typeof eventData['message']!=='undefined')
contentHelper.appendTextRow(ls`Message`,eventData['message']);break;case recordTypes.EmbedderCallback:contentHelper.appendTextRow(ls`Callback Function`,eventData['callbackName']);break;case recordTypes.Animation:if(event.phase===SDK.TracingModel.Phase.NestableAsyncInstant)
contentHelper.appendTextRow(ls`State`,eventData['state']);break;case recordTypes.ParseHTML:{const beginData=event.args['beginData'];const startLine=beginData['startLine']-1;const endLine=event.args['endData']?event.args['endData']['endLine']-1:undefined;url=beginData['url'];if(url)
contentHelper.appendLocationRange(ls`Range`,url,startLine,endLine);break;}
case recordTypes.FireIdleCallback:contentHelper.appendTextRow(ls`Allotted Time`,Number.millisToString(eventData['allottedMilliseconds']));contentHelper.appendTextRow(ls`Invoked by Timeout`,eventData['timedOut']);case recordTypes.RequestIdleCallback:case recordTypes.CancelIdleCallback:contentHelper.appendTextRow(ls`Callback ID`,eventData['id']);break;case recordTypes.EventDispatch:contentHelper.appendTextRow(ls`Type`,eventData['type']);break;case recordTypes.MarkLCPCandidate:contentHelper.appendTextRow(ls`Type`,String(eventData['type']));contentHelper.appendTextRow(ls`Size`,String(eventData['size']));case recordTypes.MarkFirstPaint:case recordTypes.MarkFCP:case recordTypes.MarkFMP:case recordTypes.MarkLoad:case recordTypes.MarkDOMContent:contentHelper.appendTextRow(ls`Timestamp`,Number.preciseMillisToString(event.startTime-model.minimumRecordTime(),1));break;default:{const detailsNode=Timeline.TimelineUIUtils.buildDetailsNodeForTraceEvent(event,model.targetByEvent(event),linkifier);if(detailsNode)
contentHelper.appendElementRow(ls`Details`,detailsNode);break;}}
Timeline.TimelineUIUtils._maybeAppendProductToDetails(contentHelper,badgePool,url||eventData&&eventData['url']);if(timelineData.timeWaitingForMainThread){contentHelper.appendTextRow(ls`Time Waiting for Main Thread`,Number.millisToString(timelineData.timeWaitingForMainThread,true));}
const relatedNode=relatedNodesMap&&relatedNodesMap.get(timelineData.backendNodeId);if(relatedNode){const nodeSpan=await Common.Linkifier.linkify(relatedNode);contentHelper.appendElementRow(relatedNodeLabel||ls`Related Node`,nodeSpan);}
if(event[Timeline.TimelineUIUtils._previewElementSymbol]){contentHelper.addSection(ls`Preview`);contentHelper.appendElementRow('',event[Timeline.TimelineUIUtils._previewElementSymbol]);}
if(initiator||timelineData.stackTraceForSelfOrInitiator()||TimelineModel.InvalidationTracker.invalidationEventsFor(event))
Timeline.TimelineUIUtils._generateCauses(event,model.targetByEvent(event),relatedNodesMap,contentHelper);const stats={};const showPieChart=detailed&&Timeline.TimelineUIUtils._aggregatedStatsForTraceEvent(stats,model,event);if(showPieChart){contentHelper.addSection(ls`Aggregated Time`);const pieChart=Timeline.TimelineUIUtils.generatePieChart(stats,Timeline.TimelineUIUtils.eventStyle(event).category,event.selfTime);contentHelper.appendElementRow('',pieChart);}
return contentHelper.fragment;}
static _maybeAppendProductToDetails(contentHelper,badgePool,url){const parsedURL=url?url.asParsedURL():null;if(parsedURL)
contentHelper.appendElementRow('',badgePool.badgeForURL(parsedURL));}
static statsForTimeRange(events,startTime,endTime){if(!events.length)
return{'idle':endTime-startTime};buildRangeStatsCacheIfNeeded(events);const aggregatedStats=subtractStats(aggregatedStatsAtTime(endTime),aggregatedStatsAtTime(startTime));const aggregatedTotal=Object.values(aggregatedStats).reduce((a,b)=>a+b,0);aggregatedStats['idle']=Math.max(0,endTime-startTime-aggregatedTotal);return aggregatedStats;function aggregatedStatsAtTime(time){const stats={};const cache=events[Timeline.TimelineUIUtils._categoryBreakdownCacheSymbol];for(const category in cache){const categoryCache=cache[category];const index=categoryCache.time.upperBound(time);let value;if(index===0){value=0;}else if(index===categoryCache.time.length){value=categoryCache.value.peekLast();}else{const t0=categoryCache.time[index-1];const t1=categoryCache.time[index];const v0=categoryCache.value[index-1];const v1=categoryCache.value[index];value=v0+(v1-v0)*(time-t0)/(t1-t0);}
stats[category]=value;}
return stats;}
function subtractStats(a,b){const result=Object.assign({},a);for(const key in b)
result[key]-=b[key];return result;}
function buildRangeStatsCacheIfNeeded(events){if(events[Timeline.TimelineUIUtils._categoryBreakdownCacheSymbol])
return;const aggregatedStats={};const categoryStack=[];let lastTime=0;TimelineModel.TimelineModel.forEachEvent(events,onStartEvent,onEndEvent,undefined,undefined,undefined,filterForStats());function filterForStats(){const visibleEventsFilter=Timeline.TimelineUIUtils.visibleEventsFilter();return event=>visibleEventsFilter.accept(event)||SDK.TracingModel.isTopLevelEvent(event);}
function updateCategory(category,time){let statsArrays=aggregatedStats[category];if(!statsArrays){statsArrays={time:[],value:[]};aggregatedStats[category]=statsArrays;}
if(statsArrays.time.length&&statsArrays.time.peekLast()===time)
return;const lastValue=statsArrays.value.length?statsArrays.value.peekLast():0;statsArrays.value.push(lastValue+time-lastTime);statsArrays.time.push(time);}
function categoryChange(from,to,time){if(from)
updateCategory(from,time);lastTime=time;if(to)
updateCategory(to,time);}
function onStartEvent(e){const category=Timeline.TimelineUIUtils.eventStyle(e).category.name;const parentCategory=categoryStack.length?categoryStack.peekLast():null;if(category!==parentCategory)
categoryChange(parentCategory,category,e.startTime);categoryStack.push(category);}
function onEndEvent(e){const category=categoryStack.pop();const parentCategory=categoryStack.length?categoryStack.peekLast():null;if(category!==parentCategory)
categoryChange(category,parentCategory,e.endTime);}
const obj=(events);obj[Timeline.TimelineUIUtils._categoryBreakdownCacheSymbol]=aggregatedStats;}}
static async buildNetworkRequestDetails(request,model,linkifier,badgePool){const target=model.targetByEvent(request.children[0]);const contentHelper=new Timeline.TimelineDetailsContentHelper(target,linkifier);const category=Timeline.TimelineUIUtils.networkRequestCategory(request);const color=Timeline.TimelineUIUtils.networkCategoryColor(category);contentHelper.addSection(ls`Network request`,color);const duration=request.endTime-(request.getStartTime()||-Infinity);if(request.url)
contentHelper.appendElementRow(ls`URL`,Components.Linkifier.linkifyURL(request.url));Timeline.TimelineUIUtils._maybeAppendProductToDetails(contentHelper,badgePool,request.url);if(isFinite(duration))
contentHelper.appendTextRow(ls`Duration`,Number.millisToString(duration,true));if(request.requestMethod)
contentHelper.appendTextRow(ls`Request Method`,request.requestMethod);if(typeof request.priority==='string'){const priority=PerfUI.uiLabelForNetworkPriority((request.priority));contentHelper.appendTextRow(ls`Priority`,priority);}
if(request.mimeType)
contentHelper.appendTextRow(ls`Mime Type`,request.mimeType);let lengthText='';if(request.memoryCached())
lengthText+=ls` (from memory cache)`;else if(request.cached())
lengthText+=ls` (from cache)`;else if(request.timing&&request.timing.pushStart)
lengthText+=ls` (from push)`;if(request.fromServiceWorker)
lengthText+=ls` (from service worker)`;if(request.encodedDataLength||!lengthText)
lengthText=`${Number.bytesToString(request.encodedDataLength)}${lengthText}`;contentHelper.appendTextRow(ls`Encoded Data`,lengthText);if(request.decodedBodyLength)
contentHelper.appendTextRow(ls`Decoded Body`,Number.bytesToString(request.decodedBodyLength));const title=ls`Initiator`;const sendRequest=request.children[0];const topFrame=TimelineModel.TimelineData.forEvent(sendRequest).topFrame();if(topFrame){const link=linkifier.maybeLinkifyConsoleCallFrame(target,topFrame,{tabStop:true});if(link)
contentHelper.appendElementRow(title,link);}else{const initiator=TimelineModel.TimelineData.forEvent(sendRequest).initiator();if(initiator){const initiatorURL=TimelineModel.TimelineData.forEvent(initiator).url;if(initiatorURL){const link=linkifier.maybeLinkifyScriptLocation(target,null,initiatorURL,0,{tabStop:true});if(link)
contentHelper.appendElementRow(title,link);}}}
if(!request.previewElement&&request.url&&target){const parsedRequestURL=new Common.ParsedURL(request.url);request.previewElement=await Components.ImagePreview.build(target,request.url,false,{imageAltText:ls`Image from ${parsedRequestURL.displayName}`});}
if(request.previewElement)
contentHelper.appendElementRow(ls`Preview`,request.previewElement);return contentHelper.fragment;}
static _stackTraceFromCallFrames(callFrames){return({callFrames:callFrames});}
static _generateCauses(event,target,relatedNodesMap,contentHelper){const recordTypes=TimelineModel.TimelineModel.RecordType;let callSiteStackLabel;let stackLabel;switch(event.name){case recordTypes.TimerFire:callSiteStackLabel=ls`Timer Installed`;break;case recordTypes.FireAnimationFrame:callSiteStackLabel=ls`Animation Frame Requested`;break;case recordTypes.FireIdleCallback:callSiteStackLabel=ls`Idle Callback Requested`;break;case recordTypes.UpdateLayoutTree:case recordTypes.RecalculateStyles:stackLabel=ls`Recalculation Forced`;break;case recordTypes.Layout:callSiteStackLabel=ls`First Layout Invalidation`;stackLabel=ls`Layout Forced`;break;}
const timelineData=TimelineModel.TimelineData.forEvent(event);if(timelineData.stackTrace&&timelineData.stackTrace.length){contentHelper.addSection(ls`Call Stacks`);contentHelper.appendStackTrace(stackLabel||ls`Stack Trace`,Timeline.TimelineUIUtils._stackTraceFromCallFrames(timelineData.stackTrace));}
const initiator=TimelineModel.TimelineData.forEvent(event).initiator();if(TimelineModel.InvalidationTracker.invalidationEventsFor(event)&&target){contentHelper.addSection(ls`Invalidations`);Timeline.TimelineUIUtils._generateInvalidations(event,target,relatedNodesMap,contentHelper);}else if(initiator){const delay=event.startTime-initiator.startTime;contentHelper.appendTextRow(ls`Pending for`,Number.preciseMillisToString(delay,1));const link=createElementWithClass('span','devtools-link');UI.ARIAUtils.markAsLink(link);link.tabIndex=0;link.textContent=ls`Reveal`;link.addEventListener('click',()=>{Timeline.TimelinePanel.instance().select(Timeline.TimelineSelection.fromTraceEvent((initiator)));});link.addEventListener('keydown',event=>{if(isEnterKey(event)){Timeline.TimelinePanel.instance().select(Timeline.TimelineSelection.fromTraceEvent((initiator)));event.consume(true);}});contentHelper.appendElementRow(ls`Initiator`,link);const initiatorStackTrace=TimelineModel.TimelineData.forEvent(initiator).stackTrace;if(initiatorStackTrace){contentHelper.appendStackTrace(callSiteStackLabel||ls`First Invalidated`,Timeline.TimelineUIUtils._stackTraceFromCallFrames(initiatorStackTrace));}}}
static _generateInvalidations(event,target,relatedNodesMap,contentHelper){const invalidationTrackingEvents=TimelineModel.InvalidationTracker.invalidationEventsFor(event);const invalidations={};invalidationTrackingEvents.forEach(function(invalidation){if(!invalidations[invalidation.type])
invalidations[invalidation.type]=[invalidation];else
invalidations[invalidation.type].push(invalidation);});Object.keys(invalidations).forEach(function(type){Timeline.TimelineUIUtils._generateInvalidationsForType(type,target,invalidations[type],relatedNodesMap,contentHelper);});}
static _generateInvalidationsForType(type,target,invalidations,relatedNodesMap,contentHelper){let title;switch(type){case TimelineModel.TimelineModel.RecordType.StyleRecalcInvalidationTracking:title=ls`Style Invalidations`;break;case TimelineModel.TimelineModel.RecordType.LayoutInvalidationTracking:title=ls`Layout Invalidations`;break;default:title=ls`Other Invalidations`;break;}
const invalidationsTreeOutline=new UI.TreeOutlineInShadow();invalidationsTreeOutline.registerRequiredCSS('timeline/invalidationsTree.css');invalidationsTreeOutline.element.classList.add('invalidations-tree');const invalidationGroups=groupInvalidationsByCause(invalidations);invalidationGroups.forEach(function(group){const groupElement=new Timeline.TimelineUIUtils.InvalidationsGroupElement(target,relatedNodesMap,contentHelper,group);invalidationsTreeOutline.appendChild(groupElement);});contentHelper.appendElementRow(title,invalidationsTreeOutline.element,false,true);function groupInvalidationsByCause(invalidations){const causeToInvalidationMap=new Map();for(let index=0;index<invalidations.length;index++){const invalidation=invalidations[index];let causeKey='';if(invalidation.cause.reason)
causeKey+=invalidation.cause.reason+'.';if(invalidation.cause.stackTrace){invalidation.cause.stackTrace.forEach(function(stackFrame){causeKey+=stackFrame['functionName']+'.';causeKey+=stackFrame['scriptId']+'.';causeKey+=stackFrame['url']+'.';causeKey+=stackFrame['lineNumber']+'.';causeKey+=stackFrame['columnNumber']+'.';});}
if(causeToInvalidationMap.has(causeKey))
causeToInvalidationMap.get(causeKey).push(invalidation);else
causeToInvalidationMap.set(causeKey,[invalidation]);}
return causeToInvalidationMap.valuesArray();}}
static _collectInvalidationNodeIds(nodeIds,invalidations){nodeIds.addAll(invalidations.map(invalidation=>invalidation.nodeId).filter(id=>id));}
static _aggregatedStatsForTraceEvent(total,model,event){const events=model.inspectedTargetEvents();function eventComparator(startTime,e){return startTime-e.startTime;}
const index=events.binaryIndexOf(event.startTime,eventComparator);if(index<0)
return false;let hasChildren=false;const endTime=event.endTime;if(endTime){for(let i=index;i<events.length;i++){const nextEvent=events[i];if(nextEvent.startTime>=endTime)
break;if(!nextEvent.selfTime)
continue;if(nextEvent.thread!==event.thread)
continue;if(i>index)
hasChildren=true;const categoryName=Timeline.TimelineUIUtils.eventStyle(nextEvent).category.name;total[categoryName]=(total[categoryName]||0)+nextEvent.selfTime;}}
if(SDK.TracingModel.isAsyncPhase(event.phase)){if(event.endTime){let aggregatedTotal=0;for(const categoryName in total)
aggregatedTotal+=total[categoryName];total['idle']=Math.max(0,event.endTime-event.startTime-aggregatedTotal);}
return false;}
return hasChildren;}
static async buildPicturePreviewContent(event,target){const snapshotWithRect=await new TimelineModel.LayerPaintEvent(event,target).snapshotPromise();if(!snapshotWithRect)
return null;const imageURLPromise=snapshotWithRect.snapshot.replay();snapshotWithRect.snapshot.release();const imageURL=await imageURLPromise;if(!imageURL)
return null;const container=createElement('div');UI.appendStyle(container,'components/imagePreview.css');container.classList.add('image-preview-container','vbox','link');const img=container.createChild('img');img.src=imageURL;const parsedImageURL=new Common.ParsedURL(imageURL);img.alt=ls`Image from ${parsedImageURL.displayName}`;const paintProfilerButton=container.createChild('a');paintProfilerButton.textContent=ls`Paint Profiler`;UI.ARIAUtils.markAsLink(container);container.tabIndex=0;container.addEventListener('click',()=>Timeline.TimelinePanel.instance().select(Timeline.TimelineSelection.fromTraceEvent(event)),false);container.addEventListener('keydown',keyEvent=>{if(isEnterKey(keyEvent)){Timeline.TimelinePanel.instance().select(Timeline.TimelineSelection.fromTraceEvent(event));keyEvent.consume(true);}});return container;}
static createEventDivider(event,zeroTime){const eventDivider=createElementWithClass('div','resources-event-divider');const startTime=Number.millisToString(event.startTime-zeroTime);eventDivider.title=Common.UIString('%s at %s',Timeline.TimelineUIUtils.eventTitle(event),startTime);const style=Timeline.TimelineUIUtils.markerStyleForEvent(event);if(style.tall)
eventDivider.style.backgroundColor=style.color;return eventDivider;}
static _visibleTypes(){const eventStyles=Timeline.TimelineUIUtils._initEventStyles();const result=[];for(const name in eventStyles){if(!eventStyles[name].hidden)
result.push(name);}
return result;}
static visibleEventsFilter(){return new TimelineModel.TimelineVisibleEventsFilter(Timeline.TimelineUIUtils._visibleTypes());}
static categories(){if(Timeline.TimelineUIUtils._categories)
return Timeline.TimelineUIUtils._categories;Timeline.TimelineUIUtils._categories={loading:new Timeline.TimelineCategory('loading',ls`Loading`,true,'hsl(214, 67%, 74%)','hsl(214, 67%, 66%)'),scripting:new Timeline.TimelineCategory('scripting',ls`Scripting`,true,'hsl(43, 83%, 72%)','hsl(43, 83%, 64%) '),rendering:new Timeline.TimelineCategory('rendering',ls`Rendering`,true,'hsl(256, 67%, 76%)','hsl(256, 67%, 70%)'),painting:new Timeline.TimelineCategory('painting',ls`Painting`,true,'hsl(109, 33%, 64%)','hsl(109, 33%, 55%)'),gpu:new Timeline.TimelineCategory('gpu',ls`GPU`,false,'hsl(109, 33%, 64%)','hsl(109, 33%, 55%)'),async:new Timeline.TimelineCategory('async',ls`Async`,false,'hsl(0, 100%, 50%)','hsl(0, 100%, 40%)'),other:new Timeline.TimelineCategory('other',ls`System`,false,'hsl(0, 0%, 87%)','hsl(0, 0%, 79%)'),idle:new Timeline.TimelineCategory('idle',ls`Idle`,false,'hsl(0, 0%, 98%)','hsl(0, 0%, 98%)')};return Timeline.TimelineUIUtils._categories;}
static generatePieChart(aggregatedStats,selfCategory,selfTime){let total=0;for(const categoryName in aggregatedStats)
total+=aggregatedStats[categoryName];const element=createElementWithClass('div','timeline-details-view-pie-chart-wrapper hbox');const pieChart=new PerfUI.PieChart({chartName:ls`Time spent in rendering`,size:110,formatter:value=>Number.preciseMillisToString(value),showLegend:true,});pieChart.element.classList.add('timeline-details-view-pie-chart');pieChart.setTotal(total);const pieChartContainer=element.createChild('div','vbox');pieChartContainer.appendChild(pieChart.element);function appendLegendRow(name,title,value,color){if(!value)
return;pieChart.addSlice(value,color,title);}
if(selfCategory){if(selfTime){appendLegendRow(selfCategory.name,Common.UIString('%s (self)',selfCategory.title),selfTime,selfCategory.color);}
const categoryTime=aggregatedStats[selfCategory.name];const value=categoryTime-selfTime;if(value>0){appendLegendRow(selfCategory.name,Common.UIString('%s (children)',selfCategory.title),value,selfCategory.childColor);}}
for(const categoryName in Timeline.TimelineUIUtils.categories()){const category=Timeline.TimelineUIUtils.categories()[categoryName];if(category===selfCategory)
continue;appendLegendRow(category.name,category.title,aggregatedStats[category.name],category.childColor);}
return element;}
static generateDetailsContentForFrame(frame,filmStripFrame){const contentHelper=new Timeline.TimelineDetailsContentHelper(null,null);contentHelper.addSection(ls`Frame`);const duration=Timeline.TimelineUIUtils.frameDuration(frame);contentHelper.appendElementRow(ls`Duration`,duration,frame.hasWarnings());const durationInMillis=frame.endTime-frame.startTime;contentHelper.appendTextRow(ls`FPS`,Math.floor(1000/durationInMillis));contentHelper.appendTextRow(ls`CPU time`,Number.millisToString(frame.cpuTime,true));if(filmStripFrame){const filmStripPreview=createElementWithClass('div','timeline-filmstrip-preview');filmStripFrame.imageDataPromise().then(data=>UI.loadImageFromData(data)).then(image=>image&&filmStripPreview.appendChild(image));contentHelper.appendElementRow('',filmStripPreview);filmStripPreview.addEventListener('click',frameClicked.bind(null,filmStripFrame),false);}
if(frame.layerTree)
contentHelper.appendElementRow(ls`Layer tree`,Components.Linkifier.linkifyRevealable(frame.layerTree,ls`Show`));function frameClicked(filmStripFrame){new PerfUI.FilmStripView.Dialog(filmStripFrame,0);}
return contentHelper.fragment;}
static frameDuration(frame){const durationText=Common.UIString('%s (at %s)',Number.millisToString(frame.endTime-frame.startTime,true),Number.millisToString(frame.startTimeOffset,true));if(!frame.hasWarnings())
return UI.formatLocalized('%s',[durationText]);const link=UI.DisabledXLink.create('https://aka.ms/docs-landing-page',ls`jank`,false);return UI.formatLocalized('%s. Long frame times are an indication of %s',[durationText,link]);}
static createFillStyle(context,width,height,color0,color1,color2){const gradient=context.createLinearGradient(0,0,width,height);gradient.addColorStop(0,color0);gradient.addColorStop(0.25,color1);gradient.addColorStop(0.75,color1);gradient.addColorStop(1,color2);return gradient;}
static quadWidth(quad){return Math.round(Math.sqrt(Math.pow(quad[0]-quad[2],2)+Math.pow(quad[1]-quad[3],2)));}
static quadHeight(quad){return Math.round(Math.sqrt(Math.pow(quad[0]-quad[6],2)+Math.pow(quad[1]-quad[7],2)));}
static eventDispatchDesciptors(){if(Timeline.TimelineUIUtils._eventDispatchDesciptors)
return Timeline.TimelineUIUtils._eventDispatchDesciptors;const lightOrange='hsl(40,100%,80%)';const orange='hsl(40,100%,50%)';const green='hsl(90,100%,40%)';const purple='hsl(256,100%,75%)';Timeline.TimelineUIUtils._eventDispatchDesciptors=[new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(1,lightOrange,['mousemove','mouseenter','mouseleave','mouseout','mouseover']),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(1,lightOrange,['pointerover','pointerout','pointerenter','pointerleave','pointermove']),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(2,green,['wheel']),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(3,orange,['click','mousedown','mouseup']),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(3,orange,['touchstart','touchend','touchmove','touchcancel']),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(3,orange,['pointerdown','pointerup','pointercancel','gotpointercapture','lostpointercapture']),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(3,purple,['keydown','keyup','keypress'])];return Timeline.TimelineUIUtils._eventDispatchDesciptors;}
static markerShortTitle(event){const recordTypes=TimelineModel.TimelineModel.RecordType;switch(event.name){case recordTypes.MarkDOMContent:return ls`DCL`;case recordTypes.MarkLoad:return ls`L`;case recordTypes.MarkFirstPaint:return ls`FP`;case recordTypes.MarkFCP:return ls`FCP`;case recordTypes.MarkFMP:return ls`FMP`;case recordTypes.MarkLCPCandidate:return ls`LCP`;}
return null;}
static markerStyleForEvent(event){const tallMarkerDashStyle=[6,4];const title=Timeline.TimelineUIUtils.eventTitle(event);if(event.hasCategory(TimelineModel.TimelineModel.Category.Console)||event.hasCategory(TimelineModel.TimelineModel.Category.UserTiming)){return{title:title,dashStyle:tallMarkerDashStyle,lineWidth:0.5,color:event.hasCategory(TimelineModel.TimelineModel.Category.UserTiming)?'purple':'orange',tall:false,lowPriority:false,};}
const recordTypes=TimelineModel.TimelineModel.RecordType;let tall=false;let color='grey';switch(event.name){case recordTypes.FrameStartedLoading:color='green';tall=true;break;case recordTypes.MarkDOMContent:color='#0867CB';tall=true;break;case recordTypes.MarkLoad:color='#B31412';tall=true;break;case recordTypes.MarkFirstPaint:color='#228847';tall=true;break;case recordTypes.MarkFCP:color='#1A6937';tall=true;break;case recordTypes.MarkFMP:color='#134A26';tall=true;break;case recordTypes.MarkLCPCandidate:color='#1A3422';tall=true;break;case recordTypes.TimeStamp:color='orange';break;}
return{title:title,dashStyle:tallMarkerDashStyle,lineWidth:0.5,color:color,tall:tall,lowPriority:false,};}
static markerStyleForFrame(){return{title:ls`Frame`,color:'rgba(100, 100, 100, 0.4)',lineWidth:3,dashStyle:[3],tall:true,lowPriority:true};}
static colorForId(id){if(!Timeline.TimelineUIUtils.colorForId._colorGenerator){Timeline.TimelineUIUtils.colorForId._colorGenerator=new Common.Color.Generator({min:30,max:330},{min:50,max:80,count:3},85);Timeline.TimelineUIUtils.colorForId._colorGenerator.setColorForID('','#f2ecdc');}
return Timeline.TimelineUIUtils.colorForId._colorGenerator.colorForID(id);}
static eventWarning(event,warningType){const timelineData=TimelineModel.TimelineData.forEvent(event);const warning=warningType||timelineData.warning;if(!warning)
return null;const warnings=TimelineModel.TimelineModel.WarningType;const span=createElement('span');const eventData=event.args['data'];switch(warning){case warnings.ForcedStyle:case warnings.ForcedLayout:const forcedReflowLink=UI.createDisabledDocumentationLink('',ls`Forced reflow`,false);span.appendChild(UI.formatLocalized('%s is a likely performance bottleneck.',[forcedReflowLink]));break;case warnings.IdleDeadlineExceeded:const exceededMs=Number.millisToString(event.duration-eventData['allottedMilliseconds'],true);span.textContent=ls`Idle callback execution extended beyond deadline by ${exceededMs}`;break;case warnings.LongHandler:span.textContent=Common.UIString('Handler took %s',Number.millisToString(event.duration,true));break;case warnings.LongRecurringHandler:span.textContent=Common.UIString('Recurring handler took %s',Number.millisToString(event.duration,true));break;case warnings.LongTask:const longTaskLink=UI.createDisabledDocumentationLink('',ls`Long task`,false);span.appendChild(UI.formatLocalized('%s took %s.',[longTaskLink,Number.millisToString(event.duration,true)]));break;case warnings.V8Deopt:span.appendChild(UI.DisabledXLink.create('https://aka.ms/docs-landing-page',Common.UIString('Not optimized'),true));span.createTextChild(Common.UIString(': %s',eventData['deoptReason']));break;default:console.assert(false,'Unhandled TimelineModel.WarningType');}
return span;}
static displayNameForFrame(frame,trimAt){const url=frame.url;if(!trimAt)
trimAt=30;return url.startsWith('about:')?`"${frame.name.trimMiddle(trimAt)}"`:frame.url.trimEnd(trimAt);}};Timeline.TimelineRecordStyle=class{constructor(title,category,hidden){this.title=title;this.category=category;this.hidden=!!hidden;}};Timeline.TimelineUIUtils.NetworkCategory={HTML:Symbol('HTML'),Script:Symbol('Script'),Style:Symbol('Style'),Media:Symbol('Media'),Other:Symbol('Other')};Timeline.TimelineUIUtils._aggregatedStatsKey=Symbol('aggregatedStats');Timeline.TimelineUIUtils.InvalidationsGroupElement=class extends UI.TreeElement{constructor(target,relatedNodesMap,contentHelper,invalidations){super('',true);this.listItemElement.classList.add('header');this.selectable=false;this.toggleOnClick=true;this._relatedNodesMap=relatedNodesMap;this._contentHelper=contentHelper;this._invalidations=invalidations;this.title=this._createTitle(target);}
_createTitle(target){const first=this._invalidations[0];const reason=first.cause.reason||ls`Unknown cause`;const topFrame=first.cause.stackTrace&&first.cause.stackTrace[0];const truncatedNodesElement=this._getTruncatedNodesElement(this._invalidations);if(truncatedNodesElement===null)
return UI.formatLocalized(reason,[]);const title=UI.formatLocalized('%s for %s',[reason,truncatedNodesElement]);if(topFrame&&this._contentHelper.linkifier()){const stack=createElementWithClass('span','monospace');const completeTitle=UI.formatLocalized('%s. %s',[title,stack]);stack.createChild('span').textContent=Timeline.TimelineUIUtils.frameDisplayName(topFrame);const link=this._contentHelper.linkifier().maybeLinkifyConsoleCallFrame(target,topFrame);if(link){stack.createChild('span').textContent=' @ ';stack.createChild('span').appendChild(link);}
return completeTitle;}
return title;}
async onpopulate(){const content=createElementWithClass('div','content');const first=this._invalidations[0];if(first.cause.stackTrace){const stack=content.createChild('div');stack.createTextChild(ls`Stack trace:`);this._contentHelper.createChildStackTraceElement(stack,Timeline.TimelineUIUtils._stackTraceFromCallFrames(first.cause.stackTrace));}
content.createTextChild(this._invalidations.length!==1?ls`Nodes:`:ls`Node:`);const nodeList=content.createChild('div','node-list');let firstNode=true;for(let i=0;i<this._invalidations.length;i++){const invalidation=this._invalidations[i];const invalidationNode=this._createInvalidationNode(invalidation,true);if(invalidationNode){if(!firstNode)
nodeList.createTextChild(ls`, `);firstNode=false;nodeList.appendChild(invalidationNode);const extraData=invalidation.extraData?', '+invalidation.extraData:'';if(invalidation.changedId){nodeList.createTextChild(Common.UIString('(changed id to "%s"%s)',invalidation.changedId,extraData));}else if(invalidation.changedClass){nodeList.createTextChild(Common.UIString('(changed class to "%s"%s)',invalidation.changedClass,extraData));}else if(invalidation.changedAttribute){nodeList.createTextChild(Common.UIString('(changed attribute to "%s"%s)',invalidation.changedAttribute,extraData));}else if(invalidation.changedPseudo){nodeList.createTextChild(Common.UIString('(changed pesudo to "%s"%s)',invalidation.changedPseudo,extraData));}else if(invalidation.selectorPart){nodeList.createTextChild(Common.UIString('(changed "%s"%s)',invalidation.selectorPart,extraData));}}}
const contentTreeElement=new UI.TreeElement(content,false);contentTreeElement.selectable=false;this.appendChild(contentTreeElement);}
_getTruncatedNodesElement(invalidations){const invalidationNodes=[];const invalidationNodeIdMap={};for(let i=0;i<invalidations.length;i++){const invalidation=invalidations[i];const invalidationNode=this._createInvalidationNode(invalidation,false);invalidationNode.addEventListener('click',e=>e.consume(),false);if(invalidationNode&&!invalidationNodeIdMap[invalidation.nodeId]){invalidationNodes.push(invalidationNode);invalidationNodeIdMap[invalidation.nodeId]=true;}}
if(invalidationNodes.length===1){return invalidationNodes[0];}else if(invalidationNodes.length===2){return UI.formatLocalized('%s and %s',invalidationNodes);}else if(invalidationNodes.length===3){return UI.formatLocalized('%s, %s, and 1 other',invalidationNodes.slice(0,2));}else if(invalidationNodes.length>=4){return UI.formatLocalized('%s, %s, and %s others',[...invalidationNodes.slice(0,2),(invalidationNodes.length-2).toString()]);}
return null;}
_createInvalidationNode(invalidation,showUnknownNodes){const node=(invalidation.nodeId&&this._relatedNodesMap)?this._relatedNodesMap.get(invalidation.nodeId):null;if(node){const nodeSpan=createElement('span');Common.Linkifier.linkify(node).then(link=>nodeSpan.appendChild(link));return nodeSpan;}
if(invalidation.nodeName){const nodeSpan=createElement('span');nodeSpan.textContent=Common.UIString('[ %s ]',invalidation.nodeName);return nodeSpan;}
if(showUnknownNodes){const nodeSpan=createElement('span');return nodeSpan.createTextChild(Common.UIString('[ unknown node ]'));}}};Timeline.TimelineUIUtils._previewElementSymbol=Symbol('previewElement');Timeline.TimelineUIUtils.EventDispatchTypeDescriptor=class{constructor(priority,color,eventTypes){this.priority=priority;this.color=color;this.eventTypes=eventTypes;}};Timeline.TimelineCategory=class extends Common.Object{constructor(name,title,visible,childColor,color){super();this.name=name;this.title=title;this.visible=visible;this.childColor=childColor;this.color=color;this.hidden=false;}
get hidden(){return this._hidden;}
set hidden(hidden){this._hidden=hidden;this.dispatchEventToListeners(Timeline.TimelineCategory.Events.VisibilityChanged,this);}};Timeline.TimelineCategory.Events={VisibilityChanged:Symbol('VisibilityChanged')};Timeline.TimelineMarkerStyle;Timeline.TimelinePopupContentHelper=class{constructor(title){this._contentTable=createElement('table');const titleCell=this._createCell(Common.UIString('%s - Details',title),'timeline-details-title');titleCell.colSpan=2;const titleRow=createElement('tr');titleRow.appendChild(titleCell);this._contentTable.appendChild(titleRow);}
contentTable(){return this._contentTable;}
_createCell(content,styleName){const text=createElement('label');text.createTextChild(String(content));const cell=createElement('td');cell.className='timeline-details';if(styleName)
cell.className+=' '+styleName;cell.textContent=content;return cell;}
appendTextRow(title,content){const row=createElement('tr');row.appendChild(this._createCell(title,'timeline-details-row-title'));row.appendChild(this._createCell(content,'timeline-details-row-data'));this._contentTable.appendChild(row);}
appendElementRow(title,content){const row=createElement('tr');const titleCell=this._createCell(title,'timeline-details-row-title');row.appendChild(titleCell);const cell=createElement('td');cell.className='details';if(content instanceof Node)
cell.appendChild(content);else
cell.createTextChild(content||'');row.appendChild(cell);this._contentTable.appendChild(row);}};Timeline.TimelineDetailsContentHelper=class{constructor(target,linkifier){this.fragment=createDocumentFragment();this._linkifier=linkifier;this._target=target;this.element=createElementWithClass('div','timeline-details-view-block');this._tableElement=this.element.createChild('div','vbox timeline-details-chip-body');this.fragment.appendChild(this.element);}
addSection(title,swatchColor){if(!this._tableElement.hasChildNodes()){this.element.removeChildren();}else{this.element=createElementWithClass('div','timeline-details-view-block');this.fragment.appendChild(this.element);}
if(title){const titleElement=this.element.createChild('div','timeline-details-chip-title');if(swatchColor)
titleElement.createChild('div').style.backgroundColor=swatchColor;titleElement.createTextChild(title);}
this._tableElement=this.element.createChild('div','vbox timeline-details-chip-body');this.fragment.appendChild(this.element);}
linkifier(){return this._linkifier;}
appendTextRow(title,value){const rowElement=this._tableElement.createChild('div','timeline-details-view-row');rowElement.createChild('div','timeline-details-view-row-title').textContent=title;rowElement.createChild('div','timeline-details-view-row-value').textContent=value;}
appendElementRow(title,content,isWarning,isStacked){const rowElement=this._tableElement.createChild('div','timeline-details-view-row');if(isWarning)
rowElement.classList.add('timeline-details-warning');if(isStacked)
rowElement.classList.add('timeline-details-stack-values');const titleElement=rowElement.createChild('div','timeline-details-view-row-title');titleElement.textContent=title;const valueElement=rowElement.createChild('div','timeline-details-view-row-value');if(content instanceof Node)
valueElement.appendChild(content);else
valueElement.createTextChild(content||'');}
appendLocationRow(title,url,startLine,startColumn){if(!this._linkifier||!this._target)
return;const link=this._linkifier.maybeLinkifyScriptLocation(this._target,null,url,startLine,{columnNumber:startColumn,tabStop:true});if(!link)
return;this.appendElementRow(title,link);}
appendLocationRange(title,url,startLine,endLine){if(!this._linkifier||!this._target)
return;const locationContent=createElement('span');const link=this._linkifier.maybeLinkifyScriptLocation(this._target,null,url,startLine,{tabStop:true});if(!link)
return;locationContent.appendChild(link);locationContent.createTextChild(String.sprintf(' [%s\u2026%s]',startLine+1,endLine+1||''));this.appendElementRow(title,locationContent);}
appendStackTrace(title,stackTrace){if(!this._linkifier||!this._target)
return;const rowElement=this._tableElement.createChild('div','timeline-details-view-row');rowElement.createChild('div','timeline-details-view-row-title').textContent=title;this.createChildStackTraceElement(rowElement,stackTrace);}
createChildStackTraceElement(parentElement,stackTrace){if(!this._linkifier||!this._target)
return;parentElement.classList.add('timeline-details-stack-values');const stackTraceElement=parentElement.createChild('div','timeline-details-view-row-value timeline-details-view-row-stack-trace');const callFrameContents=Components.JSPresentationUtils.buildStackTracePreviewContents(this._target,this._linkifier,stackTrace);callFrameContents.links.forEach(link=>link.tabIndex=0);stackTraceElement.appendChild(callFrameContents.element);}
appendWarningRow(event,warningType){const warning=Timeline.TimelineUIUtils.eventWarning(event,warningType);if(warning)
this.appendElementRow(ls`Warning`,warning,true);}};Timeline.TimelineUIUtils._categoryBreakdownCacheSymbol=Symbol('categoryBreakdownCache');;Timeline.TimelineLayersView=class extends UI.SplitWidget{constructor(model,showPaintProfilerCallback){super(true,false,'timelineLayersView');this._model=model;this._showPaintProfilerCallback=showPaintProfilerCallback;this.element.classList.add('timeline-layers-view');this._rightSplitWidget=new UI.SplitWidget(true,true,'timelineLayersViewDetails');this._rightSplitWidget.element.classList.add('timeline-layers-view-properties');this.setMainWidget(this._rightSplitWidget);const vbox=new UI.VBox();this.setSidebarWidget(vbox);this._layerViewHost=new LayerViewer.LayerViewHost();const layerTreeOutline=new LayerViewer.LayerTreeOutline(this._layerViewHost);vbox.element.appendChild(layerTreeOutline.element);this._layers3DView=new LayerViewer.Layers3DView(this._layerViewHost);this._layers3DView.addEventListener(LayerViewer.Layers3DView.Events.PaintProfilerRequested,this._onPaintProfilerRequested,this);this._rightSplitWidget.setMainWidget(this._layers3DView);const layerDetailsView=new LayerViewer.LayerDetailsView(this._layerViewHost);this._rightSplitWidget.setSidebarWidget(layerDetailsView);layerDetailsView.addEventListener(LayerViewer.LayerDetailsView.Events.PaintProfilerRequested,this._onPaintProfilerRequested,this);}
showLayerTree(frameLayerTree){this._frameLayerTree=frameLayerTree;if(this.isShowing())
this._update();else
this._updateWhenVisible=true;}
wasShown(){if(this._updateWhenVisible){this._updateWhenVisible=false;this._update();}}
_onPaintProfilerRequested(event){const selection=(event.data);this._layers3DView.snapshotForSelection(selection).then(snapshotWithRect=>{if(snapshotWithRect)
this._showPaintProfilerCallback(snapshotWithRect.snapshot);});}
_update(){this._frameLayerTree.layerTreePromise().then(layerTree=>this._layerViewHost.setLayerTree(layerTree));}};;Timeline.TimelinePaintProfilerView=class extends UI.SplitWidget{constructor(frameModel){super(false,false);this.element.classList.add('timeline-paint-profiler-view');this.setSidebarSize(60);this.setResizable(false);this._frameModel=frameModel;this._logAndImageSplitWidget=new UI.SplitWidget(true,false);this._logAndImageSplitWidget.element.classList.add('timeline-paint-profiler-log-split');this.setMainWidget(this._logAndImageSplitWidget);this._imageView=new Timeline.TimelinePaintImageView();this._logAndImageSplitWidget.setMainWidget(this._imageView);this._paintProfilerView=new LayerViewer.PaintProfilerView(this._imageView.showImage.bind(this._imageView));this._paintProfilerView.addEventListener(LayerViewer.PaintProfilerView.Events.WindowChanged,this._onWindowChanged,this);this.setSidebarWidget(this._paintProfilerView);this._logTreeView=new LayerViewer.PaintProfilerCommandLogView();this._logAndImageSplitWidget.setSidebarWidget(this._logTreeView);this._needsUpdateWhenVisible=false;this._pendingSnapshot=null;this._event=null;this._paintProfilerModel=null;this._lastLoadedSnapshot=null;}
wasShown(){if(this._needsUpdateWhenVisible){this._needsUpdateWhenVisible=false;this._update();}}
setSnapshot(snapshot){this._releaseSnapshot();this._pendingSnapshot=snapshot;this._event=null;this._updateWhenVisible();}
setEvent(paintProfilerModel,event){this._releaseSnapshot();this._paintProfilerModel=paintProfilerModel;this._pendingSnapshot=null;this._event=event;this._updateWhenVisible();if(this._event.name===TimelineModel.TimelineModel.RecordType.Paint)
return!!TimelineModel.TimelineData.forEvent(event).picture;if(this._event.name===TimelineModel.TimelineModel.RecordType.RasterTask)
return this._frameModel.hasRasterTile(this._event);return false;}
_updateWhenVisible(){if(this.isShowing())
this._update();else
this._needsUpdateWhenVisible=true;}
_update(){this._logTreeView.setCommandLog([]);this._paintProfilerView.setSnapshotAndLog(null,[],null);let snapshotPromise;if(this._pendingSnapshot){snapshotPromise=Promise.resolve({rect:null,snapshot:this._pendingSnapshot});}else if(this._event.name===TimelineModel.TimelineModel.RecordType.Paint){const picture=TimelineModel.TimelineData.forEvent(this._event).picture;snapshotPromise=picture.objectPromise().then(data=>this._paintProfilerModel.loadSnapshot(data['skp64'])).then(snapshot=>snapshot&&{rect:null,snapshot:snapshot});}else if(this._event.name===TimelineModel.TimelineModel.RecordType.RasterTask){snapshotPromise=this._frameModel.rasterTilePromise(this._event);}else{console.assert(false,'Unexpected event type or no snapshot');return;}
snapshotPromise.then(snapshotWithRect=>{this._releaseSnapshot();if(!snapshotWithRect){this._imageView.showImage();return;}
const snapshot=snapshotWithRect.snapshot;this._lastLoadedSnapshot=snapshot;this._imageView.setMask(snapshotWithRect.rect);snapshot.commandLog().then(log=>onCommandLogDone.call(this,snapshot,snapshotWithRect.rect,log));});function onCommandLogDone(snapshot,clipRect,log){this._logTreeView.setCommandLog(log||[]);this._paintProfilerView.setSnapshotAndLog(snapshot,log||[],clipRect);}}
_releaseSnapshot(){if(!this._lastLoadedSnapshot)
return;this._lastLoadedSnapshot.release();this._lastLoadedSnapshot=null;}
_onWindowChanged(){this._logTreeView.updateWindow(this._paintProfilerView.selectionWindow());}};Timeline.TimelinePaintImageView=class extends UI.Widget{constructor(){super(true);this.registerRequiredCSS('timeline/timelinePaintProfiler.css');this.contentElement.classList.add('fill','paint-profiler-image-view');this._imageContainer=this.contentElement.createChild('div','paint-profiler-image-container');this._imageElement=this._imageContainer.createChild('img');this._maskElement=this._imageContainer.createChild('div');this._imageElement.addEventListener('load',this._updateImagePosition.bind(this),false);this._transformController=new LayerViewer.TransformController(this.contentElement,true);this._transformController.addEventListener(LayerViewer.TransformController.Events.TransformChanged,this._updateImagePosition,this);}
onResize(){if(this._imageElement.src)
this._updateImagePosition();}
_updateImagePosition(){const width=this._imageElement.naturalWidth;const height=this._imageElement.naturalHeight;const clientWidth=this.contentElement.clientWidth;const clientHeight=this.contentElement.clientHeight;const paddingFraction=0.1;const paddingX=clientWidth*paddingFraction;const paddingY=clientHeight*paddingFraction;const scaleX=(clientWidth-paddingX)/width;const scaleY=(clientHeight-paddingY)/height;const scale=Math.min(scaleX,scaleY);if(this._maskRectangle){const style=this._maskElement.style;style.width=width+'px';style.height=height+'px';style.borderLeftWidth=this._maskRectangle.x+'px';style.borderTopWidth=this._maskRectangle.y+'px';style.borderRightWidth=(width-this._maskRectangle.x-this._maskRectangle.width)+'px';style.borderBottomWidth=(height-this._maskRectangle.y-this._maskRectangle.height)+'px';}
this._transformController.setScaleConstraints(0.5,10/scale);let matrix=new WebKitCSSMatrix().scale(this._transformController.scale(),this._transformController.scale()).translate(clientWidth/2,clientHeight/2).scale(scale,scale).translate(-width/2,-height/2);const bounds=UI.Geometry.boundsForTransformedPoints(matrix,[0,0,0,width,height,0]);this._transformController.clampOffsets(paddingX-bounds.maxX,clientWidth-paddingX-bounds.minX,paddingY-bounds.maxY,clientHeight-paddingY-bounds.minY);matrix=new WebKitCSSMatrix().translate(this._transformController.offsetX(),this._transformController.offsetY()).multiply(matrix);this._imageContainer.style.webkitTransform=matrix.toString();}
showImage(imageURL){this._imageContainer.classList.toggle('hidden',!imageURL);if(imageURL)
this._imageElement.src=imageURL;}
setMask(maskRectangle){this._maskRectangle=maskRectangle;this._maskElement.classList.toggle('hidden',!maskRectangle);}};;Timeline.TimelinePanel=class extends UI.Panel{constructor(){super('timeline');this.registerRequiredCSS('timeline/timelinePanel.css');this.element.addEventListener('contextmenu',this._contextMenu.bind(this),false);this._dropTarget=new UI.DropTarget(this.element,[UI.DropTarget.Type.File,UI.DropTarget.Type.URI],Common.UIString('Drop timeline file or URL here'),this._handleDrop.bind(this));this._recordingOptionUIControls=[];this._state=Timeline.TimelinePanel.State.Idle;this._recordingPageReload=false;this._millisecondsToRecordAfterLoadEvent=3000;this._toggleRecordAction=(UI.actionRegistry.action('timeline.toggle-recording'));this._recordReloadAction=(UI.actionRegistry.action('timeline.record-reload'));this._historyManager=new Timeline.TimelineHistoryManager();this._performanceModel=null;this._viewModeSetting=Common.settings.createSetting('timelineViewMode',Timeline.TimelinePanel.ViewMode.FlameChart);this._disableCaptureJSProfileSetting=Common.settings.createSetting('timelineDisableJSSampling',false);this._disableCaptureJSProfileSetting.setTitle(Common.UIString('Disable JavaScript samples'));this._captureLayersAndPicturesSetting=Common.settings.createSetting('timelineCaptureLayersAndPictures',false);this._captureLayersAndPicturesSetting.setTitle(Common.UIString('Enable advanced paint instrumentation (slow)'));this._showScreenshotsSetting=Common.settings.createSetting('timelineShowScreenshots',true);this._showScreenshotsSetting.setTitle(Common.UIString('Screenshots'));this._showScreenshotsSetting.addChangeListener(this._updateOverviewControls,this);this._showMemorySetting=Common.settings.createSetting('timelineShowMemory',false);this._showMemorySetting.setTitle(Common.UIString('Memory'));this._showMemorySetting.addChangeListener(this._onModeChanged,this);const timelineToolbarContainer=this.element.createChild('div','timeline-toolbar-container');this._panelToolbar=new UI.Toolbar('timeline-main-toolbar',timelineToolbarContainer);this._panelRightToolbar=new UI.Toolbar('',timelineToolbarContainer);this._createSettingsPane();this._updateShowSettingsToolbarButton();this._timelinePane=new UI.VBox();this._timelinePane.show(this.element);const topPaneElement=this._timelinePane.element.createChild('div','hbox');topPaneElement.id='timeline-overview-panel';this._overviewPane=new PerfUI.TimelineOverviewPane('timeline');this._overviewPane.addEventListener(PerfUI.TimelineOverviewPane.Events.WindowChanged,this._onOverviewWindowChanged.bind(this));this._overviewPane.show(topPaneElement);this._overviewControls=[];this._statusPaneContainer=this._timelinePane.element.createChild('div','status-pane-container fill');this._createFileSelector();SDK.targetManager.addModelListener(SDK.ResourceTreeModel,SDK.ResourceTreeModel.Events.Load,this._loadEventFired,this);this._flameChart=new Timeline.TimelineFlameChartView(this);this._searchableView=new UI.SearchableView(this._flameChart);this._searchableView.setMinimumSize(0,100);this._searchableView.element.classList.add('searchable-view');this._searchableView.show(this._timelinePane.element);this._flameChart.show(this._searchableView.element);this._flameChart.setSearchableView(this._searchableView);this._onModeChanged();this._populateToolbar();this._showLandingPage();this._updateTimelineControls();Extensions.extensionServer.addEventListener(Extensions.ExtensionServer.Events.TraceProviderAdded,this._appendExtensionsToToolbar,this);SDK.targetManager.addEventListener(SDK.TargetManager.Events.SuspendStateChanged,this._onSuspendStateChanged,this);}
static instance(){return(self.runtime.sharedInstance(Timeline.TimelinePanel));}
searchableView(){return this._searchableView;}
wasShown(){UI.context.setFlavor(Timeline.TimelinePanel,this);Host.perfMetrics.markSingleton('DevTools.Launch.Timeline',true);}
willHide(){UI.context.setFlavor(Timeline.TimelinePanel,null);this._historyManager.cancelIfShowing();}
loadFromEvents(events){if(this._state!==Timeline.TimelinePanel.State.Idle)
return;this._prepareToLoadTimeline();this._loader=Timeline.TimelineLoader.loadFromEvents(events,this);}
_onOverviewWindowChanged(event){const left=event.data.startTime;const right=event.data.endTime;this._performanceModel.setWindow({left,right},true);}
_onModelWindowChanged(event){const window=(event.data.window);this._overviewPane.setWindowTimes(window.left,window.right);}
_setState(state){this._state=state;this._updateTimelineControls();}
_createSettingCheckbox(setting,tooltip){const checkboxItem=new UI.ToolbarSettingCheckbox(setting,tooltip);this._recordingOptionUIControls.push(checkboxItem);return checkboxItem;}
_populateToolbar(){this._panelToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._toggleRecordAction));this._panelToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._recordReloadAction));this._clearButton=new UI.ToolbarButton(Common.UIString('Clear'),'largeicon-clear');this._clearButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this._onClearButton());this._panelToolbar.appendToolbarItem(this._clearButton);this._loadButton=new UI.ToolbarButton(Common.UIString('Load profile...'),'largeicon-load');this._loadButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this._selectFileToLoad());this._saveButton=new UI.ToolbarButton(Common.UIString('Save profile...'),'largeicon-download');this._saveButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this._saveToFile());this._panelToolbar.appendSeparator();this._panelToolbar.appendToolbarItem(this._loadButton);this._panelToolbar.appendToolbarItem(this._saveButton);this._panelToolbar.appendSeparator();this._panelToolbar.appendToolbarItem(this._historyManager.button());this._panelToolbar.appendSeparator();this._panelToolbar.appendSeparator();this._showScreenshotsToolbarCheckbox=this._createSettingCheckbox(this._showScreenshotsSetting,Common.UIString('Capture screenshots'));this._panelToolbar.appendToolbarItem(this._showScreenshotsToolbarCheckbox);this._showMemoryToolbarCheckbox=this._createSettingCheckbox(this._showMemorySetting,Common.UIString('Show memory timeline'));this._panelToolbar.appendToolbarItem(this._showMemoryToolbarCheckbox);this._panelToolbar.appendToolbarItem(UI.Toolbar.createActionButtonForId('components.collect-garbage'));this._panelRightToolbar.appendSeparator();this._panelRightToolbar.appendToolbarItem(this._showSettingsPaneButton);}
_createSettingsPane(){this._showSettingsPaneSetting=Common.settings.createSetting('timelineShowSettingsToolbar',false);this._showSettingsPaneButton=new UI.ToolbarSettingToggle(this._showSettingsPaneSetting,'largeicon-settings-gear',Common.UIString('Capture settings'));SDK.multitargetNetworkManager.addEventListener(SDK.MultitargetNetworkManager.Events.ConditionsChanged,this._updateShowSettingsToolbarButton,this);MobileThrottling.throttlingManager().addEventListener(MobileThrottling.ThrottlingManager.Events.RateChanged,this._updateShowSettingsToolbarButton,this);this._disableCaptureJSProfileSetting.addChangeListener(this._updateShowSettingsToolbarButton,this);this._captureLayersAndPicturesSetting.addChangeListener(this._updateShowSettingsToolbarButton,this);this._settingsPane=new UI.HBox();this._settingsPane.element.classList.add('timeline-settings-pane');this._settingsPane.show(this.element);const captureToolbar=new UI.Toolbar('',this._settingsPane.element);captureToolbar.element.classList.add('flex-auto');captureToolbar.makeVertical();captureToolbar.appendToolbarItem(this._createSettingCheckbox(this._disableCaptureJSProfileSetting,Common.UIString('Disables JavaScript sampling, reduces overhead when running against mobile devices')));captureToolbar.appendToolbarItem(this._createSettingCheckbox(this._captureLayersAndPicturesSetting,Common.UIString('Captures advanced paint instrumentation, introduces significant performance overhead')));const throttlingPane=new UI.VBox();throttlingPane.element.classList.add('flex-auto');throttlingPane.show(this._settingsPane.element);const networkThrottlingToolbar=new UI.Toolbar('',throttlingPane.element);networkThrottlingToolbar.appendText(Common.UIString('Network:'));this._networkThrottlingSelect=this._createNetworkConditionsSelect();networkThrottlingToolbar.appendToolbarItem(this._networkThrottlingSelect);const cpuThrottlingToolbar=new UI.Toolbar('',throttlingPane.element);cpuThrottlingToolbar.appendText(Common.UIString('CPU:'));this._cpuThrottlingSelect=MobileThrottling.throttlingManager().createCPUThrottlingSelector();cpuThrottlingToolbar.appendToolbarItem(this._cpuThrottlingSelect);this._showSettingsPaneSetting.addChangeListener(this._updateSettingsPaneVisibility.bind(this));this._updateSettingsPaneVisibility();}
_appendExtensionsToToolbar(event){const provider=(event.data);const setting=Timeline.TimelinePanel._settingForTraceProvider(provider);const checkbox=this._createSettingCheckbox(setting,provider.longDisplayName());this._panelToolbar.appendToolbarItem(checkbox);}
static _settingForTraceProvider(traceProvider){let setting=traceProvider[Timeline.TimelinePanel._traceProviderSettingSymbol];if(!setting){const providerId=traceProvider.persistentIdentifier();setting=Common.settings.createSetting(providerId,false);setting.setTitle(traceProvider.shortDisplayName());traceProvider[Timeline.TimelinePanel._traceProviderSettingSymbol]=setting;}
return setting;}
_createNetworkConditionsSelect(){const toolbarItem=new UI.ToolbarComboBox(null);toolbarItem.setTitle(ls`Select network conditions`);toolbarItem.setMaxWidth(140);MobileThrottling.throttlingManager().decorateSelectWithNetworkThrottling(toolbarItem.selectElement());return toolbarItem;}
_prepareToLoadTimeline(){console.assert(this._state===Timeline.TimelinePanel.State.Idle);this._setState(Timeline.TimelinePanel.State.Loading);if(this._performanceModel){this._performanceModel.dispose();this._performanceModel=null;}}
_createFileSelector(){if(this._fileSelectorElement)
this._fileSelectorElement.remove();this._fileSelectorElement=UI.createFileSelectorElement(this._loadFromFile.bind(this));this._timelinePane.element.appendChild(this._fileSelectorElement);}
_contextMenu(event){const contextMenu=new UI.ContextMenu(event);contextMenu.appendItemsAtLocation('timelineMenu');contextMenu.show();}
async _saveToFile(){if(this._state!==Timeline.TimelinePanel.State.Idle)
return;const performanceModel=this._performanceModel;if(!performanceModel)
return;const now=new Date();const fileName='Profile-'+now.toISO8601Compact()+'.json';const stream=new Bindings.FileOutputStream();const accepted=await stream.open(fileName);if(!accepted)
return;const error=await performanceModel.save(stream);if(!error)
return;Common.console.error(Common.UIString('Failed to save timeline: %s (%s, %s)',error.message,error.name,error.code));}
async _showHistory(){const model=await this._historyManager.showHistoryDropDown();if(model&&model!==this._performanceModel)
this._setModel(model);}
_navigateHistory(direction){const model=this._historyManager.navigate(direction);if(model&&model!==this._performanceModel)
this._setModel(model);return true;}
_selectFileToLoad(){this._fileSelectorElement.click();}
_loadFromFile(file){if(this._state!==Timeline.TimelinePanel.State.Idle)
return;this._prepareToLoadTimeline();this._loader=Timeline.TimelineLoader.loadFromFile(file,this);this._createFileSelector();}
_loadFromURL(url){if(this._state!==Timeline.TimelinePanel.State.Idle)
return;this._prepareToLoadTimeline();this._loader=Timeline.TimelineLoader.loadFromURL(url,this);}
_updateOverviewControls(){this._overviewControls=[];this._overviewControls.push(new Timeline.TimelineEventOverviewResponsiveness());if(Runtime.experiments.isEnabled('inputEventsOnTimelineOverview'))
this._overviewControls.push(new Timeline.TimelineEventOverviewInput());this._overviewControls.push(new Timeline.TimelineEventOverviewFrames());this._overviewControls.push(new Timeline.TimelineEventOverviewCPUActivity());this._overviewControls.push(new Timeline.TimelineEventOverviewNetwork());if(this._showScreenshotsSetting.get()&&this._performanceModel&&this._performanceModel.filmStripModel().frames().length)
this._overviewControls.push(new Timeline.TimelineFilmStripOverview());if(this._showMemorySetting.get())
this._overviewControls.push(new Timeline.TimelineEventOverviewMemory());for(const control of this._overviewControls)
control.setModel(this._performanceModel);this._overviewPane.setOverviewControls(this._overviewControls);}
_onModeChanged(){this._updateOverviewControls();this.doResize();this.select(null);}
_updateSettingsPaneVisibility(){if(this._showSettingsPaneSetting.get())
this._settingsPane.showWidget();else
this._settingsPane.hideWidget();}
_updateShowSettingsToolbarButton(){const messages=[];if(MobileThrottling.throttlingManager().cpuThrottlingRate()!==1)
messages.push(Common.UIString('- CPU throttling is enabled'));if(SDK.multitargetNetworkManager.isThrottling())
messages.push(Common.UIString('- Network throttling is enabled'));if(this._captureLayersAndPicturesSetting.get())
messages.push(Common.UIString('- Significant overhead due to paint instrumentation'));if(this._disableCaptureJSProfileSetting.get())
messages.push(Common.UIString('- JavaScript sampling is disabled'));this._showSettingsPaneButton.setDefaultWithRedColor(messages.length);this._showSettingsPaneButton.setToggleWithRedColor(messages.length);if(messages.length){const tooltipElement=createElement('div');messages.forEach(message=>{tooltipElement.createChild('div').textContent=message;});this._showSettingsPaneButton.setTitle(tooltipElement);}else{this._showSettingsPaneButton.setTitle(Common.UIString('Capture settings'));}}
_setUIControlsEnabled(enabled){this._recordingOptionUIControls.forEach(control=>control.setEnabled(enabled));}
async _startRecording(){console.assert(!this._statusPane,'Status pane is already opened.');this._setState(Timeline.TimelinePanel.State.StartPending);this._showRecordingStarted();const enabledTraceProviders=Extensions.extensionServer.traceProviders().filter(provider=>Timeline.TimelinePanel._settingForTraceProvider(provider).get());const recordingOptions={enableJSSampling:!this._disableCaptureJSProfileSetting.get(),capturePictures:this._captureLayersAndPicturesSetting.get(),captureFilmStrip:this._showScreenshotsSetting.get()};const mainTarget=(SDK.targetManager.mainTarget());this._controller=new Timeline.TimelineController(mainTarget,this);this._setUIControlsEnabled(false);this._hideLandingPage();const response=await this._controller.startRecording(recordingOptions,enabledTraceProviders);if(response[Protocol.Error])
this._recordingFailed(response[Protocol.Error]);else
this._recordingStarted();}
async _stopRecording(){if(this._statusPane){this._statusPane.finish();this._statusPane.updateStatus(Common.UIString('Stopping timeline\u2026'));this._statusPane.updateProgressBar(Common.UIString('Received'),0);}
this._setState(Timeline.TimelinePanel.State.StopPending);const model=await this._controller.stopRecording();this._performanceModel=model;this._setUIControlsEnabled(true);this._controller.dispose();this._controller=null;}
_recordingFailed(error){if(this._statusPane)
this._statusPane.hide();this._statusPane=new Timeline.TimelinePanel.StatusPane({description:error},()=>this.loadingComplete(null));this._statusPane.showPane(this._statusPaneContainer);this._statusPane.updateStatus(ls`Recording failed`);this._statusPane.updateButton(ls`Close`);this._setState(Timeline.TimelinePanel.State.RecordingFailed);this._performanceModel=null;this._setUIControlsEnabled(false);this._controller.dispose();this._controller=null;}
_onSuspendStateChanged(){this._updateTimelineControls();}
_updateTimelineControls(){const state=Timeline.TimelinePanel.State;this._toggleRecordAction.setToggled(this._state===state.Recording);this._toggleRecordAction.setEnabled(this._state===state.Recording||this._state===state.Idle);this._recordReloadAction.setEnabled(this._state===state.Idle);this._historyManager.setEnabled(this._state===state.Idle);this._clearButton.setEnabled(this._state===state.Idle);this._panelToolbar.setEnabled(this._state!==state.Loading);this._panelRightToolbar.setEnabled(this._state!==state.Loading);this._dropTarget.setEnabled(this._state===state.Idle);this._loadButton.setEnabled(this._state===state.Idle);this._saveButton.setEnabled(this._state===state.Idle&&!!this._performanceModel);}
_toggleRecording(){if(this._state===Timeline.TimelinePanel.State.Idle){this._recordingPageReload=false;this._startRecording();Host.userMetrics.actionTaken(Host.UserMetrics.Action.TimelineStarted);}else if(this._state===Timeline.TimelinePanel.State.Recording){this._stopRecording();}}
_recordReload(){if(this._state!==Timeline.TimelinePanel.State.Idle)
return;this._recordingPageReload=true;this._startRecording();Host.userMetrics.actionTaken(Host.UserMetrics.Action.TimelinePageReloadStarted);}
_onClearButton(){this._historyManager.clear();this._clear();}
_clear(){this._showLandingPage();this._reset();}
_reset(){self.runtime.sharedInstance(PerfUI.LineLevelProfile.Performance).reset();this._setModel(null);}
_applyFilters(model){if(model.timelineModel().isGenericTrace()||Runtime.experiments.isEnabled('timelineShowAllEvents'))
return;model.setFilters([Timeline.TimelineUIUtils.visibleEventsFilter()]);}
_setModel(model){if(this._performanceModel){this._performanceModel.removeEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onModelWindowChanged,this);}
this._performanceModel=model;if(model)
this._applyFilters(model);this._flameChart.setModel(model);this._updateOverviewControls();this._overviewPane.reset();if(model){this._performanceModel.addEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onModelWindowChanged,this);this._overviewPane.setBounds(model.timelineModel().minimumRecordTime(),model.timelineModel().maximumRecordTime());const lineLevelProfile=self.runtime.sharedInstance(PerfUI.LineLevelProfile.Performance);lineLevelProfile.reset();for(const profile of model.timelineModel().cpuProfiles())
lineLevelProfile.appendCPUProfile(profile);this._setMarkers(model.timelineModel());this._flameChart.setSelection(null);this._overviewPane.setWindowTimes(model.window().left,model.window().right);}
for(const control of this._overviewControls)
control.setModel(model);if(this._flameChart)
this._flameChart.resizeToPreferredHeights();this._updateTimelineControls();}
_recordingStarted(){if(this._recordingPageReload){const target=this._controller.mainTarget();const resourceModel=target.model(SDK.ResourceTreeModel);if(resourceModel)
resourceModel.reloadPage();}
this._reset();this._setState(Timeline.TimelinePanel.State.Recording);this._showRecordingStarted();this._statusPane.updateStatus(Common.UIString('Profiling\u2026'));this._statusPane.updateProgressBar(Common.UIString('Buffer usage'),0);this._statusPane.startTimer();this._hideLandingPage();}
recordingProgress(usage){this._statusPane.updateProgressBar(Common.UIString('Buffer usage'),usage*100);}
_showLandingPage(){if(this._landingPage){this._landingPage.show(this._statusPaneContainer);return;}
function encloseWithTag(tagName,contents){const e=createElement(tagName);e.textContent=contents;return e;}
const learnMoreNode=UI.DisabledXLink.create('https://aka.ms/docs-landing-page',Common.UIString('Learn\xa0more'),true);const recordKey=encloseWithTag('b',UI.shortcutRegistry.shortcutDescriptorsForAction('timeline.toggle-recording')[0].name);const reloadKey=encloseWithTag('b',UI.shortcutRegistry.shortcutDescriptorsForAction('timeline.record-reload')[0].name);const navigateNode=encloseWithTag('b',Common.UIString('WASD'));this._landingPage=new UI.VBox();this._landingPage.contentElement.classList.add('timeline-landing-page','fill');const centered=this._landingPage.contentElement.createChild('div');const recordButton=UI.createInlineButton(UI.Toolbar.createActionButton(this._toggleRecordAction));const reloadButton=UI.createInlineButton(UI.Toolbar.createActionButtonForId('timeline.record-reload'));centered.createChild('p').appendChild(UI.formatLocalized('Click the record button %s or hit %s to start a new recording.\nClick the refresh button %s or hit %s to record the page load.',[recordButton,recordKey,reloadButton,reloadKey]));centered.createChild('p').appendChild(UI.formatLocalized('After recording, select an area of interest in the overview by dragging.\nThen, zoom and pan the timeline with the mousewheel or %s keys.\n%s',[navigateNode,learnMoreNode]));this._landingPage.show(this._statusPaneContainer);}
_hideLandingPage(){this._landingPage.detach();}
loadingStarted(){this._hideLandingPage();if(this._statusPane)
this._statusPane.hide();this._statusPane=new Timeline.TimelinePanel.StatusPane({showProgress:true},this._cancelLoading.bind(this));this._statusPane.showPane(this._statusPaneContainer);this._statusPane.updateStatus(Common.UIString('Loading profile\u2026'));if(!this._loader)
this._statusPane.finish();this.loadingProgress(0);}
loadingProgress(progress){if(typeof progress==='number')
this._statusPane.updateProgressBar(Common.UIString('Received'),progress*100);}
processingStarted(){this._statusPane.updateStatus(Common.UIString('Processing profile\u2026'));}
loadingComplete(tracingModel){delete this._loader;this._setState(Timeline.TimelinePanel.State.Idle);if(this._statusPane)
this._statusPane.hide();delete this._statusPane;if(!tracingModel){this._clear();return;}
if(!this._performanceModel)
this._performanceModel=new Timeline.PerformanceModel();this._performanceModel.setTracingModel(tracingModel);this._setModel(this._performanceModel);this._historyManager.addRecording(this._performanceModel);}
_showRecordingStarted(){if(this._statusPane)
return;this._statusPane=new Timeline.TimelinePanel.StatusPane({showTimer:true,showProgress:true},this._stopRecording.bind(this));this._statusPane.showPane(this._statusPaneContainer);this._statusPane.updateStatus(Common.UIString('Initializing profiler\u2026'));}
_cancelLoading(){if(this._loader)
this._loader.cancel();}
_setMarkers(timelineModel){const markers=new Map();const recordTypes=TimelineModel.TimelineModel.RecordType;const zeroTime=timelineModel.minimumRecordTime();for(const event of timelineModel.timeMarkerEvents()){if(event.name===recordTypes.TimeStamp||event.name===recordTypes.ConsoleTime)
continue;markers.set(event.startTime,Timeline.TimelineUIUtils.createEventDivider(event,zeroTime));}
this._overviewPane.setMarkers(markers);}
async _loadEventFired(event){if(this._state!==Timeline.TimelinePanel.State.Recording||!this._recordingPageReload||this._controller.mainTarget()!==event.data.resourceTreeModel.target())
return;const controller=this._controller;await new Promise(r=>setTimeout(r,this._millisecondsToRecordAfterLoadEvent));if(controller!==this._controller||this._state!==Timeline.TimelinePanel.State.Recording)
return;this._stopRecording();}
_frameForSelection(selection){switch(selection.type()){case Timeline.TimelineSelection.Type.Frame:return(selection.object());case Timeline.TimelineSelection.Type.Range:return null;case Timeline.TimelineSelection.Type.TraceEvent:return this._performanceModel.frameModel().frames(selection._endTime,selection._endTime)[0];default:console.assert(false,'Should never be reached');return null;}}
_jumpToFrame(offset){const currentFrame=this._selection&&this._frameForSelection(this._selection);if(!currentFrame)
return;const frames=this._performanceModel.frames();let index=frames.indexOf(currentFrame);console.assert(index>=0,'Can\'t find current frame in the frame list');index=Number.constrain(index+offset,0,frames.length-1);const frame=frames[index];this._revealTimeRange(frame.startTime,frame.endTime);this.select(Timeline.TimelineSelection.fromFrame(frame));return true;}
select(selection){this._selection=selection;this._flameChart.setSelection(selection);}
selectEntryAtTime(events,time){if(!events)
return;for(let index=events.upperBound(time,(time,event)=>time-event.startTime)-1;index>=0;--index){const event=events[index];const endTime=event.endTime||event.startTime;if(SDK.TracingModel.isTopLevelEvent(event)&&endTime<time)
break;if(this._performanceModel.isVisible(event)&&endTime>=time){this.select(Timeline.TimelineSelection.fromTraceEvent(event));return;}}
this.select(null);}
highlightEvent(event){this._flameChart.highlightEvent(event);}
_revealTimeRange(startTime,endTime){const window=this._performanceModel.window();let offset=0;if(window.right<endTime)
offset=endTime-window.right;else if(window.left>startTime)
offset=startTime-window.left;this._performanceModel.setWindow({left:window.left+offset,right:window.right+offset},true);}
_handleDrop(dataTransfer){const items=dataTransfer.items;if(!items.length)
return;const item=items[0];if(item.kind==='string'){const url=dataTransfer.getData('text/uri-list');if(new Common.ParsedURL(url).isValid)
this._loadFromURL(url);}else if(item.kind==='file'){const entry=items[0].webkitGetAsEntry();if(!entry.isFile)
return;entry.file(this._loadFromFile.bind(this));}}};Timeline.TimelinePanel.State={Idle:Symbol('Idle'),StartPending:Symbol('StartPending'),Recording:Symbol('Recording'),StopPending:Symbol('StopPending'),Loading:Symbol('Loading'),RecordingFailed:Symbol('RecordingFailed')};Timeline.TimelinePanel.ViewMode={FlameChart:'FlameChart',BottomUp:'BottomUp',CallTree:'CallTree',EventLog:'EventLog'};Timeline.TimelinePanel.rowHeight=18;Timeline.TimelinePanel.headerHeight=20;Timeline.TimelinePanel.ModelSelectionData;Timeline.TimelineSelection=class{constructor(type,startTime,endTime,object){this._type=type;this._startTime=startTime;this._endTime=endTime;this._object=object||null;}
static fromFrame(frame){return new Timeline.TimelineSelection(Timeline.TimelineSelection.Type.Frame,frame.startTime,frame.endTime,frame);}
static fromNetworkRequest(request){return new Timeline.TimelineSelection(Timeline.TimelineSelection.Type.NetworkRequest,request.startTime,request.endTime||request.startTime,request);}
static fromTraceEvent(event){return new Timeline.TimelineSelection(Timeline.TimelineSelection.Type.TraceEvent,event.startTime,event.endTime||(event.startTime+1),event);}
static fromRange(startTime,endTime){return new Timeline.TimelineSelection(Timeline.TimelineSelection.Type.Range,startTime,endTime);}
type(){return this._type;}
object(){return this._object;}
startTime(){return this._startTime;}
endTime(){return this._endTime;}};Timeline.TimelineSelection.Type={Frame:'Frame',NetworkRequest:'NetworkRequest',TraceEvent:'TraceEvent',Range:'Range'};Timeline.TimelineModeViewDelegate=function(){};Timeline.TimelineModeViewDelegate.prototype={select(selection){},selectEntryAtTime(events,time){},highlightEvent(event){},};Timeline.TimelinePanel.StatusPane=class extends UI.VBox{constructor(options,stopCallback){super(true);this.registerRequiredCSS('timeline/timelineStatusDialog.css');this.contentElement.classList.add('timeline-status-dialog');const statusLine=this.contentElement.createChild('div','status-dialog-line status');statusLine.createChild('div','label').textContent=Common.UIString('Status');this._status=statusLine.createChild('div','content');UI.ARIAUtils.markAsStatus(this._status);if(options.showTimer){const timeLine=this.contentElement.createChild('div','status-dialog-line time');timeLine.createChild('div','label').textContent=Common.UIString('Time');this._time=timeLine.createChild('div','content');}
if(options.showProgress){const progressLine=this.contentElement.createChild('div','status-dialog-line progress');this._progressLabel=progressLine.createChild('div','label');this._progressBar=progressLine.createChild('div','indicator-container').createChild('div','indicator');UI.ARIAUtils.markAsProgressBar(this._progressBar);}
if(typeof options.description==='string'){const descriptionLine=this.contentElement.createChild('div','status-dialog-line description');descriptionLine.createChild('div','label').textContent=ls`Description`;this._description=descriptionLine.createChild('div','content');this._description.innerText=options.description;}
this._stopButton=UI.createTextButton(Common.UIString('Stop'),stopCallback,'',true);this.contentElement.createChild('div','stop-button').appendChild(this._stopButton);}
finish(){this._stopTimer();this._stopButton.disabled=true;}
hide(){this.element.parentNode.classList.remove('tinted');this.element.remove();}
showPane(parent){this.show(parent);parent.classList.add('tinted');this._stopButton.focus();}
updateStatus(text){this._status.textContent=text;}
updateProgressBar(activity,percent){this._progressLabel.textContent=activity;this._progressBar.style.width=percent.toFixed(1)+'%';UI.ARIAUtils.setProgressBarCurrentPercentage(this._progressBar,percent);this._updateTimer();}
updateButton(caption){this._stopButton.innerText=caption;}
startTimer(){this._startTime=Date.now();this._timeUpdateTimer=setInterval(this._updateTimer.bind(this,false),1000);this._updateTimer();}
_stopTimer(){if(!this._timeUpdateTimer)
return;clearInterval(this._timeUpdateTimer);this._updateTimer(true);delete this._timeUpdateTimer;}
_updateTimer(precise){if(!this._timeUpdateTimer)
return;const elapsed=(Date.now()-this._startTime)/1000;this._time.textContent=Common.UIString('%s\xa0sec',elapsed.toFixed(precise?1:0));}};Timeline.LoadTimelineHandler=class{handleQueryParam(value){UI.viewManager.showView('timeline').then(()=>{Timeline.TimelinePanel.instance()._loadFromURL(window.decodeURIComponent(value));});}};Timeline.TimelinePanel.ActionDelegate=class{handleAction(context,actionId){const panel=UI.context.flavor(Timeline.TimelinePanel);console.assert(panel&&panel instanceof Timeline.TimelinePanel);switch(actionId){case'timeline.toggle-recording':panel._toggleRecording();return true;case'timeline.record-reload':panel._recordReload();return true;case'timeline.save-to-file':panel._saveToFile();return true;case'timeline.load-from-file':panel._selectFileToLoad();return true;case'timeline.jump-to-previous-frame':panel._jumpToFrame(-1);return true;case'timeline.jump-to-next-frame':panel._jumpToFrame(1);return true;case'timeline.show-history':panel._showHistory();return true;case'timeline.previous-recording':panel._navigateHistory(1);return true;case'timeline.next-recording':panel._navigateHistory(-1);return true;}
return false;}};Timeline.TimelinePanel._traceProviderSettingSymbol=Symbol('traceProviderSetting');;Runtime.cachedResources["timeline/historyToolbarButton.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.content {\n  margin-left: 5px;\n}\n\n.history-dropdown-button {\n  width: 160px;\n  height: 26px;\n  text-align: left;\n  display: flex;\n}\n\n.history-dropdown-button[disabled] {\n  opacity: .5;\n}\n\n.history-dropdown-button > .content {\n  padding-right: 5px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  flex: 1 1;\n  min-width: 35px;\n}\n\n.history-dropdown-button[data-keyboard-focus=\"true\"]:focus::before {\n  content: \"\";\n  position: absolute;\n  top: 2px;\n  left: 0px;\n  right: 0px;\n  bottom: 2px;\n  border-radius: 2px;\n  background: rgba(0, 0, 0, 0.08);\n}\n/*# sourceURL=timeline/historyToolbarButton.css */";Runtime.cachedResources["timeline/invalidationsTree.css"]="/*\n * Copyright 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.header, .children, .content {\n    min-height: initial;\n    line-height: initial;\n}\n\n/* This TreeElement is always expanded and has no arrow.   */\n/* FIXME(crbug.com/475618): Implement this in TreeElement. */\n.children li::before {\n    display: none;\n}\n\n.content {\n    margin-bottom: 4px;\n}\n\n.content .stack-preview-container {\n    margin-left: 8px;\n}\n\n.content .node-list {\n    margin-left: 10px;\n}\n\n/*# sourceURL=timeline/invalidationsTree.css */";Runtime.cachedResources["timeline/timelineFlamechartPopover.css"]="/*\n * Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.timeline-flamechart-popover {\n    overflow: hidden;\n}\n\n.timeline-flamechart-popover span {\n    margin-right: 5px;\n}\n\n.timeline-flamechart-popover span.timeline-info-network-time {\n    color: #009;\n}\n\n.timeline-flamechart-popover span.timeline-info-time {\n    color: #282;\n}\n\n.timeline-flamechart-popover span.timeline-info-warning {\n    color: #e44;\n}\n\n.timeline-flamechart-popover span.timeline-info-warning * {\n    color: inherit;\n}\n\n/*# sourceURL=timeline/timelineFlamechartPopover.css */";Runtime.cachedResources["timeline/timelineHistoryManager.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.drop-down {\n  padding: 1px;\n  box-shadow: var(--drop-shadow);\n  background: white;\n}\n\n.preview-item {\n  border-color: transparent;\n  border-style: solid;\n  border-width: 1px 5px;\n  padding: 2px 0px;\n  margin: 2px 1px;\n}\n\n.preview-item.selected {\n  border-color: var(--selection-bg-color);\n}\n\n.preview-item canvas {\n  width: 100%;\n  height: 100%;\n}\n\n.text-details {\n  font-size: 11px;\n  padding: 3px;\n}\n\n.text-details span {\n  flex: 1 0;\n  padding-left: 8px;\n  padding-right: 8px;\n}\n\n.text-details .name {\n  font-weight: bold;\n}\n\n.text-details span.time {\n  color: #555;\n  text-align: right;\n}\n\n.screenshot-thumb {\n  display: flex;\n  border: 1px solid #ccc;\n  margin: 2px 4px;\n}\n\n.screenshot-thumb img {\n  margin: auto;\n  max-width: 100%;\n  max-height: 100%;\n}\n\n/*# sourceURL=timeline/timelineHistoryManager.css */";Runtime.cachedResources["timeline/timelinePanel.css"]="/*\n * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.timeline-toolbar-container {\n    display: flex;\n    flex: none;\n}\n\n.timeline-toolbar-container > .toolbar {\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.timeline-main-toolbar {\n    flex: 1 1 auto;\n}\n\n.timeline-settings-pane {\n    flex: none;\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n#timeline-overview-panel {\n    flex: none;\n    position: relative;\n    border-bottom: 1px solid #bbb;\n}\n\n#timeline-overview-grid {\n    background-color: rgb(255, 255, 255);\n}\n\n#timeline-overview-grid .timeline-grid-header {\n    height: 12px;\n}\n\n#timeline-overview-grid .resources-dividers-label-bar {\n    pointer-events: auto;\n    height: 12px;\n}\n\n#timeline-overview-grid .resources-divider-label {\n    top: 1px;\n}\n\n.timeline-details-split {\n    flex: auto;\n}\n\n.timeline.panel .status-pane-container {\n    z-index: 1000;\n    display: flex;\n    align-items: center;\n    pointer-events: none;\n}\n\n.timeline.panel .status-pane-container.tinted {\n    background-color: lightgray;\n    pointer-events: auto;\n}\n\n.timeline.panel .status-pane-container > div {\n    pointer-events: auto;\n}\n\n#timeline-overview-panel .overview-strip {\n    margin-top: 2px;\n    justify-content: center;\n}\n\n#timeline-overview-panel .overview-strip .timeline-overview-strip-title {\n    color: #666;\n    font-size: 10px;\n    font-weight: bold;\n    z-index: 100;\n    background-color: rgba(255, 255, 255, 0.7);\n    padding: 0 4px;\n    position: absolute;\n    top: -2px;\n    right: 0;\n}\n\n#timeline-overview-cpu-activity {\n    flex-basis: 20px;\n}\n\n#timeline-overview-network {\n    flex-basis: 8px;\n}\n\n#timeline-overview-framerate {\n    flex-basis: 16px;\n    margin-top: 0 !important;\n}\n\n#timeline-overview-filmstrip {\n    flex-basis: 30px;\n}\n\n#timeline-overview-memory {\n    flex-basis: 20px;\n}\n\n#timeline-overview-framerate::before,\n#timeline-overview-network::before,\n#timeline-overview-cpu-activity::before {\n    content: \"\";\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    border-bottom: 1px solid hsla(0, 0%, 0%, 0.06);\n    z-index: -200;\n}\n\n.overview-strip .background {\n    z-index: -10;\n}\n\n#timeline-overview-responsiveness {\n    flex-basis: 5px;\n    margin-top: 0 !important;\n}\n\n#timeline-overview-input {\n    flex-basis: 6px;\n}\n\n#timeline-overview-pane {\n    flex: auto;\n    position: relative;\n    overflow: hidden;\n}\n\n#timeline-overview-container {\n    display: flex;\n    flex-direction: column;\n    flex: none;\n    position: relative;\n    overflow: hidden;\n}\n\n#timeline-overview-container canvas {\n    width: 100%;\n    height: 100%;\n}\n\n.popover ul {\n    margin: 0;\n    padding: 0;\n    list-style-type: none;\n}\n\n.memory-graph-label {\n    position: absolute;\n    right: 0;\n    bottom: 0;\n    font-size: 9px;\n    color: #888;\n    white-space: nowrap;\n    padding: 0 4px;\n    background-color: hsla(0, 0%, 100%, 0.8);\n}\n\n#memory-graphs-canvas-container {\n    overflow: hidden;\n    flex: auto;\n    position: relative;\n}\n\n#memory-counters-graph {\n    flex: auto;\n}\n\n#memory-graphs-canvas-container .memory-counter-marker {\n    position: absolute;\n    border-radius: 3px;\n    width: 5px;\n    height: 5px;\n    margin-left: -3px;\n    margin-top: -2px;\n}\n\n#memory-graphs-container .timeline-memory-header {\n    flex: 0 0 26px;\n    background-color: #eee;\n    border-bottom: 1px solid #ddd;\n    justify-content: space-between;\n}\n\n#memory-graphs-container .timeline-memory-header::after {\n    content: \"\";\n    background-image: url(Images/toolbarResizerVertical.png);\n    background-repeat: no-repeat;\n    background-position: right center, center;\n    flex: 20px 0 0;\n    margin: 0 4px;\n}\n\n.timeline-memory-toolbar {\n    flex-shrink: 1;\n}\n\n.memory-counter-value {\n    margin: 8px;\n}\n\n#counter-values-bar {\n    flex: 0 0 20px;\n    border-top: solid 1px lightgray;\n    width: 100%;\n    overflow: hidden;\n    line-height: 18px;\n}\n\n.timeline-details {\n    vertical-align: top;\n}\n\n.timeline-details-title {\n    border-bottom: 1px solid #B8B8B8;\n    font-weight: bold;\n    padding-bottom: 5px;\n    padding-top: 0;\n    white-space: nowrap;\n}\n\n.timeline-details-row-title {\n    font-weight: bold;\n    text-align: right;\n    white-space: nowrap;\n}\n\n.timeline-details-row-data {\n    white-space: nowrap;\n}\n\n.timeline-details-view {\n    color: #333;\n    overflow: hidden;\n}\n\n.timeline-details-view-body {\n    flex: auto;\n    overflow: auto;\n    position: relative;\n    background-color: var(--toolbar-bg-color);\n    -webkit-user-select: text;\n}\n\n.timeline-details-view-body > div {\n    overflow: hidden;\n}\n\n.timeline-details-view-block {\n    flex: none;\n    display: flex;\n    background-color: white;\n    flex-direction: column;\n    padding-bottom: 5px;\n    border-bottom: var(--divider-border);\n}\n\n.timeline-details-view-row {\n    padding-left: 10px;\n    flex-direction: row;\n    display: flex;\n    line-height: 20px;\n}\n\n.timeline-details-view-block .timeline-details-stack-values {\n    flex-direction: column !important;\n}\n\n.timeline-details-chip-title {\n    font-size: 13px;\n    padding: 8px;\n    display: flex;\n    align-items: center;\n}\n\n.timeline-details-chip-title > div {\n    width: 12px;\n    height: 12px;\n    border: 1px solid rgba(0, 0, 0, 0.2);\n    display: inline-block;\n    margin-right: 4px;\n    content: \" \";\n}\n\n.timeline-details-view-row-title:not(:empty) {\n    color: rgb(152, 152, 152);\n    overflow: hidden;\n    padding-right: 10px;\n}\n\n.timeline-details-warning {\n    background-color: rgba(250, 209, 209, 0.48);\n}\n\n.timeline-details-warning .timeline-details-view-row-title {\n    color: red;\n}\n\n.timeline-details-warning .timeline-details-view-row-value {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.timeline-details-view-row-value {\n    -webkit-user-select: text;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.timeline-details-view-row-value .stack-preview-container {\n    line-height: 11px;\n}\n\n.timeline-details-view-pie-chart-wrapper {\n    margin: 4px 0;\n}\n\n.timeline-details-view-pie-chart {\n    margin-top: 5px;\n}\n\n.timeline-details-view-row-stack-trace {\n    padding: 4px 0;\n    line-height: inherit;\n}\n\n.timeline-details-view-row-stack-trace div {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    line-height: 12px;\n}\n\n.timeline-flamechart {\n    overflow: hidden;\n}\n\n.timeline-flamechart-resizer {\n    flex: 8px 0 0;\n    background-color: var(--toolbar-bg-color);\n    border: 1px #a3a3a3;\n    border-style: solid none;\n    display: flex;\n    flex-direction: row;\n    align-items: flex-end;\n    justify-content: center;\n}\n\n.timeline-network-resizer-disabled > .timeline-flamechart-resizer {\n    display: none;\n}\n\n.timeline-flamechart-resizer:after {\n    content: \"...\";\n    font-size: 14px;\n    margin-bottom: -1px;\n}\n\n.timeline-layers-view > div:last-child,\n.timeline-layers-view-properties > div:last-child {\n    background-color: #eee;\n}\n\n.timeline-layers-view-properties table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.timeline-layers-view-properties td {\n    border: 1px solid #e1e1e1;\n    line-height: 22px;\n}\n\n.timeline-paint-profiler-log-split > div:last-child {\n    background-color: #eee;\n    z-index: 0;\n}\n\n.timeline-filmstrip-preview > img {\n    margin-top: 5px;\n    max-width: 500px;\n    max-height: 300px;\n    cursor: pointer;\n    border: 1px solid #ddd;\n}\n\n.timeline-tree-view {\n    display: flex;\n    overflow: hidden;\n}\n\n.timeline-tree-view .toolbar {\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.timeline-tree-view .data-grid {\n    border: none;\n    flex: auto;\n}\n\n.timeline-tree-view .data-grid .data-container {\n    overflow-y: scroll;\n}\n\n.timeline-tree-view .data-grid.data-grid-fits-viewport .corner {\n    display: table-cell;\n}\n\n.timeline-tree-view .data-grid table.data {\n    background: white;\n}\n\n.timeline-tree-view .data-grid tr:not(.selected) .highlight {\n    background-color: rgb(255, 230, 179);\n}\n\n.timeline-tree-view .data-grid tr:hover td:not(.bottom-filler-td) {\n    background-color: rgba(0, 0, 0, 0.1);\n}\n\n.timeline-tree-view .data-grid td.numeric-column {\n    text-align: right;\n    position: relative;\n}\n\n.timeline-tree-view .data-grid div.background-percent-bar {\n    float: right;\n}\n\n.timeline-tree-view .data-grid span.percent-column {\n    color: #888;\n    width: 45px;\n    display: inline-block;\n}\n\n.timeline-tree-view .data-grid tr.selected span {\n    color: inherit;\n}\n\n.timeline-tree-view .data-grid .name-container {\n    display: flex;\n    align-items: center;\n    padding-left: 2px;\n}\n\n.timeline-tree-view .data-grid .name-container div {\n    flex: none;\n}\n\n.timeline-tree-view .data-grid .name-container .activity-icon {\n    width: 12px;\n    height: 12px;\n    border: 1px solid rgba(0, 0, 0, 0.05);\n    margin: 3px 0;\n}\n\n.timeline-tree-view .data-grid .name-container .activity-icon-container {\n    margin-right: 3px;\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    overflow: hidden;\n}\n\n.timeline-tree-view .data-grid .name-container .activity-warning::after {\n    content: \"[deopt]\";\n    margin: 0 4px;\n    line-height: 12px;\n    font-size: 10px;\n    color: #777;\n}\n\n.timeline-tree-view .data-grid tr.selected .name-container .activity-warning::after {\n    color: white;\n}\n\n.timeline-tree-view .data-grid .name-container .activity-link {\n    flex: auto;\n    text-align: right;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    margin-left: 5px;\n}\n\n.timeline-tree-view .data-grid .background-bar-container {\n    position: absolute;\n    left: 3px;\n    right: 0;\n}\n\n.timeline-tree-view .data-grid .background-bar {\n    float: right;\n    height: 18px;\n    background-color: hsla(43, 84%, 64%, 0.2);\n    border-bottom: 1px solid hsl(43, 84%, 64%);\n}\n\n.timeline-tree-view .data-grid .selected .background-bar {\n    background-color: rgba(255, 255, 255, 0.3);\n    border-bottom-color: rgba(255, 255, 255, 0.9);\n}\n\n.timeline-tree-view .timeline-details-view-body .full-widget-dimmed-banner {\n    background-color: inherit;\n}\n\n.timeline-details .filter-input-field {\n    width: 120px;\n}\n\n.timeline-tree-view .data-grid .header-container {\n    height: 21px;\n}\n\n.timeline-tree-view .data-grid .data-container {\n    top: 21px;\n}\n\n.timeline-stack-view-header {\n    height: 27px;\n    background-color: var(--toolbar-bg-color);\n    padding: 6px 10px;\n    color: #5a5a5a;\n    white-space: nowrap;\n    border-bottom: var(--divider-border);\n}\n\n.timeline-landing-page {\n    position: absolute;\n    background-color: white;\n    justify-content: center;\n    align-items: center;\n    overflow: auto;\n    font-size: 13px;\n    color: #777;\n}\n\n.timeline-landing-page > div {\n    max-width: 450px;\n    margin: 10px;\n}\n\n.timeline-landing-page > div > p {\n    flex: none;\n    white-space: pre-line;\n}\n\n/*# sourceURL=timeline/timelinePanel.css */";Runtime.cachedResources["timeline/timelinePaintProfiler.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.paint-profiler-image-view {\n    overflow: hidden;\n}\n\n.paint-profiler-image-view .paint-profiler-image-container {\n    -webkit-transform-origin: 0 0;\n}\n\n.paint-profiler-image-view .paint-profiler-image-container div {\n    border-color: rgba(100, 100, 100, 0.4);\n    border-style: solid;\n    z-index: 100;\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n\n.paint-profiler-image-view img {\n    border: solid 1px black;\n}\n\n/*# sourceURL=timeline/timelinePaintProfiler.css */";Runtime.cachedResources["timeline/timelineStatusDialog.css"]="/*\n * Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.timeline-status-dialog {\n    display: flex;\n    flex-direction: column;\n    padding: 16px 16px 12px 16px;\n    align-self: center;\n    background-color: white;\n    box-shadow: var(--drop-shadow);\n}\n\n.status-dialog-line {\n    margin: 2px;\n    height: 14px;\n    display: flex;\n    align-items: baseline;\n}\n\n.status-dialog-line .label {\n    display: inline-block;\n    width: 80px;\n    text-align: right;\n    color: #aaa;\n    margin-right: 10px;\n}\n\n.timeline-status-dialog .progress .indicator-container {\n    display: inline-block;\n    width: 200px;\n    height: 8px;\n    background-color: #f4f4f4;\n    display: inline-block;\n}\n\n.timeline-status-dialog .progress .indicator {\n    background-color: rgb(112, 166, 255);\n    height: 100%;\n    width: 0;\n    margin: 0;\n}\n\n.timeline-status-dialog .stop-button {\n    margin-top: 8px;\n    height: 100%;\n    align-self: flex-end;\n}\n\n.timeline-status-dialog .stop-button button {\n    min-width: 80px;\n}\n\n/*# sourceURL=timeline/timelineStatusDialog.css */";WebAudio.GraphVisualizer={};WebAudio.GraphVisualizer.Size;WebAudio.GraphVisualizer.Point;WebAudio.GraphVisualizer.NodeLayout;WebAudio.GraphVisualizer.PortTypes={In:Symbol('In'),Out:Symbol('Out'),Param:Symbol('Param'),};WebAudio.GraphVisualizer.Port;WebAudio.GraphVisualizer.NodeCreationData;WebAudio.GraphVisualizer.ParamCreationData;WebAudio.GraphVisualizer.NodesConnectionData;WebAudio.GraphVisualizer.NodesDisconnectionData;WebAudio.GraphVisualizer.NodesDisconnectionDataWithDestination;WebAudio.GraphVisualizer.NodeParamConnectionData;WebAudio.GraphVisualizer.NodeParamDisconnectionData;;WebAudio.GraphVisualizer.GraphStyles={PortPadding:4,InputPortRadius:10,AudioParamRadius:5,LeftMarginOfText:12,RightMarginOfText:30,LeftSideTopPadding:5,BottomPaddingWithoutParam:6,BottomPaddingWithParam:8,ArrowHeadSize:12,GraphPadding:20,GraphMargin:20,};WebAudio.GraphVisualizer.GraphStyles.TotalInputPortHeight=WebAudio.GraphVisualizer.GraphStyles.InputPortRadius*2+WebAudio.GraphVisualizer.GraphStyles.PortPadding;WebAudio.GraphVisualizer.GraphStyles.TotalOutputPortHeight=WebAudio.GraphVisualizer.GraphStyles.TotalInputPortHeight;WebAudio.GraphVisualizer.GraphStyles.TotalParamPortHeight=WebAudio.GraphVisualizer.GraphStyles.AudioParamRadius*2+WebAudio.GraphVisualizer.GraphStyles.PortPadding;WebAudio.GraphVisualizer.GraphStyles.NodeLabelFontStyle='14px Segoe UI, Arial';WebAudio.GraphVisualizer.GraphStyles.ParamLabelFontStyle='12px Segoe UI, Arial';;WebAudio.GraphVisualizer.GraphManager=class extends Common.Object{constructor(){super();this._graphMapByContextId=new Map();}
createContext(contextId){const graph=new WebAudio.GraphVisualizer.GraphView(contextId);graph.addEventListener(WebAudio.GraphVisualizer.GraphView.Events.ShouldRedraw,this._notifyShouldRedraw,this);this._graphMapByContextId.set(contextId,graph);}
destroyContext(contextId){if(!this._graphMapByContextId.has(contextId))
return;const graph=this._graphMapByContextId.get(contextId);graph.removeEventListener(WebAudio.GraphVisualizer.GraphView.Events.ShouldRedraw,this._notifyShouldRedraw,this);this._graphMapByContextId.delete(contextId);}
hasContext(contextId){return this._graphMapByContextId.has(contextId);}
clearGraphs(){this._graphMapByContextId.clear();}
getGraph(contextId){return this._graphMapByContextId.get(contextId);}
_notifyShouldRedraw(event){const graph=(event.data);this.dispatchEventToListeners(WebAudio.GraphVisualizer.GraphView.Events.ShouldRedraw,graph);}};;WebAudio.GraphVisualizer.NodeRendererUtility={};WebAudio.GraphVisualizer.NodeRendererUtility.calculateInputPortXY=portIndex=>{const y=WebAudio.GraphVisualizer.GraphStyles.InputPortRadius+
WebAudio.GraphVisualizer.GraphStyles.LeftSideTopPadding+
portIndex*WebAudio.GraphVisualizer.GraphStyles.TotalInputPortHeight;return{x:0,y:y};};WebAudio.GraphVisualizer.NodeRendererUtility.calculateOutputPortXY=(portIndex,nodeSize,numberOfOutputs)=>{const{width,height}=nodeSize;const outputPortY=(height/2)+
(2*portIndex-numberOfOutputs+1)*WebAudio.GraphVisualizer.GraphStyles.TotalOutputPortHeight/2;return{x:width,y:outputPortY};};WebAudio.GraphVisualizer.NodeRendererUtility.calculateParamPortXY=(portIndex,offsetY)=>{const paramPortY=offsetY+WebAudio.GraphVisualizer.GraphStyles.TotalParamPortHeight*(portIndex+1)-
WebAudio.GraphVisualizer.GraphStyles.AudioParamRadius;return{x:0,y:paramPortY};};;WebAudio.GraphVisualizer.NodeView=class{constructor(data,label){this.id=data.nodeId;this.type=data.nodeType;this.numberOfInputs=data.numberOfInputs;this.numberOfOutputs=data.numberOfOutputs;this.label=label;this.size={width:0,height:0};this.position=null;this._layout={inputPortSectionHeight:0,outputPortSectionHeight:0,maxTextLength:0,totalHeight:0,};this.ports=new Map();this._initialize(data);}
_initialize(data){this._updateNodeLayoutAfterAddingNode(data);this._setupInputPorts();this._setupOutputPorts();}
addParamPort(paramId,paramType){const paramPorts=this.getPortsByType(WebAudio.GraphVisualizer.PortTypes.Param);const numberOfParams=paramPorts.length;const{x,y}=WebAudio.GraphVisualizer.NodeRendererUtility.calculateParamPortXY(numberOfParams,this._layout.inputPortSectionHeight);this._addPort({id:WebAudio.GraphVisualizer.generateParamPortId(this.id,paramId),type:WebAudio.GraphVisualizer.PortTypes.Param,label:paramType,x,y,});this._updateNodeLayoutAfterAddingParam(numberOfParams+1,paramType);this._setupOutputPorts();}
getPortsByType(type){const result=[];this.ports.forEach(port=>{if(port.type===type)
result.push(port);});return result;}
_updateNodeLayoutAfterAddingNode(data){const{TotalInputPortHeight,LeftSideTopPadding,BottomPaddingWithoutParam,TotalOutputPortHeight,NodeLabelFontStyle,}=WebAudio.GraphVisualizer.GraphStyles;const inputPortSectionHeight=TotalInputPortHeight*Math.max(1,data.numberOfInputs)+LeftSideTopPadding;this._layout.inputPortSectionHeight=inputPortSectionHeight;this._layout.outputPortSectionHeight=TotalOutputPortHeight*data.numberOfOutputs;this._layout.totalHeight=Math.max(inputPortSectionHeight+BottomPaddingWithoutParam,this._layout.outputPortSectionHeight);const nodeLabelLength=WebAudio.GraphVisualizer.measureTextWidth(this.label,NodeLabelFontStyle);this._layout.maxTextLength=Math.max(this._layout.maxTextLength,nodeLabelLength);this._updateNodeSize();}
_updateNodeLayoutAfterAddingParam(numberOfParams,paramType){const leftSideMaxHeight=this._layout.inputPortSectionHeight+
numberOfParams*WebAudio.GraphVisualizer.GraphStyles.TotalParamPortHeight+
WebAudio.GraphVisualizer.GraphStyles.BottomPaddingWithParam;this._layout.totalHeight=Math.max(leftSideMaxHeight,this._layout.outputPortSectionHeight);const paramLabelLength=WebAudio.GraphVisualizer.measureTextWidth(paramType,WebAudio.GraphVisualizer.GraphStyles.ParamLabelFontStyle);this._layout.maxTextLength=Math.max(this._layout.maxTextLength,paramLabelLength);this._updateNodeSize();}
_updateNodeSize(){this.size={width:Math.ceil(WebAudio.GraphVisualizer.GraphStyles.LeftMarginOfText+this._layout.maxTextLength+
WebAudio.GraphVisualizer.GraphStyles.RightMarginOfText),height:this._layout.totalHeight,};}
_setupInputPorts(){for(let i=0;i<this.numberOfInputs;i++){const{x,y}=WebAudio.GraphVisualizer.NodeRendererUtility.calculateInputPortXY(i);this._addPort({id:WebAudio.GraphVisualizer.generateInputPortId(this.id,i),type:WebAudio.GraphVisualizer.PortTypes.In,x,y,});}}
_setupOutputPorts(){for(let i=0;i<this.numberOfOutputs;i++){const portId=WebAudio.GraphVisualizer.generateOutputPortId(this.id,i);const{x,y}=WebAudio.GraphVisualizer.NodeRendererUtility.calculateOutputPortXY(i,this.size,this.numberOfOutputs);if(this.ports.has(portId)){const port=this.ports.get(portId);port.x=x;port.y=y;}else{this._addPort({id:portId,type:WebAudio.GraphVisualizer.PortTypes.Out,x,y,});}}}
_addPort(port){this.ports.set(port.id,port);}};WebAudio.GraphVisualizer.generateInputPortId=(nodeId,inputIndex)=>{return`${nodeId}-input-${inputIndex || 0}`;};WebAudio.GraphVisualizer.generateOutputPortId=(nodeId,outputIndex)=>{return`${nodeId}-output-${outputIndex || 0}`;};WebAudio.GraphVisualizer.generateParamPortId=(nodeId,paramId)=>{return`${nodeId}-param-${paramId}`;};WebAudio.GraphVisualizer.NodeLabelGenerator=class{constructor(){this._totalNumberOfNodes=0;}
generateLabel(nodeType){if(nodeType.endsWith('Node'))
nodeType=nodeType.slice(0,nodeType.length-4);this._totalNumberOfNodes+=1;const label=`${nodeType} ${this._totalNumberOfNodes}`;return label;}};WebAudio.GraphVisualizer.measureTextWidth=(text,fontStyle)=>{if(!WebAudio.GraphVisualizer._contextForFontTextMeasuring)
WebAudio.GraphVisualizer._contextForFontTextMeasuring=createElement('canvas').getContext('2d');const context=WebAudio.GraphVisualizer._contextForFontTextMeasuring;context.save();context.font=fontStyle;const width=UI.measureTextWidth(context,text);context.restore();return width;};;WebAudio.GraphVisualizer.EdgeView=class{constructor(data,type){const{edgeId,sourcePortId,destinationPortId}=WebAudio.GraphVisualizer.generateEdgePortIdsByData(data,type);this.id=edgeId;this.type=type;this.sourceId=data.sourceId;this.destinationId=data.destinationId;this.sourcePortId=sourcePortId;this.destinationPortId=destinationPortId;}};WebAudio.GraphVisualizer.generateEdgePortIdsByData=(data,type)=>{if(!data.sourceId||!data.destinationId){console.error(`Undefined node message: ${JSON.stringify(data)}`);return null;}
const sourcePortId=WebAudio.GraphVisualizer.generateOutputPortId(data.sourceId,data.sourceOutputIndex);const destinationPortId=getDestinationPortId(data,type);return{edgeId:`${sourcePortId}->${destinationPortId}`,sourcePortId:sourcePortId,destinationPortId:destinationPortId,};function getDestinationPortId(data,type){if(type===WebAudio.GraphVisualizer.EdgeTypes.NodeToNode){return WebAudio.GraphVisualizer.generateInputPortId(data.destinationId,data.destinationInputIndex);}else if(type===WebAudio.GraphVisualizer.EdgeTypes.NodeToParam){return WebAudio.GraphVisualizer.generateParamPortId(data.destinationId,data.destinationParamId);}else{console.error(`Unknown edge type: ${type}`);return'';}}};WebAudio.GraphVisualizer.EdgeTypes={NodeToNode:Symbol('NodeToNode'),NodeToParam:Symbol('NodeToParam'),};;WebAudio.GraphVisualizer.GraphView=class extends Common.Object{constructor(contextId){super();this.contextId=contextId;this._nodes=new Map();this._edges=new Map();this._outboundEdgeMap=new Multimap();this._inboundEdgeMap=new Multimap();this._nodeLabelGenerator=new WebAudio.GraphVisualizer.NodeLabelGenerator();this._paramIdToNodeIdMap=new Map();}
addNode(data){const label=this._nodeLabelGenerator.generateLabel(data.nodeType);const node=new WebAudio.GraphVisualizer.NodeView(data,label);this._nodes.set(data.nodeId,node);this._notifyShouldRedraw();}
removeNode(nodeId){this._outboundEdgeMap.get(nodeId).forEach(edgeId=>this._removeEdge(edgeId));this._inboundEdgeMap.get(nodeId).forEach(edgeId=>this._removeEdge(edgeId));this._nodes.delete(nodeId);this._notifyShouldRedraw();}
addParam(data){const node=this.getNodeById(data.nodeId);if(!node){console.error(`AudioNode should be added before AudioParam`);return;}
node.addParamPort(data.paramId,data.paramType);this._paramIdToNodeIdMap.set(data.paramId,data.nodeId);this._notifyShouldRedraw();}
removeParam(paramId){this._paramIdToNodeIdMap.delete(paramId);}
addNodeToNodeConnection(edgeData){const edge=new WebAudio.GraphVisualizer.EdgeView(edgeData,WebAudio.GraphVisualizer.EdgeTypes.NodeToNode);this._addEdge(edge);}
removeNodeToNodeConnection(edgeData){if(edgeData.destinationId){const{edgeId}=WebAudio.GraphVisualizer.generateEdgePortIdsByData((edgeData),WebAudio.GraphVisualizer.EdgeTypes.NodeToNode);this._removeEdge(edgeId);}else{this._outboundEdgeMap.get(edgeData.sourceId).forEach(edgeId=>this._removeEdge(edgeId));}}
addNodeToParamConnection(edgeData){const edge=new WebAudio.GraphVisualizer.EdgeView(edgeData,WebAudio.GraphVisualizer.EdgeTypes.NodeToParam);this._addEdge(edge);}
removeNodeToParamConnection(edgeData){const{edgeId}=WebAudio.GraphVisualizer.generateEdgePortIdsByData(edgeData,WebAudio.GraphVisualizer.EdgeTypes.NodeToParam);this._removeEdge(edgeId);}
getNodeById(nodeId){return this._nodes.get(nodeId);}
getNodes(){return this._nodes;}
getEdges(){return this._edges;}
getNodeIdByParamId(paramId){return this._paramIdToNodeIdMap.get(paramId);}
_addEdge(edge){const sourceId=edge.sourceId;if(this._outboundEdgeMap.hasValue(sourceId,edge.id))
return;this._edges.set(edge.id,edge);this._outboundEdgeMap.set(sourceId,edge.id);this._inboundEdgeMap.set(edge.destinationId,edge.id);this._notifyShouldRedraw();}
_removeEdge(edgeId){const edge=this._edges.get(edgeId);if(!edge)
return;this._outboundEdgeMap.delete(edge.sourceId,edgeId);this._inboundEdgeMap.delete(edge.destinationId,edgeId);this._edges.delete(edgeId);this._notifyShouldRedraw();}
_notifyShouldRedraw(){this.dispatchEventToListeners(WebAudio.GraphVisualizer.GraphView.Events.ShouldRedraw,this);}};WebAudio.GraphVisualizer.GraphView.Events={ShouldRedraw:Symbol('ShouldRedraw')};;WebAudio.WebAudioModel=class extends SDK.SDKModel{constructor(target){super(target);this._enabled=false;this._agent=target.webAudioAgent();target.registerWebAudioDispatcher(this);SDK.targetManager.addModelListener(SDK.ResourceTreeModel,SDK.ResourceTreeModel.Events.FrameNavigated,this._flushContexts,this);}
_flushContexts(){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.ModelReset);}
suspendModel(){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.ModelSuspend);return this._agent.disable();}
resumeModel(){if(!this._enabled)
return Promise.resolve();return this._agent.enable();}
ensureEnabled(){if(this._enabled)
return;this._agent.enable();this._enabled=true;}
contextCreated(context){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.ContextCreated,context);}
contextWillBeDestroyed(contextId){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.ContextDestroyed,contextId);}
contextChanged(context){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.ContextChanged,context);}
audioListenerCreated(listener){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.AudioListenerCreated,listener);}
audioListenerWillBeDestroyed(contextId,listenerId){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.AudioListenerWillBeDestroyed,{contextId,listenerId});}
audioNodeCreated(node){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.AudioNodeCreated,node);}
audioNodeWillBeDestroyed(contextId,nodeId){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.AudioNodeWillBeDestroyed,{contextId,nodeId});}
audioParamCreated(param){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.AudioParamCreated,param);}
audioParamWillBeDestroyed(contextId,nodeId,paramId){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.AudioParamWillBeDestroyed,{contextId,paramId});}
nodesConnected(contextId,sourceId,destinationId,sourceOutputIndex,destinationInputIndex){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.NodesConnected,{contextId,sourceId,destinationId,sourceOutputIndex,destinationInputIndex});}
nodesDisconnected(contextId,sourceId,destinationId,sourceOutputIndex,destinationInputIndex){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.NodesDisconnected,{contextId,sourceId,destinationId,sourceOutputIndex,destinationInputIndex});}
nodeParamConnected(contextId,sourceId,destinationId,sourceOutputIndex){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.NodeParamConnected,{contextId,sourceId,destinationId,sourceOutputIndex,});}
nodeParamDisconnected(contextId,sourceId,destinationId,sourceOutputIndex){this.dispatchEventToListeners(WebAudio.WebAudioModel.Events.NodeParamDisconnected,{contextId,sourceId,destinationId,sourceOutputIndex,});}
async requestRealtimeData(contextId){return await this._agent.getRealtimeData(contextId);}};SDK.SDKModel.register(WebAudio.WebAudioModel,SDK.Target.Capability.DOM,false);WebAudio.WebAudioModel.Events={ContextCreated:Symbol('ContextCreated'),ContextDestroyed:Symbol('ContextDestroyed'),ContextChanged:Symbol('ContextChanged'),ModelReset:Symbol('ModelReset'),ModelSuspend:Symbol('ModelSuspend'),AudioListenerCreated:Symbol('AudioListenerCreated'),AudioListenerWillBeDestroyed:Symbol('AudioListenerWillBeDestroyed'),AudioNodeCreated:Symbol('AudioNodeCreated'),AudioNodeWillBeDestroyed:Symbol('AudioNodeWillBeDestroyed'),AudioParamCreated:Symbol('AudioParamCreated'),AudioParamWillBeDestroyed:Symbol('AudioParamWillBeDestroyed'),NodesConnected:Symbol('NodesConnected'),NodesDisconnected:Symbol('NodesDisconnected'),NodeParamConnected:Symbol('NodeParamConnected'),NodeParamDisconnected:Symbol('NodeParamDisconnected'),};;WebAudio.AudioContextSelector=class extends Common.Object{constructor(title){super();this._items=new UI.ListModel();this._dropDown=new UI.SoftDropDown(this._items,this);this._dropDown.setPlaceholderText(ls`(no recordings)`);this._toolbarItem=new UI.ToolbarItem(this._dropDown.element);this._toolbarItem.setEnabled(false);this._toolbarItem.setTitle(title);this._items.addEventListener(UI.ListModel.Events.ItemsReplaced,this._onListItemReplaced,this);this._toolbarItem.element.classList.add('toolbar-has-dropdown');this._selectedContext=null;}
_onListItemReplaced(){this._toolbarItem.setEnabled(!!this._items.length);}
contextCreated(event){const context=(event.data);this._items.insert(this._items.length,context);if(this._items.length===1)
this._dropDown.selectItem(context);}
contextDestroyed(event){const contextId=(event.data);const contextIndex=this._items.findIndex(context=>context.contextId===contextId);if(contextIndex>-1)
this._items.remove(contextIndex);}
contextChanged(event){const changedContext=(event.data);const contextIndex=this._items.findIndex(context=>context.contextId===changedContext.contextId);if(contextIndex>-1){this._items.remove(contextIndex);this._items.insert(contextIndex,changedContext);if(this._selectedContext&&this._selectedContext.contextId===changedContext.contextId)
this._dropDown.selectItem(changedContext);}}
createElementForItem(item){const element=createElementWithClass('div');const shadowRoot=UI.createShadowRootWithCoreStyles(element,'web_audio/audioContextSelector.css');const title=shadowRoot.createChild('div','title');title.createTextChild(this.titleFor(item).trimEnd(100));return element;}
selectedContext(){if(!this._selectedContext)
return null;return this._selectedContext;}
highlightedItemChanged(from,to,fromElement,toElement){if(fromElement)
fromElement.classList.remove('highlighted');if(toElement)
toElement.classList.add('highlighted');}
isItemSelectable(item){return true;}
itemSelected(item){if(!item)
return;if(!this._selectedContext||this._selectedContext.contextId!==item.contextId)
this._selectedContext=item;this.dispatchEventToListeners(WebAudio.AudioContextSelector.Events.ContextSelected,item);}
reset(){this._items.replaceAll([]);}
titleFor(context){return`${context.contextType} (${context.contextId.substr(-6)})`;}
toolbarItem(){return this._toolbarItem;}};WebAudio.AudioContextSelector.Events={ContextSelected:Symbol('ContextSelected')};;WebAudio.ContextDetailBuilder=class{constructor(context){this._fragment=createDocumentFragment();this._container=createElementWithClass('div','context-detail-container');this._fragment.appendChild(this._container);this._build(context);}
_build(context){const title=context.contextType==='realtime'?ls`AudioContext`:ls`OfflineAudioContext`;this._addTitle(title,context.contextId);this._addEntry(ls`State`,context.contextState);this._addEntry(ls`Sample Rate`,context.sampleRate,'Hz');if(context.contextType==='realtime')
this._addEntry(ls`Callback Buffer Size`,context.callbackBufferSize,'frames');this._addEntry(ls`Max Output Channels`,context.maxOutputChannelCount,'ch');}
_addTitle(title,subtitle){this._container.appendChild(UI.html`
      <div class="context-detail-header">
        <div class="context-detail-title">${title}</div>
        <div class="context-detail-subtitle">${subtitle}</div>
      </div>
    `);}
_addEntry(entry,value,unit){const valueWithUnit=value+(unit?` ${unit}`:'');this._container.appendChild(UI.html`
      <div class="context-detail-row">
        <div class="context-detail-row-entry">${entry}</div>
        <div class="context-detail-row-value">${valueWithUnit}</div>
      </div>
    `);}
getFragment(){return this._fragment;}};WebAudio.AudioContextSummaryBuilder=class{constructor(contextId,contextRealtimeData){const time=contextRealtimeData.currentTime.toFixed(3);const mean=(contextRealtimeData.callbackIntervalMean*1000).toFixed(3);const stddev=(Math.sqrt(contextRealtimeData.callbackIntervalVariance)*1000).toFixed(3);const capacity=(contextRealtimeData.renderCapacity*100).toFixed(3);this._fragment=createDocumentFragment();this._fragment.appendChild(UI.html`
      <div class="context-summary-container">
        <span>${ls`Current Time`}: ${time} s</span>
        <span>\u2758</span>
        <span>${ls`Callback Interval`}:  = ${mean} ms,  = ${stddev} ms</span>
        <span>\u2758</span>
        <span>${ls`Render Capacity`}: ${capacity} %</span>
      </div>
    `);}
getFragment(){return this._fragment;}};;WebAudio.WebAudioView=class extends UI.ThrottledWidget{constructor(){super(true,1000);this.element.classList.add('web-audio-drawer');this.registerRequiredCSS('web_audio/webAudio.css');const toolbarContainer=this.contentElement.createChild('div','web-audio-toolbar-container vbox');this._contextSelector=new WebAudio.AudioContextSelector(ls`BaseAudioContexts`);const toolbar=new UI.Toolbar('web-audio-toolbar',toolbarContainer);toolbar.appendToolbarItem(UI.Toolbar.createActionButtonForId('components.collect-garbage'));toolbar.appendSeparator();toolbar.appendToolbarItem(this._contextSelector.toolbarItem());this._detailViewContainer=this.contentElement.createChild('div','vbox flex-auto');this._graphManager=new WebAudio.GraphVisualizer.GraphManager();this._landingPage=new UI.VBox();this._landingPage.contentElement.classList.add('web-audio-landing-page','fill');this._landingPage.contentElement.appendChild(UI.html`
      <div>
        <p>${ls`Open a page that uses Web Audio API to start monitoring.`}</p>
      </div>
    `);this._landingPage.show(this._detailViewContainer);this._summaryBarContainer=this.contentElement.createChild('div','web-audio-summary-container');this._contextSelector.addEventListener(WebAudio.AudioContextSelector.Events.ContextSelected,event=>{const context=(event.data);this._updateDetailView(context);this.doUpdate();});SDK.targetManager.observeModels(WebAudio.WebAudioModel,this);}
wasShown(){super.wasShown();for(const model of SDK.targetManager.models(WebAudio.WebAudioModel))
this._addEventListeners(model);}
willHide(){for(const model of SDK.targetManager.models(WebAudio.WebAudioModel))
this._removeEventListeners(model);}
modelAdded(webAudioModel){if(this.isShowing())
this._addEventListeners(webAudioModel);}
modelRemoved(webAudioModel){this._removeEventListeners(webAudioModel);}
async doUpdate(){await this._pollRealtimeData();this.update();}
_addEventListeners(webAudioModel){webAudioModel.ensureEnabled();webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.ContextCreated,this._contextCreated,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.ContextDestroyed,this._contextDestroyed,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.ContextChanged,this._contextChanged,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.ModelReset,this._reset,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.ModelSuspend,this._suspendModel,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.AudioListenerCreated,this._audioListenerCreated,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.AudioListenerWillBeDestroyed,this._audioListenerWillBeDestroyed,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.AudioNodeCreated,this._audioNodeCreated,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.AudioNodeWillBeDestroyed,this._audioNodeWillBeDestroyed,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.AudioParamCreated,this._audioParamCreated,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.AudioParamWillBeDestroyed,this._audioParamWillBeDestroyed,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.NodesConnected,this._nodesConnected,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.NodesDisconnected,this._nodesDisconnected,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.NodeParamConnected,this._nodeParamConnected,this);webAudioModel.addEventListener(WebAudio.WebAudioModel.Events.NodeParamDisconnected,this._nodeParamDisconnected,this);}
_removeEventListeners(webAudioModel){webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.ContextCreated,this._contextCreated,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.ContextDestroyed,this._contextDestroyed,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.ContextChanged,this._contextChanged,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.ModelReset,this._reset,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.ModelSuspend,this._suspendModel,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.AudioListenerCreated,this._audioListenerCreated,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.AudioListenerWillBeDestroyed,this._audioListenerWillBeDestroyed,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.AudioNodeCreated,this._audioNodeCreated,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.AudioNodeWillBeDestroyed,this._audioNodeWillBeDestroyed,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.AudioParamCreated,this._audioParamCreated,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.AudioParamWillBeDestroyed,this._audioParamWillBeDestroyed,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.NodesConnected,this._nodesConnected,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.NodesDisconnected,this._nodesDisconnected,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.NodeParamConnected,this._nodeParamConnected,this);webAudioModel.removeEventListener(WebAudio.WebAudioModel.Events.NodeParamDisconnected,this._nodeParamDisconnected,this);}
_contextCreated(event){const context=(event.data);this._graphManager.createContext(context.contextId);this._contextSelector.contextCreated(event);}
_contextDestroyed(event){const contextId=(event.data);this._graphManager.destroyContext(contextId);this._contextSelector.contextDestroyed(event);}
_contextChanged(event){const context=(event.data);if(!this._graphManager.hasContext(context.contextId))
return;this._contextSelector.contextChanged(event);}
_reset(){if(this._landingPage.isShowing())
this._landingPage.detach();this._contextSelector.reset();this._detailViewContainer.removeChildren();this._landingPage.show(this._detailViewContainer);this._graphManager.clearGraphs();}
_suspendModel(){this._graphManager.clearGraphs();}
_audioListenerCreated(event){const listener=(event.data);const graph=this._graphManager.getGraph(listener.contextId);if(!graph)
return;graph.addNode({nodeId:listener.listenerId,nodeType:'Listener',numberOfInputs:0,numberOfOutputs:0,});}
_audioListenerWillBeDestroyed(event){const{contextId,listenerId}=event.data;const graph=this._graphManager.getGraph(contextId);if(!graph)
return;graph.removeNode(listenerId);}
_audioNodeCreated(event){const node=(event.data);const graph=this._graphManager.getGraph(node.contextId);if(!graph)
return;graph.addNode({nodeId:node.nodeId,nodeType:node.nodeType,numberOfInputs:node.numberOfInputs,numberOfOutputs:node.numberOfOutputs,});}
_audioNodeWillBeDestroyed(event){const{contextId,nodeId}=event.data;const graph=this._graphManager.getGraph(contextId);if(!graph)
return;graph.removeNode(nodeId);}
_audioParamCreated(event){const param=(event.data);const graph=this._graphManager.getGraph(param.contextId);if(!graph)
return;graph.addParam({paramId:param.paramId,paramType:param.paramType,nodeId:param.nodeId,});}
_audioParamWillBeDestroyed(event){const{contextId,paramId}=event.data;const graph=this._graphManager.getGraph(contextId);if(!graph)
return;graph.removeParam(paramId);}
_nodesConnected(event){const{contextId,sourceId,destinationId,sourceOutputIndex,destinationInputIndex}=event.data;const graph=this._graphManager.getGraph(contextId);if(!graph)
return;graph.addNodeToNodeConnection({sourceId,destinationId,sourceOutputIndex,destinationInputIndex,});}
_nodesDisconnected(event){const{contextId,sourceId,destinationId,sourceOutputIndex,destinationInputIndex}=event.data;const graph=this._graphManager.getGraph(contextId);if(!graph)
return;graph.removeNodeToNodeConnection({sourceId,destinationId,sourceOutputIndex,destinationInputIndex,});}
_nodeParamConnected(event){const{contextId,sourceId,destinationId,sourceOutputIndex}=event.data;const graph=this._graphManager.getGraph(contextId);if(!graph)
return;const nodeId=graph.getNodeIdByParamId(destinationId);if(!nodeId)
return;graph.addNodeToParamConnection({sourceId,destinationId:nodeId,sourceOutputIndex,destinationParamId:destinationId,});}
_nodeParamDisconnected(event){const{contextId,sourceId,destinationId,sourceOutputIndex}=event.data;const graph=this._graphManager.getGraph(contextId);if(!graph)
return;const nodeId=graph.getNodeIdByParamId(destinationId);if(!nodeId)
return;graph.removeNodeToParamConnection({sourceId,destinationId:nodeId,sourceOutputIndex,destinationParamId:destinationId,});}
_updateDetailView(context){if(this._landingPage.isShowing())
this._landingPage.detach();const detailBuilder=new WebAudio.ContextDetailBuilder(context);this._detailViewContainer.removeChildren();this._detailViewContainer.appendChild(detailBuilder.getFragment());}
_updateSummaryBar(contextId,contextRealtimeData){const summaryBuilder=new WebAudio.AudioContextSummaryBuilder(contextId,contextRealtimeData);this._summaryBarContainer.removeChildren();this._summaryBarContainer.appendChild(summaryBuilder.getFragment());}
_clearSummaryBar(){this._summaryBarContainer.removeChildren();}
async _pollRealtimeData(){const context=this._contextSelector.selectedContext();if(!context){this._clearSummaryBar();return;}
for(const model of SDK.targetManager.models(WebAudio.WebAudioModel)){if(context.contextType==='realtime'){if(!this._graphManager.hasContext(context.contextId))
continue;const realtimeData=await model.requestRealtimeData(context.contextId);if(realtimeData)
this._updateSummaryBar(context.contextId,realtimeData);}else{this._clearSummaryBar();}}}};;Runtime.cachedResources["web_audio/webAudio.css"]="/*\n * Copyright 2019 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n  overflow: hidden;\n}\n\n.web-audio-toolbar-container {\n  background-color: var(--toolbar-bg-color);\n  border-bottom: var(--divider-border);\n}\n\n.web-audio-toolbar {\n  display: inline-block;\n}\n\n.web-audio-landing-page {\n  position: absolute;\n  background-color: white;\n  justify-content: center;\n  align-items: center;\n  overflow: auto;\n  font-size: 13px;\n  color: #777;\n}\n\n.web-audio-landing-page > div {\n  max-width: 500px;\n  margin: 10px;\n}\n\n.web-audio-landing-page > div > p {\n  flex: none;\n  white-space: pre-line;\n}\n\n.context-detail-container {\n  flex: none;\n  display: flex;\n  background-color: white;\n  flex-direction: column;\n}\n\n.context-detail-header {\n  border-bottom: 1px solid rgb(230, 230, 230);\n  padding: 12px 24px;\n  margin-bottom: 10px;\n}\n\n.context-detail-title {\n  font-size: 15px;\n  font-weight: 400;\n}\n\n.context-detail-subtitle {\n  font-size: 12px;\n  margin-top: 10px;\n  user-select: text;\n}\n\n.context-detail-row {\n  flex-direction: row;\n  display: flex;\n  line-height: 18px;\n  padding-left: 24px;\n}\n\n.context-detail-row-entry:not(:empty) {\n  color: hsla(0, 0%, 46%, 1);\n  overflow: hidden;\n  width: 130px;\n}\n\n.context-detail-row-value {\n  user-select: text;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n}\n\n.context-summary-container {\n  flex: 0 0 27px;\n  line-height: 27px;\n  padding-left: 5px;\n  background-color: #eee;\n  border-top: 1px solid #ccc;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n}\n\n.context-summary-container span {\n  margin-right: 6px;\n}\n\n/*# sourceURL=web_audio/webAudio.css */";Runtime.cachedResources["web_audio/audioContextSelector.css"]="/*\n * Copyright 2019 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n  padding: 2px 1px 2px 2px;\n  white-space: nowrap;\n  display: flex;\n  flex-direction: column;\n  height: 36px;\n  justify-content: center;\n}\n\n.title {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  flex-grow: 0;\n}\n/*# sourceURL=web_audio/audioContextSelector.css */";WorkspaceDiff.WorkspaceDiff=class extends Common.Object{constructor(workspace){super();this._uiSourceCodeDiffs=new WeakMap();this._loadingUISourceCodes=new Map();this._modifiedUISourceCodes=new Set();workspace.addEventListener(Workspace.Workspace.Events.WorkingCopyChanged,this._uiSourceCodeChanged,this);workspace.addEventListener(Workspace.Workspace.Events.WorkingCopyCommitted,this._uiSourceCodeChanged,this);workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeRemoved,this._uiSourceCodeRemoved,this);workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved,this._projectRemoved,this);workspace.uiSourceCodes().forEach(this._updateModifiedState.bind(this));}
requestDiff(uiSourceCode){return this._uiSourceCodeDiff(uiSourceCode).requestDiff();}
subscribeToDiffChange(uiSourceCode,callback,thisObj){this._uiSourceCodeDiff(uiSourceCode).addEventListener(WorkspaceDiff.Events.DiffChanged,callback,thisObj);}
unsubscribeFromDiffChange(uiSourceCode,callback,thisObj){this._uiSourceCodeDiff(uiSourceCode).removeEventListener(WorkspaceDiff.Events.DiffChanged,callback,thisObj);}
modifiedUISourceCodes(){return Array.from(this._modifiedUISourceCodes);}
isUISourceCodeModified(uiSourceCode){return this._modifiedUISourceCodes.has(uiSourceCode)||this._loadingUISourceCodes.has(uiSourceCode);}
_uiSourceCodeDiff(uiSourceCode){if(!this._uiSourceCodeDiffs.has(uiSourceCode))
this._uiSourceCodeDiffs.set(uiSourceCode,new WorkspaceDiff.WorkspaceDiff.UISourceCodeDiff(uiSourceCode));return this._uiSourceCodeDiffs.get(uiSourceCode);}
_uiSourceCodeChanged(event){const uiSourceCode=(event.data.uiSourceCode);this._updateModifiedState(uiSourceCode);}
_uiSourceCodeAdded(event){const uiSourceCode=(event.data);this._updateModifiedState(uiSourceCode);}
_uiSourceCodeRemoved(event){const uiSourceCode=(event.data);this._removeUISourceCode(uiSourceCode);}
_projectRemoved(event){const project=(event.data);for(const uiSourceCode of project.uiSourceCodes())
this._removeUISourceCode(uiSourceCode);}
_removeUISourceCode(uiSourceCode){this._loadingUISourceCodes.delete(uiSourceCode);const uiSourceCodeDiff=this._uiSourceCodeDiffs.get(uiSourceCode);if(uiSourceCodeDiff)
uiSourceCodeDiff._dispose=true;this._markAsUnmodified(uiSourceCode);}
_markAsUnmodified(uiSourceCode){this._uiSourceCodeProcessedForTest();if(this._modifiedUISourceCodes.delete(uiSourceCode))
this.dispatchEventToListeners(WorkspaceDiff.Events.ModifiedStatusChanged,{uiSourceCode,isModified:false});}
_markAsModified(uiSourceCode){this._uiSourceCodeProcessedForTest();if(this._modifiedUISourceCodes.has(uiSourceCode))
return;this._modifiedUISourceCodes.add(uiSourceCode);this.dispatchEventToListeners(WorkspaceDiff.Events.ModifiedStatusChanged,{uiSourceCode,isModified:true});}
_uiSourceCodeProcessedForTest(){}
async _updateModifiedState(uiSourceCode){this._loadingUISourceCodes.delete(uiSourceCode);if(uiSourceCode.project().type()!==Workspace.projectTypes.Network){this._markAsUnmodified(uiSourceCode);return;}
if(uiSourceCode.isDirty()){this._markAsModified(uiSourceCode);return;}
if(!uiSourceCode.hasCommits()){this._markAsUnmodified(uiSourceCode);return;}
const contentsPromise=Promise.all([this.requestOriginalContentForUISourceCode(uiSourceCode),uiSourceCode.requestContent()]);this._loadingUISourceCodes.set(uiSourceCode,contentsPromise);const contents=await contentsPromise;if(this._loadingUISourceCodes.get(uiSourceCode)!==contentsPromise)
return;this._loadingUISourceCodes.delete(uiSourceCode);if(contents[0]!==null&&contents[1]!==null&&contents[0]!==contents[1])
this._markAsModified(uiSourceCode);else
this._markAsUnmodified(uiSourceCode);}
requestOriginalContentForUISourceCode(uiSourceCode){return this._uiSourceCodeDiff(uiSourceCode)._originalContent();}
revertToOriginal(uiSourceCode){function callback(content){if(typeof content!=='string')
return;uiSourceCode.addRevision(content);}
Host.userMetrics.actionTaken(Host.UserMetrics.Action.RevisionApplied);return this.requestOriginalContentForUISourceCode(uiSourceCode).then(callback);}};WorkspaceDiff.WorkspaceDiff.UISourceCodeDiff=class extends Common.Object{constructor(uiSourceCode){super();this._uiSourceCode=uiSourceCode;uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._uiSourceCodeChanged,this);uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._uiSourceCodeChanged,this);this._requestDiffPromise=null;this._pendingChanges=null;this._dispose=false;}
_uiSourceCodeChanged(){if(this._pendingChanges){clearTimeout(this._pendingChanges);this._pendingChanges=null;}
this._requestDiffPromise=null;const content=this._uiSourceCode.content();const delay=(!content||content.length<65536)?0:WorkspaceDiff.WorkspaceDiff.UpdateTimeout;this._pendingChanges=setTimeout(emitDiffChanged.bind(this),delay);function emitDiffChanged(){if(this._dispose)
return;this.dispatchEventToListeners(WorkspaceDiff.Events.DiffChanged);this._pendingChanges=null;}}
requestDiff(){if(!this._requestDiffPromise)
this._requestDiffPromise=this._innerRequestDiff();return this._requestDiffPromise;}
_originalContent(){const originalNetworkContent=Persistence.networkPersistenceManager.originalContentForUISourceCode(this._uiSourceCode);if(originalNetworkContent)
return originalNetworkContent;let callback;const promise=new Promise(fulfill=>callback=fulfill);this._uiSourceCode.project().requestFileContent(this._uiSourceCode,callback);return promise;}
async _innerRequestDiff(){if(this._dispose)
return null;const baseline=await this._originalContent();if(baseline.length>1024*1024)
return null;if(this._dispose)
return null;let current=this._uiSourceCode.workingCopy();if(!current&&!this._uiSourceCode.contentLoaded())
current=await this._uiSourceCode.requestContent();if(current.length>1024*1024)
return null;if(this._dispose)
return null;if(current===null||baseline===null)
return null;return Diff.Diff.lineDiff(baseline.split(/\r\n|\n|\r/),current.split(/\r\n|\n|\r/));}};WorkspaceDiff.Events={DiffChanged:Symbol('DiffChanged'),ModifiedStatusChanged:Symbol('ModifiedStatusChanged')};WorkspaceDiff.workspaceDiff=function(){if(!WorkspaceDiff.WorkspaceDiff._instance)
WorkspaceDiff.WorkspaceDiff._instance=new WorkspaceDiff.WorkspaceDiff(Workspace.workspace);return WorkspaceDiff.WorkspaceDiff._instance;};WorkspaceDiff.DiffUILocation=class{constructor(uiSourceCode){this.uiSourceCode=uiSourceCode;}};WorkspaceDiff.WorkspaceDiff.UpdateTimeout=200;;// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
/* eslint-disable indent */
(function(window) {

  // DevToolsAPI ----------------------------------------------------------------

  /**
   * @unrestricted
   */
  const DevToolsAPIImpl = class {
    constructor() {
      /**
       * @type {number}
       */
      this._lastCallId = 0;

      /**
       * @type {!Object.<number, function(?Object)>}
       */
      this._callbacks = {};

      /**
       * @type {!Array.<!ExtensionDescriptor>}
       */
      this._pendingExtensionDescriptors = [];

      /**
       * @type {?function(!ExtensionDescriptor)}
       */
      this._addExtensionCallback = null;
    }

    /**
     * @param {number} id
     * @param {?Object} arg
     */
    embedderMessageAck(id, arg) {
      const callback = this._callbacks[id];
      delete this._callbacks[id];
      if (callback)
        callback(arg);
    }

    /**
     * @param {string} method
     * @param {!Array.<*>} args
     * @param {?function(?Object)} callback
     */
    sendMessageToEmbedder(method, args, callback) {
      const callId = ++this._lastCallId;
      if (callback)
        this._callbacks[callId] = callback;
      const message = {'id': callId, 'method': method};
      if (args.length)
        message.params = args;
      DevToolsHost.sendMessageToEmbedder(JSON.stringify(message));
    }

    /**
     * @param {string} method
     * @param {!Array<*>} args
     */
    _dispatchOnInspectorFrontendAPI(method, args) {
      const inspectorFrontendAPI = /** @type {!Object<string, function()>} */ (window['InspectorFrontendAPI']);
      inspectorFrontendAPI[method].apply(inspectorFrontendAPI, args);
    }

    // API methods below this line --------------------------------------------

    /**
     * @param {!Array.<!ExtensionDescriptor>} extensions
     */
    addExtensions(extensions) {
      // Support for legacy front-ends (<M41).
      if (window['WebInspector'] && window['WebInspector']['addExtensions']) {
        window['WebInspector']['addExtensions'](extensions);
      } else {
        // The addExtensions command is sent as the onload event happens for
        // DevTools front-end. We should buffer this command until the frontend
        // is ready for it.
        if (this._addExtensionCallback)
          extensions.forEach(this._addExtensionCallback);
        else
          this._pendingExtensionDescriptors.pushAll(extensions);
      }
    }

    /**
     * @param {string} url
     */
    appendedToURL(url) {
      this._dispatchOnInspectorFrontendAPI('appendedToURL', [url]);
    }

    /**
     * @param {string} url
     */
    canceledSaveURL(url) {
      this._dispatchOnInspectorFrontendAPI('canceledSaveURL', [url]);
    }

    contextMenuCleared() {
      this._dispatchOnInspectorFrontendAPI('contextMenuCleared', []);
    }

    /**
     * @param {string} id
     */
    contextMenuItemSelected(id) {
      this._dispatchOnInspectorFrontendAPI('contextMenuItemSelected', [id]);
    }

    /**
     * @param {number} count
     */
    deviceCountUpdated(count) {
      this._dispatchOnInspectorFrontendAPI('deviceCountUpdated', [count]);
    }

    /**
     * @param {!Adb.Config} config
     */
    devicesDiscoveryConfigChanged(config) {
      this._dispatchOnInspectorFrontendAPI('devicesDiscoveryConfigChanged', [config]);
    }

    /**
     * @param {!Adb.PortForwardingStatus} status
     */
    devicesPortForwardingStatusChanged(status) {
      this._dispatchOnInspectorFrontendAPI('devicesPortForwardingStatusChanged', [status]);
    }

    /**
     * @param {!Array.<!Adb.Device>} devices
     */
    devicesUpdated(devices) {
      this._dispatchOnInspectorFrontendAPI('devicesUpdated', [devices]);
    }

    /**
     * @param {string} message
     */
    dispatchMessage(message) {
      this._dispatchOnInspectorFrontendAPI('dispatchMessage', [message]);
    }

    /**
     * @param {string} messageChunk
     * @param {number} messageSize
     */
    dispatchMessageChunk(messageChunk, messageSize) {
      this._dispatchOnInspectorFrontendAPI('dispatchMessageChunk', [messageChunk, messageSize]);
    }

    enterInspectElementMode() {
      this._dispatchOnInspectorFrontendAPI('enterInspectElementMode', []);
    }

    /**
     * @param {!{r: number, g: number, b: number, a: number}} color
     */
    eyeDropperPickedColor(color) {
      this._dispatchOnInspectorFrontendAPI('eyeDropperPickedColor', [color]);
    }

    /**
     * @param {!Array.<!{fileSystemName: string, rootURL: string, fileSystemPath: string}>} fileSystems
     */
    fileSystemsLoaded(fileSystems) {
      this._dispatchOnInspectorFrontendAPI('fileSystemsLoaded', [fileSystems]);
    }

    /**
     * @param {string} fileSystemPath
     */
    fileSystemRemoved(fileSystemPath) {
      this._dispatchOnInspectorFrontendAPI('fileSystemRemoved', [fileSystemPath]);
    }

    /**
     * @param {?string} error
     * @param {?{type: string, fileSystemName: string, rootURL: string, fileSystemPath: string}} fileSystem
     */
    fileSystemAdded(error, fileSystem) {
      this._dispatchOnInspectorFrontendAPI('fileSystemAdded', [error, fileSystem]);
    }

    /**
     * @param {!Array<string>} changedPaths
     * @param {!Array<string>} addedPaths
     * @param {!Array<string>} removedPaths
     */
    fileSystemFilesChangedAddedRemoved(changedPaths, addedPaths, removedPaths) {
      // Support for legacy front-ends (<M58)
      if (window['InspectorFrontendAPI'] && window['InspectorFrontendAPI']['fileSystemFilesChanged']) {
        this._dispatchOnInspectorFrontendAPI(
            'fileSystemFilesChanged', [changedPaths.concat(addedPaths).concat(removedPaths)]);
      } else {
        this._dispatchOnInspectorFrontendAPI(
            'fileSystemFilesChangedAddedRemoved', [changedPaths, addedPaths, removedPaths]);
      }
    }

    /**
     * @param {number} requestId
     * @param {string} fileSystemPath
     * @param {number} totalWork
     */
    indexingTotalWorkCalculated(requestId, fileSystemPath, totalWork) {
      this._dispatchOnInspectorFrontendAPI('indexingTotalWorkCalculated', [requestId, fileSystemPath, totalWork]);
    }

    /**
     * @param {number} requestId
     * @param {string} fileSystemPath
     * @param {number} worked
     */
    indexingWorked(requestId, fileSystemPath, worked) {
      this._dispatchOnInspectorFrontendAPI('indexingWorked', [requestId, fileSystemPath, worked]);
    }

    /**
     * @param {number} requestId
     * @param {string} fileSystemPath
     */
    indexingDone(requestId, fileSystemPath) {
      this._dispatchOnInspectorFrontendAPI('indexingDone', [requestId, fileSystemPath]);
    }

    /**
     * @param {{type: string, key: string, code: string, keyCode: number, modifiers: number}} event
     */
    keyEventUnhandled(event) {
      event.keyIdentifier = keyCodeToKeyIdentifier(event.keyCode);
      this._dispatchOnInspectorFrontendAPI('keyEventUnhandled', [event]);
    }

    /**
     * @param {function(!ExtensionDescriptor)} callback
     */
    setAddExtensionCallback(callback) {
      this._addExtensionCallback = callback;
      if (this._pendingExtensionDescriptors.length) {
        this._pendingExtensionDescriptors.forEach(this._addExtensionCallback);
        this._pendingExtensionDescriptors = [];
      }
    }

    /**
     * @param {boolean} hard
     */
    reloadInspectedPage(hard) {
      this._dispatchOnInspectorFrontendAPI('reloadInspectedPage', [hard]);
    }

    /**
     * @param {string} url
     * @param {number} lineNumber
     * @param {number} columnNumber
     */
    revealSourceLine(url, lineNumber, columnNumber) {
      this._dispatchOnInspectorFrontendAPI('revealSourceLine', [url, lineNumber, columnNumber]);
    }

    /**
     * @param {string} url
     * @param {string=} fileSystemPath
     */
    savedURL(url, fileSystemPath) {
      this._dispatchOnInspectorFrontendAPI('savedURL', [url, fileSystemPath]);
    }

    /**
     * @param {number} requestId
     * @param {string} fileSystemPath
     * @param {!Array.<string>} files
     */
    searchCompleted(requestId, fileSystemPath, files) {
      this._dispatchOnInspectorFrontendAPI('searchCompleted', [requestId, fileSystemPath, files]);
    }

    /**
     * @param {string} tabId
     */
    setInspectedTabId(tabId) {
      // Support for legacy front-ends (<M41).
      if (window['WebInspector'] && window['WebInspector']['setInspectedTabId'])
        window['WebInspector']['setInspectedTabId'](tabId);
      else
        this._dispatchOnInspectorFrontendAPI('setInspectedTabId', [tabId]);
    }

    /**
     * @param {boolean} useSoftMenu
     */
    setUseSoftMenu(useSoftMenu) {
      this._dispatchOnInspectorFrontendAPI('setUseSoftMenu', [useSoftMenu]);
    }

    /**
     * @param {string} panelName
     */
    showPanel(panelName) {
      this._dispatchOnInspectorFrontendAPI('showPanel', [panelName]);
    }

    /**
     * @param {number} id
     * @param {string} chunk
     * @param {boolean} encoded
     */
    streamWrite(id, chunk, encoded) {
      this._dispatchOnInspectorFrontendAPI('streamWrite', [id, encoded ? this._decodeBase64(chunk) : chunk]);
    }

    /**
     * @param {string} chunk
     * @return {string}
     */
    _decodeBase64(chunk) {
      const request = new XMLHttpRequest();
      request.open('GET', 'data:text/plain;base64,' + chunk, false);
      request.send(null);
      if (request.status === 200) {
        return request.responseText;
      } else {
        console.error('Error while decoding chunk in streamWrite');
        return '';
      }
    }

    // Edge-only methods --------------------------------------------------------

    /**
     * @param {!boolean} isIE
     * @suppress {missingProperties}
     */
    renderEngineSwitched(isIE) {
      if (isIE)
        window.UI.RenderEngineSwitchedScreen.show();
      else
        window.UI.RenderEngineSwitchedScreen.dismiss();
    }
  };

  const DevToolsAPI = new DevToolsAPIImpl();
  window.DevToolsAPI = DevToolsAPI;

  // InspectorFrontendHostImpl --------------------------------------------------

  /**
   * @implements {InspectorFrontendHostAPI}
   * @unrestricted
   */
  const InspectorFrontendHostImpl = class {
    /**
     * @return {string}
     */
    getSelectionBackgroundColor() {
      return '#6e86ff';
    }

    /**
     * @return {string}
     */
    getSelectionForegroundColor() {
      return '#ffffff';
    }

    /**
     * @return {string}
     */
    getInactiveSelectionBackgroundColor() {
      return '#c9c8c8';
    }

    /**
     * @return {string}
     */
    getInactiveSelectionForegroundColor() {
      return '#323232';
    }

    /**
     * @override
     * @param {string} type
     * @param {string} message
     * @param {string} stack
     * @param {string} filename
     * @param {string} sourceUrl
     * @param {number} lineno
     * @param {number} colno
     */
    reportError(type, message, stack, filename, sourceUrl, lineno, colno) {
      DevToolsAPI.sendMessageToEmbedder('reportError', [type, message, stack, filename, sourceUrl, lineno.toString(), colno.toString()], null);
    }

    /**
     * @override
     * @return {string}
     */
    platform() {
      return DevToolsHost.platform();
    }

    /**
     * @override
     */
    loadCompleted() {
      DevToolsAPI.sendMessageToEmbedder('loadCompleted', [], null);
      // Support for legacy (<57) frontends.
      if (window.Runtime && window.Runtime.queryParam) {
        const panelToOpen = window.Runtime.queryParam('panel');
        if (panelToOpen)
          window.DevToolsAPI.showPanel(panelToOpen);
      }
    }

    /**
     * @override
     */
    bringToFront() {
      DevToolsAPI.sendMessageToEmbedder('bringToFront', [], null);
    }

    /**
     * @override
     */
    closeWindow() {
      DevToolsAPI.sendMessageToEmbedder('closeWindow', [], null);
    }

    /**
     * @override
     * @param {boolean} isDocked
     * @param {function()} callback
     */
    setIsDocked(isDocked, callback) {
      DevToolsAPI.sendMessageToEmbedder('setIsDocked', [isDocked], callback);
    }

    /**
     * Requests inspected page to be placed atop of the inspector frontend with specified bounds.
     * @override
     * @param {{x: number, y: number, width: number, height: number}} bounds
     */
    setInspectedPageBounds(bounds) {
      DevToolsAPI.sendMessageToEmbedder('setInspectedPageBounds', [bounds], null);
    }

    /**
     * @override
     */
    inspectElementCompleted() {
      DevToolsAPI.sendMessageToEmbedder('inspectElementCompleted', [], null);
    }

    /**
     * @override
     * @param {string} url
     * @param {string} headers
     * @param {number} streamId
     * @param {function(!InspectorFrontendHostAPI.LoadNetworkResourceResult)} callback
     */
    loadNetworkResource(url, headers, streamId, callback) {
      DevToolsAPI.sendMessageToEmbedder(
          'loadNetworkResource', [url, headers, streamId], /** @type {function(?Object)} */ (callback));
    }

    /**
     * @override
     * @param {function(!Object<string, string>)} callback
     */
    getPreferences(callback) {
      DevToolsAPI.sendMessageToEmbedder('getPreferences', [], /** @type {function(?Object)} */ (callback));
    }

    /**
     * @override
     * @param {string} name
     * @param {string} value
     */
    setPreference(name, value) {
      DevToolsAPI.sendMessageToEmbedder('setPreference', [name, value], null);
    }

    /**
     * @override
     * @param {string} name
     */
    removePreference(name) {
      DevToolsAPI.sendMessageToEmbedder('removePreference', [name], null);
    }

    /**
     * @override
     */
    clearPreferences() {
      DevToolsAPI.sendMessageToEmbedder('clearPreferences', [], null);
    }

    /**
     * @override
     * @param {string} origin
     * @param {string} script
     */
    setInjectedScriptForOrigin(origin, script) {
      DevToolsAPI.sendMessageToEmbedder('registerExtensionsAPI', [origin, script], null);
    }

    /**
     * @override
     * @param {string} url
     */
    inspectedURLChanged(url) {
      DevToolsAPI.sendMessageToEmbedder('inspectedURLChanged', [url], null);
    }

    /**
     * @override
     * @param {string} text
     */
    copyText(text) {
      DevToolsHost.copyText(text);
    }

    /**
     * @override
     * @param {string} url
     */
    openInNewTab(url) {
      DevToolsAPI.sendMessageToEmbedder('openInNewTab', [url], null);
    }

    /**
     * @override
     * @param {string} fileSystemPath
     */
    showItemInFolder(fileSystemPath) {
      DevToolsAPI.sendMessageToEmbedder('showItemInFolder', [fileSystemPath], null);
    }

    /**
     * @override
     * @param {string} url
     * @param {string} content
     * @param {boolean} forceSaveAs
     */
    save(url, content, forceSaveAs) {
      DevToolsAPI.sendMessageToEmbedder('save', [url, content, forceSaveAs], null);
    }

    /**
     * @override
     * @param {string} url
     * @param {string} content
     */
    append(url, content) {
      DevToolsAPI.sendMessageToEmbedder('append', [url, content], null);
    }

    /**
     * @override
     * @param {string} url
     */
    close(url) {
    }

    /**
     * @override
     * @param {string} message
     */
    sendMessageToBackend(message) {
      DevToolsAPI.sendMessageToEmbedder('dispatchProtocolMessage', [message], null);
    }

    /**
     * @override
     * @param {string} actionName
     * @param {number} actionCode
     * @param {number} bucketSize
     */
    recordEnumeratedHistogram(actionName, actionCode, bucketSize) {
      // Support for M49 frontend.
      if (actionName === 'DevTools.DrawerShown')
        return;
      DevToolsAPI.sendMessageToEmbedder('recordEnumeratedHistogram', [actionName, actionCode, bucketSize], null);
    }

    /**
     * @override
     * @param {string} histogramName
     * @param {number} duration
     */
    recordPerformanceHistogram(histogramName, duration) {
      DevToolsAPI.sendMessageToEmbedder('recordPerformanceHistogram', [histogramName, duration], null);
    }

    /**
     * @override
     * @param {string} umaName
     */
    recordUserMetricsAction(umaName) {
      DevToolsAPI.sendMessageToEmbedder('recordUserMetricsAction', [umaName], null);
    }

    /**
     * @override
     */
    requestFileSystems() {
      DevToolsAPI.sendMessageToEmbedder('requestFileSystems', [], null);
    }

    /**
     * @override
     * @param {string=} type
     */
    addFileSystem(type) {
      DevToolsAPI.sendMessageToEmbedder('addFileSystem', [type || ''], null);
    }

    /**
     * @override
     * @param {string} fileSystemPath
     */
    removeFileSystem(fileSystemPath) {
      DevToolsAPI.sendMessageToEmbedder('removeFileSystem', [fileSystemPath], null);
    }

    /**
     * @override
     * @param {string} fileSystemId
     * @param {string} registeredName
     * @return {?DOMFileSystem}
     */
    isolatedFileSystem(fileSystemId, registeredName) {
      return DevToolsHost.isolatedFileSystem(fileSystemId, registeredName);
    }

    /**
     * @override
     * @param {!FileSystem} fileSystem
     */
    upgradeDraggedFileSystemPermissions(fileSystem) {
      DevToolsHost.upgradeDraggedFileSystemPermissions(fileSystem);
    }

    /**
     * @override
     * @param {number} requestId
     * @param {string} fileSystemPath
     * @param {string} excludedFolders
     */
    indexPath(requestId, fileSystemPath, excludedFolders) {
      // |excludedFolders| added in M67. For backward compatibility,
      // pass empty array.
      excludedFolders = excludedFolders || '[]';
      DevToolsAPI.sendMessageToEmbedder('indexPath', [requestId, fileSystemPath, excludedFolders], null);
    }

    /**
     * @override
     * @param {number} requestId
     */
    stopIndexing(requestId) {
      DevToolsAPI.sendMessageToEmbedder('stopIndexing', [requestId], null);
    }

    /**
     * @override
     * @param {number} requestId
     * @param {string} fileSystemPath
     * @param {string} query
     */
    searchInPath(requestId, fileSystemPath, query) {
      DevToolsAPI.sendMessageToEmbedder('searchInPath', [requestId, fileSystemPath, query], null);
    }

    /**
     * @override
     * @return {number}
     */
    zoomFactor() {
      return DevToolsHost.zoomFactor();
    }

    /**
     * @override
     */
    zoomIn() {
      DevToolsAPI.sendMessageToEmbedder('zoomIn', [], null);
    }

    /**
     * @override
     */
    zoomOut() {
      DevToolsAPI.sendMessageToEmbedder('zoomOut', [], null);
    }

    /**
     * @override
     */
    resetZoom() {
      DevToolsAPI.sendMessageToEmbedder('resetZoom', [], null);
    }

    /**
     * @override
     * @param {string} shortcuts
     */
    setWhitelistedShortcuts(shortcuts) {
      DevToolsAPI.sendMessageToEmbedder('setWhitelistedShortcuts', [shortcuts], null);
    }

    /**
     * @override
     * @param {boolean} active
     */
    setEyeDropperActive(active) {
      DevToolsAPI.sendMessageToEmbedder('setEyeDropperActive', [active], null);
    }

    /**
     * @override
     * @param {!Array<string>} certChain
     */
    showCertificateViewer(certChain) {
      DevToolsAPI.sendMessageToEmbedder('showCertificateViewer', [JSON.stringify(certChain)], null);
    }

    /**
     * Only needed to run Lighthouse on old devtools.
     * @override
     * @param {function()} callback
     */
    reattach(callback) {
      DevToolsAPI.sendMessageToEmbedder('reattach', [], callback);
    }

    /**
     * @override
     */
    readyForTest() {
      DevToolsAPI.sendMessageToEmbedder('readyForTest', [], null);
    }

    /**
     * @override
     */
    connectionReady() {
      DevToolsAPI.sendMessageToEmbedder('connectionReady', [], null);
    }

    /**
     * @override
     * @param {boolean} value
     */
    setOpenNewWindowForPopups(value) {
      DevToolsAPI.sendMessageToEmbedder('setOpenNewWindowForPopups', [value], null);
    }

    /**
     * @override
     * @param {!Adb.Config} config
     */
    setDevicesDiscoveryConfig(config) {
      DevToolsAPI.sendMessageToEmbedder(
          'setDevicesDiscoveryConfig',
          [
            config.discoverUsbDevices, config.portForwardingEnabled, JSON.stringify(config.portForwardingConfig),
            config.networkDiscoveryEnabled, JSON.stringify(config.networkDiscoveryConfig)
          ],
          null);
    }

    /**
     * @override
     * @param {boolean} enabled
     */
    setDevicesUpdatesEnabled(enabled) {
      DevToolsAPI.sendMessageToEmbedder('setDevicesUpdatesEnabled', [enabled], null);
    }

    /**
     * @override
     * @param {string} pageId
     * @param {string} action
     */
    performActionOnRemotePage(pageId, action) {
      DevToolsAPI.sendMessageToEmbedder('performActionOnRemotePage', [pageId, action], null);
    }

    /**
     * @override
     * @param {string} browserId
     * @param {string} url
     */
    openRemotePage(browserId, url) {
      DevToolsAPI.sendMessageToEmbedder('openRemotePage', [browserId, url], null);
    }

    /**
     * @override
     */
    openSendFeedbackDialog() {
      DevToolsAPI.sendMessageToEmbedder('openSendFeedbackDialog', [], null);
    }

    /**
     * @override
     */
    openNodeFrontend() {
      DevToolsAPI.sendMessageToEmbedder('openNodeFrontend', [], null);
    }

    /**
     * @override
     * @param {number} x
     * @param {number} y
     * @param {!Array.<!InspectorFrontendHostAPI.ContextMenuDescriptor>} items
     * @param {!Document} document
     */
    showContextMenuAtPoint(x, y, items, document) {
      DevToolsHost.showContextMenuAtPoint(x, y, items, document);
    }

    /**
     * @override
     * @return {boolean}
     */
    isHostedMode() {
      return DevToolsHost.isHostedMode();
    }

    /**
     * @override
     * @param {function(!ExtensionDescriptor)} callback
     */
    setAddExtensionCallback(callback) {
      DevToolsAPI.setAddExtensionCallback(callback);
    }

    // Backward-compatible methods below this line --------------------------------------------

    /**
     * Support for legacy front-ends (<M65).
     * @return {boolean}
     */
    isUnderTest() {
      return false;
    }

    /**
     * Support for legacy front-ends (<M50).
     * @param {string} message
     */
    sendFrontendAPINotification(message) {
    }

    /**
     * Support for legacy front-ends (<M41).
     * @return {string}
     */
    port() {
      return 'unknown';
    }

    /**
     * Support for legacy front-ends (<M38).
     * @param {number} zoomFactor
     */
    setZoomFactor(zoomFactor) {
    }

    /**
     * Support for legacy front-ends (<M34).
     */
    sendMessageToEmbedder() {
    }

    /**
     * Support for legacy front-ends (<M34).
     * @param {string} dockSide
     */
    requestSetDockSide(dockSide) {
      DevToolsAPI.sendMessageToEmbedder('setIsDocked', [dockSide !== 'undocked'], null);
    }

    /**
     * Support for legacy front-ends (<M34).
     * @return {boolean}
     */
    supportsFileSystems() {
      return true;
    }

    /**
     * Support for legacy front-ends (<M44).
     * @param {number} actionCode
     */
    recordActionTaken(actionCode) {
      this.recordEnumeratedHistogram('DevTools.ActionTaken', actionCode, 100);
    }

    /**
     * Support for legacy front-ends (<M44).
     * @param {number} panelCode
     */
    recordPanelShown(panelCode) {
      this.recordEnumeratedHistogram('DevTools.PanelShown', panelCode, 20);
    }
  };

  window.InspectorFrontendHost = new InspectorFrontendHostImpl();

  // DevToolsApp ---------------------------------------------------------------

  function installObjectObserve() {
    /** @type {!Array<string>} */
    const properties = [
      'advancedSearchConfig',
      'auditsPanelSplitViewState',
      'auditsSidebarWidth',
      'blockedURLs',
      'breakpoints',
      'cacheDisabled',
      'colorFormat',
      'consoleHistory',
      'consoleTimestampsEnabled',
      'cpuProfilerView',
      'cssSourceMapsEnabled',
      'currentDockState',
      'customColorPalette',
      'customDevicePresets',
      'customEmulatedDeviceList',
      'customFormatters',
      'customUserAgent',
      'databaseTableViewVisibleColumns',
      'dataGrid-cookiesTable',
      'dataGrid-DOMStorageItemsView',
      'debuggerSidebarHidden',
      'disableDataSaverInfobar',
      'disablePausedStateOverlay',
      'domBreakpoints',
      'domWordWrap',
      'elementsPanelSplitViewState',
      'elementsSidebarWidth',
      'emulation.deviceHeight',
      'emulation.deviceModeValue',
      'emulation.deviceOrientationOverride',
      'emulation.deviceScale',
      'emulation.deviceScaleFactor',
      'emulation.deviceUA',
      'emulation.deviceWidth',
      'emulation.geolocationOverride',
      'emulation.showDeviceMode',
      'emulation.showRulers',
      'enableAsyncStackTraces',
      'eventListenerBreakpoints',
      'fileMappingEntries',
      'fileSystemMapping',
      'FileSystemViewSidebarWidth',
      'fileSystemViewSplitViewState',
      'filterBar-consoleView',
      'filterBar-networkPanel',
      'filterBar-promisePane',
      'filterBar-timelinePanel',
      'frameViewerHideChromeWindow',
      'heapSnapshotRetainersViewSize',
      'heapSnapshotSplitViewState',
      'hideCollectedPromises',
      'hideNetworkMessages',
      'highlightNodeOnHoverInOverlay',
      'highResolutionCpuProfiling',
      'inlineVariableValues',
      'Inspector.drawerSplitView',
      'Inspector.drawerSplitViewState',
      'InspectorView.panelOrder',
      'InspectorView.screencastSplitView',
      'InspectorView.screencastSplitViewState',
      'InspectorView.splitView',
      'InspectorView.splitViewState',
      'javaScriptDisabled',
      'jsSourceMapsEnabled',
      'lastActivePanel',
      'lastDockState',
      'lastSelectedSourcesSidebarPaneTab',
      'lastSnippetEvaluationIndex',
      'layerDetailsSplitView',
      'layerDetailsSplitViewState',
      'layersPanelSplitViewState',
      'layersShowInternalLayers',
      'layersSidebarWidth',
      'messageLevelFilters',
      'messageURLFilters',
      'monitoringXHREnabled',
      'navigatorGroupByFolder',
      'navigatorHidden',
      'networkColorCodeResourceTypes',
      'networkConditions',
      'networkConditionsCustomProfiles',
      'networkHideDataURL',
      'networkLogColumnsVisibility',
      'networkLogLargeRows',
      'networkLogShowOverview',
      'networkPanelSplitViewState',
      'networkRecordFilmStripSetting',
      'networkResourceTypeFilters',
      'networkShowPrimaryLoadWaterfall',
      'networkSidebarWidth',
      'openLinkHandler',
      'pauseOnCaughtException',
      'pauseOnExceptionEnabled',
      'preserveConsoleLog',
      'prettyPrintInfobarDisabled',
      'previouslyViewedFiles',
      'profilesPanelSplitViewState',
      'profilesSidebarWidth',
      'promiseStatusFilters',
      'recordAllocationStacks',
      'requestHeaderFilterSetting',
      'request-info-formData-category-expanded',
      'request-info-general-category-expanded',
      'request-info-queryString-category-expanded',
      'request-info-requestHeaders-category-expanded',
      'request-info-requestPayload-category-expanded',
      'request-info-responseHeaders-category-expanded',
      'resources',
      'resourcesLastSelectedItem',
      'resourcesPanelSplitViewState',
      'resourcesSidebarWidth',
      'resourceViewTab',
      'savedURLs',
      'screencastEnabled',
      'scriptsPanelNavigatorSidebarWidth',
      'searchInContentScripts',
      'selectedAuditCategories',
      'selectedColorPalette',
      'selectedProfileType',
      'shortcutPanelSwitch',
      'showAdvancedHeapSnapshotProperties',
      'showEventListenersForAncestors',
      'showFrameowkrListeners',
      'showHeaSnapshotObjectsHiddenProperties',
      'showInheritedComputedStyleProperties',
      'showMediaQueryInspector',
      'showNativeFunctionsInJSProfile',
      'showUAShadowDOM',
      'showWhitespacesInEditor',
      'sidebarPosition',
      'skipContentScripts',
      'skipStackFramesPattern',
      'sourceMapInfobarDisabled',
      'sourcesPanelDebuggerSidebarSplitViewState',
      'sourcesPanelNavigatorSplitViewState',
      'sourcesPanelSplitSidebarRatio',
      'sourcesPanelSplitViewState',
      'sourcesSidebarWidth',
      'standardEmulatedDeviceList',
      'StylesPaneSplitRatio',
      'stylesPaneSplitViewState',
      'textEditorAutocompletion',
      'textEditorAutoDetectIndent',
      'textEditorBracketMatching',
      'textEditorIndent',
      'textEditorTabMovesFocus',
      'timelineCaptureFilmStrip',
      'timelineCaptureLayersAndPictures',
      'timelineCaptureMemory',
      'timelineCaptureNetwork',
      'timeline-details',
      'timelineEnableJSSampling',
      'timelineOverviewMode',
      'timelinePanelDetailsSplitViewState',
      'timelinePanelRecorsSplitViewState',
      'timelinePanelTimelineStackSplitViewState',
      'timelinePerspective',
      'timeline-split',
      'timelineTreeGroupBy',
      'timeline-view',
      'timelineViewMode',
      'uiTheme',
      'watchExpressions',
      'WebInspector.Drawer.lastSelectedView',
      'WebInspector.Drawer.showOnLoad',
      'workspaceExcludedFolders',
      'workspaceFolderExcludePattern',
      'workspaceInfobarDisabled',
      'workspaceMappingInfobarDisabled',
      'xhrBreakpoints'
    ];

    /**
     * @this {!{_storage: Object, _name: string}}
     */
    function settingRemove() {
      this._storage[this._name] = undefined;
    }

    /**
     * @param {!Object} object
     * @param {function(!Array<!{name: string}>)} observer
     */
    function objectObserve(object, observer) {
      if (window['WebInspector']) {
        const settingPrototype = /** @type {!Object} */ (window['WebInspector']['Setting']['prototype']);
        if (typeof settingPrototype['remove'] === 'function')
          settingPrototype['remove'] = settingRemove;
      }
      /** @type {!Set<string>} */
      const changedProperties = new Set();
      let scheduled = false;

      function scheduleObserver() {
        if (scheduled)
          return;
        scheduled = true;
        setImmediate(callObserver);
      }

      function callObserver() {
        scheduled = false;
        const changes = /** @type {!Array<!{name: string}>} */ ([]);
        changedProperties.forEach(function(name) {
          changes.push({name: name});
        });
        changedProperties.clear();
        observer.call(null, changes);
      }

      /** @type {!Map<string, *>} */
      const storage = new Map();

      /**
       * @param {string} property
       */
      function defineProperty(property) {
        if (property in object) {
          storage.set(property, object[property]);
          delete object[property];
        }

        Object.defineProperty(object, property, {
          /**
           * @return {*}
           */
          get: function() {
            return storage.get(property);
          },

          /**
           * @param {*} value
           */
          set: function(value) {
            storage.set(property, value);
            changedProperties.add(property);
            scheduleObserver();
          }
        });
      }

      for (let i = 0; i < properties.length; ++i)
        defineProperty(properties[i]);
    }

    window.Object.observe = objectObserve;
  }

  /** @type {!Map<number, string>} */
  const staticKeyIdentifiers = new Map([
    [0x12, 'Alt'],
    [0x11, 'Control'],
    [0x10, 'Shift'],
    [0x14, 'CapsLock'],
    [0x5b, 'Win'],
    [0x5c, 'Win'],
    [0x0c, 'Clear'],
    [0x28, 'Down'],
    [0x23, 'End'],
    [0x0a, 'Enter'],
    [0x0d, 'Enter'],
    [0x2b, 'Execute'],
    [0x70, 'F1'],
    [0x71, 'F2'],
    [0x72, 'F3'],
    [0x73, 'F4'],
    [0x74, 'F5'],
    [0x75, 'F6'],
    [0x76, 'F7'],
    [0x77, 'F8'],
    [0x78, 'F9'],
    [0x79, 'F10'],
    [0x7a, 'F11'],
    [0x7b, 'F12'],
    [0x7c, 'F13'],
    [0x7d, 'F14'],
    [0x7e, 'F15'],
    [0x7f, 'F16'],
    [0x80, 'F17'],
    [0x81, 'F18'],
    [0x82, 'F19'],
    [0x83, 'F20'],
    [0x84, 'F21'],
    [0x85, 'F22'],
    [0x86, 'F23'],
    [0x87, 'F24'],
    [0x2f, 'Help'],
    [0x24, 'Home'],
    [0x2d, 'Insert'],
    [0x25, 'Left'],
    [0x22, 'PageDown'],
    [0x21, 'PageUp'],
    [0x13, 'Pause'],
    [0x2c, 'PrintScreen'],
    [0x27, 'Right'],
    [0x91, 'Scroll'],
    [0x29, 'Select'],
    [0x26, 'Up'],
    [0x2e, 'U+007F'],  // Standard says that DEL becomes U+007F.
    [0xb0, 'MediaNextTrack'],
    [0xb1, 'MediaPreviousTrack'],
    [0xb2, 'MediaStop'],
    [0xb3, 'MediaPlayPause'],
    [0xad, 'VolumeMute'],
    [0xae, 'VolumeDown'],
    [0xaf, 'VolumeUp'],
  ]);

  /**
   * @param {number} keyCode
   * @return {string}
   */
  function keyCodeToKeyIdentifier(keyCode) {
    let result = staticKeyIdentifiers.get(keyCode);
    if (result !== undefined)
      return result;
    result = 'U+';
    const hexString = keyCode.toString(16).toUpperCase();
    for (let i = hexString.length; i < 4; ++i)
      result += '0';
    result += hexString;
    return result;
  }

  function installBackwardsCompatibility() {
    const majorVersion = getRemoteMajorVersion();
    if (!majorVersion)
      return;

    /** @type {!Array<string>} */
    const styleRules = [];
    // Shadow DOM V0 polyfill
    if (majorVersion <= 73 && !Element.prototype.createShadowRoot) {
      Element.prototype.createShadowRoot = function() {
        try {
          return this.attachShadow({mode: 'open'});
        } catch (e) {
          // some elements we use to add shadow roots can no
          // longer have shadow roots.
          const fakeShadowHost = document.createElement('span');
          this.appendChild(fakeShadowHost);
          fakeShadowHost.className = 'fake-shadow-host';
          return fakeShadowHost.createShadowRoot();
        }
      };

      const origAdd = DOMTokenList.prototype.add;
      DOMTokenList.prototype.add = function(...tokens) {
        if (tokens[0].startsWith('insertion-point') || tokens[0].startsWith('tabbed-pane-header'))
          this._myElement.slot = '.' + tokens[0];
        return origAdd.apply(this, tokens);
      };

      const origCreateElement = Document.prototype.createElement;
      Document.prototype.createElement = function(tagName, ...rest) {
        if (tagName === 'content')
          tagName = 'slot';
        const element = origCreateElement.call(this, tagName, ...rest);
        element.classList._myElement = element;
        return element;
      };

      Object.defineProperty(HTMLSlotElement.prototype, 'select', {
        async set(selector) {
          this.name = selector;
        }
      });

      // Document.prototype.createElementWithClass is a DevTools method, so we
      // need to wait for DOMContentLoaded in order to override it.
      if (window.document.head &&
          (window.document.readyState === 'complete' || window.document.readyState === 'interactive'))
        overrideCreateElementWithClass();
      else
        window.addEventListener('DOMContentLoaded', overrideCreateElementWithClass);

      function overrideCreateElementWithClass() {
        window.removeEventListener('DOMContentLoaded', overrideCreateElementWithClass);

        const origCreateElementWithClass = Document.prototype.createElementWithClass;
        Document.prototype.createElementWithClass = function(tagName, className, ...rest) {
          if (tagName !== 'button' || (className !== 'soft-dropdown' && className !== 'dropdown-button'))
            return origCreateElementWithClass.call(this, tagName, className, ...rest);
          const element = origCreateElementWithClass.call(this, 'div', className, ...rest);
          element.tabIndex = 0;
          element.role = 'button';
          return element;
        };
      }
    }

    // Custom Elements V0 polyfill
    if (majorVersion <= 73 && !Document.prototype.registerElement) {
      const fakeRegistry = new Map();
      Document.prototype.registerElement = function(typeExtension, options) {
        const {prototype, extends: localName} = options;
        const document = this;
        const callback = function() {
          const element = document.createElement(localName || typeExtension);
          const skip = new Set(['constructor', '__proto__']);
          for (const key of Object.keys(Object.getOwnPropertyDescriptors(prototype.__proto__ || {}))) {
            if (skip.has(key))
              continue;
            element[key] = prototype[key];
          }
          element.setAttribute('is', typeExtension);
          if (element['createdCallback'])
            element['createdCallback']();
          return element;
        };
        fakeRegistry.set(typeExtension, callback);
        return callback;
      };

      const origCreateElement = Document.prototype.createElement;
      Document.prototype.createElement = function(tagName, fakeCustomElementType) {
        const fakeConstructor = fakeRegistry.get(fakeCustomElementType);
        if (fakeConstructor)
          return fakeConstructor();
        return origCreateElement.call(this, tagName, fakeCustomElementType);
      };

      // DevTools front-ends mistakenly assume that
      //   classList.toggle('a', undefined) works as
      //   classList.toggle('a', false) rather than as
      //   classList.toggle('a');
      const originalDOMTokenListToggle = DOMTokenList.prototype.toggle;
      DOMTokenList.prototype.toggle = function(token, force) {
        if (arguments.length === 1)
          force = !this.contains(token);
        return originalDOMTokenListToggle.call(this, token, !!force);
      };
    }

    if (majorVersion <= 66) {
      /** @type {(!function(number, number):Element|undefined)} */
      ShadowRoot.prototype.__originalShadowRootElementFromPoint;

      if (!ShadowRoot.prototype.__originalShadowRootElementFromPoint) {
        ShadowRoot.prototype.__originalShadowRootElementFromPoint = ShadowRoot.prototype.elementFromPoint;
        /**
         *  @param {number} x
         *  @param {number} y
         *  @return {Element}
         */
        ShadowRoot.prototype.elementFromPoint = function(x, y) {
          const originalResult = ShadowRoot.prototype.__originalShadowRootElementFromPoint.apply(this, arguments);
          if (this.host && originalResult === this.host)
            return null;
          return originalResult;
        };
      }
    }

    if (majorVersion <= 53) {
      Object.defineProperty(window.KeyboardEvent.prototype, 'keyIdentifier', {
        /**
         * @return {string}
         * @this {KeyboardEvent}
         */
        get: function() {
          return keyCodeToKeyIdentifier(this.keyCode);
        }
      });
    }

    if (majorVersion <= 50)
      installObjectObserve();

    if (majorVersion <= 45) {
      /**
       * @param {string} property
       * @return {!CSSValue|null}
       * @this {CSSStyleDeclaration}
       */
      function getValue(property) {
        // Note that |property| comes from another context, so we can't use === here.
        // eslint-disable-next-line eqeqeq
        if (property == 'padding-left') {
          return /** @type {!CSSValue} */ ({
            /**
             * @return {number}
             * @this {!{__paddingLeft: number}}
             */
            getFloatValue: function() {
              return this.__paddingLeft;
            },
            __paddingLeft: parseFloat(this.paddingLeft)
          });
        }
        throw new Error('getPropertyCSSValue is undefined');
      }

      window.CSSStyleDeclaration.prototype.getPropertyCSSValue = getValue;

      function CSSPrimitiveValue() {
      }
      CSSPrimitiveValue.CSS_PX = 5;
      window.CSSPrimitiveValue = CSSPrimitiveValue;
    }

    if (majorVersion <= 45)
      styleRules.push('* { min-width: 0; min-height: 0; }');

    if (majorVersion <= 51) {
      // Support for quirky border-image behavior (<M51), see:
      // https://bugs.chromium.org/p/chromium/issues/detail?id=559258
      styleRules.push('.cm-breakpoint .CodeMirror-linenumber { border-style: solid !important; }');
      styleRules.push(
          '.cm-breakpoint.cm-breakpoint-conditional .CodeMirror-linenumber { border-style: solid !important; }');
    }
    if (majorVersion <= 71) {
      styleRules.push(
          '.coverage-toolbar-container, .animation-timeline-toolbar-container, .computed-properties { flex-basis: auto; }');
    }

    if (majorVersion <= 50)
      Event.prototype.deepPath = undefined;

    if (majorVersion <= 54) {
      window.FileError = /** @type {!function (new: FileError) : ?} */ ({
        NOT_FOUND_ERR: DOMException.NOT_FOUND_ERR,
        ABORT_ERR: DOMException.ABORT_ERR,
        INVALID_MODIFICATION_ERR: DOMException.INVALID_MODIFICATION_ERR,
        NOT_READABLE_ERR: 0  // No matching DOMException, so code will be 0.
      });
    }

    installExtraStyleRules(styleRules);
  }

  /**
   * @return {?number}
   */
  function getRemoteMajorVersion() {
    try {
      const remoteVersion = new URLSearchParams(window.location.search).get('remoteVersion');
      if (!remoteVersion)
        return null;
      const majorVersion = parseInt(remoteVersion.split('.')[0], 10);
      return majorVersion;
    } catch (e) {
      return null;
    }
  }

  /**
   * @param {!Array<string>} styleRules
   */
  function installExtraStyleRules(styleRules) {
    if (!styleRules.length)
      return;
    const styleText = styleRules.join('\n');
    document.head.appendChild(createStyleElement(styleText));

    const origCreateShadowRoot = HTMLElement.prototype.createShadowRoot;
    HTMLElement.prototype.createShadowRoot = function(...args) {
      const shadowRoot = origCreateShadowRoot.call(this, ...args);
      shadowRoot.appendChild(createStyleElement(styleText));
      return shadowRoot;
    };
  }

  /**
   * @param {string} styleText
   * @return {!Element}
   */
  function createStyleElement(styleText) {
    const style = document.createElement('style');
    style.type = 'text/css';
    style.textContent = styleText;
    return style;
  }

  installBackwardsCompatibility();

})(window);
/*
 * Copyright (C) 2010 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
/* eslint-disable indent */

/**
 * @fileoverview This file contains small testing framework along with the
 * test suite for the frontend. These tests are a part of the continues build
 * and are executed by the devtools_sanity_unittest.cc as a part of the
 * Interactive UI Test suite.
 * FIXME: change field naming style to use trailing underscore.
 */

(function createTestSuite(window) {

  /**
   * @unrestricted
   */
  const TestSuite = class {
    /**
     * Test suite for interactive UI tests.
     * @param {Object} domAutomationController DomAutomationController instance.
     */
    constructor(domAutomationController) {
      this.domAutomationController_ = domAutomationController;
      this.controlTaken_ = false;
      this.timerId_ = -1;
      this._asyncInvocationId = 0;
    }

    /**
     * Key event with given key identifier.
     */
    static createKeyEvent(key) {
      return new KeyboardEvent('keydown', {bubbles: true, cancelable: true, key: key});
    }
  };

  /**
   * Reports test failure.
   * @param {string} message Failure description.
   */
  TestSuite.prototype.fail = function(message) {
    if (this.controlTaken_)
      this.reportFailure_(message);
    else
      throw message;
  };

  /**
   * Equals assertion tests that expected === actual.
   * @param {!Object|boolean} expected Expected object.
   * @param {!Object|boolean} actual Actual object.
   * @param {string} opt_message User message to print if the test fails.
   */
  TestSuite.prototype.assertEquals = function(expected, actual, opt_message) {
    if (expected !== actual) {
      let message = 'Expected: \'' + expected + '\', but was \'' + actual + '\'';
      if (opt_message)
        message = opt_message + '(' + message + ')';
      this.fail(message);
    }
  };

  /**
   * True assertion tests that value == true.
   * @param {!Object} value Actual object.
   * @param {string} opt_message User message to print if the test fails.
   */
  TestSuite.prototype.assertTrue = function(value, opt_message) {
    this.assertEquals(true, !!value, opt_message);
  };

  /**
   * Takes control over execution.
   */
  TestSuite.prototype.takeControl = function() {
    this.controlTaken_ = true;
    // Set up guard timer.
    const self = this;
    this.timerId_ = setTimeout(function() {
      self.reportFailure_('Timeout exceeded: 20 sec');
    }, 20000);
  };

  /**
   * Releases control over execution.
   */
  TestSuite.prototype.releaseControl = function() {
    if (this.timerId_ !== -1) {
      clearTimeout(this.timerId_);
      this.timerId_ = -1;
    }
    this.controlTaken_ = false;
    this.reportOk_();
  };

  /**
   * Async tests use this one to report that they are completed.
   */
  TestSuite.prototype.reportOk_ = function() {
    this.domAutomationController_.send('[OK]');
  };

  /**
   * Async tests use this one to report failures.
   */
  TestSuite.prototype.reportFailure_ = function(error) {
    if (this.timerId_ !== -1) {
      clearTimeout(this.timerId_);
      this.timerId_ = -1;
    }
    this.domAutomationController_.send('[FAILED] ' + error);
  };

  /**
   * Run specified test on a fresh instance of the test suite.
   * @param {Array<string>} args method name followed by its parameters.
   */
  TestSuite.prototype.dispatchOnTestSuite = function(args) {
    const methodName = args.shift();
    try {
      this[methodName].apply(this, args);
      if (!this.controlTaken_)
        this.reportOk_();
    } catch (e) {
      this.reportFailure_(e);
    }
  };

  /**
   * Wrap an async method with TestSuite.{takeControl(), releaseControl()}
   * and invoke TestSuite.reportOk_ upon completion.
   * @param {Array<string>} args method name followed by its parameters.
   */
  TestSuite.prototype.waitForAsync = function(var_args) {
    const args = Array.prototype.slice.call(arguments);
    this.takeControl();
    args.push(this.releaseControl.bind(this));
    this.dispatchOnTestSuite(args);
  };

  /**
   * Overrides the method with specified name until it's called first time.
   * @param {!Object} receiver An object whose method to override.
   * @param {string} methodName Name of the method to override.
   * @param {!Function} override A function that should be called right after the
   *     overridden method returns.
   * @param {?boolean} opt_sticky Whether restore original method after first run
   *     or not.
   */
  TestSuite.prototype.addSniffer = function(receiver, methodName, override, opt_sticky) {
    const orig = receiver[methodName];
    if (typeof orig !== 'function')
      this.fail('Cannot find method to override: ' + methodName);
    const test = this;
    receiver[methodName] = function(var_args) {
      let result;
      try {
        result = orig.apply(this, arguments);
      } finally {
        if (!opt_sticky)
          receiver[methodName] = orig;
      }
      // In case of exception the override won't be called.
      try {
        override.apply(this, arguments);
      } catch (e) {
        test.fail('Exception in overriden method \'' + methodName + '\': ' + e);
      }
      return result;
    };
  };

  /**
   * Waits for current throttler invocations, if any.
   * @param {!Common.Throttler} throttler
   * @param {function()} callback
   */
  TestSuite.prototype.waitForThrottler = function(throttler, callback) {
    const test = this;
    let scheduleShouldFail = true;
    test.addSniffer(throttler, 'schedule', onSchedule);

    function hasSomethingScheduled() {
      return throttler._isRunningProcess || throttler._process;
    }

    function checkState() {
      if (!hasSomethingScheduled()) {
        scheduleShouldFail = false;
        callback();
        return;
      }

      test.addSniffer(throttler, '_processCompletedForTests', checkState);
    }

    function onSchedule() {
      if (scheduleShouldFail)
        test.fail('Unexpected Throttler.schedule');
    }

    checkState();
  };

  /**
   * @param {string} panelName Name of the panel to show.
   */
  TestSuite.prototype.showPanel = function(panelName) {
    return UI.inspectorView.showPanel(panelName);
  };

  // UI Tests

  /**
   * Tests that scripts tab can be open and populated with inspected scripts.
   */
  TestSuite.prototype.testShowScriptsTab = function() {
    const test = this;
    this.showPanel('sources').then(function() {
      // There should be at least main page script.
      this._waitUntilScriptsAreParsed(['debugger_test_page.html'], function() {
        test.releaseControl();
      });
    }.bind(this));
    // Wait until all scripts are added to the debugger.
    this.takeControl();
  };

  /**
   * Tests that scripts tab is populated with inspected scripts even if it
   * hadn't been shown by the moment inspected paged refreshed.
   * @see http://crbug.com/26312
   */
  TestSuite.prototype.testScriptsTabIsPopulatedOnInspectedPageRefresh = function() {
    const test = this;
    const debuggerModel = SDK.targetManager.mainTarget().model(SDK.DebuggerModel);
    debuggerModel.addEventListener(SDK.DebuggerModel.Events.GlobalObjectCleared, waitUntilScriptIsParsed);

    this.showPanel('elements').then(function() {
      // Reload inspected page. It will reset the debugger agent.
      test.evaluateInConsole_('window.location.reload(true);', function(resultText) {});
    });

    function waitUntilScriptIsParsed() {
      debuggerModel.removeEventListener(SDK.DebuggerModel.Events.GlobalObjectCleared, waitUntilScriptIsParsed);
      test.showPanel('sources').then(function() {
        test._waitUntilScriptsAreParsed(['debugger_test_page.html'], function() {
          test.releaseControl();
        });
      });
    }

    // Wait until all scripts are added to the debugger.
    this.takeControl();
  };

  /**
   * Tests that scripts list contains content scripts.
   */
  TestSuite.prototype.testContentScriptIsPresent = function() {
    const test = this;
    this.showPanel('sources').then(function() {
      test._waitUntilScriptsAreParsed(['page_with_content_script.html', 'simple_content_script.js'], function() {
        test.releaseControl();
      });
    });

    // Wait until all scripts are added to the debugger.
    this.takeControl();
  };

  /**
   * Tests that scripts are not duplicaed on Scripts tab switch.
   */
  TestSuite.prototype.testNoScriptDuplicatesOnPanelSwitch = function() {
    const test = this;

    function switchToElementsTab() {
      test.showPanel('elements').then(function() {
        setTimeout(switchToScriptsTab, 0);
      });
    }

    function switchToScriptsTab() {
      test.showPanel('sources').then(function() {
        setTimeout(checkScriptsPanel, 0);
      });
    }

    function checkScriptsPanel() {
      test.assertTrue(test._scriptsAreParsed(['debugger_test_page.html']), 'Some scripts are missing.');
      checkNoDuplicates();
      test.releaseControl();
    }

    function checkNoDuplicates() {
      const uiSourceCodes = test.nonAnonymousUISourceCodes_();
      for (let i = 0; i < uiSourceCodes.length; i++) {
        for (let j = i + 1; j < uiSourceCodes.length; j++) {
          test.assertTrue(
              uiSourceCodes[i].url() !== uiSourceCodes[j].url(),
              'Found script duplicates: ' + test.uiSourceCodesToString_(uiSourceCodes));
        }
      }
    }

    this.showPanel('sources').then(function() {
      test._waitUntilScriptsAreParsed(['debugger_test_page.html'], function() {
        checkNoDuplicates();
        setTimeout(switchToElementsTab, 0);
      });
    });

    // Wait until all scripts are added to the debugger.
    this.takeControl();
  };

  // Tests that debugger works correctly if pause event occurs when DevTools
  // frontend is being loaded.
  TestSuite.prototype.testPauseWhenLoadingDevTools = function() {
    const debuggerModel = SDK.targetManager.mainTarget().model(SDK.DebuggerModel);
    if (debuggerModel.debuggerPausedDetails)
      return;

    this.showPanel('sources').then(function() {
      // Script execution can already be paused.

      this._waitForScriptPause(this.releaseControl.bind(this));
    }.bind(this));

    this.takeControl();
  };

  // Tests that pressing "Pause" will pause script execution if the script
  // is already running.
  TestSuite.prototype.testPauseWhenScriptIsRunning = function() {
    this.showPanel('sources').then(function() {
      this.evaluateInConsole_('setTimeout("handleClick()", 0)', didEvaluateInConsole.bind(this));
    }.bind(this));

    function didEvaluateInConsole(resultText) {
      this.assertTrue(!isNaN(resultText), 'Failed to get timer id: ' + resultText);
      // Wait for some time to make sure that inspected page is running the
      // infinite loop.
      setTimeout(testScriptPause.bind(this), 300);
    }

    function testScriptPause() {
      // The script should be in infinite loop. Click "Pause" button to
      // pause it and wait for the result.
      UI.panels.sources._togglePause();

      this._waitForScriptPause(this.releaseControl.bind(this));
    }

    this.takeControl();
  };

  /**
   * Tests network size.
   */
  TestSuite.prototype.testNetworkSize = function() {
    const test = this;

    function finishRequest(request, finishTime) {
      test.assertEquals(25, request.resourceSize, 'Incorrect total data length');
      test.releaseControl();
    }

    this.addSniffer(SDK.NetworkDispatcher.prototype, '_finishNetworkRequest', finishRequest);

    // Reload inspected page to sniff network events
    test.evaluateInConsole_('window.location.reload(true);', function(resultText) {});

    this.takeControl();
  };

  /**
   * Tests network sync size.
   */
  TestSuite.prototype.testNetworkSyncSize = function() {
    const test = this;

    function finishRequest(request, finishTime) {
      test.assertEquals(25, request.resourceSize, 'Incorrect total data length');
      test.releaseControl();
    }

    this.addSniffer(SDK.NetworkDispatcher.prototype, '_finishNetworkRequest', finishRequest);

    // Send synchronous XHR to sniff network events
    test.evaluateInConsole_(
        'let xhr = new XMLHttpRequest(); xhr.open("GET", "chunked", false); xhr.send(null);', function() {});

    this.takeControl();
  };

  /**
   * Tests network raw headers text.
   */
  TestSuite.prototype.testNetworkRawHeadersText = function() {
    const test = this;

    function finishRequest(request, finishTime) {
      if (!request.responseHeadersText)
        test.fail('Failure: resource does not have response headers text');
      const index = request.responseHeadersText.indexOf('Date:');
      test.assertEquals(
          112, request.responseHeadersText.substring(index).length, 'Incorrect response headers text length');
      test.releaseControl();
    }

    this.addSniffer(SDK.NetworkDispatcher.prototype, '_finishNetworkRequest', finishRequest);

    // Reload inspected page to sniff network events
    test.evaluateInConsole_('window.location.reload(true);', function(resultText) {});

    this.takeControl();
  };

  /**
   * Tests network timing.
   */
  TestSuite.prototype.testNetworkTiming = function() {
    const test = this;

    function finishRequest(request, finishTime) {
      // Setting relaxed expectations to reduce flakiness.
      // Server sends headers after 100ms, then sends data during another 100ms.
      // We expect these times to be measured at least as 70ms.
      test.assertTrue(
          request.timing.receiveHeadersEnd - request.timing.connectStart >= 70,
          'Time between receiveHeadersEnd and connectStart should be >=70ms, but was ' +
              'receiveHeadersEnd=' + request.timing.receiveHeadersEnd + ', connectStart=' +
              request.timing.connectStart + '.');
      test.assertTrue(
          request.responseReceivedTime - request.startTime >= 0.07,
          'Time between responseReceivedTime and startTime should be >=0.07s, but was ' +
              'responseReceivedTime=' + request.responseReceivedTime + ', startTime=' + request.startTime + '.');
      test.assertTrue(
          request.endTime - request.startTime >= 0.14,
          'Time between endTime and startTime should be >=0.14s, but was ' +
              'endtime=' + request.endTime + ', startTime=' + request.startTime + '.');

      test.releaseControl();
    }

    this.addSniffer(SDK.NetworkDispatcher.prototype, '_finishNetworkRequest', finishRequest);

    // Reload inspected page to sniff network events
    test.evaluateInConsole_('window.location.reload(true);', function(resultText) {});

    this.takeControl();
  };

  TestSuite.prototype.testPushTimes = function(url) {
    const test = this;
    let pendingRequestCount = 2;

    function finishRequest(request, finishTime) {
      test.assertTrue(
          typeof request.timing.pushStart === 'number' && request.timing.pushStart > 0,
          `pushStart is invalid: ${request.timing.pushStart}`);
      test.assertTrue(typeof request.timing.pushEnd === 'number', `pushEnd is invalid: ${request.timing.pushEnd}`);
      test.assertTrue(request.timing.pushStart < request.startTime, 'pushStart should be before startTime');
      if (request.url().endsWith('?pushUseNullEndTime')) {
        test.assertTrue(request.timing.pushEnd === 0, `pushEnd should be 0 but is ${request.timing.pushEnd}`);
      } else {
        test.assertTrue(
            request.timing.pushStart < request.timing.pushEnd,
            `pushStart should be before pushEnd (${request.timing.pushStart} >= ${request.timing.pushEnd})`);
        // The below assertion is just due to the way we generate times in the moch URLRequestJob and is not generally an invariant.
        test.assertTrue(request.timing.pushEnd < request.endTime, 'pushEnd should be before endTime');
        test.assertTrue(request.startTime < request.timing.pushEnd, 'pushEnd should be after startTime');
      }
      if (!--pendingRequestCount)
        test.releaseControl();
    }

    this.addSniffer(SDK.NetworkDispatcher.prototype, '_finishNetworkRequest', finishRequest, true);

    test.evaluateInConsole_('addImage(\'' + url + '\')', function(resultText) {});
    test.evaluateInConsole_('addImage(\'' + url + '?pushUseNullEndTime\')', function(resultText) {});
    this.takeControl();
  };

  TestSuite.prototype.testConsoleOnNavigateBack = function() {

    function filteredMessages() {
      return SDK.consoleModel.messages().filter(a => a.source !== SDK.ConsoleMessage.MessageSource.Violation);
    }

    if (filteredMessages().length === 1)
      firstConsoleMessageReceived.call(this, null);
    else
      SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageAdded, firstConsoleMessageReceived, this);


    function firstConsoleMessageReceived(event) {
      if (event && event.data.source === SDK.ConsoleMessage.MessageSource.Violation)
        return;
      SDK.consoleModel.removeEventListener(SDK.ConsoleModel.Events.MessageAdded, firstConsoleMessageReceived, this);
      this.evaluateInConsole_('clickLink();', didClickLink.bind(this));
    }

    function didClickLink() {
      // Check that there are no new messages(command is not a message).
      this.assertEquals(3, filteredMessages().length);
      this.evaluateInConsole_('history.back();', didNavigateBack.bind(this));
    }

    function didNavigateBack() {
      // Make sure navigation completed and possible console messages were pushed.
      this.evaluateInConsole_('void 0;', didCompleteNavigation.bind(this));
    }

    function didCompleteNavigation() {
      this.assertEquals(7, filteredMessages().length);
      this.releaseControl();
    }

    this.takeControl();
  };

  TestSuite.prototype.testSharedWorker = function() {
    function didEvaluateInConsole(resultText) {
      this.assertEquals('2011', resultText);
      this.releaseControl();
    }
    this.evaluateInConsole_('globalVar', didEvaluateInConsole.bind(this));
    this.takeControl();
  };

  TestSuite.prototype.testPauseInSharedWorkerInitialization1 = function() {
    // Make sure the worker is loaded.
    this.takeControl();
    this._waitForTargets(1, callback.bind(this));

    function callback() {
      Protocol.test.deprecatedRunAfterPendingDispatches(this.releaseControl.bind(this));
    }
  };

  TestSuite.prototype.testPauseInSharedWorkerInitialization2 = function() {
    this.takeControl();
    this._waitForTargets(1, callback.bind(this));

    function callback() {
      const debuggerModel = SDK.targetManager.models(SDK.DebuggerModel)[0];
      if (debuggerModel.isPaused()) {
        SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageAdded, onConsoleMessage, this);
        debuggerModel.resume();
        return;
      }
      this._waitForScriptPause(callback.bind(this));
    }

    function onConsoleMessage(event) {
      const message = event.data.messageText;
      if (message !== 'connected')
        this.fail('Unexpected message: ' + message);
      this.releaseControl();
    }
  };

  TestSuite.prototype.testSharedWorkerNetworkPanel = function() {
    this.takeControl();
    this.showPanel('network').then(() => {
      if (!document.querySelector('#network-container'))
        this.fail('unable to find #network-container');
      this.releaseControl();
    });
  };

  TestSuite.prototype.enableTouchEmulation = function() {
    const deviceModeModel = new Emulation.DeviceModeModel(function() {});
    deviceModeModel._target = SDK.targetManager.mainTarget();
    deviceModeModel._applyTouch(true, true);
  };

  TestSuite.prototype.waitForDebuggerPaused = function() {
    const debuggerModel = SDK.targetManager.mainTarget().model(SDK.DebuggerModel);
    if (debuggerModel.debuggerPausedDetails)
      return;

    this.takeControl();
    this._waitForScriptPause(this.releaseControl.bind(this));
  };

  TestSuite.prototype.switchToPanel = function(panelName) {
    this.showPanel(panelName).then(this.releaseControl.bind(this));
    this.takeControl();
  };

  // Regression test for crbug.com/370035.
  TestSuite.prototype.testDeviceMetricsOverrides = function() {
    function dumpPageMetrics() {
      return JSON.stringify(
          {width: window.innerWidth, height: window.innerHeight, deviceScaleFactor: window.devicePixelRatio});
    }

    const test = this;

    async function testOverrides(params, metrics, callback) {
      await SDK.targetManager.mainTarget().emulationAgent().invoke_setDeviceMetricsOverride(params);
      test.evaluateInConsole_('(' + dumpPageMetrics.toString() + ')()', checkMetrics);

      function checkMetrics(consoleResult) {
        test.assertEquals(
            '"' + JSON.stringify(metrics) + '"', consoleResult, 'Wrong metrics for params: ' + JSON.stringify(params));
        callback();
      }
    }

    function step1() {
      testOverrides(
          {width: 1200, height: 1000, deviceScaleFactor: 1, mobile: false, fitWindow: true},
          {width: 1200, height: 1000, deviceScaleFactor: 1}, step2);
    }

    function step2() {
      testOverrides(
          {width: 1200, height: 1000, deviceScaleFactor: 1, mobile: false, fitWindow: false},
          {width: 1200, height: 1000, deviceScaleFactor: 1}, step3);
    }

    function step3() {
      testOverrides(
          {width: 1200, height: 1000, deviceScaleFactor: 3, mobile: false, fitWindow: true},
          {width: 1200, height: 1000, deviceScaleFactor: 3}, step4);
    }

    function step4() {
      testOverrides(
          {width: 1200, height: 1000, deviceScaleFactor: 3, mobile: false, fitWindow: false},
          {width: 1200, height: 1000, deviceScaleFactor: 3}, finish);
    }

    function finish() {
      test.releaseControl();
    }

    test.takeControl();
    step1();
  };

  TestSuite.prototype.testDispatchKeyEventShowsAutoFill = function() {
    const test = this;
    let receivedReady = false;

    function signalToShowAutofill() {
      SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
          {type: 'rawKeyDown', key: 'Down', windowsVirtualKeyCode: 40, nativeVirtualKeyCode: 40});
      SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
          {type: 'keyUp', key: 'Down', windowsVirtualKeyCode: 40, nativeVirtualKeyCode: 40});
    }

    function selectTopAutoFill() {
      SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
          {type: 'rawKeyDown', key: 'Down', windowsVirtualKeyCode: 40, nativeVirtualKeyCode: 40});
      SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
          {type: 'keyUp', key: 'Down', windowsVirtualKeyCode: 40, nativeVirtualKeyCode: 40});
      SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
          {type: 'rawKeyDown', key: 'Enter', windowsVirtualKeyCode: 13, nativeVirtualKeyCode: 13});
      SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
          {type: 'keyUp', key: 'Enter', windowsVirtualKeyCode: 13, nativeVirtualKeyCode: 13});

      test.evaluateInConsole_('document.getElementById("name").value', onResultOfInput);
    }

    function onResultOfInput(value) {
      // Console adds "" around the response.
      test.assertEquals('"Abbf"', value);
      test.releaseControl();
    }

    function onConsoleMessage(event) {
      const message = event.data.messageText;
      if (message === 'ready' && !receivedReady) {
        receivedReady = true;
        signalToShowAutofill();
      }
      // This log comes from the browser unittest code.
      if (message === 'didShowSuggestions')
        selectTopAutoFill();
    }

    this.takeControl();

    // It is possible for the ready console messagage to be already received but not handled
    // or received later. This ensures we can catch both cases.
    SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageAdded, onConsoleMessage, this);

    const messages = SDK.consoleModel.messages();
    if (messages.length) {
      const text = messages[0].messageText;
      this.assertEquals('ready', text);
      signalToShowAutofill();
    }
  };

  TestSuite.prototype.testKeyEventUnhandled = function() {
    function onKeyEventUnhandledKeyDown(event) {
      this.assertEquals('keydown', event.data.type);
      this.assertEquals('F8', event.data.key);
      this.assertEquals(119, event.data.keyCode);
      this.assertEquals(0, event.data.modifiers);
      this.assertEquals('', event.data.code);
      InspectorFrontendHost.events.removeEventListener(
          InspectorFrontendHostAPI.Events.KeyEventUnhandled, onKeyEventUnhandledKeyDown, this);
      InspectorFrontendHost.events.addEventListener(
          InspectorFrontendHostAPI.Events.KeyEventUnhandled, onKeyEventUnhandledKeyUp, this);
      SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
          {type: 'keyUp', key: 'F8', code: 'F8', windowsVirtualKeyCode: 119, nativeVirtualKeyCode: 119});
    }
    function onKeyEventUnhandledKeyUp(event) {
      this.assertEquals('keyup', event.data.type);
      this.assertEquals('F8', event.data.key);
      this.assertEquals(119, event.data.keyCode);
      this.assertEquals(0, event.data.modifiers);
      this.assertEquals('F8', event.data.code);
      this.releaseControl();
    }
    this.takeControl();
    InspectorFrontendHost.events.addEventListener(
        InspectorFrontendHostAPI.Events.KeyEventUnhandled, onKeyEventUnhandledKeyDown, this);
    SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
        {type: 'rawKeyDown', key: 'F8', windowsVirtualKeyCode: 119, nativeVirtualKeyCode: 119});
  };

  TestSuite.prototype.testDispatchKeyEventDoesNotCrash = function() {
    SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
        {type: 'rawKeyDown', windowsVirtualKeyCode: 0x23, key: 'End'});
    SDK.targetManager.mainTarget().inputAgent().invoke_dispatchKeyEvent(
        {type: 'keyUp', windowsVirtualKeyCode: 0x23, key: 'End'});
  };

  // Check that showing the certificate viewer does not crash, crbug.com/954874
  TestSuite.prototype.testShowCertificate = function() {
    InspectorFrontendHost.showCertificateViewer([
      'MIIFIDCCBAigAwIBAgIQE0TsEu6R8FUHQv+9fE7j8TANBgkqhkiG9w0BAQsF' +
          'ADBUMQswCQYDVQQGEwJVUzEeMBwGA1UEChMVR29vZ2xlIFRydXN0IFNlcnZp' +
          'Y2VzMSUwIwYDVQQDExxHb29nbGUgSW50ZXJuZXQgQXV0aG9yaXR5IEczMB4X' +
          'DTE5MDMyNjEzNDEwMVoXDTE5MDYxODEzMjQwMFowZzELMAkGA1UEBhMCVVMx' +
          'EzARBgNVBAgMCkNhbGlmb3JuaWExFjAUBgNVBAcMDU1vdW50YWluIFZpZXcx' +
          'EzARBgNVBAoMCkdvb2dsZSBMTEMxFjAUBgNVBAMMDSouYXBwc3BvdC5jb20w' +
          'ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCwca7hj0kyoJVxcvyA' +
          'a8zNKMIXcoPM3aU1KVe7mxZITtwC6/D/D/q4Oe8fBQLeZ3c6qR5Sr3M+611k' +
          'Ab15AcGUgh1Xi0jZqERvd/5+P0aVCFJYeoLrPBzwSMZBStkoiO2CwtV8x06e' +
          'X7qUz7Hvr3oeG+Ma9OUMmIebl//zHtC82mE0mCRBQAW0MWEgT5nOWey74tJR' +
          'GRqUEI8ftV9grAshD5gY8kxxUoMfqrreaXVqcRF58ZPiwUJ0+SbtC5q9cJ+K' +
          'MuYM4TCetEuk/WQsa+1EnSa40dhGRtZjxbwEwQAJ1vLOcIA7AVR/Ck22Uj8X' +
          'UOECercjUrKdDyaAPcLp2TThAgMBAAGjggHZMIIB1TATBgNVHSUEDDAKBggr' +
          'BgEFBQcDATCBrwYDVR0RBIGnMIGkgg0qLmFwcHNwb3QuY29tggsqLmEucnVu' +
          'LmFwcIIVKi50aGlua3dpdGhnb29nbGUuY29tghAqLndpdGhnb29nbGUuY29t' +
          'ghEqLndpdGh5b3V0dWJlLmNvbYILYXBwc3BvdC5jb22CB3J1bi5hcHCCE3Ro' +
          'aW5rd2l0aGdvb2dsZS5jb22CDndpdGhnb29nbGUuY29tgg93aXRoeW91dHVi' +
          'ZS5jb20waAYIKwYBBQUHAQEEXDBaMC0GCCsGAQUFBzAChiFodHRwOi8vcGtp' +
          'Lmdvb2cvZ3NyMi9HVFNHSUFHMy5jcnQwKQYIKwYBBQUHMAGGHWh0dHA6Ly9v' +
          'Y3NwLnBraS5nb29nL0dUU0dJQUczMB0GA1UdDgQWBBTGkpE5o0H9+Wjc05rF' +
          'hNQiYDjBFjAMBgNVHRMBAf8EAjAAMB8GA1UdIwQYMBaAFHfCuFCaZ3Z2sS3C' +
          'htCDoH6mfrpLMCEGA1UdIAQaMBgwDAYKKwYBBAHWeQIFAzAIBgZngQwBAgIw' +
          'MQYDVR0fBCowKDAmoCSgIoYgaHR0cDovL2NybC5wa2kuZ29vZy9HVFNHSUFH' +
          'My5jcmwwDQYJKoZIhvcNAQELBQADggEBALqoYGqWtJW/6obEzY+ehsgfyXb+' +
          'qNIuV09wt95cRF93HlLbBlSZ/Iz8HXX44ZT1/tGAkwKnW0gDKSSab3I8U+e9' +
          'LHbC9VXrgAFENzu89MNKNmK5prwv+MPA2HUQPu4Pad3qXmd4+nKc/EUjtg1d' +
          '/xKGK1Vn6JX3i5ly/rduowez3LxpSAJuIwseum331aQaKC2z2ri++96B8MPU' +
          'KFXzvV2gVGOe3ZYqmwPaG8y38Tba+OzEh59ygl8ydJJhoI6+R3itPSy0aXUU' +
          'lMvvAbfCobXD5kBRQ28ysgbDSDOPs3fraXpAKL92QUjsABs58XBz5vka4swu' +
          'gg/u+ZxaKOqfIm8=',
      'MIIEXDCCA0SgAwIBAgINAeOpMBz8cgY4P5pTHTANBgkqhkiG9w0BAQsFADBM' +
          'MSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3QgQ0EgLSBSMjETMBEGA1UEChMK' +
          'R2xvYmFsU2lnbjETMBEGA1UEAxMKR2xvYmFsU2lnbjAeFw0xNzA2MTUwMDAw' +
          'NDJaFw0yMTEyMTUwMDAwNDJaMFQxCzAJBgNVBAYTAlVTMR4wHAYDVQQKExVH' +
          'b29nbGUgVHJ1c3QgU2VydmljZXMxJTAjBgNVBAMTHEdvb2dsZSBJbnRlcm5l' +
          'dCBBdXRob3JpdHkgRzMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB' +
          'AQDKUkvqHv/OJGuo2nIYaNVWXQ5IWi01CXZaz6TIHLGp/lOJ+600/4hbn7vn' +
          '6AAB3DVzdQOts7G5pH0rJnnOFUAK71G4nzKMfHCGUksW/mona+Y2emJQ2N+a' +
          'icwJKetPKRSIgAuPOB6Aahh8Hb2XO3h9RUk2T0HNouB2VzxoMXlkyW7XUR5m' +
          'w6JkLHnA52XDVoRTWkNty5oCINLvGmnRsJ1zouAqYGVQMc/7sy+/EYhALrVJ' +
          'EA8KbtyX+r8snwU5C1hUrwaW6MWOARa8qBpNQcWTkaIeoYvy/sGIJEmjR0vF' +
          'EwHdp1cSaWIr6/4g72n7OqXwfinu7ZYW97EfoOSQJeAzAgMBAAGjggEzMIIB' +
          'LzAOBgNVHQ8BAf8EBAMCAYYwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUF' +
          'BwMCMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFHfCuFCaZ3Z2sS3C' +
          'htCDoH6mfrpLMB8GA1UdIwQYMBaAFJviB1dnHB7AagbeWbSaLd/cGYYuMDUG' +
          'CCsGAQUFBwEBBCkwJzAlBggrBgEFBQcwAYYZaHR0cDovL29jc3AucGtpLmdv' +
          'b2cvZ3NyMjAyBgNVHR8EKzApMCegJaAjhiFodHRwOi8vY3JsLnBraS5nb29n' +
          'L2dzcjIvZ3NyMi5jcmwwPwYDVR0gBDgwNjA0BgZngQwBAgIwKjAoBggrBgEF' +
          'BQcCARYcaHR0cHM6Ly9wa2kuZ29vZy9yZXBvc2l0b3J5LzANBgkqhkiG9w0B' +
          'AQsFAAOCAQEAHLeJluRT7bvs26gyAZ8so81trUISd7O45skDUmAge1cnxhG1' +
          'P2cNmSxbWsoiCt2eux9LSD+PAj2LIYRFHW31/6xoic1k4tbWXkDCjir37xTT' +
          'NqRAMPUyFRWSdvt+nlPqwnb8Oa2I/maSJukcxDjNSfpDh/Bd1lZNgdd/8cLd' +
          'sE3+wypufJ9uXO1iQpnh9zbuFIwsIONGl1p3A8CgxkqI/UAih3JaGOqcpcda' +
          'CIzkBaR9uYQ1X4k2Vg5APRLouzVy7a8IVk6wuy6pm+T7HT4LY8ibS5FEZlfA' +
          'FLSW8NwsVz9SBK2Vqn1N0PIMn5xA6NZVc7o835DLAFshEWfC7TIe3g==',
      'MIIDujCCAqKgAwIBAgILBAAAAAABD4Ym5g0wDQYJKoZIhvcNAQEFBQAwTDEg' +
          'MB4GA1UECxMXR2xvYmFsU2lnbiBSb290IENBIC0gUjIxEzARBgNVBAoTCkds' +
          'b2JhbFNpZ24xEzARBgNVBAMTCkdsb2JhbFNpZ24wHhcNMDYxMjE1MDgwMDAw' +
          'WhcNMjExMjE1MDgwMDAwWjBMMSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3Qg' +
          'Q0EgLSBSMjETMBEGA1UEChMKR2xvYmFsU2lnbjETMBEGA1UEAxMKR2xvYmFs' +
          'U2lnbjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKbPJA6+Lm8o' +
          'mUVCxKs+IVSbC9N/hHD6ErPLv4dfxn+G07IwXNb9rfF73OX4YJYJkhD10FPe' +
          '+3t+c4isUoh7SqbKSaZeqKeMWhG8eoLrvozps6yWJQeXSpkqBy+0Hne/ig+1' +
          'AnwblrjFuTosvNYSuetZfeLQBoZfXklqtTleiDTsvHgMCJiEbKjNS7SgfQx5' +
          'TfC4LcshytVsW33hoCmEofnTlEnLJGKRILzdC9XZzPnqJworc5HGnRusyMvo' +
          '4KD0L5CLTfuwNhv2GXqF4G3yYROIXJ/gkwpRl4pazq+r1feqCapgvdzZX99y' +
          'qWATXgAByUr6P6TqBwMhAo6CygPCm48CAwEAAaOBnDCBmTAOBgNVHQ8BAf8E' +
          'BAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUm+IHV2ccHsBqBt5Z' +
          'tJot39wZhi4wNgYDVR0fBC8wLTAroCmgJ4YlaHR0cDovL2NybC5nbG9iYWxz' +
          'aWduLm5ldC9yb290LXIyLmNybDAfBgNVHSMEGDAWgBSb4gdXZxwewGoG3lm0' +
          'mi3f3BmGLjANBgkqhkiG9w0BAQUFAAOCAQEAmYFThxxol4aR7OBKuEQLq4Gs' +
          'J0/WwbgcQ3izDJr86iw8bmEbTUsp9Z8FHSbBuOmDAGJFtqkIk7mpM0sYmsL4' +
          'h4hO291xNBrBVNpGP+DTKqttVCL1OmLNIG+6KYnX3ZHu01yiPqFbQfXf5WRD' +
          'LenVOavSot+3i9DAgBkcRcAtjOj4LaR0VknFBbVPFd5uRHg5h6h+u/N5GJG7' +
          '9G+dwfCMNYxdAfvDbbnvRG15RjF+Cv6pgsH/76tuIMRQyV+dTZsXjAzlAcmg' +
          'QWpzU/qlULRuJQ/7TBj0/VLZjmmx6BEP3ojY+x1J96relc8geMJgEtslQIxq' +
          '/H5COEBkEveegeGTLg=='
    ]);
  };

  // Simple sanity check to make sure network throttling is wired up
  // See crbug.com/747724
  TestSuite.prototype.testOfflineNetworkConditions = async function() {
    const test = this;
    SDK.multitargetNetworkManager.setNetworkConditions(SDK.NetworkManager.OfflineConditions);

    function finishRequest(request) {
      test.assertEquals(
          'net::ERR_INTERNET_DISCONNECTED', request.localizedFailDescription, 'Request should have failed');
      test.releaseControl();
    }

    this.addSniffer(SDK.NetworkDispatcher.prototype, '_finishNetworkRequest', finishRequest);

    test.takeControl();
    test.evaluateInConsole_('window.location.reload(true);', function(resultText) {});
  };

  TestSuite.prototype.testEmulateNetworkConditions = function() {
    const test = this;

    function testPreset(preset, messages, next) {
      function onConsoleMessage(event) {
        const index = messages.indexOf(event.data.messageText);
        if (index === -1) {
          test.fail('Unexpected message: ' + event.data.messageText);
          return;
        }

        messages.splice(index, 1);
        if (!messages.length) {
          SDK.consoleModel.removeEventListener(SDK.ConsoleModel.Events.MessageAdded, onConsoleMessage, this);
          next();
        }
      }

      SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageAdded, onConsoleMessage, this);
      SDK.multitargetNetworkManager.setNetworkConditions(preset);
    }

    test.takeControl();
    step1();

    function step1() {
      testPreset(
          MobileThrottling.networkPresets[2],
          [
            'offline event: online = false', 'connection change event: type = none; downlinkMax = 0; effectiveType = 4g'
          ],
          step2);
    }

    function step2() {
      testPreset(
          MobileThrottling.networkPresets[1],
          [
            'online event: online = true',
            'connection change event: type = cellular; downlinkMax = 0.390625; effectiveType = 2g'
          ],
          step3);
    }

    function step3() {
      testPreset(
          MobileThrottling.networkPresets[0],
          ['connection change event: type = cellular; downlinkMax = 1.4400000000000002; effectiveType = 3g'],
          test.releaseControl.bind(test));
    }
  };

  TestSuite.prototype.testScreenshotRecording = function() {
    const test = this;

    function performActionsInPage(callback) {
      let count = 0;
      const div = document.createElement('div');
      div.setAttribute('style', 'left: 0px; top: 0px; width: 100px; height: 100px; position: absolute;');
      document.body.appendChild(div);
      requestAnimationFrame(frame);
      function frame() {
        const color = [0, 0, 0];
        color[count % 3] = 255;
        div.style.backgroundColor = 'rgb(' + color.join(',') + ')';
        if (++count > 10)
          requestAnimationFrame(callback);
        else
          requestAnimationFrame(frame);
      }
    }

    const captureFilmStripSetting = Common.settings.createSetting('timelineCaptureFilmStrip', false);
    captureFilmStripSetting.set(true);
    test.evaluateInConsole_(performActionsInPage.toString(), function() {});
    test.invokeAsyncWithTimeline_('performActionsInPage', onTimelineDone);

    function onTimelineDone() {
      captureFilmStripSetting.set(false);
      const filmStripModel = UI.panels.timeline._performanceModel.filmStripModel();
      const frames = filmStripModel.frames();
      test.assertTrue(frames.length > 4 && typeof frames.length === 'number');
      loadFrameImages(frames);
    }

    function loadFrameImages(frames) {
      const readyImages = [];
      for (const frame of frames)
        frame.imageDataPromise().then(onGotImageData);

      function onGotImageData(data) {
        const image = new Image();
        test.assertTrue(!!data, 'No image data for frame');
        image.addEventListener('load', onLoad);
        image.src = 'data:image/jpg;base64,' + data;
      }

      function onLoad(event) {
        readyImages.push(event.target);
        if (readyImages.length === frames.length)
          validateImagesAndCompleteTest(readyImages);
      }
    }

    function validateImagesAndCompleteTest(images) {
      let redCount = 0;
      let greenCount = 0;
      let blueCount = 0;

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      for (const image of images) {
        test.assertTrue(image.naturalWidth > 10);
        test.assertTrue(image.naturalHeight > 10);
        canvas.width = image.naturalWidth;
        canvas.height = image.naturalHeight;
        ctx.drawImage(image, 0, 0);
        const data = ctx.getImageData(0, 0, 1, 1);
        const color = Array.prototype.join.call(data.data, ',');
        if (data.data[0] > 200)
          redCount++;
        else if (data.data[1] > 200)
          greenCount++;
        else if (data.data[2] > 200)
          blueCount++;
        else
          test.fail('Unexpected color: ' + color);
      }
      test.assertTrue(redCount && greenCount && blueCount, 'Color sanity check failed');
      test.releaseControl();
    }

    test.takeControl();
  };

  TestSuite.prototype.testSettings = function() {
    const test = this;

    createSettings();
    test.takeControl();
    setTimeout(reset, 0);

    function createSettings() {
      const localSetting = Common.settings.createLocalSetting('local', undefined);
      localSetting.set({s: 'local', n: 1});
      const globalSetting = Common.settings.createSetting('global', undefined);
      globalSetting.set({s: 'global', n: 2});
    }

    function reset() {
      Runtime.experiments.clearForTest();
      InspectorFrontendHost.getPreferences(gotPreferences);
    }

    function gotPreferences(prefs) {
      Main.Main._instanceForTest._createSettings(prefs);

      const localSetting = Common.settings.createLocalSetting('local', undefined);
      test.assertEquals('object', typeof localSetting.get());
      test.assertEquals('local', localSetting.get().s);
      test.assertEquals(1, localSetting.get().n);
      const globalSetting = Common.settings.createSetting('global', undefined);
      test.assertEquals('object', typeof globalSetting.get());
      test.assertEquals('global', globalSetting.get().s);
      test.assertEquals(2, globalSetting.get().n);
      test.releaseControl();
    }
  };

  TestSuite.prototype.testWindowInitializedOnNavigateBack = function() {
    const test = this;
    test.takeControl();
    const messages = SDK.consoleModel.messages();
    if (messages.length === 1)
      checkMessages();
    else
      SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageAdded, checkMessages.bind(this), this);

    function checkMessages() {
      const messages = SDK.consoleModel.messages();
      test.assertEquals(1, messages.length);
      test.assertTrue(messages[0].messageText.indexOf('Uncaught') === -1);
      test.releaseControl();
    }
  };

  TestSuite.prototype.testConsoleContextNames = function() {
    const test = this;
    test.takeControl();
    this.showPanel('console').then(() => this._waitForExecutionContexts(2, onExecutionContexts.bind(this)));

    function onExecutionContexts() {
      const consoleView = Console.ConsoleView.instance();
      const selector = consoleView._consoleContextSelector;
      const values = [];
      for (const item of selector._items)
        values.push(selector.titleFor(item));
      test.assertEquals('top', values[0]);
      test.assertEquals('Simple content script', values[1]);
      test.releaseControl();
    }
  };

  TestSuite.prototype.testRawHeadersWithHSTS = function(url) {
    const test = this;
    test.takeControl();
    SDK.targetManager.addModelListener(
        SDK.NetworkManager, SDK.NetworkManager.Events.ResponseReceived, onResponseReceived);

    this.evaluateInConsole_(`
      let img = document.createElement('img');
      img.src = "${url}";
      document.body.appendChild(img);
    `, () => {});

    let count = 0;
    function onResponseReceived(event) {
      const networkRequest = event.data;
      if (!networkRequest.url().startsWith('http'))
        return;
      switch (++count) {
        case 1:  // Original redirect
          test.assertEquals(301, networkRequest.statusCode);
          test.assertEquals('Moved Permanently', networkRequest.statusText);
          test.assertTrue(url.endsWith(networkRequest.responseHeaderValue('Location')));
          break;

        case 2:  // HSTS internal redirect
          test.assertTrue(networkRequest.url().startsWith('http://'));
          test.assertEquals(307, networkRequest.statusCode);
          test.assertEquals('Internal Redirect', networkRequest.statusText);
          test.assertEquals('HSTS', networkRequest.responseHeaderValue('Non-Authoritative-Reason'));
          test.assertTrue(networkRequest.responseHeaderValue('Location').startsWith('https://'));
          break;

        case 3:  // Final response
          test.assertTrue(networkRequest.url().startsWith('https://'));
          test.assertTrue(networkRequest.requestHeaderValue('Referer').startsWith('http://127.0.0.1'));
          test.assertEquals(200, networkRequest.statusCode);
          test.assertEquals('OK', networkRequest.statusText);
          test.assertEquals('132', networkRequest.responseHeaderValue('Content-Length'));
          test.releaseControl();
      }
    }
  };

  TestSuite.prototype.testDOMWarnings = function() {
    const messages = SDK.consoleModel.messages();
    this.assertEquals(1, messages.length);
    const expectedPrefix = '[DOM] Found 2 elements with non-unique id #dup:';
    this.assertTrue(messages[0].messageText.startsWith(expectedPrefix));
  };

  TestSuite.prototype.waitForTestResultsInConsole = function() {
    const messages = SDK.consoleModel.messages();
    for (let i = 0; i < messages.length; ++i) {
      const text = messages[i].messageText;
      if (text === 'PASS')
        return;
      else if (/^FAIL/.test(text))
        this.fail(text);  // This will throw.
    }
    // Neither PASS nor FAIL, so wait for more messages.
    function onConsoleMessage(event) {
      const text = event.data.messageText;
      if (text === 'PASS')
        this.releaseControl();
      else if (/^FAIL/.test(text))
        this.fail(text);
    }

    SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageAdded, onConsoleMessage, this);
    this.takeControl();
  };

  TestSuite.prototype._overrideMethod = function(receiver, methodName, override) {
    const original = receiver[methodName];
    if (typeof original !== 'function') {
      this.fail(`TestSuite._overrideMethod: $[methodName] is not a function`);
      return;
    }
    receiver[methodName] = function() {
      let value;
      try {
        value = original.apply(receiver, arguments);
      } finally {
        receiver[methodName] = original;
      }
      override.apply(original, arguments);
      return value;
    };
  };

  TestSuite.prototype.startTimeline = function(callback) {
    const test = this;
    this.showPanel('timeline').then(function() {
      const timeline = UI.panels.timeline;
      test._overrideMethod(timeline, '_recordingStarted', callback);
      timeline._toggleRecording();
    });
  };

  TestSuite.prototype.stopTimeline = function(callback) {
    const timeline = UI.panels.timeline;
    this._overrideMethod(timeline, 'loadingComplete', callback);
    timeline._toggleRecording();
  };

  TestSuite.prototype.invokePageFunctionAsync = function(functionName, opt_args, callback_is_always_last) {
    const callback = arguments[arguments.length - 1];
    const doneMessage = `DONE: ${functionName}.${++this._asyncInvocationId}`;
    const argsString = arguments.length < 3 ?
        '' :
        Array.prototype.slice.call(arguments, 1, -1).map(arg => JSON.stringify(arg)).join(',') + ',';
    this.evaluateInConsole_(
        `${functionName}(${argsString} function() { console.log('${doneMessage}'); });`, function() {});
    SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageAdded, onConsoleMessage);

    function onConsoleMessage(event) {
      const text = event.data.messageText;
      if (text === doneMessage) {
        SDK.consoleModel.removeEventListener(SDK.ConsoleModel.Events.MessageAdded, onConsoleMessage);
        callback();
      }
    }
  };

  TestSuite.prototype.invokeAsyncWithTimeline_ = function(functionName, callback) {
    const test = this;

    this.startTimeline(onRecordingStarted);

    function onRecordingStarted() {
      test.invokePageFunctionAsync(functionName, pageActionsDone);
    }

    function pageActionsDone() {
      test.stopTimeline(callback);
    }
  };

  TestSuite.prototype.enableExperiment = function(name) {
    Runtime.experiments.enableForTest(name);
  };

  TestSuite.prototype.checkInputEventsPresent = function() {
    const expectedEvents = new Set(arguments);
    const model = UI.panels.timeline._performanceModel.timelineModel();
    const asyncEvents = model.virtualThreads().find(thread => thread.isMainFrame).asyncEventsByGroup;
    const input = asyncEvents.get(TimelineModel.TimelineModel.AsyncEventGroup.input) || [];
    const prefix = 'InputLatency::';
    for (const e of input) {
      if (!e.name.startsWith(prefix))
        continue;
      if (e.steps.length < 2)
        continue;
      if (e.name.startsWith(prefix + 'Mouse') &&
          typeof TimelineModel.TimelineData.forEvent(e.steps[0]).timeWaitingForMainThread !== 'number')
        throw `Missing timeWaitingForMainThread on ${e.name}`;
      expectedEvents.delete(e.name.substr(prefix.length));
    }
    if (expectedEvents.size)
      throw 'Some expected events are not found: ' + Array.from(expectedEvents.keys()).join(',');
  };

  TestSuite.prototype.testInspectedElementIs = async function(nodeName) {
    this.takeControl();
    await self.runtime.loadModulePromise('elements');
    if (!Elements.ElementsPanel._firstInspectElementNodeNameForTest)
      await new Promise(f => this.addSniffer(Elements.ElementsPanel, '_firstInspectElementCompletedForTest', f));
    this.assertEquals(nodeName, Elements.ElementsPanel._firstInspectElementNodeNameForTest);
    this.releaseControl();
  };

  TestSuite.prototype.testDisposeEmptyBrowserContext = async function(url) {
    this.takeControl();
    const targetAgent = SDK.targetManager.mainTarget().targetAgent();
    const {browserContextId} = await targetAgent.invoke_createBrowserContext();
    const response1 = await targetAgent.invoke_getBrowserContexts();
    this.assertEquals(response1.browserContextIds.length, 1);
    await targetAgent.invoke_disposeBrowserContext({browserContextId});
    const response2 = await targetAgent.invoke_getBrowserContexts();
    this.assertEquals(response2.browserContextIds.length, 0);
    this.releaseControl();
  };

  TestSuite.prototype.testCreateBrowserContext = async function(url) {
    this.takeControl();
    const browserContextIds = [];
    const targetAgent = SDK.targetManager.mainTarget().targetAgent();

    const target1 = await createIsolatedTarget(url);
    const target2 = await createIsolatedTarget(url);

    const response = await targetAgent.invoke_getBrowserContexts();
    this.assertEquals(response.browserContextIds.length, 2);
    this.assertTrue(response.browserContextIds.includes(browserContextIds[0]));
    this.assertTrue(response.browserContextIds.includes(browserContextIds[1]));

    await evalCode(target1, 'localStorage.setItem("page1", "page1")');
    await evalCode(target2, 'localStorage.setItem("page2", "page2")');

    this.assertEquals(await evalCode(target1, 'localStorage.getItem("page1")'), 'page1');
    this.assertEquals(await evalCode(target1, 'localStorage.getItem("page2")'), null);
    this.assertEquals(await evalCode(target2, 'localStorage.getItem("page1")'), null);
    this.assertEquals(await evalCode(target2, 'localStorage.getItem("page2")'), 'page2');

    const removedTargets = [];
    SDK.targetManager.observeTargets({targetAdded: () => {}, targetRemoved: target => removedTargets.push(target)});
    await Promise.all([disposeBrowserContext(browserContextIds[0]), disposeBrowserContext(browserContextIds[1])]);
    this.assertEquals(removedTargets.length, 2);
    this.assertEquals(removedTargets.indexOf(target1) !== -1, true);
    this.assertEquals(removedTargets.indexOf(target2) !== -1, true);

    this.releaseControl();

    /**
     * @param {string} url
     * @return {!Promise<!SDK.Target>}
     */
    async function createIsolatedTarget(url) {
      const {browserContextId} = await targetAgent.invoke_createBrowserContext();
      browserContextIds.push(browserContextId);

      const {targetId} = await targetAgent.invoke_createTarget({url: 'about:blank', browserContextId});
      await targetAgent.invoke_attachToTarget({targetId, flatten: true});

      const target = SDK.targetManager.targets().find(target => target.id() === targetId);
      const pageAgent = target.pageAgent();
      await pageAgent.invoke_enable();
      await pageAgent.invoke_navigate({url});
      return target;
    }

    async function disposeBrowserContext(browserContextId) {
      const targetAgent = SDK.targetManager.mainTarget().targetAgent();
      await targetAgent.invoke_disposeBrowserContext({browserContextId});
    }

    async function evalCode(target, code) {
      return (await target.runtimeAgent().invoke_evaluate({expression: code})).result.value;
    }
  };

  TestSuite.prototype.testInputDispatchEventsToOOPIF = async function() {
    this.takeControl();

    await new Promise(callback => this._waitForTargets(2, callback));

    async function takeLogs(target) {
      const code = `
        (function() {
          var result = window.logs.join(' ');
          window.logs = [];
          return result;
        })()
      `;
      return (await target.runtimeAgent().invoke_evaluate({expression: code})).result.value;
    }

    let parentFrameOutput;
    let childFrameOutput;

    const inputAgent = SDK.targetManager.mainTarget().inputAgent();
    const runtimeAgent = SDK.targetManager.mainTarget().runtimeAgent();
    await inputAgent.invoke_dispatchMouseEvent({type: 'mousePressed', button: 'left', clickCount: 1, x: 10, y: 10});
    await inputAgent.invoke_dispatchMouseEvent({type: 'mouseMoved', button: 'left', clickCount: 1, x: 10, y: 20});
    await inputAgent.invoke_dispatchMouseEvent({type: 'mouseReleased', button: 'left', clickCount: 1, x: 10, y: 20});
    await inputAgent.invoke_dispatchMouseEvent({type: 'mousePressed', button: 'left', clickCount: 1, x: 230, y: 140});
    await inputAgent.invoke_dispatchMouseEvent({type: 'mouseMoved', button: 'left', clickCount: 1, x: 230, y: 150});
    await inputAgent.invoke_dispatchMouseEvent({type: 'mouseReleased', button: 'left', clickCount: 1, x: 230, y: 150});
    parentFrameOutput = 'Event type: mousedown button: 0 x: 10 y: 10 Event type: mouseup button: 0 x: 10 y: 20';
    this.assertEquals(parentFrameOutput, await takeLogs(SDK.targetManager.targets()[0]));
    childFrameOutput = 'Event type: mousedown button: 0 x: 30 y: 40 Event type: mouseup button: 0 x: 30 y: 50';
    this.assertEquals(childFrameOutput, await takeLogs(SDK.targetManager.targets()[1]));


    await inputAgent.invoke_dispatchKeyEvent({type: 'keyDown', key: 'a'});
    await runtimeAgent.invoke_evaluate({expression: `document.querySelector('iframe').focus()`});
    await inputAgent.invoke_dispatchKeyEvent({type: 'keyDown', key: 'a'});
    parentFrameOutput = 'Event type: keydown';
    this.assertEquals(parentFrameOutput, await takeLogs(SDK.targetManager.targets()[0]));
    childFrameOutput = 'Event type: keydown';
    this.assertEquals(childFrameOutput, await takeLogs(SDK.targetManager.targets()[1]));

    await inputAgent.invoke_dispatchTouchEvent({type: 'touchStart', touchPoints: [{x: 10, y: 10}]});
    await inputAgent.invoke_dispatchTouchEvent({type: 'touchEnd', touchPoints: []});
    await inputAgent.invoke_dispatchTouchEvent({type: 'touchStart', touchPoints: [{x: 230, y: 140}]});
    await inputAgent.invoke_dispatchTouchEvent({type: 'touchEnd', touchPoints: []});
    parentFrameOutput = 'Event type: touchstart touch x: 10 touch y: 10';
    this.assertEquals(parentFrameOutput, await takeLogs(SDK.targetManager.targets()[0]));
    childFrameOutput = 'Event type: touchstart touch x: 30 touch y: 40';
    this.assertEquals(childFrameOutput, await takeLogs(SDK.targetManager.targets()[1]));

    this.releaseControl();
  };

  TestSuite.prototype.testLoadResourceForFrontend = async function(baseURL, fileURL) {
    const test = this;
    const loggedHeaders = new Set(['cache-control', 'pragma']);
    function testCase(url, headers, expectedStatus, expectedHeaders, expectedContent) {
      return new Promise(fulfill => {
        Host.ResourceLoader.load(url, headers, callback);

        function callback(statusCode, headers, content) {
          test.assertEquals(expectedStatus, statusCode);

          const headersArray = [];
          for (const name in headers) {
            const nameLower = name.toLowerCase();
            if (loggedHeaders.has(nameLower))
              headersArray.push(nameLower);
          }
          headersArray.sort();
          test.assertEquals(expectedHeaders.join(', '), headersArray.join(', '));
          test.assertEquals(expectedContent, content);
          fulfill();
        }
      });
    }

    this.takeControl();
    await testCase(baseURL + 'non-existent.html', undefined, 404, [], '');
    await testCase(baseURL + 'hello.html', undefined, 200, [], '<!doctype html>\n<p>hello</p>\n');
    await testCase(baseURL + 'echoheader?x-devtools-test', {'x-devtools-test': 'Foo'}, 200, ['cache-control'], 'Foo');
    await testCase(baseURL + 'set-header?pragma:%20no-cache', undefined, 200, ['pragma'], 'pragma: no-cache');

    await SDK.targetManager.mainTarget().runtimeAgent().invoke_evaluate({
      expression: `fetch("/set-cookie?devtools-test-cookie=Bar",
                         {credentials: 'include'})`,
      awaitPromise: true
    });
    await testCase(baseURL + 'echoheader?Cookie', undefined, 200, ['cache-control'], 'devtools-test-cookie=Bar');

    await SDK.targetManager.mainTarget().runtimeAgent().invoke_evaluate({
      expression: `fetch("/set-cookie?devtools-test-cookie=same-site-cookie;SameSite=Lax",
                         {credentials: 'include'})`,
      awaitPromise: true
    });
    await testCase(
        baseURL + 'echoheader?Cookie', undefined, 200, ['cache-control'], 'devtools-test-cookie=same-site-cookie');
    await testCase('data:text/html,<body>hello</body>', undefined, 200, [], '<body>hello</body>');
    await testCase(fileURL, undefined, 200, [], '<html>\n<body>\nDummy page.\n</body>\n</html>\n');

    this.releaseControl();
  };

  TestSuite.prototype.testDevToolsLocalizationEnabled = async function() {
    this.takeControl();

    this.assertTrue(UI.viewManager.view('elements').title() === 'Elementos');
    this.assertTrue(UI.viewManager.view('accessibility.view').title() === 'Accesibilidad');
    this.assertTrue(UI.viewManager.view('performance.monitor').title() === 'Monitor de rendimiento');

    this.releaseControl();
  };

  TestSuite.prototype.testDevToolsLocalizationDisabled = async function() {
    this.takeControl();

    this.assertTrue(UI.viewManager.view('elements').title() === 'Elements');
    this.assertTrue(UI.viewManager.view('accessibility.view').title() === 'Accessibility');
    this.assertTrue(UI.viewManager.view('performance.monitor').title() === 'Performance monitor');

    this.releaseControl();
  };

  // Toggle the DevTools display theme.
  // Runs as a pre test.
  TestSuite.prototype.testDevToolsLocalizationChangeTheme = function() {
    this.takeControl();
    const themeSetting = Common.settingForTest('uiTheme');
    themeSetting.set((themeSetting.get() === 'default') ? 'dark' : 'default');
    this.releaseControl();
  };

  TestSuite.prototype.testExtensionWebSocketUserAgentOverride = async function(websocketPort) {
    this.takeControl();

    const testUserAgent = 'test user agent';
    SDK.multitargetNetworkManager.setUserAgentOverride(testUserAgent);

    function onRequestUpdated(event) {
      const request = event.data;
      if (request.resourceType() !== Common.resourceTypes.WebSocket)
        return;
      if (!request.requestHeadersText())
        return;

      let actualUserAgent = 'no user-agent header';
      for (const {name, value} of request.requestHeaders()) {
        if (name.toLowerCase() === 'user-agent')
          actualUserAgent = value;
      }
      this.assertEquals(testUserAgent, actualUserAgent);
      this.releaseControl();
    }
    SDK.targetManager.addModelListener(
        SDK.NetworkManager, SDK.NetworkManager.Events.RequestUpdated, onRequestUpdated.bind(this));

    this.evaluateInConsole_(`new WebSocket('ws://127.0.0.1:${websocketPort}')`, () => {});
  };

  /**
   * Serializes array of uiSourceCodes to string.
   * @param {!Array.<!Workspace.UISourceCode>} uiSourceCodes
   * @return {string}
   */
  TestSuite.prototype.uiSourceCodesToString_ = function(uiSourceCodes) {
    const names = [];
    for (let i = 0; i < uiSourceCodes.length; i++)
      names.push('"' + uiSourceCodes[i].url() + '"');
    return names.join(',');
  };

  /**
   * Returns all loaded non anonymous uiSourceCodes.
   * @return {!Array.<!Workspace.UISourceCode>}
   */
  TestSuite.prototype.nonAnonymousUISourceCodes_ = function() {
    /**
     * @param {!Workspace.UISourceCode} uiSourceCode
     */
    function filterOutService(uiSourceCode) {
      return !uiSourceCode.project().isServiceProject();
    }

    const uiSourceCodes = Workspace.workspace.uiSourceCodes();
    return uiSourceCodes.filter(filterOutService);
  };

  /*
 * Evaluates the code in the console as if user typed it manually and invokes
 * the callback when the result message is received and added to the console.
 * @param {string} code
 * @param {function(string)} callback
 */
  TestSuite.prototype.evaluateInConsole_ = function(code, callback) {
    function innerEvaluate() {
      UI.context.removeFlavorChangeListener(SDK.ExecutionContext, showConsoleAndEvaluate, this);
      const consoleView = Console.ConsoleView.instance();
      consoleView._prompt._appendCommand(code);

      this.addSniffer(Console.ConsoleView.prototype, '_consoleMessageAddedForTest', function(viewMessage) {
        callback(viewMessage.toMessageElement().deepTextContent());
      }.bind(this));
    }

    function showConsoleAndEvaluate() {
      Common.console.showPromise().then(innerEvaluate.bind(this));
    }

    if (!UI.context.flavor(SDK.ExecutionContext)) {
      UI.context.addFlavorChangeListener(SDK.ExecutionContext, showConsoleAndEvaluate, this);
      return;
    }
    showConsoleAndEvaluate.call(this);
  };

  /**
   * Checks that all expected scripts are present in the scripts list
   * in the Scripts panel.
   * @param {!Array.<string>} expected Regular expressions describing
   *     expected script names.
   * @return {boolean} Whether all the scripts are in "scripts-files" select
   *     box
   */
  TestSuite.prototype._scriptsAreParsed = function(expected) {
    const uiSourceCodes = this.nonAnonymousUISourceCodes_();
    // Check that at least all the expected scripts are present.
    const missing = expected.slice(0);
    for (let i = 0; i < uiSourceCodes.length; ++i) {
      for (let j = 0; j < missing.length; ++j) {
        if (uiSourceCodes[i].name().search(missing[j]) !== -1) {
          missing.splice(j, 1);
          break;
        }
      }
    }
    return missing.length === 0;
  };

  /**
   * Waits for script pause, checks expectations, and invokes the callback.
   * @param {function():void} callback
   */
  TestSuite.prototype._waitForScriptPause = function(callback) {
    this.addSniffer(SDK.DebuggerModel.prototype, '_pausedScript', callback);
  };

  /**
   * Waits until all the scripts are parsed and invokes the callback.
   */
  TestSuite.prototype._waitUntilScriptsAreParsed = function(expectedScripts, callback) {
    const test = this;

    function waitForAllScripts() {
      if (test._scriptsAreParsed(expectedScripts))
        callback();
      else
        test.addSniffer(UI.panels.sources.sourcesView(), '_addUISourceCode', waitForAllScripts);
    }

    waitForAllScripts();
  };

  TestSuite.prototype._waitForTargets = function(n, callback) {
    checkTargets.call(this);

    function checkTargets() {
      if (SDK.targetManager.targets().length >= n)
        callback.call(null);
      else
        this.addSniffer(SDK.TargetManager.prototype, 'createTarget', checkTargets.bind(this));
    }
  };

  TestSuite.prototype._waitForExecutionContexts = function(n, callback) {
    const runtimeModel = SDK.targetManager.mainTarget().model(SDK.RuntimeModel);
    checkForExecutionContexts.call(this);

    function checkForExecutionContexts() {
      if (runtimeModel.executionContexts().length >= n)
        callback.call(null);
      else
        this.addSniffer(SDK.RuntimeModel.prototype, '_executionContextCreated', checkForExecutionContexts.bind(this));
    }
  };


  window.uiTests = new TestSuite(window.domAutomationController);
})(window);
// Copyright 2019 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file

// This file is used when the DevTools are in hosted mode.
// When the DevTools are not in hosted mode (i.e. !InspectorFrontendHost.isHostedMode()),
// the browser will instead serve back a different version of strings.js that includes
// the localized strings.

self.DevToolsLocalization = {
  /**
   * @param {string} stringId
   * @return {string}
   */
  getString: stringId => stringId,
};
(function() {
    /*
 * Copyright (C) 2012 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/* eslint-disable indent */

function defineCommonExtensionSymbols(apiPrivate) {
  if (!apiPrivate.panels)
    apiPrivate.panels = {};
  apiPrivate.panels.SearchAction = {
    CancelSearch: 'cancelSearch',
    PerformSearch: 'performSearch',
    NextSearchResult: 'nextSearchResult',
    PreviousSearchResult: 'previousSearchResult'
  };

  /** @enum {string} */
  apiPrivate.Events = {
    ButtonClicked: 'button-clicked-',
    PanelObjectSelected: 'panel-objectSelected-',
    NetworkRequestFinished: 'network-request-finished',
    OpenResource: 'open-resource',
    PanelSearch: 'panel-search-',
    RecordingStarted: 'trace-recording-started-',
    RecordingStopped: 'trace-recording-stopped-',
    ResourceAdded: 'resource-added',
    ResourceContentCommitted: 'resource-content-committed',
    ViewShown: 'view-shown-',
    ViewHidden: 'view-hidden-'
  };

  /** @enum {string} */
  apiPrivate.Commands = {
    AddRequestHeaders: 'addRequestHeaders',
    AddTraceProvider: 'addTraceProvider',
    ApplyStyleSheet: 'applyStyleSheet',
    CompleteTraceSession: 'completeTraceSession',
    CreatePanel: 'createPanel',
    CreateSidebarPane: 'createSidebarPane',
    CreateToolbarButton: 'createToolbarButton',
    EvaluateOnInspectedPage: 'evaluateOnInspectedPage',
    ForwardKeyboardEvent: '_forwardKeyboardEvent',
    GetHAR: 'getHAR',
    GetPageResources: 'getPageResources',
    GetRequestContent: 'getRequestContent',
    GetResourceContent: 'getResourceContent',
    InspectedURLChanged: 'inspectedURLChanged',
    OpenResource: 'openResource',
    Reload: 'Reload',
    Subscribe: 'subscribe',
    SetOpenResourceHandler: 'setOpenResourceHandler',
    SetResourceContent: 'setResourceContent',
    SetSidebarContent: 'setSidebarContent',
    SetSidebarHeight: 'setSidebarHeight',
    SetSidebarPage: 'setSidebarPage',
    ShowPanel: 'showPanel',
    Unsubscribe: 'unsubscribe',
    UpdateButton: 'updateButton'
  };
}

/**
 * @param {!ExtensionDescriptor} extensionInfo
 * @param {string} inspectedTabId
 * @param {string} themeName
 * @param {!Array<number>} keysToForward
 * @param {number} injectedScriptId
 * @param {function(!Object, !Object)} testHook
 * @suppressGlobalPropertiesCheck
 */
function injectedExtensionAPI(extensionInfo, inspectedTabId, themeName, keysToForward, testHook, injectedScriptId) {
  const keysToForwardSet = new Set(keysToForward);
  const chrome = window.chrome || {};
  const devtools_descriptor = Object.getOwnPropertyDescriptor(chrome, 'devtools');
  if (devtools_descriptor)
    return;

  const apiPrivate = {};

  defineCommonExtensionSymbols(apiPrivate);

  const commands = apiPrivate.Commands;
  const events = apiPrivate.Events;
  let userAction = false;

  // Here and below, all constructors are private to API implementation.
  // For a public type Foo, if internal fields are present, these are on
  // a private FooImpl type, an instance of FooImpl is used in a closure
  // by Foo consutrctor to re-bind publicly exported members to an instance
  // of Foo.

  /**
   * @constructor
   */
  function EventSinkImpl(type, customDispatch) {
    this._type = type;
    this._listeners = [];
    this._customDispatch = customDispatch;
  }

  EventSinkImpl.prototype = {
    addListener: function(callback) {
      if (typeof callback !== 'function')
        throw 'addListener: callback is not a function';
      if (this._listeners.length === 0)
        extensionServer.sendRequest({command: commands.Subscribe, type: this._type});
      this._listeners.push(callback);
      extensionServer.registerHandler('notify-' + this._type, this._dispatch.bind(this));
    },

    removeListener: function(callback) {
      const listeners = this._listeners;

      for (let i = 0; i < listeners.length; ++i) {
        if (listeners[i] === callback) {
          listeners.splice(i, 1);
          break;
        }
      }
      if (this._listeners.length === 0)
        extensionServer.sendRequest({command: commands.Unsubscribe, type: this._type});
    },

    /**
     * @param {...} vararg
     */
    _fire: function(vararg) {
      const listeners = this._listeners.slice();
      for (let i = 0; i < listeners.length; ++i)
        listeners[i].apply(null, arguments);
    },

    _dispatch: function(request) {
      if (this._customDispatch)
        this._customDispatch.call(this, request);
      else
        this._fire.apply(this, request.arguments);
    }
  };

  /**
   * @constructor
   */
  function InspectorExtensionAPI() {
    this.inspectedWindow = new InspectedWindow();
    this.panels = new Panels();
    this.network = new Network();
    this.timeline = new Timeline();
    defineDeprecatedProperty(this, 'webInspector', 'resources', 'network');
  }

  /**
   * @constructor
   */
  function Network() {
    /**
     * @this {EventSinkImpl}
     */
    function dispatchRequestEvent(message) {
      const request = message.arguments[1];
      request.__proto__ = new Request(message.arguments[0]);
      this._fire(request);
    }
    this.onRequestFinished = new EventSink(events.NetworkRequestFinished, dispatchRequestEvent);
    defineDeprecatedProperty(this, 'network', 'onFinished', 'onRequestFinished');
    this.onNavigated = new EventSink(events.InspectedURLChanged);
  }

  Network.prototype = {
    getHAR: function(callback) {
      function callbackWrapper(result) {
        const entries = (result && result.entries) || [];
        for (let i = 0; i < entries.length; ++i) {
          entries[i].__proto__ = new Request(entries[i]._requestId);
          delete entries[i]._requestId;
        }
        callback(result);
      }
      extensionServer.sendRequest({command: commands.GetHAR}, callback && callbackWrapper);
    },

    addRequestHeaders: function(headers) {
      extensionServer.sendRequest(
          {command: commands.AddRequestHeaders, headers: headers, extensionId: window.location.hostname});
    }
  };

  /**
   * @constructor
   */
  function RequestImpl(id) {
    this._id = id;
  }

  RequestImpl.prototype = {
    getContent: function(callback) {
      function callbackWrapper(response) {
        callback(response.content, response.encoding);
      }
      extensionServer.sendRequest({command: commands.GetRequestContent, id: this._id}, callback && callbackWrapper);
    }
  };

  /**
   * @constructor
   */
  function Panels() {
    const panels = {
      elements: new ElementsPanel(),
      sources: new SourcesPanel(),
    };

    function panelGetter(name) {
      return panels[name];
    }
    for (const panel in panels)
      this.__defineGetter__(panel, panelGetter.bind(null, panel));
    this.applyStyleSheet = function(styleSheet) {
      extensionServer.sendRequest({command: commands.ApplyStyleSheet, styleSheet: styleSheet});
    };
  }

  Panels.prototype = {
    create: function(title, icon, page, callback) {
      const id = 'extension-panel-' + extensionServer.nextObjectId();
      const request = {command: commands.CreatePanel, id: id, title: title, icon: icon, page: page};
      extensionServer.sendRequest(request, callback && callback.bind(this, new ExtensionPanel(id)));
    },

    setOpenResourceHandler: function(callback) {
      const hadHandler = extensionServer.hasHandler(events.OpenResource);

      function callbackWrapper(message) {
        // Allow the panel to show itself when handling the event.
        userAction = true;
        try {
          callback.call(null, new Resource(message.resource), message.lineNumber);
        } finally {
          userAction = false;
        }
      }

      if (!callback)
        extensionServer.unregisterHandler(events.OpenResource);
      else
        extensionServer.registerHandler(events.OpenResource, callbackWrapper);

      // Only send command if we either removed an existing handler or added handler and had none before.
      if (hadHandler === !callback)
        extensionServer.sendRequest({command: commands.SetOpenResourceHandler, 'handlerPresent': !!callback});
    },

    openResource: function(url, lineNumber, callback) {
      extensionServer.sendRequest({command: commands.OpenResource, 'url': url, 'lineNumber': lineNumber}, callback);
    },

    get SearchAction() {
      return apiPrivate.panels.SearchAction;
    }
  };

  /**
   * @constructor
   */
  function ExtensionViewImpl(id) {
    this._id = id;

    /**
     * @this {EventSinkImpl}
     */
    function dispatchShowEvent(message) {
      const frameIndex = message.arguments[0];
      if (typeof frameIndex === 'number')
        this._fire(window.parent.frames[frameIndex]);
      else
        this._fire();
    }

    if (id) {
      this.onShown = new EventSink(events.ViewShown + id, dispatchShowEvent);
      this.onHidden = new EventSink(events.ViewHidden + id);
    }
  }

  /**
   * @constructor
   * @extends {ExtensionViewImpl}
   * @param {string} hostPanelName
   */
  function PanelWithSidebarImpl(hostPanelName) {
    ExtensionViewImpl.call(this, null);
    this._hostPanelName = hostPanelName;
    this.onSelectionChanged = new EventSink(events.PanelObjectSelected + hostPanelName);
  }

  PanelWithSidebarImpl.prototype = {
    createSidebarPane: function(title, callback) {
      const id = 'extension-sidebar-' + extensionServer.nextObjectId();
      const request = {command: commands.CreateSidebarPane, panel: this._hostPanelName, id: id, title: title};
      function callbackWrapper() {
        callback(new ExtensionSidebarPane(id));
      }
      extensionServer.sendRequest(request, callback && callbackWrapper);
    },

    __proto__: ExtensionViewImpl.prototype
  };

  function declareInterfaceClass(implConstructor) {
    return function() {
      const impl = {__proto__: implConstructor.prototype};
      implConstructor.apply(impl, arguments);
      populateInterfaceClass(this, impl);
    };
  }

  function defineDeprecatedProperty(object, className, oldName, newName) {
    let warningGiven = false;
    function getter() {
      if (!warningGiven) {
        console.warn(className + '.' + oldName + ' is deprecated. Use ' + className + '.' + newName + ' instead');
        warningGiven = true;
      }
      return object[newName];
    }
    object.__defineGetter__(oldName, getter);
  }

  function extractCallbackArgument(args) {
    const lastArgument = args[args.length - 1];
    return typeof lastArgument === 'function' ? lastArgument : undefined;
  }

  const Button = declareInterfaceClass(ButtonImpl);
  const EventSink = declareInterfaceClass(EventSinkImpl);
  const ExtensionPanel = declareInterfaceClass(ExtensionPanelImpl);
  const ExtensionSidebarPane = declareInterfaceClass(ExtensionSidebarPaneImpl);
  const PanelWithSidebar = declareInterfaceClass(PanelWithSidebarImpl);
  const Request = declareInterfaceClass(RequestImpl);
  const Resource = declareInterfaceClass(ResourceImpl);
  const TraceSession = declareInterfaceClass(TraceSessionImpl);

  /**
   * @constructor
   * @extends {PanelWithSidebar}
   */
  function ElementsPanel() {
    PanelWithSidebar.call(this, 'elements');
  }

  ElementsPanel.prototype = {__proto__: PanelWithSidebar.prototype};

  /**
   * @constructor
   * @extends {PanelWithSidebar}
   */
  function SourcesPanel() {
    PanelWithSidebar.call(this, 'sources');
  }

  SourcesPanel.prototype = {__proto__: PanelWithSidebar.prototype};

  /**
   * @constructor
   * @extends {ExtensionViewImpl}
   */
  function ExtensionPanelImpl(id) {
    ExtensionViewImpl.call(this, id);
    this.onSearch = new EventSink(events.PanelSearch + id);
  }

  ExtensionPanelImpl.prototype = {
    /**
     * @return {!Object}
     */
    createStatusBarButton: function(iconPath, tooltipText, disabled) {
      const id = 'button-' + extensionServer.nextObjectId();
      const request = {
        command: commands.CreateToolbarButton,
        panel: this._id,
        id: id,
        icon: iconPath,
        tooltip: tooltipText,
        disabled: !!disabled
      };
      extensionServer.sendRequest(request);
      return new Button(id);
    },

    show: function() {
      if (!userAction)
        return;

      const request = {command: commands.ShowPanel, id: this._id};
      extensionServer.sendRequest(request);
    },

    __proto__: ExtensionViewImpl.prototype
  };

  /**
   * @constructor
   * @extends {ExtensionViewImpl}
   */
  function ExtensionSidebarPaneImpl(id) {
    ExtensionViewImpl.call(this, id);
  }

  ExtensionSidebarPaneImpl.prototype = {
    setHeight: function(height) {
      extensionServer.sendRequest({command: commands.SetSidebarHeight, id: this._id, height: height});
    },

    setExpression: function(expression, rootTitle, evaluateOptions) {
      const request = {
        command: commands.SetSidebarContent,
        id: this._id,
        expression: expression,
        rootTitle: rootTitle,
        evaluateOnPage: true,
      };
      if (typeof evaluateOptions === 'object')
        request.evaluateOptions = evaluateOptions;
      extensionServer.sendRequest(request, extractCallbackArgument(arguments));
    },

    setObject: function(jsonObject, rootTitle, callback) {
      extensionServer.sendRequest(
          {command: commands.SetSidebarContent, id: this._id, expression: jsonObject, rootTitle: rootTitle}, callback);
    },

    setPage: function(page) {
      extensionServer.sendRequest({command: commands.SetSidebarPage, id: this._id, page: page});
    },

    __proto__: ExtensionViewImpl.prototype
  };

  /**
   * @constructor
   */
  function ButtonImpl(id) {
    this._id = id;
    this.onClicked = new EventSink(events.ButtonClicked + id);
  }

  ButtonImpl.prototype = {
    update: function(iconPath, tooltipText, disabled) {
      const request =
          {command: commands.UpdateButton, id: this._id, icon: iconPath, tooltip: tooltipText, disabled: !!disabled};
      extensionServer.sendRequest(request);
    }
  };

  /**
   * @constructor
   */
  function Timeline() {
  }

  Timeline.prototype = {
    /**
     * @param {string} categoryName
     * @param {string} categoryTooltip
     * @return {!TraceProvider}
     */
    addTraceProvider: function(categoryName, categoryTooltip) {
      const id = 'extension-trace-provider-' + extensionServer.nextObjectId();
      extensionServer.sendRequest(
          {command: commands.AddTraceProvider, id: id, categoryName: categoryName, categoryTooltip: categoryTooltip});
      return new TraceProvider(id);
    }
  };

  /**
   * @constructor
   * @param {string} id
   */
  function TraceSessionImpl(id) {
    this._id = id;
  }

  TraceSessionImpl.prototype = {
    /**
     * @param {string=} url
     * @param {number=} timeOffset
     */
    complete: function(url, timeOffset) {
      const request =
          {command: commands.CompleteTraceSession, id: this._id, url: url || '', timeOffset: timeOffset || 0};
      extensionServer.sendRequest(request);
    }
  };

  /**
   * @constructor
   * @param {string} id
   */
  function TraceProvider(id) {
    /**
     * @this {EventSinkImpl}
     */
    function dispatchRecordingStarted(message) {
      const sessionId = message.arguments[0];
      this._fire(new TraceSession(sessionId));
    }

    this.onRecordingStarted = new EventSink(events.RecordingStarted + id, dispatchRecordingStarted);
    this.onRecordingStopped = new EventSink(events.RecordingStopped + id);
  }

  /**
   * @constructor
   */
  function InspectedWindow() {
    /**
     * @this {EventSinkImpl}
     */
    function dispatchResourceEvent(message) {
      this._fire(new Resource(message.arguments[0]));
    }

    /**
     * @this {EventSinkImpl}
     */
    function dispatchResourceContentEvent(message) {
      this._fire(new Resource(message.arguments[0]), message.arguments[1]);
    }

    this.onResourceAdded = new EventSink(events.ResourceAdded, dispatchResourceEvent);
    this.onResourceContentCommitted = new EventSink(events.ResourceContentCommitted, dispatchResourceContentEvent);
  }

  InspectedWindow.prototype = {
    reload: function(optionsOrUserAgent) {
      let options = null;
      if (typeof optionsOrUserAgent === 'object') {
        options = optionsOrUserAgent;
      } else if (typeof optionsOrUserAgent === 'string') {
        options = {userAgent: optionsOrUserAgent};
        console.warn(
            'Passing userAgent as string parameter to inspectedWindow.reload() is deprecated. ' +
            'Use inspectedWindow.reload({ userAgent: value}) instead.');
      }
      extensionServer.sendRequest({command: commands.Reload, options: options});
    },

    /**
     * @return {?Object}
     */
    eval: function(expression, evaluateOptions) {
      const callback = extractCallbackArgument(arguments);
      function callbackWrapper(result) {
        if (result.isError || result.isException)
          callback(undefined, result);
        else
          callback(result.value);
      }
      const request = {command: commands.EvaluateOnInspectedPage, expression: expression};
      if (typeof evaluateOptions === 'object')
        request.evaluateOptions = evaluateOptions;
      extensionServer.sendRequest(request, callback && callbackWrapper);
      return null;
    },

    getResources: function(callback) {
      function wrapResource(resourceData) {
        return new Resource(resourceData);
      }
      function callbackWrapper(resources) {
        callback(resources.map(wrapResource));
      }
      extensionServer.sendRequest({command: commands.GetPageResources}, callback && callbackWrapper);
    }
  };

  /**
   * @constructor
   */
  function ResourceImpl(resourceData) {
    this._url = resourceData.url;
    this._type = resourceData.type;
  }

  ResourceImpl.prototype = {
    get url() {
      return this._url;
    },

    get type() {
      return this._type;
    },

    getContent: function(callback) {
      function callbackWrapper(response) {
        callback(response.content, response.encoding);
      }

      extensionServer.sendRequest({command: commands.GetResourceContent, url: this._url}, callback && callbackWrapper);
    },

    setContent: function(content, commit, callback) {
      extensionServer.sendRequest(
          {command: commands.SetResourceContent, url: this._url, content: content, commit: commit}, callback);
    }
  };

  function getTabId() {
    return inspectedTabId;
  }

  let keyboardEventRequestQueue = [];
  let forwardTimer = null;

  function forwardKeyboardEvent(event) {
    let modifiers = 0;
    if (event.shiftKey)
      modifiers |= 1;
    if (event.ctrlKey)
      modifiers |= 2;
    if (event.altKey)
      modifiers |= 4;
    if (event.metaKey)
      modifiers |= 8;
    const num = (event.keyCode & 255) | (modifiers << 8);
    // We only care about global hotkeys, not about random text
    if (!keysToForwardSet.has(num))
      return;
    event.preventDefault();
    const requestPayload = {
      eventType: event.type,
      ctrlKey: event.ctrlKey,
      altKey: event.altKey,
      metaKey: event.metaKey,
      shiftKey: event.shiftKey,
      keyIdentifier: event.keyIdentifier,
      key: event.key,
      code: event.code,
      location: event.location,
      keyCode: event.keyCode
    };
    keyboardEventRequestQueue.push(requestPayload);
    if (!forwardTimer)
      forwardTimer = setTimeout(forwardEventQueue, 0);
  }

  function forwardEventQueue() {
    forwardTimer = null;
    const request = {command: commands.ForwardKeyboardEvent, entries: keyboardEventRequestQueue};
    extensionServer.sendRequest(request);
    keyboardEventRequestQueue = [];
  }

  document.addEventListener('keydown', forwardKeyboardEvent, false);

  /**
   * @constructor
   */
  function ExtensionServerClient() {
    this._callbacks = {};
    this._handlers = {};
    this._lastRequestId = 0;
    this._lastObjectId = 0;

    this.registerHandler('callback', this._onCallback.bind(this));

    const channel = new MessageChannel();
    this._port = channel.port1;
    this._port.addEventListener('message', this._onMessage.bind(this), false);
    this._port.start();

    window.parent.postMessage('registerExtension', '*', [channel.port2]);
  }

  ExtensionServerClient.prototype = {
    /**
     * @param {!Object} message
     * @param {function()=} callback
     */
    sendRequest: function(message, callback) {
      if (typeof callback === 'function')
        message.requestId = this._registerCallback(callback);
      this._port.postMessage(message);
    },

    /**
     * @return {boolean}
     */
    hasHandler: function(command) {
      return !!this._handlers[command];
    },

    registerHandler: function(command, handler) {
      this._handlers[command] = handler;
    },

    unregisterHandler: function(command) {
      delete this._handlers[command];
    },

    /**
     * @return {string}
     */
    nextObjectId: function() {
      return injectedScriptId.toString() + '_' + ++this._lastObjectId;
    },

    _registerCallback: function(callback) {
      const id = ++this._lastRequestId;
      this._callbacks[id] = callback;
      return id;
    },

    _onCallback: function(request) {
      if (request.requestId in this._callbacks) {
        const callback = this._callbacks[request.requestId];
        delete this._callbacks[request.requestId];
        callback(request.result);
      }
    },

    _onMessage: function(event) {
      const request = event.data;
      const handler = this._handlers[request.command];
      if (handler)
        handler.call(this, request);
    }
  };

  function populateInterfaceClass(interfaze, implementation) {
    for (const member in implementation) {
      if (member.charAt(0) === '_')
        continue;
      let descriptor = null;
      // Traverse prototype chain until we find the owner.
      for (let owner = implementation; owner && !descriptor; owner = owner.__proto__)
        descriptor = Object.getOwnPropertyDescriptor(owner, member);
      if (!descriptor)
        continue;
      if (typeof descriptor.value === 'function')
        interfaze[member] = descriptor.value.bind(implementation);
      else if (typeof descriptor.get === 'function')
        interfaze.__defineGetter__(member, descriptor.get.bind(implementation));
      else
        Object.defineProperty(interfaze, member, descriptor);
    }
  }

  const extensionServer = new ExtensionServerClient();
  const coreAPI = new InspectorExtensionAPI();

  Object.defineProperty(chrome, 'devtools', {value: {}, enumerable: true});

  // Only expose tabId on chrome.devtools.inspectedWindow, not webInspector.inspectedWindow.
  chrome.devtools.inspectedWindow = {};
  chrome.devtools.inspectedWindow.__defineGetter__('tabId', getTabId);
  chrome.devtools.inspectedWindow.__proto__ = coreAPI.inspectedWindow;
  chrome.devtools.network = coreAPI.network;
  chrome.devtools.panels = coreAPI.panels;
  chrome.devtools.panels.themeName = themeName;

  // default to expose experimental APIs for now.
  if (extensionInfo.exposeExperimentalAPIs !== false) {
    chrome.experimental = chrome.experimental || {};
    chrome.experimental.devtools = chrome.experimental.devtools || {};

    const properties = Object.getOwnPropertyNames(coreAPI);
    for (let i = 0; i < properties.length; ++i) {
      const descriptor = Object.getOwnPropertyDescriptor(coreAPI, properties[i]);
      if (descriptor)
        Object.defineProperty(chrome.experimental.devtools, properties[i], descriptor);
    }
    chrome.experimental.devtools.inspectedWindow = chrome.devtools.inspectedWindow;
  }

  if (extensionInfo.exposeWebInspectorNamespace)
    window.webInspector = coreAPI;
  testHook(extensionServer, coreAPI);
}

/**
 * @param {!ExtensionDescriptor} extensionInfo
 * @param {string} inspectedTabId
 * @param {string} themeName
 * @param {!Array<number>} keysToForward
 * @param {function(!Object, !Object)|undefined} testHook
 * @return {string}
 */
self.buildExtensionAPIInjectedScript = function(extensionInfo, inspectedTabId, themeName, keysToForward, testHook) {
  const argumentsJSON = [extensionInfo, inspectedTabId || null, themeName, keysToForward].map(_ => JSON.stringify(_)).join(',');
  if (!testHook)
    testHook = () => {};
  return '(function(injectedScriptId){ ' + defineCommonExtensionSymbols.toString() + ';' +
      '(' + injectedExtensionAPI.toString() + ')(' + argumentsJSON + ',' + testHook + ', injectedScriptId);' +
      '})';
};

        var tabId;
        var extensionInfo = {};
        var extensionServer;
        platformExtensionAPI(injectedExtensionAPI("remote-" + window.parent.frames.length));
    })();<svg xmlns="http://www.w3.org/2000/svg" width="770" height="1580"><path d="M4.5 366v100" fill="none" stroke="#f80" stroke-width="9"/><path d="M4.5 768V568" fill="none" stroke="#888" stroke-width="9"/><rect width="767" height="1580" ry="80" rx="80" fill="#222" fill-rule="evenodd" transform="matrix(-1 0 0 1 770.5 0)"/><g fill="#fff" fill-rule="evenodd" transform="matrix(-1 0 0 1 770.5 0)"><rect x="273.5" y="1526" width="220" height="15" ry="5" rx="5" fill-opacity=".133"/><path d="M70.363 6.95C28.333 5.754 4.808 47.982 4.838 83.222l1.194 1424.49c.026 30.952 32.038 68.279 64.634 68.216l622.086-1.194c30.873-.06 68.216-37.263 68.216-64.634V76.057c0-31.282-24.689-66.72-63.137-70.302C456.898 4.61 269.722 6.95 70.363 6.95z" fill-opacity=".867"/></g></svg>PNG

   IHDR         H   !PLTE!!!444dddeee333...///Xe   \IDATx^0]A@jqhl7]9k=G?9<-$.$Izb	$qIb_a= 53!    IENDB`<svg xmlns="http://www.w3.org/2000/svg" height="1580" width="770"><path d="M766 366v100" stroke="#f80" stroke-width="9" fill="none"/><path d="M766 768V568" stroke="#888" stroke-width="9" fill="none"/><g fill-rule="evenodd"><rect rx="80" ry="80" height="1580" width="767" fill="#222"/><rect fill-opacity=".133" rx="5" ry="5" height="18" width="80" y="80" x="343.5" fill="#fff"/><circle cx="459" fill-opacity=".267" cy="76.25" r="15" fill="#00f"/><circle cx="297.25" fill-opacity=".267" cy="74" r="17.5" fill="#00f"/></g><g fill-rule="evenodd" fill="#fff"><rect fill-opacity=".133" rx="10" ry="10" height="25" width="50" y="34" x="358.5"/><rect fill-opacity=".133" rx="5" ry="5" height="15" width="220" y="1526" x="273.5"/><path d="M83.5 38c-27.7 0-50 22.3-50 50v1360c0 16.62 13.38 30 30 30h640c16.62 0 30-13.38 30-30V88c0-27.7-22.3-50-50-50h-140c-19.39 0-35 15.61-35 35v4c0 24.93-20.07 45-45 45h-160c-24.93 0-45-20.07-45-45v-4c0-19.39-15.61-35-35-35h-70z" fill-opacity=".867"/></g></svg>PNG

   IHDR         ?tB   PLTEdV-   IDATx^1   @1<%$DTCj-    IENDB`PNG

   IHDR         s2   PLTE7d/   eIDATx^@3~tnm@(`r\Wy/s	
,} 
B,+?#?
rw	 v27    IENDB`PNG

   IHDR         .   PLTEdV-   "IDATx^  ?-P@pH^F(kZ1    IENDB`<svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" version="1.1" width="750" height="750"><defs id="defs3"><style id="style5">.cls-2{fill:#ffe082;opacity:.5}.cls-3{fill:#2979ff}.cls-5{fill:#fff176}.cls-6{fill:#f4511e}.cls-7{fill:#e64a19}.cls-9{fill:#ff7043}.cls-11{fill:#fdd835}.cls-12{fill:#fff9c4}</style></defs><path d="M92.428 571.024c52.32 0 52.32-33.94 104.64-33.94s52.31 33.94 104.63 33.94c52.32 0 52.32-33.94 104.63-33.94 52.31 0 52.32 33.94 104.64 33.94s52.32-33.94 104.64-33.94c49.48 0 52.17 30.34 96.56 33.64a326.73 326.73 0 0 0 8.09-72.39c0-179.87-145.82-325.69-325.69-325.69s-325.7 145.82-325.7 325.69a326.75 326.75 0 0 0 7.9 71.51 98.88 98.88 0 0 0 15.66 1.18z" id="path9" fill="#304ffe"/><path id="rect15" fill="#ffd54f" d="M362.978 213.564h84.84v78.49h-84.84z"/><path class="cls-5" id="rect17" fill="#fff176" d="M362.978 213.564h29.95v78.49h-29.95z"/><ellipse class="cls-5" cx="392.298" cy="233.214" rx="19.84" ry="24.89" id="ellipse19" fill="#fff176"/><path class="cls-6" d="M360.898 204.704a43.835 43.835 0 1 1 87.67 0" id="path21" fill="#f4511e"/><path class="cls-7" d="M405.108 160.874a43.51 43.51 0 0 1 43.46 43.83h-43.46v-43.83z" id="path23" fill="#e64a19"/><rect class="cls-6" x="352.418" y="203.294" width="104.64" height="11.31" rx="5.66" ry="5.66" id="rect25" fill="#f4511e"/><path id="polygon27" transform="translate(-42.202 118.024)" fill="#c5cae9" d="M393 416l12.23-242.5h84.84L501 404z"/><path class="cls-9" id="line29" fill="#ff7043" d="M449.038 310.254l3.26 64.17"/><path class="cls-9" id="polygon31" transform="translate(-42.202 118.024)" fill="#ff7043" d="M402.05 233.8l-3.42 67.29 95.87-44.69-3.26-64.17z"/><path class="cls-9" id="line33" fill="#ff7043" d="M455.518 437.664l3.27 64.18"/><path class="cls-9" id="polygon35" transform="translate(-42.202 118.024)" fill="#ff7043" d="M395.25 367.4l-3.42 67.3 109.16-50.88-3.27-64.18z"/><path class="cls-7" id="rect39" fill="#e64a19" d="M349.988 255.904h109.49v35.82h-109.49z"/><path class="cls-6" id="rect41" fill="#f4511e" d="M349.988 255.904h71.78v35.82h-71.78z"/><path class="cls-2" d="M403.978 255.904c0 13-12.1 23.5-27 23.5s-27-10.52-27-23.5" id="path43" opacity=".5" fill="#ffe082"/><g id="layer1" transform="translate(-111.07 296.27)" display="inline"><path class="cls-3" d="M653.728-50.456a19.59 19.59 0 0 1 8.32 1.84 34.49 34.49 0 0 1 66.7-9h.12a23.25 23.25 0 0 1 0 46.5h-75.14a19.67 19.67 0 1 1 0-39.34z" id="path71" fill="#2979ff"/><path d="M430.728 137.024a16.6 16.6 0 0 1 7 1.56 29.23 29.23 0 0 1 56.53-7.63h.1a19.71 19.71 0 1 1 0 39.41h-63.63a16.67 16.67 0 1 1 0-33.34z" id="path77" fill="#448aff"/></g><g id="layer2" transform="translate(-111.07 296.27)" display="inline"><circle class="cls-11" cx="593.868" cy="-88.776" r="3.53" id="circle45" fill="#fdd835"/><circle class="cls-12" cx="624.868" cy="109.624" r="6.13" id="circle47" fill="#fff9c4"/><circle class="cls-12" cx="253.468" cy="53.594" r="6.13" id="circle49" fill="#fff9c4"/><circle class="cls-12" cx="353.418" cy="160.214" r="6.13" id="circle51" fill="#fff9c4"/><circle class="cls-12" cx="598.478" cy="11.644" r="6.13" id="circle53" fill="#fff9c4"/><circle class="cls-12" cx="727.628" cy="169.544" r="6.13" id="circle55" fill="#fff9c4"/><circle class="cls-11" cx="240.268" cy="192.404" r="3.53" id="circle57" fill="#fdd835"/><circle class="cls-11" cx="272.828" cy="121.094" r="3.53" id="circle59" fill="#fdd835"/><circle class="cls-11" cx="294.738" cy="102.714" r="3.53" id="circle61" fill="#fdd835"/><circle class="cls-11" cx="387.348" cy="20.004" r="3.53" id="circle63" fill="#fdd835"/><circle class="cls-11" cx="679.868" cy="30.224" r="3.53" id="circle65" fill="#fdd835"/><circle class="cls-11" cx="818.598" cy="177.654" r="3.53" id="circle67" fill="#fdd835"/><circle class="cls-11" cx="328.678" cy="9.394" r="3.53" id="circle69" fill="#fdd835"/><circle class="cls-11" cx="640.898" cy="179.204" r="3.53" id="circle73" fill="#fdd835"/><circle class="cls-11" cx="747.868" cy="90.754" r="3.53" id="circle75" fill="#fdd835"/></g><g id="layer3" transform="translate(-111.07 296.27)" display="inline"><path class="cls-2" d="M475.488-83.896l-334.62-47.79a3.65 3.65 0 0 0-1-.14c-8.67 0-16 31.89-16 71.15 0 39.26 7.33 71.07 16 71.07a3.66 3.66 0 0 0 .93-.13l334.64-47.88v-46.28z" id="path11" opacity=".5" fill="#ffe082"/></g><g id="layer6" display="inline"><path id="polygon37" transform="translate(-42.202 118.024)" opacity=".5" fill="#304ffe" d="M493.27 173.5h-42.9V393L502 416l-8.73-242.5z"/></g><g id="layer5" transform="translate(-111.07 296.27)" display="inline"><path d="M413.768 275.484c52.32 0 52.32-33.94 104.63-33.94 52.31 0 52.32 33.94 104.63 33.94 44.42 0 51.13-24.46 84.16-31.84-45.13-24.66-112.53-40.33-187.84-40.33-75.63 0-143.28 15.79-188.41 40.64 31.93 7.73 39.02 31.53 82.83 31.53z" id="path79" fill="#00c853"/><path d="M413.868 275.014c52.32 0 52.32-33.94 104.63-33.94h1.1l-.58-37.32c-74.89 0-142 15.49-187.08 39.91 31.16 7.98 38.55 31.35 81.93 31.35z" id="path81" fill="#64dd17"/></g></svg><svg height="11" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M22.8.5l2.7 5-2.7 5H.5V.5z" fill="#698cfe" stroke="#4073f4"/></svg><svg height="11" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M22.8.5l2.7 5-2.7 5H.5V.5z" fill="#ef9d0d" stroke="#a36c01"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="11" height="11"><path d="M3.65 7.21L2.21 5.18 1 6.39 3.55 10 10 2.33 8.88 1z"/></svg>PNG

   IHDR            IDATWc8c !SSU X{    IENDB`<svg xmlns="http://www.w3.org/2000/svg" width="30" height="10"><path d="M0 2.75l.965-.965 4.108 4.107L.965 10 0 9.035l3.135-3.143zM27.25 2.927l.965.965L24.108 8 20 3.892l.965-.965 3.143 3.136z"/></svg>PNG

   IHDR         H   JIDATc@DfF1(#D+,XP`"))b6B"<@
6AUa =    IENDB`PNG

   IHDR   &         DIDATx^  ~J:<uP5ddv
3;0J3agje~[x^J D    IENDB`PNG

   IHDR  
   U   d_   	pHYs        sRGB    gAMA  a  IDATx[xw$L*b
.!A(CH|DQTI<	uGq2_%uuCu:]q<Q  A @    B122H6-wcmZI7N=\q_4$y^H'0n}<L-Od>\<L';qKKy></u^>1lu x/zS8/m~yrj;gG7UwxyqM.ZVq(lxx,8	s.Hi8}Hxx<8Me9__80m(V+V?\y}y.l*k-`
sSmwqpsVVWOv	lqY46?[xcccw~,s7LA(I\xYmLkTTfSE
FM_2  +3-
hEZeB  &LZ[[U___:3mHoS! 7"~ae?PL4I _PpH-  IA(
-REA $H!)7w  c$ "] japfE{uU_>mV?dyG DB'1
Bf@s-[O//~b B{NE3SRIKd( @9*Ga(Po;-bo_|'bA\@ra0Ng&uVAu|D P^Zuww[ImIy_QhV?:8|C}R~M'E]ZPtttXcJcV4B$H$z/F!uuT8F
wq[UbA[RLG&Q-rit#.ajasZqS(z>B& P/EdUV'N4i0
;'AnH"ZBY6"t 09."X>.Q>Rh@CpPPF7\!q%GT/NFGA}4$ ?'LP?4bAq!xG,J
E"qg*#  '"uyY[VB	z6Y	@JM44B!$Uz(M,M @tE33&a'
 
{(,Y W53],CfX7Dbs(*-
hnn.{]<;,N ma/2
r6B{t
e>? 3g{n7tN6S+7GHf x~/P
3|J$tr5C ^0w B  k9G6sY&<w:_Q /1y<tcM\|qd8bJgO\dqc
`mSnlq],bY@<\8$,]eM_}!KMP 	H8m(-?].s	o"T(+,$q	 eHaH+6]yEh)g|l]&dZqV@-24pKM1wpY}o;O_~@|yDB
x^aKS ?@Z[[&/[@(@;!8p4.?DKKD@(@9\0Bk"   %%QA} % h!"pU(hZVO^W=zHe
ShAwYf)SM(:Yj7[#a$3fgU)wt~W\Q?W===jz?!)9=/Z _v0o<o>5w\k<
;g8~fYYC'"oV6m@T' N>]eA]x6~
8$(Tiq= Vn"A~
?zAU-z	NQw-,-Z?&-|v5-
E:.]>|@Tg ,X$LI.]Riz}D jE u%n:uEQG6	
EpI,Rm3?M'sv
Z<N<vs)djLm/[K}GR85)]NMcMBZKEa|4qFmaP7$ $GEAj`1rJI;wREEZ94T
rVRvG]l_hxte8Ts	
PTGQE3qJM25,,Z~
D}SugfE-L uuui+$VcF&DeyH A/_\wS$fdElLPs\Y>r^	A}?(PjX)yV>
rP9r"Q@@Yg=@	W R,`l  k  %%` {93<< P188@(@9I#/_TCCC
|`xG@z<4*/<nJzN<r-o~\w^bWe9wwX
C\$HRyr-?_c5$&t<^q5BpBwC1#pqWy,Jmhh}Vm?T/\'Sq<O[okllt:,q|]_yneQV.Xxdw_%'0+5s\6't=@?{1qCY)||et:W=C-?_<K/d"pv    IENDB`PNG

   IHDR  6   U      	pHYs        sRGB    gAMA  a  pIDATx{TY1[`j[ 1`m1U
(R1`$AcI$1J)DmJl$iKVV]pva}N=sYd2s9ssjnnNA( F$lA:HueH*n6+l5M*fdeS&?('B!aC6~4eict,;F+**$|0*'_oemgSu?oU	1Ytg2'v-Y|< !a@X1`*QDH,JXduT1\% 'U/.|ro>TX--/BBdYyvqaE,8tyo\d!dFQUOtL8v,_^<d,%&/x2QV	XN1?GU2G1-mv`7o>  a3l"HI?4a}PFw2`z(++#Q#~TTT@CC$tg*8gGFx?3	J5[jPYY	A2x. !a ffFpMd#M&DO$6	mFk ~66LTNADvu:p\.t3"pg]VY	qh@SMT'<w+f<^ 
fln xs&5@sLc4t6W' t'G]Mk$W]Q3SG' A2!eQ[n/aAC5p]L& qh$q7lTxlDSmBx'${?@@jNhUr==CW!/1[ svn?PQ!zC[`rX| O7l>>6Zw 
qD)QQXoh8<q7 ZuW&
H+jnz"\qUgZ{YjBq$#UnH#Lf}mExk\Y; -ra6?vAdkBSSgu [q$<[;
e8\i.T;ZX%^v9wk+`5wQilRu:iht#d0Ys4Da<cifq#x_5mh#Vc*+!7xo;Mu6*RozYo

nZ	;ri<>q8@D>}:7^(j:L6 [+vD&-\Z,c-s,x_uo1+*-T![)4oku#ID~LD(O(<iyYcp05N^SNz!CEz|7m[@w*Q)F"amdO/@}=	_@4ZlHou01b:kq
t8C~#tej9k%2;Mw4}|gBGk+/V/l]Im0!.m?X;#1E5?>7S0t:0,QVn;q)$a<tt]V(VB_)a`QWj[W,8%`]XyEjnn-~a;VYEYzs~WU0a3%5nvw;Z24R3Z%{)"6Km.d:us53gUpsKVR;GC19sTx8}L[	;!x7p`2KNZ-v77leN<r*r=8[fw>8VUQN]5U@Xq*.	Q:u
b	E~F6Z-7\!8tr 
OCUU0a_huNZ2
4gz8+!V#]5@>#!0A2Z0
dkIR
(#{MlArqN0d'D!e2k'hMl'~a%tqd_lYp^Gj<
TUqDT?K_{I|:ld_!=mq@h4'w_9/).Dn QldyiP	daYA?SL L<;+wB6\! )JYzE`lI$]:>ti$eeepC$ ]gvte~LADQQ F$lA:hJajgFm~i^2:%KG#+|ti&,}]]u$KWM9C}lUmU&l[u\&WC]I/oUyt%JWOFH8j	LVR'MB-AqyzublUUtl,LYyuhm86BD1MSY^\OZv&f4UQ6#o'	(d~Mukkulc.mRfc?^)Y<^",
w4LT4M{M(K+6bveqddbCF!Zg(d$hDAA-55 a#QC ATH!dQ.0:{DWaF:MMM00aBGdm@.^[nug	y]ve`vZAK,?PUU5,&MKO?"6;}aGXdN~*o#P~aq#
ai3SoCa;{[2fx<Em0cah5^=
@^VHe=p@`{w/+8(;w&YcxGL>V\	/2rjea/'NX[`hu]k~*U.-6KcN.\{ 3E	rPH4+1.?~[gXAEK'jwvvA!'VB; X;~AA@d}
 ~FCAJ}~
w\"M"Vlo>{ @DD'7xC3Q6o[lMF\S|"`}zCKGG3!_v`^S4lG*rb `S![AE|5+lussU26y0o<W {(>rg?9s]rEMF }lj9 *0_/S^6g#Q#	MISS,lMBwV[6,65"eTYnk EABBiCAD6@l|wef
y}h!8]fct10r:\p!,X )T<>6{7W?x(Ar%vS .4IF2$lO'Bp-4IJ#
6b|S\"(8H4D"@BW 
BtC0y~]K7_yy|d0SmTYU4e{)~c#xD.TkekB"M&U8yr'{*Q+b2E75derrd(H[%~= M%NPmO<>6B(f6Tqf	f';^++;5edxu"KPx*48Y' 4lO,|\vUl "|r_U}C</M&laqM0YJt.:0WLC<Yzb.tVIlJc}18&L/    IENDB`PNG

   IHDR      U   .   	pHYs        sRGB    gAMA  a   IDATxS1 sN@ti zJ)t' &	8wSAh#}]}B(t$SC~kS&y:OANx)%32qh^
9o}BWekW    IENDB`PNG

   IHDR      U   .   	pHYs        sRGB    gAMA  a   IDATxA E\zw&&F
OP4_N)6#p?{'f&$hk	Z=0E.<G-gl
XB9cAC1{LCHTn?\rje    IENDB`PNG

   IHDR      U   W   	pHYs        sRGB    gAMA  a  hIDATxK~&
h$iFbh+c4@LT\XvaYe}~u9CU:?zZ)EJ "G9*QD
 rT @ "'9ydCUp}y&=z}K?D- f"i0>D K/^P#h0>D 3}!+*6GL6nlf|TajT&l l	A6E2EPyNvE. EQD
 rT @ "G9*QD
 rT @ta:.K:vym\O,ue9:|M:~h]b_(c^']W$BK>6}sp]3yeMTrFx%\%\^gIz?>q]uO(2Y\\P^|`BwB:n.]b&t.%_oic, rT e39R%+C@4Ufc|i/"vHJHd:g/C)JBG>B5$v:/DZ4K_ji\i>k1zrW}e|]i
B%ZXXhBq(~7;@21j*mfuTM655D311Al> M-[h%IK$oTX 1;i}Q
mqY w<Dbzz{={(&B v^cccE`FGG *,;QP=@m~~J}]vgmQW,a!088h>e66KwK.OQ($??~Hocc2<F |BC ][W~U.D@n\2.PAHB<@Y62Q\?~Ct*JTPNk:uz,m~L=LjO #c'N7+<y$wG
rw?y{kb {Gi9r ^OgLF/pyu5*gi"7n prr"c X7hYg
jKa#jd"?sq( x+uSA4>0b wfYYun=}`](pqY ?~0~<t2wv7& z458Omd7O/^tc@cOA`vP  D`WV-V1fU. 
=+h3N-e^	!LF9~P LBQohAZ P_ef
aC4b Cp72qS dL(T&}JhyqU#~}zfc G}w`Aw6mhC\IZ~@uK,;'S0m#z]D^	!araMBeJkI0n
\}`(:F -lT    IENDB`PNG

   IHDR      U   W   	pHYs        sRGB    gAMA  a  IDATx;LMB1ViMxiPPB$$4@K 4$~;8o8I>v3g/5G 
@8*  
@8*  
@8*  
@8*  
@8*  
@8*  
@8*  
@8*  NQAuv|eimjjjJ4m7iC([iQt2ov/>~n=w|}wunn8{xP#|[n<W@Nm|AcgB|	wBZvww+c :v]kqePl_/nmhmTAGQ:|Ly[|^9=DvG<-sY|F$S}go74E*r\K>^I%d|Ir<'&lyAyDIYP9|Ju9*!4#d Y*&)%pEvO3PNA8^jyAnF06}//tuRC@0H @JUtmB85{\X[[#[n$J [/<@0f
!Hg~%=@$Qx={,<MOOS$lJC5O411AoRww7y@.Pgg'Y=~q!7{.=~i}}FFF0tHUr	FGG(*"z??|`!!, pp8@?O<>HG8$F9px1?'<x@
qc3L ]WWgDo^W5k"eyyf'''c 6)GQAAMl3/T	fPQAFi/Ln<_~H<Snhh0Sx7o9jmm58C:d
?noX :"K[96>wP.]Nfp8CqYXh q3ydp )z= "@[s|||@|  A ny``~ #$pi],@r7o!	J A o^Unjq8`"Kz:<PN y>PO#aP "
n sBK) E=)7 r8+yS ` u_ dJ>t>+=&U#B"??y{s:'
hGzoOR]"f2/PO>Dv|	}jqsG|(%uE:;Axy [\gmCQ?/>"    IENDB`PNG

   IHDR         H   RIDATc@DfF1(!*`!O[
WQmP|_ ()|QWPC j
8V    IENDB`PNG

   IHDR   '      ?   AIDATx^	00~'>zyd'!.:EC0C0PwC -|    IENDB`<svg xmlns="http://www.w3.org/2000/svg" width="6" height="4"><path d="M-.246.532l3.257 2.791L6.268.532" fill="none" stroke="red" stroke-width=".656" stroke-linecap="square"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 48 48" fill="#000000">
    <path d="M0 0h48v48H0z" fill="none"/>
    <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm2 30h-4V22h4v12zm0-16h-4v-4h4v4z"/>
</svg>
<svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 18 18" fill="#000000">
    <path d="M0 0h18v18H0z" fill="none"/>
    <path d="M.5 16h17L9 1 .5 16zm9.5-2H8v-2h2v2zm0-3H8V7h2v4z"/>
</svg>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="224" height="216"><g transform="translate(-322 -72)"><circle transform="translate(326 74)" cx="15" cy="17" r="3" fill="#009802"/><path d="M329 77h18v18h-18z" fill="none"/><path d="M327.25 75.25h20v20h-20z" fill="none"/><path d="M325.12 73.125h20v20h-20z" fill="none"/></g><path d="M51 12l-3.5-4H33v8h14.5M14.767 31h-1.534v4.233H9v1.534h4.233V41h1.534v-4.233H19v-1.534h-4.233V31z"/><path d="M33 27h18v18H33z" fill="none"/><path d="M45.42 33.7l-6.705-6.705-1.058 1.057 1.786 1.785L35.58 33.7a1.118 1.118 0 0 0 0 1.59l4.125 4.125c.218.217.51.33.795.33.285 0 .578-.113.795-.33l4.125-4.125a1.118 1.118 0 0 0 0-1.59zm-8.512.795l3.592-3.593 3.592 3.593h-7.184zm10.341 1.125s-1.5 1.627-1.5 2.625c0 .825.675 1.5 1.5 1.5s1.5-.675 1.5-1.5c0-.998-1.5-2.625-1.5-2.625z"/><path d="M33 42h18v3H33z" fill-opacity=".36"/><path d="M7 51h18v18H7z" fill="none"/><path d="M20 56h1.494c.832 0 1.506.672 1.506 1.506v7.987c0 .832-.672 1.507-1.506 1.507h-7.987A1.505 1.505 0 0 1 12 65.493V64h6.494c.835 0 1.506-.675 1.506-1.507V56z" fill-opacity=".36"/><path d="M10.5 53c-.831 0-1.5.669-1.5 1.5v8c0 .831.669 1.5 1.5 1.5h8c.831 0 1.5-.669 1.5-1.5v-8c0-.831-.669-1.5-1.5-1.5h-8zm0 1.5h8v8h-8v-8z" fill="#212121"/><path d="M37 57h8v6h-8z" stroke-miterlimit="4.2" stroke="#000" stroke-width="2"/><path d="M45 60l4-4v8"/><g stroke="#000"><path d="M70.58 12.5a1.08 1.08 0 1 1-2.16 0 1.08 1.08 0 1 1 2.16 0z" fill-rule="evenodd" stroke-width="1.00008"/><path d="M69.48 9.5l2.54-2h-1.524v-2h-2l-.016 2h-1.54zM72.5 12.5l2 2.5v-1.5h2v-2h-2V10zM69.5 15.5l-2.5 2h1.5v2h2v-2H72zM66.5 12.5l-2-2.5v1.5h-2v2h2V15z"/></g><g fill-rule="evenodd"><path d="M60.308 28.525H76.54v16.232H60.308z" fill="none"/><path d="M64.072 36.049l-1.275 1.275 3.826 3.825 7.652-7.651L73 32.222 66.623 38.6z"/></g><path d="M65.94 56l-.94.94L68.053 60 65 63.06l.94.94 4-4z"/><path d="M69.94 56l-.94.94L72.053 60 69 63.06l.94.94 4-4zM14.44 88.94c-2.48 0-4.5-2.02-4.5-4.5 0-.88.26-1.7.69-2.39l6.2 6.2c-.69.44-1.51.69-2.39.69m4.5-4.5c0 .88-.26 1.7-.69 2.39l-6.2-6.2c.69-.44 1.51-.69 2.39-.69 2.48 0 4.5 2.02 4.5 4.5M14.5 78a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13"/><g fill-rule="evenodd"><path d="M32.071 76.568h15.688v15.688H32.07z" fill="none"/><path d="M42.53 79.618a1.312 1.312 0 0 0-1.313-1.307h-5.219c-.723 0-1.312.587-1.312 1.313v6.961c0 .725.584 1.31 1.307 1.313v-8.28h6.536zm-5.23 2.62c0-.725.59-1.312 1.313-1.312h5.218c.726 0 1.313.585 1.313 1.312V89.2c0 .725-.59 1.312-1.313 1.312h-5.218A1.312 1.312 0 0 1 37.3 89.2v-6.962zm1.307-.005h5.23v6.972h-5.23v-6.972z"/></g><path d="M79 84l-3.64-4h-1.79L68 88h7.36L79 84zM61 80v8h2.05L68 80h-7zM63.67 92.55l-1.59-1.32 10.76-15.78 1.59 1.32-10.76 15.78z"/><path d="M54 72h24v24H54z" fill="none"/><path d="M54 72h24v24H54zm0 0h24v24H54zm0 0h24v24H54zm0 0h24v24H54z" fill="none"/><path d="M54 72h24v24H54z" fill="none"/><path d="M54 72h24v24H54z" fill="none"/><path d="M54 72h24v24H54z" fill="none"/><path d="M103 8.33L101.67 7 98 10.67 94.33 7 93 8.33 96.67 12 93 15.67 94.33 17 98 13.33l3.67 3.67 1.33-1.33L99.33 12 103 8.33zM103 37H93v-5h10v5zm-12 5h14V30H91v12zM96 64h7v-8h-7zm9 2H91V54h14zM100 88h-7v-8h7v8zm-9 2h14V78H91v12zM7 112.089v2.91h2.91l8.284-8.283-2.91-2.91L7 112.088zm13.769-7.939a.771.771 0 0 0 0-1.1l-1.82-1.82a.771.771 0 0 0-1.1 0l-1.52 1.53 2.91 2.91 1.53-1.52zM48.77 103.04l-1.816-1.816a.78.78 0 0 0-1.1 0l-2.43 2.43-1.49-1.493-1.1 1.1 1.104 1.105L35 111.301v3.695h3.694l6.938-6.939 1.1 1.105 1.1-1.1-1.492-1.494 2.43-2.431a.768.768 0 0 0 0-1.097zm-10.721 10.4l-1.493-1.493 6.272-6.274 1.493 1.493-6.272 6.274z"/><path d="M66 107l2 3v4h4v-4l2-3z" opacity=".5" fill="#424242"/><path d="M68.5 113.23c.32.13.84.24 1.47.24.59 0 1.14-.1 1.53-.26v-3.93l4-4.57v-.19h-11v.22l4 4.57v3.93zm1.47 1.77c-1.16-.09-2.15-.29-2.97-.99v-4.12l-4-4.57V103h14v2.35l-4 4.57v4.13c-.92.67-2.1.94-3.03.95"/><path d="M89 99h18v18H89z" fill="none"/><path d="M89 114h18v3H89z" fill-opacity=".36"/><path d="M97.25 101.25l-4.125 10.5h1.688l.84-2.25h4.687l.84 2.25h1.688l-4.118-10.5h-1.5zM96.215 108L98 103.252 99.785 108h-3.57z"/><path d="M120.5 19.5v-14h12v14z" fill="none" stroke="#000"/><path d="M126.5 13l-3.25-5h6.5M120 16v-1h13v1z"/><path d="M119.5 30.5h14v12h-14z" fill="none" stroke="#000"/><path d="M126 36.5l5-3.25v6.5M123 30h1v13h-1z"/><path d="M133.5 54.5h-14v12h14z" fill="none" stroke="#000"/><path d="M127 60.5l-5-3.25v6.5M130 54h-1v13h1z"/><path d="M120.5 77.5v14h12v-14z" fill="none" stroke="#000"/><path d="M126.5 84l-3.25 5h6.5M120 81v1h13v-1zM123 107h-4v-4h4v4zM133 105h-9v-2h9v2zM133 107h-9v-1h9v1zM133 111h-9v-2h9v2zM123 113h-4v-4h4v4zM133 113h-9v-1h9v1zM21 133h-2v2h2zM21 137h-2v2c1 0 2-1 2-2zM21 129h-2v2h2zM19 125v2h2c0-1-1-2-2-2zM9 139h4v-6H7v4c0 1.1.9 2 2 2zM9 129H7v2h2zM17 125h-2v2h2zM17 137h-2v2h2zM9 125c-1 0-2 1-2 2h2zM13 125h-2v2h2zM53 143v-5l-5 5h5z"/><g fill-rule="evenodd"><path d="M71.989 127.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 1 1 3 0zM71.989 132.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 1 1 3 0zM71.989 137.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 1 1 3 0z"/></g><path d="M88 123h18v18H88z" fill="none"/><path d="M103.52 130.53a5.625 5.625 0 0 0-5.516-4.526 5.63 5.63 0 0 0-4.988 3.026 4.499 4.499 0 0 0 .487 8.974h9.75c2.07 0 3.75-1.68 3.75-3.75 0-1.98-1.54-3.585-3.483-3.724zm-.266 5.974h-9.75a3 3 0 1 1 0-6h.532a4.127 4.127 0 0 1 3.968-3 4.123 4.123 0 0 1 4.125 4.125v.375h1.125a2.252 2.252 0 0 1 2.25 2.25 2.252 2.252 0 0 1-2.25 2.25zM121 124c-.55 0-.99.45-.99 1l-.01 14c0 .55.44 1 1 1h10c.55 0 1-.45 1-1v-10l-5-5h-6zm6 5v-4l4 4h-4z"/><path d="M117 123h18v18h-18zM147 5h18v18h-18z" fill="none"/><path d="M145.25 3.25h20v20h-20z" fill="none"/><path d="M143.12 1.125h20v20h-20z" fill="none"/><path d="M149 4c-.55 0-1 .45-1 1v14c0 .55.44 1 1 1h5.094a5.022 5.022 0 0 1-.094-1 5 5 0 0 1 5-5c.343 0 .677.028 1 .094V9l-5-5h-6zm6 1l4 4h-4V5z"/><path d="M145 28h18v18h-18z" fill="none"/><path d="M156 33l-2-2h-5c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-5z"/><path d="M160 54h-10.5a1.5 1.5 0 0 0-1.5 1.5v9a1.5 1.5 0 0 0 1.5 1.5H160c.825 0 1.5-.675 1.5-1.5v-9A1.5 1.5 0 0 0 160 54zm0 10.5h-10.5V57H160v7.5z" fill="#010101"/><path d="M144.97 51.07h18v18h-18z" fill="none"/><path d="M155 76.9h-5.005c-.54 0-.995.45-.995 1.007v11.986a1 1 0 0 0 .995 1.007h8.01c.54 0 .995-.451.995-1.007V80.9l-4-4zm3 4h-3v-3l3 3zm-6 2l5 2.5-5 2.5v-5z"/><g stroke="#000"><path d="M151.343 105.675l-.712.23-.015.975.024.065.37.724-.882.641-.575-.577-.053-.041-.932-.287-.44.605.56.797.057.039.727.367-.338 1.039-.805-.129-.067-.003-.923.315v.75l.923.316.067-.003.805-.13.338 1.038-.727.369-.056.037-.562.798.44.605.933-.287.053-.043.575-.576.883.64-.372.727-.023.062.015.976.712.23.586-.778.018-.066.125-.805h1.092l.126.805.018.066.585.778.713-.23.014-.976-.022-.062-.372-.727.883-.64.575.576.052.043.933.287.44-.605-.562-.798-.055-.037-.726-.369.336-1.038.805.13.067.003.923-.317v-.749l-.923-.315-.067.003-.805.129-.336-1.039.726-.367.055-.039.562-.797-.44-.605-.933.288-.052.041-.575.577-.883-.641.372-.725.022-.064-.014-.975-.713-.23-.585.78-.018.064-.126.805h-1.092l-.125-.806-.02-.067-.584-.777m1.275 2.477a2.64 2.657 0 0 1 2.64 2.657 2.64 2.657 0 0 1-2.64 2.659 2.64 2.657 0 0 1-2.639-2.659 2.64 2.657 0 0 1 2.639-2.657z" stroke-width=".72907"/><path d="M156.08 100.757l-.516.287.136.935.023.029.542.554-.428.722-.746-.214-.037-.005-.887.323-.009.589.879.35.037-.005.751-.193.411.73-.56.541-.023.028-.16.931.503.302.74-.585.015-.035.214-.747.833.012.19.752.012.035.725.607.514-.288-.138-.933-.022-.03-.54-.558.427-.717.747.212.037.007.89-.325.007-.59-.88-.348-.037.004-.752.193-.408-.731.56-.54.022-.028.162-.932-.507-.302-.742.586-.014.036-.209.745-.833-.01-.193-.753-.012-.035-.725-.606zm1.322 1.558a1.413 1.413 0 0 1 1.413 1.413 1.413 1.413 0 0 1-1.413 1.412 1.413 1.413 0 0 1-1.412-1.412 1.413 1.413 0 0 1 1.412-1.413z" stroke-width=".65543393"/></g><g fill="none"><path d="M146 124h16v16h-16v-16z" opacity=".5"/><path d="M152 138h-2.5c-1 0-1.5-.5-1.5-1.5v-9c0-1 .5-1.5 1.5-1.5h9c1.5 0 1.5 1.468 1.5 1.5v2.5h-1v-3h-10v10h3v1zm9-5l-3 2 3 3-1 1-3-3-2 3-2-8 8 2z" fill="#000"/></g><path d="M12.5 151.5h-1l2-2 2 2h-1s-.035 4.638-.035 4.035l4.035-.034v-1l2 2-2 2v-1l-4.035-.034.035 4.034h1l-2 2-2-2h1l.034-4.034-4.034.034v1l-2-2 2-2v1l4.034.034z" stroke="#000"/><path d="M39.6 159.2h1.6v-6.4h-1.6v6.4zM42 148c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14.4a6.408 6.408 0 0 1-6.4-6.4c0-3.528 2.872-6.4 6.4-6.4 3.528 0 6.4 2.872 6.4 6.4 0 3.528-2.872 6.4-6.4 6.4zm.8-3.2h1.6v-6.4h-1.6v6.4zM69 160h-3v-8h3v8zM75 160h-3v-8h3v8zM101 159h-2v-6h2zm-4 0h-2v-6h2zm4-10h-6l-4 4v6l4 4h6l4-4.12V153z"/><g font-weight="400" font-family="Sans"><path d="M121 149v5l3.343.531-.015 8.047L123 163c.006.593.44 1.011 1 1h8c.579.002.982-.427 1-1v-14c-.01-.535-.482-.997-1-1h-10a1.026 1.026 0 0 0-1 1zm1 0h10v14h-8l.718-.422.094-8.422L122 154v-1z" overflow="visible" style="text-indent:0;line-height:normal;text-transform:none;block-progression:tb"/><path d="M118 154v9c.006.593.44 1.011 1 1h5c.579.002.982-.427 1-1v-9c-.01-.535-.482-.997-1-1h-5a1.026 1.026 0 0 0-1 1zm1 1h5v7h-5z" overflow="visible" style="text-indent:0;line-height:normal;text-transform:none;block-progression:tb"/></g><path d="M146 156c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8-8 3.58-8 8zm8 6.4a6.408 6.408 0 0 1-6.4-6.4c0-3.528 2.872-6.4 6.4-6.4 3.528 0 6.4 2.872 6.4 6.4 0 3.528-2.872 6.4-6.4 6.4zm-1.493-2.971l4.571-3.429-4.571-3.429v6.857zM10 180l10-5v10M48 180l-10-5v10M66.01 179.99c.61.28 1.07.9 1.07 1.58.11.85-.05 1.72.12 2.57.27.54 1 .28 1.43.55.49.24.48 1.01-.06 1.18-.56.22-1.18.08-1.74-.05-.71-.2-1.41-.72-1.5-1.5-.18-.89.01-1.8-.16-2.68-.22-.64-.94-.9-1.57-.93-.58-.1-.83-.94-.35-1.3.51-.35 1.26-.14 1.69-.66.44-.48.29-1.18.32-1.78 0-.81-.02-1.77.65-2.34.66-.54 1.58-.71 2.41-.63.63 0 .98.87.4 1.22-.44.37-1.2.06-1.51.65-.14.56-.05 1.15-.07 1.73-.01.75-.05 1.64-.72 2.13-.12.1-.26.19-.4.26M74.98 179.99c-.67-.3-1.08-1.02-1.08-1.75-.07-.76.03-1.52-.06-2.28-.24-.58-.98-.4-1.46-.59-.59-.24-.48-1.18.14-1.31.73-.15 1.52-.01 2.18.32.56.28.95.86.99 1.48.13.83-.03 1.68.13 2.5.2.68.94.83 1.54.9.56.07.86.8.46 1.21-.44.46-1.2.2-1.65.66-.51.46-.4 1.21-.4 1.83-.03.78.06 1.69-.52 2.3-.74.65-1.8.86-2.75.68-.52-.16-.69-1.01-.15-1.25.44-.23 1.02-.08 1.41-.45.26-.45.09-.98.14-1.47.01-.76-.07-1.63.43-2.26.18-.21.42-.37.66-.51"/><g><path d="M82 168h24v24H82z" fill="none"/><path d="M98 174c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h-2a4 4 0 1 1-4-4c1.276 0 2.393.601 3.125 1.531h2.344A6.004 6.004 0 0 0 98 174z"/><path d="M103.091 174.88v3.092h-3.092z" stroke="#000" stroke-width="1.068"/></g><g><path d="M120.586 185.891a7.978 7.978 0 0 1-2.586-5.89c0-4.42 3.58-8 8-8s8 3.58 8 8-3.58 8-8 8v-1.6c3.528 0 6.4-2.873 6.4-6.4 0-3.529-2.872-6.4-6.4-6.4a6.408 6.408 0 0 0-6.4 6.4c0 1.935.865 3.673 2.228 4.848l1.692-1.42.015 4.463-4.392-.79 1.443-1.21zm3.92-2.462l4.572-3.429-4.571-3.428v6.857z"/></g><g><path d="M161 180l-8-5v10M151 185h-3v-10h3v10z"/></g><g><path d="M175.2 10.15c.055-.113.153-.22.231-.306.546-.608 1.39-1.198 3.006-1.57V6.101c-1.294.252-2.315.669-3.304 1.56-.333.383-.506.624-.514 1.166-.007.443.177.886.581 1.322zm6.63 3.13c-1.616-.025-3.108-.257-4.622-.765-2.694-.903-3.029-2.17-3.17-2.593-.096 1.69.028 2.957.034 3.065.092 1.5 1.292 2.674 2.158 3.115a12.806 12.806 0 0 0 5.6 1.415v2.484l3.252-4.648-3.251-4.649v2.575zm-.322-5.297c1.616.01 3.453.339 5.245 1.113.735.318 1.328.79 1.808 1.305.332-.152.807-.73.741-1.292-.161-1.388-1.626-2.191-1.88-2.305-1.77-.79-3.975-1.035-5.914-1.058V4l-2.014 2.879 2.014 2.878V7.983zm8.423 1.866c-.082.648-.827 2.035-3.898 2.914v4.525c1.132-.368 2.465-1.296 3.18-2.2.29-.367.468-.874.576-1.241.333-1.123.187-3.314.142-3.998z"/></g><g><path d="M184.624 30.47a6.127 6.127 0 0 1 3.497 4.947H189C188.7 31.823 185.684 29 182 29l-.387.018 2.232 2.222.779-.77zm-3.661-.45a.876.876 0 0 0-1.242 0l-3.725 3.71a.867.867 0 0 0 0 1.238l7.04 7.011a.876.876 0 0 0 1.242 0l3.726-3.71a.867.867 0 0 0 0-1.236l-7.041-7.012zm2.694 11.34l-7.04-7.01 3.725-3.71 7.041 7.01-3.725 3.71zm-4.282.17a6.119 6.119 0 0 1-3.497-4.947H175c.298 3.594 3.315 6.417 7 6.417l.386-.018-2.231-2.222-.78.77z"/></g><g><path d="M171.96 50.013h20v20h-20z" fill="none"/><path d="M175 53h18v18h-18z" fill="none"/><path d="M173.25 51.25h20v20h-20z" fill="none"/><path d="M171.12 49.125h20v20h-20z" fill="none"/><path d="M166 48h24v24h-24z" fill="none"/><path d="M187.35 60.686c.029-.224.05-.448.05-.686 0-.238-.021-.462-.05-.686l1.518-1.155a.347.347 0 0 0 .087-.448l-1.44-2.422a.367.367 0 0 0-.439-.154l-1.791.7a5.295 5.295 0 0 0-1.217-.686l-.273-1.855a.348.348 0 0 0-.353-.294h-2.878a.348.348 0 0 0-.353.294l-.273 1.855a5.568 5.568 0 0 0-1.216.686l-1.792-.7a.356.356 0 0 0-.44.154l-1.439 2.422a.339.339 0 0 0 .087.448l1.518 1.155c-.029.224-.05.455-.05.686 0 .231.021.462.05.686l-1.518 1.155a.347.347 0 0 0-.087.448l1.44 2.422c.086.154.28.21.439.154l1.792-.7c.374.28.777.511 1.216.686l.273 1.855a.348.348 0 0 0 .353.294h2.878c.18 0 .331-.126.353-.294l.273-1.855a5.568 5.568 0 0 0 1.217-.686l1.792.7c.165.063.352 0 .438-.154l1.44-2.422a.347.347 0 0 0-.087-.448l-1.518-1.155zm-5.347 1.764c-1.389 0-2.519-1.099-2.519-2.45 0-1.351 1.13-2.45 2.52-2.45 1.388 0 2.518 1.099 2.518 2.45 0 1.351-1.13 2.45-2.519 2.45z"/></g><g><path d="M176.5 91.5v-14h12v14z" fill="none" stroke="#000"/><path d="M182.5 80l-3.25 5h6.5M176 88v-1h13v1z"/></g><g><path d="M174.5 102.5h14v12h-14z" fill="none" stroke="#000"/><path d="M186 108.5l-5-3.25v6.5M178 102h1v13h-1z"/></g><g><path d="M188.5 126.5h-14v12h14z" fill="none" stroke="#000"/><path d="M177 132.5l5-3.25v6.5M185 126h-1v13h1z"/></g><g><path d="M176.5 149.5v14h12v-14z" fill="none" stroke="#000"/><path d="M182.5 161l-3.25-5h6.5M176 153v1h13v-1z"/></g><g><path d="M176 180c0 3.31 2.69 6 6 6s6-2.69 6-6-2.69-6-6-6-6 2.69-6 6"/></g><g><path d="M12.5 209c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2M13 198v4h-3l4.5 4 4.5-4h-3v-4h-3z"/></g><g><path d="M40.5 209c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2M42.5 198l-4.5 4h3v4h3v-4h3l-4.5-4z"/></g><g><path d="M68 206.5c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2"/><path d="M63.25 207.03c2.55-8.43 11.4-8.73 13.94 0" fill="none" stroke="#000" stroke-width="2.5"/><path d="M77.68 209l-4.54-2.76 6.68-2.1"/></g><g transform="translate(82 192)"><path transform="translate(-288 -24)" d="M295 36a9 9 0 1 0 18.001-.001A9 9 0 0 0 295 36" fill="url(#a)"/><path d="M10 12c0 3.31 2.69 6 6 6s6-2.69 6-6-2.69-6-6-6-6 2.69-6 6"/><defs><radialGradient id="b" cx="0" cy="0" r="1" gradientTransform="matrix(18 0 0 -18 680 341)" gradientUnits="userSpaceOnUse"><stop offset="0"/><stop stop-opacity="0" offset="1"/></radialGradient><radialGradient id="a" cx="0" cy="0" r="1" gradientTransform="matrix(9 0 0 9 304 36)" gradientUnits="userSpaceOnUse" xlink:href="#b"/></defs></g><g><path d="M117 195h18v18h-18z" fill="none"/><path d="M132.25 203h.75v-3h-11v3h.75a1.5 1.5 0 0 1 1.5-1.5h2.5v7.25a1.5 1.5 0 0 1-1.5 1.5v.75h4.5v-.75a1.5 1.5 0 0 1-1.5-1.5v-7.25h2.5a1.5 1.5 0 0 1 1.5 1.5z" fill-opacity=".36"/><path d="M129.25 200h.75v-3h-11v3h.75a1.5 1.5 0 0 1 1.5-1.5h2.5v7.25a1.5 1.5 0 0 1-1.5 1.5v.75h4.5v-.75a1.5 1.5 0 0 1-1.5-1.5v-7.25h2.5a1.5 1.5 0 0 1 1.5 1.5z"/></g><g><path d="M149.5 201h9l-1.5 10h-6M157.5 198h-2v-1h-3v1h-2c-.55 0-1 .48-1 1v1h9v-1c0-.52-.45-1-1-1"/></g><g><path d="M178 201h-2v9h11v-2h-9z"/><path d="M181 200h7v5h-7zm-2-2v9h11v-9z"/></g><g><path d="M210 6.69c-3.636 0-6.742 2.263-8 5.455 1.258 3.193 4.364 5.455 8 5.455s6.742-2.262 8-5.455c-1.258-3.192-4.364-5.454-8-5.454zm0 9.092a3.638 3.638 0 0 1-3.636-3.637A3.638 3.638 0 0 1 210 8.51a3.638 3.638 0 0 1 3.636 3.636A3.638 3.638 0 0 1 210 15.782zm0-5.818a2.179 2.179 0 0 0-2.182 2.181c0 1.208.975 2.182 2.182 2.182a2.179 2.179 0 0 0 2.182-2.182A2.179 2.179 0 0 0 210 9.964z"/></g><g><path d="M219 33h-11v-2h11v2z" opacity=".2"/><path d="M208 33h-6v-2h6v2zM211 36h-6v-2h6v2zM216 39h-6v-2h6v2zM218 42h-6v-2h6v2z"/></g><text style="line-height:0%" x="12.356" y="231.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="12.356" y="231.559" style="line-height:1.25" font-size="12">a</tspan></text><text style="line-height:0%" x="40.356" y="231.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="40.356" y="231.559" style="line-height:1.25" font-size="12">b</tspan></text><text style="line-height:0%" x="68.356" y="231.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="68.356" y="231.559" style="line-height:1.25" font-size="12">c</tspan></text><text style="line-height:0%" x="96.356" y="231.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="96.356" y="231.559" style="line-height:1.25" font-size="12">d</tspan></text><text style="line-height:0%" x="124.356" y="231.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="124.356" y="231.559" style="line-height:1.25" font-size="12">e</tspan></text><text style="line-height:0%" x="152.356" y="231.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="152.356" y="231.559" style="line-height:1.25" font-size="12">f</tspan></text><text style="line-height:0%" x="180.356" y="231.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="180.356" y="231.559" style="line-height:1.25" font-size="12">g</tspan></text><text style="line-height:0%" x="208.356" y="231.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="208.356" y="231.559" style="line-height:1.25" font-size="12">h</tspan></text><text style="line-height:0%" x="-15.644" y="207.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="207.559" style="line-height:1.25" font-size="12">1</tspan></text><text style="line-height:0%" x="-15.644" y="183.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="183.559" style="line-height:1.25" font-size="12">2</tspan></text><text style="line-height:0%" x="-15.644" y="159.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="159.559" style="line-height:1.25" font-size="12">3</tspan></text><text style="line-height:0%" x="-15.644" y="135.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="135.559" style="line-height:1.25" font-size="12">4</tspan></text><text style="line-height:0%" x="-15.644" y="111.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="111.559" style="line-height:1.25" font-size="12">5</tspan></text><text style="line-height:0%" x="-15.644" y="87.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="87.559" style="line-height:1.25" font-size="12">6</tspan></text><text style="line-height:0%" x="-15.644" y="63.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="63.559" style="line-height:1.25" font-size="12">7</tspan></text><text style="line-height:0%" x="-15.644" y="39.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="39.559" style="line-height:1.25" font-size="12">8</tspan></text><text style="line-height:0%" x="-15.644" y="15.559" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-15.644" y="15.559" style="line-height:1.25" font-size="12">9</tspan></text><g fill="none"><path fill="none" d="M200 50h20v20h-20z"/><path d="M204.343 59.343a8.004 8.004 0 0 1 13.267 3.184l-1.455.473h-.496a6.002 6.002 0 0 0-9.902-2.243L208 63h-6v-6l2.343 2.343z" fill="#000"/></g><path d="M215 82h-3v-4h-4v4h-3l5 6zm-10 7v1h10v-1z"/><path d="M196 72h24v24h-24z" fill="none"/><path d="M210 102l-5 6h3v4h4v-4h3zm-5 11v1h10v-1zM206 176h8v8h-8z"/><g><path d="M212.857 134.628h-.62l-.22-.212a5.083 5.083 0 0 0 1.233-3.322 5.106 5.106 0 1 0-5.106 5.105 5.083 5.083 0 0 0 3.323-1.233l.212.22v.62l3.927 3.92 1.17-1.17zm-4.713 0a3.53 3.53 0 0 1-3.534-3.534 3.53 3.53 0 0 1 3.534-3.535 3.53 3.53 0 0 1 3.535 3.535 3.53 3.53 0 0 1-3.535 3.534z"/><path d="M200.682 123.632h18.852v18.851h-18.852z" fill="none"/></g><path d="M211.72 203.423c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2"/><g><path d="M211 203.5l-4-4.5v3h-4v3h4v3z"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="96" height="96"><defs><linearGradient id="a"><stop offset="0" stop-color="#d7687d"/><stop offset="1" stop-color="#b21402"/></linearGradient><linearGradient id="b"><stop offset="0" stop-color="#606eda"/><stop offset="1" stop-color="#021db2"/></linearGradient><linearGradient xlink:href="#a" id="m" gradientUnits="userSpaceOnUse" gradientTransform="matrix(0 -.41667 -.41667 0 25 10)" x2="24"/><linearGradient xlink:href="#b" id="k" gradientUnits="userSpaceOnUse" gradientTransform="translate(-.714 -69.286) scale(.71429)" x1="113" y1="104" x2="127" y2="104"/></defs><path d="M3 36h10v9.008A1.99 1.99 0 0111 47H5c-1.105 0-2-.9-2-1.992zm-1-2h12v1H2zm3-1h6v1H5zM29.526 38.25h-1.474v-.75c0-.414-.33-.75-.737-.75h-1.473V36c0-.414-.33-.75-.737-.75h-.737v-1.5a.743.743 0 00-.494-.7.494.494 0 00-.243-.05C19.968 33 17 36.022 17 39.75s2.968 6.75 6.631 6.75c3.663 0 6.632-3.022 6.632-6.75V39c0-.414-.33-.75-.737-.75zm-9.947 2.25c-.611 0-1.106-.503-1.106-1.125s.495-1.125 1.106-1.125c.61 0 1.105.503 1.105 1.125s-.495 1.125-1.105 1.125zm1.105-4.125c0-.622.495-1.125 1.105-1.125.611 0 1.105.503 1.105 1.125 0 .621-.494 1.125-1.105 1.125-.61 0-1.105-.504-1.105-1.125zM22.894 45c-.61 0-1.105-.503-1.105-1.125 0-.62.495-1.125 1.105-1.125.611 0 1.106.504 1.106 1.125 0 .622-.495 1.125-1.106 1.125zm.369-3.75c-.61 0-1.105-.504-1.105-1.125S22.653 39 23.263 39s1.105.504 1.105 1.125-.495 1.125-1.105 1.125zm3.684 1.5c-.61 0-1.105-.504-1.105-1.125s.495-1.125 1.105-1.125 1.105.504 1.105 1.125-.495 1.125-1.105 1.125z" fill="#212121"/><path d="M40 38c3.314 0 6-.895 6-2s-2.686-2-6-2-6 .895-6 2 2.686 2 6 2zm-6 7c0 1.105 2.686 2 6 2s6-.895 6-2v-2c0 1.105-2.686 2-6 2s-6-.895-6-2zm0-3c0 1.105 2.686 2 6 2s6-.895 6-2v-2c0 1.105-2.686 2-6 2s-6-.895-6-2zm0-3c0 1.105 2.686 2 6 2s6-.895 6-2v-2c0 1.105-2.686 2-6 2s-6-.895-6-2z"/><g fill="none"><path d="M48 32h16v16H48z"/><path d="M57 33h-5.005c-.54 0-.995.45-.995 1.007v11.986A1 1 0 0051.995 47h8.01c.54 0 .995-.451.995-1.007V37l-4-4zm3.29 4H57v-3.29z" fill="#000"/></g><path d="M6.5 51.229V49h3v2.229a4.994 4.994 0 011.88 1.087l1.932-1.115 1.5 2.598-1.93 1.115a5.018 5.018 0 010 2.173l1.93 1.114-1.5 2.598-1.931-1.115A4.995 4.995 0 019.5 60.771v2.23h-3v-2.23a4.994 4.994 0 01-1.88-1.087L2.687 60.8l-1.5-2.598 1.93-1.114a5.018 5.018 0 010-2.173l-1.93-1.115 1.5-2.598 1.931 1.115A4.995 4.995 0 016.5 51.23zM8 58.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM18 51.999a1 1 0 01.99-.999H24v3h-6v-2.001zM18 59h6v3h-5.01a.992.992 0 01-.99-.999V59zm0-4h6v3h-6zm7-4h5.01c.546 0 .99.443.99.999V54h-6v-3zm0 8h6v2.001a1 1 0 01-.99.999H25v-3zm0-4h6v3h-6z" fill="#212121"/><path d="M39.5 61a5.5 5.5 0 100-11 5.5 5.5 0 000 11zm0-2.2v-2.2h-3.3v-2.2h3.3v-2.2l3.3 3.3z"/><g transform="translate(-26 25)"><circle transform="matrix(1.2 0 0 1.2 72.4 21.2)" cx="10.5" cy="11.5" r="2.5" fill="#009802"/><path d="M78 25c-.544 0-1 .45-1 1v8c0 .54.45 1 1 1h3.031a3.533 3.533 0 01-.031-.5c0-.17.008-.337.031-.5H78v-8h3v3h3v1.5c.163-.023.33 0 .5 0 .17 0 .337-.023.5 0V28l-3-3zm4 1l2 2h-2z"/></g><path d="M8 66H3.997a1 1 0 00-.997.995v8.01c0 .54.446.995.997.995h6.006a1 1 0 00.997-.995V69l-3-3zm0 1l2 2H8zm-4 0h3v3h3v5H4z"/><path d="M17 71.5a6.5 6.5 0 1013 0 6.5 6.5 0 00-13 0" fill="#9f9f9f"/><path d="M27 69.43l-.93-.93-2.57 2.57-2.57-2.57-.93.93L22.57 72 20 74.57l.93.93 2.57-2.57 2.57 2.57.93-.93L24.43 72z" fill-opacity=".36"/><path d="M27 68.93l-.93-.93-2.57 2.57L20.93 68l-.93.93 2.57 2.57L20 74.07l.93.93 2.57-2.57L26.07 75l.93-.93-2.57-2.57z" fill="#fff"/><path d="M33 71.5a6.5 6.5 0 1013 0 6.5 6.5 0 00-13 0" fill="#bebebe"/><path d="M43 69.43l-.93-.93-2.57 2.57-2.57-2.57-.93.93L38.57 72 36 74.57l.93.93 2.57-2.57 2.57 2.57.93-.93L40.43 72z" fill-opacity=".37"/><path d="M43 68.93l-.93-.93-2.57 2.57L36.93 68l-.93.93 2.57 2.57L36 74.07l.93.93 2.57-2.57L42.07 75l.93-.93-2.57-2.57z" fill="#fff"/><g transform="translate(49 65)"><path transform="translate(-111 -96)" d="M118 96c-3.87 0-7 3.13-7 7s3.13 7 7 7 7-3.13 7-7-3.13-7-7-7" fill="url(#c)"/><path d="M.5 7a6.5 6.5 0 1013 0 6.5 6.5 0 00-13 0" fill="#f27d82"/><path d="M10.5 4.93L9.57 4 7 6.57 4.43 4l-.93.93L6.07 7.5 3.5 10.07l.93.93L7 8.43 9.57 11l.93-.93L7.93 7.5z" fill-opacity=".36"/><path d="M10.5 4.43l-.93-.93L7 6.07 4.43 3.5l-.93.93L6.07 7 3.5 9.57l.93.93L7 7.93l2.57 2.57.93-.93L7.93 7z" fill="#fff"/><defs><linearGradient id="d"><stop stop-color="#d7687d" offset="0"/><stop stop-color="#b21402" offset="1"/></linearGradient><linearGradient id="c" x2="24" gradientTransform="matrix(0 -.58333 -.58333 0 118 110)" gradientUnits="userSpaceOnUse" xlink:href="#d"/></defs></g><g transform="translate(1 81)"><path transform="translate(-96 -96)" d="M103 110c3.87 0 7-3.13 7-7s-3.13-7-7-7-7 3.13-7 7 3.13 7 7 7" fill="url(#e)"/><path transform="translate(-96 -96)" d="M103 96.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13" fill="url(#f)"/><path d="M10.5 4.93L9.57 4 7 6.57 4.43 4l-.93.93L6.07 7.5 3.5 10.07l.93.93L7 8.43 9.57 11l.93-.93L7.93 7.5z" fill="#993c35"/><path d="M10.5 4.43l-.93-.93L7 6.07 4.43 3.5l-.93.93L6.07 7 3.5 9.57l.93.93L7 7.93l2.57 2.57.93-.93L7.93 7z" fill="#fff"/><defs><linearGradient id="f" x1="96.5" x2="109.5" y1="103" y2="103" gradientTransform="rotate(90 103 103)" gradientUnits="userSpaceOnUse" xlink:href="#g"/><linearGradient id="g"><stop stop-color="#e59290" offset="0"/><stop stop-color="#e99890" offset="1"/></linearGradient><linearGradient id="e" x1="113" x2="127" y1="104" y2="104" gradientTransform="rotate(90 112 95)" gradientUnits="userSpaceOnUse" xlink:href="#h"/><linearGradient id="h"><stop stop-color="#c0544f" offset="0"/><stop stop-color="#d08481" offset="1"/></linearGradient></defs></g><path d="M26.27 90.92a4.5 4.5 0 11.73-.684l2.346 2.346-.707.707zm-2.692-.106a3.5 3.5 0 100-7 3.5 3.5 0 000 7z" fill="#5b5b5b"/><text style="line-height:0%" x="-11.403" y="91.208" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-11.403" y="91.208" style="line-height:1.25" font-size="10">1</tspan></text><text style="line-height:0%" x="-11.144" y="75.675" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-11.144" y="75.675" style="line-height:1.25" font-size="10">2</tspan></text><text style="line-height:0%" x="-11.066" y="60.143" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-11.066" y="60.143" style="line-height:1.25" font-size="10">3</tspan></text><text style="line-height:0%" x="-11.266" y="44.611" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="-11.266" y="44.611" style="line-height:1.25" font-size="10">4</tspan></text><text style="line-height:0%" x="5.935" y="108.082" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="5.935" y="108.082" style="line-height:1.25" font-size="10">a</tspan></text><text style="line-height:0%" x="21.659" y="108.082" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="21.659" y="108.082" style="line-height:1.25" font-size="10">b</tspan></text><text style="line-height:0%" x="37.384" y="108.082" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="37.384" y="108.082" style="line-height:1.25" font-size="10">c</tspan></text><text style="line-height:0%" x="53.108" y="108.082" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#b3b3b3"><tspan x="53.108" y="108.082" style="line-height:1.25" font-size="10">d</tspan></text><g fill="none"><path d="M48 96H32V80h16z"/><path d="M40 81c-3.864 0-7 3.136-7 7s3.136 7 7 7 7-3.136 7-7-3.136-7-7-7zm-5.5 7c0-3.032 2.468-5.5 5.5-5.5s5.5 2.468 5.5 5.5-2.468 5.5-5.5 5.5a5.507 5.507 0 01-5.5-5.5zm6.5 4v-5h-2v5zm-2-6h2v-2h-2z" fill="#000"/></g><g transform="matrix(1.39974 0 0 1.39343 65.054 81.02)" mask="url(#i)"><path d="M1 9l4-8 4 8z" stroke="#c19600" stroke-width="2" stroke-linejoin="round"/><path d="M1 9l4-8 4 8z" fill="#f4bd00" stroke="#f5bd00" stroke-width="1.5" stroke-linejoin="round"/><path d="M3.75 2.75h2.5v2.5L5.75 7h-1.5l-.5-1.75v-2.5m0 5.25h2.5v1.25h-2.5" fill="#ad8601"/><mask id="i"><path fill="#fff" d="M0 0h10v10H0z"/><path transform="translate(-60)" d="M64 3h2v2.25L65.5 7h-1L64 5.25V3m0 5h2v1h-2"/></mask></g><g transform="matrix(1.36 0 0 1.34 65.3 65.5)" mask="url(#j)"><path transform="translate(-80)" d="M85 0c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5" fill="url(#k)"/><path d="M.36 5C.36 7.56 2.44 9.64 5 9.64c2.56 0 4.64-2.08 4.64-4.64C9.64 2.44 7.56.36 5 .36 2.44.36.36 2.44.36 5" fill="#2a53cd"/><mask id="j"><path fill="#fff" d="M0 0h10v10H0z"/><path transform="translate(-80)" d="M83.93 2.14c-.03-.53.55-.97 1.06-.83.5.12.79.73.56 1.18-.2.44-.79.61-1.2.36a.812.812 0 01-.42-.71zm1.7 5.46h.67v.53h-2.89V7.6h.66V3.99h-.66v-.53h2.22z"/></mask></g><g transform="matrix(1.37 0 0 1.36 65.2 49.3)" mask="url(#l)"><path transform="translate(-20)" d="M25 0c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5" fill="url(#m)"/><path d="M.36 5C.36 7.56 2.44 9.64 5 9.64c2.56 0 4.64-2.08 4.64-4.64C9.64 2.44 7.56.36 5 .36 2.44.36.36 2.44.36 5" fill="#eb3941"/><mask id="l"><path fill="#fff" d="M0 0h10v10H0z"/><path transform="translate(-20)" d="M23 3l4 4M27 3l-4 4" stroke="#000"/></mask></g><path d="M72 33.333A6.67 6.67 0 0065.333 40 6.67 6.67 0 0072 46.667 6.67 6.67 0 0078.667 40 6.67 6.67 0 0072 33.333zm0 2c1.107 0 2 .894 2 2 0 1.107-.893 2-2 2s-2-.893-2-2c0-1.106.893-2 2-2zm0 9.467a4.8 4.8 0 01-4-2.147c.02-1.326 2.667-2.053 4-2.053 1.327 0 3.98.727 4 2.053a4.8 4.8 0 01-4 2.147z"/><path d="M64 32h16v16H64z" fill="none"/><text style="line-height:0%;-inkscape-font-specification:Sans;text-align:start" x="-10.738" y="28.118" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill-opacity=".373"><tspan x="-10.738" y="28.118" style="line-height:1.25" font-size="10">5</tspan></text><text style="line-height:0%;-inkscape-font-specification:Sans;text-align:start" x="68.649" y="107.697" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill-opacity=".351"><tspan x="68.649" y="107.697" style="line-height:1.25" font-size="10">e</tspan></text><path d="M65.25 24.75h1.5v-1.5h-1.5zm0 3h1.5v-1.5h-1.5zm0-6h1.5v-1.5h-1.5zm3 3h10.5v-1.5h-10.5zm0 3h10.5v-1.5h-10.5zm0-7.5v1.5h10.5v-1.5z"/><path d="M63 15h18v18H63zM47 79h18v18H47z" fill="none"/><path d="M62 85h-2.107a4.489 4.489 0 00-1.366-1.47l1.223-1.222-1.058-1.058-1.627 1.627a4.439 4.439 0 00-2.122 0l-1.635-1.627-1.058 1.058 1.215 1.222A4.547 4.547 0 0052.108 85H50v1.5h1.568a4.978 4.978 0 00-.068.75V88H50v1.5h1.5v.75c0 .255.03.503.068.75H50v1.5h2.108A4.498 4.498 0 0056 94.75a4.498 4.498 0 003.893-2.25H62V91h-1.567c.037-.248.067-.495.067-.75v-.75H62V88h-1.5v-.75c0-.255-.03-.503-.067-.75H62zm-4.5 6h-3v-1.5h3zm0-3h-3v-1.5h3z"/><g fill="none"><path opacity=".2" d="M48 16h16v16H48z"/><path d="M48.5 30h15L56 17zm8.5-2h-2v-2h2zm0-3h-2v-3h2z" fill="#000"/></g><text style="line-height:0%" x="32.47" y="23.902" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0"><tspan x="32.47" y="23.902" style="line-height:1.25" font-weight="700" font-size="10">A</tspan></text><text style="line-height:0%" x="40.363" y="31.525" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0"><tspan x="40.363" y="31.525" style="line-height:1.25" font-weight="700" font-size="10">B</tspan></text><path d="M37.955 29.089c-1.915-.292-2.12-.9-2.237-4.13h-1.22c.047 3.856.062 5.297 5.736 5.258l.316-.014-2.595-2.996a39.95 39.95 0 000 1.882z"/><g fill="none" fill-rule="evenodd"><path d="M0 16h16v16H0z"/><g fill="#000" fill-rule="nonzero"><path d="M9.58 27.313l1.417 1.294c-.86.577-1.89.913-2.997.913-3.004 0-5.44-2.471-5.44-5.52 0-.917.22-1.782.61-2.543l1.417 1.294c-.138.39-.214.81-.214 1.249 0 2.032 1.624 3.68 3.627 3.68.567 0 1.103-.132 1.58-.367zm1.826-2.046c.143-.395.22-.822.22-1.267 0-2.032-1.623-3.68-3.626-3.68-.573 0-1.116.135-1.598.375l-1.414-1.292A5.36 5.36 0 018 18.48c3.004 0 5.44 2.471 5.44 5.52 0 .924-.224 1.795-.619 2.56z"/><path d="M8 25.84v5.52l3.022-2.76zM8 22.16v-5.52L4.978 19.4z"/></g></g><g fill="none" fill-rule="evenodd"><path fill="#000" d="M20 20h2v6h-2zM26 22h2v6h-2z"/><path fill="#000" fill-rule="nonzero" d="M24.667 20.667l-3.667-4-3.667 4h4.584zM23.333 27.333l3.667 4 3.667-4h-4.584z"/><path d="M16 16h16v16H16z"/></g><text style="line-height:0%;-inkscape-font-specification:Sans;text-align:start" x="-10.547" y="11.352" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill-opacity=".373"><tspan x="-10.547" y="11.352" style="line-height:1.25" font-size="10">6</tspan></text><text style="line-height:0%;-inkscape-font-specification:Sans;text-align:start" x="85.725" y="108.235" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill-opacity=".351"><tspan x="85.725" y="108.235" style="line-height:1.25" font-size="10">f</tspan></text><g><path d="M1 1h14v14H1z" fill="none"/><path d="M12.287 6.857A4.37 4.37 0 004.121 5.69 3.497 3.497 0 001 9.167c0 1.93 1.57 3.5 3.5 3.5h7.583A2.918 2.918 0 0015 9.75a2.903 2.903 0 00-2.713-2.893z"/></g><g><path d="M24.044 15a1.44 1.44 0 001.435-1.436h-2.871c0 .79.639 1.436 1.436 1.436zm4.307-4.308v-3.59c0-2.204-1.177-4.049-3.23-4.537v-.488C25.12 1.48 24.639 1 24.044 1c-.596 0-1.077.481-1.077 1.077v.488c-2.06.488-3.231 2.326-3.231 4.538v3.59L18.3 12.127v.718h11.487v-.718z"/></g><g><path d="M32 0h16v16H32z" fill="none"/><path d="M45.333 2.667H34.667c-.74 0-1.327.593-1.327 1.333l-.007 8c0 .74.594 1.333 1.334 1.333h10.666c.74 0 1.334-.593 1.334-1.333V4c0-.74-.594-1.333-1.334-1.333zm0 9.333H34.667V8h10.666zm0-6.667H34.667V4h10.666z"/></g><g><path d="M55.993 1.333A6.663 6.663 0 0049.333 8c0 3.68 2.98 6.667 6.66 6.667A6.67 6.67 0 0062.667 8a6.67 6.67 0 00-6.674-6.667zm.007 12A5.332 5.332 0 0150.667 8 5.332 5.332 0 0156 2.667 5.332 5.332 0 0161.333 8 5.332 5.332 0 0156 13.333z"/><path d="M48 0h16v16H48z" fill="none"/><path d="M56.333 4.667h-1v4l3.5 2.1.5-.82-3-1.78z"/></g></svg>PNG

   IHDR   6      qv  IDATx^K`#6R#%`2ZRI5;C=xYqDA2vX-|wO4MC.<o-se~D)+iq|FRV\g^LnG_BV`80f!6FQM j*4iFKCPzvx)(^Bi0=Hdp<lhUEeT.Q 
b7%;>,L;OP !{8)kUQ<23<?wv~gMk9
J(!a:j@DNo-5_=XcYs*CsG9^nwa3XR{c5v

l'C,c_Ck&h|I<PQvJm*6(R]8=Y- #[*tKG|=IN-V7wF1Ptee#X`a\$BZs(@BiZ
V	>,3AGU<mBZ
Lq^57i=gn/^){I+j_m{a    IENDB`PNG

   IHDR   l   $   dG  IDATx^OoGzcBlqPH@
		5$1lR"UJT!jjUT Ym8PN9p SE\JI#Q+ZZ/}45YkgYBe4;y=~M{I
xN).%4`:`_JJ9iI*N+%9%9zVZqwoFV`j=]F23^sRXjer1<s)ml{0bnta?:nMgMri7vqAT0k9Vsd fjA'`1i7s.CtD	Zy>@(P4cKf:8KmOC0Z@sq+O<y|&%^Jx2+1Bh!JY-(R`&XwhIu]wV_?!-PFaj"9wMEV	N$e{z\7}#j--<P6N56b	*hmMXA*TX>F?EE'2jIpRAe@h>&+5E.Y1nXmCBzg>4|UW}38"0@s,-ks^/L!c	>*h3>	UQL#ehon1"T"B%0H,]Dg}M
^l,j
X5@X0Z2b$}YSbe'VgfE]^A	hjF`IPwM5Ub8}"bQ!"e~a	4}VMjJvhV#t?c1t`SWr]:3?MOU&7+cQ_VSs^4`;0-!@@FR{0:tG"[?oPzH=Y}!Dc<r,uV7["-l+l[cA!/ILS]gJ034qbm3sU,
1
>wG6%S.gmn+3ASi{y;t.5,S%pmEt51x>/bn(X^O S[qo&`:l0#uX:4SkCZ6:hE11,,_./Sk+EL|MlOct'pee%ed)@FpIzX    IENDB`PNG

   IHDR   "   "   :G   bKGD      	pHYs    ~   tIME
x{=  IDATXkUWksf08 &|CA	+
ZT	6aV)Jh1XRcIkS(3qswpf\;9gY
]Xhzr*QIyk5f6.<!e#&PP:kV<ph>'kJ;8YjBtK7{fro0YG[9?O'/|w00x++zTms+=T#vU/x_]zhBZw:E3g=AE`DP5AZow=gR\X*"Xk)"5R6>ko/nQd!8Hb>74EuDQBl-Q!S0vnYqoksf>UE^j ^j^ Evyy "P K[,~o=5Q&mwxYK%2{T8$t-;8<srhpT	T0Pk)j"57"B-lcATeX7sB11TRSL'U"SSI|rNe
`T@!.)RSMbyo,|QZPeWX+E2!FJm: "2&eN-cTR*(jP?4ZVU2<j-0iO OhPS?G"bBU(c*Sn=T#`qA"3C9
k^ab#:}'r1bill.rV	0j$XM8vj?FzraQ+ak,H<jR:sTz}`d+@=r>/I5JOH9ONb?y6:o^xEW:L8"T.?U<TU]t|uTrG6l{Q_'/y;w\lY0dv>zUhS-"shJqs8gGTAy=//nGWxKSA0vy)TWwNd=o# 7_w]6<~O={	rGuFM!=+7iw|qmDo}+s 4xQ'Sa[Vm;[bcw$~L{sx}im=2Q~[{]oho(pGv:Un    IENDB`PNG

   IHDR      L   V|   TPLTE   i   tRNS  +T
^cWaQ)\OB0}   IDATx^I0o8gDV	H{S964|!G4bL}02Af@d;
BN5 0>aFk@q0&FI]-)^F@ TE11][7Vh# n0    IENDB`PNG

   IHDR           szz   IDATx^Wk\Ed6F4d7m
(>X}O-@OR[UP(X V-"fnjR439{a]Y&3s~sqQ&rv5<FC):NR F's3=giiiO>5\>vn"<6PJqL4yZF[GrW"Q#'}~Gh4\lA)dcj	wc6W=uo y)lex%u8X\imBaRb`q]JW| ^\c8g+!_!m||$YLF@"gO|PP x;Clg69[hHD)cIyV@*	&C,/f"L&E	`i>np4033kks4ypA&36zb"a@UC IR)<j2'A~&G?y
] ',%HoBn1J@th@HZT3(&[(`UY2C@k@99 nkk0oRS/~`&y?+k{Ms,,m= jB-vWM@^E> C:3I#/"9 m{
z^= 2:`wCav	Lm%e$1yt kE~gh,iWsq"tT1RJvRM
8d/'Fylw#JYN2{3Ry^-!%zm>~Q>F<kx}PuTBQDKv+{%Ex1*>$J3j	E9@	(L8H9_|lf
mgSv'qN\pHi_	wG<y"KiJ5Nk;8}_RURrOg09tj}]Hq|_mp\w):'gU+D*
8` c Yyv=(/ U@:    IENDB`PNG

   IHDR           szz  IDATx^Wk\U7I6F4Lf&1VD	vu%u[+n"|5_dE'IspQoJ0yw9{$Vxtl7z q[wP,:|_(A'M Hx_}> g|!&Z82/,9v}vh|ClfMDGlw38{d^z"?)$;R'2'e$O@jEaf
 ++#
n1590$ EsIBT9|>\&s^Z
0H`~Bu/:x---I&'<r$EPjIxgAd]	Ms`i/8+dq6T.bU ~a9$ss !%  |ZdG&C3%eM&y_4!acS+PaIK5X[Vk5)UzYfl-T$UHA>kC0.nIjFyylcQ4} 2All|*ISe4'WXrh&9?cwT.F*_Hz(D +~\Hyu{
woQ/2*"s$$j$y &kC~z!e8k	H?K~g>8V/}w:jhPq\*{uzrZ|+?lj]+G^xXfL3VuKZc/O?Bs$tZke]Eg;vN6,speHnJblhydsG{w?&6Zt	GG@(k[/%/ia"W0X
PWWW bGlmH:$yW)q    IENDB`PNG

   IHDR         a  IDATxQ/AfmV
D\.D]D$W!'$~B+D#-[3]6}{o	c3~@co]^[OZWJWWW LN/X&h
E7YJzT!NOC<*D#-^K%%65s)"FDm^J6R}0@PdyT%M-rWx[@v.I\}lC7.).In!hBd3pz@v7n3v@d%"U^bWW(Bq$hoT]\4!!%ZQ xi0YwuF`ROu]/'<    IENDB`PNG

   IHDR   	   	   J   fIDATcAYSByr)Dq@a!PHWO
tc059'YA++>/=3(hc@d3PvY!!F  Il    IENDB`PNG

   IHDR         r|   gAMA  a   IDAT(A
0E7pdKw+.q#$h.F]KFfVneS~]|Yj@G2v{F{:lwrNp]QD3}W1,~    IENDB`PNG

   IHDR         JL   gAMA  a  2IDATHj@F?mK-oF;_@YFc:/L&dZYQ^a{Z:$jIO0%dM$EwZb)D$S$'jc~[D%ZEQ(Zb$"D;VVcTC0"2$b:	:c[sQ*\EYT,MjHo|XpwP$zH$]r5uhC=_W!HVp)uB4gCmyIc;	;    IENDB`PNG

   IHDR         -   gAMA  a   7IDAT(cd``@|A g2\3!Q	 F#H@)( lt,}    IENDB`PNG

   IHDR      4   \'   gAMA  a   IDATH1
0DE^Y!S,h,1#ERz`5/H\/vU]$K]@etY
XHG	][Ep+E	    IENDB`PNG

   IHDR         ^.   gAMA  a   #IDAT(cd``bi %x46_A6 cV    IENDB`PNG

   IHDR   4      -Q+   gAMA  a   ^IDATHcd``bS H1P	1!q?3XYza!0! *Gp! m.w    IENDB`PNG

   IHDR           szz  IDATxiHTQ(6:jd2N	Mc6/E aTZ)C(pR%+TL^zW1Q97v&P(*V%''GQgq\*RGk:|Fjp8E@IR!sX5?~Q"D$ AVs'R,	 ##K|ONN !iii|DM<FD $EBP,ZzhhhtQ
y?`2D$D !>}	 $}IZoE  K5xx
jtf,w,,]	,M+.6N3(J=BIQf?!6Ct)bv!]JH$gmw1 L1f!_2
04 $F>- y4~! m0{0C#9BD@{8b0I"G_cd&+qa/'Y1?R8 C0yD6_6s-NfUsM:v,<%mAxyEIG%!c*"88?8rqk={3:G:q& 'Ahqk$lf.H,fpnnD~> u0
Cww;@MIQPu7sy2vy =44)))hllnP>-A{8l6K}r1XlQz~AcaaalKK)%d%55ULy7SdW n"Np@|#JRzI+ Zn('Y|#
 dW`7%T    IENDB`PNG

   IHDR           szz  ~IDATxVKHQ7KYP{.EB1Et&\A=V*dPHZ3sst;3>3 0Bp( N	!Z?Z;|LO{(9unDSIp$#NBE
Lp 
c||\k[|>//{TUUrn}tVTTG0z
U"}aaah#fKbBNA-_AM.**Jh^z=@K`vX>#9\??"
wp2B&"&c79'%	aaK(.uI9dXSC0	m`Q`palhyx*Ts`#xt%tg!c)N+Ek6	2\A8B+B74bco(lE'tT&l]"Oz&)GkE5Gqhj
:
xKaEdlJ2~u#f'R]#{a2Zp<d[ej~)~R(2#/%8,s5-eXSV hYd[bpXz/;}2YYYl?bddDdU5O DR[[5h
D;_WxxxLm=w}MMMqP<bZ%4nXyuab 9  cPgI!<gax0/QiW]    IENDB`PNG

   IHDR         7   TIDAT(c` 8bB!GXP"BA(!@!e) dS3:nC	&DB@S+!
 `4{y    IENDB`PNG

   IHDR           szz  IDATx^WMhQmn/&""6.I${(*=	
E^=w$EBZH!UHf}>H&Tzafvvwnq0i8L0BK6B!_*$d^@o+$DR	 #UJ
)X,*G`dddG -tk	}t'TT*:4y$NH cL Q}? n 	/vE]P_?q)&.|74G!R=6R%nH(um#hn5WH-}QT[ I(HEU]+`YZt`~SqX=1t2nxX@|xUZGh['}{xT\T,;j)<CH@#	 V4y
kL/R'l6+J"x<\.PQ(Aoo/ "T%Rk233#U|^===ImEiH$;V;44D;%B-Ix~"7vpB+eY7661($Te    IENDB`PNG

   IHDR           s   IDATx^?
0?y(G#N]
}*
!	QTJo/45u8W2:@1^@ T)^|(`QA$0e ]g! yN-p  '$N$r6R!||,t) t	|8d@%    IENDB`PNG

   IHDR         7   9IDAT(c` 8bB!GXP"BA(!
@$	B"(%\	Q  sp56%    IENDB`PNG

   IHDR           szz  BIDATx^{K#g_O'PPhJu4&nT34"Z/t1FV\	S8&Sy99yg+t]]S4Gs8_5okk/p8\H$Vp||K9gv+:hf{{8<<:0;;Kc|IFU
HUgNOOi|>l6?m~f=gEUx^4[hfffk<{f+Fibf(Jq#NN~evwF<19UpAZa9lJA M ZZ( a0Lfgm5k-X^.'52tV'	X-}OL$| wBbl0,<99d|H}}}6&LaXbpOt>b.!)Wf[,u5xCbhiiYgg'SGGxN<pss~{{P($E<fF+b(l6"J(1K<Tp8NIPf	UUU7o"all]]]X/ceH%g0GGGTTT5X[GVlj
_ z~KE`01'U7e0Wchhggg9Jeee0=p8p8Gt_ 1~}!sIA80lS.Q\\FDi0vhFg0LSQRRWTTW!(G_gERli<)Eh,f$z]XX'  k4<4=?;+0C
"q)b$	$&E]s,<x3f|#!+|#!C$yFbq0_*RUUz"}4z|OR>zw,L!6]&7\!3ZEbUeT,SZm)r.ZCpbSo]}B(@pG!V'@;&Le)'>*F>]
k`QD7:d0bzM|CW    IENDB`PNG

   IHDR   	      =Z   'IDATcx_kDb@0aRH`jM -2^    IENDB`PNG

   IHDR   	      =Z   "IDATcx JCXH0A \ !b
 k-jP    IENDB`<svg xmlns="http://www.w3.org/2000/svg" width="80" height="32"><g fill="none"><path d="M50 19.732A1.73 1.73 0 0 1 51.726 18h9.548c.953 0 1.726.769 1.726 1.732v8.536A1.73 1.73 0 0 1 61.274 30h-9.548A1.725 1.725 0 0 1 50 28.268v-8.536zM56 22h1v-1h-1v1zm0 5h1v-4h-1v4z" fill="#000"/><path d="M64 32V16h16v16z"/><path d="M67.719 18c-.952 0-1.719.762-1.719 1.719v8.562c0 .963.765 1.719 1.719 1.719h9.562c.952 0 1.719-.762 1.719-1.719V19.72c0-.963-.765-1.719-1.719-1.719H67.72zm4.781 2a2 2 0 0 1 2 2c0 .44-.184.84-.469 1.125l-.437.469c-.36.365-.594.656-.594 1.406h-1v-.25a2 2 0 0 1 .594-1.406l.625-.625A.998.998 0 0 0 73.5 22c0-.55-.45-1-1-1s-1 .45-1 1h-1a2 2 0 0 1 2-2zm-.5 6h1v1h-1v-1z" fill="#000"/><g transform="translate(0 16)"><path opacity=".2" d="M0 0h16v16H0z"/><rect rx="1" height="8" width="8" y="4" x="4" fill="#000"/></g><g transform="translate(16 16)"><path opacity=".2" d="M0 0h16v16H0z"/><rect rx="4" height="8" width="8" y="4" x="4" fill="#000"/></g><path opacity=".2" d="M32 16h16v16H32z"/><path fill="#000" d="M35 28l5-9 5 9z"/><path opacity=".2" d="M32 0h16v16H32z"/><path d="M32.5 14h15L40 1l-7.5 13zm8.5-2h-2v-2h2v2zm0-3h-2V6h2v3z" fill="#000"/><path d="M32 0v16H16V0z"/><path d="M24 1c-3.864 0-7 3.136-7 7s3.136 7 7 7 7-3.136 7-7-3.136-7-7-7zm-5.5 7c0-3.032 2.468-5.5 5.5-5.5s5.5 2.468 5.5 5.5-2.468 5.5-5.5 5.5A5.507 5.507 0 0 1 18.5 8zm6.5 4V7h-2v5h2zm-2-6h2V4h-2v2z" fill="#000"/><path d="M16 0v16H0V0z"/><path d="M10.5 6.5v-1A2.5 2.5 0 0 0 8 3c-1.38.01-2.5 1.12-2.5 2.5v1H5c-.55 0-1 .45-1 .996V12.5c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-5c0-.528-.45-1-1-1h-.5zm-4 .01V5.5C6.5 4.67 7.17 4 8 4s1.5.67 1.5 1.5v1.01h-3z" fill="#000"/><path d="M160-32V0h-32v-32z"/><path opacity=".2" d="M0-32h32V0H0z"/><g><path opacity=".2" d="M32-32h32V0H32z"/></g><g><path opacity=".2" d="M64-32h32V0H64z"/></g><g><path opacity=".2" d="M64-64h32v32H64z"/></g><g><path d="M64-64v32H32v-32z"/></g><g><path d="M32-64v32H0v-32z"/></g></g></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="110" height="110"><defs><linearGradient id="y" x1="113" x2="127" y1="104" y2="104" gradientTransform="translate(-.714 -69.286) scale(.71429)" gradientUnits="userSpaceOnUse" xlink:href="#a"/><linearGradient id="a"><stop stop-color="#606eda" offset="0"/><stop stop-color="#021db2" offset="1"/></linearGradient><linearGradient id="A" x2="24" gradientTransform="matrix(0 -.41667 -.41667 0 25 10)" gradientUnits="userSpaceOnUse" xlink:href="#b"/><linearGradient id="b"><stop stop-color="#d7687d" offset="0"/><stop stop-color="#b21402" offset="1"/></linearGradient></defs><path d="M0 20.995c0-.55.456-.995.995-.995h8.01c.55 0 .995.455.995.995v8.01c0 .549-.456.995-.995.995H.995C.445 30 0 29.544 0 29.004zm5.123 4.744C7.691 25.312 8.75 24.546 8.75 22h-1.5c0 1.62-.44 1.939-2.373 2.26-2.568.429-3.627 1.194-3.627 3.74h1.5c0-1.62.44-1.937 2.373-2.26zM23.65 27.21l-1.44-2.03L21 26.39 23.55 30 30 22.33 28.88 21z"/><path d="M6.5 46c0 .55.45 1 1 1s1-.45 1-1-.45-1-1-1-1 .45-1 1" fill="#bababa"/><path d="M5.75 42.75L2.25 46l3.5 3.25" fill="none" stroke="#bababa" stroke-width="1.5"/><path d="M27.5 42.43l-.93-.93L24 44.07l-2.57-2.57-.93.93L23.07 45l-2.57 2.57.93.93L24 45.93l2.57 2.57.93-.93L24.93 45l2.57-2.57z" fill-opacity=".24"/><path d="M27.5 41.93l-.93-.93L24 43.57 21.43 41l-.93.93 2.57 2.57-2.57 2.57.93.93L24 45.43 26.57 48l.93-.93-2.57-2.57 2.57-2.57z" fill="#676767"/><path d="M43.25 20c-.7 0-1.25.5-1.25 1.25v7.5c0 .7.5 1.25 1.25 1.25h3.5c.7 0 1.25-.5 1.25-1.25v-7.5c0-.7-.5-1.25-1.25-1.25zM43 21h4v7h-4zm2 7.25c.4 0 .75.3.75.75 0 .4-.3.75-.75.75-.4 0-.75-.3-.75-.75 0-.4.3-.75.75-.75z"/><g transform="translate(40 40)"><path transform="translate(-20)" d="M25 0c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5" fill="url(#c)"/><path d="M.36 5C.36 7.56 2.44 9.64 5 9.64c2.56 0 4.64-2.08 4.64-4.64C9.64 2.44 7.56.36 5 .36 2.44.36.36 2.44.36 5" fill="#eb3941"/><path d="M3 3l4 4M7 3L3 7" stroke="#fff"/><defs><linearGradient id="d"><stop stop-color="#d7687d" offset="0"/><stop stop-color="#b21402" offset="1"/></linearGradient><linearGradient id="c" x2="24" gradientTransform="matrix(0 -.41667 -.41667 0 25 10)" gradientUnits="userSpaceOnUse" xlink:href="#d"/></defs></g><path d="M4.5 61.3l4 3.7-4 3.7v-1.2H1.425l.075-5h3z" fill="#adf2ad" stroke="#007200"/><g transform="translate(20 60)"><path transform="translate(-140)" d="M144.95 10A5.002 5.002 0 0 1 140 4.95 5.002 5.002 0 0 1 145.05 0c2.76.03 4.98 2.29 4.95 5.05a5.002 5.002 0 0 1-5.05 4.95z" fill="url(#e)"/><path d="M9.5 5.05A4.494 4.494 0 0 1 4.95 9.5 4.494 4.494 0 0 1 .5 4.95 4.494 4.494 0 0 1 5.05.5C7.54.53 9.53 2.56 9.5 5.05z" fill="#00be00"/><path transform="translate(-140)" d="M145.08.53c1.97.02 3.55 1.06 3.54 2.32-.01 1.26-1.62 2.26-3.59 2.24-1.97-.02-3.55-1.06-3.54-2.32.01-1.26 1.62-2.26 3.59-2.24z" fill="url(#f)"/><path transform="translate(-140)" d="M144.98 9.41c1.66.02 3.01-.68 3.02-1.56.01-.88-1.33-1.61-2.98-1.63-1.66-.02-3.01.68-3.02 1.56-.01.88 1.33 1.61 2.98 1.63z" fill="url(#g)"/><defs><linearGradient id="h"><stop stop-color="#00d600" stop-opacity="0" offset="0"/><stop stop-color="#d8fc7b" stop-opacity=".81" offset="1"/></linearGradient><linearGradient id="i"><stop stop-color="#00ba00" offset="0"/><stop stop-color="#fff" stop-opacity=".91" offset="1"/></linearGradient><linearGradient id="j"><stop stop-color="#00a104" offset="0"/><stop stop-color="#00c605" offset="1"/></linearGradient><linearGradient id="g" x1="227.88" x2="235.12" y1="103.16" y2="103.16" gradientTransform="matrix(-.0048 .4396 .78038 .00853 65.608 -94.834)" gradientUnits="userSpaceOnUse" xlink:href="#h"/><linearGradient id="f" x1="227.88" x2="235.12" y1="103.16" y2="103.16" gradientTransform="matrix(.00687 -.62923 .9267 .01012 47.871 147.44)" gradientUnits="userSpaceOnUse" xlink:href="#i"/><linearGradient id="e" x1="227.88" x2="235.12" y1="103.16" y2="103.16" gradientTransform="matrix(-.01507 1.3791 -1.3006 -.0142 282.66 -312.8)" gradientUnits="userSpaceOnUse" xlink:href="#j"/></defs></g><g transform="translate(40 60)"><path transform="translate(-80)" d="M85 0c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5" fill="url(#k)"/><path d="M.36 5C.36 7.56 2.44 9.64 5 9.64c2.56 0 4.64-2.08 4.64-4.64C9.64 2.44 7.56.36 5 .36 2.44.36.36 2.44.36 5" fill="#2a53cd"/><path d="M3.93 2.14c-.03-.53.55-.97 1.06-.83.5.12.79.73.56 1.18-.2.44-.79.61-1.2.36a.812.812 0 0 1-.42-.71zm1.7 5.46h.67v.53H3.41V7.6h.66V3.99h-.66v-.53h2.22V7.6z" fill="#fff"/><defs><linearGradient id="l"><stop stop-color="#606eda" offset="0"/><stop stop-color="#021db2" offset="1"/></linearGradient><linearGradient id="k" x1="113" x2="127" y1="104" y2="104" gradientTransform="translate(-.714 -69.286) scale(.71429)" gradientUnits="userSpaceOnUse" xlink:href="#l"/></defs></g><path d="M60.45 20.467v9.079h5.373l3.582-4.54-3.582-4.539z" fill="#698cfe" stroke="#4073f4" stroke-width=".908"/><path d="M60.45 40.467v9.08h5.372l3.581-4.54-3.581-4.54z" fill="#ef9d0d" stroke="#a36c01" stroke-width=".908"/><g transform="translate(60 60)"><path d="M5 10c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="#e5a600"/><path d="M9.5 5c0 2.49-2.01 4.5-4.5 4.5S.5 7.49.5 5 2.51.5 5 .5 9.5 2.51 9.5 5z" fill="#ffbd00"/><path transform="translate(-160)" d="M165.03.53c1.97 0 3.56 1.02 3.56 2.28 0 1.26-1.59 2.28-3.56 2.28s-3.56-1.02-3.56-2.28c0-1.26 1.59-2.28 3.56-2.28z" fill="url(#m)"/><path transform="translate(-160)" d="M164.99 9.42c1.66 0 3-.71 3-1.59 0-.88-1.34-1.59-3-1.59s-3 .71-3 1.59c0 .88 1.34 1.59 3 1.59z" fill="url(#n)"/><defs><linearGradient id="o"><stop stop-color="#ffa801" stop-opacity="0" offset="0"/><stop stop-color="#f0fb3d" offset="1"/></linearGradient><linearGradient id="p"><stop stop-color="#ffbd00" stop-opacity=".65" offset="0"/><stop stop-color="#fff" stop-opacity=".91" offset="1"/></linearGradient><linearGradient id="n" x1="227.88" x2="235.12" y1="103.16" y2="103.16" gradientTransform="matrix(0 .43966 .78049 0 84.444 -93.924)" gradientUnits="userSpaceOnUse" xlink:href="#o"/><linearGradient id="m" x1="227.88" x2="235.12" y1="103.16" y2="103.16" gradientTransform="matrix(0 -.62931 .92683 0 69.47 148.53)" gradientUnits="userSpaceOnUse" xlink:href="#p"/></defs></g><g transform="translate(0 80)"><path transform="translate(-120)" d="M125 10c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="url(#q)"/><path d="M9.5 5c0 2.49-2.01 4.5-4.5 4.5S.5 7.49.5 5 2.51.5 5 .5 9.5 2.51 9.5 5z" fill="#d00"/><path transform="translate(-120)" d="M125.03.53c1.97 0 3.56 1.02 3.56 2.28 0 1.26-1.59 2.28-3.56 2.28s-3.56-1.02-3.56-2.28c0-1.26 1.59-2.28 3.56-2.28z" fill="url(#r)"/><path transform="translate(-120)" d="M125.03 9.47c1.66 0 3-.71 3-1.59 0-.88-1.34-1.59-3-1.59s-3 .71-3 1.59c0 .88 1.34 1.59 3 1.59z" fill="url(#s)"/><defs><linearGradient id="t"><stop stop-color="red" stop-opacity="0" offset="0"/><stop stop-color="#f0cb68" stop-opacity=".71" offset="1"/></linearGradient><linearGradient id="u"><stop stop-color="#e60000" stop-opacity=".65" offset="0"/><stop stop-color="#fff" stop-opacity=".91" offset="1"/></linearGradient><linearGradient id="v"><stop stop-color="#a10000" offset="0"/><stop stop-color="#c60000" offset="1"/></linearGradient><linearGradient id="s" x1="227.88" x2="235.12" y1="103.16" y2="103.16" gradientTransform="matrix(0 .43966 .78049 0 44.488 -93.88)" gradientUnits="userSpaceOnUse" xlink:href="#t"/><linearGradient id="r" x1="227.88" x2="235.12" y1="103.16" y2="103.16" gradientTransform="matrix(0 -.62931 .92683 0 29.47 148.53)" gradientUnits="userSpaceOnUse" xlink:href="#u"/><linearGradient id="q" x1="227.88" x2="235.12" y1="103.16" y2="103.16" gradientTransform="matrix(0 1.3793 -1.3008 0 259.08 -314.35)" gradientUnits="userSpaceOnUse" xlink:href="#v"/></defs></g><path d="M20 80h10v10H20z" fill="none"/><path d="M27.5 82.5V80H20v7.5h2.5V90H30v-7.5zM21 81h5.5v5.5H21zm2.5 6.5h4v-4H29V89h-5.5z"/><path d="M23.5 87.5h4v-4H29V89h-5.5z" fill-opacity=".25"/><g fill="#acf2ae" stroke="#007200" stroke-width="2.577"><path transform="matrix(.29356 0 0 .2909 2.65 86.864)" d="M144.95 10A5.002 5.002 0 0 1 140 4.95 5.002 5.002 0 0 1 145.05 0c2.76.03 4.98 2.29 4.95 5.05a5.002 5.002 0 0 1-5.05 4.95z"/><path transform="matrix(.29356 0 0 .2909 2.65 86.864)" d="M149.5 5.05a4.494 4.494 0 0 1-4.55 4.45 4.494 4.494 0 0 1-4.45-4.55A4.494 4.494 0 0 1 145.05.5c2.49.03 4.48 2.06 4.45 4.55z"/></g><path d="M48.313 82.5L45.21 86l-3.102-3.5h1.24v-1.92h3.723v1.92z" fill="#adf2ad" stroke="#007200"/><path d="M66.537 88.514a1.314 1.314 0 0 1-1.335 1.295 1.313 1.313 0 0 1-1.306-1.324 1.314 1.314 0 0 1 1.335-1.294c.731.009 1.315.6 1.307 1.323z" fill="#acf2ae" stroke="#007200" stroke-width=".753"/><path d="M62.108 83.5l3.102-2.982 3.102 2.982h-1.24v2h-3.723v-2z" fill="#adf2ad" stroke="#007200"/><path d="M83.25 21.75l3.5 3.25-3.5 3.25" fill="none" stroke="#367cf1" stroke-width="1.5"/><path d="M86 40l-5 5 5 5v-2h3v-6h-3zM84 60l5 5-5 5.022v-2.045L81 68v-6h3z" fill="#4688f1"/><path d="M84.5 88l3.5-6h-7M7 104.5L2 101v7M24 100l4 7h-8"/><path d="M43.25 102.75l3.5 3.25-3.5 3.25" fill="none" stroke="#939393" stroke-width="1.5"/><path d="M61 109l4-8 4 8z" stroke="#c19600" stroke-width="2" stroke-linejoin="round"/><path d="M61 109l4-8 4 8z" fill="#f4bd00" stroke="#f5bd00" stroke-width="1.5" stroke-linejoin="round"/><path d="M63.75 102.75h2.5v2.5l-.5 1.75h-1.5l-.5-1.75v-2.5m0 5.25h2.5v1.25h-2.5" fill="#ad8601"/><path d="M64 103h2v2.25l-.5 1.75h-1l-.5-1.75V103m0 5h2v1h-2" fill="#fff"/><text style="line-height:0%" x="3.051" y="118.387" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="3.051" y="118.387" style="line-height:1.25" font-size="8">a</tspan></text><text style="line-height:0%" x="23.051" y="118.387" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="23.051" y="118.387" style="line-height:1.25" font-size="8">b</tspan></text><text style="line-height:0%" x="43.051" y="118.387" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="43.051" y="118.387" style="line-height:1.25" font-size="8">c</tspan></text><text style="line-height:0%" x="63.051" y="118.387" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="63.051" y="118.387" style="line-height:1.25" font-size="8">d</tspan></text><text style="line-height:0%" x="83.051" y="118.387" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="83.051" y="118.387" style="line-height:1.25" font-size="8">e</tspan></text><text style="line-height:0%" x="-7.026" y="107.818" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="-7.026" y="107.818" style="line-height:1.25" font-size="8">1</tspan></text><text style="line-height:0%" x="-6.819" y="87.88" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="-6.819" y="87.88" style="line-height:1.25" font-size="8">2</tspan></text><text style="line-height:0%" x="-6.756" y="67.992" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="-6.756" y="67.992" style="line-height:1.25" font-size="8">3</tspan></text><text style="line-height:0%" x="-6.917" y="47.994" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="-6.917" y="47.994" style="line-height:1.25" font-size="8">4</tspan></text><text style="line-height:0%" x="-7.108" y="28.056" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="-7.108" y="28.056" style="line-height:1.25" font-size="8">5</tspan></text><circle cx="3" cy="3" r="2.5" transform="matrix(1.13208 0 0 1.13208 81.604 102.604)" fill="#00bcd4" stroke="#000" stroke-width=".3"/><path d="M5 0a5 5 0 1 0 0 10A5 5 0 0 0 5 0zm.048.721c1.083 0 2.179.4 3.005 1.226a4.234 4.234 0 0 1 0 5.986L5.048 4.952l-2.98-3.005A4.18 4.18 0 0 1 5.047.721z"/><text style="line-height:0%" x="-6.68" y="8" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="-6.68" y="8" style="line-height:1.25" font-size="8">6</tspan></text><path d="M17.601-2.913h16.232v16.232H17.601z" fill="none"/><path d="M21.11 5.556L20 6.667 23.334 10 30 3.334l-1.11-1.111-5.556 5.555z" fill-rule="evenodd"/><path d="M44.954 8.42a3.467 3.467 0 0 1-3.462-3.46c0-.678.2-1.309.531-1.84l4.77 4.77c-.531.338-1.162.53-1.84.53m3.462-3.46c0 .676-.2 1.307-.53 1.838l-4.77-4.77a3.405 3.405 0 0 1 1.839-.53 3.467 3.467 0 0 1 3.461 3.461M45 .005a5 5 0 1 0 0 10 5 5 0 0 0 0-10"/><path d="M68.875 2.219L63.344 7.78l-.407-.406L61.844 8.5l1.5 1.5L70 3.344l-1.125-1.125z" fill-rule="evenodd"/><text style="line-height:0%" x="103.739" y="118.482" font-weight="400" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="#ccc"><tspan x="103.739" y="118.482" style="line-height:1.25" font-size="8">f</tspan></text><g transform="translate(100 100)" mask="url(#w)"><path d="M1 9l4-8 4 8z" stroke="#c19600" stroke-width="2" stroke-linejoin="round"/><path d="M1 9l4-8 4 8z" fill="#f4bd00" stroke="#f5bd00" stroke-width="1.5" stroke-linejoin="round"/><path d="M3.75 2.75h2.5v2.5L5.75 7h-1.5l-.5-1.75v-2.5m0 5.25h2.5v1.25h-2.5" fill="#ad8601"/><mask id="w"><path fill="#fff" d="M0 0h10v10H0z"/><path transform="translate(-60)" d="M64 3h2v2.25L65.5 7h-1L64 5.25V3m0 5h2v1h-2"/></mask></g><g transform="translate(100 80)" mask="url(#x)"><path transform="translate(-80)" d="M85 0c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5" fill="url(#y)"/><path d="M.36 5C.36 7.56 2.44 9.64 5 9.64c2.56 0 4.64-2.08 4.64-4.64C9.64 2.44 7.56.36 5 .36 2.44.36.36 2.44.36 5" fill="#2a53cd"/><mask id="x"><path fill="#fff" d="M0 0h10v10H0z"/><path transform="translate(-80)" d="M83.93 2.14c-.03-.53.55-.97 1.06-.83.5.12.79.73.56 1.18-.2.44-.79.61-1.2.36a.812.812 0 0 1-.42-.71zm1.7 5.46h.67v.53h-2.89V7.6h.66V3.99h-.66v-.53h2.22V7.6z"/></mask></g><g transform="translate(100 60)" mask="url(#z)"><path transform="translate(-20)" d="M25 0c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5" fill="url(#A)"/><path d="M.36 5C.36 7.56 2.44 9.64 5 9.64c2.56 0 4.64-2.08 4.64-4.64C9.64 2.44 7.56.36 5 .36 2.44.36.36 2.44.36 5" fill="#eb3941"/><mask id="z"><path fill="#fff" d="M0 0h10v10H0z"/><path transform="translate(-20)" d="M23 3l4 4M27 3l-4 4" stroke="#000"/></mask></g><g><path d="M105.1 40.267a4.835 4.835 0 0 0-4.833 4.833 4.835 4.835 0 0 0 4.833 4.833 4.835 4.835 0 0 0 4.833-4.833 4.835 4.835 0 0 0-4.833-4.833zm0 1.45c.802 0 1.45.647 1.45 1.45 0 .802-.648 1.45-1.45 1.45-.802 0-1.45-.648-1.45-1.45 0-.803.648-1.45 1.45-1.45zm0 6.863a3.48 3.48 0 0 1-2.9-1.556c.014-.962 1.933-1.489 2.9-1.489.962 0 2.885.527 2.9 1.489a3.48 3.48 0 0 1-2.9 1.556z"/><path d="M99.3 39.3h11.6v11.6H99.3z" fill="none"/></g><path d="M105 22.528l-4 4.43.94 1.042 3.06-3.382L108.06 28l.94-1.041z"/><path d="M76.448 14.99h17.528v19.416H76.448z" fill="none"/><path d="M88.06 3.06L85 6.113 81.94 3.06 81 4l4 4 4-4z"/></svg>PNG

   IHDR         a   tEXtSoftware Adobe ImageReadyqe<  -IDATxS@dR@:@t@ _ Qof./%1E'-
 G&q\l`PH!w]VVQ65w
<I#o6#V[W5g'&")PG=8:y=	i|HA  v~'z;$s`Ti\.NOA$GfZc,Kv ^j0%/l"x4l"3l]!!L\";MB5Q- Cn    IENDB`PNG

   IHDR         _   #IDAT(c`LLL"	aR	aAF? dy0Kw    IENDB`PNG

   IHDR         J#+   IDATx^10Ec{v*aA&^we1kp	CiO8r*:z&<=Unr
fJNa_G8BWON?/x|'b< $bN1J)'EbrtT6Bt
{}_cAvbqxT{o8j+9    IENDB`PNG

   IHDR   .   .     IDATx^O0t)vM=Ae(B[-hTU|3kL&%|yyyOzG%-=/p#E18\x6psd-47%2}&.se)LLMxd3AU_b	>B8&I7 cU[?Me=P11v)+Q:\z`9c>B|LOU`pW^}\Vn<a9CO&dW%H'St7EF~1LtKZ(
euMWp)]d(]s	OI(i(^"OS.cA>aQDX%4aOP6\"}KbJg    IENDB`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="24"><path d="M7.5 6L2 2.25v7.5M20.5 9.5L24.25 4h-7.5"/></svg>PNG

   IHDR         `  PLTE(y,|.}*z0~<96742&x>M$vFD@!u0yVB1{1}+u5|Y2wJ3~/{H+w3z5z2uA0x5ysT/z78Pi5~k(w2yR(y^qy(x+xNb4(so	ebem+ud!c3w8+z#h6|-{/|%gg'u#kX!d~D%nVd0w fH&mhI%p9}%r_ _'t
^(qh1u ]@;'k<[FlG$exrd^)r-ue#rc6yY&glXj7ue^$uV&pb4oi<~P3umY;tm.tx` qw@~G{nWvZK!kb@@(M D{s^Iv?}yydd)M%@6mhZb6`GSO:ETDSVMz  ,IDATxoRWppiav@6&6bcA6JKi4j4
i)&s8g6jlf27s/9r{-q9<TVNgm-kp<sx=fO+FkY(zh`(B`qxW"FhE	PE{I1K8zI8Fb1R0sFlMLb3AOP	A"WE+TA/`[,4+qbXN
S"M/@|l3Z1WMX\,Z0\UU^ #qKQ;z4M0)bKCf;.`Jf;+%%oE,tw\Qw&VX\<	,RWG+b t^.kXb>fOn!Va=CM+p23^TxfkukZ-V$4HXR#US f5MC,]uI_b`0X0^jy`E,4WX*{}yj!)L)UHos`E\X{)"+&p}WhzNgCdS&,ycqt5`h;TzGT03QOu}yKE6L*
$x5=+)eQKK`[)c?dS	cAWx`DH#LJ4!	[ ZkYew+@n]xw<ZqZ}]wqBr{_^Ou gqh/x U7GO*:0}`GM{_u=h	7^8uiAthF4'x{!JN+apasNKWtuXyjb 4m:!W*rg;$L'4oZ`fs0MIub<2:T^O{ZJyfojCm%(-b|Iha ?YkhoX_$$KRs_.g[vnE9 y~J:tqDKbf
c.m2{  zjg) Nm}KbDXiiB"Oc,F`v9 V%GlE@D_HK("F[+CH`]XBvKQ5Y9?=w-rap|+m8MXCa0jB-7A\(-Hn]&iVb^;`<J3!H:a.\/3|{S.Hpwufw8'Sc]7t{Cjz"-XK#QAuh.%W^-&mLkM8:Kj@6WI:vK/(?[-0.\v.>F^NFp3VFqm+Niz"z*	Rz=pdx+{r\y^^Z+]P/C5.d9gXBhVx\PEo<UE%#1piyC$7tIw,1)E7
8Ty3`&54D}	d#[5iyZO]I)==;#	\|9kh7+',>V,^U	!sVP*`z<0[8srRR&VY#GO
j6o.}qU`,</VK|ivllbi`lm[U[Mo"y_b}3l 8NK8#<rKGtlmb=6_	nr51kZ#+<\"82{GhYqKMCFKA}l\.^"(R4T%Z>7	t204{?&%,KIy0CK+QWF:[,@FPA^S	SV?D"t'
{h/G zk
qm6%uf!cKArO4nHp6]
Vqcpn97GW=j<WjL2^>LS6t2~N$~MH+JkOJX\ p6I&RdCVh$x_nK#0?KIkQ7erE!ZC[	yFbH	NC S#pTL p4j0A2v&`8& o$>#pb9j6Jb9Uf3';o]>$%t
d?80:..^~?	}x_{z=?D_lWI8n opUCG~<D|7~hx.{+b'V;gF2&pT&s	Fs1y'!?@QI? Ox["AR~Xtf9l-	IL"OP#Pghq;;81&0x.T70F%^>rxf^U\FHFg5,zb_|48xx/L`^lR\
XP2S	D*{,m`"aUBbqTE`7t?~.,_vzzTH`A;a`Oqhh~
#Dbtae>U.}3Q]!~@gn^8/Cu3kMIW,Hr CIFoPD:n*b!*fq&g6m3e>3OUT{:Ui[Es~_=zK=xL3u+zhT"6fY890s--6xllGnkwNCzetQ/eo"p0,;`S/s:^t1<9OG/7ElK	q7(A	=R\TMUzsb1{3sZpuiz	/j$|PbX<+)YMk0<>E< 8/N"R=cVCInq`^Lh]mX"
YX[AngxZ4_eR)+x]tpAGR#"RMn+nP;CO~ccfR]',4ta$|p7^O4-_v594#;UF|*3)]oEd#1#fUw"E|ZH
-?<Sm#Gh@3Q"m}=[Jwrvm\vg+a=g}7	]-'+"DS\}.|#;'?j5{~Nw.^\pX.wF\M8<Ma8Hzk	`NPF+)vk KMjnP6=:Tv{F6<mXq/CAot=\CecM6,@Ii,Nuz^N0yL@p*- ]ZIA8ILOE%7/%v~X8bM3s:fU'ib`G4u&">,/0&=",Oh!QG6s1SkP`gg$ij\'R)vY;Xel{M`Q6?,C{T0-x\eJUXu'#okme1l2]-&*^<Ixf'jeCly|^v5MkXR#9@CwPV4j5a!,a7 ,D;)Xo2Kk-n*4pB|LCBlE3`@LHGhe,Fb0WeeXMS*m0T(i=e{m?bK{"jPIn30{ibpN;?%hW-/LfWDfJ1@?}+Ei"b%d1"KaC[6ciBPcK}bnv,#o WXYBm^11rD1vI,|oeYK#+03X097x6XVa^Df=DI#,H*Zp$9}uaQ{qfkUp`T*>q,
oZ360<"gp!#4n#pVgq+j6T%{=P6pyQt:O (D({E` Tg4$}v7zZ{K3|A%3yYD[9J	\0UX_] q59j{Aa,6NMiG/_yDI4QRaRAh o	sT;hEp`h~/^Y|.)K$LZnY2vZmd$7O92:];HR%`P;0-X
vq-i,he0Biq7.Vu<OS;r[n<cm@80(BcZ@4TAl)4
u_i`>nR&L4>Yp?)? o+@0Gi4]*5Z F/T.>X~bD]rrG
i'?_9PMNP&#ysw
- >ko 8\4f7o$]rqcWgx<}n(iqw{thrH DTE^&U`auP`Q`tu"d|7/= \uZM$.V0n,|w}N3+DitIpV6t cx\RgyAY]t{Q[\v- iJkwXu$ Tuq#	Pz}iS-h@	tU $jXQN;]v,j,{2r2#^&W,$``XYl e]'tI0Sk"cNaSNG(Gt+"h!K{9
	
Wyq^NqDA\C[:?
u1K$o}9K}M~s* T#M}X]|}S/m\U5zxP{ow|Y0m
KVoP!>?8FDE|~C{T$VBkK\{f[/o-mYTj\Tz%fEEHAd:@x$H;{}1W	6 ODi7D 0V_9V?]VQ8
8R04cOv&.NlA:a"!sSDA*(5-e.)IWdg>K^?<id0-_L0qc]q*ZVpPg"Z2^"68.z#xG8r>aXkfE=f4s=+oiym+V$L1M*M3M`f#QQ0rkH\?wg_!O_ u_	m#26I,b$I{6|~")k
ldug);lH.Beu;e9x)sOgly0>8>16mb&.A=R$!p 25-*`L)g3p)]8:sP2~x_ _aAWi\A+WC$2yK6"Na45wsE#t-]	`wa[sAj-!L<R? {m) ~nZ6Jm	YG-C'f5UdFA`W,V	J1BL"~??Ds=[{{id?v>Wn=SM89A+t?dt'N\{p)>p@M~r`NKz.<^"eY	+8\$XPn6JobQgXp|mvta+9dM8<|n{{4U pFw^T\aY~(f Vq_$eEE3h1tU\1t1|/8q$fg]vY07&-p~<J^[%!m
cF>'!m"#1a(#0IVZR?O{j~<L3.KEzvc<.Kt3:4*fH$@,dbrmwqgr0&/b14>)	,W>J&kQJ^Z	`X)8V ][Z.4p,7V|&iIC+"2-c`s.[kR `s\".`VS=2FV&{4'uop~@3`j
#2z%0x8fZsVR^8u3
 |ay@7p_AJC\[y]oe08 	`!e-*LXp*ES/xF5`!^
&Qk,9*pmpBMKa"~jc2^xol`B`Oyv<JF]C|7hygJ_Iit^r0&~"'{X&pn\9n@_PO)5hmoW63[(B&	Ez8hi^ yz}XR/wHmaPHwn73iTCZ#X"mVmk{}l$oRd7 t6c
11fqst0
yf4&J3Rr"xqcx
"-06%!,b=O~}U:8/ YxxtL-
HKK'O`
^RK^AaOFc6lFsp\Y]<KcEaK--B~GAw]f16FIjt31<vhM .}h3>	g6|p#|.22gz)&@UM	`+v7T
{nv5}sCCncMHy*qK\LKq`[R0)xf08sy#6PrClzQ9w~3glxOd"wWnQI8\
SR\>!*vO06]+-7>#p`'pebu*'ivz>>A#3m/,m> $hj=g<x ZutR;X0'0XJdPPaxt'U6!ZM#nG~{\W ;tkX
ym 66.-A,j=_CkMe:cAC-kSs<oRMEX6OIdo|Zp?KF^:}<f{xp_~zkw.os-](pX*TX_g]rpry/G9	=X,}"v==;('cqp`)\e{{:lR1XSY$6<0N_zq)4XQ\JW;C"$*%!X	f)lmL7`Z#QVc9r7TJ6ot'w;M"[+l'GuLh`#2DiObHR$"M
$</#KT(X.,4%uGTL,t*
KUHtLkVWm'GA``-??]cu	<KLbw;t|b~c*`B`HkGDsE> j/5A|TX:K#7
o*C2by
cBtI	Xjxh3NRS~}SNgtJB?5ui;Oi21mgsx%K8_5/hdNf@[v<J#i%x:csE'[iVQT g&H\e	~w1^& c`Zm|G\bChR18<hk:I/nf_5\\/G_LW.FO+]XQmJ9W	jN'ur-g MqvX#u<gY4TmjU81dS]&AMf_Cwn[5eVlKV&
]9a1}k#1
aNVf}Q^v+RkVm'};sy"x.J\GF0#cV1]cY@49vz=XlEYEqO@FyoF}8k5`=;k=; P`lS-T<0dOwo-yl :okw0K3`<;Jx^
9_-Xu0Z<Xo=.@S1!s n]5.JL~8R7byS.`W>+.Bo|0n]q ?LyADaA=bCH	VzT.mfFc|D!(0]7wfo2z>5>8p6/ +[K%H0&_?,~M:*'\csB	WC6-\Lw+UJ2[FpF|B,8?=5olm6cZuRbH!FpTG24	YWzx%p1<? ^LQt/-R*.mUBY:c>!xitzK"'<8xi<{ap"h:S`
O!6	s-X_wS$X!6_RpV/TU
BTb]#v1D+LFPUEfKp2!:}
qVl,3\NX`<"1*Z#1 a<8aQWX9dxe`KTs?l`a0+K:8EaAPs<UYnSE-`l8-uX6h!b<aN(-Sh^Lbw\vJ.XI)1Pp.jZ`)xvR\-W,Z`)Xj    IENDB`     }sFWu<"oR]"gKyg_"\.DB" @rJf3 (Qfw_NyO^Y<pGJ:
Z.f'//,tixy
gW*yq^.<p //8G{p\NYd,[2I8~z2?pnYgtw2mCYhU+q/m9y]#tB\U=v702Nny4&sP !'/g5r.nU.X/gqK''VX%iR!dN_Lpr6unK}v	M`2vx[!4d&:	$OPb&q2L'<oko9dN8VY-I0"<x"F`Mh;Y:=ne9!+y6
\kH{C
=Hf8tq8<wQxv-'[o[tKC3Kn8p`YFRQ*hd9\wr4;lz/j^ J`%- m`E}klu8Rk(9P,9RMn*sEBdIb/`Z+n:Le37.bcu6a,`*nOy>O=Gs < EF.g=kWn!OVu\~gr
2g/=p7Se<li#W+mZ
f3$YV =:49LVETih	#8|NES=dxI!,}o
o/ u}Te)/n?6aGC86CG7`ep,S4[7RI5m5MfG9Db@z:Op0:2  ~T4SIDqk2XD<JB??x!_G,38it)%H+BAjm|@F
hF!2gvQ,&iTS2n)Yf{fitGyx&No`bHFA<::8/,U6T0g4+SC&N QAS]<g[Amqz7;8jtXg|f5	5=X9OvHtcYVU.sE : ;#^&UL-{Ji(z,F`0Km'~vWNGqT0}T$+r(HE)H 8j,EL88~NuU}m)vG@l-Ef
|O*de	F^P-f2aCWS2/uX&B$+29iwP{y8
2*`4
hq5t?]TEsLI > BF	{ $aY4Zi2
?IuJ@IPQr5Z>(6X(J(rw:M^"_k/ou?;,x0z)M-T9n%xFN{+y} U6PpOQ:#<-dRq}0{!n7*;35oNH\<k2Kge$Y"KuJ^i:^F* H:"
eI]e0|?pWOi ^^ CV'"UgG5EP(Q#4> 9S+l<2V*[Po`I_j4{SgR_lR
%^4L- MgX%7p 7_{h nTl*$K=R;Za0^$&Y]}$22QlE*P7}^/xccH43/}4
EZq_{JGPF%H6 UK&>b=t3u4YqpA!!c2m_L5FTX@-=7,xr4A\G6t1O&eMY#0=D&L\b6sXL_
a*L=IMDp.=V*^o6+ByX3d Cz_Wa`{~68aI2
~Nt,B,?OT,3E>o~Z$Ia\3]K*C,fmy1A"()Je')LEr\N<s^WvTK{o|=PjDQGJQ,m$XdBy
msq1,wNQtYD&]^Q-9A"tmQQW`eQll	Q7RC"Z4LT~Ql-"Z5FS
*w]3bk|Xn?Y]fRlFn-
o4xY}.`{B=uu@3`MtfW+q%x'	
~a(_A!RiJ oXwH&n_#X0fi+ JKej'SKJ_mTZ"rr0&`(.
%0K	0CDd<2S{?6JM3j&
OYi),*",Q2i0 ~M<y	}, [vC	ITszIC2>;r1(r&LD)ez	7MI|  F`<;C-u 6fl60]_U^%8YD
"^f%*%vx*c!g*v|@Ooz=?>`w{m}^wc;tGm|9{kwm?gu\ukqvk#]{:^Q}>|i$X8[< ^FqkIP^:=P=Aw`]Cn{PwFM-~;KG=z1g +m,<J,h(	sw`+`wg= ca#P[f;51\6lS/{`cX}5| n{a~{??v:Aw4aCq76,%
 #/0%q$AYx`-|^|}m'!C@9eO2qW
 {;&~L=x`EM >yPAQ{1(zO=zCX}QJ0} y?)#m"4Z@R8e;! HFU:gX*O^(tZ~pD9$1eyqp=z
x#:+lq|q88ugZ_;G Ex?&9Dd``vaQ+7,H9C|mW /#D0 ,`4\nyWs"4x<q/tutKP>zzsajwp fAp1`E}l2W1+1MUt=@j}@>$:}B05$g)Fp`1ey{	D,` ^g;a"{BO.<]Kz0]-`
(uJe_@;>o|F*X .sjI$"U$*z]j<5ii3t\"Z*z5mm EK6!p|wCi  tk=iAw0|P x^[!:,Z8Z#@P2 };{PG~/
 qz>FQ7pX(z>X.xl -I/ x
j9._>q;0Nn,p s#p"x3<qrhJEB.&c&,!zD`bu]-E^9t
S/Ay8cY_-GC`ER
('z5eMi	1Q]zDvv{3Vk"%# 'sb&<g7y^o0~:x+1,o.l%7=hi6 jK	jHuU2xWSLOAVr@69{JF aG,L7ey
=4D y5w][cZ	EF554pB2R CGRF%I7|g@*ArC)LKP@sASg22
GN!52|wSv,KnSY%8C~ZfkKMVT4fHN^QqR3P@'@R;c`RA2K\_HBz`&_MWr.?&xYIk9,qkp%c- iH}<Yyr'OYENL 08'R4]7r	CGq|wmS$
ypA+Yj]QOc|{D
flq5@2y@800eoKGa\F\9~n[7Vb?_rVBef=}50<g#YM)YQ%]_dOy <-5={4`(',mSa/<WU !FjDq"7T$'lSTmb^.{ 5yIbEK@; H){|mf	wS&zyH?awW25ZVxBjNa8#taRv.QHHOy-Wr@)
87tk(RGgIc Kd#T:Scem/D,BZRb{@^Zr[R9\N'&?B`OO8)yh:Q<zq2ck$/K%v)~)wJk^Q,em7?#j2r[%1$l"m6)PPZ\iG|>]Y?X|u)`ZyT`W 	X^lX, Jvf/90]N4Dtq0I<+`:OK
[qL.8XX#$/lvL+#4wit8h`8rW=4*M0<Yt)3Bi^?qV'l,IR)es=ABTs~Moj	jJ	MP1`[%q5fnnxRSUb34DSisFL(3k4SF#"OMxfochxsDIY'Fkn1HaRwEPv[0y,[e"%D5EIu-JeIKQJ.%aS)w_VX="=b{u<]8gNU# Njk)%_S;l71Y3,2w!dN\;4UYMz^Xq@(Yw5iolpaLp{;Rx}Zt9'Gq[*oyFg>JEC9qn5ilCAcrt&ZoTLyZI\>nfqQl IcP~D1)JdtoI	ft_mhTZS	E4rL"Xe,1,22n'j`OpKPg
frsA2s'QnXCG!pkR'iAiv>~L<cfv{c0OmJlc|s-_iby[N(\^Jn[*%p
nY,`{]%='JaGGxi2ZqX\AZm.$d45PyTu?Wl[Ni3&#{`dz>qh!m74X8M[hhd?s41 3&rM-Tw2K/_gd:R\U8P2`23UJvnECHr$$Ix?&IG< 	cqWjBAai	' IU&;_+w8^&F^VHu[zkV5oQqC6:gGq/@npW4jDK;F8NXfvX+u%*?6T<&BZZrcS_Qjw/9.^^~8O[^ns/O	p.:ytKUm~{gbv=U#+W^XO6"U{uKmc*g'8,*BIVx%wWS*&A~Yqy%6jt UB6[i.uoPu38MmLP?*;&@V*tIukUS@	"w+cbl~dU/Y	r.AH\by9KOpq{[riuMwzR7@0)Sc]t}^fjOe2R&%Uz&I7$j%Y+Ef1_Xocw,&B1zzVX-Y);=6oAZ_S4wQGVIt4nLcmYuwn>|MY-&_m9}x-U
qo1 9*BJ48xtdOp-s ,D$

w #&2wJjLTB\G[&{Z*y'<mY'xw,j]25465`g"8Mz#pc(+S6Y+.LkLiDTcS`!<2)'KI	\FG=aUT_MX	e}FxyFLeTV.]^vqI-]d%s}gbf&37:gYYT|m8YA?PU:)_Vcin5{g_3p)6n3|][Z*f$^nSER}@  OWuW|*&Qn//J*tN5>du/&TIjI,4NqoA~h'R!<gN?"|Mt%|^\ieUl]-_9<g));B*"'{4HV!>NY@lpDR]ZC"iwPyfY1]2-] &=I<(
Y$ke_8GUE<	W	~ebFF'cfEN4`|fycI/R?R6|L=&zGx"*D$\IGeS[:LI/4'fGE)+>|@YSdVw+}J{Vlb"{A$Gr|s=(lg3:x%j2"2nM
t[;X}%Y$-2+1EGvJ#fWp@Y(bg8XQB5la6B%mg( VC"(^'ZCTH;b*;(NEF[D285^E3/>&-I}.a .pn uBB\1 [BT%mMa<fW\I\ h=c&z{\d@PE}&T"=!}XDH-U3MM+TrU/9]qlIXu
	uFswR,lH[6,\{H2	^KxIo:S,]D=LeWYO"k!(XN?/*EbP?/3EiwdL_^$|+avayp&8V`W+ WEq=1`x1"iJFSyTRe9486gb}f%Zs##i1@X=
\xyC_1#rj7JOY_n~1caEV1XWqbEwVIQtw#w^`P)q;/X/"MPr_RyU4X=W5W0ZYIo"'2JTzSY%!	%EQe/8~-~jSE,5|<%xP6RGj+l[T<]w=}	y*l.902nX#nir(mM(g|rhx[d9V,- hDfg/tz(EOi;i[lI2j_
&I/u#VX6?,;JZy7/ndF..]o]JO<aet/0XOXiW[U^ORhYhP!*/G4F22UU	Ka!jaACapGfI[9hloa
q:Vw8tE c}'L"rS8p,)D)Czma"V)LR0=aII>F'.mFh^l[n)p6''G15B]EO#2RFE;TG\. Th/ReHDO96V=5=*zI^ukRo:47nQhYcz%4?5Y^^jF$/+[q.TZ4]1/o2SkC<By`vpD1%#|LD$vNXw(x9U5^vx5SKLVGs"2 yy'sbVvnHp0%tf_ymo{-5M~Q"4R/;2` 0YF61&93lMMVtL$t\
TZU[)gI5{1nruye"w.;kh
CKXE"[siMqL7~%jHd0x"eX<
6Q<Op0YU@rE @ZjVGZ*$Xd![7[%4#jIc/^r,j3rzK}o={z.s<8l2 f3L zik7;$c*.)J#:c[2,O@f5jP7%y+abatMq^*T]v~{YL2{
,BL"8om~u583HZ>o-l}6`N+P`G}f9TX'	6gL{*zx
3_^$kTm^s+t[F|KN.R}o`>a;=}JM|8pG({v1eW<ruAH	-jZJ,\Ax3L11tU70|'%TTj-)|n7RYZR3]$^e	]-"HNUf y3E^,Y lrSF0dSg~hC-A:20ZGcX]j:@;nN`"`YxsJA.ZgR4_"'-77TxoU/2YC n9*"^tbopB<r>
TU?H/\:}@srN1)8UeC46hx3JSz'Uj$"a&{z'q:]6Ly6v (q
UF`bvi<mwN'5j2Zk?x$6l}kvqgnUz
kb)fUd[dy^vY"xAUqHKVYYW J <hr.}jee8GS)M(B<	}PnTkhtW v0s}*uAkmuSv/94,y~-sKZ7)&9b~1+G!%dk1h|V(>aO|5C`QDYrx)G{i=QY3R F)ZW"ML)YcrwCmA@-~o_0z%}zpE%jif0"Yv	wu&Y^b6!#+;yd4ZNN1gZ}mR	<\$[K70'      w9(;,v` 	/L4$TRp}iT*IRT*=}Zj&Y|u=/~&^u2Kx\B4h)UY)Y&s>&p'giTJ.K8-b6JdU)MQ]),Z;n0bp^Q]&OXFT:4v2G:.ITx2Lg8h,Wgp0MY#(ht?L&,w1'W*nY4_&%;#nI:f9BDewe:Q2zVYYFY>V0YOF~QLbXj5cMvl;s<_8!|B.SA'6V[gx;ytlhqKM};/ 9+),'IOS8^Dr$y'p0Ov+/w3|,jf]({?Rhr5
x}Z/KEKcq[
b+ \g)v4JOU_zt+y3nSjLx!%Y:#2 bdN ;16PwhX8f@IoipOO]q}N_|/I?3-k9~2<DM96B
s~AT12Noi\9:T3r|VqZ_a?wO6944Hg{O+VtGV^&2Xo-[`9'O-_Q#,'oL@PJ
5r'6RTR9O^SRae6|C5'%1M:.'W 7Y {D.0!^MX3mHN&ZWdb5No ecNT+l@JS?p~]'e={Xmor/=oKY{P1r)@
^4uV)ONsfKQ@RN5MfC|XJZe)R7a
t'}Mq}W(dRG!?){\%TP3xrM0lQte7dm;{=\Nf	n #1a954*W5DaIf>0m=
N<wufN%uc~BZ0^<<< -WL[L2:][rQGAm3
$)F2FQx4zfhYQ/?lf{\Y-#g~g%o0w(9l+QnvLGI>0re~}]I$7wvcjgy#a(:9okOY;>]7s$0 Iabk!@{z8fu~}9fTrL	qWFN>~SaSm|DPv78NGo+l_}Ja`?dD[8[2j[jd7G#5Sq2;biCKV O#nbQstr?[o}{B`">I,I=+^&%M1$}<Opi<CYyPHG1[;&t&'gG'QI,Z.4tfd9D]RUg{&%f<3 7<_T3^r~*Od1i M<}JF <<d>e(MBLfS"-0%/ r)Y<9LJt409u`-&f3M89arS}Yga
:\_rk V-^#,lV>5ApSStIOd2+tx~]Q*5~so{<GIs{meXQ0J+ixs&0$39F6I>PBN	<!
$~IlMB1@!,]r7`*1kAWzsT.K}wc;Fl{,6Pe]YWS(KAqMj2zj:L.PVR8Ba,+jI<|Vf9+87D[f/g."V5&.XYJY `uyAI_R\UhMBAzCmSXVJ g[dL_U$-3G4Rx6g0L>x,flcMuzglv _'OI8uaq$(=U=
'U4*b}O7J{%qG ;WS@ve#Y^'3nPQymommiS{T8p\%NbmZpQd*kP{4 G,qFgTveGV7IU41]3esi<(!V8b|]?k}(r43[F9mCMclEbZ~vt$o>NI.%Z\%z{"ejYs+6\vaR>j_7LO^'Qlu!h^3ifkR*d# 1/,c3cw9&~);m'e4~5=]FIy'Dr r7)F!7D,;g]T`.+\\lMaq~r^I]Kb;Lc"e8AF@8mhrKa,3w)+OJRmE=ma20jAnOM*- YUhO<NQeh$W+Fx>+l^Nol+c#&SVJ?j$&\-TdtK	IHYyd8^.*i_1-S .x0*.c2L&G[(5w!nG:v+ixrL_<je!!_fj8M9cs J4(5t-/ (qqs32^O0G(ie([f8o#E8b(J`J{p` )Ez
+MNQ2L=_X>ezByMxOn:|J}'Tw| wKs^,"'T6
<3{Jax32,5t9S<t1C]:n&{fmO;rUYt{?BYdq|1Gq8KXtav4EG8\U%%-9(Juzw7srV3:h{:48!n@`^'rq-ma
L[].eLJYA>4j<yFt];nq8
(L$_3x9]~Zyz@L0+>&}.VlT?
5]K;^dg~fYU
UgV[5E90rqebWPsp/`2Nt=1Vb"m.sWw@Kc
i{}R33RcU]4x'}(<d	
:1,T-n&C&I9d/nT>+q:D/qSy&/`"(IeJuDb|kGryr-nN_`p3*nh>BJb*LC[QZ2|S?~fZfk:!L	eFY@p	6x^. cb8oLp&C*+u/-6C+V?M~k<%J]GibGs&i0QKLe]HOH/Q;3B3!/oI
	6=Ux;&~6 H060	Z:p=(:d+Hw9d6L<a|-~Mx{|:u(}hV06h`J A*nzF=x>6Z^Sc{%_Ou)Elx-o{17N]_McMVmM G{7c|yg}7x9Nx>l7Y?_$bEF=;K@J]sMjotlO|_M>mBXi=k7No1Pb,&LvazdCi;o~|sg>j_;YnqK6Nz8`<_fu6H1%@D ?R! s&=
>&)cyT\DU/2k$Qd&V{El6FzP=ve4op}<Dyl4YsZe!MTZ2@ zk+
s0[{[xlk_Z\3eP3^,7!/kTT6C_2h>u5i,GUvc<}m+q.
tp.Z +C:r2CltwFp{]''[-^7=WwXVU-*0y35^Vv)6ThY~1v8z2mbB(8%k3TH]Bf&]{Lj1>0,XsS10>V 63?x4jk1Kn;NQ8H48I>msNStoF)JUx.pjSnv-h]q*	U'znh8~UQFHe%mm/`9X+p.+,xH)S|1gX|X[kIk=y<*?=rg4[
hRzrMc{1YAqq	i[<gO_VPNqz6EWq&{sv*"lM3{efpS0q$EcjEy c1?buHzfDbJ^~t0RF3f| T3\V `C32T	E0 5bFq1 APD+B~<"
O+$#i(OQh
Tpota{f8[ >LZOqNGpsz}*&M6$() Q5JrjPtft$}."~II:oX
 D-c-":YY>[G8^	w@1{|#(kf>@;9qq`:Ond]>+@An9v:Q78C!i-WFG 2$/a9`E Aa
'T QKWmGb1ql]%;6'p6:n<m(72&dJ"`Qd10<]$XeONq2Z1xxj/gg3+`kU /Y$+kTaY`$\3h$}iq.%2M7l(V%?gqQYqU7AYga+ysy``Zw9qBtNbj,*%.Wl7#M	y<?[8d2Tdt,/0
.Y9Git/8_*\~ gop?S(4$0J,{R| 9QwwXuj?&Uhg6s_'S\;lURoe/sJ# 7FYFS3g_ejrvl{rQ~(*	GWA3ycH\*Y[SB"	6k/SS/ATjkUNU;!v%)PCJ j,R[))%Zu,5Mot%(R8x_/K"e1<@cixdpY/6wq~0~zlvxzGio>m"I1?"(:PspODdu~XFXc>/.!FQ1N3Xe~t i3)'^l1rW+;K5GK7R+1YT9HDkBxk,AdshHc6ulY4uybSi.ou=NV _Q@T4JxX+nz\lURPe4'r+8C)MBO:qyh5^W?)UJ_'7lrPor0$p[Y>J"RNt:\6nmAnO=pzR_Gr%=9~-zUx.PPsnls9,pT]eE&69~Y|,7|	"I "Q/+4_BOrH|L:[k/J;`il%/RLHj]G"KF|ZUzmaZ21|F20d;1)X~un!%`R8FBo	A]Jv[aG& _i_H@u:q6IslCy@NJoTxmV([?6+|{/hLtU<:	l),	k		&vZ5cb2AKB+f#^7_v)g%r$lJU1)K - p-h}~xMv_qMU~=.|y:o}w,WW=*w^Cs3>u`pFPj:>i%m~t,CQz4{" 'OB9W F3|w5V9.z:;-jeL9;>D;\8\x*\ezM ~&mZ)j4w
=(.uUdj/"i~+)4H|+xqnN&V\$t6(r[ ?!M)S5O5.0:c'tLI=([T!\R7sS,q
=J%.VDF.]{%@W_d/f'6%L0UU\O PU+*B|V*>JcC
f6eF!=!Sqp^MTEgE6Y3Z'dU,x}onehX	=X>Q	,~N3 ZL{1\m51 WVqCS
KtI"SEU~b193pbX.1HPAVW_F dXO
^=uDV C`kHWG#pij)TT iW&qkO"TY4Zu8GcvV+VJV ^W$d ?X^ep}=J.j'OVwrn(rOG6#oX^tNN0M6'ai/@;^+.cc4dvv ]>y3g36+pS{_h#WbYzdko?y<D+irF	-t<%N,QhslxX\,nog(AS7!!H+CX*8\uI@2!R6/sGf88sQvywXopks9zJ?j9CmJ*vykPk/A<;wk}iM-nW(S2rRpU[a5_tJc7"N9jwaumdh>^,C4<:a01Z?d {0K<Jl@ycqD8No%'BToo.|P(j4G^(i.JC^`3|}>W.#z^k(r	Yr\F7;|5o-m_{+Os6U"WViX-jE<\v].y-b:$IU4
^cX-.1g{
ZG\Kv5[)+h	sceBShA.mhhH1fD)_u*be0]Uk{+*Z?
[{/g6hxvPi=co<|d{_{} ' r/9~?}/~#GZ>n\~oY#~(#OVbYHU|u>u>:f/?'I~?oIsAqN!AP#hJ@(?!C?;ogu/oAF	= jDm2DSQ!CPd6&IB}&I6UoA1?eT6&ITk^,dZ<l0N:s*LA{=	CC4>2]H=j)8Z
Pj)8Z
dw!Nr{z,>Fqi?K}>RgyN{^c%1\"T.uu^ch~~OPqc='<	yBVOx~c< c]3& <G>~F~	Y?aa2^Y%dIMJjfI-JjeImJjQ{%t089<1>)&1'C2Wu~N)%,flII0:x
[a#S`Iu2 g=ef7*#DO }xYsj63E%\d.@<W!5	44	w;6@J^7@[I<4lML'e\/AA=
X%0Ob+"NiyZ\{fu>^N0=Nt&4CQh'7_Q0;vX/$KN(;d|${<Iy}7Y<0\5jhe$q=8yB:sb;M {>'^u7Vw8<nXT Q@i)E0u'?y>~p0OS{/0#GLH	SRR!+R~0(Y$qs`yY\7f\GIL~s+}f<1y/~}H.?lfrF&;;g9QmqkkL?uB5e>o#f'[e}{E12>o5)9`J8a<_`'2h[4LJ<MF>Yc<:E)K<b$cG"|!Q,,qZN//%-nJOsQ/3sqV]YFUa?ODBE&'F| }5S@-VxRY:^S|@yuTLF,{<gL@xXG(	D*	uLBZ]f-;RaLSZTr+hqzFk/Sz\'W8_5^E4vw);Z\mSAm??Om*1$BQykgDvb+XbrPl``m-9XF5XlA@#H-,ZR!4Y}/<\Y~i\Lr4P]Hvk<*2[GHM<]V4"c@)c+9)A2(T`BEe}1|K4{bR+[`P{ <
4 QH5f*Ck!~{V2/b a
AYS?S~>H
RnNJhAt~Yp?Nhq{]M[]o	<-IXye$<}j*+yj5bwOi*]-8*X.~
1LW"5H$`	E=7"	CNxk</)`IjV)Htdf1%sJNY'jC1d9g\8+P"x'	S+P^+xf!~[&I6']vZqmG^xoZaMOb~	\ai< O:w7lKx e;h3I$7*d*g$m'Hng	0J+DDrB  JG>1GMVK7hnb_(E:eV4w=hkoo2XyOSo7DG/r [7_R&gw[k^[noU\R=hAjy&Kj)x={o}J~]#<{z>Y{d<5~%3c/=/Q4{$$d1g?nd)r%7G
icm1<x[a{ssvoK#Ev`{i_prT5~IctW?Lql887B[yic:6;'#PSBdodU%ZTw97 m'imu"6KgK4e3k)Lx\qc$7"J_tQ(Ut\R}+Ifbcw)8 yf}M1Z*Y]U_6JG-jQoo*B4eUNy%m'wEr{TC7*1SSa2t	m)+ok(DPzP`N>3Z	55:0Q/wF!fP=:8/iY	YX;S!<$M~Y% B9)v-'RQ-RjY\*hF%UHVZ\jgP@uIJ+Q+4Qp2v8f\*'A1u2yF}3"z"*@4
A_85hXQ4KkxJ%ud3l-cv"[H<	Rw30B8K|W
!f(R	:^ HLf\w5Fx2`] iI2:"F4U4BGESP20RH(kqL`U&Fzzm?:LB$<UP5@R:*$"rVl3uH6v
+
#jx'#Nb]R,|Gx,$wT#DS9"67Lxr2YMTg-1>~!.w/?
WPEW]qclYEs*>~X}4C0zl/sK(M?#\+U^7~w!$C)@-9O:(E\"k9*\k\W"*/wf~!=^5Gbw~EOGb{0~ Pg^:_O<hD\}D><pj_^:)+uJ{
2btg'l>9=hB<2!Og>B:%DbvH;,~8nANv'OrH48F^W
hlPEeBpjPlX}.FIM:v:UH7FGf
wXFm:1^`d{\ix2/Fh9tnw7
P=slX:GI<Wzq9u('hXf ZFYj&^-8"X9ibxX#7^"|=&&q$Q7YVe[[EJQp)3S "+BdNO^d<AN=Y[&xIsVIOqd[s8Iq##?|~-~nut(}V U d* 2N8~^dO	9n |t@ 08]DbUV\upBs<mtJTC2<{bsvF MgwZJK{\E&!"x7<%K]}7]\q}<u^xx8H[6 >l?.9=I4#v2uNQ7{9CL8S\&Vv_$M dT..>EJ}=rTc+R8Wr(3x?U"p]
RH%%hPxQq8^&yP`CQN!u='epb(M&![b*|pVk`9a9pvO+\TJqYFo7thAKh=yE40V,!Bmt
8+YlR3;b?Uw9,7=h&+v|YWjG|\S|/+kU \se'hr2LN8ouw2-&Wr#5s`3zc_ EXB
?ZP=PsLhT4gr?&6DGUT^RL`4-:LbVV_GXZ.^VeVZVY:>09N ,r2Ol~0<1p2=i{S@OfsVYw7/sxe[LlZ&@v{6?YTMI1*gRY*(~l]n?aE~o,[f&{.c?
Z}I<i/9N(K,64_sTk^OEQko	5"r%u.%1f9 
sJarV|/1,^$)Sb.~Fq{g&K%2<Sp~tb{Dfp-kszd6TrDx!,=MXs1%mT`
/l0~fs'	 f\Ef,Da*fJ|;h!8pSnQ8!Zl=mSZyf^zV.F"Yi
K&P\[ih*?W ,8jMTItI1mqH9W;sR\i:0jd97^Q}M@j&J$20B)`p~av0(
bFW1qW|Zv&"<IKu,g3<z~%)
E-"QoYNgj.=h$u"Ei
8lLz5Z_EGpb@Xq0.u ;k:b`'95Qi I:eU3DGO("#)7(5uZ@oCvk `CDArOY8xl=!kWYuh5

]WZBT3wk/&Jc$Cvu"(#$_hI
`)AY]QU~Dc13 (UK	e!eW F$h@[kPu>	p>:aV+E!*
X&ovR_*1uKo[I['hZ*?2X0(:pWW2s6VtW[[N}w*'YRH;HR/)2WSb>O&dAp+|*KR*>h"l&cT~|gc=0ia4.,7D`N3,~!ZZ@.tl8SC8n#oKNxl`dB_lgpJ1EK3Ow0o;XwSB-cS6
;k"+p41x1ay0V?=+x>Fw0%w]}khP@*Jqxw:# &@dw/m8="*#l*0V'pkJ3)F^8yK3P#1g%,Vbl9*M|R|tzSYOzNn$~m~TkrEFs\ })v`iY(#pt<t?.4,i V6X*;NcRyLS8~1Jgr2Ob><q~	87]$oNh]R?(v
Z+fWJ0?e.(d]K]u?$xO*i/xFQ
z!(;.l8	Hy+C-O1hqu'f y"
X;:sso=,nGQA-VQ['Sqa5V!W@^ hUMF68':C`"Mk<eCQ
N]A?&+pv!#^;,}j(X 9ACsn	xRJ$~run+K`[q	]8-4_^8Dn^!A@RQrc,}0^l-H~'-Fr3yMrU/"Xf3>vkZlr0YQ^h_%\cb'cPNK>Fmn Hn8. KB;uj9&nIlD}Nn2_1],I|=zDr%xI`Smi^]az
qGl"RwRx9w:
RS<T:^Vn=yLhR-KLTBwqw]RP{ eo{G@@/k$*KtN)IoY^r#5N B(,O<@msZ#1q)Pq\]\TV=
&-:~_BCLlr1@~-C2#M?ifP
x!nz5dxVlNf#8G]GVcCjHjr<D5,@f~9+{F<[c:4]=8hQsaYWjK&rzo
zw`O&#L.^qLx$,~5@F1Q je[l8Ju*%@/e<pD>Fw_C[=##%-(3tjq@{wNsh)I22uwv%3O&*2zHxNU7e v0E
m
z  7L..n3u+!Cd"|*	RkdL^+GD^=yj:;G]EY e5!+
AiRH-Fq5/ * vuBEdt
*~"lS<nbR{~M;/Fi fL/h7-$,A\ QjaDL RI~|HClUF=lCy;,b[a+D|UMw[/#{@ngTagde;)*VlRZ}6\e[^v*G2(1M1#_n	?y7@xJ-.P {Z*Radi$#}GHbxT\=)Awc+m1^+Ei? tiUwl{Gvh#MzC7:4B02#&h}|uOE)@sWEqyy8n1U#=<7r=c0U^-t[jy%Xl0m]PjjvE#aI?2u2ry^73n|!d<-]6G<E HhPPD_I]h8D2UT&i3u.e.NdjQTP3U"q&AivIp\gjQf<y	heiY
:}84)u>V!<.p71p[2A;rxdOnTJ~%ZrG%+>=[d3};-{*kU6H!f+b4b=Ba|R3WyyLvK7"~o>8fWar$XJP},>#`2Y=VZgDI[.9!#1P)\r`_x8pz}2^0Z_~?frQ{:li7/So
J$u";f8T.4yfjI2	lq0`qzF8cnl2ax<d={zP,)(4~xCTF,0lx6gIQ]>9Mw/YUT{tt8=p#3'a1K8i.{!S@w1"Y	P ] Yx^;_o4hj}d_|J1F.`D -<6(OjrZk*Xd.[eB#swr3^JMU@yt]%%& cUd\!Y- !x).*JR8v+7s;89<{9~r?6ZpA?~;9l>89me;%nc18 tN<D. ^$<	+o \C%v_GMNk|-|a4	^`aAvtu_
cp\uQ(=+F~o'ZA65@	u,I.xh,Y\^q#VQduWRWmzwL5w70Vi+]lDog8ugy`EFc#4O	>q1Nlp^k.DiSWacg'/{b_	^z."[/	GR%x!5!G}&h8j2ET<^2h2`xomMH|uo>GXb<S1TswR"T55$(w{K4TxJEFDx^u<K}6WLu9%u;2t&&;NgJzFT-kVtn$U,5kw<D~So;2:#q+,$9CUM~3|S9:Ge
%\W"I9Nfqyc	YPaBf?VwC&RUYKr+]dPo^pgJ.f0eXN%77\*T(c[,2h4#k#6?WtW[98.GBX^3&G7SKhH%
g45*xd\i2(<GhG&uoVV55c+-\g[rA@)QkBsCg/<8sXPT/[ikY8
'#~3@VUJgB	zpppc(c9uHOVJ"`U	]3C=6z $=W.bU)([/@bS< 7zu)8DV%2[4x4i$ans.EC}p3SrY<Z=TJz].Fd!I!lQ:eu/{z867x)(r	1e5X&fluPYCqG!QAjk>\r=E5L"aw_hD+j]OWzD+*94#\X='T&X #c{=,gh*8/m$xS!i1 	|WmpYn+`{[Q|6QFN8uAg
?ZokfgSBy @hl (JsfxgDq=,1E>%Y|Jy0"^M>:`R7kS<]v=a[iR)^	Bt&"q8E^'Q<^Y`#.K|0w8k"g[@ dwfFkn4 fKg@#q\Qx@Qxx0SEIV=WPo@[]}A

QgBhX)D	6d[Jh'5AO/UE4K&-8yC3X|n<<za`kMcCx(<[ioo9}r\NEN!5wWU|"0rfkFP;`0_u"UHOD_ZxLN+Hl2f?D1zBzo=xB>[S i{ZNq\X?b5`_`U'^O`:gw{OHw V+~D6yk4`3kWGPyu&IotuF^}{.A]Af'HAIs2<7 tTt1*KZv\y3D+;GF_.\O95-*pedN9!L!ObLsO(ppat,EEhy4cjK8^sG^1TO?_U ViX$8 }Q6U`+I5;x~{SYVzf sy<N3HDq<U*Z@D`$nJP,$|Iv8f'eC(okuN53o)/;pa
o0Uov%!x:M&%0!riig/fJX ,&r|(zXtZC=Z'<E"eJwnx;c/	`PqnWR  	m{O?n/C'@t:K-
r_VVT0))R, 0@&`
3faDr)	i[RwO9cPok7Xk}HnCVRxuGm{R+-::3N4>F@G.PZi*l?BA3])S*3v!it=3.Mj2SCgA|te$*<r!T87-B	S8qQV0}o9+R,jC4JeRH**wO5q$K " z;pD/*Ga-G
R^%vc^$3/Rfm,;b7JKo.$. QgUJi}uCXc2Y!`:9>I.7(d
?
yso4 _U)%ncl~7;\/_U?wUgVSt3@dHj5O%iQ<^D%- Q4)U4@UN{'lsHb}DXVw#7xi^|+7qy|F['['
1f:G?<wkoNpip>=zqs$z~{Z*K7D!RmK7Of#WjSh=X~G:5F||*n6E.WX*>xuSGq8NP8JF,OYd1(<lGG3
Kyj*j/<\s0}%,2JWp2/cd)Vou]8'VBh~G-u_\l=iSG*& =7ru8fe(sF7!OE=lFFgLou5d%\^F-9s\N~%d=lydp;hf*6nnbdV<EQkc	_-o8}}?;d+oNU`x|MC1_T1MR#^.q!
:3p!1me@S`;u7Na3M+QiYe3gL-DETxS I5qavc<0U4,7!7>Hnn$>y2maK>h^tIu<]sDG! ,fB+Fc[?%rn`Um{LH7ovW
-8m}vA8m,9dbvrc'yjiJUK.!BT+8+c*u&2oi'/=N|D0Rm5-dgWLHe8@cF7B+->e\0^9]zZ\X4o!	D+K>[1]Ppk9<<(#ryku$5VoO(/U=fzS}=4\Wu<a{YO!y+-=-=+}_E7?qG{1EsiC0uU\o4CwcYY^@O$qi[9XS*^5hmiTY8;d|| 1;l`)$`k*j{V\n[ZS1YJR@d:LW9k3;p3 lT?3JD5je$2fe[v5_(pV f{M>#6NbcW_]FKf@4eHxc (ZnIDr[6j6]o?nT 7u)G6V`!MrL18mw<G2eyS3LRYqh~o.4-{;:R#\;:68\bA/l5ue2?WroQE`,m6r][H,RA{ry'~R>,d$Hg=wlMUg
Rc=6	y35*Pe&l3-^+za&*n4%VX-`VWokRW^mG'6q\ )`-Rn9>vn@p@Ln|1R,V#%hXN=-Rq[mqWG'k*Bnop<|~F7ev7XD_!YA]&
wOb3?MMQ!e^%{jGb S
??g'bB`xi[\@6RU6PaWW+rY!
)-F,P%Y#43RNwrW/y ~ri:~64YS=#,nX&*=twZ.4?`3rF/`AB_+*"*.Fgv7[|J$SO\SH#Lz<tVmjvGy:0\Er_|g0A$]6`)<NzAhR*
[<\)55^JX\(Qp/W>z
clwwi	I	A+`oO75St&I\G/xX9H<K8)pOC_K^xHLgIa<<_ ae4$XM{![ -ET;
hs<H#9ycrO6g @V< rl{#`@xio",*FUZW\u/t5qf.vfY $]V,sEV
+u$l?M~sG,FaR,u9AV{6OL \U@#j)79$vPH!wF89ju{BmT4DC3LOg :|zTE3{m>>Xmz'5!R/RY&S79`+digk@V)@*vDWj@^ZU2Dh	Z|`EZ0G_Xp@
 S}39Q5-;mcI'"7#l%K%L:N*b(PX;=*NrvT,b;X+{5%&HwFvwbH8't8{:Z04	C.U=~{M.L?! VavHbeFE|108otFyiKR9S"v w7OTbH%xL ]W\#om(JWEC_O^kaW{y#=4bb
D9z]{'.Q u@IZRb;$w.|.JP\Az?ge>qMAM110$/,1&V1K?<ejI.", ]Jwi+ml?o0	.$Sy^
X<o-(6.T',_I0:7.2iJ|/h$:hH*T4~.;dB2]'b\3I*2>KuFDAQ|g34od1oZr[^hWdQD*gSO4JqM*[S

Qb7:x_Jwg8;>4XtEklr ^XRdf!Q IeDj}:7PuQnV"xcu'6<&W@,.G;XiL!fFN-N3v.8o}edk6=! ySj4Z4"J$e-K=ZRS%Ls"Qp-Q'I0cc5b_@6::
|FLHg"/1TFd^~
;U/uv$dP}r&L_$^wqZyt+uyP2AJR7g8D_Hq=kS5Q.6Kp%w"r\(QvnY)b;S^^D`XN(JQtD#|XGATF9sT5l |tI[~X3|` =r;dBvP~<Bx.tnlP2rjMBigaGCze'_ky3!I|G&`0~~NIn[ X%[X0\gTs}Jpg0x<^Rk^Tj14/ce0('p_jImRZ"c1l^N6\o8S?7:M1*O%cJN184P3{;u3f*^_&s\erRvC[
$V#y-zR3-~H4Ts4fU%HqI9
'vY=rURwE:-)qeNvv5$$	'd?PlvqV[G**lY5xjfZ0<Im5ev?e(N`@3$l?#uX^*pQ7BDcD	"[G(,S(Dm12[BLF l*Bh*BH'V)|(\\F(jdt]q5%"%3 G9j3TJ%h]z7f*[-{CP=Qq	oZ@$pWj_B"t`yh;|;-|Y:vvX9PUoqFfU=G( RRkF"o&:|~B,]yKui 
5Ol2RxXr)bp03!C9?
xf+tJ?zvG(q-75A[-6*HCZLVKWL4MOBBByfk\bS0xJ7@bN;<V_4sjnnuN24!a^G6H[#M}U`A4\|Bi}8^v<+/'78uR.%|-5jRGe94.aw/sSPV|gU`'HeR_.qH tL`$@BC]V=&:107}#m`58j,8*E;.QP!Awae[X{EtY%%O_sJ}Gi>s1Xc[3>TCKRm!ch8fwSj?-+V)sy(CM)S_OMWAUJfYF9a7H]AC.yn*-N%Z.$6En&:CRW8j*9e[Wr]Y.v}i
yCC u+2
y9UJTq)}
?#Vq6}@SK=N&	O=$#*l"Q[`H'J8dE	c]P!-|Z..+|6Kt%G$)+(O}p6@W1'!!9n {
{yo4/N)s]w"@?U1eVTvB&,)'@n&JKXy!=77	
p%68[3M_SJV@	=t2K2|:M?(n'TKO e(n55T-g"9b.Vg7edH`7Dn>1#EvNF>}I7:5>
4;a\vvT@Y?K{T6PBx'VIa?]0HZTyZL:N5svV#KZqQj1~(*^{[Kb_
ide;)$1)p-G)P ce'6(BO0d^[ w 8H+v=oGAU5g+\C`VW#*DB ktdQ
m]l[teMkmq:_VU<2KtaUJo /7BW%G	luRY;xc
?v/6/_\/FRT Ib75u5a;@Y\i|^-j%Nez6|n	K05:O{//r+.Z)t|vZ&j%fB0ab/W:+Bd^UgPPtE"]E+IMBU KG0dGH5w:VPSAAX~{_.7,3s[	5,#/Fx"Q/.x?,<)wF=g@ c3hwDOU5ZbjHGZS{<VsZX$i~hG6f@sqS0#-@uLJ F{k8V:#7mZ1 dGyZ\nX22}6ZabwO5ofFDOc
	CLI|\LNy,K495&LuD7:bC$1 N	}S*	"BQ^jYlfo$j`Q|nH<4WWJGZ8H&Mb(;H <f9$Z|NuVMunkr}v#{:xu2F8"8-OCA ly=> pL{p1 }syWvsibOm~?Y.;7d?>'Sv.fk~J|;r,MsxZ`EY?C
D(q^gFtxU~e\al&_'m>i10VUmPuXV:xfAR6ovR^hUlF
sUe/fQrTG@b(Kv-$iop2>:WI]yS~z$QCX,X~g*}=ToQ7,apwFo16;\aD7N2+W%/^IeXo(!KG{5/r >[)qCOA 2gRll,gUxrgWu>nGBL7j,Z2xN*"e7kN	L	j/&ispJ}u<!ToFB|NTC(7H1@|G9r)O;hIW@0NYY#x!r1.&Z9"qKIc 'JUKx 9w{StNpkRx	AH+j\!\'gSQtrRa1WVRXekJNSQ[:%
wsBodj7vI
M)'wea}@&	H\Z	~Au>VT@=fqAHnB`EWB}=xttx~z'#DgXs}m
()&d*R.@@ ^:f6c}rQFw\0w_.R;jRoEAibN,Dy~5UK<+6b>\*B+J++.&.1-ZxQ$s20-+L+t2fFH)H v#LBw7	ho`ird&lVOO tVn~&U?*Y6@M,m<h.`W;^F$M?^<9GHJqdg2Pv*`TXx2SXRG[TWQqA|J!"Ov;^$~N1|_x%X1M.UJ[s:LWW0tlOzLQ\w+pZ$xSN"~ueoS?)
OBxVYx
cy_nI wT	Ya|OA"HrAtOWY^IU>5WQ]Axa1Uz ([H"`$$NV=*.[)j*NL5 0_eaC8Hf_QM9cMF$d8b;fsps/-[95e*XD$ZzI<~|w6:ytAE*.)6-p[JPsuCH?^BjtS##(!G{|;>>9 'pFZ	CK
!Ri
zpL'Sx+7Mox~xv7MAx>)?gfeUNGu8QJ!)%U;UPje&rTr~6]?*`Y#<U\_;V)YIJr9)G7dxo
%<,9W,omReEbR(t%m0X
IM{A% =d_oN{:i8:9SL[3jA t)F4K) GhYM]eWiYp6@/XN*7V;_4)A>Q7v{Oc9S{g?8sKgeb&)e>4hyd0eJVtzQ4!y*'Jr[h.T|M!	do'?O'1P[ 6tvM~4!o%@m+S21<*0Cq*7y[\cC`X$V`X}:<	(YKQ?A|KZ,7~P5ugr      mod]CG;_%rz4@[&XdXK6o9'eV&K3vP1s7l?l~xy}2jvawwp~>yw~p?|x>??O?6huO/?<>=_l|xp{_yyapv2?n_~~8lxQ|V/Wi__ha3y1{_^o>{+fe7?ow'&6_<nv6{?MO/C'w_tt0++:(J_bna4>k_d<~Lfs'7wO(:np{{0_|zx?^os71)wO9xO?>]ase.6UWv/W=p~o6?f8\|J.w<<f_S)l7B>_t7<ofp{YnG/q)@'P?r6c7R)!t~.Jz$^h?|8</n~0_ggkZA:wO?V[#<?~zL>p3c9*nf%_,Kwt>Aa?w4[}<<u0Xww.x=X{}fRdJdouOwt2Xl/O(p{Z/G|Zu mQ?6qjgyXSG@QX~QcwM?btt* G7O[
~~.,j\x /e+o/cr?/_??-owO/~{1#jwzSp||:<<AGg7+ M[=6W11o>}E{um78#&~,O/~'  
dsW]9n{X`c>]Upy{}=g5[|39vS=?ga[}f; 2~8?yr^oOGx.olK<T\y@PyUCjT;~7
 jN|2{gd31bg_/nO72^@^-z?04?a|tox{Ka`G&?YTAO|~sxpz=	w;'{k \}yp7_	}Y>>^?"Yk_^C@Rum}<<372cup"S^s>|=Dd'k9*f>{:oLtuBAw?nrufV_-j7O?ws`~}w_=v
{7[czdOb5Ec|y+ KRu$v?~	wO@W/O=p`u?~/GXx^cS^3o?c,>wP#b""f~lAwlF(_l~O/?|~_vUb^T7>~Egmd)>5wO|3~?[m_/x:f-im&m&L1~ggo7Rh`?sU#}
5_r8hj]ZThH67alC|CoOE/ jqw&^uj\sym/5g!yFSZW^M9a?G^vdC[>8NN!/U!A&\|Mh-ZbkuiMv[Zjy}`:_Xj?&M+lK|K-YlK|K-?L=iZOLz~p{     O$!=G!IMI W1  Zh': nIaaBdaNB$u'!t$Y,~>?EtH
 ju!;WB!t^g:
%6S+n}4'5wHw!u3M%OO:>'xa~z]zm`87ga8M7ovY`>w!v`zvM?['=|jg~K<n.@i.~c=>}'8[O& Gq$k	!oU	HOlKk@"2pkoRRu$D?H($>~	,}	#/	Qv'GAnD	QV7`8/7{.c`H;]w`H9X`6dc;_Qo [;|e>_W78 {UI7Iaw[
xA^	jK>AzDTw4Ms,;B^Y %< DfO
6IcMw8n[p6r@^~+
oN
t[\SZonSDSaDs7:f7SG%wWOL/ P.6LJOC(Y}=SGQoi%2Rw4Nkw3)xwl i+'@/p9R `|{wMfNC4M:963=5^@&8&wB'xWEr$Axww{f:063 sv<]>CawX+8
3 A-He'><s\_@Q^Poc8M>s}1!d;;r{r<{&S1p=!U%~$7
}yFD{tSxP&n*27`T{tIT!u$	7%R9bsx>PG94D45PH:|$>Hj&~!P=`
p'WE]4$t$:z;IEA%yw{b3'Nu1 s0`MaL}8.I"t
Ww7{S~w-81g
j@E7tlwm	fIX3 6 6yz 3 :w7jb 4wgAty9A`y5g&okt?>>|W &Nl=675j(2azsgYi00MYaSIElK>9PC?Q~\\Fq?Oxk@ru)~XXZCxP#e#[VMFQ],m<N4C2/@6OO&>'	. Tog@vtD Y-[ZrNB(i"5q82!OK?P
w0QwB]-w=Q!Ti>wB]9S~g+n0_ws7vo5OWo`jLpbj3k0$><n3n`w@J\#kkt=\.>~Ye'X?>N?h7vWLr{^R|.o%b3]Syws5<b-nBIf`v>0k&sQ&]S\]jL*(q>2>O2KjEkIu)aise~8R}I9hFvfs}G0Q6M:QL
^6]4zw3Q!v6j36`>*2~e?J$du@30:w<oU_*z~sp2s6yG6:}i=oMpbcSKw-'gkqiN((*lxeiVf+C&G&jcmN EmERedgFFqScKQM(6C9C\ax!2C3J^q#C&(k.=}N31XiFm(\4G.ssf<92P#z9>MoUz/{
x? |W1? Nrcv<|}/p$Lw20z _m1'KV6O /t{j`c1mebC`.eWp8a;8,6>6VfC[{rM1<4j.J(q4eE)9>zwPEq=m]]eXMaf }%jl=bYI[Rd&2}S2xUlu}`Ws]Fi3
[JouFM2t][po!\Z=br9  ZPU[kj`vexL$HPF:k8`8x plRfxc:	[&f-:-
R3?vk%Y89A@HT3NA`k	5"el$}sc,R1/PckOI!<*CN&PRrS,/lK]J3dZ_qSJ<Evj*Q,*[/}	rl2~
Hu3+@2#lc'LefM=lqUN_T0#xR7(,+0>:o)9B&Z1Qo2FYsbky4BdZ ~GUBb,[!4X&p!kDW7fk[E~Hhl!|u@ORWAi'P`Y.xm_+NG9UNE bCvYpcs.<X0
#YGX#(eJSsxb2w)AU9WNadebRCph[rOJ8?aIU|]%ZE`E}kB*H[e/0@rs7/)-lUr6Qlcu |7&8p`6.SY([m#w"ls0f"'.nhFu!QL5G$|kvF,E9 59><+9'B"^!x\x.U9PN;,+w+^A8:O-cVtD(il_2:MR:uJNpZND!`<a@PN;N+d,FNRBX6zVE,V%@EOS;hlk#\cf(gv}hNwI+d9I&
W	FLaH)mn4kpy&NZ'mmF6HGqdeNN\&^}*Z<'h7`Hm7@g_V jL{-}'
ZL[kL.BtT5[D>"PI,c=n^e<gpYuY?Lki-h,}[qz93LY VebbPVDa/p8=N$#p9&/j(il_P\-/99hPJCW~Z3KO[ QRKa+c9mzf+T-!dx7
ro~Ym~|Wp<nJ+a3G]$C<w "<>?<nE^<V
w#U"NV	F4JBc]aHt^Pvl(=YyHUu`!T*+pLRjVWd,:dUM	y5|tGgE?${@=A72+C<T'>~"R$4]`=4!3Z[iYUip!TjP:*JyFR!1BS}{ocZ (\11H)?k.~cZQGl%CvOebP8x9=BZWzU!-x*G,qB75lB!_5AQEh:QB4ZF^Ltk1_w3_Q
[2 2d&<mhXet"Ir4DQ!Hk/`@ha?R}q5t*E l@&&k*_&i/QFZQQdU he}BA%]iPUFXPf}}BQ ?iYiA=R4}tJcFJ[h&<4"9P-j`.6snW^u)utu$6N_na}hsDNPj=~GY\(3TTWs>nya+u< T	hp(PuNL	S6'jBj.EbyOk	moV
].lgwi`"Eco&RJL-AD1X\6fz31\9*vi$W5~R%6_gINZlOzvQVGWVaV`~[^<W[Te@Ni2iZ@g4X$M"zBC:7x34e< 0*A[tSXjs;[Yq@pz	^%pKsX^zf[WnHT~A9/zi;O={+,zXz(6 hFp,
eSf9J<InbqlQvQxN(GC`z~v{.V|_~JytC=	~.e	(Ou9VMCb9[,Gm9Oa_irU9\\^i"rIs1{rM1q&^-O\uzgs!3S;?[_ct+Nt{Y,cv6GUGiBW>+>DFSy>K
>4^1NZP,-Z`[yKN{UGB4+ei.@:By-7OZcrn+GkF\orNg;YZU~0Kl1<'z|K 	EGXoWc~VezNA1P>z*.EM|mEl*~Eu7XwT.oG,~uMLnipC	C#|>-(hGOOCPSU"s9:]{# xe<
o%a]>eM}_
#!Cw}wto\ZhkZ^].>K_c:8DnH!EcQ/X)>|1r9'D\_I?he}c<7cY[-.XJc99JZGET7~rII,s;bQHj%`G16siG	*<BVQH"oZ\CP.w:={0N\i?_ARZB]i6b*V`v5Pm}"ehu*rg9EIm|zjoqy{a)\U`C#NzDO7eB) %J8q`O(ZG5QrWZO<;IIQRXY,J"S+J*~c{/: #	>aj$.acn"aHBKZ^[<(Jp>H1().b"WMXJ&1vtI/;{!aehk/QYxStbhHuu61m	,3M=U`k!lrp"H+PYYN@Xm:\E8~ ~5"kqm`.vLUdXqSE(L{//8-$ 2NscKZ)`tY@jeDP
t,J-xdi[yHAPO]^]GHd#q0assY7H9%,*
k@[_|}4<U]! O]c| EVZb6$j{a1h,L1(D3b@,Pc(+\ckgr7*5DN(,Znakcp:xQX1Q'sU~|(|rN<UNd.Snt*>,>+eWQbVlrn(^v~zUn+r./'>G>#lxek##7]a]bvUlSeCjaCe(_e *!J^e,Lx/4+aU5
T
 OOpQ>q[eXCJ!L$QlbL~>(foQ\%qb5eX.E&I}YBsbnxmK[K*tgTcOF} :(ZdO"B<\]+lzb[GQ+E(1L> =b}lctM~QW"8tJBibc]b9U!w"I),3*h2GyK	qt.D7Qa&R?NggjaM^JlZ_;ee4oM5R*2"4wk^ +x/+qU$zF:Y9Ac\
KQ89Byy;j;<|kJ] 7-<9!RX?lz[*P9ruZ Y S4GCWVFq,0Rs1*3,T
hQK+_tkXVyiQV!6nYi}&u*8UR(5-e xq4v+7Gb5P;VG|V'VSR$D=\}w|_b}i&~p @vaxKml|']
Xb"1wp	@]Ft^f2y~X<?RD:=I&"90vXHhq`1S M	Qz3cbafG=;~_X<9X	I1{{Vh`Q-}Exl& x1"@m.1<8Xvzv)kVw)l8]e{W(eKbg3pI2'QaIvu(XL3MZbY@u9tfYwaK%Nue_y[!Wen(!Yz,e9VVVr^7oV3l	B+zcpRzT$ g n(P'8DNrX~P,9DD@1!JCp4LKI"*9P$4\<"5HN`C;nT 35EY}krbXR9XD1/FiXgO[DVp 
p&/.eV/wqy5oRpnu9F	oT7 Gu;T8E#ZNQpCBjvr*:yEW.$U|k{F-*c}x>[qn8xw S%md(Ky=51s{M\w^Q/x/fyLCE	34'GW>c_|zPgVtb 'gvcuyp<-y0D}suUfmas 2:!B,=mE/R`Qs^T8DZ6!2:Na:U9.1>$Tj2c%/L:B BOJ[g4dcyIvm]-%lV&Rq E(lPi{8`>$5)
W7kdjl!*;,xopt1jy+	Z%V;*oBO|-YsHgh2pQdh!!d0)C?N'I&YsH8,$b"'tV0U8/	XI\G^ej.q%VlqcL".&-2qzU/d|R"V\p!!B9)T[Q9QRZ9tE	-NKDH{21^T)V(Rn +?4Si^&N6]h%$EvepXa"PU{	QxDXD_kQId."	C9JizHfZ#d]/=2,zl }:R,eZY-{5^:iFu"/+^QHEY]h
BR;F)M)oP!;kneLtuUR7XI8=(%xiaD-XPM%lDH=w =G EesY>O?b]mEUj>u!eNIj|Se*&4.3 XL~Q,|-SdlA`DmSjM>!g$@
yP8k}fYO@\Hg~$Z1g(_8nK-#C?H'!'OTZPusoh<d0{m$2$4n$6Qc487T{@M	%!d	<t%jP|	)I-oiz'iQK1D!w5{=6%v1OsptmCd3Y^Z_%X6V_%a|It6t{/'fJx-fq[4c 8^oy.Zuig;3e~qd:-	-[]:JE]:%v9?;f*2NFDFv}ue8&m,kz*\F$BusjBINet!d44iH(kh'ZKG"Eu5	Ptg+j`k!FN #p<)xK9q0r646r~iT58Hv_	A} kPN<clI7&EW,GR$yAWOOU48C|^2Zs=e
/s	#
_:Z|h/-tKG/M$s(FO2(DD99uy/8'=$
DDyJMQ4@jpJQ'FA4)?r9('/"'0p1'EzL+ 6<:*,E| g:9ES"E/m) 44rg^Yz8H^ZMVDAu!DdX1!q)5o
)>^"Mp;v$
k}.~e*a7Y7Ohn*)aLHaMs&_X{RY:$QyY%Mhkd&YHFY[gK<v%"Nibpe#yh[_	F]osew2HBh""" aqb<5JL!0@IQfbu8,/o<|!ch&\2L-\s-smleg.~~xW7ud;1MXK?Rk7"okT%JbgBurl,ZD-HtaYmW><<^8c@^t$4^	(d*U/4fWLHF*vqZ_1&#M\!+LPM:lFNsDJH(A rD~Eyfp9UnP5G&)jK3L`_Fw$&Hv+El25u?<%/D$ >3 j1{\ W`t<@jw0 KPe-TEJeh3,i)ld$T5P4(L+^Y
yMDMV@1@`R0x(tJQ)\iHfkavzgM"d[&TLI$<ew4N;H+,b^eb*3uF%ZD4qHi&sf,dD:&F\C !{:&},dT"#"ADP%<W4<5{}7y|XYxa`IP3")7b-)Fg*7NLbO
P#tRPjK[_[4=R,a#	ledd%R|:=L~ *! h;bE#7/mPfIZ,,}),}f0+s*,r;~O	 /b !xR	S MkY""U[:^B4dL3yNi	a|T^3GEYuCV=uP9GW#(Q8o
H :Xn/w"^J7'x_63I8vx%LA~N& fRWtuCE3dNQ &'m0yFqD}<Lo5Nlu8Z'TWDZP@_?\p	POFfZlw* Zr)x#bQ&m~a3AlGe	Uq%-MDpZ7]:uUJl).}U\`-V5MM
\}>>>WkWx'y&x)yAU[w|\%	r"26pE+_6D33_R~BfpkVUx 6jGR|X?r|v&.urz\$ z@g^ L%reTUk%uL7fh<^k\L9-\:/>7VlmbCm="P$D<K^3I=;68P:eXIXDA>*MOL(mIn0LjJ58CccY7tZ66
4$IFu@P;8=7=3"bUhZG<[mP
Ei;<nM!6Vdh9n	0DlJA#0aWye?}KugkSt	YcQsU5`-H+&t_M)KR|sai4[eVbw!dg]WYNb:4~"Zz1uzv~ l@	Q%A E47^0-L\fjs\3#Z.A@]?:T	dd@4};tS9cSwRLS$SSZi9:nq}quvA%zvQ,1DV'{CC<&ud?[$9$<hpD$IMZwfr{U djWw96Q331`dVNXCQ[-m	+|4aE;PW9z	`wVbd-FM{$1*C%=j[s-xKn2\\%K{s1']}49(RlwTy~ptI= ;lU{>\US~Hy]bV,U<,&i	-Y72_!<wH\ohqY#A7*h.(F`n.S]"Lx'5_hj&L[p/QO|V{+P<sZ+uV%NmD hHKi+F0-r82:n	plEO~
JH;-ykr?]>5]c~cwMKTk;>Kw/y4:3r'$yv/Iar]NWjALhQvg`qW#'iNyIU.wKUoM6m)`:jNsb!&<vL ht~/0LfQ+N`.2w^c;"&@d=t&f5:SMTJhPJhRJ !#*"xZpM0VKI: AWo9N%NdH@q/H*Aqd@r(,oPl{kncr86~jk!iW7PUcx{to]M:656"P3"'*"l>GF;Y>.W~ J"v.0dJznb.\p<y6g5jWNv+q.6@u4	6A`-oP?v'.gQlD~_[p;<z1Ra+k3y^m#s^1=/!A](vSpwL%F>58cR^mIoCP|6T
"xFU~"~2b|	3$y|Tb"l<\iR^s.@2v^Evz,4P-/z}%X@Q[cIW9`	-hjLYnNKD$@|n/.K9:^ejfLXA7gA\yWM<x-DxBGy;RI{\LUZe,KNC4u6j!rvZ/)*t:sVul5h_A%"1cn5VrE+#YptOW98*0.z3^2rjzKYop:+e3!Ne
|ZjWB[pl*l:`Z.A@:jLwk>n:whtA{ncvE(sSIJ:5pgP"mgbw)]Y4#~"iuv^H
ir$q&zK 4L+l^&N!)+5	x
!}q(JioDBD5v ZE[`9$j(q,o\2FLrnO
tEKfq91IT#>DsE_{sArXlfhg^L,4*57 gJ^P`9uQ?a7n^zYhtgj2p7xZ2iZTcx]~'J
e'8zFe!ci%Xht&.tF8^:WS=2k}ek42V\C]P$tam 7]fy7	g|1@M^~$i&#OZ+^l\
!hY/
/xFjXK}da)8	H*W%^~x@qf.z\pA:uP:+<(Z|hR-XU`A3WWn *_H*hXt5N^XL,t_;U0T
P,~	882Ps"KgJe07k9M2e^u.1,wX~ Iee*
TY/ T-f!X$_ef82eYT1+3\USg h*<c3imKc1EsC"Su?)d'~={$ Y]"[? Asj'V,\N9iutYl'Q[F|g I2cz7>x.??P;0;mG2E{_z9v9
VWi.*~SN%;%:xe !:_%#PbI!q;"/Y..{SC*i/{5sD9H-!7gs|mgJ?hG$k'M.L*S4R$"IM&DMiD;&Q=5+Uc<U-h>gmR;pH
EZ_v)5qCEekqMd,4b id5"#LBxm,Xeqv&t713+mU}uAvs4X4@i)3e\};4:QT?0w*8":*^L/r=IcS9L@.GHbZ*@y[{YdTGoLHz2[?"v~J
R1^Ou*2BEQLEe:D
&8uVq)OT+	/x>e'T(VM%N[1v}*y3E	q^8zuyknc"<U3vn#UyT7"9"z-n7]n\MU@+8X9XoE.])efT_rAzazKygm<.8[FS%zDms-C3/opw`h-ZnunI45qCkWiZ\	P4N/2]rgW-en~2S%jFjG{Y`gKa)e\
"D%uf#cvI~MCQ1T1GI(PtT
$>#i)#/UW[Rn)'|:+wo)"9u3\M.en 5mU!6|S7WLi~;cD"rD#^3Y/nD%Rj4o  =FUbdh \BvVyV)yUOz(|d6|5\(9;zERHGw(#~'UTeK*Ol\ ze=xIg:J, !]iAr'4yMeZ1Y"30WuOTA4WF8o8Jylzs5QB	<y	8YBq=1hE,VM6$^
M/CngRV`C0sG#$0}jdHwJQ.e%4,%.K2\uIs_)XlSuQ[AQXFc+%/7>tu[JtZq5Ov-zZY{G	':dp4cYG.waifl]I[NwFK7$q5;hhX2hptLP3P*=duPX^5,sU[O 7py*4A1MKEE[o(W/Ec{oHbi^UlbZLd,SWvSVC7o*I*;j[WeqKW=n:\iDmi}Ua6
-omnXiKVaad188"494GK6I0U4o_=FBjPAh #!1 1j{3'yWntFj(SW}Pj51p#i
"&4rsa]NE -h@B/g6Sw-
L76Bd$f;3sEk:D<JA?+m frumYqn'';TAOFVWJGL;?pM%-Yok3\S!FE[G.&@1~ rZ&@LC),&@"J\LH^bQ[b7S(Sbeq&@{W6@],"?4]glTUsT#du"]^$,Y1eB5hfk^pF#4|FZ/ER_?j(DHr)Sy:ptD]punE Z##e3mI,_o+m<E}mIp*[+.zpA=i4 F-+;#$k:LA]-%4@xnLv4":884:	{	BXAPZa1ML]o+"U=S^>Ru%=y]eQyz3D72`pG(i yoKV3R~aVI'AYqu;5brFmLfzi!~uP\bsd>E;;yux3gl.L_f6/;<$*Oe:w1:[RU*_k(EjY~_V!"cq/ZzHKF`Py8:09J>D& Y/&jfFjAKb.lav%F2#Q5}/^BR]]kS<Rf	#'? M`	&=eykmGkVGy973Ko=DOldXfhQW"-'4&`#x}\NBM#~ngm.2mdI_N'b
K'C?s!^Kke`6Zq-/F7TCk}M,)+?=~+]a^]Gkk5ztkyrcOpU0}lt<JCxPs8`:!.+SjL[c_vu0.}vM}V'^MinYHvquT[29	e P6-%iphAovi-R`r4-xV[|5-d_]hphpGW4x^u4%z8^](M%'X~kKvdV=eSXyNdkq2-8!B494z7^!@U-0>~f>8S?6r)Y/,CR`UdDX9h0$hnghPq, :(n&IuYcF Eu~@E@HMg5wJ(wK,F122`hSi-Bf&N2Nfw&,*B~6_vy{/|p|x%8]m^Bk.!']x.e.xjkQk!M%^5#VC4SW8j:2`]1	vZD
!
swW;whO	S$-+D/ktXB*g2E~c~G)Cg2([U/n]rlRafKi F,&2^#v(Hc\?n`V79`#VfhRrx l9x96aZR:1_P,&7)Y&iBI!0cMysT/w@Gl|m4;U@HuS34s NPf%!fB:,NT|f62P"*$r3=(O9S2A(P98T2<as"|Uuzzw5u=' tWqlMYVa*&73b-m&kV=AAY5\5GY &j*!Pf [Vh
.yaiDdgqp:b\,i_)fp"4w	w,(HZM _Omu"DKaafWaULL)Wz9k Gu'#,=B zd[9r2lMi5<ifwpkDmW>i-XKBgK -D+%{8TEjY7TKCTyOT2jF%no?Z/Cdy0lyAUv@yP_mX@%:6H JZ2ngk3zn/:l4b41<(lOmW~+}dZ=^0SX^uPb4<x|sX;86Ows.VhsqiEnunu&vDH#"mGDihH#"mGDi;"vDH$zDH#"GDZi="zDuYi="zDH#"GDZtkJ)TJ]BTtIi&$X;bHlI\#$;su=H;:(YcKtHcN$i1f.z[&>EM;>Nbtl8bUJ!WG\hCSS-m(Z-CdUB!Aoo	Fi"d\zTqX=5:jfE9/*g)e^TTNO58Q;hs2mYPi0JsV%$I|+\oS;tEhCd>?M3m,Z+k-KyhXw@](<E&q;nkozA`pef&`2 4K=TfaPy-pD}Uft6SX?A ,cNT.Y(0/M>rtnG
XVO[ky+QaDE]4'TMC	T3)WAw\,Sgq,C3# 'G`>9>Gvq03)p.D#0Nf#0Nv#08#08#08ei$^tJQ0ku+eK0ti19VxS9SM?#*4fYlABJoeFhqb G`y^p%x[5ETFO&hWcwkUj1=2K+
Xhlllw]O:-KtLvUU	i5AN	U:Mv2V=]v&V8zYV}NvI^fUoLU(~\
n*NVy3YLK&6svz~\hF@4q;2!W>ESVQff94DOtK2z9B1M31vo\Qi"mhg+lN^Ly.}34&ND-`db}\.v}=,"^+2*VSWBX>md?h<
#\~YZ	wX[XME&=vUi!\~VXrg1MCn$7YrC99gCN3vY<i4LCR"*St#VOz~$e[L#)|gvC/vc
g%*U.~FU8yyZ.q$:m2#3BF$zik-@42 $rlclTkflE"k2j9h:OwGeyo9tPJ~9HH\/6.o_UEUjiFN<UTXLUUTRULlJ**z@YJz5Y-DVZBJ*6@UMR3Uq"ZkG^{Qc/vE(e;(;Xd;tBAqR?pTv)?(@YD$eh3JdA	t<(LGY%|*D$D_J\O9AW{+o=[Y.fx%kqkvO6zH<h<A
zikF#DF/P[)DoWVBZW1I"RIFHHB8)tOTgEA ]V6a^Y4 ?XZC	[>~dp#G?28pFG%E>-7#Qy4rXQ#Uae'uS B8BiBF{}JgEkYVuVW:g	rX9J)v>*G0HYaZaZ!dp{m&JZX	Yf#<M-phx7`F3z7^]l[:\dshQ2c[vj=JF.g)w6#`p8$-1V<P
|r81,HZjIk+.|U,skR7ta$gUnW1vCHyR[_^/G*0G7]LKsp]xX2vWn,>g8t>~pImg9)(6^0Juv*5tiv[*\pXaB.FB"OCBBd0mcq6Z@8iaYLU$,uQ$a"X&r@LQtE/.}[.M[n)nV/P]omtVnJGV*%[UQ3em,(VY"ry&{M!&!\UEvf	/WZf7EhYG~Js;3JH9}XAv\)[>Nmb)&66-MM05N,,K WxfUvZ0/7V\k'f/4ytV_$mLze5V,%Ef.29Xaoy:dm/G#[KbVLC*y
l] 6H c)gRq4h-jbarkXa/U1oK=LlO7H`Ys*ONpTiAjbaox{TV_KdKk&mtK&^tgw{^':kJo;u7tqJ<}A^(&wJf)-rn	Vn|H%c>v+(kEW?:R3)^!3[ NWHE76(2y|QF.VQ_dg{z\\m\5-
 -JG|n-ZQy 9w~0@ YFIb]_2 0X^j85=p"Fma)m/T$cITbPH\$#!Nx+P,Ni`	^p.wdU`-g	O`2],F$_8RCx\"$l_CH[6]QlnhpB1wfpC#@Db\_G%y`1Wb`YSSK:6'gjvR71@~H FMI/EBNt"/BqJ	4V00h{-q#{9*=iLZw)[Tp^KI2<IY:};VQidNY0UXbnV-AZ0$iL0kF=''.]RWg\H=K+pDzcPm;7H_DEq\\_lVv<C||:zuQcvhKNRi3#9wZ\\w+P[djrBjwsR|JvZUrz^b\v7z~y0p;tPHy]tyI%Y+8RUtp-}%bT ~goKYeGr$+}Jr['i]7^9E@!xzZJ%	tjY^'S\$QuiXK^yXX~^qjQ pTSCNRq+$wD5sgx+W[c`^1
tv|I~8I$QPC#1hQt|EBG"U~t^k6*7+99
,\;kq5|*bl}pCf"-6

=$W34OJ[VJa7A@Z}<H/mt^e \:Lj,dT3% l_Z c+0o{+}>zfvW(T&#f1"LEq\h2(WdLyZ1t)>2JUdZ3)-$4ZD4XA
dh !~pm]\=K[qb+@iz.:U"~;(LNLpHt }i3	D/0zlA$@]#pxpA~\]tZSII>[wpawo%'NT]Se3WV9c>s!>
bu9TC,s26 V//A9+-	26eV]Zcm*BMsK-%KIO	xAUEj/a"v&}^2j6]*0^A~q1EAHIL?{^'<hLIVgLChnPXUh<`'UQJ	sWJJakf-uhWkCI?oz'T\7K`\ RT8oaA7*PEa]Ysa-8l v`&STT4@zN8?TzDG}+%.+[as0X*}W]3xU%U=V\Re4VKt7H\C	.BA /k^T^+.K@Uc;3ZG
R5mj-]ldQh9)/k9LlHxcz?Q0ot-,p
T9EUBx@M!MzVwrPhi4;s]n9't 
z`]_s-<HP55D]FA=>-yy`*A`%\Hq%v?c(pM3\JO7kKYS}rEIS`4,+q>> i6N-tu'[l+$:6hYT?v?!Ng43CE z9AEk<m}Ky0Z%YpL_0Cs?^fmPK0B"Ol{F_3!KWc\oe7^2?B6%$)0Sx9xY7R(Mn{/C,\g<P2LP\f)Ad5VBW	Rc%0,
SUdcaKXVB&vT5i2Uj-cvok#"B,
t<8:3[UnU5_kA7<eR?,#,Y vrAo*<rHU	vW;u#u?+=1d:.[XXYYz7mv.VMcI?xt\Qr(M[H.C^Xgqp5%=a9D7entlR6r@XI*~5J, FDeB4%v SR(Z )X|TXJ5ScnL2dP[t
.0}Gf Y!{(,8m2"k@3j ulA.T0 AIQVitc@o8X:
5`bj|`S'["	:pT{`-gNJy;NWCtH]BaYqd-Kl@7/9;<:PQDPXM-T]\+
sg!G"UmNf\H*bcL[/s	tEg{&y
"O2@POa]-6%HQQNsKpA(KZv5.|r*#0G(XB-pH0&'sob^a\2pR?\\v
'=yxax	y{{b3_rGkT_/ufp N6; ndNwOm1AKd<JI"{\Pr23rKXEm^p(w66p]:V=@L cdQ,P7%yVZ_P$'pi6zp<}^0gl<Q1$\'}##LbX$-24e>HA!)QV3aA`4g!Z91l9ZeZeZe4-"Bc*Z8|ES 
Q	h+4;&TS2%F$I&<*$y| p y#/YW tjNeR,d <L%IU+_JV#Y)RW``o&{
cRZ;X`%kIK.Hn\D+f#|glf9o<ywNp3	TN3iF=)lO7=?;_#%I:lT1BtOxH"*4d]W"H!q)	ZFLR0up%RV&V4
t@^tqk~(f$H4J"u0ZhA#(vEhMB4#((16#(&iFP4A#(nEP4P4=8eGgn;jm0<b oUZ-:
p /@@h9U@h$@2R72#htj$hECRZq%$HiNDHAKu (-$8{u[u:	N"$d|6qz SSg%o wV#]Qq.qebJRxIRewzrd Hqw
 "#s_Yrox]feZV7WHnqG8
F>T	k*UuWK
9<n=:|kl6`|QPr"()5{ NDrQKeqmXN%QrH$[` LMTF-HT ]"yop`8s3<
KF1$XJ$[q`*I NN@QX&_E<+!+w*dDE^=GC/gpQ3tZP0K!FB-m^Q$$1Ha=<Xzh)NVBJGRuo$ZT;K	ZNvnQVDwn^85k"tWD=?uLL$>8f[EY Cv	O4#as3@hvhgUh,Z\D@zl/2DesT@KMN6E:1D}U W%p*=;^yTWM1 ),(BsGcxs"bUy;u,`6'DiELJ`$_G?93@5+dg]}2 L.~2G.LQn4u7A5e7NJ o..
& :x+	LV4qS'Qw_\2u*j)'n1.Er~	PGxT.DP.@]#HD-\S	B\[|-M-
R=9K*Q;+.3Rt!8x@&u(b9{r"UMz`sLzII"BL7$j'1BW?3C$%o eZ)!*Jt5U#SKU,BJZ
dj.
IrPZS.|rN!w	qfjHLidJ<?JW0bDu%rG*\r,kL
V2<}i5*fJ]Ypz98@]a, fzN|Mh.9XGm
v[Xz9Gv5fk	BhfZsRE6|*	Xi-yIRDDD7NrjNy4Y5N
"#:4TYHj[+p	9+@+\\	yoy_Ir} p"jK\4[ID(	(:bVC$((Y_kX5W 27}cv<6ihX]Ocy59D,SJtCp8*;#}P?KdBs\$: XU==Y1+Nte	 DIzI|&CBC;4AERQJ#	kJu
Wf:S@Z_7ocu/K\3b
I"o~^<[-Al=0FB^9tL.G4P%Q+B3
H%*a0@R7$6M{FI$Knq'[.rI?6yvn'5pec*ypFpgs&O:q_m*79'x91EW9i5%p&'b8w,E2Io:)C()">@_V9-!2%5B !4Mc8H"\
Z=n{I+y~_]"aMM8YPM5 )U81^MKK|;w,`H+>0
}*fOU(=US4{bhs=d.usGENu

D3mPC1Yzlp*:$\1$%(
'Fogi<*)tEqb%STXmq
XK#?3U#o`f>wz}p>dy#nBf%arPS1-	{*,
2$|#fRJS&O}5kb3 n=^$O__3	xzBks,1kI<]LPa$zI<0[PbP.N$gP ($dm;D#:X$I/KHq$(0F	H Da *fye,6UF
BVlT9V 	MvhdsfdW!US	Tt@SJ[FtI9~kC'-kr&7|)_($T8[z1X~>qAuc0 k{F:&0V{q7Z+Uzq5_F&Z,/If
#,Yy4,8@T*JN#0U!Yr^-`ILU3EzeDT|@kSe7C)uG -P{1 rDRS2(Y, <Cnz|NG~^id7qg`16|= w8;&sbiF`<,P9hdiz)^-+UH)v	I1>K84]en#bp1.v-pSq.Cp!tG!(qat.FtQ,v"`"<"[(.q:j%)CO1#d|]$Ukb_jv=p# F_o_k)Lo	#;fg)g]Y/GiQry/GiQrF/-=uS+u)MctVr  	'0#B5!%cuz1~J'DuS|(]+E{m4p%>c	)NiqJ7fQi=7ZQ$e3L	6HHYLgc:eUKrj7U#e=
szmr{+rIl$o&ZGZ^zK y	fyyy6"Al1h#2/mDtyA u_G(eSl~M)Q6E?-A]X5l(b3)6l(b3)6l(a_c(b3)6l(b3)6leSl,b3Z)Q6E?G(eSl~M)rvJ8^Y*=LR~(g;JR~(gg(uNdQvlG)?QvlG)?Qy 4iF)?QflF)?QflF)?r
QlF)?QflF)?Qfl,g]LazUWG"
@0%3[
PU%J3M?l"gJzRHEKC4Z@[ZI'0Xb!T'=t,Q ,g`O3lv4f.*r]E?m~tr.Q>,>,|Y$gQcc")!P>^HL"0+I$ULaD;N*PULD1,@TT(i",}	]	]e U\PL>N`EX0qxU"WUyW]yWeyWmyDd2%@-zQFlU8$U`VU[j$:AVZD4egBw%K_r'r
<{wL q"ft}Xp:"e(*lc59'Nn/Nn/u$Nn/uzEpr{1"	o5Uf{,Fz+X8DIHs+o<X`FBz7}dY]RLNLVtD&:*o#Bs"KKCD$_B
U//KNpPZ[_N^PLdv}AH$IT\wu^ /sr[L^HEI\
|YNrU'1^{iDO$'$0I7y\K6a;b~Ri5HUsZ\1x#t+c^)Y+XfE-[+ <Q0O:^Cjd0-^nV#$x@x5xHxJ	@Q|,:C`{!=yuxYF`.d#A]IF=)gB4:eD^d3Cv_%dA;u/[3"H%7IHY-q'rd 1kD{RVwV=c/.z)),:*zHtD]hG	j^mHXA@F%uh{b%
aF	E($@&Dt;F	5X>>WQD])R/H"@6H+(]W850%|n(?Soayz*jC*qQ,N'2{f:hq7n0p^N	7Ll^Ym,K&Y	2z> Hm,){rz0`tr$T'{,tX%I[[nk%yQ/4O=b+j6FvB
$[1^njn^^Hzo	?WV{`j%Gq>ny#@h;q+4c\iF2<SFogk]Z[.NVQh jdTUp$D%1vFrIF8Ng'x8^^-:BOLNAxL3K{:[JZIVKEk_Y|-1AIki?.mfp4|c(S,(bK&O
UUO]fxUHS	xMB5ti*[7F(tj-NTSy{xMF;^/_9q/fve|
nUTorPbu3I5+G%E+pIhB.C9O8 f572^D^Em!^@3-Y$!.LGx}YaYaJ0G+L/(Uj@1%f	_	B}{rW!Q1Q!S.9glL<5G
Ckf!2E-TB)ds.D(f^V(	\_B;9*dZ +qgGjW,^ #w:Vi1Vadi-RW-D)%X	\bu!|!P2A(9	nk`M9`#Kl
e	due[2M[Q,CZi(Vi>$),U4Bun6Oqva0Ysp?dsbM"ory.IxZHP 5TjZRm+qW^#NN{S#gol+"ggJ*r#2K+ <)Rx{ 0eP;5<APg)-p2+^Zj6pGr*J^8bgP_HY2$OVCrI36t,e2B{Et7H9,R_v&jArJtzu:{a^.P$qB-	(5-Lr	w95%v')h[('{Rw1U=-p~v[Rh}c ]cHP"!hpF<g{V20ESr1wwE#s7.Xh('oz%Zo F8J'Mr!ohGgUA( pJW&})\,A0X\,e]Ds^k]asH`'B5|$44sUCARD%7aBbHgMxO ;FL&i\85TAN0ou8g^U0,(P1hc"Fon_ U"FVD^`,zNPZuzF*X6}zrT*&*IB &:HJDAJ5[R?,9TUBn-.yE,(;
ml0J>-%{CTl
Z-H&RGYT-9+5&|>|C+Ru^yObA,j_RDhAa%1I55A%{]To<Kx0a,S_6W>i}zE^&\S%3 +txRhImZEf, Mvu,u]n|M>/|#YOP|};f0zWzT3({X)A+V>A%
!0"R#B"@
 p.#(r^PCc( FQ#ub	!_Xu6:3=KuV{+$j!^IqNUrB('D1	QrBezl5	PV (>bn<d0tE$oS{uX@48;l@r4XwBER@!zLervSa``{^}.?"0Rj}Fn}_}B#2#2/GAW)}=#=|8pW{^uoICr.: ,;[)[#so8!GT7rf. KR1>H`Dy_[{}Vsj=ZF}qB/YrVV
k6N_ca@p4
(nE	3nx2N})}r!r	wlB!f/DP3F#j!	20!]GnQn(o<Q0`^5c~?
oari6Xt'#{k~0b=6-Dc>s4\(j}-@`#%#YH>1eFrIHB3%hm3'rMGa>b[ Vh_osK28_P3WMh8|@uY "j >GQRmM"O%KG;H/-+_^r6n*|}72|uPWGX*g	g{*a3`lmMZ{cl-5+hB-cU{ZA&f)Kz@Tb`{/*t|u&B$u^N\10K6&Bjl*Z$fRE|e)hjRCVktlu`gl{)kfm~"*ac$.Ki%R 0&#v `RC/+L`y7m39*vaQixz1
O/GnF(<ixz.yo[suF\ittix8hkMh&	+wRo!	r@+d+x@R`)DQDVL D[,@W1T@ F| A.QQ*LPXjwj$O+/I9n^UA
gk2x/o"\@|	*yZ$&)`
FJJU3	_J|"EKTEJ3u{H%}I& /=VqpJaKDBy:4N|6b!&8NT;iC[t9L/":Lr|d&p;>A_L.o_jWIJqsB%>==^K Rf=yP+DYsx)%F
jr[{VnvgMf-KIP#cH5 ;!m&#zfi%+}n_#^}}]~-F)+=@_6wjxb2Fcm v%W8zk F|L&Yu.}ZpJM2iS[ ]UF^cAk}YY
<].S6\*gP0I`9"yGg
W4xo *qDTKLUGiDs=Z{I`>`mv.wZJ!J/{0.MWm{,F&M0:~T23%y;iEq!`J1oCi2!jWmj1N^	u7/V$V88[vS8(v
z;:6,$C4k qi:jf9X%6/O:dTXE l.qq	,MpOB)P^H	R,-	ze 5}4%or;E(pTDV.5|v	e+^.y +J8+dT!! fN$*Z JD889})9L[rDMNrR xM'\D3+bb0,m~m$#=|rKt[FFe%U2<%O-2%p3{~	p} 
 /8>fh{~77v@^_VDtQ-In_,Pr%}H8`l<2~nd@u%Sg_|"3Ac#I/:	c@@*)%9TuVXR#^:Gn^]_)6q5b3!rC)62c6@6&AdFNQ^32jGHJG9L!}-^RH^**")$C9xb<
@i yc[=%T#i|~h@Z}yGI#9RI]RKZ:]
K,XBB*,.lXo8tZby T0{
f]%F5/PA
vQ
r(),q
r(RX4XWDZNd}Rl8VFF3iLQaV *UTrS#C`:XRs^+I6$C%g::gYf\Ud["^V{[&`;TAJovsB^,N0L8_.Z`"#7t\|Gen
eurnqw3\h-~(G7fx(~rM#4kq@SH#h* 2i
W|;Jt&7~d0"MPF(>:4kI8F)dD'5;9qliZ6MqVc+%peq3 <+R|*(%HC	[+Ti&|;?77wtQHQ"G,rJp=)sAa%2coImK[{V^{O_7zys[sr]vZ\[Y[;T?!"F(o6TYoegc\s]dci%%M`oh	jhZp'R{`%HJK6[}6 +RTo=A,3)n5xx 6/bL}A:X#:K;rx#'Yv]H%b)
K-aSJZFN2N)sWVJ&GQVbj'.VjJ'ti3|Lq(0M?\5f>zjZ>_^7~?_gq}t	Pt.o?Xa^=r]nV_y}xmeuE}-eNY3`Gr\Wt(Mgv(7va6gc>-@	_."'<HjyttNp`o.HC1dVm	HV~Cr=K*:#oy)9*1>\mhzZd/o:gdYa9w'3.._7_}sysw.|$%wIatahkP_9\s7'M6yYTW(no~|CU/sMNIr@G4vnaSfp1FkS/(9;/QKOQ29\xjH\C]5q-	Kv~)5-7F'a aphaZlGaT;k)%#I2CI|_q|]x3ubY@aK8S*6JS2u5OX.-'oG8*oJ8p|ipE2{.lw[K~sW#4N:G}P*sV2jO?#Kt51iM.it.tD@n7G
a9w"vM!q`&0ZfyIjc7i`beMhOa^At^6/sG2b d#?vH~k;)U`&~2L_Sti8a%	r7A37\3{@|J-_Ga=bls1MGaJ@4r RaG{Q|aF~ tXY/OOoo6c|hLS2Ww#x8p{~{j|aw$l*#.6	aqYv0P71VWp4moB#/K6` ^(Er2kV,iG+QOgIHj&,D({3s.~vpE$*A'O03A4@?jS"hh]lY\Obz}_YO4g!Y$W,NHkZh-R^djUX,?2}_~k*=y_&s}6w_3t5bK886L",!'|F:K(ov352ULj[jMK:tbi?iHu"z?crj'-*|xkx- :*ov<[v_672<HMNv~lzy&l*]st6\$"gd,cO
_#~Wlf,6!&9B?'=$AP-Hk#<p~C Yw1[A-I"ayCNp2N9C!Q5=,Cn^ulFrV"p@wa*O9q_03-$4zxr
/\;TGI<W4"OKsB(bdM)x'q2b{58~,BMtECiU\9M#U8L^qjBs%P**	X:P#gY%}*<Ds5/%$0YeGMKLkT	.3H(VgK&SyVf`=zO*v=N?d\*y`2-zzc=MG9#a91fI~xmugtixZ$~J'R.S2KOz{*9>AErgn>(j}V;X2yHl;5fgA%*#xWyUE.i50MP^+,G%Rk{akQZozvrlq{UY{C.><xgvL9W`\b_YrXHx@,d
89m,z{if54A
Yw42_p
X<LV} 5*1$i3wc6}@prI4_]e_/oYfq]]:[]B*y/lws]*zuy-o~66z
=	,rqYqUoUvOhUfSrj1-v*efV.nVf].W<]"2xws.tnwfuGY^_\l}K+MF0j[[#5+RFmo6w-!f4~flYenMYN%/W4/2~w?^.mQ[[^V/og8'ITYzP5g_GnzE!cxt__7SU}RZ~n>
onDykyOJ((WO\bgr7s^..ntzfzB:gK?>l~wXZ;f {~{m}f)s**)#?_0~e~|\M'Z^-nN"DOe("++b*IUct)P:!](2=2>~#GiNh%\_\'KQ87%UFMO;R+179My|	\JG*qP0~M&>iPm 0a%mb-R'7|vqun<-w'TA%p '6Va/Nb Gj{
aNU!)1^lmcHuHD'i$blW63z)dz*|'VPB8
~
&>&aas?qh!.Z_Crxsv:|^H	67M4)vb}}A:
sU{DY~M=;;=X+rx'J5$O^w1)(Fp0jYfuRJIfw\Txe=FPS&C
&VjQP5&jWL%ezH%m,{9"6\bhb2([2epbGGE:	qAw/-	}n =r>k~k2F4P#$Y^X.gYWD}d&mVoTqon}
yCC~zuTN
NvXqz@m8i->+ ujd+.>PXg*(v8R1'8,#{Tu01'^m.isJ7qRxxG7(?@x#.'o~q=X1sfhDK"Hlz<&3Rc/^d}}_|A 2F[Uk3w4YY=gGvr+05y9o&`]57
t]OU?&+\]]Ho]/,".b,O%R@|yX |P` (v$.Sk@gBh/}=-{}K<,-67{lkS\$y=bx;f?krPboDloo,i[G`2~.>q7U,;P~B+pi8kVa)(:/
kWvwe(a.*Z{E1tQ|a^68m?92\74utgOzENMcbgmoBS|wl4 J"7k8l\S&W"hy6}ME~o/>;z;{@?n<:!(c$yoR?Y9|:ugOt
8~@QV;*=tc8*4MH9>znD*oz1h*"-[u%6=MJ_RSE!Xq?va$toH`8"}]p;:_>PZ%o*}wtj|G+HH.e6t_tD(Wov$#uOc9oAG%vM}XV:wBb'd&-taizo@rh#EwTC{G''F-}|tZBzO~KEO~b.#@
W[\/pZPh;|/ v}zysu{sM7_._]n^S~A>ZE	0Ir)?X|&<YlE<lWrM-n~t_bYH=+eXc2R1S\'g/~"(1&f}C3/<3Ga~fT//0T,T+XabU9e6'g[Zwh>]PKl2ehl]/`TOr%pJEFy@G
ei%kfUIN4?}J>D>ib
lt]]jXn_p{	+7-3Lwj[=vAO?lZz\UK^f53q]%4,oo}O1-^Sg;;\clk2eXBtn]v{h]B{d r1*Wfn-l9A"jc:WqG`bn3cY*L}"#TM[<?!L&yk\	{@!$rJ%D2kx]]|SliMn-FgNoe-p6~q2S }|=q0f5/*t/g~YzO}`t!Lq>Qoo6	z_.H;v~:.:v`0nm!6r`bMAvZOktTc8{ vO/!\\>E(<<gS=XOhHk`1n
{~cHexR2f8ew vJ)P&&9L?GlJ";@0u8r>K_dWarIiKN_VoVLxa.hM2y]EipDN;0NhB5M;% ]"{i]\|zxB&vf:qk=bxqZ53=|qOwvDO;[3Mt3=xO$)]{By;] G$q&lOZ@J8`\,Qpm`2W\Q^gwvqkdSA
<=P?jt,8y@?G2GGxX%FOr\ZTBvx^F;690\?{=&a?A^l>Zc~G~B#=OtI4x	w}];sS(~<MO<E-P(^_liwO1[hE_{yhvO7]YMy~'LF\A>'q}|%H/%]H7u~*IzL29%oBdG~[Yo9{\w[F8'6y7#P ?zG|8?6}Tao>Uex=Swn'|yxBZX_lMI=#RLaM@f7q
?8hyNWy<K}m>q=9dFxl,e&o'bF</[t(a~dj*-Ol\\K}L!=-e6W6mH"o1]e/*uL,xStDM)>jm~6	,p0g_NEy0	EG`_O9yG!N?7,C\xdmnb
&1!<{f3)QDh<x.$XNFWgy:5Lj=u:b*tVlurL=29m~%|ddqwCJ+hF)7(O<qK7CCbgo_+[%HM	!k{
wvFcCr)!~61B=4	Lv!,#? iT-oF29Vowc3rb0!!?`c(C:;0gL^Sszj6u6e |	6|s6:kFqZpG^gyCf?_#</(f A#_6m	^g (?Dy32AxLq` > 3"n]Mi@^;ue5:GWUR*77J&CbOh+4rc0i:3e|2Duuj;l+tf#{>b,|T]3dX:>!:p2lq7D&84DQ/]SZjwOMNU^MV~!{T'zYkS\/0w&MXa*T&vj _zY}Xb =:sNHWi2i<S.}Xj=	&6Q=MSMLl5PK?<?OTM7}DuuFq4mF]=f}WY{l=a=;OGf$VD58&/B?1pD._/v0L=/bF3_n f~@,uOX/7O0GKPh_Xkq_?L8lBFn( ?M?q?q3)PyVzHN|
LhO;g;iv!CLau1E(u#p8I^NR~nqc,?jL1p1X=TkuM^^zA6Gw{\)8ROHtwuq:4qoFDDtU[mh7c}GF@M7;g {9_s 8Y9}_T"uFw~/Vpg1pMs}O]n--4O*~aBsz	i	!F"#5(FIYB~cBu>-X!Z 9r#D<7d~*,RFsCwKmP	jG8FO,~dnT_[$(RT''l?C7*o
}0-/P$yb4>`C`v~y|>
qO
zsb<`9:]bKsh	 CA0e8R@^1?b:G= >{L8t6`w>1x]sggGr#Dsg!>Si}cH)ZX26Pc B91kGD8xLJ$cC}9\%Ex>T;&7t"S"'D '>~=~=HYT,<Ax7(i
nP,}sU'v\K%}{?5'c Y,[-Opux
q0:fu}lgJ=APRQy`/t&w{FQl7Cg//W}b[=;N'v`%lRJF ?9=Wv*Ia/C_L7J/CO\r zvE>qZ.6}3Bv~F3y\QCJv(_Sa/=LRb<LLuK:;uL=B8h$Rn<oyt, )E1By_sby(Qfr`|lBWu&\+Juz\:)~QC~|*aq:U|NHdZw$ndsJm[nv|EH<z<RDvxGb,NoVo'm|~I1n?/.%yKk0;iV5z D]n
~N,tO|
{ql:$QH},m~*GSUMq"ea<	dqUU	6&D1MH]DG.?2Su<v/QM&kT/:<B'y<GZVh-i+He7q$oAA$MHT9=0fLZ82(ISu1e-q#WwYj!S'o(Pq|5pTd [}Mu=5!~bw(#[/|_hzb8=ErJ=wX)4ipa>X3b%f"02#{6//67b(qAx2&-Uk#_=N2&Eh P6yW&{6do_gN;H]i6E>!@$iUYU =xIUDFF68*oyS%_E8[_p}+SA]C[qmTp.5Kt`jp^ O iqw?,\e_e[)w	+NsyR7*,zPqo~rN!e*T)*~P,3`8`WNJv4 }L]Z!6yJ2 +x|/4	Va;#?kMQ /<m.Ail7LU)"-oE*^bXp+(*,O<rd)S"UD=|d;u%-iPNzt|r)esEQ;D,L l,G*e, @T"mz'V?m^L\pB<`?pug<V7K	,zK .U~}+mt:'Ap]PYCfD4Wy~k
<r.,'_gyPPsge*`[s(SD v~'>,:Zhg%h8_O-|x-qimT"yTE:"HLyoU'\.dN?|XDg=BL2lF*K#hLg1W
%TJ"FQ).C8^ZAoED<59T.P/='
JZTHF 9oFI4&)oH[.@]  P|bfx)*)(JTBT5%&<I[<_.6-9"Z bH|'0pinC=&o?y${8i=</b.YR}Z -_`HE
zMR$zZ21aV<\*I+ -,Z_*`Cj wA3/ g92_p@	.',e2EsXh@Q22-.8<8#y_bHv |:S<uk<%=4ebEg){!^I)"[EgQ??`
)b30(JTV;PJv2s!AN{8v<J,xfc",6/ #\hPF	"LW("4VaX.Rl8r/}b{0H. p,:PQC_R-d8.4I}qQy#`BWIV-L`L|iETj/_`C&3*R/_|^$p{VaAf%= ==^io_;Y-zUpQ-li?3%uGCBMu{;hIB+x<'u=M*zyb-ci%o?|*O<Yh+iM_4 %v& z%~Rd`-ge(aJ&VqCh,1&wZ-~BuLa7?~r?@V9V6aX^5a, QBl7
Oa?Cx}:D?<Q	2HqQDPdHVRz^k"k9.K5Lby;6\GdbR*K;
#4"z[Zb`XhS4e**AS*hm*<8Td P pY&P>]BBBuT9irh\Z+p2;N9P~|y1vTc+uXi9V}U/C,,qg{,k[n'8vz]pW60L4X8+'#Krd^|3_l0PkL|@/*3IM_TcAX0"i4Gf76c ~)	~	WPv$E4E9 PIgH	fJLcE[O$cf#dKP:$}\$"vAv}Dccf{
0se >"qi=~Cm=->36IbwIL$Hce<D$gReP"Z!3,	'$pe@}d[_=X^`fR1bZ BsVE6J1BYt!&j>oAPa|JaC
E	HzVyV,b4e^0HBO:*l|p@bnyJ"Gf\(}s|95i186.`V	*nYk|O'<~o3MO
P|s(q	|*TB+UsZ!yz"{hO,;}V<(G%&zB,~;qPUKKk6k/yiN,s2|V>[m9GuZ`Cea`P&?-2mlgP-xo)BoCvn6(rQ2m,nZigq;} e{!A3KO1VOyGjO/}+qN:b\Lnz
[7l#2{! z}0"z@v#k=&uR#-R]2mM}7r
r#UZ0y	!}QIwfTGj7ohJ'FmM- ~X\Hqw
1?b/R	KnC);	^BW>\$IJ|nQIktI9O+Y3$^Vt-tdt^xv x]^9Cu>Nyr>l
~	3 F3E;ijCE1$4zC5GUYeI#4o
9K-Q&7u=X7 lY\	zX&VH5GzR#q7-(7>fa10DX.ax[
!*Ru#]+M";v^Ls+(p`PyGzZ
[b!J]"aPv1jFm .T\,aPpU\]
o'9Y02&h[L8;GG=x'`|Dlc6IE)LMQ	dWGWLkR{@Z}	sd!LV:M?1hgkDE[FpV`[% lv;|`<;ee|_*oxC	HE!:?/J&'TGfZCilzEXQ{%@E+d*QHL:;jZ>+|NUIgHl
%
vvRnOVF4g6|>ClqZ>%%Ly/yyz`zX`j$[P]AvBRs>~,HpnQ;HDx);	tM]Xa$[H\ D ~V!Y>Kc!Vb~YX=-cexm@ MD8;whY<:zTN>=Q6{Dy`h=!gTs A@!ZX8rNDYg%tJs_`V'Vyb4|z@cp0qmw`!v	0'eGy}.u&}|^an9Ra(RKJoQ.
TP4
h^@/s}+OUw
4Mg"V|fWq;(/vQn/
-a)v2Z-rK-\> +aQlga}.e0 yHy.X	
F=;\hxVL@7CQ6"7F<(p{|t>(c(u2)TqCTT\z-t-0
-E!Qh"
?+E"S@tqyy`TI3=Tgk{Z4#2A.el{]0Vx,GxxPm<E_L*bn)!KG ury+=x=8I.Hye2V$O$pl[ 	7e_g]LN*DQ[~VxIi! 
vB L/
q'&,[3&	[M(q
B*E$Aw9 
+x`$brvv ^jR8sdSmAxp?Ry(wP"='Ut8%.K$Vy>&(7 %	M#-]P-9yjS<=-d^)t%e"y~4sFAwj#/= uYE"oYbsO` 8R"6q
oEZ6	'x(~Aq(p2XE]>o>Q!^@d~}+]ZvS9F]bocDbyQ`{]_OZKP!7Mk{R8.:(Co?G8vvb	wF\fALI<GUWjqB]aSQC*'&OT:bi[HYLZ.@<:L$n4:5&g_~n2=^:kH\_4_d 7P6d=x} l"F0Y	5#5Tfq-uQ@HA4fEZiJI$@I}}:WEC~eq(S^-T]dbSH}$+d`jd\}gg~{+_~f(
z["^	**qJf& 1 $\A%S)xu`e8 y&02`g >o03	f`^vkLuA	9'9,0J_3Ne)yuZ"JI7uc7W(H%sOjPgh>ju}f|c]9?qQ9${p`'tSAd6ByK f4^bJ!KX/ad5F%*KdI#j4rJ{]1K+wuI\rdVLR&+MiG3"alCP{=SIJdmK~4/OfK;T<Z!CHFdpr@qr3>$-*DV.:ExRz)iyuI&V:~`ebgV%)|kM,'RJK(X%z7K=|e&vdzDG4d}	H+LdvuAA+zEM{6|>hUA}ZTI";ip
rqM_?35u$7gj'c{/S~B'{5)d,K\] &)b0JM[&9yW0{@'Ws	<vR"7m.Dx.W$Q Qg=6"XeFf0GIM@^?@qaIY?|+,NQ)\k:pzm 3}(>}VL
'o$I^w!j_o9INh8:@jFQY5]_M	U5fOC#@r244d$(C?Rk(b(I3^1jLFp3h5.VQ\^H(0}EI,
UcbXFKtE*JuVCp@qu
+b=h4BTK8F
VzI+7pHnDXjy^vkZ{'5Cp;H0?+%E*k}U}3:AGj;1	@:+"D`P&}Li"S1
T jW/kP/gRj=ZU\m&[-X~W+O[XZz/w
YKnthg)b-LdB[T1aZl-_RE)?|q}}lCmzh_@GdN6xx8)\)';QCmZ3eiKp*)6__f1]xyEW|[";ZSHZKQ%=q` `5n v_ o[+?},rgo6Zx^w=v:DK4VdJ+W>4O1:xK'UQ{T\!D}4V}x3TS7JKP'|5"TcnF3ce*Y@w5*DU,d; zb;dh6OI{4 8`]0uJC09RWijq7%
H?$h{cZ)	Z$M 8I6]67bV6P	y%t:6#IdjTiL `TszOa4&&)+a"N =JT.UWWp}^yVd$qO\gOvtDtm&pIJm~&%Gzotv11B+jkE=4+>YQT]cFxKHY>
48+=OG''?	T!zZ1cPVQIv;~yB3FJ'vL1B!sH5NR" [[?%?s(KD3tFy6~knZ #WoR8q>>O[Y7S,wD!y<L2zqq(wiEMCp3tADWpdxjp1xq{g1m|!dW2zW6c+
gn7rbH9LU2Hm2 ms<-4.\1Q53+l~&Z8v0Sb[q1MXRaCL9 ZSVi-!a 4d,79	\]REFxrD2rS{Hx4q6JTM[Xi>VbW4U
8h$2V%EhilT3`C-n[_wWNqlxQz11drB%c[nCt^@@ :MP<[=Sdj7"'ns&Uu}Hc?94HuuFLaOzu|$JZK@K3njQi-8[h8V
haDlt-nM+'-M$[7umIfnMljOYqt`0th"4de<Hd M R_4AVNYw
2epeo{m \cxEL~3VN5?g 91{IZZe.~THj _@2<auvxXo%U#DU4Is%Rm2Q-E)Q%;
uU_YeK&RLjf?-YkVR?nd>_(cO1iWL*faZ
]9WUIHjv49bF3	T?r!<fOq	_Zbjd0^OOrLaZMB8izP|C|`$&L:w&&)~W?oP
 o0d	{*4|YI5v{{9s+ b@0h~DPv+u_P	6u	o&*zy!<31"_|sl9VCs%(%DR&q+Q*W^G_:yFsfb~FZXXjwtk&B<^w#ScTEKU
36SGB&!"0+*s(I5^/,20MmDo^S
	18iy	yH0NRj]|5F|bf-*P\T)dN'9b?F&?p3S*mTpom[Wj`}/=[J"cT^*`xzxo;'8oQgEMs#Uu*=}Mr@l|0ROA!'	@	7Oz*_ _]dO6Bryu;3-*]I^y2Orj=d]pJ;IKcm1"Y6pJ5_n1	OQ$e	0`&%)[0:6t&1Uxu=hn	O6z[wLF=	_<b	U,i0XD 7hDXvmvSDH<3c]YZ`V:=>'<G/Yg2%}5,D;A4gbIW4e H@[X@[h4LtPk*	K%we62zo5G]IvVW(6kzFvwsN!H^xuYo-a/0i49iUBl}{E.lV1yYZ8T+ucg76gdH+zf2`c'-Q	6&i>=iUgiIM*+;lnH1g*,?`r+bRfA]	K1s|0OqDAMje'MDad.XS32lA dU,Dur8!y!6CN "3;R7 xqC0B5QL:srIV0K!se{U`3n^X~*>B>;1{BxU0Hs*},+<FcGI)'TJuVc|>c>'t<c+L>Gb?<5+Zz	<qqY9H^"mN0*zd&ht~,%'1k3^eIA6F6vCmVUTpS#KtPw5EC;#Rs
K#2{JMQ 5\X(sRSVkC#"j\LH?)Gw^TdUM4peqHRG->7+*&dKh6	vaP}},E4&q)LP`ObygN7soh$_:}_sGf%%g z'|,6rm\&|n<`l_U9kF$i&WWKpAx;`Mnb"UN]2C7f.oKHg_r&/Tbj\PuF=.ZAL[GLC*#Uvd-XiY|'m[$>WA1WJ2g"5[Ojj
ZRP(.uHiK5
K$"}P3|~zwaxJw.NA6NVcw<:f-:#o.fIs%f:m<]%8Vk^J 56Pr#$JnoY{owPKhaC _!vNb#	p<mm
y5o
SO-h_M%o#Zo-1xZ+ZcpW)qgqxJ9xQ:T Lj0{|;s=eJ(!{lXfwdgvhBNut(iF=nU,0g-7 4W7y1O	0
Nt)}X)HEo"m\`!#c8{2v'Wr&bUd,O[$#~??gHk19os~Dx= &Cc>ix^41%U_}"ng'y{.>3=gh*8\6K"f	4Wu,	4FqHT>LA'[X-'iIQ[l	4]kjJ+"b#YGFddWcV9x`R'kC=xP
pd62iRk*[TLZ0`)5nQ]tgI x8v5t [=?j[8Z22EmzD5_wsSjd,%1hBG KC5|".jtfAt3@K/yGg IigZgx`y2y)G"A,5Dv3'N~+)/vYOO0 ~6KV/f[-9dj5 U% F+T)-_QC2_]jI %_;'~_!UZj_?ss&_Z>]a|z'x{
GP-Y:BJ3.M_|nEw tt \hUSXD[bVR.1L4>l='\G?FS!s_<;^,(Ur:-ML)L kUww]H_y4S$=BjueY1{OFk l2';vwNuEr(*MWjkfW}	,-z?r],Cip`7+5>-L/^v 
2VmimU)v=1((U(2J5GJX~hNe4Ar1U{MJD&b6)l;l!
%$((1dgAgxp7'kE$0	(nU8!rx`gZ1?r>dF&iVjDE\[ RiWJXAp]9{ ~S13lx7281Bt(,n.-O8?:j_-;{bWD`@B
UcKQxG_5)1~Jz9fuV9]icHNDGP:^c^|49fE,'F=&@%WDl%N	t;_?h$@m'`:M/OlF8iZs98"."	V)>$cP+kd)0@,y5ykY}*n|$?0LP)hJmu1gIjH0%eD5G_XqO~5N\u$F-@R{w`EgM"~$MZIBDH (8ek!JEK/kpeEQ<.RuRW3ia4l`L.p7+,ds#(@8j7NkL9XI =9^o,:Ad*^'?#U	^03J:J,jP:/
Xugka_	2iIb7P%(XPpd(RD4x6j+viMJjj&&9O53S:5BJx2 G\wW+J*;dco5+Y&kR44Bvf E?`<naxd/Y*yW&=Q.RwZIme/&LtJ&^|6nPB	C?p"1/b8a?Nid	C<oB#/RlE`i'!SWQs~gH\@XnXQ^o3cW<>(6cv9x}-Aq66T1\><Y!T2RhS8{+ ^@r`\C~H}|e,D>|~'2NS4Gyb&oP\A]6p+Vo@6+ 6!ySHJM)_X6T'5\
xc\*	V8P`U93DN_OMWo55f<Pvn+afdYixw~DZ;ewJ9,-;{F@N\=B'J2gnPGJIj &}/v6_A[,d"h(UV(ZtCD>
^:#S]8jM)sf%B>+w&6s0se9Dqz(wDd1)&1dY.L[t(hC:_4h{#c
/@@_ok)QL7Rz=d^ xFy
'gr23=+]3^YZU%Y^*;Tp].`nQ#*:\e]PA_o.MA@%Mw5]$bn`>p#Rtk)d&Vl|8GEiJkF7,"bhkVoSRoK-[<9b6:J1_iZx^5oTLrCMq'W0oVHWRdL4CT6c%3X])	C|FbN( L")RnU^#8[*hNoBu0^2lDpAL4
qX<yJzWN<$m-~x(
|OUe*Ly$oA6gm|gjSIq.aTR1)O.G<6cK="]lC1n/36P2ge;~Fvda1vz56)!x#3_!V xW"0xF"{\0b|tFY="H%}"sK(-d'uYPGUK$|~\6hEKCn;s-^2WWNPf#W6vwvGD
NKc)YW_(4$
ildOkkgwM 
 LbVA\FT@SN$
bz`7NS=2B|}xq1Wv?)@8`J/^-t7^H?n%NIoQi3+4FJf0Mb!,GQ\Tez>^1T:N [l=+)Rd;o:E6-u>tlRg$&05FFbqMC.6|Ek5 OVKNaf;:qS351zBNk c22~6L'RQ5-]W<hZ]g0H%BEs#IEq$Hl%vw4 =[=W0VdSJ6w;mgLd/f_A5N:<L87`(VvHvGmG9Vtx-8q\NNz9lSYS@Z0j,i<.	uf%j-8*)^B1iwL*r|/v-['9:q!nXHzdSL13\_ dz~?s	K21>Dxs55&SJw*a%;zws&`k-|jIRXi&<~22hPu- 6ZjVcbO_mf}A2&i3e+GDb m/8*1" Lb\}kdoFhn#f/Ibmflz@!Us5C_9Z<Imns|+
vq+g:IFmXi@mw4U[P_? 
]]x.;ivIu>+O.|1<(Yp_NQmIys<t%3Nr>GZ>K$J?$Yr$\p\?S7huxaO_DrqyUg#"~y*ehA829fj_NL+rEr&8`Ue\59WG(DM";`@b zY*2MiCO&+ta<3E9dZ kWF8rL^lV,dobze]]i&NGuRz^Al%Q'P>"pe0HqXUA_7'Y*PuZwK[JF{W]P"n6k~DNLtm}bg_j7J;	</M^\hqQ,;yTuFhFCk F^e@xyXSc)s{CIwf*ke{E4> 5'0nGfeC(cY/V#`CM`Q.=($;<Xib5P8~W[f%
fe1&	*vnbuL+%
{lWW~k@6E1o|xfOlG%~m-HE2o@77 rBks&j*w"X7>1-]'yj,c*+CE}~}U!mBQL,${er<SmX.hxG5
\kpf,KX",WjfeJQL>>$|?uEW'
~G~~u}B`ji?qYJjEPUryykYV :qk3=)_ Kd^fH=]#pQ/j I"=h hz3!*Iks"Yk mN}v~N=Ox`5rpMH}=wHo<'C2oNXc[miUB0^pNlRCrC5:@O v@	VNvJ*6l,+-~tC@j?#HbEi(	] D]aT#_zWIRaz -_57l '_.,NZ-f+a8QU~D<xxyb.D&91EJ%o0A2G8qd|x|wIl=:_Gt4ZLES^(Nl~wn@w:X8_n}XLRx,aRr%$<J@5QuG;hq^[z#'OFRh";QSO,-anCdSHu*v3N'`+ UCi
gr%cCigWNvx4|hE2*x1,B8h#QkuM$$#OV'y2z!l7Dz#&Zt\h>4,+BOCjh;0nIz6QB4mEDC(ioM>+!1 &$@QFD<4vV&",3*-3t~J=	H2.tmV9:6"'qhf-
^~h~P}"W73eRUz5</Y!V&ubCXbRf= EiI+{	3/@V{X3~MYJ,hpcAl,5!4F1yP>FFCpghf]oTy]o4hSCl_bi#e^@sABKJE5Pt!K6DXbVU^R("4G:J~A+jZ)Sb6"J'+FI~lJk7Mh)L?m]`5qU3Q*0Y+4bKF}$zcm#a"hqA_Aoo
5vH5'fe5YmbaR~R8".uN~#;a.>UUX\]YKP$h'i?T9zOE#Tl?.U3T0>fvy93TP+nJHFA/5CF<Mxt7,47([jhMQ[azvA2U}S:Y	bA,6m,d[5sNDxIY8bX2;@3w0f"wL;u<KnUD5/&o{OKp=
R;X~kZfce3V$mf	Yn`HnWApT[+v6B&EKnax8<&F,B`W*,005m^\kJG4l47&YI.%%kiu?!--/KM<rW2wA8V[i-vMlAOH&W(rHsKCZ]voq(7 :p%*0S%Y9Cyz2#%jv:$0b>EcfT2+QD]Bje
&5V'X;T\DP_0Q~j@'3M1E}F_/?^7~sVsw/`?ToN_A2Cvc:~ov_~q?~<n=r^v\]Qn'v.IUwo<uVWoc=xn+gSyO~OI:kg6@/_?>4wN}Tj%7j#\MK9pJq\^}=kr{I4yu^46>^}=,9z5guj'M]k\/o/>*px7Z]vr.E6z_cUh^Xs7lyt[SjJZj.\Z3?gGjpEp\{-tp}QbFsG3]g'EnC	e:/n=z69r-WR']>wkPvmxJGy%G}|lv>nZ?l>a`.]Hsv1=zG_p#Y(=FyOnNi=uEs\k`Z[oq(^\aNPf!3,Spw3?q=>}C)T}UwOA{N-js4ov6q7>5\1'37/jblD[+Y{D>|J8_Fs_?Z^ncu{hiyk3	v=. oZ:!a>%{D$o5SZ}gD~}q\->:x:Xs1[W5n*uodemQ>G_u6%D3Laj8jBN#pZ;}Dr=<voC~[cVyC@ _6IW	}t7F/T&lW	 As7L;x'^v7'>Us~uNT\h]!a5g;{wBzEe??qjCwL'^vpggZX5Cr@.%ty}10dw*O	1O+z{sqriwhT}Uo^CG%/o]$FZ=>"2M"o}{D$<*s.)me1UR/;q#SEkk$m~e-gTygcw	m'CV!
#W?=<Q%z o?Z YN=&Cy9d8?<BnO8obO~k<lNecZxr:d{xpp#N ]~2]<RIqjz-#.z!Z~N>Z*^IMb6m6=9opoz%t7N%|Xbs }UpG%/?]0_m.I/!yh]yRg\=\PwDH_Seb_g7wH7f}y{AoIy9&[lkEu]OSOO{dW[C:-w[c<skI2oWYl//7Gs1mu[nub}I7}Y{jv%;t;M?clYMuhNgTgFmpHU<{mC<_d*s%!{<kmULh?
Ho>`5I<Rhh's]+}R}'L0x4gq5k-Yy-/N39D^Vf/<TGTGFk{f-KY]xk#Vt0uy8P16%5|r.ZCkt=jXw'Y{Sz=F~ZQ}jycHGuFc7?u>l9d\t[5_.nSNe>>$t	mg>!y62{~}wC?=Ey	{vNv'>!,$>@{[tAD7Y`?Y{>ex.[;?@=|OX(`809h{}boQ|xGs	 {#BT7~ZyM!G[<+[vU6.0nCLm`~b'~4~m7;\x?v!x2KLsuuv\~:\sS/o~NKntgwA?37YgXaL0j{^]An =p>1]b:z3/rau'Apr~99lH>W9]p;xO>GouC<y_}s<9i1E{p<S;oB>=g~:iS}yzh=zprp.n !>s/`-l
y4$Y`vq#2%9R2<*A~}>##kn9gVyyos6cCO>N=|?m-5`<Ha)7<5A\|h/d$[9'=apCm]T LqD~EHH{UW=
tKtSyp/^&qYeold])hD6 {:t?>OstcAkgxz*M{7n#6Av2"n n ~XEytltK[;j]V?[\]O9V	|!yLm	G]w&rP|jv6lDxhB{wn|u|Ti)22wyn!N;Zcw-vy{NAz:b(e_ilavAKLY '5|zv]w*OI;SbFkuH.B/>-Zw}q1#mO.Bot>x@csL4Av{mF=v?H]OmG-Z_'coZ[\[[HGLCQ[[[HX`/EtS#y#'~/~'h`p=:<y_{_JOOwCcGC+b=x5,w$_LqCkrxp.h=DvvuSW] 2y~vN~Ne-Mk9aZW=;Y}{Q',{9bEExYYxvLFxuO:%\8I#QVvGaiG5'weuAqQ:5Q$Ux'<Iq2pF-]^:ZA)q~KvsQ:{N_hRQM)Nb{aQTq@-41Q6!e=oj=>M0)"-:'-q8OTg5<[D\b~`?N98n9({S:CpbVGDn9"5S_f7Gn=ppbv88+T-"[}8B[ET'w[/N|Z._i8rm=8lwX>YwC>=ex]>Q:N"xN8#hxw[,s>{EG>d("B4#HD9w,Z|-8jFk Ht#lqE2.2G8D\6IKB{;|.NyBTS}_;YG:SCr!h{y\sFStLcs>HCd{ZD]cOD,]oDZ-lt!ND,?i1-Gr#w9KxXL&2yZFi1$N1]D9""T=\sd8 A| .x!f7v0!|x "O<!:4Lh3NYm|
v.nz\d98ms1gb"DfDRSajti eD6 FT#Kxtk9#&jg;T2q`L p$=?61|tz^z&F;#M{v!s54wA7\]qy\}is\,FK4;4f6hsQiXwdQ?.x^A,;GMaQniI2[bmI'l>J/${r>z&|).Yn<'pD9uwUY	,KgNAEd]&#kmX&%4N!hrId1"Z7x=G#zr,r2}^e8tt58~aA:Eu})g
(d[)>LEI?lI?l=E~[S!wo}d@V1]| 3lZ3!+lp<Go/DSuu:sL6DD&hY6!B{hMP@:`81[yust{}uzt#HGb ~@C%<$h?-Y8g<#cPq~E#vQxs}lD4Ca!R_#z#["9{Nj-xNs.^u45$G')db>g<AV4K
n+GFO%wwk.H>m?v-=p9cKjf"#:N]d6RvFltd/uY0yb2$"{u]Il"z6tzOfslvCd7p}O~jh}>	88reHL_"}&NZ3:c^^#t]X|Bo|$]"eVA-;g1<8o.8[:6dj="gt&NV 2E5T[Oq0N'2!2Y8Kg s#)2'4nE7Y`ms-["Z"T=ld93-3/,gD~rc<\|vc8Yqd#crH~eE9dx&HqY]>;qS#7=`j8UG%[[V?HrZ_|BhB|qBHGYn.u^,?!4ZVBNP!"g6`n_YfuC&WFpFA}n5gNdu{1m=nEVkfuk4tVY?jYAVEnVmfuLY?Y'AY~b?y(4TfS;e_%cMsJ>^Gv9G.|$|V&]j6UND{yzi,0z_YY`jOy"f*l#Gk+2yx2ONJ}W9pd~#d<k'zad<q%OWU:t4D,cWf+fuWM-^84vC~1Q_?j/S={,*TO?`]'n?bNpN1b|a/,V,5[?>sq9i
v,N}]Of?n>_O@/Df.e3?X9boA<Ir}c<wg>O%2gLY]'3[LY_C~0+K$>#ObI7-_m[>rwqNhSge'o@yvTV@gvgfgEp.YkC,\m.d63kbazrEy
v~9)ljW%V(Y%R/w`B@f `s[^ 1b6`yvoS8-5V]zF4/i,FBqU0f|J!> l9s_1li&6)p/$lUg(ZOQ/p0V_L_OxvQb#VQq+,`Hb!4}IGp~>:O!1@
Xa
rxzdj#xYp|D,s&BIu.j"$AzZOAoL{$tZV{y|1Tc>0S6;^<>nqH89C{aYN6(.7Z;a6y3 >AdWbXlw [|gE,zu0XFF-8'CvEJ^\l/e0(s)kt{gp"kf ^muQ8,h#U6;a+PTGg_3=ea#<EVm}Q={k1z?_dV7w%MMnX=^Q#V/}1Ps^&{6>!gFCf(6@ $pg/#Vf)6lS)^DxM#F  rY^6CF2D {}\.1@Y6g*f2.b[
$By-7H_,+ao&"17P0a tD 
W>oT+)# }EzpGfhXh2!sW3ud<+	Y[b jS)we_FGhgkD0399RdcIThnZa[{ #2jY:~Dm0@BOFdX [	2Ms]FOTbf^a`52 l/BJ	X.`(!A2_@C<Mh.A/x,!`'c 7d#<wQPbN8M e=kk<nem#yrCgswG?)y)Lo!.E64]$:sOi2p\ s9WC@6&ROl_(I@!%0CX>ZKgve>i5A4{gd4\`iU}yn'A"/baHEmIwWk(c"kgz=>t5++qKG?7-#$R\vxUQX%O@P 	(@DG@XQgWV@3MbNWfNZ;3P-=AbamF'$pYr1V%F^d!c@UfaV?8L$xEqm+E]#)2cy^`?>z </Y|4s}<sW-* 1X/0/_41Kscdc2?L,-8DtUBv.Xrv`J/\{^PWRmyL(IxqmW%<);,"w#z_5jO^[t/ZL;@mCXo?Oo'll,|^|~lNXh5z^dLfy5KH%_"1?<lnU&OG@yo_zj}5$?n8t jWsF~T~_8Uyj/s<B6xakd!WFwo:Bi/D<
'f5)?By6/,&@*wF]xH,f" Tv(<zY`-?Y(Ee17MVQ#x)v3w!	=c7zDe9cfzF 3]N{zObA2{|^MA.,KWo,)LnIserc#6Ox|{sAPD^yqDsw8!+)4VwxBfq"ZGb{U3*O#j}/(O%r,hCH;+W@L ;p|xkPVC.|1hzTX<>YB|D>S^QN<NNS	l>mgz<0n*K(KF7}eLX{hzVoTCx40%E@0%}G]Omlt=K kh22'du|xbDgD"x6"
0K"{r"8(MbglInn s	{k+PG3/t8}&sWs.-&gDVUcT?b%:tg	S>6P@b%6rvn#5<w$ &~*1i?"ybO`Tzd}0S?Ua\^-)[b,~
 $f&~
gq@<#`y
p?m#&zd
O!c4W*.m8(E$W8P@O1V-Y9 c['13btzUezaPoa7]QOY>ZTem.cP2
lV-[Lg:'`?~n#KSd&&OclnXIQ0^zI+X7LgU\Y?54F]yEQ6T-]HGH]\0%ZMsAbTB')bTBkl=P6Q6A&zo._A-g-Z#KE%P/[^Ih6>^BTq1B\qO A?5]<R)J+)c oLie5+kP 7@&?NCk,=-%P~R0L`HWY?7?Aom5wc>[/d;M6~),omvc=1d50*H651?D>1d@pOkt,YkbBDdZq->`\^/7!;}O-Fd2/Gmh{a{afz790c}^XL#/pc!FBooQG#Qb}"M330_E)VSut&Sac,`6Vwoo}`$<0~0+a@	0y	W,~`[9xAoeFHHm{`[y/1bi [dF(* [d|e%F<>g	
#AF>r7Xc#3\;H|~}cY_q26/dI^ ~>~6^/_3m8+JWNh)'h{-?\wV:/sx\riUC9Q+3>=(yL6ca)#x!Fsg4K>~HR~@D8qA#P]%Ck8q#}{_RT
7p%"MY")eatF^"0M(7#&WO|
 q#QV=_?68QBP{>.:q%Mmk%96/+Wl;o%=VOX`GO/ )|b4"8O"'0BQM=2(s_e PS"ZE"7wz%5GMTzUT<{UG4l2#"VFbu]$??`>#_C~@B0Oll\BAlU!z*]OD^%4BA{:]h7w!?|8xSG6L,S.|OG!e#SkkyxwFB_X!+7o1Lx=*&Ivo	B&kcg@gh5.s*~gE5g4cgz;J|0(w2=4!>G$`*oj|%J3U_UsVS:eRAgI06qj-|[K;'|;zo I*DwVSq('{XkC_J&mpgZ_y,LiEz0Ai;}yZq;]wK
E_~5(M:c@w&i1g;kF}@z-}~&tuaI^n.q2l^{]+_<}wW=J<7Q__q=[%RU.?\E[MB&E.&V*y5ETW.JN%xbm>kSU5Xw.G1_V/1Z]GG3\2?i+lAn&lG9P?E.v8w'kuU%0cxV{n;x);n^;8z^;8rA99Se@V(Yz<o	d1qr4h< `xFty ?>wba'~Dko@O#&y%?_WxG\YR{<cx</67g1x"=O^^@YQ89@&.h.^e{_sKyUGpnJ1~J?YW}E}OQW1P^m#Ry]6gm~se#s]y\Ss,#LG	].]n]bEn->I6/jc^]Yq8}%}o+Ts_|6}qsm}jwfw
*VwZ>J}vfworn7BqJXS_M&W&c}9g[}Fp8Bgo^>o|u>
5e|oKkLJxz<jnq(K0X~Lz6pbCovEZ|cu[pdw+`` nl5}V
;y4v1#kE&V,@$% )*R, kxo96zK&VP K0b4&VW	nEir!FM Rs/ptaE^naBv`/V%`}:G+l!DJTDcsU!Rmq8i jZ Hr sXCVehLc1)lhL]HYYE,P9\0 t,oR#4^R eU``	o
W<yz'h!c:0S[[X"|m	,-n[@k4!	2bT-7~ S"Fm* K'FMZUX;;EDuh {tjCS}
c0`!d0j.1-0j*ZZEKdcN@Y srH^C|WjhJ+E5;D%d7! F[*n
VqX_`=5=XG+c~w$	Ly[ty,"JU"56Q%-!=E[j~{HdC;kZwKeuzl,p@0Ay.Ge)cXE6am.PtAai5K8 ,>0.}"`\E[+G[jcv&2u@3V;amM6=L@9s^5hqb}R "FXSd4d/s1D(G Dc]<B2 A@F1V!	u`@	\aG2hw~HI;M@,d6F ly";7`%^U/zew0fV/YQ
oj6U$%,.D0D{a$
lDpao}xL#`FFXUe4d6@151S ]!5H`x6`mvBx^8@: kP?tQ%B@Ua/<h[qB,	VoMF0"!DCmiX0~;#x8l6 KP+8<!9J,0C4r=BVyF@R[N0n%j!1N{./!5gEj,=YHe<^!57S#R!5Y!5AszAjaO UQyXwc3m;q4CPgqHKR@aDy=VF(ElS$^6"^US{MAo*,&NhkzLc.\^b>(#+!bwB=7ib0q@15 }GX#BMq]x!nw%nQ:T|))2{z8F}DWK}9w#6+ {c^WrD_.o*uPPq}AGQiQ"Dwt{KH(^}EXu<hVO1X5mN<(jwq16Gw=t{k)^ng	;1Bxe:;ovms"jeAt Lu-DrGm 5g?FPDiAX"0*&6SFFB1
C0\hW+RT9|?1f	P~ZkC)i=%*FAd*GBE}x+:%=	P)3B9>FoJ0j6Qepw;iVJw(D&"a/&lOiQDA6pYVP8()	in3D##btzB!"V3lPr$Pq$/GB]S$#GQ}doMQxoIp:{@ODLE.F!p+pnv#^p7I!-[OGqTS8iF5h_=t]>%d$)+GJi>qd36Gy$Z	)S$0ZwIUOM(J@)FzlP7R<0[]7K:; {M{Y=:8PR
bciU6s |OBp
GGkh{
bDB%=/a\/Dx-~,u0dDLo3"W||6K0T._A04OW9PU<C}!]nZ;\8("\qm08nl&Ky^z.PW]ear^.,S$.u}t]PQp)0r3~V}lGa 6k2udQsCKsxFaG"lvhLc Tcxm4P*^{|S2~{)]J7FRl\
tl[.dBbdHcnT+1d:H)VdX;-:hxxdW&
F=F@j UTs;j/Na(--7#HvYF&# yp_1]I$a?"[xaN;GETc{]Ct3\D `BPk_^KV"c _ d+= {aw`A:7$AoA_ g;K@ i@2D`6z9FA$M^24^A$=z9i;M}6?>l]i!jw~' ;FJ2,/Fw::)Rs\5%gZZF\h`qU'W8UTD!)b|OSRf{|D_'gIfr#	t'B* 9Qi0Y4 6P bb	F69tx'ZOF4dPdF'9iDf2*ZjA@0/=G0#=EK`h>^,N4f	V  uT'(sc`{	dlu6D1paua8("SG; #_36NY}iYJeI,w80\Js#R\X+>%#!:B	xPgf4F0;  ll4&cP[2A,G<R@24h]:2$:Wy\v:z^An#YJ%f9rUP(Wr_a[uCHLZFv4C*: A)zv:U3@#B4W
p1\W{NGn#;R{Y5Oek|p^=O8jJ7<_N	Nm!3
5C6 4l(~
N1!<Dnm"z	{%J?"
!yB{et*if
:L}oT6	 UKyZ2=Q\q>'[LKIZugt3eKrz@/Dh0<a
=x_aNue@-YwyQ BLSop;X{I&vP0KCV)NA"4)@t3%Y6l\O@cey0u,cdK[*wDN^GZ.x+nK'@+DkN
sGo*l]L}_YACigF5FwfL
 H]+DvW@y6m0=jWK(a #;k!6`G\xK\K.%	u9Z'!K.[h	55Bw/yY!i6Q2jQP#I9[YBBOY	pc%Y[*j~F
eO-E@x
+SAMn@oP5A=wcr7S"p@@w9Q(^#-}=rn3Gr4H|Z"_s4.hfpM&DGcSBT'	UT;G}MyS+j%T4-d
Om!WDK1+h/]p'!;<@sA8`nF|7
+:Pht?aXczUEe\T;KY70iJbG_
h.cdy
J$!b;v)8qm;I6R}Cav]85@G*=Xjs.
|E?]v8&Zl"hwGFw4Tw!]#pG
9 j#bYptAW /EuM%6vnyn
=Nq#;J2+#JiL(G-y$;?% ,wwvDIO=t
0 zRVDH )-Vx2Av-D#!2|
4@ieEe)!=Vt&{q^eoXrnT;+%vm4 	EOvPL+GU[zP(q#\P\: 9]<ayU.?pY;	BALAGkKzq
b#4ZDWM7yQzDi:w>D\N 9;F@ )G|tx<-O
i
GYsQTf(`e{HrH&x*w&OGDcE%'N.H#7!wDv(rDW,)Bh	tHNTQ#weEr9ACdz(\f/~Fi\HTo$#A$IO%R#G5I</7u!{#?FHmtoW$sZ$MX-T1o4kH3$K39~K
(d=c 59q

566z0/RufB# 6[/h\td;r"m,%R''x Xd:s@]ArZXW`_h\kDtS,#EiAT;  Sve{"l_ko<ll[KAC|-qlKF->`ln]>-7dcol!wu8k{;k k"DmzrRe)o.=>M)~jRit0}MZ'Bvs$W(yd-+?zAE}iG{#xub)M+GZd"e]<WwXVzM@UUqyu}nTz/KOe{'D)0E>Ik'2{wKQW&}x?^MF`R=:|f{#-/a1;6_zvz=wI{)rycG
1I- +UoPA&>Ldul=-/p%}E$jwvPlq-;u	Llq-/CE
y|<e #d;=v1 qrn-jo1]2ch|9gocDjWUhr/YkEdK'VhMF,A}vgn(m
~spE?9TvPs}z{@jN=Z "x"8H-A04dG Z5z?yWY~y/ b#>?Kh'Y)"zH6g%])]B@F$;0P^ck\i	6x^0R|0^Ql9*082DL+Az8kD^cPC6:Y4SLk. m4vL@<JvOj5Wg}@kzBak*.3x*rWC:BTc6eQ-9x_i;^_=E'ge{X<sWKae[cut0A!z}@:0a4*r99=S^~vH?Y"zdeV<;}Wj~^oD
YF,,8s7!%9WBxU812"+8F6/![j,Z<3VFa)P%>ptx*q\z9<(KX+OW)1S(H?Cnf`.;26e#'pJ#{P|BKF;xM+Cg"{+Y{p3~QAoWcYsVWo3;;`LsMNK:vj#OV3<Z1m593zgj<*qGBybRdr^G^T&_%FF6
.ys c7
g* CV=QmgcH1q)<SQx<-_ /]B8TS6@-z =!A *SY=fe*c{FI h[XgbdAxZd+w`;XxVoo7wv`;}eV^p?w2
r1y@L~S1k,#t0wNs5s.cFUg/@}F$\_,]cm-X1o'^o?/I/o`N|w:.~;a#QnIw:w"M>|O>l^M|vXu~SG,0:wYpY]n<9Mb8_kXu4XWoX!`lmO|SP?Q\7,/r93`3+a"wYKwQA+x}<'	\B?N}AC}3Pn4of3^)jfr>LwTr6MqvV?Ai]yk_NW#}DQf0-yThV48N0%_Ml&)"a UY3WyE=z-GY?MDl]coYws3O>(xP6-uga]r-WMiV3	ms/WuQv[&y
}awsR^OY'<}uM7kn8Nu9-]+|?k{3y:_I9:_*+v>ZZO:anZ:iHH)r'&i3w,.kwrvwa!)_d.YK	+.XBoXBmo25:q<i:>Z3KTjw0lzg~Rn"8U$YLUM1Z\uQ&;G}'YE|i8mEUdb]l5V@D_^#1Zm}ol6`yP&M,9KA.[hLh&1Fu4n0Jw_z.T	e>ZBy[(X-~pid]`7l&|~&_P(fr@~O!:\	@eC Dpc0].@#anvMf~8{ln;=>o0}|KW8->~u''? /=<OvqxQ=sC,sulsBR]??^NHX\l
.| EbSg9hYLE5MwhGO7yN>~;8Z[;{=I"Fm%m"sI/ndtUfla05}v:{3YNK.;~Iz4{lX_=pTI/2g]G*Yc07DjDk;0 V\`",:k	ky:9yVjLgyf^;L-t8@RMlln7{q=#6nba[??A0u*l\9qwu0d|+*eNyn9Np~dvAlHG(ET<5lHg3<^t(C<y/r/&%OXarZ[Sjv%/!;[Xo&lr:;Sw>nxs!p?0)X&*,H:A8H&2<fd6p
NKh.nd7~?`wj	/)$^Gncbwpp4;'UB!?2ays<~S+YV{+>/O=~jL995|WU,NoP%ykElcgd}B^q~4/9_5!'O(DO#p~51yO
U9TU fTovL!b`9w6}lKy=-wj}q3g,u;9Osa8	S}9ucm#E`IV;(4'$>->o*7Bk\K/MDC'~A!_uv8%lV|o7[?ob}b9$>fuVS;4Q[d;a`I)7]@^l2t6+3q]WM,WI_f^IYI<gx);&r-+U6~H\tCeN$|CTdx$ca{jhfhvI%30r=;g"rs{pf6a'~jn_,:dqWqb(%D_JRn9A8d'u%/Eo4%=s.0ZJ)(|+;	zfzR?&El'H=-SP[O
{uJ[gVQ3RumI.oLM#|xw7Rje~'|iPr5*r
//Zp-L.DYu[v~(_Hz!.0q~DfP;;b$Wt/0 X<pS{r.KY/K6b8cX$ MgskpRraraM&V9Hy^sdhi!y_m3t)pKO H$ 5"e]Gj|y>znl&lSsT6|bRz<%?n/@{./GxjCH{'vV6s(P(|I^!y{U_4$lzA}`y];K}PZGa;}wdp6	>_oK.NKn;	L/\b*z6 /Cu*A1l%ofg*HoD7u 65FJI_6WhgE%3u\^HV~|b}ny}6hu//=Z8*q3l^y-AT"YO >P<=)&g
m!v1rQGsqREnm]r7XtEI#_Qu
DiyNO)Fnszo-dkf' )w^B.m} ]z+&Kxg${+[]O}o+|/r{z+T^ MY.?{Gt
|vkQfuoM A^h+t'E ;uUO15z3(Iwb4#	V`#d4Y`y''UHcBNbtUCd[PIdL;q6~DW
4fI)*lP=yg-|2,!I.[QW%(#ed;6PeP= /@HM$COI_WXZ@-j]z%Z=P/1:^qvZ!.$W	sv:$!&$S~)e2eEHL9L+.lXR;FZD~jYl&El+,\.C~Ovq@kCwOU:~1!&9Cc98/BlS,^'utr8,"X,.q"v%N	H6X=O	V<),2`9/E8tf '*Wy5$2?H:.\tGQzMfqS#.&%"#:_LK9!;q[!y~T,T7@U8}8}bI|.e.@"8.'uh2CO);gmzo>Pvu5mrzlvmgeh3(1!QY/)&J${Pn_
o_n|\e /XJJv/P4jrWy6k/arr26qz#oU@8KwIbJqeA+f
;ekV-<lkn|ev"oe&l\j!Bd8~eJ\g/2b5qL}`t72g].jK]^uU2;ZY54v~o;l6.~pz|ywojf]^{;V~bkK-;`ME%h0O! g:DQ(S{ntii>.0Y_L,*4 5	s	Kk6|7$2a+u;M"1!c8ENK&q$tde?g$@Q-	Halu.&TLz{ma] nS
>u.!Wc76F"\y^WwDNTQlV>#v4_y%tK)pHQAO?egm[87-VT
7P6?qX
%s*';_`Yi"X	yWb!8dp=Ld!='_3k[i^{N^}ttJ3KL}kSo Q0oF5I.0.Xk<1/(irs^A9YR6<9fsr?<42lG1x[~W&>x3wlJm,W$:;<#pdN$@H4eeDV k"hh.)@"WW:}%C
`YFW?g<=Yd YqB?t^>DtqF .`]bRi=.4j/6	o6pf5;we)v$YuZkawce{CmEBH{6Xds;Va3EuJ%KJ4 9DnyC$dE#=N&TqbdcAlv?vn3guIY]Jq}D 89.){Da
gvzh04Rf+M[9)pYn &thgkEDvK+J.-cw7.'xsJ(mH5MNpK$rNN)Ar?U	!QJ5.?d^i^h#a38B,w)2iAA|h
lFrC65IIhXb %*J.(|oO 1rp ( 5f
D' yrJ!(~2f8'9a2v]){ff 'Z^_([x
kQB?NuS\Su^_%;^gbC\iVv
*%6_&2V-iol\c@8Q[l74M-;V8D4>ulLz|;o/MG_!i"j4-,)_W1o"(vLH<)Iu`pfXvcUUA@|lZw- xq3/{q~Kwa}BhqDB'% jB|#PZ-hT	G"Mz!g
k?4v.Ppb
p/p	vJE; lz0Wi{x2c=HDXIj69qWQVi0f&]VL.2K+JFmAXSUZ#d_;s)`rW~>~ |z(8]m cM6z#X*|D?Jn`(K`Zj2n9zlR-qn*h,w?])-4f-sV@V412vDYiDRpA`,'NUdv3m*nu:8PNQN'S:#?zwi{mTzO
>UbyvYq8;L_{Kx%$\=7c&wvmK,ybESAtS3)|D-`78&`3tmf!uF$r97A^@Qc0*lj:6[Z.A=%U JtNg~&&GgEf?!;ZqG)/D
(il*8run7y!]urM~;$0n;bc3	5%5!O,zw-`mV<hJ-
 PniyinNKy9J+;uKH6e4}v{+N[5Z{>t&Am40UG
XsqV
m$7~7^MiQOlq4RtCU$VFVsMi:U0gL/IgVX4xO<h+m%('W)WRb|n=/{TT0M';^4cA-e\9hp	RzAJ:P<6,Ch\wItYt8POZ"<8~Zo>'|OV?ol,?I>Hw721z4S4q:@ =I$J:~>pb;#I@@*!~ iS26[ML4R[,|8&}+tWpv46J=yuSkLI.2mb-c{s0E6j*[<OF*sLxX;3 (;G@ EDE[]
:A)RX#"v9UrPxAS/h=X3GJD(^m!-	A%i@rD+E;66KD"RMb*aKZcR-'B>h;O^0WMDbAKSrU2:_6bOX<gfUPu)jzVR$Yx/> `~wN[u)J!5E.4xj";7c=]RDo+@Po[^Dr,J!A"*Q)Pab*
$\]P%e@RbeOT0L#OJZ/E*	dVsZMw7&y~D&a!d	oiXmL!"@Yj;8qGrI]4gHjPzsppv1lwa[u/UC+iD$rZJr=?f/?9~&mz1zfz'y	2q_ p%l1A()Mt-2Qh?e"6d0	P	[9J[hx@cIO5Q4~Sl!EOxWH:9G2_N/xl|f7s6 G%[*z .x?
K2nP|&	|Dw7Xs8i	4O9bB"-P|qcsQw>i^c*Cf82&1Y!0r+,.%D5\\ssENq~2-/}>G+&2e'50BdG)S;Jr(5t0m7KhN7#J=7K'.XNS.-v3mM(=Lc!!|l	.u,iT}@mf!
4bQj1`)iy@=&:,IDau//?Jfc)7,^m20ul+%cf[!k[GG$L["_tDF)/5RW1s5(eYS7DnlaCAb0*3=d;cxDeCnJfI7,`y`Hp;<jq^R7wTBKp:6oMI`G|T*yU\?/1Au{!%< EBEEhTC1J^0qNZ?p/>|T,CnJ(x?9cb/???/ar(%q_8@'s^t$\~0G@">K@Fn
9yr~DecjVsOFeV1<J9-syPF(wRI!PpHEPg%CeGv9M!VXCqh5zWl[Rs_C
J''Z{'Yb=k NKVM7}+ulJxdpRl6q2:Dm2j8@DGk<J\41shy"P-a2HlU%G%V5t}R,50td|!5d{JJSMqM:UsZ;q7~MD|Gk
$.rTE.{hs1^3G.q`r o	Lw;?)^(?a@e;.y8ugiwzRY$+(FiOz[v-R5>{Dg7;5KoS1OmJpM{v|2
pK.Mrq}:crG71mVV70zZ5 Dc#|:pxY 5LwXM.N!f#4'ms{AcgEPC/dF	\Woll.OP=AZiGDm9u?d>yg4CCu	={N~t%w,8=uE-4ikXS{EM$Q5[=z[c\N"
H^+-U>V l|rC.~J+V.2G%3q(AWpzP[e@y[ "ttU3$`aoq=\
c}E30Z}{2kcmNNZWOkpbReJYz,od[$[JDE=M*r/"iWJWg3n*HF=b$g*zX jSX^A{Ic-tR"blcoIV{w7bjpb@$>Ic1)[q_n+AKYk0# w7Nd+6Z{qhqLdR4gnvdBVB.DGG+e\~joRDz)/3wR-C]r~ajxtCf.N`"zq$%!u+t&[A<|y %IHS`&3.'V;!](f~,kPdGXk#YeqWe@bh;m9<\g1q_61U=zQK\6)K\$G!S@-cRFVa:T?B%E/HQ\\A8.Vx~Ek{u19#JS(S?l! 9 [)ym:"2A9%QbIo\A4uGd*^)PU](!	oZ\$sU2~/'?!pi[mIEcpzqq]'~K	aPX	*f@'%1GP=omRCf>lrQ|s?biv6R"VN T*{bHG+AWz1;J&4_ L'9Vp$#e:fR7eYT[d^i6YD#[dU>0S/)jU#OHT-ZsHcq9`0j&*bZD[DdsaD&~\lM1=07m6Sy`a_KoCw4U}A]t7*Qr>%%.9VCkG|!tYpLf60'/3]	P?%2[XseJ0'cd
qWTK$mEA63A)gdMm:1 !:J =|9	3^?}@],6~B3&wd"tv?r,N_W%&lY|[x+3EbB|}#y\.'2U5=EJCXdQqLeIi_-~\}v? I\OI[45CUu\#VP4U-e7)2+A,J7VNE>clJLq lJ%F&U0?ezo9?z+C% trdJ2JUz?_Q2k4E"2Q[nW%J	_F2+Zj`b'kLBCCpKyAEe^%GUbMe7"	@~8~T	Qc$CPZIf ^Z<k9N@0{ TC_\3sd.M1^ r.Yu$n7,/[)sbge}v|L^4^=aW^2
h1_fH|v@6{J{go.`u0O>Y)'+Q!l~l |PSs4~$d-=JRhQ'{3JbL`i>IM"Z|S+`V$fQIB+uUA=OU'#4nM`Za+[R
"L2M_hR/asWP_g	J+_^>9Du8BhBn>\9PEf){~MjME1	VZXU\~SA"(Od"sT.ATnu9395_a>C!R<A?w}6N}Pn6wC++rA$.Y{x2-d
a]"O%5	q^Nx*Dg5608(bj*-|-yI:D1i322C1(_(HMjqrb]Gt)1%-sHwBhN	Ud8kU; 'G<)RTNkA<fS,0(t}{>7	ss0@27l$4FOw3*NEz 9(NybG2V8+7Ar$/IPNA&rsOZ
'Q=r=_=fm(bG/lFuFq,UyN` Zd,.sn<&?:OL\d^@.G%qn'[m=Kc;*rBw;q"!vgZdVjmkB,]DIp1AT#(vMmh"./:q4Z|h\@P-$^twICbD>;^_7|oM.jOYqu_L93Yv~!q&vdYx|v?H
nnH]u~qyH1XFz$t(L}Vx%=!,oe(R0RP-_F>_N:!?-vI4SRo-71q%3=nL'tj	U&X%0`z<Kzc#&UsW<lQS<9[m
ZJ&=hu0v_.~u>e+s\6g)vg% m(d@:GDkqDm48mr!RF)chMEEM~/Gz:InPtf|(] iNbw#YBWC;3l3R"#Kvoau@>b|/o}bv?[hj?>(#4l,a"mQXSP_[G4,xYg}BO+rb7/$iICvuvSHeYgU7rH9?t]PVYP"f}`x=c
Mb%pkN^Hi<oS=5=cR[U9}S-%=.#4"]l=6$ ,`5N]IEQ'Z"R2;Iv}B,Xw2|xm~&,Op!2KD.8STn Vy6y=K;lN/9VD\m'J]:)JHgs=|t/,XN7H'?y(`a	 /7W&2Y;Bn GaLU=^SA7e6!}.$8JhZOX'- @cYM=p'#FHs0_l~ZA6XH0w4'Ca4~5v'L~eK,'?!:mKpKCC9HZR,B&XZ&caQ6IA<f7l6f-s2J~*QzH7a5QP&*$FGKvSI25\6_wWzip_@T1?Y6>+Yz0w]n#I(f%!(tKE[xJ"Uufde$$s 1 )ocl=#2H@TODdFDzx<y~J9(fl=MTlx1)v*SIsx
BgM,qw ;@0z}MINNysBc]$}t/" kW)G^"dvMO5`b0`Q-K.;AY^%+%mElR"M1M/1/tp"*jP7:UEv@&*M-Jw@TuX}L&X.stk|
i8y1XM'i^bl"9Gxg8FN>l>NNf;7sCwy:HWH2%EvdjW7~mGuGY\MhwbZ&HvTd8!SB-!,8FDyUT:ZE)/l!L		gJRVR^1?oh<kIks\e@^>	&%9F~;6>ej	-h!t?]i>FE!y3aZ&B(F{"+Ur/gRVy>Ve}N))dku<.*KUt3ubrVK#c5{lMuE;-:v:S$X/DAhs|EIrr\M,lK1T])n@<!rzE."1j{:M!gxSA,Zn"-||${m7T0dRhqY4k1)/3)PLDp}6qP+7*p758eRt:,iX7y1:LI<F#@ [e<8ySK:+yqWE(Wv9$U{XvI\dB)`#+J!>fyK=Y>Mm!w%SF#tKz^,Gv{SZFG6a39{<$4"FX=F`k^h8`u"j+$GR0u9U#sClqb@ky!AbD;G!8x`4@&O	jc- BdH2r?_%=j;O;} 	~XcEZaI{n 7Q9Q*ZuL;&X{cg|Q^"w;& OJc9lvIAiMKe<g3 k>A.61@r"#3oj*u1tzZ	ylNqR;?+J(73+@+!#||
x7l7_*S4BWax|o>2@u*B5%dhw)1sV{qIV}`lb:GO~nPk]V-0Sa{:dqjl})'q|n{sv{Uw],kGmR`Y)['(lj2B[sp!~a#9F(^B|:9}bKZl\ k,rW%lQ*ED6.|l}$@g^s)ap[ee;
20={U:m;wO[D$pC` vw(^cI4k#+!g=*,M'WA~3pKAv)Q;m	}/mugeYQ i Q="`0w/6_x%
g;N4-87W{TG%	
t<K.##l	Wq^7qw=vca7M,XU6G^ >@r(`_/N%2NWo:S\/_
~YIqsb-*	;n=jSik7nii##^H[?}@5Pwp8*yAd n.^ 6-kV\YYXM3\@lH3}%gCQ"H%Vy`;FY	8e(}*97"mPd(Me5/lWXj,Ije!Vxb4%!UjDQ l2U"%D|Hl%X4%EI7 d$kz[ kOXb$[G)yX 'c,?!(4d6AvGh
HR<Sb-A.8xwJE+xQn(A?n2^'"IwIUbh@s M	Um?;K}e<D:L+#XLYgTb];X8|q@{T|Fj@-{rnQ%+C67l){U)]huQaJtf>uTPvlo0$m,mYKz#fYXi_XL^lj`R)zvHl^,ZQ]I_-2]'[)RfY=v.@-F "qdkncN$7p@bjZgv;;`l??bEA^~2wWOd1sWH!'^. hv` *[ek$0VVc:hOx+ipi`lkko7+z>_spP&>b}3(^3/17+,)w%	[2^!]"EO p-a/F!eGo{lHzQ3E}wx?,;~[i	`^Q V]I56'i<2u)pspS_(/9_fW]<3~dLf#=q7P*c ytw~161EP-Z^4#?giq(?I/'u.psVp'np#W%n,YfgT_JF<Y~c[!z{ *Lvy.L1(iK~1d!Mu0dP%e0271QD^ED}|Sf.M`<IO\^i:/O>e\w6uN#^li~Pm,kD
DJgf(n$H-8S*1yslQPsPRS +! J!		9[Qc<
^;p	zPT%y/cj$Go'm!T[c<x*g&LdGf_$4mHLf~avsz?rS@O.t="iI7#}1J)A3&\}\	\?YX^2J{()ET`H&Nw:ZPIg%f_~A#bTN\R$Eh6ws;Gl<2pSXz?8hkJ=Kx*=E"$.:"((m)3=<Ppkb^'!x<(PT`_7RBhew]0`^[tv+0u{Ol*|pei8LT*:EV~h'r,!PR?$"|w\ "Tfbc=NE%HsIzHnGXN!6_%F"1~dbKjleijYg*^dMqk\K&M\ (.W<UrSyS/6m =NsSknq^I	}=0LN#js	tynt8}MM>( 1;(hYSus]f(p2	66lMOM*Ln?fsB/iBsi
(Z;~?{
QPAQG@u=Qij]q/aNyTSS1>SP8dF~WRBr_T|U,vE5fjPLn5$?-]nR5RN0KG~m]E0O{#J	l&TL0F=1O(y
xP]Tc
7'>c|d~KJv's64-s{F#o+6P~Ffx1kpj$$Ams#=s)yh~:&\+$}z.(RSS(F.vdde~jzhDX
RpyeX2;o2&'cMu2__s)/"_>Q |dKN$9Dl;r"8pH|w{SC)r3/br= 3 RJp}pzZgrL$}jjmoo}:fe*a_T!Cd?R=W;rJi1	0g5>S:eWL.{EY? E\q_GTa}I<"7,cNlMIT7_[{z:ONsIlFP.;f8vEn0j?3fFb5{MvHL-0/	Bau\0}Uk!Ydf'^}$%-T	g5Dj.vAT7%5lV PZ0P4tE	*$QW?/d:*qYEV!{quJ(R"5u5W U=gUBy@bkLQL$M'yz^M^u/Kx2IjpbRo n"xwufK0:94~bh{ H@^e?N.S`	re	n{mYXG |m6Mt\3d1xjdC|qS=omn#,8q6NGdlm 9[uIdRQaaUdnt6p,=+ys@f#f`:t/;2lGW	?]+As
9c#g'.\NL^?'7R$bygQR=yUE@[ y% )	PyN|d;$gFtti=6('?ApFi)kgDUsc%t'4]A|xR&da2G?b1;lF*1a|mo*8 {Ej	_'\eGho-y^usf"#~%#{!bQPesKm6uA.2:
;k,vDGl'A,oA<aCUjg{]:gb]	8-&FOks^#A	GlFKVRLh}[dlO&JL|tV&&BAKjda;!vV	iQCN6|1"  _Z s>\4aWpwLj*?NS!;n!B?vB`W9LX	)hF+w^:V	Xo$`5Eu<8i\=X;IJ4G|A&.Sus5ZXU*ZN!r5kqB%&<r Uc?<X4I`Dc_=ZvV[#|=YL5wtzxLLS3)+X{wR2aq+/J@ 89)*)]2DPxVN5	gtMq:/`[Qwe4`"A'DP/3F#uOT1/2%,P[RM6J/]7yS`'va?e7Q3,'cf/n#t|*m:GYqrM#P@ cN2W:l^Kt%HdeEu|^=bUq6mJ`N{i`*TvH66kO
B0*<Oq"6L +>xc5>[[qoFC:KQq2\'zkE)t (	w^]vLQ650]_Q<M&-!e@HvS96XAUg66v%9EnmsndK'Y<W<F(]r.y; Wrb
^aA({8	[-
#9PAi6aRv8/J?cg&P!	.6JH!.vPYdYk&M{_pI4OAc><aG['0G</9X6fn*2yYoDQ5;B3J:~JC9`c8"Xq mp,7Ag8c3c>}J%CPg_?{S}S98OSxa oWErGMaC#1_5
)d .p^>WTTSi)'C#\K_;iZsSY!KkQ
NE;!H!zhhg?;,Q/_B]YW[[A4avt ]]} Y]teuRs~mQ_2E{" oU_n$"+dn3/]m+W@G~Bd<:m"5<IWI:m\js4FN{"^sFmviqF'.4Y}su_%XY	ags	1=:#jL!uzd@[E/FA	:?ak4t;l(T$Hv+-bwl^oBIRN.e360QCM&=`eFxWNKWq$z&
92U=V>)P -D]X|qhkAy*5CPV<@\Dg[[b^6H~WsET@n)zX&oO~ EIT^1jHR*gGgg'{'I1noQr~#h+%nYO/:g'Ca%mY#T/Ki`8Vx2^'8&Z,xs.DY0_(F-n*(/r}5Q[P2L@IoWD9
+<1A=m[vyu(GEOl}|4x$
V$2=zjV$[)+YU!hs<MvT[MAz}+G9I8B!bN7\va|(6Q{)G@LbkK9,0>6mrW zv_+fPN|aMQ6D(K+Hpp+:J'3"0cU z).\~3=TOGf=NKBiG\Na6++|R)EK0Nm]S!zru(E\,/}`QXly2-{^N ]hIEc>rGQ$}E~_~r9cDM
{%BPQ76\FP'AZ:jjTDnKEMYe7/)p1_cDmju9)eI7O{QxnSaD<y0j0{P7mpAA9dnomq)e-af<v)sj3So*}>p%fuOh{U)x_A9Nh|_qK`*Y{xYeO,@ Ll9ML$A$	WTO	VXJ@`$Sor3~RI_^*y	!x6axV4>lD;}Qni;ZHRz!6w?l.[_-"k1;b:hc Ir+>._#
JRELf|7:^
c`?MHOI6fk[d+T?b]IWlX`q!9O>[ Ndyz1E5M*dTeg0i
qr3'G+b99z|U%!s986a'8Wj| {Q,=GhPQ;pYqFGm!XP4Av:Rc~s&}aU]_unmtsG|7ajBbTe3W{6(|fOc/4;fl UTX*@OILIM66h^?}2/syx@f~i7|7HB8V2UF.k~V
[DiZ:)O	P.\wQ	I1(0LI:?Cv0)<z-7v<8]uUxfH9\Mg=_T5@3x; ?'L yOy<z3-GoJg]P}dJr9a_3!7Udx/&rE7 T-$Tn!HF+VETyJUo0!:F.&]~n)b7m?^^aaI>'0JBCl.eRa0<7l0Ox+U'Sgxv?sV-WZb3/,enx(S3+|l~(UkAGl:"!>1Qqg)8^
{>xBU`%AAUGU"W_(Wh[M`VcM,	B\h>bY]EQ|r#3+TeZuWUBLzv??>yIPA6`|\?^DS>{/D$`v|r.g'4rG-q	&g*~I>%VD7|Ny23'$fv$7	w0?UuCr{Lxn7l/^vS-<1C#'O}ze`q>Mb$bJ{*F`UD?oN>?{.}UYVUmAMmy": A=F"nI>z'{BMKv@D'Wxeqb'eLJC\DUjE<{~V^kE5UUlut}e2R:8<>zkvvE<)*1~egYfU;z~
 HU'&`gl*O)~6#/A40:F]vTU$	R@%b`6iznn2pvhYNg2),	q@{~L0=gM:4&%5ixq,X?lFjhxHk ~qRngD4peW>,Il-f~92Hn{<RECb)^M UI)B5
*yFbboVXw4y(([a=LoCmxl(t(@^. mni`j6>MRH)c.eh!@ueh@4rnK:JM8a`$h?bZ6Z7C>P,J,wv|~tg
[82X1[h>O&n2e4H
&R3EOpW.8r<jf=A	TJt 3&}w>9jB3/2C^m1	
+<r)"WYMFxk\`U)EZvn"G"loN\R!#F&Bt|Rm3en})x&YhF-]mKX5&Cjv[ 1ppW	~2qO&`)?i2GX4%#f\
+Gm5A#TLg6mkJj{f+de'
-pKwWYt@/|{zx	KzVH0-QYK1HbQ>}}:/7hkQgc68,?m tge(=j^[o+n4E)*uKZOSv&V9p	zv%TXhF([d4Ejw=b)C WV/"^UjZ_?"t D3<"p1Z%2@e"cZu2Jq0Z`Q
oqZ_+"fZa@6?|&C\$2X$WK.o%`C.AOd-zPV30F>F|>ZZD_]%_m	K/*pG@~9Q7;scnq.ClwA6<,
}Wx`kJ,VdYa"K81w90nf
a_m,_<,e&_ |_f/"B+}:OH".)/"RBD5;5YuY9<Y;,qPjFh@()66PSIW(Qq)ynVmp\H:,-TO?+Wj_nUE:%iwDCiAIH F!bN:e^5
&|M*f]}Af\YU[LeFgAts9\1V_j"YZgAV'`	`zYcP7!:LaT4zYEl{ JZ7&j-fmum9[~Um77}px:<3 }k/2
Ye1wtp~t;8ydU6%6+
o-Lh	4f#EjAMj^=r@U^E CN /ZVrxYj|E;lqg\vc=6V]vWKjpE{o{*$p2M181oY7`0:D++!^=Ue6!|'0eV8ya7tWlY3i7[Y8h1&C;/g,s,o~s'@X.HE:vdMWR2e6_#5| z0?;aRqZTe(C&'K-{j9j-2/~ WVE6_]}[Np}.3P:S<4Uh14l|S]U\/Co9)lnMb$'0"BAhoyNOhk-]xLzfM6._SL-lXUmz}We)fS{${X>dFrtiZ0N~7]G6vl0rv.2{A-*A~:fO "4>zt_KL##<3pwW?E{%,7OP]g=V]>2pdBk|CqFZtz(
or]t5qZT 5v?jj/52TGU%PvZvORku79efwgd:+{ +1;"%S^S42"[_&1i2FI&}&V+|w}]C""Ix^DHhLht|8Mmc_?os;b[+MG'R+<SL\Qp7d9yEN&=wl-=nd3tFO6\w\
OBoiK%L$XgemWaT&)8GJQ],_kP;	Kg3)v&a(UM|R)e:Hui|QV~W*4@9B-VTAFU6M=O<,A H~My0Z[6bC[6WUoE?JiT0~i`B05?ktguiNflW1-;&X>sex7'Upa
vd8KCt?hO;PH$B!8Q~co|1:j p&9$O
EpX~jZ+"fhl
_M=4Bb;:W"ky.jH:?e6ksFUv$A1Zu?W=e+s.#ESP55vcy1+2VZ
?v-Zx
3Q;RWC tk&1h+/. kIE<+=Sk#.yGLnok4 D'{8;Z8Tji0`#>AC]&1)_>erY6V31P ?g +Rv|V/n0ahp2J9 wt~2y40BQ"F+,{fWSV	lB;;;Ih9Ba\Lv_[<u?f[u|tOkq"lP+F,4nB~RW$:2;jfujXx]RVV9u#ITm%Pf:%<6#I]oMK1E^O|*b8Glr(A}N 	 l"syz %@>+=G-s!8fW}O?1 fectj,gI^wx(j"H0a>= I1Jq-S()I^~|hnCOF;#2=s8I,;!u7 Q1_V5[}D}| >%6j4$dg[)E2>.,Su8@|G[D grb,#I^Sr /~qH<!N1Z2Of.}wK>nyeOG&~n9
Z(=d{N'g~]SB  .qPUSZ,mLtd^'VE#/|t8!!=(t8-dXk6MHG7yT5ePwZ{ahrgEK;#e<&11&\T|?bg`K"6[YeZ])ETm%|{- >)[Kl6YSM}H
|07ntkhH#q~@7%MK9e cg_pH{fRM2MXB+-]]N	)3-2q%/dc8p%]i:5(Y~6L&4 t<cKgsP;gnbwOv;#qZqYPU|"/e:IdNo'vX:[.>{]yan>IupkVF}s7	6ti1ND*!U,c]7:8/q9y3ALVdDhi9; Talc@)	[@cv2xzR^&8/mSzo?a.O{=p,s.+r
W%(Rm1s#'$@j9vTNc U{[xwQ
&e(9
]l5ip[ZR`X^
 8':%ReNkO!F=*l[HP%gk}WNf$'l;`zm;Z}Z;E0ziz-!*H:XzloWd/Of7,
M2YU{PH[7T=[`4w29w*IW#OKIW
B+Gw_PmD5@>"4"21
*/Y$JwhvY-mr)owA,cw\ws:k/
yU*Z.P+Y}i&uB]M)I F\KY|k?7O@tp<>JynlC$ZXN& \rA"V%=^ZW*+my9'M} &^&)Dv1oMW}$cirbp4	!:Q&\OB	Z1VP9Y&Tgn?8:O, 4sl,j/Nqr91'to~'[PEbj`Oxi x=qDqS}6V2"PO'"$x>w*j
X}zr"q|AN@dF7I6A>O7:[Q\cOJQC(	Bay3f@U;W,o 9cXIJ*1A8bD^WoxLdpr{>@! G:6z#)8I7b#he2/lVYZ> fCiyvFITw;tYGeMO#Jy;]qG}CD$kgjnPNuv	G!^},?a}1nRY~PWLHcO
0p`brlG/ZRRa$TvY,9{1xw{8~XEE{.q1~}	we
 ".
z5M7u"WdSw^iiip$?Usl#[NQ	!mu)UO|?[WJ,7pfmP^,WMunb.n%{}uCB47O&"eHC}2dp<Eac3dcGg[!*8+IoCZl/|7|~fxy~~	"]w+N<Qb?M'f]G*czXh(
B$z/Y{R5?&EG?..mAv6rFq+X8((^Vi
R tu_qPn6`'emCc4loP2!t-*N#Q-
j?#*6a}RP}4n\s"p?6_: 6LOsBPNnAK9+J%ijsBi1HrCJ
TV"6:P7GMlWl'|d7_{5e&b2pCxH_xlr]kDS'>aS^L:.RKupMqPjWuda*s_&j^"zmO^[dw)3C0H/M3D1|KB_>Han5+s!@&	Bier)!n"Iz 4pw,$X}R,b(pM:nPxy9IVWSC8l8tyw6jWg#^-\9;tdh7_jWEz}nwI;Ikmxq/Ofm<7TlMkP^xV!0hgFlo(i6JjFqd3aD]PxOuv_ts&;a20H	a>]uh0 G7f#.cEdDB|xKOR+yr[`rc6].:'yQfIs	X5grQ?
R~U`2Ar&MB D(bmRQ	e|_GHa2np<.WmQ"X(x \R`JmZe^S2bM!zXnQi(+FQ4HqpAxi@MQ@5~V7n'Y<oG0p3Y]XFfXr'WJ%.^*
YfK
p*,9/ kC|*qJ=~3?WkLT928$jcLkOOQB*kx>WDX)G+^yNP LO3:&lV" 
H
h;MQV i.Z? NdRFfXj2O3nU I-k^M?+QrL0d#>6lm5#8
\Wo%L'i5Wqw>OVV/2sY9taMD(hi[-Rf0*+fvj%?Z|!-w,*wD%R\'#(.t$S|\#cAorFYNT}(F\W;m[h+WAu6AZ}5}[iw|\+6nG<2I90I&w1l~>4_?;xSUerLfx4S.?&Rr0an0qse2w
FAY++A1YdAW>CDQPIxv%]dG}6vrKr0Wj[X4l}(/K6Nl'[$lVRFEIDo#>FG\UI8+lD6=1@XlaO(t
E?M=N|s68- +=}0P.5+q
?zE
pl[(%8BpjT}[& 1Bp,,]+vj|55+d,X*:
)N@X7Y?@E4X89l8</?yn(8pP$Bx(T<7is@%)4y/>vSM0~?O>Et8QH,d|Su u3uwut!t77YpCp1pNI4]%`(uW,1'PXx	s>-3gpBb!B\aF|u]2V#!ZQ?UEG8k52fI?^* 00}TaNUHj8E_JKC5`V9^
=}Pium9cci&w9b8bu3]9h0~: JoN2GgcGt2%ks:>cT
S=-m
Qd~kwy3+H/~p]H6z:NYi4Dkf323IRLO;rc~bu{<Zo},Of~$jrUL&U0Twx:wUjJ)"	+[OH:X'.Qfh]rkU^JSYh:t2`
,C#^WO00/Z-% &s-3Zg1 *-k%wpO*!	DI!%YmM;ZFAu(*r ek3Ra!?{m?JppWf ??T 2A6
tFb'!A*bi?UfJm_%1nfk$D 5'X=T:}'IigybEArJLhl.RW~N^}^5Bq-o1Nmf	z@B9j{t="5+tZX=}Y>|{'U]_o]|lo.ClG#@9|Q4<8;p|p{(m+?jo77Zvxkxx70jb3_L $kU	L)}r jz"~j)K?l(	{]p*Ee"^(%?(,+oRi;Rdj"LH/@MvRhV 7Vz<f'fLPH?'}-u}6bYHS8ZF.'KxU J]M"R cv`=D1Oq'8GV.4CpXP@z5>Ldygu$(0QNa6W0[;PAc'y5Dq-a9q5F3G+&BjEk6.1"Gl<-3C|o~P(K;Tj+H4&h=Db]0H(9d&,!kEN=#[tiG1th
<,?l7$r/Dp6 ]6\FUAq?x [a[6m*aV>Bw?wV-{knh	]m'Y)Cw39	/'j`4.<LY2znE^3H`spR4S	3]ic3uSnt#W5p ZG"^]:qL9VUPIYzo)9TDPsOz+k90<2%rJntl"v(\)vG-(DUL|wx=Qlp$VQtz[J-vQx+\j`*Wu+6SOukH
Jn$:uhvJR|cA=H}] }UME-7)ba(S+JVo;=P
)='V]1Dc6rI{Utni~]5"5L/1
i%z.R}h{y5v:dQ1e5)sAN&/yOkAE
,?8nkllH#Eb~<0&sf!`{!d2H<RJ!$do1%eOJ55|4Vq9,^v&v/^6PnETx$=w\:zz >^ |Yv)*y'lE*S!7w9o0SHnMBeL|&KLa&o|fg^ 2QA8iK U<9E:H~BrVY>c|T>A;++mZM.Bk).lomtviDJw;s6?a<'2:O?N#y~~ogk/Fu/ a`\</ILa"?	vPa
{af$)PkYb[P}6Id+GgYPV^NwQr]{(%nf9&\XD&i(9Ma*$FR'PH%^*N`s?=$x{j!Ku%~9wih=j%FiO<	_.3_z\tl:bL]<x\{LY`*SM8KMFAcp'7Wg&A>1VB^/S;=}J]5C}e%aGZmwltmc\+V4O!3l8m}Hd9?z_keCvY96T!N]t?[,0PMD7j]UNZ[]u%qM^5 "kCA+o*8_?4T><NESDl*"E%X(((gUw&3b%g3Dj~Rns.V?;^]n$iP8j~'3{P&-XEd+TfPGT8]0n4Z>F0Zg_8EbJzPyxP n>i$]HBQ(	O3x
T_&m5'G g2hsqoT(IZ?oSw46r
%XsRpT1~1:'_Lyt<lej3nvdJN{z.dwa6v}[]-vD+`U%nSa;>)N3$:/=B"[34,(]{]w{Uw0ziq," |wlg<}S'Jab`&W<wY]fl^$j)H]SjFTrNr&jvw?w8+RE6]4Mo~N.r0HsW@8`%/~yaIyX$i!V"w#e/fl+NF_`#S}F#$PwUPanP V=?\~;+kzM[ZnWi^7gghk3/ Dl,cV2#0KYV:ud?C#buLT (A)%[9B_zEu(X\M:fjExmvux)+Ts
R\lIVqC})PO$=2`VAa?bP(]<:8s10\yQc:v:NVs4/:,-xy*@	:IY+nqVi,E>7WH)BHut42	4V v2D$ejgt?<~-1X3R_'<^h'ae2X?kh5>uc$Hs6o6Cx*%k!kns q|2FNE2k$Ut5GrJpM4iP+A:sl`hPD58Z,i6
hgyDJgVoo(1nn="5LKig{?Ugww59{Mi,0v^3o1vu;u;1~>w)fv^?{bv}oNoFKwdFQ;b<zurY.&[lLm{Y#%7bj&,gX.`8[t/Re`dG8mrZb'5v|^	Q,9|d"nqiom1.;#3Gd-&KBQdWghnL|9&lc] ZfN.5QN.\V.?LQM1WTc{"GU.vFuy8`tfVF;
2Vms2j.}blbjh\Uno+v=m7SA<re	
wxr_#x8C&,m"w/gidkFgFg{}#xjzP5TAC%nx=<c{;MCl:/-I&btswP(
fDd9%X\L6~01qe?(l3ANT	b$,EAGvm_Dxq6><-"]slJaad
wnGz19a><]w	_$?uWAkwFpE/OfPN	&+kGx/Gx_Gk@8SF8_$DjgEH|4cGc>3H9G`LY>2ca1fs}w`!}fV&<YlR<N1EQ>w#,2P]|i) :l:=y5xh`YC.:f`"O"T+-<Xd3@6`S/8]t57AQ9i+GLy\)BkvwK{n3$x45@Yop	_XeV\_sZN"mp0B5Tk5p1HM}V|b2D#KpSc w|\0.qF}W|choDe1^0|8	pU48g\Ouh_>-V;szxmhr|q1kLj!d8_QSNXW)n_&NIR+]dX1u4&_'o,7&QC^Z({8CdT+P1P'vUL~rKy,gsMF
"v`W	3r_dueB_4@iX:[[!m31?Y/P,!>B4iB67O e+*uxX0(S2^/P;$Yj!aR\NUNtV[6!PwId*x-rIh8",[DYuTW<hhAg^nNu**,-&gU.>-	Xg9My$wMklg[O?tq}i)ClZr}a1/IhSD?j,K=	)j{olAH/
-	fe=]'[lx/(?_lPlaS"
q^,|` 6K1AFsSbb%cg2F	*j`hBV06y"o!<%V!$M[ ??&.1Kkue8|O8YzO4^7:fV|FuqKu58U,H:G;!{:L" dW ~N?<4J@I+P]IhqehIHl)e8s 'BKtO.ap,-:_/&{w~V=	iw}2"1/~"bsv1S3A)]BTHRIIK)hBb[T`!~!,/	(]yK'M=w'Rcwwtx/F".14n
B]tXQ=~q(zT\ef ]	\?b>WDFVTo CP|UBZy@tZ@{	>f
tv9LYn/SG0to^[_$vXJX,Pc5fE&=rDA2@nN^=UN>fd0M'`0|v@/\^l7-0Rxlejw`7Qu[p[xe6 ieK1C]cadQ(/6I{zT8{ULA=|)YeiHCVX4Kq(J0&xpzbab+(ET}[@W~|d%#1pM__*9JV:!MkIP`}[L+UVT>q8f2zP-[Z-f_;/f	$GEYibkf(l6jPbmI_TG]kL/KZ'wgs5QAZls:{]k%CuJJ1]*!@b9"Jd$TTI^c;12:?)%C`sQ5[n{nSH5'e?(p?u)TB~jFfg?0,oyIlRzs&DoyCS'9 &'u4
Jns6*Y+0@,l2J?tmt
      w(=~wVCZI	Yc[ZIIV2-%uL9eE9>_hRdfXlP(
P(<{/fe~s;o;,z(y^LE@U\/Co,M{XLf4;wtTuAv{UUzU(Y<x1[L2&NV}MA#_4d=X*$Us*9u29E9	e<~,{$fNk%"5e8D>EJG:_h_PQ5f262]vlUu3:'~ib1?U"jE:?~%)?(1eb<cv_~~t|dPaJVk)LVA*	b^Pny*E}Lva0cs>:e6_VrssU\.JAZzU]+3QLqayFt0g"(tr^>&U#)% Xp,3#vL A:Om`@W?d=c2	MW(m, nVS==1@,)5-}o^y Nk~YIqqEFNo`(5b z ]1JaE5W MGl*8	H]m<8UfW$)pJBd]An~P,uz%,UdL92oss"pa&vaU?S*\+%aJvaVlw&x7&VC/EDTQ2yG2Pw96![yoQ'  
U|\W{Ql4],W	%,ulQ/Y!!,`MRbEEN7r(rC/:Z{j77e~",qeq;Vz>Q~v`G+F1GFwN|<28:KQ2IN:,NfG+WyhZ/Mj%)l6nsZ$c1EMlfQGfn,e3_PMG=.&~RBQG$y;*j%)DoAC&j;&2tOZ85	co
TB;f-~M-a}?.|1d[#fbivAcQ0OPq*{m"Lh
#NU&IF)Ih@oM1hX:c5*KCF!H"u# w(4<-dd{V"}|$ X7)/ACf2 0$5	c'6*YZ>sXw35jSaV(VJL-Tfp8r_P=M+]2p zK N]Hq	]OUOu @\FY9|{|%eRv6P9(._ E1kk[x,ibYcGTF8&pjZOm5N4? zZ4PG
h4IjU"+@E>C!hgp	Xje@HPGqVq@5oe6i{gn*[c#)pJ*UK
J09>fTqQ-wgv>=}-gwvvS,>'R7$7>i-$|+`'@RZ8g[2ZWb"+B;bH"G~ln*\@tXBVmeWLWS.lSA0%[afW@Oqgxm>3r0HB+LEV"-	gzm6kNp6{X4rZ, #XTf}+m<;&9poykN[W.Q+auB=1!.fG^gmK=*8S@:dWVl/v(G350H0W<p3;6YTHGm=,@KiF6a/Z%@I.A}GSf:
iI	iWDH-*lZ[RiIPSU=&OAO*(T'HTf9G|S.pbmk }Z>b8Aj?mA3
<es'^<I;JixJp`|7Xe
<d9H(>Hf
$KP@l[t&YSvdL|hiV/-|8Ze$5GAv8$ExXe*$vh+}gf?e[qs4`,H; L44/a%h5h|x{{B4)1hRq1hND2k[Ff];#? OMHSU$G_l^/frEV"O<~8j#~:`)JE:ExPW<>~35t4}dYx:]hjsB5$Oe)$	4\.uD'Nm>%5MiCxe]:	UmYx/$(Y+Fy]BP4$*3UirfoK
,bKx`264:O)uz\rP(dm)c=GziI)4Q?|-GO~1c?pu8)t;kFw[xN[}0 ,5o-S nm9?PM5:tB@JN:Y>3k,?+=uk
<t.iJ\$r<	a(#N
w`JJB;O`j3cquW`X9a
8Ss\
"j m7:y7I?f'+Xt<`3b1Q"Vz?=rr?
%+	;el:Roj&	2g[yu<rcJ[}qkw\b2_MVPOVA0gd.ezoTu'9s+>v:TZ2blYZhAv+;,thYm;{1pJ1dx|~5h56_J*%]"jlA>5U5X>te{EyiYe.(j3`Hu~TuU~(Vm2J.l'=+Ybwq1fV1J=g~-?b_{~B^ -jL|)LfW#0M3xgOMl,JD)	Kgv|fgr*+nL|OM)|B,,$<Me~bbK<(u`8B2V`;92W/[_,7'0;[Ta}T7cwX|e74/-vvO:_rNl}+wK^8:XC/kV.k9kD5Aj[5n(^
sHG$"]dt2}VRIF3#(G{N}'M@ 1/j8~}KER[sMY6OYXK77nu|Zs-yH\e5?BG=ZXWL=n3<DK{jy=
8|o3+*rH3:zD}3Oa4O<GVrbn+|{&h}9~UU`<l<_QR=t[I^v~u6 O2Tq1LoYe`.LgN[-*{/*Rv32k<D7//U2=}s	k{oqi17mYE6Eh_]TI C24#IvTVV?_ z4{Y7S37~nK#Yiuk
L<WY!,jTgMSi>&n0_gHRsqa@l]2; 7kAwPyKg<i|%V{"@O7IOL*xJ^	 %+CsVXo_ntq5{Loh3EOMN>%;XP"PpU
B~u=devg*K6Zvt9 #<,n+EfOjz'u2Cl+"0[No>b4jDF 6UX+C[UmVjmi$`0O&\^DC>.>~^Yh-<`*wrD|T]}$#I[tE_~`:3jbo37>^oavW/+>jRY	g/	U=Yu%ei
U?Hd-9M{3Iv.:hB"/c-'3
	H`y9_x-d(_o`cVXRAfG`l"  #(Q~l+nAmQ};qSAt"I[ldO.._f9ckE>Y,}l_407v9^#s]tm%nFbVtOdAGWPA	6zvGAwe7tl+[&K93,@:mO	W0:Q{RG.q<ZR`b7%~#hUYmn3QRs';Jq#JyQ_S|} #CU<I?'?&&,wRf[ryd0~Km{a7^|.?|Ca?|CZ*OLpyEQE',HOc8F$yp%eYTiLzc<b3X_F
l-	|zZ<LoQ~ge*?]qv6p#m/wn]o^8%y	+W0yfDGn8DA8GzD.x^P|aGvjy@jDuK*2
quV6ECle>f-n/ Gsa8.L{_3@NW(brPf(]ZK=A\a)|vM  }Nt6k3<OoRj1MB	2D:%#:i7i?`w4yo0CF?@<UC|60~8Zza<A-`Cg(~o[Hew
_Ehona2* Y7cX1   Q<&(KY-^${to;e%-N;==	NgZ'J25}yx/Y31*8,pK 2(E?p9aNg6>8W8S&]b'&fn36#>-jVGl|#*TJ];hO:F24Alf\2IF'4Lzu+	ih=,k
i|TS 9Q|X?X\5[
fF[[R-[UVE#;6PzB@.W~
le+`e5&vA_Gi:j'<U(NMI`x!$#y0R'WjQb,Z$jVxNMH?67b_%7JTp2`hxt8Ib;oAmfd$=L">Cp*VD"H%A	9cYw	YxM5@F4vct\.)vyK$%AIZ,badhxx|e_$3I|I]-@nowC4VaI5ZiD|[C%1Zq9 km*d
t:c'e|_SrD4^W"^
gj[5r18Gzte(om
8rQ6:]Q, om'
f*tX^wh!bV\qxQ,
[.crgH$ebs!1n5Pl#h/TWd]JZ8OUqw]8]Mwl]0>v 8]>>02Aa`lg\oe*v5Iu[uj7xej7odl.vr@FY2Yxq_Sm/;:k"/[A1PuCy5S|t<	jIdrf)PX	/]lZ	^z)Fs{.; s(PR|12,xo]2sb,^MI(KB	O}^kk$XUoN{{S\{o)c"Tk2Kzuv#@	77Yi8-)_%jiNbje7-`|YW>`}?0<X.l-n;weCUki?ZA9<K*.('jZxX5SZUIA1WGhA/j}-{9^Jbejwp6S)wi!Y_t=)ur7`y\T8-} 	U>'k ^*s7R=D>cE"c$4<EC:7X.^>GVi^TQcBK	MA 2i!**GwT{7{P%=_-EXNaVK ^]S8w9wU0PTe!U{'0- I@M$\	h2 wRKJp{T+ff_YAq7}jCqiA^DrP 0r>D#LX \cm?4NGTl/f=|FSLU7*T#=W97M6E"\v;v;bf2Jgpakb-77'a:3DBCRAhA{8("u$VxAfi@TQ+_Y;UHUj`ok[F/?~W=z#Ij1w-,-5^+x=LQpvV(@QzTk%2;K'CA[dhPx-`M\\scqNM~m!:ku[)Bs_ul%fLiif&LBsoP}Vz2WYi%wI{?)vg]=K~/./~7<3x&w??2p}\-tsl2M+*nT)Ug08VmZ61XG)QWQjsDc.`wx*\qhmj6w8hVICg<jn=F=(9v*4^S%.$!~'1)u_]Q@x[5iWP;~}8K22	NFs`]QXvZJ5f3/]rp2e@W[JStVm};S`>iH5ZZK |3!@\RF*eP#*QjVQ
nwo6LVbZ$Zh?m*\	g[%NLCu0;zU"u5?1u?Bt/*n${!DRKbPh)_XD+20|RTfDRL)vu(&L:#M:1MuHXV'#i>A[wW8wvpdv;X	#SIqq^vw,hW<nu __^CQJc3i-^,7$bY5Zi!SPw3#(20YiI:G-M_- 0]0>P0.GowBGa4n&eu	>`JP>>>mxXGlsn1ZkIl%__/h82xpg6pxsB};1nUS@Ykd.;	.~58feGt\qM__<wft2k:2S	<a([jh26@MiS:KT1 kl>zg^-fF114:MJ-fkl'8'w^D5,c	C;c}wu145v|SwHuS~j
D|/.QwHCZ*uNdI:8"1heX9"f()y<r-uuof{DUkn~kCY<YQ#Rkcmqi.c=Y[/!z;nwWi<t]IC6CF)\QYM_V<2>oe@yV;#NkF}Nc eS<TO~yF_xU6zDfVC>-r{1j\qPF
qzAo{_)hs{!UnYPCxPu6+2+S:	b[]H0Sr
H/` ol xgdZbX]T`ld2	$^d2U^xoztw;~
hBz}mDWpg%M,rN2m 7WdLk^DiD0p@g%&k97[uF	Ls-3f;,&9q9@
apSn?M?cMA~l1/d|D:GQ0/*Mz\eI1Z6ZG]z7/	79":[.g`rG)0~|&,e#l59\9+asd](C'[bj<bW{w,zYU00jk8}c'?c#3/xp]:i{C\9e_nu"yDFuH_Yu@G W)pJo[^< 	d:BTcvB[|`LZn!HTTcg^i;U[sU
Mg2NWN)JS{_z)x&Zp{!3DQU\SgrZLnVE92b+qnhV4r.8v#-
>(Z	ajC]@4Di1}*iTjsYu!
9dQIg0 3Itx*Qr3'&h%*)L<{f+MM%Ez30-Crz;	H!9{5HHiC-=Io#EO^/JW`,-80TRivV;rX<+kJCrf%04Yi,x>lW{&+UYr]Ic3N7T='?+t0MM`1|
Zg57zZ0tfn4Qm"5=%-
iquH hvcX!-:lMw<c8gz-]Yd"j6o&tQKBES"1`f,k/1Ikaxo'q=
#a
zfn	u(Ei`u!_bP
gB$WP{lY;0:8aCgt-v DU;-QG]h=_VX^Z|	9&RW,:wK)D"zlhiVC_h(7}avxU+]V/ 	_eV|BPDAi3P,i6	=U~^&64V,k2%qVtk hGX_'0ve5x	a$9f[.GL+MVX(0f1
%lPn t3=6^Io &kTKp9e9Pr!(UBNAxKYrK 5H=z|7%cG}:,kT)l>c=ENct09!u*=W=94b#1KW"d/\Uh|Kjo|?aZ1jqY]:ROxlgBYb^1g*jsug*+	
us5_
0H?kd>N<n8Zb;hR{f$!>~H|-'~Ov2\l_`g7Y:=[x}#+nlC}|TN%?m#H bnW*
(KvEc'1mCUx`5@T"^4>akw9jlw3\6.C[m{&8NWtxo\B8&
iuW+6SCE%-5[LPBV`i8gk3Ac'Q-73^}s92b(62>OE,f#@JKr~|Fho6G_cEQeHP[jyELbm&gy8HKQwxz_^ !b/WS xdCBt7U^s6J2~fj{rm.bHz^Ip+*X\*|sHK7}
p`IiNavv? R67Q	I^aR8Rxt[[#LV.	!9}S|9c7
pq:mbo71'|YDPw/4ksH5V}u{56;DRV>5t{QF|%dW2K][{q>=Jb~oc<TKR6M*2}ZX	YKl%Is{!npp(stpY,MA=EtE]T8qNg=X7uDR%|o>pM&aK#_:.]TxX'uTa*Dg*}K.uk)q6uGiu{^`
FadNa[pjx\6wdw@eyx=u26--kEj#qiv{fivP3~e5M(ud1NM?l{xAR8SgP,q]Y[w|Cx`v}YFU:4?dn4$Me~YzKaj;GlYe;fxxvCj	<22M~bLT{A/^PC,}+	NF(QHNNxPgIb1wuQ|igcJml14Bevu#1tnqu64l>JoTa`@G: smLP$z"[/JIqa~Fsn$w^ u2(f.~7lZJzVM6a.]3KSab#`@K 67sCbg0aO9Q [JpO)Q%vhwd3)Q<HV6t!CDl9nAn$[S EUqGi@VSdJpt{wn[-}z/e^ww:[t#NUp\3-0RS5qT$lE+CR,DA;8e1Dm`@]"$wWGOUwk1U4y_U'3 9LNU>L$V@YYN0ML4	
S`Jk^+RzWa5%]:w>Lz:h! vc:#,jEPCTwR/2`TN=/0A)"5hHCZ1,,	G0-YzGvBcB'j
g@|YbDET0uQW t>oGQ_o$1.+i2LCjaOr,?' 	[4"d'+>et!7uJh

$T;?-5%)X >lbh5Q`l\L_E#`.>^&>7JI-2D1)7&+"ou!*\HSI<d`]TRdNG	)38Im{}@}M4/8'1B)Gw$g	0qL``q9.nvE3?5m	?_(HoZ,By|cB'7hCnKpO\OvOdg*yb(Wc-[L FXGa3=mD>)Y+>.Qbm3V;rakw"-c,$@vV3E_-/8~ai:*:J<fGa;< Aj_ zI6Z@NUj5xUzD JPf7-r[3%nZr:#`xTXQ@J I~reV}ZH7~	OU<)qnmeoJjjj~X?Y1C%*(/Cf6!Y?Y^cl,di^:anR	4?UVR/M}BE;jU=8dB_WrY	sLH}{`1LL"TZ(TWoZ=^G=ZNV+q$5l$;Ea76h.|4UN'\a=qqFB.c%2J/CW/7Btx
+|6g(I:mw.v.?:g	9i^+y,!'UbX9,7Px5:IB,A6Nm>,Cz9+bBU=^{1-y{Y8S2y{,0x
txXrAu 	@JW'++j=n(G.+'eDWHzls|GbQBj.'\${V=Qe>Ex"50pP'gsQ@`*J6Q5&,5 #)"Gwc@Z~"ZdG0J>.`:[ Cb	#IVw>@O`kSHQ6M09._G`e*HD3zhpm-i*`X,TLPrH4l6Ny=D]s?oSJ2NVWRIV.p5
?o=KEw03`EeZ `?q]27&0,cL$E/ig_=HC05X`y_|EMdqL+vuhmV4 P.*^j1fN-zDr/nSU]Q@%_K0E'IpOjlqLSa|VG>g:^.[Y)iBHWuJ&pc;;D
zw'Gi_b9Lw.??OTIG,gCx1Na@4UvOKJ??~uMc RVuyywrrw]V 7h\Dxz:$^~{67]w:;d2<2bK?_^o4N^tvx:8;HqNWY/+vQfhxj_5K_:A'4	rpw,p85eG}(a|<R(XvU'S`L^fS%~W2EO#|:d#RV)@;?z4[Y^32n-o=<[dN2~stx`Mq>e+<]?FQRsJjh]OMgzf5't^wztr_Oi5,<"+PQX|8,cEiOAG0g;G >~wW[\GXdLuT^''OT?+fY@<{(`ZL+PWlt2^Y{pcGX(?hQwihU38>~;xnb[QLCXN^|^=VAL}le1bP<|8w9!5A6eacIG?Fz)zvwz7
7d)w?^FLa<B%[|xpt>88Gw-kr69aLU_j

Mm%F.#6,Q`r63|^2'%.-CmZ?<%9WFP=LOp,8,8b1_qs|J8rA@3;7ShBa!(Gj{L
(gLy/\:L 	)y1lxJ9NP8?})wi&+3
i9wc~T#8!#^K]jAl8yhVE7Pgw1Yl`uYKq#h=g}LmnYb?mj%x|,v|=1jLg9vYS[]ZL^%mlib
D]Aa~8jrCvp<t1FB_'dHB_JpJZ|J*d">pDS o:AmRmc/&CzCv-*~N2#*/#rw;QdlLm ]=G
nvOGeHp6o-qbt_eC,J*L%G3UGQ64lJS_zNM<rhmnQ*wT'~9C*Vh)4-!NtY.	NdbLqZK6d=)^6z7ukp"(Jq_l);9tEKel4_4&&c<~k;&cT|a)\q>3u7i"_[`'kSez9&\3-:n)4?eW	<7V-YJ9tSM/2Uv:;',_1GD:<3h(N^ }/<CvL41agR^J[wkepU.!-y:?]nu}y;	|r%d?YD#0]%7;UIsYv6_`ra,LvlY)<}aUxCYjO3A6Co!yZyJlF1 Ax2=VZA,8,Zpr^(1FS'kMzG-vHYUqbc{L ~\\3l>`^2T^tmW89#<^[^ C_m_HZC[s.tmboZnPz{6^d[i6BdRPq[jDvTei-v}ch6Y6\y.XZ{ u`j"JDBp`#.n6@,U?`eJ+GceO:o+9Ahu\/_9Qz7^+\`Ns*f]c)uUh7	YSP3\oaD;~_pt6IUSi~]Jt&@0P5]8n}K#G_\sF,Ew):B A/X]f
T1TvU|rx)bJT M';:BVq/?x;ij3#`|gOy,qFbFbj>mu@'
L.qIt}BRaN`q;_OjQAzA{7?F'Ob|OO/PjWonbKCR
#3+`IhH'Eod4/fk4V2}}>eQ(%d%R}jg()j,]7L*X7^sv\C0{{)!L)o
 rOsob3|6- fZ,X*FHF)WJ2I:DHVc
,J^yeMkUhkLup8=kR!l)'iw:4(c|^t2uzQ20=| 0cn'7	;eEkpT7U$zlf:ylU{|0SM7PA/t0HFR3t7pC^R	{/<;x{dhO=7S?WbRGnx9(GGggXXZRF*]"~fhQ{`\p [j[/B{=qER2^bL~,upcA)v*rFD9L^6y[kdH}!O`z c`.*R9S]I&$eaBdO=d0:'e( u`]b1>/qs}EL*B) MN	;hFb=8DA^05nkN
I:W^aPPSS8J&<No:p z	U)#*Ks>88#}Zt*nnMr1hS1:w}BMt x,N%rNjJZ\jz"?(n&70T
5lv"+rhzNJ+>}^_<>wxBi_.@1>aDzB^Wajcwc_`|p24/vhcX.,t\iG@eObs?9mRA:|BR>]N@t4W;\5PLRO%1JW]z6WUf u6!^r~v})DD7K@goGg3T&%$Px g5p!?O<,Iz7"mozbS7mz3V70aw<vo3A:Z0\Xsz_qx|4VfLA0+]Nl;3Uem{C!,$3X{I25vDS=*H$u'Kz>,~6eiZo$aHhclxK._Z1+
!)t1j0f+b*G-TZMM|.pTb8*qPrA(	uMs. ;z:;'S@
$g\;SX,jXju1Vj7+`>c#LU`m5C1f-T\Kz/xU|S'Fg2j4Z#Y5zM!k:]F\EwkO5x}8]*hXqb)h6'h`I1oNh6u,i>C} yk\. O+ YM3:R&K^FW2^Q:jv,VuH,bPr9g8Qg-67#>F^`p	n^=31LO(r|2F9@pCG{xrfX]j']*kid(<	)09F-_}e6dm^so$.:B\Qf*=f]MV#hpLVOl*d?G*o&8%k4}`89*/o'
8Mw1R%Q[91Sgs\/^:/6-FP3x18\Rc]he&-l2^L%J>u T'#D)GMO"B7^|hkaUjf v-t$t+E 3~jkQ5 C/G&W+CB@cPu`Q=&Z=JPu6M6`}HMC,`VmJwV>CBS* ?pgO.ix#)0ec#s\:)a33U f@`)bW'<5+^
o&^Rj49N6fbgJ7*?`>6:X/-O,>X;A/tg>bW^\]~92^C\QRl7JQt>}h,Lu&P[M-`=ieq;A^7nWZ!4] `ujzQ;l(rl^CPkj-E?*wh)J/L@,mjZ~-{c]qfi|%?.6R}iCWE^n;h4SM?*{6-pi_B#Ggq4+rtz(?,=@]LU&4u 
8c,C^s_Lq=&-, ShGJZl=2z}9DU_~1ocpXXLa}Vfa[p]J98\E=f$HGO*.OQZ,e,/ p&Z$81j= vco{"d
L$q1DZQkHj#MBCD]f0V'>K=Igq:3PemH{|Jmy|zf -I^W$DZ]Z@85BgkT*{a
3f~-Wt#aJny\;5v4]!uiL)qj0/U(d9jXCSPF9}_}^ISbl%uW~|C:AOgv[)]d"1QE
Mj<i?{ Ug; ?PjL>	uC_	L S# A1l'xpvepF.ScaI(3VSxN>p"'`cuCKk
KLmppUZZn\w3cX*m3XcyAa(@UW[Q/-F[H^Q5~w \LqBte`<d{*x}c&6ZSg:C-y4FqTPu;|G:iiVJ0xgOiG:.dHvXtLdGoUS$KnOF?$zS^eBo*	^H)Gg a2'il(M3# @zXN]Z}Av*~" =rLN 1^ >Ovkv9Y.-\SAD3>3sXx9W,Q*?.SS,f&de?c6] 6GdN}&0PTT&rh   b_VTQkvwCqPQK#(.c_8GRaXikBbka5HQ6[K~s
B;Vkw-"oe,V$liG+:`%byS]u>oMI-+Vrs"CyL>{N7*=>@}gmiNqYeFap2PPI9l7![UU674ZJtNrb;+C{.W>EnTjHcmIM5w3KK\?u*0ORk}AvZxYM	eF*XZ{l6_:sqM}S@W<#UiL4|'3p&Mqmv{{pq`tvn']s0Kpa^.;GheW-}KRJ`U+H{7K1$t`6fv!qu;DC$+lbQQ(L6]`I"~|*%u1Is7U_)hXoxZg
/_0eBMZ:600v`}^29G>wGv[*~^HSjo_"tou+x9!Tzk!Pt!\Hr*,Y%[ FG6X.1pSB<m@hlVAiZAt!7c1HW^s8}yQ4#:^v%cJ`,wNf5LE';Wr=XI_`4]I N*H'Zy*Cj.e`Lt135{_}p,3:~a'+;m\eg5d1y@8-k|E&'4Nc^6VN;\uOz^Hj3h!Dz=R$a6\*aY%:4US jCB&}kBx>"Q~zull6-S.8t<#\#=mV`mk:]_A!%{Pafq-c-/c.wLWjdB  ,+!l"];lwx!
r;x0|PLvW+
<F:m=6:qkkRw7Rn}@SGbH-hR`3j.'tC_{{_^.Zwrny65|fwDp|]uq["n(J_.mz/Irb*@(qK*e *~#b!TmU	ua~ER0;*-<`;-";=:V-<]_
C\/7O:u1mZY#2n~D[gp }l]'	@|y&*W9_Z['b_m{gJFP',05%l,PQ+kBICBS?uk`uZ5gH	[zHs<V="u]9XkAS=N'
4u l\WH5HgBl #(MO:sthvd5&6,i!_Ei5U`p|/FZC"N$RLW-|5|m#**+^WN}(6
J:Y ?#y%`sSCK, a ~qSi~EE,0g"A({L(Q*7WY&8@l^k\}to0l[b?KcV:b2"8{XdD?VIz0sW6sGB>pv+t"lQ_GWp4F}$FWypXf8|CRxV!nvwD_?Z*

""LVkc]co3X>5Q8O=NSD+D
(:\x0yoA	p.Pu2E]-a$QlBV-bGf=/+,B/}`b\^h	-,$t,[d1cl^tjNl>}Y*LD7=f7"(J<7OjR$[7WMX~'`mYOdz}$%X4pk{K#_OF'-d
x.$'c+V?IsaM==veQ@usc'uz4#mCu;LNI!)$"B` ?L{k[(5 H~6*cv}(zFU|$^-M*y9FWg@LK!`2=K;Tr>e+#-T`1Vc(#3q:4
S~Tp	cq<F/3cMLOetg6UaMe
Mj%J!u:iE)U~#Gbi7:,VV)]O{y7	H"*!FFE?-Q|!\/y+s~
AC`*5Q$l24+>N'L7)kN-\N'}3Vs/8bj8E@qG46@/vWE{tZP	4
'?VTjA,^	j w"o nuRxc`_{{{Gfni7:4:3J.4jn-;C;@yx~}}/ OSjuOzYKR3@C`T*gY_5<|z6L?-%lp3`TNxkX* G.hz5=zPgCJ(~C&4mM5./=Hi&pA{vJ}!l0qbw?;<,frxaP66S.,AR)"{\+~5UgQL%Umc(Sd|0B%.4'>fLNx.yp5|t5WL"Q;N4q+!e7#:?WoweL"5PdmyoG*Br2=4%$#tF}?-sQ7.?q.cv4p<9mc7e[Z='V~u78)&r2$eZ;GQKBuMelOL^""elI!,kPUA EW<t,1+ hOT{=0u:NJ&Bls+ eZ gn,+dx8qhB[-z/	sdId$I/rnPG{P=3IZ<N!fTM9%=1`pStiRhoi=Wx|W[E}DirHKKR{;?ZXt>;=?;?>j3>9iXN:AIX+DPE!>h6Uh]QdOAK%'|I@_?/7Bj=I{Gi^x!C8sr\;SFKtrEr5QxR$`GA 9by[b.nso\l;\j?T &/z
n^m@VsCB-y1pQT69\%K7b5?:oG^V]D[%I`xIwP$81[GcWHM<}x#(8X>)]*Q[y<]aO/i;RWef*jWU<eATV^'EV^1I{.o	y6zUwYh= QgZcy;.cot	3FWC.+4}eL`*h)]lwdh/4XcFfWcsQ9}3DD,~@x]7;+!-c%;({<GWF`3eq[ VR[z)jeKVV+XPk	6 fq|R~2v7@y%I8%rJ*D7<`"d13TwPrDrL-!^$j{A%Q\i(j4WJu:e?RZcw6gi<Ay^EEdg6a}X^w>')p,Gp/tw31>p/9fTb(t&N]$i&uwFsoqBs9Cm^j96vO2Y8/+(Xr4aNX<s6g'qh
,,Nas!"Oe	sc2J<yVVIo/03fn#uw;w~R'
L#-frCWyt|LZN9Ivr}k|O:t,vvm3m Y6:}9@f3L3\rwEvk[]sFJpl jYZ~tCz/k.g255n5n8<r9Q+R^CF_1\s"=&y]0fc~b@Gh ]HcqO/SNWQ6n\5iAexa'g7ZK]|dO[+b{-^SKM1mv9#hJg!	vbMsfQ^6 dVf+AC#ihU&v\GuWBSs+[,0jc`\jvASA=R"CO@JF\lHpJC7q2}fG=L#?$HW:I@_DE%-Qx H>[uk;
.i/EJ%C7R%Y7-Yv\<o>py?IhG".Q=_e?j~={.)=*d3~D 	rE5\%c<S@(IfEv68"LzmxCDVr
jEnO	6N@tv'S! }1 WWi`tU0fDjhEHkKM9c'L'$]<]6O1O=Uf)q3f,tD i-UCbAigDH>PH{.l|[T4UywlC6m1htSTjWr7k3}iL5Aq3P_[THt4o> ;a)9I$S8ifzM-87cZd4;tz=Wzb-A\
9wRf]fKEXzdpaD	00Q3 t
&uF&NE>ArP,Z[:iwED%S8+1$$6&1uduf.9'INIS%p$w R `dpOfv,f,1wU_	]d~"3
4@xh?Q8
"?ge^p6TzQXUnx2uQFSDE"o{(hV&44<2=sF]%^6faK.c<b,P+|9 >gy\)(\U.6.C\"
-H8^1uW1Y<25[UIWSyjQ5q7~E?t+j7[w<~VzlOfx`t2Ez+D%U^s_5eGa|JuHZ7Sr+-
.XT<CZaF1)bai5e,
uJMa&p@Qjy#SM~^N)W57O!{~^~:<DJ=<swNDp\Qdj,V(2>x*ax8L ,($Az,%$  Ri='Y7qi4}
.Y}GVPT<cFPqR%th1	|qAb<{-	_{FJr tvZbGG?&i|RV<GuYtk)Go_EXc
1v0(vm2=D.|+wCHAS}^x6=6[ng/vQ78!>z+<MpnVk=&2%|8q\euJ(JmkM+7eK&1?U]G':{r:7Tw%
+_\/-q'^wq=QQC#}Y=`@cJT1at$Ya	}^"zc},v%ou~'_5.DtVm*[.T{.qW90[EsQ/0KPG\U *kB,&zB$$mFV\U}xp){D@CLyYn;kUT8?~@{m-L]':/-#E'Is|	h)vJn8n^	EtT}GE##OJ\@>JFCOn:N>IcS99j)S'aD((]hqv8)uYDpo[vDa:`E:p%WX>}<'?T,p }EBrvvML?K<Ahshzb1Y\+c(,L ~u/'CPd;"Lj/"E	Z*ft]%d1kUQ<.[^|Vrv%[6 -r-u+LfdZ?,mfVs~l
tDbavl c%mJx#wyRVlp!wbLb#`dt<Xnj*b/ZGcV|OEo9Pb2I8{<t	XX4;_\d"EWKCrv!l!A4YDc|Wn$_5p	1<}XLC Up$svDX[7#mg48g6miM6j[F1&{Mmaoi+efrXDvc:R52N%{C7jH.lPK];2d
|Bbj@S)[|mxo'qf~*$RTIHc/IsY7F+>Q8P^Dd]$vM/3"HBH8#ZYF+9]z`Q:~S<:l<jQ&"Q|:'e{$1@?jG(Ze_~fS^lrK! ?A%O~iV')P,d*]wG1*i$EzN)f#N\FQ8h+ v,9	SfU00,T]_T 
^I}L<Hp/Y&p	!r5 rCQd+j-s.?j_Y?j u\,/W	hhCQ'!%5&A8L3cpC,G7_>ZC*t_=G;H}U]ANjgy3
zs<#DM,;NV4TDN9EAmiv8
%w3/:XMc^T/MhD~~O.U=j3+2ZX%kC8[v$|w|#Z[""MZi*,3I#pZ]?%F[33N]r
C=w
;&EB Bz8K%,`2Mx%p3A@l+Vqt_+`:#f4z[gRh5!G}X`,Zk 3FG6YYKY r4aWi
% {P^Jn-]x/~Mssoi`kJVRB3o&Q@VL-B>LU96`]f`X&H-D"ZZ^q!%lW632zb_G>}v6rcxK?F-t9o_"Y~Z?"&OY})mDp,r^ZN'[D<zSf,0`3	dOp
v	|vOkpwn27 N[O_^1E}8Zn:c:_>A>sUv+372E!{~sAp6xL!o#xz MW~zO?9y@l,2] +Q$77@	/Qp(SW j+?GvFU{F'=9S5N(b#"%1xL~li/\}#mE5V>6orDc5,'Z6[iLeGj'7:8S}3[$,+wh~\}n4gLwEZL<K kh-PBDQp-G]	_eL@QCIipA.g.C}[-dy5\o:	/)4^*OS3|il1aR,b6:cb81B	"P	/>*!
.5:K~UUdf&#f7,P+Lr(6%X
 -En(QfhOm1wk#YacK5!Z]V+9!m<w@\w2"<|%'I.hf1- b;JU(PcE1RaQYX~U)21G?\f#	,Ql:.Q`'$C8+YiLY:sQR9*%Mf+I>B\U^vEM!6$Q^bA1U!P0~fP}7Zm(nE	
!3;8on,Ahg]eRlPh,Q:96HnYFB8ksq~g'`Mz!zG$hRBT<1g-="x<	fs+Yq*ATkT~#d-;]Tj>L,H}f7Zf[(s\u!R~Yf%H9+'?^U3AP/cY?:ys,:[^XG/?~Dd'
LPH&R){b-YR~~,NEad'BU'>)4Fc~}hkqA!CojeH\9(+%L7~|/
e	Mt7Hu|V7`}&oQQ;B|h\?Q(9&kE]ESEhc+:OF\89aeRuaOK>13<_Q7RPMGA{nRW oL``NUAU\u-0O_t-Sw:mdjV%xta[3ON8R.}>Nw}:zN,=94^<5^'p:.AQU3CptAUYYuK5XaH0b{]+{@udbI:UC WHCE>@PCu\1u;d*w<.	.QJ,+w@4+a^%Xk^(wZ.$w"L^Sh02)~vXQ-j6d5N	`Tq3K5SrUK*cVF1aUK~(8w-/im.Kmm~d{;RU7p1\`v0TAHu!(x$l/>R%:w\ft~9+tRpv9p3yTD%g$j8>.avs+ #\\ (^eRDYqOx	-J>y7_QQnW+o>fdN }[K*DPL? |FPC}BW/Ja
}"q-E wP"1%'AtTW+QwJ|v" .=/-k}u;HEmME7T lnR~dqlZZZ|;1rhw\	_pH&XMkt
sQ"}~StF	F(W[;eV GD&380onobqzlUK[: m-77F&s2b" 16a3tq7	^GLp^_;a&1bxZos, 8hqmf?8^~^[d.bW(R,PZ.{5\[cVGY?wi7_2wd[UnFr@X"(%KcHJ 8gQAO
q\;J7<P8 xz{pxBkfj]%jY:nIV./7e$']gXEYH,)4wq5x_JWk5a~L8P~O1g%-S|p6P {ErmA_/dQ/[%Zvceb+wTepFPQ ]&:~x>.K`eeceTMq0[<e*[<qkQJ<.*h3-&ckzfLgsW&omCX%g\?&H
A8E+S  ^Og'
J5lYgQvH<%~1q0cPsl<*MR77JHU6+Kw: 5{y_
'[iJ9)h:kgm1%tQ-U}Cn:JaA-.h\z4LM"\y2%N6a7Gd-{Izz~9Z$X^Gj)de/sE%jOM#Q.A8@Fz?3{2$1`YcXMrYw#)I"by^rIi]_ffw~<77Z.`AEn@lo.~	I17y~:=C0b+kn7:%x6{r~b&gf\Vfa?mbl\1,34Sr-;V%9
)hqITcng>>~/ls#6gdf66m#{==6{]77o.v#d.ud7g"Xg<.:X}m gik^+NI,7Qwot0WYjn-^c"nGr4bcI3VoP{L1L(ZNEkNz-&M/6.)	6nfCwTo5A-w)Cyv0M*@gME-9{2]r sk@vFW|N`LwLnK;.q:Id2u)U;oFeXhY	(axn54Xk|T~D711dA65[[.Ug7DSjMZj: d5VcO(Fh^XK<$'u*,2-L
io,WF_AwcN[KaW1Z__>;>>~8O?oz9o*w'5~Uis]`?	?Z
Bl@zdRif1om[ cc3+u@ow9zYaY&_K,lM^}^<WU:31Z]?}IA,D?"Cs~S9-nu?4n|`~-z7,d]<n@%wl7oo-g67
W>Wgdf$[Ju>w:Jx>Bd.ALCU<_Lu=0s$Eo13P<rbQ=Oi@5o&x _Z<.S ^F`w  A_	g`;!SjVkt`O q8{s > n(pD /
m"hhEhF[1&?6$Wi;jx?n}j:U_N$CLn;AF:, vqh"8d+9iZJ8NQic-au
?WVLhoAT'?15EY:aT}$|4.a(wx]*)f@UMRDx'l;[Jm] o@ y5O(g`[VS( !8,O)MXy.M[s.	a{![3Fm*GVdOEEq'7l>{6Pk=y7FzFa%kK}iW_<F%?I+6,K)e8DI}wcT]6TX0rw#QFb+} "$@%Lkh"c79p\ C xT"8CQ	eAB-|P.w9u2/ioU4m]03V78}2Ni5R\42=u]6N/X?wBsGm]9eNeWa(PJZC1?lh4|ny%uwF@y_Zz+1c{g=b -&l2w^	95Dy`?K7uI $S6Y"BJmF~Z{u
D ji1h'J@wK^T]Y]_'5i
1O_k9Up5?u}@QT!lA}
m	"+(1smc1'9lA* 4*Ir~^X=l8o!"b O	JNA4	*	\azReKZf;L}!V-m1ps?syv @}U\&E-m~!zja#t~T'/WLIG12hynft_@m!z'0HS5=B~$O ;p#KI&d(:{u="Anz&V<>ysAsS~}|z?T7^=0[De\i,Ifss>J\:!*Y	JjZ@5o'GPl@&YaL%.& ;z490vm]='}f4x$|+VS9CqXXVN>v1gDAhcg"{A.ru!Bu=O>
V<I'$E'	h)S34:&F7sChD%;a
*IOIDG((Ft4nPEcykA\}(n~	[8
@[m|u5 <7AD$d9kp7o8o	ad_hlSQSI2NZ#[nLk%
u>-rweK`z:9kkHvaaw=OQuO
&Ul"
 ]rR,KmzSl 7fU9EGJT[EII{f|#{)$%2iLJi;lPI)f_Xm[e%"^aE]/	m~r#/4Z(
[66W;g109t8<qu0SV?Yp-Z$+4"\^07r6kTI'1O^[Y$<<,	<I5O Et8mn$dD+%<_*X>.V+_J?!3&4
` !Q6d2DY5Ed8.U)#;H#(3sttR&+^?U?[+lt9w.-}%>/"e$g9r	v7Z:`)9s@l'@R-7WXBbMkd5YOm\q*C\4Vo 8\ D_|3sgDis Jj&cW*f%n4{]cV8C b]_%` [oI8({OG\Qu2KRRyA;vIX!Z6sr>y*3	Z$6A.w9-':;=oG`{UaM5_cym6(LhH\=KxO6IMl

GK!s =
LL^)D	BEW~/
E7<15
<AaEGbL{v8y
;p<P4J&nh?gk7p`y!rGxro6g9oq"u&/\{'GhLGAQT79rlu'kgFvF=~`$?zehSX'Q[R&/&9dJQ9$2 f3SSyM~5RfB'zAx{*3qJ)5Mg]+f$X,9^	73G]PJyuotf0|MVKW[Y*'$*Vhi Nn$jZ
){(sG2m^FZq>s,+^^l>eG8*$I&0bl~=V4h^3HnJ?JY*,g 2\A9Da'e}8aH9>$ eS+A-M1fHh)Hgl&3aO/AYk5~A3]L~(@#F+GFbhX	oE[{=)x0v#X| _0s	))Bl_|&}%m	DZU;Sf864E\0\Krv@E+1*wr{CM%C
a4[L=HgVf4,:sM+Z9y>K[}~f6in5?7~=>h9:wwI}sCo1!,lot}jhw POM]yCfMX}Oko` dcz^|	8+f]9jit)Qn
<+jI%_R~OPT
:I2:e40,Lf
&Yt1dBL sj#&6[Vg~yZ1Lf)|!oayR%'eenx1"+3Uuz>x"2)e7}Y gK%Aef7-u}z2{e|w;F#oI+4R}2LqQ~/>PX	mMr^J1\DNUG(/bp'`z;hE]OI?.&SfG(4^S#b/ZppWJA]%(835z}`|C#~DWrX~j+U3ZDT6LT8R3!;Ptdr)Y?	29e^;M[G}PLDYBo;K]CT3re/,3OT1;RR(wvaScY9p;sY446{ePng'1OOWU%ml#S3VkJ820f:5ohd-Y&\Tu{{:7PZ)u^ gn&|vN
wHS}S*9mDw]2Wg
jia~v$eS$Xq4S\*)'B-VBGnpUEYgm,<`<# CG&W6Iia](X4Sx^t`j@-jI[K7Q2OQ0A<si`L=6iD/wzM+VbSrWSon%]b5s7&9dU?vMNX>=3-9+5U{?|om4)3px8&`fyz~kj7z	I2p^thE99o%a{$K9T#v~9SR*tz%]url2hZXKn*3cPHh *M[ l&Scg.\V
<"E;"||2@w%bs'U8jAvNlKEmpa.* e ;J 3gZ-8?Z>t8Q4q(z&CrFG{@qN'(2TdZ>"<MQ'~,[2"M0%,U'(>$.55jM}W{Aj"].J_IF&}}kU%GRg.HG]yFY$^'zd|h2"?<8_SO5E/fP^76X[TZLC^@pgI^1`?<XS}oXg*|(Fqfz^%9fXI6TkJ%TSC|<(usSkyPV5b
YS* d('B*y"'UYbXM
N~	+~jQE2jtlT1jI@GA_5{}'b?|onU"0.zTf86Sc,nwE4U*{|	Zoh~ ZnK_m3[3++,%H#&9 Qt^\"&|__,FTc;]M^<>>);
Cs[I&/nV(8WDI<O!;CWhlaK#]	%.E~qI)g
;43_(i..e:8<<t{yfq~kt/|9mESl-[Hn| "4c;~[ZP,uyJi@(Cf@:7[mFL$0j`V LrR+EI+WjjIDdDb&]{McNnel'X]	wV(+&KvG',r*>h"?8(`;[Z*]>_/SVc;oNotVt&h9jjb.w@L"y`p}t)[{K^nor4
 OutlmE=DP[TZSil|?2EP gCX u*qd(etlqh6&p{Wd-lnp?c	*	`71xF9:OazQ@fNe{V=y%rak5gX[-
G}s#rnC -'_Makk<hxC\M~,>%~kB	"..[I#|%1Ikk>_(BKV!_aZKRng>;3!8]g|p5)&xr:YGkt'c0h-=*zmfu]kVvJq~7 c86Xd;%Tk	<Ldf[]	`&D58n1%P-q1Qs_.b-R(_x~<F	_ _q?_F8oB0d,?e-^'a >O,GLq$-{scA"OFF7<y#,k>hw(g%^XC|rV],7QbaWB|ZVyHz3l\7eKmu	W7CW	y}:	R8h@jNEBsb|Y'G?(bMvQ.{\u=pe:UtBGL',r2WQPZ-Ov+4Ed+O* X-Q/
<sXXt3x>g*81y MfJ'\plX6H:]52:	SUdAlc nAw(X_^	pTnhC7M~L/c'F9b+1c#wycA^y+JMO?nP:RvFdbQE|/z^Bj FEh*Zp!qy#LV5(\!gs#JYz 8"h|p|t#U=1oy7VeIqtZBK`N-'jAv<2n!W,m@vlnywl>uo10Z`7G0e{Sk%6t1yBz+7.)/JP9.m|@gZmiq$oE3:MqlW2WqE$)4LGS(B!;&Vwa7{N<\C%I3,!^z2VW'G;eW2GGp#FzIAKpf2b|#XjpP%FUaAK IK1{40<KGz6{| 5`(>"!gh"q*4,XF<wy(4ZIHuFe<T*: ;t=U7T
[r4c6G9LfLbLLL1k[i6kkZjGp+|yczQF:P8"6Q(G1T$|1@W63@T=6'}$7ysl	Y,oFvL&cT:aC<sZbw@9q5SPjZUg)\^U`r':.y @7	#iW
'>T;wM7ih,,|pco8T|MW{#d^7T h`nK$&8Ic }j-Ml5__W'}^eLYzv$(:S&l,%j2/O]&b`W5|yk D?X>N	0h'8?/dQ/h_XME<|f|kA9Cmy	Q[+AF siJTeySsY.*pB7}/q~N7Od<pn4m-SNX9?YeOLj.cLbH=#fKk"6JaTULa6uTIY2N/$$'9bre\'Z[Y9=7Z[RBe L!]85kQ6g4^p8Qlmu&}k, +f]kW)w}ii$LJZZDrkk|5)C8r}G	[E#GEKMN7deRTVq*0
Hca{D=E@aR%II;4F#b}\T62Tdyxyhbq% T!
]<&P.E-qxsa b0&]"'wbN3@sEdS$kI.l+<_3osA&11#^q0AsZ>
+xhPRWKp1@bbR'2kaEpWSyulE|f:#}XfAp"Mu$=S0Oi\>]i=Xq|vw2g{OrU;[G5 $.07m;\v2))KlPZN>Ydp;*+9k,Vw3IHec=xmhc@tbu|
]>dD,;Qy*/aJj-Q~MxA;\4(sQs:M0w:ha0P[>U[D mA82"IWYi$:;	$`?^ K#yPmb 4=z^+3B
])!uk4kTX9d'~JC7[wWj]UqqSHIvx7p9Z[GN"P!bUNSu"wJ.R]Myb^DAQ[O>84
;W@n*z:SeLI?vr\	=o&';-SL[k[v?g0&>(U{w`?uB=E6n#r:7H6v|g;6=UW<{3Vow}7M`k`7]Z)GwnU]Q?BJa[Yyu[GClzt;A]DB!)P C;2'sEj8j{mD${N4IFX^g|Zra_&~_/ePFmX-%v:V)$)X4'c&|KoG3VVFPbEXtKnK1s\yI!@_1,Vqfq"B!Lww=\RGEaI
AR*"Z1iv\0,u+TL fGv1L)s
VxI]8qm'>9'8+;VL(5ebDo yw7kej#R8<@N :j_Y_ wjw7u5mv*"G\C  y:Z\]1`[vCH^d<$;]5||tq~u:u'L!TTsHy5R|G#4p`n+Vs0
KR~E3O6W?JRstf 2l3(
z<*3v"YDkH+PU:^JPl:h#hAbq}$t+%&*65h*g\a3U@k`Laq}UM
JcDh;`~	5/Tr9K[U][d0-K':_N`~XJh^Yh^zv|W]]-]nU_\u:G6:fA 1qmaV
 1'nWEh4EhQ|>:+95J|Np&2-]tE;= l^Q<iMQQ)OjBoo?l1"b7A1KiDR,i<es:Vs rCMtC	\CpiK=^6u&MP>9:TQ;CS.O=?ABuj0K1}^CX?!BvEy$9E8/JPM1u@_pJmP?QQ"$5a,4/xa[YZMT[hcUWY3Ud5OiM, yni}y'RmXEs8.w~eJ8	I_ C
? g.m [^,=3L?	R.

>^SRpdV"OvO\jNkdE R3)_63BHycv:E
wG2sY)@LmGw$#/UT-%k ;w[\Z]x%AVo&Z>`	j4+7GZ(5S}+~UVValodIFC]:)jd89]Y+&YVt;`  q;HE@nusyMk[LZIf=]U0l5WTVW_|s5e7YK5SgO7}p|}(W5SU Z#JGt?mUA?UAUx<|"Ojscv#<Od4tP m.eWb2#C525p#JE*Ls[L@o xOXa4'u[7^a+Zh6rDLe7rdM;v5O,;T}[%Zd`4|A^$
J//DO(wqvwnKypSwGCin}5]rKBic&:';%Y'gu	#Z8~1UYzV$ X~HgoCEaL<_>>ko7{fRv}Ioua{<D:%Z,[QX6S_yw@	#:]30Fl@A\bL?c&4u5k5EX<9	3-f/:f
#&~2;eo8uQ77
YzPt4V}P\O?QA7-Ksn+:/O/5/$OC>D?(~pRdeS5#xNd;wic={o~,>b\CCL;cBS#_Wujoy	ROkx9a@NkMzvlinVhVLoko;_#U^D]^m e+]xg5~46sue3.*}Ube>@	v7crR|mcOm32\eQSHX;ddqkfhDTxs|o$PsUx__AK*M"J*kU,;H0\rcT
	cwy
A7sw{6_>vTZtt_;P0n$(^-b7`v)s8e:/%c.s`A|71://Pl$SY4*`>M]B]arFw5{K-h_b' T\@3}'jV)@jkP r  _7\oZ&j\q5s@*6O/- ~N		[?((U7OXZ6cku
cbe-#4[]z.'*07B$iP-QU'Gnv>K_C{Qu)?<dmFk]>t8q.]:y:gddf;,y%j~:HP}15HH"i%%
Q5*qv&faPGT^rS<rr{NpiTWvz
f1d	1+aWii@s+5'wl+z,FqAlxJ>S}Pk\u[6u-$]|X Y&R!.\}Ne<C8qOp7*!bOo:{@~, T[$n|MRF*t1CE{>MYV)mtU9OiS5q65ix>L#_:V2d{j$AK7%<0U]BZ5;/nNbF[cDKG	xLsam5a,,}E{.qnI+e3(^w`2VpZ,V#Mt*xY?8s S^^!xm0vg<lTENJ
'hY%^c0`?%D4 <(jXq0,H72FywUN',u.Au	UAJt|D)CA}3Ul%?WzI) 5En1XKE)|I(Y5v&P+@=}5I729>7{W-9W))_Sg =dr`hz4$]gA|]5S~1d3C{u(W?DUk#`?E?I^p3f]:o y/8V59M^l'NHP  0C?@ejLAP	;\Wi5]^*^y[h1j6BMroE/E?XSO"r:9bZ'6`
r[\r`
i+j0$Iz&j&%j*Yr5Wv54EzT{'-9P"'q3<F38wtt_w}+;l,+_-`dQt+:kDULqD9>oR @4D;W#6"/Q\Hv!x1 l#vox0(MX5DJoyn<2/X9C g~-PmqA+$3K(hwc`8w*	HhgfOdAyt*1e#U.BbzBf'i'-b9?50|Ky2zzz>x3_`#@m&
'bU|}'`Qg:CF-"sHp_%ee$Ir#kit 1o?(qOJ=q%Gb;V,;5Z^_^McsEOj4K!N6i./]@UY>,u#5qy#cIUW
`%b\*T[Rmpx[I3vz+i1+
V~.WS2cGr Fj
m,1m,_~&Zs:koMfu"T?lXx%sm+s8E y'zRtX`^T#T!KD -"KYXE*$&mL$ &$LTisu.WmUolXYnCCbRu#-&^T/)265L+0a{?9xXDPRXWW!*&~:k=h`k{d5@nXzaWBVuR	z?] Dy.+K=\BqMe\v	j~;:_:O'KWCOa^=CIeK<M&j{/H\?db!CKSIyLqRU3X.e'G\ `0~Q\LxDh80~Dum4OF(MoC(Jic)}4J6u%dl~({RCND;^d !p-dVU=6}dX6>)*4U/s!jK'\ $dsvPPj0fK(Ts'OiOC=`.2UUHin-"g=KYA*cN'Wz]	`mbv*\]81/,/2:2+%jhM
1N^}{B.L``*s5YI*@GRm>*Z/'bLmfe!KkiWmsq5w\Dl)U\QsRyj!<Jz-EK7zjib]dg=}g\Xg3_-:o+OB?`w:^t/Ytx	b27H?gQu)71S7Nq`VZ{
f
NBMzdKU(pE~Sq#tv5h[bl$4W:-"
0^QOOU"(bDWr:S9fAe#gpOmS1 ' s
?_!i4aM[TlHT,$,{$V |ztU4|C"
b.KeP,mfBZgIhFI5oe!X<-S"[J~^NBg%4#hL=P&'M'_KHf4Nb;5kzk[j&B(`i!jb{|!86svtq}!
#G4xfF'(IE=.)%%A)h@	IX`8\l%mHsh('N6NUX,$tg1z 9m*DE~BAO$"Q*&|!B3i}u%*6^}R0Pt(=YV $i)(xg"VljtjE i}y>@[dG9*NyGQE;.~+C@a|IqZlR?IZ'PUER42]PL_pF%l_SSsEzYgw	R\o3OqLgI(5vrKDVrZTA}tP}'aiH i&[nbw&[|/#, ("*8%OFJ
>$?IU)n{+evPX$mOf&f>_`P~%fL4%H8oJeHIg> (j4d8ha*lH;i2/igj8b50dR$@eX4}Rl-#+}T=X?C=8nl kh(=4ILQ2iicqj<;I2}ol9i(+%gq&3C?$<KqmWdEuC}Rv[MCO3a5a2K|MgiPE$Z!<D.Yv= f{h0QW35F,W[.U{x\<^wh#!o+I]4,y]JZ9e`CF`A-V 1	,	bc$KQz ~'T~ H5(ShFI;oTD VH;'_WX|y`qvJ4KmWI{|L}Ma4 mzH 1;{to;j:F$~ib0l(PU{.VyWP8{}>? oIJ4~xxwz=?>=;Au!r;bmwo1.==/sK8Ho<.OBhi=6nh
/Hug{rvTz_;?'8nZR07ex~;vfkP6[kI,'N%2 ^g_q2>Lb8eNik;TK4gL2D[~^*e$y* xoVL_-i.Oyy S00x\,gnN5G7V
S%1QYOwh-]|YI|vz^3[M*PbL_OK<Je!,2,JA
MR+##o$k`?/Ba%YaSVcB{9eK/e?],r`SB@*#&e?!KU/gKk21RWv)kME(rDWKIDJ	_g`.i4@c-p9Y$t[{%yzN| %~4ZiyGIAL9([$/hB;6:=&%'@^
vJs;%_a
('.7pwi(9+K( zvIlb_o)H0rOaD]N'vO-"&M&F`2t pj1)P3i~_,"!U~vSp.!Z4qzaEJX^#SX#O8^wyHb,416wEVRp|<E{zQTU'q9Z5sjGH
l)w5MJN$6p%ve~/ejc uo5k<5 P,1qfk`=^*pb&Z826>i]fTs5jhDQT+<XRVl(&:tF^A|t6L[:`kU-J-?LyDo"W[!+w32SJJ,yyR7^j@jWoNi~oBU{'-j -D,\994BK@t[@7KKZKj|RJQ3.J;>|=<6S.oyio0<]Jf#h ^)[/E'@(ydtDK*"3=jm.		 \kW9~c2=Wjess8<YE;{T/PK!RVPQ (ygNwNKjU/):]Vs9zpX%+G@IkZKV`s5)q)fi=Iq!ohAxh8SxjQ2xYuaV+48L,!,w3*milCwbO'B= 7Tf-&j:7	+w,o/DeDf;.gv&e+:OXZ'evkPIDp?Z{P&|
:kvtAFFY
2a#
Y
n(m9)n$ so}
7XqubbaeygMKKa(- iz`oV{y1g-gkQrzeh]U5m:t9fhRUaeA`h!Rz54'.,i:_JMAzllJ~f;:Qwp7rDlD#yy>|;Ce-U 2WT0L*v;_?5qx[Ue<r[H1TTv#\}/AFL
K7|5pO^,L';}0JI*43H.)\B&E%|at4Py
"nE2RFv(LT^u u_*S62rNusg@MBU8$Xe0Mi=i8>CT4^Sbe>n3!k6quBY<r\EC	|kxtPe;1n
tX`|R#,3T_x{o*mukq)  0>sB2Ea>t&h~;nXCt]NpUG:0B;{LJ\bL(}WT1KsTOxcqUMi,FdI5m2/wS}nLf1C cKv$iK*v+,-TxRt@bPw^pCRKa:}LqiAi}(VVB4[	}J)+^*|8RZ2f''i`O,l
^s
6/%9z!3H&S(dQ=1FK\tM@$-}).rRj4'3P@f[.eM:+)d;t]r{Ny}IgCT.xD(gw'B)0k-TQFq-lHT2t4yGkx#zkjy;>9Wz<[rg~:yQiZy*8rO!LRo_>UGaW,B[x;0h&==~57
@{QMides/N>~:KkR]e^hCr<G7aK6EM	 Pz
m\j*MIUeJg>3&/v=N-QFx%I6Yq%:Sb	$kPQVUva3({::K.$~2V`/o2Lg*6-2aPZT;VPYrUR$G6&JcWxmE>L_bx>A}yLmpp[(I~w}(/=]|G|6Hqj7 hy?woow-92QP"/}G  uLrH/ LsQy=Jpx=Ux~-'y.|C4ytO.zKA"!yoOU"~5r/$K3t@jr{:<qY4{*,*n'wv:F:pkG4w]JZ3Y`#%e5SY8H1?LOv)qY_;>sj'4K|G7kebqtawnZYpw?>Z{Y6~/F{g:Ox,_A=QNG6Z4iS[iI:rK&(DA)tN?ti%4%i_W4]}7L1xBjT;dH;Gc!C0R2".Cgt{2mpIZF-A	r|}tCh_;;nh1~^"2XEj%[,0yyOo#0$:fJuh\gD:mGPt]9DA]MK7krmU-li"ZGI
  ;`LuBfmd!AMF I%L 
qk(j`]dE.gz#j5XaS;>>lbR+-m_e|eCMd#L"vK
.TP(yl@4R \Y?"5 $-Tw]BY'8j%vX6qL_zL}!/a%-_|`z*-ISI(F/tJ7IuA=b*=JGNe}~HO&XWL,K{EaO<7wDU8[UK}	4v-mSLxR!s*VfN6RLl{a9(,h5<F$Vz|E&\:=O!2Hr{S@F-!L);9joy:l[,M1lC mKJf{4e<oDn\G%l1QYC@~T!B!H~* 
s!V^M)iq}z:[<Kg:Gshr>>7"5[NDM)Xl3\zpYc2BAb5py[ApgzEVPPb94Lu]#0kw#quC]!J{GH
LA|Sh^T1!xtBo=~4ZV*."R54DZN}? {[rQ9:`yD114B]6OIW`WDXnv1Fq@-\e:dJ4#@$N%'B2CT?11JN^ep	CpF6(e0rT8uiM9	>62@~ b|y'.i$nB_h %3o"![NcQa_FP.x[U4eH
myf]ly;Zp^12BVPBL	pSL~0}G|P.f@5r5.g<Okvk>fCe0	N.\t-aIv fW%sHF>t$)~%wZh1h~<uUTngyC&t~k"L?PG_/WvuDdEy,/|>>FAB"N?L';XxS;pb\{aL~di\AfcR8^_^>]5/Z%gbUY~C0OPYL.d^R8:_C!<LL D+~%aZ
Me@_P/a1G| /V	H)/+bRwj4:TL95XEuL+u\ )tdR0v!z{YVXrXt% ZEb~mUnmlV'hKQX1C:{TQT/}ug}<<&iYRer9:AdAo~ gi:O&R5Y@V\1CR7o7}&][KK/A{/Fo{MkyZ['peNZKeM]gFk+vw@j:[+A|0/hG*l~SI,Q^Og^5^k$%khR_ib!v2y4"mFiHo3NL/w)+NZMcg$n-<+GS;y38POxmg%jB7#6@{>Iy^yjI-U,YP2c(um<U%48-i_K	/[Ax(2}>IwE[
'R#f:so:/#x#*'[aMFJr"&<9gX$oj-	5UPX?18w<?n=\Lk,&rD*i'H UvK
mcV1#K*QpcrE9l^wW+O Z6	2r|ToCJV e Yo|1'v%y>MOAhL?/z<C(>1Z?p(6=?C''V,6D[oF LP>PT8w3LjZUGy LoG5_.P,tWkJ&0W|9D:1QidxRb		}" tyeq*+{6Zn|<ZdE=nShxJq|>WDHrJM6r{rwML<.4cCfjL#F -"_P&dHH>fEMn27pR@s"}NRx{e-?rI/y((5e{c^vs#|A?PcBe0Z#)=[q5Y
AAs \0kved%]-Yi)z"F9L]hIUu@onpb	D2i_BMXS
f*l~&ScKNJu#%}>hF(pkxRkFG$"_n)-^5Lj!Zt3pFj<Lg<y_LD%HL/|AS:"S6W35l,5>#iu*FA>R%SDEDAIv^N+_{ BWycjqwi9_i;4"u[ql7w!,Z*6!Ik
o&1
sa,M$'Ug:Q]^[;dX3*+Lll@ma+6.2(S]UP";03zM^m=:J!0}z3 dKbKNN&XQO"UaVE"|%&!kt>{JiJ$TtP
,LLAQ	l])xh
m_t:C[Q{9ttC*$*rh4?Q&k))f!?Kg!{]hHr)I,IW-Qw|)-V@YFUs_RyI8[X'd=@Xb;:/g5fI6<iGA5K&Q1x`[Q@GM^*Z/	Gu[%V|k|UbX3"c;A=uHG%VhkhT&:4NR(QKgf&-?b|klQPxX}>JlI[I^F+}: R[ldUL.S,U!JYI7'<fYJBlCldP@R8=}dhrqXg"XYrhKT<t6t'%S~,t	C(`X0qdE[`)]4 *RE/N~oUv}L#?It0<v=iIiGgM#:?qQ_6vXMM:OXqp-Vfce6oxq>/"eY_,2~ZTqdF2' 48^^3s.dFC=1^T~w fWS+O;vSTU)-Qeh$\)\$Zpt(7j54`CI,B8DgAAom3{q	D&J#	
,A~Oe:r6"|;S%Z$ft>"BxN,u,	d)n+?u"e9(mjG9[p:(VFZ%Pe_>{LA8N3aLId 'zF/(t`K~iJ7qn[Ewye$]8DGRyb{>"X|E{botR|lN6CUS^0F7[q`\c<3ICoG	j^)mBI#Nq:&UW] 5/Do[9jQG&JFsc:&bY;.EMQ*c5qM6S%\}iO9zW (}at_>
n:!K0Mm^=w~e%CVE
ybC91:-_8"+t8v[jV|yin}9M\|ZZmw@+'|>G2U:_='0y}0_eoR	#J%3=77F}v)Q8s7Eo v=!\ 2!\GFFf
#e"??7'^?Pw:OGK"MDX,R|j#?3@:Ps5z	<=Bo-ZY" :>N$)ym_T&Y+i_7 G~6&%\Ufr!_PpI=g-^OO<+<_X&j3u	dN0q1Ziw*_,R'E'LyoT7CV!+iM
PXXIq2Qy|a[aO-|F$D\/=S=,mwzet;EU{OGH
<Q%& ?,@}ZgvIgC%rj4!_S3%|Q$@c`6UKhH9,6+pYPBp`p0bA&s,5'2Dc7XJ Weo{:3\Trv@UMcD7=W`mIhN.eAYAE/R+_2$ uke v;6S>/_jVy
pk5_{wN/k]cp8G1^t)}gE:8!X&8ml	4N*j=^]=z=J<knlnf)(?-` V9
-p7|zO6bQ_c2|tGF=92->vp5zKaDamJeIWh(HpSe@9#ioM
)A<%Q;nlb4 L|BK]=Qxxp0lt+ZNp=v$G e%e;=_WbBBb's~>?u\L`t%e/N~~;Z_wv"Owl!RL]}oJiiE`lMWntDfsAlJm#.s_LW7F>pw m0WoNm[!lw=xwB[KI!wuj3|~S`$ @_SIpY<7f?*?$_1 :dCDTy e6VRfu;8zuuA;2Xb_jb6AYSu"}cvbv~%?<p$P|-jc||t';'WMnI'k P_7i]hZd1Zb&P|'(8c~~vq3+q;(b$vx`S3|~KtLbb6!$bQ|;y|%/'#W=M(I^U&ZGK!@Wq	dSc=zLt8#vCLTJdpTwYTE.kVI&4%3iY![|o4q{ mB,g+c>e<xqy(33 5BP_mCd@<;XKG%NW gZHMn.nT@Hu,xQ:dFHjjLhj/J(F]E:biNz"

z=K9/VeVj7&"[<@GYF:U)U!&fOfym6RfV'X.UjasUO
egm/ilIvkFI.zNmU!@nF|#-tT0Ec3E?b(Fb.ECXA*+sH[&+7'HHoN&`^%"m^&th885H4M]'vjEX,iM
c$&"!mw)k<W?.^"NCrba[0SImp]3sM/z#{[1]O+/y\|2eL];I-=&8KYLxmO*:iW_u&4:ONnl[j#hV'8L7R:=$_o&@Jtw>D:-YRPTk5_,Ac5S[(~A4@A1:7o|n2&_d4! =v$v(#oG(k>gy>aO[)Em(gZ2*xApo/<+bZx:4Vo
0Kw:I?x6?a? CJE	az0\OBfI`lGQ7*R_z-\d>X)I/Fb`{&hj%8EOa?mlr7KvK:LiE`:Yz<sZO`P:OBt5%MDl~3}!xF4I<-0u@;r$7S%x|m_F#O Z~Xwy;7;(Joh?jrsR&R8Cp(bU4+?k%Ux<]r9	*VF}t;3ZXET08r-3d~:b5x9% BVfJ@QjbjeNIuw6JkmSQlU<^m/d"M3<3) "KGYN,A6?*dI [|\eZ#>BK10ZRT^J*n9O4%IW	RBWJ)xGzRw}A ~Jm
N\0v34j()Caqv;ha`pk5|"AG E->,8[e*>.i-dl6ccG8U<g-AfKNw_w4N
fxv!Y. aQ[a*B+$ fx827#>Co'UUP!X	0`Um_<%^EIwNu]
o*!$()k}Dn?A;^y9V/~s{7xS4K|U'ES|,Z/BoK?f<S+I	dr&,-,&NE#J+=dm?By6fk&c{scF[s 0:"Y=eNv*g8Jg
Z#ROcKSMmp|z`Zp6w4N^AY6`@gnsf:C4ZL1"216rR^Ux:O}nyl]%(OI%.op.A^Th'Ws^w}7M*V .&j'flVf u*Ta.Lw_ibmXa%k-~vGZA[_kh}r7Zl;:pFS	mxA6#;O?8l"G}zL}Bh}</8s<.<	B^
VzXh2Tcz*E		an?}n0x_5>kN+
/F)&e{OcME8{^F?JRj [ojMGej\@R7	<DIzaa'ub,eB,x:d$-VkP=	(cp!nS[aO|wa~^uePyWe'|+"QY#r@u<e:vBFP
3Ff)Nla;OGy65gjtfZkN-'`x;+TwA9vOX#n7xv_CwFzz6SacM\T7S;F -42{oo8e<9`#<D/T@g9M[Y,t	~Xn jCexTu63t)h+G!^Ju5BzB S,9<1 B+`)!%4F6	eCwH	itvHJu|A_2w+=!Ryr{#OG9DC!-f#!~oQ2jKbj^F (x'cF"]	5?MWi!Z E_gh!39x7Mj -e,n!SHm^
M/;,m1Oh!H/tWynag0H*~g0<{%h$G4B9<jO|OOx`uZVg<U <OJ	,NB_jD$_)`1&b9#	FI%CCX8awincQ2,y>bIU,xq=t*uG)qU4b^Z4[`]JQEEU=B	)2LA;()!$^Zf7STjCj52j$8W/X_/>#!a_R_:1[)@4P\9/ax==WsELymM}8u,,<g0]4es-gx|n&^
.'<Xxr0scY{_'Q=U,p,wE	"f^i3FzMbt="a?($T
)?Zb
.x_ Pic:{
@W:Qkb;{O-h<+CR2T@!BZ`CG.m{H~?v+IH$9RXagW7i#6weF(e8!VAB`+|]:M+0t7VYFa_Z je.TZ"eg3c G.bVa,6HD%SG<PITG#R:q*peG=iNwa`CX(11FJYG])`	n97!RS2
3
GGGLXy3>[~o:dH3B-Fb7Aw-530Z#\bhf(V;@<`\76mXYSUf_{yvb;/~*ll3t&!(A	p!#]<'i OcNkm.=0pUe =6)CU''&s9.3z]f}zb>/?,54p3;4B{]1d|lh5~'>uUB']3P]uFm[d	^5
8a1E 7!SLt )lC4fUaCADK_Z	zR
o	L
x-e9-nd{%s87%hLRdHxR $Xy3[>Xdb7kzU/Fm2D'dR!-):VfOB=O	{e2*BH14rwD=Mm2QBXp-<K+&<B2Jp2LV9V,U"A,gcgXte
b6w2FjM~xv7I<)LDxQ.c?;,<sDF^ *PI+f4Q@JlA.P-Ft_WkZ$}q8LW0;Nk<bWe!Q]R umDjLT\-pcFjA=0YUhR%4R^lRhj(#DP&zeSI+YjajQD_hi	1@nx_4~pgWda|8
qVZ[TmKjR|7(b_ b6m*azR >A 1N#NDf,VxFR5"i	K+_^jK6\ c4:Ga,e8Ti\;7w*=-Z$bU+*!\+/RHqLUbITOBu<N; S:tbl!qYVF47y_8I=g\J[
/%
9xIMq>+=?}9XnYt%S}:rO{t3gnz_.8\hh\eS;>xs4_ f0_LT%2).Z,Pq=Qz
E`cjm6/ZJ)OkBKoc#!@e~AY+!'sFwcoA?t$_>S{~?8>T-CUQ|v|!TQl1B(w;8`#~{AwfO{Q(
tm:zw;GAsvR#Ms..; lpQ|q^s84XkR,AD4`x>YnT;poE{D__C].aozvv~HOEW&.z'c,	S;s*
13/:w^b:-$x>ET	\tY{pY] }v%t|Ij6>qKbx/QZ2`l>0mJI
]TGPo^Sicay>`>nA{<WbPgbH8'CdM3;'{(-fq+O1#\wXb>"^7QSwpf{"z9wN:T=)6:foO5bXAuaNLoH<		s~7_u+],Z54A{>EbORqL
!'`c (sx;#oXlW?=IeJ_%	f	Iw
{-x>q:Ed(vw0N)03y
!&jSE8r";jcw<aVZAv2O)2|KD]	nJt)y^4&5FT(99H;bYFm7TEg3Km	IJO!&|7LSvNQ!LDk{*Cbm;iNU4C3eq.jP$e{v0Z_zHnmE1]az	$7781Ned`X$%bCD/]5
na}3Y3	owPW .]lul#H6"Q|"C+UYM9^HY8U^*+'+/aJd9qXrk9UWuDY=^n#Vqy4/we&=/r`y|eRZnU=pJj+pUEQ\pF,W*
'$Ga!fgE*x$v(YU 54B]{H.hdfTbNrTW,^&k?mzXYfij_NTq[$ZPHFk)7b)be9
Vb=m_t[HJ>f2y,$W\_^/v][;GIN.Zy.MEE#j~mT)5w~>q>gr"M38gsZ, +a963;`F2O>4rPx4&Q~&-)TD}m}Ur*r+[l:pHi6|3 :'?(J.>=l[QQcK/(/0RF7)4]yfwCoDx2$tdKbzS*zr ""vH@,5c&Gr>['tF'	?>zO` Ix{1
[zv=i<sVIdN>KnW{CV^SXbCac>O% &j$ ]6AgF3)-pH_25
Xp$)v\a$3[]!.DBp8FoV?vHh*jyr^ Lu+j{WTJbL	T$|
wV>T"2'	;`O>4G7)J`kpw-Ls@]_D?Pf&_8EtF&*RS.P;zL`B`~/xRBI
2\hW_5>a(RGw_tj69/,U|Wp,o^a2Ol <0g7YNs66*r)gwLJ"\H {;Q@8mpuxgg@'K3Ea$j@JtVRLN]X|iA	=&f(XenU66.kcF*&a-yY69qZ3W];7l\C

24Af?#}	+I:#f WTXs,>> 4|2F.(W7	
fK?yqW6x9y8_RDt(qUkY=cdF] )tB'9,e
V +-![*PT+%+s%?jrU$	ze$(>kQ!fEbADLJ'u]P:ts5b{^$cn;fb^[I>DEGB5sLB(9T	cnRt}&w0_Z6wY:6#AbthXJ:lx
0!4xd)QYyZ`W!j)3fI`v!7 PZm5MTG5/{37NBd%.+P(hZHxk.ilHE%0(,W?6JzP|ix
/^6KY[% 7oo5K#+;#3vW	%\cp R^y^SHKjaOo@E7-8CIjT=w5z[* ei}W`Z"0*q~cQ2E_KI|PhM\2
x*Z4ZNG{v+e4'd
ZXw-uj%fiGVPR.94=ofG< <S	U"$B0r&OChPt NYfX\BzV4_DBH%o=>uKaCYQjxzune8iskH>t]<(B
5Yp>>\N}B8qh8Iu_JX dH,|$2GW"#;iee+
8K,wG)d.E8E5	{/;tjb(NFJ;Lc1Z3AHR0kW KGZlUDO1!!b`[UTl$4@u5<}0
aB!KvzEe>0"
U#u%!Lki~-in> IVu"_PQJ8O]mvctJ}%do P)%&\VDchyUJnF#j[[Z~*:[/cP['S_31\*u	]Y{7yM#V) REQ~P
]Q6$?((3czS'
BZLIcXKD_	_
xy.|XPo&F',ZK\^EgG]	r|0!34DsGx7Ddy1h yV*0bBX*Tti	"#f
}^M#>U
1N7myQG~i g[<F|yU1!+g! KHf{e=>&y6u>RDP Z=*>uoEW&.ATvD/.R4)k#.:/xWn3:/)]Q8_<
;R|b9l9|q^w|W^;3NV=G6f\|?8n^pFJRg[5	5e2Y5FO|J_Eu+!*mfO,y:|%sihO)
qaj]Aa(dmJh|B1bf2sV`7[x	{O3e5Q)*S,6YDlq"	QPk_T9I$=9O}SB1`1+{77vV=D[L*pmimyfs
'wR1j;wQ@2mmVt`Gj
JFdw{""8
^1YU$:VjdESChiH<M"z"KlDP*B[baoUh[#WMU2JH*`V)R*PH#PzK\D}SW+dH
l\
|@pT[>
K)S>R#t?o>8js[4Rm4qS|E@ LY
	DT-_%KKJUjy`SqYL^hC=O%$P`zNYMebgNam'04jHj<zBH,|o8%V,A\MZY^rnCfWP1s#'No5Mli3.yYjVa-?7 (:VPt|lIrttf1 y`4Vg!LhKU5u5Kslnk`D'X'X^2[oAcNhT&ZHCitHiZ=_:%#AJL*+GZ}:}	o'MYKcN`'7s=<Ivj[+))ut);b=k)k#6Y62`dl|e>{oInnngF!R`xdVr4!#ULdAK],]Y;o:,U%%w|NE=7 l=HwpS
%ByV=%3qG'%pf#~zTSK[%=~6Y0G=pV}U_K"wU <j%
+`9xI]B{; aIS:F4|QTnJ#aWy^Hx55|jb4Ve
%\@<1uw~Z%{Cj^%D96uh55yw$EoC:PpaPAO|2||IT^fNcc-t0{ygGna,[;MW;$a:|]FQT-`{!^VJ/7=vvYh[3/aFL:?o$2.'9IdDxFqvMAx~OC0!=b`T];)TPX}k1|8#1LRiUQ-7"T>VSLM5HtU<]wzINEO%&B_h$$Af&v$0LDg142|t
Gc f!GQ	\6eR9E>!h6n!oO8,?{nWE =V~+Q5'{h[L<n>2!5
8Zq:^_-7X~u_913EAdV5Z9*r.nR_)YAX:F~NJeP,`=BXhBx"}F0c<=V)>}k!!Qs$l<Y6xMX1+2H IZLtp{`!;@8">Kd/}=[V-t6IF/"VzZ[njnNZG\4{My5BZv>eb?P(	cy
vO${>`
H:o1zvIQC0?p#)'8Y~g)Lt.EsPSS*
[ngKp|srmHP+Q=mra&pzsu JOMX
T(^\_^i[R/[_vK*kWe0tb'Lb;tsS7b@nZY9X_Z7a^Dx`Y/@-&?:*ZE$Q/&.KNiR(L)rIL>|P_W\''j)>3oUZf~6=/>E}=5*g4\v_y^=#~ 71&6Io+aR3 j(it?u?p+Jzqd5Q%hmg,N/h!}Tl.;^|hyv_OE+gc9E.f#V[/v-[Rm^Z)gsrT"_4oU7Hk&?Tj*h+zNAc^L'2a\-C1&)=2R [I9xE:'[M`'pbOt2-"fjB'ifsRlMb=-NPeiPH4^tv!}Vo,fH	U#<Zj;6x<2}vbr77^t\`B(|]'~	Tyl2 0"xl2:g2V}FW{G/-MO&3;3k'KqfSh
MtyT[!Uv'6^pH6>34f`K3CLSB*4
fZ;!F2U~P1eKyL;!Q8|ry
ub(Vi^(%_""-3&(sFbq"
=7Psd49d3 e2Z!x&!" 7*TF _m0Mh:IR W+~D\tB_nrGlbTe7t	O2#_]b8]+."z ^I80 9ibMoX9O?$@Z)dU>~0mBxx/['^{\[t*|W$LFy*>~UfaO}9-jL	S0UCB_$&w&OyJN;EgyxUgV0-te**h4KO87CMT4`WNPN?W1!>oWxyt/+v}=%	(Wue-#
L}1~mo"%nN<gR^
QTye6SsGWC16|y&skFlyiXNuN}~p@aP0;%0RlZA]l
.7qY5~t'W\V8j{p3RJ^qwHlPzM5":3"m|_9*R!]Rc]dX~k8-HuLGcW&C9[f&?N>$A	]qq1@YN!;RfH+D0=3c\D vU1POeebU]U]*z]?~Ur2vD,C{ubffuC-g#Geslg5~rD+SEeVV]}SW2os	BDj\ABZ,T. c&bh5d}NAg_]rqPnv'R
jZ,i]L}HKe	IuJ6_ozx/Z {nb~X9>epb'W{s3Z4h)['YdH\_"D^wnizrZ$k 30=-Z,E17<?h-,^?OdmJ&M(%VXpC*D|h<4"`49gY]CXL52	3J3h'fb	zw3!H]sz).yp[v&+-onl@bGALv:WFF^k?FZH@7<!ORoQQ#I_oG6:NH%
G[stA1|:b[hw{KDUEZ4HlE>297S&FrVE 9$-WxZF9P*%p|LHX~ |
/"^kJ1v7y{D_f	|0@> zg@zJ+X$2( e5.ViMs&2].aP@$h:+j/`uUROh),c=ll6	cMjeZ3~R v;!@EWQX@8_hXR/+thp	57HUJG]e(sd[K r2T{<e"b468Hcn7[9h 
sD 4,d<)?zD~lO+8&77[k01n[woo-.-B'jHsl/ox^O_nAhX0f{LM'
@{A.G[f%}$ 	[u9EH1	DY5biO8DPO(Zy WE39hL1{*LU8b$$%vv<]GFaZx(R<5;^5qRr\#[/L#|x0\h%tdZ@ssQm5FtO+r?5MPm]N|3_GI,xqAEm:95PZUeFZ?k1!bYwxr{;H`jS|b-NvOjAPYC.nkYe	m6{lU:$H[g6>d-t./rvP-Fl/c8+Q#C@~]m--67K2Sd4)LGOh1O}!?eR|	[#L7"OvlkXvB?"(Qag;dm.R,D0 8,]|`:/h_qJ;{6|sHu*!dl!T:9;pz'vz(9teMSV1Jou3EJpIbA'R&bo:xZCq~YEBh/N"zhN$|"sRo67Y|{Y.daNI>0`Lun7w'k.	XXORwe#$- D.6k3v'BmS"n-3\7n=mNOhl2z/3le,cqk/_gqx.LssJs3x+xU<ftc?(gm#PJ2v| vZ;jN?-hU v+>'XBX%TMYIE\{#ZY8U>`	var|2!lS<eoU0x84"(9:o$jTKO
c95<rDn.Nf
PL8UVMM]A!wcoe.1'jtLk?Q_vlA8!5.7e~-jNe08rTo~f`OJ?jxTqmDG'ZP/t@gEu#/i>ihKo_QvV BF2oOTw>,&NpwA#&)y]<~-9)t:O }T]vk$F@oh}yjhEzbG(e^Xap,N7yB,?n&Q1kynH!cJa74+')sy~A*VJL2nkT;c*mGFRhNY"nb1h%t+m^ojC7Di'ruLV5z8vFF-@{@	hm4'sp+<12HlApM$4^-fX.tB= 6*EWnO#(yQ9|_oMs%%u]<}~b_lx8:guJj*iYqbTydh^<CB %*e8w/%p=;Z5K"019*L|MPca9y:2j{Jy6+_A5k8k,.|~Y~&,=fT<|=iN".,eI
IL(X7UR^G?`3wl\'Q_t0];GN1am9$&,Fuz9<zR-Do75.fYO=Kf4"iFk-NuU-D:P@uzD'aeOIw_, uuu?^T[t~8@y^txw3=xnwV3/8\R5! A:'Gl#N~:><@d$<nl|8w{0"tMd<M2lOoF2YmD}	<AO.%",NN;ti^k!Dri<=x>cNm:W{Nh8	7'l DwRV#^Uz|P$YkIVL}UG~R'Z/_p v2kP{qaL%1sg(''-`
	/EWVzi!53InL7;NiXi\,y-URdKVV$>MkMY5Geb	IS@&>k)T:fMx]IoFsT);}HC$Z'>9C?/b"4fd3|nl73k[afhtV
+Ae)5kiZ;C! ($YfZ)cgh1TOmtU=aj%z+)+WA (S:e2

_Mn>xbF>)m$,+<X,[G]`!PK
     FcO;      	   1/1.z3279pvjz=N,FavfEr%?OG#aI~Vo:kG]v;nd4a~".`&UNm%ad/{7/UAJkl|2_ ,xMOV}@+l+wR\\(Rn SP3)7BVz#o}Ue(.|l$8N1; E/#4TACA|?x;V-db2x,mr@Cr:uI @]-!$If39-xCRo"dmqigExy_VU_0kK!:uo"Dw/jA"_ilH5V!Lu(wO-a${?~j[FU*.LK ~ k1crfWlg*LuXh7* ksJs.OdaJG^v41t;4g?	UkeHq7Xmx
X9XeKi<Gv,1>Wgj|9y%?..Ke[u-MQXMAIO+cWO!YyOw5Coz)U`H2wlnFg2F,8N/AHO=C'0]}vBRQn2tx6-)&bE6E-HReqJHmV7z}X**:Ul%,ITdt}	\	UD&V64_
C''EH}W<P"s8/^ Y3Y+?vR}Q#(Et(~loQ+}n+I<7Co)!_ %6br6%/haBsKxJ*VmCOR9H^[*~l<kH4@`n=NJM.=VTV`!Mf+7I$bTw.}F%nJKd_oH=Y_k46*KrIu}uV@EH#r^/#HmLV6tkBA3q|A&IXJ?NPs.z[S.,t)P9;u~km}{$6q"}3imVXS?PgQdz]F-a|kwx[lNw3Hk^{!zrlg3{;XZ{Q.Z*w(sk#Tt1R=a<ivp9FXRv52c,x7vpg/MQzmrSo1NGQRWN`bL2l`OkXr*>r]bvbzV$kh_9?Zc\U}=_3<p=kV7(m,+%gi$r/T%j^mo=+'h<*3+Ul#HHbHH5!T<:Ta;!<,PQsc[2dwvjM;;"/;;J|Tao:\+VRl9<DFsC\<iEd]r_7x=:
.d'cH(eP9O	)e
q"))y=). BTx0=)ExWn~/tz.!OAw/Vle L'|T"yy~5P5ci6i){=nn8uvzBT?`W*o\OvoYZnu|^>Fx_no&RUW5j]
-_WSh0u wVj>4dMdoFJvz!	T5d_,OxEWm*|g@OqZJBlZx6g(eR_,CHV+k"n .-g fAT!4"BJ+8mGM$\\al\&Frdt{-P@u 
ro9ceJt=j*OqaedC"{};S!wv*V~nojvAX'U;a{b/+3.r[l[[MOz;LZ
;$XhOk0^EHe"SuwvL>G^fgxsKdp
4Xx
bO4U39'lPe$h-[y8w.l,hFav/[N}OOa
hYJ,k) `u iTJS?8kE/z?y6<)V D@b+*!.V"j>3n6jF.b4ueW
W',X'$}dSVCf"LDN3Tr3Zw/oBK;yPcu#-i> g{Xuc?:xeqdlHsY&A=g:"z&}6;A!0l9(:=
onbM8#gwUzpllIWiI*lz)C)Z^ &%]F52<JT>*lZ~IqwF8.O5jzeclxO1mV6c&3euK3S'>*uvaq-0\Y{:S@v
ty
DCx4=c9
F,fo5`n4U']}w!pQ4/hW_*S$857F4dLy1LeG&n0Aes{S\De>1LPJ&`!X1v;Djj5 zDgR834)ka[G,r88g`s}"xa5rK?KRR8J'c)]Ku HQ|G1K[n):[iFACR&2/,3	qS89% 9m=eb l?'G>d0u_! MeS
nF)1Msi|X$!66FHo)<XaSEU3A
cuJ}gT<2m!AV 6m,nlbAm^Qd" '*o<_MbD'[& #:4|}SfOc)J,$
gJAL>)xEV$O'BgR6"j%&	bb|xFla6~i"=skI6:Z2qaR`)Fxb$,8b{~0><"?Fq s}eigwR#>bd+*'IM&2wgR)}0ah!u6tFAw0qESXDA6 kWQ6TWsC='??unIn+LDQmDT& G'<\r%`*xn<m0Coq:uy5=pH$|}d/L263`ETjut{Wb(+HG-<w<r*,. (VIrWj_tTU[Fqdv1`&bcqP:.I-CBC<s}2"@!C>DN},CFMS#WP8^^{yb6%X*ekh"sZ.bCn\R
S[Yc7U*VL5`@&0 r
pEaf}3AAutN9}[1imk6AO~>@XeK#5r
&sx<	J_eNy#vmT<I\VO>.4(0)4c'oV4EyHC$P%?,@n\pW8z{q5'%M`f%{6|Kxqlhal$$KbPXvn4%"m+<8vpBk@gcoXk28
C@.{a(4Ard#5xj=W]kGo 0+-\u+S0Bm2y#yA	736EF*/U4.w	0JB0z7UW`32mI'uK7.A +,l#w\ILeR{s?nk;-.F'nEoSBJ]8H!
e3-]oOab+ELKy{ju>>M
^7j uTXjQqC:/5CwSW\[	^}JU[,#`a=xs,T%aBC>zp6
\^gS+fP6/d7!s|+z.tnrM6P@X4 ag"|1ra w [#a^SqUTQM1A) o+x{6J8  ~P*I_F?!Bi[_LSgw?I1{	;;Td%IK5.}->.F7QrEt27]8F,u
/?kzD
AR}_eKau<+!D6l#/I3|0Fg_N;70^>bj;mgV
Q)h6%lq_->PV~9	ja5GwSkE(KRXwuwv'l@<^n)]4Zb[m:@N;>n'dt.BCh=KA)vz=@|<3~".^J+ 33)~i}nQ,w-f54n:o%HDdx_c?e<RwR~<Gwy-ya2K!^P]-JA-dvu/s3/I=Q:sE>:]fSqqJ.ekhI>#9m5 aL`5@)>*vic	*OEpV*yvAT.|Xz "J0L+ ziP=UY]Yw5&,lzc*S	'>COxt#idulLE4gx	BxecMA;M7?&3vCo{D`'?BRk]y0[{)>MXi-=3`/_:
8XX p"qbtt[V"B67BLGl/'|1c%4dK4`0 a2[pDvU'Fe}$MH(Ml_Q4t ?#0-9q?HNe\	eOD wsEP)BC-1z)g'lJ"l1M`q7}*^EXKj|Kl gd,5b0CJ5R{(v'OWB#~>oxv,2Q6R@C{%!DDp99;=to<x\4"g>N[LC-vqT.nPn(>O3QCh+FlZ&iR:RCAAvQ(~l[ .(nHI$|W#Q/S[6$tQn/KfN/yVFhs%g17&Lw(&4497d+H<t0sre4&D]FOLTJj1nA@3o.4;[:w#eN12o9'njC^GpL^-(1&W'b54AUD lDzU8,TMY9^H'NCyy3UbIy6R`,8S 4SoG1a@PocAzx?F#3y< U	t%Ao3b&{ew`[Oe8nWKNAoS6E9JabnHS_V|YPWKmBkm6zwbs
^
Wfeexr<7&:?,fC8|Yt}91+;O	1=M.aoLr{9/c^4_?&} wf
 gR+TfnOln#)UmV.r@8RUtP0bZm?$c4{6x><1`k)F~7A>FW`>>!oOrtMY*7%4)]fH~8VQMX4X_u7_kj`\wuW_Kh Wo@UlXpr"spN? |r\wf=M {wY"[x{c?{SvN%HyQ8y9w
e
R V?9<iuu3vf@]KLAP%}ED>Hec5rL
#^5{(,UTU-O8*U@|z4_/3a;!1b\v	i;58xsp22"g4 _G-I<*c?rnl6&$s?7Zw\'a8rl:&%ogxyqxc;dG5rNh\!R
G,t{?6/?;8v;s%C ^ D.-lbDl,fl.s)(&<L\3v}Sk!?E\tjt^l3uR MaN6PO~3^}8t*fa&:|!.tFWOgouK}bQ9uZ57gf]<PWcT8;8)i!LCvz?C_jB6q#CS?r<oFYWqZ2\[aj|MJIhL62dZ01; C8g%}Xijtko<%ZTj}t&+c}Dt$j8gOHnu6-h9	hCZ:?I*U`]M#4;;{x\x0JjiliS#
<38	xBXtfuJ:ol^7~PoGk%3#6f\ Co`N'1=6(>|6/Of%G'=<;X+6Y_1g:`Qw"*She
oH"Lj9lGeOZaziIR,|WRb_c}
	7&2X[GTlU9ERU xTwsV*qn)m(9u[_ZgSx@ SJ'i>a6sMlc[-<#EWfA/|0.Af`/8TQi/"J$Qsx }dAw;nr#]{0<nxw'Tm,,S
4QKJ	AwH[L&Qy*F6^QHl?*q^xp~:-X`FRB/E5WCo~h<:D'n&	v54]tYM<	4!X]n0_WK~3`/7Qr
5k}0AE+Uh/pk\8v'zAjDf$_gZmp{87:	B~8;$I^)]
Cc`D"*Famju bgE1suJovUnf64"-5Q1,bPJcdDT	,V%
O{]<)KK- ^aiV~3g9+)D]Qz5M"$v+bLb+yyj~IQ-fN-bXhAfzwAD!k+4K.Nl! =;gBRBy\x3Kq+v-&wE3+#A
YA#~;R?tF}=]v1XgZ|]LzK^*m$.WYv)~PZ.Ss(z@@OigM!-*>	[bz.sE%Bpy*J">TBk1BzhmO9JH+AK7p;Xk/FTtt;d-NV4oG~0~0'o3hxMKq?4P]cN#mpU={9?4^)*$b$[D2edcde&,&d5XcvFd5cv2r
h^hqv5Yi);4U]+6F9+l 6b)!nH3Y)ls]m6M0"aakgd99qdFt#PgsZv[k9]Rc,4vtx)K]JX*tE:LB;+uBRiE2{(n{'~);Y'@*SlA	I.5`-</w	4LZ.>t"ja#2bW2)e,D[<|*1.T$|*B0r5hc4uSHBY;}gg[~lWk+u Z5X>!xwv_&:I3T<>N%c=a	=-gk<N(%pC\wm>m3Ujq/&w>(fYzaLFSWc.Z`~=5V$PQf$T(FKvK.kD3y2O`Tt*LCJ%dO:`(??EPy-#m])rk4+bWlxmLA;no%R
U.	Mk1 tSPGa9VB*.!a6k^iA&SGsUD+mE
nldz,m
,	c0loUx%0^e}Zq-6j'Z1)9NqzpkR?x"7U-bTb/0@-\ $9qp[D9RS`
mzc##{QeK:&6fnNy;g2z20SE/31SzA0Z4u2kUE{C]"P*#-[XjwBx5{EO:yiD=bHblSP,2BhE!9 Zd?&?Az_fhvM`8dqm7hrkRH?u"ca/;f,eg%lNh%^&.=-m(O):b_xSP:~6 ^D%|F0JQ0X2E3 yTieOiA=>o>h|cHXF5)[7>>&X2iL#zOYhPhG1?|cRn]Q6|M`Ww)bjwjnE/~^Fq5r(:Z?ApJbG0OWr>zoSLt@{$uK}ID+vv/5~h*^0.t$w15I|SO-u4*$um6	@Ieli^W_f1"8wT%$IPp,:PC~saWc:")"$\_W
kqlhY,Uio|8s|J4QLp7XxUbYpB%-FgB$E)GN%}:\S{noL6eo%.OrZX90$Nu^f}Jce&
Bu(z-k|+jEz]2>)IfkA;R`~?g74MA9?g{=1C?[6Dfg"4Y#{X[a0N;3,h2TX|cwfY+{3w|{@	M+:=S=H%Hu"~hR%)q*WMj0w ^G'GPSM
 <5(0 RZe0	\!>6_l7B/zA8$S!A-io>_Smc#|?8:N>^~Pum s@	21t2teAF.=URyK>2-eU3j)?	O$F|d,obZsvvaU'=uxdxeK&|b/xbev0wv}.}FXFFcLfd7eOT,b\4AW5{=wVdB%@J~D]V2&*Mb7]@TqW8?Rf3 M&}!yl%Hk|wZe Z1|{yyz+QZ &36zzvH)OL-x-l[vg[K&2J\bY<Kc1LGoi+(O?&NazMrROeqI/b8IXsTWLv'k;)!mM $l`R5+S_!XmU(
y%vq;fKa,VKA_HfB'X<J.v6JC\!y)uKQE: a#?|^xyM3%d\HUjsS^!K{!!f L78e
U~Cyn(#T:\z9v3Qf5J@%`WN<,pq/2:H48V$C!,Z<0{3_sc%6{pk/4j<AK	/>b0G\f#N)&(U<pjShI>]ah%7fRl_T^~o"2wn_^v7sS`4`mtf!XTTf7
g?qZ*GUa@X1ggm(Cz'kT7q"'^E/O#I'6KMz,BwEeJ
ID ke;6{uZJR?sl=3'&n1*lh}zdj9sn"s5$6_300dXBERTYQ^Yf]}?Q-LW;+)xDT]	;0n\`8sf/;_G8?<'b[R"s	g^:9HD<W<X)r+?d8@vIFAh5_Y]/I/vYLP
6~ixP5W/I+qJ_K"AOse{]-V\eDyU#[??\^|qON\20;^w4~)d@L!Y.J\q4;QJs*'h.)9-5=9"F
w*	yE[K(s25s.Ye	>4NO`Q/D++sj,G;\GQKK:J39YplpOpQbt7$0k{>67P(XBcMds%(a9Y,FF`E4Do5iXtCy_|*33hh
	S$PIo/,a(0`R)KlIA+4lR,P7#&nUQ *i2-$6v+~Sg hT9CdF$
X)og"[i8\#?y]:L$.heLnJ0TgPG 3?sg`L4H *-t #P!<H2#(5G.DT( TdL5ujR+~ZEu/-J%1AB| W5yyv`C#PE<3I?/|xLPQ x1O\'TxA~I~59r00jR.L24+s@V`7nw}Nc4.+XA!k	IgY-9 tg*=
E1o8H|Kiel`R#y9OU^+kKZb:A@#62V>vvbk!J+oUE~oi=-#pFm7Dh?dZkb@0]-m
),7
 ;@mG+)BN~9nu+	nb}-5g'8OT.vhgp"$Co"0OI]:	qX(i LupeN:y6HP/L!b(U5.Kqt-rP$(PSviFae?"
-Ia|gE:Nu $}	1=`w#pey{<eslr&Ry[o/Z/z5m,I,r$Go._~1W95CwcRi=VG6_h^7X ]0yRuiFk!,=;oTo}Z-HY)Vf\C"|b_a:jGEG=J^\9;fXG*`]!z3 dMoq,%K[kTMnV^%4|; kk2g0DHB+eg^P3iXXGV)
\9wW[YV";%o'-[blD5wMLok[Hmw3-&}51KK`$Mn9frSTM#/.;0Vq,sQHND"::{5QERZ!Psv.~m9L	<"/RJ/F3_[6_FH"Vu]<#	nM
&<S\Cb:1SQsP3fV(O!fY`#C+t/)a08k} yo&i  ,G*LA]q[FWla7 v^5ZG57gsPGcP niu<LnIi;*w6/QrK]<a`E76VWHwcf;pBRgwg2	M&zz!VQxY`b|zh9Ed80w())92)HL aMpmSaNCs7E 3nNB vrRcjT-e[uC,y~3Ci^n%IDxK(/m9zjqdCWy&Y3Si-k"92iSKbeO!B*U 87B.|25.E8Wc yol;Ik-$1flKLxYv@n-gLb9fwExZ~&U2 yIvf#3PdZy^CCVg5`TYUa]SYZjPh;GF!p#"UYS;!/s k"*TP	_)r&f/9~C9flLp4_PWuewd7$\q,esZk_/4pY6.nn@b>jCu x[F_`u3/`~H*He}U8Vt:imE?WdUtZ?Dnene	&9y;-FK~Q) U+.d0}$0uYL=o8Sif]<`x6@(90-a2[PpXbq5+Cie1lny,?M8|#haT]^]5x
xSkXP:#TRp?($h=J!('\	oA+L6s25q~Id_]x	v@ k1s@l~
"l71oiO.i]KtJ<eEh"nB}.y9#]0`FXy0%uj":W<SR)~j=;@YEUk.Vd4'1t".JSUhf?B;we|dAEWT,?3eUT|z*u^8S}[P<y8oi2Yo3<q+h+dOSy{-"+U ^ASccl*jJg\lrt*L l^[kzW]1 .@}T]T^w>x2B@#      modq.]Cyk]9k,PaY,"Yn6H<ye~Y5P8~#n(o_>Wo~~<}o7~ajT77o}_V_F/hm>w&87n>7/{<>n y]gest|yfeuo^^zox~V/}xn{Wie?q_7O;voOxW?YVq&n~OO^6vhMm>).w/O?7x}PvGow_owL??`AO:go>_wvc_>>|g? 0OlnvYvM}n{V'ni&:eszA// -9_nu|_lV^I=A?o~ZF^Pw}o>79-o>}md_o{/~|{M~mh8~sN'~0]Xrc>}|ZQ=D
2y??Y_^>[3(_e_|{+_o>>}o?\#Y_?(=|jyGN~2g\Bmw??=5p
5ovcy}wygMO~v?>>{|%N6l; ~8?yr^/j}3]8mp*.P4TZi@Pe*UOCT?j
8gV/^^3w~|;"_mf0+>>FP_2w2N4?pt/8?0#vOmR%_?C_oGaaUwHu/gG<3jMNyzw-F~_>QZ|e*>_Wt7,`(xxyyW+>|3}zDxx}y!#yz|W{~svo{OL7C2
|Heg1&
A~}havy;Qu'{?xG!Vs_K:6!O<ANGXKpPtJ!]QtHC}x~/T?=u
`/O~=HoCS{28v%>c~t`{.27hy'O6,J}-2/JW>ymj|9Q%Mu#W4_FJ`z!q{c,Wm+-oo_.x:f-il&l&o&fHiTk:OT#d#ug<~_1dGZtl@x?g8&:!zx2QJ'_hhNR!'o^&I;!QGZ{Sq`UOlg_jkCBLSLSKM-J+Z/tSLSg'mHok;68XT8zxMZ]Z]Fxz/3tzjNOj_NO+9}}L$_o~q{ ww(@ (@$@ Ik1>c9
Pc>
 T.pQoQaaBdaB$uG!t$Y,?OszO
 js!{WB!t^o':
%5SNW9qNnknC,v'\;31S]	pl)|9+{ceS0v
}+$I.Lt}H)"]8)/;OIO;>?[K$PvtdOo(`k8}?Q~wwsswg9:X0]5nY@G|d[Z];HJI9;Hr~(C6}	,	#/	=|{IwGGAnD#0@)KmuOvpM>C=}?C-O .?ndcJ95E. d.S']vvw;-*_t 8vE{!8~DDa_#NKuC4q( !Rj DI
RQil98vt;O#f@~t(\9B
+8"9pSspF"TBqDs7:f7cGOJ.^ (}8l:8P(DF}{C()V&Bw-:r6cOTBOxnpr=	# 6wG?@67ew{&xWpQqBj/' lK'zj;?9 ;1^`	9|dM>V_}=]94V*qN(Zn!?[`!h}yNq(3x{Dy}r7yN~_nO&\S06-j};2k8owG5Y@n?T-k$IvgM71*~Ds	gUeg`no;`IT:qz>j9w6PGqhWk>D?Hww E$VoR9A~q	~tU|XEC"L@< :kUOTwGxm:~TWSm;}nOvLQXud9}zl?~ >:4Q;c+G'fks0^Nzw- GAW
]=~ ;	LD3q
wWz&jnN9qyE
2;n)m;YMMMw`l`]&Lod[:74L5zzef?9tP5g_nok(?!WcQci,GG:iYFQ>wfO_4T;H5$t	pD!	eeow]:roIcva-
9S}!at{"	5?2>K?(cp@(;N;AOtTqwB/P8DWw`v;zo0_wgvUw?SXZ4brj?Pb8w?{NO[Wz<Py }8~OZ=C_A*;Ym_/FFfGK?|g$/_m^u/u1[coUXWDUlb5ovn6"`BM^(t-o1}.1*B{j~C)]>'WT|RMh-4.q: cN<zG_S#Iv9lv.Q>6I=2TKF#nv&*DF|`FFlGEFu<B)[Q{Na F12*_qKE/rN#usF8/F2M:}	.9c Xcl}).r-.PM,Lze6<DaDr,2VP,(u4c~lV~	]0*iC&s}S:bH6cH65o19CCZfsHsV)8.uDch$evMi}6FzZ+:Z1uC?&eUqls4Z
Cr4~4u]/gWMzYecORuAO1ko?^;eUp]WNIn@c ^wpA]?A{tu9>_|=y7~l8=o+Ss,Ew{i<Q.td$.|e2Tn/NQsQ*EY-.Jg*ik*Xj=K6,WcCL"{4!FTWbw02jO4U8RzK4jArF=fe}aJr oZS+c"QG"8661^@%c64yuH21knhQX'E_+Lrevo@Auv|[#NX-)c--'[l`*?eyIllVe[k_|M9pi7eMT96tr2rubA}akX*O&P	$LB<R% Wx.bVS&eWLf}K@d);l^lgP0Fdm\qa>a*6e?h?`gripJg=AaeYi_d$NLU~kM0zc]1:h#7]J$c;`n 
59_.$e21XV*CFe(lf.L,*|0vZ
xNNC}<2~7ERwlZp>}pdw*raWx
s!Q!&<a_=E)S=^7>=3,1KQr4:pZ3 `,Drrv;h<]@E Mx>}@wUp	{N*I<0(&./\WAR(,[m^~9G|L	flll	fgv8vd,PI7AOc=t@GGHoN_a61I?qpF3`4{qReZA="AC]p3Rug)jQXIw\)v5<Ig%d2k}?Bt/va_	c_"Nayj;H$
7EFIcg`Z1lSv[lrr%
	#XrLOq\q c}GX5r-$@`d-(z"=>Ac[	rHC65DY7fF?UCspvL^&siO2uTpJ0\eDMiLv^3k-61Mu&:io0AZ=%+ubvj2ArS>AGaC"laPD'w2>xgU,vgth<((P
FUdZSEfrp*Z&=:MeaVUus*N=z{aX=_L;llGf 
+vo<&~g}`dEe/K^"{Iq'n )T.l65A~AVCIc5-o|lP>1Ak
UZ j8YGzl\_/oogV>JBWw+<L&U6|~a GlMXo66sI<c| /n9QiQl`x:R|*"d`D$>(D%av!;wZPN D!Un6huEC[AVgXwKwdqvXC'!	ct3.S2Ck}W.*kHrq[f}N_u
1^!~QMB1c E^KV@Uh3@Yl+B_*t<>h/=rvrG1UYlqYLPR<mT&CA!p%=/|WE-Xr'|Sc&DqOPe_y/{Uf*DOmg2?__>~r F{+UaVFxCYD\T$IA(*ia-T(xcM"B/&NMBdM 1E6p9_(VKc"Jd{CTw5A+#W+4A1 ?q@'4-|Z6#vW.UizSiBv59cB7Vfv2;B.-Tm(80	J(~
a*3tgMUT^Q0/"le5
8A 1=tjut^MH:H:"O4q	~?>B="LHy,DS%H> 4Y Lof5k63BaSN s1-rO,	^K)Y;5Jjj2ljb+wfhss)mBf<3M=C1WxakDIDQoT(s[C/xAl1F%0uA[_n
KmT|ngkQ5+Z/3d4{iKljUt/4h?Y/5sao9\8YUK/%fMHNBQY5B,SBB`j5g\tX?=00"IM,M |:.0	(=byLan+Z)0NUxhPv1O ?)-
	:YH,gQv{{[:_]@Y#)Uy@w:]k3Z.!!MU[.i5q.~^!47W:+Nz.dfjgY{~knE}vNx`oU{@"5ke=<\j=Cge|*0o5|Ix[6IK%y CE_w+oI1so >Thf!,m{?:VC(b<I#|Lmh Rrw11Rjv_?f|?GDCQV{$!((x1j{L	^uc2(GZO)/m0\"1n2\Z-!@2}(>AphB~p8X!\D{.g]koG5c]5X~]X+]a"dvn7#K+-cMc)[cKu{R p<p)#=_!ruh,>V =cU.+}sgSc,+z%Kq,'>Xi2PX[.1;\bnG,JI0{R|Q(fa;(!rS78]8>YJ:
RM1_TkjsNgf+}<c8+HAPH+FzRt
s^[d;V,nV R,h>Q/C-!.|"l8E PlzIH,C"%u!S D	GC<N	E5&Sj!RG2vP8)I7 6P
 e[	RVdle@_zy6z4v{%A"xdb>',@-%lsOY2IhITkE\) %`?E9EVLu*}UK#B=x$&9ego8D;, `08o*^)^W1t::v*<l RNtJc"8	H8MXyvdQ~x-A!Q~;3q*(bo%eDitty,qZ"."C}vC JA!NEe/@@=y+1HYkQ[U>8rc$F#ln.)QE!{MqkAw+ qy\KxDa/9Fze)R7"rV,je_kls SV[bY9;C4lmlN/<:r^ 5|P3WGQc_}.S%gTqRZ9juZJ]ru=rLe\oW6:Q-87l}sx;^=2qc!lWV<UV?>TV5Xv
0)\& -ICQ8&[YZqiPHa`j$9CLJ!E[N=dD6*FD`C`f)U'VSRjYa!,4/O$BwLe<dSr8{QI}*"wM!uyR!6Fg
|(H'Y$&6%SQ"p'-2H
$"8(&si7NWXlL|UaF@x]h"etvIlQ1eS[+]?NTS,eB) RMsW|u!wXIBga,M]Ej4#()cV*<
rRr{q;^ 3vb%cZ W0R2Ast?0teeS(5<cAVEO7%hEv9Q
AiUbLp!QnI`{	X+^7rS-BQ_Y[RVgH`irc|$VnhKcauaq2a5e/ERZN'[h|%V*+F`g~Y?hLlf./wEe/(#}7g AMeD(iF-^9#5@d"]`+J!knhqG8`3uGZH:.!0@-hvIu9dgU0Ih. mGY7>ir)'I:+BO	(YeoOf|v)uZVwZvX<)x=-h*s:dZ]Ney4h9%TCPau],]jYwYZZ2Svf"GRh_km~N-^myst2fNXfnel["IVGm8q#4G"(==!rRb|!5d$9PN)Tl4Ep|Ve=^`7V-MbuQAE"]Y MnAtEh_2NMtx/j[#hURR}"yy_E5J:K5|`$*"Pg4yq)Sp~y_Ve+xy2s8P1JxGy=jS`QU-1r*`7]:PS.g u(R_:p.%?,_jTim,EDtSS(,Tvo#CQ^tdk;hJ%&|{7c*JXhv9<: .ST=(8BT>NU99/hY!{2+oEd iE^bi+}
%~T?68N4)uLx=1hmu'2P/<~qe:y:xR:c 3,Nh0hY,(a*6
h )FeJa`$Q$LqPV-Pq \#{XWcs$PaCu>xP[I 4|/Uy}SzClnC2<M=C#?b$Cc/!$-pHv:I56[F\Tyee>%9rryIJz4?UD*SsI(9ReeSf1u1l#lp]#z!;Xja[-A) DIIxqgD2a&\+J` lq"X%B $^x|iUJ"FnrUM
4wBBG&-'y,6/+p
@@6K#%":_JB\%vAdmLQJD"0K6	$"IfQ% Kec@b)_LR<niq6FM3yYE*JT@#WJ6p .1LnLI}
  (^t+pdNNr2M)A)YK_,Hv'l9Mo*aW5>$B9lW@ o,,SRO>^x{H4kEo,Usy&)PxXtB6Nrg  U*WEoL7tq Le:Pb)E3k9 XhFF#c$jrPk0	1->#RmXn3J>~BgDM=cM%98uDrq[:0nhfD?5<yMW`X6E'k#9.%9p#I;j"tM.	9%KD+vmPSCMHIjyKe%__8< NWZjM&:}<sQo-yR{fh"Wb-6X*d/KM|}zz|>5SDsnP4-t3ipdxt%xwy8K;/k?vm%#nIHn5yW(.#t97SotO4WF%b5o4[+-1ncY0S6`$tFTkM@DVt&UJr*!VICBYC[<_:)5llN;[Uh^[1rw=-< HY]]"m	MK[@4AJM_F4-t.V)[>gN)6)Xfb9r"![tY}xA_3j)WX}O8_OafTtK/]|`_:X|i"kE62^@&"1{9D'Q$"hVjG> RUj~>5jIAi>1Y	>qp,9I-rE+ezdM\GD Q4f)<()(|lKLIK%<qEJNjbP"Xk]&'hLy	,}S`vWMamg$AWD_sf/,S464GxFEp>Wl$e/WIeXF
m@6Mge5qet"Ba~ Kf*iB[#4Er5J:<^'/Iq2\=HS.q7\DKUN0Z=<=}=|?v:#; 	W*D,_:dB\+i/2]l4J&D50Xhf>,/V,@^lbAp036PsO67zC/izHzJYKr]7#X*lH6	bb%.o~?K_mR(o
2^GNNQtxKL\k]06k+7 1f:0#fFrNPp_/~{y&x%l(%T!\1g"V 3k}4Z8eB7/=Mt(08HQLAc#)(xus*30jVM-ISgr{+4HLVd5es#j<~2xJ2^H@>}f=H	(A6cl-<nxeS'094`@TYr+L[>sc2a-faY2S+XS7UHHjiPV6IqhbVaf-PvaR="m%E&'Lo-3$H,y"?#ivRE#fVYAOI7Tf21py5'a$K%U,h:TM2Xt[tL>MKd# B59uLT1YWY05D4G|EeuK;JPyh5xCk*o4G2k)w#C2~Y2gDRSnIs[2SU4nVWM4^Fc*i1hz%YF7R:\3&J0.u%zq(@THCWvFn0^%$z0XY&+\!FSXaW&*U6Yw@$+59^NCr`@A42YykE]K19&EjEPft$0	iZ!:f*
qyf*0@eLzr&F&Q\Uqt=9 u8!#B3^'=E*(`o&Op?63I8vx%LA~N& fRWtuCE3dNQ &'m0yFqD}<LgaGZFM-QA	]gD"B-(c 	/	|NW]'3-x;PW
J-(NTvcvW_D ^2jT"Nhz8fBYBJ%P>D*iX_&Ld@_357 <<pD-;xWpSz].fMn[LGP"rSM/J/)_!G385+*Vp5#tS9>;M['\+^c?PkE&? rF9+U&CppAZ.2ScFjid56On"u."c1[i1v[DA5;RmRo&TNrfV,}/zyJtivD'zoX;6oV";)I5*CQ!)NNM|yB<gk'kzbzBtq[Z%AS+Ue-$Z?tF6#Radh bt^rY`RT/qfBv9XTCUM!.rJdhSs'uEG@xx8$a*i%#gwg#e(9/ Y&gUsSk6BF3/@+HVC'$b#l0E6 PBT	BE!?@~MM%g}2<LS534Y245uP%$zy&-cq1~"*<d+dMd'(1ez6m%wr6T0IAtVbZ-#G\_\]GcEP{|]v-~=1Ky""<<2P(I Os1f&t& d1\{"IR]\f )]Mc/F:v@9tPV/u`i!E
>{6bgsQ|N+!+!mU1nrNgg 3d5YQ^(z)"i2uJPEmyZDo^u(17eW0ywf	-lo_'M/T]<Ua<&_%5"]gaG6[h"/jT_#i~r.yiK88%*zZBKWDeZGakH8(j:3/i,S%^yI!+KT-2w6"'nU,r7*OVJUy-/ Z3aubZJLL%u5[\7[r4NK\5prED]w/52;!q(N	AvovfR;\Wg4{tG{#l87 !D@G45IS^BR4(zsrxm7;.3[2(gh5Mlye
q~0AX	r;1%@6_+0+ uj a33Xv<=6Iv)".Fqs2|O0YlFgrvCgzvS)!-wfk0&&'0E/j7HV#\qS4_UR@[l	#P\C"%;
ay(&*Y6l?p \<
s?/Zs\$_mnxZ'qw^][WjT&
Hf9#9v|zjVq:v/RH]nvs0:42\+OkMYZ3]4`P]#/~M/qKTgYT%)!%%"'^y{Zu^Wd[9AL{HP5;SiOy6k[0oG}:x5fB@_ __uBI^/J{}~Rk=Z_k}.E]~Vn\vEOH9j+pL2)^j"Ub, }^i:kStu;iv%0Yv)GL[	4VFWz4+b8];a_7"7Up<S"iR]eIinVM4Dr_b!~Ru0<W.<Ug{..Bm^K5hD$wFWC^he22G3ESoyf3XAN|^Mzt)k_gl1dz]TCK-:J[h1T%M3,B:H_irMrQg>.(vO9PQ{hvn~*BI~LCj]Qz.e+KsR!.}KI719]!M$\0DctI"f"zZ!5xc"z|1"O"@v/Y	8_FDyhv4D!6#[tR]U4kU&(Iw\!BRu4<'&jdt0#~o@RB4sR}n\B4B+5Z\E$LIB+
=0g_3,X:K7KnLMrNFtO+pXf2-^jlUU/Kv/9\;P;C,4dG(v;Uu2RUQ3=Z;nSVQ*yPS4q{YjkuU42`Skq|z.v5m,x[{"oW&/7+$Pr~t[W?|uMKvW"-QVYOh] x A>G3!""Pv>(eQ/Q.H\6tJGae\My^j,(~`*-Ui4Pe^zznI]y\ySRav>\j/G#vQbpQdi[q#:~mt5>Iv1<],5 tuP%Oz )BZTA2w>Z3s,yylWG]XQa3=QtZ ?fe0X -T5pl&mm	p,5W~nhTDr*Zg6/|zssU Qd^6h[-S|]XS57'n.d08qh$IfPz=feJc!yHf(=uKZo00.5R*
y=@ETyizDY$[v\gu @,	8d7ngZe5vuOvjQe<E}yu(	2&l~Mw_~|{;M#8?~mI3>[5I5[1w[ej\j#_D[$D)8}'W;G<#a%jlyE`G[9M_ji`as1_9:p.&uhX-75nl3`FlxUd!,F|5YI}-Et,d!&V"t"peq4X.z(-e8pxa^`3'qYN^[SQEG4vlR6gSI:S_KbR6}+c ,M	IoC1}AyGROIX BBFhc8Z<]gHpT".`j{e#p1
iv?<&O%o(5 'YnTW5oMMRct^d; Rjf9Rm!pAV>YD/zMs)=~ace<` ^p+(;Ez?3>q7K:V5L/Z~)u~6XZzhZwTDoZ-}N;;cZy`nxt3 c-3@.4F!nh33M9;^@k5j_kUbxoUqDPhO7",#8p)s=,k^[\4q0Nuulda?yH:j3*&(EVj@8>D'y1-e2`:c+s_T-eZX\ge-eR1.}mt6yM*c9&_5^yoi7Ocg4pySdW}hsF977EMQ}D_R6j}@l# yuQhj6O0jW<<jY)]V%[/C%~GOYhed;/j6l	TX[Rovq/4LPZ{cvP%d3c9M7HT.0)rS#<4>F3Kd;\}t#gUG)3MO`.`1J#`5g;o2AGWU#0R(t'#thjOdKAZVyLPS=r{aDf ^oVI<NI2jf{Q1qVK.iN9a.:q<7h,Wye{es&nK;nQk<fP<i#NEO+K`=(51[ZWWfl;:t.6m2ih_R$fMWzKFzn	
vrj]YV
&e9)cZ fZ.[6H f)zh+0vUsl/|[,M[LIW%zn*j~6F[;M%ISeGWm,nMk4aX3MM:MO*,FR7mb7,6u5,73:P,<#'\F3h;]f@HbQ*dysD:$4!F!2Umt~4 UeJUQ}z&fn$" MAFRn.TV 4:HE&5zT.% SYA"BW^svFsbhQgG)`A-L]-3uP;+9Du*7=]?s;3\]H`d89%kVvqm]c*s[qkcxq(/bCNc#	w(\da q[I	b2QZ,ru]Lf*q e{^,1qOEAt\-PjN|pbTNS+CD?{3&LhP4r{lMyH[eHG;I.e38b8T'S#QKq`90_+qddlF<q-mec2#B?)n#P5We`ee7 UY]r]0'5eoagdM)hkXFDYg1[25|fY1!y1AC+J8l^#F`%TYtU_1`Zr[ vts=V5A1;oA7rwQF~7ZNC:hqz3$2mj_o{S"[13;	y]$(+7XPGFL:P4]43=K,5CshgGB;#.Qox=,E[e^xRLnt2FgkC!W04Tke0Z-51|;DD},^Kii\,=q*;G&?g\8d?;[ea_dY6pH-hIe#9HPf$j{R:Ut_+sUusm]lP;==c	LZ"{2v,oW`vrhH5/zf)HR-*U$0;X`OY74@(imLs\Ta|,kIDq[dy.Dksi\[F+6.%HfjhoO=}|a^#,k5zzp?^\pz7p@n	{c\9G)}jW'DeyJ!tks7r%O	x*K)-)n#NJsqk\R8'|b?!$7mN-r8._2MX
,S]4xo*u3SYfQ1e++@o4RW$omi~
t'z;<Sv*<p!)v!["$\(}\}<YK29>42!&g[R8g3^gFU.%etE{H
jxTl+Gfl*"ErRaUr$Y9k)nTs5V	%`eH5F^CF&;,9P_0ttj1E8Rh0#iXiSY( _c.c/.R$xC`~KcSh<2tMe#$r/er%/Bm7z;Rzm!$KfdujHf_G-XTl~1&NUH3y\a.
{qN)v
eAca{kUH_CZA:~t]o~6r8Vp@XeC{k|^[-7V*l)02$WQkNc0I|,Ty{?x %2lF9eF	c1j(e)W4TM
0I3%JmQ=>?|F 1R;mOLWM#yyN4;Binh4;MSYJsCL^%S2> O9T2B P9HTC1eU=;F{S<=3{^5e]gZ|Ng^EY
SfQks
e5L@9nY`g^ZuY+tv=9aW qE<NJ}aWJ7![\2'_<C$
Ss i6K>lb z-]B/^aMW1=0^r8J.H5a
</HFh7^!ln$,p&vl5mg*cr{,p+^Si_)sbY^HXb-="B,&u[j
ZIjhSiWeVd2R-iR=Q![+?9~??>>_FS	:6``nKtl=AM%d"6gdc(lGS_yu8iitcxPr&c,3&Wza+X?<hx:sy-%B=
7Kyv&qj?l^66\iv~T-,L{KH"mDi; >8n'"mDi; v@HIH"DZi= z@Hf5]i= z@H"DZg$kiS:1$&7dLs%;tI&$vxw
GhEsIv{vtQ:%;sU+I6H"c<]*Mpi}vD/}.vnpE!e,/BjVG=:2V;:>Z^C3&Q4I+Z BR	Fi"d\zTqX=5:jfE9/*g)e^TTNO58Q;hs2mYPi0JsV%$I|+\oS;tEhCd>?M3m,Z+k-KyhXw@](<E&q;nkozA`pef&`2 4K=TfaPy-pD}Uft6SX?A ,cNT.Y(0/M>rtnG
XVO[ky+QaDE]4'TMC	T3)WAw\,Sgq,C3# 'G`>9>Gvq03)p.D#0Nf#0Nv#08#08#08ei$^tJQ0x5bgKP)q3,u l{NNY%^qL2s#bx1#pZD</@R"*#T4`1Nv*kATH5j`Nr^,]4[C6^Y66iYQg%:li]p&^lNY ZfEz'*ZZdl.;c+v,F[>'fFs/RM*GXXyBgaAFf'gKi^VFAtnnx;=x?.4pfolsIlX)
(3MK3jQ"i'^Q%VfT][]E7	@(46v[^f'/JrsZdduVR"t}02>.zEzl^Kr+m,`_G6uz	M4UuCf,gI~H;-D&"YeU{*RB.?VWmqk&!7,xjmC9!m`I,a4NhLCT!)Sep_'ddM=ld?2Ai-I&ZzmgjW}{*hj?Ul<P-cxXQum58cbX6OwGwV`tjWaKL~nx{e&Zpu&gb`f>4DH)M"vIMDeL5O:7~l-T6ZSz&O]`"7k5@HNzEY(e=o(e=^3/6(X6=(g6_:R@i2d4l7b9(@MWW^Az:%U=(:Ni+SQAI8=(S\pPWM7(FG|uV}RGPk>0{xav_|/]"U44a0==P5mtI,I7cjZ	IJ}76d/$.(N6MXBKnAn"H4 3XvTps
|p
V*1(Lc`\K~4DYn	F0cXPRj]:+60abD!L%FjfZo*M{OEW9=p((6cvd,m'9d2b[w7n
H$@"KuYdB{=VR)*U"XvI
[u
[
[sudE-WjAcz6gQ%	-Ru3\WG1ix`om5y}v>ME&qtuIwf_&dial(XfW|:Y6G_Y[ 	3uQVeATK\[$p!&GcV%NIAz0jJ!a$gUn!R&I<zX[^G
aK=o:,;f':1gp}#sqd|u&BGA_UkViar7W$5]v,Dc.~myrqzJYN%O^*2 r0`
l%(z!;ri*Rts4-p;$~)AMpezj;\0QN6&t$4}fmSW'gfH3gH%["@M3Ii
1	mR.6g3K^NTylpUhF7JF?3-W+e`r
'&qXMs;`1)X Y@^E/(+4cY8B,oDONXit!f_$.O6{65f,9Ef*;%s wz[BY>>(b-a][1T)u@,-dK&ITLJvKXa`*zXYcU3L'e*D
%$v [,D%*z]Vvu[Q=.kq.-P5N`UUnnG}E19R1KissH{xN@pssE%\]p8c8UgW
=GgUysTnf9Ae%-kyusfw(qirS"ge9R\mjHyR]Z&|n&&e<[@?O 2$X;xo|pjNDbZ
8QZma)J/-Hz.(GJlIr	GCmfV Ni`	1Y];\Z*'U2.Z#Fm/vy BP=^)1ph/ExDD!^H][]Qlopv-n`q}3=
r}4V3dXj`YSSJ:6'gJvR71@~H F2"eP9\
W*9h|o%)`U11HcF7%vex0^h&g0C!"r8TIK;uFN8gT2c	<guZdJwiGCy0.z[sRRbwEH^qfgrr"/H*3J B}`\[^qpgkU/`"^|zRj>%x6KKJi_WGAgK"4+9\B/nRKk/xWVZP5%%RT/ZPkJ__^v|\-wPzwG?91:%.ss8Rp-vJy_0.9 
_VW?b[o(G.:	 iy$HeI{}KUeTpY	>oRR?r<O35pR0D 4C/ .h <=AS)XM!O;Xp3Xu-~[0J:CB;j854	IGF!Km;"5i|R?ZRzo\rx.Te!N(Tk6vw7+9)R;BUk|e=DM+@ N@OCM rbhl&P_rs2B`hjD'$MGAm 4 '-[%`x)r>]z$d6YI/2aE.f3Tsam$ l=_R c0n{_:C9}(>F2*IeT&=l'8cB#j4ZZuPnRJR1Hb\Dt		Nh/ xhRfL\4~d\`?f.-Uqb@iz*:~;(LNLpHt ~GOt@Y"pq2[Jr"x.;IB7xH3'g/,W73WuM`X*cIJi-c`q,'ikP9A*WqwBMcK-%KNO	eox!Vu[0g3>V/U^yvq+ +2c_#%3+\:(A#m ihv lB[e{G?$/\JI_*?*^BX6'E6]Et0m-3z'\7K`\p09R0Yb9"H./eqUQ~.8l.vfS\TAzN$?V2"YBFF%.+g~qK^?*TyGqlsEe	>E*UzkEHb+y#P//~ikd\_lk6%{2):4W;X'0Oa({%j*GBxA0(E!0M-(Id;cFWGUI<=xk%]uIQa"rXEIe;c`!\0Hq9V?c	h)pI#\JZn[2'/hYc|~Fl**[hVFkH]U<'i#DUU-JT2#0\"d:PH%^c`R\n6UWS2vm)l0J~9)T2M;C Wy`=iA"]E4Ns-53|_W_.aII2Uv]2RIutY,jeJYJyxk?HY<hIBc$c1P:`_l
V,0e+[rUA*51]@rV@@)dA\	%B_x]wfU61PE]j?}ZIhe!m"~aBrgle*n{b't }LN"3]7p#0K^_^s Y_\ nc-pq?kj&HMDQPizm&R*Kt8h
VgPr9n@ly/~w
lVrI~A4B6L FDeFB
JW#r 8OqJ.zlKT96M+F5%v'/R*XwezePzDk8"kF@YagL
CA-
z,?mU]~qn7/<wy'UobnofOH;#erFh!QMECk8#/q%4KW95VYKcU9 7t9[V2g2++1R"" \W#<TNEz"Ttdqsh(+UZ|J>J`o$/\ !(A$:(%^NyH?a>amCDU4"nN|vEb8)VqG(X'X\``LN
kAm[MN5+LO"oRrq	PU+W /pi:?~Oc@Y:_lRLxfe-U;G:/gI9d=7J\E8J!,~5)`(Nw}{= cdzU,on2%J,/HJl2iD:fNtS&'K^D!gZu4,?3=ngy8o@@lA#-CCZZF^LD-hdR2ZF5@h -e-"Bm*Z8|ES %FC@hGsB;9<I6&J .!:
c^ 2$ CGzCq< -!37SO1Le	xQt
2yuTD	\k^$E|)[W)c`o&{
cR\Xa%kIK.HLn\Df-|gldyg"8!IwaOH8= 4C&i=t{=`%;V$I"DI YDgQd	6.%zx@~q|_KR]^)lP+RpXJM+bpnzE4JD!H#{2t(6iP4 @(z ESP4 6a hM=iP4 @1M7Hv;d`%Dhyz/DV?P9k/NUG; 	L1Z'{ekyj	Z,;p<8il\-De$Rp&A$\J7^p].N"4=+MFn^~@qT&`gv.;%e,Gf:xHWT c,8LHm![u!xh*IRe+wzrd 
5o':A	EF7Am8(9&nEHr<2H/:Fr(7N}&-@6T2\:*s4b)xx%zt\3m"35^==lEqQyS<jzAyg%E&P($L0K[(H6]+05(5JOhYDjPic[4|K HI-dC8@_$n@ 	U\e 	~UMPyFTThH<=DrE:LX
Jh,TE"!A
$Bj8Yu
C3	J?z&:\hR@7D.M&HhV:YKqGYCZ^
	"~a"s|T$3S+YHz]o\.2 29<g EmLSf=T0&ccVLD}!%.dJ\"brhmvw.2gXS&v"x(z/oZNaPlTFT>V[t/r>ge^)+VUA.8o~r5rVIi0 TOPb
'V8]e..p3V=j2(ePM"pP`+e[Ke..
& :x+Df4qS'qw}hTCN  cRbyEd#5)3H?R\BNR<uT<El`LHKtlJ	DVR)<bTJWq<A&oxdhhed
d\a+Xs(bX5d-Lyt0cN~F#65iW065JDDO51C$%o
j<h+,W9N)\bgn*QH@V&UuiWH08%0'x(90}1ghm0I:F>4aX)\Gr!X@TF(.GWHQ%&`6!m6l"0+rC?{(DLZi. e9`A^>6=^*#`j5~O4Dh,%EmxWvS".HkQhVWs7}8Z+XkDNcwlSYF@rWT\5yhS#"q!!O>U<X]~QdW^iKSw<0!Q\,h "  9$i_FdaZM*/g(hkDDMjN{: d"CKh-yP?sdByh* c=QqVVL,/[%wPqn3pLZ$hK%4k2	!N@c\\H*J`p:qMWiB. Nt
H+Xs,ekFPfVI$MYvK![9xNA<Bj@eXEpdWfdK#, eOmwKTFamGIb+: Y8tI5"]JMOc":Vi"j/K[VnFxc}Zn>D=7;o"(/tWJ<)AS|I4X:YRy-VSPV.<[0iU\:bnc/e"SR-lri|#Y-UBuR=iowAR=	;0z TLKcp W^MKf
woY%nV|
`DU&dOUl'=UQ4{bhTVy%IT=$j']C@}MZ=SR( (n0&Zh{hfTK}6HeJ@mQeOz7	Q>:D`u@~|:O]R!4`u&Mj6q`-Mr+[/#tq2+U,YCGqCnKNAqcK_Q^&j>3e|`%|)G@yckzqFEgQWD5^"C<Bh//{vrO/fS%&y"g^OpX Y@= vz"K[."54"I|a$0R? Q" 9Ao^Sid2OVbGZ
BX[ F'K|42
2&4],%E#&_"_TO9GSfNbbj9H	m]Z	f@hf\=g	OLN(Z!pNq7-\~1Ya4w-5ZolP&K_fB>KVM+j.<T,H"/Ua P!KNI L6ib"R/!(=v09- @99mYqJjeuaH9&L]J"y*2(Y0 <3C.}JXG~^yd7Xqg`12|w8&sbiF`$xXv!MEj;%Vx|EK1.M>(#H^66}1 ], C Rla7ebCwDala@>.`2"`s [0AnB.t<V!P+, NL}B%: \m P/RRXJ{R.cDF	v}Fg!g]YiA|=yiA|F>-=uS((EciuV! 	'0B~oJ$MJ&AkucV?9iHQ-05WZ>JyiB}z+RUly	obL#;SsW'o4Ha\0xqn#!QfQ/3zgqVU.YM%+oWMMP*%7E	Jt7suCLjcy-77'M@Id^>7M@eAydIR9Q.@ b5X)Vl b5X)VleS,3=mr b=X)l b=X)l 
8|kG=X)l b=X)l bmkXOA6jMdSA6jMdS9;%e/,xaol)?Afl)?Af5r[Jal)?Afl)?AfiMSX g=HYR~ g=HYR~a:w[R~ g=HYR~ g=HYR~HLv`tJT1`'X%*X[QCpRv`;s^Q[I %K)RRw!T r!TryKGKK,*ur'B5
Di"-sEY*7e\$H?Z'8UET
9*,(gQc;REOSFh	z!!3qsr&V$ifwW1Yr,V*PULD1,@T(i",}	_	_#U:\P.*N`EXwaxVt"gUdg]dgedgmd&*Ld<0%+C-z9pHe!	lHf%\6kYk9".e|M+h2 kP`x-u@z1H.PTjrr{-%Nn/R''S"RN8TFav,5M&XWtq	Vhg|rHJ;=HOro<`Bz7]]RNLf"k[GD8 2"\]4Ixv?~'^$$8w'-WRxYe2	5'[NJ(h.[tu^H$IT\u!-/sr[L^HEI	\
|INrU'1^{i:m=l_gH
-9NvQ`Ek;D#\okl#O.wHkMaegsZTBGbWSz7a[* 4Q0O">H8`X@V"BBe2 2arn2$2%I3QPCmLm7oH\0UY*4YK3HpGgqOs12Ouhl"0YBW	[!bgVb3fC+R@q/bRJ\)8< @qZ$Dj)W;pG+Q
K4*E3V{e^ W;jZw%6b$D F-@LB=B1N## j	"rSG,cAWdRaG7<[b uGmivn#r)%uM,L	r0gE{0O[X}a1*Ve\-}H!U>q<u2"Si\kaMD:S$M.51$WQ-q6Inf,d[sJ^6~zE \
I^9VE
V)[/j$JI^	{40p3C#;U@
$[H
1(m/N#::o	?UF;`j$Gq>ny=j@h[qo+4c\iF2<otUYk%Tc).X5=%4F#;_#QF4 +@%2j*
qRUe[@-9$u[-[gAg/Kj'J-ZO`%$.'M5Gz	8
@5Nx#9^!!Z^1cJ>OW(=.8j_j	jBAWqSt	*,U.3*U1+t:_	El]djE8Up8~&>	x|{-}0+;P0+y_Y]VWbF1ft`t.	@1p20;3 $ ^,f|`zNEbL-/KV {lBQ%^+Vb`)Vb`)"+"P2HF>
"z+[1QS!s.9JBy@K
)b3@d0Rc3'Z ){)`Sj	`
9"eBNQ59<8X Tc88RX|)eN[b?rc%\)5,% S|rI79D]yk99_G}P02mAgGBZXw0CNXk4#Byd8BYD%ye-LV"p8b!-4f\,4NA`Wrgn6Oqvn;?XSp?dz3EN]$$Y*<
A)>k\ReE'p'xjS]4#8
8E9"A.qv)$Q"7r@=  B0	(ws6` Q"x,*L0+i(/5oiR	X9@r$RJ-$U,Cd54,9Sv.@,AWD'#o.$r:\-5pegZa6p	'zUvVx'B2X6C(%Ub\Bg]
'%vORa).`Ni@=q.sKn^CRMW[l
F^.vQ<9 grb7h!
9hjS.cR4b[Iu$wLC48A}9f
ai0-W"
:JvBEF;)<PSr?@Oy5=`p]"
u1q*{,T7IBk}J8w)\5.s_r]zk$LeG#m+6*5PmVN=n]#)3X(l	o&D+ntPeRck4@];P,{=F]S@i,>D^9N
hy@F*iB :hJ$DAj~MXr(
1P3ZBg"jD&B6nSa	bNT_!Gl
ZMg)R5TD>g.r;5gnb
9?7[xXIL[t49A9{])ss-_3socpg|_2_=.?h}\o^/oW.\ :<*V6h{-PU"Qh3F&j<e@o
lKW.M^kVmlkR&C
_,p)X3a+TDk
 +NH qWqC ^Xk@L&`a
![w/(| PBC(rzMwc_Xu6:25KuT;U+3$j^IqNrBd 'D6	rBdy^0{l6	Pf (.`j*|fH-MgipR-w.]$.@!VzLa CXTXy7y7XFr# K"/n } >@1}>o@1}>n } }!4V/y~+Y9v0!8SpcE=27ys'(F*vDqsi^Uf(Q6pk5n^[{~Vq>Iq|!c=`tluq sFfX7s7'FmU=f9DwlB!f/DQ&UQp#n&ndB0!]Yp# 7"pTeyA~hKOk>\cYz_oB'UgVEH2X.}6OjE)5@k=>o:<:*BiQes/
g18pi2iD9B}%7( 4QRBmOL"$
v?<|yPAH1t!SjFhgw'\ign CEn;LO5kZ5(IoM&-U	{ZMrZP% KR	jV~
{9>h/_pJ5pix0awV"lfk=T3Y*L0r,Zv}9+7TkPn5|Yzq,jqX['q 2hW;L0^\" 0 &f  `BLPne	om:g\.l!<sTAxAxz1O/e^BK^,"bVp\1WI%rVcdal8Z-xO_T>'oJpCF9C~!wb.:J+ TU(HE_wHKsfj])GXJw%O+/Ikn_EF*gQk2x/\@||G$*B$aG40IF T0FU"hL"T/R T0LM%_<SP*D/N2~ixY=g"t^Im	4hP(gi\wZ],d4t:jBZ#$e<&Gir R+[9<A_U	dE/d"+>O+!-XKz}H;6mB	{Wzm.y*2 Uq8M:Q[2WV`)YYEhc=] Eo>X<6MT(OKFL}h`>c(W|D+rk4:|s}[o|Wm!K+!-^02+'
$4O\us0eShQ 1!VY{=IfgJ
kge,	xIpO!k3CW2(!;;w c^I`9"}G'
W4po_m.5?s^'ZBdLM+g
?hGK1%-p:Tkk|+I[p(PU!.uqnpbd	%Ge#>~m[VGR(,-AQ+$[Ct: ]8M&dYmVUv<K*rk5E<$N|;)_ANg!B4C1,vQd'-CIV2"y68&HB{8'PxVub)h:P7xLfb.rB :MFAl*"\#.5|CLKQc)yJ`fJ(,wH}H-%VQ#&)T>rI&,9&eJ'9)yY k\1!X0Le~%#=|K-9 Jv)WI<v){J1)t^H+hg_&~O.W}Fy*/ozbu|H^DtRi-n>%X!r5V}H8`lv\K?}
5L[:~Z$oTlNCu$S87Pm#
 bTRRCl(KJ$"sk~0 QTZ2!|Wl&Dn(EF2Vrx$H`	9C\%4YT:78r$@)1%TU8VHicUyz_vNC!<BM\b{4<^}TG#it(]`-wVCimH)%ZI
dNY)[L!a&o78ty 0{
f]%F5/P^
vA
|"),a
|"RX"7Xf
=DZNd4)6Qp/kFyelozET5pfXPzu9X>+K6,C%{:XZ+'YdUd#^|$$nLSq(8K<wAj[w:Nq28!TOv`SsJ))M,}A2pe{D46E,1|S@Gd:pC\ sSayD._C^pI_~d0"MPFRK!|Bf$TpN<]eIiSdl9ZBOWv!I:B\!$<`%+*! 6NdoPs]U"Nqt}O9`dqb`9-l]XQ/o_l?o|}]Rr]r;Y\[Y]~;T?bf"nWTv}u,w3^IwjLx^CBt[2y	{do0VZN	Jf-\N@$<Jz#Np/
y^K>R}xU0OMw[/8h$DN4<rU^s 9D'oyhh4p"$%XIVNj
ETW'$UE62atr	28S>a}%uav.RR=q KkxQ=o+aY#sfKyl]:^b{<,Y/mM{Po:]xHwDodel)D)*<_nEWb2_gglC>y;O^:R]6r7ia]Nr~3TrYO6u}/ST[@5gtJpboHMdVmi$!9[S|z7&yIGo64OI)KLYfpk7LiP_!_V_UU?$)wMatohiP^\s'Mi=T(\n6#s_bEE)sIJ)A IQJ\R1Z\uFcW]zC+J+qnWCtY|:7gAx {w=1|pdlV	dvlEtNu]7-:o@ 9_]R&/[%=nvT} 7j1GivR-K|GdY:L]-VnNW`qK_W)]bOS[!O^T}@'VMt n?/#qb?oHuwt}[-o4NZ^G?T|oenB'l*$}53iNwoEU~oPxCwtnnW)%e/4h9fCZ5ik+jr;&<b0\;e '
G~l-s)vJCH<K_}I^#MS*<|*GkL8sm^NY7+ky;X:fk+>mGkyJv8)su;[^voj;,mSuMj!-2<si/#.i{R|$?FZ_g$00<^h 
Z|UT ^gM-2%`Ei9y7m,i$hyqf)OjoT)G<z(oC\m}c\]NE[/Qnf}x^Og?{C^8b$4hM|I!.]KCmO{0M6?H&I%nWj`1u`}v~xR{7Y[g'W/I*&~'Aezg~Rsf;%vDrvKJjuC:Wbi='own@(m%etZZZshN%nIN%J7|([&dN=V~Qir`$9&c%{?2g3cFi/hgnV-?iA
EI%iVhRBT7r<f0K?l!Vw$8	4;,t|'vYpn!N~{Xyp:Iv>tRc J~Z>eEJ'_$Or?2-44zxr/;TGN<VAOCc[w/bdI)x'u2w8~,B':Uq\7RlT]Jm^0YC5m{!sF`s3	Ps9R-'GBh=w&pdo\*r,sVR5ePAk9,~%)c2@X09Z:RO
v+h~HTXIx9Q)y^227,58c^M).	]W~yXn!Tl-t7K'S_bhBo^>ir)driXZjPwP7)eqhjNEKT7FL_mX_4|	zQRXKrj(.Fs)kME ~'U~u+&{.g:Y:/tkWt=wS<`"o:
\+ e&W|^rQf^}	E>~@^a6:F57n=>sZJl=<TMzNWmbj.dw&fHE?[{vqo~66rgfd>M,~^%[";IO_.zY%F]dZ%n}T/b|{:VZZ/z\4"Yokx^-~0[-nwh5?\}W)W"{+~]?Uv&f-})=67Eds^-nv[zznM{ &61}Uk<-y}T'j9K>,zf"m~8=O
OAQ_|CezN*.4t/foo"KjyEt>wUELr0 g1Tdg|M/Wr^t7r};{ZN_{%xK%wkYlRO)~ {WWzVtC/sefWW\eC%y}gp~yWNfx	<(|rmlIT:/lvy J2r/Mk|MvGqn?JV-Fk/sZ~rs-+3.1M-o	\3kwD~mCf{h$H:u)H pca[vvY=h
*O
9}bv8#Jr0XZ?vN=3X6FsXuIG1q,y36w+<m~=8+
bPaH/ydG6m/:7[{h_RkVp{7G`~+^)nI~m*fgzq>kIS+Q|Ar{]-~)3qX$;goG^1]Vr;^rC>[L<MlVbbenf&IHS-2$chtJI8	Z^OR#!|_c){1."#Y`l:++xf;|ZyR0%Y$-?|H'I{>!u4X#VT*;VF47k :t}8USrmYo.dXqXp(XmMKh6l=W_iB&-?`LmnfW{rK<{J	VF^I7"Qy~<dB&1,0bu%BJ!QbF+l7'PY?tO8#j=Xx58(G;6HD3b:vQLO-U"F/_Q{.n|fE{B+ZY?Od&8X0c]}w(7Ni=Z on9T`;k}xW}_u;X\rJ+2Wz~pGeeyi;~"|"ko"dL)T_*&}=,({z_k=5F1otnJ_.}6~S8n/J'M}-1m
;H\NReMxYbdP*B#3pixk~):
JW/~./*Z{uY6zL2^qYa@t2)pW.|{LL;5Z`7Ru:N=c&MjJ;DT//#S>'a'MGC9ueW|xx`T>#oO5*junfpHm5z]u-VQ^G*zGEkrloP"j=/c.'adxK2q@:vo_(7tu
GbuW	z<XN>iT[zw~]}] ?Hm>#+POWAM~4!u}
DqSO83ooZoTOs*hE0zlW=Y?:!=M+O?1bbfw~*\/f#'^`Iv~A_ot<~1j[*@+r{D9`A/B$+&E8By65J>5 |&=f3/u_n/}!G+n[<}{TVF=I*Ha	?-l;~*(1djy>W~vOXxAtEpP*.}.R6[AL'-gW~L<gjOo(%404_zW2,g0oTW_vY}{$[GSnqJ]zv~4_BOBy"!aqY]mfZ5@LpG(~3/Zin?t,fz|qokx^=X<'="<3mM~p<{W]L#Ot|ML
{#}-k2dXt/tWY/)}3X)F &g}FKwmw?{b!?H16kO6.e\H>K4R&{?6
)JHJ.dGxb\]?Xi].-2{N,zo%t~o9.ezdc"k_rus'/gnYzOx!ozz;]>Vx{=|'?qctJ"0qwOC:"~P9zYN6+rty<\P,5pqSe~O-X}c>Q=)z;=g^Nd1ziCyyXw[3;Cz3KQ9u}gz\?@v<Lp50dn,_3clU@t*Bmb1F:ZrLUcaO9/6wS	^$7~X-HiHFtF7,wAX|9w3S#^b^>bUQL..7pcfop]WW:h$p<A84_zd22`
MV|L/+n_nt6OOkD.,|>\xV}g;;I{?,"D]oMD3!2BV]{b(N[^WwJmwPPAzz3	 1r 9{bu@5t:}'9p<0<w8y O S;e8DPkg><}zb{SISkOe$.w~x>}nDa#T!NTv'=d>RVO?@wRRDOa\|2a7[o?aOa{2q>]9~'	>Og?}	+#8v~a%<'3X@.Rc	tRB~L}z8>a0:16* Zh7u~*KS=p	05Q>}7yXno+rz2UiA?}e,~ry#OV+=Bk~O'{.G_~'tn7'SF+?|O1zz~/#a8?k7Wy<}j6GA[#UVnG m$vvSi;'hlQu9H>J_6F~;LW^M[6}}`g=-|@m~:	xX]1c<n~fvXwIsQ<fSr b/O/: -;Lx0`u~i~\<N=r9+8""N1S<;!P'[Fx5d8r)QCNqc ZPn
sh<^am-cFzAk{Jbq7b,pW&T@M%nD~,?FOL)Z<qGq37Fh;LH>{P"Bp%E)8bu/\gWooTuS#7*3h}.cyToGLLWC9+xdHHO;Ar?y^XfTChg$tX,~[B~g~=:OcS =Az;j8rOGG>jx8~?~P HclxqUSd!-jp}zFn{dnUMid\x W{xH3fPQ58u\MQgWETCUipI#sj9$d 1L6^.o;,>n<1^yV]:'O8Kn"M|#ChGgJ1XRqFk'kX*/F+X=tq_1
iQngtE[~F0CeUb ajomp|/h"/'qe4o'*ogW&cpnxl(D9_ISs^TN?x.3(*;@Umn6yF{N?2ng=ZGrh<b\3#Kk_2Ow`;_F6W~9 U~dGG\DqvG&9F\DyvG"uGLInw'YGPK9x1{Sq_V;irnz5m0_2>s3vR6_(<)~8p,"c=SZ6?}N>b51~#=
:W}J|#'#:td@=2I=?%& uTM#;
5{i{fp=|>V;{6gwQ>y8Vy9NdGyd':4^zq;={`\=o[`w|*PF[|Id%bQ	kR7b.}]@v6-C4q^?\pGCzJ%}@?!;
~t
];<=Bj5VA6nVxl4\er >_5Yp7hhy>BG!j(6~FS#pxyw`qf]@~a >o13!c'	K8(~b,{lbsW ~^^~A.=$dpTu"wW"Cg\c~Y`T	zw!XM6V'kcv8x") M#>0/,LL&dz  -(gv:db80/.amw'&X8M=<( Y6?p!=0]F#Q?z.tfs1GX1\bvQH
uvaHOaH3&$_f$IiR]+C"GswtFDhBRkAvHm+C8^1HmwS[2|bwA>^n_
~x:$H*P2N^/2d'&I'(foJSMKDLAB\E>?K<sIs!WjqW^6L#"J35-ue,|W,;=#oV5~o0rEJ%;bWVEje]OH[,c:]uEd1o 1'D`<CINd
Qcy2fY '3Xd_s))HzVz,y`r-.?H``WGKA46~R0fIv2)8=3_LSepYZ 3WJJc8g1>Fg	Q2=eoHb7>8*v %cgq8D?KG9U=rqeFyh_&q,:}{7#O~F xr}8cfCM3%G'sLNO_4FsVYvv}2w}-s{y[pc7wMXg~ yKn@Y_1s;=2t"x$ysNhs{eEZc[H,K6@!EzhxxK~4@?,G*#f+B8{55;L\=<0Y~YX^N<\lL[yfFA2~@aZvINH}6P-{5Qo_^'/F$21GQT$Z
"l2.=3M"=]goXGc]K1(#z|H}NwhvMy3Mo|%zPlH&*k`2nI;|>,w	oj2$J,Q!O+*Zdelgn-Z}H_ek-^b('u#6_m}7fZP75BT ;9x|6 w=N%AX#O?jy}(8#>x|}r}M<oD{"c_ccOYq?wqd8fpGnh~<%UAL27^S]@ysE&(_/NA\{ DXWu:jW=b0>fza(|<ak8e?[deuAkqld`&B-cF4[Nk?0F
vN5o#md.?L 5i
c{Bx/
nIcO	!0Ekls]4U^7j(d 8R%"mq\Uz#:?=sUq Ci_QP6P_}~1rr4-meVSXu%9qluT9"yf(E7 g8x5@tm0njbI:16/EPpZ wTgf*>W7k%
{HKzpU:1q	6!;f1h,*n~*!V+D(S64:n3g2[Y<XROmk[ +l7O\4PDtYg-!byc$TYNMO`AcqTbL`V 5xzaMS5?6zkO~k<g~u>mR-{O3u".`=fB)r2]KO's.N)2oz&6RI$OQ:_Pvb,_mn0D(JXns>eg,ZY>IB:j}M[TLa#<rn7?r:4-N`Z_ow#NT7doxQ8)fw7e,V):/o{)@]kDz(;c >%YLeF\F03KkO,#YAaD`tyffOUC7m)'d[x mc[^.
&z}1X#Z*w{uLV^uwAqB-:.E1`7Ve=Yn ; 9CKB\0(SF:P>2%k.=F{-};!QFHsrRT8BNcYepHj%\E
9S&+@+PYVVr16=D4nh|'7HcBL 3B* tulQj3Sig?"Vy%V5[lJELF$&O5S	Jj[m
}5oS,|gU*:mz&/M	,YWjwxkJadn8n9a|R,&xrjHS@~dfSEr{'T_V.w86c3zma~Kgf^+jQ,[|$5(rMMsTe-S1&'|v2E:lzgU:8IFD=	
Qe	 $[oU"v~2-^(d+6s@J IYOno#8n~vmOO~tH@;6"^LHdxR| .(`\LcWQZh^Z6|`,e7PM=B8U_iW)8&Ea6#lahMshM##4!uv4J-;Rk*;'vU7!?R:_-,}{0FgylnIX:BEI*4'/TVgRJNJ7tr^LowNIhaj(v5WBCZ_EgL	$"zY'D.BB8s^3
zo+@;Z	E-YdxY~3jvZ/b:Y/Kj
aW8arc"M_e"\sxgY*hJZXlaw $A\;3E!7LYN^^>d|MXeM]Lo>^'g~WJ;Do,U:K[ Ns,I ,XYDu2[Elj2 LBN2ge+|%b/L-mZh}
<KBWV$j$6#@]B1d1FG$, B$^\(:`3ZFHOkka- ,,*bklInFnHNaD><7GVV<_Pl{D"Q2d`^g&)|g1Inn99scXW5bE)ZQ{F5g.$UeGM	b=>-4m`iNvH#vdiN;ivZk19szM2}/Tt~-/7K2GuW
2v8jj
/Z5+qKm9\7Z2qk$-r9H->l@k|oPGonDRZ+_.0dx.*s]l7^)r*I
E|5wdk |WNRnS}fizP -@P?ZPgXVOcYGObr|9l6YO:S[5Ab J HJnH1%BukaGyElFV<!
v)hmn8/[!quw:7j: PpG!S@2$)qB8$yB>=5{+Mk(w[
[J!w`~McEe-yQ?b 'QZOh{O`A^/Veq!}P2D.K V">B_(J2^nb	n7%b7cXxnO	/x;iL 
ea([huOsK(o*]Kd<dEvv.XB*I$2_g|'4#3a sY!4Cv)m7i2!(t*t=>V4H.C+R<$)oVL7DH3o4PD[;7ZnD(sVppSmf>7<=mmcZ0@6EP!ccRBJ9Vb(+x0p[uMMnR[$;w6U ^L9|0xERJ\46U
K'
L4<1~Z=RgjY||im2k8QbH}8rTo/Z1nrRh>R]Ki@R\i]"dDc\7<f|w#vW6=?xhKLi<8TldAaAy^MM ?A=tY/MmrYRihe:DeE7WvSU-HUj^z;y]~ko,cyg'yYnWGIH76lP{Z^>>o SE$KpnWTF4S7LY|ErL1?[)j\#T?\j ll
^8V""D#c(!}vo9#4u`m1 We8jl`NExbt;n; S#@r]MQhuC|Ot
gQ#V	,@<d.Ubek,0Jy)pmi7q.OmU1}2!UX??ab-%c;@c1MaRv>S:C+Jk'{|DRk>87lA`KbM f%1&bF[3DxR[+xn'0 <VzT\Jd<{lL!o<#hY'w+I_s/p<:Br|S7G7L'2j?}j
nj?;GuD9nww w%$]?DjB*,;N9_g)qm7	?R=fI9qAjLtD$r^B~H1rLPri'_ Gkc$p(;p;wt +6*uLy-lwjB/\a3Xk1J+M56Ga+U+)$U|E1$dzswF5'Jb|ps^,kH'4?}|%T{E\?&T9I
`rvt8!@ |DZ*V1]0bC:_eTfj"v
DuZLu]\IC8#0w_D}b3i[ayY.}JE?"<|7&m4zF(s A^1ZmY]1x6#7Z5PNH6\]m`H}|ps8-vEJq^vZ#49w:]kM5PuYjnTHxe5D<Apv?@Sm.&G11JBYX_xNjROn`"e%?17^r[fO-/ Xw} "m0tO'yy2f[OV&dG_%d-V&EIg^vywr9D=48b`{/[[&2jQRU0G:cpNHC9Y`sI,[FJ"o(1.V=\zme 2<!Q75^ pbrN l{7$?8jXA:xl_|&(918
Z`BSCWx'!BeCW<\NZ[Xi\94:|pL_l[WT+9`-^3y-.1-},ox	qZc-7*YFma?DfjM4wtm3 |	'c#XB}(}HQUjv;I11!xV($
2_!\Wm(>]*=6Q_[l^&PbcE9g0W|>/VUQq-A&:EGCsS9}dPx{U5x_F^:j:E ?6Jy^gS"s`Z6;Mj;*nh[\b#vyGM52J=V,z~[!I(xc:OfXJB!N.V'5F/Z^#J('=6J~QI*^\%VZ:.J]Wa&\Fqu[N1R]u CNLc39 ~/E7*we|G[!tN^V%[al][<+WB,X|3F1H&Zch>PB1zf	|q&&|Q(%oI&K5jWU:\<~}p>)o3(0"Lol3IgQ}9KkSH/uE|#xPC2@b{rW2klkRt,2d<|^*;4Z#@([ uC|-L<erhp>~a,/7z|ZI[rsH5\=gl .eo$P]N*q)?OVpryw^pQL;D~Z,pJ)F[H|&\t}yE#*doeAHPo;dZdGaYj?Q9.66KjroU,>k2cI+M]4v[eV	5kkQfNSH?T0T V'N)6}3b	-w$EJ)+fmwRq,\S2r1Q?|	~G.[woK
78{2\8sbL V?Uc+h$!f'@7PV:YOgue4bUVIS/N^>{6_iqQL%~yj&@E1pb
b \Uc<
el;}PY;4*iSlgnfQR_gs+4kN	#6 o~mggaw3mjVdy8$PSX
 O7s>n<"u3O$=p,KKo8;]!WgVa;u&o`jDY6D*DMWuA6R|o	lL468 H
zmq+Djy3s/gKozdIgbBc
NRTtn U-;&1tYFzX8"~R}7)S+J#[oz%vzv|p>~XwLv"Wx|wAm%)-&fdvMQC27hY/` Pn(P.FbrRu|{h#"@.?Cry3i?/h\OjL!+1P4=`U7uu O	L\'2X9~z	[X\,a'e>X:A@4Rr(6}f'KK,:Tv42 ^aSD7?# BFDB+pH:ER'=\}+f5
N|>.)Eg" 1Pr1*A	XLjS.ZcNd=E	aSftn?ur62@
	_A5*^$;0~DZS#.*Z`Ap4yr=m"QY:Xj\(X 9O--e>/DY[=d X5k:^_$IwnT]fNpv38m"R,a2k;mmEoolYCiH6QZ9zV
7e[yO'9$.'Mm}%`VFa#B\&x4\ltt \=PUu=9
Y)8gY|mXTA?ih/=?-hy|0q&` (./z,CS7@}
b{9_+4]: xp+,*d^l!2*'+M.O6sjFB~;Qf*w&	M_B({z6YO:p c u-Wq-k{YUN//|&OEi!08 "'~Qf~U>=Lm*66p`=y}=%Fvl{'Xk]O!YKA	P'+<_#>o<As2_!>XW~f^|XA<v=n*r%ev,3T( !vGXKk;[g0tb
"XglY!PZ0wisH8+xXIY&2R;lwAh
Txj4iTyq.X-
Xf2/W%/[q{^6!4&?TBU[UzOj9-&rE75mYWZ2U+ <	FJ)4[r}n3}Jyx/QM,+#*s$9aowo2K>.l!|s~IBW7&DIq	F{";8l-;e~Ur?Gi&`}?|MiXu@*:*QGSu^XL\!]T_;4dEpK/Viy_r@YPki/R|ioP]sXa^q5q?{|[vI?PrT"zh%j-!WMKfIQm%.EQH*vQU#;iV3V*DU`/D	  sY&nu+](0;4.4p~-;\gcRFE)qW[{eT5K_'govl%x=NELKK~i0FauNM^Wr#Y{-ObO7hCVpm^0)xi1ljm7fl)_L}f>{)RV49{i$g}RB9sJ11YvR`+^\@Gh@OE/w!`%0T}Wt.dE1`a[)?vVa{^d$6n-S.L!!7cTSyjYv4	c[l}Dv,%\bm]'j[ 9g?OZkjpywr`_/n<{jP;6bm g3I:;iImaWHW#(6t+2C$kiP Gd/K)e+G6EnjjlyQ	f-QjTXJj:l_PpD
AV3Ra#+)
/N80~7O
U\/nA&:LOR]?rY-/~~7?D_M:M|.\4@6nSe= .T4+mL'KTeytKcN2t:@\OE^+%c90lEjuo:rq0^jK4^}<O{o0r@SBFbd(mA&>cv<? S8sK&r.F'Q!`FL\.p3b	]yu>v9a-s(|@
$<8J5gGi:\0_-k/\ln&!J>?z;>rR<4%=BFVff2dnBB:d ];zZt0rSVt}!Xf~(ZgiA
 ~XTvO+dE[tR(/)q[h!GKR0$m^/K4)Sp qt g`T<M8vo=QXX+H8#nvG'6UYOFs
1,f+T d@?be;vc,M4Xi	UwC`[Xo0Tt:I;QDM.G9IA8dW?-p:"2h"B6'%TP ?su5_Yur8c=5d?q5[Lp06i`+LN1G;8K\2Kad	;mT$ rm#>?FCk<?dcp~_-( 8[#mk!o'3q.u?..g|?VcVaik4TKB7fl(a+z{]VxH~,<:ETf([`@m '{3ah	<P6zJ#3vU{d{vGKV,SEj]W	#eJ?	+gAEHQ= In]g`*'I+U/"]w,<0+W^!zv+N~C2mYH;yTh`5O$K z&6\ul9rTz NZN|mj6qir06[}6bXy[d;f"l}Kl.!Kb)`I;5f#{a:'uD[&b|;>CoA2DsqM8?94Nj!,wt9b~I:DzYtmb?Z^|:|N;dTwl~@h	/Q=r
B)/riHz9:Zy o['hdh|4N~*}>OJb/=K/[@mTi/^	e{B?9S2u97;T+|9zX'[(n%kT#8f6x
%dNQ7P/Yn{fS.wdx~:<RC*sk\].!]AsRy;j kmWTB}	9)]|f!g]#}8Wp7swweLX\M_K )B8JFs_(i~RkDG3L,XGLB|jpRNeF~`dYR3	\F[rVwmE;OKWK0.4((rZ]%;//?<-8!6ML]7sTN3&Pa_;`+Z?3{xFYJ(|$NIr781%_tOt<|StJ;i&rN~]cV9E$]f;~<PpC1@Knl:6(CFO by0kmDfRfBsQ|qT5O
ad35^F*kg=0j~mP\MZ}Kxa/J *hDiP~,	>8bpe{P0d72$wajUr5\R|+my:
ox&;p\5	m'hX%roQ+\#a
=xnck3B[:=5R+9g.b@!!d"0L%<{Z?cDB3(
qPJw%%&!|T*:"C0D$\@aZ5Gm\;t'nn+l?Sn<AvM~'zsa?	W	P94d~{LR1V6OZ^=GMu}&C0!X"3flbAZs'|[N;qa`I?F1_'{m"h5xbnK _j{=T{.eyZ/m&W]-f]! _bKY_g3]CX/un,qQzif?=q%/=/j% V=185gW`SqqsmW}l=#LBNM`e/ox/"8.E/aZKQ=Yc|T@D[
t9R:Q7S\HA)LHJ^%+y#0ll'/wz3qgj_	KX.{GR4sYvWF`8iNSO}[C0wx
88B4y*]zd]F&}'3Ff40OdCNOz"LfWya*EjTK0HT}XCvLoTJ[h*&46JhUOh2&&7fuK3	&}'Kt7dMC3l
]N6VEe!*BjPU :4 qmuIS`t%v[vm1Q>o7rf.Y`PNLAVVPK,*/LJ_mIx07VlEodRZ;d$<6qf
YetU!+TMSJWv<ey\4VJtcJ=Dc!OO^Ce7#lun.ZO^@u/I{	&v[L X]vP !6 @MBdw
aw|)CUx[@bX#TZC^>[[@`r`%m4{>~7eBgB|FV-e&?zGY9:q?a&~w#YYo!Qg;:(GC=uEN?Dapdagx8oQt :;h>:a]4j:u{NMkt9]aZ5D,/qjRIMQ|j^'5A3Ro_T*?K:M9`BEiOAkt9]nUCDHC,"j|M.W2*===w1qn95{1x8:Ag{4jE]-#X?:G:K4jZV]4@]MFFi%pDz2dO	?$4j!3 /* UzjBdVcdR4549xad A69MLfA:_~G	~ji 2Abr#7)<K}2}8iUFy#F+~kh(H&iy-Tw}vpr6Rr9~GCu{;UE6`8zB7|,!Z^03QpicSOj?M(Y){0U=>ps$;9Fc.cgdEmE&'&9!`9_Saw5kt5 &W_b~DPmph( 6]W]e3kdaEt2#'5O5-JDdF3T9><Bm{x?1NO,,-siR'l#M=)w!N==h4{($S|[g+/hW?n-\2wD.fW?u:g_
BuaG]1wN68=UqS_31Y^O\|ofn.87?{s 4GuwE*c)NO?\%pe_L1<6tE
@X5c^Pp=g6mm _"9G[PC`yC
rG'"_88cKt9:}4'QxFP5xgHG)
ZQ]Yx0=abXT!@U<FosaK-bclk<}1HL:cOQIV/E<O:l}7GUQVr}pYN$Yo[i]?x)6n.v{7=snp{pEulPg*(y{s-)+I7 kY#q_##.^9c|Yf.~R*@nUAPX^N
Z61 wdeBl)+N}/*k$ab 8AFH2j$WT6M <G7NPX@'\)`"Anc5@5;,r,U69/_E^w#hzGe1?DNV5DeX6D:&
Jl P	=pK3l<B!1l!`jp*rQVY	!+l?7 -lVu:mFd,>t5Y4V`DyL8S EA# {k3XT+@z[ uMPh$r2M7V9#,r>)6kQCv]C/n\W/8$qFCdr^FU0TsT	^!W(8m5ZhJ$VKV,=Kp9EHu~z9[2]D?T	I?7c3jO9
4kxp{X7 Q[(##!3ki	-Rk~D+00v-Hg;$*ImO<;ukn2C e<y_nbIN^]&1h8Q.!G@.ptIn~>71fMx,T<W LYLUtaN6"~1DLG2`,|*xKoE:d	RUW6f+]R["c],Kf Nh-*PAGP^FwsAus	oB/o 2WZCVFT" HS?HS	E~zvO Q@xUK1q	[.5cm@""V4Oc^1UHl@/I/tw4T!Bd{*4Wkf]uR=%TB|yEU4MIhnLD{UaT}w!2Jt`T-	P\aLPU7Jh;93VzD'^Eq"iT9o7Ln8P&J<2i:gmGMV+;uZROroI^Uf[*K!./!W?pChN`o7qqIf:fBL$ jNeV";q[o	N:C"V($2e-^a3VZ8Acg!o_+).*iR3{2YL6GajOv2^Yl_0)sV8P_Mlql5+fH>.r-cx>YLWYD
"5P	+q|9.{To@T{}&XF8'I4IhdOd=NkRxJqa@N7y54r}6+0N4NWvl0g!<2;D6dP(TSm}
l1m!*d*CerKB6->f _vj2-	v4Ge)^Was>m$pP?KZ17YH5u[(Tg5aKVJzZ?}!y_+cYM Hz,hcm03y5vs4rHYg@'^?V(y^?|nv,wK*!_mya8.pA9^?ZZ#qXQ9dLy:e-.DrcH=rU yy]R,jI_)q7q*i}a?b~V@'>NFsnZkBGSak;SvW|cb^];Q+7-xM_mh?B RHiZqA9SisrAtjnOh
B5h2Ko-bHia*{r+@{dYAv-goY{";d^7<k|n=N<k
P s*9lUuD=/z5M-xY\kJ]rk}'kNr2v^ScJ|T|go"~./k8=~]=1 w7tWVK((u')T"S`sh;Vd2|i.{L=D]"G/57zdXd{2V%-!4+P%qGACY_rL<hDkrbkuUx,QOt2tO^T8;KbV[a%8K\ [!$%<_Nf_./oRoS5I#DnC5V{OqG?mzRa: MlGj&T.cwYV$gfEwO6CZJ7cU1l KQ1>]=U1TreX>0P>*(?+&	;V=2d<ku]&r`YPN6]Cm=A UBm7_tlEgp#3G,YRP{i
^H%Vef;V'K/'+M%icCbVj>_!Atbd>T~/|bDeeDvOY{j< n^
.=sjp;vLGzWEI1De~y3iU4*9G<S,O=XYShdU$\xld.,	aNVr{ fRXB]xXjwu
oI zHL-7DsEXyc,xbO93W3%vEm=&SfnD}i~Ro<jm{[c-7?c,K1p$g!3(x`I}Gt]\/;7G+zpiIFCa~}A*xQ>:R}n|57_b-vq.o~^~,N8>"pAbu ;@r]U@Dk{viCsxdQQ\4!:B{q}_BDABTc De%UGzIN})cSDfE-PVVA}M57yBT4pzCg-w'
\X,S)Ohn9S*YZjff3ymr=YK}=6MC	`8np\Oij%X N,aYQ>yX 1/Dm-B#e8,g)n4_/BA3=sl3yk&K(Z.,nu*Oy>;C{kegd[NVAM|\9s#z!/y;FC!i\&$")'+2*6H.\j-NowB ='RG{/[zy7/VjE=Du|Uu}8{c0l//w0Ht{N!25
<PSGV(RT|joa;]@nghEg%,Afv.%]ul2NR<edu_=6#S;zc
X` 7n&*vL'n <$,Il|yx7. `  v:f0FV`\wV^jMR;6[8AnOLI{7	_n:b:ZafYxD$kd#ux%$Y[`w(-KT,ga0m"}V0}-Nu~"|21qX?Wh7hYqB	(`?	:r27\L9SN>n Iw2(rx:G'88kSC&&qW+3oj
&Ct3)f8l?-`dQ\v9~-n_e.t*hqm9=x8k"!qmFs1!r>~/
N6M	{9X'xhx'r>okQD9. N5=lliYDCfyEn0TgS\3=:P[7`w_
sr Sn_RE0NvV%~2c+kDW, (%DYP }S6<T[g']3.&gNP{{n0D
L+Q[eI}i_P,5NXudtuEA5 mJX*^ S&Ths9)h}
3f5)Gr sQo m\^P|qc;;@JBQEe#%"fA%zPw96	z3^9d}O.*L^$*!;0 bY&1
'OMrFBt/DLMSTT`Ugk B5saO{*o,ZCaIEw&1d j7Qz"@vA yIQ"j;B[,,cuh6&.RK+T_n,2	LHhmcNc,xl)h%YZf1Y,w0cJ-~ZXg6avou/Z() 7!c F|98v8z+/+
=	c+7_tN&m'5.(N'QaeftG)4%^yGiFVVz-,;uYo^gm{lF fc; rlh:3Dxt@iaFLB$<;G`(/d)edf	[HG6]_Kr2s!.2,':JLZcP_}|(yT^_ylOzQQ	m#g}>^+Bz$xsusK#5c Wn6}YEk;EU8?2wx&><UVb+2l0Qg(W+A%6ne{Y-&r$!fvb>
SV0*z"AMg{D'|?9f8w8|yHJS5Kc ^3K=6Omty)f=y+N>?_DtUfa"J2#DYt(bev	sNu$>3cO)]AuY3Hq=-msS`,#'6rm$cFna]O_}&=M6Nivlk]{u6Mzz`iYxlQ~zRRvO1Ld=)R}[U&U>g<2;]n-w{<JqsC:V>j^"[_U&f`,Mv	0|f*k@	rQfe/;z+~zhy'j}EI6;?lW #osQ-ec% */oc.UDSK|?da7EWMv+l=[`&N`T^!$jCBwA^oH99d?8U_e%kkWb_UQAh?a+C?}}zU!S="Uai8-i.hCMxo`?Mq~~lpd?VWy.NW+LiU=BY~1YG|D,osSL?,Yn`N?d       v(uA #<KX7#3+k@$$a8 iY#q4o4H39'dEGuuuuuuwuUx=/,O{Tl&*Y".Uvv4KDA(NYE?fC|J,UdYeV'iUJM6F T>&awdCUoZ{`.Vh_^G  d'|<F8e#A}&bt1Rq3?Is6B?IP\;Ish&  &lK	 ugV|t4{CbWH*A7Y=lVMLMZUb!Xr_f4/rE\^Y)z so& rJt>FPz ~chc5
e=WPtFY!Pk* c;]c>$@F[[2	up[,R!t)Marnm],0	?g{Jr&h7aY)nII,l*1|YwXe,Ul`9)]tu ?$F^lUk Ce>\W{di5JU2tU K'YBErY@7D%qP[z^g3V+ a%#'	3|r#'	BbeZ.\,V-4DI$R?XJ`IQd>Ls4SIR-E%N
_(P"Qy:)=+HXu2O'(.zdTn!~PLQY.n`wg,5sGUzs^:FjHHVEn"O7,RGT0fEE'WY%.j6~WUeqciWt6V
?2fe+( Oq*g4(A'AQY@k`5&&(*=*QQ[l,.2;c9V)1t
SO)Yfi4O(p$7 XJFZGna
PTuYe !23bRMB@1D5R5v5;oFW$mPR	b FJ+%KYLndw:XP{Z^-{r*^X%zKp(j@ @]F^9|{|&JDY,<HH!bqAR1x-l]fTL5THUjoNMbrDqoQD-)fJ;dwB	}XZEYu\<xM CG)%o%ce"vr3~OhBhLv"9sZe}L%ipsZm9{*J`*Cc3}*KFq(0gwtgoD47Bllv ~>>j3-s_uO mKhoj\?7HKm`H|X(usuvt3a
<&/z;@n$Zo'i0@olA!AQRH:cTr%1@1nrz_`lh7mUNdco>-CAQ MIyM3gxwzlqun<;P69Pn0-62u]F0xsHiv{cB\Ng :h"m,ylCyIG5u
@G8UeIt/`v )P )+zL\	6T:YQ1*i ?*A9iF:EA^C @N!]G`SRt$T6$j6UilVT:e=T`%=a}`?=2	"Ug;@Nc,JZ|`xS= 3(p9:d#14JIkSw{u?k9QgQ;Esw1@A$E@$l hDj	"%@Pa"7t
1B!Ul YW(<-I:Q)IO5~T4@<,*{|d;D@Yq3
S5.Yu=6K^(@@B!*1@		DoI=A:{}#:_h2yn"@l"?b&2c15WgG!	Ta>/:e&:_vdVOQ,%D
:Yi/H ~y|f	WeI{`7qK6}y#:ZB3OU)$|4?0\.M'NM:%t -{`|Mk:J[@Kb3gHH0X}]1CHaKrPOHuTS%.lg|*eN6_B}q6}1oeOq\%DVphtR3H`!Z3\zj$`?m|-(%GGV ~>e?EZYouJ6^h1(*no[KI0>+9:DK@JN6Y>3^2W+~{1nGUx{fM]gIhCCqD1SuLN J4$D)V03B5aEgZY8
fB9nTaQOyJ4x*"@<tlAt<`3b6""yX{d2Wq+D=F5T .]2<K'7o0<xN|P7N93~<p5l9;SL<8%HG%Fl=5C>gLjW`UUzEu'9rx+u|bt4*bI7CmH~+%(aYYHQ 4wf;2s:?td/56Jx H6$@#BWs.SND I-KT_RbL!c{=(ewGR~~uwmmSJR_ LJ( Ns5bE*?fwGybU?cS=7!0J;R|^	DPs:|<z&Ur:Ngx?tkAZtjY6EkT+FUiDUL,tE.ua1zZif\=vaH0WSDd9vN[Uwo5n0pIw;`V]8?PV^rM6f(JjmRAtgqMcE,C+[3&-7uGvn(:%qIEH*etRFD@SE((`-]PIhKl>F$:/Wi,'e,XKn}|Z3=I{TSC/
aGj	'$cXiOMm*O;c i9gYmeMIpF#;{]')wH&<m>i(Yax,3S^=@WcPIm\}?D=~?|r>JI<I!!wA;4IZ:TL)1,Lt@vUMr/xk	w[sN?3kp?U9@U/v.ao?v>6-fo
_w}*p()2d^dw5	PAo'^Omn'MExV/Te&lF{0kP]_
"\nfX0Veq*je~y,:\aF9,j96,I[[!e*1)AdQk.pJHk,@>C0o"=;IUJqg1'  9YD`}Q6}G(6UzC')Zjr,%
Xt}*M| 2M5p$t~F(>YBhPnN+k>~i/GwQ'5"meq$Z0BauZXh{(<Wy|r,5 x4Fym5E0#,3l]',X}JOTxd$"){hd^TFcW%`Lf|O`[|Ha7)tEIVo,{hRJ
6$?B#!*"O>qczc3'D[[j4dQO-y	R_HX73HRujY"/y6PuJZhRAjG
"  "Q:U?I:7 o%E><E._;MG'\P']U'Qvhl*;G}z%hs~d|'M'G=nz}1GRgyz7f;4Hh`0AAPaXt3JGg2+E]CVx|^Nagq 96*;fig-X
=i~^cF0O|VT2AopGN Jov(S|
*S`w{;(HrYd0+EmZa^|.?|!}x|}x46	:[}2H6qei^_yQ)66OXauIl'z0`,OhZ-b3hObf~kPyYo|8=),oQ~gUmf(Wo
??X;;<6p7my7p_/t^w@c4nW^k,FbRBF6^8x@8C%0'Yys3|=[=1WhZ7bQ(N~:x,K(DQZ[5)CL8Top|Q@vaaFjNwe]QT:/\ANn\WHCrPRbwi/i^

SgDc
PqRVA+]m}zrX@t1FUAA"X3<o@Cm|{O'g2K2$(\Ec38` l$H3U	C
[f144~w!l 4NzM-KPyE$y@.KHS[@1%rcR)Hjs(-nw.;#^Cndz}RJ9p87r=qptpi#hT`O8k1J$+>z(>Y_p,T;-0whh\] @Ze)vciXtC/-' o  ^/hjC3$@|F0__D)Y@
@z_^ e1\ ENgi|FDu6'M'#NE2u2Jg,#>DR 4bVX%A-f#o}tWv&i#3@IQa}	E=SqWE1Wt$~kiF0 /?d|:LgsJ]xhO=}4>pi'q!\.i&d&
~(9?"#]@}O ;*m&BQO<d7e#~|?i;<`1rl(.
w~^Op@Qr	 ;$a+lFGPWF.	1uLX.hS
7-=LJ'MM8J\DcIV"^s*I
p[qsS57uY
Z('BHxq.#VNH|*I-$!frDH%AM	a3MG9HCGg5d't%n\/3t*.Ftq( fX31Kl.Q,U	pEM7N,EWmQc^q2(#),\!DuInM.gEH.Wkt*]{ |UV`{e.8Wb4FkY|h_!k!'x:C"F]tvl7XCgl2>j"b-K]pj;0*]&F~KgEz?KEwS2h~4W,8K,&[,%+skh(VgClS<c<n!@[hNl#U{2k@`F!dnCFAcS6=91Ye8L(D[	'R%<ug+UfrnCYaa.+Rn9nX5)W!y#K.;.Z:!Op,xq_Yy__FrzW'+h%{:myn]KocYT(EW&&.b^v=v*]F}Oe c[#Et#Yx4XL8-%m6
S
F&l"1u<tZXaC 4!= wr.-xoezSJSJ-vg+ ysUrOnJ\ph!-4}}+&}E7sM
kHJXXy3f\UfxQgm/kxq1V_-~]FYSFohocPGjng/Jrz%f6;vjF4ck},i_n:GsC1t|@tZT:T9-8%N@|WI\nZhiZzDsm.7xdb*P^#?/-.I4HP\JtHz:J@e2H,"zDT>AHz|8V1Fy
`c)8FgKCwl=u)g`fD<:44
dB`-/Mc{@un{$nrRaKznGOo^Z<(u;'Mf*'R[0xA!0A$""+q?B|@S{b+SDP6&x[x$z{>#(n7s)h{`COB&?Yl73=18;kNlNId'jI>@>T"!.REhp8av(@ZA^akKV u
 "&qe')S?6 }]h(!&eJ{K=!N]K]gc,MaP0$0x?G',(:"UR	A7rPwElc14,d.`,<}-uco6P[U]i+)|k_t%fX].mGW}mVtwTK.]K4K468;8z68[$?;?:~7x{Qw^|>4sn<Y?\k-0tNOclC+-*Mdim)`4
_K:n	Vt>|djKk16^shgcwY'aDzxk3awzO<O*~ZV[r>(x(|2G)_#7RA"Gn{Zk<b'fjh]0CR44f3-]zrp2QTF6-vTm# o;D?VE}g9[!p`^Pzhk}I'f.Co/$T9Y5g*UEe6J63Q:<$6{;Gm[mpI&UT#pL:6-eJLBbf&_0"hDx<\Y	iQ>-}!Epq=1asEB)ris489\.Xi`p	;T:M*fq _.8iPO=g;,#E>AA'0{Dr&t( -a$S$s6\3.oB1
NWsfFO.l0lR,hAkXJJ;.KsF#\03Tlb1rAt.?$%b<.A%gM$(B0402tP@]?it_]E^| 8Qwv?k7zSc4t)[!l~4|)F
LV
No>1jGMT?7f"OpcemGLqO<t6kVxElj)y/Kk)gudQln_/YC
b\;iz&tu3kzM9XJi$KRZieg3Y[Xj=b9wVNpl)[=rU{
3<hpr"tM<h#7pbt}7Y3%U.c<IQhC=`{D;A,i1ny%;=wRm%[X{?7,_yC5sk^- b`xqf}9%]&EhMZ}Z72S>6%:CB(\V}d5EGN3hZ{u\8~=.)9-3rlM	e%`rly=_\zAKm U_fi'zu:j];B%}n
Ij"+j_p@4i".tuP\@IJ#q.n`de"\O5zqjqmEE-l#hafkmtVnH_''v>`<8IkErT|gWKGvVrZ!/V(bdllD(	@e59Nva^feK}r/ZFv]#yIBA63{ma
`Yr<	IUdn,6k0dI+Ax c(,7$XpIdu^"D4te?aL>&@|[=hG@fGJ !E#~IXi5G(dZ8
E pmN*Y<f{evNXqM4bGpR>UPV_F6W)tkh-)~i>C(wO}2ewSdh.O6kgL:j#xhoX=2F,/>j5z_Sck.ebV2q0c:p]>1<7sc&`#nInEJ>1wA$+}uvzh+7Ezw&]X8SQipsa\Z	D5Qk #^	ksNUP#m\(r`	4C4Hbe.D#^'z{WBH"3~MC&n#i5v\zvLwJ/j.c\mkCZPUwxKK,e#R5xm$(^KO'v_[Ofc^! ",%):9!O'i&oICW.v9/{M"Q09pkY[vtn*F@)$$8i:kWM'Y1o$`K1Y-0h,o*rXI}igGx)aZGuXz3fc!x|~km:S $t5}5nwO#>a!(|bZ2h_)"ewL*Xiqi~gE|`Y-Y>gGY=t(#3E_+`0^WdZ :4cSh@bMtdzNG5a[2@Q[X}'nQ7|ZShbr>|q]PKp&h_i7	v3IX+4gvEF58t8hAF5g"|qk0TX[*\Nu{![ ~Xh8	tXia$_E+xk3a=n  I7tCD/(G=**xfXS/grk9H809<Q.D
H,wjAAfN_IX<>j
 Kz8aj)g	E
GoaUiRZD	tK4'QFX^ ?uUMyI2qyc+j!{0 ~k Q==h@OF1Px0??d@Bmn)T$ZvH & ntSDl&i-{*0^vN}d'ncD''H'Ovi<mHk8=pXv@k$`^e_cf;i]K[#DcsYKm>RYUOMflu@'|iKU ;H|W@=$Z6AS)yK*P7,fxU2!b{qOr6Sp	 ]Kt(Ur=%K=YirMKeB0RA6t*e	^IFmaB{{7~/h
8VW*<V{>P(Te1cgN6{}do\tg*uK6uAG~(q/nGB
MYhX,*fj;yVv\*_0;]ocu[Z(Y]<bbhE9/B !jL |7aq	HDOcHtzrLLynCEDg.WKNl|qjI"+-/R??<FFHzU~NT'H:^V;bLILnC? DK4I/0V'jE<)qkSPX}cnK1E4?7hH{4jy\nk59_s]z+b=>a4P{#A*\hyWZdiQ|^`wZt4!;kf-'{p|UPO:21qy}]uu=Zw)0&@\VFo?QZj,J@E 5dqIvr>^\R(axqXG2'1 -?SfwLSdh'W_{f@xtjA3Wo^~;>8|`g*`BS {h.<]wY=#$3@<01deYb["viBtlHdhoi-&o&@Bb~;9tvK|?Z)0Vi:.Kwg>5bA:`E5o4*EGK6neF_J8CStQO\vNW9fs`5d`R!5PoG'GfOKk#D		79HnSzbQBYd]in9+>,Or~[V1w 73	UZoYq*}w4(5KN,<a7%
Ua
{hjnO(vSKBnz1g\%|mCGr9jRB!76v_FLj#&	vrNFIge`FYygNl^-F|0kO&]Op4Rq1~
C:9gmqM(`"9q@#'\V|STiCsuA;!KKs,hSk}xOP=HDT;m9tblx!lU\{>u`!hM	vlVBu_KTq-#:4u+tP80VkAy`bX{H\
Z] KeeN#~h[>ryJM4(J'm'kB])s /#	zlR/[[{._fhkK#OC\j0N:YvEvLFx(sptVV~`tn*%B~ $=1^}WcVWJ:y+J2\SNXKFpDJVu|#!	whG%UE`W%) }$'rj -Lde:"CQaX7/jQ$;tKfF0@,x!t9ik#gHR*ziVV7k^i0+{kQ_a!&EPFq#"~sk(65*cP=Ti.eLCH J_pygc(%^1tEvU'1u66!"W4s(L?tI{ Yoa?D"q\)	i(eG~()N

*`SLJ)d[a_[cDJfY2qJ]jL&tZsbC~0]\!7@pLA13gKg3aB8S\tP "1]	/WWhh3F3%29 edlhiyRV`^$k;YK/
9uvsUY
Oih@.V;Ej 	T`!uSX!GNzhyaCabR2'	;$aLiF4^'s.k?kvp\J|Vp[jAj<Z`ap	F(g
dE~3Za&A9@f'IHPlmhb(7D;.4ddN_#y]	t*1[+#.X;J{7mnTa(W?X_OLk&SyKYcdyLdrQ1AqHP/x!3-6#F~|,^-dlLtE^9#AtS6$"Eh&9_Zti-uO-^xfDqu(7O1dqm ;L%!lzIB?V)eC[hbC>>;?<<odo{i/vf[D_;J;{w
M=>xPB	`^WHvaT^uyo:(+llIX%|zl1UFtpOIV8UYc$9<R?eIw;@e("7CRdeW8ijW0S<ggg~ (].`8?]U1r[hph0E@A^B<>
k)-/HS1H.
]=@,;`X>RO/KH%@wxJzp()pd|6B6vFNf;yox]6=VlZS.>NskCY&jac<(/w_Kd4 Zb"K:hU%U zP@13yGw}B-~^&fYJYt*h"5/Ceos-#w5=aBWz_EIX 4sSefthHoE"M<I#o$+-".)q&	w"/`BV;IzGu9=NB$cna:\.FNxR4$ s)3|wR ,t0S4 ]B{UE+I%Jy:~U7:@;-9=m0:	xzkco Q*K$UYiBP3o5:P(p*%1Dq3y9#$J{tXlJj<peW >9j?`?mCUer2A >;:8|sG5lC1h$Lw?	4&5c)YMErWE^lR=n];zoHop_)Q+Q^H.EZ)O	0 a*/br_lQ(DeU2[aYU)+L=W,-~On#-+FR*ZIucO~zS5D:a)H`G?=QrS85dX" Qp^(i):o*DWs;<zG-KfUd bhDEenoTmL-@tz5(%!>K}^T1 WOx~@Dx+pN	LikAj&M`RmXRZ (20hQOAeM$|y5o(	#46xcqD-jxAnkI^J OorXkbRU<z'bXPi2PG#uv24RuaP@p4+~-Q%=Q"O=bIploIV#=-ZkEOQ~DpqMgx.QscNN*?[" `o5/Z{"vKae:gP{_;g'Y5kpxa:ETWs8qNu!	W|zMvVqDlh2`!.QkU{n>==B0L+1$?_YPYYrUYd}6$Z{&eS>L:J)]L`Hmy_2"(Ct4:3P(lC`
Pj] <jG;')]i$mmPMG{Z7g"/G?1^?JhT3GWD8S<2. G:4?Q'|
OtLC
$Jq OLG#1>EwN_NrYEgwQW>x~yfv)6mi9Gb1/ui_u4$*m
~g5C<{_dj]P:g5P(h(g-	UtG8jq:^lLbT!=(oUM?vgOW/.!trQORM}s>JBV94	: =l+fwlp/-9@2*prV?XL$YgDL^iRNy(N9H('\{&9ikR~1dpb
%9|xB;n:Lc @zOUC.;/5<rx:ak!XBk})[_Ldt6,AY%xbFFG<PtLTVBq8P6B@z!Gl3Lc5 HuJM[D}16ExUQ+{xiFT2X^X^jc|0FG'DY3]ZUxk&A^3c1Gzj%*W{Omsb
6<-fo#$L^:>=:Ws7rz~vz'?V`Y`R| F}tMr|5eC.b7t6j L#SA6]nnubFm Q{cd44@1dX}5Hz U^5(c$(O8.lRDi=u)^{$`3eFI1+<gEAQ-KCOoGt:X&hFtCSn-z0Bho> 3'BBfc~iV]<#AlDC Rx+?`B.	% rm~F/FfcxTp irv1FsoY8zBD"`~(}o2@M;(lz+;%D`euc!x(am+}q\9y)z!b4yz8'],hqu(Ij$VRDi`TnSIb ZW5$ytc-<af-y<2gv(j~,7`pT/<c5`wT>hIFW%M8q<.lm)2z:ZPv$rxwy6du3x!3\M5pt0XT4UH8*7HT&eY9m
#>FlmagdeY)s&7#p0+\@8#bn%?kTN[$X>gGphj8;W_0JW	CsI:E-& X#_ia$bV~O/lLAywjQ!DV+.
J:&?rYiB&}"IfI1m(iown;69{[21GNQ*Ruhu6c~FX	Wlv%m57I&jPKZW}y?C}0LlZw_B"r48PqbVyn(w@Afhu'4Z@nk]#~o;9NhF<$!H [!w8#oxi2	JHB4O"?2E~dhi7)q=>5 "S'_~=UW6+7b6y//K4Aph<OFUcz:fVn=~R;(z,VK,1
%Zia(,ZwhKRWtMdBoFce4Y]|8O?Ado	@fx#. h2w=M1W8MXg~?s%6HNYvt%_e%qE%|~GnYHy[zh lD!}*89{vI.nR'27qHXH/|4Qp1%LGV\"I5U!uP{aV=y s$wI:9f*CzR*d[_JdCN/w*B,Fe*@g(3$koE_((r2Q7AFlF.@29<wg&Z"${Hy;
<
(k(lZ"`D>4|LJUYzJ1&X`wy4!{;R=I*h_KmN
gYm)kKIJh%nw8O,aUN{{hM#c%@IyBk/!Zj"(NAtE!zA='c_=o^R}#~QRHL4 <CIp<}34kqQ})4@`x)&9zw<p3r-Z2o=_xXt}#6'O kz@;o+ne0}60#z`Q29Ipp/-TlVYx0h/wCx;uk.FsvgioubK:.RC<}t&3rxt%XtQsQ'^4`MM++edTz<q}<'/ap~_'yn3hSDn-MlqkV43t3wgE$awTlv_^be z};wF !p\'kOJK{)6%c1jL^OZq#:'Fb,fmx"B&*{Bzua	cXUUF6Iv33z"vqUV!(#/Udg7uiLm=X0Hti	r*HkrhsWqQCH1`8l0g_PXQ{3>XEsU{A[5XfP0A<s9Bs_o[we1m!	/piHl8a}#}a9sDenKywWL=sGB7Eog07xwk\}_sR"vRI|.>/.][.~s9Q~9WKX8LT"z'bs j1wWNnEVSr7O8B
&-F5iVr~
la>_Gg>tEy'\nr;AM `
(S06``0zV#fiba>gC.",z	1H||F}7h{)iR/c)WS
~gQ6*VKVC%Dq)8J!B<UVkX	wi-o<G7y)wv+-7.(Ggh|+(L2	#]!5%mx3)!Mcy>slVg3 _^U/	nm> S3E
$)ZOY9	fzviEIGOz^|`pjH;(zSAU+iBt&+!|iKwdmfERyb>ma !CRyXRu:&3>+7oe~7;n`<4<sd]zt"NHkN!XOsS& 7t0$"hobs5fWz+E k)7_T.Bj$* \Z"]r~5D;f|UuuaXK 7YVKe$kL1MZI^LdpI+@(~_RXM4#YyfWi1yX\62U"L,(m^@m2)'zoBk5Q'~b<E^jI8BG4L_\1Vq#
EB?r'ilWNtk@CW^Xgq@6mFaLktcZum-m*
Ctx,|1D>XH <[x53gI}Ce. *s}*vV+*^%&#qiVZkegD"i7eL8V7YCrH<X2{S&	ZOA5_97?0_SX6"]3Pd]g}8,OJV9>AxHo`wHc_`G4Ev\MWD2dl.RTt7Sw
nGkiz)JOcr}q%g@"h^PD\111jRBgLh?|]o:gMtSV2J*Q*kb/AV:K! jqH@_p-mZ4+eiU_fyHzepzBWc`!d/bAxZz2!k/2pa!G 	,h3UN l>5E{QnQWpv+| 8{LW	*+|2_JB&V*S]S{*8Di9:o
\%H#Cn%R j^_ =f K
)s[2Y)LG`Wllt VEhuf\*^\kH1x&Na):IPIx@Tbu9wCz>*Btrtbcr\Ol\W\zYtP|tPA@HbjKu|]5~Dh9Vi4I:gISr#gl^4w	cPrYdD3.JG=AI#R/8qke1#X!?mSRv/{/Cg((^ 7AB*'OE[[MnU7/*rwKDT2l`.t:z;+>aY%Q1a$hhi=x]bx4dIy_9fYe{*vxs'A%!`AOt\TGEEyr\83 2 G	k`POB$cR=,GvKqEZZ"f
$ [vm/Gbt>upyJ:*dPS =L4U<'tE{n0xTb:eOY[QJJ|c:s
,fwuCJ7 OTH*_
p	Q>10F Ab]
kdAn[ZqATvG&Ta{$gv]H=p19H8} -c()'6\7F	f\ NtkP*D%t\F;'_ggiWp_cqi)#1~}%nlRHa9'
frA8{HDuv`f_%cIqTT:fh~u$1
!9t-Ln7S1#:`_XWe {"uMb061IAQ[/v!=`|YS-J-|lWGu1~WEOv	)P|x4Y/|7|x!6D1/L3`i6PVxx`>\~?y6rJl087E#0L1Oz/"/?tga5V^m+Z,"0Nwdzq^rZt1`6_&Q HaL"]GfMi6iIIx6aL~O$}-$d}YXmTiSnIr>xT	4'BXc#$#:=*?l>a-*y(83t"|lp]do@{f>@Zp__"]UK}!|NszxA"$<1=&Q&J9p"^0dz"m"LVs},	>1  b)y)ziG:D K)<~EB&FkmoP,ahWA<z4TQu3\i<`VSI	rb=7yq~K=[N0.t8C|kXtYpGxgiWDe#z\\dw&fxoJ11;CZk.KY	I&J`G|kl]<u6Lx
}zi'
Rocjt"l3NtgQIo|xR$G!#La-+gP&Ya:.xPM(avX)Y6m',g9J{LxZC(|9W+qOWF f![uuDFDu6q`t"/x|tN2W%iHFX,vY`(	gW^Z,DSYjN~zM'40.i)Y&Uc ^<Y@K[jfSu5`DKVAj6; G`g7([EXLu'BQF|I$!SFvK]C)R qynDQ3_sPF)/.v(_>|
bomAi0q@O$c-YC-^)*_cNJ*\DGt? 3`"z@!'#Kd%iGd|H0Yg3v31t
b:<S
v+:}.B4n%:}P+tl$`(:-p{
M)^uUF	G/@"u%Uf*xp4>I&_4X8mrS6:OX'Ml:|J`0VO'^zxFnn6#Gj\xg&ed>J"#]|>32ucCs!kC6YkL6K7dj&]lLmh~!J_5JP]l2>z6K.+ly<V&c
 [-v^alEY=>63y)Fa&HiyzS'P.^g'{&PrE!EQs><EFV_VIgC({3U7NIDs?/,,%cPK""rRt] @6q-#q/:aB:0G,Lr G6}RdaE\`E"u[.&"oao6+6%%-%}F#q{]Wl<Hv6_X\`0`8%?IXs:>X_@i1mvo3)UO
ZgY(SIrxzFZ'`oxwE8<`2;EqF.NZ :|	I(zka"q-&n0z5\!RFwxZ|D~}F
6=Gd:~$)XJZMN;}Nv~4(w p51.
Je~!c>~xgl}79(~P'0EvYm9gMm
shjq%n`B|\$QD=-t9L86rx&96+QM:Ex\L5#BO3"`g:f	[n:!tM++`BU+abM|CQ.Z!{ ?z&np]t}B'lCe(L.i+74"
_Z&hC>?(5EEITt0bN~IM?t;/aoc3yI]CTSTg;Jmtr#[w$H0(1:kO\/UrxB*66%Xj*}s'hp\G`A+_/;#jyXZnR_K3bJUw
vVPHc<B~FIPmk1bNUmT.{89Zul #j8IQS%Sg nY`m#flEnIbg4F'kz,&lYKu44
9;T[kmE+SXTMFpXzC5wY:])`kY/X	8n!m+y<FBE
MCCJF*tuT05-
P9Kz[g\ A4onx=a)2`C!Cf\n^D&D[L35SjmCkn=Lw78p?/Lcjpx?pp7P"Ilz6$jja]j@[B}0dc+Oa6(q(lF)sgXfJ8`jtjb1tDXHl`c$l$U@ |]`LmL%sDE6[qS]Gui
qJ	Z+NQ?+7A[DbX!CNWU99+lVuaUS'5l5g2$NeW<Wo}ZBIaf.nmJ8tq%^{5#S'9vp|b_gT#HS^='ynL)VrStVL{-a}QN6;%>Lw 1P*U7Vx0g\&C"[y})[:*A	[+0vycKiNHpB?j@XND<'JN{\D +o4<fGR/'I| :nW$zm:"GAe0sr{n^,^=[zEbvpQ$*CK:5=z)n	Cw[P2csu`R0d`zF(-x(U7\[]Fv./9GIG!~,9HAd'N&:B>|s_3)# 8+:Qeb?{nm$e51(S<\|/yc?8^KcXGF2F1":m%:qrgF&"!d}gR:-G=c+z{K+Me4.7kl#{#'s?ET")D`aV?f%rP:jQ$;tZ\OPt	iZf@@/QVlZB6	finOX;K!x9PHR2zOeI-@?h-:{skA5+I=T:^?	1{jX!Im$@.BTWg E*kb3}P>Szx<ZDQN)Tsoa~b7bY

7Hf2+f2{
n-U;rFP)W&n~s5
Dn72+UDz :zrpe	~%oUZ_!k%uL Yyhr>H)YTZ:].
E%$&g;'k**^D!C3*P|L5-{76.9;0x
%&u9\<CJhDYDvC,u83	,6)@c ff]fJetZ*B	YORSMZB% PQqXT&i"n!HxqXV9^,]f^9e`vB72w" Q$l$H#\_ 5MGZ:Gn'1%gc !7i#Xo=xN4;sq7C%%wa3p1)./H[l@]Ew7=3%gC B\Am%TiTut/K + X?oYQFBI43rCI!d%!NL, syO5jyt?gWij+iqAPdnwO7KZ%Nw%`/p>p/#d$I=l3knyv;JFy[^Wk4B5_=T/P7MPcbM3<*{}={s%Ie05k^ZzY?Oe<1^q|Yi] -;$dNXNX3uj}i\\i(GJJvp]?@_f%G-&G[;N<KCv _wW	B4FvoJCpE;IYPAQhEO#F}K.jUY+%)9d1KTW%MTkyV^ zA>7kcN T!u	PuPyh 2o|fxeCKp$
z-z _F.q*MCYZ@Fo
q"6$ZjNY7^\W[o]l2rY)L<k`	/3w9;y:0]UE} 8M@juK:Eaei/c MYXP\^jL( 3'*<_75IxUYYxnKw|I)6C4,Ee4igT|"Of~40Y -ue|ASSk/7sp|.>$.KEOsE=bW\)]SQpi~sb;tbw9ar!<g2|r(+?.r=9;]H/@)]GZBPC #ror?&	1
k{ZZ(0bd0bd	bD1/W0W".RXR,jdS?BoZDCgMQFeZPx]>[?Tu] L7R/WJvvZ.8xUS;WV1*sO8 _Ribj"suy;bTs{7C[*P+'Cto'[(O+tS}}ya-aZF"vz8wRtD67Zq(g%%xRm]<LYoEf|2}nm7"B@D
`'@"8TV"#0.a*l6vb"L].8rHVZy"ZD9Ff?|/V8f-Mvc(R.d(1)Ip-bsVDHt+lorBx H9zcr+P~@@FUT%AqzJ"@t]j?Uur#~R C3E=&00D5EC$>='?sdw30?2?)l-EXY
n5[Xi]IN0((RTx2}'&8$-d%\MX,;YNw	t,?>3IR;H!%K`2s*ArZ9n):1`2.Nars_f9noy]/[3;tl^bt7,*tbDxQe/J<&ovV@VGG^.FcWhE*wu
Uye6Th}a-?Ypg m2 alN7bMBA$*Tg=^zxd%/I%FX6V@(3s6MV	R-%=D&nzA%3=b?13p4e>]d0c:V'7R`&>!?{dgK=ue[V*3xJP)@4}W.|3t	/|m+Psfc\POn}-E<AF^-P
zs.zveT&Sxfx[79Vbi@*RX_

vfkfD:^L7As;^olm}1"#MMPW$Dllo	AE!pex,:f*0]8=Vrr$60L%H<OovI_HBt@j0u85;pV

W:!'|4Y*;!w'!_lW\1Z8O^"w#t;QheP5c}jv~X^A}NRuL,]<J6dY2rnkr3>4S]sG[. (GduNM6}5iSuG?-=TJ8pyn7kS7 *2gz~8@MQ`nFVDJ&:<J1)mK:t*!nAu4B{`g![s}[%fh~lgsk)I:Rd%@>xfnDL6id> Ff
g*90!9aFU;3R	4.G!MRS+R+#5^Q/-+ca>\WpumEgQ)]Q7&MM,>CSSM5pN6>I.C'}cz1q6)?tFtiE!{iQ}G)|[;|9W=r](IuXfeR4pU9>h%R/PENnKffCk^l:5$yX%*XBuF}7BHs;]e$bp=cb$b9)ssS H$v]j=Jf{7d|HpCfJB)^pXM#%KH"	=
<Hj+2,yw$#;xxj?uVgjY$0=(( +_~t
7_U;y_y2b>OG&N2U$t1OWR+V0F|;wTgmw&W>A_4nREO`z<.VfDML9tEYck$x
6fOo (]L
+s\A#V5q8fd< ^j~#^	GJ@|NWs`PuGq
 |s-+PEBp,2A}GL;|_Vbf<T{qqpZ\~)d;a( 4c)pa{U/)^Wny2
l1|y/cP)VOfq1)+rzRD1"Kcd!q0pvO48<G'G'7V)3^c11Z)?#+H:<<wg\	v|n(8'	d*h']SyH6t}1 &q SFLd`i&w"zuUL37D//8176i:t@ h;2c0<[7UgO/[c`2m4b9{
/v#gw?UN8~,3 <h1`f!+Qgvuyi2/<+FdQ9}BZh,%K8QLA |vq8>h#
ZdlXn9SV/O>FR4ryM^$E	,(ir dX}g7]V;4g	P\xB[>O?3DTUCf~|!PHo)PTngOJ/JK<3?]qb1Y0Jb]c^lm/iD~c W=Iaf?s/w%HA|5{x/a'|2b0h9QTM44Q)::[d,F]3iT/i sv.i(Tvb}FO}#8)03u9V GtM-FwggU}7+Gm72';>Dv6T)Ta}[Xv"s4p+D`n{du/Bf'uSq*ReC4]r|'}e\[vj4zPV3`5MwY][81pTJ)k"~roRZb-<,L5Xq:s/8~y}hw&cI
QSu|b+`+OBM(fDln#:7Q_O4FN3\uWsZ:`d4hz"t.,]b/jQ7D]g,5G^"TV"	D
0]Hlu}l<{3&`:g(d#!.UoM[%OP41\^Fo68-o7,tTuNl\Z6y5g| n1<\J7%.4dTLJk)g2^<ZOn4ZO<2+F%KeQKpGl.sg7.b~,^]\f6x0?
|aK^^k2 UnXR)F $rGi
Wo0[^0A?SI0*7]y B`;
/tw37?J}iE }S@Lh _QMz /Q9\-j\&zGcof::YxZ@YQ" wV{WL~AP1:gfWwT|(*WP~X.q%@[Ab<}+/UyLKX(bDcS2z@
JR/^TsjoWTV%N[M8~<8p^Y0A8h^;0RR=m}7\54/UBHxU;\'$*;6Ps@&{Man/F:~qBVtCuG'tEW){|;5=Q];S&=iF\UPIV7< "0xjtzf
s^Cf<OU<8Kx]f0./,ARx S#}k[~yH%_=Xs)Yd;i.MT|+01}Su_x,RW@I75C[*20[@Y +!:$01w
DNq&+h/.CWb( 0'$7pJRRV%Z9Ki\KVYaWG[Qn@){ w.!i`y1Nng
EZ79GEjjZx8q*=9{*;:Q(*tK-Z} TQ=c5AWr]<huB+t. CuX Hq|$^'^{/#,DL%~z;-"ijaxxp4wwcp@qJT9mewth|02\wKpy=|zJQ0O.Z$Y5A7wVpXlB1	G!~/ur;DbshM(b vp^j)B4`[<`IN#J
L@d/E	;9[
X@. >7x!44>yN[wZ7DIZXcB-A%Ep3'XUMuu>g0!E>!;J
}
pb)GT,Oj^eotBb*=jXujNx5}EmXg*5N7;=wBM.%Bs!=K^+KI^W^\)V:QNMl`,@7N[0+Av7:*&,Qgd|kPPDrgZX.Y8 $~xUf]z,w2^K
8V]m W	*ySTJ<oX291	\`iooFbC,$Q:J	47tbrl[."`a:S7ZrF/ 
AO'E1$Vm*,=x+fN=vD>4v'&yqdo0vF*HE&*XsC>Vd %/B9,tva>&Yad=Kt#g_z"z2@bMh~,QDZQT"xATV&5 Ax6 39lr:P-z{vkSzhtdD7@.qZ3hj]eM={/f%Eforl
'SWts2 \XBM17NKWB%AV
-v d.6i~|7|O;DVFc`vsa0gg^Cu.3_h^ZE`oPnRi2>zXEE/UG(K$)pA93pn
O`@6&*$$ZJ=e
$*p-`}_NSJs"RVmQG`F@i2\I*.>NJM|Fc-iO66SK6QKS<'9KRan)}8+_xCL;XJi:l!ryDEn6t d] %odhb=4LzCwmf<+2/oo99=|-me7uvU=7Y 7>+N-pS	".h^oA!WX J=MP5^75:"Xzc:yA1XKHHDAw4vAo7_=C0mu5YXw& G[`Q`(2q[n_kBuR~(902[j4;p(dxy^kP+LE-],%Ps(|$E)gLNt*%/oV-1lW=v	*/B7,u,PjlZ$Xmic-XBr-I=#-2aak ?	qp$aFOW`.3%o?fm}]*wH~b o>iG4}_\or !9{S?Php<?q8K(.(8.uc7?m'h)U!y T^$?z[smy,U{WiN7^k:mutz;w&AzC>.B|{]^vT-n^#AcfK:\<{~]Q	T  $	MXY4[u
.z"Pwgy$r5/S6Ny8yrrtXywEOrEddr7;R~q=^ u<L0ZKl,2hH%ui.8;&j_h,M;z{e(M]ERg~^kQ X	pkBnA,	,&`AB0L)_V*(+"e9 /0LpNhbK[I>$$6[N$PnktK3_'6c!SGUM+v")"[1P:4>e)^VEQegz=y)$s3]s'sfvNzN$J{GGnMznw_'vcPvD$ 8@dUQ[1M< n0Blz\]>C$$B"}nZ.o?C)HO(/3ZXCRm@,SV-%:!9"=CN6la|*i0\D w-XK0=XXxkL+DFm?ie[%=8=
=o}*i]gkb,k?p|4?gpAKRy1^`0X'!M67oVyhu&s'd,uV
hV"_:R442$(1%/'\AarZ[M!4N=+R\rvLM{iBj
Hak	1AGp"MFyvzi rsm*kkI00kyC>5:PUh>h-W]}mqt({ajWNK`i3L(
r*zyPRYZOsgi{UU}}Ib*f9]Yp]4PI@,Qm}1w*#"v'	Q%k5Ie(lb9KDl9YMJ 0Z_`9e]i_02ID*<(c)`JrWDp!wTW*C.Eh7iPl1 A4sozY_t6QsQ7cq,zl~]K[_5L~
ESwteA|[TZmN(AR9tww'Hz	;pxu^I{J:Aj9He4e1YTdtK;dS*tR@c5yq)B02&6b!u286,m2LJy)J=k`51]$*xu%3.J/r9^`U-Y3 7X!v"m \^L4I?(G^uMv,.B2D}lv0KN[!N|@^Jm7Pg5	!7PbkHz,p`<PuFf%[,./]
gj\x7vI1:h`!x~PG~~7s5v e`)U_8]xfioiq)6b`a5?/Ru\ 5!BxfIi<QBfh_/+Dr3LCB>"[jjlFF=D Fg&xs5sK2+1rLR;_L3_-`ht!wDYRKstBU1- -f"+6]qIMAPsM`n0A{^hb'cd\hbO{MK	t;k8+x%@1yFh-ijI?XDr}Qy?ncLLR{^24wy@ n'\FJKWJWA =
s?o8"8i-_0N,#,eY3H:],h#9yY#xTkFlR]! 1I EbF^3\[<.gGJ;{O='HzFo1V07H.F`<=YNA9ia" g?iI|p,ip7l~&" wXg1G  gXv=m5{jMXa>-< YtJ<5Bhe%>QOEHJW["dhk_Po\x+DE%nJI$2fCPZWaWx	nL/	%2dXqxg|q- ,z?gD!Pvzg*}XH:>&;DEYTt / [E@-++Yg ,F,Q(a53'T	(tVuUS,Y6[
1E6'${\H5<RthcU^$*SWcc?~{9pZIaxJwn'{3y'dGpouKIa|#(zX3}[L/#pYN_yc8a/pn@DL?3P;bL>-"/1
4)1$wx2+/Q7$[SB&+liqfMoP}v}9
YT^wavCgZf\=Rb7]RR!(}Lvc+~{+2\G#m`I-@q9(:k5:\P@UFQzCx%>te2]<yKE-y+0v^.[0nxQKTQo1D^1\"h~W`8^lPagT>BEr&WOA?	pz>rD7*Oti:0uZk
6ay!Q Q5d=lJ~1s#1,qA)iTBi8v$1j=b;IVl	-[n\9%l)C%$e!dU"&X1*sM1k9@~EcQC=SMDZ9;{H{c~o:ZOz7&V[:VxXKhP'J+v|%6?5<)ZP,g{ 4 '0V~]>(,
 wz7~
g+AJi>	oDEc1~l7D0)o]-;]]ee
R>E*)[(yw }^`rH!{yiW_93K[5Dh}^:o4gCz8R(?}u*XUMS]URLR%pmk'l"
6qt6:I8*U5 ;nObYqkUZz_Vuw7astE1D7QI];P#bNTuGT8H#dNiKNt7qag;0N;{CrsO?FS^G}rvQG,==sA}C4y(2%87+3 >~cHpog<,>bSsb>?y'/TgzcTjHM4F&=9ZESXUF
cAKO=j^|
4kXg}f %d4%:hx4&C%(L@UjW_6W_j_=(y4),Q
"AU;MU.H7%=<mI^3R2sn9	%98.5m@G%u|r?;?wzN0$-F
@kzT)gk!vQI{;N8L[u/do2-^Cx})! {\]|z\:(
|tFr*9IaT?{|T!GbehDTKD/YM=Ml{TGdi7%<xn
X0$v~^m}I|d$`yhE3Po*w<}8  [dZM'e#=@D pU<,68N&l[0
xPQK>5%E8q	e}%.CYOy?Bu%8\Bw[Rz]4;C! B",8a&2MjQ[;O_G?0/_21@ PLXLem9H2
(][NEtj)*y}v|u`7 )xy@;0')P4zJ~@x9E
Uk:48Pv~a{&DW-~;<e RaQnfEraLdEPo{5'L7ugsrN,-/m\l=jwTXIG4`16A'=mUzF;6WBFE(s
EEVdRq@IdI5XNzoz]P2ky89,*x}Q1B%9VI4z-#vRLthfvI~/ ?cH+hX;gXxAzV<c ]nxV'`c_^5J\Qtw|B:oyhm4yFybO,EM5yV&ApF5
;}{|yGaQ<J^m+hiW@29hJWm <link rel="import" href="edge://resources/edge_html/polymer.html">

<link rel="import" href="edge://resources/edge_elements/icons.html">
<link rel="import" href="edge://resources/edge_html/i18n_behavior.html">
<link rel="import" href="edge://resources/edge_html/web_ui_listener_behavior.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-button/paper-button.html">
<link rel="import" href="profile_info_browser_proxy.html">
<link rel="import" href="sync_browser_proxy.html">
<link rel="import" href="../i18n_setup.html">
<link rel="import" href="../icons.html">
<link rel="import" href="../route.html">
<link rel="import" href="../settings_shared_css.html">

<link rel="import" href="manage_profile.html">

<dom-module id="settings-profile-control">
  <template>
    <style include="settings-shared">
      :host {
        --shown-avatar-size: 62px;
        --sync-icon-size: 16px;
      }

      .profile-control-wrapper {
        background-color: var(--edge-card-color);
        border-radius: var(--edge-card-border-radius);
        display: flex;
        flex-direction: row;
        font-family: system-ui, sans-serif;
        margin-bottom: 8px;
        min-height: 90px;
        padding: 0;
        @apply --edge-card-elevation;
      }

      .avatar-container {
        align-self: flex-start;
        border: 1px #666 solid;
        border-radius: 50%;
        display: flex;
        margin-bottom: 20px;
        margin-inline-start: 20px;
        margin-top: 20px;
        position: relative;
      }

      .account-icon {
        border-radius: 50%;
        height: var(--shown-avatar-size);
        width: var(--shown-avatar-size);
      }

      #sync-icon-container {
        align-items: center;
        background: #666;
        border: 1px solid white;
        border-radius: 50%;
        bottom: -1px;
        display: flex;
        height: var(--sync-icon-size);
        justify-content: center;
        position: absolute;
        right: -1px;
        width: var(--sync-icon-size);
      }

      #sync-icon-container.syncing {
        background: rgb(16, 124, 16);
      }

      #sync-icon-container.sync-problem-recoverable {
        background: var(--edge-error-rest);
      }

      #sync-icon-container iron-icon {
        fill: white;
        height: calc(var(--sync-icon-size) * 0.75);
        margin-top: 0;
        width: calc(var(--sync-icon-size) * 0.75);
      }

      #sync-icon-container.syncing iron-icon {
        height: calc(var(--sync-icon-size));
        width: calc(var(--sync-icon-size));
      }

      .content-edit-wrapper {
        align-items: flex-start;
        display: flex;
        flex-grow: 1;
      }

      .profile-manager-wrapper {
        padding: 12px 20px 16px 20px;
        width: 100%;
      }

      #edit-module-header {
        font-size: 12px;
        line-height: 16px;
        margin-top: 0;
      }

      .profile-container {
        align-items: flex-start;
        align-self: stretch;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        justify-content: center;
        margin-bottom: 8px;
        margin-top: 8px;
        max-width: 340px;
        padding-inline-start: 22px;
      }

      .user-name {
        font-size: 18px;
        font-weight: bold;
        line-height: 24px;
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .sync-status-text {
        font-size: 12px;
        line-height: 16px;
        margin-bottom: 6px;
        margin-top: 2px;
      }

      .tertiary-text {
        font-size: 11px;
      }

      .oneline {
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
      }

      .button-container {
        align-items: center;
        align-self: stretch;
        display: flex;
        flex-direction: row;
        flex-grow: 1;
        flex-wrap: wrap;
        justify-content: flex-end;
        padding-inline-end: 20px;
      }

      #edit-profile-button {
        margin-inline-end: 8px;
      }

      #action-button {
        margin-inline-start: 8px;
      }

      .wide {
        min-width: 100px;
      }

      #my-account-button {
        background: transparent;
        border-bottom: 1px solid transparent;
        border-radius: 0;
        color: var(--edge-text-light-blue-rest);
        height: 16px;
        margin: 0;
        padding: 0;
      }

      #my-account-button.keyboard-focus {
        border-bottom: 2px solid;
        outline: none;
      }

      #my-account-button:hover {
        border-bottom: 1px solid var(--edge-text-light-blue-rest);
      }

      #my-account-button[disabled] {
        opacity: var(--edge-disabled-opacity);
      }

      @media only screen and (max-width : 640px) {
        .button-container {
          align-items: center;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          margin-bottom: 8px;
          margin-top: 8px;
          padding-inline-end: 16px;
          padding-inline-start: 16px;
        }

        #edit-profile-button {
          margin-inline-end: 0;
        }

        #action-button {
          margin-inline-start: 0;
        }
      }
    </style>
    <div class="profile-control-wrapper" id="avatar-row">
      <div class="avatar-container">
        <img id="account-icon" class="account-icon" alt=""
             src="[[profileIconUrl_]]">
        </img>
        <div id="sync-icon-container"
             hidden="[[shouldHideSyncIcon_(syncStatus)]]"
             class$="[[getSyncIconStyle_(syncStatus)]]">
          <iron-icon icon$="[[getSyncIcon_(syncStatus)]]">
          </iron-icon>
        </div>
      </div>
      <div class="content-edit-wrapper">
        <template is="dom-if" if="[[showProfileModule]]" restamp>
          <div class="profile-manager-wrapper">
            <settings-manage-profile
                profile-name="[[profileName_]]"
                sync-status="[[syncStatus]]"
                profile-icon-url="{{profileIconUrl_}}"
                profile-module-mode="{{profileModuleMode}}"
                show-profile-module="{{showProfileModule}}">
            </settings-manage-profile>
          </div>
        </template>
        <template is="dom-if" if="[[!showProfileModule]]">
          <div class="profile-container">
              <span id="user-name" class="user-name">
                [[profileName_]]
              </span>
              <template is="dom-if" if="[[shouldShowSubtitle_(syncStatus,
                  profileForcedSignOut_)]]">
                <div id="sync-status-test" class="sync-status-text">
                  [[getSubtitleText_(syncStatus, profileForcedSignOut_)]]
                </div>
              </template>
              <template is="dom-if" if="[[profileForcedSignOut_]]">
                <span class="tertiary-text">
                  $i18n{msProfilesAccountForcedRemovedTertiary}
                </span>
              </template>
              <template is="dom-if" if="[[syncStatus.signedIn]]">
                <paper-button id="my-account-button"
                    disabled$="[[disableButtons]]"
                    on-click="onMyAccountButtonTap_">
                  $i18n{msManageProfileMyAccount}
                </paper-button>
              </template>
            </div>
            <div class="button-container">
              <paper-button id="edit-profile-button"
                  disabled$="[[disableButtons]]"
                  class="light-outline-button wide"
                  on-click="onEditProfileTap_">
                $i18n{msManageProfileEdit}
              </paper-button>
              <paper-button id="remove-profile-button"
                  disabled$="[[disableButtons]]"
                  class="light-outline-button wide"
                  on-click="onRemoveCurrentProfile_"
                  hidden="[[shouldHideRemoveProfileButton_()]]">
                $i18n{msManageProfileRemove}
              </paper-button>
              <paper-button id="action-button"
                  disabled$="[[disableButtons]]"
                  class$="[[getActionButtonStyle_(syncStatus,
                      profileForcedSignOut_)]] wide oneline"
                  on-click="onActionButtonTap_"
                  hidden="[[shouldHideActionButton_(syncStatus)]]">
                [[actionButtonText_(syncStatus, profileForcedSignOut_)]]
              </paper-button>
          </div>
        </template>
      </div>
    </div>
  </template>
  <script src="profile_control.js"></script>
</dom-module>
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @fileoverview
 * 'settings-profile-control' is the settings page component that is the card
 * displaying the primary profile's details. Also contains logic for controlling
 * inline edit and add a profile. The component was modeled after the original
 * people_page profile component and sync_accounts_control.
 */
cr.exportPath('settings');

Polymer({
  is: 'settings-profile-control',
  behaviors: [WebUIListenerBehavior, I18nBehavior],
  properties: {
    /**
     * The current profile's account type, if connected. One of 'msa', 'aad', or
     * 'none'.
     * @private
     */
    accountType_: String,

    /**
     * The current sync status, supplied by parent element.
     * @type {!settings.SyncStatus}
     */
    syncStatus: {
      type: Object,
    },

    /**
     * The currently selected profile icon URL. May be a data URL.
     * @private
     */
    profileIconUrl_: String,

    /**
     * The current profile name.
     * @private
     */
    profileName_: String,

    /**
     * True if the edit/add module is showing in the profile card. Supplied by
     * parent element.
     */
    showProfileModule: {
      type: Boolean,
      notify: true,
      observer: 'showProfileModuleChanged',
    },

    /**
     * What mode the edit/add module is in. One of 'edit' or 'add'. Supplied by
     * parent element.
     */
    profileModuleMode: {
      type: String,
      notify: true,
    },

    /**
     * True if the sign in is enabled by policy.
     */
    signInAllowed_: {
      type: Boolean,
    },

    /**
     * True if force sign in is enabled by policy.
     */
    forceSigninEnabled_: {
      type: Boolean,
    },

    /**
     * True if the profile is non-removable per NonRemovableProfileEnabled
     * policy.
     */
    profileNonRemovable_: Boolean,

    disableButtons: Boolean,
  },

  /** @private {?settings.SyncBrowserProxy} */
  syncBrowserProxy_: null,

  created: function() {
    this.syncBrowserProxy_ = settings.SyncBrowserProxyImpl.getInstance();
  },

  /** @override */
  attached: function() {
    const profileInfoProxy = settings.ProfileInfoBrowserProxyImpl.getInstance();
    profileInfoProxy.getProfileInfo().then(this.handleProfileInfo_.bind(this));
    this.addWebUIListener(
      'profile-info-changed', this.handleProfileInfo_.bind(this));
    this.signInAllowed_ = loadTimeData.getBoolean('isSignInEnabled');
    this.forceSigninEnabled_ = loadTimeData.getBoolean('forceBrowserSignInEnabled');
    this.profileNonRemovable_ = loadTimeData.getBoolean('isProfileNonRemovable');
  },

  /**
   * Handler for when the profile's icon and name is updated.
   * @private
   * @param {!settings.ProfileInfo} info
   */
  handleProfileInfo_: function(info) {
    this.profileName_ = info.name;
    this.profileIconUrl_ = info.iconUrl;
    this.accountType_ = info.accountType;
    this.profileForcedSignOut_ = info.profileForcedSignOut;
  },

  /**
   * Returns the string for the action button in the profile card.
   * @return {string}
   * @private
   */
  actionButtonText_: function(syncStatus, profileForcedSignOut) {
    if (!syncStatus) {
      return '';
    }

    if (profileForcedSignOut) {
      return loadTimeData.getString(
        "msProfilesAccountForcedRemovedSignInButtonLabel"
      );
    }

    // Check we are not an add a profile module because we only want the main
    // profile control to fire impressions.
    if (!syncStatus.signedIn && this.profileModuleMode !== 'add') {
      chrome.metricsPrivate.recordUserAction('Signin_Impression_FromSettings');
    }

    if (syncStatus.signedIn) {
      return loadTimeData.getString('msProfileSignOut');
    }

    return loadTimeData.getString('msProfileSignIn');
  },

  // Check if the sign in/out button should be displayed.
  // If Browser SignIn Settings Policy is enabled to Force the sign-in, sign out
  // button is hidden. Also, if the same policy is configured to disable signin,
  // the sign-in button is hidden.
  shouldHideActionButton_: function (syncStatus) {
    if (this.profileNonRemovable_) {
      return true;
    }
    if (syncStatus) {
      if (syncStatus.signedIn) {
        return this.forceSigninEnabled_;
      }
      return !this.signInAllowed_;
    }
    return false;
  },

  shouldHideRemoveProfileButton_: function() {
    return this.profileNonRemovable_;
  },

  shouldHideSyncIcon_: function() {
    return !this.syncStatus.signedIn ||
        (this.profileModuleMode === 'add' && !!this.showProfileModule);
  },

  showProfileModuleChanged: function(newVal) {
    // Only fire telemetry on showing module.
    if (newVal) {
      if (this.profileModuleMode === 'edit') {
        chrome.metricsPrivate.recordUserAction(
          'Settings_PeoplePage_EditProfileMode_Impression');
      } else if (this.profileModuleMode === 'add') {
        chrome.metricsPrivate.recordUserAction(
          'Settings_PeoplePage_AddProfileMode_Impression');
      }
    }
  },

  /**
   * Returns the class of the sync icon.
   * @return {string}
   * @private
   */
  getSyncIconStyle_: function(syncStatus) {
    // Logic has been pushed up to proxy but leave getter for CSS class style in
    // profile_control.html.
    return this.syncBrowserProxy_.getUIStateFromStatus(syncStatus);
  },

  /**
   * @return {string}
   * @private
   */
  getSyncIcon_: function(syncStatus) {
    // Two icon options - sync arrows for positive state and an X for all other
    // states.
    switch (this.getSyncIconStyle_(syncStatus)) {
      case 'syncing':
        return 'edge16:syncing';
      case 'sync-problem-unrecoverable':
      case 'sync-problem-recoverable':
      case 'sync-disabled-no-signin':
      case 'sync-disabled-by-aad':
      case 'sync-disabled-by-choice':
      case 'sync-disabled-by-admin':
        return 'edge:clear';
      default:
        return 'edge:clear';
    }
  },

  /**
   * @return {string}
   * @private
   */
  getSubtitleText_: function(syncStatus, profileForcedSignOut) {
    const username = this.syncStatus.signedInUsername || '';
    const positiveSyncText = loadTimeData.getStringF(
      'msActiveSyncingStatus', username);
    const notSyncText = loadTimeData.getStringF(
      'msNotSyncingStatus', username);

    if (profileForcedSignOut) {
      return loadTimeData.getString("msProfilesAccountForcedRemovedSubtitle");
    }

    switch (this.getSyncIconStyle_(syncStatus)) {
      case 'syncing':
        return positiveSyncText;
      case 'sync-problem-unrecoverable':
      case 'sync-problem-recoverable':
      case 'sync-disabled-no-signin':
      case 'sync-disabled-by-aad':
      case 'sync-disabled-by-choice':
      case 'sync-disabled-by-admin':
        return notSyncText;
      default:
        return notSyncText;
    }
  },

  /** @private */
  onActionButtonTap_: function() {
    // There will need to be more logic here to respond to sync status better.
    // This is fine for now though.
    if (this.syncStatus.signedIn) {
      settings.navigateTo(settings.routes.SIGN_OUT);
    } else {
      this.syncBrowserProxy_.startSignIn();
    }
  },

  /** @private */
  onMyAccountButtonTap_: function() {
    assert(!!this.accountType_,
      "My account called without a signed in account type.");
    assert(!!this.syncStatus.signedInUsername,
      "My account called without a signed in account.");
    chrome.metricsPrivate.recordUserAction(
      'Microsoft.Settings_PeoplePage_MyAccountLinkClick');

    switch (this.accountType_) {
      case 'msa':
        window.open(loadTimeData.getStringF(
          'msMyAccountMSALink', this.syncStatus.signedInUsername));
        break;
      case 'aad':
        window.open(loadTimeData.getString('msMyAccountAADLink'));
        break;
      default:
        // Should never reach.
        assert(true, 'My account button clicked without AAD or MSA attached.');
        break;
    }
  },

  /** @private */
  onEditProfileTap_: function() {
    if (!this.showProfileModule) {
      this.showProfileModule = true;
      this.profileModuleMode = 'edit';
    }
  },

  /** @private */
  onRemoveCurrentProfile_: function() {
    settings.navigateTo(settings.routes.DELETE_PROFILE);
  },

  /**
   * Getter for the style of the action button in the card.
   * @private
   * @param {!settings.SyncStatus} syncStatus
   */
  getActionButtonStyle_: function(syncStatus, profileForcedSignOut) {
    if (!syncStatus || !syncStatus.signedIn || profileForcedSignOut) {
      return 'action-button';
    }

    return '';
  },

  shouldShowSubtitle_: function(syncStatus, profileForcedSignOut) {
    return (syncStatus && syncStatus.signedIn) || profileForcedSignOut;
  },
});
<link rel="import" href="edge://resources/edge_html/polymer.html">

<link rel="import" href="edge://resources/edge_elements/cr_input/cr_input.html">
<link rel="import" href="edge://resources/edge_elements/cr_profile_avatar_selector/cr_profile_avatar_selector.html">
<link rel="import" href="edge://resources/edge_elements/cr_toggle/cr_toggle.html">
<link rel="import" href="edge://resources/edge_html/i18n_behavior.html">
<link rel="import" href="edge://resources/edge_html/web_ui_listener_behavior.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-button/paper-button.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-styles/shadow.html">
<link rel="import" href="../i18n_setup.html">
<link rel="import" href="manage_profile_browser_proxy.html">
<link rel="import" href="../route.html">
<link rel="import" href="../settings_shared_css.html">

<dom-module id="settings-manage-profile">
  <template>
    <style include="settings-shared">
      .settings-box {
        margin-bottom: 15px;
        margin-top: 19px;
        padding: 0;
      }

      cr-input {
        --cr-input-error-display: none;
        width: 100%;
      }

      #selector {
        margin-bottom: 18px;
        margin-top: 18px;
      }

      .button-wrapper {
        display: flex;
        justify-content: flex-end;
        margin-top: 11px;
        width: 100%;
      }

      .button {
        height: 32px;
        width: 112px;
      }

      .button:first-child {
        margin-inline-end: 8px;
      }

      #positiveButton {
        background-color: rgb(0, 120, 212);
        color: white;
      }
    </style>
    <div on-keydown="onManageProfileKeydown_">
      <div class="settings-box first">
        <cr-input id="name" value="[[nameInputFieldValue_()]]"
            spellcheck="false"
            placeholder="[[namePlaceholderText_(profileName,
                                                profileDefaultName_)]]"
            on-change="onProfileNameChanged_" on-keydown="onProfileNameKeydown_"
            disabled="[[isProfileNameDisabled_(syncStatus)]]"
            aria-label="[[getInputAriaLabel_(profileModuleMode)]]">
        </cr-input>
      </div>
      <template is="dom-if" if="[[isProfileShortcutSettingVisible_]]">
        <div class="settings-box first">
          <div id="showShortcutLabel" class="start">
            $i18n{showShortcutLabel}
          </div>
          <cr-toggle id="hasShortcutToggle"
              checked="{{hasProfileShortcut_}}"
              on-change="onHasProfileShortcutChange_"
              aria-labelledby="showShortcutLabel">
          </cr-toggle>
        </div>
      </template>
      <cr-profile-avatar-selector id="selector" avatars="[[availableIcons]]"
          selected-avatar="{{profileAvatar_}}" ignore-modified-key-events>
      </cr-profile-avatar-selector>
      <div class="button-wrapper">

        <paper-button id="positiveButton" class="button"
            on-click="onPositiveTap_">
          [[positiveButtonString_(profileModuleMode)]]
        </paper-button>

        <paper-button id="negativeButton" class="button"
            on-click="onNegativeTap_">
          $i18n{msManageProfileCancel}
        </paper-button>

      </div>
    </div>
  </template>
  <script src="manage_profile.js"></script>
</dom-module>
// Copyright 2015 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @fileoverview
 * 'settings-manage-profile' is the settings subpage containing controls to
 * edit a profile's name, icon, and desktop shortcut.
 */
Polymer({
  is: 'settings-manage-profile',

  behaviors: [WebUIListenerBehavior, I18nBehavior],

  properties: {
    /**
     * The newly selected avatar. Populated only if the user manually changes
     * the avatar selection. The observer ensures that the changes are
     * propagated to the C++.
     * @private
     */
    profileAvatar_: {
      type: Object,
      observer: 'onProfileAvatarChanged_',
    },

    /**
     * The current profile name.
     */
    profileName: String,

    /**
     * True if the current profile has a shortcut.
     */
    hasProfileShortcut_: Boolean,

    /**
     * The available icons for selection.
     * @type {!Array<!AvatarIcon>}
     */
    availableIcons: {
      type: Array,
      value: function() {
        return [];
      },
    },

    /**
     * The current sync status.
     * @type {?settings.SyncStatus}
     */
    syncStatus: Object,

    /**
     * True if showing the edit / add profile module. Propagated to parent
     * element, used to close module.
     */
    showProfileModule: {
      type: Boolean,
      notify: true,
    },

    /**
     * One of: 'edit' or 'add'. Signals what mode this module should function
     * in.
     */
    profileModuleMode: {
      type: String,
      notify: true,
    },

    /**
     * Tracks the name inputted into the profile name editor or creator.
     * @private
     */
    inputtedName_: String,

    /**
     * True if the profile shortcuts feature is enabled.
     */
    isProfileShortcutSettingVisible_: Boolean,

    /**
     * Profile icon URL being displayed on the profile card. Supplied by parent
     * profile-control.
     * @private
     */
    profileIconUrl: {
      type: String,
      notify: true,
    },

    /**
     * Profile avatar URL of image in profile_control. Used in edit mode to rest
     * the profile card image back to original if the user cancels the edit.
     * @private
     */
    originalProfileIconURL_: {
      type: String,
      value: '',
    },

    /**
     * Default name of the next profile to be created. In the shape of "Profile
     * ${Number}".
     * @private
     */
    profileDefaultName_: String,
  },

  /** @private {?settings.ManageProfileBrowserProxy} */
  browserProxy_: null,

  /** @override */
  created: function() {
    this.browserProxy_ = settings.ManageProfileBrowserProxyImpl.getInstance();
  },

  /** @override */
  attached: function() {
    const setProfileDefaultName = defaults => {
      this.profileDefaultName_ = defaults.name;
    };

    // Set the profile avatar icon proactively to the doughboy.
    if (this.profileModuleMode === 'add') {
      this.profileIconUrl = 'edge://theme/IDR_PROFILE_AVATAR_0';
    }

    this.browserProxy_.getProfileDefaults().then(setProfileDefaultName);
    this.addWebUIListener('profile-defaults-changed', setProfileDefaultName);

    // 'available-icons-changed' only returns when account image loaded async.
    this.addWebUIListener('available-icons-changed', this.setIcons_.bind(this));
    this.browserProxy_.getAvailableIcons().then(this.setIcons_.bind(this));

    Polymer.RenderStatus.afterNextRender(
        this, () => this.$.name.inputElement.focus());
  },

  /**
   * Handler for when avatar selection icons are pushed.
   * @private
   */
  setIcons_: function(icons) {
    let modifiedIcons = icons;

    if (modifiedIcons.length > 20) {
      if (this.profileModuleMode === 'edit') {
        // Remove the doughboy.
        modifiedIcons.splice(1, 1);
      } else if (this.profileModuleMode === 'add') {
        // Remove the user's image.
        modifiedIcons.splice(0, 1);
      }
    }

    if (this.profileModuleMode === 'add') {
      // Remove current 'selected' property of all avatars.
      modifiedIcons =
        modifiedIcons.map(icon => Object.assign(icon, { selected: false }));

      // Set the doughboy (elem 0) to selected since we have set the profile
      // icon proactively to the doughboy.
      modifiedIcons[0].selected = true;
      this.profileIconUrl = modifiedIcons[0].url;
    }

    // Set the initial state of |profileAvatar_| for both module modes. Find
    // the selected avatar from the supplied list.
    this.profileAvatar_ =
      modifiedIcons.filter(icon => icon.selected === true)[0];
    this.availableIcons = modifiedIcons;
  },

  /** @private */
  namePlaceholderText_: function(profileName, profileDefaultName_) {
    if (this.profileModuleMode === 'edit') {
      return profileName || '';
    } else if (this.profileModuleMode === 'add') {
      return profileDefaultName_ || '';
    } else {
      return '';
    }
  },

  /** @private */
  nameInputFieldValue_: function() {
    if (this.profileModuleMode === 'add') {
      return '';
    } else if (this.profileModuleMode === 'edit') {
      return this.profileName;
    }

    return '';
  },

  /** @private */
  onPositiveTap_: function() {
    assert(this.availableIcons.length >= 0,
      'No available avatar icons available for manage_profile.');
    assert(
        !!this.profileDefaultName_,
        'profileDefaultName_ was not set in time for profile creation.');

    const nameToSet = this.inputtedName_ ? this.inputtedName_.trim() : '';

    if (this.profileModuleMode === 'edit') {
      if (this.profileAvatar_ && this.profileAvatar_.isGaiaAvatar) {
        this.browserProxy_.setProfileIconToGaiaAvatar();
      } else if (this.profileAvatar_) {
        this.browserProxy_.setProfileIconToDefaultAvatar(
          this.profileAvatar_.url);
      }

      if (nameToSet.length > 0) {
        this.browserProxy_.setProfileName(nameToSet);
      }
    } else if (this.profileModuleMode === 'add') {
      const imageUrl = this.profileAvatar_ ?
        this.profileAvatar_.url : this.availableIcons[0].url;
      const name = nameToSet.length > 0 ? nameToSet : this.profileDefaultName_;
      this.browserProxy_.addNewProfile(name, imageUrl, false);
    }

    this.showProfileModule = false;
  },

  /** @private */
  positiveButtonString_: function(profileModuleMode) {
    return profileModuleMode === 'add' ?
      this.i18n('msManageProfileAdd') : this.i18n('msManageProfileUpdate');
  },

  /** @private */
  onNegativeTap_: function() {
    if (this.originalProfileIconURL_ != '' &&
        this.profileModuleMode === 'edit') {
      this.profileIconUrl = this.originalProfileIconURL_;
    }

    // Will restamp when closed so form reset is handled.
    this.showProfileModule = false;
  },

  /**
   * Handler for when the profile name field is changed, then blurred.
   * @param {!Event} event
   * @private
   */
  onProfileNameChanged_: function(event) {
    if (event.target.invalid) {
      return;
    }

    this.inputtedName_ = event.target.value;
  },

  /**
   * Handler for profile name keydowns.
   * @param {!Event} event
   * @private
   */
  onProfileNameKeydown_: function(event) {
    if (event.key === 'Enter') {
      event.target.blur();
      this.onPositiveTap_();
    }
  },

  /**
   * @param {?settings.SyncStatus} syncStatus
   * @return {boolean} Whether the profile name field is disabled.
   * @private
   */
  isProfileNameDisabled_: function(syncStatus) {
    return !!syncStatus.supervisedUser && !syncStatus.childUser;
  },

  /**
   * Handler for when the profile shortcut toggle is changed.
   * @param {!Event} event
   * @private
   */
  onHasProfileShortcutChange_: function(event) {
    if (this.hasProfileShortcut_) {
      this.browserProxy_.addProfileShortcut();
    } else {
      this.browserProxy_.removeProfileShortcut();
    }
  },

  /**
   * Handler for when the user selects a profile avatar icon in the
   * cr-profile-avatar-selector.
   * @private
   */
  onProfileAvatarChanged_: function() {
    // Save the profile avatar url that was originally in the profile card. If
    // we cancel we will reset to this value.
    if (this.originalProfileIconURL_ === '') {
      this.originalProfileIconURL_ = this.profileIconUrl;
    }

    this.profileIconUrl = this.profileAvatar_.url;
  },

  /**
   * Returns the ARIA label for the input field in the manage profile module.
   * @private
   */
  getInputAriaLabel_: function(profileModuleMode) {
    if (profileModuleMode === 'edit') {
      return this.i18n('msManageProfileEditInputLabel');
    } else if (profileModuleMode === 'add') {
      return this.i18n('msManageProfileAddInputLabel');
    }
  },

  onManageProfileKeydown_: function(event) {
    if (event.key === 'Escape') {
      this.showProfileModule = false;
    }
  },
});
<link rel="import" href="edge://resources/edge_html/cr.html">
<script src="manage_profile_browser_proxy.js"></script>
// Copyright 2016 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @fileoverview A helper object used from the "Manage Profile" subpage of
 * the People section to interact with the browser. Chrome Browser only.
 */

/**
 * Contains the possible profile shortcut statuses. These strings must be kept
 * in sync with the C++ Manage Profile handler.
 * @enum {string}
 */
const ProfileShortcutStatus = {
  PROFILE_SHORTCUT_SETTING_HIDDEN: 'profileShortcutSettingHidden',
  PROFILE_SHORTCUT_NOT_FOUND: 'profileShortcutNotFound',
  PROFILE_SHORTCUT_FOUND: 'profileShortcutFound',
};

/**
 * @typedef {{name: string}}
 */
let ProfileDefault;

cr.define('settings', function() {
  /** @interface */
  class ManageProfileBrowserProxy {
    /**
     * Gets the available profile icons to choose from.
     * @return {!Promise<!Array<!AvatarIcon>>}
     */
    getAvailableIcons() {}

    /**
     * Sets the profile's icon to the GAIA avatar.
     */
    setProfileIconToGaiaAvatar() {}

    /**
     * Sets the profile's icon to one of the default avatars.
     * @param {string} iconUrl The new profile URL.
     */
    setProfileIconToDefaultAvatar(iconUrl) {}

    /**
     * Sets the profile's name.
     * @param {string} name The new profile name.
     */
    setProfileName(name) {}

    /**
     * Returns whether the current profile has a shortcut.
     * @return {!Promise<ProfileShortcutStatus>}
     */
    getProfileShortcutStatus() {}

    /**
     * Adds a shortcut for the current profile.
     */
    addProfileShortcut() {}

    /**
     * Removes the shortcut of the current profile.
     */
    removeProfileShortcut() {}

    /**
     * Creates a new profile with given information.
     * @param {string} name The new profile name.
     * @param {string} iconUrl The new profile image.
     * @param {boolean} createShortcut If a profile shortcut should be created
     *     for this profile.
     */
    addNewProfile(name, iconUrl, createShortcut) {}

    /**
     * Get profile default information.
     * @return {!Promise<ProfileDefault>}
     */
    getProfileDefaults() {}
  }

  /**
   * @implements {settings.ManageProfileBrowserProxy}
   */
  class ManageProfileBrowserProxyImpl {
    /** @override */
    getAvailableIcons() {
      return cr.sendWithPromise('getAvailableIcons');
    }

    /** @override */
    setProfileIconToGaiaAvatar() {
      chrome.send('setProfileIconToGaiaAvatar');
    }

    /** @override */
    setProfileIconToDefaultAvatar(iconUrl) {
      chrome.send('setProfileIconToDefaultAvatar', [iconUrl]);
    }

    /** @override */
    setProfileName(name) {
      chrome.send('setProfileName', [name]);
    }

    /** @override */
    getProfileShortcutStatus() {
      return cr.sendWithPromise('requestProfileShortcutStatus');
    }

    /** @override */
    addProfileShortcut() {
      chrome.send('addProfileShortcut');
    }

    /** @override */
    removeProfileShortcut() {
      chrome.send('removeProfileShortcut');
    }

    /** @override */
    addNewProfile(name, iconUrl, createShortcut) {
      chrome.send(
        'createProfile', [name, iconUrl, createShortcut]);
    }

    /** @override */
    getProfileDefaults() {
      return cr.sendWithPromise('getProfileDefaults');
    }
  }

  // The singleton instance_ is replaced with a test version of this wrapper
  // during testing.
  cr.addSingletonGetter(ManageProfileBrowserProxyImpl);

  return {
    ManageProfileBrowserProxy: ManageProfileBrowserProxy,
    ManageProfileBrowserProxyImpl: ManageProfileBrowserProxyImpl,
  };
});
<link rel="import" href="edge://resources/edge_html/cr.html">
<link rel="import" href="i18n_setup.html">
<link rel="import" href="page_visibility.html">

<script src="route.js"></script>
// Copyright 2016 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Specifies all possible routes in settings.
 *
 * @typedef {{
 *   ABOUT: (undefined|!settings.Route),
 *   ADDRESSES: (undefined|!settings.Route),
 *   ADVANCED: (undefined|!settings.Route),
 *   APPEARANCE: (undefined|!settings.Route),
 *   AUTOFILL: (undefined|!settings.Route),
 *   BASIC: (undefined|!settings.Route),
 *   CERTIFICATES: (undefined|!settings.Route),
 *   CHROME_CLEANUP: (undefined|!settings.Route),
 *   CLEAR_BROWSER_DATA: (undefined|!settings.Route),
 *   CLEAR_BROWSER_DATA_ON_EXIT: (undefined|!settings.Route),
 *   DEFAULT_BROWSER: (undefined|!settings.Route),
 *   DELETE_PROFILE: (undefined|!settings.Route),
 *   DEVICE: (undefined|!settings.Route),
 *   DISPLAY: (undefined|!settings.Route),
 *   DOWNLOADS: (undefined|!settings.Route),
 *   EDIT_DICTIONARY: (undefined|!settings.Route),
 *   FINGERPRINT: (undefined|!settings.Route),
 *   FONTS: (undefined|!settings.Route),
 *   IMPORT_DATA: (undefined|!settings.Route),
 *   INCOMPATIBLE_APPLICATIONS: (undefined|!settings.Route),
 *   KEYBOARD: (undefined|!settings.Route),
 *   LANGUAGES: (undefined|!settings.Route),
 *   LOCK_SCREEN: (undefined|!settings.Route),
 *   MANAGE_PASSWORDS: (undefined|!settings.Route),
 *   NEW_TAB_PAGE: (undefined|!settings.Route),
 *   ON_STARTUP: (undefined|!settings.Route),
 *   PASSWORDS: (undefined|!settings.Route),
 *   PAYMENTS: (undefined|!settings.Route),
 *   PEOPLE: (undefined|!settings.Route),
 *   POINTERS: (undefined|!settings.Route),
 *   POWER: (undefined|!settings.Route),
 *   PRINTING: (undefined|!settings.Route),
 *   PRIVACY: (undefined|!settings.Route),
 *   RESET: (undefined|!settings.Route),
 *   RESET_DIALOG: (undefined|!settings.Route),
 *   SEARCH: (undefined|!settings.Route),
 *   SEARCH_ENGINES: (undefined|!settings.Route),
 *   SIGN_OUT: (undefined|!settings.Route),
 *   SITE_SETTINGS: (undefined|!settings.Route),
 *   SITE_SETTINGS_ADS: (undefined|!settings.Route),
 *   SITE_SETTINGS_ALL: (undefined|!settings.Route),
 *   SITE_SETTINGS_AUTOMATIC_DOWNLOADS: (undefined|!settings.Route),
 *   SITE_SETTINGS_BACKGROUND_SYNC: (undefined|!settings.Route),
 *   SITE_SETTINGS_CAMERA: (undefined|!settings.Route),
 *   SITE_SETTINGS_CLIPBOARD: (undefined|!settings.Route),
 *   SITE_SETTINGS_COOKIES: (undefined|!settings.Route),
 *   SITE_SETTINGS_DATA_DETAILS: (undefined|!settings.Route),
 *   SITE_SETTINGS_FLASH: (undefined|!settings.Route),
 *   SITE_SETTINGS_HANDLERS: (undefined|!settings.Route),
 *   SITE_SETTINGS_IMAGES: (undefined|!settings.Route),
 *   SITE_SETTINGS_JAVASCRIPT: (undefined|!settings.Route),
 *   SITE_SETTINGS_SENSORS: (undefined|!settings.Route),
 *   SITE_SETTINGS_SOUND: (undefined|!settings.Route),
 *   SITE_SETTINGS_TRACKING_PREVENTION: (undefined|!settings.Route),
 *   SITE_SETTINGS_LOCATION: (undefined|!settings.Route),
 *   SITE_SETTINGS_MICROPHONE: (undefined|!settings.Route),
 *   SITE_SETTINGS_MIDI_DEVICES: (undefined|!settings.Route),
 *   SITE_SETTINGS_NOTIFICATIONS: (undefined|!settings.Route),
 *   SITE_SETTINGS_PAYMENT_HANDLER: (undefined|!settings.Route),
 *   SITE_SETTINGS_PDF_DOCUMENTS: (undefined|!settings.Route),
 *   SITE_SETTINGS_POPUPS: (undefined|!settings.Route),
 *   SITE_SETTINGS_PROTECTED_CONTENT: (undefined|!settings.Route),
 *   SITE_SETTINGS_SITE_DATA: (undefined|!settings.Route),
 *   SITE_SETTINGS_SITE_DETAILS: (undefined|!settings.Route),
 *   SITE_SETTINGS_UNSANDBOXED_PLUGINS: (undefined|!settings.Route),
 *   SITE_SETTINGS_USB_DEVICES: (undefined|!settings.Route),
 *   SITE_SETTINGS_ZOOM_LEVELS: (undefined|!settings.Route),
 *   STORAGE: (undefined|!settings.Route),
 *   STYLUS: (undefined|!settings.Route),
 *   SYNC: (undefined|!settings.Route),
 *   SYSTEM: (undefined|!settings.Route),
 *   TRIGGERED_RESET_DIALOG: (undefined|!settings.Route),
 * }}
 */
let SettingsRoutes;

cr.define('settings', function() {

  /**
   * Class for navigable routes. May only be instantiated within this file.
   */
  class Route {
    /** @param {string} path */
    constructor(path) {
      /** @type {string} */
      this.path = path;

      /** @type {?settings.Route} */
      this.parent = null;

      /** @type {number} */
      this.depth = 0;

      /**
       * @type {boolean} Whether this route corresponds to a navigable
       *     dialog. Those routes don't belong to a "section".
       */
      this.isNavigableDialog = false;

      // Below are all legacy properties to provide compatibility with the old
      // routing system.

      /** @type {string} */
      this.section = '';
    }

    /**
     * Returns a new Route instance that's a child of this route.
     * @param {string} path Extends this route's path if it doesn't contain a
     *     leading slash.
     * @return {!settings.Route}
     * @private
     */
    createChild(path) {
      assert(path);

      // |path| extends this route's path if it doesn't have a leading slash.
      // If it does have a leading slash, it's just set as the new route's URL.
      const newUrl = path[0] == '/' ? path : `${this.path}/${path}`;

      const route = new Route(newUrl);
      route.parent = this;
      route.section = this.section;
      route.depth = this.depth + 1;

      return route;
    }

    /**
     * Returns a new Route instance that's a child section of this route.
     * TODO(tommycli): Remove once we've obsoleted the concept of sections.
     * @param {string} path
     * @param {string} section
     * @return {!settings.Route}
     * @private
     */
    createSection(path, section) {
      const route = this.createChild(path);
      route.section = section;
      return route;
    }

    /**
     * Returns the absolute path string for this Route, assuming this function
     * has been called from within edge://settings.
     * @return {string}
     */
    getAbsolutePath() {
      return window.location.origin + this.path;
    }

    /**
     * Returns true if this route matches or is an ancestor of the parameter.
     * @param {!settings.Route} route
     * @return {boolean}
     */
    contains(route) {
      for (let r = route; r != null; r = r.parent) {
        if (this == r) {
          return true;
        }
      }
      return false;
    }

    /**
     * Returns true if this route is a subpage of a section.
     * @return {boolean}
     */
    isSubpage() {
      return !!this.parent && !!this.section &&
          this.parent.section == this.section;
    }
  }

  /**
   * Computes and return all available routes based on settings.pageVisibility.
   * @return {!SettingsRoutes}
   */
  const computeAvailableRoutes = function() {
    const pageVisibility = settings.pageVisibility || {};

    /** @type {!SettingsRoutes} */
    const r = {};

    // Root pages.
    r.BASIC = new Route('/');
    r.ADVANCED = new Route('/advanced');

    // People page routes
    if (pageVisibility.people) {
      r.PEOPLE = r.BASIC.createSection('/people', 'people');
      r.SYNC = r.PEOPLE.createChild('/syncSetup');
      r.ADDRESSES = r.PEOPLE.createChild('/addresses');
      r.MANAGE_PASSWORDS = r.PEOPLE.createChild('/passwords');
      r.PAYMENTS = r.PEOPLE.createChild('/payments');

      // Make settings/autofill point to settings/people as that is where we
      // have the autofill related components.
      r.AUTOFILL = r.BASIC.createSection('/autofill', 'people');
    }

    // Appearance page routes
    if (pageVisibility.appearance) {
      r.APPEARANCE = r.BASIC.createSection('/appearance', 'appearance');
      r.FONTS = r.APPEARANCE.createChild('/fonts');
    }

    // Privacy page routes
    r.PRIVACY = r.BASIC.createSection('/privacy', 'privacy');
    if (pageVisibility.privacy && pageVisibility.privacy.privacySection) {
      r.CERTIFICATES = r.PRIVACY.createChild('/certificates');
    }
    if (pageVisibility.privacy &&
        pageVisibility.privacy.clearBrowsingDataSection) {
      r.CLEAR_BROWSER_DATA = r.BASIC.createChild('/clearBrowserData');
      r.CLEAR_BROWSER_DATA.isNavigableDialog = true;
      if (loadTimeData.getBoolean('enableDBDOnExitFeature')) {
        r.CLEAR_BROWSER_DATA_ON_EXIT = r.PRIVACY.createChild(
          '/clearBrowserDataOnExit');
      }
    }
    if (pageVisibility.privacy && pageVisibility.privacy.servicesSection) {
      r.SEARCH = r.PRIVACY.createChild('/search');
      r.SEARCH_ENGINES = r.SEARCH.createChild('/searchEngines');
    }

    // Site settings page routes
    if (pageVisibility.siteSettings) {
      r.SITE_SETTINGS = r.BASIC.createSection('/content', 'contentSettings');
      if (loadTimeData.getBoolean('enableSiteSettings')) {
        r.SITE_SETTINGS_ALL = r.SITE_SETTINGS.createChild('all');
        r.SITE_SETTINGS_SITE_DETAILS =
            r.SITE_SETTINGS_ALL.createChild('/content/siteDetails');
      } else {
        r.SITE_SETTINGS_SITE_DETAILS =
            r.SITE_SETTINGS.createChild('/content/siteDetails');
      }
      r.SITE_SETTINGS_HANDLERS = r.SITE_SETTINGS.createChild('/handlers');
      r.SITE_SETTINGS_ADS = r.SITE_SETTINGS.createChild('ads');
      r.SITE_SETTINGS_AUTOMATIC_DOWNLOADS =
          r.SITE_SETTINGS.createChild('automaticDownloads');
      r.SITE_SETTINGS_BACKGROUND_SYNC =
          r.SITE_SETTINGS.createChild('backgroundSync');
      r.SITE_SETTINGS_CAMERA = r.SITE_SETTINGS.createChild('camera');
      r.SITE_SETTINGS_CLIPBOARD = r.SITE_SETTINGS.createChild('clipboard');
      r.SITE_SETTINGS_COOKIES = r.SITE_SETTINGS.createChild('cookies');
      r.SITE_SETTINGS_SITE_DATA =
          r.SITE_SETTINGS_COOKIES.createChild('/siteData');
      r.SITE_SETTINGS_DATA_DETAILS =
          r.SITE_SETTINGS_SITE_DATA.createChild('/cookies/detail');
      r.SITE_SETTINGS_IMAGES = r.SITE_SETTINGS.createChild('images');
      r.SITE_SETTINGS_JAVASCRIPT = r.SITE_SETTINGS.createChild('javascript');
      r.SITE_SETTINGS_SOUND = r.SITE_SETTINGS.createChild('sound');
      r.SITE_SETTINGS_SENSORS = r.SITE_SETTINGS.createChild('sensors');
      if (pageVisibility.privacy && pageVisibility.privacy.trackingPreventionSection) {
        r.SITE_SETTINGS_TRACKING_PREVENTION = r.SITE_SETTINGS.createChild('trackingPrevention');
      }
      r.SITE_SETTINGS_LOCATION = r.SITE_SETTINGS.createChild('location');
      r.SITE_SETTINGS_MICROPHONE = r.SITE_SETTINGS.createChild('microphone');
      r.SITE_SETTINGS_NOTIFICATIONS =
          r.SITE_SETTINGS.createChild('notifications');
      r.SITE_SETTINGS_FLASH = r.SITE_SETTINGS.createChild('flash');
      r.SITE_SETTINGS_POPUPS = r.SITE_SETTINGS.createChild('popups');
      r.SITE_SETTINGS_UNSANDBOXED_PLUGINS =
          r.SITE_SETTINGS.createChild('unsandboxedPlugins');
      r.SITE_SETTINGS_MIDI_DEVICES = r.SITE_SETTINGS.createChild('midiDevices');
      r.SITE_SETTINGS_USB_DEVICES = r.SITE_SETTINGS.createChild('usbDevices');
      r.SITE_SETTINGS_ZOOM_LEVELS = r.SITE_SETTINGS.createChild('zoomLevels');
      r.SITE_SETTINGS_PDF_DOCUMENTS =
          r.SITE_SETTINGS.createChild('pdfDocuments');
      r.SITE_SETTINGS_PROTECTED_CONTENT =
          r.SITE_SETTINGS.createChild('protectedContent');
      if (loadTimeData.getBoolean('enablePaymentHandlerContentSetting')) {
        r.SITE_SETTINGS_PAYMENT_HANDLER =
            r.SITE_SETTINGS.createChild('paymentHandler');
      }
    }

    // Downloads page routes
    if (pageVisibility.downloads) {
      r.DOWNLOADS = r.BASIC.createSection('/downloads', 'downloads');
    }

    // On startup page routes
    if (pageVisibility.onStartup) {
      r.ON_STARTUP = r.BASIC.createSection('/onStartup', 'onStartup');
      r.STARTUP_PAGES = r.ON_STARTUP.createChild('/startupPages');
    }

    // New tab page routes
    if (pageVisibility.newTabPage) {
      r.NEW_TAB_PAGE = r.BASIC.createSection('/newTabPage', 'newTabPage');
    }

    // Languages page routes
    if (pageVisibility.languages) {
      r.LANGUAGES = r.BASIC.createSection('/languages', 'languages');
      r.EDIT_DICTIONARY = r.LANGUAGES.createChild('/editDictionary');
    }

    // Printing page routes
    if (pageVisibility.printing) {
      r.PRINTING = r.BASIC.createSection('/printing', 'printing');
    }

    // System page routes
    if (pageVisibility.system) {
      r.SYSTEM = r.BASIC.createSection('/system', 'system');
    }

    // Reset page routes
    if (pageVisibility.reset) {
      r.RESET = r.BASIC.createSection('/reset', 'reset');
      if (pageVisibility.reset !== false) {
        r.RESET_DIALOG = r.BASIC.createChild('/resetProfileSettings');
        r.RESET_DIALOG.isNavigableDialog = true;
        r.TRIGGERED_RESET_DIALOG =
            r.BASIC.createChild('/triggeredResetProfileSettings');
        r.TRIGGERED_RESET_DIALOG.isNavigableDialog = true;
      }
      r.CHROME_CLEANUP = r.RESET.createChild('/cleanup');
    }

    // About page routes
    r.ABOUT = r.BASIC.createSection('/help', 'about');

    // Navigable dialogs. These are the only non-section children of root
    // pages. These are disfavored. If we add anymore, we should add explicit
    // support.
    if (pageVisibility.people) {
      r.IMPORT_DATA = r.BASIC.createChild('/importData');
      r.IMPORT_DATA.isNavigableDialog = true;
      r.SIGN_OUT = r.BASIC.createChild('/signOut');
      r.SIGN_OUT.isNavigableDialog = true;
      r.DELETE_PROFILE = r.BASIC.createChild('/deleteProfile');
      r.DELETE_PROFILE.isNavigableDialog = true;
    }

    return r;
  };

  class Router {
    constructor() {
      /**
       * List of available routes. This is populated taking into account current
       * state (like guest mode).
       * @private {!SettingsRoutes}
       */
      this.routes_ = computeAvailableRoutes();

      /**
       * The current active route. This updated is only by settings.navigateTo
       * or settings.initializeRouteFromUrl.
       * @type {!settings.Route}
       */
      this.currentRoute = /** @type {!settings.Route} */ (this.routes_.BASIC);

      /**
       * The current query parameters. This is updated only by
       * settings.navigateTo or settings.initializeRouteFromUrl.
       * @private {!URLSearchParams}
       */
      this.currentQueryParameters_ = new URLSearchParams();

      /** @private {boolean} */
      this.wasLastRouteChangePopstate_ = false;

      /** @private {boolean}*/
      this.initializeRouteFromUrlCalled_ = false;
    }

    /** @return {settings.Route} */
    getRoute(routeName) {
      return this.routes_[routeName];
    }

    /** @return {!SettingsRoutes} */
    getRoutes() {
      return this.routes_;
    }

    /**
     * Helper function to set the current route and notify all observers.
     * @param {!settings.Route} route
     * @param {!URLSearchParams} queryParameters
     * @param {boolean} isPopstate
     */
    setCurrentRoute(route, queryParameters, isPopstate) {
      this.recordMetrics(route.path);

      const oldRoute = this.currentRoute;
      this.currentRoute = route;
      this.currentQueryParameters_ = queryParameters;
      this.wasLastRouteChangePopstate_ = isPopstate;
      new Set(routeObservers).forEach((observer) => {
        observer.currentRouteChanged(this.currentRoute, oldRoute);
      });
    }

    /** @return {!settings.Route} */
    getCurrentRoute() {
      return this.currentRoute;
    }

    /** @return {!URLSearchParams} */
    getQueryParameters() {
      return new URLSearchParams(
          this.currentQueryParameters_);  // Defensive copy.
    }

    /** @return {boolean} */
    lastRouteChangeWasPopstate() {
      return this.wasLastRouteChangePopstate_;
    }

    /**
     * @param {string} path
     * @return {?settings.Route} The matching canonical route, or null if none
     *     matches.
     */
    getRouteForPath(path) {
      // Allow trailing slash in paths.
      const canonicalPath = path.replace(CANONICAL_PATH_REGEX, '$1$2');

      // TODO(tommycli): Use Object.values once Closure compilation supports it.
      const matchingKey =
          Object.keys(this.routes_)
              .find((key) => this.routes_[key].path == canonicalPath);

      return matchingKey ? this.routes_[matchingKey] : null;
    }

    /**
     * Navigates to a canonical route and pushes a new history entry.
     * @param {!settings.Route} route
     * @param {URLSearchParams=} opt_dynamicParameters Navigations to the same
     *     URL parameters in a different order will still push to history.
     * @param {boolean=} opt_removeSearch Whether to strip the 'search' URL
     *     parameter during navigation. Defaults to false.
     */
    navigateTo(route, opt_dynamicParameters, opt_removeSearch) {
      // The ADVANCED route only serves as a parent of subpages, and should not
      // be possible to navigate to it directly.
      if (route == this.routes_.ADVANCED) {
        route = /** @type {!settings.Route} */ (this.routes_.BASIC);
      }

      const params = opt_dynamicParameters || new URLSearchParams();
      const removeSearch = !!opt_removeSearch;

      const oldSearchParam = this.getQueryParameters().get('search') || '';
      const newSearchParam = params.get('search') || '';

      if (!removeSearch && oldSearchParam && !newSearchParam) {
        params.append('search', oldSearchParam);
      }

      let url = route.path;
      const queryString = params.toString();
      if (queryString) {
        url += '?' + queryString;
      }

      // History serializes the state, so we don't push the actual route object.
      window.history.pushState(this.currentRoute.path, '', url);
      this.setCurrentRoute(route, params, false);
    }

    /**
     * Navigates to the previous route if it has an equal or lesser depth.
     * If there is no previous route in history meeting those requirements,
     * this navigates to the immediate parent. This will never exit Settings.
     */
    navigateToPreviousRoute() {
      const previousRoute = window.history.state &&
          assert(this.getRouteForPath(
              /** @type {string} */ (window.history.state)));

      if (previousRoute && previousRoute.depth <= this.currentRoute.depth) {
        window.history.back();
      } else {
        this.navigateTo(
            this.currentRoute.parent ||
            /** @type {!settings.Route} */ (this.routes_.BASIC));
      }
    }

    /**
     * Initialize the route and query params from the URL.
     */
    initializeRouteFromUrl() {
      this.recordMetrics(window.location.pathname);

      assert(!this.initializeRouteFromUrlCalled_);
      this.initializeRouteFromUrlCalled_ = true;

      let route = this.getRouteForPath(window.location.pathname);
      const isGuest = loadTimeData.getBoolean('isGuest');
      let replaceHistory = !route;
      if (!route || route === routes.BASIC) {
        if (isGuest) {
          route = routes.PRIVACY;
        } else {
          route = routes.PEOPLE;
        }
      }
      // Never allow direct navigation to ADVANCED.
      if (route && route != this.routes_.ADVANCED) {
        this.currentRoute = route;
        this.currentQueryParameters_ =
            new URLSearchParams(window.location.search);
      } else {
        replaceHistory = true;
      }

      if (replaceHistory) {
        window.history.replaceState(undefined, '',
          isGuest ? this.routes_.PRIVACY.path : this.routes_.PEOPLE.path);
      }
    }

    /**
     * Make a UMA note about visiting this URL path.
     * @param {string} urlPath The url path (only).
     */
    recordMetrics(urlPath) {
      assert(!urlPath.startsWith('edge://'));
      assert(!urlPath.startsWith('settings'));
      assert(urlPath.startsWith('/'));
      chrome.metricsPrivate.recordSparseHashable(
          'Microsoft.WebUI.Settings.PathVisited', urlPath);
    }

    resetRouteForTesting() {
      this.initializeRouteFromUrlCalled_ = false;
      this.wasLastRouteChangePopstate_ = false;
      this.currentRoute = /** @type {!settings.Route} */ (this.routes_.BASIC);
      this.currentQueryParameters_ = new URLSearchParams();
    }
  }

  const routerInstance = new Router();

  const routeObservers = new Set();

  /** @polymerBehavior */
  const RouteObserverBehavior = {
    /** @override */
    attached: function() {
      assert(!routeObservers.has(this));
      routeObservers.add(this);

      // Emulating Polymer data bindings, the observer is called when the
      // element starts observing the route.
      this.currentRouteChanged(routerInstance.currentRoute, undefined);
    },

    /** @override */
    detached: function() {
      assert(routeObservers.delete(this));
    },

    /**
     * @param {!settings.Route|undefined} opt_newRoute
     * @param {!settings.Route|undefined} opt_oldRoute
     */
    currentRouteChanged: function(opt_newRoute, opt_oldRoute) {
      assertNotReached();
    },
  };

  /**
   * Regular expression that captures the leading slash, the content and the
   * trailing slash in three different groups.
   * @type {!RegExp}
   */
  const CANONICAL_PATH_REGEX = /(^\/)([\/-\w]+)(\/$)/;

  window.addEventListener('popstate', function(event) {
    // On pop state, do not push the state onto the window.history again.
    routerInstance.setCurrentRoute(
        /** @type {!settings.Route} */ (
            routerInstance.getRouteForPath(window.location.pathname) ||
            routerInstance.getRoutes().BASIC),
        new URLSearchParams(window.location.search), true);
  });

  // TODO(scottchen): Change to 'get routes() {}' in export when we fix a bug in
  // ChromePass that limits the syntax of what can be returned from cr.define().
  const routes = routerInstance.getRoutes();

  // TODO(scottchen): Stop exposing all those methods directly on settings.*,
  // and instead update all clients to use the singleton instance directly
  const getCurrentRoute = routerInstance.getCurrentRoute.bind(routerInstance);
  const getRouteForPath = routerInstance.getRouteForPath.bind(routerInstance);
  const initializeRouteFromUrl =
      routerInstance.initializeRouteFromUrl.bind(routerInstance);
  const resetRouteForTesting =
      routerInstance.resetRouteForTesting.bind(routerInstance);
  const getQueryParameters =
      routerInstance.getQueryParameters.bind(routerInstance);
  const lastRouteChangeWasPopstate =
      routerInstance.lastRouteChangeWasPopstate.bind(routerInstance);
  const navigateTo = routerInstance.navigateTo.bind(routerInstance);
  const navigateToPreviousRoute =
      routerInstance.navigateToPreviousRoute.bind(routerInstance);

  return {
    Route: Route,            // The Route class definition.
    Router: Router,          // The Router class definition.
    router: routerInstance,  // the singleton.
    routes: routes,
    RouteObserverBehavior: RouteObserverBehavior,
    getRouteForPath: getRouteForPath,
    initializeRouteFromUrl: initializeRouteFromUrl,
    resetRouteForTesting: resetRouteForTesting,
    getCurrentRoute: getCurrentRoute,
    getQueryParameters: getQueryParameters,
    lastRouteChangeWasPopstate: lastRouteChangeWasPopstate,
    navigateTo: navigateTo,
    navigateToPreviousRoute: navigateToPreviousRoute,
  };
});
<link rel="import" href="edge://resources/edge_html/polymer.html">

<link rel="import" href="edge://resources/edge_elements/hidden_style_css.html">
<link rel="import" href="edge://resources/edge_elements/icons.html">
<link rel="import" href="edge://resources/edge_html/search_highlight_utils.html">
<link rel="import" href="edge://resources/edge_html/promise_resolver.html">
<link rel="import" href="edge://resources/polymer/v1_0/iron-a11y-announcer/iron-a11y-announcer.html">
<link rel="import" href="edge://resources/polymer/v1_0/iron-icon/iron-icon.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-button/paper-button.html">
<link rel="import" href="../about_page/about_page.html">
<link rel="import" href="../basic_page/basic_page.html">
<link rel="import" href="../i18n_setup.html">
<link rel="import" href="../prefs/prefs.html">
<link rel="import" href="../route.html">
<link rel="import" href="../settings_shared_css.html">
<link rel="import" href="../settings_vars_css.html">

<dom-module id="settings-main">
  <template>
    <style include="edge-hidden-style">
      #overscroll {
        margin-top: 64px;
      }

      .showing-subpage ~ #overscroll {
        display: none;
      }

      #noSearchResults {
        margin-top: 40px;
        margin-left: 40px;
        margin-right: 40px;
      }

      #noSearchResults > h1 {
        @apply --edge-title-text;
      }
    </style>
    <div id="noSearchResults" hidden$="[[!showNoResultsFound_]]">
      <h1>$i18n{searchNoResults}</h1>
    </div>
    <template is="dom-if" if="[[showPages_.settings]]">
      <settings-basic-page prefs="{{prefs}}"
          page-visibility="[[pageVisibility]]"
          show-android-apps="[[showAndroidApps]]"
          have-play-store-app="[[havePlayStoreApp]]"
          on-subpage-expand="onSubpageExpand_"
          in-search-mode="[[inSearchMode_]]"
          advanced-toggle-expanded="{{advancedToggleExpanded}}">
      </settings-basic-page>
    </template>
    <div id="overscroll" style="padding-bottom: [[overscroll_]]px"></div>
  </template>
  <script src="settings_main.js"></script>
  <script src="../search_settings.js"></script>
</dom-module>
<script src="edge://resources/edge_js/load_time_data.js"></script>
<script src="strings.js"></script>
<link rel="import" href="edge://resources/edge_html/cr.html">
<script src="profile_info_browser_proxy.js"></script>
// Copyright 2016 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @fileoverview A helper object used from the the People section to get the
 * profile info, which consists of the profile name and icon. Used for both
 * Chrome browser and ChromeOS.
 */
cr.exportPath('settings');

/**
 * An object describing the profile.
 * @typedef {{
 *   name: string,
 *   iconUrl: string,
 *   accountType: string,
 *   browserAddPersonEnabled: boolean,
 *   profileForcedSignOut: boolean,
 * }}
 */
settings.ProfileInfo;

cr.define('settings', function() {
  /** @interface */
  class ProfileInfoBrowserProxy {
    /**
     * Returns a Promise for the profile info.
     * @return {!Promise<!settings.ProfileInfo>}
     */
    getProfileInfo() {}

    /**
     * Returns a Promise for the non-active profile list.
     * @return {!Promise<!Array<settings.ProfileInfo>>}
     */
    getNonActiveProfiles() {}

    /**
     * Opens profile settings for the specified profile.
     */
    openProfileSettings(profilePath) {}

    /**
     * Requests the profile stats count. The result is returned by the
     * 'profile-stats-count-ready' WebUI listener event.
     */
    getProfileStatsCount() {}
  }

  /**
   * @implements {ProfileInfoBrowserProxy}
   */
  class ProfileInfoBrowserProxyImpl {
    /** @override */
    getProfileInfo() {
      return cr.sendWithPromise('getProfileInfo');
    }

    /** @override */
    getNonActiveProfiles() {
      return cr.sendWithPromise('getNonActiveProfiles');
    }

    /** @override */
    openProfileSettings(profilePath) {
      chrome.send('launchProfileSettings', [profilePath]);
    }

    /** @override */
    getProfileStatsCount() {
      chrome.send('getProfileStatsCount');
    }
  }

  cr.addSingletonGetter(ProfileInfoBrowserProxyImpl);

  return {
    ProfileInfoBrowserProxyImpl: ProfileInfoBrowserProxyImpl,
  };
});
<link rel="import" href="edge://resources/edge_elements/paper_button_style_css.html">
<link rel="import" href="edge://resources/edge_elements/search_highlight_style_css.html">
<link rel="import" href="edge://resources/edge_elements/shared_vars_css.html">
<link rel="import" href="edge://resources/edge_elements/shared_style_css.html">
<link rel="import" href="settings_icons_css.html">
<link rel="import" href="settings_vars_css.html">


<!-- Common styles for Material Design settings. -->
<dom-module id="settings-shared">
  <template>
    <style include="settings-icons paper-button-style edge-shared-style search-highlight-style">
      /* Prevent action-links from being selected to avoid accidental
       * selection when trying to click it. */
      a[is=action-link] {
        user-select: none;
      }

      h1 {
        @apply --edge-title-text;
        align-items: center;
        align-self: flex-start;
        color: var(--edge-black);
        display: flex;
        margin-block-start: 0;
        margin-block-end: 0;
        padding: 32px 10px 16px 10px;
      }

      h1.first {
        padding-top: 34px;
      }

      h1.about {
        padding-bottom: 0;
      }

      /* Use <h2> as the "sub-header" mentioned in the UX design docs. */
      h2 {
        @apply --edge-regular-text;
        align-items: center;
        align-self: flex-start;
        color: var(--edge-black);
        display: flex;
        margin: 0;
        padding-bottom: 12px;
        padding-top: 20px;
      }

      iron-icon {
        flex-shrink: 0;  /* Prevent distortion of icons in cramped UI. */
        margin-top: 12px;
      }

      iron-icon[icon='edge:check'] {
       --iron-icon-fill-color: var(--google-green-500);
      }

      iron-icon.policy {
        margin-inline-end: var(--edge-controlled-by-spacing);
      }

      iron-list {
        --iron-list-items-container: {
          /* Text selection in an iron-list is problematic because the items are
           * reused. The result is the selection happens somewhat arbitrarily.
           * Add a |risk-selection| attribute to enabled selection in an
           * iron-list. */
          user-select: none;
        }
      }

      iron-list[risk-selection] {
        --iron-list-items-container: {
          /* On short lists where selection is likely desired, we'll risk having
           * text selection enabled. If the list is short enough that items are
           * not actually reused, the bugs with selection are not evident. */
          user-select: text;
        }
      }

      .separator + paper-icon-button-light {
        margin-inline-start: var(--edge-icon-ripple-margin);
      }

      neon-animatable {
        display: flex;
        flex-direction: column;
      }

      paper-button {
        margin-top: 4px;
      }

      /* For "Advanced" toggle button. */
      paper-button[toggles][active] {
        background-color: var(--edge-grey-rest);
      }

      paper-button.restart-button {
        margin-inline-end: 8px;
        background-color: var(--edge-grey-rest);
      }

      paper-button.restart-button:hover {
        margin-inline-end: 8px;
        background-color: var(--edge-grey-hover);
      }

      paper-button.restart-button:active {
        margin-inline-end: 8px;
        background-color: var(--edge-grey-pressed);
      }

      paper-button.nav-button {
        margin-bottom: 0;
        margin-top: 0;
      }

      paper-ripple {
        --paper-ripple-opacity: 0;
      }

      edge-paper-icon-button {
        margin-top: 2px;
      }

      md-select {
        margin-top: 4px;
      }

      /* Special case for buttons inside of toggle-buttons. */
      .settings-box settings-toggle-button paper-button:last-of-type {
        margin-inline-end: 16px;
      }

      /* Space out multiple buttons in the same row. */
      .settings-box paper-button + paper-button {
        margin-inline-start: 16px;
      }

      span ~ a {
        margin-inline-start: 4px;
      }

      a[href] {
        border-bottom: solid 1px var(--edge-text-blue-rest);
        color: var(--edge-text-blue-rest);
        text-decoration: none;
      }

      a[href]:hover {
        border-bottom: solid 2px var(--edge-text-blue-rest);
      }

      a[href]:focus {
        border-bottom: solid 2px var(--edge-black);
        outline: none;
      }

      a[href].no-link {
        border-bottom: none;
      }

      /* For elements that are simple out-links but don't look like anchors. */
      .inherit-color {
        color: inherit !important;
      }

      .primary-toggle {
        color: var(--edge-secondary-text-color);
        font-weight: 500;
      }

      .primary-toggle[checked] {
        color: var(--edge-blue-rest);
      }

      cr-link-row {
        @apply --edge-primary-text;
        --cr-link-row-icon-width: 40px;
        border-top: var(--settings-separator-line);
      }

      controlled-radio-button,
      cr-radio-button {
        @apply --edge-regular-text;
        min-height: var(--settings-row-min-height);
      }

      cr-radio-group {
        width: 100%;
      }

      cr-radio-group:focus {
        background-color: var(--edge-grey-rest);
        outline: none;
      }

      /* See also: .no-min-width below. */
      .text-elide {
        @apply --edge-text-elide;
      }

      /* By default, flexbox children have min-width calculated to be the width
       * of the content. However, in some cases we might want to allow the
       * width to be smaller than the content (i.e. for long text to ellipsis).
       * In such cases this class should be applied.
       * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=1108514#c5) */
      .no-min-width {
        min-width: 0;
      }

      .header-aligned-button {
        margin-top: 12px;  /* Align paper-button with <h2>. */
      }

      /* A list-frame is an outer container for list-items. It is intended to be
       * outside of a settings-box. A list-frame is likely to follow a
       * settings box. */
      .list-frame {
        @apply --settings-list-frame-padding;
        align-items: center;
        display: block;
      }

      /* A list-item is intended to be contained within a list-frame. The list
       * frame will set up the initial start margin. */
      .list-item {
        display: flex;
        min-height: var(--settings-row-min-height);
        padding: 0;
      }

      /* A thin separator line under a list item. */
      .list-item.underbar {
        border-bottom: var(--settings-separator-line);
      }

      .list-item.selected {
        font-weight: 500;
      }

      /* The middle part (horizontally) of a list item. */
      .list-item .middle {
        flex: 1;
        margin: 8px 16px;
      }

      /* The start (left in LTR) part (horizontally) of a list item. */
      .list-item > .start {
        flex: 1;
      }

      .list-item > label span[disabled] {
        opacity: var(--settings-disabled-opacity);
      }

      /* This button has no ink ripple. */
      .list-button[is='action-link'] {
        align-items: center;
        display: flex;
        flex: 1;
        font-weight: 500;
        min-height: inherit;
      }

      /* A row with two lines of text. Often the lower line will be .secondary.
       */
      .two-line {
        min-height: var(--settings-row-two-line-min-height);
      }

      /* A row with three lines of text. Often the lower lines will be
       * .secondary. */
      .three-line {
        min-height: var(--settings-row-three-line-min-height);
      }

      /* A settings-box is a horizontal row of text or controls within a
       * setting section (page or subpage). */
      .settings-box {
        @apply --edge-section;
      }

      .settings-box.two-line {
        min-height: var(--settings-row-two-line-min-height);
      }

      .settings-box.three-line {
        min-height: var(--settings-row-three-line-min-height);
      }

      /* We use an explicit tag to remove the top border, rather than a
       * :first-of-type modifier. This is a conscious choice, please consult
       * with dbeam@ or dschuyler@ prior to changing it. */
      .settings-box.first,
      .settings-box.continuation {
        border-top: none;
      }

      h2.first {
        padding-top: 0;
      }

      .settings-box.block {
        display: block;
      }

      /* A start-aligned column. */
      .single-column {
        align-items: flex-start;
        flex-direction: column;
        justify-content: center;
      }

      /* A settings-box with no height other than the separator line. */
      .settings-box.line-only {
        min-height: 0;
      }

      /* A settings-box that is embedded in another settings-box (e.g. a control
       * that is associated with a toggle button). */
      .settings-box.embedded {
        padding-inline-start: var(--settings-box-row-indent);
      }

      /* The lower line of text in a two-line row. */
      .secondary {
        @apply --edge-secondary-text;
        padding-top: 4px;
        font-size: 85.714%;
      }

      .start {
        @apply --edge-primary-text;
        margin-top: 10px;
      }

      .label {
        @apply --edge-primary-text;
      }

      .middle {
        @apply --edge-primary-text;
        margin-top: 10px;
      }

      /* The |:empty| CSS selector only works when there is no whitespace.
       * E.g. <div>[[foo]]</div> will be |:empty| when foo == ""; and
       * <div> [[foo]] </div> will not be |:empty| when foo == "". Ensure there
       * is no extra whitespace when the contents of .secondary may be "".
       */
      .secondary:empty {
        margin: 0;
        padding: 0;
      }

      /* The middle part (horizontally) of a row. */
      .settings-box .middle {
        align-items: center;
        flex: auto;
        padding-inline-start: 16px;
      }

      .settings-box .middle.two-line,
      .settings-box .start.two-line {
        display: flex;
      }

      /* The start (left in LTR) part (horizontally) of a row. */
      .settings-box .start {
        align-items: center;
        flex: auto;
      }

      /* For grouping elements with common flex options. */
      .settings-row {
        align-items: center;
        display: flex;
        flex-direction: row;
        max-width: 100%;
        min-width: 0;  /* Workaround for text elision in sub-elements. */
      }

      .no-outline {
        background: none;
        outline: none;
      }

      /* Prevent icon-button's ripples from fighting with potential scrollbars.
       * Also apply to all iron-lists to align the buttons across them all.*/
      [scrollable],
      iron-list,
      .list-item {
        --edge-paper-icon-button-margin: {
          margin-inline-end: 0;
          margin-inline-start: var(--edge-icon-button-margin-start);
        };
      }

      /* Helper for a list frame to automatically avoid the separator line. */
      .vertical-list > *:not(:first-of-type) {
        border-top: var(--settings-separator-line);
      }

      /* The separator a vertical line like a horizontal rule <hr> tag, but goes
       * the other way. An example is near the |sign out| button on the People
       * settings. */
      .separator {
        border-inline-start: 1px solid var(--edge-border-rest);
        flex-shrink: 0;
        /* Match paper-button's default height. */
        height: 32px;
        margin: 0 16px;
      }

      .favicon-image {
        background-repeat: no-repeat;
        background-size: contain;
        height: 16px;
        width: 16px;
      }

      .column-header {
        color: var(--edge-text-grey-rest);
        font-size: inherit;
        font-weight: 400;
      }

      /* Error message that appears in a toast to indicate the success or
       * failure of an operation. An example is when adding a printer. */
      .error-message {
        color: white;
        font: 13px;
        padding-bottom: 15px;
        padding-top: 15px;
        text-align: center;
        white-space: normal;
      }

      /* URLs should always be displayed using a LTR embedding - see
       * https://url.spec.whatwg.org/#url-rendering. */
      .url-directionality {
        direction: ltr;
        unicode-bidi: embed;
      }

      .sub-section {
        background: var(--edge-content-grey);
        width: 100%;
        height: var(--card-height);
        margin-bottom: 40px;
      }

      .sub-card {
        background: var(--edge-content-grey);
        width: 100%;
        height: var(--card-height);
        border-radius: 4px;
        padding: 6px 0 6px 0;
        border: 1px solid var(--edge-border-rest)
      }
    </style>
  </template>
</dom-module>
<link rel="import" href="../i18n_setup.html">
<link rel="import" href="edge://resources/edge_html/cr.html">
<script src="sync_browser_proxy.js"></script>
// Copyright 2016 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @fileoverview A helper object used from the the People section to get the
 * status of the sync backend and user preferences on what data to sync. Used
 * for both Chrome browser and ChromeOS.
 */
cr.exportPath('settings');

/**
 * @typedef {{fullName: (string|undefined),
 *            givenName: (string|undefined),
 *            email: string,
 *            avatarImage: (string|undefined)}}
 * @see chrome/browser/ui/webui/settings/people_handler.cc
 */
settings.StoredAccount;

/**
 * @typedef {{childUser: (boolean|undefined),
 *            disabled: (boolean|undefined),
 *            disabledByUser: (boolean|undefined),
 *            domain: (string|undefined),
 *            hasError: (boolean|undefined),
 *            hasUnrecoverableError: (boolean|undefined),
 *            managed: (boolean|undefined),
 *            setupInProgress: (boolean|undefined),
 *            signedIn: (boolean|undefined),
 *            signedInUsername: (string|undefined),
 *            signinAllowed: (boolean|undefined),
 *            statusAction: (!settings.StatusAction),
 *            statusText: (string|undefined),
 *            supervisedUser: (boolean|undefined),
 *            syncSystemEnabled: (boolean|undefined)}}
 * @see chrome/browser/ui/webui/settings/people_handler.cc
 */
settings.SyncStatus;


/**
 * Must be kept in sync with the return values of getSyncErrorAction in
 * chrome/browser/ui/webui/settings/people_handler.cc
 * @enum {string}
 */
settings.StatusAction = {
  NO_ACTION: 'noAction',             // No action to take.
  REAUTHENTICATE: 'reauthenticate',  // User needs to reauthenticate.
  SIGNOUT_AND_SIGNIN:
      'signOutAndSignIn',               // User needs to sign out and sign in.
  UPGRADE_CLIENT: 'upgradeClient',      // User needs to upgrade the client.
  ENTER_PASSPHRASE: 'enterPassphrase',  // User needs to enter passphrase.
  CONFIRM_SYNC_SETTINGS:
      'confirmSyncSettings',  // User needs to confirm sync settings.
};

/**
 * The state of sync. This is the data structure sent back and forth between
 * C++ and JS. Its naming and structure is not optimal, but changing it would
 * require changes to the C++ handler, which is already functional.
 * @typedef {{
 *   appsEnforced: boolean,
 *   appsRegistered: boolean,
 *   appsSynced: boolean,
 *   autofillEnforced: boolean,
 *   autofillRegistered: boolean,
 *   autofillSynced: boolean,
 *   bookmarksEnforced: boolean,
 *   bookmarksRegistered: boolean,
 *   bookmarksSynced: boolean,
 *   encryptAllData: boolean,
 *   encryptAllDataAllowed: boolean,
 *   enterGooglePassphraseBody: (string|undefined),
 *   enterPassphraseBody: (string|undefined),
 *   extensionsEnforced: boolean,
 *   extensionsRegistered: boolean,
 *   extensionsSynced: boolean,
 *   fullEncryptionBody: string,
 *   historySyncPolicyEnabled: boolean,
 *   passphrase: (string|undefined),
 *   passphraseRequired: boolean,
 *   passphraseTypeIsCustom: boolean,
 *   passwordsEnforced: boolean,
 *   passwordsRegistered: boolean,
 *   passwordsSynced: boolean,
 *   paymentsIntegrationEnabled: boolean,
 *   preferencesEnforced: boolean,
 *   preferencesRegistered: boolean,
 *   preferencesSynced: boolean,
 *   setNewPassphrase: (boolean|undefined),
 *   syncAllDataTypes: boolean,
 *   tabsEnforced: boolean,
 *   tabsRegistered: boolean,
 *   tabsSynced: boolean,
 *   themesEnforced: boolean,
 *   themesRegistered: boolean,
 *   themesSynced: boolean,
 *   typedUrlsEnforced: boolean,
 *   typedUrlsRegistered: boolean,
 *   typedUrlsSynced: boolean,
 * }}
 */
settings.SyncPrefs;

/**
 * @enum {string}
 */
settings.PageStatus = {
  SPINNER: 'spinner',                     // Before the page has loaded.
  CONFIGURE: 'configure',                 // Preferences ready to be configured.
  TIMEOUT: 'timeout',                     // Preferences loading has timed out.
  DONE: 'done',                           // Sync subpage can be closed now.
  PASSPHRASE_FAILED: 'passphraseFailed',  // Error in the passphrase.
};

cr.define('settings', function() {
  /**
   * Key to be used with localStorage.
   * @type {string}
   */
  const PROMO_IMPRESSION_COUNT_KEY = 'signin-promo-count';

  /** @interface */
  class SyncBrowserProxy {
    // 
    /**
     * Starts the signin process for the user. Does nothing if the user is
     * already signed in.
     */
    startSignIn() {}

    /**
     * Signs out the signed-in user.
     * @param {boolean} deleteProfile
     */
    signOut(deleteProfile) {}

    /**
     * Opens the multi-profile user manager.
     */
    manageOtherPeople() {}

    /**
     * @return {number} the number of times the sync account promo was shown.
     */
    getPromoImpressionCount() {}

    /**
     * Increment the number of times the sync account promo was shown.
     */
    incrementPromoImpressionCount() {}

    // 

    // 

    /**
     * Gets the current sync status.
     * @return {!Promise<!settings.SyncStatus>}
     */
    getSyncStatus() {}

    /**
     * Gets a list of stored accounts.
     * @return {!Promise<!Array<!settings.StoredAccount>>}
     */
    getStoredAccounts() {}

    /**
     * Function to invoke when the sync page has been navigated to. This
     * registers the UI as the "active" sync UI so that if the user tries to
     * open another sync UI, this one will be shown instead.
     */
    didNavigateToSyncPage() {}

    /**
     * Function to invoke when leaving the sync page so that the C++ layer can
     * be notified that the sync UI is no longer open.
     * @param {boolean} didAbort
     */
    didNavigateAwayFromSyncPage(didAbort) {}

    /**
     * Sets whether the user wants Sync to be enabled or not
     * @param {boolean} isSyncEnabled
     */
    setSyncEnabled(isSyncEnabled) {}

    /**
     * Sets which types of data to sync.
     * @param {!settings.SyncPrefs} syncPrefs
     * @return {!Promise<!settings.PageStatus>}
     */
    setSyncDatatypes(syncPrefs) {}

    /**
     * Sets the sync encryption options.
     * @param {!settings.SyncPrefs} syncPrefs
     * @return {!Promise<!settings.PageStatus>}
     */
    setSyncEncryption(syncPrefs) {}

    /**
     * Start syncing with an account, specified by its email.
     * |isDefaultPromoAccount| is true if |email| is the email of the default
     * account displayed in the promo.
     * @param {string} email
     * @param {boolean} isDefaultPromoAccount
     */
    startSyncingWithEmail(email, isDefaultPromoAccount) {}

    /**
     * Opens the Google Activity Controls url in a new tab.
     */
    openActivityControlsUrl() {}

    /**
     * Function to invoke when the unified consent toggle state changes, to
     * notify the C++ layer.
     * @param {boolean} toggleChecked
     */
    unifiedConsentToggleChanged(toggleChecked) {}

    /**
     * Tell the handler that the user navigated to the sync settings page
    */
   onNavigateToSyncSettingsPage() {}

    /**
     * Tell the handler that the user navigated to the profile settings page.
     */
    onNavigateToProfileSettingsPage() {}

    /**
     * Takes in a |syncStatus| object and return the mapping from |syncStatus|
     * to the state of the sync engine that the UI will respond to.
     * @param {?settings.SyncStatus} syncStatus
     * @return {!string}
     */
    getUIStateFromStatus(syncStatus) {}
  }

  /**
   * @implements {settings.SyncBrowserProxy}
   */
  class SyncBrowserProxyImpl {
    // 
    /** @override */
    startSignIn() {
      chrome.send('SyncSetupStartSignIn');
    }

    /** @override */
    signOut(deleteProfile) {
      chrome.send('SyncSetupSignout', [deleteProfile]);
    }

    /** @override */
    manageOtherPeople() {
      chrome.send('SyncSetupManageOtherPeople');
    }

    /** @override */
    getPromoImpressionCount() {
      return parseInt(
                 window.localStorage.getItem(PROMO_IMPRESSION_COUNT_KEY), 10) ||
          0;
    }

    /** @override */
    incrementPromoImpressionCount() {
      window.localStorage.setItem(
          PROMO_IMPRESSION_COUNT_KEY,
          (this.getPromoImpressionCount() + 1).toString());
    }

    // 
    // 

    /** @override */
    getSyncStatus() {
      return cr.sendWithPromise('SyncSetupGetSyncStatus');
    }

    /** @override */
    getStoredAccounts() {
      return cr.sendWithPromise('SyncSetupGetStoredAccounts');
    }

    /** @override */
    didNavigateToSyncPage() {
      chrome.send('SyncSetupShowSetupUI');
    }

    /** @override */
    didNavigateAwayFromSyncPage(didAbort) {
      chrome.send('SyncSetupDidClosePage', [didAbort]);
    }

    /** @override */
    setSyncEnabled(isSyncEnabled) {
      chrome.send(
        'SetSyncEnabled', [isSyncEnabled]);
    }

    /** @override */
    setSyncDatatypes(syncPrefs) {
      return cr.sendWithPromise(
          'SyncSetupSetDatatypes', JSON.stringify(syncPrefs));
    }

    /** @override */
    setSyncEncryption(syncPrefs) {
      return cr.sendWithPromise(
          'SyncSetupSetEncryption', JSON.stringify(syncPrefs));
    }

    /** @override */
    startSyncingWithEmail(email, isDefaultPromoAccount) {
      chrome.send(
          'SyncSetupStartSyncingWithEmail', [email, isDefaultPromoAccount]);
    }

    /** @override */
    openActivityControlsUrl() {
      chrome.metricsPrivate.recordUserAction(
          'Signin_AccountSettings_GoogleActivityControlsClicked');
    }

    /** @override */
    unifiedConsentToggleChanged(toggleChecked) {
      chrome.send('UnifiedConsentToggleChanged', [toggleChecked]);
    }

    /** @override */
    onNavigateToSyncSettingsPage() {
      chrome.send(
        'OnNavigateToSyncSettingsPage');
    }

    /** @override */
    onNavigateToProfileSettingsPage() {
      chrome.send('OnNavigateToProfileSettingsPage');
    }

    /** @override */
    getUIStateFromStatus(syncStatus) {
      // We have 7 states:
      //   - Signed out, sync disabled.
      //   - Signed in, sync enabled.
      //   - Signed in, sync disabled by choice.
      //   - Signed in, sync disabled by admin.
      //   - Signed in, sync disabled because AAD is disabled.
      //   - Signed in, sync disabled by unrecoverable error.
      //   - Signed in, sync disabled by recoverable error.
      // Return a string for each state and we will respond to it in the UI.
      if (!syncStatus || !syncStatus.signedIn) {
        return 'sync-disabled-no-signin';
      }

      // Sync is disabled, this takes precidence over error. So the state
      // will never be disabled and error.
      if (syncStatus.disabled) {
        // When AAD sync is enabled remove check for AAD above and return
        // 'sync-disabled-by-admin'.
        if (syncStatus.disabledForAccountType) {
          return 'sync-disabled-by-aad';
        } else if (syncStatus.managed) {
          return 'sync-disabled-by-admin';
        }
      }

      if (syncStatus.disabledByUser) {
        return 'sync-disabled-by-choice';
      }

      // Signed in and not disabled, sync engine is on. Check for errors.
      if (syncStatus.hasError) {
        if (syncStatus.hasUnrecoverableError) {
          return 'sync-problem-unrecoverable';
        }

        return 'sync-problem-recoverable';
      }

      // Signed in, not disabled, and no error. Green sync state.
      return 'syncing';
    }
  }

  cr.addSingletonGetter(SyncBrowserProxyImpl);

  return {
    SyncBrowserProxy: SyncBrowserProxy,
    SyncBrowserProxyImpl: SyncBrowserProxyImpl,
  };
});
<link rel="import" href="edge://resources/edge_html/polymer.html">
<link rel="import" href="edge://resources/edge_html/cr/ui.html">
<link rel="import" href="edge://resources/edge_html/util.html">
<link rel="import" href="/force_signin_more_profiles_control.html">
<link rel="import" href="/force_signin_current_profile_control.html">
<link rel="import" href="../settings_main/settings_main.html">
<link rel="import" href="profile_info_browser_proxy.html">

<style include="edge-hidden-style">
  managed-header {
    background-color: var(--edge-card-color);
    display: flex;
    position: relative;
    z-index: 2;
  }

  #force_signin_background {
      background-color: var(--edge-page-host_-_background-color);
  }

</style>
<body id="force_signin_background">
  <div style="
        font-family: system-ui, sans-serif;
        padding: 24px;
      ">
    <force-signin-profile-control></force-signin-profile-control>
    <force-signin-more-profiles-control></force-signin-more-profiles-control>
  </div>
</body>
<link rel="import" href="edge://resources/edge_html/i18n_behavior.html">
<link rel="import"
  href="edge://resources/edge_html/web_ui_listener_behavior.html">
<link rel="import"
  href="edge://resources/polymer/v1_0/paper-button/paper-button.html">
<link rel="import" href="../i18n_setup.html">
<link rel="import" href="../settings_shared_css.html">

<link rel="import" href="profile_info_browser_proxy.html">

<dom-module id="force-signin-more-profiles-control">
  <template>
    <style include="settings-shared">
      :host {
        --card-height: 90px;
        --shown-avatar-size: 62px;
      }

      .card {
        background: var(--edge-card-color);
        border-radius: var(--edge-card-border-radius);
        color: var(--edge-primary-text-color);
        display: flex;
        font-family: system-ui, sans-serif;
        height: var(--card-height);
        margin-bottom: 8px;
        width: 100%;
        @apply --edge-card-elevation;
      }

      .avatar-container {
        align-items: center;
        display: flex;
        padding-inline-start: 20px;
      }

      .account-icon {
        border: 1px solid var(--edge-light-border-rest);
        border-radius: 50%;
        height: var(--shown-avatar-size);
        width: var(--shown-avatar-size);
      }

      .description {
        display: flex;
        flex-direction: column;
        justify-content: center;
        overflow: hidden;
        padding-inline-end: 20px;
        padding-inline-start: 20px;
      }

      .description> :first-child {
        font-family: system-ui, sans-serif;
        font-size: 18px;
        font-weight: bold;
        line-height: 24px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .card .actions {
        align-items: center;
        display: flex;
        flex-grow: 1;
        justify-content: flex-end;
        margin-inline-end: 20px;
      }

      .wide {
        min-width: 100px;
      }

      h1 {
        padding-left: 0px;
      }
    </style>
    <template is="dom-if" if="[[areProfiles_(profiles_)]]">
      <h1>$i18n{msMoreProfileTitle}</h1>
    </template>
    <template is="dom-repeat" items="[[profiles_]]">
      <div class="card">
        <div class="avatar-container">
          <img class="account-icon" alt="" src="[[item.iconUrl]]"></img>
        </div>
        <div class="description">
          <span>[[item.name]]</span>
          <span>[[getProfileSubtext_(item.username)]]</span>
        </div>
        <div class="actions">
          <paper-button tabindex="0" id="manageProfileButton"
            class="light-outline-button wide" disabled$="[[disableButtons]]"
            on-click="onProfileTap_" aria-label$="[[buttonAriaLabel_(item)]]">
            $i18n{msForceSigninSwitchProfile}
          </paper-button>
        </div>
      </div>
    </template>
  </template>
  <script src="force_signin_more_profiles_control.js"></script>
</dom-module>
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @fileoverview
 * 'force-signin-more-profiles-control' is the force signin page component that
 * shows the non-active profiles.
 */
(function(){
Polymer({
  is: 'force-signin-more-profiles-control',

  behaviors: [
    WebUIListenerBehavior, I18nBehavior
  ],

  properties: {
    profiles_: Array,

    // Passed in from people_page. True if the 'manage' button should be
    // disabled.
    disableButtons: Boolean,
  },

  /** @override */
  attached: function () {
    const profileInfoProxy = settings.ProfileInfoBrowserProxyImpl.getInstance();
    profileInfoProxy.getNonActiveProfiles().then(
      this.handleAllNonActiveProfile_.bind(this)
    );
    this.addWebUIListener(
      'non-active-profiles-changed',
      this.handleAllNonActiveProfile_.bind(this)
    );
  },

  /**
   * Handler for when the list of non-active browser profiles is updated.
   * @private
   */
  handleAllNonActiveProfile_: function(profiles) {
    this.profiles_ = profiles;
  },

  /**
   * Check if there are profiles to display.
   * @private
   */
  areProfiles_: function(profiles) {
    return !!profiles && profiles.length > 0;
  },

  /**
   * Get the text that should be shown under the profile's name.
   * @private
   */
  getProfileSubtext_: function(username) {
    return username ? username : "";
  },

  /**
   * Handler for tap of the manage profile button.
   * @private
   */
  onProfileTap_: function(e) {
    const profileInfoProxy = settings.ProfileInfoBrowserProxyImpl.getInstance();
    profileInfoProxy.openProfileSettings(e.model.item.path);
  },

  /**
   * Get the accessible text for profile manage button.
   * @private
   */
  buttonAriaLabel_: function(item) {
    return loadTimeData.getString("msForceSigninSwitchProfile");
  },
});
})();
<link rel="import" href="edge://resources/edge_html/i18n_behavior.html">
<link rel="import"
  href="edge://resources/edge_html/web_ui_listener_behavior.html">
<link rel="import"
  href="edge://resources/polymer/v1_0/paper-button/paper-button.html">
<link rel="import" href="profile_info_browser_proxy.html">
<link rel="import" href="profile_control.html">
<link rel="import" href="sync_browser_proxy.html">
<link rel="import" href="../i18n_setup.html">
<link rel="import" href="../icons.html">
<link rel="import" href="../route.html">
<link rel="import" href="../settings_shared_css.html">
<link rel="import" href="manage_profile.html">
<link rel="import"
  href="edge://resources/edge_components/managed_header/managed_header.html">

<dom-module id="force-signin-profile-control">
  <template>
    <style include="settings-shared">
      :host {
        --shown-avatar-size: 62px;
        --sync-icon-size: 16px;
      }

      .profile-control-wrapper {
        background-color: var(--edge-card-color);
        border-radius: var(--edge-card-border-radius);
        display: flex;
        flex-direction: row;
        font-family: system-ui, sans-serif;
        margin-bottom: 8px;
        min-height: 90px;
        padding: 0;
        @apply --edge-card-elevation;
      }

      .avatar-container {
        align-self: flex-start;
        border: 1px #666 solid;
        border-radius: 50%;
        display: flex;
        margin-bottom: 20px;
        margin-inline-start: 20px;
        margin-top: 20px;
        position: relative;
      }

      .account-icon {
        border-radius: 50%;
        height: var(--shown-avatar-size);
        width: var(--shown-avatar-size);
      }

      #sync-icon-container {
        align-items: center;
        background: #666;
        border-radius: 50%;
        bottom: -1px;
        display: flex;
        height: var(--sync-icon-size);
        justify-content: center;
        position: absolute;
        right: -1px;
        width: var(--sync-icon-size);
      }

      #sync-icon-container.syncing {
        background: rgb(16, 124, 16);
      }

      #sync-icon-container.sync-problem-recoverable {
        background: var(--edge-error-rest);
      }

      #sync-icon-container iron-icon {
        fill: white;
        height: calc(var(--sync-icon-size) * 0.75);
        margin-top: 0;
        width: calc(var(--sync-icon-size) * 0.75);
      }

      #sync-icon-container.syncing iron-icon {
        height: calc(var(--sync-icon-size));
        width: calc(var(--sync-icon-size));
      }

      .content-edit-wrapper {
        align-items: flex-start;
        display: flex;
        flex-grow: 1;
      }

      .profile-manager-wrapper {
        padding: 12px 20px 16px 20px;
        width: 100%;
      }

      #edit-module-header {
        font-size: 12px;
        line-height: 16px;
        margin-top: 0;
      }

      .profile-container {
        align-items: flex-start;
        align-self: stretch;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        justify-content: center;
        margin-bottom: 8px;
        margin-top: 8px;
        padding-inline-start: 22px;
      }

      .user-name {
        color: var(--edge-primary-text-color);
        font-size: 18px;
        font-weight: bold;
        line-height: 24px;
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .sync-status-text {
        font-size: 12px;
        line-height: 16px;
        margin-bottom: 6px;
        margin-top: 2px;
      }

      .button-container {
        align-items: center;
        align-self: stretch;
        display: flex;
        flex-direction: row;
        flex-grow: 1;
        flex-wrap: wrap;
        justify-content: flex-end;
        padding-inline-end: 20px;
      }

      #edit-profile-button {
        margin-inline-end: 8px;
      }

      #action-button {
        margin-inline-start: 8px;
      }

      .wide {
        min-width: 100px;
      }

      #my-account-button {
        background: transparent;
        border-bottom: 1px solid transparent;
        border-radius: 0;
        color: var(--edge-text-light-blue-rest);
        height: 16px;
        margin: 0;
        padding: 0;
      }

      #my-account-button.keyboard-focus {
        border-bottom: 2px solid;
        outline: none;
      }

      #my-account-button:hover {
        border-bottom: 1px solid var(--edge-text-light-blue-rest);
      }

      #my-account-button[disabled] {
        opacity: var(--edge-disabled-opacity);
      }

      @media only screen and (max-width : 640px) {
        .button-container {
          align-items: center;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          margin-bottom: 8px;
          margin-top: 8px;
          padding-inline-end: 16px;
          padding-inline-start: 16px;
        }

        #edit-profile-button {
          margin-inline-end: 0;
        }

        #action-button {
          margin-inline-start: 0;
        }
      }

      .header-wrapper {
        align-items: center;
        direction: row;
        display: flex;
        justify-content: space-between;
      }

      #add-profile-button {
        align-self: flex-end;
        background: none;
        margin: 0px 10px 12px 0px;
      }

      #add-profile-button:hover {
        background-color: var(--edge-grey-hover);
      }

      #add-profile-button:active {
        background-color: var(--edge-grey-pressed);
      }
    </style>
    <div id="managedBar">
      <style>
        #managedBar {
          border-top: 1px solid var(--cr-separator-color);
          color: var(--edge-primary-text-color);
          display: none;
          font-size: 0.75rem;

          align-items: center;
          display: flex;
          height: 36px;
          width: 100%;
          background-color: var(--edge-grey-rest);
          justify-content: center;
        }

        a[href] {
          color: var(--cr-link-color);
          text-decoration: none;
        }

        iron-icon {
          align-self: flex-start;
          flex-shrink: 0;
          height: 16px;
          padding-inline-end: 8px;
          width: 16px;
        }
      </style>
      <iron-icon icon="edge16:domain"></iron-icon>
      <div id="content">
        [[getManagedBannerTextHalf_("true")]]<b>[[profileName_]]</b>[[getManagedBannerTextHalf_("false")]]
      </div>
    </div>
    <div class="header-wrapper">
      <h1 class="first">[[getPeoplePageTitle_(showAddProfileModule_)]]</h1>
      <paper-button id="add-profile-button" on-click="onAddProfileTap_"
        disabled$="[[showAddProfileModule_]]"
        hidden="[[!addProfileEnabledPolicy_]]">
        <!--
              Plus symbol hard coded following guidance that not-frequently
              used SVGs should be included in files.
            -->
        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"
          style="padding-right: 8px; padding-left: 8px">
          <path
            d="M12 5.625V6.375H6.375V12H5.625V6.375H0V5.625H5.625V0H6.375V5.625H12Z">
          </path>
        </svg>
        $i18n{msPeoplePageAddProfile}
      </paper-button>
    </div>

    <template is="dom-if" if="[[showAddProfileModule_]]" restamp>
      <div class="profile-control-wrapper">
        <div class="avatar-container">
          <img id="account-icon" class="account-icon" alt=""
            src="[[addProfileIconUrl_]]">
          </img>
        </div>

        <div class="profile-manager-wrapper">
          <settings-manage-profile profile-name="[[profileName_]]"
            sync-status="[[syncStatus_]]"
            profile-icon-url="{{addProfileIconUrl_}}" profile-module-mode="add"
            show-profile-module="{{showAddProfileModule_}}">
          </settings-manage-profile>
        </div>
      </div>
    </template>

    <h1 class="first" hidden="[[!showAddProfileModule_]]">
      $i18n{msPeoplePageTitle}
    </h1>

    <div class="profile-control-wrapper" id="avatar-row">
      <div class="avatar-container">
        <img id="account-icon" class="account-icon" alt=""
          src="[[profileIconUrl_]]">
        </img>
      </div>
      <div class="content-edit-wrapper">
        <div class="profile-container">
          <span id="user-name" class="user-name">
            [[profileName_]]
          </span>
        </div>
        <div class="button-container">
          <paper-button id="action-button" disabled$="[[disableButtons]]"
            class="action-button wide"
            on-click="onActionButtonTap_" hidden=[[syncStatus_.signedIn]]>
            [[actionButtonText_(syncStatus_)]]
          </paper-button>
        </div>
      </div>
    </div>
  </template>
  <script src="force_signin_current_profile_control.js"></script>
</dom-module>
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @fileoverview
 * 'force-signin-profile-control' is the page that displays the force sign in
 * page. Also contains logic for controlling inline add a profile. The component
 * was modeled after the profile_control file.
 */
cr.exportPath('settings');

Polymer({
  is: 'force-signin-profile-control',
  behaviors: [WebUIListenerBehavior, I18nBehavior],
  properties: {
    /**
     * The current sync status, supplied by parent element.
     * @type {!settings.SyncStatus}
     */
    syncStatus_: {
      type: Object,
    },

    /**
     * The currently selected profile icon URL. May be a data URL.
     * @private
     */
    profileIconUrl_: String,

    /**
     * New profile icon URL. May be a data URL.
     * @private
     */
    addProfileIconUrl_: String,

    /**
     * The current profile name.
     * @private
     */
    profileName_: String,

    /**
     * True if the add profile module is being shown to the user.
     * @private
     */
    showAddProfileModule_: {
      type: Boolean,
      value: false,
      observer: 'showAddProfileModuleChanged_',
    },

    /**
     * Value of the BrowserAddPersonEnabled policy.
     * @private
     * */
    addProfileEnabledPolicy_: {
      type: Boolean,
      value: true,
    },

    /**
     * True if the add module is showing in the profile card. Supplied by
     * parent element.
     */
    showProfileModule: {
      type: Boolean,
      notify: true,
      observer: 'showProfileModuleChanged',
    },

    disableButtons: Boolean,
  },

  /** @private {?settings.SyncBrowserProxy} */
  syncBrowserProxy_: null,

  /** @override */
  attached: function () {
    const profileInfoProxy = settings.ProfileInfoBrowserProxyImpl.getInstance();
    profileInfoProxy.getProfileInfo().then(this.handleProfileInfo_.bind(this));
    this.addWebUIListener(
      'profile-info-changed', this.handleProfileInfo_.bind(this));

    this.syncBrowserProxy_ = settings.SyncBrowserProxyImpl.getInstance();
    this.syncBrowserProxy_.getSyncStatus().then(
      this.handleSyncStatus_.bind(this));
    this.addWebUIListener(
      'sync-status-changed', this.handleSyncStatus_.bind(this));
  },


  /**
   * Handler for when the sync state is pushed from the browser.
   * @param {?settings.SyncStatus} syncStatus
   * @private
   */
  handleSyncStatus_: function (syncStatus) {
    this.syncStatus_ = syncStatus;
  },


  /**
   * Handler for when the profile's icon and name is updated.
   * @private
   * @param {!settings.ProfileInfo} info
   */
  handleProfileInfo_: function (info) {
    this.profileName_ = info.name;
    this.profileIconUrl_ = info.iconUrl;
    this.addProfileEnabledPolicy_ = info.browserAddPersonEnabled;
  },

  /**
   * Returns the string for the action button in the profile card.
   * @return {string}
   * @private
   */
  actionButtonText_: function (syncStatus) {
    if (syncStatus.signedIn) {
      return loadTimeData.getString('msProfileSignOut');
    }

    return loadTimeData.getString('msProfileSignIn');
  },

  shouldHideSyncIcon_: function () {
    return !this.syncStatus_.signedIn || !!this.showProfileModule;
  },

  onAddProfileTap_: function () {
    this.showAddProfileModule_ = true;
  },

  showProfileModuleChanged: function (newVal) {
    // Only fire telemetry on showing module.
    if (newVal) {
      chrome.metricsPrivate.recordUserAction(
        'Settings_PeoplePage_AddProfileMode_Impression');
    }
  },

  /**
   * React to the add profile dialog visility changing. We use this to set
   * the focus back to a visible element after closed.
   * @private
   */
  showAddProfileModuleChanged_: function (newVal, oldVal) {
    if (!newVal && oldVal) {
      // Dialog closed so set focus on the add profile button.
      this.$$('#add-profile-button').focus();
    }
  },

  /**
   * Returns the class of the sync icon.
   * @return {string}
   * @private
   */
  getSyncIconStyle_: function (syncStatus) {
    // Logic has been pushed up to proxy but leave getter for CSS class style in
    // profile_control.html.
    return this.syncBrowserProxy_.getUIStateFromStatus(syncStatus);
  },

  /**
   * @return {string}
   * @private
   */
  getSyncIcon_: function (syncStatus) {
    // Two icon options - sync arrows for positive state and an X for all other
    // states.

    switch (this.getSyncIconStyle_(syncStatus)) {
      case 'syncing':
        return 'edge16:syncing';
      case 'sync-problem-unrecoverable':
      case 'sync-problem-recoverable':
      case 'sync-disabled-no-signin':
      case 'sync-disabled-by-aad':
      case 'sync-disabled-by-choice':
      case 'sync-disabled-by-admin':
        return 'edge:clear';
      default:
        return 'edge:clear';
    }
  },

  /** @private */
  onActionButtonTap_: function () {
    this.syncBrowserProxy_.startSignIn();
  },

  /** @private */
  onRemoveCurrentProfile_: function () {
    settings.navigateTo(settings.routes.DELETE_PROFILE);
  },

  getPeoplePageTitle_: function (showAddProfileModule) {
    return showAddProfileModule ?
      loadTimeData.getString('msManageProfileAddTitle') :
      loadTimeData.getString('msPeoplePageTitle');
  },

  getManagedBannerTextHalf_: function (firsthalf) {
    if (firsthalf == "true") {
      halfnumber = 0;
    }
    if (firsthalf == "false") {
      halfnumber = 1;
    }
    return loadTimeData.getString('msForceSigninManagedBar').split("$1")[halfnumber];
  },
});
// Copyright (C) Microsoft Corporation. All rights reserved.

const SERVER_URL =
    'wss://speech.platform.bing.com/consumer/speech/synthesize' +
    '/readaloud/edge/v1';
const MIME_CODEC = 'audio/mpeg';
const NORMAL_CLOSURE = 1000;
const ABNORMAL_CLOSURE = 1006;
const HEADER_LENGTH_BYTES = 2;
const MEDIA_DURATION_PLACEHOLDER_SECONDS = 60 * 30;

class AudioStreamer {
  constructor(
      onSourceReady, onWordBoundariesReceived, onPlaybackReady, onError,
      onBufferFull) {
    this._initializeState();

    this._serverUrl = null;
    this._onWordBoundariesReceived = onWordBoundariesReceived;
    this._onPlaybackReady = onPlaybackReady;
    this._onError = onError;
    this._onSourceReady = onSourceReady;
    this._onBufferFull = onBufferFull;
    const urlFunction = this._initializeUrl.bind(this);
    chrome.systemPrivate.getApiKey(urlFunction);
  }

  startStream(utterance, options) {
    this._mediaSource = new MediaSource();
    const mediaUrl = URL.createObjectURL(this._mediaSource);
    this._onSourceReady(mediaUrl);
    this._mediaSource.onsourceopen = this._handleSourceOpen.bind(this);

    // If there is an issue connecting to the service, an error will be thrown
    // here
    try {
      this._connection = new WebSocket(this._serverUrl);
    } catch(error) {
      const errorObj =
          ErrorHelper.createDefaultError(
              TelemetryHelper.ErrorEnum().CONNECTION_OPEN);
      errorObj.message = JSON.stringify(error);
      errorObj.source = document.URL;
      this._onError(
          errorObj,
          ErrorHelper.NETWORK_ERROR_CODE());
      return;
    }

    this._connection.onopen =
        this._connectionOpened.bind(this, utterance, options);
    this._connection.onerror = this._handleConnectionError.bind(this);
    this._connection.onclose = this._handleConnectionClosed.bind(this);
    this._connection.onmessage = this._handleMessage.bind(this);
  }

  reset() {
    this._clearEventHandlers();
    // If the connection is non-null and open, close it, ensuring the proper
    // handshake is completed.
    if ((this._connection != null) && (this._connection.readyState == 1)) {
      this._connection.close(NORMAL_CLOSURE);
    }

    if ((this._mediaSource != null) &&
        (this._mediaSource.sourceBuffers.length > 0)) {
      this._mediaSource.removeSourceBuffer(this._sourceBuffer);
    }
    this._initializeState();
  }

  getUuid() {
    return this._uuid;
  }

  _clearEventHandlers() {
    if (this._connection) {
      this._connection.onopen = null;
      this._connection.onmessage = null;
      this._connection.onclose = null;
      this._connection.onerror = null;
    }
    if (this._mediaSource) {
      this._mediaSource.onsourceopen = null;
    }
    if (this._sourceBuffer) {
      this._sourceBuffer.onupdate = null;
      this._sourceBuffer.onupdateend = null;
      this._sourceBuffer.onupdatestart = null;
    }
  }

  _initializeState() {
    this._connection = null;
    this._mediaSource = null;
    this._sourceBuffer = null;
    this._audioBuffer = [];
    this._downloadStarted = false;
    this._downloadEnded = false;
    this._isPlaybackStarted = false;
    this._sourceOpened = false;
    this._appendingToBuffer = false;
    this._recievedAudio = false;
    this._loadingBinaryCount = 0;
    this._uuid = null;
  }

  _initializeUrl(key) {
    this._serverUrl = SERVER_URL + "?TrustedClientToken=" + key;
  }

  _connectionOpened(utterance, options) {
    const configMessage = this._createConfigMessage(options);
    this._connection.send(configMessage);

    //send ssml message
    const ssmlMessage = this._createSsmlMessage(utterance, options);
    this._connection.send(ssmlMessage);
  }

  _createSsmlMessage(utterance, options) {
    const ssml = Ssml.createSsml(utterance, options);
    const currentTime = new Date();
    this._uuid = UUID.createUUID();
    const ssmlMessage = 'X-RequestId:' + this._uuid +
        '\r\nContent-Type:application\/ssml+xml\r\nX-Timestamp:'
        + currentTime.toString() + 'Z\r\nPath:ssml\r\n\r\n' + ssml;
    return ssmlMessage;
  }

  _createConfigMessage(options) {
    const currentTime = new Date();
    const config = Config.createConfig(options);
    const configMessage = 'X-Timestamp:' + currentTime.toString() +
        '\r\nContent-Type:application/json; ' +
        'charset=utf-8\r\nPath:speech.config\r\n\r\n' +
        config;
    return configMessage;
  }

  _handleMessage(messageEvent) {
    console.log(messageEvent.data);

    if(messageEvent.data instanceof Blob) {
      this._handleBinaryMessage(messageEvent.data);
    }

    if(typeof(messageEvent.data) == 'string'){
      this._handleStringMessage(messageEvent.data);
    }
  }

  _handleBinaryMessage(data) {
    this._loadingBinaryCount += 1;
    const temporaryFileReader = new FileReader();
    temporaryFileReader.onload =
      this._handleBinaryLoaded.bind(this, this._uuid);
    temporaryFileReader.readAsArrayBuffer(data);
  }

  _handleBinaryLoaded(uuid, e) {
    // Loading a binary is an asynchronous operation, this makes sure that
    // the loaded binary is fresh
    if (this._uuid !== uuid) {
      return;
    }

    const buffer = e.target.result;
    const dataview = new DataView(buffer);
    const headerLength = dataview.getInt16(0);
    const body = buffer.slice(HEADER_LENGTH_BYTES + headerLength);

    if (body.byteLength > 0) {
      this._recievedAudio = true;
      this._audioBuffer.push(body);
    }
    this._loadingBinaryCount -= 1;
    if (this._sourceBuffer != null) {
      this._handleSourceBufferUpdate();
    }
  }


  _handleStringMessage(data) {
    if (data.indexOf('turn.start') >= 0) {
      this._downloadStarted = true;
    }

    if (data.indexOf('turn.end') >= 0) {
      this._handleStreamEnd();
    }

    if (data.indexOf('audio.metadata') >= 0) {
      this._handleMetadata(data);
    }
  }

  _handleStreamEnd() {
    this._downloadEnded = true;
    this._handleSourceBufferUpdateEnd();
  }

  _handleMetadata(data) {
    const wordBoundaries = WordBoundary.getWordBoundaries(data);
    this._onWordBoundariesReceived(wordBoundaries);
  }

  _handleSourceOpen(_) {
    this._sourceOpened = true;
    this._mediaSource.duration = MEDIA_DURATION_PLACEHOLDER_SECONDS;
    this._sourceBuffer = this._mediaSource.addSourceBuffer(MIME_CODEC);
    this._sourceBuffer.onupdate = this._handleSourceBufferUpdate.bind(this);
    this._sourceBuffer.onupdateend =
        this._handleSourceBufferUpdateEnd.bind(this);
    this._sourceBuffer.onupdatestart =
        this._handleSourceBufferUpdateStart.bind(this);
    this._handleSourceBufferUpdate();
  }

  _handleSourceBufferUpdate() {
    if ((this._audioBuffer.length > 0) && this._sourceBufferAvailable()) {
      this._appendingToBuffer = true;
      const binary = this._audioBuffer.shift();
      try {
        this._sourceBuffer.appendBuffer(binary);
      } catch (error) {
        this._audioBuffer.unshift(binary);
        console.log(
            'buffer filled, pausing addition of binaries until space is made');
        this._onBufferFull(this._handleSourceBufferCanEmpty.bind(this));
        return;
      }
      this._notifyPlayback();
    } else if (this._canEndStream()) {
      this._handleSourceBufferUpdateEnd();
    }
  }

  _handleSourceBufferUpdateEnd() {
    if (this._canEndStream() && this._sourceBufferAvailable()) {
      this._mediaSource.endOfStream();
      this._notifyPlayback();
    }
  }

  _handleSourceBufferUpdateStart() {
    this._appendingToBuffer = false;
  }

  _sourceBufferAvailable() {
    return ((this._sourceBuffer != null) && !this._sourceBuffer.updating);
  }

  _handleSourceBufferCanEmpty(durationToRemove) {
    if (this._sourceBufferAvailable()) {
      this._sourceBuffer.remove(0, durationToRemove);
    } else {
      this._onBufferFull(this._handleSourceBufferCanEmpty.bind(this));
    }
  }

  _canEndStream() {
    return (this._downloadEnded && (this._audioBuffer.length === 0) &&
        ((this._loadingBinaryCount === 0) && this._sourceOpened) &&
        !this._appendingToBuffer && (this._mediaSource.readyState === "open"));
  }

  _notifyPlayback() {
    if (!this._isPlaybackStarted) {
      this._onPlaybackReady(!this._recievedAudio);
      this._isPlaybackStarted = true;
    }
  }

  _handleConnectionError(event) {
    const connectionError =
        this._createConnectionError(
            event, TelemetryHelper.ErrorEnum().CONNECTION_ERROR);
    this._onError(connectionError, ErrorHelper.NETWORK_ERROR_CODE());
  }

  _handleConnectionClosed(event) {
    if ((event.code != NORMAL_CLOSURE) && (event.code != ABNORMAL_CLOSURE)) {
      const connectionError =
          this._createConnectionError(
              event, TelemetryHelper.ErrorEnum().CONNECTION_CLOSE);
      this._onError(connectionError, ErrorHelper.NETWORK_ERROR_CODE());
    }
  }

  _createConnectionError(event, errorEnum) {
    const error = ErrorHelper.createDefaultError(errorEnum);
    error.message = JSON.stringify(event) + ' | ' + this._uuid;
    // If we recieve an error before the uuid has been set, then the user does
    // not have an internet connection.
    error.isNoInternetError = (this._uuid == null);
    return error;
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

const MAX_UTTERANCE_LENGTH = 32768;

// In the case of a very long utterance, when the audio buffer is filled,
// this is how much audio we clear every time we refill the buffer.
const FULL_BUFFER_TIMEOUT_SECONDS = 60;
const FULL_BUFFER_TIMEOUT_MILLISECONDS = FULL_BUFFER_TIMEOUT_SECONDS * 1000;

let tabTitle = '';

class AudioViewModel {
  constructor() {
    this._audio = new Audio();
    this._wordBoundaryEventManager = new WordBoundaryEventManager(
      this._audio,
      this._handleWordBoundaryEvent.bind(this),
      this.handleError.bind(this),
      this);
    this._audioStreamer = new AudioStreamer(
      this._setAudioSource.bind(this),
      this._wordBoundaryEventManager.addWordBoundaries.bind(
          this._wordBoundaryEventManager),
      this._startPlayback.bind(this),
      this.handleError.bind(this),
      this._handleBufferFull.bind(this));
    this._telemetryHelper = new TelemetryHelper();
    this._sendTtsEvent = null;
    this._utterance = null;
    this._voice = null;
    this._paused = false;

    this._timeBufferEmptied = 0;
    this._fullBufferTimeout = 0;
  }

  speak(utterance, options, sendTtsEvent) {
    if (this._containsNullOrUndefined([utterance, options, sendTtsEvent])) {
      const error = ErrorHelper.createDefaultError(
          TelemetryHelper.ErrorEnum().INVALID_ARGUMENTS);
      error.message = JSON.stringify([sendTtsEvent]);
      error.source = document.URL;
      this.handleError(
          error, ErrorHelper.INVALID_ARGUMENT_ERROR_CODE());
      return;
    }

    this._setMetadata(options['voiceName']);

    // From tts_extension.js: Truncate the utterance if it's too long. Both
    // Chrome's tts extension api and the web speech api specify 32k as the
    // maximum limit for an utterance.
    if (utterance.length > MAX_UTTERANCE_LENGTH) {
      utterance = utterance.substr(0, MAX_UTTERANCE_LENGTH);
    }

    TelemetryHelper.recordAction(TelemetryHelper.ActionEnum().SPEAK);
    this._reset();
    this._telemetryHelper.startTimer();
    this._sendTtsEvent = sendTtsEvent;
    this._voice = options.voiceName;
    this._utterance = Ssml.replaceNonstandardCharacters(utterance);
    // the service requires that text sent in ssml is formatted a certain way.
    const formattedUtterance = Ssml.formatRawText(this._utterance);
    this._sendTtsEvent({ 'type': 'start', 'charIndex': 0 });
    this._wordBoundaryEventManager.setUtterance(this._utterance);
    this._audioStreamer.startStream(formattedUtterance, options);
  }

  stop() {
    this._telemetryHelper.recordTime(this._isNeuralVoice());
    this._reset();
    tabTitle = '';
    if (this._sendTtsEvent != null) {
      TelemetryHelper.recordAction(TelemetryHelper.ActionEnum().CANCEL);
      this._sendTtsEvent({ 'type': 'end', 'charIndex': 0 });
    }
  }

  pause() {
    this._paused = true;
    this._audio.pause();
  }

  resume() {
    if (this._paused) {
      this._paused = false;
      this._audio.play();
    }
  }

  handleError(error, errorCode) {
    // If the error was caused because the user is not connected to the internet
    // there is no reason to record telemetry and debugging info.
    if (!error.isNoInternetError) {
      TelemetryHelper.recordAction(TelemetryHelper.ActionEnum().ERROR);
      ErrorHelper.handleError(error);
    }
    this._reset();
    this._sendTtsEvent({ 'type' : 'error', 'errorMessage' : errorCode });
  }

  getUuid() {
    if (this._audioStreamer != null) {
      return this._audioStreamer.getUuid();
    }
    return null;
  }

  _containsNullOrUndefined(args) {
    const nullOrUndefined = args.filter(function (arg) {
      return (arg === null) || (arg === undefined);
    });
    return (nullOrUndefined.length > 0);
  }

  _setAudioSource(mediaUrl) {
    this._audio.src = mediaUrl;
    this._audio.load();
  }

  _setMetadata(voiceName) {
    chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {
      if (tabTitle.length == 0) {
        // Some pages, like the edge:// pages, do not have a title property. So,
        // we fall back to a static string.
        tabTitle = tabs[0].title ? tabs[0].title : 'Microsoft Edge';
      }

      navigator.mediaSession.metadata = new MediaMetadata({
        title: tabTitle,
        artist: 'Text-to-Speech: ' + voiceName
      });
    });
  }

  _startPlayback(emptyAudio = false) {
    this._audio.onended = this._utteranceFinished.bind(this, this._utterance);
    this._telemetryHelper.recordTime(this._isNeuralVoice());
    
    // Recieving no audio (if all other parts of the protocol are followed)
    // is a valid response from the server, handle that case here.
    if (emptyAudio) {
      this._utteranceFinished(this._utterance);
    } else if (!this._paused) {
      this._audio.play();
    }
  }

  _utteranceFinished(utterance) {
    TelemetryHelper.recordAction(TelemetryHelper.ActionEnum().FULL_LISTEN);
    this._reset();
    this._sendTtsEvent({ 'type': 'end', 'charIndex': utterance.length });
  }

  _handleWordBoundaryEvent(startIndex, length) {
    this._sendTtsEvent(
        { 'type' : 'word', 'charIndex' : startIndex, 'length' : length });
  }

  _handleBufferFull(streamCallback) {
    const timeSinceLastEmpty =
        this._audio.currentTime - this._timeBufferEmptied;
    if (timeSinceLastEmpty >= FULL_BUFFER_TIMEOUT_SECONDS) {
      this._timeBufferEmptied = this._audio.currentTime;
      streamCallback(timeSinceLastEmpty);
    } else {
      this._fullBufferTimeout = setTimeout(
          this._handleBufferFull.bind(this, streamCallback),
          FULL_BUFFER_TIMEOUT_MILLISECONDS);
    }
  }

  _reset() {
    this._audio.pause();
    this._audio = new Audio();
    this._audioStreamer.reset();
    this._wordBoundaryEventManager.reset(this._audio);
    this._telemetryHelper.resetTimer();
    this._paused = false;

    this._timeBufferEmptied = 0;
    clearTimeout(this._fullBufferTimeout);
  }

  _isNeuralVoice() {
    return (this._voice != null) && (this._voice.indexOf('Neural') >= 0);
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

const audioViewModel = new AudioViewModel();

function speakListener(utterance, options, sendTtsEvent) {
  try {
    audioViewModel.speak(utterance, options, sendTtsEvent);
  } catch (error) {
    handleUncaughtErrorInAudioViewModel(error);
  }
}

function stopListener() {
  try {
    audioViewModel.stop();
  } catch (error) {
    handleUncaughtErrorInAudioViewModel(error);
  }
}

function pauseListener() {
  try {
    audioViewModel.pause();
  } catch (error) {
    handleUncaughtErrorInAudioViewModel(error);
  }
}

function resumeListener() {
  try {
    audioViewModel.resume();
  }  catch (error) {
    handleUncaughtErrorInAudioViewModel(error);
  }
}

function handleUncaughtErrorInAudioViewModel(error) {
  const errorObj = ErrorHelper.createDefaultError(
      TelemetryHelper.ErrorEnum().UNCAUGHT);
  errorObj.message = JSON.stringify(error);
  errorObj.source = document.URL;
  errorObj.errorEnum = TelemetryHelper.ErrorEnum().UNCAUGHT;
  audioViewModel.handleError(
      errorObj, ErrorHelper.SYNTHESIS_FAILED_ERROR_CODE());
}

function initializeVoiceList() {
  const voiceListSingleton = VoiceListSingleton.instance();
  voiceListSingleton.refreshVoiceList(voiceListUpdated);
}

function voiceListUpdated() {
  const voiceListSingleton = VoiceListSingleton.instance();
  if (voiceListSingleton.voiceList.length > 0) {
    const voiceList = voiceListSingleton.getTtsVoiceList();
    chrome.ttsEngine.updateVoices(voiceList);
  }
}

function handleUncaughtErrorinVoiceList(
    message, source, lineNumber, columnNumber, error) {
  const errorString =
      message + ' ' + source + ':' + lineNumber + ':' + columnNumber;
  error.line = lineNumber;
  error.column = columnNumber;
  error.stack = errorString;
  error.errorEnum =
      error.errorEnum ?
          error.errorEnum : TelemetryHelper.ErrorEnum().VOICE_LIST;
  ErrorHelper.handleError(error);
}

chrome.ttsEngine.onSpeak.addListener(speakListener);
chrome.ttsEngine.onStop.addListener(stopListener);
chrome.ttsEngine.onPause.addListener(pauseListener);
chrome.ttsEngine.onResume.addListener(resumeListener);
window.onerror = handleUncaughtErrorinVoiceList.bind(this);
window.onload = initializeVoiceList();// Copyright (C) Microsoft Corporation. All rights reserved.

class Config {

  static createConfig(options) {
    const configObj = {};
    configObj.context = {};
    configObj.context.synthesis = {};
    configObj.context.synthesis.audio = {};
    configObj.context.synthesis.audio.metadataoptions = {};
    configObj.context.synthesis.audio.metadataoptions.sentenceBoundaryEnabled =
        'false';
    configObj.context.synthesis.audio.metadataoptions.wordBoundaryEnabled =
        'true';
    configObj.context.synthesis.audio.outputFormat =
        Config._getOutputFormat(options.voiceName);
    return JSON.stringify(configObj);
  }

  static _getOutputFormat(friendlyName) {
    let outputFormat = '';
    const voiceListSingleton = VoiceListSingleton.instance();
    if (voiceListSingleton.containsVoice(friendlyName)) {
      outputFormat = voiceListSingleton.getOutputFormat(friendlyName);
    } else {
      // Default to 24k if the voiceListSingleton has not been populated yet
      outputFormat = 'audio-24khz-48kbitrate-mono-mp3';
    }
    return outputFormat;
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

class ErrorHelper {

  static NETWORK_ERROR_CODE() {
    return 'network';
  }

  static SYNTHESIS_FAILED_ERROR_CODE() {
    return 'synthesis-failed';
  }

  static TEXT_TOO_LONG_ERROR_CODE() {
    return 'text-too-long';
  }

  static INVALID_ARGUMENT_ERROR_CODE() {
    return 'invalid-argument';
  }

  static handleError(error) {
    TelemetryHelper.recordError(error.errorEnum);
    const errorInfo = {
      component: 'extensions-onlineVoices',
      name: error.errorEnum.toString(),
      message: error.message,
      line: error.line,
      column: error.column,
      source_url: error.source,
      stack: error.stack
    };
    chrome.errorReporting.reportError(errorInfo);
    console.log(JSON.stringify(errorInfo));
  }

  static createDefaultError(numberDefault = 0) {
    const error = {};
    error.errorEnum = numberDefault;
    error.message = "";
    error.line = numberDefault;
    error.column = numberDefault;
    error.source = document.URL;
    error.stack = error.source + ':' + error.line + ':' + error.column;
    return error;
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

class ManifestHelper {

  static getVoiceAttribute(voiceName, attributeName, defaultValue = null) {
    const voices = ManifestHelper.getVoiceList();
    let result = defaultValue;
    let i;
    for (i = 0; i < voices.length; ++i) {
      if (voiceName === voices[i]['voice_name']) {
        result = voices[i][attributeName];
        break;
      }
    }
    return result;
  }

  static getVoiceList() {
    const manifestData = chrome.runtime.getManifest();
    return manifestData['tts_engine']['voices'];
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

const DEFAULT_VOICE_NAME = 'ZiraRUS';
const DEFAULT_LANGUAGE = 'en-US';
const DEFAULT_RATE = 1.0;
const DEFAULT_PITCH = 1.0;
const DEFAULT_VOLUME = 1.0;

const ESCAPABLE_CHARACTERS_EXPRESSION = /<|>|&|"|'/g;
const ESCAPE_CHARACTERS_EXPRESSION = /&lt;|&gt;|&amp;|&quot;|&apos;/g;
const NON_STANDARD_CHARACTERS_EXPRESSION = /||||||||/g;

const CHARACTER_TO_ESCAPE = {
  '<' : '&lt;',
  '>' : '&gt;',
  '&' : '&amp;',
  '"' : '&quot;',
  '\'' : '&apos;',
};
const ESCAPE_TO_CHARACTER = {
  '&lt;' : '<',
  '&gt;' : '>' ,
  '&amp;' : '&',
  '&quot;' : '"',
  '&apos;' : '\'',
};
const STANDARD_CONVERSION = {
  '' : '\'',
  '' : '\'',
  '' : '\'',
  '' : '\'',
  '' : '\'',
  '' : '"',
  '' : '"',
  '' : '"',
  '' : '"',
  '' : '"',
};

class Ssml {

  static createSsml(text, options) {
    Ssml._ensureDefaultOptions(options);
    const rateString =
        Ssml._getConvertedPercentageString(options.rate, DEFAULT_RATE);
    const pitchString = Ssml._getConvertedPitchString(options.pitch);
    const volumeString =
        Ssml._getConvertedPercentageString(options.volume, DEFAULT_VOLUME);
    const voiceName = Ssml.getVoiceName(options.voiceName);
    const language =
        ManifestHelper.getVoiceAttribute(voiceName, 'lang', DEFAULT_LANGUAGE);

    return '<speak version=\'1.0\' ' +
        'xmlns=\'http://www.w3.org/2001/10/synthesis\' xml:lang=\'' + language +
        '\'>' + '<voice  name=\'' + voiceName + '\'>' + '<prosody pitch=\'' +
        pitchString + '\' rate =\'' + rateString + '\' volume=\'' +
        volumeString + '\'> ' + text + '</prosody></voice></speak>';
  }

  static formatRawText(text) {
    return text.replace(
        ESCAPABLE_CHARACTERS_EXPRESSION,
        Ssml._replaceEscapableCharacter.bind(this));
  }

  static replaceNonstandardCharacters(text) {
    return text.replace(
      NON_STANDARD_CHARACTERS_EXPRESSION,
      Ssml._replaceNonstandardCharacter.bind(this));
  }

  static revertFormattedText(formattedText) {
    return formattedText.replace(
        ESCAPE_CHARACTERS_EXPRESSION, Ssml._replaceEscapeCharacter.bind(this));
  }

  static getEscapeToCharacter() {
    return ESCAPE_TO_CHARACTER;
  }

  static getVoiceName(friendlyName) {
    let outputName = friendlyName;
    const voiceListSingleton = VoiceListSingleton.instance();
    if (voiceListSingleton.containsVoice(friendlyName)) {
      outputName = voiceListSingleton.getName(friendlyName);
    }
    return outputName;
  }

  static _ensureDefaultOptions(options) {
    if (!options.hasOwnProperty('voiceName')) {
      options['voiceName'] = DEFAULT_VOICE_NAME;
    }

    if (!options.hasOwnProperty('lang')) {
      options['lang'] = DEFAULT_LANGUAGE;
    }

    if (!options.hasOwnProperty('rate')) {
      options['rate'] = DEFAULT_RATE;
    }

    if (!options.hasOwnProperty('pitch')) {
      options['pitch'] = DEFAULT_PITCH;
    }

    if (!options.hasOwnProperty('volume')) {
      options['volume'] = DEFAULT_VOLUME;
    }
  }

  static _getConvertedPitchString(pitch) {
    const convertedPitch = (pitch - DEFAULT_PITCH);
    return convertedPitch < 0 ?
        convertedPitch + 'Hz' : '+' + convertedPitch + 'Hz';
  }

  static _getConvertedPercentageString(value, defaultValue) {
    const convertedPercentage = (value - defaultValue) * 100;
    return (convertedPercentage < 0) ?
        (convertedPercentage + '%') : (('+' + convertedPercentage) + '%');
  }

  static _replaceEscapableCharacter(character) {
    return CHARACTER_TO_ESCAPE[character];
  }

  static _replaceEscapeCharacter(escapeCharacter) {
    return ESCAPE_TO_CHARACTER[escapeCharacter];
  }

  static _replaceNonstandardCharacter(character) {
    return STANDARD_CONVERSION[character];
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

const PREFIX = 'Microsoft.Voices.';

const ACTION_HISTOGRAM = PREFIX + 'Action';
const CONNECTION_ERROR_HISTOGRAM = PREFIX + 'ConnectionErrors';
const ERROR_HISTOGRAM = PREFIX + 'Errors';
const PLAYBACK_HISTOGRAM = PREFIX + 'Playback.Time';
const PLAYBACK_HISTOGRAM_NEURAL = PLAYBACK_HISTOGRAM + '.Neural';

class TelemetryHelper {
  constructor () {
    this._startTime = null;
  }


// These values are logged to UMA. Entries should not be renumbered and
// numeric values should never be reused. Please keep in sync with
// "Microsoft.Voices.ActionEnum"
// in src/tools/metrics/histograms/edge_enums.xml.
  static ActionEnum() {
    return {
      'SPEAK' : 0,
      'CANCEL' : 1,
      'FULL_LISTEN' : 2,
      'ERROR' : 3,
    };
  }

// These values are logged to UMA. Entries should not be renumbered and
// numeric values should never be reused. Please keep in sync with
// "Microsoft.Voices.ErrorEnum"
// in src/tools/metrics/histograms/edge_enums.xml.
  static ErrorEnum() {
    return {
      'CONNECTION_ERROR' : 0,
      'INTERNAL' : 1,
      'INVALID_ARGUMENTS' : 2,
      'SERVICE' : 3,
      'CONNECTION_OPEN': 4,
      'CONNECTION_CLOSE': 5,
      'UNCAUGHT': 6,
      'VOICE_LIST': 7,
      'VOICE_LIST_CONNECTION': 8,
      'VOICE_LIST_CACHE': 9,
    };
  }

// These values are logged to UMA. Entries should not be renumbered and
// numeric values should never be reused. Please keep in sync with
// "Microsoft.Voices.ConnectionErrorEnum"
// in src/tools/metrics/histograms/edge_enums.xml.
  static ConnectionErrorEnum() {
    return {
      '1002' : 0,
      '1007' : 1,
      '1011' : 2,
    };
  }

  static recordAction(action) {
    chrome.metricsPrivate.recordEnumerationValue(
        ACTION_HISTOGRAM,
        action,
        Object.keys(TelemetryHelper.ActionEnum()).length);
  }

  static recordError(errorEnum) {
    chrome.metricsPrivate.recordEnumerationValue(
        ERROR_HISTOGRAM,
        errorEnum,
        Object.keys(TelemetryHelper.ErrorEnum()).length);
  }

  static recordConnectionError(connectionErrorEnum) {
    chrome.metricsPrivate.recordEnumerationValue(
      CONNECTION_ERROR_HISTOGRAM,
      connectionErrorEnum,
      Object.keys(TelemetryHelper.ConnectionErrorEnum()).length);
  }

  startTimer() {
    this._startTime = new Date();
  }

  resetTimer() {
    this._startTime = null;
  }

  recordTime(isNeuralVoice) {
    if (this._startTime === null) {
      return;
    }
    const currentTime = new Date();
    const timeDiff = currentTime - this._startTime;
    if (isNeuralVoice) {
      chrome.metricsPrivate.recordTime(PLAYBACK_HISTOGRAM_NEURAL, timeDiff);
    } else {
      chrome.metricsPrivate.recordTime(PLAYBACK_HISTOGRAM, timeDiff);
    }

    this._startTime = null;
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

const ARRAY_LENGTH = 16;
const MIN_HEX_LENGTH = 2;

class UUID {

  static createUUID() {
    const array = new Uint8Array(ARRAY_LENGTH);
    window.crypto.getRandomValues(array);

    let uuid = '';
    for (let i = 0; i < ARRAY_LENGTH; i++) {
      let hexString = array[i].toString(ARRAY_LENGTH);
      hexString = this._formatHexString(hexString);
      uuid += hexString;
    }
    return uuid;
  }

  static _formatHexString(hexString) {
    if (hexString.length < MIN_HEX_LENGTH) {
      hexString = '0' + hexString;
    }
    return hexString;
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

const BASE_URL = 'https://speech.platform.bing.com/consumer/speech/synthesize' +
    '/readaloud/voices/list';

class VoiceListRequester {

  static getVoiceList(onVoiceListAcquired) {
    chrome.systemPrivate.getApiKey(
        VoiceListRequester._getVoiceListWithKey.bind(
            this, onVoiceListAcquired));
  }

  static _getVoiceListWithKey(onVoiceListAcquired, key) {
    const url = BASE_URL + '?trustedclienttoken=' + key;
    const httpRequest = new XMLHttpRequest();
    httpRequest.onreadystatechange =
        VoiceListRequester._readyStateChanged.bind(
            this, httpRequest, onVoiceListAcquired);
    httpRequest.onerror =
        VoiceListRequester._handleError.bind(this, httpRequest);
    httpRequest.responseType = 'json';
    httpRequest.open('GET', encodeURI(url), true);
    httpRequest.send();
  }

  static _readyStateChanged(httpRequest, onVoiceListAcquired) {
    if (VoiceListRequester._isRequestReady(httpRequest)) {
      onVoiceListAcquired(httpRequest.response);
    }

    if (VoiceListRequester._isRequestError(httpRequest)) {
      VoiceListRequester._handleError(httpRequest);
    }
  }

  static _isRequestReady(httpRequest) {
    return ((httpRequest.readyState == 4) && (httpRequest.status == 200));
  }

  static _isRequestError(httpRequest) {
    return ((httpRequest.readyState == 4) && (httpRequest.status != 200)
        && (httpRequest.status != 0)); // 0 indicates no internet connection
  }

  static _isNoInternetError(httpRequest) {
    return (httpRequest.status === 0) && (httpRequest.responseURL === "");
  }

  static _handleError(httpRequest) {
    // if the user is not connected to the internet when a call to the service
    // is made, the REST call will throw a specific error. This equates to noise
    // on our end, so ignore the error for telemetry and error reporting.
    if (this._isNoInternetError(httpRequest)) {
      return;
    }
    const error = ErrorHelper.createDefaultError(
        TelemetryHelper.ErrorEnum().VOICE_LIST_CONNECTION);
    error.message =
        'status: ' + httpRequest.status + ' responseURL: '
        + httpRequest.responseURL;
    ErrorHelper.handleError(error);
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

const CACHE_KEY = 'voiceList';

class VoiceListSingleton {
  static instance() {
    if (VoiceListSingleton.singleton) {
      return VoiceListSingleton.singleton;
    }

    VoiceListSingleton.singleton = new VoiceListSingleton();
    return VoiceListSingleton.singleton;
  }

  constructor() {
    this.voiceList = []; // List of type VoiceModel
    this._OnVoiceListUpdated = null;
  }

  // Update the Singleton's voice list from the cache, then reach out
  // to the service to update the cache (and voice list again).
  refreshVoiceList(onVoiceListUpdated) {
    this._OnVoiceListUpdated = onVoiceListUpdated;
    chrome.storage.local.get(
      CACHE_KEY, this._voiceListAcquiredFromCache.bind(this));
  }

  getTtsVoiceList() {
    const ttsVoiceList = [];
    this.voiceList.forEach((voiceModel) => {
      ttsVoiceList.push(voiceModel.toTtsVoice());
    });
    return ttsVoiceList;
  }

  containsVoice(friendlyName) {
    let containsVoice = false;
    this.voiceList.forEach((voiceModel) => {
      if (voiceModel.friendlyName === friendlyName) {
        containsVoice = true;
      }
    });
    return containsVoice;
  }

  getOutputFormat(friendlyName) {
    return this._getField('friendlyName', friendlyName, 'outputFormat');
  }

  getName(friendlyName) {
    return this._getField('friendlyName', friendlyName, 'name');
  }

  _getField(inputField, inputValue, outputField) {
    let outputValue = null;
    this.voiceList.forEach((voiceModel) => {
      if (voiceModel[inputField] === inputValue) {
        outputValue = voiceModel[outputField];
      }
    });
    return outputValue;
  }

  _voiceListAcquiredFromService(voiceList) {
    this.voiceList = VoiceModel.createFromServiceVoiceList(voiceList);
    const voiceListObj = {};
    voiceListObj[CACHE_KEY] = this.voiceList;
    chrome.storage.local.set(voiceListObj, this._voiceListCached.bind(this));
    this._OnVoiceListUpdated();
  }

  _voiceListAcquiredFromCache(voiceListObj) {
    // If there was an error, record it. Otherwise, update the voice list with
    // the contents of the cache.
    if (chrome.runtime.lastError != undefined) {
      this._handleCacheError(
          'retrieving', chrome.runtime.lastError.message);
    } else {
      const cacheVoiceList = voiceListObj[CACHE_KEY];
      this.voiceList = cacheVoiceList;
    }
    VoiceListRequester.getVoiceList(
      this._voiceListAcquiredFromService.bind(this));
  }

  _voiceListCached() {
    if (chrome.runtime.lastError != undefined) {
      this._handleCacheError(
          'caching', chrome.runtime.lastError.message);
    }
  }

  _handleCacheError(customMessage, runtimeMessage) {
    const error = ErrorHelper.createDefaultError(
        TelemetryHelper.ErrorEnum().VOICE_LIST_CACHE);
    error.message = customMessage + ':' + runtimeMessage;
    ErrorHelper.handleError(error);
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

class VoiceModel {
  constructor(name, language, outputFormat, friendlyName) {
    this.name = name;
    this.language = language;
    this.outputFormat = outputFormat;
    this.friendlyName = friendlyName;
  }

  static createFromServiceVoice(serviceVoice) {
    return new VoiceModel(
        serviceVoice.Name, serviceVoice.Locale, serviceVoice.SuggestedCodec,
        serviceVoice.FriendlyName);
  }

  static createFromServiceVoiceList(serviceVoiceList) {
    const resultList = [];
    serviceVoiceList.forEach((serviceVoice) => {
        resultList.push(VoiceModel.createFromServiceVoice(serviceVoice));
    });
    return resultList;
  }

  toTtsVoice() {
    return {
        eventTypes: ['end', 'error', 'start', 'word'],
        lang: this.language,
        remote: true,
        voiceName: this.friendlyName
    };
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

class WordBoundary {

  constructor(timeOffset, text, length) {
    this.timeOffset = timeOffset;
    this.text = text;
    this.length = length;
  }

  static getWordBoundaries(rawString) {
    const jsonIndex = rawString.indexOf('{');
    const jsonString = rawString.substr(jsonIndex);
    const metaDataJson = JSON.parse(jsonString);
    const wordBoundaries = [];
    metaDataJson.Metadata.forEach(
        WordBoundary._extractWordBoundary.bind(this, wordBoundaries));
    return wordBoundaries;
  }

  static _extractWordBoundary(wordBoundaries, json) {
    if (WordBoundary._isValidBoundary(json)) {
      const wordBoundary = new WordBoundary(
        json.Data.Offset,
        json.Data.text.Text,
        json.Data.text.Length);
      wordBoundaries.push(wordBoundary);
    }
  }

  static _isValidBoundary(json) {
    return json.Type === 'WordBoundary' &&
      json.hasOwnProperty('Data') &&
      json.Data.hasOwnProperty('Offset') &&
      json.Data.hasOwnProperty('text') &&
      json.Data.text.hasOwnProperty('Text') &&
      json.Data.text.hasOwnProperty('Length');
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.

const TIME_CONVERSION_FACTOR = 10000;
const MILLI_CONVERSION_FACTOR = 1000;
const OFFSET_THRESHOLD = 1;

class WordBoundaryEventManager {
  constructor(audio, onWordBoundaryEvent, onError, uuidProvider) {
    this._audio = audio;
    this._onWordBoundaryEvent = onWordBoundaryEvent;
    this._onError = onError;
    this._uuidProvider = uuidProvider;
    this._wordBoundaries = [];
    this._timeout = null;
    this._utterance = null;
    this._searchIndex = 0;
  }

  addWordBoundaries(wordBoundaries) {
    this._wordBoundaries = this._wordBoundaries.concat(wordBoundaries);
    if (this._timeout === null) {
      this._attemptSetTimeout();
    }
  }

  pause() {
    if (this._timeout != null) {
      clearTimeout(this._timeout);
      this._timeout = null;
    }
  }

  resume() {
    this._attemptSetTimeout();
  }

  reset(audio) {
    if (this._timeout != null) {
      clearTimeout(this._timeout);
    }

    this._audio = audio;
    this._wordBoundaries = [];
    this._timeout = null;
    this._utterance = null;
    this._searchIndex = 0;
  }

  setUtterance(utterance) {
    this._utterance = utterance;
    this._searchIndex = 0;
  }

  _wordBoundaryOccured(timeOffset) {
    let wordBoundary = this._wordBoundaries[0];
    if (wordBoundary.timeOffset != timeOffset) {
      const errorMessage = 'previous timeout was not cancelled';
      const error =
          this._createWordBoundaryError(
              errorMessage, ErrorHelper.SYNTHESIS_FAILED_ERROR_CODE());
      this._onError(error, TelemetryHelper.ErrorEnum().INTERNAL);
      return;
    }

    if (this._shouldResetTimeout(wordBoundary.timeOffset)) {
      this._attemptSetTimeout();
      return;
    }

    wordBoundary = this._formatWordBoundary(wordBoundary);
    const wordIndex =
        this._findWordIndex(wordBoundary.text, wordBoundary.length);
    if (wordIndex < 0) {
      const errorMessage = 'text from wordBoundary not found in utterance. '
          + this._uuidProvider.getUuid();
      const error =
          this._createWordBoundaryError(
              errorMessage, TelemetryHelper.ErrorEnum().SERVICE);
      this._onError(error, ErrorHelper.SYNTHESIS_FAILED_ERROR_CODE());
      return;
    }

    this._wordBoundaries.shift();
    this._timeout = null;
    this._onWordBoundaryEvent(wordIndex, wordBoundary.length);
    this._attemptSetTimeout();
  }

  _attemptSetTimeout() {
    if (this._wordBoundaries.length === 0) {
      return false;
    }

    const wordBoundary = this._wordBoundaries[0];
    const timeOutOffset = this._calculateTimeoutOffset(wordBoundary.timeOffset);
    this._timeout =
        setTimeout(this._wordBoundaryOccured.bind(
            this, wordBoundary.timeOffset), timeOutOffset);
    return true;
  }

  _findWordIndex(word, wordLength) {
    const wordIndex = this._utterance.indexOf(word, this._searchIndex);
    this._searchIndex = wordIndex + wordLength;
    return wordIndex;
  }

  _shouldResetTimeout(wordTimeOffset) {
    return this._calculateTimeoutOffset(wordTimeOffset) > OFFSET_THRESHOLD;
  }

  _calculateTimeoutOffset(wordTimeOffset) {
    return (wordTimeOffset / TIME_CONVERSION_FACTOR) -
        (this._audio.currentTime * MILLI_CONVERSION_FACTOR);
  }

  _formatWordBoundary(wordBoundary) {
    wordBoundary.text = Ssml.revertFormattedText(wordBoundary.text);
    wordBoundary.length = wordBoundary.text.length;
    return wordBoundary;
  }

  _createWordBoundaryError(message, errorEnum) {
    const error = ErrorHelper.createDefaultError(errorEnum);
    error.message = message;
    error.source = document.URL;
    return error;
  }
}<!--
Copyright 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.

We use an HTML page just to have access to the DOM, for URL
parsing. An alternative would be to include a URL parsing JavaScript
library with the extension but this approach is likely smaller and
faster.
-->
<html>
<head>
    <script src="Background.js"></script>
</head>
<body>
</body>
</html>
// Copyright (C) Microsoft Corporation. All rights reserved.

//Use this function for getting message from page script
chrome.runtime.onMessageExternal.addListener(
  function (request, sender, sendResponse) {
    console.log('MediaInternals background.js onMessageExternal, message received:   '
      + JSON.stringify(request) + ', sender: ' + JSON.stringify(sender));
    function doSendResponse(value, errorString) {
      let error = null;
      if (errorString) {
        error = {};
        error['name'] = 'ComponentExtensionError';
        error['message'] = errorString;
      }

      const errorMessage = error || chrome.runtime.lastError;
      sendResponse({ 'value': value, 'error': errorMessage });
    }
    // These should be the properties of the video player element
    // They are available for only enabled web sites.
    let rendererId = null;
    let playerId = null;

    if (request.rendererId !== undefined && request.playerId !== undefined) {
      console.log('setting video player params ' + request.rendererId +
        "," + request.playerId);
      rendererId = request.rendererId;
      playerId = request.playerId;

      const options = {
        rendererId: rendererId,
        playerId: request.playerId
      };

      if (request.api == "getLog") {
        chrome.mediaInternalsPrivate.getLog(options, doSendResponse);
      }

    } else {
      console.log('Error need rendererId and playerId integer params');
    }
    return true;
  }
);// Copyright (C) Microsoft Corporation. All rights reserved.

//Use this function for getting message from page script
chrome.runtime.onMessageExternal.addListener(
  function (request, sender, sendResponse) {
    console.log('WebrtcInternals background.js onMessageExternal, message: '
      + JSON.stringify(request) + ', sender: ' + JSON.stringify(sender));
    function doSendResponse(value, errorString) {
      let error = null;
      if (errorString) {
        error = {};
        error['name'] = 'ComponentExtensionError';
        error['message'] = errorString;
      }

      let data = {};
      let moreData = false;
      let offset = 0;
      if (value !== undefined) {
        moreData = value.moreData;
        offset = value.offset;
        if (value.contents !== undefined) {
          data = {
            // Create a view
            data: Array.apply(null, new Uint8Array(value.contents)),
            contentType: 'raw-bytes'
          };
        }
      }

      const errorMessage = error || chrome.runtime.lastError;
      sendResponse({
        'data': data, 'moreData': moreData,
        'offset': offset, 'error': errorMessage
      });
    }

    function getHost(url) {
      if (!url) {
        return '';
      }
      const a = document.createElement('a');
      a.href = url;
      let origin = a.protocol + '//' + a.hostname;
      if (a.port != '') {
        origin = origin + ':' + a.port;
      }
      origin = origin + '/';
      return origin;
    }

    if (request.api == "getWebRtcLog" && request.logId !== undefined) {
      const requestInfo = {};
      console.log('sender.tab.id ' + sender.tab.id);
      console.log('sender.url ' + sender.url);

      const origin = getHost(sender.url);
      const logId = request.logId;
      let offset;
      if (request.offset !== undefined) {
        offset = request.offset;
      } else {
        offset = 0;
      }
      requestInfo['securityOrigin'] = origin;
      requestInfo['logId'] = logId;
      requestInfo['offset'] = offset;
      requestInfo['tabId'] = sender.tab.id;

      chrome.webrtcInternalsPrivate.getWebRtcLog(requestInfo, doSendResponse);
    } else {
      console.log('Error API name should be getWebRtcLog or logId param missing');
    }
    return true;
  }
);// Copyright 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @fileoverview
 * This is a component extension that implements a text-to-speech (TTS)
 * engine powered by Google's speech synthesis API.
 *
 * This is an "event page", so it's not loaded when the API isn't being used,
 * and doesn't waste resources. When a web page or web app makes a speech
 * request and the parameters match one of the voices in this extension's
 * manifest, it makes a request to Google's API using Chrome's private key
 * and plays the resulting speech using HTML5 audio.
 */

/**
 * The main class for this extension. Adds listeners to
 * chrome.ttsEngine.onSpeak and chrome.ttsEngine.onStop and implements
 * them using Google's speech synthesis API.
 * @constructor
 */
function TtsExtension() {}

TtsExtension.prototype = {
  /**
   * The url prefix of the speech server, including static query
   * parameters that don't change.
   * @type {string}
   * @const
   * @private
   */
  SPEECH_SERVER_URL_: 'https://to-be-replaced.invalid/speech-api/v2/synthesize?' +
      'enc=mpeg&client=chromium',

  /**
   * A mapping from language and gender to voice name, hardcoded for now
   * until the speech synthesis server capabilities response provides this.
   * The key of this map is of the form '<lang>-<gender>'.
   * @type {Object<string>}
   * @private
   */
  LANG_AND_GENDER_TO_VOICE_NAME_: {
    'en-gb-male': 'rjs',
    'en-gb-female': 'fis',
  },

  /**
   * The arguments passed to the onSpeak event handler for the utterance
   * that's currently being spoken. Should be null when no object is
   * pending.
   *
   * @type {?{utterance: string, options: Object, callback: Function}}
   * @private
   */
  currentUtterance_: null,

  /**
   * The HTML5 audio element we use for playing the sound served by the
   * speech server.
   * @type {HTMLAudioElement}
   * @private
   */
  audioElement_: null,

  /**
   * A mapping from voice name to language and gender, derived from the
   * manifest file.  This is used in case the speech synthesis request
   * specifies a voice name but doesn't specify a language code or gender.
   * @type {Object<{lang: string, gender: string}>}
   * @private
   */
  voiceNameToLangAndGender_: {},

  /**
   * This is the main function called to initialize this extension.
   * Initializes data structures and adds event listeners.
   */
  init: function() {
    // Get voices from manifest.
    const voices = chrome.app.getDetails().tts_engine.voices;
    for (let i = 0; i < voices.length; i++) {
      this.voiceNameToLangAndGender_[voices[i].voice_name] = {
        lang: voices[i].lang,
        gender: voices[i].gender
      };
    }

    // Initialize the audio element and event listeners on it.
    this.audioElement_ = document.createElement('audio');
    document.body.appendChild(this.audioElement_);
    this.audioElement_.addEventListener(
        'ended', this.onStop_.bind(this), false);
    this.audioElement_.addEventListener(
        'canplaythrough', this.onStart_.bind(this), false);

    // Install event listeners for the ttsEngine API.
    chrome.ttsEngine.onSpeak.addListener(this.onSpeak_.bind(this));
    chrome.ttsEngine.onStop.addListener(this.onStop_.bind(this));
    chrome.ttsEngine.onPause.addListener(this.onPause_.bind(this));
    chrome.ttsEngine.onResume.addListener(this.onResume_.bind(this));
  },

  /**
   * Handler for the chrome.ttsEngine.onSpeak interface.
   * Gets Chrome's Google API key and then uses it to generate a request
   * url for the requested speech utterance. Sets that url as the source
   * of the HTML5 audio element.
   * @param {string} utterance The text to be spoken.
   * @param {Object} options Options to control the speech, as defined
   *     in the Chrome ttsEngine extension API.
   * @private
   */
  onSpeak_: function(utterance, options, callback) {
    // Truncate the utterance if it's too long. Both Chrome's tts
    // extension api and the web speech api specify 32k as the
    // maximum limit for an utterance.
    if (utterance.length > 32768) {
      utterance = utterance.substr(0, 32768);
    }

    try {
      // First, stop any pending audio.
      this.onStop_();

      this.currentUtterance_ = {
        utterance: utterance,
        options: options,
        callback: callback
      };

      let lang = options.lang;
      let gender = options.gender;
      if (options.voiceName) {
        lang = this.voiceNameToLangAndGender_[options.voiceName].lang;
        gender = this.voiceNameToLangAndGender_[options.voiceName].gender;
      }

      if (!lang) {
        lang = navigator.language;
      }

      // Look up the specific voice name for this language and gender.
      // If it's not in the map, it doesn't matter - the language will
      // be used directly. This is only used for languages where more
      // than one gender is actually available.
      const key = lang.toLowerCase() + '-' + gender;
      const voiceName = this.LANG_AND_GENDER_TO_VOICE_NAME_[key];

      let url = this.SPEECH_SERVER_URL_;
      chrome.systemPrivate.getApiKey(
          (function(key) {
            url += '&key=' + key;
            url += '&text=' + encodeURIComponent(utterance);
            url += '&lang=' + lang.toLowerCase();

            if (voiceName) {
              url += '&name=' + voiceName;
            }

            if (options.rate) {
              // Input rate is between 0.1 and 10.0 with a default of 1.0.
              // Output speed is between 0.0 and 1.0 with a default of 0.5.
              url += '&speed=' + (options.rate / 2.0);
            }

            if (options.pitch) {
              // Input pitch is between 0.0 and 2.0 with a default of 1.0.
              // Output pitch is between 0.0 and 1.0 with a default of 0.5.
              url += '&pitch=' + (options.pitch / 2.0);
            }

            // This begins loading the audio but does not play it.
            // When enough of the audio has loaded to begin playback,
            // the 'canplaythrough' handler will call this.onStart_,
            // which sends a start event to the ttsEngine callback and
            // then begins playing audio.
            this.audioElement_.src = url;
          }).bind(this));
    } catch (err) {
      console.error(String(err));
      callback({'type': 'error', 'errorMessage': String(err)});
      this.currentUtterance_ = null;
    }
  },

  /**
   * Handler for the chrome.ttsEngine.onStop interface.
   * Called either when the ttsEngine API requests us to stop, or when
   * we reach the end of the audio stream. Pause the audio element to
   * silence it, and send a callback to the ttsEngine API to let it know
   * that we've completed. Note that the ttsEngine API manages callback
   * messages and will automatically replace the 'end' event with a
   * more specific callback like 'interrupted' when sending it to the
   * TTS client.
   * @private
   */
  onStop_: function() {
    if (this.currentUtterance_) {
      this.audioElement_.pause();
      this.currentUtterance_.callback({
        'type': 'end',
        'charIndex': this.currentUtterance_.utterance.length
      });
    }
    this.currentUtterance_ = null;
  },

  /**
   * Handler for the canplaythrough event on the audio element.
   * Called when the audio element has buffered enough audio to begin
   * playback. Send the 'start' event to the ttsEngine callback and
   * then begin playing the audio element.
   * @private
   */
  onStart_: function() {
    if (this.currentUtterance_) {
      if (this.currentUtterance_.options.volume !== undefined) {
        // Both APIs use the same range for volume, between 0.0 and 1.0.
        this.audioElement_.volume = this.currentUtterance_.options.volume;
      }
      this.audioElement_.play();
      this.currentUtterance_.callback({'type': 'start', 'charIndex': 0});
    }
  },

  /**
   * Handler for the chrome.ttsEngine.onPause interface.
   * Pauses audio if we're in the middle of an utterance.
   * @private
   */
  onPause_: function() {
    if (this.currentUtterance_) {
      this.audioElement_.pause();
    }
  },

  /**
   * Handler for the chrome.ttsEngine.onPause interface.
   * Resumes audio if we're in the middle of an utterance.
   * @private
   */
  onResume_: function() {
    if (this.currentUtterance_) {
      this.audioElement_.play();
    }
  }

};

(new TtsExtension()).init();
<!doctype html>
<html dir="$i18n{textdirection}" lang="$i18n{language}" class="loading">
<head>
  <meta charset="utf8">
  <title>$i18n{title}</title>
  <link rel="stylesheet" href="edge://resources/css/md_colors.css">
  <style>
    html {
      /* Remove 300ms delay for 'click' event, when using touch interface. */
      touch-action: manipulation;
    }

    html,
    body {
      background: var(--md-background-color);
      height: 100%;
      margin: 0;
      overflow: hidden;
    }

    html.loading::before {
      background-color: var(--md-toolbar-color);
      border-bottom: var(--md-toolbar-border);
      box-sizing: border-box;
      content: '';
      display: block;
      height: var(--md-toolbar-height);
    }
  </style>
</head>
<body>
  <bookmarks-app></bookmarks-app>

  <link rel="stylesheet" href="edge://resources/css/text_defaults_md.css">
  <link rel="import" href="app.html">
</body>
</html>
<!--
Copyright 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.

We use an HTML page just to have access to the DOM, for URL
parsing. An alternative would be to include a URL parsing JavaScript
library with the extension but this approach is likely smaller and
faster.
-->
<html>
<head>
<script src="thunk.js"></script>
</head>
<body>
</body>
</html>
// Copyright 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

chrome.runtime.onMessageExternal.addListener(function(
    message, sender, sendResponse) {
  function doSendResponse(value, errorString) {
    let error = null;
    if (errorString) {
      error = {};
      error['name'] = 'ComponentExtensionError';
      error['message'] = errorString;
    }

    const errorMessage = error || chrome.runtime.lastError;
    sendResponse({'value': value, 'error': errorMessage});
  }

  function getHost(url) {
    if (!url) {
      return '';
    }
    // Use the DOM to parse the URL. Since we don't add the anchor to
    // the page, this is the only reference to it and it will be
    // deleted once it's gone out of scope.
    const a = document.createElement('a');
    a.href = url;
    let origin = a.protocol + '//' + a.hostname;
    if (a.port != '') {
      origin = origin + ':' + a.port;
    }
    origin = origin + '/';
    return origin;
  }

  try {
    const requestInfo = {};

    // Set the tab ID. If it's passed in the message, use that.
    // Otherwise use the sender information.
    if (message['tabId']) {
      requestInfo['tabId'] = +message['tabId'];
      if (isNaN(requestInfo['tabId'])) {
        throw new Error(
            'Cannot convert tab ID string to integer: ' + message['tabId']);
      }
    } else if (sender.tab) {
      requestInfo['tabId'] = sender.tab.id;
    }

    if (sender.guestProcessId) {
      requestInfo['guestProcessId'] = sender.guestProcessId;
    }

    const method = message['method'];

    // Set the origin. If a URL is passed in the message, use that.
    // Otherwise use the sender information.
    let origin;
    if (message['winUrl']) {
      origin = getHost(message['winUrl']);
    } else {
      origin = getHost(sender.url);
    }

    if (method == 'cpu.getInfo') {
      chrome.system.cpu.getInfo(doSendResponse);
      return true;
    } else if (method == 'logging.setMetadata') {
      const metaData = message['metaData'];
      chrome.webrtcLoggingPrivate.setMetaData(
          requestInfo, origin, metaData, doSendResponse);
      return true;
    } else if (method == 'logging.start') {
      chrome.webrtcLoggingPrivate.start(requestInfo, origin, doSendResponse);
      return true;
    } else if (method == 'logging.uploadOnRenderClose') {
      chrome.webrtcLoggingPrivate.setUploadOnRenderClose(
          requestInfo, origin, true);
      doSendResponse();
      return false;
    } else if (method == 'logging.noUploadOnRenderClose') {
      chrome.webrtcLoggingPrivate.setUploadOnRenderClose(
          requestInfo, origin, false);
      doSendResponse();
      return false;
    } else if (method == 'logging.stop') {
      chrome.webrtcLoggingPrivate.stop(requestInfo, origin, doSendResponse);
      return true;
    } else if (method == 'logging.upload') {
      chrome.webrtcLoggingPrivate.upload(requestInfo, origin, doSendResponse);
      return true;
    } else if (method == 'logging.uploadStored') {
      const logId = message['logId'];
      chrome.webrtcLoggingPrivate.uploadStored(
          requestInfo, origin, logId, doSendResponse);
      return true;
    } else if (method == 'logging.stopAndUpload') {
      // Stop everything and upload. This is allowed to be called even if
      // logs have already been stopped or not started. Therefore, ignore
      // any errors along the way, but store them, so that if upload fails
      // they are all reported back.
      // Stop incoming and outgoing RTP dumps separately, otherwise
      // stopRtpDump will fail and not stop anything if either type has not
      // been started.
      const errors = [];
      chrome.webrtcLoggingPrivate.stopRtpDump(
          requestInfo, origin, true /* incoming */, false /* outgoing */,
          function() {
            appendLastErrorMessage(errors);
            chrome.webrtcLoggingPrivate.stopRtpDump(
                requestInfo, origin, false /* incoming */, true /* outgoing */,
                function() {
                  appendLastErrorMessage(errors);
                  chrome.webrtcLoggingPrivate.stop(
                      requestInfo, origin, function() {
                        appendLastErrorMessage(errors);
                        chrome.webrtcLoggingPrivate.upload(
                            requestInfo, origin, function(uploadValue) {
                              let errorMessage = null;
                              // If upload fails, report all previous errors.
                              // Otherwise, throw them away.
                              if (chrome.runtime.lastError !== undefined) {
                                appendLastErrorMessage(errors);
                                errorMessage = errors.join('; ');
                              }
                              doSendResponse(uploadValue, errorMessage);
                            });
                      });
                });
          });
      return true;
    } else if (method == 'logging.store') {
      const logId = message['logId'];
      chrome.webrtcLoggingPrivate.store(
          requestInfo, origin, logId, doSendResponse);
      return true;
    } else if (method == 'logging.discard') {
      chrome.webrtcLoggingPrivate.discard(requestInfo, origin, doSendResponse);
      return true;
    } else if (method == 'getSinks') {
      chrome.webrtcAudioPrivate.getSinks(doSendResponse);
      return true;
    } else if (method == 'getAssociatedSink') {
      const sourceId = message['sourceId'];
      chrome.webrtcAudioPrivate.getAssociatedSink(
          origin, sourceId, doSendResponse);
      return true;
    } else if (method == 'isExtensionEnabled') {
      // This method is necessary because there may be more than one
      // version of this extension, under different extension IDs. By
      // first calling this method on the extension ID, the client can
      // check if it's loaded; if it's not, the extension system will
      // call the callback with no arguments and set
      // chrome.runtime.lastError.
      doSendResponse();
      return false;
    } else if (method == 'getNaclArchitecture') {
      chrome.runtime.getPlatformInfo(function(obj) {
        doSendResponse(obj.nacl_arch);
      });
      return true;
    } else if (method == 'logging.startRtpDump') {
      const incoming = message['incoming'] || false;
      const outgoing = message['outgoing'] || false;
      chrome.webrtcLoggingPrivate.startRtpDump(
          requestInfo, origin, incoming, outgoing, doSendResponse);
      return true;
    } else if (method == 'logging.stopRtpDump') {
      const incoming = message['incoming'] || false;
      const outgoing = message['outgoing'] || false;
      chrome.webrtcLoggingPrivate.stopRtpDump(
          requestInfo, origin, incoming, outgoing, doSendResponse);
      return true;
    } else if (method == 'logging.startAudioDebugRecordings') {
      const seconds = message['seconds'] || 0;
      chrome.webrtcLoggingPrivate.startAudioDebugRecordings(
          requestInfo, origin, seconds, doSendResponse);
      return true;
    } else if (method == 'logging.stopAudioDebugRecordings') {
      chrome.webrtcLoggingPrivate.stopAudioDebugRecordings(
          requestInfo, origin, doSendResponse);
      return true;
    } else if (method == 'logging.startEventLogging') {
      const sessionId = message['sessionId'] || '';
      const maxLogSizeBytes = message['maxLogSizeBytes'] || 0;
      const outputPeriodMs = message['outputPeriodMs'] || -1;
      const webAppId = message['webAppId'] || 0;
      chrome.webrtcLoggingPrivate.startEventLogging(
          requestInfo, origin, sessionId, maxLogSizeBytes, outputPeriodMs,
          webAppId, doSendResponse);
      return true;
    } else if (method == 'getHardwarePlatformInfo') {
      chrome.enterprise.hardwarePlatform.getHardwarePlatformInfo(
          doSendResponse);
      return true;
    }

    throw new Error('Unknown method: ' + method);
  } catch (e) {
    doSendResponse(null, e.name + ': ' + e.message);
  }
});

// If Hangouts connects with a port named 'onSinksChangedListener', we
// will register a listener and send it a message {'eventName':
// 'onSinksChanged'} whenever the event fires.
function onSinksChangedPort(port) {
  function clientListener() {
    port.postMessage({'eventName': 'onSinksChanged'});
  }
  chrome.webrtcAudioPrivate.onSinksChanged.addListener(clientListener);

  port.onDisconnect.addListener(function() {
    chrome.webrtcAudioPrivate.onSinksChanged.removeListener(clientListener);
  });
}

// This is a one-time-use port for calling chooseDesktopMedia.  The page
// sends one message, identifying the requested source types, and the
// extension sends a single reply, with the user's selected streamId.  A port
// is used so that if the page is closed before that message is sent, the
// window picker dialog will be closed.
function onChooseDesktopMediaPort(port) {
  function sendResponse(streamId) {
    port.postMessage({'value': {'streamId': streamId}});
    port.disconnect();
  }

  port.onMessage.addListener(function(message) {
    const method = message['method'];
    if (method == 'chooseDesktopMedia') {
      const sources = message['sources'];
      let cancelId = null;
      if (port.sender.tab) {
        cancelId = chrome.desktopCapture.chooseDesktopMedia(
            sources, port.sender.tab, sendResponse);
      } else {
        const requestInfo = {};
        requestInfo['guestProcessId'] = port.sender.guestProcessId || 0;
        requestInfo['guestRenderFrameId'] =
            port.sender.guestRenderFrameRoutingId || 0;
        cancelId = chrome.webrtcDesktopCapturePrivate.chooseDesktopMedia(
            sources, requestInfo, sendResponse);
      }
      port.onDisconnect.addListener(function() {
        // This method has no effect if called after the user has selected a
        // desktop media source, so it does not need to be conditional.
        if (port.sender.tab) {
          chrome.desktopCapture.cancelChooseDesktopMedia(cancelId);
        } else {
          chrome.webrtcDesktopCapturePrivate.cancelChooseDesktopMedia(cancelId);
        }
      });
    }
  });
}

// A port for continuously reporting relevant CPU usage information to the page.
function onProcessCpu(port) {
  let tabPid = port.sender.guestProcessId || undefined;
  function processListener(processes) {
    if (tabPid == undefined) {
      // getProcessIdForTab sometimes fails, and does not call the callback.
      // (Tracked at https://crbug.com/368855.)
      // This call retries it on each process update until it succeeds.
      chrome.processes.getProcessIdForTab(port.sender.tab.id, function(x) {
        tabPid = x;
      });
      return;
    }
    const tabProcess = processes[tabPid];
    if (!tabProcess) {
      return;
    }

    let browserProcessCpu, gpuProcessCpu;
    for (const pid in processes) {
      const process = processes[pid];
      if (process.type == 'browser') {
        browserProcessCpu = process.cpu;
      } else if (process.type == 'gpu') {
        gpuProcessCpu = process.cpu;
      }
      if (browserProcessCpu && gpuProcessCpu) {
        break;
      }
    }

    port.postMessage({
      'browserCpuUsage': browserProcessCpu || 0,
      'gpuCpuUsage': gpuProcessCpu || 0,
      'tabCpuUsage': tabProcess.cpu,
      'tabNetworkUsage': tabProcess.network,
      'tabPrivateMemory': tabProcess.privateMemory,
      'tabJsMemoryAllocated': tabProcess.jsMemoryAllocated,
      'tabJsMemoryUsed': tabProcess.jsMemoryUsed
    });
  }

  chrome.processes.onUpdated.addListener(processListener);
  port.onDisconnect.addListener(function() {
    chrome.processes.onUpdated.removeListener(processListener);
  });
}

function appendLastErrorMessage(errors) {
  if (chrome.runtime.lastError !== undefined) {
    errors.push(chrome.runtime.lastError.message);
  }
}

chrome.runtime.onConnectExternal.addListener(function(port) {
  if (port.name == 'onSinksChangedListener') {
    onSinksChangedPort(port);
  } else if (port.name == 'chooseDesktopMedia') {
    onChooseDesktopMediaPort(port);
  } else if (port.name == 'processCpu') {
    onProcessCpu(port);
  } else {
    // Unknown port type.
    port.disconnect();
  }
});
<!doctype html>
<html i18n-values="dir:textdirection;lang:language">
  <head>
    <script src="edge://resources/js/i18n_template_no_process.js"></script>
  </head>
  <body>
    <div id="bluetooth-logs-info-container">
      <span i18n-content="bluetooth-logs-message"></span>
    </div>
  </body>
<html>

<!doctype html>
<html i18n-values="dir:textdirection;lang:language">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="edge://resources/css/apps/topbutton_bar.css"></link>
<style>/* Copyright 2019 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

html {
  height: 100%;
}

body {
  background-color: #fff;
  display: flex;
  flex-direction: column;
  height: 100%;
  margin: 0;
  overflow: auto;
  padding: 0;
  width: 100%;
}

#assistant-title-bar {
  -webkit-app-region: drag;
  align-items: center;
  background-color: #fff;
  display: flex;
  min-height: 20px;
}

#assistant-close-button {
  position: absolute;
  right: 0;
}

html[dir='rtl'] #assistant-close-button {
  left: 0;
  right: auto;
}

#assistant-logs-info-container {
  line-height: 20px;
  margin-bottom: 20px;
  margin-inline-end: 20px;
  margin-inline-start: 20px;
  margin-top: 20px;
  text-align: justify;
  text-justify: inter-word;
}
</style>

<script src="edge://resources/js/i18n_template_no_process.js"></script>
<script src="edge://resources/js/util.js"></script>
<script src="../js/assistant_logs_info.js"></script>
</head>
<body>
  <div id="assistant-title-bar" class="title-bar">
    <span class="topbutton-bar">
      <button class="close-button"
              id="assistant-close-button" tabindex="-1"
              i18n-values="aria-label:close-btn-label">
      </button>
    </span>
  </div>
  <div id="assistant-logs-info-container">
  <span i18n-content="assistant-logs-message"></span>
  </div>
</body>
</html>
<!doctype html>
<html i18n-values="dir:textdirection;lang:language">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="edge://resources/css/text_defaults.css">
<link rel="stylesheet" href="edge://resources/css/apps/common.css"></link>
<link rel="stylesheet" href="edge://resources/css/apps/topbutton_bar.css"></link>
<style>/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */


html {
  height: 100%;
}

body {
  background-color: #fbfbfb;
  display: flex;
  flex-direction: column;
  height: 100%;
  margin: 0;
  overflow: auto;
  padding: 0;
  width: 100%;
}

[hidden] {
  display: none !important;
}

.title-bar {
  -webkit-align-items: center;
  -webkit-app-region: drag;
  background-color: #fff;
  box-shadow: 0 1px #d0d0d0;
  color: rgb(80, 80, 82);
  display: -webkit-flex;
  font-size: 15px;
  min-height: 48px;
}

.title-bar #page-title {
  -webkit-flex: 1 1 auto;
  margin-inline-start: 20px;
}

.title-bar .button-bar {
  -webkit-flex: 0 1 auto;
}

.content {
  color: #646464;
  flex-grow: 1;
  font-size: 12px;
  margin: 20px;
}

.content #description-text {
  border-color: #c8c8c8;
  box-sizing: border-box;
  height: 120px;
  line-height: 18px;
  padding: 10px;
  resize: none;
  width: 100%;
}

.content #additional-info-label {
  margin-inline-start: 10px;
}

.content .text-field-container {
  -webkit-align-items: center;
  display: -webkit-flex;
  height: 29px;
  margin-top: 10px;
  padding-inline-start: 10px;
}

.content .text-field-container > label {
  -webkit-flex: 0 1 auto;
  width: 100px;
}

.content .text-field-container > select {
  border: 1px solid #c8c8c8;
  color: #585858;
  flex: 1 1 auto;
  height: 100%;
  padding-inline-start: 5px;
}

.content .text-field-container > input[type=text] {
  -webkit-flex: 1 1 auto;
  border: 1px solid;
  border-color: #c8c8c8;
  color: #585858;
  height: 100%;
  padding-inline-start: 5px;
}

.content .text-field-container > input[type=checkbox] {
  margin-inline-end: 9px;
}

.content .checkbox-field-container {
  -webkit-align-items: center;
  display: -webkit-flex;
  height: 29px;
}

#assistant-checkbox-container {
  align-items: flex-start;
  line-height: 20px;
  margin-bottom: 20px;
  margin-top: 7px;
  vertical-align: text-top;
}

#screenshot-container {
  margin-top: 10px;
}

.content #screenshot-image {
  display: block;
  height: 60px;
  margin-inline-end: 25px;
  margin-top: 40px;
  transition: all 250ms ease;
}

.content #screenshot-image:hover {
  height: 125px;
  margin-inline-end: 0;
  margin-top: 80px;
  z-index: 1;
}

.content #screenshot-image.wide-screen {
  height: auto;
  width: 100px;
}

.content #screenshot-image.wide-screen:hover {
  height: auto;
  width: 200px;
}

.content #screenshot-label {
  flex: auto;
}

.content #sys-info-container {
  margin-inline-end: 130px;
}

.content #privacy-note {
  color: #969696;
  font-size: 12px;
  line-height: 20px;
  margin-bottom: 0;
  margin-top: 20px;
  text-align: justify;
  text-justify: inter-word;
}

.content .buttons-pane {
  bottom: 20px;
  display: -webkit-flex;
  justify-content: flex-end;
  left: 20px;
  position: absolute;
  right: 20px;
}

.content .top-buttons {
  position: absolute;
}

#bottom-buttons-container {
  margin: 0;
}

.content .bottom-buttons {
  margin-bottom: 20px;
  margin-inline-end: 20px;
  margin-inline-start: 20px;
  margin-top: 0;
  position: static;
}

.content .remove-file-button {
  background-color: transparent;
  background-image: -webkit-image-set(
      url(edge://resources/images/apps/button_butter_bar_close.png) 1x,
      url(edge://resources/images/2x/apps/button_butter_bar_close.png) 2x);
  background-position: 50% 80%;
  background-repeat: no-repeat;
  border: none;
  height: 16px;
  margin-inline-start: 5px;
  pointer-events: auto;
  width: 16px;
}

.content .remove-file-button:hover {
  background-image: -webkit-image-set(
      url(edge://resources/images/apps/button_butter_bar_close_hover.png) 1x,
      url(edge://resources/images/2x/apps/button_butter_bar_close_hover.png) 2x);
}

.content .remove-file-button:active {
  background-image: -webkit-image-set(
      url(edge://resources/images/apps/button_butter_bar_close_pressed.png) 1x,
      url(edge://resources/images/2x/apps/button_butter_bar_close_pressed.png) 2x);
}

.content #attach-file-note {
  margin-bottom: 10px;
  margin-inline-start: 112px;
  margin-top: 10px;
}

.content .attach-file-notification {
  color: rgb(204, 0, 0);
  font-weight: bold;
}

button.white-button {
  color: #000;
  margin-inline-end: 10px;
}

button.blue-button {
  color: #fff;
  text-shadow: 1px sharp drop shadow rgb(45, 106, 218);
}
</style>

<script src="edge://resources/js/load_time_data.js"></script>
<script src="edge://resources/js/i18n_template_no_process.js"></script>
<script src="edge://resources/js/util.js"></script>
<script src="../js/feedback_util.js"></script>
<script src="../js/take_screenshot.js"></script>
<script src="../js/topbar_handlers.js"></script>
<script src="../js/feedback.js"></script>
</head>
<body>
  <div id="title-bar" class="title-bar">
    <span id="page-title" i18n-content="page-title"></span>
    <span class="topbutton-bar">
      <button class="minimize-button" id="minimize-button" tabindex="-1"
              i18n-values="aria-label:minimize-btn-label">
      </button>
      <button class="close-button" id="close-button" tabindex="-1"
              i18n-values="aria-label:close-btn-label">
      </button>
    </span>
  </div>
  <div id="content-pane" class="content">
    <textarea id="description-text" aria-labelledby="page-title"></textarea>
    <div>
      <p id="additional-info-label" i18n-content="additionalInfo"><p>
    </div>
    <div id="page-url" class="text-field-container">
      <label id="page-url-label" i18n-content="page-url"></label>
      <input id="page-url-text" aria-labelledby="page-url-label" type="text">
    </div>
    <!-- User e-mail -->
    <div id="user-email" class="text-field-container" hidden>
      <label id="user-email-label" i18n-content="user-email"></label>
      <select id="user-email-drop-down" aria-labelledby="user-email-label">
        <option id="anonymous-user-option" value="anonymous_user"
                i18n-content="anonymous-user"></option>
      </select>
    </div>
    <!-- Attach a file -->
    <div id="attach-file-container" class="text-field-container">
      <label id="attach-file-label" i18n-content="attach-file-label"></label>
      <input id="attach-file" type="file" aria-labelledby="attach-file-label">
      <div id="custom-file-container" hidden>
        <label id="attached-filename-text"></label>
        <button id="remove-attached-file" class="remove-file-button"></button>
      </div>
      <div id="attach-error" class="attach-file-notification"
          i18n-content="attach-file-to-big" hidden></div>
    </div>
    <div id="attach-file-note" i18n-content="attach-file-note"></div>
    <!-- Screenshot -->
    <div id="screenshot-container" class="checkbox-field-container">
      <input id="screenshot-checkbox" type="checkbox" aria-labelledby="screenshot-label">
      <label id="screenshot-label" i18n-content="screenshot"></label>
      <img id="screenshot-image">
    </div>
    <!-- System Information -->
    <div id="sys-info-container" class="checkbox-field-container">
      <input id="sys-info-checkbox" type="checkbox" aria-labelledby="sys-info-label" checked>
      <label id="sys-info-label" i18n-values=".innerHTML:sys-info"></label>
    </div>

    <!-- Privacy note -->
    <div id="privacy-note" i18n-values=".innerHTML:privacy-note"></div>
  </div>
  <!-- Buttons -->
  <div id="bottom-buttons-container" class="content">
    <div class="buttons-pane bottom-buttons">
      <button id="cancel-button" type="submit"
          class="white-button" i18n-content="cancel">
      </button>
      <button id="send-report-button" type="submit"
          class="blue-button" i18n-content="send-report">
      </button>
    </div>
  </div>
</body>
</html>
<!doctype html>
<html i18n-values="dir:textdirection;lang:language">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title i18n-content="sysinfoPageTitle"></title>
    <link rel="stylesheet" href="edge://resources/css/text_defaults.css">
    <link rel="stylesheet" href="edge://resources/css/spinner.css">
    <style>/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

#anchor {
  display: none;
}

body {
  font-size: 84%;
  margin: 0;
  min-width: 45em;
  padding: 0.75em;
}

.global-button {
  margin: 1px 3px 0 3px;
}

h1,
h2 {
  margin: 0;
}

h1 {
  color: rgb(74, 142, 230);
  font-size: 110%;
  font-weight: bold;
  padding: 0;
}

h2 {
  color: rgb(58, 117, 189);
  display: inline-block;
  font-size: 110%;
  font-weight: normal;
  padding-inline-end: 1em;
  padding-inline-start: 0;
}

#header {
  background: rgb(82, 150, 222);
  background-size: 100%;
  border: 1px solid rgb(58, 117, 189);
  border-radius: 6px;
  color: white;
  margin-bottom: 0.75em;
  overflow: hidden;
  padding: 0.5em 0;
  position: relative;
  text-shadow: 0 0 2px black;
}

html[dir='rtl'] #header {
  padding: 0.6em 0 0.75em 1em;
}

#header h1 {
  color: white;
  display: inline;
}

div#header h1::before {
  /* grit doesn't flatten -webkit-mask, so define the properties separately
  * for now. */
  -webkit-mask-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDQ4IDQ4Ij48cGF0aCBkPSJNMCAwaDQ4djQ4SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTM4Ljg2IDI1Ljk1Yy4wOC0uNjQuMTQtMS4yOS4xNC0xLjk1cy0uMDYtMS4zMS0uMTQtMS45NWw0LjIzLTMuMzFjLjM4LS4zLjQ5LS44NC4yNC0xLjI4bC00LTYuOTNjLS4yNS0uNDMtLjc3LS42MS0xLjIyLS40M2wtNC45OCAyLjAxYy0xLjAzLS43OS0yLjE2LTEuNDYtMy4zOC0xLjk3TDI5IDQuODRjLS4wOS0uNDctLjUtLjg0LTEtLjg0aC04Yy0uNSAwLS45MS4zNy0uOTkuODRsLS43NSA1LjNhMTQuOCAxNC44IDAgMCAwLTMuMzggMS45N0w5LjkgMTAuMWExIDEgMCAwIDAtMS4yMi40M2wtNCA2LjkzYy0uMjUuNDMtLjE0Ljk3LjI0IDEuMjhsNC4yMiAzLjMxQzkuMDYgMjIuNjkgOSAyMy4zNCA5IDI0cy4wNiAxLjMxLjE0IDEuOTVsLTQuMjIgMy4zMWMtLjM4LjMtLjQ5Ljg0LS4yNCAxLjI4bDQgNi45M2MuMjUuNDMuNzcuNjEgMS4yMi40M2w0Ljk4LTIuMDFjMS4wMy43OSAyLjE2IDEuNDYgMy4zOCAxLjk3bC43NSA1LjNjLjA4LjQ3LjQ5Ljg0Ljk5Ljg0aDhjLjUgMCAuOTEtLjM3Ljk5LS44NGwuNzUtNS4zYTE0LjggMTQuOCAwIDAgMCAzLjM4LTEuOTdsNC45OCAyLjAxYTEgMSAwIDAgMCAxLjIyLS40M2w0LTYuOTNjLjI1LS40My4xNC0uOTctLjI0LTEuMjhsLTQuMjItMy4zMXpNMjQgMzFjLTMuODcgMC03LTMuMTMtNy03czMuMTMtNyA3LTcgNyAzLjEzIDcgNy0zLjEzIDctNyA3eiIvPjwvc3ZnPg==);
  -webkit-mask-position: center;
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-size: 24px;
  background-color: white;
  content: '';
  display: inline-block;
  height: 20px;
  vertical-align: middle;
  width: 37px;
}

#header p {
  color: white;
  display: inline;
  font-size: 84%;
  font-style: italic;
  padding-inline-start: 0.4em;
}

.list {
  border-collapse: collapse;
  font-size: 84%;
  line-height: 200%;
  width: 100%;
}

.list:not(.filtered) tr:nth-child(odd) td {
  background: rgb(239, 243, 255);
}

.list td {
  font-family: 'Courier New', monospace;
  line-height: 1.4em;
  padding: 0 0.5em;
  padding-top: 0.35em;
  vertical-align: top;
}

.list tr td:nth-last-child(1),
.list tr th:nth-last-child(1) {
  padding-inline-end: 1em;
}

.list:not(.filtered) .tab .name {
  padding-inline-start: 1.5em;
}

.list .name {
  width: 20%;
}

.list .button-cell {
  width: 7%;
}

.list .name div {
  height: 1.6em;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.button-hidden {
  display: none;
}

.number-expanded,
.number-collapsed  {
  text-align: start;
  text-overflow: ellipsis;
  width: 80%;
}

tr > *:nth-child(1),
tr > *:nth-child(2) {
  border-inline-end: 1px solid rgb(181, 198, 222);
}

.name {
  background-position: 5em center;
  background-repeat: no-repeat;
}

.stat-value {
  text-overflow: ellipsis;
  white-space: pre-wrap;
}

html[dir='rtl'] #details .name {
  background-position-left: auto;
  background-position-right: 5em;
}

.number-collapsed .stat-value {
  display: none;
}

.number-expanded .stat-value {
  display: auto;
}

.spinner {
  animation: rotate 2s linear infinite;
  border: 4px solid rgb(239, 243, 255);
  border-radius: 50%;
  border-top: 4px solid rgb(82, 150, 222);
  height: 20px;
  width: 20px;
}

@keyframes rotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
    <style>/* Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

html,
body {
  overflow: visible;
  user-select: auto;
}

#detailsTable {
  margin-top: .5em;
}

#status {
  color: rgb(66, 133, 244);
  display: inline-block;
  margin: .5em .5em;
}</style>
    <script src="edge://resources/js/util.js"></script>
    <script src="edge://resources/js/i18n_template_no_process.js"></script>
    <script src="../js/sys_info.js"></script>
  </head>
  <body>
    <div id="header">
      <h1 id="title" i18n-content="sysinfoPageTitle"></h1>
      <p id="description" i18n-content="sysinfoPageDescription"></p>
    </div>
    <div id="content">
      <h2 id="tableTitle" i18n-content="sysinfoPageTableTitle"></h2>
      <div id="anchor"></div>
      <button id="expandAllBtn" class="global-button"
              i18n-content="sysinfoPageExpandAllBtn"></button>
      <button id="collapseAllBtn" class="global-button"
              i18n-content="sysinfoPageCollapseAllBtn"></button>
      <div id="spinner-container">
        <div class="inline-spinner"></div>
        <p id="status" i18n-content="sysinfoPageStatusLoading"></p>
      </div>
      <table class="list" id="detailsTable"></table>
    </div>
  </body>
</html>
// Copyright 2019 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Setup handlers for the minimize and close topbar buttons.
 */
function assistantInit() {
  const closeButton = $('assistant-close-button');
  closeButton.addEventListener('mousedown', function(e) {
    e.preventDefault();
  });
  closeButton.addEventListener('click', function() {
    chrome.app.window.current().close();
  });
  window.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      chrome.app.window.current().close();
    }
  }, false);
}
window.addEventListener('DOMContentLoaded', assistantInit);
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/** @type {string}
 * @const
 */
const FEEDBACK_LANDING_PAGE =
    'https://support.google.com/chrome/go/feedback_confirmation';

/** @type {string}
 * @const
 */
const FEEDBACK_LANDING_PAGE_TECHSTOP =
    'https://support.google.com/pixelbook/answer/7659411';

/** @type {string}
 * @const
 */
const FEEDBACK_LEGAL_HELP_URL =
    'https://support.google.com/legal/answer/3110420';

/** @type {string}
 * @const
 */
const FEEDBACK_PRIVACY_POLICY_URL = 'https://policies.google.com/privacy';

/** @type {string}
 * @const
 */
const FEEDBACK_TERM_OF_SERVICE_URL = 'https://policies.google.com/terms';

/**
 * Opens the supplied url in an app window. It uses the url as the window ID.
 * @param {string} url The destination URL for the link.
 */
function openUrlInAppWindow(url) {
  chrome.app.window.create(url, {
    frame: 'chrome',
    id: url,
    width: 640,
    height: 400,
    hidden: false,
    resizable: true
  });
}
// Copyright 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

// // Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/** @type {string}
 * @const
 */
const FEEDBACK_LANDING_PAGE =
    'https://support.google.com/chrome/go/feedback_confirmation';

/** @type {string}
 * @const
 */
const FEEDBACK_LANDING_PAGE_TECHSTOP =
    'https://support.google.com/pixelbook/answer/7659411';

/** @type {string}
 * @const
 */
const FEEDBACK_LEGAL_HELP_URL =
    'https://support.google.com/legal/answer/3110420';

/** @type {string}
 * @const
 */
const FEEDBACK_PRIVACY_POLICY_URL = 'https://policies.google.com/privacy';

/** @type {string}
 * @const
 */
const FEEDBACK_TERM_OF_SERVICE_URL = 'https://policies.google.com/terms';

/**
 * Opens the supplied url in an app window. It uses the url as the window ID.
 * @param {string} url The destination URL for the link.
 */
function openUrlInAppWindow(url) {
  chrome.app.window.create(url, {
    frame: 'chrome',
    id: url,
    width: 640,
    height: 400,
    hidden: false,
    resizable: true
  });
}


/**
 * @type {number}
 * @const
 */
const FEEDBACK_WIDTH = 500;
/**
 * @type {number}
 * @const
 */
const FEEDBACK_HEIGHT = 610;

/**
 * @type {string}
 * @const
 */
const FEEDBACK_DEFAULT_WINDOW_ID = 'default_window';

// To generate a hashed extension ID, use a sha-1 hash, all in lower case.
// Example:
//   echo -n 'abcdefghijklmnopqrstuvwxyzabcdef' | sha1sum | \
//       awk '{print toupper($1)}'
const whitelistedExtensionIds = [
  '12E618C3C6E97495AAECF2AC12DEB082353241C6',  // QuickOffice
  '3727DD3E564B6055387425027AD74C58784ACC15',  // QuickOffice
  '2FC374607C2DF285634B67C64A2E356C607091C3',  // QuickOffice
  '2843C1E82A9B6C6FB49308FDDF4E157B6B44BC2B',  // G+ Photos
  '5B5DA6D054D10DB917AF7D9EAE3C56044D1B0B03',  // G+ Photos
  '986913085E3E3C3AFDE9B7A943149C4D3F4C937B',  // Feedback Extension
  '7AE714FFD394E073F0294CFA134C9F91DB5FBAA4',  // Connectivity Diagnostics
  'C7DA3A55C2355F994D3FDDAD120B426A0DF63843',  // Connectivity Diagnostics
  '75E3CFFFC530582C583E4690EF97C70B9C8423B7',  // Connectivity Diagnostics
  '32A1BA997F8AB8DE29ED1BA94AAF00CF2A3FEFA7',  // Connectivity Diagnostics
  'A291B26E088FA6BA53FFD72F0916F06EBA7C585A',  // Chrome OS Recovery Tool
  'D7986543275120831B39EF28D1327552FC343960',  // Chrome OS Recovery Tool
  '8EBDF73405D0B84CEABB8C7513C9B9FA9F1DC2CE',  // GetHelp app.
  '97B23E01B2AA064E8332EE43A7A85C628AADC3F2',  // Chrome Remote Desktop Dev
  '9E527CDA9D7C50844E8A5DB964A54A640AE48F98',  // Chrome Remote Desktop Stable
  'DF52618D0B040D8A054D8348D2E84DDEEE5974E7',  // Chrome Remote Desktop QA
  '269D721F163E587BC53C6F83553BF9CE2BB143CD',  // Chrome Remote Desktop QA
                                               // backup
  'C449A798C495E6CF7D6AF10162113D564E67AD12',  // Chrome Remote Desktop Apps V2
  '981974CD1832B87BE6B21BE78F7249BB501E0DE6',  // Play Movies Dev
  '32FD7A816E47392C92D447707A89EB07EEDE6FF7',  // Play Movies Nightly
  '3F3CEC4B9B2B5DC2F820CE917AABDF97DB2F5B49',  // Play Movies Beta
  'F92FAC70AB68E1778BF62D9194C25979596AA0E6',  // Play Movies Stable
  '0F585FB1D0FDFBEBCE1FEB5E9DFFB6DA476B8C9B',  // Hangouts Extension
  '2D22CDB6583FD0A13758AEBE8B15E45208B4E9A7',  // Hangouts Extension
  '49DA0B9CCEEA299186C6E7226FD66922D57543DC',  // Hangouts Extension
  'E7E2461CE072DF036CF9592740196159E2D7C089',  // Hangouts Extension
  'A74A4D44C7CFCD8844830E6140C8D763E12DD8F3',  // Hangouts Extension
  '312745D9BF916161191143F6490085EEA0434997',  // Hangouts Extension
  '53041A2FA309EECED01FFC751E7399186E860B2C',  // Hangouts Extension
  '0F42756099D914A026DADFA182871C015735DD95',  // Hangouts Extension
  '1B7734733E207CCE5C33BFAA544CA89634BF881F',  // GLS nightly
  'E2ACA3D943A3C96310523BCDFD8C3AF68387E6B7',  // GLS stable
  'BA007D8D52CC0E2632EFCA03ACD003B0F613FD71',  // http://crbug.com/470411
  '5260FA31DE2007A837B7F7B0EB4A47CE477018C8',  // http://crbug.com/470411
  '4F4A25F31413D9B9F80E61D096DEB09082515267',  // http://crbug.com/470411
  'FBA0DE4D3EFB5485FC03760F01F821466907A743',  // http://crbug.com/470411
  'E216473E4D15C5FB14522D32C5F8DEAAB2CECDC6',  // http://crbug.com/470411
  '676A08383D875E51CE4C2308D875AE77199F1413',  // http://crbug.com/473845
  '869A23E11B308AF45A68CC386C36AADA4BE44A01',  // http://crbug.com/473845
  'E9CE07C7EDEFE70B9857B312E88F94EC49FCC30F',  // http://crbug.com/473845
  'A4577D8C2AF4CF26F40CBCA83FFA4251D6F6C8F8',  // http://crbug.com/478929
  'A8208CCC87F8261AFAEB6B85D5E8D47372DDEA6B',  // http://crbug.com/478929
  // TODO (ntang) Remove the following 2 hashes by 12/31/2017.
  'B620CF4203315F9F2E046EDED22C7571A935958D',  // http://crbug.com/510270
  'B206D8716769728278D2D300349C6CB7D7DE2EF9',  // http://crbug.com/510270
  'EFCF5358672FEE04789FD2EC3638A67ADEDB6C8C',  // http://crbug.com/514696
  'FAD85BC419FE00995D196312F53448265EFA86F1',  // http://crbug.com/516527
  'F33B037DEDA65F226B7409C2ADB0CF3F8565AB03',  // http://crbug.com/541769
  '969C788BCBC82FBBE04A17360CA165C23A419257',  // http://crbug.com/541769
  '3BC3740BFC58F06088B300274B4CFBEA20136342',  // http://crbug.com/541769
  '2B6C6A4A5940017146F3E58B7F90116206E84685',  // http://crbug.com/642141
  '96FF2FFA5C9173C76D47184B3E86D267B37781DE',  // http://crbug.com/642141
  'A3E3DE9E9F16B41D4A2FAD106BD6CA76B94A0C94',  // http://crbug.com/908458
  'C2ABD68C33A5B485971C9638B80D6A2E9CBA78C4',  // http://crbug.com/908458
  'B41E7F08E1179CC03CBD1F49E57CF353A40ADE07',  // http://crbug.com/908458
  'A948368FC53BE437A55FEB414106E207925482F5',  // ChromeOS Files App.
];

/**
 * Used to generate unique IDs for FeedbackRequest objects.
 * @type {number}
 */
let lastUsedId = 0;

/**
 * A FeedbackRequest object represents a unique feedback report, requested by an
 * instance of the feedback window. It contains the system information specific
 * to this report, the full feedbackInfo, and callbacks to send the report upon
 * request.
 */
class FeedbackRequest {
  constructor(feedbackInfo) {
    this.id_ = ++lastUsedId;
    this.feedbackInfo_ = feedbackInfo;
    this.onSystemInfoReadyCallback_ = null;
    this.isSystemInfoReady_ = false;
    this.reportIsBeingSent_ = false;
    this.isRequestCanceled_ = false;
    this.useSystemInfo_ = false;
  }

  /**
   * Called when the system information is sent from the C++ side.
   * @param {Object} sysInfo The received system information.
   */
  getSystemInformationCallback(sysInfo) {
    if (this.isRequestCanceled_) {
      // If the window had been closed before the system information was
      // received, we skip the rest of the operations and return immediately.
      return;
    }

    this.isSystemInfoReady_ = true;

    // Combine the newly received system information with whatever system
    // information we have in the feedback info (if any).
    if (this.feedbackInfo_.systemInformation) {
      this.feedbackInfo_.systemInformation =
          this.feedbackInfo_.systemInformation.concat(sysInfo);
    } else {
      this.feedbackInfo_.systemInformation = sysInfo;
    }

    if (this.onSystemInfoReadyCallback_ != null) {
      this.onSystemInfoReadyCallback_();
      this.onSystemInfoReadyCallback_ = null;
    }
  }

  /**
   * Retrieves the system information for this request object.
   * @param {function()} callback Invoked to notify the listener that the system
   * information has been received.
   */
  getSystemInformation(callback) {
    if (this.isSystemInfoReady_) {
      callback();
      return;
    }

    this.onSystemInfoReadyCallback_ = callback;
    // The C++ side must reply to the callback specific to this object.
    const boundCallback = this.getSystemInformationCallback.bind(this);
    chrome.feedbackPrivate.getSystemInformation(boundCallback);
  }

  /**
   * Sends the feedback report represented by the object, either now if system
   * information is ready, or later once it is.
   * @param {boolean} useSystemInfo True if the user would like the system
   * information to be sent with the report.
   */
  sendReport(useSystemInfo) {
    this.reportIsBeingSent_ = true;
    this.useSystemInfo_ = useSystemInfo;
    if (useSystemInfo && !this.isSystemInfoReady_) {
      this.onSystemInfoReadyCallback_ = this.sendReportNow;
      return;
    }
    this.sendReportNow();
  }

  /**
   * Sends the report immediately and removes this object once the report is
   * sent.
   */
  sendReportNow() {
    if (!this.useSystemInfo_) {
      // Clear the system information if the user doesn't want it to be sent.
      this.feedbackInfo_.systemInformation = null;
    }

    /** @const */ const ID = this.id_;
    /** @const */ const FLOW = this.feedbackInfo_.flow;
    chrome.feedbackPrivate.sendFeedback(
        this.feedbackInfo_, function(result, landingPageType) {
          if (result == chrome.feedbackPrivate.Status.SUCCESS) {
            console.log('Feedback: Report sent for request with ID ' + ID);
            if (FLOW != chrome.feedbackPrivate.FeedbackFlow.LOGIN &&
                landingPageType !=
                    chrome.feedbackPrivate.LandingPageType.NO_LANDING_PAGE) {
              const landingPage = landingPageType ==
                      chrome.feedbackPrivate.LandingPageType.NORMAL ?
                  FEEDBACK_LANDING_PAGE :
                  FEEDBACK_LANDING_PAGE_TECHSTOP;
              window.open(landingPage, '_blank');
            }
          } else {
            console.log(
                'Feedback: Report for request with ID ' + ID +
                ' will be sent later.');
          }
          if (FLOW == chrome.feedbackPrivate.FeedbackFlow.LOGIN) {
            chrome.feedbackPrivate.loginFeedbackComplete();
          }
        });
  }

  /**
   * Handles the event when the feedback UI window corresponding to this
   * FeedbackRequest instance is closed.
   */
  onWindowClosed() {
    if (!this.reportIsBeingSent_) {
      this.isRequestCanceled_ = true;
      if (this.feedbackInfo_.flow ==
          chrome.feedbackPrivate.FeedbackFlow.LOGIN) {
        chrome.feedbackPrivate.loginFeedbackComplete();
      }
    }
  }
}

/**
 * Function to determine whether or not a given extension id is whitelisted to
 * invoke the feedback UI. If the extension is whitelisted, the callback to
 * start the Feedback UI will be called.
 * @param {string} id the id of the sender extension.
 * @param {Function} startFeedbackCallback The callback function that will
 *     will start the feedback UI.
 * @param {Object} feedbackInfo The feedback info object to pass to the
 *     start feedback UI callback.
 */
function senderWhitelisted(id, startFeedbackCallback, feedbackInfo) {
  crypto.subtle.digest('SHA-1', new TextEncoder().encode(id))
      .then(function(hashBuffer) {
        let hashString = '';
        const hashView = new Uint8Array(hashBuffer);
        for (let i = 0; i < hashView.length; ++i) {
          const n = hashView[i];
          hashString += n < 0x10 ? '0' : '';
          hashString += n.toString(16);
        }
        if (whitelistedExtensionIds.indexOf(hashString.toUpperCase()) != -1) {
          startFeedbackCallback(feedbackInfo);
        }
      });
}

/**
 * Callback which gets notified once our feedback UI has loaded and is ready to
 * receive its initial feedback info object.
 * @param {Object} request The message request object.
 * @param {Object} sender The sender of the message.
 * @param {function(Object)} sendResponse Callback for sending a response.
 */
function feedbackReadyHandler(request, sender, sendResponse) {
  if (request.ready) {
    chrome.runtime.sendMessage({sentFromEventPage: true});
  }
}

/**
 * Callback which gets notified if another extension is requesting feedback.
 * @param {Object} request The message request object.
 * @param {Object} sender The sender of the message.
 * @param {function(Object)} sendResponse Callback for sending a response.
 */
function requestFeedbackHandler(request, sender, sendResponse) {
  if (request.requestFeedback) {
    senderWhitelisted(sender.id, startFeedbackUI, request.feedbackInfo);
  }
}

/**
 * Callback which starts up the feedback UI.
 * @param {Object} feedbackInfo Object containing any initial feedback info.
 */
function startFeedbackUI(feedbackInfo) {
  const win = chrome.app.window.get(FEEDBACK_DEFAULT_WINDOW_ID);
  if (win) {
    win.show();
    return;
  }
  chrome.app.window.create(
      'html/default.html', {
        frame: feedbackInfo.useSystemWindowFrame ? 'chrome' : 'none',
        id: FEEDBACK_DEFAULT_WINDOW_ID,
        innerBounds: {
          minWidth: FEEDBACK_WIDTH,
          minHeight: FEEDBACK_HEIGHT,
        },
        hidden: true,
        resizable: false
      },
      function(appWindow) {
        const request = new FeedbackRequest(feedbackInfo);

        // The feedbackInfo member of the new window should refer to the one in
        // its corresponding FeedbackRequest object to avoid copying and
        // duplicatations.
        appWindow.contentWindow.feedbackInfo = request.feedbackInfo_;

        // Define some functions for the new window so that it can call back
        // into here.

        // Define a function for the new window to get the system information.
        appWindow.contentWindow.getSystemInformation = function(callback) {
          request.getSystemInformation(callback);
        };

        // Define a function to request sending the feedback report.
        appWindow.contentWindow.sendFeedbackReport = function(useSystemInfo) {
          request.sendReport(useSystemInfo);
        };

        // Observe when the window is closed.
        appWindow.onClosed.addListener(function() {
          request.onWindowClosed();
        });
      });
}

chrome.runtime.onMessage.addListener(feedbackReadyHandler);
chrome.runtime.onMessageExternal.addListener(requestFeedbackHandler);
chrome.feedbackPrivate.onFeedbackRequested.addListener(startFeedbackUI);
// Copyright 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
/** @type {number}
 * @const
 */
const MAX_ATTACH_FILE_SIZE = 3 * 1024 * 1024;

/**
 * @type {number}
 * @const
 */
const FEEDBACK_MIN_WIDTH = 500;

/**
 * @type {number}
 * @const
 */
const FEEDBACK_MIN_HEIGHT = 585;

/**
 * @type {number}
 * @const
 */
const FEEDBACK_MIN_HEIGHT_LOGIN = 482;

/** @type {number}
 * @const
 */
const CONTENT_MARGIN_HEIGHT = 40;

/** @type {number}
 * @const
 */
const MAX_SCREENSHOT_WIDTH = 100;

/** @type {string}
 * @const
 */
const SYSINFO_WINDOW_ID = 'sysinfo_window';

let attachedFileBlob = null;
const lastReader = null;

/**
 * Determines whether the system information associated with this instance of
 * the feedback window has been received.
 * @type {boolean}
 */
let isSystemInfoReady = false;

/**
 * Regular expression to check for all variants of blu[e]toot[h] with or without
 * space between the words; for BT when used as an individual word, or as two
 * individual characters, and for BLE when used as an individual word. Case
 * insensitive matching.
 * @type {RegExp}
 */
const btRegEx = new RegExp('blu[e]?[ ]?toot[h]?|\\bb[ ]?t\\b|\\bble\\b', 'i');

/**
 * Regular expression to check for all strings indicating that a user can't
 * connect to a HID or Audio device. This is also a likely indication of a
 * Bluetooth related issue.
 * Sample strings this will match:
 * "I can't connect the speaker!",
 * "The keyboard has connection problem."
 * @type {RegExp}
 */
const cantConnectRegEx = new RegExp(
    '((headphone|keyboard|mouse|speaker)((?!(connect|pair)).*)(connect|pair))' +
        '|((connect|pair).*(headphone|keyboard|mouse|speaker))',
    'i');

/**
 * Regular expression to check for "tether" or "tethering". Case insensitive
 * matching.
 * @type {RegExp}
 */
const tetherRegEx = new RegExp('tether(ing)?', 'i');

/**
 * Regular expression to check for "Smart (Un)lock" or "Easy (Un)lock" with or
 * without space between the words. Case insensitive matching.
 * @type {RegExp}
 */
const smartLockRegEx = new RegExp('(smart|easy)[ ]?(un)?lock', 'i');

/**
 * The callback used by the sys_info_page to receive the event that the system
 * information is ready.
 * @type {function(sysInfo)}
 */
let sysInfoPageOnSysInfoReadyCallback = null;

/**
 * Reads the selected file when the user selects a file.
 * @param {Event} fileSelectedEvent The onChanged event for the file input box.
 */
function onFileSelected(fileSelectedEvent) {
  $('attach-error').hidden = true;
  const file = fileSelectedEvent.target.files[0];
  if (!file) {
    // User canceled file selection.
    attachedFileBlob = null;
    return;
  }

  if (file.size > MAX_ATTACH_FILE_SIZE) {
    $('attach-error').hidden = false;

    // Clear our selected file.
    $('attach-file').value = '';
    attachedFileBlob = null;
    return;
  }

  attachedFileBlob = file.slice();
}

/**
 * Clears the file that was attached to the report with the initial request.
 * Instead we will now show the attach file button in case the user wants to
 * attach another file.
 */
function clearAttachedFile() {
  $('custom-file-container').hidden = true;
  attachedFileBlob = null;
  feedbackInfo.attachedFile = null;
  $('attach-file').hidden = false;
}

/**
 * Sets up the event handlers for the given |anchorElement|.
 * @param {HTMLElement} anchorElement The <a> html element.
 * @param {string} url The destination URL for the link.
 * @param {boolean} useAppWindow true if the URL should be opened inside a new
 *                  App Window, false if it should be opened in a new tab.
 */
function setupLinkHandlers(anchorElement, url, useAppWindow) {
  anchorElement.onclick = function(e) {
    e.preventDefault();
    if (useAppWindow) {
      openUrlInAppWindow(url);
    } else {
      window.open(url, '_blank');
    }
  };

  anchorElement.onauxclick = function(e) {
    e.preventDefault();
  };
}

/**
 * Opens a new window with edge://slow_trace, downloading performance data.
 */
function openSlowTraceWindow() {
  chrome.app.window.create(
      'edge://slow_trace/tracing.zip#' + feedbackInfo.traceId);
}

/**
 * Checks if any keywords related to bluetooth have been typed. If they are,
 * we show the bluetooth logs option, otherwise hide it.
 * @param {Event} inputEvent The input event for the description textarea.
 */
function checkForBluetoothKeywords(inputEvent) {
  const isRelatedToBluetooth = btRegEx.test(inputEvent.target.value) ||
      cantConnectRegEx.test(inputEvent.target.value) ||
      tetherRegEx.test(inputEvent.target.value) ||
      smartLockRegEx.test(inputEvent.target.value);
  $('bluetooth-checkbox-container').hidden = !isRelatedToBluetooth;
}

/**
 * Sends the report; after the report is sent, we need to be redirected to
 * the landing page, but we shouldn't be able to navigate back, hence
 * we open the landing page in a new tab and sendReport closes this tab.
 * @return {boolean} True if the report was sent.
 */
function sendReport() {
  if ($('description-text').value.length == 0) {
    const description = $('description-text');
    description.placeholder = loadTimeData.getString('no-description');
    description.focus();
    return false;
  }

  // Prevent double clicking from sending additional reports.
  $('send-report-button').disabled = true;
  console.log('Feedback: Sending report');
  if (!feedbackInfo.attachedFile && attachedFileBlob) {
    feedbackInfo.attachedFile = {
      name: $('attach-file').value,
      data: attachedFileBlob
    };
  }

  feedbackInfo.description = $('description-text').value;
  feedbackInfo.pageUrl = $('page-url-text').value;
  feedbackInfo.email = $('user-email-drop-down').value;

  let useSystemInfo = false;
  let useHistograms = false;
  if ($('sys-info-checkbox') != null && $('sys-info-checkbox').checked) {
    // Send histograms along with system info.
    useSystemInfo = useHistograms = true;
  }

  // 

  // 

  feedbackInfo.sendHistograms = useHistograms;

  // If the user doesn't want to send the screenshot.
  if (!$('screenshot-checkbox').checked) {
    feedbackInfo.screenshot = null;
  }

  let productId = parseInt('' + feedbackInfo.productId);
  if (isNaN(productId)) {
    // For apps that still use a string value as the |productId|, we must clear
    // that value since the API uses an integer value, and a conflict in data
    // types will cause the report to fail to be sent.
    productId = null;
  }
  feedbackInfo.productId = productId;

  // Request sending the report, show the landing page (if allowed), and close
  // this window right away. The FeedbackRequest object that represents this
  // report will take care of sending the report in the background.
  sendFeedbackReport(useSystemInfo);
  scheduleWindowClose();
  return true;
}

/**
 * Click listener for the cancel button.
 * @param {Event} e The click event being handled.
 */
function cancel(e) {
  e.preventDefault();
  scheduleWindowClose();
  if (feedbackInfo.flow == chrome.feedbackPrivate.FeedbackFlow.LOGIN) {
    chrome.feedbackPrivate.loginFeedbackComplete();
  }
}

// 

function resizeAppWindow() {
  // We pick the width from the titlebar, which has no margins.
  let width = $('title-bar').scrollWidth;
  if (width < FEEDBACK_MIN_WIDTH) {
    width = FEEDBACK_MIN_WIDTH;
  }

  // We get the height by adding the titlebar height and the content height +
  // margins. We can't get the margins for the content-pane here by using
  // style.margin - the variable seems to not exist.
  let height = $('title-bar').scrollHeight + $('content-pane').scrollHeight +
      CONTENT_MARGIN_HEIGHT;

  let minHeight = FEEDBACK_MIN_HEIGHT;
  if (feedbackInfo.flow == chrome.feedbackPrivate.FeedbackFlow.LOGIN) {
    minHeight = FEEDBACK_MIN_HEIGHT_LOGIN;
  }
  height = Math.max(height, minHeight);

  chrome.app.window.current().resizeTo(width, height);
}

/**
 * A callback to be invoked when the background page of this extension receives
 * the system information.
 */
function onSystemInformation() {
  isSystemInfoReady = true;
  // In case the sys_info_page needs to be notified by this event, do so.
  if (sysInfoPageOnSysInfoReadyCallback != null) {
    sysInfoPageOnSysInfoReadyCallback(feedbackInfo.systemInformation);
    sysInfoPageOnSysInfoReadyCallback = null;
  }
}

/**
 * Close the window after 100ms delay.
 */
function scheduleWindowClose() {
  setTimeout(function() {
    window.close();
  }, 100);
}

/**
 * Initializes our page.
 * Flow:
 * .) DOMContent Loaded        -> . Request feedbackInfo object
 *                                . Setup page event handlers
 * .) Feedback Object Received -> . take screenshot
 *                                . request email
 *                                . request System info
 *                                . request i18n strings
 * .) Screenshot taken         -> . Show Feedback window.
 */
function initialize() {
  // Add listener to receive the feedback info object.
  chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {
    if (request.sentFromEventPage) {
      if (!feedbackInfo.flow) {
        feedbackInfo.flow = chrome.feedbackPrivate.FeedbackFlow.REGULAR;
      }

      if (feedbackInfo.includeBluetoothLogs) {
        assert(
            feedbackInfo.flow ==
            chrome.feedbackPrivate.FeedbackFlow.GOOGLE_INTERNAL);
        $('description-text')
            .addEventListener('input', checkForBluetoothKeywords);
      }

      if ($('assistant-checkbox-container') != null &&
          feedbackInfo.flow ==
              chrome.feedbackPrivate.FeedbackFlow.GOOGLE_INTERNAL &&
          feedbackInfo.fromAssistant) {
        $('assistant-checkbox-container').hidden = false;
      }

      $('description-text').textContent = feedbackInfo.description;
      if (feedbackInfo.descriptionPlaceholder) {
        $('description-text').placeholder = feedbackInfo.descriptionPlaceholder;
      }
      if (feedbackInfo.pageUrl) {
        $('page-url-text').value = feedbackInfo.pageUrl;
      }

      takeScreenshot(function(screenshotCanvas) {
        // We've taken our screenshot, show the feedback page without any
        // further delay.
        window.requestAnimationFrame(function() {
          resizeAppWindow();
        });
        chrome.app.window.current().show();

        // Allow feedback to be sent even if the screenshot failed.
        if (!screenshotCanvas) {
          $('screenshot-checkbox').disabled = true;
          $('screenshot-checkbox').checked = false;
          return;
        }

        screenshotCanvas.toBlob(function(blob) {
          $('screenshot-image').src = URL.createObjectURL(blob);
          // Only set the alt text when the src url is available, otherwise we'd
          // get a broken image picture instead. crbug.com/773985.
          $('screenshot-image').alt = 'screenshot';
          $('screenshot-image')
              .classList.toggle(
                  'wide-screen',
                  $('screenshot-image').width > MAX_SCREENSHOT_WIDTH);
          feedbackInfo.screenshot = blob;
        });
      });

      chrome.feedbackPrivate.getUserEmail(function(email) {
        // Never add an empty option.
        if (!email) {
          return;
        }
        const optionElement = document.createElement('option');
        optionElement.value = email;
        optionElement.text = email;
        optionElement.selected = true;
        // Make sure the "Report anonymously" option comes last.
        $('user-email-drop-down')
            .insertBefore(optionElement, $('anonymous-user-option'));

        // Now we can unhide the user email section:
        $('user-email').hidden = false;
      });

      // Initiate getting the system info.
      isSystemInfoReady = false;
      getSystemInformation(onSystemInformation);

      // An extension called us with an attached file.
      if (feedbackInfo.attachedFile) {
        $('attached-filename-text').textContent =
            feedbackInfo.attachedFile.name;
        attachedFileBlob = feedbackInfo.attachedFile.data;
        $('custom-file-container').hidden = false;
        $('attach-file').hidden = true;
      }

      // No URL and file attachment for login screen feedback.
      if (feedbackInfo.flow == chrome.feedbackPrivate.FeedbackFlow.LOGIN) {
        $('page-url').hidden = true;
        $('attach-file-container').hidden = true;
        $('attach-file-note').hidden = true;
      }

      // 
      chrome.feedbackPrivate.getStrings(feedbackInfo.flow, function(strings) {
        loadTimeData.data = strings;
        i18nTemplate.process(document, loadTimeData);

        const sysInfoUrlElement = $('sys-info-url');
        if (sysInfoUrlElement) {
          // Opens a new window showing the full anonymized system+app
          // information.
          sysInfoUrlElement.onclick = function(e) {
            e.preventDefault();
            const win = chrome.app.window.get(SYSINFO_WINDOW_ID);
            if (win) {
              win.show();
              return;
            }
            chrome.app.window.create(
                '/html/sys_info.html', {
                  frame: 'chrome',
                  id: SYSINFO_WINDOW_ID,
                  width: 640,
                  height: 400,
                  hidden: false,
                  resizable: true
                },
                function(appWindow) {
                  // Define functions for the newly created window.

                  // Gets the full system information for the new window.
                  appWindow.contentWindow.getFullSystemInfo = function(
                      callback) {
                    if (isSystemInfoReady) {
                      callback(feedbackInfo.systemInformation);
                      return;
                    }

                    sysInfoPageOnSysInfoReadyCallback = callback;
                  };

                  // Returns the loadTimeData for the new window.
                  appWindow.contentWindow.getLoadTimeData = function() {
                    return loadTimeData;
                  };
                });
          };

          sysInfoUrlElement.onauxclick = function(e) {
            e.preventDefault();
          };
        }

        const histogramUrlElement = $('histograms-url');
        if (histogramUrlElement) {
          // Opens a new window showing the histogram metrics.
          setupLinkHandlers(
              histogramUrlElement, 'edge://histograms',
              true /* useAppWindow */);
        }

        const legalHelpPageUrlElement = $('legal-help-page-url');
        if (legalHelpPageUrlElement) {
          setupLinkHandlers(
              legalHelpPageUrlElement, FEEDBACK_LEGAL_HELP_URL,
              false /* useAppWindow */);
        }

        const privacyPolicyUrlElement = $('privacy-policy-url');
        if (privacyPolicyUrlElement) {
          setupLinkHandlers(
              privacyPolicyUrlElement, FEEDBACK_PRIVACY_POLICY_URL,
              false /* useAppWindow */);
        }

        const termsOfServiceUrlElement = $('terms-of-service-url');
        if (termsOfServiceUrlElement) {
          setupLinkHandlers(
              termsOfServiceUrlElement, FEEDBACK_TERM_OF_SERVICE_URL,
              false /* useAppWindow */);
        }

        const bluetoothLogsInfoLinkElement = $('bluetooth-logs-info-link');
        if (bluetoothLogsInfoLinkElement) {
          bluetoothLogsInfoLinkElement.onclick = function(e) {
            e.preventDefault();

            chrome.app.window.create(
                '/html/bluetooth_logs_info.html',
                {width: 400, height: 120, resizable: false},
                function(appWindow) {
                  appWindow.contentWindow.onload = function() {
                    i18nTemplate.process(
                        appWindow.contentWindow.document, loadTimeData);
                  };
                });

            bluetoothLogsInfoLinkElement.onauxclick = function(e) {
              e.preventDefault();
            };
          };
        }

        const assistantLogsInfoLinkElement = $('assistant-logs-info-link');
        if (assistantLogsInfoLinkElement) {
          assistantLogsInfoLinkElement.onclick = function(e) {
            e.preventDefault();

            chrome.app.window.create(
                '/html/assistant_logs_info.html',
                {width: 400, height: 120, resizable: false, frame: 'none'},
                function(appWindow) {
                  appWindow.contentWindow.onload = function() {
                    i18nTemplate.process(
                        appWindow.contentWindow.document, loadTimeData);
                  };
                });

            assistantLogsInfoLinkElement.onauxclick = function(e) {
              e.preventDefault();
            };
          };
        }

        // Make sure our focus starts on the description field.
        $('description-text').focus();
      });
    }
  });

  window.addEventListener('DOMContentLoaded', function() {
    // Ready to receive the feedback object.
    chrome.runtime.sendMessage({ready: true});

    // Setup our event handlers.
    $('attach-file').addEventListener('change', onFileSelected);
    $('send-report-button').onclick = sendReport;
    $('cancel-button').onclick = cancel;
    $('remove-attached-file').onclick = clearAttachedFile;
    // 
  });
}

initialize();
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * The global load time data that contains the localized strings that we will
 * get from the main page when this page first loads.
 */
let loadTimeData = null;

/**
 * A queue of a sequence of closures that will incrementally build the sys info
 * html table.
 */
const tableCreationClosuresQueue = [];

/**
 * The time used to post delayed tasks in MS. Currently set to be enough for two
 * frames.
 */
const STANDARD_DELAY_MS = 32;

function getValueDivForButton(button) {
  return $(button.id.substr(0, button.id.length - 4));
}

function getButtonForValueDiv(valueDiv) {
  return $(valueDiv.id + '-btn');
}

/**
 * Expands the multiline table cell that contains the given valueDiv.
 * @param {HTMLElement} button The expand button.
 * @param {HTMLElement} valueDiv The div that contains the multiline logs.
 * @param {number} delayFactor A value used for increasing the delay after which
 *     the cell will be expanded. Useful for expandAll() since it expands the
 *     multiline cells one after another with each expension done slightly after
 *     the previous one.
 */
function expand(button, valueDiv, delayFactor) {
  button.textContent = loadTimeData.getString('sysinfoPageCollapseBtn');
  // Show the spinner container.
  const valueCell = valueDiv.parentNode;
  valueCell.firstChild.hidden = false;
  // Expanding huge logs can take a very long time, so we do it after a delay
  // to have a chance to render the spinner.
  setTimeout(function() {
    valueCell.className = 'number-expanded';
    // Hide the spinner container.
    valueCell.firstChild.hidden = true;
  }, STANDARD_DELAY_MS * delayFactor);
}

/**
 * Collapses the multiline table cell that contains the given valueDiv.
 * @param {HTMLElement} button The expand button.
 * @param {HTMLElement} valueDiv The div that contains the multiline logs.
 */
function collapse(button, valueDiv) {
  button.textContent = loadTimeData.getString('sysinfoPageExpandBtn');
  valueDiv.parentNode.className = 'number-collapsed';
}

/**
 * Toggles whether an item is collapsed or expanded.
 */
function changeCollapsedStatus() {
  const valueDiv = getValueDivForButton(this);
  if (valueDiv.parentNode.className == 'number-collapsed') {
    expand(this, valueDiv, 1);
  } else {
    collapse(this, valueDiv);
  }
}

/**
 * Collapses all log items.
 */
function collapseAll() {
  const valueDivs = document.getElementsByClassName('stat-value');
  for (let i = 0; i < valueDivs.length; ++i) {
    if (valueDivs[i].parentNode.className != 'number-expanded') {
      continue;
    }
    const button = getButtonForValueDiv(valueDivs[i]);
    if (button) {
      collapse(button, valueDivs[i]);
    }
  }
}

/**
 * Expands all log items.
 */
function expandAll() {
  const valueDivs = document.getElementsByClassName('stat-value');
  for (let i = 0; i < valueDivs.length; ++i) {
    if (valueDivs[i].parentNode.className != 'number-collapsed') {
      continue;
    }
    const button = getButtonForValueDiv(valueDivs[i]);
    if (button) {
      expand(button, valueDivs[i], i + 1);
    }
  }
}

function createNameCell(key) {
  const nameCell = document.createElement('td');
  nameCell.setAttribute('class', 'name');
  const nameDiv = document.createElement('div');
  nameDiv.setAttribute('class', 'stat-name');
  nameDiv.appendChild(document.createTextNode(key));
  nameCell.appendChild(nameDiv);
  return nameCell;
}

function createButtonCell(key, isMultiLine) {
  const buttonCell = document.createElement('td');
  buttonCell.setAttribute('class', 'button-cell');

  if (isMultiLine) {
    const button = document.createElement('button');
    button.setAttribute('id', '' + key + '-value-btn');
    button.onclick = changeCollapsedStatus;
    button.textContent = loadTimeData.getString('sysinfoPageExpandBtn');
    buttonCell.appendChild(button);
  }

  return buttonCell;
}

function createValueCell(key, value, isMultiLine) {
  const valueCell = document.createElement('td');
  const valueDiv = document.createElement('div');
  valueDiv.setAttribute('class', 'stat-value');
  valueDiv.setAttribute('id', '' + key + '-value');
  valueDiv.appendChild(document.createTextNode(value));

  if (isMultiLine) {
    valueCell.className = 'number-collapsed';
    const loadingContainer = $('spinner-container').cloneNode(true);
    loadingContainer.setAttribute('id', '' + key + '-value-loading');
    loadingContainer.hidden = true;
    valueCell.appendChild(loadingContainer);
  } else {
    valueCell.className = 'number';
  }

  valueCell.appendChild(valueDiv);
  return valueCell;
}

function createTableRow(key, value) {
  const row = document.createElement('tr');

  // Avoid using element.scrollHeight as it's very slow. crbug.com/653968.
  const isMultiLine = value.split('\n').length > 2 || value.length > 1000;

  row.appendChild(createNameCell(key));
  row.appendChild(createButtonCell(key, isMultiLine));
  row.appendChild(createValueCell(key, value, isMultiLine));

  return row;
}

/**
 * Finalize the page after the content has been loaded.
 */
function finishPageLoading() {
  $('collapseAllBtn').onclick = collapseAll;
  $('expandAllBtn').onclick = expandAll;

  $('spinner-container').hidden = true;
}

/**
 * Pops a closure from the front of the queue and executes it.
 */
function processQueue() {
  const closure = tableCreationClosuresQueue.shift();
  if (closure) {
    closure();
  }

  if (tableCreationClosuresQueue.length > 0) {
    // Post a task to process the next item in the queue.
    setTimeout(processQueue, STANDARD_DELAY_MS);
  }
}

/**
 * Creates a closure that creates a table row for the given key and value.
 * @param {string} key The name of the log.
 * @param {string} value The contents of the log.
 * @return {function():void} A closure that creates a row for the given log.
 */
function createTableRowWrapper(key, value) {
  return function() {
    $('detailsTable').appendChild(createTableRow(key, value));
  };
}

/**
 * Creates closures to build the system information table row by row
 * incrementally.
 * @param {Object} systemInfo The system information that will be used to fill
 * the table.
 */
function createTable(systemInfo) {
  for (const key in systemInfo) {
    const item = systemInfo[key];
    tableCreationClosuresQueue.push(
        createTableRowWrapper(item['key'], item['value']));
  }

  tableCreationClosuresQueue.push(finishPageLoading);

  processQueue();
}

/**
 * Initializes the page when the window is loaded.
 */
window.onload = function() {
  loadTimeData = getLoadTimeData();
  i18nTemplate.process(document, loadTimeData);
  getFullSystemInfo(createTable);
};
// Copyright 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Function to take the screenshot of the current screen.
 * @param {function(HTMLCanvasElement)} callback Callback for returning the
 *     canvas with the screenshot. Called with null if the screenshot failed.
 */
function takeScreenshot(callback) {
  let screenshotStream = null;
  const video = document.createElement('video');

  video.addEventListener('canplay', function(e) {
    if (screenshotStream) {
      const canvas = document.createElement('canvas');
      canvas.setAttribute('width', video.videoWidth);
      canvas.setAttribute('height', video.videoHeight);
      canvas.getContext('2d').drawImage(
          video, 0, 0, video.videoWidth, video.videoHeight);

      video.pause();
      video.srcObject = null;

      screenshotStream.getVideoTracks()[0].stop();
      screenshotStream = null;

      callback(canvas);
    }
  }, false);

  navigator.webkitGetUserMedia(
      {
        video: {
          mandatory:
              {chromeMediaSource: 'screen', maxWidth: 4096, maxHeight: 2560}
        }
      },
      function(stream) {
        if (stream) {
          screenshotStream = stream;
          video.srcObject = screenshotStream;
          video.play();
        }
      },
      function(err) {
        console.error(
            'takeScreenshot failed: ' + err.name + '; ' + err.message + '; ' +
            err.constraintName);
        callback(null);
      });
}
// Copyright 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Setup handlers for the minimize and close topbar buttons.
 */
function initializeHandlers() {
  // If this dialog is using system window controls, these elements aren't
  // needed at all.
  if (window.feedbackInfo.useSystemWindowFrame) {
    $('minimize-button').hidden = true;
    $('close-button').hidden = true;
    return;
  }
  $('minimize-button').addEventListener('click', function(e) {
    e.preventDefault();
    chrome.app.window.current().minimize();
  });

  $('minimize-button').addEventListener('mousedown', function(e) {
    e.preventDefault();
  });

  $('close-button').addEventListener('click', function() {
    scheduleWindowClose();
  });

  $('close-button').addEventListener('mousedown', function(e) {
    e.preventDefault();
  });
}

window.addEventListener('DOMContentLoaded', initializeHandlers);
/* Copyright 2019 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

html {
  height: 100%;
}

body {
  background-color: #fff;
  display: flex;
  flex-direction: column;
  height: 100%;
  margin: 0;
  overflow: auto;
  padding: 0;
  width: 100%;
}

#assistant-title-bar {
  -webkit-app-region: drag;
  align-items: center;
  background-color: #fff;
  display: flex;
  min-height: 20px;
}

#assistant-close-button {
  position: absolute;
  right: 0;
}

html[dir='rtl'] #assistant-close-button {
  left: 0;
  right: auto;
}

#assistant-logs-info-container {
  line-height: 20px;
  margin-bottom: 20px;
  margin-inline-end: 20px;
  margin-inline-start: 20px;
  margin-top: 20px;
  text-align: justify;
  text-justify: inter-word;
}
/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */


html {
  height: 100%;
}

body {
  background-color: #fbfbfb;
  display: flex;
  flex-direction: column;
  height: 100%;
  margin: 0;
  overflow: auto;
  padding: 0;
  width: 100%;
}

[hidden] {
  display: none !important;
}

.title-bar {
  -webkit-align-items: center;
  -webkit-app-region: drag;
  background-color: #fff;
  box-shadow: 0 1px #d0d0d0;
  color: rgb(80, 80, 82);
  display: -webkit-flex;
  font-size: 15px;
  min-height: 48px;
}

.title-bar #page-title {
  -webkit-flex: 1 1 auto;
  margin-inline-start: 20px;
}

.title-bar .button-bar {
  -webkit-flex: 0 1 auto;
}

.content {
  color: #646464;
  flex-grow: 1;
  font-size: 12px;
  margin: 20px;
}

.content #description-text {
  border-color: #c8c8c8;
  box-sizing: border-box;
  height: 120px;
  line-height: 18px;
  padding: 10px;
  resize: none;
  width: 100%;
}

.content #additional-info-label {
  margin-inline-start: 10px;
}

.content .text-field-container {
  -webkit-align-items: center;
  display: -webkit-flex;
  height: 29px;
  margin-top: 10px;
  padding-inline-start: 10px;
}

.content .text-field-container > label {
  -webkit-flex: 0 1 auto;
  width: 100px;
}

.content .text-field-container > select {
  border: 1px solid #c8c8c8;
  color: #585858;
  flex: 1 1 auto;
  height: 100%;
  padding-inline-start: 5px;
}

.content .text-field-container > input[type=text] {
  -webkit-flex: 1 1 auto;
  border: 1px solid;
  border-color: #c8c8c8;
  color: #585858;
  height: 100%;
  padding-inline-start: 5px;
}

.content .text-field-container > input[type=checkbox] {
  margin-inline-end: 9px;
}

.content .checkbox-field-container {
  -webkit-align-items: center;
  display: -webkit-flex;
  height: 29px;
}

#assistant-checkbox-container {
  align-items: flex-start;
  line-height: 20px;
  margin-bottom: 20px;
  margin-top: 7px;
  vertical-align: text-top;
}

#screenshot-container {
  margin-top: 10px;
}

.content #screenshot-image {
  display: block;
  height: 60px;
  margin-inline-end: 25px;
  margin-top: 40px;
  transition: all 250ms ease;
}

.content #screenshot-image:hover {
  height: 125px;
  margin-inline-end: 0;
  margin-top: 80px;
  z-index: 1;
}

.content #screenshot-image.wide-screen {
  height: auto;
  width: 100px;
}

.content #screenshot-image.wide-screen:hover {
  height: auto;
  width: 200px;
}

.content #screenshot-label {
  flex: auto;
}

.content #sys-info-container {
  margin-inline-end: 130px;
}

.content #privacy-note {
  color: #969696;
  font-size: 12px;
  line-height: 20px;
  margin-bottom: 0;
  margin-top: 20px;
  text-align: justify;
  text-justify: inter-word;
}

.content .buttons-pane {
  bottom: 20px;
  display: -webkit-flex;
  justify-content: flex-end;
  left: 20px;
  position: absolute;
  right: 20px;
}

.content .top-buttons {
  position: absolute;
}

#bottom-buttons-container {
  margin: 0;
}

.content .bottom-buttons {
  margin-bottom: 20px;
  margin-inline-end: 20px;
  margin-inline-start: 20px;
  margin-top: 0;
  position: static;
}

.content .remove-file-button {
  background-color: transparent;
  background-image: -webkit-image-set(
      url(edge://resources/images/apps/button_butter_bar_close.png) 1x,
      url(edge://resources/images/2x/apps/button_butter_bar_close.png) 2x);
  background-position: 50% 80%;
  background-repeat: no-repeat;
  border: none;
  height: 16px;
  margin-inline-start: 5px;
  pointer-events: auto;
  width: 16px;
}

.content .remove-file-button:hover {
  background-image: -webkit-image-set(
      url(edge://resources/images/apps/button_butter_bar_close_hover.png) 1x,
      url(edge://resources/images/2x/apps/button_butter_bar_close_hover.png) 2x);
}

.content .remove-file-button:active {
  background-image: -webkit-image-set(
      url(edge://resources/images/apps/button_butter_bar_close_pressed.png) 1x,
      url(edge://resources/images/2x/apps/button_butter_bar_close_pressed.png) 2x);
}

.content #attach-file-note {
  margin-bottom: 10px;
  margin-inline-start: 112px;
  margin-top: 10px;
}

.content .attach-file-notification {
  color: rgb(204, 0, 0);
  font-weight: bold;
}

button.white-button {
  color: #000;
  margin-inline-end: 10px;
}

button.blue-button {
  color: #fff;
  text-shadow: 1px sharp drop shadow rgb(45, 106, 218);
}
/* Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

html,
body {
  overflow: visible;
  user-select: auto;
}

#detailsTable {
  margin-top: .5em;
}

#status {
  color: rgb(66, 133, 244);
  display: inline-block;
  margin: .5em .5em;
}PNG

   IHDR   0   0   W   gAMA  a  IDAThYIhW/C!n
NY
Ei<b'u(
k.,g	nU+tg@,p<wTJ;sKog o:tX,nGoZUkr$t+WWWpB?m?
yf[M0 ^EE~/_92T[{fX>&JmQ",ZSg8QeK*D~/]Dg]@GGG+DjZ^6M|l_pOW^u 39$@P3x,[3qlYt <EfT<[>+[*EE=1T,3!8-4+JLL"_?144py V \zQ-ogZ m(bMOC;!L&VmX$Y)`O[08%K|:EO T`ZJ(;IxS.KE4lp[MHHcz#M>esJFR,P'Yo[g2-gJg!J;;|TnsYCwYX?aky{K 0l6o</gu~S?11jH1,9j+X"qsJ5$w={W___KIn!Vd|}y~EmvDie)N|CY[Ef}0Uv. M{;$H}E/_tK.M\<z@eJg;@,J_m,PPE`aSar%`]RdR0?ilQX**%.9m-Z&
62:e'+
4@DM-D^c 0Vuq-+<^Aj	]>XFO>=zBG>U"-R*eElX>SMv^=VTDfg>\t]NeMycC~*8 Z"mp9SJ-h2Sc4Lp#D'K\-;w:T<e.'
gU*G,89}NRL*L~`L9Fe9*dK={?[GT2ymE
w}0~8 {+yurs@	4%8v[-
^RqLMXv/
ZEAV:L	~p'Txbh{;v38x n0eMg7(B2aL	$iQg%- s*^h3' [G :|d\N10|l*y&dQh0S~Y_s3b*kO9a0""RC]LEl7oFxE
J[?lyVcOyZft~ >w&6Ep5Tm1b_8gT,cPDBLlE3#PJ}NXxT)+s'6lVi+fjz!z8|Jf{wV+WF ab&WEP/IZ|GeES(PWN7M2_Y
>VllkW+U-;IEUF0|BK=(l'@`sx'nW0~Y@[k|uV2E?
Ke    IENDB`PNG

   IHDR         Rl   gAMA  a  ?@IDATxyWUo@101/D*@HA[$"BuIcS
b)NP`J@C9PBHX-HP#FD2Iz};;wk}3u[W`]uXW`]uXW`]uXW`]uXW`]uXW`];{~}7GwDpqwRXtqD-/Bo.86ko/'8^UmXoj'B-ZQu^.KQEYvPw}U.W-
,?+]=@^j}-'5{s~_!EQaJOmC>{7?Em~{N?gR_oN].}B-o
uK(_bvm[(,t64}!y{nT~h|Y1y]tXnf;*by^Alz.(sAqV`p	6v}a75*4Bb%.3UyUWx;,y|VoM<2Q'EF`S!le${km7FHMl-":_\Ts9s7/\.>PKwC:sqqI'-ye[M-Jtty^vJMKkFv
[nenZ\2b_R^k{^I{~{2!lk6k^W;e8Fkrvo+=thQNE:d?w?6ui%gMM"zK/=IvTo ZZI;G_8.<4/.K_/]=19N>>B0oM8z?ge]\Ty<_pi/1IxsEkSMg#pTV^0.~^?>3y/J$^]Cr7$Ov!M~HM{1sh%/l'y\Kk^m	A:Qj^_~8o\\yQ|;M{e|c&ei;M)^%xG}x_L7`cK7/wCax;6=caZm|cCq),%]V_|(&zjRMYuu-enZpO2Pe|"m/`+/;Yym-}&"YrC%/9.w.;<q"Q691?o.&I[S_-M1C[Ly3otvm__wMxnX|Wt&:I4}2fbF!/+|k_nsVwKigtr\cl&)?zN9!={?iKko#bl>
~.Pcs4d_T;ik?q[LOe9O:G|3?z]Hx`~^&;x/|a&T>[.|/V+3eMaX-q7)k !z9|#i}juZ;T`DYNt7{\`~m29P~g6	5w?Vk	~}Kzq]k64uBSbo7>[SrLCqscaW'sU=2=pS?O~=RghgSI9q`zx=:HrsLayToQ<g}b_mzBySs/h{D&~9N-PsN5U#1QzlRo6_Gs3QIm})r:6>kKo=O{^u}/6@}*CyTi9aNPGyN|bG&/U+.uiz37^X)+on:h&Tqcqf~^rhzr}&8k:~y^z-)G{Y/X^MM}ooa|yO't(O{KGs[,~ReZNt*%IK\+ll9w\R]k#m^=5Zh{?lR|('K:NvPL_C.=Vn6~ZH\M{b20+O;~wjO\swsXv^\k~>CR`?JA/	~L11^|61<:[Yb.C3>vF'D:sOw= |<x,F7	?9as|O:oe.T={mbOCs|'Sn/uz8mE*TkUT{eW7D{z2Mq=5O}C,4}JG}~B3OU-S{o"!N61m''];eVn{m,FZ>}kcu9tC=(ee\Z[$0Cj<+??sH^XV+}<P'<]fZdk+syb:v4So[T?/_Z?qM;qcMilC<Z6h's,@5lG^q3TL$u_TWvK'O{1eiiN|4WSP?U_%8 ?pL]d
Oe|a37~zF?X)e[7}%gRwkL2r$7v	Tc5hs9hdCb<c<qKc7gG;1=:>c9!/M?kS
kkvP}I%|sC'3;.?}4mvC39k12GpTp}=_v:=k; -&$U*c$M<'~7Yrh!W[*}c330%P^Z7Xe,<1c;'C/VT+-^j\N<r oVi>xe-RSo ~c]t_ajk,
k,T6N{829zV8>jL^,MU/.e-X[)	~G7 k	x=uG@&\sd)3uhy}9|c'1dh?6=k5UGwtq/u<G98y'UZ9^oUj6TIy[}O%e3oqPgMXc).9kO^{I|ifa(|#SgRUx}a+/U~EYb{2R1<ek%*os~i~;Y; ^Uo_/8on-^)jrlz7eryibJU|7No+3>6yq+mx_xf}v2Sy)~Gb
O1n23%>Oyr}%M^6^ig~.b-c7!2KN}iESoK{Xu-*}u-j+EsH]K'#wLbUR1s(cMp|%sl0><?z<9YKY<}reST|S9'9kvYK?cRo9}nYs917@U}q}EYxm>!n>>>o}W{#NNK)OyA=~Y^9-~[z}J}gIb4Z![f^)[oc%?CRr*fHV?O9XcHS
o|n7GyYg|e_l-KI$z:#>moxbm	W_gg-oSvnWg{fnkU>'~O-l.LT,K[?SK	?3?Q@/)^ 7^_o.g*y|8po~HvLz?s`6d53qPYkqg/D]+@;^r%/Ksei;.K;Cc_+OTo KDx|+M.#7,WwVpe;-|G4mSvks|0+m m+(Ibk^)>Ypi(3<s	\h=HC9+N-|dGc+ma|^%6+_B=cgMSV nD>}XYnzW0M.Q7Er%Vp.Xnpkq&?)wvO'k5Y.i--[4=~6))L^4mJ2&W=UkdQG6O/rxU.ELK;72/==l3@}5y,K/C{>>kco+7mD&`yA_X\- |~Gmr'k1C}}J)j7HCMc1Oz ,8IeyOx[5\cKmSN9db-F&~.~e!~Ge%kA')?>-VX?_jOT<',4"3&f.ceh'ql1^uvY#p?j4k-j?ag{(!1{`PF=r=\ro.?/:heyY<c`l\FS6 OYo~=9xd2<i9| 7?ls6{E2&rsj`X~mM/77xM=}k5cp'%v,vZ?-.F,sLIcJMSA?yC	zGHZgozu!?[-Go2b(t*7_b3\8==~1A2sF//m`R\
FAvLC|):}O&K$5Tt*U.G~J
GGRTK!`-?:(-~}UStTwDlrPqm)&f~I~W6P!#MzAL@,94etk5k:'3M8x&~N:40}-K><H;V([y-19ksi=;m>xll:#	IO%Xyi+?inv\vZO_l#>x3|Huct8'.h!>k/uv?<y>8_V~S'56k B ig_>#k)vocF!w:a8r\9$O|Cl@->T>Oy<DuPM8'^&Eo&inXGr<XZ!?r{kmW[sR$.v=:y]?I$oe+"W5f5Fi-cUt_.7uWf6Xs<Q?x?fBG8m/^zpL_jSn_Kp)7vh/cn45/yd)Gkk/0vwnRlNwv+9Ad]iWl#q-wqKAvi'O?-V.oR~c4O	X[3o|#k`M*-_I7K*D{`M3nmg2WC>eJ'^G/ PO0oqP>;Do/pXnOn&704yiA1k!l/F)<~;~WbO{eN8?sJ<}&dCyG;WFvfl3@99M@Q>1A&8.Z^VJV176x3sJ:1zzu~32Ba/UGG]mNnr~b$o`o+L!{Jbfc9g1yrcz<j!ZI'8s7xS`Z^;6;Eq)GJO=|;gZ_zz%G{
4kIII`&
j'UXXHuns^_/VZ.	^Zc$iL^l4`O}95gO 6cqjl8<^+or<sLJ&rs=z[| olm%8 ryD\ tI&IfF9xcY9yb!NCs59L\@3=(&@<=-cUr2kx%?Uz9;p&D6Yg >Js@R}9V8(V6kU.M]E/2mK^'vLlnM2O?KU6P<?is]tS%w9[L&B9@=:do1E\lSrsiCkg<9!|O&<be\\B`LZ^X:s0L?~3WY|F?4S)W6OX(+	xJ40v'7@fNniR6<hRtbib<[}\LPp4ekmNJq!&\]*MnKsv21-n~?C=,,R8^9C:0mzcWq1Hz_K;m g
zjmBsBI}A&aOK?@\vQ^JIZ Rus]W~Z9$>Npdv]n' Up}/g> K3};_.pf}p=2mDEN9J1d!%dV8Sj7eJZot<^h(c"'/&h#oyj+MeCgj`r/TRB9l1[ukY[}$12=zXcTS?nj;D'7@%oA(+wKV#v_C?>O9bkjm`S) jy3X&T1[rbqi~.ol@7fu96eobm'}lW&>eOxmZ!['>-MH"g#8'V817j-s&F_=}#)8hS[c=.6yrtvu98|"v@4^]Wi_OZW{9Cm}f.}'vJmq;kW!:yxM`'l>|+_&XRt<zq)jCy6~"5}74eO7D^?_Ko` 5h&vbW-O/<+ze`N9;d~R`kWG:Ywh,-&;WE/mlb#v+/xNp {q/k{!>C6i3CGVkV!:y3kobJ`;rcJSerh}CN?4}dN-6cI"xtTwo_qm3>nwPA?]u[<	>}27>zxt	)G/F\by)\Pg|\'6>dgKJn>1z9{UuSqMpn7fs-rF6%Vhgto,m|%L:w76gf;Fgm7+KulJ6)~-h6e=?=2%nb<rK?aN^<8+lg`XA>TK +Tt?1Tw"j7p]\T]pbM?J}&]t:I.cqK[*@CJ4e-9>[{mF/>.nL 
<mW+p}?2s.VR.ebz):j>Cyk-n?|7x>0~r2Qtok|t;0pL&jcn[__l|swTYy`L\Sxcy_?Po[pk~\X<-_[CACLiWu> s|jMd&/8l)^W]bw68YW~?#|L7!{2hm~g?O*O%;L
Ygi?F=azce_?C=[JmzGL_F#h 8DX^[r;PV!LwwJ''[\t<&PnT?9_~U]+~A8)"j6eGg5mGqC[%XiizU]zl~+7	:piQX~-~r3)[zM<v[_qT8W^;Y/CW ;0Nyz|-~m,,86RSgp[bS/m2vuErGA+mT{S9 $<uCl9VoctjO^R1M2w|g?yfd<zrFj~59#JV=~zb1<L[*^{mYb?2J wC-oMS?'vbqRFoH?%_yos$ c}Z/T^oa[G>jl:"u9u)~c=|s_y%T2o:%bqg!RnIZ,ei'.~[?S[xc}c;~{*W)}kq
;_yO|M%q2S04mS-+ruvn'N'u:FQ_L^*a`;_mk"89`)v>4q`CZkGE6xCGL9hZJuqq`U~.yST{)~So)58ok}{e]62k7+fjDGxI[;P=vY~Rk,9S6Z~jZI{~V {>_Y`,^[<Gm.u.~>qRx R2'M>}Ci{Pr2.O|Ct*^pm{yEn
Eri]@C1CqCbIm2"e_Y&O6%wEgu'N[P|)+nMJm|h'S!7|G=6iz04p&mylZ{t*W?j61"fN'cmV}# ee?lqB'^c+>gEXk*?1O}VLz~kg?>Sb[-?y>|[%:=Mv;Z,<x;%FX_e1]3S&/5FRtczyRs=7iw3?ZW$7$-Dd }HG9!3s'KM!Xt-9My97ch'"Tei<N;r=Cj{mbF@4i/yQHx8)\Uhom|-7eCm*K jxDQ]|(&Wpds!(j%13p=VWg_++x2N{qMEG"l^COF2VN?um~'#.W?uKB5>zUbOu_Z"0HwROL6@
~!1Xc{1:R6D{~[,zyeZC;cUxfz-qW$wI'[C&7#.A<tc|8|R6$X6eVgf
;CFsVP]y+@Z`l@-{TJ0ANkC_~lQO:>}ic/F;1[~
2Xm<IusQwe\9iq>.!>h\gm?%O}O8RRR'	^C+w8+3]w@zCrA:esO&XFvh|O..yM:GO=2)>>Wogw(^Z$/McS>)Hb}b!?~z}dEFzk7mOySUq*"-=Y{o!dj7>orJ,89u&Dgn~	d|V..*q\v,J&&)=grH*cmz}o=qH-e!S?|.9<(qG@x}n= >j}}BRx,,$ncv7XtLsioySkQ^}` uS|N~cYP0 ~?DekFtl1b};/OL)KWt|R	zxmxi!y=;	|[?34tbbs#H96O]WtS{7NS\:TxNz82[J?.aZ^r%e{O?taiwi3>
hCE+ :.N/,34&V&m6}L_q^sWZ?Uu0/~<&fYl c| nqKO^*F='eYW~>VS8ea .xp}UC`JM%&i/k	|`fZ1lOa|O7,zsa}_R8vUc,2?<s/?b0oL'=w<M:G[8i#}(v.~Wo_l TX<^q,4'#yPomJ%F;N	Rq66q^= K|m1!NlbmsOg?ro'>s9Wg("799-7'HxK.I}bSO?R8+_)opjZu;4AG{D/N(0uZW]'|,vNz.9Po!%Vjkec&3gWI5W}nz7v+C93@&fmUWg(]o7>YM~41O]OJW vd~K>y}SN9}MyB>6D.fA9c~L:eC/z&.<j?>?6|^Go~J\.xMi:A2t4^N(O+^,(tXhoI.=pa4_Wi>j|DXQB7NLN\&q}=x)8d#dV}x/-K=7<GuO{$,Es$:&~<:y6`,LMtLxGo
'Vm>i)9}K]K\l9x}O;ZsvsMnb&<&Mfpw1rN4ed==	2y?#-}6oXY]A@}kG?W{!NhE -6ztl~.i)wU1x^]+W/>Z/C_W,~)W}N`]t&oUz8#0YSMO~H.mY$l:={1{tn48ztYx'Mq^%#bIJ2}8C<'D.U&E.
v1&M<reo,l?DY-py(nv;>F;eWcx_,;civA\~p/:1Ztb-:i->w]0ds3@j^Yh&=cj~kCOJ]h'M;yibU}R3orth324eui5Dz/XHIoZS;:nzt~`Qpq]d5+=Nm9c8t<3Tj}~W;/A gAD{P8l n}.zs)kkwhS	{k!>&KKe6v<!r*eGj>r%}1rb7W8py$u!)scp't.sx4_;1zo,\pn-63j/un7Eo%~f!flK-kXg7^~WMw3{EwPOu~A{%Qjqz ;6=8+ue~tE}qAc_o?,Z_eugF`=xyolku_^oXT	\[* [1Mt=:|BmEg=	8XlVtk]]_q,jns<1*.=ZZ<;o29N(nlRz)-o}sn.zS|ok
+
+
+
+
+
+0^qT    IENDB`<!doctype html>
<html i18n-values="dir:textdirection;lang:language">
<head>
  <title i18n-content="pageTitle"></title>
  <meta charset="utf-8">
  <style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

:root {
  --edge-white: #FFFFFF;
  --edge-black: #101010;
  --edge-content-background-color: #F7F7F7;
  --edge-primary-text-color: var(--edge-black);
  --edge-secondary-text-color: #6F6F6F;

  --edge-border-hover: #949494;
  --edge-border-rest: #C5C5C5;
  --edge-border-pressed: #ADADAD;

  --edge-blue-border-focus: #888888;
  --edge-blue-hover: #006CBE;
  --edge-blue-rest: #0078D4;
  --edge-blue-pressed: #1081D7;
  --edge-blue-selected: #004274;

  --edge-grey-hover: #EAEAEA;
  --edge-grey-rest: #E6E6E6;
  --edge-grey-pressed: #EFEFEF;

  --edge-light-border-hover: #9C9C9C;
  --edge-light-border-rest: #CECECE;
  --edge-light-border-pressed: #B5B5B5;

  --edge-light-grey-hover: #F3F3F3;
  --edge-light-grey-rest: #EFEFEF;
  --edge-light-grey-pressed: #F7F7F7;

  --link-active: #1081D7;
  --link-color: #0061AB;
  --link-hover: #0070C6;

  --checkbox-checked-color: var(--edge-black);
  --focus-border-color: var(--edge-black);
  --input-control-background-color: var(--edge-white);

  --close-button-active-color: var(--edge-grey-pressed);
  --close-button-hover-color: var(--edge-grey-hover);
  --close-button-icon-color: var(--edge-black);

  --titlebar-button-active-color: var(--edge-grey-pressed);
  --titlebar-button-hover-color: var(--edge-grey-hover);

  --primary-button-border-focus: var(--edge-blue-border-focus);
  --primary-button-box-focus: var(--edge-white);
  --primary-button-active: var(--edge-blue-pressed);
  --primary-button-backgroundcolor: var(--edge-blue-rest);
  --primary-button-hover: var(--edge-blue-hover);

  --secondary-button-active: var(--edge-grey-pressed);
  --secondary-button-background: var(--edge-grey-rest);
  --secondary-button-hover: var(--edge-grey-hover);

  --scrollbar-track-color: #EFEFEF;
  --scrollbar-thumb-color: #CACACA;
  --scrollbar-thumb-hover-color: #9E9E9E;

  --radio-button-checked-border-color: var(--edge-black);
  --radio-button-dot-color: var(--edge-black);

  --toggle-knob-off-color: var(--edge-black);
  --toggle-knob-on-color: var(--edge-white);

  --progressbar-background-color: #EFEFEF;
  --progressbar-bar-color: var(--edge-blue-rest);

  /* Svg color stays black in light mode */
  --svg-icon-filter-invert: invert(0%);
  /* Convert svg black to --link-color using filter */
  --svg-icon-filter-blue:
      invert(26%) sepia(59%) saturate(2259%)
      hue-rotate(186deg) brightness(99%) contrast(101%);

  --sys-info-list-item-hover-color: var(--edge-grey-hover);

  --screenshot-editor-secondary-button-hover: var(--edge-grey-hover);
  --screenshot-editor-pen-panel-background: #E0E0E0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --edge-white: #FFFFFF;
    --edge-black: #1D1D1D;
    --edge-content-background-color: #2D2D2D;
    --edge-primary-text-color: var(--edge-white);
    --edge-secondary-text-color: #949494;

    --edge-border-hover: #909090;
    --edge-border-rest: #575757;
    --edge-border-pressed: #787878;

    --edge-blue-border-focus: #888888;
    --edge-blue-box-focus: #00355D;
    --edge-blue-hover: #0078D4;
    --edge-blue-rest: #006CBE;
    --edge-blue-pressed: #0069B9;
    --edge-blue-selected: #63ACE5;

    --edge-grey-hover: #3A3A3A;
    --edge-grey-rest: #3E3E3E;
    --edge-grey-pressed: #353535;

    --edge-light-border-hover: #999999;
    --edge-light-border-rest: #676767;
    --edge-light-border-pressed: #808080;

    --edge-light-grey-hover: #424242;
    --edge-light-grey-rest: #464646;
    --edge-light-grey-pressed: #3E3E3E;

    --link-active: #2189DA;
    --link-color: #63ACE5;
    --link-hover: #429BDF;

    --checkbox-checked-color: var(--edge-white);
    --focus-border-color: var(--edge-white);
    --input-control-background-color: var(--edge-black);

    --close-button-active-color: var(--edge-grey-pressed);
    --close-button-hover-color: var(--edge-grey-hover);
    --close-button-icon-color: var(--edge-white);

    --titlebar-button-active-color: var(--edge-grey-pressed);
    --titlebar-button-hover-color: var(--edge-grey-hover);

    --primary-button-active: var(--edge-blue-pressed);
    --primary-button-backgroundcolor: var(--edge-blue-rest);
    --primary-button-border-focus: var(--edge-blue-border-focus);
    --primary-button-box-focus: var(--edge-blue-box-focus);
    --primary-button-hover: var(--edge-blue-hover);

    --secondary-button-active: var(--edge-grey-pressed);
    --secondary-button-background: var(--edge-grey-rest);
    --secondary-button-hover: var(--edge-grey-hover);

    --scrollbar-track-color: #272727;
    --scrollbar-thumb-color: #4E4E4E;
    --scrollbar-thumb-hover-color: #7D7D7D;

    --radio-button-checked-border-color: var(--edge-white);
    --radio-button-dot-color: var(--edge-white);

    --toggle-knob-off-color: var(--edge-white);
    --toggle-knob-on-color: var(--edge-white);

    --progressbar-background-color: #212121;
    --progressbar-bar-color: var(--edge-blue-rest);

    /* Convert svg black to white using filter */
    --svg-icon-filter-invert: invert(100%);
    /* Convert svg black to --link-color using filter */
    --svg-icon-filter-blue:
        invert(65%) sepia(76%) saturate(643%)
        hue-rotate(177deg) brightness(92%) contrast(95%);

    --sys-info-list-item-hover-color: var(--edge-light-grey-hover);

    --screenshot-editor-secondary-button-hover: var(--edge-light-grey-hover);
    --screenshot-editor-pen-panel-background: #404040;
  }
}

:root {
  --button-alignment: flex-end;
  --text-capitalize: initial;
}

:root.mac {
  --text-capitalize: capitalize;
}

body {
  background-color: var(--edge-content-background-color);
  color: var(--edge-primary-text-color);
  font-family: system-ui, Segoe UI, SegoeUI, Helvetica Neue,
               Helvetica, Arial, sans-serif;
  font-size: 14px;
  line-height: 20px;
}

[hidden] {
  display: none !important;
}

/* scrollbar styles */
::-webkit-scrollbar {
  height: 12px;
  width: 12px;
}

::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color);
  border: solid 3px var(--scrollbar-track-color);
  border-radius: 9px;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover-color);
}

::-webkit-scrollbar-track {
  background-color: var(--scrollbar-track-color);
}

::-webkit-scrollbar-corner {
  background-color: var(--scrollbar-track-color);
}

/* Input text and textarea styles */
input[type=text],
input[type=url],
input[type=email],
textarea {
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  color: var(--edge-primary-text-color);
  font-family: inherit;
  font-size: inherit;
  font-weight: 400;
  margin: 0;
  max-width: 100%;
  padding: 10px;
}

input[type=text]:hover,
input[type=url]:hover,
input[type=email]:hover,
input[type=checkbox]:hover,
textarea:hover {
  border-color: var(--edge-border-hover);
}

html:not(.focus-by-keydown) *:focus {
  outline: none;
}

input[type=text]:focus,
input[type=url]:focus,
input[type=email]:focus,
html.focus-by-keydown input[type=checkbox]:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  box-shadow: var(--focus-border-color) 0 0 0 1px inset;
  outline: none;
}

textarea:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  outline: 1px solid var(--focus-border-color) !important;
}

input[type=email]:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

/* button styles */
.button {
  align-items: center;
  border: 2px solid;
  border-color: transparent;
  border-radius: 2px;
  box-sizing: border-box;
  display: inline-flex;
  font-family: inherit;
  font-size: 14px;
  height: 32px;
  justify-content: center;
  line-height: 1;
  overflow: hidden;
  padding: 0 16px;
  text-decoration: none;
  text-transform: var(--text-capitalize);
  transition: all 200ms ease-in-out;
  white-space: nowrap;
}

.button:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

html.focus-by-keydown .button:focus {
  border-color: var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

html.focus-by-keydown .primary-button:focus {
  border-color: var(--primary-button-border-focus);
  box-shadow: 0 0 0 2px inset var(--primary-button-box-focus);
  outline: none;
}

.primary-button {
  background-color: var(--primary-button-backgroundcolor);
  color: white;
}

.primary-button:hover {
  background-color: var(--primary-button-hover);
}

.primary-button:active {
  background-color: var(--primary-button-active);
}

.secondary-button {
  background-color: var(--secondary-button-background);
  color: var(--edge-primary-text-color);
}

.secondary-button:hover {
  background-color: var(--secondary-button-hover);
}

.secondary-button:active {
  background-color: var(--secondary-button-active);
}

.outline-button {
  background-color: transparent;
  border-color: var(--edge-light-border-rest);
  border-width: 1px;
  color: var(--edge-primary-text-color);
}

.outline-button:hover {
  background-color: var(--edge-light-grey-hover);
  border-color: var(--edge-light-border-hover);
}

.outline-button:active {
  background-color: var(--edge-light-grey-pressed);
  border-color: var(--edge-light-border-pressed);
}

html.focus-by-keydown .outline-button:focus {
  border-width: 2px;
}

/* hypertext link styles */
a {
  outline: none;
  text-decoration: none;
}

a:link,
a:visited {
  border-bottom: solid 1px var(--link-color);
  color: var(--link-color);
}

a:link:hover,
a:visited:hover {
  border-bottom: 2px solid var(--link-hover);
  box-shadow: none;
  color: var(--link-hover);
  outline: none;
}

a:link:active,
a:visited:active {
  color: var(--link-active);
}

html.focus-by-keydown a:link:focus,
html.focus-by-keydown a:visited:focus {
  border-bottom: 2px solid var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

/* Checkbox styles */
.checkbox-container {
  align-items: center;
  display: inline-flex;
  flex-direction: row;
  position: relative;
}

.checkbox-container .checkbox {
  -webkit-appearance: none;
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  height: 18px;
  margin: 0;
  position: absolute;
  width: 18px;
  z-index: 1;
}

.checkbox-container .check-symbol {
  border-radius: 2px;
  display: inline-block;
  flex-shrink: 0;
  height: 18px;
  position: relative;
  width: 18px;
}

.checkbox-container .check-symbol::before {
  height: 11px;
  left: 10px;
  top: 3px;
  transform: rotate(40deg);
}

.checkbox-container .check-symbol::after {
  height: 5px;
  left: 5px;
  top: 8px;
  transform: rotate(-45deg);
}

.checkbox-container .check-symbol::before,
.checkbox-container .check-symbol::after {
  content: '';
  pointer-events: none;
  position: absolute;
  width: 2px;
  z-index: 1;
}

.checkbox-container input[type=checkbox]:checked + .check-symbol::before,
.checkbox-container input[type=checkbox]:checked + .check-symbol::after {
  background-color: var(--checkbox-checked-color);
}

.checkbox-container .checkbox-label {
  padding-inline-end: 8px;
  padding-inline-start: 8px;
}
</style>
  <style>/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

/* title bar */
.title-bar {
  -webkit-app-region: drag;
  align-items: center;
  display: flex;
  min-height: 54px;
}

.title-bar .logo-image {
  height: 28px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
  width: 28px;
}

.title-bar .page-title {
  flex: 1 1 auto;
  font-size: 15px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
}

.title-bar .page-title.bold {
  font-size: 18px !important;
  margin-inline-start: 20px !important;
}

.title-bar .topbutton-bar {
  display: flex;
}

.title-bar .topbutton-bar .title-bar-button {
  -webkit-app-region: no-drag;
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 2px solid transparent;
  display: flex;
  height: 32px;
  margin-block-start: -12px;
  overflow: hidden;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.title-bar .topbutton-bar .title-bar-button:last-child {
  margin-inline-end: 6px;
}

html.focus-by-keydown .title-bar .topbutton-bar .title-bar-button:focus {
  border: 2px solid var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.title-bar .topbutton-bar .title-bar-button:hover {
  background-color: var(--titlebar-button-hover-color);
  border-color: var(--titlebar-button-hover-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button:active {
  background-color: var(--titlebar-button-active-color);
  border-color: var(--titlebar-button-active-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button > span {
  filter: var(--svg-icon-filter-invert);
  height: 16px;
  width: 16px;
}

.title-bar .maximize-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAxMCAxMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik0xMCAwLjU4ODg2N1YxMC41ODg5SDBWMC41ODg4NjdIMTBaTTguOTk5MDIgMS41ODk4NEgxLjAwMDk4VjkuNTg3ODlIOC45OTkwMlYxLjU4OTg0WiIvPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .restore-down-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAyMDQ4IDIwNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyINCiAgICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgPHBhdGggZmlsbD0iIzEwMTAxMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwyMDQ4KSBzY2FsZSgxLC0xKSINCiAgICBkPSJNMjA0OCAyMDQ4TDIwNDggNDEwTDE2MzggNDEwTDE2MzggMEwwIDBMMCAxNjM4TDQxMCAxNjM4TDQxMCAyMDQ4TDIwNDggMjA0OFpNMTQzNCAyMDVMMTQzNCAxNDM0TDIwNSAxNDM0TDIwNSAyMDVMMTQzNCAyMDVaTTE4NDMgNjE0TDE4NDMgMTg0M0w2MTQgMTg0M0w2MTQgMTYzOEwxNjM4IDE2MzhMMTYzOCA2MTRMMTg0MyA2MTRaIj4NCiAgPC9wYXRoPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .close-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik01LjcwODAxIDVMMTAgOS4yOTE5OUw5LjI5MTk5IDEwTDUgNS43MDgwMUwwLjcwODAwOCAxMEwwIDkuMjkxOTlMNC4yOTE5OSA1TDAgMC43MDgwMDhMMC43MDgwMDggMEw1IDQuMjkxOTlMOS4yOTE5OSAwTDEwIDAuNzA4MDA4TDUuNzA4MDEgNVoiLz4NCjwvc3ZnPg0K) no-repeat center;
}

/* Close button styles */
.title-bar .close-button {
  -webkit-app-region: no-drag;
  display: block;
  margin-block-start: -12px;
  margin-inline-end: 6px;
}

.close-button {
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 0;
  height: 32px;
  margin: 0;
  overflow: hidden;
  padding: 0;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.close-button > span {
  display: inline-flex;
  height: 12px;
  position: relative;
  width: 12px;
}

.close-button > span::before {
  transform: rotate(-45deg);
}

.close-button > span::after {
  transform: rotate(45deg);
}

.close-button > span::after,
.close-button > span::before {
  content: '';
  height: 14px;
  left: 6px;
  position: absolute;
  top: 0;
  width: 1px;
}

/* black color close button */
.close-button > span::after,
.close-button > span::before {
  background-color: var(--close-button-icon-color);
}

html.focus-by-keydown .topbutton-bar button:focus,
html.focus-by-keydown .close-button:focus {
  border: 2px solid  var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.topbutton-bar button:hover,
.close-button:hover {
  background-color: var(--close-button-hover-color);
  border: 0;
  border-radius: 2px;
}

.close-button:active {
  background-color: var(--close-button-active-color);
  border: 0;
  border-radius: 2px;
}
</style>
  <style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

/* Screenshot modal related styles */
.screenshot-modal {
  background-color: rgba(0, 0, 0, 0.9);
  bottom: 0;
  display: none;
  height: 100%;
  left: 0;
  position: absolute;
  right: 0;
  top: 0;
  width: 100%;
  z-index: 1;
}

.screenshot-modal:focus {
  outline: none;
}

.modal-image-container {
  align-items: center;
  display: flex;
  height: 100%;
  justify-content: center;
}

.modal-image {
  background-repeat: no-repeat;
  cursor: -webkit-zoom-out;
  height: 60%;
  width: 100%;
}

.modal-title-bar {
  position: absolute;
  width: 100%;
}

/* screenshot modal back button */
.back-button {
  -webkit-app-region: no-drag;
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border-color: transparent;
  display: block;
  height: 32px;
  margin-block-start: -6px;
  margin-inline-start: 6px;
  overflow: hidden;
  padding: 0;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.back-button:hover {
  background: rgb(94, 94, 94);
}

.back-button:focus {
  box-shadow: none;
  outline: 1px solid rgb(241, 241, 241);
}

.back-button-path {
  fill: rgb(241, 241, 241);
}

.back-button > svg {
  fill: none;
  height: 16px;
  padding: 8px;
  width: 16px;
}
</style>
  <style>/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

html {
  height: 100%;
  width: 400px;
}

body {
  display: flex;
  flex-direction: column;
  height: 100%;
  margin: 0;
  overflow: auto;
  padding: 0;
  width: 100%;
}

/* feedback-pane section */
.feedback-pane {
  display: block;
  flex-grow: 1;
  margin-block-end: 24px;
  margin-block-start: 12px;
  margin-inline-end: 24px;
  margin-inline-start: 24px;
}

.feedback-pane .block {
  display: flex;
  flex-direction: column;
  margin-block-end: 12px;
}

.feedback-pane .block > * {
  margin-block-start: 8px;
}

.block-first-child {
  margin-block-start: 0 !important;
}

.feedback-pane input[type=text],
.feedback-pane input[type=url],
.feedback-pane input[type=email] {
  height: 32px;
}

.feedback-pane .description-text-label,
.feedback-pane .page-url-label {
  font-size: 12px;
}

.feedback-pane .description-text {
  height: 100px;
  resize: none;
}

.description-text::placeholder {
  font-size: 14px;
}

/* Screenshot related styles */
.screenshot-image-container {
  margin-block-end: 12px;
}

.image-thumbnail-container {
  border: 2px solid transparent;
  height: 120px;
  margin-block-start: 8px;
  position: relative;
  width: 100%;
}

html.focus-by-keydown .image-thumbnail-container:focus {
  border: 2px solid var(--focus-border-color) !important;
  box-shadow: none;
  outline: none;
}

.screenshot-image {
  align-self: flex-start;
  height: 100%;
  max-width: 100%;
  object-fit: contain;
}

.screenshot-image-modal {
  max-height: 100%;
  max-width: 100%;
}

.cursor-box {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid #d4d4d4;
  cursor: -webkit-zoom-in;
  display: none;
  height: 40px;
  position: absolute;
  top: 0;
  transition: all 50ms ease-in-out;
  width: 40px;
}

.screenshot-overlay {
  align-items: center;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  height: 100%;
  justify-content: center;
  outline: none;
  position: absolute;
  top: 0;
  visibility: hidden;
}

.overlay-text {
  color: white;
  display: flex;
  flex-direction: column;
  font-size: 1.3em;
  justify-content: center;
  text-align: center;
}

/* privacy styles */
.feedback-pane .privacy-note {
  color: var(--edge-secondary-text-color);
  display: block;
  font-size: 10px;
  line-height: 16px;
  margin-block-end: 12px;
}

/* container for the Send button */
.button-container {
  display: flex;
  justify-content: var(--button-alignment);
}

/* Submit button styles */
.send-button {
  width: 150px;
}
</style>
  <script src="edge://resources/js/load_time_data.js"></script>
  <script src="edge://resources/js/i18n_template_no_process.js"></script>
  <script src="../js/focus_outline_manager.js"></script>
  <script src="edge://resources/js/util.js"></script>
  <script src="../js/data.js"></script>
  <script src="../js/take_screenshot.js"></script>
  <script src="../js/topbar_handlers.js"></script>
  <script src="../js/screenshot_modal.js"></script>
  <script src="../js/resize_app_window.js"></script>
  <script src="../js/feedback.js"></script>
</head>
<body>
  <div id="title-bar" class="title-bar">
    <img alt="" class="logo-image"
         srcset="edge://theme/current-channel-logo@1x 1x,edge://theme/current-channel-logo@2x 2x">
    <h1 id="page-title" class="page-title bold" i18n-content="pageTitle"></h1>
    <button id="close-button" class="close-button" type="button"
            i18n-values="aria-label:closeButtonLabel"><span></span></button>
  </div>
  <div id="content-pane">
    <!-- Feedback Pane -->
    <form id="feedback-pane" class="feedback-pane">
      <!-- Description textarea -->
      <div class="block">
        <label id="description-text-label"
               i18n-content="descriptionTextLabel"
               class="description-text-label block-first-child"></label>
        <textarea id="description-text" class="description-text"
                  i18n-values="placeholder:descriptionTextareaPlaceholder"
                  aria-labelledby="description-text-label"
                  maxlength="5000" required></textarea>
      </div>
      <!-- URL -->
      <div class="block">
        <label id="page-url-label" i18n-content="pageUrl"
                class="page-url-label block-first-child"></label>
        <input id="page-url-text" type="url" aria-labelledby="page-url-label"
                maxlength="5000" spellcheck="false">
      </div>
      <!-- User e-mail -->
      <div class="block">
        <label class="block-first-child checkbox-container">
          <input class="checkbox" id="email-checkbox" type="checkbox">
          <span class="check-symbol"></span>
          <span id="user-email-label" class="checkbox-label"
                i18n-content="userEmailLabel"></span>
        </label>
        <input id="user-email-text" aria-labelledby="user-email-label"
                type="email" maxlength="500" spellcheck="false">
      </div>
      <!-- System Information -->
      <div class="block" id="sys-info-container">
        <label class="block-first-child checkbox-container">
          <input class="checkbox" id="sys-info-checkbox" type="checkbox"
                 checked="true">
          <span class="check-symbol"></span>
          <span id="sys-info-label" class="checkbox-label"
                i18n-values=".innerHTML:sysInfoCheckboxLabel"></span>
        </label>
      </div>
      <!-- Screenshot -->
      <div class="screenshot-image-container" id="screenshot-image-container">
        <label class="checkbox-container">
          <input class="checkbox" id="screenshot-checkbox" type="checkbox">
          <span class="check-symbol"></span>
          <span id="screenshot-label" class="checkbox-label"
                i18n-content="screenshotLabel"></span>
        </label>
        <div id="image-thumbnail-container" class="image-thumbnail-container"
             tabindex="0" role="button"
             i18n-values="aria-label:screenshotOpenEditor">
          <img id="screenshot-image" class="screenshot-image"
               i18n-values="aria-label:screenshotImage">
          <div id="screenshot-overlay" class="screenshot-overlay">
            <div class="overlay-text"
                 i18n-content="screenshotOverlayText"></div>
          </div>
          <div id="cursor-box" class="cursor-box"></div>
        </div>
      </div>
      <!-- Privacy note -->
      <small id="privacy-note" class="privacy-note"
             i18n-values=".innerHTML:privacyNote"></small>
      <div class="button-container">
        <!-- Submit button -->
        <button id="send-report-button" type="submit"
                class="button primary-button send-button"
                i18n-content="sendReport"></button>
      </div>
    </form>
    <!--end of feedback pane -->
  </div>
  <!-- Screenshot modal overlay -->
  <div id="screenshot-modal" class="screenshot-modal" tabindex="-1">
    <div class="modal-title-bar title-bar">
      <div id="back-button" class="back-button"
           i18n-values="aria-label:screenshotBackButtonLabel" tabindex="0">
        <svg xmlns="http://www.w3.org/2000/svg">
          <path class="back-button-path"
                d="M16 8H1.95312L8.10156 14.1484L7.39844 14.8516L0.046875 7.5L7.39844
                0.148438L8.10156 0.851562L1.95312 7H16V8Z">
        </svg>
      </div>
    </div>
    <div class="modal-image-container">
      <div id="modal-image" class="modal-image" role="img"
           i18n-values="aria-label:screenshotModal"></div>
    </div>
  </div>
</body>
</html>
<!doctype html>
<html i18n-values="dir:textdirection;lang:language">
<head>
  <title i18n-content="screenshotEditorTitle"></title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

:root {
  --edge-white: #FFFFFF;
  --edge-black: #101010;
  --edge-content-background-color: #F7F7F7;
  --edge-primary-text-color: var(--edge-black);
  --edge-secondary-text-color: #6F6F6F;

  --edge-border-hover: #949494;
  --edge-border-rest: #C5C5C5;
  --edge-border-pressed: #ADADAD;

  --edge-blue-border-focus: #888888;
  --edge-blue-hover: #006CBE;
  --edge-blue-rest: #0078D4;
  --edge-blue-pressed: #1081D7;
  --edge-blue-selected: #004274;

  --edge-grey-hover: #EAEAEA;
  --edge-grey-rest: #E6E6E6;
  --edge-grey-pressed: #EFEFEF;

  --edge-light-border-hover: #9C9C9C;
  --edge-light-border-rest: #CECECE;
  --edge-light-border-pressed: #B5B5B5;

  --edge-light-grey-hover: #F3F3F3;
  --edge-light-grey-rest: #EFEFEF;
  --edge-light-grey-pressed: #F7F7F7;

  --link-active: #1081D7;
  --link-color: #0061AB;
  --link-hover: #0070C6;

  --checkbox-checked-color: var(--edge-black);
  --focus-border-color: var(--edge-black);
  --input-control-background-color: var(--edge-white);

  --close-button-active-color: var(--edge-grey-pressed);
  --close-button-hover-color: var(--edge-grey-hover);
  --close-button-icon-color: var(--edge-black);

  --titlebar-button-active-color: var(--edge-grey-pressed);
  --titlebar-button-hover-color: var(--edge-grey-hover);

  --primary-button-border-focus: var(--edge-blue-border-focus);
  --primary-button-box-focus: var(--edge-white);
  --primary-button-active: var(--edge-blue-pressed);
  --primary-button-backgroundcolor: var(--edge-blue-rest);
  --primary-button-hover: var(--edge-blue-hover);

  --secondary-button-active: var(--edge-grey-pressed);
  --secondary-button-background: var(--edge-grey-rest);
  --secondary-button-hover: var(--edge-grey-hover);

  --scrollbar-track-color: #EFEFEF;
  --scrollbar-thumb-color: #CACACA;
  --scrollbar-thumb-hover-color: #9E9E9E;

  --radio-button-checked-border-color: var(--edge-black);
  --radio-button-dot-color: var(--edge-black);

  --toggle-knob-off-color: var(--edge-black);
  --toggle-knob-on-color: var(--edge-white);

  --progressbar-background-color: #EFEFEF;
  --progressbar-bar-color: var(--edge-blue-rest);

  /* Svg color stays black in light mode */
  --svg-icon-filter-invert: invert(0%);
  /* Convert svg black to --link-color using filter */
  --svg-icon-filter-blue:
      invert(26%) sepia(59%) saturate(2259%)
      hue-rotate(186deg) brightness(99%) contrast(101%);

  --sys-info-list-item-hover-color: var(--edge-grey-hover);

  --screenshot-editor-secondary-button-hover: var(--edge-grey-hover);
  --screenshot-editor-pen-panel-background: #E0E0E0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --edge-white: #FFFFFF;
    --edge-black: #1D1D1D;
    --edge-content-background-color: #2D2D2D;
    --edge-primary-text-color: var(--edge-white);
    --edge-secondary-text-color: #949494;

    --edge-border-hover: #909090;
    --edge-border-rest: #575757;
    --edge-border-pressed: #787878;

    --edge-blue-border-focus: #888888;
    --edge-blue-box-focus: #00355D;
    --edge-blue-hover: #0078D4;
    --edge-blue-rest: #006CBE;
    --edge-blue-pressed: #0069B9;
    --edge-blue-selected: #63ACE5;

    --edge-grey-hover: #3A3A3A;
    --edge-grey-rest: #3E3E3E;
    --edge-grey-pressed: #353535;

    --edge-light-border-hover: #999999;
    --edge-light-border-rest: #676767;
    --edge-light-border-pressed: #808080;

    --edge-light-grey-hover: #424242;
    --edge-light-grey-rest: #464646;
    --edge-light-grey-pressed: #3E3E3E;

    --link-active: #2189DA;
    --link-color: #63ACE5;
    --link-hover: #429BDF;

    --checkbox-checked-color: var(--edge-white);
    --focus-border-color: var(--edge-white);
    --input-control-background-color: var(--edge-black);

    --close-button-active-color: var(--edge-grey-pressed);
    --close-button-hover-color: var(--edge-grey-hover);
    --close-button-icon-color: var(--edge-white);

    --titlebar-button-active-color: var(--edge-grey-pressed);
    --titlebar-button-hover-color: var(--edge-grey-hover);

    --primary-button-active: var(--edge-blue-pressed);
    --primary-button-backgroundcolor: var(--edge-blue-rest);
    --primary-button-border-focus: var(--edge-blue-border-focus);
    --primary-button-box-focus: var(--edge-blue-box-focus);
    --primary-button-hover: var(--edge-blue-hover);

    --secondary-button-active: var(--edge-grey-pressed);
    --secondary-button-background: var(--edge-grey-rest);
    --secondary-button-hover: var(--edge-grey-hover);

    --scrollbar-track-color: #272727;
    --scrollbar-thumb-color: #4E4E4E;
    --scrollbar-thumb-hover-color: #7D7D7D;

    --radio-button-checked-border-color: var(--edge-white);
    --radio-button-dot-color: var(--edge-white);

    --toggle-knob-off-color: var(--edge-white);
    --toggle-knob-on-color: var(--edge-white);

    --progressbar-background-color: #212121;
    --progressbar-bar-color: var(--edge-blue-rest);

    /* Convert svg black to white using filter */
    --svg-icon-filter-invert: invert(100%);
    /* Convert svg black to --link-color using filter */
    --svg-icon-filter-blue:
        invert(65%) sepia(76%) saturate(643%)
        hue-rotate(177deg) brightness(92%) contrast(95%);

    --sys-info-list-item-hover-color: var(--edge-light-grey-hover);

    --screenshot-editor-secondary-button-hover: var(--edge-light-grey-hover);
    --screenshot-editor-pen-panel-background: #404040;
  }
}

:root {
  --button-alignment: flex-end;
  --text-capitalize: initial;
}

:root.mac {
  --text-capitalize: capitalize;
}

body {
  background-color: var(--edge-content-background-color);
  color: var(--edge-primary-text-color);
  font-family: system-ui, Segoe UI, SegoeUI, Helvetica Neue,
               Helvetica, Arial, sans-serif;
  font-size: 14px;
  line-height: 20px;
}

[hidden] {
  display: none !important;
}

/* scrollbar styles */
::-webkit-scrollbar {
  height: 12px;
  width: 12px;
}

::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color);
  border: solid 3px var(--scrollbar-track-color);
  border-radius: 9px;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover-color);
}

::-webkit-scrollbar-track {
  background-color: var(--scrollbar-track-color);
}

::-webkit-scrollbar-corner {
  background-color: var(--scrollbar-track-color);
}

/* Input text and textarea styles */
input[type=text],
input[type=url],
input[type=email],
textarea {
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  color: var(--edge-primary-text-color);
  font-family: inherit;
  font-size: inherit;
  font-weight: 400;
  margin: 0;
  max-width: 100%;
  padding: 10px;
}

input[type=text]:hover,
input[type=url]:hover,
input[type=email]:hover,
input[type=checkbox]:hover,
textarea:hover {
  border-color: var(--edge-border-hover);
}

html:not(.focus-by-keydown) *:focus {
  outline: none;
}

input[type=text]:focus,
input[type=url]:focus,
input[type=email]:focus,
html.focus-by-keydown input[type=checkbox]:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  box-shadow: var(--focus-border-color) 0 0 0 1px inset;
  outline: none;
}

textarea:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  outline: 1px solid var(--focus-border-color) !important;
}

input[type=email]:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

/* button styles */
.button {
  align-items: center;
  border: 2px solid;
  border-color: transparent;
  border-radius: 2px;
  box-sizing: border-box;
  display: inline-flex;
  font-family: inherit;
  font-size: 14px;
  height: 32px;
  justify-content: center;
  line-height: 1;
  overflow: hidden;
  padding: 0 16px;
  text-decoration: none;
  text-transform: var(--text-capitalize);
  transition: all 200ms ease-in-out;
  white-space: nowrap;
}

.button:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

html.focus-by-keydown .button:focus {
  border-color: var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

html.focus-by-keydown .primary-button:focus {
  border-color: var(--primary-button-border-focus);
  box-shadow: 0 0 0 2px inset var(--primary-button-box-focus);
  outline: none;
}

.primary-button {
  background-color: var(--primary-button-backgroundcolor);
  color: white;
}

.primary-button:hover {
  background-color: var(--primary-button-hover);
}

.primary-button:active {
  background-color: var(--primary-button-active);
}

.secondary-button {
  background-color: var(--secondary-button-background);
  color: var(--edge-primary-text-color);
}

.secondary-button:hover {
  background-color: var(--secondary-button-hover);
}

.secondary-button:active {
  background-color: var(--secondary-button-active);
}

.outline-button {
  background-color: transparent;
  border-color: var(--edge-light-border-rest);
  border-width: 1px;
  color: var(--edge-primary-text-color);
}

.outline-button:hover {
  background-color: var(--edge-light-grey-hover);
  border-color: var(--edge-light-border-hover);
}

.outline-button:active {
  background-color: var(--edge-light-grey-pressed);
  border-color: var(--edge-light-border-pressed);
}

html.focus-by-keydown .outline-button:focus {
  border-width: 2px;
}

/* hypertext link styles */
a {
  outline: none;
  text-decoration: none;
}

a:link,
a:visited {
  border-bottom: solid 1px var(--link-color);
  color: var(--link-color);
}

a:link:hover,
a:visited:hover {
  border-bottom: 2px solid var(--link-hover);
  box-shadow: none;
  color: var(--link-hover);
  outline: none;
}

a:link:active,
a:visited:active {
  color: var(--link-active);
}

html.focus-by-keydown a:link:focus,
html.focus-by-keydown a:visited:focus {
  border-bottom: 2px solid var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

/* Checkbox styles */
.checkbox-container {
  align-items: center;
  display: inline-flex;
  flex-direction: row;
  position: relative;
}

.checkbox-container .checkbox {
  -webkit-appearance: none;
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  height: 18px;
  margin: 0;
  position: absolute;
  width: 18px;
  z-index: 1;
}

.checkbox-container .check-symbol {
  border-radius: 2px;
  display: inline-block;
  flex-shrink: 0;
  height: 18px;
  position: relative;
  width: 18px;
}

.checkbox-container .check-symbol::before {
  height: 11px;
  left: 10px;
  top: 3px;
  transform: rotate(40deg);
}

.checkbox-container .check-symbol::after {
  height: 5px;
  left: 5px;
  top: 8px;
  transform: rotate(-45deg);
}

.checkbox-container .check-symbol::before,
.checkbox-container .check-symbol::after {
  content: '';
  pointer-events: none;
  position: absolute;
  width: 2px;
  z-index: 1;
}

.checkbox-container input[type=checkbox]:checked + .check-symbol::before,
.checkbox-container input[type=checkbox]:checked + .check-symbol::after {
  background-color: var(--checkbox-checked-color);
}

.checkbox-container .checkbox-label {
  padding-inline-end: 8px;
  padding-inline-start: 8px;
}
</style>
  <style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */
body {
  display: flex;
  flex-direction: column;
  height: 100vh;
  margin: 0;
}

.wrapper {
  align-items: stretch;
  display: flex;
  flex-direction: column;
  height: 100%;
  padding-inline-end: 16px;
  padding-inline-start: 16px;
}

/* For header and footer style */
.outer-panel {
  align-items: center;
  display: flex;
  flex-direction: column;
  height: 60px;
}

.bottom-panel {
  flex-direction: row !important;
  justify-content: var(--button-alignment);
}

/* Tool bar style */
.center-tool-bar {
  align-items: center;
  display: flex;
  flex-direction: row;
  margin: 0;
}

.separator {
  border-inline-end: 1px solid var(--focus-border-color);
  border-inline-start: 1px solid var(--focus-border-color);
  display: inline-block;
  height: 60%;
  margin-inline-end: 4px;
  margin-inline-start: 4px;
  opacity: 0.3;
  padding: 0;
  width: 0;
}

.tool-bar-button {
  background-color: transparent;
  border: none;
  height: 44px;
  outline: none;
  padding: 0;
  width: 44px;
}

html.focus-by-keydown .tool-bar-button:focus {
  border: 1px solid var(--focus-border-color);
  outline: none;
}

.crop-tool-button-with-text {
  color: var(--focus-border-color);
  width: 100px !important;
}

.tool-bar-button:hover {
  background-color: var(--screenshot-editor-secondary-button-hover);
}

.tool-icn {
  filter: var(--svg-icon-filter-invert);
  height: 16px;
  width: 16px;
}

.crop-save-icn {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTE0LjM1MiA0LjM1Mkw2IDEyLjcxIDEuNjQ4IDguMzVsLjcwNC0uNzAzTDYgMTEuMjlsNy42NDgtNy42NC43MDQuNzAzeiIgZmlsbD0iIzAwMCIvPjwvc3ZnPg==) no-repeat top left;
  margin-inline-end: 8px;
}

.crop-cancel-icn {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTggMWMuNjQzIDAgMS4yNi4wODQgMS44NTMuMjUzYTYuODk1IDYuODk1IDAgMCAxIDMuMDkgMS44MDUgNi45MDMgNi45MDMgMCAwIDEgMS44MDQgMy4wOUMxNC45MTYgNi43NCAxNSA3LjM1NyAxNSA4YzAgLjY0My0uMDg0IDEuMjYyLS4yNTMgMS44NmE2LjkyNSA2LjkyNSAwIDAgMS0uNzA0IDEuNjY3IDcuMDY4IDcuMDY4IDAgMCAxLTQuMTkgMy4yMjdBNi45MDggNi45MDggMCAwIDEgOCAxNWE2Ljk4NCA2Ljk4NCAwIDAgMS0xLjg2LS4yNDYgNy4xMjkgNy4xMjkgMCAwIDEtMy4wOS0xLjgwNSA3LjEyOCA3LjEyOCAwIDAgMS0xLjgwNS0zLjA5QTYuOTg1IDYuOTg1IDAgMCAxIDEuMDAxIDhjMC0uNjQzLjA4Mi0xLjI2LjI0Ni0xLjg1M2E3LjAzIDcuMDMgMCAwIDEgMS44MDUtMy4wOSA3LjA2OCA3LjA2OCAwIDAgMSAxLjQyMi0xLjEgNi45MjIgNi45MjIgMCAwIDEgMS42NjgtLjcwNEE2LjgwOCA2LjgwOCAwIDAgMSA4IDF6bTAgMTMuMTI1Yy43NDcgMCAxLjQ2LS4xMjggMi4xNC0uMzgzYTYuMTMgNi4xMyAwIDAgMCAxLjg3My0xLjExNGwtOC42NC04LjY0QTYuMTMgNi4xMyAwIDAgMCAyLjI1NyA1Ljg2IDYuMDMxIDYuMDMxIDAgMCAwIDEuODc1IDhjMCAuNTY1LjA3MyAxLjExLjIxOSAxLjYzNC4xNDYuNTIuMzUgMS4wMDcuNjE1IDEuNDYzLjI2OS40NS41ODguODYzLjk1NyAxLjIzNy4zNzQuMzcuNzg2LjY4OCAxLjIzNy45NTcuNDU2LjI2NC45NDQuNDcgMS40NjMuNjE1QTYuMDY0IDYuMDY0IDAgMCAwIDggMTQuMTI1em00LjYyOC0yLjExMmE2LjE1MiA2LjE1MiAwIDAgMCAxLjExNC0xLjg2N2MuMjU1LS42ODMuMzgzLTEuMzk5LjM4My0yLjE0NmE1Ljk5IDUuOTkgMCAwIDAtLjIxOS0xLjYyNyA1Ljk2NiA1Ljk2NiAwIDAgMC0uNjIyLTEuNDYzIDUuODczIDUuODczIDAgMCAwLS45NTctMS4yMzcgNS44NyA1Ljg3IDAgMCAwLTEuMjM3LS45NTcgNS45NjcgNS45NjcgMCAwIDAtMS40NjMtLjYyMkE1Ljk5MiA1Ljk5MiAwIDAgMCA4IDEuODc1Yy0uNzQ3IDAtMS40NjMuMTI4LTIuMTQ2LjM4M2E2LjE1MyA2LjE1MyAwIDAgMC0xLjg2NyAxLjExNGw4LjY0IDguNjR6IiBmaWxsPSIjMDAwIi8+PC9zdmc+) no-repeat top left;
  margin-inline-end: 8px;
}

.crop-mode-icn {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgPHBhdGggZD0iTTEyLjk5MjIgMTJIMTZWMTMuMDA3OEgxMi45OTIyVjE2SDEyVjEzLjAwNzhIMi45OTIxOVY0SDBWMy4wMDc4MUgyLjk5MjE5VjBINFYzLjAwNzgxSDEyLjI4OTFMMTUuMTQwNiAwLjE0ODQzOEwxNS44NTE2IDAuODUxNTYyTDEyLjk5MjIgMy43MTA5NFYxMlpNMTEuMjg5MSA0SDRWMTEuMjg5MUwxMS4yODkxIDRaTTQuNzEwOTQgMTJIMTJWNC43MTA5NEw0LjcxMDk0IDEyWiIgZmlsbD0iYmxhY2siLz4NCjwvc3ZnPg0K) no-repeat top left;
}

#pen-button {
  position: relative;
}

.pen-mode-icn {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgPHBhdGggdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwyMDQ4KSBzY2FsZSgxLC0xKSIgZD0gIk0xOTIwIDIwNDhMMTkyMCAxNTM2TDE4MDAgMTUzNkwxMzUxIDY0MEwxMjc5IDY0MFExMjc4IDYxMiAxMjc1LjUgNTY5LjVRMTI3MyA1MjcgMTI2Ny41IDQ3Ni41UTEyNjIgNDI2IDEyNTIuNSAzNzEuNVExMjQzIDMxNyAxMjI5LjUgMjY0UTEyMTYgMjExIDExOTcgMTYzUTExNzggMTE1IDExNTMgNzlRMTEyOCA0MyAxMDk2IDIxLjVRMTA2NCAwIDEwMjQgMFE5NzEgMCA5MzIgMzdRODkzIDc0IDg2NSAxMzIuNVE4MzcgMTkxIDgxOC41IDI2My41UTgwMCAzMzYgNzg5LjUgNDA3LjVRNzc5IDQ3OSA3NzQuNSA1NDAuNVE3NzAgNjAyIDc2OSA2NDBMNjk3IDY0MEwyNDggMTUzNkwxMjggMTUzNkwxMjggMjA0OEwyNTYgMjA0OEwyNTYgMTY2NEwxNzkyIDE2NjRMMTc5MiAyMDQ4TDE5MjAgMjA0OFpNMTAyNCAxMjhRMTA0NyAxNDAgMTA2NSAxNzUuNVExMDgzIDIxMSAxMDk3IDI2MFExMTExIDMwOSAxMTIwLjUgMzY1UTExMzAgNDIxIDExMzYuNSA0NzRRMTE0MyA1MjcgMTE0Ni41IDU3MVExMTUwIDYxNSAxMTUxIDY0MEw4OTcgNjQwUTg5OCA2MTUgOTAxLjUgNTcxUTkwNSA1MjcgOTExLjUgNDc0UTkxOCA0MjEgOTI3LjUgMzY1UTkzNyAzMDkgOTUxIDI2MFE5NjUgMjExIDk4MyAxNzUuNVExMDAxIDE0MCAxMDI0IDEyOFpNMTI3MiA3NjhMMTY1NiAxNTM2TDM5MiAxNTM2TDc3NiA3NjhMMTI3MiA3NjhaIj48L3BhdGg+DQo8L3N2Zz4=) no-repeat top left;
  position: absolute;
}

.pen-mode-icn-active {
  bottom: 0;
  display: flex;
  height: 10px;
  justify-content: center;
  position: absolute;
  width: 100%;
}

.pen-mode-icn-arrow {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOHB4IiBoZWlnaHQ9IjhweCIgdmlld0JveD0iMCAwIDIwNDggMjA0OCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogIDxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMjA0OCkgc2NhbGUoMSwtMSkiIGQ9ICJNMTAyNCA2NjZMMTkzOSAxNTgxTDIwMjkgMTQ5MUwxMDI0IDQ4NkwxOSAxNDkxTDEwOSAxNTgxTDEwMjQgNjY2WiI+PC9wYXRoPg0KPC9zdmc+) no-repeat top left;
  filter: var(--svg-icon-filter-blue);
  height: 8px;
  width: 8px;
}

.pen-mode-icn-line {
  background: var(--link-color);
  bottom: 0;
  height: 2px;
  position: absolute;
  width: 100%;
}

.undo-icn {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTguNS4wMzFjLjUgMCAuOTgyLjA2NSAxLjQ0NS4xOTZBNS40NjUgNS40NjUgMCAwIDEgMTIuMzYgMS42NGE1LjQ3IDUuNDcgMCAwIDEgMS40MTQgMi40MTRjLjEzLjQ2My4xOTYuOTQ1LjE5NiAxLjQ0NSAwIC43MTQtLjEzOCAxLjQwNC0uNDE0IDIuMDdhNS4yOCA1LjI4IDAgMCAxLTEuMTY0IDEuNzVsLTYuNTQgNi41MzItLjcwMy0uNzA0TDExLjY4IDguNjFBNC4zNzcgNC4zNzcgMCAwIDAgMTIuOTY5IDUuNWMwLS42MS0uMTItMS4xODUtLjM2LTEuNzI3YTQuNTM5IDQuNTM5IDAgMCAwLS45Ni0xLjQyMSA0LjU0IDQuNTQgMCAwIDAtMS40MjItLjk2MUE0LjIyMSA0LjIyMSAwIDAgMCA4LjUgMS4wM2MtLjU2MyAwLTEuMDYuMDg2LTEuNDkyLjI1OGE0Ljc4IDQuNzggMCAwIDAtMS4xODguNjcyIDguODYyIDguODYyIDAgMCAwLTEuMDU0Ljk0NUM0LjQzMiAzLjI2IDQuMDggMy42MjUgMy43MSA0SDd2MUgyVjBoMXYzLjI5Yy4yODYtLjI5My41Ni0uNTc0LjgyLS44NDUuMjY2LS4yNzYuNTI5LS41MzQuNzktLjc3My4yNjUtLjI0NS41MzMtLjQ2Ni44MDQtLjY2NEE0Ljk0NSA0Ljk0NSAwIDAgMSA3LjI5Ny4xNTYgNS40MDIgNS40MDIgMCAwIDEgOC41LjAzMXoiIGZpbGw9IiMwMDAiLz48L3N2Zz4=) no-repeat top left;
}

.redo-icn {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTkgNGgzLjI5Yy0uMzctLjM3NS0uNzI1LS43NC0xLjA2My0xLjA5NGE4LjQxOSA4LjQxOSAwIDAgMC0xLjA0Ny0uOTQ1IDQuNzM1IDQuNzM1IDAgMCAwLTEuMTk2LS42NzJjLS40MjctLjE3Mi0uOTIxLS4yNTgtMS40ODQtLjI1OC0uNjEgMC0xLjE4NS4xMi0xLjcyNy4zNmE0LjU0IDQuNTQgMCAwIDAtMS40MjEuOTZjLS40MDcuNDA3LS43My44OC0uOTcgMS40MjJhNC4zMDEgNC4zMDEgMCAwIDAtLjM1IDEuNzI3QTQuMzc1IDQuMzc1IDAgMCAwIDQuMzIgOC42MWw2LjUzMiA2LjUzOC0uNzA0LjcwNEwzLjYxIDkuMzJhNS4zODMgNS4zODMgMCAwIDEtMS4xNzEtMS43NSA1LjQ1MSA1LjQ1MSAwIDAgMSAuMzQzLTQuODJBNS41NSA1LjU1IDAgMCAxIDYuMDU1LjIyNyA1LjMyIDUuMzIgMCAwIDEgNy41LjAzYy40MzggMCAuODM2LjA0MiAxLjE5NS4xMjUuMzY1LjA3OC43LjE5IDEuMDA4LjMzNi4zMTMuMTQuNjA0LjMxMy44NzUuNTE2LjI3Ni4xOTguNTQ0LjQyLjgwNS42NjQuMjY1LjI0LjUyOS40OTcuNzg5Ljc3My4yNi4yNzEuNTM2LjU1Mi44MjguODQ0VjBoMXY1SDlWNHoiIGZpbGw9IiMwMDAiLz48L3N2Zz4=) no-repeat top left;
}

/* Pen drown down panel*/
.pen-panel-container {
  background: var(--screenshot-editor-pen-panel-background);
  border: none;
  box-shadow: 5px 5px 10px 0 rgba(0,0,0,0.4);
  display: flex;
  height: 214px;
  position: absolute;
  top: 108px;
  width: 272px;
  z-index: 1;
}

.pen-panel {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  overflow: hidden;
  padding: 8px;
}

.color-container {
  display: flex;
}

.pen-panel p {
  font-weight: 600;
  margin: 0;
}

.slider-container {
  display: flex;
  flex-direction: column;
  padding: 12px;
  padding-block-start: 0;
}

.size-sampler {
  height: 60px;
  margin-block-end: 12px;
}

.size-slider {
  -webkit-appearance: none;
  background: var(--edge-secondary-text-color);
  height: 2px;
  margin: 0;
  opacity: 0.7;
  outline: none;
  transition: opacity 200ms;
}

html.focus-by-keydown .size-slider:focus {
  outline: 2px solid var(--focus-border-color);
  outline-offset: 12px;
}
html.focus-by-keydown .size-slider:focus,
.size-slider:hover {
  opacity: 1.0;
}

.size-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  background: var(--primary-button-backgroundcolor);
  border-radius: 6px;
  cursor: pointer;
  height: 24px;
  width: 6px;
}

/* Pen Mode color buttons */
.color-button {
  -webkit-appearance: none;
  border: 2px solid var(--screenshot-editor-pen-panel-background);
  border-radius: 50%;
  height: 40px;
  margin: 2px;
  outline: none;
  width: 40px;
}

html.focus-by-keydown .color-button:focus {
  outline: 2px solid var(--focus-border-color);
  outline-offset: 1px;
}

.color-button:hover {
  border-color: transparent;
  box-shadow: none;
  outline: none;
}

.pen-panel input[type='radio']:checked {
  border: 2px solid var(--edge-primary-text-color);
  box-shadow: inset 0 0 0 2px var(--screenshot-editor-pen-panel-background);
}

#black-pen {
  background-color: #000;
}

#white-pen {
  background-color: #FFF;
}

#red-pen {
  background-color: rgb(230, 27, 27);
}

#blue-pen {
  background-color: rgb(35, 53, 249);
}

#green-pen {
  background-color: rgb(0, 122, 0);
}

#pink-pen {
  background-color: rgb(241, 0, 195);
}

.canvas-container {
  background-color: #E9E9E9;
  display: flex;
  flex: 1 100%;
  min-height: 100px;
  padding: 24px;
}

/* Resizable selection styles */
.resizable {
  position: absolute;
  visibility: hidden;
  z-index: 1;
}

.resizers {
  border: 4px solid var(--edge-blue-rest);
  box-sizing: border-box;
  height: 100%;
  width: 100%;
}

.resizer {
  background: var(--edge-blue-rest);
  border: none;
  border-radius: 50%;
  height: 16px;
  position: absolute;
  width: 16px;
}

html.focus-by-keydown .resizer:focus {
  outline: 2px solid var(--focus-border-color);
  outline-offset: 15px;
}

.top-left {
  cursor: nwse-resize;
  left: -5px;
  top: -5px;
}

.top-right {
  cursor: nesw-resize;
  right: -5px;
  top: -5px;
}

.bottom-left {
  bottom: -5px;
  cursor: nesw-resize;
  left: -5px;
}

.bottom-right {
  bottom: -5px;
  cursor: nwse-resize;
  right: -5px;
}

/* Save button style */
.save-button {
  text-transform: none !important;
  width: 150px;
}
</style>
  <style>/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

/* title bar */
.title-bar {
  -webkit-app-region: drag;
  align-items: center;
  display: flex;
  min-height: 54px;
}

.title-bar .logo-image {
  height: 28px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
  width: 28px;
}

.title-bar .page-title {
  flex: 1 1 auto;
  font-size: 15px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
}

.title-bar .page-title.bold {
  font-size: 18px !important;
  margin-inline-start: 20px !important;
}

.title-bar .topbutton-bar {
  display: flex;
}

.title-bar .topbutton-bar .title-bar-button {
  -webkit-app-region: no-drag;
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 2px solid transparent;
  display: flex;
  height: 32px;
  margin-block-start: -12px;
  overflow: hidden;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.title-bar .topbutton-bar .title-bar-button:last-child {
  margin-inline-end: 6px;
}

html.focus-by-keydown .title-bar .topbutton-bar .title-bar-button:focus {
  border: 2px solid var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.title-bar .topbutton-bar .title-bar-button:hover {
  background-color: var(--titlebar-button-hover-color);
  border-color: var(--titlebar-button-hover-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button:active {
  background-color: var(--titlebar-button-active-color);
  border-color: var(--titlebar-button-active-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button > span {
  filter: var(--svg-icon-filter-invert);
  height: 16px;
  width: 16px;
}

.title-bar .maximize-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAxMCAxMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik0xMCAwLjU4ODg2N1YxMC41ODg5SDBWMC41ODg4NjdIMTBaTTguOTk5MDIgMS41ODk4NEgxLjAwMDk4VjkuNTg3ODlIOC45OTkwMlYxLjU4OTg0WiIvPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .restore-down-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAyMDQ4IDIwNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyINCiAgICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgPHBhdGggZmlsbD0iIzEwMTAxMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwyMDQ4KSBzY2FsZSgxLC0xKSINCiAgICBkPSJNMjA0OCAyMDQ4TDIwNDggNDEwTDE2MzggNDEwTDE2MzggMEwwIDBMMCAxNjM4TDQxMCAxNjM4TDQxMCAyMDQ4TDIwNDggMjA0OFpNMTQzNCAyMDVMMTQzNCAxNDM0TDIwNSAxNDM0TDIwNSAyMDVMMTQzNCAyMDVaTTE4NDMgNjE0TDE4NDMgMTg0M0w2MTQgMTg0M0w2MTQgMTYzOEwxNjM4IDE2MzhMMTYzOCA2MTRMMTg0MyA2MTRaIj4NCiAgPC9wYXRoPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .close-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik01LjcwODAxIDVMMTAgOS4yOTE5OUw5LjI5MTk5IDEwTDUgNS43MDgwMUwwLjcwODAwOCAxMEwwIDkuMjkxOTlMNC4yOTE5OSA1TDAgMC43MDgwMDhMMC43MDgwMDggMEw1IDQuMjkxOTlMOS4yOTE5OSAwTDEwIDAuNzA4MDA4TDUuNzA4MDEgNVoiLz4NCjwvc3ZnPg0K) no-repeat center;
}

/* Close button styles */
.title-bar .close-button {
  -webkit-app-region: no-drag;
  display: block;
  margin-block-start: -12px;
  margin-inline-end: 6px;
}

.close-button {
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 0;
  height: 32px;
  margin: 0;
  overflow: hidden;
  padding: 0;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.close-button > span {
  display: inline-flex;
  height: 12px;
  position: relative;
  width: 12px;
}

.close-button > span::before {
  transform: rotate(-45deg);
}

.close-button > span::after {
  transform: rotate(45deg);
}

.close-button > span::after,
.close-button > span::before {
  content: '';
  height: 14px;
  left: 6px;
  position: absolute;
  top: 0;
  width: 1px;
}

/* black color close button */
.close-button > span::after,
.close-button > span::before {
  background-color: var(--close-button-icon-color);
}

html.focus-by-keydown .topbutton-bar button:focus,
html.focus-by-keydown .close-button:focus {
  border: 2px solid  var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.topbutton-bar button:hover,
.close-button:hover {
  background-color: var(--close-button-hover-color);
  border: 0;
  border-radius: 2px;
}

.close-button:active {
  background-color: var(--close-button-active-color);
  border: 0;
  border-radius: 2px;
}
</style>
  <script src="../js/focus_outline_manager.js"></script>
  <script src="edge://resources/js/util.js"></script>
  <script src="edge://resources/js/i18n_template_no_process.js"></script>
  <script src="../js/topbar_handlers.js"></script>
  <script src="../js/resize_app_window.js"></script>
  <script src="../js/screenshot_editor.js"></script>
</head>
<body>
  <div id="title-bar" class="title-bar">
    <img alt="" class="logo-image"
         srcset="edge://theme/current-channel-logo@1x 1x,edge://theme/current-channel-logo@2x 2x">
    <h1 id="page-title" class="page-title bold"
        i18n-content="screenshotEditorTitle"></h1>
    <span class="topbutton-bar">
      <button id="maximize-button" type="button"
              class="title-bar-button maximize-icon"
              i18n-values="aria-label:maximizeButtonLabel;
                            title:maximizeButtonLabel">
        <span></span>
      </button>
      <button id="close-button" type="button"
              class="title-bar-button close-icon"
              i18n-values="aria-label:closeButtonLabel">
        <span></span>
      </button>
    </span>
  </div>
  <div class="wrapper" id="content-pane">
    <div class="outer-panel">
      <div id="home-tool-container" class="center-tool-bar">
        <button id="crop-button"
                class="button tool-bar-button"
                i18n-values="aria-label:screenshotEditorCropButton;
                                  title:screenshotEditorCropButton">
          <span class="tool-icn crop-mode-icn"></span>
        </button>
        <button id="pen-button" aria-expanded="false"
                class="button tool-bar-button" hidden
                i18n-values="aria-label:screenshotEditorPenButton;
                                  title:screenshotEditorPenButton">
          <span class="tool-icn pen-mode-icn"></span>
          <svg width="16px" height="16px" viewBox="0 0 2048 2048"
               xmlns="http://www.w3.org/2000/svg"
               xmlns:xlink="http://www.w3.org/1999/xlink">
            <path id="pen-fill" transform="translate(0,2048) scale(1,-1)"
             d="M288 1600L288 1600L1760 1600L1312 704L736 704L288 1600Z"></path>
          </svg>
          <span id="pen-active" class="pen-mode-icn-active" hidden>
            <span id="pen-arrow" class="pen-mode-icn-arrow"></span>
            <span class="pen-mode-icn-line"></span>
          </span>
        </button>
        <div id="separator" class="separator"></div>
        <button id="undo-button"
                class="button tool-bar-button"
                i18n-values="aria-label:screenshotEditorUpdoButton;
                                  title:screenshotEditorUpdoButton">
          <span id="undo-icon" class="tool-icn undo-icn"></span>
        </button>
        <button id="redo-button"
                class="button tool-bar-button"
                i18n-values="aria-label:screenshotEditorRedoButton;
                                  title:screenshotEditorRedoButton">
          <span id="redo-icon" class="tool-icn redo-icn"></span>
        </button>
      </div>
      <div id="crop-tools-container" class="center-tool-bar" hidden>
        <button id="crop-save-button"
                class="button tool-bar-button crop-tool-button-with-text">
          <span class="tool-icn crop-save-icn"></span>
          <span i18n-content="screenshotEditorCropApplyButton"></span>
        </button>
        <button id="crop-cancel-button"
                class="button tool-bar-button crop-tool-button-with-text">
          <span class="tool-icn crop-cancel-icn"></span>
          <span i18n-content="screenshotEditorCropCancelButton"></span>
        </button>
      </div>
      <div id="pen-tools-container" class="pen-panel-container" hidden
           role="dialog" i18n-values="aria-label:screenshotEditorPenPanel">
        <div class="pen-panel">
          <p i18n-content="screenshotEditorPenColor"></p>
          <div class="color-container" role="radiogroup" tabindex="-1">
            <input id="black-pen" name="color" class="color-button" type="radio"
                   tabindex="0" checked
                   i18n-values="aria-label:screenshotEditorColorBlack;
                                   title:screenshotEditorColorBlack">
            <input id="white-pen" name="color" class="color-button" type="radio"
                   i18n-values="aria-label:screenshotEditorColorWhite;
                                   title:screenshotEditorColorWhite">
            <input id="red-pen" name="color" class="color-button" type="radio"
                   i18n-values="aria-label:screenshotEditorColorRed;
                                   title:screenshotEditorColorRed">
            <input id="blue-pen" name="color" class="color-button" type="radio"
                   i18n-values="aria-label:screenshotEditorColorBlue;
                                   title:screenshotEditorColorBlue">
            <input id="green-pen" name="color" class="color-button" type="radio"
                   i18n-values="aria-label:screenshotEditorColorGreen;
                                   title:screenshotEditorColorGreen">
            <input id="pink-pen" name="color" class="color-button" type="radio"
                   i18n-values="aria-label:screenshotEditorColorPink;
                                   title:screenshotEditorColorPink">
          </div>
          <p id="pen-size" i18n-content="screenshotEditorPenSize"></p>
          <div class="slider-container">
            <canvas id="size-sampler" class="size-sampler"></canvas>
            <input id="size-slider" class="size-slider" title="4"
                   type="range" min="5" max="18" value="8"
                   aria-labelledby="pen-size">
          </div>
        </div>
      </div>
    </div>
    <div id="canvas-container" class="canvas-container">
      <canvas id="canvas-screenshot"
              role="img" i18n-values="aria-label:screenshotImage"></canvas>
      <div id="selection" class="resizable">
        <div id="resizers" class="resizers" role="group" tabindex="-1"
             i18n-values="aria-label:screenshotEditorCropArea">
          <div id="resizer-top-left"
               tabindex="1" class="resizer top-left"
               i18n-values="aria-label:screenshotEditorResizerTopLeft"
               role="button"></div>
          <div id="resizer-top-right"
               tabindex="2" class="resizer top-right"
               i18n-values="aria-label:screenshotEditorResizerTopRight"
               role="button"></div>
          <div id="resizer-bottom-left"
               tabindex="3" class="resizer bottom-left"
               i18n-values="aria-label:screenshotEditorResizerBottomLeft"
               role="button"></div>
          <div id="resizer-bottom-right"
               tabindex="4" class="resizer bottom-right"
               i18n-values="aria-label:
               screenshotEditorResizerBottomRight"
               role="button"></div>
        </div>
      </div>
    </div>
    <div class="outer-panel bottom-panel">
      <button id="save-button"
              class="button primary-button save-button" type="submit"
              i18n-content="saveAndIncludeButton"></button></div>
  </div>
</body>
</html>
<!doctype html>
<html>
<head>
  <title id="head-title"></title>
  <meta charset="utf-8">
  <style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

:root {
  --edge-white: #FFFFFF;
  --edge-black: #101010;
  --edge-content-background-color: #F7F7F7;
  --edge-primary-text-color: var(--edge-black);
  --edge-secondary-text-color: #6F6F6F;

  --edge-border-hover: #949494;
  --edge-border-rest: #C5C5C5;
  --edge-border-pressed: #ADADAD;

  --edge-blue-border-focus: #888888;
  --edge-blue-hover: #006CBE;
  --edge-blue-rest: #0078D4;
  --edge-blue-pressed: #1081D7;
  --edge-blue-selected: #004274;

  --edge-grey-hover: #EAEAEA;
  --edge-grey-rest: #E6E6E6;
  --edge-grey-pressed: #EFEFEF;

  --edge-light-border-hover: #9C9C9C;
  --edge-light-border-rest: #CECECE;
  --edge-light-border-pressed: #B5B5B5;

  --edge-light-grey-hover: #F3F3F3;
  --edge-light-grey-rest: #EFEFEF;
  --edge-light-grey-pressed: #F7F7F7;

  --link-active: #1081D7;
  --link-color: #0061AB;
  --link-hover: #0070C6;

  --checkbox-checked-color: var(--edge-black);
  --focus-border-color: var(--edge-black);
  --input-control-background-color: var(--edge-white);

  --close-button-active-color: var(--edge-grey-pressed);
  --close-button-hover-color: var(--edge-grey-hover);
  --close-button-icon-color: var(--edge-black);

  --titlebar-button-active-color: var(--edge-grey-pressed);
  --titlebar-button-hover-color: var(--edge-grey-hover);

  --primary-button-border-focus: var(--edge-blue-border-focus);
  --primary-button-box-focus: var(--edge-white);
  --primary-button-active: var(--edge-blue-pressed);
  --primary-button-backgroundcolor: var(--edge-blue-rest);
  --primary-button-hover: var(--edge-blue-hover);

  --secondary-button-active: var(--edge-grey-pressed);
  --secondary-button-background: var(--edge-grey-rest);
  --secondary-button-hover: var(--edge-grey-hover);

  --scrollbar-track-color: #EFEFEF;
  --scrollbar-thumb-color: #CACACA;
  --scrollbar-thumb-hover-color: #9E9E9E;

  --radio-button-checked-border-color: var(--edge-black);
  --radio-button-dot-color: var(--edge-black);

  --toggle-knob-off-color: var(--edge-black);
  --toggle-knob-on-color: var(--edge-white);

  --progressbar-background-color: #EFEFEF;
  --progressbar-bar-color: var(--edge-blue-rest);

  /* Svg color stays black in light mode */
  --svg-icon-filter-invert: invert(0%);
  /* Convert svg black to --link-color using filter */
  --svg-icon-filter-blue:
      invert(26%) sepia(59%) saturate(2259%)
      hue-rotate(186deg) brightness(99%) contrast(101%);

  --sys-info-list-item-hover-color: var(--edge-grey-hover);

  --screenshot-editor-secondary-button-hover: var(--edge-grey-hover);
  --screenshot-editor-pen-panel-background: #E0E0E0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --edge-white: #FFFFFF;
    --edge-black: #1D1D1D;
    --edge-content-background-color: #2D2D2D;
    --edge-primary-text-color: var(--edge-white);
    --edge-secondary-text-color: #949494;

    --edge-border-hover: #909090;
    --edge-border-rest: #575757;
    --edge-border-pressed: #787878;

    --edge-blue-border-focus: #888888;
    --edge-blue-box-focus: #00355D;
    --edge-blue-hover: #0078D4;
    --edge-blue-rest: #006CBE;
    --edge-blue-pressed: #0069B9;
    --edge-blue-selected: #63ACE5;

    --edge-grey-hover: #3A3A3A;
    --edge-grey-rest: #3E3E3E;
    --edge-grey-pressed: #353535;

    --edge-light-border-hover: #999999;
    --edge-light-border-rest: #676767;
    --edge-light-border-pressed: #808080;

    --edge-light-grey-hover: #424242;
    --edge-light-grey-rest: #464646;
    --edge-light-grey-pressed: #3E3E3E;

    --link-active: #2189DA;
    --link-color: #63ACE5;
    --link-hover: #429BDF;

    --checkbox-checked-color: var(--edge-white);
    --focus-border-color: var(--edge-white);
    --input-control-background-color: var(--edge-black);

    --close-button-active-color: var(--edge-grey-pressed);
    --close-button-hover-color: var(--edge-grey-hover);
    --close-button-icon-color: var(--edge-white);

    --titlebar-button-active-color: var(--edge-grey-pressed);
    --titlebar-button-hover-color: var(--edge-grey-hover);

    --primary-button-active: var(--edge-blue-pressed);
    --primary-button-backgroundcolor: var(--edge-blue-rest);
    --primary-button-border-focus: var(--edge-blue-border-focus);
    --primary-button-box-focus: var(--edge-blue-box-focus);
    --primary-button-hover: var(--edge-blue-hover);

    --secondary-button-active: var(--edge-grey-pressed);
    --secondary-button-background: var(--edge-grey-rest);
    --secondary-button-hover: var(--edge-grey-hover);

    --scrollbar-track-color: #272727;
    --scrollbar-thumb-color: #4E4E4E;
    --scrollbar-thumb-hover-color: #7D7D7D;

    --radio-button-checked-border-color: var(--edge-white);
    --radio-button-dot-color: var(--edge-white);

    --toggle-knob-off-color: var(--edge-white);
    --toggle-knob-on-color: var(--edge-white);

    --progressbar-background-color: #212121;
    --progressbar-bar-color: var(--edge-blue-rest);

    /* Convert svg black to white using filter */
    --svg-icon-filter-invert: invert(100%);
    /* Convert svg black to --link-color using filter */
    --svg-icon-filter-blue:
        invert(65%) sepia(76%) saturate(643%)
        hue-rotate(177deg) brightness(92%) contrast(95%);

    --sys-info-list-item-hover-color: var(--edge-light-grey-hover);

    --screenshot-editor-secondary-button-hover: var(--edge-light-grey-hover);
    --screenshot-editor-pen-panel-background: #404040;
  }
}

:root {
  --button-alignment: flex-end;
  --text-capitalize: initial;
}

:root.mac {
  --text-capitalize: capitalize;
}

body {
  background-color: var(--edge-content-background-color);
  color: var(--edge-primary-text-color);
  font-family: system-ui, Segoe UI, SegoeUI, Helvetica Neue,
               Helvetica, Arial, sans-serif;
  font-size: 14px;
  line-height: 20px;
}

[hidden] {
  display: none !important;
}

/* scrollbar styles */
::-webkit-scrollbar {
  height: 12px;
  width: 12px;
}

::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color);
  border: solid 3px var(--scrollbar-track-color);
  border-radius: 9px;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover-color);
}

::-webkit-scrollbar-track {
  background-color: var(--scrollbar-track-color);
}

::-webkit-scrollbar-corner {
  background-color: var(--scrollbar-track-color);
}

/* Input text and textarea styles */
input[type=text],
input[type=url],
input[type=email],
textarea {
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  color: var(--edge-primary-text-color);
  font-family: inherit;
  font-size: inherit;
  font-weight: 400;
  margin: 0;
  max-width: 100%;
  padding: 10px;
}

input[type=text]:hover,
input[type=url]:hover,
input[type=email]:hover,
input[type=checkbox]:hover,
textarea:hover {
  border-color: var(--edge-border-hover);
}

html:not(.focus-by-keydown) *:focus {
  outline: none;
}

input[type=text]:focus,
input[type=url]:focus,
input[type=email]:focus,
html.focus-by-keydown input[type=checkbox]:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  box-shadow: var(--focus-border-color) 0 0 0 1px inset;
  outline: none;
}

textarea:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  outline: 1px solid var(--focus-border-color) !important;
}

input[type=email]:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

/* button styles */
.button {
  align-items: center;
  border: 2px solid;
  border-color: transparent;
  border-radius: 2px;
  box-sizing: border-box;
  display: inline-flex;
  font-family: inherit;
  font-size: 14px;
  height: 32px;
  justify-content: center;
  line-height: 1;
  overflow: hidden;
  padding: 0 16px;
  text-decoration: none;
  text-transform: var(--text-capitalize);
  transition: all 200ms ease-in-out;
  white-space: nowrap;
}

.button:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

html.focus-by-keydown .button:focus {
  border-color: var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

html.focus-by-keydown .primary-button:focus {
  border-color: var(--primary-button-border-focus);
  box-shadow: 0 0 0 2px inset var(--primary-button-box-focus);
  outline: none;
}

.primary-button {
  background-color: var(--primary-button-backgroundcolor);
  color: white;
}

.primary-button:hover {
  background-color: var(--primary-button-hover);
}

.primary-button:active {
  background-color: var(--primary-button-active);
}

.secondary-button {
  background-color: var(--secondary-button-background);
  color: var(--edge-primary-text-color);
}

.secondary-button:hover {
  background-color: var(--secondary-button-hover);
}

.secondary-button:active {
  background-color: var(--secondary-button-active);
}

.outline-button {
  background-color: transparent;
  border-color: var(--edge-light-border-rest);
  border-width: 1px;
  color: var(--edge-primary-text-color);
}

.outline-button:hover {
  background-color: var(--edge-light-grey-hover);
  border-color: var(--edge-light-border-hover);
}

.outline-button:active {
  background-color: var(--edge-light-grey-pressed);
  border-color: var(--edge-light-border-pressed);
}

html.focus-by-keydown .outline-button:focus {
  border-width: 2px;
}

/* hypertext link styles */
a {
  outline: none;
  text-decoration: none;
}

a:link,
a:visited {
  border-bottom: solid 1px var(--link-color);
  color: var(--link-color);
}

a:link:hover,
a:visited:hover {
  border-bottom: 2px solid var(--link-hover);
  box-shadow: none;
  color: var(--link-hover);
  outline: none;
}

a:link:active,
a:visited:active {
  color: var(--link-active);
}

html.focus-by-keydown a:link:focus,
html.focus-by-keydown a:visited:focus {
  border-bottom: 2px solid var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

/* Checkbox styles */
.checkbox-container {
  align-items: center;
  display: inline-flex;
  flex-direction: row;
  position: relative;
}

.checkbox-container .checkbox {
  -webkit-appearance: none;
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  height: 18px;
  margin: 0;
  position: absolute;
  width: 18px;
  z-index: 1;
}

.checkbox-container .check-symbol {
  border-radius: 2px;
  display: inline-block;
  flex-shrink: 0;
  height: 18px;
  position: relative;
  width: 18px;
}

.checkbox-container .check-symbol::before {
  height: 11px;
  left: 10px;
  top: 3px;
  transform: rotate(40deg);
}

.checkbox-container .check-symbol::after {
  height: 5px;
  left: 5px;
  top: 8px;
  transform: rotate(-45deg);
}

.checkbox-container .check-symbol::before,
.checkbox-container .check-symbol::after {
  content: '';
  pointer-events: none;
  position: absolute;
  width: 2px;
  z-index: 1;
}

.checkbox-container input[type=checkbox]:checked + .check-symbol::before,
.checkbox-container input[type=checkbox]:checked + .check-symbol::after {
  background-color: var(--checkbox-checked-color);
}

.checkbox-container .checkbox-label {
  padding-inline-end: 8px;
  padding-inline-start: 8px;
}
</style>
  <style>/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

/* title bar */
.title-bar {
  -webkit-app-region: drag;
  align-items: center;
  display: flex;
  min-height: 54px;
}

.title-bar .logo-image {
  height: 28px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
  width: 28px;
}

.title-bar .page-title {
  flex: 1 1 auto;
  font-size: 15px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
}

.title-bar .page-title.bold {
  font-size: 18px !important;
  margin-inline-start: 20px !important;
}

.title-bar .topbutton-bar {
  display: flex;
}

.title-bar .topbutton-bar .title-bar-button {
  -webkit-app-region: no-drag;
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 2px solid transparent;
  display: flex;
  height: 32px;
  margin-block-start: -12px;
  overflow: hidden;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.title-bar .topbutton-bar .title-bar-button:last-child {
  margin-inline-end: 6px;
}

html.focus-by-keydown .title-bar .topbutton-bar .title-bar-button:focus {
  border: 2px solid var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.title-bar .topbutton-bar .title-bar-button:hover {
  background-color: var(--titlebar-button-hover-color);
  border-color: var(--titlebar-button-hover-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button:active {
  background-color: var(--titlebar-button-active-color);
  border-color: var(--titlebar-button-active-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button > span {
  filter: var(--svg-icon-filter-invert);
  height: 16px;
  width: 16px;
}

.title-bar .maximize-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAxMCAxMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik0xMCAwLjU4ODg2N1YxMC41ODg5SDBWMC41ODg4NjdIMTBaTTguOTk5MDIgMS41ODk4NEgxLjAwMDk4VjkuNTg3ODlIOC45OTkwMlYxLjU4OTg0WiIvPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .restore-down-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAyMDQ4IDIwNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyINCiAgICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgPHBhdGggZmlsbD0iIzEwMTAxMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwyMDQ4KSBzY2FsZSgxLC0xKSINCiAgICBkPSJNMjA0OCAyMDQ4TDIwNDggNDEwTDE2MzggNDEwTDE2MzggMEwwIDBMMCAxNjM4TDQxMCAxNjM4TDQxMCAyMDQ4TDIwNDggMjA0OFpNMTQzNCAyMDVMMTQzNCAxNDM0TDIwNSAxNDM0TDIwNSAyMDVMMTQzNCAyMDVaTTE4NDMgNjE0TDE4NDMgMTg0M0w2MTQgMTg0M0w2MTQgMTYzOEwxNjM4IDE2MzhMMTYzOCA2MTRMMTg0MyA2MTRaIj4NCiAgPC9wYXRoPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .close-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik01LjcwODAxIDVMMTAgOS4yOTE5OUw5LjI5MTk5IDEwTDUgNS43MDgwMUwwLjcwODAwOCAxMEwwIDkuMjkxOTlMNC4yOTE5OSA1TDAgMC43MDgwMDhMMC43MDgwMDggMEw1IDQuMjkxOTlMOS4yOTE5OSAwTDEwIDAuNzA4MDA4TDUuNzA4MDEgNVoiLz4NCjwvc3ZnPg0K) no-repeat center;
}

/* Close button styles */
.title-bar .close-button {
  -webkit-app-region: no-drag;
  display: block;
  margin-block-start: -12px;
  margin-inline-end: 6px;
}

.close-button {
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 0;
  height: 32px;
  margin: 0;
  overflow: hidden;
  padding: 0;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.close-button > span {
  display: inline-flex;
  height: 12px;
  position: relative;
  width: 12px;
}

.close-button > span::before {
  transform: rotate(-45deg);
}

.close-button > span::after {
  transform: rotate(45deg);
}

.close-button > span::after,
.close-button > span::before {
  content: '';
  height: 14px;
  left: 6px;
  position: absolute;
  top: 0;
  width: 1px;
}

/* black color close button */
.close-button > span::after,
.close-button > span::before {
  background-color: var(--close-button-icon-color);
}

html.focus-by-keydown .topbutton-bar button:focus,
html.focus-by-keydown .close-button:focus {
  border: 2px solid  var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.topbutton-bar button:hover,
.close-button:hover {
  background-color: var(--close-button-hover-color);
  border: 0;
  border-radius: 2px;
}

.close-button:active {
  background-color: var(--close-button-active-color);
  border: 0;
  border-radius: 2px;
}
</style>
  <script src="../js/focus_outline_manager.js"></script>
  <script src="edge://resources/js/util.js"></script>
  <script src="../js/topbar_handlers.js"></script>
  <script src="../js/sys_info_log.js"></script>
  <style>
    html {
      height: 100%;
    }

    body {
      display: flex;
      flex-direction: column;
      height: 100%;
      margin: 0;
      padding: 0;
      width: 100%;
    }

    .log-wrapper {
      margin-block-end: 24px;
      margin-block-start: 10px;
      margin-inline-end: 20px;
      margin-inline-start: 24px;
      overflow: auto;
    }

    html.focus-by-keydown .log-wrapper:focus {
      outline: 2px solid var(--focus-border-color);
    }

    html[dir='rtl'] #log-content {
      margin-inline-start: 8px;
    }

    #log-content {
      overflow: auto;
      user-select: all;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div id="title-bar" class="title-bar">
    <h1 id="page-title" class="page-title"></h1>
    <button id="close-button" class="close-button"><span></span></button>
  </div>
  <div class="log-wrapper" tabindex="0">
    <div id="log-content" dir="auto"></div>
  </div>
</body>
</html>
<!doctype html>
<html i18n-values="dir:textdirection;lang:language">
<head>
  <title i18n-content="sysInfoPageTitle"></title>
  <meta charset="utf-8">
  <style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

:root {
  --edge-white: #FFFFFF;
  --edge-black: #101010;
  --edge-content-background-color: #F7F7F7;
  --edge-primary-text-color: var(--edge-black);
  --edge-secondary-text-color: #6F6F6F;

  --edge-border-hover: #949494;
  --edge-border-rest: #C5C5C5;
  --edge-border-pressed: #ADADAD;

  --edge-blue-border-focus: #888888;
  --edge-blue-hover: #006CBE;
  --edge-blue-rest: #0078D4;
  --edge-blue-pressed: #1081D7;
  --edge-blue-selected: #004274;

  --edge-grey-hover: #EAEAEA;
  --edge-grey-rest: #E6E6E6;
  --edge-grey-pressed: #EFEFEF;

  --edge-light-border-hover: #9C9C9C;
  --edge-light-border-rest: #CECECE;
  --edge-light-border-pressed: #B5B5B5;

  --edge-light-grey-hover: #F3F3F3;
  --edge-light-grey-rest: #EFEFEF;
  --edge-light-grey-pressed: #F7F7F7;

  --link-active: #1081D7;
  --link-color: #0061AB;
  --link-hover: #0070C6;

  --checkbox-checked-color: var(--edge-black);
  --focus-border-color: var(--edge-black);
  --input-control-background-color: var(--edge-white);

  --close-button-active-color: var(--edge-grey-pressed);
  --close-button-hover-color: var(--edge-grey-hover);
  --close-button-icon-color: var(--edge-black);

  --titlebar-button-active-color: var(--edge-grey-pressed);
  --titlebar-button-hover-color: var(--edge-grey-hover);

  --primary-button-border-focus: var(--edge-blue-border-focus);
  --primary-button-box-focus: var(--edge-white);
  --primary-button-active: var(--edge-blue-pressed);
  --primary-button-backgroundcolor: var(--edge-blue-rest);
  --primary-button-hover: var(--edge-blue-hover);

  --secondary-button-active: var(--edge-grey-pressed);
  --secondary-button-background: var(--edge-grey-rest);
  --secondary-button-hover: var(--edge-grey-hover);

  --scrollbar-track-color: #EFEFEF;
  --scrollbar-thumb-color: #CACACA;
  --scrollbar-thumb-hover-color: #9E9E9E;

  --radio-button-checked-border-color: var(--edge-black);
  --radio-button-dot-color: var(--edge-black);

  --toggle-knob-off-color: var(--edge-black);
  --toggle-knob-on-color: var(--edge-white);

  --progressbar-background-color: #EFEFEF;
  --progressbar-bar-color: var(--edge-blue-rest);

  /* Svg color stays black in light mode */
  --svg-icon-filter-invert: invert(0%);
  /* Convert svg black to --link-color using filter */
  --svg-icon-filter-blue:
      invert(26%) sepia(59%) saturate(2259%)
      hue-rotate(186deg) brightness(99%) contrast(101%);

  --sys-info-list-item-hover-color: var(--edge-grey-hover);

  --screenshot-editor-secondary-button-hover: var(--edge-grey-hover);
  --screenshot-editor-pen-panel-background: #E0E0E0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --edge-white: #FFFFFF;
    --edge-black: #1D1D1D;
    --edge-content-background-color: #2D2D2D;
    --edge-primary-text-color: var(--edge-white);
    --edge-secondary-text-color: #949494;

    --edge-border-hover: #909090;
    --edge-border-rest: #575757;
    --edge-border-pressed: #787878;

    --edge-blue-border-focus: #888888;
    --edge-blue-box-focus: #00355D;
    --edge-blue-hover: #0078D4;
    --edge-blue-rest: #006CBE;
    --edge-blue-pressed: #0069B9;
    --edge-blue-selected: #63ACE5;

    --edge-grey-hover: #3A3A3A;
    --edge-grey-rest: #3E3E3E;
    --edge-grey-pressed: #353535;

    --edge-light-border-hover: #999999;
    --edge-light-border-rest: #676767;
    --edge-light-border-pressed: #808080;

    --edge-light-grey-hover: #424242;
    --edge-light-grey-rest: #464646;
    --edge-light-grey-pressed: #3E3E3E;

    --link-active: #2189DA;
    --link-color: #63ACE5;
    --link-hover: #429BDF;

    --checkbox-checked-color: var(--edge-white);
    --focus-border-color: var(--edge-white);
    --input-control-background-color: var(--edge-black);

    --close-button-active-color: var(--edge-grey-pressed);
    --close-button-hover-color: var(--edge-grey-hover);
    --close-button-icon-color: var(--edge-white);

    --titlebar-button-active-color: var(--edge-grey-pressed);
    --titlebar-button-hover-color: var(--edge-grey-hover);

    --primary-button-active: var(--edge-blue-pressed);
    --primary-button-backgroundcolor: var(--edge-blue-rest);
    --primary-button-border-focus: var(--edge-blue-border-focus);
    --primary-button-box-focus: var(--edge-blue-box-focus);
    --primary-button-hover: var(--edge-blue-hover);

    --secondary-button-active: var(--edge-grey-pressed);
    --secondary-button-background: var(--edge-grey-rest);
    --secondary-button-hover: var(--edge-grey-hover);

    --scrollbar-track-color: #272727;
    --scrollbar-thumb-color: #4E4E4E;
    --scrollbar-thumb-hover-color: #7D7D7D;

    --radio-button-checked-border-color: var(--edge-white);
    --radio-button-dot-color: var(--edge-white);

    --toggle-knob-off-color: var(--edge-white);
    --toggle-knob-on-color: var(--edge-white);

    --progressbar-background-color: #212121;
    --progressbar-bar-color: var(--edge-blue-rest);

    /* Convert svg black to white using filter */
    --svg-icon-filter-invert: invert(100%);
    /* Convert svg black to --link-color using filter */
    --svg-icon-filter-blue:
        invert(65%) sepia(76%) saturate(643%)
        hue-rotate(177deg) brightness(92%) contrast(95%);

    --sys-info-list-item-hover-color: var(--edge-light-grey-hover);

    --screenshot-editor-secondary-button-hover: var(--edge-light-grey-hover);
    --screenshot-editor-pen-panel-background: #404040;
  }
}

:root {
  --button-alignment: flex-end;
  --text-capitalize: initial;
}

:root.mac {
  --text-capitalize: capitalize;
}

body {
  background-color: var(--edge-content-background-color);
  color: var(--edge-primary-text-color);
  font-family: system-ui, Segoe UI, SegoeUI, Helvetica Neue,
               Helvetica, Arial, sans-serif;
  font-size: 14px;
  line-height: 20px;
}

[hidden] {
  display: none !important;
}

/* scrollbar styles */
::-webkit-scrollbar {
  height: 12px;
  width: 12px;
}

::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color);
  border: solid 3px var(--scrollbar-track-color);
  border-radius: 9px;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover-color);
}

::-webkit-scrollbar-track {
  background-color: var(--scrollbar-track-color);
}

::-webkit-scrollbar-corner {
  background-color: var(--scrollbar-track-color);
}

/* Input text and textarea styles */
input[type=text],
input[type=url],
input[type=email],
textarea {
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  color: var(--edge-primary-text-color);
  font-family: inherit;
  font-size: inherit;
  font-weight: 400;
  margin: 0;
  max-width: 100%;
  padding: 10px;
}

input[type=text]:hover,
input[type=url]:hover,
input[type=email]:hover,
input[type=checkbox]:hover,
textarea:hover {
  border-color: var(--edge-border-hover);
}

html:not(.focus-by-keydown) *:focus {
  outline: none;
}

input[type=text]:focus,
input[type=url]:focus,
input[type=email]:focus,
html.focus-by-keydown input[type=checkbox]:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  box-shadow: var(--focus-border-color) 0 0 0 1px inset;
  outline: none;
}

textarea:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  outline: 1px solid var(--focus-border-color) !important;
}

input[type=email]:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

/* button styles */
.button {
  align-items: center;
  border: 2px solid;
  border-color: transparent;
  border-radius: 2px;
  box-sizing: border-box;
  display: inline-flex;
  font-family: inherit;
  font-size: 14px;
  height: 32px;
  justify-content: center;
  line-height: 1;
  overflow: hidden;
  padding: 0 16px;
  text-decoration: none;
  text-transform: var(--text-capitalize);
  transition: all 200ms ease-in-out;
  white-space: nowrap;
}

.button:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

html.focus-by-keydown .button:focus {
  border-color: var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

html.focus-by-keydown .primary-button:focus {
  border-color: var(--primary-button-border-focus);
  box-shadow: 0 0 0 2px inset var(--primary-button-box-focus);
  outline: none;
}

.primary-button {
  background-color: var(--primary-button-backgroundcolor);
  color: white;
}

.primary-button:hover {
  background-color: var(--primary-button-hover);
}

.primary-button:active {
  background-color: var(--primary-button-active);
}

.secondary-button {
  background-color: var(--secondary-button-background);
  color: var(--edge-primary-text-color);
}

.secondary-button:hover {
  background-color: var(--secondary-button-hover);
}

.secondary-button:active {
  background-color: var(--secondary-button-active);
}

.outline-button {
  background-color: transparent;
  border-color: var(--edge-light-border-rest);
  border-width: 1px;
  color: var(--edge-primary-text-color);
}

.outline-button:hover {
  background-color: var(--edge-light-grey-hover);
  border-color: var(--edge-light-border-hover);
}

.outline-button:active {
  background-color: var(--edge-light-grey-pressed);
  border-color: var(--edge-light-border-pressed);
}

html.focus-by-keydown .outline-button:focus {
  border-width: 2px;
}

/* hypertext link styles */
a {
  outline: none;
  text-decoration: none;
}

a:link,
a:visited {
  border-bottom: solid 1px var(--link-color);
  color: var(--link-color);
}

a:link:hover,
a:visited:hover {
  border-bottom: 2px solid var(--link-hover);
  box-shadow: none;
  color: var(--link-hover);
  outline: none;
}

a:link:active,
a:visited:active {
  color: var(--link-active);
}

html.focus-by-keydown a:link:focus,
html.focus-by-keydown a:visited:focus {
  border-bottom: 2px solid var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

/* Checkbox styles */
.checkbox-container {
  align-items: center;
  display: inline-flex;
  flex-direction: row;
  position: relative;
}

.checkbox-container .checkbox {
  -webkit-appearance: none;
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  height: 18px;
  margin: 0;
  position: absolute;
  width: 18px;
  z-index: 1;
}

.checkbox-container .check-symbol {
  border-radius: 2px;
  display: inline-block;
  flex-shrink: 0;
  height: 18px;
  position: relative;
  width: 18px;
}

.checkbox-container .check-symbol::before {
  height: 11px;
  left: 10px;
  top: 3px;
  transform: rotate(40deg);
}

.checkbox-container .check-symbol::after {
  height: 5px;
  left: 5px;
  top: 8px;
  transform: rotate(-45deg);
}

.checkbox-container .check-symbol::before,
.checkbox-container .check-symbol::after {
  content: '';
  pointer-events: none;
  position: absolute;
  width: 2px;
  z-index: 1;
}

.checkbox-container input[type=checkbox]:checked + .check-symbol::before,
.checkbox-container input[type=checkbox]:checked + .check-symbol::after {
  background-color: var(--checkbox-checked-color);
}

.checkbox-container .checkbox-label {
  padding-inline-end: 8px;
  padding-inline-start: 8px;
}
</style>
  <style>/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

/* title bar */
.title-bar {
  -webkit-app-region: drag;
  align-items: center;
  display: flex;
  min-height: 54px;
}

.title-bar .logo-image {
  height: 28px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
  width: 28px;
}

.title-bar .page-title {
  flex: 1 1 auto;
  font-size: 15px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
}

.title-bar .page-title.bold {
  font-size: 18px !important;
  margin-inline-start: 20px !important;
}

.title-bar .topbutton-bar {
  display: flex;
}

.title-bar .topbutton-bar .title-bar-button {
  -webkit-app-region: no-drag;
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 2px solid transparent;
  display: flex;
  height: 32px;
  margin-block-start: -12px;
  overflow: hidden;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.title-bar .topbutton-bar .title-bar-button:last-child {
  margin-inline-end: 6px;
}

html.focus-by-keydown .title-bar .topbutton-bar .title-bar-button:focus {
  border: 2px solid var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.title-bar .topbutton-bar .title-bar-button:hover {
  background-color: var(--titlebar-button-hover-color);
  border-color: var(--titlebar-button-hover-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button:active {
  background-color: var(--titlebar-button-active-color);
  border-color: var(--titlebar-button-active-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button > span {
  filter: var(--svg-icon-filter-invert);
  height: 16px;
  width: 16px;
}

.title-bar .maximize-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAxMCAxMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik0xMCAwLjU4ODg2N1YxMC41ODg5SDBWMC41ODg4NjdIMTBaTTguOTk5MDIgMS41ODk4NEgxLjAwMDk4VjkuNTg3ODlIOC45OTkwMlYxLjU4OTg0WiIvPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .restore-down-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAyMDQ4IDIwNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyINCiAgICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgPHBhdGggZmlsbD0iIzEwMTAxMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwyMDQ4KSBzY2FsZSgxLC0xKSINCiAgICBkPSJNMjA0OCAyMDQ4TDIwNDggNDEwTDE2MzggNDEwTDE2MzggMEwwIDBMMCAxNjM4TDQxMCAxNjM4TDQxMCAyMDQ4TDIwNDggMjA0OFpNMTQzNCAyMDVMMTQzNCAxNDM0TDIwNSAxNDM0TDIwNSAyMDVMMTQzNCAyMDVaTTE4NDMgNjE0TDE4NDMgMTg0M0w2MTQgMTg0M0w2MTQgMTYzOEwxNjM4IDE2MzhMMTYzOCA2MTRMMTg0MyA2MTRaIj4NCiAgPC9wYXRoPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .close-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik01LjcwODAxIDVMMTAgOS4yOTE5OUw5LjI5MTk5IDEwTDUgNS43MDgwMUwwLjcwODAwOCAxMEwwIDkuMjkxOTlMNC4yOTE5OSA1TDAgMC43MDgwMDhMMC43MDgwMDggMEw1IDQuMjkxOTlMOS4yOTE5OSAwTDEwIDAuNzA4MDA4TDUuNzA4MDEgNVoiLz4NCjwvc3ZnPg0K) no-repeat center;
}

/* Close button styles */
.title-bar .close-button {
  -webkit-app-region: no-drag;
  display: block;
  margin-block-start: -12px;
  margin-inline-end: 6px;
}

.close-button {
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 0;
  height: 32px;
  margin: 0;
  overflow: hidden;
  padding: 0;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.close-button > span {
  display: inline-flex;
  height: 12px;
  position: relative;
  width: 12px;
}

.close-button > span::before {
  transform: rotate(-45deg);
}

.close-button > span::after {
  transform: rotate(45deg);
}

.close-button > span::after,
.close-button > span::before {
  content: '';
  height: 14px;
  left: 6px;
  position: absolute;
  top: 0;
  width: 1px;
}

/* black color close button */
.close-button > span::after,
.close-button > span::before {
  background-color: var(--close-button-icon-color);
}

html.focus-by-keydown .topbutton-bar button:focus,
html.focus-by-keydown .close-button:focus {
  border: 2px solid  var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.topbutton-bar button:hover,
.close-button:hover {
  background-color: var(--close-button-hover-color);
  border: 0;
  border-radius: 2px;
}

.close-button:active {
  background-color: var(--close-button-active-color);
  border: 0;
  border-radius: 2px;
}
</style>
  <style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

:root {
  --svg-invert: 0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --svg-invert: 1;
  }
}

html {
  height: 100%;
}

body {
  display: flex;
  flex-direction: column;
  height: 100%;
  margin: 0;
  padding: 0;
  width: 100%;
}

svg {
  filter: invert(var(--svg-invert));
}

::-webkit-scrollbar-thumb {
  border-width: 4px !important;
}

.button {
  width: 172px;
}

.action-button {
  justify-content: flex-start;
  padding: 0;
  width: 146px;
}

.action-button .action-button-icon {
  width: 36px;
}

.save-button {
  text-transform: none !important;
}

.checkbox-container {
  align-items: start !important;
}

.checkbox:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

.margin-top-1em {
  margin-block-start: 1em;
}

.content-pane {
  height: 100%;
  margin: 24px;
  padding: 0;
}

.content-body {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
}

.content-body.hide-children > * {
  display: none;
}

.content-body-main-section {
  display: flex;
  flex-direction: row;
  height: 90%;
  padding-block-end: 8px;
}

.footer {
  align-items: flex-end;
  display: flex;
  height: 10%;
  justify-content: flex-end;
  width: 100%;
}

.content-view {
  padding-block-end: 12px;
  padding-block-start: 0;
  padding-inline-start: 12px;
  width: 100%;
}

.advance-trace-capture-view {
  height: 100%;
  overflow-y: auto;
  text-align: justify;
}

.file-upload-view {
  height: 100%;
  overflow-y: auto;
}

.recreate-title {
  font-size: 16px !important;
  line-height: 24px;
  margin: 0;
}

.file-attach-error {
  color: red;
  margin-block-end: 8px;
  margin-block-start: 8px;
  visibility: hidden;
}

.file-attach-error.show {
  visibility: visible;
}

/* List styles */
.list-container {
  overflow-y: auto;
  padding-inline-end: 4px;
}

.sys-info-list-view.list-container {
  height: 100%;
}

.advance-trace-capture-view > .list-container {
  height: 35%;
  margin-block-start: 40px;
}

.file-upload-view > .list-container {
  height: 70%;
}

.list-container ul {
  list-style: none;
  margin: 0;
  padding: 0;
  width: 100%;
}

.list-container ul:empty {
  display: none;
}

.list-container li {
  align-items: center;
  display: flex;
  height: 40px;
}

.list-container li span.label {
  flex: 1;
  font-size: 14px;
  line-height: 20px;
}

.file-upload-view .list-container li span.label {
  color: var(--link-color)
}

.remove-file {
  border-bottom: 0 !important;
  font-size: 12px !important;
}

html.focus-by-keydown .remove-file:focus {
  border-bottom: 2px solid var(--focus-border-color) !important;
}
/*End of list styles*/

/* Navigation item styles */
.nav-section {
  border-inline-end: 1px solid var(--edge-border-rest);
  min-width: 280px;
  padding: 0 12px 0 0;
}

@media screen and (max-width: 720px) {
  .nav-section {
    max-width: 200px;
    min-width: 200px;
  }
}

.nav-item {
  align-items: center;
  background-color: transparent;
  border: transparent;
  box-sizing: border-box;
  color: var(--edge-primary-text-color);
  cursor: pointer;
  display: flex;
  font-family: inherit;
  font-size: 14px;
  height: 36px;
  justify-content: flex-start;
  overflow: hidden;
  padding: 0;
  white-space: nowrap;
  width: 100%;
}

.nav-item:hover {
  background-color: var(--edge-grey-hover);
}

html.focus-by-keydown .nav-item:focus {
  outline: solid 2px var(--focus-border-color);
}

.nav-item.active {
  background-color: var(--edge-grey-pressed);
}

.nav-item-select-rect {
  background-color: var(--edge-blue-selected);
  border-radius: 2px;
  height: 20px;
  margin-inline-start: 1px;
  position: relative;
  visibility: hidden;
  width: 3px;
}

.nav-item.active .nav-item-select-rect {
  visibility: visible;
}

.nav-item-icon {
  font-size: 16px;
  line-height: 16px;
  text-align: center;
  width: 40px;
}
/* End of navigation item styles*/

/* toggle button styles */
.toggle-button {
  position: relative;
}

.toggle-button input {
  -webkit-appearance: none;
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 20px;
  border-style: solid;
  border-width: 1px;
  height: 20px;
  margin: 0;
  outline: none;
  position: relative;
  width: 40px;
}

.toggle-button input:hover {
  border-color: var(--edge-border-hover);
}

.toggle-button input:checked,
.toggle-button input:checked:hover {
  background-color: var(--edge-blue-rest);
  border-color: var(--edge-blue-rest);
}

.toggle-button .knob {
  background-color: var(--toggle-knob-off-color);
  border-radius: 10px;
  height: 10px;
  margin-inline-start: -34px;
  pointer-events: none;
  position: absolute;
  top: 5px;
  transition: all 100ms ease 0ms;
  width: 10px;
}

.toggle-button input:checked + .knob {
  background-color: var(--toggle-knob-on-color);
  margin-inline-start: -15px;
}
/* End of toggle button styles */

/* Progress bar styles*/
.progressbar-container {
  display: flex;
  width: 100%;
}

.progressbar-loading-text {
  flex: 1;
  width: 20%;
}

.progressbar {
  align-items: center;
  background: var(--progressbar-background-color);
  border-radius: 100px;
  height: 4px;
  margin-block-start: 8px;
  margin-inline-end: 20px;
  margin-inline-start: 8px;
  overflow: hidden;
  position: relative;
  width: 100%;
}

.progressbar-container .progressbar {
  width: 80%;
}

.progressbar .bluebar-1 {
  animation: indeterminate-1 2s infinite;
  background-color: var(--progressbar-bar-color);
  border-radius: 100px;
  height: 100%;
  opacity: 0;
  position: absolute;
  transform: translateX(-100%);
  width: 40%;
}

.progressbar .bluebar-2 {
  animation: indeterminate-2 2s infinite;
  background-color: var(--progressbar-bar-color);
  border-radius: 100px;
  height: 100%;
  opacity: 0;
  position: absolute;
  transform: translateX(-150%);
  width: 60%;
}

@keyframes indeterminate-1 {
  0% {
    opacity: 1;
    transform: translateX(-100%);
  }

  70% {
    opacity: 1;
    transform: translateX(300%);
  }

  70.01% {
    opacity: 0;
  }

  100% {
    opacity: 0;
    transform: translateX(300%);
  }
}

@keyframes indeterminate-2 {
  0% {
    opacity: 0;
    transform: translateX(-150%);
  }

  29.99% {
    opacity: 0;
  }

  30% {
    opacity: 1;
    transform: translateX(-150%);
  }

  100% {
    opacity: 1;
    transform: translateX(166.66%);
  }
}

html[dir='rtl'] .progressbar .bluebar-1 {
  animation: indeterminate-1-rtl 2s infinite;
  transform: translateX(100%);
}

html[dir='rtl'] .progressbar .bluebar-2 {
  animation: indeterminate-2-rtl 2s infinite;
  transform: translateX(150%);
}

@keyframes indeterminate-1-rtl {
  0% {
    opacity: 1;
    transform: translateX(100%);
  }

  70% {
    opacity: 1;
    transform: translateX(-300%);
  }

  70.01% {
    opacity: 0;
  }

  100% {
    opacity: 0;
    transform: translateX(-300%);
  }
}

@keyframes indeterminate-2-rtl {
  0% {
    opacity: 0;
    transform: translateX(150%);
  }

  29.99% {
    opacity: 0;
  }

  30% {
    opacity: 1;
    transform: translateX(150%);
  }

  100% {
    opacity: 1;
    transform: translateX(-166.66%);
  }
}
/* End of progress bar styles*/
</style>
  <script src="../js/focus_outline_manager.js"></script>
  <script src="edge://resources/js/util.js"></script>
  <script src="edge://resources/js/i18n_template_no_process.js"></script>
  <script src="../js/topbar_handlers.js"></script>
  <script src="../js/resize_app_window.js"></script>
  <script src="../js/sys_info_trace.js"></script>
</head>
<body>
  <div id="title-bar" class="title-bar">
    <img alt="" class="logo-image"
         srcset="edge://theme/current-channel-logo@1x 1x,edge://theme/current-channel-logo@2x 2x">
    <h1 id="page-title" class="page-title bold"
        i18n-content="sysInfoPageTitle"></h1>
    <span class="topbutton-bar">
      <button id="maximize-button" type="button"
              class="title-bar-button maximize-icon"
              i18n-values="aria-label:maximizeButtonLabel;
                            title:maximizeButtonLabel">
        <span></span>
      </button>
      <button id="close-button" type="button"
              class="title-bar-button close-icon"
              i18n-values="aria-label:closeButtonLabel">
        <span></span>
      </button>
    </span>
  </div>
  <div id="content-pane" class="content-pane">
    <div id="progressbar-container" class="progressbar-container">
      <span class="progressbar-loading-text"
            i18n-content="sysInfoPageStatusLoading"></span>
      <span class="progressbar" slot="indeterminate" role="progressbar">
        <span class="bluebar-1"></span>
        <span class="bluebar-2"></span>
      </span>
    </div>
    <div id="content-body" class="content-body hide-children" aria-live="off">
      <div class="content-body-main-section">
        <div id="nav-section" class="nav-section" role="tablist" hidden
             tabindex="-1" i18n-values="aria-label:sysInfoPageTitle">
          <button role="tab" aria-selected="true" tabindex="0"
                  type="button" id="diagnostic-data-button"
                  class="nav-item active">
            <div class="nav-item-select-rect"></div>
            <div class="nav-item-icon">
                <svg width="14" height="15" viewBox="0 0 14 15" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M14 0.681641V14.6816H0V0.681641H14ZM13
                      1.68164H1V13.6816H13V1.68164ZM8
                      12.6816H6V7.68164H8V12.6816ZM5
                      12.6816H3V5.68164H5V12.6816ZM11
                      12.6816H9V3.68164H11V12.6816Z"
                    fill="black">
                </svg>
            </div>
            <div class="nav-item-text"
                  i18n-content="sysInfoNavDiagnosticLogs"></div>
          </button>
          <button role="tab" aria-selected="false" tabindex="-1"
                  type="button" id="advance-button" class="nav-item">
            <div class="nav-item-select-rect"></div>
            <div class="nav-item-icon">
              <svg width="15" height="17" viewBox="0 0 15 17" fill="none"
                              xmlns="http://www.w3.org/2000/svg">
                <path d="M7 15.6816C7.33333 15.6816 7.66406 15.653
                        7.99219 15.5957C8.32031
                        15.5384 8.64062 15.4551 8.95312 15.3457C9.00521
                        15.5072 9.0651
                        15.666 9.13281 15.8223C9.20573 15.9733 9.28906 16.1191
                        9.38281
                        16.2598C8.9974 16.3952 8.60417 16.4993 8.20312
                        16.5723C7.80729
                        16.6452 7.40625 16.6816 7 16.6816C6.35938 16.6816
                        5.73958 16.5983
                        5.14062 16.4316C4.54688 16.265 3.98958 16.0306
                        3.46875 15.7285C2.95312
                        15.4212 2.48177 15.054 2.05469 14.627C1.6276 14.1999
                        1.26042 13.7285
                        0.953125 13.2129C0.651042 12.6921 0.416667 12.1348 0.25
                        11.541C0.0833333
                        10.9473 0 10.3275 0 9.68164C0 9.10352 0.0677083 8.54362
                        0.203125
                        8.00195C0.34375 7.45508 0.539062 6.93945 0.789062
                        6.45508C1.04427
                        5.96549 1.35156 5.51497 1.71094 5.10352C2.07031
                        4.68685 2.47135
                        4.31966 2.91406 4.00195C3.36198 3.67904 3.84375
                        3.41081 4.35938
                        3.19727C4.88021 2.98372 5.42708 2.83529 6
                        2.75195V1.68164H4V0.681641H9V1.68164H7V2.68164C7.72396
                        2.68164
                        8.42708 2.79102 9.10938 3.00977C9.79688 3.22331 10.4349
                        3.53841
                        11.0234 3.95508L12.6484 2.33008L13.3516 3.0332L11.7969
                        4.58789C12.1458
                        4.92122 12.4557 5.2832 12.7266 5.67383C13.0026 6.06445
                        13.2344 6.47591
                        13.4219 6.9082C13.6094 7.34049 13.7526 7.79102 13.8516
                        8.25977C13.9505
                        8.72331 14 9.19727 14 9.68164C14 9.85352 13.9922 10.0254
                        13.9766
                        10.1973C13.9609 10.3691 13.9401 10.541 13.9141
                        10.7129C13.7578 10.6504
                        13.5964 10.6009 13.4297 10.5645C13.2682 10.528 13.1042
                        10.4993 12.9375
                        10.4785C12.9583 10.3431 12.974 10.2103 12.9844
                        10.0801C12.9948 9.94987
                        13 9.81706 13 9.68164C13 9.12956 12.9271 8.59831
                        12.7812 8.08789C12.6406
                        7.57747 12.4401 7.10091 12.1797 6.6582C11.9193 6.21029
                        11.6068 5.80404
                        11.2422 5.43945C10.8776 5.07487 10.4714 4.76237 10.0234
                        4.50195C9.58073
                        4.24154 9.10417 4.04102 8.59375 3.90039C8.08333 3.75456
                        7.55208 3.68164
                        7 3.68164C6.44792 3.68164 5.91667 3.75456 5.40625
                        3.90039C4.89583
                        4.04102 4.41667 4.24154 3.96875 4.50195C3.52604 4.76237
                        3.1224 5.07487
                        2.75781 5.43945C2.39323 5.80404 2.08073 6.21029 1.82031
                        6.6582C1.5599
                        7.10091 1.35677 7.57747 1.21094 8.08789C1.07031 8.59831
                        1 9.12956 1 9.68164C1
                        10.2337 1.07031 10.765 1.21094 11.2754C1.35677 11.7858
                        1.5599 12.265 1.82031
                        12.7129C2.08073 13.1556 2.39323 13.5592 2.75781
                        13.9238C3.1224 14.2884 3.52604
                        14.6009 3.96875 14.8613C4.41667 15.1217 4.89583 15.3249
                        5.40625 15.4707C5.91667
                        15.6113 6.44792 15.6816 7 15.6816ZM7
                        5.68164V9.68164H10V10.6816H6V5.68164H7ZM12.5
                        11.6816C12.8438 11.6816 13.1667 11.7467 13.4688
                        11.877C13.776 12.0072 14.0417
                        12.1868 14.2656 12.416C14.4948 12.64 14.6745 12.9056
                        14.8047 13.2129C14.9349
                        13.515 15 13.8379 15 14.1816C15 14.5254 14.9349 14.8509
                        14.8047 15.1582C14.6745
                        15.4603 14.4948 15.7259 14.2656 15.9551C14.0417 16.179
                        13.776 16.3561 13.4688
                        16.4863C13.1667 16.6165 12.8438 16.6816 12.5
                        16.6816C12.1562 16.6816 11.8307
                        16.6165 11.5234 16.4863C11.2214 16.3561 10.9557
                        16.179 10.7266 15.9551C10.5026
                        15.7259 10.3255 15.4603 10.1953 15.1582C10.0651
                        14.8509 10 14.5254 10 14.1816C10
                        13.8379 10.0651 13.515 10.1953 13.2129C10.3255
                        12.9056 10.5026 12.64 10.7266
                        12.416C10.9557 12.1868 11.2214 12.0072 11.5234
                        11.877C11.8307 11.7467 12.1562
                        11.6816 12.5 11.6816Z"
                      fill="black">
              </svg>
            </div>
            <div class="nav-item-text"
                        i18n-content="sysInfoNavRecreateMyProblem"></div>
          </button>
          <button role="tab" aria-selected="false" tabindex="-1"
                  type="button" id="files-upload-nav-button" class="nav-item">
            <div class="nav-item-select-rect"></div>
            <div class="nav-item-icon">
              <svg width="7" height="16" viewBox="0 0 7 16" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                <path d="M7 3V12.5C7 12.9844 6.90625 13.4401 6.71875
                        13.8672C6.53646 14.2891 6.28646 14.6589 5.96875
                        14.9766C5.65625 15.2891 5.28646 15.5391 4.85938
                        15.7266C4.4375 15.9089 3.98438 16 3.5 16C3.01562
                        16 2.5599 15.9089 2.13281 15.7266C1.71094 15.5391
                        1.34115 15.2891 1.02344 14.9766C0.710938 14.6589
                        0.460938 14.2891 0.273438 13.8672C0.0911458 13.4401 0
                        12.9844 0 12.5V2.5C0 2.15625 0.0651042 1.83333 0.195312
                        1.53125C0.330729 1.22917 0.510417 0.966146 0.734375
                        0.742188C0.963542 0.513021 1.22917 0.333333 1.53125
                        0.203125C1.83333 0.0677083 2.15625 0 2.5 0C2.84375 0
                        3.16667 0.0677083 3.46875 0.203125C3.77083 0.333333
                        4.03385 0.513021 4.25781 0.742188C4.48698 0.966146
                        4.66667 1.22917 4.79688 1.53125C4.93229 1.83333 5
                        2.15625 5 2.5V12.5C5 12.7083 4.96094 12.9036 4.88281
                        13.0859C4.80469 13.2682 4.69792 13.4271 4.5625
                        13.5625C4.42708 13.6979 4.26823 13.8047 4.08594
                        13.8828C3.90365 13.9609 3.70833 14 3.5 14C3.29167 14
                        3.09635 13.9609 2.91406 13.8828C2.73177 13.8047 2.57292
                        13.6979 2.4375 13.5625C2.30208 13.4271 2.19531 13.2682
                        2.11719 13.0859C2.03906 12.9036 2 12.7083 2
                        12.5V4H3V12.5C3 12.6354 3.04948 12.7526 3.14844
                        12.8516C3.2474 12.9505 3.36458 13 3.5 13C3.63542 13
                        3.7526 12.9505 3.85156 12.8516C3.95052 12.7526 4
                        12.6354 4 12.5V2.5C4 2.29167 3.96094 2.09635 3.88281
                        1.91406C3.80469 1.73177 3.69792 1.57292 3.5625
                        1.4375C3.42708 1.30208 3.26823 1.19531 3.08594
                        1.11719C2.90365 1.03906 2.70833 1 2.5 1C2.29167 1
                        2.09635 1.03906 1.91406 1.11719C1.73177 1.19531 1.57292
                        1.30208 1.4375 1.4375C1.30208 1.57292 1.19531 1.73177
                        1.11719 1.91406C1.03906 2.09635 1 2.29167 1 2.5V12.5C1
                        12.8438 1.0651 13.1667 1.19531 13.4688C1.33073 13.7708
                        1.51042 14.0365 1.73438 14.2656C1.96354 14.4896 2.22917
                        14.6693 2.53125 14.8047C2.83333 14.9349 3.15625 15 3.5
                        15C3.84375 15 4.16667 14.9349 4.46875 14.8047C4.77083
                        14.6693 5.03385 14.4896 5.25781 14.2656C5.48698 14.0365
                        5.66667 13.7708 5.79688 13.4688C5.93229 13.1667 6
                        12.8438 6 12.5V3H7Z"
                      fill="black">
              </svg>
            </div>
            <div class="nav-item-text"
                 i18n-content="sysInfoNavAttachFile"></div>
          </button>
        </div>
        <div id="content-view" class="content-view">
          <div id="sys-info-list-view"
                class="sys-info-list-view list-container">
            <ul id="sys-info-list"></ul>
          </div>
          <div id="advance-trace-capture-view"
                class="advance-trace-capture-view" hidden>
            <h2 class="recreate-title" i18n-content="sysInfoRecreateTitle"></h2>
            <label class="checkbox-container margin-top-1em">
              <input class="checkbox" type="checkbox"
                      id="repro-mode-consent-checkbox">
              <span class="check-symbol"></span>
              <span class="checkbox-label"
                    i18n-content="sysInfoRecreateAgreeCheckboxLabel"></span>
            </label>
            <p>
              <button disabled type="button" id="start-recording-button"
                      class="button secondary-button action-button">
                <span class="action-button-icon">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 0C8.73438 0 9.44271 0.0963542 10.125
                            0.289062C10.8073 0.476562 11.4427 0.744792 12.0312
                            1.09375C12.625 1.44271 13.1641 1.86198 13.6484
                            2.35156C14.138 2.83594 14.5573 3.375 14.9062
                            3.96875C15.2552 4.55729 15.5234 5.19271 15.7109
                            5.875C15.9036 6.55729 16 7.26562 16 8C16 8.73438
                            15.9036 9.44271 15.7109 10.125C15.5234 10.8073
                            15.2552 11.4453 14.9062 12.0391C14.5573 12.6276
                            14.138 13.1667 13.6484 13.6562C13.1641 14.1406
                            12.625 14.5573 12.0312 14.9062C11.4427 15.2552
                            10.8073 15.526 10.125 15.7188C9.44271 15.9062
                            8.73438 16 8 16C7.26562 16 6.55729 15.9062 5.875
                            15.7188C5.19271 15.526 4.55469 15.2552 3.96094
                            14.9062C3.3724 14.5573 2.83333 14.1406 2.34375
                            13.6562C1.85938 13.1667 1.44271 12.6276 1.09375
                            12.0391C0.744792 11.4453 0.473958 10.8073 0.28125
                            10.125C0.09375 9.44271 0 8.73438 0 8C0 7.26562
                            0.09375 6.55729 0.28125 5.875C0.473958 5.19271
                            0.744792 4.55729 1.09375 3.96875C1.44271 3.375
                            1.85938 2.83594 2.34375 2.35156C2.83333 1.86198
                            3.3724 1.44271 3.96094 1.09375C4.55469 0.744792
                            5.19271 0.476562 5.875 0.289062C6.55729 0.0963542
                            7.26562 0 8 0ZM8 15C8.64062 15 9.25781 14.9167
                            9.85156 14.75C10.4505 14.5833 11.0078 14.349
                            11.5234 14.0469C12.0443 13.7396 12.5182 13.3724
                            12.9453 12.9453C13.3724 12.5182 13.737 12.0469
                            14.0391 11.5312C14.3464 11.0104 14.5833 10.4531
                            14.75 9.85938C14.9167 9.26562 15 8.64583 15 8C15
                            7.35938 14.9167 6.74219 14.75 6.14844C14.5833
                            5.54948 14.3464 4.99219 14.0391 4.47656C13.737
                            3.95573 13.3724 3.48177 12.9453 3.05469C12.5182
                            2.6276 12.0443 2.26302 11.5234 1.96094C11.0078
                            1.65365 10.4505 1.41667 9.85156 1.25C9.25781
                            1.08333 8.64062 1 8 1C7.35938 1 6.73958 1.08333
                            6.14062 1.25C5.54688 1.41667 4.98958 1.65365 4.46875
                            1.96094C3.95312 2.26302 3.48177 2.6276 3.05469
                            3.05469C2.6276 3.48177 2.26042 3.95573 1.95312
                            4.47656C1.65104 4.99219 1.41667 5.54948 1.25
                            6.14844C1.08333 6.74219 1 7.35938 1 8C1 8.64062
                            1.08333 9.26042 1.25 9.85938C1.41667 10.4531
                            1.65104 11.0104 1.95312 11.5312C2.26042 12.0469
                            2.6276
                            12.5182 3.05469 12.9453C3.48177 13.3724 3.95312
                            13.7396
                            4.46875 14.0469C4.98958 14.349 5.54688 14.5833
                            6.14062
                            14.75C6.73438 14.9167 7.35417 15 8 15Z"
                          fill="black" fill-opacity="0.83">
                  </svg>
                </span>
                <span i18n-content="sysInfoRecreateStartButon"></span>
              </button>
              <button hidden type="button" id="stop-recording-button"
                      class="button secondary-button action-button">
                <span class="action-button-icon">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 0H14V14H0V0Z" fill="black" fill-opacity="0.83">
                  </svg>
                </span>
                <span i18n-content="sysInfoRecreateStopButon"></span>
              </button>
            </p>
            <div class="list-container">
              <ul id="advance-trace-list" hidden>
                <li id="net-export" hidden>
                  <span class="label"><a id="net-export-text-link"
                                            href="#">net-export.json</a></span>
                  <span><a class="remove-file" id="net-export-remove-link"
                     href="#" i18n-content="sysInfoRemoveFileLabel"
                     role="button"></a>
                  </span>
                </li>
              </ul>
            </div>
          </div>
          <div id="file-upload-view" class="file-upload-view" hidden
               aria-live="polite" role="region"
               i18n-values="aria-label:sysInfoFileViewLabel">
            <button id="choose-file-button" type="button"
                    class="button secondary-button"
                    i18n-content="sysInfoFileChooseButton"></button>
            <div id="file-attach-error" class="file-attach-error"
                 i18n-content="sysInfoFileAttachError"></div>
            <div class="list-container">
              <ul id="file-upload-list"></ul>
            </div>
          </div>
        </div>
      </div>
      <div id="footer" class="footer">
        <button id="save-button" type="button"
                class="button primary-button save-button"
                i18n-content="saveAndIncludeButton"></button>
      </div>
    </div>
  </div>
</body>
</html>
<!doctype html>
<html i18n-values="dir:textdirection;lang:language">
<head>
<title i18n-content="pageTitle"></title>
<meta charset="utf-8">
<style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

:root {
  --edge-white: #FFFFFF;
  --edge-black: #101010;
  --edge-content-background-color: #F7F7F7;
  --edge-primary-text-color: var(--edge-black);
  --edge-secondary-text-color: #6F6F6F;

  --edge-border-hover: #949494;
  --edge-border-rest: #C5C5C5;
  --edge-border-pressed: #ADADAD;

  --edge-blue-border-focus: #888888;
  --edge-blue-hover: #006CBE;
  --edge-blue-rest: #0078D4;
  --edge-blue-pressed: #1081D7;
  --edge-blue-selected: #004274;

  --edge-grey-hover: #EAEAEA;
  --edge-grey-rest: #E6E6E6;
  --edge-grey-pressed: #EFEFEF;

  --edge-light-border-hover: #9C9C9C;
  --edge-light-border-rest: #CECECE;
  --edge-light-border-pressed: #B5B5B5;

  --edge-light-grey-hover: #F3F3F3;
  --edge-light-grey-rest: #EFEFEF;
  --edge-light-grey-pressed: #F7F7F7;

  --link-active: #1081D7;
  --link-color: #0061AB;
  --link-hover: #0070C6;

  --checkbox-checked-color: var(--edge-black);
  --focus-border-color: var(--edge-black);
  --input-control-background-color: var(--edge-white);

  --close-button-active-color: var(--edge-grey-pressed);
  --close-button-hover-color: var(--edge-grey-hover);
  --close-button-icon-color: var(--edge-black);

  --titlebar-button-active-color: var(--edge-grey-pressed);
  --titlebar-button-hover-color: var(--edge-grey-hover);

  --primary-button-border-focus: var(--edge-blue-border-focus);
  --primary-button-box-focus: var(--edge-white);
  --primary-button-active: var(--edge-blue-pressed);
  --primary-button-backgroundcolor: var(--edge-blue-rest);
  --primary-button-hover: var(--edge-blue-hover);

  --secondary-button-active: var(--edge-grey-pressed);
  --secondary-button-background: var(--edge-grey-rest);
  --secondary-button-hover: var(--edge-grey-hover);

  --scrollbar-track-color: #EFEFEF;
  --scrollbar-thumb-color: #CACACA;
  --scrollbar-thumb-hover-color: #9E9E9E;

  --radio-button-checked-border-color: var(--edge-black);
  --radio-button-dot-color: var(--edge-black);

  --toggle-knob-off-color: var(--edge-black);
  --toggle-knob-on-color: var(--edge-white);

  --progressbar-background-color: #EFEFEF;
  --progressbar-bar-color: var(--edge-blue-rest);

  /* Svg color stays black in light mode */
  --svg-icon-filter-invert: invert(0%);
  /* Convert svg black to --link-color using filter */
  --svg-icon-filter-blue:
      invert(26%) sepia(59%) saturate(2259%)
      hue-rotate(186deg) brightness(99%) contrast(101%);

  --sys-info-list-item-hover-color: var(--edge-grey-hover);

  --screenshot-editor-secondary-button-hover: var(--edge-grey-hover);
  --screenshot-editor-pen-panel-background: #E0E0E0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --edge-white: #FFFFFF;
    --edge-black: #1D1D1D;
    --edge-content-background-color: #2D2D2D;
    --edge-primary-text-color: var(--edge-white);
    --edge-secondary-text-color: #949494;

    --edge-border-hover: #909090;
    --edge-border-rest: #575757;
    --edge-border-pressed: #787878;

    --edge-blue-border-focus: #888888;
    --edge-blue-box-focus: #00355D;
    --edge-blue-hover: #0078D4;
    --edge-blue-rest: #006CBE;
    --edge-blue-pressed: #0069B9;
    --edge-blue-selected: #63ACE5;

    --edge-grey-hover: #3A3A3A;
    --edge-grey-rest: #3E3E3E;
    --edge-grey-pressed: #353535;

    --edge-light-border-hover: #999999;
    --edge-light-border-rest: #676767;
    --edge-light-border-pressed: #808080;

    --edge-light-grey-hover: #424242;
    --edge-light-grey-rest: #464646;
    --edge-light-grey-pressed: #3E3E3E;

    --link-active: #2189DA;
    --link-color: #63ACE5;
    --link-hover: #429BDF;

    --checkbox-checked-color: var(--edge-white);
    --focus-border-color: var(--edge-white);
    --input-control-background-color: var(--edge-black);

    --close-button-active-color: var(--edge-grey-pressed);
    --close-button-hover-color: var(--edge-grey-hover);
    --close-button-icon-color: var(--edge-white);

    --titlebar-button-active-color: var(--edge-grey-pressed);
    --titlebar-button-hover-color: var(--edge-grey-hover);

    --primary-button-active: var(--edge-blue-pressed);
    --primary-button-backgroundcolor: var(--edge-blue-rest);
    --primary-button-border-focus: var(--edge-blue-border-focus);
    --primary-button-box-focus: var(--edge-blue-box-focus);
    --primary-button-hover: var(--edge-blue-hover);

    --secondary-button-active: var(--edge-grey-pressed);
    --secondary-button-background: var(--edge-grey-rest);
    --secondary-button-hover: var(--edge-grey-hover);

    --scrollbar-track-color: #272727;
    --scrollbar-thumb-color: #4E4E4E;
    --scrollbar-thumb-hover-color: #7D7D7D;

    --radio-button-checked-border-color: var(--edge-white);
    --radio-button-dot-color: var(--edge-white);

    --toggle-knob-off-color: var(--edge-white);
    --toggle-knob-on-color: var(--edge-white);

    --progressbar-background-color: #212121;
    --progressbar-bar-color: var(--edge-blue-rest);

    /* Convert svg black to white using filter */
    --svg-icon-filter-invert: invert(100%);
    /* Convert svg black to --link-color using filter */
    --svg-icon-filter-blue:
        invert(65%) sepia(76%) saturate(643%)
        hue-rotate(177deg) brightness(92%) contrast(95%);

    --sys-info-list-item-hover-color: var(--edge-light-grey-hover);

    --screenshot-editor-secondary-button-hover: var(--edge-light-grey-hover);
    --screenshot-editor-pen-panel-background: #404040;
  }
}

:root {
  --button-alignment: flex-end;
  --text-capitalize: initial;
}

:root.mac {
  --text-capitalize: capitalize;
}

body {
  background-color: var(--edge-content-background-color);
  color: var(--edge-primary-text-color);
  font-family: system-ui, Segoe UI, SegoeUI, Helvetica Neue,
               Helvetica, Arial, sans-serif;
  font-size: 14px;
  line-height: 20px;
}

[hidden] {
  display: none !important;
}

/* scrollbar styles */
::-webkit-scrollbar {
  height: 12px;
  width: 12px;
}

::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color);
  border: solid 3px var(--scrollbar-track-color);
  border-radius: 9px;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover-color);
}

::-webkit-scrollbar-track {
  background-color: var(--scrollbar-track-color);
}

::-webkit-scrollbar-corner {
  background-color: var(--scrollbar-track-color);
}

/* Input text and textarea styles */
input[type=text],
input[type=url],
input[type=email],
textarea {
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  color: var(--edge-primary-text-color);
  font-family: inherit;
  font-size: inherit;
  font-weight: 400;
  margin: 0;
  max-width: 100%;
  padding: 10px;
}

input[type=text]:hover,
input[type=url]:hover,
input[type=email]:hover,
input[type=checkbox]:hover,
textarea:hover {
  border-color: var(--edge-border-hover);
}

html:not(.focus-by-keydown) *:focus {
  outline: none;
}

input[type=text]:focus,
input[type=url]:focus,
input[type=email]:focus,
html.focus-by-keydown input[type=checkbox]:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  box-shadow: var(--focus-border-color) 0 0 0 1px inset;
  outline: none;
}

textarea:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  outline: 1px solid var(--focus-border-color) !important;
}

input[type=email]:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

/* button styles */
.button {
  align-items: center;
  border: 2px solid;
  border-color: transparent;
  border-radius: 2px;
  box-sizing: border-box;
  display: inline-flex;
  font-family: inherit;
  font-size: 14px;
  height: 32px;
  justify-content: center;
  line-height: 1;
  overflow: hidden;
  padding: 0 16px;
  text-decoration: none;
  text-transform: var(--text-capitalize);
  transition: all 200ms ease-in-out;
  white-space: nowrap;
}

.button:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

html.focus-by-keydown .button:focus {
  border-color: var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

html.focus-by-keydown .primary-button:focus {
  border-color: var(--primary-button-border-focus);
  box-shadow: 0 0 0 2px inset var(--primary-button-box-focus);
  outline: none;
}

.primary-button {
  background-color: var(--primary-button-backgroundcolor);
  color: white;
}

.primary-button:hover {
  background-color: var(--primary-button-hover);
}

.primary-button:active {
  background-color: var(--primary-button-active);
}

.secondary-button {
  background-color: var(--secondary-button-background);
  color: var(--edge-primary-text-color);
}

.secondary-button:hover {
  background-color: var(--secondary-button-hover);
}

.secondary-button:active {
  background-color: var(--secondary-button-active);
}

.outline-button {
  background-color: transparent;
  border-color: var(--edge-light-border-rest);
  border-width: 1px;
  color: var(--edge-primary-text-color);
}

.outline-button:hover {
  background-color: var(--edge-light-grey-hover);
  border-color: var(--edge-light-border-hover);
}

.outline-button:active {
  background-color: var(--edge-light-grey-pressed);
  border-color: var(--edge-light-border-pressed);
}

html.focus-by-keydown .outline-button:focus {
  border-width: 2px;
}

/* hypertext link styles */
a {
  outline: none;
  text-decoration: none;
}

a:link,
a:visited {
  border-bottom: solid 1px var(--link-color);
  color: var(--link-color);
}

a:link:hover,
a:visited:hover {
  border-bottom: 2px solid var(--link-hover);
  box-shadow: none;
  color: var(--link-hover);
  outline: none;
}

a:link:active,
a:visited:active {
  color: var(--link-active);
}

html.focus-by-keydown a:link:focus,
html.focus-by-keydown a:visited:focus {
  border-bottom: 2px solid var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

/* Checkbox styles */
.checkbox-container {
  align-items: center;
  display: inline-flex;
  flex-direction: row;
  position: relative;
}

.checkbox-container .checkbox {
  -webkit-appearance: none;
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  height: 18px;
  margin: 0;
  position: absolute;
  width: 18px;
  z-index: 1;
}

.checkbox-container .check-symbol {
  border-radius: 2px;
  display: inline-block;
  flex-shrink: 0;
  height: 18px;
  position: relative;
  width: 18px;
}

.checkbox-container .check-symbol::before {
  height: 11px;
  left: 10px;
  top: 3px;
  transform: rotate(40deg);
}

.checkbox-container .check-symbol::after {
  height: 5px;
  left: 5px;
  top: 8px;
  transform: rotate(-45deg);
}

.checkbox-container .check-symbol::before,
.checkbox-container .check-symbol::after {
  content: '';
  pointer-events: none;
  position: absolute;
  width: 2px;
  z-index: 1;
}

.checkbox-container input[type=checkbox]:checked + .check-symbol::before,
.checkbox-container input[type=checkbox]:checked + .check-symbol::after {
  background-color: var(--checkbox-checked-color);
}

.checkbox-container .checkbox-label {
  padding-inline-end: 8px;
  padding-inline-start: 8px;
}
</style>
<style>/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

/* title bar */
.title-bar {
  -webkit-app-region: drag;
  align-items: center;
  display: flex;
  min-height: 54px;
}

.title-bar .logo-image {
  height: 28px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
  width: 28px;
}

.title-bar .page-title {
  flex: 1 1 auto;
  font-size: 15px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
}

.title-bar .page-title.bold {
  font-size: 18px !important;
  margin-inline-start: 20px !important;
}

.title-bar .topbutton-bar {
  display: flex;
}

.title-bar .topbutton-bar .title-bar-button {
  -webkit-app-region: no-drag;
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 2px solid transparent;
  display: flex;
  height: 32px;
  margin-block-start: -12px;
  overflow: hidden;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.title-bar .topbutton-bar .title-bar-button:last-child {
  margin-inline-end: 6px;
}

html.focus-by-keydown .title-bar .topbutton-bar .title-bar-button:focus {
  border: 2px solid var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.title-bar .topbutton-bar .title-bar-button:hover {
  background-color: var(--titlebar-button-hover-color);
  border-color: var(--titlebar-button-hover-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button:active {
  background-color: var(--titlebar-button-active-color);
  border-color: var(--titlebar-button-active-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button > span {
  filter: var(--svg-icon-filter-invert);
  height: 16px;
  width: 16px;
}

.title-bar .maximize-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAxMCAxMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik0xMCAwLjU4ODg2N1YxMC41ODg5SDBWMC41ODg4NjdIMTBaTTguOTk5MDIgMS41ODk4NEgxLjAwMDk4VjkuNTg3ODlIOC45OTkwMlYxLjU4OTg0WiIvPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .restore-down-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAyMDQ4IDIwNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyINCiAgICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgPHBhdGggZmlsbD0iIzEwMTAxMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwyMDQ4KSBzY2FsZSgxLC0xKSINCiAgICBkPSJNMjA0OCAyMDQ4TDIwNDggNDEwTDE2MzggNDEwTDE2MzggMEwwIDBMMCAxNjM4TDQxMCAxNjM4TDQxMCAyMDQ4TDIwNDggMjA0OFpNMTQzNCAyMDVMMTQzNCAxNDM0TDIwNSAxNDM0TDIwNSAyMDVMMTQzNCAyMDVaTTE4NDMgNjE0TDE4NDMgMTg0M0w2MTQgMTg0M0w2MTQgMTYzOEwxNjM4IDE2MzhMMTYzOCA2MTRMMTg0MyA2MTRaIj4NCiAgPC9wYXRoPg0KPC9zdmc+DQo=) no-repeat center;
}

.title-bar .close-icon > span {
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGw9IiMxMDEwMTAiIGQ9Ik01LjcwODAxIDVMMTAgOS4yOTE5OUw5LjI5MTk5IDEwTDUgNS43MDgwMUwwLjcwODAwOCAxMEwwIDkuMjkxOTlMNC4yOTE5OSA1TDAgMC43MDgwMDhMMC43MDgwMDggMEw1IDQuMjkxOTlMOS4yOTE5OSAwTDEwIDAuNzA4MDA4TDUuNzA4MDEgNVoiLz4NCjwvc3ZnPg0K) no-repeat center;
}

/* Close button styles */
.title-bar .close-button {
  -webkit-app-region: no-drag;
  display: block;
  margin-block-start: -12px;
  margin-inline-end: 6px;
}

.close-button {
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 0;
  height: 32px;
  margin: 0;
  overflow: hidden;
  padding: 0;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.close-button > span {
  display: inline-flex;
  height: 12px;
  position: relative;
  width: 12px;
}

.close-button > span::before {
  transform: rotate(-45deg);
}

.close-button > span::after {
  transform: rotate(45deg);
}

.close-button > span::after,
.close-button > span::before {
  content: '';
  height: 14px;
  left: 6px;
  position: absolute;
  top: 0;
  width: 1px;
}

/* black color close button */
.close-button > span::after,
.close-button > span::before {
  background-color: var(--close-button-icon-color);
}

html.focus-by-keydown .topbutton-bar button:focus,
html.focus-by-keydown .close-button:focus {
  border: 2px solid  var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.topbutton-bar button:hover,
.close-button:hover {
  background-color: var(--close-button-hover-color);
  border: 0;
  border-radius: 2px;
}

.close-button:active {
  background-color: var(--close-button-active-color);
  border: 0;
  border-radius: 2px;
}
</style>
<style>/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

body {
  height: 100%;
  margin: 0;
  overflow: auto;
  padding: 0;
  width: 100%;
}

.question-pane {
  margin-inline-end: 24px;
  margin-inline-start: 24px;
}

.survey-question {
  display: block;
  font-weight: bold;
  margin-top: 20px;
}

.choice-form {
  margin-top: 30px;
}

/* Radio button styles */
.radio-button {
  align-items: center;
  display: inline-flex;
  flex-direction: row;
  margin: 0 5px 0 27px;
  position: relative;
}

.radio-button-icon {
  -webkit-appearance: none;
  border: 2px solid var(--edge-border-rest);
  border-radius: 50%;
  height: 20px;
  margin: 0;
  outline-style: none;
  position: absolute;
  width: 20px;
  z-index: 1;
}

input[type=radio]:checked {
  border: 1px solid var(--radio-button-checked-border-color);
}

input[type=radio]:hover {
  border: 2px solid var(--edge-border-hover);
}

html.focus-by-keydown input[type=radio]:focus {
  border: 2px solid var(--focus-border-color);
}

.radio-button-dot {
  border-radius: 50%;
  display: inline-block;
  flex-shrink: 0;
  height: 30px;
  position: relative;
  width: 30px;
}

input[type='radio']:checked + .radio-button-dot::before {
  background-color: var(--radio-button-dot-color);
}

.radio-button-dot::before {
  background: transparent;
  border-radius: 50%;
  content: '';
  height: 12px;
  left: 4px;
  pointer-events: none;
  position: absolute;
  top: 9px;
  width: 12px;
  z-index: 1;
}

label[for='nps-rating-most-negative'] {
  float: left;
  font-size: 12px;
  font-weight: bold;
}

label[for='nps-rating-most-positive'] {
  float: left;
  font-size: 12px;
  font-weight: bold;
  margin-inline-start: 164px;
}

/* Privacy Style*/
.privacy-note {
  bottom: 68px;
  color: var(--edge-secondary-text-color);
  display: block;
  font-size: 11px;
  margin-inline-end: 20px;
  position: absolute;
}

.comment-pane {
  display: none;
  margin-inline-end: 24px;
  margin-inline-start: 24px;
  margin-top: 5px;
}

.comment-label {
  font-weight: bold;
  margin-bottom: 10px;
  margin-top: 20px;
}

/* Text area styles */
.comment-text {
  -webkit-appearance: none;
  height: 150px;
  margin-top: 0;
  padding: 10px;
  resize: none;
  width: 100%;
}

/* button style */
.buttons-pane {
  bottom: 20px;
  margin-inline-end: 24px;
  margin-inline-start: 24px;
  position: absolute;
}

.button {
  width: 170px;
}

.add-explanation-button {
  margin-inline-start: 8px;
}

.send-button {
  display: none;
  margin-inline-start: 182px;
}
</style>

<script src="edge://resources/js/load_time_data.js"></script>
<script src="edge://resources/js/i18n_template_no_process.js"></script>
<script src="../js/focus_outline_manager.js"></script>
<script src="edge://resources/js/util.js"></script>
<script src="../js/data.js"></script>
<script src="../js/topbar_handlers.js"></script>
<script src="../js/survey.js"></script>
</head>
<body>
  <div class="title-bar closebutton-container">
    <h1 id="page-title" class="page-title" i18n-content="pageTitle"></h1>
    <button id="close-button" class="close-button" type="button"
            i18n-values="aria-label:closeButtonLabel"><span></span></button>
  </div>
  <div id="question-pane" class="question-pane">
    <div id="survey-question" class="survey-question"
         i18n-content="surveyQuestion"></div>
    <form id="choice-form" class="choice-form" name="choice-form">
      <div class="radio-button">
        <input class="radio-button-icon" type="radio"
               id="nps-rating-most-negative" name="nps-radio-button"
               value="0.2" aria-labelledby="nps-rating-most-negative-label">
        <span class="radio-button-dot"></span>
      </div>
      <div class="radio-button">
        <input class="radio-button-icon" type="radio" name="nps-radio-button"
               value="0.4" i18n-values="aria-label:npsRatingNegativeLabel">
        <span class="radio-button-dot"></span>
      </div>
      <div class="radio-button">
        <input class="radio-button-icon" type="radio" name="nps-radio-button"
               value="0.6" i18n-values="aria-label:npsRatingNeutralLabel">
        <span class="radio-button-dot"></span>
      </div>
      <div class="radio-button">
        <input class="radio-button-icon" type="radio" name="nps-radio-button"
               value="0.8" i18n-values="aria-label:npsRatingPositiveLabel">
        <span class="radio-button-dot"></span>
      </div>
      <div class="radio-button">
        <input class="radio-button-icon" type="radio"
               id="nps-rating-most-positive" name="nps-radio-button"
               value="1.0" aria-labelledby="nps-rating-most-positive-label">
        <span class="radio-button-dot"></span>
      </div>
      <label id="nps-rating-most-negative-label" for="nps-rating-most-negative"
             i18n-content="npsRatingMostNegativeLabel">
      </label>
      <label id="nps-rating-most-positive-label" for="nps-rating-most-positive"
             i18n-content="npsRatingMostPositiveLabel">
      </label>
    </form>
    <small id="privacy-note" class="privacy-note"
           i18n-values=".innerHTML:privacyNote"></small>
  </div>
  <div id="comment-pane" class="comment-pane">
    <div id="comment-label" class="comment-label"
         i18n-content="commentLabel"></div>
    <textarea id="comment-text" class="comment-text" maxlength="5000"
              aria-labelledby="comment-label"></textarea>
  </div>
  <!-- Buttons -->
  <div class="buttons-pane">
    <button class="button secondary-button" id="send-now-button"
            type="submit" i18n-content="sendNow"></button>
    <button class="button primary-button add-explanation-button"
            id="add-explanation-button" type="submit"
            i18n-content="addExplanation"></button>
    <button id="send-button" type="submit"
            class="button primary-button send-button"
            i18n-content="send"></button>
  </div>
</body>
</html>
// Copyright 2016 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @type {string}
 * @const
 */
const FEEDBACK_PRIVACY_STATEMENT_URL =
                            'https://go.microsoft.com/fwlink/p/?linkid=158334';
// Copyright 2013 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @type {number}
 * @const
 */
const FEEDBACK_WINDOW_MIN_WIDTH = 400;
/**
 * @type {number}
 * @const
 */
const FEEDBACK_WINDOW_MIN_HEIGHT = 468;
/**
 * @type {number}
 * @const
 */
const SURVEY_WINDOW_WIDTH = 400;
/**
 * @type {number}
 * @const
 */
const SURVEY_WINDOW_HEIGHT = 330;

/**
 * @type {string}
 * @const
 */
const FEEDBACK_DEFAULT_WINDOW_ID = 'default_window';

/**
 * @type {string}
 * @const
 */
const FEEDBACK_NOTIFY_THANK_YOU =
                             'https://go.microsoft.com/fwlink/?linkid=2060563';

/**
 * @type {string}
 * @const
 */
const SURVEY_NPS_WINDOW_ID = 'nps_window';

/**
 * @type {string}
 * @const
 */
const FEEDBACK_DEFAULT_HTML = 'html/default.html';

/**
 * @type {string}
 * @const
 */
const SURVEY_HTML = 'html/survey.html';

/**
 * defines window bounds for survey dialog
 */
const surveyWindowBounds = {
  minWidth: SURVEY_WINDOW_WIDTH,
  maxWidth: SURVEY_WINDOW_WIDTH,
  minHeight: SURVEY_WINDOW_HEIGHT,
  maxHeight: SURVEY_WINDOW_HEIGHT,
};

/**
 * Used to generate unique IDs for FeedbackRequest objects.
 * @type {number}
 */
let lastUsedId = 0;

/**
 * A FeedbackRequest object represents a unique feedback report, requested by an
 * instance of the feedback window. It contains the diagnostic data specific
 * to this report, the full feedbackInfo, and callbacks to send the report upon
 * request.
 */
class FeedbackRequest {
  constructor(feedbackInfo) {
    this.id_ = ++lastUsedId;
    this.feedbackInfo_ = feedbackInfo;
    this.onDiagnosticDataReadyCallback_ = null;
    this.isDiagnosticDataReady_ = false;
    this.reportIsBeingSent_ = false;
    this.isRequestCanceled_ = false;
    this.useDiagnosticData_ = false;
  }

  /**
   * Called when the diagnostic data is sent from the C++ side.
   * @param {Object} diagData The received diagnostic data.
   */
  getDiagnosticDataCallback(diagData) {
    if (this.isRequestCanceled_) {
        // If the window had been closed before the diagnostic data was
        // received, we skip the rest of the operations and return immediately.
        return;
    }

    this.isDiagnosticDataReady_ = true;

    // Combine the newly received diagnostic data with whatever system
    // information we have in the feedback info (if any).
    if (this.feedbackInfo_.diagnosticData) {
        this.feedbackInfo_.diagnosticData =
      this.feedbackInfo_.diagnosticData.concat(diagData);
    } else {
      this.feedbackInfo_.diagnosticData = diagData;
    }

    if (this.onDiagnosticDataReadyCallback_ != null) {
      this.onDiagnosticDataReadyCallback_();
      this.onDiagnosticDataReadyCallback_ = null;
    }
  }

  /**
   * Retrieves the diagnostic data for this request object.
   * @param {function()} callback Invoked to notify the listener that the system
   * information has been received.
   */
  getDiagnosticData(callback) {
    if (this.isDiagnosticDataReady_) {
      callback();
      return;
    }

    this.onDiagnosticDataReadyCallback_ = callback;
    // The C++ side must reply to the callback specific to this object.
    const boundCallback = this.getDiagnosticDataCallback.bind(this);
    chrome.edgeFeedbackPrivate.getDiagnosticData(boundCallback);
  }

  /**
   * Sends the feedback report represented by the object,
   * information to be sent with the report.
   * @param {boolean} useDiagnosticData True if the user would like the system
   * information to be sent with the report. False if they don't. Null/undefined
   * for the survey and other instances where it's N/A
   */
  sendReport(useDiagnosticData) {
    this.reportIsBeingSent_ = true;
    this.useDiagnosticData_ = useDiagnosticData;
    if (useDiagnosticData != null  && !this.isDiagnosticDataReady_) {
        this.onDiagnosticDataReadyCallback_ = this.sendReportNow;
        return;
    }
    this.sendReportNow();
  }

  /**
   * Sends the report immediately and removes this object once the report is
   * sent.
   */
  sendReportNow() {
    if (this.useDiagnosticData_ === false) {
        // Clear the diagnostic data if the user doesn't want it to be sent.
        this.feedbackInfo_.diagnosticData = 
            this.feedbackInfo_.diagnosticData.filter(data => data.isMandatory);
    }

    const ID = this.id_;
    chrome.edgeFeedbackPrivate.sendFeedback(
      this.feedbackInfo_, function(result, params) {
        if (result == chrome.edgeFeedbackPrivate.Status.SUCCESS) {
          let thankYouUrl = FEEDBACK_NOTIFY_THANK_YOU;
          for (const key in params) {
            thankYouUrl += `&${key}=${params[key]}`;
          }
          window.open(thankYouUrl, '_blank');
          console.log('Feedback: Report sent for request with ID ' + ID);
        } else {
          console.log(
            'Feedback: Report for request with ID ' + ID +
            ' will be sent later.');
        }
      }
    );
  }

  /**
   * Handles the event when the feedback UI window corresponding to this
   * FeedbackRequest instance is closed.
   */
  onWindowClosed() {
    if (!this.reportIsBeingSent_) {
      this.isRequestCanceled_ = true;
    }
  }
}

/**
 * Callback which starts up the feedback UI.
 * @param {Object} feedbackInfo Object containing any initial feedback info.
 */
function startFeedbackUI(feedbackInfo) {
  let windowId, pageToLoad, bounds;
  let validFlow = true;
  switch (feedbackInfo.flow) {
    case chrome.edgeFeedbackPrivate.FeedbackFlow.REGULAR:
    case chrome.edgeFeedbackPrivate.FeedbackFlow.SMILE_BUTTON:
    case chrome.edgeFeedbackPrivate.FeedbackFlow.BASIC:
      windowId = FEEDBACK_DEFAULT_WINDOW_ID;
      pageToLoad = FEEDBACK_DEFAULT_HTML;
      bounds = null;
      break;
    case chrome.edgeFeedbackPrivate.FeedbackFlow.SURVEY_NPS:
      windowId = SURVEY_NPS_WINDOW_ID;
      pageToLoad = SURVEY_HTML;
      bounds = surveyWindowBounds;
      break;
    default:
      validFlow = false;
      break;
  }

  if (!validFlow) {
    return;
  }

  const win = chrome.app.window.get(windowId);
  if (win) {
    win.show();
    return;
  }

  chrome.app.window.create(
    pageToLoad, {
      frame: feedbackInfo.useSystemWindowFrame ? 'chrome' : 'none',
      id: windowId,
      innerBounds: bounds,
      hidden: true,
      resizable: false
    },
    function(appWindow) {
      const request = new FeedbackRequest(feedbackInfo);

      // The feedbackInfo member of the new window should refer to the one in
      // its corresponding FeedbackRequest object to avoid copying and
      // duplicatations.
      appWindow.contentWindow.feedbackInfo = request.feedbackInfo_;

      // Pass along the frame info for initializeCloseButtonHandlers
      appWindow.contentWindow.useSystemWindowFrame =
                                           feedbackInfo.useSystemWindowFrame;

      // Keeps the status of recording so as to cancel it
      // during window onClosed if it is already started but not closed.
      appWindow.contentWindow.recordingStarted = false;

      // save minHeight and minWidth to feedback dialog window object
      // it is used by resizeAppWindow function in feedback.js
      if(feedbackInfo.flow ==
                    chrome.edgeFeedbackPrivate.FeedbackFlow.REGULAR ||
          feedbackInfo.flow ==
                    chrome.edgeFeedbackPrivate.FeedbackFlow.SMILE_BUTTON ||
          feedbackInfo.flow ==
                    chrome.edgeFeedbackPrivate.FeedbackFlow.BASIC) {
        appWindow.contentWindow.appWindowMinHeight =
                                                    FEEDBACK_WINDOW_MIN_HEIGHT;
        appWindow.contentWindow.appWindowMinWidth =
                                                      FEEDBACK_WINDOW_MIN_WIDTH;
        appWindow.contentWindow.screenInfo = feedbackInfo.screenInfo;
      }

      // Define some function for the new window so that it can call back
      // into here.

      // Define a function for the new window to get the diagnostic data.
      appWindow.contentWindow.getDiagnosticData = function (callback) {
        request.getDiagnosticData(callback);
      };

      // Define a function to request sending the feedback report.
      appWindow.contentWindow.sendFeedbackReport = function (useDiagnosticData) {
        request.sendReport(useDiagnosticData);
      };

      // If repro mode recording is started but not stopped then cancel it.
      appWindow.contentWindow.cancelRecording = function() {
        if (appWindow.contentWindow.recordingStarted) {
          appWindow.contentWindow.recordingStarted = false;
          chrome.edgeFeedbackPrivate.toggleNetExportCapture((trace) => {});
        }
      };

      // Observe when the window is closed.
      appWindow.onClosed.addListener(function() {
        // When feedback dialog is closed directly we close sub windows also,
        // so stop repro mode recording if started but not stopped by user.
        appWindow.contentWindow.cancelRecording();
        request.onWindowClosed();
      });
    }
  );
}

chrome.edgeFeedbackPrivate.onFeedbackRequested.addListener(startFeedbackUI);
// Copyright 2013 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/** @type {string}
 * @const
 */
const SYSINFO_WINDOW_ID = 'sysinfo_window';

/**
 * @type {string}
 * @const
 */
const SCREENSHOT_EDITOR_WINDOW_ID = 'screenshot_editor_window';

/** @type {string}
 * @const
 */
const CHANNEL_NAME_STABLE = 'stable';

/**
 * @type {number}
 * @const
 */
const FEEDBACK_STATUS_SCREENSHOTEDITOR_OPENED = 8;

/**
 * @type {number}
 * @const
 */
const FEEDBACK_STATUS_MAX = 13;

/**
 * array containing repro mode trace entries.
 * Each entry contains - keyname, file location, enabled or disabled status
 */
const reproModeTraceList = [
        {key: 'net_export_watson_file', value: '', enabled: false, 
          type: chrome.edgeFeedbackPrivate.DiagnosticDataType.WATSON_FILE_PATH},
      ];

/**
 * array containing files to be uploaded
 */
const savedFileUploadList = [];


/**
 * Determines whether the diagnostic data associated with this instance of
 * the feedback window has been received.
 * @type {boolean}
 */
let isDiagnosticDataReady = false;

/**
 * The callback used by the sys_info_page to receive the event that the system
 * information is ready.
 * @type {function(diagData)}
 */
let diagDataPageOnDiagDataReadyCallback = null;

/**
 * Sets up the event handlers for the given |anchorElement|.
 * @param {HTMLElement} anchorElement The <a> html element.
 * @param {string} url The destination URL for the link.
 */
function setupLinkHandlers(anchorElement, url) {
  anchorElement.onclick = function(e) {
    e.preventDefault();
    window.open(url, '_blank');
  };

  anchorElement.onauxclick = function(e) {
    e.preventDefault();
  };
}

/**
 * Adds captured trace(s) (if any) to diagnosticData
 */
function addReproModeTraceListToDiagData() {
  for (const item in reproModeTraceList) {
    if (reproModeTraceList[item]['enabled']) {
      const newDiagDataEntry = {
        enabled: true,
        key: reproModeTraceList[item]['key'],
        value: reproModeTraceList[item]['value'],
        type: chrome.edgeFeedbackPrivate.DiagnosticDataType.WATSON_FILE_PATH,
        queryableValue: { hasNetworkTrace: 1 },
        isMandatory: false
      };

      feedbackInfo.diagnosticData.push(newDiagDataEntry);
    }
  }
}

/**
 * Adds attached file(s) (if any) to diagnosticData
 */
function addUploadFilesToDiagData() {
  for (const item in savedFileUploadList) {
    const newDiagDataEntry = {
      enabled: true,
      key: 'file_upload_' + item + '_watson_file',
      value: savedFileUploadList[item]['filepath'],
      type: chrome.edgeFeedbackPrivate.DiagnosticDataType.WATSON_FILE_PATH,
      queryableValue: { hasAttachedFile: 1 },
      isMandatory: false
    };

    feedbackInfo.diagnosticData.push(newDiagDataEntry);
  }
}

/**
 * Sends the report; after the report is sent, sendReport closes this tab.
 * @param {Event} e submit event.
 * @return {boolean} True if the report was sent.
 */
function sendReport(e) {
  // Here we are preventing form controls from submitting implicitly
  // via enter key and only allow submit via the submit button
  e.preventDefault();
  if (document.activeElement != $('send-report-button')) {
    return false;
  }

  // do form validation and return if validation fails
  if(!$('feedback-pane').reportValidity()) {
    return true;
  }

  // Prevent double clicking from sending additional reports.
  $('send-report-button').disabled = true;
  console.log('Feedback: Sending report');

  feedbackInfo.description = $('description-text').value;
  feedbackInfo.pageUrl = $('page-url-text').value;

  let useDiagnosticData = false;
  if ($('sys-info-checkbox') != null && $('sys-info-checkbox').checked
      && isDiagnosticDataReady) {
    useDiagnosticData = true;
    // add traces ran from sys info dialog to diagnosticData
    addReproModeTraceListToDiagData();
    // add files ran from sys info dialog to diagnosticData
    addUploadFilesToDiagData();
  }

  if (!$('email-checkbox').checked) {
    feedbackInfo.email = null;
  } else {
    feedbackInfo.email = $('user-email-text').value;
    if (feedbackInfo.email && !chrome.extension.inIncognitoContext) {
      chrome.storage.local.set({ last_saved_email: feedbackInfo.email });
    }
  }

  // If the user doesn't want to send the screenshot.
  if (!$('screenshot-checkbox').checked) {
    feedbackInfo.screenshot = null;
  }

  // Request sending the report, and close this window right away.
  // The FeedbackRequest object that represents this
  // report will take care of sending the report in the background.
  sendFeedbackReport(useDiagnosticData);
  scheduleWindowClose();
  return true;
}

/**
 * Handle check/uncheck of 'Include email address' checkbox
 */
function emailCheckboxChanged() {
  if ($('email-checkbox').checked) {
    // When checked - populate with logged in user
    // $('user-email-text').value = 'loggedInUser@domain.com';
    setUserEmail().then(function(result) {
      $('user-email-text').disabled = false;
    });
  } else {
    // When unchecked, set input to empty string.
    // Email value will be set to 'null' when the report is actually sent.
    $('user-email-text').value = '';
    $('user-email-text').disabled = true;
  }
}

/**
 * A callback to be invoked when the background page of this extension receives
 * the diagnostic data.
 */
function onDiagnosticData() {
  isDiagnosticDataReady = true;
  // In case the sys_info_page needs to be notified by this event, do so.
  if (diagDataPageOnDiagDataReadyCallback != null) {
    diagDataPageOnDiagDataReadyCallback(feedbackInfo.diagnosticData);
    diagDataPageOnDiagDataReadyCallback = null;
  }
}

/**
 * Sets email text field using the last saved email local storage (if present)
 * otherwise call edgeFeedbackPrivate getUserEmail to get user email
 */
function setUserEmail() {
  return new Promise(function(resolve, reject) {
    chrome.storage.local.get(['last_saved_email'], function(result) {
      // Get the last used email from local storage if it is available
      // and set email to that value.
      if (chrome.extension.inIncognitoContext) {
        return resolve();
      }
      if (typeof result.last_saved_email != 'undefined'
          && result.last_saved_email) {
        $('user-email-text').value = result.last_saved_email;
        return resolve();
      } else {
        // If local storage doesn't have anything set then retrieve
        // the user email from FeedbackPrivate and set email to that value.
        chrome.edgeFeedbackPrivate.getUserEmail(function(email) {
          if (!email) {
            // If local storage and the Feedback private doesn't have
            // any values then set the email to empty string.
            $('user-email-text').value = '';
          } else {
            $('user-email-text').value = email;
          }
          return resolve();
        });
      }
    });
  });
}

/**
 * Setup and initialize feedback pane.
 *  - setup feedback pane event handlers
 *  - initialize url, email
 *  - labels/text are rendered by requesting i18n strings
 */
function setupFeedbackPane() {
  // Setup event handlers
  $('feedback-pane').addEventListener('submit', sendReport);
  $('email-checkbox').addEventListener('change', emailCheckboxChanged);

  // Set initial value and state of email input.
  setUserEmail().then(function() {
    if ($('user-email-text').value  === '') {
      $('user-email-text').disabled = true;
      $('email-checkbox').checked = false;
    } else {
      $('user-email-text').disabled = false;
      $('email-checkbox').checked = true;
    }
  }).then(function(){
    // Doing this as a chained 'then' so it is applied last,
    // as this channel-based policy should override any previous settings.
    if (feedbackInfo.channel === CHANNEL_NAME_STABLE) {
      $('email-checkbox').checked = false;
      $('sys-info-checkbox').checked = false;
    }
  });

  if (feedbackInfo.pageUrl) {
    $('page-url-text').value = feedbackInfo.pageUrl;
  }

  // Make sure our focus starts on the description field.
  $('description-text').focus();
}

/**
 * Takes screenshot
 */
const captureScreenshot = new Promise(function(resolve, reject) {
  takeScreenshot(function(screenshotCanvas) {
    return resolve(screenshotCanvas);
  });
});

/**
 * Add class to the root element depending up on the platform
 */
const addPlatformClass = new Promise(function(resolve, reject) {
  chrome.runtime.getPlatformInfo(function(info) {
    document.querySelector('html').classList.add(info.os);
    return resolve();
  });
});

/**
 * Convert screenshot to image and display it on the thumbnail, and
 * setup either screenshot modal or editor depending on the feature flag
 */
function processCanvasToImage(screenshotCanvas) {
  // Allow feedback to be sent even if the screenshot failed.
  if (!screenshotCanvas) {
    $('screenshot-checkbox').disabled = true;
    $('screenshot-checkbox').checked = false;
    return;
  }

  screenshotCanvas.toBlob(function(blob) {
    $('screenshot-image').src = URL.createObjectURL(blob);

    feedbackInfo.screenshot = blob;

    let screenshotLabel;
    if (feedbackInfo.enabledFeatureFlags.includes('screenshotCrop')) {
      screenshotLabel = loadTimeData.getString('screenshotOpenEditor');
      setupHandlersForScreenshotEditor();
    } else {
      screenshotLabel = loadTimeData.getString('screenshotZoom');
      $('screenshot-image').classList.remove('screenshot-image');
      $('screenshot-image').classList.add('screenshot-image-modal');
      setUpHandlersForScreenshotModal();
    }
    $('image-thumbnail-container').setAttribute('aria-label', screenshotLabel);
  });
}

/**
 * Set up event handlers for screenshot thumbnail for editing experience
 */
function setupHandlersForScreenshotEditor() {
  $('image-thumbnail-container').addEventListener('click', triggerEditorLaunch);
  $('image-thumbnail-container').addEventListener('keyup', handleEnterKeyUp);

  $('image-thumbnail-container').addEventListener('mousemove',
                                                  showOverlay);
  $('image-thumbnail-container').addEventListener('mouseleave', hideOverlay);

  $('image-thumbnail-container').addEventListener('focus',
                                                  showOverlay);
  $('image-thumbnail-container').addEventListener('blur', hideOverlay);

  /**
   * Show screenshot thumbnail overlay
   * @param {MouseEvent || FocusEvent} e mouseenter or focus event
   */
  function showOverlay(e) {
    e.preventDefault();

    // For mouseevent, hide overlay when cursor is
    // outside the visible image boundaries
    let isCursorWithinImage = false;
    if (e.type == 'mousemove') {
      const rect = $('screenshot-image').getBoundingClientRect();
      isCursorWithinImage = e.pageX < rect.right && e.pageX > rect.left;
      if (!isCursorWithinImage) {
        hideOverlay();
        return;
      }
    }

    let overlayWidth = $('screenshot-image').width;
    const minWidth = 100;
    overlayWidth = (overlayWidth > minWidth) ? overlayWidth : minWidth;

    // For tab focus or if the cursor is within the image bound
    if (e.type == 'focus' || isCursorWithinImage) {
      $('screenshot-overlay').style.width = overlayWidth + 'px';
      $('screenshot-overlay').style.visibility = 'visible';
    }
  }

  /**
   * Hide screenshot thumbnail overlay
   */
  function hideOverlay() {
    $('screenshot-overlay').style.visibility = 'hidden';
  }

  /**
   * Allow the enter key to trigger screenshot editor
   * @param {KeyboardEvent} e keyup event.
   */
  function handleEnterKeyUp(e) {
    if (e.keyCode === 13 || e.keyCode == 32) { // enter or space
      triggerEditorLaunch(e);
    }
  }

  /**
   * Trigger screenshot editor
   * @param {MouseEvent || KeyboardEvent} e click event or keyup event
   */
  function triggerEditorLaunch(e) {
    e.preventDefault();
    $('image-thumbnail-container').blur();

    chrome.metricsPrivate.recordEnumerationValue(
              'Microsoft.Feedback.SendFeedback',
              FEEDBACK_STATUS_SCREENSHOTEDITOR_OPENED,
              FEEDBACK_STATUS_MAX);

    createScreenshotEditorDialog();
  }
}

/**
 * Gets the localized string for Labels and other text on the page
 */
const getAndApplyLocalizedStrings = new Promise(function(resolve, reject) {
  chrome.edgeFeedbackPrivate.getStrings(
        chrome.edgeFeedbackPrivate.FeedbackFlow.REGULAR, function(strings) {
          loadTimeData.data = strings;
          i18nTemplate.process(document, loadTimeData);

          // Privacy link and System info link comes from getStrings, hence we need
          // to wait for stringsbefore setting up event handlers on these links
          const privacyPolicyUrlElement = $('privacy-statement-page-url');
          if (privacyPolicyUrlElement) {
            setupLinkHandlers(privacyPolicyUrlElement,
                              FEEDBACK_PRIVACY_STATEMENT_URL);
          }

          setupDiagnosticDataLinkClick();

          return resolve();
        });
});

/*
* Launches system info dialog with Trace capture facility inside that dialog,
* when clicked on 'system info' link
*/
function createDiagnosticDataDialog() {
  const win = chrome.app.window.get(SYSINFO_WINDOW_ID);
  if (win) {
    win.show();
    return;
  }
  chrome.app.window.create(
    '/html/sys_info_trace.html', {
      frame: feedbackInfo.useSystemWindowFrame ? 'chrome' : 'none',
      id: SYSINFO_WINDOW_ID,
      hidden: true,
      resizable: true
    },
    function(appWindow) {
      // Pass along some required values/information to new dialog
      appWindow.contentWindow.useSystemWindowFrame =
                                           feedbackInfo.useSystemWindowFrame;
      appWindow.contentWindow.appWindowMinWidth = 900;
      appWindow.contentWindow.appWindowMinHeight = 570;
      appWindow.contentWindow.screenInfo = feedbackInfo.screenInfo;
      appWindow.contentWindow.allowMaximize = true;

      // Pass along the list of enabled feature flags
      appWindow.contentWindow.enabledFeatureFlags =
                                            feedbackInfo.enabledFeatureFlags;

      // Gets the full diagnostic data for the new window.
      appWindow.contentWindow.getFullDiagnosticData = function(callback) {
        if (isDiagnosticDataReady) {
          callback(feedbackInfo.diagnosticData);
          return;
        }

        diagDataPageOnDiagDataReadyCallback = callback;
      };

      // Enable or disable a diagnostic data key
      // if key is disabled then it is not sent as a part of diagnostic data
      appWindow.contentWindow.changeDiagnosticDataKeyStatus =
      function(keyName, enabledStatus) {
        const index = findIndexBasedOnKey(feedbackInfo.diagnosticData,
                                          keyName);
        if (index >= 0) {
          feedbackInfo.diagnosticData[index]['enabled'] = enabledStatus;
        }
      };

      // Returns the loadTimeData for the new window.
      appWindow.contentWindow.getLoadTimeData = function() {
        return loadTimeData;
      };

      // Get the sys info value for a key
      appWindow.contentWindow.getValueForKey = function(keyName) {
        const index = findIndexBasedOnKey(feedbackInfo.diagnosticData,
                                          keyName);
        if (index >= 0) {
          return feedbackInfo.diagnosticData[index]['value'];
        }
        return null;
      };

      // gets the saved trace captured list
      appWindow.contentWindow.getSavedTraceList = function() {
        return reproModeTraceList;
      };

      // gets the saved file upload list
      appWindow.contentWindow.getSavedFileList = function() {
        return savedFileUploadList;
      };

      // enables the entry (signified by keyName) inside repro mode trace list
      appWindow.contentWindow.enableTraceInReproModeTraceList =
      function(keyName, value) {
        const index = findIndexBasedOnKey(reproModeTraceList, keyName);
        if (index >= 0) {
          reproModeTraceList[index]['value'] = value;
          reproModeTraceList[index]['enabled'] = true;
        }
      };

      // disable the entry (signified by keyName) inside repro mode trace list
      appWindow.contentWindow.disableTraceInReproModeTraceList =
      function(keyName, value) {
        const index = findIndexBasedOnKey(reproModeTraceList, keyName);
        if (index >= 0) {
          reproModeTraceList[index]['value'] = '';
          reproModeTraceList[index]['enabled'] = false;
        }
      };

      // add file entry to saved file upload list
      appWindow.contentWindow.addFileToFileUploadList =
      function(filename, filepath) {
        const index = findIndexBasedOnFilepath(savedFileUploadList, filepath);
        if (index == -1) {
          const entry = {
            filename: filename,
            filepath: filepath
          };
          savedFileUploadList.push(entry);
        }
      };

      // remove file entry from saved file upload list
      appWindow.contentWindow.removeFileFromSavedFileUploadList =
      function(filepath) {
        const index = findIndexBasedOnFilepath(savedFileUploadList, filepath);
        if (index >= 0) {
          savedFileUploadList.splice(index, 1);
        }
      };

      // update recordingStarted flag to true
      // to indicate trace recording started
      appWindow.contentWindow.recordingStarted = function() {
        window.recordingStarted = true;
      };

      // update recordingStarted flag to false to indicate
      // trace recording stopped
      appWindow.contentWindow.recordingStopped = function() {
        window.recordingStarted = false;
      };

      // Save and Include button clicked so enable/check
      // 'Include diagnostic data' checkbox
      appWindow.contentWindow.enableDiagDataCheckbox = function() {
        $('sys-info-checkbox').checked = true;
      };

      // window closed event listener
      appWindow.onClosed.addListener(() => {
        // cancel recording if it is not stopped after being started
        window.cancelRecording();
      });
    }
  );
}

/**
 * Returns index from array
 * if the property of any entry in array matches the searchTerm
 * @param {Array} arrayName array to be searched
 * @param {string} property property name
 * @param {string} searchTerm search term
 */
function findIndex(arrayName, property, searchTerm) {
  return arrayName.findIndex(function(element) {
    return element[property] == searchTerm;
  });
}

/**
 * Returns index from array
 * if the keyName property of any entry in array matches the searchTerm
 * @param {Array} arrayName array to be searched
 * @param {string} keyName search term
 */
function findIndexBasedOnKey(arrayName, keyName) {
  return findIndex(arrayName, 'key', keyName);
}

/**
 * Returns index from array
 * if the filename property of any entry in array matches the searchTerm
 * @param {Array} arrayName array to be searched
 * @param {string} value search term
 */
function findIndexBasedOnFilepath(arrayName, value) {
  return findIndex(arrayName, 'filepath', value);
}

/*
 * Setup click event on diagnostic data link
 */
function setupDiagnosticDataLinkClick() {
  const diagDataUrlElement = $('sys-info-url');
  if (diagDataUrlElement) {
    diagDataUrlElement.onclick = function(e) {
      e.preventDefault();
      chrome.edgeFeedbackPrivate.triggerEventForFeature(
                chrome.edgeFeedbackPrivate.FeedbackFeature.TRACING_CAPTURE);
      createDiagnosticDataDialog();
    };

    diagDataUrlElement.onauxclick = function(e) {
      e.preventDefault();
    };
  }
}

/*
 * Launch screenshot editor when screenshot thumbnail is clicked
 */
function createScreenshotEditorDialog() {
  const win = chrome.app.window.get(SCREENSHOT_EDITOR_WINDOW_ID);
  if (win) {
    win.show();
    return;
  }
  chrome.app.window.create(
    '/html/screenshot_editor.html', {
      frame: feedbackInfo.useSystemWindowFrame ? 'chrome' : 'none',
      id: SCREENSHOT_EDITOR_WINDOW_ID,
      hidden: true,
      resizable: true
    },
    function(appWindow) {
      // Pass along some required values/information to new dialog
      appWindow.contentWindow.useSystemWindowFrame =
                                           feedbackInfo.useSystemWindowFrame;
      appWindow.contentWindow.appWindowMinWidth = 900;
      appWindow.contentWindow.appWindowMinHeight = 570;
      appWindow.contentWindow.screenInfo = feedbackInfo.screenInfo;
      appWindow.contentWindow.allowMaximize = true;
      // Pass along the list of enabled feature flags
      appWindow.contentWindow.enabledFeatureFlags =
                                            feedbackInfo.enabledFeatureFlags;

      appWindow.contentWindow.originalScreenshot = function() {
        return $('screenshot-image').src;
      };

      // Return the loadTimeData for the new window.
      appWindow.contentWindow.getLoadTimeData = function() {
        return loadTimeData;
      };

      appWindow.onClosed.addListener(function() {
        // Receive the edited canvas if provided.
        const resultCanvas = appWindow.contentWindow.getEditedScreenshot();

        if (resultCanvas) { // null if user closed editor without saving
          // User saved the edited screenshot hence check the checkbox
          feedbackInfo.screenshotEdited = true;
          $('screenshot-checkbox').checked = true;

          resultCanvas.toBlob(function(blob) {
            $('screenshot-image').src = URL.createObjectURL(blob);
            feedbackInfo.screenshot = blob;
          });
        }
        $('image-thumbnail-container').focus();
      });
    }
  );
}

/**
 * Close system info and screenshot editor windows if they are open.
 */
function closeSubWindows() {
  let win = chrome.app.window.get(SYSINFO_WINDOW_ID);
  if (win) {
    win.close();
  }
  win = chrome.app.window.get(SCREENSHOT_EDITOR_WINDOW_ID);
  if (win) {
    win.close();
  }
}

/*
 * Show feedback dialog
 */
function showDialog() {
  setupFeedbackPane();

  resizeAppWindow();

  // when the window is created from event_handler.js, it is hidden
  // so we need to call show() now
  // If we don't wait after setting page title (via i18nTemplate.process),
  // screen reader reads out window document as blank/unknown.
  // Hence we are introducing a small delay before displaying window.
  setTimeout(function() {
    chrome.app.window.current().show();
  }, 25);
}

/**
 * Shows one of the panes inside content-pane based on the feedback flow
 * - takes screenshot
 * - gets localizes strings
 * - shows dialog
 */
function createDialog() {
  //if flow is basic we don't capture screenshot and system log
  if (feedbackInfo.flow == chrome.edgeFeedbackPrivate.FeedbackFlow.BASIC) {
    Promise.all([getAndApplyLocalizedStrings, addPlatformClass])
    .then(() => {
      // hide screenshot and system info container
      // so that we don't show them for basic flow
      $('screenshot-image-container').style.display = 'none';
      $('sys-info-container').style.display = 'none';
      // uncheck system info so that we don't send system info for basic flow
      $('sys-info-checkbox').checked = false;
      showDialog();
    });
  } else {
    // take screenshot before we show the dialog otherwise
    // feedback dialog shows up in screenshot capture
    Promise.all([captureScreenshot, getAndApplyLocalizedStrings,
                 addPlatformClass])
    .then((results) => {
      showDialog();
      // get diagnostic data since sys-info-checkbox is checked by default
      getDiagnosticData(onDiagnosticData);
      // convert screenshot canvas to image inside screenshot image container
      const screenshotCanvas = results[0];
      processCanvasToImage(screenshotCanvas);
    });
  }
}

/**
 * Initializes our page.
 * . DOMContent Loaded  ->  create dialog based on feedbackInfo.flow
 * . onClosed  ->  close other feedback windows if they are open
 */
function initialize() {
  window.addEventListener('DOMContentLoaded', function() {
    createDialog();
  });

  const appWin = chrome.app.window.current();
  appWin.onClosed.addListener(closeSubWindows);
}

initialize();
// Copyright 2013 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

const CLASS_NAME = 'focus-by-keydown';
const doc = document;

/**
 * For keydown on document add class 'focus-by-keydown' to documentElement.
 * Remove the class 'focus-by-keydown' from documentElement for each click
 *
 * Then to add focus outline or border for focus via keyboard, add these styles
 *
 *  html.focus-by-keydown .button:focus {
 *    border: 2px solid black;
 *    outline: none;
 *  }
 *
 */

const eventHandle = function(isKeyDownEvent, e) {
  // event can take place via keydown or mousedown
  if (isKeyDownEvent) {
    doc.documentElement.classList.toggle(CLASS_NAME, true);
  } else {
    doc.documentElement.classList.remove(CLASS_NAME);
  }
};

doc.addEventListener('keydown', eventHandle.bind(this, true), true);
doc.addEventListener('mousedown', eventHandle.bind(this, false), true);
// Copyright 2013 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @type {number}
 * @const
 */
const SYSTEM_WINDOW_FRAME_TITLE_HEIGHT = 22;

/**
 * resize app window dialog so that all the contents are laid out
 * without scrollbar
 */
function resizeAppWindow() {
  // We pick the width from the titlebar, which has no margins.
  let width = $('title-bar').scrollWidth;
  // set width to min expected width (if it is less than min expected width)
  if (window.appWindowMinWidth) {
    width = Math.max(width, window.appWindowMinWidth);
  }

  // We get the height by adding the titlebar height and the content height.
  let height = $('title-bar').scrollHeight + $('content-pane').scrollHeight;
  // For Mac which uses system window frame to show close, min, max buttons,
  // we need to add system window frame title to height
  if (window.useSystemWindowFrame) {
    height += SYSTEM_WINDOW_FRAME_TITLE_HEIGHT;
  }
  // set height to min expected height (if it is less than min expected height)
  if (window.appWindowMinHeight) {
    height = Math.max(height, window.appWindowMinHeight);
  }

  // Use screenInfo to position the dialog to center in the target screen.
  // If screenInfo feature flag is enabled then screen info is capture
  //  from c++ code and passed to javascript via feedbackInfo.screenInfo.
  // During the creation of dialog, feedbackInfo.screenInfo is assigned to
  // dialog's window.screenInfo.
  // If window.screenInfo.width or window.screenInfo.height is 0,
  // it indicates the screen info is not available so don't do reposition.
  let left2 = 0;
  let top2 = 0;
  let maximizeWindow = false;
  if (window.screenInfo && window.screenInfo.width > 0
                        && window.screenInfo.height > 0) {
    left2 = Math.round(window.screenInfo.left
                            + window.screenInfo.width / 2
                            - width / 2);
    top2 = Math.round(window.screenInfo.top
                            + window.screenInfo.height / 2
                            - height / 2);

    // if either left and top bounds are negative
    // then maximize the dialog
    if (window.allowMaximize && (left2 <= 0 || top2 <= 0)) {
      maximizeWindow = true;
    }

    // reposition left and top to 10 if they are less than 10
    left2 = left2 <= 10 ? 10 : left2;
    top2 = top2 <= 10 ? 10 : top2;

    // if width of dialog exceeds screen width
    // then reduce the width to be within inside screen width
    if (width + 20 > window.screenInfo.width) {
      width = window.screenInfo.width - 20;
    }

    // if height of dialog exceeds screen height
    // then reduce the height to be within inside screen height
    if (height + 30 > window.screenInfo.height) {
      height = window.screenInfo.height - 30;
    }
  }

  // resize the dialog to the newly calulated width and height
  chrome.app.window.current().resizeTo(width, height);

  // reposition the dialog based on calculations we did using screenInfo
  if (window.screenInfo && window.screenInfo.width > 0
                        && window.screenInfo.height > 0) {
    chrome.app.window.current().outerBounds.setPosition(left2, top2);
  }

  // Force the dialog to be displayed in maximized state
  // when dialog bounds are greater than screen bounds
  if (maximizeWindow) {
    chrome.app.window.current().maximize();
  }
}
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * The global load time data that contains the localized strings that we will
 * get from the main page when this page first loads.
 */
let loadTimeData = null;

/**
 * |userActionStack| keeps a record of user actions in an array.
 * It is also used as the Undo stack for undo actions.
 */
const userActionStack = [];

/**
 * |redoStack| keeps a record of undo'ed actions in an array
 * to provide redo actions in an array.
 */
let redoStack = [];

/**
 * |croppingStack| keeps a record of cropping actions in an array
 */
let croppingStack = [];

/**
 * |penStack| keeps a record of pen actions in an array
 */
const penStack = [];

/**
 * |actionLabel| is used for listing user action labels
 */
const actionLabel = {
  crop: 1,
  pen: 2
};

/**
 * Canvas information object.
 */
const canvasObj = {
  cropMode: false,
  penMode: false,

  // True if the canvas is dirty meaning
  // there are newly added or removed drawings
  // that |flattenedScreenshotImage| needs to be updated
  // before taking actions such as crop mode or window resize
  isCanvasDirty: false,
  // True if a user is drawing on canvas in pen mode == isMouseDown
  isDrawing: false,
  // True if the window resizing should wait till the flattened image is ready
  isResizeOnHold: false,
  // True a user decides to save edits
  isSavingChanges: false,
  // By default set to black ink
  penColor: '#000',
  // Pen thickness
  penSize: 4,
  cursor: 'crosshair',
  lastPoint: null,
  // Keeps tracks of the current pen stroke being drawn
  path: []
};

/**
 * |originalScreenshotImage| is the screenshot image in its original size.
 */
const originalScreenshotImage = new Image();

/**
 *  Same size and image as |originalScreenshotImage| but with user drawings.
 * 'flattened' meaning any user drawings are incorporated in one image object.
 */
const flattenedScreenshotImage = new Image();

/**
 * @type {number}
 * @const
 */
const FEEDBACK_STATUS_SCREENSHOT_CROPPED = 9;

/**
 * @type {number}
 * @const
 */
const FEEDBACK_STATUS_MAX = 13;

/**
 * Set up Screenshot Editor event handlers.
 */
function setupHandlers() {
  // Mode buttons: crop and pen.
  $('crop-button').addEventListener('click', enterEditMode);

  // Enable pen mode by feature flag
  if (enabledFeatureFlags.includes('screenshotPen')) {
    $('pen-button').addEventListener('click', enterEditMode);
    $('pen-button').removeAttribute('hidden');
  }

  // Crop tool buttons
  $('crop-save-button').addEventListener('click', cropModeSave);
  $('crop-cancel-button').addEventListener('click', exitCropMode);

  // Crop mode: Attach setup handlers for each corner of resizers
  const resizers = [$('resizer-top-left'), $('resizer-top-right'),
                    $('resizer-bottom-left'), $('resizer-bottom-right')];
  resizers.forEach(function(resizer) {
    resizer.addEventListener('mousedown', setupResize);
    resizer.addEventListener('touchstart', setupResize);
    resizer.addEventListener('keydown', setupArrowKeys);
  });

  // Pen mode: Attach setup handlers for color buttons and size slider
  const colorButtons = document.getElementsByClassName('color-button');
  for (let i = 0; i < colorButtons.length; i++) {
    const button = colorButtons[i];
    button.addEventListener('click', function() {
      canvasObj.penColor = getComputedStyle(this).getPropertyValue(
                               'background-color'); // ex: rgb(0, 0, 0);
      getSVGElement('pen-fill').style.fill = canvasObj.penColor;
      updatePenSizeSample();
    });

    button.addEventListener('mouseup', closePenPanel);
    button.addEventListener('keydown', togglePenPanelFocus);
  }

  $('size-slider').addEventListener('input', function () {
    canvasObj.penSize = this.value;
    $('size-slider').title = this.value;
    updatePenSizeSample();
  });

  $('size-slider').addEventListener('mouseup', closePenPanel);
  $('size-slider').addEventListener('keydown', togglePenPanelFocus);

    // Handlers for Undo, Redo and Save buttons
  $('undo-button').addEventListener('click', handleUndoRedoAction);
  $('redo-button').addEventListener('click', handleUndoRedoAction);
  $('save-button').addEventListener('click', saveAndClose);
}

/**
 * Return the edited canvas.
 * @return {Object} resultCanvas the main canvas.
 */
function getEditedScreenshot() {
  return canvasObj.isSavingChanges ? $('canvas-screenshot') : null;
}

/**
 * Prepare for an editing Mode.
 * Direct to either the crop or pen mode.
 */
function enterEditMode() {
  if (this === $('crop-button')) { // Crop clicked
    // If in pen mode then exit
    if (canvasObj.penMode) {
      exitPenMode();
    }

    canvasObj.cropMode = true;
    refreshToolbar();
    if (canvasObj.isCanvasDirty) {
      // Then flatten the canvas first and
      // wait for |flattenedScreenshotImage| onload handler
      // to trigger enterCropMode();
      flattenScreenshotImage();
    } else {
      enterCropMode();
    }
  } else { // Pen clicked
    if (!canvasObj.penMode) {
      // Enter pen mode
      enterPenMode();
    } else {
      // Already in pen mode, handle dropdown actions
      isPenPanelOpen() ? closePenPanel() : openPenPanel();
    }
    refreshToolbar();
  }
}

/**
 * Display crop mode.
 */
function enterCropMode() {
  // Disable save button and remove the tab index of top buttons
  $('save-button').disabled = true;
  $('maximize-button').tabIndex = -1;
  $('close-button').tabIndex = -1;
  displayCroppingGrid();
  greyOutUnselectedArea();

  if (loadTimeData.data_.textdirection == 'rtl') {
    $('resizer-top-right').tabIndex = 1;
    $('resizer-top-left').tabIndex = 2;
    $('resizer-bottom-right').tabIndex = 3;
    $('resizer-bottom-left').tabIndex = 4;
    $('resizer-top-right').focus();
  } else {
    $('resizer-top-left').focus();
  }
}

/**
 * Return True if pen panel is open.
 */
function isPenPanelOpen() {
  return !$('pen-tools-container').hidden;
}

/*
 * Place focus on current color button on pen panel.
 */
function focusCurrentColor() {
  const colorButtons = document.getElementsByClassName('color-button');
  for (let i = 0; i < colorButtons.length; i++) {
    const button = colorButtons[i];
    if (button.checked) {
      button.focus();
    }
  }
}

/**
 * Handle closing of pen panel.
 * Pen panel is closed when
 * (1) esc key is pressed
 * (2) pen button is clicked - handled in enterEditMode()
 * (3) area outside the panel is clicked.
  * @param {MouseEvent | KeyboardEvent} a click or keydown event.
 */
function penPanelCloseHandler(e) {
  if (!isPenPanelOpen()) return;

  if (e.type == 'click' &&
    (!$('pen-button').contains(e.target)) &&
    (!e.target.matches('.color-button')) &&
    (!$('pen-tools-container').contains(e.target))) {
    closePenPanel();
  } else if (e.type == 'keydown' && e.keyCode == 27) {
    closePenPanel();
    $('pen-button').focus();
  }
}

/**
 * Circulate focus within pen panel.
 * @param {KeyboardEvent} a keydown event.
 */
function togglePenPanelFocus(e) {
  if (e.keyCode == 9) {
    e.preventDefault();
    if (this == $('size-slider')){
      focusCurrentColor();
    } else if (e.target.matches('.color-button')){
      $('size-slider').focus();
    }
  }
}

/**
 * Close pen panel.
 */
function closePenPanel() {
  $('pen-arrow').hidden = false;
  $('pen-tools-container').hidden = true;
  $('pen-button').setAttribute('aria-expanded', false);

  window.removeEventListener('click', penPanelCloseHandler);
  window.removeEventListener('keydown', penPanelCloseHandler);
}

/**
 * Draw a curve on sampler canvas by joining two quadratic lines.
 */
function updatePenSizeSample() {
  const canvasinlineMargin = 20;
  const vertical = $('size-sampler').height / 2;
  const start = { x: canvasinlineMargin, y: vertical };
  const end = { x: $('size-sampler').width - canvasinlineMargin, y: start.y };
  const mid = { x: $('size-sampler').width / 2, y: start.y };
  const horizontal = (mid.x - start.x) / 2;

  const canvasContext = $('size-sampler').getContext('2d');
  canvasContext.clearRect(0, 0,
                          $('size-sampler').width,
                          $('size-sampler').height);

  canvasContext.beginPath();
  canvasContext.lineCap = 'round';
  canvasContext.lineWidth = canvasObj.penSize;

  canvasContext.moveTo(start.x, start.y);
  canvasContext.quadraticCurveTo(start.x + horizontal,
                                 start.y - vertical, mid.x, mid.y);
  canvasContext.moveTo(mid.x, mid.y);
  canvasContext.quadraticCurveTo(mid.x + horizontal,
                                 mid.y + vertical, end.x, end.y);

  canvasContext.strokeStyle = canvasObj.penColor;
  canvasContext.stroke();
}

/**
 * Open pen panel.
 */
function openPenPanel() {
  $('pen-arrow').hidden = true;
  $('pen-tools-container').hidden = false;
  $('pen-button').setAttribute('aria-expanded', true);

  focusCurrentColor();
  // Once the panel is open, listen for actions that closes the panel
  window.addEventListener('click', penPanelCloseHandler);
  window.addEventListener('keydown', penPanelCloseHandler);

  // Display pen size sampler
  setCanvasSize($('size-sampler'));
  updatePenSizeSample();
}

/**
 * Enter Pen mode.
 */
function enterPenMode() {
  canvasObj.penMode = true;

  // Listen for events that initiate and start drawing
  $('canvas-screenshot').addEventListener('mousedown', initDrawing);
  $('canvas-screenshot').addEventListener('mousemove', startDrawing);
  $('canvas-screenshot').addEventListener('touchstart', initDrawing);
  $('canvas-screenshot').addEventListener('touchmove', startDrawing);

  // Listen for events that cancel drawing
  const cancelEvents = ['mouseleave', 'mouseup', 'touchend', 'touchcancel'];
  cancelEvents.forEach(function(eventName) {
    $('canvas-screenshot').addEventListener(eventName, finishDrawing);
  });
}

/**
  * Retern true if a given point is within the visible image part of canvas.
  * @param {Object} point (x, y) point.
  * @return {Boolean} indicating whether a point is in the canvas.
  */
function isPointInCanvas(point) {
  const canvasRect = $('canvas-screenshot').getBoundingClientRect();
  const canvasMargin = getCanvasMargin();

  return !((point.x < canvasMargin.w) ||
      (point.x > canvasRect.width - canvasMargin.w) ||
      (point.y < canvasMargin.h) ||
      (point.y > canvasRect.height - canvasMargin.h));
}

/**
  * Set up drawing.
  * @param {MouseEvent or TouchEvent} e mousedown or touchstart event.
  */
function initDrawing(e) {
  const canvasRect = $('canvas-screenshot').getBoundingClientRect();
  const isTouch = (e.type === 'touchstart');
  const point = {
    x: (isTouch ? e.changedTouches[0].pageX : e.pageX) - canvasRect.left,
    y: (isTouch ? e.changedTouches[0].pageY : e.pageY) - canvasRect.top
  };
  // Allow drawing only within the image part of the canvas
  if (!isPointInCanvas(point)) return;

  canvasObj.isDrawing = true;
  canvasObj.lastPoint = point;
  canvasObj.path = [point];
}

/*
  * Return the distance between point A and B.
  * @param {Object} A point (x, y)
  * @param {Object} B point (x, y)
  * @return {Number} distance between two points.
  */
function distanceBetween(A, B) {
  return Math.hypot(B.x - A.x, B.y - A.y);
}

/*
  * Return the angle (in radians) between the positive x-axis.
  * and the ray from (0,0) to the point (A, B).
  * @param {Object} A point (x, y)
  * @param {Object} B point (x, y)
  * @return {Number} angle in radians.
  */
function angleBetween(A, B) {
  return Math.atan2(B.x - A.x, B.y - A.y);
}

/**
  * Draw a smooth line between two points.
  * @param {Canvas2DContext} canvasContext a canvas 2d context object.
  * @param {Object} A a point (x, y).
  * @param {Object} B a point (x, y).
  * @param {String} color the color of the line.
  * @param {Number} size the thickness of the line.
  * @param {Boolean} isSaving indicates whether to save the point to path array.
  */
function drawLine(canvasContext, A, B, color, size, isSaving) {
  if (!A || !B) return;

  const dist = distanceBetween(A, B);
  const angle = angleBetween(A, B);

  for (let i = 0; i < dist; i++) {
    const x = A.x + (Math.sin(angle) * i);
    const y = A.y + (Math.cos(angle) * i);

    canvasContext.fillStyle = color;
    canvasContext.fillRect(x - size / 2, y - size / 2, size, size);

    if (isSaving) {
      canvasObj.path.push(B);
    }
  }
}

/**
  * Add a pen stroke to |penStack| and update related variables.
  */
function addPathToStack() {
  if (canvasObj.path.length < 1) return;

  // Adjust the current path to its original scale
  const origPath = [];
  for (let i = 0; i < canvasObj.path.length; i++) {
    const point = canvasObj.path[i];
    const newPoint = getOriginalCoordinates(point.x, point.y);
    origPath.push(newPoint);
  }

  penStack.push({
    path: origPath,
    color: canvasObj.penColor,
    size: canvasObj.penSize / getDisplayScale()
  });

  // Record that user did a pen action.
  userActionStack.push(actionLabel.pen);

  canvasObj.path = [];

  updateUndoRedoButtonState();
}

/**
  * Draw according to the mouse position and direction.
  * @param {MouseEvent or TouchEvent} e mousemove or touchmove event.
  */
function startDrawing(e) {
  const canvasContext = $('canvas-screenshot').getContext('2d');
  const canvasRect = $('canvas-screenshot').getBoundingClientRect();

  const isTouch = (e.type === 'touchmove');
  const curPoint = {
    x: (isTouch ? e.changedTouches[0].pageX : e.pageX) - canvasRect.left,
    y: (isTouch ? e.changedTouches[0].pageY : e.pageY) - canvasRect.top
  };

  const isOnImage = isPointInCanvas(curPoint);
  $('canvas-screenshot').style.cursor = isOnImage ? canvasObj.cursor : 'auto';

  if (!canvasObj.isDrawing) return;

  // Stop drawing if it's not moving over the image part of the canvas
  if (!isOnImage) {
    // Add any existing pen strokes
    addPathToStack();
    // Reset last point
    canvasObj.lastPoint = null;
    return;
  }

  drawLine(canvasContext, canvasObj.lastPoint, curPoint,
      canvasObj.penColor, canvasObj.penSize, true);

  canvasObj.lastPoint = curPoint;

  // If mouse was moving in the margin and then comes back
  // then we reach this part.
  // The next mousemove will start a new pen stroke.
  if (canvasObj.path.length == 0) {
    canvasObj.path = [curPoint];
  }
}

/**
  * Finish the drawing action.
  */
function finishDrawing() {
  if (!canvasObj.isDrawing) return;

  // Set the flags that drawing is over and canvas is dirty
  canvasObj.isDrawing = false;
  canvasObj.isCanvasDirty = true;

  // Add the pen stroke to the stack
  addPathToStack();
}

/**
  * Update the tool bar depending on any active mode.
  */
function refreshToolbar() {
  if (!canvasObj.cropMode && !canvasObj.penMode) {
    // If not in any edit mode, show the default tools
    $('home-tool-container').hidden = false;
    $('crop-tools-container').hidden = true;
    $('pen-tools-container').hidden = true;
    updateUndoRedoButtonState();
  }

  if (canvasObj.cropMode) {
    // If crop mode then show only the crop tools
    // and hide mode buttons and undo/redo buttons
    $('home-tool-container').hidden = true;
    $('crop-tools-container').hidden = false;
  }

  if (canvasObj.penMode) {
    getSVGElement('pen-fill').style.fill = canvasObj.penColor;
    $('pen-active').hidden = false;
  } else {
    getSVGElement('pen-fill').style.fill = 'transparent';
    $('pen-active').hidden = true;
  }
}

/**
  * Return the coordinates in the original image
  *        corresponding to the canvas selection.
  * @param {number} x x coordinate
  * @param {number} y y coordinate
  * @return {Object} Array containing x and y
  *                  in original dimension.
  */
function getOriginalCoordinates(x, y) {
  const selection = peek(croppingStack);
  const canvasMargin = getCanvasMargin();
  const scale = getDisplayScale();

  const newX = selection.x + (x / scale)
                        - (canvasMargin.w / scale);
  const newY = selection.y + (y / scale)
                        - (canvasMargin.h / scale);

  return {
    x: (newX < 0) ? 0 : newX,
    y: (newY < 0) ? 0 : newY,
  };
}

/**
  * Save selection and exit crop mode.
  */
function cropModeSave() {
  // Calculate the original size of the selection
  const prevSelection = peek(croppingStack);
  const canvasRect = $('canvas-screenshot').getBoundingClientRect();
  const selection = {
    x: $('selection').offsetLeft - canvasRect.left,
    y: $('selection').offsetTop - canvasRect.top,
    w: $('selection').offsetWidth,
    h: $('selection').offsetHeight
  };

  const scale = getDisplayScale();
  const newPos = getOriginalCoordinates(selection.x, selection.y);

  croppingStack.push({
    x: (newPos.x < 0) ? 0 : newPos.x,
    y: (newPos.y < 0) ? 0 : newPos.y,
    w: selection.w / scale,
    h: selection.h / scale
  });

  userActionStack.push(actionLabel.crop);

  chrome.metricsPrivate.recordEnumerationValue(
            'Microsoft.Feedback.SendFeedback',
            FEEDBACK_STATUS_SCREENSHOT_CROPPED,
            FEEDBACK_STATUS_MAX);

  // Show the cropped portion
  refreshCanvas(false);

  // Completion of cropping clears the redo stack
  redoStack = [];

  exitCropMode();
}

/**
  * Handle Undo or Redo action.
  * @param {MouseEvent} e click event on undo or redo button.
  */
function handleUndoRedoAction(e) {
  let action;

  if (e.currentTarget === $('undo-button')) {
    // Undo clicked
    action = userActionStack.pop();
    if (action == actionLabel.crop) {
      // Crop action
      redoStack.push([action, croppingStack.pop()]);
    } else {
      // Pen action
      redoStack.push([action, penStack.pop()]);
      canvasObj.isCanvasDirty = true;
    }
  } else {
    // Redo clicked
    action = redoStack.pop();
    userActionStack.push(action[0]);
    if (action[0] == actionLabel.crop) {
      // Crop action
      croppingStack.push(action[1]);
    } else {
      // Pen action
      penStack.push(action[1]);
      canvasObj.isCanvasDirty = true;
    }
  }

  updateUndoRedoButtonState();

  // Toggle focus between the two if one is empty.
  const undoActive = (userActionStack.length > 0);
  const redoActive = (redoStack.length > 0);
  if (undoActive && !redoActive) {
    $('undo-button').focus();
  } else if (!undoActive && redoActive) {
    $('redo-button').focus();
  }

  refreshCanvas(true);
}

/**
  * Save the canvas and close the editor.
  */
function saveAndClose() {
  canvasObj.isSavingChanges = true;

  // Save the current selection if it's in crop mode before closing
  if (canvasObj.cropMode) {
    // Save the current selection on display
    cropModeSave();
    exitCropMode();
  }

  // To prepare the export of the final canvas,
  // set the canvas to the true dimension of the latest selection
  const selection = peek(croppingStack);

  $('canvas-screenshot').width = selection.w;
  $('canvas-screenshot').height = selection.h;

  // Update the canvas and close
  refreshCanvas(true);
  scheduleWindowClose();
}

/**
  * Enable / Disable the Undo and Redo buttons depending on their size.
  */
function updateUndoRedoButtonState() {
  if (userActionStack.length > 0) {
    $('undo-button').removeAttribute('disabled');
  } else {
    $('undo-button').setAttribute('disabled', '');
  }

  if (redoStack.length > 0) {
    $('redo-button').removeAttribute('disabled');
  } else {
    $('redo-button').setAttribute('disabled', '');
  }
}

/**
  * Exit crop mode.
  */
function exitCropMode() {
  canvasObj.cropMode = false;
  refreshCanvas(false);
  $('selection').style.visibility = 'hidden';

  // Enabled save button and put back tab index for top buttons
  $('save-button').disabled = false;
  $('maximize-button').tabIndex = 0;
  $('close-button').tabIndex = 0;

  refreshToolbar();
  $('crop-button').focus();
}

/**
  * Exit pen mode.
  */
function exitPenMode() {
  canvasObj.penMode = false;

  if (isPenPanelOpen) {
    closePenPanel();
  }

  // Remove handlers for pen mode.
  $('canvas-screenshot').removeEventListener('mousedown', initDrawing);
  $('canvas-screenshot').removeEventListener('mousemove', startDrawing);
  $('canvas-screenshot').removeEventListener('touchstart', initDrawing);
  $('canvas-screenshot').removeEventListener('touchmove', startDrawing);

  const cancelEvents = ['mouseleave', 'mouseup', 'touchend', 'touchcancel'];
  cancelEvents.forEach(function(eventName) {
    $('canvas-screenshot').removeEventListener(eventName, finishDrawing);
  });

  // Reset cursor and tool bar
  $('canvas-screenshot').style.cursor = 'auto';
  refreshToolbar();
}

/**
  * Set up resizing events for the selection grid.
  * @param {MouseEvent or TouchEvent} e mousedown or touchstart event in canvas.
  */
function setupResize(e) {
  if (e.cancelable) {
    e.preventDefault();
  }

  // Set up parameters needed for resizing
  this.focus();
  const curResizer = this;
  const isTouch = (e.type === 'touchstart');
  const curPos = {
    x: (isTouch ? e.changedTouches[0].pageX : e.pageX),
    y: (isTouch ? e.changedTouches[0].pageY : e.pageY)
  };
  const curSelection = {
    x: $('selection').offsetLeft,
    y: $('selection').offsetTop,
    w: $('selection').offsetWidth,
    h: $('selection').offsetHeight
  };

  // Resize the selection grid according to resizer's new position
  function startResizing(e) {
    const newPos = {
      x: (isTouch ? e.changedTouches[0].pageX : e.pageX),
      y: (isTouch ? e.changedTouches[0].pageY : e.pageY)
    };
    resizeSelection(curResizer, newPos, curSelection, curPos);
    greyOutUnselectedArea();
  }

  // Remove resizing handlers
  const startEvents = ['mousemove', 'touchmove'];
  const cancelEvents = ['mouseleave', 'mouseup', 'touchend', 'touchcancel'];
  function removeResizeHandler() {
    startEvents.forEach(function(eventName) {
      $('canvas-container').removeEventListener(eventName, startResizing);
    });

    cancelEvents.forEach(function(eventName) {
      $('canvas-container').removeEventListener(eventName, removeResizeHandler);
    });
  }

  // Listen for events that initiate resizing
  startEvents.forEach(function(eventName) {
    $('canvas-container').addEventListener(eventName, startResizing);
  });

  // Listen for events that cancel resizing
  cancelEvents.forEach(function(eventName) {
    $('canvas-container').addEventListener(eventName, removeResizeHandler);
  });
}

/**
  * Enable the arrow keys to move the resizers so a canvas selection can be made.
  * @param {KeyboardEvent} a keydown event within canvas.
  */
function setupArrowKeys(e) {
  if (e.keyCode >= 37 && e.keyCode <= 40) {
    e.preventDefault();

    const curSelection = {
      x: $('selection').offsetLeft,
      y: $('selection').offsetTop,
      w: $('selection').offsetWidth,
      h: $('selection').offsetHeight
    };

    const delta = 15;
    let curPos; // current position of the active resizer
    if (this.classList.contains('bottom-right')) {
      curPos = {
        x: curSelection.x + curSelection.w,
        y: curSelection.y + curSelection.h
      };
    } else if (this.classList.contains('bottom-left')) {
      curPos = {
        x: curSelection.x,
        y: curSelection.y + curSelection.h
      };
    } else if (this.classList.contains('top-right')) {
      curPos = {
        x: curSelection.x + curSelection.w,
        y: curSelection.y
      };
    } else {  // Top left
      curPos = {
        x: curSelection.x,
        y: curSelection.y
      };
    }

    const newPos = { x: curPos.x, y: curPos.y };
    if (e.keyCode === 37) { // Left arrow
      newPos.x -= delta;
    } else if (e.keyCode === 38) { // Up arrow
      newPos.y -= delta;
    } else if (e.keyCode === 39) { // Right arrow
      newPos.x += delta;
    } else if (e.keyCode === 40) { // Down arrow
      newPos.y += delta;
    }

    resizeSelection(this, newPos, curSelection, curPos);
    greyOutUnselectedArea();
  }
}

/**
  * Grey out canvas except cropping selection.
  * This draws 4 grey rectangles around the selection with alpha.
  */
function greyOutUnselectedArea() {
  const canvasContext = $('canvas-screenshot').getContext('2d');
  const canvasRect = $('canvas-screenshot').getBoundingClientRect();
  const selectionRect = $('selection').getBoundingClientRect();
  const canvasMargin = getCanvasMargin();

  // Outer and inner boundaries of grey area
  const outerBox = {
    h: canvasRect.height - canvasMargin.h * 2,
    w: canvasRect.width - canvasMargin.w * 2,
    x: canvasMargin.w,
    y: canvasMargin.h
  };
  const innerBox = {
    x: Math.round(selectionRect.left - canvasRect.left + 4),
    y: Math.round(selectionRect.top - canvasRect.top + 4),
    w: Math.round(selectionRect.width - 8),
    h: Math.round(selectionRect.height - 8)
  };

  // Clear existing grey area
  refreshCanvas(false);

  // Draw the 4 rects in the order of Top - Left - Right - Bottom
  canvasContext.fillStyle = 'rgba(0, 0, 0, 0.6)';
  canvasContext.fillRect(outerBox.x, outerBox.y, outerBox.w,
                         innerBox.y - outerBox.y);
  canvasContext.fillRect(innerBox.x, innerBox.y,
                         -(innerBox.x - outerBox.x), innerBox.h);
  canvasContext.fillRect(innerBox.x + innerBox.w, innerBox.y,
    canvasRect.width - (innerBox.x + innerBox.w) - canvasMargin.w,
                                                 innerBox.h);
  canvasContext.fillRect(outerBox.x, innerBox.y + innerBox.h, outerBox.w,
    canvasRect.height - (innerBox.y + innerBox.h) - canvasMargin.h);
}

/**
  * Return the scale value at which the original screenshot
  * is currently displayed on canvas.
  * @return {Number} between 0 and 1.
  */
function getDisplayScale() {
  const selection = peek(croppingStack);
  return Math.min($('canvas-screenshot').width / selection.w,
                  $('canvas-screenshot').height / selection.h);
}

/**
  * Return width and height margin calculation of canvas
  * which is used to mimic 'background-size: contain' for canvas.
  * @return {Object} containing w and h margins on canvas.
  */
function getCanvasMargin() {
  const selection = peek(croppingStack);
  const scale = getDisplayScale();
  return {
    w: ($('canvas-screenshot').width / 2) - (selection.w / 2) * scale,
    h: ($('canvas-screenshot').height / 2) - (selection.h / 2) * scale
  };
}

/**
  * Resize the canvas selection with the given |resizer|.
  * @param {Object} resizer The resizer that is currently dictating the selection.
  * @param {Object} newPos coordinates of the new position of |resizer|.
  * @param {Object} oldSelection dim of the current selection to be resized.
  * @param {Object} oldPos coordinates of the current position of |resizer|.
  */
function resizeSelection(resizer, newPos, oldSelection, oldPos) {
  // Safe check the coordinates
  newPos = getPosWithinImageBounds(newPos.x, newPos.y);
  const deltaX = newPos.x - oldPos.x;
  const deltaY = newPos.y - oldPos.y;
  const minChange = 2;

  // If the change is too small then don't do anything
  if (Math.abs(deltaX) < minChange && Math.abs(deltaY) < minChange) {
    return;
  }

  let newWidth = oldSelection.w;
  let newHeight = oldSelection.h;
  const minSize = 20; // Min selection wil be 20x20

  if (resizer.classList.contains('bottom-right')) {
    // Change in width and height
    newWidth += deltaX;
    newHeight += deltaY;
  } else if (resizer.classList.contains('bottom-left')) {
    // Change in left, width, and height
    newWidth -= deltaX;
    newHeight += deltaY;
    $('selection').style.left = oldSelection.x +
      (newWidth > minSize ? deltaX : oldSelection.w - minSize) + 'px';
  } else if (resizer.classList.contains('top-right')) {
    // Change in top, width, height
    newWidth += deltaX;
    newHeight -= deltaY;
    $('selection').style.top = oldSelection.y +
      (newHeight > minSize ? deltaY : oldSelection.h - minSize) + 'px';
  } else { // Top-left
    // Change in left, top, width, and height
    newWidth -= deltaX;
    newHeight -= deltaY;
    $('selection').style.left = oldSelection.x +
      (newWidth > minSize ? deltaX : oldSelection.w - minSize) + 'px';
    $('selection').style.top = oldSelection.y +
      (newHeight > minSize ? deltaY : oldSelection.h - minSize) + 'px';
  }
  $('selection').style.width =
                (newWidth > minSize ? newWidth : minSize) + 'px';
  $('selection').style.height =
                (newHeight > minSize ? newHeight : minSize) + 'px';
}

/**
  * Adjust the x, y coordinates if necessary and
  * make sure they are within the visible image, not the canvas bounds.
  * @param {Number} posX The x coordinate of a point
  * @param {Number} posY The y coordinate of a point
  * @return {Object} Array containing x, and y of a point within canvas.
  */
function getPosWithinImageBounds(posX, posY) {
  const canvasRect = $('canvas-screenshot').getBoundingClientRect();
  const canvasMargin = getCanvasMargin();
  let resX, resY;

  // Check if x is within the boundary
  if (posX < canvasRect.left + canvasMargin.w) {
    resX = canvasRect.left + canvasMargin.w;
  } else if (posX > canvasRect.left + canvasRect.width - canvasMargin.w) {
    resX = canvasRect.left + canvasRect.width - canvasMargin.w;
  } else {
    resX = posX;
  }

  // Check if y is within the boundary
  if (posY < canvasRect.top + canvasMargin.h) {
    resY = canvasRect.top + canvasMargin.h;
  } else if (posY > canvasRect.top + canvasRect.height - canvasMargin.h) {
    resY = canvasRect.top + canvasRect.height - canvasMargin.h;
  } else {
    resY = posY;
  }
  return { x: resX, y: resY };
}

/**
  * Fetch the first element of |stackArray|.
  * @param {Object} stackArray a stack array.
  * @return {Object} a stack array element.
  */
function peek(stackArray) {
  return (stackArray.length > 0) ? stackArray[stackArray.length - 1] : null;
}

/**
  * Display the selection grid for cropping mode.
  */
function displayCroppingGrid() {
  const canvasRect = $('canvas-screenshot').getBoundingClientRect();
  const selection = peek(croppingStack);
  const scale = getDisplayScale();
  const canvasMargin = getCanvasMargin();
  const selectMarginWidth =
    ((canvasRect.width - canvasMargin.w * 2) -
    (selection.w * scale)) / 2;
  const selectMarginHeight =
    ((canvasRect.height - canvasMargin.h * 2) -
    (selection.h * scale)) / 2;

  $('selection').style.left =
    (canvasRect.left + canvasMargin.w + selectMarginWidth) + 'px';
  $('selection').style.top =
    (canvasRect.top + canvasMargin.h + selectMarginHeight) + 'px';
  $('selection').style.width = (selection.w * scale) + 'px';
  $('selection').style.height = (selection.h * scale) + 'px';
  $('selection').style.visibility = 'visible';
}

/**
  * Update |flattenedScreenshotImage| with a full size
  * screenshot image with current drawings.
  */
function flattenScreenshotImage() {
  canvasObj.isCanvasDirty = false;

  // If no pen actions then nothing to flatten
  if (penStack.length == 0) {
    flattenedScreenshotImage.src = originalScreenshotImage.src;
    return;
  }

  const tempCanvas = document.createElement('canvas');
  const canvasContext = tempCanvas.getContext('2d');
  canvasContext.lineJoin = canvasContext.lineCap = 'round';

  // Set the canvas to the true dimension of the original screenshot
  // so that |flattenedScreenshotImage| is the same dimension as
  // |originalScreenshotImage|
  const selection = croppingStack[0];
  tempCanvas.width = selection.w;
  tempCanvas.height = selection.h;

  canvasContext.drawImage(originalScreenshotImage, 0, 0);

  // Place pen strokes.
  for (let i = 0; i < penStack.length; i++) {
    const path = penStack[i].path;
    for (let j = 0; j < path.length - 1; j++) {
      const A = {
        x: path[j].x,
        y: path[j].y
      };
      const B = {
        x: path[j + 1].x,
        y: path[j + 1].y
      };

      drawLine(canvasContext, A, B, penStack[i].color,
                              penStack[i].size, false);
    }
  }

  // Export the canvas as an image and use it
  // to update | flattenedScreenshotImage|
  tempCanvas.toBlob(function(blob) {
    // this will trigger |flattenedScreenshotImage|'s
    // onload event handler, continueCanvasAction()
    flattenedScreenshotImage.src = URL.createObjectURL(blob);
  });
}

/**
  * Update canvas using the latest crop selection.
  * @param {Boolean} useOriginal indicates whether to refresh with
  * |originalScreenshotImage| or |flattenedScreenshotImage|.
  */
function refreshCanvas(useOriginal) {
  const img = useOriginal ? originalScreenshotImage : flattenedScreenshotImage;
  const canvasContext = $('canvas-screenshot').getContext('2d');
  const selection = peek(croppingStack);
  const scale = getDisplayScale();
  const canvasMargin = getCanvasMargin();

  canvasContext.clearRect(0, 0,
                          $('canvas-screenshot').width,
                          $('canvas-screenshot').height);
  canvasContext.drawImage(img,
              selection.x, selection.y,
              selection.w, selection.h,
              canvasMargin.w, canvasMargin.h,
              selection.w * scale,
              selection.h * scale);

  // If we are using |originalScreenshotImage| to refresh,
  // put back any pen strokes. Otherwise we are just refreshing the canvas
  // with |flattenedScreenshotImage| with already has pen strokes.
  if (useOriginal) {
    for (let i = 0; i < penStack.length; i++) {
      const scaledPath = penStack[i].path.map(function(point) {
        return {
          x: canvasMargin.w + point.x * scale - selection.x * scale,
          y: canvasMargin.h + point.y * scale - selection.y * scale
        };
      });
      for (let j = 0; j < scaledPath.length - 1; j++) {
        const A = {
          x: scaledPath[j].x,
          y: scaledPath[j].y
        };
        const B = {
          x: scaledPath[j + 1].x,
          y: scaledPath[j + 1].y
        };

        drawLine(canvasContext, A, B, penStack[i].color,
                        penStack[i].size * scale, false);
      }
    }
    // Draw margin areas to cover any drawings outside image
    // This happens when user crops part of a pen stroke
    canvasContext.fillStyle = getComputedStyle($('canvas-container')
                ).getPropertyValue('background-color'); // ex: rgb(0, 0, 0);
    if (canvasMargin.w > 0) {
      canvasContext.fillRect(0, 0,
                             canvasMargin.w, $('canvas-screenshot').height);
      canvasContext.fillRect(canvasMargin.w + selection.w * scale, 0,
                             canvasMargin.w, $('canvas-screenshot').height);
    }
    if (canvasMargin.h > 0) {
      canvasContext.fillRect(0, 0,
                             $('canvas-screenshot').width, canvasMargin.h);
      canvasContext.fillRect(0, canvasMargin.h + selection.h * scale,
                             $('canvas-screenshot').width, canvasMargin.h);
    }
  }
}

/*
 * Set canvas width and height (pixel dimension) to its css dimension.
 */
function setCanvasSize(canvasElem) {
  const canvasContainerStyle = getComputedStyle(canvasElem);
  canvasElem.width =
          parseInt(canvasContainerStyle.getPropertyValue('width'));
  canvasElem.height =
         parseInt(canvasContainerStyle.getPropertyValue('height'));
}

/**
  * Resize the canvas and refresh image to fit the new canvas.
  */
function resizeCanvas() {
  // Exit any active mode before resizing
  if (canvasObj.cropMode){
    exitCropMode();
  }
  if (canvasObj.penMode) {
    exitPenMode();
  }

  setCanvasSize($('canvas-container'));

  const canvasContainerStyle = getComputedStyle($('canvas-container'));
  $('canvas-screenshot').width =
          parseInt(canvasContainerStyle.getPropertyValue('width'));
  $('canvas-screenshot').height =
          parseInt(canvasContainerStyle.getPropertyValue('height'));

  if (canvasObj.isCanvasDirty) {
    // Update the canvas before refresh. Hold any refresh until then.
    // This happens only for the first resize event with dirty canvas.
    canvasObj.isResizeOnHold = true;
    flattenScreenshotImage(); // Will refresh onload.
    return;
  }

  // Refresh using the flattened image
  if (!canvasObj.isResizeOnHold) {
    refreshCanvas(false);
  }
}

/*
  * Direct to refresh and other canvas actions that were
  * put on hold untill |flattenedScreenshotImage| is ready.
  */
function continueCanvasAction() {
  // Refresh using the flattened image
  refreshCanvas(false);

  if (canvasObj.cropMode) {
    // Enter crop mode to continue enterEditMode()
    enterCropMode();
  }

  if (canvasObj.isResizeOnHold) {
    // Allow resize to happen without hold in resizeCanvas().
    canvasObj.isResizeOnHold = false;
  }
}

/**
  * Initializes the page when the window is loaded.
  */
function initializeScreenshotEditor() {
  loadTimeData = getLoadTimeData();
  i18nTemplate.process(document, loadTimeData);

  // Swap redo undo icons for RTL languages
  if (loadTimeData.data_.textdirection == 'rtl') {
    $('undo-icon').classList.remove('undo-icn');
    $('undo-icon').classList.add('redo-icn');
    $('redo-icon').classList.remove('redo-icn');
    $('redo-icon').classList.add('undo-icn');
  }

  flattenedScreenshotImage.onload = continueCanvasAction;

  originalScreenshotImage.onload = function() {
    croppingStack = [{
      x: 0,
      y: 0,
      w: originalScreenshotImage.width,
      h: originalScreenshotImage.height
    }];

    flattenedScreenshotImage.src = originalScreenshotImage.src;

    // Set up the canvas now that image is ready
    refreshToolbar();
    resizeCanvas();
    setupHandlers();
  };

  originalScreenshotImage.src = window.originalScreenshot();

  // If we don't wait after setting page title (via i18nTemplate.process),
  // screen reader reads out window document as blank/unknown.
  // Hence we are introducing a small delay before displaying window.
  setTimeout(function() {
    resizeAppWindow();
    chrome.app.window.current().show();
  }, 25);
}

  window.addEventListener('DOMContentLoaded', initializeScreenshotEditor);
  window.addEventListener('resize', resizeCanvas);
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
* Set up event handlers for screenshot thumbnail for modal experience
*/
function setUpHandlersForScreenshotModal() {
  // Trigger modal when clicked.
  $('image-thumbnail-container').addEventListener("click",
                                                  setUpScreenshotModal);

  // Display or update the cursor box.
  $('image-thumbnail-container').addEventListener("mouseenter",
                                                  displayCursorBox);
  $('image-thumbnail-container').addEventListener("mousemove",
                                                  displayCursorBox);

  // Enable the arrow keys and the enter key.
  $('image-thumbnail-container').addEventListener("keydown",
                                                  enableKeysOnScreenshot);

  // Display the cursor box when focused.
  $('image-thumbnail-container').addEventListener("focus", function () {
    $('cursor-box').style.display = "block";
  });

  // Remove the cursor box when not focused.
  $('image-thumbnail-container').addEventListener("blur", function () {
    $('cursor-box').style.display = "none";
  });

  // Remove the cursor box when the cursor is out of the container.
  // This mouse event switches between the cursorbox and the container,
  // so prevent the switching of the focus between the two.
  $('image-thumbnail-container').addEventListener("mouseout", function (e) {
    const event = e.toElement || e.relatedTarget;

    if (event && (event.parentNode == this || event == this)) {
      return;
    }

    $('cursor-box').style.display = "none";
  });
}

/**
* Set up launch and shutdown of screenshot modal
*/
function setUpScreenshotModal() {
  if ($('cursor-box').style.display == "none") {
    // No action taken when user clicks within
    // the container but outside the displayed image.
    return;
  }

  $('modal-image').style.backgroundImage =
    "url('" + $('screenshot-image').src + "')";

  $('screenshot-modal').style.display = "block";

  const zoom = ($('modal-image').offsetHeight
                / $('cursor-box').offsetHeight);

  $('modal-image').style.backgroundSize =
    ($('screenshot-image').width * zoom) + "px " +
    ($('screenshot-image').height * zoom) + "px";

  // Set the modal image correspond to the top left corner of the cursor box.
  $('modal-image').style.backgroundPosition =
    "-" + $('cursor-box').offsetLeft * zoom + "px -" +
    $('cursor-box').offsetTop * zoom + "px";

  $('screenshot-modal').focus();

  // Any tabbing within the modal results in the focus on the close button.
  $('back-button').addEventListener("blur", function() {
    $('back-button').focus();
  });

  // Enter or Space key press on back-button should close the modal.
  $('back-button').addEventListener('keypress', function(e) {
    // if Enter or Space key is pressed
    if (e.keyCode == 13 || e.keyCode == 32) {
      closeModal();
    }
  });

  $('screenshot-modal').addEventListener("click", closeModal);

  $('screenshot-modal').addEventListener("keyup", function (e) {
    if (e.keyCode === 27) { // Esc key
      closeModal();
    }
  });
}

/**
 * Close screenshot modal.
 */
function closeModal() {
  $('screenshot-modal').style.display = "none";
  $('image-thumbnail-container').focus();
}

/**
 * Calulate the movement of the cursor box according to pressed arrow keys
 * and allow the enter key to click on the thumbnail screenshot.
 * @param {function(KeyboardEvent)} a keydown event 
 *                                  within screenshot thumbnail.
 */
function enableKeysOnScreenshot(e) {
  const delta = 10;
  let pos;

  if (e.keyCode === 37 || e.keyCode === 38 ||
      e.keyCode === 39 || e.keyCode === 40) {
    // If one of the four arrow keys are pressed
    // then prevent the scroll bar from moving
    e.preventDefault();
  }

  if (e.keyCode === 13) { // Enter key
    $('image-thumbnail-container').click();
  } else if (e.keyCode === 37) { //Left arrow
    pos = $('cursor-box').offsetLeft - delta;
    if (pos < delta) {
      pos = 0;
    }
    $('cursor-box').style.left = pos + "px";
  } else if (e.keyCode === 38) { //Up arrow
    pos = $('cursor-box').offsetTop - delta;
    if (pos < delta) {
      pos = 0;
    }
    $('cursor-box').style.top = pos + "px";
  } else if (e.keyCode === 39) { //Right arrow
    pos = $('cursor-box').offsetLeft + delta;
    if (pos > $('screenshot-image').offsetWidth -
              $('cursor-box').offsetWidth) {
      pos = $('screenshot-image').offsetWidth -
            $('cursor-box').offsetWidth;
    }
    $('cursor-box').style.left = pos + "px";
  } else if (e.keyCode === 40) { //Down arrow
    pos = $('cursor-box').offsetTop + delta;
    if (pos > $('screenshot-image').offsetHeight -
              $('cursor-box').offsetHeight) {
      pos = $('screenshot-image').offsetHeight -
            $('cursor-box').offsetHeight;
    }
    $('cursor-box').style.top = pos + "px";
  }
}

/**
 * Calculate the position of cursor box relative to screenshot image
 * such that the box stays within the image and is centered around cursor.
 * @param {function(MouseEvent)} a mouseenter or mousemove event 
 *                               within screenshot thumbnail.
 */
function getCursorBoxPostion(e) {
  const rect = $('image-thumbnail-container').getBoundingClientRect();
  let x = e.pageX - rect.left;
  let y = e.pageY - rect.top;

  if (x > $('screenshot-image').offsetWidth -
          $('cursor-box').offsetWidth / 2) {
    // Near the rightmost
    x = $('screenshot-image').offsetWidth - $('cursor-box').offsetWidth;
  } else if (x < $('cursor-box').offsetWidth / 2) {
    // Near the leftmost
    x = 0;
  } else {
    // Use the current x but center the box.
    x -= $('cursor-box').offsetWidth / 2;
  }

  if (y > $('screenshot-image').offsetHeight -
          $('cursor-box').offsetHeight / 2) {
    // Near the bottom
    y = $('screenshot-image').offsetHeight - $('cursor-box').offsetHeight;
  } else if (y < $('cursor-box').offsetHeight / 2) {
    // Near the top
    y = 0;
  } else {
    // Use the current y but center the box.
    y -= $('cursor-box').offsetHeight / 2;
  }

  return { x: x, y: y };
}

/**
 * Display the cursorbox and hide it when cursor is visually out of the image
 * @param {function(MouseEvent)} a mouseenter or mousemove event
 *                               within screenshot thumbnail.
 */
function displayCursorBox(e) {
  e.preventDefault();
  $('cursor-box').style.display = "block";
  const boxPosition = getCursorBoxPostion(e);

  $('cursor-box').style.left = boxPosition.x + "px";
  $('cursor-box').style.top = boxPosition.y + "px";

  if (e.pageX >= $('screenshot-image').offsetWidth +
    $('image-thumbnail-container').offsetLeft) {
    // Hide the box when cursor is to the right in the image container,
    // but outside the image. This happens with a single monitor screenshot
    $('cursor-box').style.display = "none";
  }
}// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Show the dialog after the content has been loaded.
 */
function showDialog() {

  // we need to populate few fields to support localization
  document.documentElement.setAttribute("dir", getHtmlDir());
  document.documentElement.setAttribute("lang", getHtmlLang());
  $('page-title').textContent = getTitle();
  $('head-title').textContent = $('page-title').textContent;
  $('close-button').setAttribute("aria-label", getCloseButtonAriaLabel());

  // show the log content inside the window
  $('log-content').textContent = getLog();

  // If we don't wait after applying i18nTemplate process to document,
  // screen reader reads out 'system info' window document as blank/unknown.
  // Hence we are introducing a small delay before displaying window.
  setTimeout(function() {
    chrome.app.window.current().show();
  }, 25);
}

/**
 * Initializes the page when the window is loaded.
 */
window.addEventListener('DOMContentLoaded', function() {
  showDialog();
});
// Copyright 2015 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * The global load time data that contains the localized strings that we will
 * get from the main page when this page first loads.
 */
let loadTimeData = null;

/**
 * Max individual file size allowed to be uploaded via file attach
 */
const MAX_ATTACH_FILE_SIZE = 25 * 1024 * 1024;

/**
 * Max number of files allowed to be uploaded via file attach
 */
const MAX_FILE_COUNT = 5;

// net export trace's key name
const NET_EXPORT_KEY_NAME = 'net_export_watson_file';

/**
 * Starts repro mode trace capture
 */
function startTracing() {
  // indicate c++ code to start capture
  chrome.edgeFeedbackPrivate.toggleNetExportCapture((trace) => {
    if (!trace) {
      // TODO: No trace error message
    } else {
      if (trace.includes('Net Log Initializing...')) {
        // call startTracing unless we see 'Net Log Starting...' message
        startTracing();
      } else if (trace.includes('Net Log Starting...')) {
        // now inform main feedback dialog that recording has started so that
        // feedback dialog can stop recording
        // if this diag data dialog is closed unexpectedly
        window.recordingStarted();
      } else if (trace.includes('[Net export Log complete] Saved to:')) {
        // call startTracing to initiate trace again
        startTracing();
      }
    }
  });
}

/**
 * Stops repro mode trace capture
 */
function stopTracing() {
  // inform feedback dialog that recording stopped
  window.recordingStopped();
  // disable stop button
  $('stop-recording-button').disabled = true;

  // inform c++ code to stop recording
  chrome.edgeFeedbackPrivate.toggleNetExportCapture((trace) => {
    if (!trace) {
      // TODO: No trace error message
    } else {
      const traceSavedTemplateMsg = '[Net export Log complete] Saved to: ';
      if (trace.includes(traceSavedTemplateMsg)) {
        // show link to open captured trace
        $('net-export').removeAttribute('hidden');
        // set the path of the net export link to the file location
        $('net-export-text-link').filepath =
                              trace.substring(traceSavedTemplateMsg.length);
        showReproModeTraceList();
      }
    }

    // show start recording button and hide stop recording button
    $('start-recording-button').removeAttribute('hidden');
    $('start-recording-button').disabled = true;
    $('stop-recording-button').setAttribute('hidden', '');
    // remove disabled from stop button
    $('stop-recording-button').removeAttribute('disabled');
  });
}

/**
 * Show file content in a new pop-up dialog
 */
function viewLogFile() {
  event.preventDefault();
  const target = event.target;
  // the file's location is saved in link's filepath property
  // so see if the link contains filepath and use it to launch
  // the file using file:// protocol
  if (target.filepath && target.filepath.length > 0) {
    let logFileLocation = target.filepath;
    if (!logFileLocation) {
      return;
    }
    logFileLocation = 'file:///' + logFileLocation;
    chrome.app.window.create(logFileLocation, {
      innerBounds: { width: 1000, height: 1000 }
    });
  }
}

/**
 * Returns the element on which next focus should go
 * after keypress is done on remove file link
 */
function nextFocusElement(removeLink) {
  const span = removeLink && removeLink.parentNode;
  const li = span && span.parentNode;
  if (li) {
    if (!li.nextElementSibling) {
      // if no next sibling LI element then put the focus on to the save button
      return $('save-button');
    } else {
      if (li.parentElement.id == 'file-upload-list') {
        // for file remove from file-upload-list,
        // put the focus on next LI's remove file button
        return li.nextElementSibling.getElementsByClassName('remove-file')[0];
      } else if(li.parentElement.id == 'advance-trace-list') {
        // for file remove from advance-trace-list,
        // put the focus on next LI's label hyperlink
        return li.nextElementSibling.querySelector('span[class=\'label\']')
                                                .getElementsByTagName('a')[0];
      }
    }
  }
  return null;
}

/**
 * Only for keyboard events, sets focus to next element
 * after keyboard click event happend on remove file link
 */
function fixRemoveFileKeyboardFocus() {
  if (event && event.detail == 0) {
    // this means this is a keyboard click event
    // so we need to put focus on next item after this element is removed
    const element = nextFocusElement(event.target);
    element && element.focus();
  }
}

/**
 * Removes net export trace when clicked on corresponding remove link
 */
function removeNetExportFile() {
  // fix tab focus if this is a keyboard event
  fixRemoveFileKeyboardFocus();
  removeNetExport();

  if (isReproModeTraceListEmpty()) {
    enableStartRecordingButton();
    hideReproModeTraceList();
  }
}

/**
 * If any of the trace list item is not hidden then return false
 */
function isReproModeTraceListEmpty() {
  const reproModeTraceList = $('advance-trace-list')
                                      .children;
  for (let i = 0 ; i < reproModeTraceList.length; i++) {
    const li = reproModeTraceList[i];
    if (li.getAttribute('hidden') == null) {
      return false;
    }
  }
  return true;
}

/**
 * show start recording button if trace list is empty
 */
function enableStartRecordingButton() {
  $('start-recording-button').removeAttribute('disabled');
}

/**
 * show repro mode trace list
 */
function showReproModeTraceList() {
  $('advance-trace-list').removeAttribute('hidden');
}

/**
 * Hide repro mode trace list
 */
function hideReproModeTraceList() {
  $('advance-trace-list').setAttribute('hidden', 'true');
}

/**
 * Removes net export trace from saved list
 * as well as hides it's li item from html
 */
function removeNetExport() {
  $('net-export').setAttribute('hidden', '');
  // inform main feedback dialog that net export trace is removed
  // so that it can remove it from saved list
  window.disableTraceInReproModeTraceList(NET_EXPORT_KEY_NAME);
}

/**
 * Repro mode checkbox checked/unchecked event
 * if checked then enable start recording button
 * else if unchecked then disable start button
 *                        and remove any previously captured trace
 */
function reproModeConstentChange() {
  if ($('repro-mode-consent-checkbox').checked) {
    $('start-recording-button').removeAttribute('disabled');
  } else {
    $('start-recording-button').disabled = true;
    removeNetExport();
  }
}

/**
 * Event handler corresponding to start button click
 */
function startRecording() {
  // disable agree checkbox when recording is started but not stopped
  $('repro-mode-consent-checkbox').disabled = true;
  // hide the previously captured trace
  removeNetExport();
  // show stop button and hide start button
  $('start-recording-button').setAttribute('hidden', '');
  $('stop-recording-button').removeAttribute('hidden');
  // put focus on stop recording button if start button was clicked by keyboard
  if (event && event.detail == 0) {
    $('stop-recording-button').focus();
  }
  startTracing();
}

/**
 * Event handler corresponding to stop button click
 */
function stopRecording() {
  $('repro-mode-consent-checkbox').removeAttribute('disabled');
  stopTracing();
}

/**
 * Register event handler for repro mode pane
 */
function registerReproModeEvents() {
  $('start-recording-button').addEventListener('click', startRecording);
  $('stop-recording-button').addEventListener('click', stopRecording);
  $('net-export-text-link').addEventListener('click', viewLogFile);
  $('net-export-remove-link').addEventListener('click', removeNetExportFile);
  $('repro-mode-consent-checkbox').addEventListener('change',
                                                      reproModeConstentChange);
}

/**
 * One of the nav section item should have tabindex=0,
 * find that nav item and return it.
 */
function getActiveTabIndexNavItem() {
  const navItems = $('nav-section').children;
  for (let i = 0 ; i < navItems.length; i++) {
    if (navItems[i].getAttribute('tabindex') == '0') {
     return navItems[i];
    }
  }
  return null;
}

/**
 * set tab index for all nav items to -1
 */
function resetTabIndexForNavItems() {
  const navItems = $('nav-section').children;
  for (let i = 0 ; i < navItems.length; i++) {
    navItems[i].setAttribute('tabindex', "-1");
  }
}

/**
 * Allow traversal through nav section tree view items
 * using up and down arrow keys
 */
function navSectionArrowKeyEventHandler() {
  // 37 - left arrow key
  // 38 - up arrow key
  // 39 - right arrow key
  // 40 - down arrow key
  // return if it is not left or up or right or down arrow key
  if (!(event.keyCode >= 37 && event.keyCode <=  40)) {
    return;
  }

  // find the current nav item on which tabindex=0
  const activeTabIndexNavItem = getActiveTabIndexNavItem();
  if (!activeTabIndexNavItem) {
    return;
  }

  let navItem = null;
  if (event.keyCode == 37 || event.keyCode == 38) {
    // left / up arrow key pressed
    // if active tab index is on first nav item then allow circular movement
    //     to put tabindex and focus on to last nav item
    // else find previous nav item to put tabindex and focus
    if (activeTabIndexNavItem ==
                          activeTabIndexNavItem.parentNode.firstElementChild) {
      navItem = activeTabIndexNavItem.parentNode.lastElementChild;
    } else {
      navItem = activeTabIndexNavItem.previousElementSibling;
    }
  } else if (event.keyCode == 39 || event.keyCode == 40) {
    // right / down arrow key pressed
    // if active tab index is on last nav item then allow circular movement
    //     to put tabindex and focus on to first nav item
    // else find next nav item to put tabindex and focus
    if (activeTabIndexNavItem ==
                          activeTabIndexNavItem.parentNode.lastElementChild) {
      navItem = activeTabIndexNavItem.parentNode.firstElementChild;
    } else {
      navItem = activeTabIndexNavItem.nextElementSibling;
    }
  }

  if (navItem) {
    resetTabIndexForNavItems();
    navItem.setAttribute('tabindex', "0");
    navItem.focus();
  }
}

/**
 * Register event handler for left panel navigation items
 */
function registerNavButtonEvents() {
  // since nav-section is a treeview,
  // we need to use up and down arrow key to traverse through nav items
  $('nav-section').addEventListener('keydown', navSectionArrowKeyEventHandler);

  // Screen reader users can use up and down arrow keys
  // to traverse through the whole document.
  // When doing so, screen reader puts focus on
  // nav section treeview top level element i.e. $('nav-section').
  // When the screen reader puts focus on the treeview $('nav-section'),
  // we need to place that focus on to the nav item on which tabindex=0.
  $('nav-section').addEventListener('focus', () => {
    event.preventDefault();
    const activeTabIndexNavItem = getActiveTabIndexNavItem();
    activeTabIndexNavItem.focus();
  });

  $('diagnostic-data-button').addEventListener('click', () => {
    navButtonClicked($('diagnostic-data-button'));
  });
  $('advance-button').addEventListener('click', () => {
    navButtonClicked($('advance-button'));
  });
  $('files-upload-nav-button').addEventListener('click', () => {
    navButtonClicked($('files-upload-nav-button'));
  });
}

/**
 * Click event handler corresponding to nav item clicked
 * @param {Element} navItem - nav item element
 */
function navButtonClicked(navItem) {
  // Hide all panes
  $('sys-info-list-view').setAttribute('hidden', 'true');
  $('advance-trace-capture-view').setAttribute('hidden', 'true');
  $('file-upload-view').setAttribute('hidden', 'true');

  // remove active from nav item button
  $('diagnostic-data-button').classList.remove('active');
  $('advance-button').classList.remove('active');
  $('files-upload-nav-button').classList.remove('active');

  // reset aria-selected
  $('diagnostic-data-button').setAttribute('aria-selected', 'false');
  $('advance-button').setAttribute('aria-selected', 'false');
  $('files-upload-nav-button').setAttribute('aria-selected', 'false');

  // reset tabindex
  $('diagnostic-data-button').setAttribute('tabindex', '-1');
  $('advance-button').setAttribute('tabindex', '-1');
  $('files-upload-nav-button').setAttribute('tabindex', '-1');

  // Make the nav item which was clicked as active and selected
  navItem.classList.add('active');
  navItem.setAttribute('aria-selected', 'true');
  navItem.setAttribute('tabindex', '0');

  // Show pane corresponding to the nav item which was clicked
  if (navItem.id == 'diagnostic-data-button') {
    $('sys-info-list-view').removeAttribute('hidden');
  } else if (navItem.id == 'advance-button') {
    $('advance-trace-capture-view').removeAttribute('hidden');
  } else if (navItem.id == 'files-upload-nav-button') {
    $('file-upload-view').removeAttribute('hidden');
  }
}

/**
 * Retrives the previously saved captured traces
 * - adds them to the repro mode pane
 */
function showSavedCapturedTraces() {
  // check if any already captured trace is present
  const reproModeTraceList = window.getSavedTraceList();
  for (const item in reproModeTraceList) {
    if (reproModeTraceList[item]['enabled']) {

      // net-export trace was saved earlier, lets show it
      if (reproModeTraceList[item]['key'] == NET_EXPORT_KEY_NAME) {
        // set the path of the net export link to the file location
        $('net-export-text-link').filepath =
                                    reproModeTraceList[item]['value'];
        // show net-export link
        $('net-export').removeAttribute('hidden');
      }

      $('repro-mode-consent-checkbox').checked = true;
      reproModeConstentChange();

    }
  }

  if (!isReproModeTraceListEmpty()) {
    showReproModeTraceList();
  }
}

/**
 * Retrives the previously saved file uploads
 * - adds them to the file attach pane
 */
function showSavedUploadedFiles() {
  const savedFileList = window.getSavedFileList();
  for (const item in savedFileList) {
    createFileItem(savedFileList[item]['filename'],
                    savedFileList[item]['filepath']);
  }
}

/**
 * Checks if the file is already uploaded
 * @param {string} path full file path location
 */
function isFileDuplicate(path) {
  const files = $('file-upload-list').children;
  for (let i = 0 ; i < files.length; i++) {
    const file = files[i].getElementsByClassName('label')[0];
    if (file.filepath == path) {
      return true;
    }
  }
  return false;
}

/**
 * Creates li item for the file
 * @param {string} filename filename
 * @param {string} path full file path
 */
function createFileItem(filename, path) {
  // if file's location is already present in ul element (file-upload-list)
  // then don't add this duplicate file
  if (isFileDuplicate(path)) {
    return;
  }

  const li = document.createElement('li');

  // Create span for label
  const labelSpan = document.createElement('span');
  labelSpan.className = 'label';
  labelSpan.filename = filename;
  labelSpan.filepath = path;
  labelSpan.textContent = filename;
  li.appendChild(labelSpan);

  // create remove link to remove the file entry
  const spanForRemove = document.createElement('span');
  const removeLink = document.createElement('a');
  removeLink.setAttribute('role', 'button');
  removeLink.className = 'remove-file';
  removeLink.textContent = loadTimeData.getString('sysInfoRemoveFileLabel');
  removeLink.setAttribute('aria-label',
            loadTimeData.getString('sysInfoRemoveFileLabel') + ' ' + filename);
  removeLink.setAttribute('href', '#');
  removeLink.addEventListener('click', function() {
    window.removeFileFromSavedFileUploadList(path);
    // fix tab focus if this is a keyboard event
    fixRemoveFileKeyboardFocus();
    const span = this.parentNode;
    const li = span.parentNode;
    li.parentNode.removeChild(li);
  });
  spanForRemove.appendChild(removeLink);
  li.appendChild(spanForRemove);

  $('file-upload-list').appendChild(li);
}

/**
 * Returns true if file extension is not allowed
 * @param {string} filename
 */
function fileExtensionNotAllowed(filename) {
  // file ending with .cmd, .DLL,... etc. are not allowed
  // regex pattern - /\.(bat|cmd|com|dll|exe|js|jse|pdb|pl|ps|py|sh|vbs|wsf)$/i
  const pattern = new RegExp(['\\.(bat|cmd|com|dll|exe|js|jse|msc|pdb|pl|ps',
                              '|ps1|py|sh|vbs|wsf)$'].join(''), 'i');
  return pattern.test(filename);
}

/**
 * Show file attach error message
 */
function showFileAttachErrorMessage() {
  $('file-attach-error').classList.toggle('show', 'true');
}

/**
 * Hide file attach error message
 */
function hideFileAttachErrorMessage() {
  $('file-attach-error').classList.remove('show');
}

/**
 * Tries to add the file entry as LI element to file upload list
 */
async function addFileToUploadFileList(fileEntry) {
  return new Promise((resolve) => {
    // check file size and get the full file path
    fileEntry.file((file) => {
      if (file.size > MAX_ATTACH_FILE_SIZE) {
        showFileAttachErrorMessage();
        // resolve promise with empty string (path)
        resolve('');
      } else {
        // Get the file path using chrome.fileSystem.getDisplayPath.
        // This will resolve the promise and returns path
        chrome.fileSystem.getDisplayPath(fileEntry, resolve);
      }
    });
  }).then((path) => {
    if (path) {
      if ($('file-upload-list').children.length < MAX_FILE_COUNT) {
        // create li item for the file and add it to file-upload list
        createFileItem(fileEntry.name, path);
      } else {
        showFileAttachErrorMessage();
      }
    }
  });
}

/**
 * Traverses through all the selected files and adds them to file upload list
 */
function addFilesToFileUploadList(files) {
  const displayPathPromises = [];
  for (let i = 0; i < files.length; i++) {
    const fileEntry = files[i];
    if (fileEntry) {
      if (fileExtensionNotAllowed(fileEntry.name)) {
        showFileAttachErrorMessage();
      } else {
        displayPathPromises.push(addFileToUploadFileList(fileEntry));
      }
    }
  }
  // return from the function once all the displayPathPromises are resolved
  return Promise.all(displayPathPromises);
}

/**
 * Event handler which choose a file button is clicked
 */
async function onChooseFileClicked() {
  hideFileAttachErrorMessage();
  await new Promise((resolve) => {
    // launch the native file explorer
    chrome.fileSystem.chooseEntry(
        {type: 'openFile', acceptsMultiple: true},
        resolve);
  }).then((files) => {
    if (chrome.runtime.lastError || !files || files.length === 0) {
      return;
    }

    return addFilesToFileUploadList(files);
  });
}

/**
 * Enables repro mode and file upload panes
 */
function showReproMode() {
  registerNavButtonEvents();
  registerReproModeEvents();
  $('choose-file-button').addEventListener('click', onChooseFileClicked);
  // shows navigation items
  $('nav-section').removeAttribute('hidden');
  showSavedCapturedTraces();
  showSavedUploadedFiles();
}

/**
 * Saves diag data list item's toggle status
 */
function saveDiagDataListToggleStatus() {
  // Save captured traces from repro mode tab
  const diagDataList = $('sys-info-list').children;
  for (let i = 0 ; i < diagDataList.length; i++) {
    const li = diagDataList[i];
    const keyName = li.querySelector('span[class=\'label\']')
                  .getElementsByTagName('a')[0].getAttribute('data-key');
    const checkedStatus = li.querySelector('input[type=\'checkbox\']').checked;
    window.changeDiagnosticDataKeyStatus(keyName, checkedStatus);
  }
}

/**
 * Saves repro mode trace list if any captured
 */
function saveReproModeTraceList() {
  // Save captured traces from repro mode tab
  const reproModeTraceList = $('advance-trace-list')
                                      .children;
  for (let i = 0 ; i < reproModeTraceList.length; i++) {
    const li = reproModeTraceList[i];
    if (li.getAttribute('hidden') == null) {
      // save net-export
      if (li.id == 'net-export') {
        window.enableTraceInReproModeTraceList(NET_EXPORT_KEY_NAME,
                                          $('net-export-text-link').filepath);
      }
    }
  }
}

/**
 * Saves file(s) attached if any
 */
function saveUploadedFiles() {
  // Save files to be uploaded
  const files = $('file-upload-list').children;
  for (let i = 0 ; i < files.length; i++) {
    const file = files[i].getElementsByClassName('label')[0];
    window.addFileToFileUploadList(file.filename, file.filepath);
  }
}

/**
 * Save button click event handler
 */
function saveDiagnostic() {
  saveDiagDataListToggleStatus();
  saveReproModeTraceList();
  saveUploadedFiles();
  window.enableDiagDataCheckbox();
  scheduleWindowClose();
}

/**
 * Creates a diag data list item entry
 * @param {string} key keyname of the item
 * @param {boolean} isEnabled item enabled or disabled
 */
function createListItem(key, isEnabled) {
  const li = document.createElement('li');

  // Create label div
  const labelSpan = document.createElement('span');
  labelSpan.className = 'label';

  // create hyperlink
  const link = document.createElement('a');
  link.id = key + '-label';
  link.setAttribute('data-key', key);
  link.setAttribute('i18n-content', key);
  link.setAttribute('href', '#');

  // if key is a log file
  //    then open the file using file:// protocol inside native dialog
  // else create a new dialog and show log value inside that dialog
  if (key.substr(-5) == '_file') {
    link.onclick = (e) => {
      e.preventDefault();
      const dataKey = e.target.getAttribute('data-key');
      let logFileLocation = window.getValueForKey(dataKey);
      if (!logFileLocation) {
        return;
      }
      logFileLocation = 'file:///' + logFileLocation;
      chrome.app.window.create(logFileLocation, {
        innerBounds: { width: 1000, height: 1000 }
      });
    };
  } else {
    link.onclick = (e) => {
      e.preventDefault();
      createDiagnosticDataLogDialog(e.target.getAttribute('data-key'));
    };
  }

  labelSpan.appendChild(link);
  li.appendChild(labelSpan);

  // create toggle button
  const toggleButton = document.createElement('span');
  toggleButton.className = 'toggle-button';

  const checkboxEle = document.createElement('input');
  checkboxEle.type = 'checkbox';
  if (isEnabled) {
    checkboxEle.checked = 'true';
  }
  checkboxEle.setAttribute('aria-labelledby', key + '-label');
  checkboxEle.setAttribute('role', 'switch');
  checkboxEle.setAttribute('data-key', key);
  toggleButton.appendChild(checkboxEle);

  const knobEle = document.createElement('span');
  knobEle.className = 'knob';
  toggleButton.appendChild(knobEle);
  li.appendChild(toggleButton);

  li.addEventListener('click', () => {
    const li = event.currentTarget;
    const target = event.target;
    // only consider clicks on parts of LI which are not on Input or A element.
    if ((li && li.tagName == 'LI')
        && target && !(target.tagName == "A" || target.tagName == "INPUT")) {
      const checkboxStatus =
                          li.querySelector('input[type=\'checkbox\']').checked;
      li.querySelector('input[type=\'checkbox\']').checked = !checkboxStatus;
    }
  });

  $('sys-info-list').appendChild(li);
}

/*
* Creates a dialog to show diagnostic data corresponding to the link clicked
*/
function createDiagnosticDataLogDialog(key) {
  const win = chrome.app.window.get(key);
  if (win) {
    win.show();
    return;
  }
  chrome.app.window.create(
    '/html/sys_info_log.html', {
      frame: useSystemWindowFrame ? 'chrome' : 'none',
      id: key,
      width: 700,
      height: 700,
      hidden: true,
      resizable: true
    },
    function(appWindow) {
      // Pass along the frame info for initializeCloseButtonHandlers
      appWindow.contentWindow.useSystemWindowFrame = useSystemWindowFrame;

      appWindow.contentWindow.getHtmlDir = function() {
        return document.documentElement.getAttribute('dir');
      };

      appWindow.contentWindow.getHtmlLang = function() {
        return document.documentElement.getAttribute('lang');
      };

      // returns title for the log dialog
      appWindow.contentWindow.getTitle = function() {
        return $(key + '-label').textContent;
      };

      appWindow.contentWindow.getCloseButtonAriaLabel= function() {
        return $('close-button').getAttribute('aria-label');
      };

      // Returns the content to be displayed inside log dialog.
      appWindow.contentWindow.getLog = function() {
        // will call the getValueForKey function defined inside feedback.js
        // to retrieve the diagnostic data value for the corresponding key
        return window.getValueForKey(key);
      };
    }
  );
}

/**
 * Creates diagnostic datarmation list and calls showDialog to display the page.
 * @param {Object} diagnosticData The diagnostic datarmation that will be used to fill
 * the list.
 */
function createList(diagnosticData) {
  for (const key in diagnosticData) {
    const item = diagnosticData[key];
    if (!item.isMandatory) {
      createListItem(item['key'], item['enabled']);
    }
  }

  showPageContent();
}

/**
 * Hide progress bar and show diag data list.
 */
function showPageContent() {
  // Enable trace capture and file upload actions
  if (enabledFeatureFlags.includes('tracingCapture')) {
    showReproMode();
  }

  // save diagnostic button event handler
  $('save-button').addEventListener('click', saveDiagnostic);

  $('progressbar-container').hidden = true;
  // for screen reader, once loading progress bar goes away,
  // we need to set aria-live attribute to polite
  // so that new updates made to page are picked up by screen reader
  $('content-body').setAttribute('aria-live', 'polite');
  // show the page content like nav-section and diag data list
  $('content-body').classList.remove('hide-children');

  // we have to apply i18nTemplate once again,
  // so that localized text for diag data list are added to document.
  i18nTemplate.process(document, loadTimeData);

  // resize the diag data dialog so that content are laid out properly
  resizeAppWindow();
}

/**
 * Initializes the page when the window is loaded.
 */
window.addEventListener('DOMContentLoaded', function() {
  loadTimeData = getLoadTimeData();
  i18nTemplate.process(document, loadTimeData);

  // getFullDiagnosticData() occasionally introduces a delay.
  // To have the dialog displayed instantly without delay,
  // we show the loading progress bar and apply i18nTemplate,
  // so that title, close button, and loading text are localized.

  // If we don't wait after applying i18nTemplate process to document,
  // screen reader reads out 'diagnostic data' window document as blank/unknown.
  // Hence we are introducing a small delay before displaying window.
  setTimeout(function() {
    chrome.app.window.current().show();
  }, 25);

  // once we get full diagnostic data, use callback creatList() to populate diag data
  // inside this page
  getFullDiagnosticData(createList);
});
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be 
// found in the LICENSE file.

/**
 * Sets up the event handlers for the given |anchorElement|.
 * @param {HTMLElement} anchorElement The <a> html element.
 * @param {string} url The destination URL for the link.
 */
function setupLinkHandlers(anchorElement, url) {
  anchorElement.onclick = function(e) {
    e.preventDefault();
    window.open(url, '_blank');
  };

  anchorElement.onauxclick = function(e) {
    e.preventDefault();
  };
}

/**
 * Sends the survey; after the report is sent, close this dialog.
 */
function sendSurvey() {
  feedbackInfo.description = $('comment-text').value ;

  const radioButtons =
                    document.forms['choice-form'].elements['nps-radio-button'];
  for (let i = 0, len = radioButtons.length; i < len; i++) {
    if (radioButtons[i].checked) {
      feedbackInfo.surveyRating = parseFloat(radioButtons[i].value);
      break;
    }
  }

  sendFeedbackReport();
  scheduleWindowClose();
}

/**
 * Help function for enable Send button and Add button.
 */
function enableButtons() {
  enableButton('send-now-button');
  enableButton('add-explanation-button');
}

/**
 * Enable button
 */
function enableButton(name) {
  if ($(name).disabled) {
    $(name).removeAttribute('disabled');
  }
}

/**
 * Display Comment pane
 */
function showCommentPane() {
  $('question-pane').style.display = 'none';
  $('send-now-button').style.display = 'none';
  $('add-explanation-button').style.display = 'none';

  $('comment-pane').style.display = 'block';
  $('send-button').style.display = 'block';
  $('comment-text').focus();
  enableButton('send-button');
}

/**
 * Setup onchange event listener for radio buttons.
 * so as to enable Send button when one of the radio button is selected
 */
function setupChangeEventOnRadioButtons() {
  const radioButtons =
                    document.forms['choice-form'].elements['nps-radio-button'];
  // add onchange event listener on radio buttons
  for (let i = 0, len = radioButtons.length; i < len; i++) {
    radioButtons[i].addEventListener('change', enableButtons);
  }
}

/**
 * Gets and applies localized string for labels and other text on the page.
 */
function getAndApplyLocalizedStrings() {
  return new Promise(function(resolve, reject) {
    chrome.edgeFeedbackPrivate.getStrings(feedbackInfo.flow,
      function(strings) {
        loadTimeData.data = strings;
        i18nTemplate.process(document, loadTimeData);

        const privacyPolicyUrlElement = $('privacy-statement-page-url');
        if (privacyPolicyUrlElement) {
          setupLinkHandlers(
              privacyPolicyUrlElement, FEEDBACK_PRIVACY_STATEMENT_URL);
        }

        return resolve();
      }
    );
  });
}

/**
 * Add class to the root element depending up on the platform
 */
function addPlatformClass() {
  return new Promise(function(resolve, reject) {
    chrome.runtime.getPlatformInfo(function(info) {
      document.querySelector('html').classList.add(info.os);
      return resolve();
    });
  });
}

/**
 * Disable and register events for buttons initialization
*/
function setupButtons() {
  $('send-now-button').disabled = true;
  $('add-explanation-button').disabled = true;
  $('send-button').disabled = true;

  $('send-now-button').onclick = sendSurvey;
  $('add-explanation-button').onclick = showCommentPane;
  $('send-button').onclick = sendSurvey;
}

/**
 * Initializes our page.
 *    DOMContent Loaded        -> . show NPS survey dialog
 */
function initialize() {
  window.addEventListener('DOMContentLoaded', function() {
    setupButtons();
    setupChangeEventOnRadioButtons();

    Promise.all([getAndApplyLocalizedStrings(), addPlatformClass()])
    .then(() => {
      // If we don't wait after setting page title (via i18nTemplate.process),
      // screen reader reads out window document as blank/unknown.
      // Hence we are introducing a small delay before displaying window.
      setTimeout(function() {
        chrome.app.window.current().show();
      }, 25);
    });
  });
}

initialize();
// Copyright 2013 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Function to take the screenshot of the current screen.
 * @param {function(HTMLCanvasElement)} callback Callback for returning the
 *     canvas with the screenshot. Called with null if the screenshot failed.
 */
function takeScreenshot(callback) {
  var screenshotStream = null;
  var video = document.createElement('video');

  video.addEventListener('canplay', function(e) {
    if (screenshotStream) {
      var canvas = document.createElement('canvas');
      canvas.setAttribute('width', video.videoWidth);
      canvas.setAttribute('height', video.videoHeight);
      canvas.getContext('2d').drawImage(
          video, 0, 0, video.videoWidth, video.videoHeight);

      video.pause();
      video.srcObject = null;

      screenshotStream.getVideoTracks()[0].stop();
      screenshotStream = null;

      callback(canvas);
    }
  }, false);

  navigator.webkitGetUserMedia(
      {
        video: {
          mandatory:
              {chromeMediaSource: 'screen', maxWidth: 4096, maxHeight: 2560}
        }
      },
      function(stream) {
        if (stream) {
          screenshotStream = stream;
          video.srcObject = screenshotStream;
          video.play();
        }
      },
      function(err) {
        console.error(
            'takeScreenshot failed: ' + err.name + '; ' + err.message + '; ' +
            err.constraintName);
        callback(null);
      });
}
// Copyright 2013 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Setup handlers for the close topbar button.
 */
function initializeCloseButtonHandlers() {
  // If this dialog is using system window controls, these elements aren't
  // needed at all.
  if (window.useSystemWindowFrame) {
    $('close-button').hidden = true;
    if ($('maximize-button')) {
      $('maximize-button').hidden = true;
    }
    return;
  }

  if ($('maximize-button')) {
    $('maximize-button').addEventListener('click', function(e) {
      e.preventDefault();
      // if the button contains maximize-icon class
      //    then we need to maximize the dialog
      // else we need to restore the maximized dialog
      if ($('maximize-button').classList.contains('maximize-icon')) {
        chrome.app.window.current().maximize();
      } else {
        chrome.app.window.current().restore();
      }
    });

    function toggleMaximizeRestoreIcons() {
      $('maximize-button').classList.toggle('maximize-icon');
      $('maximize-button').classList.toggle('restore-down-icon');
    }

    // Handle onRestored event so that icon is set to maximize icon;
    // also title and aria-label are set to maximize label
    chrome.app.window.current().onRestored.addListener(function() {
      if (loadTimeData) {
        const maximizeLabel = loadTimeData.getString('maximizeButtonLabel');
        if (maximizeLabel) {
          $('maximize-button').setAttribute('aria-label', maximizeLabel);
          $('maximize-button').setAttribute('title', maximizeLabel);
        }
      }
      toggleMaximizeRestoreIcons();
    });

    // Handle onMaximized event so that icon is set to restore icon;
    // also title and aria-label are set to restore label
    chrome.app.window.current().onMaximized.addListener(function() {
      if (loadTimeData) {
        const restoreLabel = loadTimeData.getString('restoreDownButtonLabel');
        if (restoreLabel) {
          $('maximize-button').setAttribute('aria-label', restoreLabel);
          $('maximize-button').setAttribute('title', restoreLabel);
        }
      }
      toggleMaximizeRestoreIcons();
    });

    $('maximize-button').addEventListener('mousedown', function(e) {
      e.preventDefault();
    });

    // first time when page is loaded we need to have maximize-icon
    $('maximize-button').classList.toggle('maximize-icon', true);
  }

  $('close-button').addEventListener('click', function() {
    scheduleWindowClose();
  });

  $('close-button').addEventListener('mousedown', function(e) {
    e.preventDefault();
  });
}

/**
 * Close the window after 100ms delay.
 */
function scheduleWindowClose() {
  setTimeout(function () {
    window.close();
  }, 100);
}

window.addEventListener('DOMContentLoaded', initializeCloseButtonHandlers);
/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

:root {
  --edge-white: #FFFFFF;
  --edge-black: #101010;
  --edge-content-background-color: #F7F7F7;
  --edge-primary-text-color: var(--edge-black);
  --edge-secondary-text-color: #6F6F6F;

  --edge-border-hover: #949494;
  --edge-border-rest: #C5C5C5;
  --edge-border-pressed: #ADADAD;

  --edge-blue-border-focus: #888888;
  --edge-blue-hover: #006CBE;
  --edge-blue-rest: #0078D4;
  --edge-blue-pressed: #1081D7;
  --edge-blue-selected: #004274;

  --edge-grey-hover: #EAEAEA;
  --edge-grey-rest: #E6E6E6;
  --edge-grey-pressed: #EFEFEF;

  --edge-light-border-hover: #9C9C9C;
  --edge-light-border-rest: #CECECE;
  --edge-light-border-pressed: #B5B5B5;

  --edge-light-grey-hover: #F3F3F3;
  --edge-light-grey-rest: #EFEFEF;
  --edge-light-grey-pressed: #F7F7F7;

  --link-active: #1081D7;
  --link-color: #0061AB;
  --link-hover: #0070C6;

  --checkbox-checked-color: var(--edge-black);
  --focus-border-color: var(--edge-black);
  --input-control-background-color: var(--edge-white);

  --close-button-active-color: var(--edge-grey-pressed);
  --close-button-hover-color: var(--edge-grey-hover);
  --close-button-icon-color: var(--edge-black);

  --titlebar-button-active-color: var(--edge-grey-pressed);
  --titlebar-button-hover-color: var(--edge-grey-hover);

  --primary-button-border-focus: var(--edge-blue-border-focus);
  --primary-button-box-focus: var(--edge-white);
  --primary-button-active: var(--edge-blue-pressed);
  --primary-button-backgroundcolor: var(--edge-blue-rest);
  --primary-button-hover: var(--edge-blue-hover);

  --secondary-button-active: var(--edge-grey-pressed);
  --secondary-button-background: var(--edge-grey-rest);
  --secondary-button-hover: var(--edge-grey-hover);

  --scrollbar-track-color: #EFEFEF;
  --scrollbar-thumb-color: #CACACA;
  --scrollbar-thumb-hover-color: #9E9E9E;

  --radio-button-checked-border-color: var(--edge-black);
  --radio-button-dot-color: var(--edge-black);

  --toggle-knob-off-color: var(--edge-black);
  --toggle-knob-on-color: var(--edge-white);

  --progressbar-background-color: #EFEFEF;
  --progressbar-bar-color: var(--edge-blue-rest);

  /* Svg color stays black in light mode */
  --svg-icon-filter-invert: invert(0%);
  /* Convert svg black to --link-color using filter */
  --svg-icon-filter-blue:
      invert(26%) sepia(59%) saturate(2259%)
      hue-rotate(186deg) brightness(99%) contrast(101%);

  --sys-info-list-item-hover-color: var(--edge-grey-hover);

  --screenshot-editor-secondary-button-hover: var(--edge-grey-hover);
  --screenshot-editor-pen-panel-background: #E0E0E0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --edge-white: #FFFFFF;
    --edge-black: #1D1D1D;
    --edge-content-background-color: #2D2D2D;
    --edge-primary-text-color: var(--edge-white);
    --edge-secondary-text-color: #949494;

    --edge-border-hover: #909090;
    --edge-border-rest: #575757;
    --edge-border-pressed: #787878;

    --edge-blue-border-focus: #888888;
    --edge-blue-box-focus: #00355D;
    --edge-blue-hover: #0078D4;
    --edge-blue-rest: #006CBE;
    --edge-blue-pressed: #0069B9;
    --edge-blue-selected: #63ACE5;

    --edge-grey-hover: #3A3A3A;
    --edge-grey-rest: #3E3E3E;
    --edge-grey-pressed: #353535;

    --edge-light-border-hover: #999999;
    --edge-light-border-rest: #676767;
    --edge-light-border-pressed: #808080;

    --edge-light-grey-hover: #424242;
    --edge-light-grey-rest: #464646;
    --edge-light-grey-pressed: #3E3E3E;

    --link-active: #2189DA;
    --link-color: #63ACE5;
    --link-hover: #429BDF;

    --checkbox-checked-color: var(--edge-white);
    --focus-border-color: var(--edge-white);
    --input-control-background-color: var(--edge-black);

    --close-button-active-color: var(--edge-grey-pressed);
    --close-button-hover-color: var(--edge-grey-hover);
    --close-button-icon-color: var(--edge-white);

    --titlebar-button-active-color: var(--edge-grey-pressed);
    --titlebar-button-hover-color: var(--edge-grey-hover);

    --primary-button-active: var(--edge-blue-pressed);
    --primary-button-backgroundcolor: var(--edge-blue-rest);
    --primary-button-border-focus: var(--edge-blue-border-focus);
    --primary-button-box-focus: var(--edge-blue-box-focus);
    --primary-button-hover: var(--edge-blue-hover);

    --secondary-button-active: var(--edge-grey-pressed);
    --secondary-button-background: var(--edge-grey-rest);
    --secondary-button-hover: var(--edge-grey-hover);

    --scrollbar-track-color: #272727;
    --scrollbar-thumb-color: #4E4E4E;
    --scrollbar-thumb-hover-color: #7D7D7D;

    --radio-button-checked-border-color: var(--edge-white);
    --radio-button-dot-color: var(--edge-white);

    --toggle-knob-off-color: var(--edge-white);
    --toggle-knob-on-color: var(--edge-white);

    --progressbar-background-color: #212121;
    --progressbar-bar-color: var(--edge-blue-rest);

    /* Convert svg black to white using filter */
    --svg-icon-filter-invert: invert(100%);
    /* Convert svg black to --link-color using filter */
    --svg-icon-filter-blue:
        invert(65%) sepia(76%) saturate(643%)
        hue-rotate(177deg) brightness(92%) contrast(95%);

    --sys-info-list-item-hover-color: var(--edge-light-grey-hover);

    --screenshot-editor-secondary-button-hover: var(--edge-light-grey-hover);
    --screenshot-editor-pen-panel-background: #404040;
  }
}

:root {
  --button-alignment: flex-end;
  --text-capitalize: initial;
}

:root.mac {
  --text-capitalize: capitalize;
}

body {
  background-color: var(--edge-content-background-color);
  color: var(--edge-primary-text-color);
  font-family: system-ui, Segoe UI, SegoeUI, Helvetica Neue,
               Helvetica, Arial, sans-serif;
  font-size: 14px;
  line-height: 20px;
}

[hidden] {
  display: none !important;
}

/* scrollbar styles */
::-webkit-scrollbar {
  height: 12px;
  width: 12px;
}

::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color);
  border: solid 3px var(--scrollbar-track-color);
  border-radius: 9px;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover-color);
}

::-webkit-scrollbar-track {
  background-color: var(--scrollbar-track-color);
}

::-webkit-scrollbar-corner {
  background-color: var(--scrollbar-track-color);
}

/* Input text and textarea styles */
input[type=text],
input[type=url],
input[type=email],
textarea {
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  color: var(--edge-primary-text-color);
  font-family: inherit;
  font-size: inherit;
  font-weight: 400;
  margin: 0;
  max-width: 100%;
  padding: 10px;
}

input[type=text]:hover,
input[type=url]:hover,
input[type=email]:hover,
input[type=checkbox]:hover,
textarea:hover {
  border-color: var(--edge-border-hover);
}

html:not(.focus-by-keydown) *:focus {
  outline: none;
}

input[type=text]:focus,
input[type=url]:focus,
input[type=email]:focus,
html.focus-by-keydown input[type=checkbox]:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  box-shadow: var(--focus-border-color) 0 0 0 1px inset;
  outline: none;
}

textarea:focus {
  border-color: var(--focus-border-color) !important;
  border-image: initial;
  border-style: solid;
  border-width: 1px;
  outline: 1px solid var(--focus-border-color) !important;
}

input[type=email]:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

/* button styles */
.button {
  align-items: center;
  border: 2px solid;
  border-color: transparent;
  border-radius: 2px;
  box-sizing: border-box;
  display: inline-flex;
  font-family: inherit;
  font-size: 14px;
  height: 32px;
  justify-content: center;
  line-height: 1;
  overflow: hidden;
  padding: 0 16px;
  text-decoration: none;
  text-transform: var(--text-capitalize);
  transition: all 200ms ease-in-out;
  white-space: nowrap;
}

.button:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

html.focus-by-keydown .button:focus {
  border-color: var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

html.focus-by-keydown .primary-button:focus {
  border-color: var(--primary-button-border-focus);
  box-shadow: 0 0 0 2px inset var(--primary-button-box-focus);
  outline: none;
}

.primary-button {
  background-color: var(--primary-button-backgroundcolor);
  color: white;
}

.primary-button:hover {
  background-color: var(--primary-button-hover);
}

.primary-button:active {
  background-color: var(--primary-button-active);
}

.secondary-button {
  background-color: var(--secondary-button-background);
  color: var(--edge-primary-text-color);
}

.secondary-button:hover {
  background-color: var(--secondary-button-hover);
}

.secondary-button:active {
  background-color: var(--secondary-button-active);
}

.outline-button {
  background-color: transparent;
  border-color: var(--edge-light-border-rest);
  border-width: 1px;
  color: var(--edge-primary-text-color);
}

.outline-button:hover {
  background-color: var(--edge-light-grey-hover);
  border-color: var(--edge-light-border-hover);
}

.outline-button:active {
  background-color: var(--edge-light-grey-pressed);
  border-color: var(--edge-light-border-pressed);
}

html.focus-by-keydown .outline-button:focus {
  border-width: 2px;
}

/* hypertext link styles */
a {
  outline: none;
  text-decoration: none;
}

a:link,
a:visited {
  border-bottom: solid 1px var(--link-color);
  color: var(--link-color);
}

a:link:hover,
a:visited:hover {
  border-bottom: 2px solid var(--link-hover);
  box-shadow: none;
  color: var(--link-hover);
  outline: none;
}

a:link:active,
a:visited:active {
  color: var(--link-active);
}

html.focus-by-keydown a:link:focus,
html.focus-by-keydown a:visited:focus {
  border-bottom: 2px solid var(--focus-border-color);
  box-shadow: none;
  outline: none;
}

/* Checkbox styles */
.checkbox-container {
  align-items: center;
  display: inline-flex;
  flex-direction: row;
  position: relative;
}

.checkbox-container .checkbox {
  -webkit-appearance: none;
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 2px;
  border-style: solid;
  border-width: 1px;
  box-sizing: border-box;
  height: 18px;
  margin: 0;
  position: absolute;
  width: 18px;
  z-index: 1;
}

.checkbox-container .check-symbol {
  border-radius: 2px;
  display: inline-block;
  flex-shrink: 0;
  height: 18px;
  position: relative;
  width: 18px;
}

.checkbox-container .check-symbol::before {
  height: 11px;
  left: 10px;
  top: 3px;
  transform: rotate(40deg);
}

.checkbox-container .check-symbol::after {
  height: 5px;
  left: 5px;
  top: 8px;
  transform: rotate(-45deg);
}

.checkbox-container .check-symbol::before,
.checkbox-container .check-symbol::after {
  content: '';
  pointer-events: none;
  position: absolute;
  width: 2px;
  z-index: 1;
}

.checkbox-container input[type=checkbox]:checked + .check-symbol::before,
.checkbox-container input[type=checkbox]:checked + .check-symbol::after {
  background-color: var(--checkbox-checked-color);
}

.checkbox-container .checkbox-label {
  padding-inline-end: 8px;
  padding-inline-start: 8px;
}
/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

html {
  height: 100%;
  width: 400px;
}

body {
  display: flex;
  flex-direction: column;
  height: 100%;
  margin: 0;
  overflow: auto;
  padding: 0;
  width: 100%;
}

/* feedback-pane section */
.feedback-pane {
  display: block;
  flex-grow: 1;
  margin-block-end: 24px;
  margin-block-start: 12px;
  margin-inline-end: 24px;
  margin-inline-start: 24px;
}

.feedback-pane .block {
  display: flex;
  flex-direction: column;
  margin-block-end: 12px;
}

.feedback-pane .block > * {
  margin-block-start: 8px;
}

.block-first-child {
  margin-block-start: 0 !important;
}

.feedback-pane input[type=text],
.feedback-pane input[type=url],
.feedback-pane input[type=email] {
  height: 32px;
}

.feedback-pane .description-text-label,
.feedback-pane .page-url-label {
  font-size: 12px;
}

.feedback-pane .description-text {
  height: 100px;
  resize: none;
}

.description-text::placeholder {
  font-size: 14px;
}

/* Screenshot related styles */
.screenshot-image-container {
  margin-block-end: 12px;
}

.image-thumbnail-container {
  border: 2px solid transparent;
  height: 120px;
  margin-block-start: 8px;
  position: relative;
  width: 100%;
}

html.focus-by-keydown .image-thumbnail-container:focus {
  border: 2px solid var(--focus-border-color) !important;
  box-shadow: none;
  outline: none;
}

.screenshot-image {
  align-self: flex-start;
  height: 100%;
  max-width: 100%;
  object-fit: contain;
}

.screenshot-image-modal {
  max-height: 100%;
  max-width: 100%;
}

.cursor-box {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid #d4d4d4;
  cursor: -webkit-zoom-in;
  display: none;
  height: 40px;
  position: absolute;
  top: 0;
  transition: all 50ms ease-in-out;
  width: 40px;
}

.screenshot-overlay {
  align-items: center;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  height: 100%;
  justify-content: center;
  outline: none;
  position: absolute;
  top: 0;
  visibility: hidden;
}

.overlay-text {
  color: white;
  display: flex;
  flex-direction: column;
  font-size: 1.3em;
  justify-content: center;
  text-align: center;
}

/* privacy styles */
.feedback-pane .privacy-note {
  color: var(--edge-secondary-text-color);
  display: block;
  font-size: 10px;
  line-height: 16px;
  margin-block-end: 12px;
}

/* container for the Send button */
.button-container {
  display: flex;
  justify-content: var(--button-alignment);
}

/* Submit button styles */
.send-button {
  width: 150px;
}
/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */
body {
  display: flex;
  flex-direction: column;
  height: 100vh;
  margin: 0;
}

.wrapper {
  align-items: stretch;
  display: flex;
  flex-direction: column;
  height: 100%;
  padding-inline-end: 16px;
  padding-inline-start: 16px;
}

/* For header and footer style */
.outer-panel {
  align-items: center;
  display: flex;
  flex-direction: column;
  height: 60px;
}

.bottom-panel {
  flex-direction: row !important;
  justify-content: var(--button-alignment);
}

/* Tool bar style */
.center-tool-bar {
  align-items: center;
  display: flex;
  flex-direction: row;
  margin: 0;
}

.separator {
  border-inline-end: 1px solid var(--focus-border-color);
  border-inline-start: 1px solid var(--focus-border-color);
  display: inline-block;
  height: 60%;
  margin-inline-end: 4px;
  margin-inline-start: 4px;
  opacity: 0.3;
  padding: 0;
  width: 0;
}

.tool-bar-button {
  background-color: transparent;
  border: none;
  height: 44px;
  outline: none;
  padding: 0;
  width: 44px;
}

html.focus-by-keydown .tool-bar-button:focus {
  border: 1px solid var(--focus-border-color);
  outline: none;
}

.crop-tool-button-with-text {
  color: var(--focus-border-color);
  width: 100px !important;
}

.tool-bar-button:hover {
  background-color: var(--screenshot-editor-secondary-button-hover);
}

.tool-icn {
  filter: var(--svg-icon-filter-invert);
  height: 16px;
  width: 16px;
}

.crop-save-icn {
  background: url(../images/crop_save.svg) no-repeat top left;
  margin-inline-end: 8px;
}

.crop-cancel-icn {
  background: url(../images/crop_cancel.svg) no-repeat top left;
  margin-inline-end: 8px;
}

.crop-mode-icn {
  background: url(../images/crop_icon.svg) no-repeat top left;
}

#pen-button {
  position: relative;
}

.pen-mode-icn {
  background: url(../images/pen_icon.svg) no-repeat top left;
  position: absolute;
}

.pen-mode-icn-active {
  bottom: 0;
  display: flex;
  height: 10px;
  justify-content: center;
  position: absolute;
  width: 100%;
}

.pen-mode-icn-arrow {
  background: url(../images/pen_icon_arrow.svg) no-repeat top left;
  filter: var(--svg-icon-filter-blue);
  height: 8px;
  width: 8px;
}

.pen-mode-icn-line {
  background: var(--link-color);
  bottom: 0;
  height: 2px;
  position: absolute;
  width: 100%;
}

.undo-icn {
  background: url(../images/undo.svg) no-repeat top left;
}

.redo-icn {
  background: url(../images/redo.svg) no-repeat top left;
}

/* Pen drown down panel*/
.pen-panel-container {
  background: var(--screenshot-editor-pen-panel-background);
  border: none;
  box-shadow: 5px 5px 10px 0 rgba(0,0,0,0.4);
  display: flex;
  height: 214px;
  position: absolute;
  top: 108px;
  width: 272px;
  z-index: 1;
}

.pen-panel {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  overflow: hidden;
  padding: 8px;
}

.color-container {
  display: flex;
}

.pen-panel p {
  font-weight: 600;
  margin: 0;
}

.slider-container {
  display: flex;
  flex-direction: column;
  padding: 12px;
  padding-block-start: 0;
}

.size-sampler {
  height: 60px;
  margin-block-end: 12px;
}

.size-slider {
  -webkit-appearance: none;
  background: var(--edge-secondary-text-color);
  height: 2px;
  margin: 0;
  opacity: 0.7;
  outline: none;
  transition: opacity 200ms;
}

html.focus-by-keydown .size-slider:focus {
  outline: 2px solid var(--focus-border-color);
  outline-offset: 12px;
}
html.focus-by-keydown .size-slider:focus,
.size-slider:hover {
  opacity: 1.0;
}

.size-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  background: var(--primary-button-backgroundcolor);
  border-radius: 6px;
  cursor: pointer;
  height: 24px;
  width: 6px;
}

/* Pen Mode color buttons */
.color-button {
  -webkit-appearance: none;
  border: 2px solid var(--screenshot-editor-pen-panel-background);
  border-radius: 50%;
  height: 40px;
  margin: 2px;
  outline: none;
  width: 40px;
}

html.focus-by-keydown .color-button:focus {
  outline: 2px solid var(--focus-border-color);
  outline-offset: 1px;
}

.color-button:hover {
  border-color: transparent;
  box-shadow: none;
  outline: none;
}

.pen-panel input[type='radio']:checked {
  border: 2px solid var(--edge-primary-text-color);
  box-shadow: inset 0 0 0 2px var(--screenshot-editor-pen-panel-background);
}

#black-pen {
  background-color: #000;
}

#white-pen {
  background-color: #FFF;
}

#red-pen {
  background-color: rgb(230, 27, 27);
}

#blue-pen {
  background-color: rgb(35, 53, 249);
}

#green-pen {
  background-color: rgb(0, 122, 0);
}

#pink-pen {
  background-color: rgb(241, 0, 195);
}

.canvas-container {
  background-color: #E9E9E9;
  display: flex;
  flex: 1 100%;
  min-height: 100px;
  padding: 24px;
}

/* Resizable selection styles */
.resizable {
  position: absolute;
  visibility: hidden;
  z-index: 1;
}

.resizers {
  border: 4px solid var(--edge-blue-rest);
  box-sizing: border-box;
  height: 100%;
  width: 100%;
}

.resizer {
  background: var(--edge-blue-rest);
  border: none;
  border-radius: 50%;
  height: 16px;
  position: absolute;
  width: 16px;
}

html.focus-by-keydown .resizer:focus {
  outline: 2px solid var(--focus-border-color);
  outline-offset: 15px;
}

.top-left {
  cursor: nwse-resize;
  left: -5px;
  top: -5px;
}

.top-right {
  cursor: nesw-resize;
  right: -5px;
  top: -5px;
}

.bottom-left {
  bottom: -5px;
  cursor: nesw-resize;
  left: -5px;
}

.bottom-right {
  bottom: -5px;
  cursor: nwse-resize;
  right: -5px;
}

/* Save button style */
.save-button {
  text-transform: none !important;
  width: 150px;
}
/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

/* Screenshot modal related styles */
.screenshot-modal {
  background-color: rgba(0, 0, 0, 0.9);
  bottom: 0;
  display: none;
  height: 100%;
  left: 0;
  position: absolute;
  right: 0;
  top: 0;
  width: 100%;
  z-index: 1;
}

.screenshot-modal:focus {
  outline: none;
}

.modal-image-container {
  align-items: center;
  display: flex;
  height: 100%;
  justify-content: center;
}

.modal-image {
  background-repeat: no-repeat;
  cursor: -webkit-zoom-out;
  height: 60%;
  width: 100%;
}

.modal-title-bar {
  position: absolute;
  width: 100%;
}

/* screenshot modal back button */
.back-button {
  -webkit-app-region: no-drag;
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border-color: transparent;
  display: block;
  height: 32px;
  margin-block-start: -6px;
  margin-inline-start: 6px;
  overflow: hidden;
  padding: 0;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.back-button:hover {
  background: rgb(94, 94, 94);
}

.back-button:focus {
  box-shadow: none;
  outline: 1px solid rgb(241, 241, 241);
}

.back-button-path {
  fill: rgb(241, 241, 241);
}

.back-button > svg {
  fill: none;
  height: 16px;
  padding: 8px;
  width: 16px;
}
/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

:root {
  --svg-invert: 0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --svg-invert: 1;
  }
}

html {
  height: 100%;
}

body {
  display: flex;
  flex-direction: column;
  height: 100%;
  margin: 0;
  padding: 0;
  width: 100%;
}

svg {
  filter: invert(var(--svg-invert));
}

::-webkit-scrollbar-thumb {
  border-width: 4px !important;
}

.button {
  width: 172px;
}

.action-button {
  justify-content: flex-start;
  padding: 0;
  width: 146px;
}

.action-button .action-button-icon {
  width: 36px;
}

.save-button {
  text-transform: none !important;
}

.checkbox-container {
  align-items: start !important;
}

.checkbox:disabled {
  cursor: not-allowed !important;
  opacity: 0.3;
}

.margin-top-1em {
  margin-block-start: 1em;
}

.content-pane {
  height: 100%;
  margin: 24px;
  padding: 0;
}

.content-body {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
}

.content-body.hide-children > * {
  display: none;
}

.content-body-main-section {
  display: flex;
  flex-direction: row;
  height: 90%;
  padding-block-end: 8px;
}

.footer {
  align-items: flex-end;
  display: flex;
  height: 10%;
  justify-content: flex-end;
  width: 100%;
}

.content-view {
  padding-block-end: 12px;
  padding-block-start: 0;
  padding-inline-start: 12px;
  width: 100%;
}

.advance-trace-capture-view {
  height: 100%;
  overflow-y: auto;
  text-align: justify;
}

.file-upload-view {
  height: 100%;
  overflow-y: auto;
}

.recreate-title {
  font-size: 16px !important;
  line-height: 24px;
  margin: 0;
}

.file-attach-error {
  color: red;
  margin-block-end: 8px;
  margin-block-start: 8px;
  visibility: hidden;
}

.file-attach-error.show {
  visibility: visible;
}

/* List styles */
.list-container {
  overflow-y: auto;
  padding-inline-end: 4px;
}

.sys-info-list-view.list-container {
  height: 100%;
}

.advance-trace-capture-view > .list-container {
  height: 35%;
  margin-block-start: 40px;
}

.file-upload-view > .list-container {
  height: 70%;
}

.list-container ul {
  list-style: none;
  margin: 0;
  padding: 0;
  width: 100%;
}

.list-container ul:empty {
  display: none;
}

.list-container li {
  align-items: center;
  display: flex;
  height: 40px;
}

.list-container li span.label {
  flex: 1;
  font-size: 14px;
  line-height: 20px;
}

.file-upload-view .list-container li span.label {
  color: var(--link-color)
}

.remove-file {
  border-bottom: 0 !important;
  font-size: 12px !important;
}

html.focus-by-keydown .remove-file:focus {
  border-bottom: 2px solid var(--focus-border-color) !important;
}
/*End of list styles*/

/* Navigation item styles */
.nav-section {
  border-inline-end: 1px solid var(--edge-border-rest);
  min-width: 280px;
  padding: 0 12px 0 0;
}

@media screen and (max-width: 720px) {
  .nav-section {
    max-width: 200px;
    min-width: 200px;
  }
}

.nav-item {
  align-items: center;
  background-color: transparent;
  border: transparent;
  box-sizing: border-box;
  color: var(--edge-primary-text-color);
  cursor: pointer;
  display: flex;
  font-family: inherit;
  font-size: 14px;
  height: 36px;
  justify-content: flex-start;
  overflow: hidden;
  padding: 0;
  white-space: nowrap;
  width: 100%;
}

.nav-item:hover {
  background-color: var(--edge-grey-hover);
}

html.focus-by-keydown .nav-item:focus {
  outline: solid 2px var(--focus-border-color);
}

.nav-item.active {
  background-color: var(--edge-grey-pressed);
}

.nav-item-select-rect {
  background-color: var(--edge-blue-selected);
  border-radius: 2px;
  height: 20px;
  margin-inline-start: 1px;
  position: relative;
  visibility: hidden;
  width: 3px;
}

.nav-item.active .nav-item-select-rect {
  visibility: visible;
}

.nav-item-icon {
  font-size: 16px;
  line-height: 16px;
  text-align: center;
  width: 40px;
}
/* End of navigation item styles*/

/* toggle button styles */
.toggle-button {
  position: relative;
}

.toggle-button input {
  -webkit-appearance: none;
  background-color: var(--input-control-background-color);
  border-color: var(--edge-border-rest);
  border-image: initial;
  border-radius: 20px;
  border-style: solid;
  border-width: 1px;
  height: 20px;
  margin: 0;
  outline: none;
  position: relative;
  width: 40px;
}

.toggle-button input:hover {
  border-color: var(--edge-border-hover);
}

.toggle-button input:checked,
.toggle-button input:checked:hover {
  background-color: var(--edge-blue-rest);
  border-color: var(--edge-blue-rest);
}

.toggle-button .knob {
  background-color: var(--toggle-knob-off-color);
  border-radius: 10px;
  height: 10px;
  margin-inline-start: -34px;
  pointer-events: none;
  position: absolute;
  top: 5px;
  transition: all 100ms ease 0ms;
  width: 10px;
}

.toggle-button input:checked + .knob {
  background-color: var(--toggle-knob-on-color);
  margin-inline-start: -15px;
}
/* End of toggle button styles */

/* Progress bar styles*/
.progressbar-container {
  display: flex;
  width: 100%;
}

.progressbar-loading-text {
  flex: 1;
  width: 20%;
}

.progressbar {
  align-items: center;
  background: var(--progressbar-background-color);
  border-radius: 100px;
  height: 4px;
  margin-block-start: 8px;
  margin-inline-end: 20px;
  margin-inline-start: 8px;
  overflow: hidden;
  position: relative;
  width: 100%;
}

.progressbar-container .progressbar {
  width: 80%;
}

.progressbar .bluebar-1 {
  animation: indeterminate-1 2s infinite;
  background-color: var(--progressbar-bar-color);
  border-radius: 100px;
  height: 100%;
  opacity: 0;
  position: absolute;
  transform: translateX(-100%);
  width: 40%;
}

.progressbar .bluebar-2 {
  animation: indeterminate-2 2s infinite;
  background-color: var(--progressbar-bar-color);
  border-radius: 100px;
  height: 100%;
  opacity: 0;
  position: absolute;
  transform: translateX(-150%);
  width: 60%;
}

@keyframes indeterminate-1 {
  0% {
    opacity: 1;
    transform: translateX(-100%);
  }

  70% {
    opacity: 1;
    transform: translateX(300%);
  }

  70.01% {
    opacity: 0;
  }

  100% {
    opacity: 0;
    transform: translateX(300%);
  }
}

@keyframes indeterminate-2 {
  0% {
    opacity: 0;
    transform: translateX(-150%);
  }

  29.99% {
    opacity: 0;
  }

  30% {
    opacity: 1;
    transform: translateX(-150%);
  }

  100% {
    opacity: 1;
    transform: translateX(166.66%);
  }
}

html[dir='rtl'] .progressbar .bluebar-1 {
  animation: indeterminate-1-rtl 2s infinite;
  transform: translateX(100%);
}

html[dir='rtl'] .progressbar .bluebar-2 {
  animation: indeterminate-2-rtl 2s infinite;
  transform: translateX(150%);
}

@keyframes indeterminate-1-rtl {
  0% {
    opacity: 1;
    transform: translateX(100%);
  }

  70% {
    opacity: 1;
    transform: translateX(-300%);
  }

  70.01% {
    opacity: 0;
  }

  100% {
    opacity: 0;
    transform: translateX(-300%);
  }
}

@keyframes indeterminate-2-rtl {
  0% {
    opacity: 0;
    transform: translateX(150%);
  }

  29.99% {
    opacity: 0;
  }

  30% {
    opacity: 1;
    transform: translateX(150%);
  }

  100% {
    opacity: 1;
    transform: translateX(-166.66%);
  }
}
/* End of progress bar styles*/
/* Copyright 2013 The Chromium Authors. All rights reserved.
 * Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

/* title bar */
.title-bar {
  -webkit-app-region: drag;
  align-items: center;
  display: flex;
  min-height: 54px;
}

.title-bar .logo-image {
  height: 28px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
  width: 28px;
}

.title-bar .page-title {
  flex: 1 1 auto;
  font-size: 15px;
  margin-block-start: 24px;
  margin-inline-start: 24px;
}

.title-bar .page-title.bold {
  font-size: 18px !important;
  margin-inline-start: 20px !important;
}

.title-bar .topbutton-bar {
  display: flex;
}

.title-bar .topbutton-bar .title-bar-button {
  -webkit-app-region: no-drag;
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 2px solid transparent;
  display: flex;
  height: 32px;
  margin-block-start: -12px;
  overflow: hidden;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.title-bar .topbutton-bar .title-bar-button:last-child {
  margin-inline-end: 6px;
}

html.focus-by-keydown .title-bar .topbutton-bar .title-bar-button:focus {
  border: 2px solid var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.title-bar .topbutton-bar .title-bar-button:hover {
  background-color: var(--titlebar-button-hover-color);
  border-color: var(--titlebar-button-hover-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button:active {
  background-color: var(--titlebar-button-active-color);
  border-color: var(--titlebar-button-active-color);
  border-radius: 2px;
}

.title-bar .topbutton-bar .title-bar-button > span {
  filter: var(--svg-icon-filter-invert);
  height: 16px;
  width: 16px;
}

.title-bar .maximize-icon > span {
  background: url(../images/maximize_button.svg) no-repeat center;
}

.title-bar .restore-down-icon > span {
  background: url(../images/restore_down_button.svg) no-repeat center;
}

.title-bar .close-icon > span {
  background: url(../images/close_button.svg) no-repeat center;
}

/* Close button styles */
.title-bar .close-button {
  -webkit-app-region: no-drag;
  display: block;
  margin-block-start: -12px;
  margin-inline-end: 6px;
}

.close-button {
  background-color: transparent;
  background-position: center;
  background-repeat: no-repeat;
  border: 0;
  height: 32px;
  margin: 0;
  overflow: hidden;
  padding: 0;
  transition: all 200ms ease-in-out;
  width: 32px;
}

.close-button > span {
  display: inline-flex;
  height: 12px;
  position: relative;
  width: 12px;
}

.close-button > span::before {
  transform: rotate(-45deg);
}

.close-button > span::after {
  transform: rotate(45deg);
}

.close-button > span::after,
.close-button > span::before {
  content: '';
  height: 14px;
  left: 6px;
  position: absolute;
  top: 0;
  width: 1px;
}

/* black color close button */
.close-button > span::after,
.close-button > span::before {
  background-color: var(--close-button-icon-color);
}

html.focus-by-keydown .topbutton-bar button:focus,
html.focus-by-keydown .close-button:focus {
  border: 2px solid  var(--focus-border-color);
  border-radius: 2px;
  box-shadow: none;
  outline: none;
}

.topbutton-bar button:hover,
.close-button:hover {
  background-color: var(--close-button-hover-color);
  border: 0;
  border-radius: 2px;
}

.close-button:active {
  background-color: var(--close-button-active-color);
  border: 0;
  border-radius: 2px;
}
/* Copyright (C) Microsoft Corporation. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

body {
  height: 100%;
  margin: 0;
  overflow: auto;
  padding: 0;
  width: 100%;
}

.question-pane {
  margin-inline-end: 24px;
  margin-inline-start: 24px;
}

.survey-question {
  display: block;
  font-weight: bold;
  margin-top: 20px;
}

.choice-form {
  margin-top: 30px;
}

/* Radio button styles */
.radio-button {
  align-items: center;
  display: inline-flex;
  flex-direction: row;
  margin: 0 5px 0 27px;
  position: relative;
}

.radio-button-icon {
  -webkit-appearance: none;
  border: 2px solid var(--edge-border-rest);
  border-radius: 50%;
  height: 20px;
  margin: 0;
  outline-style: none;
  position: absolute;
  width: 20px;
  z-index: 1;
}

input[type=radio]:checked {
  border: 1px solid var(--radio-button-checked-border-color);
}

input[type=radio]:hover {
  border: 2px solid var(--edge-border-hover);
}

html.focus-by-keydown input[type=radio]:focus {
  border: 2px solid var(--focus-border-color);
}

.radio-button-dot {
  border-radius: 50%;
  display: inline-block;
  flex-shrink: 0;
  height: 30px;
  position: relative;
  width: 30px;
}

input[type='radio']:checked + .radio-button-dot::before {
  background-color: var(--radio-button-dot-color);
}

.radio-button-dot::before {
  background: transparent;
  border-radius: 50%;
  content: '';
  height: 12px;
  left: 4px;
  pointer-events: none;
  position: absolute;
  top: 9px;
  width: 12px;
  z-index: 1;
}

label[for='nps-rating-most-negative'] {
  float: left;
  font-size: 12px;
  font-weight: bold;
}

label[for='nps-rating-most-positive'] {
  float: left;
  font-size: 12px;
  font-weight: bold;
  margin-inline-start: 164px;
}

/* Privacy Style*/
.privacy-note {
  bottom: 68px;
  color: var(--edge-secondary-text-color);
  display: block;
  font-size: 11px;
  margin-inline-end: 20px;
  position: absolute;
}

.comment-pane {
  display: none;
  margin-inline-end: 24px;
  margin-inline-start: 24px;
  margin-top: 5px;
}

.comment-label {
  font-weight: bold;
  margin-bottom: 10px;
  margin-top: 20px;
}

/* Text area styles */
.comment-text {
  -webkit-appearance: none;
  height: 150px;
  margin-top: 0;
  padding: 10px;
  resize: none;
  width: 100%;
}

/* button style */
.buttons-pane {
  bottom: 20px;
  margin-inline-end: 24px;
  margin-inline-start: 24px;
  position: absolute;
}

.button {
  width: 170px;
}

.add-explanation-button {
  margin-inline-start: 8px;
}

.send-button {
  display: none;
  margin-inline-start: 182px;
}
<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill="#101010" d="M5.70801 5L10 9.29199L9.29199 10L5 5.70801L0.708008 10L0 9.29199L4.29199 5L0 0.708008L0.708008 0L5 4.29199L9.29199 0L10 0.708008L5.70801 5Z"/>
</svg>
<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 1c.643 0 1.26.084 1.853.253a6.895 6.895 0 0 1 3.09 1.805 6.903 6.903 0 0 1 1.804 3.09C14.916 6.74 15 7.357 15 8c0 .643-.084 1.262-.253 1.86a6.925 6.925 0 0 1-.704 1.667 7.068 7.068 0 0 1-4.19 3.227A6.908 6.908 0 0 1 8 15a6.984 6.984 0 0 1-1.86-.246 7.129 7.129 0 0 1-3.09-1.805 7.128 7.128 0 0 1-1.805-3.09A6.985 6.985 0 0 1 1.001 8c0-.643.082-1.26.246-1.853a7.03 7.03 0 0 1 1.805-3.09 7.068 7.068 0 0 1 1.422-1.1 6.922 6.922 0 0 1 1.668-.704A6.808 6.808 0 0 1 8 1zm0 13.125c.747 0 1.46-.128 2.14-.383a6.13 6.13 0 0 0 1.873-1.114l-8.64-8.64A6.13 6.13 0 0 0 2.257 5.86 6.031 6.031 0 0 0 1.875 8c0 .565.073 1.11.219 1.634.146.52.35 1.007.615 1.463.269.45.588.863.957 1.237.374.37.786.688 1.237.957.456.264.944.47 1.463.615A6.064 6.064 0 0 0 8 14.125zm4.628-2.112a6.152 6.152 0 0 0 1.114-1.867c.255-.683.383-1.399.383-2.146a5.99 5.99 0 0 0-.219-1.627 5.966 5.966 0 0 0-.622-1.463 5.873 5.873 0 0 0-.957-1.237 5.87 5.87 0 0 0-1.237-.957 5.967 5.967 0 0 0-1.463-.622A5.992 5.992 0 0 0 8 1.875c-.747 0-1.463.128-2.146.383a6.153 6.153 0 0 0-1.867 1.114l8.64 8.64z" fill="#000"/></svg><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M12.9922 12H16V13.0078H12.9922V16H12V13.0078H2.99219V4H0V3.00781H2.99219V0H4V3.00781H12.2891L15.1406 0.148438L15.8516 0.851562L12.9922 3.71094V12ZM11.2891 4H4V11.2891L11.2891 4ZM4.71094 12H12V4.71094L4.71094 12Z" fill="black"/>
</svg>
<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.352 4.352L6 12.71 1.648 8.35l.704-.703L6 11.29l7.648-7.64.704.703z" fill="#000"/></svg>PNG

   IHDR         a  IDAT8c`@o3T\y =p@pM0HH-	jFv!h6'~Xqg@
q>U8(=!k!#o:s}t3oip/~fj _P4/5\@ii dq|pT ]2u l
9)SaVC3Jv%k\ttQ H    IENDB`PNG

   IHDR           szz  3IDATXWAN@8G#lLM	KY`nbiJ4D!&`_mv~KNRyqG.iPLc[3so<x6L, "hlsqFsX)gP\^iRO(^Hqd]Jrs^{C`*@C46^`R%#?a?-Ss	lm }>^/(y} 60&0V^UZ:C7RAPkwtY0jHh	>"T'
b	`s68-P 1!L7]XaBs H!NHyjR5Ze`z4P-f~+N5LlAUlAqgU!v2P=+z+N9Q+%|LC.M_\L"gv n~D\zdBO$    IENDB`PNG

   IHDR   0   0   W  IDAThYMn@#9B#NVU
;E*uYl[	dUH T@fg_;=f!E-flFq[vM0>wHCT&7AG Z KWzqI|AE%2]wF onw=V/>8RJ kw e$Aj{@%PNa,dpe!09?`2>>L+F;nr3m1oPa')i[:3aY"xOgx[7{D(iTKi_GmY
4H2<a>GB_H4PlhP9oFBS&DUF&3s0UX4'"V3	8TLF-KdmG
~3[WVel:^^}+ b!30eFx!HD/Dt?LM\R8 S+Pe0 %T"/kbffY!wL/8B>fdEfQdj;nt>)M=e&Rw|)E="^fg;ot/Oz"0n>8M    IENDB`PNG

   IHDR         >a  OIDATx]nF#G#DDRz=19(@	CsLCmYA[hQ(Kr33b/og(Q&A4]Fx}MJmVXY4]/kx/|8 Ud(/5
nN* 69)*-\&;xmn,\Xaw'g3J{hSJW]DXx\KI"L Bx&.bwT$oXw5L&r\[hW>N"Q`u.w2V\p^ `V~ `2w4:PGs5/x}<69qngR)>9bqd`:, (;yr r +.g tB>:ML j kMO e -wb  
=  pay }ZIMv  )`j+0 |@ ?@G=Zy  _-@Dje H+O^^0 \w er pR1vKw|, 6>/' dtc2:+]~ n<o|}N[G_#pA
M@ J'O b<Ep<V0]k=\ b
?!J&-|_\zOefP&$`%pDyvNJ?J  oOI
`J*wit
 1qR>7q@Dg
^m@T?=Qpo{_51 R5 2;d	%&dMr;l~LHX7 {

c] gbl=	O4N39 @ 26L19U] 
3`|  % 6&P&P p. *A| I|6LMU
 sIhuy $M5SIX`PM+03L7TduW(B4.f5r
@/rpSMVBTViC~UGq J/mA~&H	|y@*kLI8T)t=1dV
mxi0B_3-P:D)!4Ua&kl)^*. H0~ a7:
V%>)wba"4k@v"!HC:suKU iU0H
 V>(V:!)b`U3o6%BTubVso+aN ~PYiK,qW0@#cta.CwW<t
'_,AaL[D
},l<QM."ac;
8g[#E{h{4BaJ:Ovb-_~t,"@>:_M5D	[v R,38z7sjxZ1M6FQ\*+Rwfo Yd]Y"?J*u2zH.CGxO!tX +tw9|)o*Xc|+AH7zF"v9gA
\%Yqqny!<${\?gI{"]GAHXq6BS?}},07 )+0&r/2qMYy"(HparXR	U+k!Vy(FJ<PVYN7#e6(oVRBMc    IENDB`PNG

   IHDR         Rl  	IDATxn#7^,.}^s[rY"G@>%i H"8d	Apg{zW@AIsGWF&_'^-U[^iybUS~||$5#/u,?AeAl\iVg]{t0nZ F	 AhD":/u:<2RozdCo9tYyDxn29ET
,~|Lgjj ;fw(bt1r#)v#Q2<*D~1G'x%)ja,)Nn>q fA>.Z@,aD?5IYD;N"QuzR,&ACEW#Y0`I5"EM`G<hH\c
G2@% X*v%}>H XS$Y!%W! I\$( @>w% @e?/T(*hy;bF ;x?E+ |sv ` ? e @R~ (~;{ SC @xhf J }S8p  [tS @+z.`&s`6/dlF}u5V xO,- oB>b<+h	
 P Z;<eQQ`IC0j$}*?#?k%e13z0YHl
O6Ow]eJ d	8 ? <zj>[egHdKu'0rI9z]I} RgUZrDN_ xN l_TG{kz"o|;Q*b  UcJ*g6	mK6}k7?y; @ Q|7, U&H.TB9Q bVRup@	rYJ]v9yPB xCxM \[hQ*@3 /:~> d2 .#|;<[  K xJgs(zxg uq^,>l@C7	;*[/=]oq@?@.l}jA||I( {*  z7}Fh Oa  )<zWi.NRh FI3CX
xV P6 @u3Og+tw51vhi#j*@O/r*8'u?<-C>^`(CfE	z]cQ0+!bXF#!c	x}cdF#2im32Bnqnk0:x5x{3]-V0|AHLNgT8W$Pm)5IqI^U:~+6n `,}`d|:c!~b]Gj([ T!4 0m5 s!Cf8OEi;$Jto@{E(:)\?WRd>Y&#C`8MC1b!h=v`:T| .F+4IBlr|#o7u1>Y
b{7|@}Am_~vH.:m6ZEJnv3c&b VUR] *`K)@(hr[0yf1^`E1jzw)~eX5}0BqkK;2IJFEdjeYXx9P1^d7#A|b@-f9qW
v~\1~o)Q9hBQo/G C7FE+Y/ 5 j)2oC@XXjAXlp1q6@2B6W"mO|nH]b.39*4Ot=8`Y&=v2/_U/OK8Pjx^.=lt+=l$;C.T.
?&zhUL B=/OBs# >XBWzBS3~b"BMA0c:+Z%P}>k[NQAaz@*(vB1> @[;fT	 @}US#@CRINKum![=7EL&%CD o=.+x)OkUStwo@n,8F02<#2#B>E-hQ :'UAPj |
t6f]:."_AWSi M:UQbD9 B6x1QZ$yy#Ij1BbrZ^#[RoyUL26rzP?G$1?    IENDB`<svg width="10" height="11" viewBox="0 0 10 11" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill="#101010" d="M10 0.588867V10.5889H0V0.588867H10ZM8.99902 1.58984H1.00098V9.58789H8.99902V1.58984Z"/>
</svg>
<svg width="16px" height="16px" viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path transform="translate(0,2048) scale(1,-1)" d= "M1920 2048L1920 1536L1800 1536L1351 640L1279 640Q1278 612 1275.5 569.5Q1273 527 1267.5 476.5Q1262 426 1252.5 371.5Q1243 317 1229.5 264Q1216 211 1197 163Q1178 115 1153 79Q1128 43 1096 21.5Q1064 0 1024 0Q971 0 932 37Q893 74 865 132.5Q837 191 818.5 263.5Q800 336 789.5 407.5Q779 479 774.5 540.5Q770 602 769 640L697 640L248 1536L128 1536L128 2048L256 2048L256 1664L1792 1664L1792 2048L1920 2048ZM1024 128Q1047 140 1065 175.5Q1083 211 1097 260Q1111 309 1120.5 365Q1130 421 1136.5 474Q1143 527 1146.5 571Q1150 615 1151 640L897 640Q898 615 901.5 571Q905 527 911.5 474Q918 421 927.5 365Q937 309 951 260Q965 211 983 175.5Q1001 140 1024 128ZM1272 768L1656 1536L392 1536L776 768L1272 768Z"></path>
</svg><svg width="8px" height="8px" viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path transform="translate(0,2048) scale(1,-1)" d= "M1024 666L1939 1581L2029 1491L1024 486L19 1491L109 1581L1024 666Z"></path>
</svg><svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 4h3.29c-.37-.375-.725-.74-1.063-1.094a8.419 8.419 0 0 0-1.047-.945 4.735 4.735 0 0 0-1.196-.672c-.427-.172-.921-.258-1.484-.258-.61 0-1.185.12-1.727.36a4.54 4.54 0 0 0-1.421.96c-.407.407-.73.88-.97 1.422a4.301 4.301 0 0 0-.35 1.727A4.375 4.375 0 0 0 4.32 8.61l6.532 6.538-.704.704L3.61 9.32a5.383 5.383 0 0 1-1.171-1.75 5.451 5.451 0 0 1 .343-4.82A5.55 5.55 0 0 1 6.055.227 5.32 5.32 0 0 1 7.5.03c.438 0 .836.042 1.195.125.365.078.7.19 1.008.336.313.14.604.313.875.516.276.198.544.42.805.664.265.24.529.497.789.773.26.271.536.552.828.844V0h1v5H9V4z" fill="#000"/></svg><svg width="10" height="11" viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink">
  <path fill="#101010" transform="translate(0,2048) scale(1,-1)"
    d="M2048 2048L2048 410L1638 410L1638 0L0 0L0 1638L410 1638L410 2048L2048 2048ZM1434 205L1434 1434L205 1434L205 205L1434 205ZM1843 614L1843 1843L614 1843L614 1638L1638 1638L1638 614L1843 614Z">
  </path>
</svg>
<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.5.031c.5 0 .982.065 1.445.196A5.465 5.465 0 0 1 12.36 1.64a5.47 5.47 0 0 1 1.414 2.414c.13.463.196.945.196 1.445 0 .714-.138 1.404-.414 2.07a5.28 5.28 0 0 1-1.164 1.75l-6.54 6.532-.703-.704L11.68 8.61A4.377 4.377 0 0 0 12.969 5.5c0-.61-.12-1.185-.36-1.727a4.539 4.539 0 0 0-.96-1.421 4.54 4.54 0 0 0-1.422-.961A4.221 4.221 0 0 0 8.5 1.03c-.563 0-1.06.086-1.492.258a4.78 4.78 0 0 0-1.188.672 8.862 8.862 0 0 0-1.054.945C4.432 3.26 4.08 3.625 3.71 4H7v1H2V0h1v3.29c.286-.293.56-.574.82-.845.266-.276.529-.534.79-.773.265-.245.533-.466.804-.664A4.945 4.945 0 0 1 7.297.156 5.402 5.402 0 0 1 8.5.031z" fill="#000"/></svg>// Copyright 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Displays a webview based authorization dialog.
 * @param {string} key A unique identifier that the caller can use to locate
 *     the dialog window.
 * @param {string} url A URL that will be loaded in the webview.
 * @param {string} mode 'interactive' or 'silent'. The window will be displayed
 *     if the mode is 'interactive'.
 */
function showAuthDialog(key, url, mode) {
  const options =
      {frame: 'none', id: key, minWidth: 1024, minHeight: 768, hidden: true};
  chrome.app.window.create(
      'scope_approval_dialog.html', options, function(win) {
        win.contentWindow.addEventListener('load', function(event) {
          let windowParam;
          if (mode == 'interactive') {
            windowParam = win;
          }
          win.contentWindow.loadAuthUrlAndShowWindow(url, windowParam);
        });
      });
}

chrome.identityPrivate.onWebFlowRequest.addListener(showAuthDialog);
/* Copyright (c) 2013 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

body {
  margin: 0;
  padding: 0;
}

.titlebar {
  -webkit-app-region: drag;
  background-color: white;
  height: 26px;
  white-space: nowrap;
  width: 100%;
}

.titlebar-border {
  border-bottom: 1px solid #e5e5e5;
}

.titlebar-close-button {
  background-image: -webkit-image-set(
    url(edge://theme/IDR_CLOSE_DIALOG) 1x,
    url(edge://theme/IDR_CLOSE_DIALOG@2x) 2x);
  -webkit-app-region: no-drag;
  height: 14px;
  margin: 6px;
  position: absolute;
  right: 0;
  width: 14px;
}

.titlebar-close-button:active {
  background-image: -webkit-image-set(
    url(edge://theme/IDR_CLOSE_DIALOG_P) 1x,
    url(edge://theme/IDR_CLOSE_DIALOG_P@2x) 2x);
}

.titlebar-close-button:hover {
  background-image: -webkit-image-set(
    url(edge://theme/IDR_CLOSE_DIALOG_H) 1x,
    url(edge://theme/IDR_CLOSE_DIALOG_H@2x) 2x);
}

.content {
  height: auto;
  width: 100%;
}
<html>
  <head>
    <link rel="stylesheet" href="edge://resources/css/text_defaults.css">
    <link rel="stylesheet" type="text/css" href="scope_approval_dialog.css">
    <script src="scope_approval_dialog.js"></script>
  </head>
  <body>
    <div class="titlebar">
      <span class="titlebar-close-button"></span>
    </div>
    <webview class="content" id="providerview"></webview>
  </body>
</html>
// Copyright 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

let webview;

/**
 * Points the webview to the starting URL of a scope authorization
 * flow, and unhides the dialog once the page has loaded.
 * @param {string} url The url of the authorization entry point.
 * @param {Object} win The dialog window that contains this page. Can
 *     be left undefined if the caller does not want to display the
 *     window.
 */
function loadAuthUrlAndShowWindow(url, win) {
  // Send popups from the webview to a normal browser window.
  webview.addEventListener('newwindow', function(e) {
    e.window.discard();
    window.open(e.targetUrl);
  });

  // Request a customized view from GAIA.
  webview.request.onBeforeSendHeaders.addListener(
      function(details) {
        headers = details.requestHeaders || [];
        headers.push({'name': 'X-Browser-View', 'value': 'embedded'});
        return {requestHeaders: headers};
      },
      {
        urls: ['https://to-be-replaced.invalid/*'],
      },
      ['blocking', 'requestHeaders']);

  if (!url.toLowerCase().startsWith('https://to-be-replaced.invalid/')) {
    document.querySelector('.titlebar').classList.add('titlebar-border');
  }

  webview.src = url;
  if (win) {
    webview.addEventListener('loadstop', function() {
      win.show();
    });
  }
}

document.addEventListener('DOMContentLoaded', function() {
  webview = document.querySelector('webview');

  document.querySelector('.titlebar-close-button').onclick = function() {
    window.close();
  };

  chrome.resourcesPrivate.getStrings('identity', function(strings) {
    document.title = strings['window-title'];
  });
});
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script src="edge://resources/polymer/v1_0/html-imports/html-imports.min.js">
  </script>
  <link rel="import" href="elements/viewer-error-screen/viewer-error-screen.html">
  <link rel="import" href="elements/viewer-page-indicator/viewer-page-indicator.html">
  <link rel="import" href="elements/viewer-page-selector/viewer-page-selector.html">
  <link rel="import" href="elements/viewer-password-screen/viewer-password-screen.html">
  <link rel="import" href="elements/viewer-pdf-toolbar/viewer-pdf-toolbar.html">
  <link rel="import" href="elements/viewer-zoom-toolbar/viewer-zoom-toolbar.html">
  <link rel="import" href="elements/shared-vars.html">
  <link rel="import" href="edge://resources/cr_elements/cr_dialog/cr_dialog.html">
  <link rel="import" href="edge://resources/html/cr/event_target.html">
  <link rel="import" href="edge://resources/html/event_tracker.html">



  <link rel="stylesheet" href="edge://resources/css/text_defaults_md.css">
  <link rel="stylesheet" href="index.css">
</head>
<body>

<viewer-pdf-toolbar id="toolbar" hidden></viewer-pdf-toolbar>

<div id="sizer"></div>
<viewer-password-screen id="password-screen"></viewer-password-screen>

<viewer-zoom-toolbar id="zoom-toolbar"></viewer-zoom-toolbar>

<viewer-page-indicator id="page-indicator"></viewer-page-indicator>

<viewer-error-screen id="error-screen"></viewer-error-screen>



<div id="content"></div>

</body>
<script src="pdf_fitting_type.js"></script>
<script src="toolbar_manager.js"></script>
<script src="viewport.js"></script>
<script src="open_pdf_params_parser.js"></script>
<script src="navigator.js"></script>
<script src="viewport_scroller.js"></script>
<script src="zoom_manager.js"></script>
<script src="gesture_detector.js"></script>
<script src="pdf_scripting_api.js"></script>
<script src="edge://resources/js/assert.js"></script>
<script src="edge://resources/js/load_time_data.js"></script>
<script src="edge://resources/js/util.js"></script>
<script src="edge://resources/js/promise_resolver.js"></script>
<script src="browser_api.js"></script>
<script src="metrics.js"></script>
<script src="pdf_viewer.js"></script>
<script src="main.js"></script>
</html>
/* Copyright 2015 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file. */

html {
  /* The viewer implements a custom pinch zoom. */
  touch-action: pan-x pan-y;
}

body {
  background-color: rgb(82, 86, 89);
  color: var(--primary-text-color);
  line-height: 154%;
  margin: 0;
}

viewer-page-indicator {
  visibility: hidden;
  z-index: 2;
}

viewer-pdf-toolbar {
  position: fixed;
  width: 100%;
  z-index: 4;
}

#content {
  height: 100%;
  position: fixed;
  width: 100%;
  z-index: 1;
}


viewer-ink-host,
#plugin {
  height: 100%;
  position: absolute;
  width: 100%;
}

#sizer {
  position: absolute;
  z-index: 0;
}

@media(max-height: 250px) {
  viewer-pdf-toolbar {
    display: none;
  }
}

@media(max-height: 200px) {
  viewer-zoom-toolbar {
    display: none;
  }
}

@media(max-width: 300px) {
  viewer-zoom-toolbar {
    display: none;
  }
}
// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * Global PDFViewer object, accessible for testing.
 *
 * @type Object
 */
window.viewer = null;


(function() {
/**
 * Stores any pending messages received which should be passed to the
 * PDFViewer when it is created.
 *
 * @type Array
 */
const pendingMessages = [];

/**
 * Handles events that are received prior to the PDFViewer being created.
 *
 * @param {Object} message A message event received.
 */
function handleScriptingMessage(message) {
  pendingMessages.push(message);
}

/**
 * Initialize the global PDFViewer and pass any outstanding messages to it.
 *
 * @param {Promise<BrowserApi>} browserApi A promise resolving to an API
 *     to the browser.
 */
function initViewer(browserApi) {
  // PDFViewer will handle any messages after it is created.
  window.removeEventListener('message', handleScriptingMessage, false);
  viewer = new PDFViewer(browserApi);
  while (pendingMessages.length > 0) {
    viewer.handleScriptingMessage(pendingMessages.shift());
  }
}

/**
 * Determine if the content settings allow PDFs to execute javascript.
 *
 * @param {Promise<BrowserApi>} browserApi A promise resolving to an API
 *     to the browser.
 */
function configureJavaScriptContentSetting(browserApi) {
  return new Promise((resolve, reject) => {
    chrome.contentSettings.javascript.get(
        {
          'primaryUrl': browserApi.getStreamInfo().originalUrl,
          'secondaryUrl': window.origin
        },
        (result) => {
          browserApi.getStreamInfo().javascript = result.setting;
          resolve(browserApi);
        });
  });
}

/**
 * Entrypoint for starting the PDF viewer. This function obtains the browser
 * API for the PDF and constructs a PDFViewer object with it.
 */
function main() {
  // Set up an event listener to catch scripting messages which are sent prior
  // to the PDFViewer being created.
  window.addEventListener('message', handleScriptingMessage, false);
  HTMLImports.whenReady(() => {
    let chain = createBrowserApi();

    // Content settings may not be present in test environments.
    if (chrome.contentSettings) {
      chain = chain.then(configureJavaScriptContentSetting);
    }

    // |loadTimeDataJobRunner| and |pdfUIComponentJobRunner| should be both
    // initialized before calling |initViewer|. They are both independently
    // initialized in `setup_job_runners.js`.
    window.loadTimeDataJobRunner.whenReady(() => {
      window.pdfUIComponentJobRunner.whenReady(() => {
        chain = chain.then(initViewer);
      });
    });
  });
}

main();
})();
// Copyright 2013 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * @typedef {{
 *   dataToSave: Array,
 *   token: string,
 *   fileName: string
 * }}
 */
let SaveDataMessageData;

/**
 * @return {number} Width of a scrollbar in pixels
 */
function getScrollbarWidth() {
  const div = document.createElement('div');
  div.style.visibility = 'hidden';
  div.style.overflow = 'scroll';
  div.style.width = '50px';
  div.style.height = '50px';
  div.style.position = 'absolute';
  document.body.appendChild(div);
  const result = div.offsetWidth - div.clientWidth;
  div.parentNode.removeChild(div);
  return result;
}

/**
 * Return the filename component of a URL, percent decoded if possible.
 *
 * @param {string} url The URL to get the filename from.
 * @return {string} The filename component.
 */
function getFilenameFromURL(url) {
  // Ignore the query and fragment.
  const mainUrl = url.split(/#|\?/)[0];
  const components = mainUrl.split(/\/|\\/);
  const filename = components[components.length - 1];
  try {
    return decodeURIComponent(filename);
  } catch (e) {
    if (e instanceof URIError) {
      return filename;
    }
    throw e;
  }
}

/**
 * Whether keydown events should currently be ignored. Events are ignored when
 * an editable element has focus, to allow for proper editing controls.
 *
 * @param {HTMLElement} activeElement The currently selected DOM node.
 * @return {boolean} True if keydown events should be ignored.
 */
function shouldIgnoreKeyEvents(activeElement) {
  while (activeElement.shadowRoot != null &&
         activeElement.shadowRoot.activeElement != null) {
    activeElement = activeElement.shadowRoot.activeElement;
  }

  return (
      activeElement.isContentEditable ||
      (activeElement.tagName == 'INPUT' && activeElement.type != 'radio') ||
      activeElement.tagName == 'TEXTAREA');
}

/**
 * Creates a cryptographically secure pseudorandom 128-bit token.
 *
 * @return {string} The generated token as a hex string.
 */
function createToken() {
  const randomBytes = new Uint8Array(16);
  return window.crypto.getRandomValues(randomBytes)
      .map(b => b.toString(16).padStart(2, '0'))
      .join('');
}

/**
 * The minimum number of pixels to offset the toolbar by from the bottom and
 * right side of the screen.
 */
PDFViewer.MIN_TOOLBAR_OFFSET = 15;

/**
 * The height of the toolbar along the top of the page. The document will be
 * shifted down by this much in the viewport.
 */
PDFViewer.MATERIAL_TOOLBAR_HEIGHT = 56;

/**
 * The embed tag begins from the point where the toolbar ends
 * The height of the toolbar in pinned state should be set here
 */
PDFViewer.EMBED_TOP_OFFSET = 0;
/**
 * Minimum height for the material toolbar to show (px). Should match the media
 * query in index-material.css. If the window is smaller than this at load,
 * leave no space for the toolbar.
 */
PDFViewer.TOOLBAR_WINDOW_MIN_HEIGHT = 250;

/**
 * The background color used for print preview (--google-grey-refresh-300).
 */
PDFViewer.PRINT_PREVIEW_BACKGROUND_COLOR = '0xFFDADCE0';

/**
 * The background color used for print preview when dark mode is enabled
 * (--google-grey-refresh-700).
 */
PDFViewer.PRINT_PREVIEW_DARK_BACKGROUND_COLOR = '0xFF5F6368';

/**
 * The background color used for the regular viewer.
 */
PDFViewer.BACKGROUND_COLOR = '0xFF525659';

/**
 * Creates a new PDFViewer. There should only be one of these objects per
 * document.
 *
 * @param {!BrowserApi} browserApi An object providing an API to the browser.
 * @constructor
 */
function PDFViewer(browserApi) {
  this.browserApi_ = browserApi;
  this.originalUrl_ = this.browserApi_.getStreamInfo().originalUrl;
  this.javascript_ = this.browserApi_.getStreamInfo().javascript || 'block';
  this.loadState_ = LoadState.LOADING;
  this.parentWindow_ = null;
  this.parentOrigin_ = null;
  this.isFormFieldFocused_ = false;
  this.beepCount_ = 0;
  this.delayedScriptingMessages_ = [];
  this.loaded_ = new PromiseResolver();

  this.isPrintPreview_ = location.origin === 'edge://print';
  this.isPrintPreviewLoadingFinished_ = false;
  this.isUserInitiatedEvent_ = true;

  /** @private {boolean} */
  this.hasEnteredAnnotationMode_ = false;

  /** @private {boolean} */
  this.hadPassword_ = false;

  /** @private {boolean} */
  this.canSerializeDocument_ = false;

  PDFMetrics.record(PDFMetrics.UserAction.DOCUMENT_OPENED);

  // Parse open pdf parameters.
  this.paramsParser_ = new OpenPdfParamsParser(
      message => this.pluginController_.postMessage(message));
  const toolbarEnabled =
      this.paramsParser_.getUiUrlParams(this.originalUrl_).toolbar &&
      !this.isPrintPreview_;

  // The sizer element is placed behind the plugin element to cause scrollbars
  // to be displayed in the window. It is sized according to the document size
  // of the pdf and zoom level.
  this.sizer_ = $('sizer');

  if (this.isPrintPreview_) {
    this.pageIndicator_ = $('page-indicator');
  }
  this.passwordScreen_ = $('password-screen');
  this.passwordScreen_.addEventListener(
      'password-submitted', e => this.onPasswordSubmitted_(e));
  this.errorScreen_ = $('error-screen');
  // Can only reload if we are in a normal tab.
  if (chrome.tabs && this.browserApi_.getStreamInfo().tabId != -1) {
    this.errorScreen_.reloadFn = () => {
      chrome.tabs.reload(this.browserApi_.getStreamInfo().tabId);
    };
  }

  // Create the viewport.
  const shortWindow = window.innerHeight < PDFViewer.TOOLBAR_WINDOW_MIN_HEIGHT;
  const topToolbarHeight =
      (toolbarEnabled) ? PDFViewer.MATERIAL_TOOLBAR_HEIGHT : 0;
  const embedTopOffset = (toolbarEnabled) ? PDFViewer.EMBED_TOP_OFFSET : 0; 
  const defaultZoom =
      this.browserApi_.getZoomBehavior() == BrowserApi.ZoomBehavior.MANAGE ?
      this.browserApi_.getDefaultZoom() :
      1.0;
  this.viewport_ = new Viewport(
      window, this.sizer_, getScrollbarWidth(), defaultZoom, topToolbarHeight,
      embedTopOffset);
  this.viewport_.setViewportChangedCallback(() => this.viewportChanged_());
  this.viewport_.setBeforeZoomCallback(
      () => this.currentController_.beforeZoom());
  this.viewport_.setAfterZoomCallback(
      () => this.currentController_.afterZoom());
  this.viewport_.setUserInitiatedCallback(
      userInitiated => this.setUserInitiated_(userInitiated));
  window.addEventListener('beforeunload', () => this.viewport_.resetTracker());

  // Create the plugin object dynamically so we can set its src. The plugin
  // element is sized to fill the entire window and is set to be fixed
  // positioning, acting as a viewport. The plugin renders into this viewport
  // according to the scroll position of the window.
  this.plugin_ = document.createElement('embed');
  // NOTE: The plugin's 'id' field must be set to 'plugin' since
  // chrome/renderer/printing/print_render_frame_helper.cc actually
  // references it.
  this.plugin_.id = 'plugin';
  this.plugin_.type = 'application/x-google-chrome-pdf';

  // Handle scripting messages from outside the extension that wish to interact
  // with it. We also send a message indicating that extension has loaded and
  // is ready to receive messages.
  window.addEventListener(
      'message', message => this.handleScriptingMessage(message), false);

  this.plugin_.setAttribute('src', this.originalUrl_);
  this.plugin_.setAttribute(
      'stream-url', this.browserApi_.getStreamInfo().streamUrl);
  let headers = '';
  for (const header in this.browserApi_.getStreamInfo().responseHeaders) {
    headers += header + ': ' +
        this.browserApi_.getStreamInfo().responseHeaders[header] + '\n';
  }
  this.plugin_.setAttribute('headers', headers);

  this.plugin_.setAttribute('background-color', PDFViewer.BACKGROUND_COLOR);
  this.plugin_.setAttribute('first-page-separator', topToolbarHeight);
  this.plugin_.setAttribute('javascript', this.javascript_);

  if (this.browserApi_.getStreamInfo().embedded) {
    this.plugin_.setAttribute(
        'top-level-url', this.browserApi_.getStreamInfo().tabUrl);
  } else {
    this.plugin_.setAttribute('full-frame', '');
  }

  $('content').appendChild(this.plugin_);

  this.pluginController_ =
      new PluginController(this.plugin_, this, this.viewport_);
  this.inkController_ = new InkController(this, this.viewport_);
  this.currentController_ = this.pluginController_;

  // Setup the button event listeners.
  this.zoomToolbar_ = $('zoom-toolbar');
  this.zoomToolbar_.setIsPrintPreview(this.isPrintPreview_);
  this.zoomToolbar_.addEventListener(
      'fit-to-changed', e => this.fitToChanged_(e));
  this.zoomToolbar_.addEventListener('zoom-in', () => this.viewport_.zoomIn());
  this.zoomToolbar_.addEventListener(
      'zoom-out', () => this.viewport_.zoomOut());

  this.gestureDetector_ = new GestureDetector($('content'));
  this.gestureDetector_.addEventListener(
      'pinchstart', e => this.onPinchStart_(e));
  this.sentPinchEvent_ = false;
  this.gestureDetector_.addEventListener(
      'pinchupdate', e => this.onPinchUpdate_(e));
  this.gestureDetector_.addEventListener('pinchend', e => this.onPinchEnd_(e));

  if (toolbarEnabled) {
    this.toolbar_ = $('toolbar');
    this.toolbar_.hidden = false;
    this.toolbar_.addEventListener('save', () => this.save());
    this.toolbar_.addEventListener('print', () => this.print());
    this.toolbar_.addEventListener(
        'undo', () => this.currentController_.undo());
    this.toolbar_.addEventListener(
        'redo', () => this.currentController_.redo());
    this.toolbar_.addEventListener(
        'rotate-right', () => this.rotateClockwise());
    this.toolbar_.addEventListener(
        'annotation-mode-toggled', e => this.annotationModeToggled_(e));
    this.toolbar_.addEventListener(
        'annotation-tool-changed',
        e => this.inkController_.setAnnotationTool(e.detail.value));

    this.toolbar_.docTitle = getFilenameFromURL(this.originalUrl_);
  }

  document.body.addEventListener('change-page', e => {
    this.viewport_.goToPage(e.detail.page);
    if (e.detail.origin == 'bookmark') {
      PDFMetrics.record(PDFMetrics.UserAction.FOLLOW_BOOKMARK);
    } else if (e.detail.origin == 'pageselector') {
      PDFMetrics.record(PDFMetrics.UserAction.PAGE_SELECTOR_NAVIGATE);
    }
  });

  document.body.addEventListener('change-page-and-xy', e => {
    const point = this.viewport_.convertPageToScreen(e.detail.page, e.detail);
    this.goToPageAndXY_(e.detail.origin, e.detail.page, point);
  });

  document.body.addEventListener('navigate', e => {
    const disposition = e.detail.newtab ?
        PdfNavigator.WindowOpenDisposition.NEW_BACKGROUND_TAB :
        PdfNavigator.WindowOpenDisposition.CURRENT_TAB;
    this.navigator_.navigate(e.detail.uri, disposition);
  });

  document.body.addEventListener('dropdown-opened', e => {
    if (e.detail == 'bookmarks') {
      PDFMetrics.record(PDFMetrics.UserAction.OPEN_BOOKMARKS_PANEL);
    }
  });

  this.toolbarManager_ =
      new ToolbarManager(window, this.toolbar_, this.zoomToolbar_);

  // Set up the ZoomManager.
  this.zoomManager_ = ZoomManager.create(
      this.browserApi_.getZoomBehavior(), () => this.viewport_.getZoom(),
      zoom => this.browserApi_.setZoom(zoom),
      this.browserApi_.getInitialZoom());
  this.viewport_.setZoomManager(this.zoomManager_);
  this.browserApi_.addZoomEventListener(
      zoom => this.zoomManager_.onBrowserZoomChange(zoom));

  // Setup the keyboard event listener.
  document.addEventListener('keydown', e => this.handleKeyEvent_(e));
  document.addEventListener('mousemove', e => this.handleMouseEvent_(e));
  document.addEventListener('mouseout', e => this.handleMouseEvent_(e));
  document.addEventListener(
      'contextmenu', e => this.handleContextMenuEvent_(e));

  const tabId = this.browserApi_.getStreamInfo().tabId;
  this.navigator_ = new PdfNavigator(
      this.originalUrl_, this.viewport_, this.paramsParser_,
      new NavigatorDelegate(tabId));
  this.viewportScroller_ =
      new ViewportScroller(this.viewport_, this.plugin_, window);

  // Request translated strings.
  chrome.resourcesPrivate.getStrings(
      'pdf', strings => this.handleStrings_(strings));

  // Listen for save commands from the browser.
  if (chrome.mimeHandlerPrivate && chrome.mimeHandlerPrivate.onSave) {
    chrome.mimeHandlerPrivate.onSave.addListener(url => this.onSave(url));
  }
}

PDFViewer.prototype = {
  /**
   * Handle key events. These may come from the user directly or via the
   * scripting API.
   *
   * @param {KeyboardEvent} e the event to handle.
   * @private
   */
  handleKeyEvent_: function(e) {
    const position = this.viewport_.position;
    // Certain scroll events may be sent from outside of the extension.
    const fromScriptingAPI = e.fromScriptingAPI;

    if (shouldIgnoreKeyEvents(document.activeElement) || e.defaultPrevented) {
      return;
    }

    this.toolbarManager_.hideToolbarsAfterTimeout(e);

    const pageUpHandler = () => {
      // Go to the previous page if we are fit-to-page or fit-to-height.
      if (this.viewport_.isPagedMode()) {
        this.viewport_.goToPreviousPage();
        // Since we do the movement of the page.
        e.preventDefault();
      } else if (fromScriptingAPI) {
        position.y -= this.viewport.size.height;
        this.viewport.position = position;
      }
    };
    const pageDownHandler = () => {
      // Go to the next page if we are fit-to-page or fit-to-height.
      if (this.viewport_.isPagedMode()) {
        this.viewport_.goToNextPage();
        // Since we do the movement of the page.
        e.preventDefault();
      } else if (fromScriptingAPI) {
        position.y += this.viewport.size.height;
        this.viewport.position = position;
      }
    };

    switch (e.keyCode) {
      case 9:  // Tab key.
        this.toolbarManager_.showToolbarsForKeyboardNavigation();
        return;
      case 27:  // Escape key.
        if (!this.isPrintPreview_) {
          this.toolbarManager_.hideSingleToolbarLayer();
          return;
        }
        break;  // Ensure escape falls through to the print-preview handler.
      case 32:  // Space key.
        if (e.shiftKey) {
          pageUpHandler();
        } else {
          pageDownHandler();
        }
        return;
      case 33:  // Page up key.
        pageUpHandler();
        return;
      case 34:  // Page down key.
        pageDownHandler();
        return;
      case 37:  // Left arrow key.
        if (!hasKeyModifiers(e)) {
          // Go to the previous page if there are no horizontal scrollbars and
          // no form field is focused.
          if (!(this.viewport_.documentHasScrollbars().horizontal ||
                this.isFormFieldFocused_)) {
            this.viewport_.goToPreviousPage();
            // Since we do the movement of the page.
            e.preventDefault();
          } else if (fromScriptingAPI) {
            position.x -= Viewport.SCROLL_INCREMENT;
            this.viewport.position = position;
          }
        }
        return;
      case 38:  // Up arrow key.
        if (fromScriptingAPI) {
          position.y -= Viewport.SCROLL_INCREMENT;
          this.viewport.position = position;
        }
        return;
      case 39:  // Right arrow key.
        if (!hasKeyModifiers(e)) {
          // Go to the next page if there are no horizontal scrollbars and no
          // form field is focused.
          if (!(this.viewport_.documentHasScrollbars().horizontal ||
                this.isFormFieldFocused_)) {
            this.viewport_.goToNextPage();
            // Since we do the movement of the page.
            e.preventDefault();
          } else if (fromScriptingAPI) {
            position.x += Viewport.SCROLL_INCREMENT;
            this.viewport.position = position;
          }
        }
        return;
      case 40:  // Down arrow key.
        if (fromScriptingAPI) {
          position.y += Viewport.SCROLL_INCREMENT;
          this.viewport.position = position;
        }
        return;
      case 65:  // 'a' key.
        if (e.ctrlKey || e.metaKey) {
          this.pluginController_.postMessage({type: 'selectAll'});
          // Since we do selection ourselves.
          e.preventDefault();
        }
        return;
      case 71:  // 'g' key.
        if (this.toolbar_ && (e.ctrlKey || e.metaKey) && e.altKey) {
          this.toolbarManager_.showToolbars();
          this.toolbar_.selectPageNumber();
        }
        return;
      case 219:  // Left bracket key.
        if (e.ctrlKey) {
          this.rotateCounterclockwise();
        }
        return;
      case 220:  // Backslash key.
        if (e.ctrlKey) {
          this.zoomToolbar_.fitToggleFromHotKey();
        }
        return;
      case 221:  // Right bracket key.
        if (e.ctrlKey) {
          this.rotateClockwise();
        }
        return;
    }

    // Give print preview a chance to handle the key event.
    if (!fromScriptingAPI && this.isPrintPreview_) {
      this.sendScriptingMessage_(
          {type: 'sendKeyEvent', keyEvent: SerializeKeyEvent(e)});
    } else {
      // Show toolbars as a fallback.
      if (!(e.shiftKey || e.ctrlKey || e.altKey)) {
        this.toolbarManager_.showToolbars();
      }
    }
  },

  handleMouseEvent_: function(e) {
    if (e.type == 'mousemove') {
      this.toolbarManager_.handleMouseMove(e);
    } else if (e.type == 'mouseout') {
      this.toolbarManager_.hideToolbarsForMouseOut();
    }
  },

  handleContextMenuEvent_: function(e) {
    // Stop Chrome from popping up the context menu on long press. We need to
    // make sure the start event did not have 2 touches because we don't want
    // to block two finger tap opening the context menu. We check for
    // firesTouchEvents in order to not block the context menu on right click.
    if (e.sourceCapabilities.firesTouchEvents &&
        !this.gestureDetector_.wasTwoFingerTouch()) {
      e.preventDefault();
    }
  },

  /**
   * Handles the annotation mode being toggled on or off.
   *
   * @param {!CustomEvent<{value: boolean}>} e
   * @private
   */
  annotationModeToggled_: async function(e) {
    const annotationMode = e.detail.value;
    if (annotationMode) {
      // Enter annotation mode.
      assert(this.currentController_ == this.pluginController_);
      // TODO(dstockwell): set plugin read-only, begin transition
      this.updateProgress(0);
      // TODO(dstockwell): handle save failure
      const result = await this.pluginController_.save(true);
      if (result.hasUnsavedChanges) {
        assert(!loadTimeData.getBoolean('pdfFormSaveEnabled'));
        try {
          await $('form-warning').show();
        } catch (e) {
          // The user aborted entering annotation mode. Revert to the plugin.
          this.toolbar_.annotationMode = false;
          this.updateProgress(100);
          return;
        }
      }
      PDFMetrics.record(PDFMetrics.UserAction.ENTER_ANNOTATION_MODE);
      this.hasEnteredAnnotationMode_ = true;
      // TODO(dstockwell): feed real progress data from the Ink component
      this.updateProgress(50);
      await this.inkController_.load(result.fileName, result.dataToSave);
      this.inkController_.setAnnotationTool(this.toolbar_.annotationTool);
      this.currentController_ = this.inkController_;
      this.pluginController_.unload();
      this.updateProgress(100);
    } else {
      // Exit annotation mode.
      PDFMetrics.record(PDFMetrics.UserAction.EXIT_ANNOTATION_MODE);
      assert(this.currentController_ == this.inkController_);
      // TODO(dstockwell): set ink read-only, begin transition
      this.updateProgress(0);
      // This runs separately to allow other consumers of `loaded` to queue
      // up after this task.
      this.loaded.then(() => {
        this.currentController_ = this.pluginController_;
        this.inkController_.unload();
      });
      // TODO(dstockwell): handle save failure
      const result = await this.inkController_.save(true);
      await this.pluginController_.load(result.fileName, result.dataToSave);
      // Ensure the plugin gets the initial viewport.
      this.pluginController_.afterZoom();
    }
  },

  /**
   * Exits annotation mode if active.
   *
   * @return {Promise<void>}
   */
  exitAnnotationMode_: async function() {
    if (!this.toolbar_.annotationMode) {
      return;
    }
    this.toolbar_.toggleAnnotation();
    await this.loaded;
  },

  /**
   * Request to change the viewport fitting type.
   *
   * @param {!CustomEvent<{
   *     fittingType: FittingType,
   *     userInitiated: boolean
   * }>} e
   * @private
   */
  fitToChanged_: function(e) {
    if (e.detail.fittingType == FittingType.FIT_TO_PAGE) {
      this.viewport_.fitToPage();
      this.toolbarManager_.forceHideTopToolbar();
    } else if (e.detail.fittingType == FittingType.FIT_TO_WIDTH) {
      this.viewport_.fitToWidth();
    } else if (e.detail.fittingType == FittingType.FIT_TO_HEIGHT) {
      this.viewport_.fitToHeight();
      this.toolbarManager_.forceHideTopToolbar();
    }

    if (e.detail.userInitiated) {
      PDFMetrics.recordFitTo(e.detail.fittingType);
    }
  },

  /**
   * Sends a 'documentLoaded' message to the PDFScriptingAPI if the document has
   * finished loading.
   *
   * @private
   */
  sendDocumentLoadedMessage_: function() {
    if (this.loadState_ == LoadState.LOADING) {
      return;
    }
    if (this.isPrintPreview_ && !this.isPrintPreviewLoadingFinished_) {
      return;
    }
    this.sendScriptingMessage_(
        {type: 'documentLoaded', load_state: this.loadState_});
  },

  /**
   * Handle open pdf parameters. This function updates the viewport as per
   * the parameters mentioned in the url while opening pdf. The order is
   * important as later actions can override the effects of previous actions.
   *
   * @param {Object} params The open params passed in the URL.
   * @private
   */
  handleURLParams_: function(params) {
    if (params.zoom) {
      this.viewport_.setZoom(params.zoom);
    }

    if (params.position) {
      this.viewport_.goToPageAndXY(
          params.page ? params.page : 0, params.position.x, params.position.y);
    } else if (params.page) {
      this.viewport_.goToPage(params.page);
    }

    if (params.view) {
      this.isUserInitiatedEvent_ = false;
      this.zoomToolbar_.forceFit(params.view);
      if (params.viewPosition) {
        const zoomedPositionShift =
            params.viewPosition * this.viewport_.getZoom();
        const currentViewportPosition = this.viewport_.position;
        if (params.view == FittingType.FIT_TO_WIDTH) {
          currentViewportPosition.y += zoomedPositionShift;
        } else if (params.view == FittingType.FIT_TO_HEIGHT) {
          currentViewportPosition.x += zoomedPositionShift;
        }
        this.viewport_.position = currentViewportPosition;
      }
      this.isUserInitiatedEvent_ = true;
    }
  },

  /**
   * Moves the viewport to a point in a page. Called back after a
   * 'transformPagePointReply' is returned from the plugin.
   *
   * @param {string} origin Identifier for the caller for logging purposes.
   * @param {number} page The index of the page to go to. zero-based.
   * @param {Object} message Message received from the plugin containing the
   *     x and y to navigate to in screen coordinates.
   * @private
   */
  goToPageAndXY_: function(origin, page, message) {
    this.viewport_.goToPageAndXY(page, message.x, message.y);
    if (origin == 'bookmark') {
      PDFMetrics.record(PDFMetrics.UserAction.FOLLOW_BOOKMARK);
    }
  },

  /**
   * @return {Promise} Resolved when the load state reaches LOADED,
   *     rejects on FAILED.
   */
  get loaded() {
    return this.loaded_.promise;
  },

  /**
   * Updates the load state and triggers completion of the `loaded`
   * promise if necessary.
   * @param {!LoadState} loadState
   * @private
   */
  setLoadState_(loadState) {
    if (this.loadState_ == loadState) {
      return;
    }
    if (loadState == LoadState.SUCCESS) {
      assert(this.loadState_ == LoadState.LOADING);
      this.loaded_.resolve();
    } else if (loadState == LoadState.FAILED) {
      assert(this.loadState_ == LoadState.LOADING);
      this.loaded_.reject();
    } else {
      assert(loadState == LoadState.LOADING);
      this.loaded_ = new PromiseResolver();
    }
    this.loadState_ = loadState;
  },

  /**
   * Update the loading progress of the document in response to a progress
   * message being received from the content controller.
   *
   * @param {number} progress the progress as a percentage.
   */
  updateProgress: function(progress) {
    if (this.toolbar_) {
      this.toolbar_.loadProgress = progress;
    }

    if (progress == -1) {
      // Document load failed.
      this.errorScreen_.show();
      this.sizer_.style.display = 'none';
      if (this.passwordScreen_.active) {
        this.passwordScreen_.deny();
        this.passwordScreen_.close();
      }
      this.setLoadState_(LoadState.FAILED);
      this.isPrintPreviewLoadingFinished_ = true;
      this.sendDocumentLoadedMessage_();
    } else if (progress == 100) {
      // Document load complete.
      if (this.lastViewportPosition_) {
        this.viewport_.position = this.lastViewportPosition_;
      }
      this.paramsParser_.getViewportFromUrlParams(
          this.originalUrl_, params => this.handleURLParams_(params));
      this.setLoadState_(LoadState.SUCCESS);
      this.sendDocumentLoadedMessage_();
      while (this.delayedScriptingMessages_.length > 0) {
        this.handleScriptingMessage(this.delayedScriptingMessages_.shift());
      }

      this.toolbarManager_.hideToolbarsAfterTimeout();
    } else {
      this.setLoadState_(LoadState.LOADING);
    }
  },

  /** @private */
  sendBackgroundColorForPrintPreview_: function() {
    this.pluginController_.postMessage({
      type: 'backgroundColorChanged',
      backgroundColor: this.dark_ ?
          PDFViewer.PRINT_PREVIEW_DARK_BACKGROUND_COLOR :
          PDFViewer.PRINT_PREVIEW_BACKGROUND_COLOR,
    });
  },

  /**
   * Load a dictionary of translated strings into the UI. Used as a callback for
   * chrome.resourcesPrivate.
   *
   * @param {Object} strings Dictionary of translated strings
   * @private
   */
  handleStrings_: function(strings) {
    document.documentElement.dir = strings.textdirection;
    document.documentElement.lang = strings.language;

    loadTimeData.data = strings;
    const isNewPrintPreview = this.isPrintPreview_ &&
        loadTimeData.getBoolean('newPrintPreviewLayoutEnabled');
    if (isNewPrintPreview) {
      this.sendBackgroundColorForPrintPreview_();
      this.toolbarManager_.reverseSideToolbar();
    }
    this.reverseZoomToolbar_ = isNewPrintPreview;
    this.zoomToolbar_.newPrintPreview = isNewPrintPreview;

    $('toolbar').strings = strings;
    $('toolbar').pdfAnnotationsEnabled =
        loadTimeData.getBoolean('pdfAnnotationsEnabled');
    $('toolbar').printingEnabled = loadTimeData.getBoolean('printingEnabled');
    $('zoom-toolbar').setStrings(strings);
    $('password-screen').strings = strings;
    $('error-screen').strings = strings;
    if ($('form-warning')) {
      $('form-warning').strings = strings;
    }
  },

  /**
   * An event handler for handling password-submitted events. These are fired
   * when an event is entered into the password screen.
   *
   * @param {Object} event a password-submitted event.
   * @private
   */
  onPasswordSubmitted_: function(event) {
    this.pluginController_.postMessage(
        {type: 'getPasswordComplete', password: event.detail.password});
  },

  /**
   * A callback that sets |isUserInitiatedEvent_| to |userInitiated|.
   *
   * @param {boolean} userInitiated The value to set |isUserInitiatedEvent_| to.
   * @private
   */
  setUserInitiated_: function(userInitiated) {
    assert(this.isUserInitiatedEvent_ != userInitiated);
    this.isUserInitiatedEvent_ = userInitiated;
  },

  /**
   * A callback that's called when an update to a pinch zoom is detected.
   *
   * @param {!Object} e the pinch event.
   * @private
   */
  onPinchUpdate_: function(e) {
    // Throttle number of pinch events to one per frame.
    if (!this.sentPinchEvent_) {
      this.sentPinchEvent_ = true;
      window.requestAnimationFrame(() => {
        this.sentPinchEvent_ = false;
        this.viewport_.pinchZoom(e);
      });
    }
  },

  /**
   * A callback that's called when the end of a pinch zoom is detected.
   *
   * @param {!Object} e the pinch event.
   * @private
   */
  onPinchEnd_: function(e) {
    // Using rAF for pinch end prevents pinch updates scheduled by rAF getting
    // sent after the pinch end.
    window.requestAnimationFrame(() => {
      this.viewport_.pinchZoomEnd(e);
    });
  },

  /**
   * A callback that's called when the start of a pinch zoom is detected.
   *
   * @param {!Object} e the pinch event.
   * @private
   */
  onPinchStart_: function(e) {
    // We also use rAF for pinch start, so that if there is a pinch end event
    // scheduled by rAF, this pinch start will be sent after.
    window.requestAnimationFrame(() => {
      this.viewport_.pinchZoomStart(e);
    });
  },

  /**
   * A callback that's called after the viewport changes.
   *
   * @private
   */
  viewportChanged_: function() {
    if (!this.documentDimensions_) {
      return;
    }

    // Offset the toolbar position so that it doesn't move if scrollbars appear.
    const hasScrollbars = this.viewport_.documentHasScrollbars();
    const scrollbarWidth = this.viewport_.scrollbarWidth;
    const verticalScrollbarWidth = hasScrollbars.vertical ? scrollbarWidth : 0;
    const horizontalScrollbarWidth =
        hasScrollbars.horizontal ? scrollbarWidth : 0;

    // Shift the zoom toolbar to the left by half a scrollbar width. This
    // gives a compromise: if there is no scrollbar visible then the toolbar
    // will be half a scrollbar width further left than the spec but if there
    // is a scrollbar visible it will be half a scrollbar width further right
    // than the spec. In RTL layout normally, and in LTR layout in Print Preview
    // when the NewPrintPreview flag is enabled, the zoom toolbar is on the left
    // left side, but the scrollbar is still on the right, so this is not
    // necessary.
    if (isRTL() === this.reverseZoomToolbar_) {
      this.zoomToolbar_.style.right =
          -verticalScrollbarWidth + (scrollbarWidth / 2) + 'px';
    }
    // Having a horizontal scrollbar is much rarer so we don't offset the
    // toolbar from the bottom any more than what the spec says. This means
    // that when there is a scrollbar visible, it will be a full scrollbar
    // width closer to the bottom of the screen than usual, but this is ok.
    this.zoomToolbar_.style.bottom = -horizontalScrollbarWidth + 'px';

    // Update the page indicator.
    const visiblePage = this.viewport_.getMostVisiblePage();

    if (this.toolbar_) {
      this.toolbar_.pageNo = visiblePage + 1;
    }

    // TODO(raymes): Give pageIndicator_ the same API as toolbar_.
    if (this.pageIndicator_) {
      this.pageIndicator_.index = visiblePage;
      if (this.documentDimensions_.pageDimensions.length > 1 &&
          hasScrollbars.vertical) {
        this.pageIndicator_.style.visibility = 'visible';
      } else {
        this.pageIndicator_.style.visibility = 'hidden';
      }
    }

    this.currentController_.viewportChanged();

    const visiblePageDimensions = this.viewport_.getPageScreenRect(visiblePage);
    const size = this.viewport_.size;
    this.sendScriptingMessage_({
      type: 'viewport',
      pageX: visiblePageDimensions.x,
      pageY: visiblePageDimensions.y,
      pageWidth: visiblePageDimensions.width,
      viewportWidth: size.width,
      viewportHeight: size.height
    });
  },

  /**
   * Handle a scripting message from outside the extension (typically sent by
   * PDFScriptingAPI in a page containing the extension) to interact with the
   * plugin.
   *
   * @param {MessageObject} message the message to handle.
   */
  handleScriptingMessage: function(message) {
    if (this.parentWindow_ != message.source) {
      this.parentWindow_ = message.source;
      this.parentOrigin_ = message.origin;
      // Ensure that we notify the embedder if the document is loaded.
      if (this.loadState_ != LoadState.LOADING) {
        this.sendDocumentLoadedMessage_();
      }
    }

    if (this.handlePrintPreviewScriptingMessage_(message)) {
      return;
    }

    // Delay scripting messages from users of the scripting API until the
    // document is loaded. This simplifies use of the APIs.
    if (this.loadState_ != LoadState.SUCCESS) {
      this.delayedScriptingMessages_.push(message);
      return;
    }

    switch (message.data.type.toString()) {
      case 'getSelectedText':
      case 'print':
      case 'selectAll':
        this.pluginController_.postMessage(message.data);
        break;
    }
  },

  /**
   * Handle scripting messages specific to print preview.
   *
   * @param {MessageObject} message the message to handle.
   * @return {boolean} true if the message was handled, false otherwise.
   * @private
   */
  handlePrintPreviewScriptingMessage_: function(message) {
    if (!this.isPrintPreview_) {
      return false;
    }

    switch (message.data.type.toString()) {
      case 'loadPreviewPage':
        this.pluginController_.postMessage(message.data);
        return true;
      case 'resetPrintPreviewMode':
        this.setLoadState_(LoadState.LOADING);
        if (!this.inPrintPreviewMode_) {
          this.inPrintPreviewMode_ = true;
          this.isUserInitiatedEvent_ = false;
          this.zoomToolbar_.forceFit(FittingType.FIT_TO_PAGE);
          this.isUserInitiatedEvent_ = true;
        }

        // Stash the scroll location so that it can be restored when the new
        // document is loaded.
        this.lastViewportPosition_ = this.viewport_.position;

        // TODO(raymes): Disable these properly in the plugin.
        const printButton = $('print-button');
        if (printButton) {
          printButton.parentNode.removeChild(printButton);
        }
        const saveButton = $('save-button');
        if (saveButton) {
          saveButton.parentNode.removeChild(saveButton);
        }

        this.pageIndicator_.pageLabels = message.data.pageNumbers;

        this.pluginController_.postMessage({
          type: 'resetPrintPreviewMode',
          url: message.data.url,
          grayscale: message.data.grayscale,
          // If the PDF isn't modifiable we send 0 as the page count so that no
          // blank placeholder pages get appended to the PDF.
          pageCount:
              (message.data.modifiable ? message.data.pageNumbers.length : 0)
        });
        return true;
      case 'sendKeyEvent':
        this.handleKeyEvent_(DeserializeKeyEvent(message.data.keyEvent));
        return true;
      case 'hideToolbars':
        this.toolbarManager_.resetKeyboardNavigationAndHideToolbars();
        return true;
      case 'darkModeChanged':
        this.dark_ = message.data.darkMode;
        if (this.isPrintPreview_) {
          this.sendBackgroundColorForPrintPreview_();
        }
        return true;
      case 'scrollPosition':
        const position = this.viewport_.position;
        position.y += message.data.y;
        position.x += message.data.x;
        this.viewport.position = position;
        return true;
    }

    return false;
  },

  /**
   * Send a scripting message outside the extension (typically to
   * PDFScriptingAPI in a page containing the extension).
   *
   * @param {Object} message the message to send.
   * @private
   */
  sendScriptingMessage_: function(message) {
    if (this.parentWindow_ && this.parentOrigin_) {
      let targetOrigin;
      // Only send data back to the embedder if it is from the same origin,
      // unless we're sending it to ourselves (which could happen in the case
      // of tests). We also allow documentLoaded messages through as this won't
      // leak important information.
      if (this.parentOrigin_ == window.location.origin) {
        targetOrigin = this.parentOrigin_;
      } else if (message.type == 'documentLoaded') {
        targetOrigin = '*';
      } else {
        targetOrigin = this.originalUrl_;
      }
      this.parentWindow_.postMessage(message, targetOrigin);
    }
  },

  /**
   * @type {Viewport} the viewport of the PDF viewer.
   */
  get viewport() {
    return this.viewport_;
  },

  /**
   * Each bookmark is an Object containing a:
   * - title
   * - page (optional)
   * - array of children (themselves bookmarks)
   *
   * @type {Array} the top-level bookmarks of the PDF.
   */
  get bookmarks() {
    return this.bookmarks_;
  },

  /**
   * Sets document dimensions from the current controller.
   *
   * @param {{height: number, width: number, pageDimensions: Array}}
   *     documentDimensions
   */
  setDocumentDimensions: function(documentDimensions) {
    this.documentDimensions_ = documentDimensions;
    this.isUserInitiatedEvent_ = false;
    this.viewport_.setDocumentDimensions(this.documentDimensions_);
    this.isUserInitiatedEvent_ = true;
    // If we received the document dimensions, the password was good so we
    // can dismiss the password screen.
    if (this.passwordScreen_.active) {
      this.passwordScreen_.close();
    }

    if (this.toolbar_) {
      this.toolbar_.docLength = this.documentDimensions_.pageDimensions.length;
    }
  },

  /**
   * Handles a beep request from the current controller.
   */
  handleBeep: function() {
    // Beeps are annoying, so just track count for now.
    this.beepCount_ += 1;
  },

  /**
   * Handles a password request from the current controller.
   */
  handlePasswordRequest: function() {
    // If the password screen isn't up, put it up. Otherwise we're
    // responding to an incorrect password so deny it.
    if (!this.passwordScreen_.active) {
      this.hadPassword_ = true;
      this.updateAnnotationAvailable_();
      this.passwordScreen_.show();
    } else {
      this.passwordScreen_.deny();
    }
  },

  /**
   * Handles a selected text reply from the current controller.
   * @param {string} selectedText
   */
  handleSelectedTextReply: function(selectedText) {
    this.sendScriptingMessage_({
      type: 'getSelectedTextReply',
      selectedText: selectedText,
    });
  },

  /**
   * Handles a navigation request from the current controller.
   *
   * @param {string} url
   * @param {string} disposition
   */
  handleNavigate: function(url, disposition) {
    // If in print preview, always open a new tab.
    if (this.isPrintPreview_) {
      this.navigator_.navigate(
          url, PdfNavigator.WindowOpenDisposition.NEW_BACKGROUND_TAB);
    } else {
      this.navigator_.navigate(url, disposition);
    }
  },

  /**
   * Handles a notification that print preview has loaded from the
   * current controller.
   */
  handlePrintPreviewLoaded: function() {
    this.isPrintPreviewLoadingFinished_ = true;
    this.sendDocumentLoadedMessage_();
  },

  /**
   * Sets document metadata from the current controller.
   * @param {string} title
   * @param {Array} bookmarks
   * @param {boolean} canSerializeDocument
   */
  setDocumentMetadata: function(title, bookmarks, canSerializeDocument) {
    if (title) {
      document.title = title;
    } else {
      document.title = getFilenameFromURL(this.originalUrl_);
    }
    this.bookmarks_ = bookmarks;
    if (this.toolbar_) {
      this.toolbar_.docTitle = document.title;
      this.toolbar_.bookmarks = this.bookmarks;
    }
    this.canSerializeDocument_ = canSerializeDocument;
    this.updateAnnotationAvailable_();
  },

  /**
   * Sets the is selecting flag from the current controller.
   * @param {boolean} isSelecting
   */
  setIsSelecting: function(isSelecting) {
    this.viewportScroller_.setEnableScrolling(isSelecting);
  },

  /**
   * Sets the form field focused flag from the current controller.
   * @param {boolean} focused
   */
  setIsFormFieldFocused: function(focused) {
    this.isFormFieldFocused_ = focused;
  },

  /**
   * An event handler for when the browser tells the PDF Viewer to perform a
   * save.
   *
   * @param {string} streamUrl unique identifier for a PDF Viewer instance.
   * @private
   */
  onSave: async function(streamUrl) {
    if (streamUrl != this.browserApi_.getStreamInfo().streamUrl) {
      return;
    }

    this.save();
  },

  /**
   * Saves the current PDF document to disk.
   */
  save: async function() {
    PDFMetrics.record(PDFMetrics.UserAction.SAVE);
    if (this.hasEnteredAnnotationMode_) {
      PDFMetrics.record(PDFMetrics.UserAction.SAVE_WITH_ANNOTATION);
    }
    // If we have entered annotation mode we must require the local
    // contents to ensure annotations are saved. Otherwise we would
    // save the cached or remote copy without annotatios.
    const requireResult = this.hasEnteredAnnotationMode_;
    // TODO(dstockwell): Report an error to user if this fails.
    const result = await this.currentController_.save(requireResult);
    if (result == null) {
      // The content controller handled the save internally.
      return;
    }

    // Make sure file extension is .pdf, avoids dangerous extensions.
    let fileName = result.fileName;
    if (!fileName.toLowerCase().endsWith('.pdf')) {
      fileName = fileName + '.pdf';
    }

    chrome.fileSystem.chooseEntry(
        {type: 'saveFile', suggestedName: fileName}, entry => {
          if (chrome.runtime.lastError) {
            if (chrome.runtime.lastError.message != 'User cancelled') {
              console.log(
                  'chrome.fileSystem.chooseEntry failed: ' +
                  chrome.runtime.lastError.message);
            }
            return;
          }
          entry.createWriter(writer => {
            writer.write(
                new Blob([result.dataToSave], {type: 'application/pdf'}));
            // Unblock closing the window now that the user has saved
            // successfully.
            chrome.mimeHandlerPrivate.setShowBeforeUnloadDialog(false);
          });
        });

    // Saving in Annotation mode is destructive: crbug.com/919364
    this.exitAnnotationMode_();
  },

  print: async function() {
    PDFMetrics.record(PDFMetrics.UserAction.PRINT);
    await this.exitAnnotationMode_();
    this.currentController_.print();
  },

  /**
   * Updates the toolbar's annotation available flag depending on current
   * conditions.
   */
  updateAnnotationAvailable_() {
    if (!this.toolbar_) {
      return;
    }
    let annotationAvailable = true;
    if (this.viewport_.getClockwiseRotations() != 0) {
      annotationAvailable = false;
    }
    if (this.hadPassword_) {
      annotationAvailable = false;
    }
    if (!this.canSerializeDocument_) {
      annotationAvailable = false;
    }
    this.toolbar_.annotationAvailable = annotationAvailable;
  },

  rotateClockwise() {
    PDFMetrics.record(PDFMetrics.UserAction.ROTATE);
    this.viewport_.rotateClockwise(1);
    this.currentController_.rotateClockwise();
    this.updateAnnotationAvailable_();
  },

  rotateCounterclockwise() {
    PDFMetrics.record(PDFMetrics.UserAction.ROTATE);
    this.viewport_.rotateClockwise(3);
    this.currentController_.rotateCounterclockwise();
    this.updateAnnotationAvailable_();
  },

  setHasUnsavedChanges: function() {
    // Warn the user if they attempt to close the window without saving.
    chrome.mimeHandlerPrivate.setShowBeforeUnloadDialog(true);
  },

  /** @param {UndoState} state */
  setAnnotationUndoState(state) {
    this.toolbar_.canUndoAnnotation = state.canUndo;
    this.toolbar_.canRedoAnnotation = state.canRedo;
  },
};

/** @abstract */
class ContentController {
  constructor() {}

  /**
   * A callback that's called before the zoom changes.
   */
  beforeZoom() {}

  /**
   * A callback that's called after the zoom changes.
   */
  afterZoom() {}

  /**
   * Handles a change to the viewport.
   */
  viewportChanged() {}

  /**
   * Rotates the document 90 degrees in the clockwise direction.
   * @abstract
   */
  rotateClockwise() {}

  /**
   * Rotates the document 90 degrees in the counter clockwise direction.
   * @abstract
   */
  rotateCounterclockwise() {}

  /**
   * Triggers printing of the current document.
   */
  print() {}

  /**
   * Undo an edit action.
   */
  undo() {}

  /**
   * Redo an edit action.
   */
  redo() {}

  /**
   * Requests that the current document be saved.
   * @param {boolean} requireResult whether a response is required, otherwise
   *     the controller may save the document to disk internally.
   * @return {Promise<{fileName: string, dataToSave: ArrayBuffer}}
   * @abstract
   */
  save(requireResult) {}

  /**
   * Loads PDF document from `data` activates UI.
   * @param {string} fileName
   * @param {ArrayBuffer} data
   * @return {Promise<void>}
   * @abstract
   */
  load(fileName, data) {}

  /**
   * Unloads the current document and removes the UI.
   * @abstract
   */
  unload() {}
}

class InkController extends ContentController {
  /**
   * @param {PDFViewer} viewer
   * @param {Viewport} viewport
   */
  constructor(viewer, viewport) {
    super();
    this.viewer_ = viewer;
    this.viewport_ = viewport;

    /** @type {ViewerInkHost} */
    this.inkHost_ = null;
  }

  /** @param {AnnotationTool} tool */
  setAnnotationTool(tool) {
    this.tool_ = tool;
    if (this.inkHost_) {
      this.inkHost_.setAnnotationTool(tool);
    }
  }

  /** @override */
  rotateClockwise() {
    // TODO(dstockwell): implement rotation
  }

  /** @override */
  rotateCounterclockwise() {
    // TODO(dstockwell): implement rotation
  }

  /** @override */
  viewportChanged() {
    this.inkHost_.viewportChanged();
  }

  /** @override */
  save(requireResult) {
    return this.inkHost_.saveDocument();
  }

  /** @override */
  undo() {
    this.inkHost_.undo();
  }

  /** @override */
  redo() {
    this.inkHost_.redo();
  }

  /** @override */
  load(filename, data) {
    if (!this.inkHost_) {
      this.inkHost_ = document.createElement('viewer-ink-host');
      $('content').appendChild(this.inkHost_);
      this.inkHost_.viewport = this.viewport_;
      this.inkHost_.addEventListener('stroke-added', e => {
        this.viewer_.setHasUnsavedChanges();
      });
      this.inkHost_.addEventListener('undo-state-changed', e => {
        this.viewer_.setAnnotationUndoState(e.detail);
      });
    }
    return this.inkHost_.load(filename, data);
  }

  /** @override */
  unload() {
    this.inkHost_.remove();
    this.inkHost_ = null;
  }
}

class PluginController extends ContentController {
  /**
   * @param {HTMLEmbedElement} plugin
   * @param {PDFViewer} viewer
   * @param {Viewport} viewport
   */
  constructor(plugin, viewer, viewport) {
    super();
    this.plugin_ = plugin;
    this.viewer_ = viewer;
    this.viewport_ = viewport;

    /** @private {!Map<string, PromiseResolver>} */
    this.pendingTokens_ = new Map();
    this.plugin_.addEventListener(
        'message', e => this.handlePluginMessage_(e), false);
  }

  /**
   * Notify the plugin to stop reacting to scroll events while zoom is taking
   * place to avoid flickering.
   * @override
   */
  beforeZoom() {
    this.postMessage({type: 'stopScrolling'});

    if (this.viewport_.pinchPhase == Viewport.PinchPhase.PINCH_START) {
      const position = this.viewport_.position;
      const zoom = this.viewport_.getZoom();
      const pinchPhase = this.viewport_.pinchPhase;
      this.postMessage({
        type: 'viewport',
        userInitiated: true,
        zoom: zoom,
        xOffset: position.x,
        yOffset: position.y,
        pinchPhase: pinchPhase,
        isFitToChanged: this.viewport_.isFitToChanged,
        fitToState: this.viewport_.fittingType
      });
    }
  }

  /**
   * Notify the plugin of the zoom change and to continue reacting to scroll
   * events.
   * @override
   */
  afterZoom() {
    const position = this.viewport_.position;
    const zoom = this.viewport_.getZoom();
    const pinchVector = this.viewport_.pinchPanVector || {x: 0, y: 0};
    const pinchCenter = this.viewport_.pinchCenter || {x: 0, y: 0};
    const pinchPhase = this.viewport_.pinchPhase;

    this.postMessage({
      type: 'viewport',
      userInitiated: this.viewer_.isUserInitiatedEvent_,
      zoom: zoom,
      xOffset: position.x,
      yOffset: position.y,
      pinchPhase: pinchPhase,
      pinchX: pinchCenter.x,
      pinchY: pinchCenter.y,
      pinchVectorX: pinchVector.x,
      pinchVectorY: pinchVector.y,
      isFitToChanged: this.viewport_.isFitToChanged,
      fitToState: this.viewport_.fittingType
    });
  }

  // TODO(dstockwell): this method should be private, add controller APIs that
  // map to all of the existing usage. crbug.com/913279
  /**
   * Post a message to the PPAPI plugin. Some messages will cause an async reply
   * to be received through handlePluginMessage_().
   *
   * @param {Object} message Message to post.
   */
  postMessage(message) {
    this.plugin_.postMessage(message);
  }

  /** @override */
  rotateClockwise() {
    this.postMessage({type: 'rotateClockwise'});
  }

  /** @override */
  rotateCounterclockwise() {
    this.postMessage({type: 'rotateCounterclockwise'});
  }

  /** @override */
  print() {
    this.postMessage({type: 'print'});
  }

  /** @override */
  save(requireResult) {
    const resolver = new PromiseResolver();
    const newToken = createToken();
    this.pendingTokens_.set(newToken, resolver);
    this.postMessage({type: 'save', token: newToken, force: requireResult});
    return resolver.promise;
  }

  /** @override */
  async load(fileName, data) {
    const url = URL.createObjectURL(new Blob([data]));
    this.plugin_.removeAttribute('headers');
    this.plugin_.setAttribute('stream-url', url);
    this.plugin_.style.display = 'block';
    try {
      await this.viewer_.loaded;
    } finally {
      URL.revokeObjectURL(url);
    }
  }

  /** @override */
  unload() {
    this.plugin_.style.display = 'none';
  }

  /**
   * An event handler for handling message events received from the plugin.
   *
   * @param {MessageObject} message a message event.
   * @private
   */
  handlePluginMessage_(message) {
    switch (message.data.type.toString()) {
      case 'beep':
        this.viewer_.handleBeep();
        break;
      case 'documentDimensions':
        this.viewer_.setDocumentDimensions(message.data);
        break;
      case 'email':
        const href = 'mailto:' + message.data.to + '?cc=' + message.data.cc +
            '&bcc=' + message.data.bcc + '&subject=' + message.data.subject +
            '&body=' + message.data.body;
        window.location.href = href;
        break;
      case 'getPassword':
        this.viewer_.handlePasswordRequest();
        break;
      case 'getSelectedTextReply':
        this.viewer_.handleSelectedTextReply(message.data.selectedText);
        break;
      case 'goToPage':
        this.viewport_.goToPage(message.data.page);
        break;
      case 'loadProgress':
        this.viewer_.updateProgress(message.data.progress);
        break;
      case 'navigate':
        this.viewer_.handleNavigate(message.data.url, message.data.disposition);
        break;
      case 'printPreviewLoaded':
        this.viewer_.handlePrintPreviewLoaded();
        break;
      case 'setScrollPosition':
        this.viewport_.scrollTo(/** @type {!PartialPoint} */ (message.data));
        break;
      case 'scrollBy':
        this.viewport_.scrollBy(/** @type {!Point} */ (message.data));
        break;
      case 'metadata':
        this.viewer_.setDocumentMetadata(
            message.data.title, message.data.bookmarks,
            message.data.canSerializeDocument);
        break;
      case 'setIsSelecting':
        this.viewer_.setIsSelecting(message.data.isSelecting);
        break;
      case 'getNamedDestinationReply':
        this.viewer_.paramsParser_.onNamedDestinationReceived(
            message.data.pageNumber);
        break;
      case 'formFocusChange':
        this.viewer_.setIsFormFieldFocused(message.data.focused);
        break;
      case 'saveData':
        this.saveData_(message.data);
        break;
      case 'consumeSaveToken':
        const resolver = this.pendingTokens_.get(message.data.token);
        assert(this.pendingTokens_.delete(message.data.token));
        resolver.resolve(null);
        break;
    }
  }

  /**
   * Handles the pdf file buffer received from the plugin.
   *
   * @param {SaveDataMessageData} messageData data of the message event.
   * @private
   */
  saveData_(messageData) {
    assert(
        loadTimeData.getBoolean('pdfFormSaveEnabled') ||
        loadTimeData.getBoolean('pdfAnnotationsEnabled'));

    // Verify a token that was created by this instance is included to avoid
    // being spammed.
    const resolver = this.pendingTokens_.get(messageData.token);
    assert(this.pendingTokens_.delete(messageData.token));

    if (!messageData.dataToSave) {
      resolver.reject();
      return;
    }

    // Verify the file size and the first bytes to make sure it's a PDF. Cap at
    // 100 MB. This cap should be kept in sync with and is also enforced in
    // pdf/out_of_process_instance.cc.
    const MIN_FILE_SIZE = '%PDF1.0'.length;
    const MAX_FILE_SIZE = 100 * 1000 * 1000;

    const buffer = messageData.dataToSave;
    const bufView = new Uint8Array(buffer);
    assert(
        bufView.length <= MAX_FILE_SIZE,
        `File too large to be saved: ${bufView.length} bytes.`);
    assert(bufView.length >= MIN_FILE_SIZE);
    assert(
        String.fromCharCode(bufView[0], bufView[1], bufView[2], bufView[3]) ==
        '%PDF');

    resolver.resolve(messageData);
  }
}
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/** Idle time in ms before the UI is hidden. */
const HIDE_TIMEOUT = 2000;
/** Time in ms after force hide before toolbar is shown again. */
const FORCE_HIDE_TIMEOUT = 1000;
/**
 * Velocity required in a mousemove to reveal the UI (pixels/ms). This is
 * intended to be high enough that a fast flick of the mouse is required to
 * reach it.
 */
const SHOW_VELOCITY = 10;
/** Distance from the top of the screen required to reveal the toolbars. */
const TOP_TOOLBAR_REVEAL_DISTANCE = 100;
/** Distance from the bottom-right of the screen required to reveal toolbars. */
const SIDE_TOOLBAR_REVEAL_DISTANCE_RIGHT = 150;
const SIDE_TOOLBAR_REVEAL_DISTANCE_BOTTOM = 250;



/**
 * @param {MouseEvent} e Event to test.
 * @return {boolean} True if the mouse is close to the top of the screen.
 */
function isMouseNearTopToolbar(e) {
  return e.y < TOP_TOOLBAR_REVEAL_DISTANCE;
}

/**
 * @param {MouseEvent} e Event to test.
 * @param {Window} window Window to test against.
 * @param {boolean} reverse Whether the side toolbar is reversed.
 * @return {boolean} True if the mouse is close to the bottom-right of the
 * screen.
 */
function isMouseNearSideToolbar(e, window, reverse) {
  let atSide = e.x > window.innerWidth - SIDE_TOOLBAR_REVEAL_DISTANCE_RIGHT;
  if (isRTL() !== reverse) {
    atSide = e.x < SIDE_TOOLBAR_REVEAL_DISTANCE_RIGHT;
  }
  const atBottom =
      e.y > window.innerHeight - SIDE_TOOLBAR_REVEAL_DISTANCE_BOTTOM;
  return atSide && atBottom;
}

/**
 * Constructs a Toolbar Manager, responsible for co-ordinating between multiple
 * toolbar elements.
 *
 * @param {Object} window The window containing the UI.
 * @param {Object} toolbar The top toolbar element.
 * @param {Object} zoomToolbar The zoom toolbar element.
 * @constructor
 */
function ToolbarManager(window, toolbar, zoomToolbar) {
  this.window_ = window;
  this.toolbar_ = toolbar;
  this.zoomToolbar_ = zoomToolbar;

  this.toolbarTimeout_ = null;
  this.isMouseNearTopToolbar_ = false;
  this.isMouseNearSideToolbar_ = false;

  this.sideToolbarAllowedOnly_ = false;
  this.sideToolbarAllowedOnlyTimer_ = null;

  this.keyboardNavigationActive = false;

  this.lastMovementTimestamp = null;

  this.reverseSideToolbar_ = false;

  this.window_.addEventListener('resize', this.resizeDropdowns_.bind(this));
  this.resizeDropdowns_();

  if (zoomToolbar.isPrintPreview()) {
    this.zoomToolbar_.addEventListener('keyboard-navigation-active', e => {
      this.keyboardNavigationActive = e.detail;
    });
  }
}

ToolbarManager.prototype = {

  handleMouseMove: function(e) {
    this.isMouseNearTopToolbar_ = this.toolbar_ && isMouseNearTopToolbar(e);
    this.isMouseNearSideToolbar_ =
        isMouseNearSideToolbar(e, this.window_, this.reverseSideToolbar_);

    this.keyboardNavigationActive = false;
    const touchInteractionActive =
        (e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents);

    // Allow the top toolbar to be shown if the mouse moves away from the side
    // toolbar (as long as the timeout has elapsed).
    if (!this.isMouseNearSideToolbar_ && !this.sideToolbarAllowedOnlyTimer_) {
      this.sideToolbarAllowedOnly_ = false;
    }

    // Allow the top toolbar to be shown if the mouse moves to the top edge.
    if (this.isMouseNearTopToolbar_) {
      this.sideToolbarAllowedOnly_ = false;
    }

    // Tapping the screen with toolbars open tries to close them.
    if (touchInteractionActive && this.zoomToolbar_.isVisible()) {
      this.hideToolbarsIfAllowed();
      return;
    }

    // Show the toolbars if the mouse is near the top or bottom-right of the
    // screen, if the mouse moved fast, or if the touchscreen was tapped.
    if (this.isMouseNearTopToolbar_ || this.isMouseNearSideToolbar_ ||
        this.isHighVelocityMouseMove_(e) || touchInteractionActive) {
      if (this.sideToolbarAllowedOnly_) {
        this.zoomToolbar_.show();
      } else {
        this.showToolbars();
      }
    }
    this.hideToolbarsAfterTimeout();
  },

  /**
   * Whether a mousemove event is high enough velocity to reveal the toolbars.
   *
   * @param {MouseEvent} e Event to test.
   * @return {boolean} true if the event is a high velocity mousemove, false
   * otherwise.
   * @private
   */
  isHighVelocityMouseMove_: function(e) {
    if (e.type == 'mousemove') {
      if (this.lastMovementTimestamp == null) {
        this.lastMovementTimestamp = this.getCurrentTimestamp_();
      } else {
        const movement =
            Math.sqrt(e.movementX * e.movementX + e.movementY * e.movementY);
        const newTime = this.getCurrentTimestamp_();
        const interval = newTime - this.lastMovementTimestamp;
        this.lastMovementTimestamp = newTime;

        if (interval != 0) {
          return movement / interval > SHOW_VELOCITY;
        }
      }
    }
    return false;
  },

  /**
   * Wrapper around Date.now() to make it easily replaceable for testing.
   *
   * @return {number}
   * @private
   */
  getCurrentTimestamp_: function() {
    return Date.now();
  },

  /**
   * Display both UI toolbars.
   */
  showToolbars: function() {
    if (this.toolbar_) {
      this.toolbar_.show();
    }
    this.zoomToolbar_.show();
  },

  /**
   * Show toolbars and mark that navigation is being performed with
   * tab/shift-tab. This disables toolbar hiding until the mouse is moved or
   * escape is pressed.
   */
  showToolbarsForKeyboardNavigation: function() {
    this.keyboardNavigationActive = true;
    this.showToolbars();
  },

  /**
   * Hide toolbars after a delay, regardless of the position of the mouse.
   * Intended to be called when the mouse has moved out of the parent window.
   */
  hideToolbarsForMouseOut: function() {
    this.isMouseNearTopToolbar_ = false;
    this.isMouseNearSideToolbar_ = false;
    this.hideToolbarsAfterTimeout();
  },

  /**
   * Check if the toolbars are able to be closed, and close them if they are.
   * Toolbars may be kept open based on mouse/keyboard activity and active
   * elements.
   */
  hideToolbarsIfAllowed: function() {
    if (this.isMouseNearSideToolbar_ || this.isMouseNearTopToolbar_) {
      return;
    }

    if (this.toolbar_ && this.toolbar_.shouldKeepOpen()) {
      return;
    }

    if (this.keyboardNavigationActive) {
      return;
    }

    // Remove focus to make any visible tooltips disappear -- otherwise they'll
    // still be visible on screen when the toolbar is off screen.
    if ((this.toolbar_ && document.activeElement == this.toolbar_) ||
        document.activeElement == this.zoomToolbar_) {
      document.activeElement.blur();
    }

    if (this.toolbar_) {
      this.toolbar_.hide();
    }
    this.zoomToolbar_.hide();
  },

  /**
   * Hide the toolbar after the HIDE_TIMEOUT has elapsed.
   */
  hideToolbarsAfterTimeout: function() {
    if (this.toolbarTimeout_) {
      this.window_.clearTimeout(this.toolbarTimeout_);
    }
    this.toolbarTimeout_ = this.window_.setTimeout(
        this.hideToolbarsIfAllowed.bind(this), HIDE_TIMEOUT);
  },

  /**
   * Hide the 'topmost' layer of toolbars. Hides any dropdowns that are open, or
   * hides the basic toolbars otherwise.
   */
  hideSingleToolbarLayer: function() {
    if (!this.toolbar_ || !this.toolbar_.hideDropdowns()) {
      this.keyboardNavigationActive = false;
      this.hideToolbarsIfAllowed();
    }
  },

  /**
   * Clears the keyboard navigation state and hides the toolbars after a delay.
   */
  resetKeyboardNavigationAndHideToolbars: function() {
    this.keyboardNavigationActive = false;
    this.hideToolbarsAfterTimeout();
  },

  /**
   * Hide the top toolbar and keep it hidden until both:
   * - The mouse is moved away from the right side of the screen
   * - 1 second has passed.
   *
   * The top toolbar can be immediately re-opened by moving the mouse to the top
   * of the screen.
   */
  forceHideTopToolbar: function() {
    if (!this.toolbar_) {
      return;
    }
    this.toolbar_.hide();
    this.sideToolbarAllowedOnly_ = true;
    this.sideToolbarAllowedOnlyTimer_ = this.window_.setTimeout(() => {
      this.sideToolbarAllowedOnlyTimer_ = null;
    }, FORCE_HIDE_TIMEOUT);
  },

  /** Reverse the position of the side toolbar. */
  reverseSideToolbar: function() {
    this.reverseSideToolbar_ = true;
  },

  /**
   * Updates the size of toolbar dropdowns based on the positions of the rest of
   * the UI.
   *
   * @private
   */
  resizeDropdowns_: function() {
    if (!this.toolbar_) {
      return;
    }
    const lowerBound =
        this.window_.innerHeight - this.zoomToolbar_.clientHeight;
    this.toolbar_.setDropdownLowerBound(lowerBound);
  }
};
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * Enumeration of page fitting types. Make sure the values for following states
 * match the values added for enum defined in components/pdf/common/pdf.mojom
 * @enum {number}
 */
const FittingType = {
  FIT_TO_PAGE: 0,
  FIT_TO_WIDTH: 1,
  FIT_TO_HEIGHT: 2,
  NONE: 3
};
// Copyright 2014 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * @typedef {{
 *   width: number,
 *   height: number,
 *   pageDimensions: Array<ViewportRect>,
 * }}
 */
let DocumentDimensions;

/** @typedef {{x: number, y: number}} */
let Point;

/** @typedef {{width: number, height: number}} */
let Size;

/** @typedef {{x: number, y: number, width: number, height: number}} */
let ViewportRect;

/**
 * Clamps the zoom factor (or page scale factor) to be within the limits.
 * @param {number} factor The zoom/scale factor.
 * @return {number} The factor clamped within the limits.
 */
function clampZoom(factor) {
  return Math.max(
      Viewport.ZOOM_FACTOR_RANGE.min,
      Math.min(factor, Viewport.ZOOM_FACTOR_RANGE.max));
}

/**
 * @param {!ViewportRect} rect1
 * @param {!ViewportRect} rect2
 * @return {number} The area of the intersection of the rects
 */
function getIntersectionArea(rect1, rect2) {
  const left = Math.max(rect1.x, rect2.x);
  const top = Math.max(rect1.y, rect2.y);
  const right = Math.min(rect1.x + rect1.width, rect2.x + rect2.width);
  const bottom = Math.min(rect1.y + rect1.height, rect2.y + rect2.height);

  if (left >= right || top >= bottom) {
    return 0;
  }

  return (right - left) * (bottom - top);
}

/**
 * @param {!Point} p1
 * @param {!Point} p2
 * @return {!Point} The vector between the two points.
 */
function vectorDelta(p1, p2) {
  return {x: p2.x - p1.x, y: p2.y - p1.y};
}

/**
 * @param {!Point} coordinateInFrame
 * @return {!Point} Coordinate converted to plugin coordinates.
 */
function frameToPluginCoordinate(coordinateInFrame) {
  const container = $('plugin');
  return {
    x: coordinateInFrame.x - container.getBoundingClientRect().left,
    y: coordinateInFrame.y - container.getBoundingClientRect().top
  };
}

class Viewport {
  /**
   * @param {!Window} window
   * @param {!HTMLDivElement} sizer The element which represents the size of the
   *     document in the viewport
   * @param {number} scrollbarWidth The width of scrollbars on the page
   * @param {number} defaultZoom The default zoom level.
   * @param {number} firstPageSeparator The number of pixels that should initially
   *     be left blank above the document.
   * @param {number} embedTopOffset The number of pixels that the embed object is
   *     shifted down for the pinned toolbar
   */
  constructor(window, sizer, scrollbarWidth, defaultZoom, firstPageSeparator,
      embedTopOffset) {
    /** @private {!Window} */
    this.window_ = window;

    /** @private {!HTMLDivElement} */
    this.sizer_ = sizer;

    /** @private {number} */
    this.scrollbarWidth_ = scrollbarWidth;

    /** @private {number} */
    this.defaultZoom_ = defaultZoom;

    /** @private {number} */
    this.firstPageSeparator_ = firstPageSeparator;

    /** @private {function():void} */
    this.viewportChangedCallback_ = function() {};

    /** @private {function():void} */
    this.beforeZoomCallback_ = function() {};

    /** @private {function():void} */
    this.afterZoomCallback_ = function() {};

    /** @private {function(boolean):void} */
    this.userInitiatedCallback_ = function() {};

    /** @private {boolean} */
    this.allowedToChangeZoom_ = false;

    /** @private {number} */
    this.internalZoom_ = 1;

    /** @private {?ZoomManager} */
    this.zoomManager_ = null;

    /** @private {?DocumentDimensions} */
    this.documentDimensions_ = null;

    /** @private {Array<ViewportRect>} */
    this.pageDimensions_ = [];

    /** @private {!FittingType} */
    this.fittingType_ = FittingType.NONE;

    this.embedTopOffset_ = embedTopOffset;
    /**
     * |twoUpView_| should be in sync with |two_up_view_| in PDFiumEngine.
     * @private {boolean}
     */
    this.twoUpView_ = false;

    /** @private {number} */
    this.prevScale_ = 1;

    /** @private {!Viewport.PinchPhase} */
    this.pinchPhase_ = Viewport.PinchPhase.PINCH_NONE;

    /** @private {?Point} */
    this.pinchPanVector_ = null;

    /** @private {?Point} */
    this.pinchCenter_ = null;

    /** @private {?Point} */
    this.firstPinchCenterInFrame_ = null;

    /** @private {number} */
    this.rotations_ = 0;

    /** @private {?Point} */
    this.oldCenterInContent_ = null;

    /** @private {boolean} */
    this.keepContentCentered_ = false;

    /** @private {!EventTracker} */
    this.tracker_ = new EventTracker();

    // Set to a default zoom manager - used in tests.
    this.setZoomManager(new InactiveZoomManager(this.getZoom.bind(this), 1));

    // flag to track fit-to-changed event, it is set to true when the view is
    // changing, the message is passed to plugin regarding fit-to changes and
    // is set to false immediately after.
    this.isFitToChanged_ = false;

    window.addEventListener('scroll', this.updateViewport_.bind(this));
    window.addEventListener('resize', this.resizeWrapper_.bind(this));
  }

  /** @param {function():void} viewportChangedCallback */
  setViewportChangedCallback(viewportChangedCallback) {
    this.viewportChangedCallback_ = viewportChangedCallback;
  }

  /** @param {function():void} beforeZoomCallback */
  setBeforeZoomCallback(beforeZoomCallback) {
    this.beforeZoomCallback_ = beforeZoomCallback;
  }

  /** @param {function():void} afterZoomCallback */
  setAfterZoomCallback(afterZoomCallback) {
    this.afterZoomCallback_ = afterZoomCallback;
  }

  /** @param {function(boolean):void} userInitiatedCallback */
  setUserInitiatedCallback(userInitiatedCallback) {
    this.userInitiatedCallback_ = userInitiatedCallback;
  }

  /**
   * @param {number} n The number of clockwise 90-degree rotations to increment
   *     by.
   */
  rotateClockwise(n) {
    this.rotations_ = (this.rotations_ + n) % 4;
  }

  /**
   * @return {number} The number of clockwise 90-degree rotations that have been
   *     applied.
   */
  getClockwiseRotations() {
    return this.rotations_;
  }

  /** @param {boolean} twoUpView The new two up view state to set. */
  setTwoUpView(twoUpView) {
    this.twoUpView_ = twoUpView;
  }

  /**
   * Converts a page position (e.g. the location of a bookmark) to a screen
   * position.
   * @param {number} page
   * @param {!Point} point The position on `page`.
   * @return {!Point} The screen position.
   */
  convertPageToScreen(page, point) {
    const dimensions = this.getPageInsetDimensions(page);

    // width & height are already rotated.
    const height = dimensions.height;
    const width = dimensions.width;

    const matrix = new DOMMatrix();

    const rotation = this.rotations_ * 90;
    // Set origin for rotation.
    if (rotation == 90) {
      matrix.translateSelf(width, 0);
    } else if (rotation == 180) {
      matrix.translateSelf(width, height);
    } else if (rotation == 270) {
      matrix.translateSelf(0, height);
    }
    matrix.rotateSelf(0, 0, rotation);

    // Invert Y position with respect to height as page coordinates are
    // measured from the bottom left.
    matrix.translateSelf(0, height);
    matrix.scaleSelf(1, -1);

    const pointsToPixels = 96 / 72;
    const result = matrix.transformPoint({
      x: point.x * pointsToPixels,
      y: point.y * pointsToPixels,
    });
    return {
      x: result.x + Viewport.PAGE_SHADOW.left,
      y: result.y + Viewport.PAGE_SHADOW.top,
    };
  }


  /**
   * Returns the zoomed and rounded document dimensions for the given zoom.
   * Rounding is necessary when interacting with the renderer which tends to
   * operate in integral values (for example for determining if scrollbars
   * should be shown).
   * @param {number} zoom The zoom to use to compute the scaled dimensions.
   * @return {?Size} Scaled 'width' and 'height' of the document.
   * @private
   */
  getZoomedDocumentDimensions_(zoom) {
    if (!this.documentDimensions_) {
      return null;
    }
    return {
      width: Math.round(this.documentDimensions_.width * zoom),
      height: Math.round(this.documentDimensions_.height * zoom)
    };
  }

  /** @return {!Size} A dictionary with the 'width'/'height' of the document. */
  getDocumentDimensions() {
    return {
      width: this.documentDimensions_.width,
      height: this.documentDimensions_.height
    };
  }

  /**
   * @return {!ViewportRect} ViewportRect for the viewport given current zoom.
   * @private
   */
  getViewportRect_() {
    const zoom = this.getZoom();
    return {
      x: this.position.x / zoom,
      y: this.position.y / zoom,
      width: this.size.width / zoom,
      height: this.size.height / zoom
    };
  }

  /**
   * @param {number} zoom Zoom to compute scrollbars for
   * @return {{horizontal: boolean, vertical: boolean}} Whether horizontal or
   *     vertical scrollbars are needed.
   * @private
   */
  documentNeedsScrollbars_(zoom) {
    const zoomedDimensions = this.getZoomedDocumentDimensions_(zoom);
    if (!zoomedDimensions) {
      return {horizontal: false, vertical: false};
    }

    // If scrollbars are required for one direction, expand the document in the
    // other direction to take the width of the scrollbars into account when
    // deciding whether the other direction needs scrollbars.
    if (zoomedDimensions.width > this.window_.innerWidth) {
      zoomedDimensions.height += this.scrollbarWidth_;
    } else if (zoomedDimensions.height > this.window_.innerHeight) {
      zoomedDimensions.width += this.scrollbarWidth_;
    }
    return {
      horizontal: zoomedDimensions.width > this.window_.innerWidth,
      vertical: zoomedDimensions.height + this.firstPageSeparator_ >
          this.window_.innerHeight
    };
  }

  /**
   * @return {!{horizontal: boolean, vertical: boolean}} Whether horizontal and
   *     vertical scrollbars are needed.
   */
  documentHasScrollbars() {
    return this.documentNeedsScrollbars_(this.getZoom());
  }

  /**
   * Helper function called when the zoomed document size changes. Updates the
   * sizer's width and height.
   * @private
   */
  contentSizeChanged_() {
    const zoomedDimensions = this.getZoomedDocumentDimensions_(this.getZoom());
    if (zoomedDimensions) {
      this.sizer_.style.width = zoomedDimensions.width + 'px';
      this.sizer_.style.height =
          zoomedDimensions.height + this.firstPageSeparator_ + 'px';
    }
  }

  /**
   * Called when the viewport should be updated.
   * @private
   */
  updateViewport_() {
    this.viewportChangedCallback_();
  }

  /**
   * Called when the browser window size changes.
   * @private
   */
  resizeWrapper_() {
    this.userInitiatedCallback_(false);
    this.resize_();
    this.userInitiatedCallback_(true);
  }

  /**
   * Called when the viewport size changes.
   * @private
   */
  resize_() {
    if (this.fittingType_ == FittingType.FIT_TO_PAGE) {
      this.fitToPageInternal_(false);
    } else if (this.fittingType_ == FittingType.FIT_TO_WIDTH) {
      this.fitToWidth();
    } else if (this.fittingType_ == FittingType.FIT_TO_HEIGHT) {
      this.fitToHeightInternal_(false);
    } else if (this.internalZoom_ == 0) {
      this.fitToNone();
    } else {
      this.updateViewport_();
    }
  }

  /** @return {!Point} The scroll position of the viewport. */
  get position() {
    return {
      x: this.window_.pageXOffset,
      y: this.window_.pageYOffset - this.firstPageSeparator_
    };
  }

  /**
   * Scroll the viewport to the specified position.
   * @param {!Point} position The position to scroll to.
   */
  set position(position) {
    this.window_.scrollTo(position.x, position.y + this.firstPageSeparator_);
  }

  /** @return {!Size} the size of the viewport excluding scrollbars. */
  get size() {
    const needsScrollbars = this.documentNeedsScrollbars_(this.getZoom());
    const scrollbarWidth = needsScrollbars.vertical ? this.scrollbarWidth_ : 0;
    const scrollbarHeight =
        needsScrollbars.horizontal ? this.scrollbarWidth_ : 0;
    return {
      width: this.window_.innerWidth - scrollbarWidth,
      height: this.window_.innerHeight - scrollbarHeight
    };
  }

  /** @return {number} The current zoom. */
  getZoom() {
    return this.zoomManager_.applyBrowserZoom(this.internalZoom_);
  }

  /** @param {!ZoomManager} manager */
  setZoomManager(manager) {
    this.resetTracker();
    this.zoomManager_ = manager;
    this.tracker_.add(
        this.zoomManager_.getEventTarget(), 'set-zoom',
        e => this.setZoom(e.detail));
    this.tracker_.add(
        this.zoomManager_.getEventTarget(), 'update-zoom-from-browser',
        this.updateZoomFromBrowserChange_.bind(this));
  }

  /**
   * @return {!Viewport.PinchPhase} The phase of the current pinch gesture for
   *    the viewport.
   */
  get pinchPhase() {
    return this.pinchPhase_;
  }

  /**
   * @return {?Point} The panning caused by the current pinch gesture (as
   *    the deltas of the x and y coordinates).
   */
  get pinchPanVector() {
    return this.pinchPanVector_;
  }

  /**
   * @return {?Point} The coordinates of the center of the current pinch
   *     gesture.
   */
  get pinchCenter() {
    return this.pinchCenter_;
  }

  /**
   * @return {number} The top offset of embed element
   */
  get embedTopOffset() {
    return this.embedTopOffset_;
  }

  /**
   * @param {number} offset The value of embed top offset to be
   */
  set embedTopOffset(offset) {
    this.embedTopOffset_ = offset;
  }

  /**
   * Used to wrap a function that might perform zooming on the viewport. This is
   * required so that we can notify the plugin that zooming is in progress
   * so that while zooming is taking place it can stop reacting to scroll events
   * from the viewport. This is to avoid flickering.
   * @param {function():void} f Function to wrap
   * @private
   */
  mightZoom_(f) {
    this.beforeZoomCallback_();
    this.allowedToChangeZoom_ = true;
    f();
    this.allowedToChangeZoom_ = false;
    this.afterZoomCallback_();
    this.isFitToChanged_ = false;
    this.zoomManager_.onPdfZoomChange();
  }

  /**
   * @param {number} newZoom The zoom level to set.
   * @private
   */
  setZoomInternal_(newZoom) {
    assert(
        this.allowedToChangeZoom_,
        'Called Viewport.setZoomInternal_ without calling ' +
            'Viewport.mightZoom_.');
    // Record the scroll position (relative to the top-left of the window).
    let zoom = this.getZoom();
    const currentScrollPos = {
      x: this.position.x / zoom,
      y: this.position.y / zoom
    };

    this.internalZoom_ = newZoom;
    this.contentSizeChanged_();
    // Scroll to the scaled scroll position.
    zoom = this.getZoom();
    this.position = {
      x: currentScrollPos.x * zoom,
      y: currentScrollPos.y * zoom
    };
  }

  /**
   * Sets the zoom of the viewport.
   * Same as setZoomInternal_ but for pinch zoom we have some more operations.
   * @param {number} scaleDelta The zoom delta.
   * @param {!Point} center The pinch center in content coordinates.
   * @private
   */
  setPinchZoomInternal_(scaleDelta, center) {
    assert(
        this.allowedToChangeZoom_,
        'Called Viewport.setPinchZoomInternal_ without calling ' +
            'Viewport.mightZoom_.');
    this.internalZoom_ = clampZoom(this.internalZoom_ * scaleDelta);

    const newCenterInContent = this.frameToContent_(center);
    const delta = {
      x: (newCenterInContent.x - this.oldCenterInContent_.x),
      y: (newCenterInContent.y - this.oldCenterInContent_.y)
    };

    // Record the scroll position (relative to the pinch center).
    const zoom = this.getZoom();
    const currentScrollPos = {
      x: this.position.x - delta.x * zoom,
      y: this.position.y - delta.y * zoom
    };

    this.contentSizeChanged_();
    // Scroll to the scaled scroll position.
    this.position = {x: currentScrollPos.x, y: currentScrollPos.y};
  }

  /**
   *  Converts a point from frame to content coordinates.
   *  @param {!Point} framePoint The frame coordinates.
   *  @return {!Point} The content coordinates.
   *  @private
   */
  frameToContent_(framePoint) {
    // TODO(mcnee) Add a helper Point class to avoid duplicating operations
    // on plain {x,y} objects.
    const zoom = this.getZoom();
    return {
      x: (framePoint.x + this.position.x) / zoom,
      y: (framePoint.y + this.position.y) / zoom
    };
  }

  /**
   * @param {number} newZoom The zoom level to zoom to.
   */
  setZoom(newZoom) {
    this.fittingType_ = FittingType.NONE;
    this.mightZoom_(() => {
      this.setZoomInternal_(clampZoom(newZoom));
      this.updateViewport_();
    });
  }

  /**
   * @param {!CustomEvent<number>} e Event containing the old browser zoom.
   * @private
   */
  updateZoomFromBrowserChange_(e) {
    const oldBrowserZoom = e.detail;
    this.mightZoom_(() => {
      // Record the scroll position (relative to the top-left of the window).
      const oldZoom = oldBrowserZoom * this.internalZoom_;
      const currentScrollPos = {
        x: this.position.x / oldZoom,
        y: this.position.y / oldZoom
      };
      this.contentSizeChanged_();
      const newZoom = this.getZoom();
      // Scroll to the scaled scroll position.
      this.position = {
        x: currentScrollPos.x * newZoom,
        y: currentScrollPos.y * newZoom
      };
      this.updateViewport_();
    });
  }

  /** @return {number} The width of scrollbars in the viewport in pixels. */
  get scrollbarWidth() {
    return this.scrollbarWidth_;
  }

  /** @return {FittingType} The fitting type the viewport is currently in. */
  get fittingType() {
    return this.fittingType_;
  }

  /**
   * @return {boolean} returns whether fit-to state is changing.
   */
  get isFitToChanged() {
    return this.isFitToChanged_;
  }

  /**
   * Get the page at a given y position. If there are multiple pages
   * overlapping the given y-coordinate, return the page with the smallest
   * index.
   * @param {number} y The y-coordinate to get the page at.
   * @return {number} The index of a page overlapping the given y-coordinate.
   * @private
   */
  getPageAtY_(y) {
    let min = 0;
    let max = this.pageDimensions_.length - 1;
    while (max >= min) {
      const page = Math.floor(min + ((max - min) / 2));
      // There might be a gap between the pages, in which case use the bottom
      // of the previous page as the top for finding the page.
      let top = 0;
      if (page > 0) {
        top = this.pageDimensions_[page - 1].y +
            this.pageDimensions_[page - 1].height;
      }
      const bottom =
          this.pageDimensions_[page].y + this.pageDimensions_[page].height;

      if (top <= y && bottom > y) {
        return page;
      }

      if (top > y) {
        max = page - 1;
      } else {
        min = page + 1;
      }
    }
    return 0;
  }

  /**
   * Return the last page visible in the viewport. Returns the last index of the
   * document if the viewport is below the document.
   * @param {!ViewportRect} viewportRect
   * @return {number} The highest index of the pages visible in the viewport.
   * @private
   */
  getLastPageInViewport_(viewportRect) {
    const pageAtY = this.getPageAtY_(viewportRect.y + viewportRect.height);

    if (!this.twoUpView_ || pageAtY % 2 == 1 ||
        pageAtY + 1 >= this.pageDimensions_.length) {
      return pageAtY;
    }

    const nextPage = this.pageDimensions_[pageAtY + 1];
    return getIntersectionArea(viewportRect, nextPage) > 0 ? pageAtY + 1 :
                                                             pageAtY;
  }

  /**
   * @param {!Point} point
   * @return {boolean} Whether |point| (in screen coordinates) is inside a page
   */
  isPointInsidePage(point) {
    const zoom = this.getZoom();
    const size = this.size;
    const position = this.position;
    const page = this.getPageAtY_((position.y + point.y) / zoom);
    const pageWidth = this.pageDimensions_[page].width * zoom;
    const documentWidth = this.getDocumentDimensions().width * zoom;

    const outerWidth = Math.max(size.width, documentWidth);

    if (pageWidth >= outerWidth) {
      return true;
    }

    const x = point.x + position.x;

    const minX = (outerWidth - pageWidth) / 2;
    const maxX = outerWidth - minX;
    return x >= minX && x <= maxX;
  }

  /**
   * @return {number} The index of the page with the greatest proportion of its
   *     area in the current viewport.
   */
  getMostVisiblePage() {
    const viewportRect = this.getViewportRect_();

    const firstVisiblePage = this.getPageAtY_(viewportRect.y);
    const lastPossibleVisiblePage = this.getLastPageInViewport_(viewportRect);
    if (firstVisiblePage === lastPossibleVisiblePage) {
      return firstVisiblePage;
    }

    let mostVisiblePage = firstVisiblePage;
    let largestIntersection = 0;

    for (let i = firstVisiblePage; i < lastPossibleVisiblePage + 1; i++) {
      const pageArea =
          this.pageDimensions_[i].width * this.pageDimensions_[i].height;

      // TODO(thestig): check whether we can remove this check.
      if (pageArea <= 0) {
        continue;
      }

      const pageIntersectionArea =
          getIntersectionArea(this.pageDimensions_[i], viewportRect) / pageArea;

      if (pageIntersectionArea > largestIntersection) {
        mostVisiblePage = i;
        largestIntersection = pageIntersectionArea;
      }
    }

    return mostVisiblePage;
  }

  /**
   * Returns the page Indexes of the pages which are visible in the viewport
   * We are using the viewport's "logical" space to find the pages
   * returns firstVisiblePage, lastVisiblePage as indices of the first
   * and last visible contiguous page in the viewport
   */
  getVisiblePageRange() {
    const firstVisiblePage = this.getPageAtY_(this.position.y / this.getZoom());
    const viewportBottom = (this.position.y + this.size.height) / this.getZoom();
    let lastVisiblePage = this.pageDimensions_.length - 1;
    const lastPageBottom =
        this.pageDimensions_[this.pageDimensions_.length - 1].y +
        this.pageDimensions_[this.pageDimensions_.length - 1].height;
    if (viewportBottom <= lastPageBottom) {
      lastVisiblePage = this.getPageAtY_(viewportBottom);
    }
    return [firstVisiblePage, lastVisiblePage];
  }

  /**
   * Compute the zoom level for fit-to-page, fit-to-width or fit-to-height.
   * At least one of {fitWidth, fitHeight} must be true.
   * @param {!Size} pageDimensions The dimensions of a given page in px.
   * @param {boolean} fitWidth Whether the whole width of the page needs to be
   *     in the viewport.
   * @param {boolean} fitHeight Whether the whole height of the page needs to be
   *     in the viewport.
   * @return {number} The internal zoom to set
   * @private
   */
  computeFittingZoom_(pageDimensions, fitWidth, fitHeight) {
    assert(
        fitWidth || fitHeight,
        'Invalid parameters. At least one of fitWidth and fitHeight must be ' +
            'true.');

    // First compute the zoom without scrollbars.
    const windowHeight = this.window_.innerHeight - this.embedTopOffset_;
    let zoom = this.computeFittingZoomGivenDimensions_(
        fitWidth, fitHeight, this.window_.innerWidth, windowHeight,
        pageDimensions.width, pageDimensions.height);

    // Check if there needs to be any scrollbars.
    const needsScrollbars = this.documentNeedsScrollbars_(zoom);

    // If the document fits, just return the zoom.
    if (!needsScrollbars.horizontal && !needsScrollbars.vertical) {
      return zoom;
    }

    const zoomedDimensions = this.getZoomedDocumentDimensions_(zoom);

    // Check if adding a scrollbar will result in needing the other scrollbar.
    const scrollbarWidth = this.scrollbarWidth_;
    if (needsScrollbars.horizontal &&
        zoomedDimensions.height > windowHeight - scrollbarWidth) {
      needsScrollbars.vertical = true;
    }
    if (needsScrollbars.vertical &&
        zoomedDimensions.width > this.window_.innerWidth - scrollbarWidth) {
      needsScrollbars.horizontal = true;
    }

    // Compute available window space.
    const windowWithScrollbars = {
      width: this.window_.innerWidth,
      height: windowHeight
    };
    if (needsScrollbars.horizontal) {
      windowWithScrollbars.height -= scrollbarWidth;
    }
    if (needsScrollbars.vertical) {
      windowWithScrollbars.width -= scrollbarWidth;
    }

    // Recompute the zoom.
    zoom = this.computeFittingZoomGivenDimensions_(
        fitWidth, fitHeight, windowWithScrollbars.width,
        windowWithScrollbars.height, pageDimensions.width,
        pageDimensions.height);

    return this.zoomManager_.internalZoomComponent(zoom);
  }

  /**
   * Compute a zoom level given the dimensions to fit and the actual numbers
   * in those dimensions.
   * @param {boolean} fitWidth Whether to constrain the page width to the
   *     window.
   * @param {boolean} fitHeight Whether to constrain the page height to the
   *     window.
   * @param {number} windowWidth Width of the window in px.
   * @param {number} windowHeight Height of the window in px.
   * @param {number} pageWidth Width of the page in px.
   * @param {number} pageHeight Height of the page in px.
   * @return {number} The internal zoom to set
   * @private
   */
  computeFittingZoomGivenDimensions_(
      fitWidth, fitHeight, windowWidth, windowHeight, pageWidth, pageHeight) {
    // Assumes at least one of {fitWidth, fitHeight} is set.
    let zoomWidth;
    let zoomHeight;

    if (fitWidth) {
      zoomWidth = windowWidth / pageWidth;
    }

    if (fitHeight) {
      zoomHeight = windowHeight / pageHeight;
    }

    let zoom;
    if (!fitWidth && fitHeight) {
      zoom = zoomHeight;
    } else if (fitWidth && !fitHeight) {
      zoom = zoomWidth;
    } else {
      // Assume fitWidth && fitHeight
      zoom = Math.min(zoomWidth, zoomHeight);
    }

    return Math.max(zoom, 0);
  }

  /** Zoom the viewport so that the page width consumes the entire viewport. */
  fitToWidth() {
    this.mightZoom_(() => {
      if (!this.documentDimensions_) {
        return;
      }
      this.fittingType_ = FittingType.FIT_TO_WIDTH;
      this.isFitToChanged_ = true;
      // When computing fit-to-width, the maximum width of a page in the
      // document is used, which is equal to the size of the document width.
      this.setZoomInternal_(
          this.computeFittingZoom_(this.documentDimensions_, true, false));
      this.updateViewport_();
    });
  }

  /**
   * Zoom the viewport so that the page height consumes the entire viewport.
   * @param {boolean} scrollToTopOfPage Set to true if the viewport should be
   *     scrolled to the top of the current page. Set to false if the viewport
   *     should remain at the current scroll position.
   * @private
   */
  fitToHeightInternal_(scrollToTopOfPage) {
    this.mightZoom_(() => {
      if (!this.documentDimensions_) {
        return;
      }
      this.fittingType_ = FittingType.FIT_TO_HEIGHT;
      this.isFitToChanged_ = true;
      const page = this.getMostVisiblePage();
      // When computing fit-to-height, the maximum height of the current page
      // is used.
      const dimensions = {
        width: 0,
        height: this.pageDimensions_[page].height,
      };
      this.setZoomInternal_(this.computeFittingZoom_(dimensions, false, true));
      if (scrollToTopOfPage) {
        this.position = {
          x: 0,
          y: this.pageDimensions_[page].y * this.getZoom()
        };
      }
      this.updateViewport_();
    });
  }

  /** Zoom the viewport so that the page height consumes the entire viewport. */
  fitToHeight() {
    this.fitToHeightInternal_(true);
  }

  /**
   * Zoom the viewport so that a page consumes as much as possible of the it.
   * @param {boolean} scrollToTopOfPage Whether the viewport should be scrolled
   *     to the top of the current page. If false, the viewport will remain at
   *     the current scroll position.
   * @private
   */
  fitToPageInternal_(scrollToTopOfPage) {
    this.mightZoom_(() => {
      if (!this.documentDimensions_) {
        return;
      }
      this.fittingType_ = FittingType.FIT_TO_PAGE;
      this.isFitToChanged_ = true;
      const page = this.getMostVisiblePage();
      // Fit to the current page's height and the widest page's width.
      const dimensions = {
        width: this.documentDimensions_.width,
        height: this.pageDimensions_[page].height,
      };
      this.setZoomInternal_(this.computeFittingZoom_(dimensions, true, true));
      if (scrollToTopOfPage) {
        this.position = {
          x: 0,
          y: this.pageDimensions_[page].y * this.getZoom()
        };
      }
      this.updateViewport_();
    });
  }

  /**
   * Zoom the viewport so that a page consumes the entire viewport. Also scrolls
   * the viewport to the top of the current page.
   */
  fitToPage() {
    this.fitToPageInternal_(true);
  }

  /** Zoom the viewport to the default zoom. */
  fitToNone() {
    this.mightZoom_(() => {
      if (!this.documentDimensions_) {
        return;
      }
      this.fittingType_ = FittingType.NONE;
      this.isFitToChanged_ = true;
      this.setZoomInternal_(Math.min(
          this.defaultZoom_,
          this.computeFittingZoom_(this.documentDimensions_, true, false)));
      this.updateViewport_();
    });
  }

  /** Zoom out to the next predefined zoom level. */
  zoomOut() {
    this.mightZoom_(() => {
      this.fittingType_ = FittingType.NONE;
      let nextZoom = Viewport.ZOOM_FACTORS[0];
      for (let i = 0; i < Viewport.ZOOM_FACTORS.length; i++) {
        if (Viewport.ZOOM_FACTORS[i] < this.internalZoom_) {
          nextZoom = Viewport.ZOOM_FACTORS[i];
        }
      }
      this.setZoomInternal_(nextZoom);
      this.updateViewport_();
    });
  }

  /** Zoom in to the next predefined zoom level. */
  zoomIn() {
    this.mightZoom_(() => {
      this.fittingType_ = FittingType.NONE;
      let nextZoom = Viewport.ZOOM_FACTORS[Viewport.ZOOM_FACTORS.length - 1];
      for (let i = Viewport.ZOOM_FACTORS.length - 1; i >= 0; i--) {
        if (Viewport.ZOOM_FACTORS[i] > this.internalZoom_) {
          nextZoom = Viewport.ZOOM_FACTORS[i];
        }
      }
      this.setZoomInternal_(nextZoom);
      this.updateViewport_();
    });
  }

  /**
   * Pinch zoom event handler.
   * @param {!Object} e The pinch event.
   */
  pinchZoom(e) {
    this.mightZoom_(() => {
      this.pinchPhase_ = e.direction == 'out' ?
          Viewport.PinchPhase.PINCH_UPDATE_ZOOM_OUT :
          Viewport.PinchPhase.PINCH_UPDATE_ZOOM_IN;

      const scaleDelta = e.startScaleRatio / this.prevScale_;
      if (this.firstPinchCenterInFrame_ != null) {
        this.pinchPanVector_ =
            vectorDelta(e.center, this.firstPinchCenterInFrame_);
      }

      const needsScrollbars =
          this.documentNeedsScrollbars_(this.zoomManager_.applyBrowserZoom(
              clampZoom(this.internalZoom_ * scaleDelta)));

      this.pinchCenter_ = e.center;

      // If there's no horizontal scrolling, keep the content centered so the
      // user can't zoom in on the non-content area.
      // TODO(mcnee) Investigate other ways of scaling when we don't have
      // horizontal scrolling. We want to keep the document centered,
      // but this causes a potentially awkward transition when we start
      // using the gesture center.
      if (!needsScrollbars.horizontal) {
        this.pinchCenter_ = {
          x: this.window_.innerWidth / 2,
          y: this.window_.innerHeight / 2
        };
      } else if (this.keepContentCentered_) {
        this.oldCenterInContent_ =
            this.frameToContent_(frameToPluginCoordinate(e.center));
        this.keepContentCentered_ = false;
      }

      this.setPinchZoomInternal_(scaleDelta, frameToPluginCoordinate(e.center));
      this.updateViewport_();
      this.prevScale_ = e.startScaleRatio;
    });
  }

  /** @param {!Object} e The pinch event. */
  pinchZoomStart(e) {
    this.pinchPhase_ = Viewport.PinchPhase.PINCH_START;
    this.prevScale_ = 1;
    this.oldCenterInContent_ =
        this.frameToContent_(frameToPluginCoordinate(e.center));

    const needsScrollbars = this.documentNeedsScrollbars_(this.getZoom());
    this.keepContentCentered_ = !needsScrollbars.horizontal;
    // We keep track of begining of the pinch.
    // By doing so we will be able to compute the pan distance.
    this.firstPinchCenterInFrame_ = e.center;
  }

  /** @param {!Object} e The pinch event. */
  pinchZoomEnd(e) {
    this.mightZoom_(() => {
      this.pinchPhase_ = Viewport.PinchPhase.PINCH_END;
      const scaleDelta = e.startScaleRatio / this.prevScale_;
      this.pinchCenter_ = /** @type {!Point} */ (e.center);

      this.setPinchZoomInternal_(scaleDelta, frameToPluginCoordinate(e.center));
      this.updateViewport_();
    });

    this.pinchPhase_ = Viewport.PinchPhase.PINCH_NONE;
    this.pinchPanVector_ = null;
    this.pinchCenter_ = null;
    this.firstPinchCenterInFrame_ = null;
  }

  /**
   * Go to the next page. If the document is in two-up view, go to the left page
   * of the next row.
   */
  goToNextPage() {
    const currentPage = this.getMostVisiblePage();
    const nextPageOffset = (this.twoUpView_ && currentPage % 2 == 0) ? 2 : 1;
    this.goToPage(currentPage + nextPageOffset);
  }

  /**
   * Go to the previous page. If the document is in two-up view, go to the left
   * page of the previous row.
   */
  goToPreviousPage() {
    const currentPage = this.getMostVisiblePage();
    let previousPageOffset = -1;

    if (this.twoUpView_) {
      previousPageOffset = (currentPage % 2 == 0) ? -2 : -3;
    }

    this.goToPage(currentPage + previousPageOffset);
  }

  /**
   * Go to the given page index.
   * @param {number} page the index of the page to go to. zero-based.
   */
  goToPage(page) {
    this.goToPageAndXY(page, 0, 0);
  }

  /**
   * Go to the given y position in the given page index.
   * @param {number} page the index of the page to go to. zero-based.
   * @param {number} x the x position in the page to go to.
   * @param {number} y the y position in the page to go to.
   */
  goToPageAndXY(page, x, y) {
    this.mightZoom_(() => {
      if (this.pageDimensions_.length === 0) {
        return;
      }
      if (page < 0) {
        page = 0;
      }
      if (page >= this.pageDimensions_.length) {
        page = this.pageDimensions_.length - 1;
      }
      const dimensions = this.pageDimensions_[page];
      let initialOffset = 0;
      // Unless we're in fit to page or fit to height mode, scroll above the
      // page by |this.firstPageSeparator_|
      if (!this.isPagedMode()) {
        initialOffset = this.firstPageSeparator_;
      }
      this.position = {
        x: (dimensions.x + x) * this.getZoom(),
        y: (dimensions.y + y) * this.getZoom() - initialOffset
      };
      this.updateViewport_();
    });
  }

  /**
   * @param {DocumentDimensions} documentDimensions The dimensions of the
   *     document
   */
  setDocumentDimensions(documentDimensions) {
    this.mightZoom_(() => {
      const initialDimensions = !this.documentDimensions_;
      this.documentDimensions_ = documentDimensions;
      this.pageDimensions_ = this.documentDimensions_.pageDimensions;
      if (initialDimensions) {
        this.setZoomInternal_(Math.min(
            this.defaultZoom_,
            this.computeFittingZoom_(this.documentDimensions_, true, false)));
        this.position = {x: 0, y: -this.firstPageSeparator_};
      }
      this.contentSizeChanged_();
      this.resize_();
    });
  }

  /**
   * @param {number} page
   * @return {ViewportRect} The bounds for page `page` minus the shadows.
   */
  getPageInsetDimensions(page) {
    const pageDimensions = this.pageDimensions_[page];
    const shadow = Viewport.PAGE_SHADOW;
    return {
      x: pageDimensions.x + shadow.left,
      y: pageDimensions.y + shadow.top,
      width: pageDimensions.width - shadow.left - shadow.right,
      height: pageDimensions.height - shadow.top - shadow.bottom,
    };
  }

  /**
   * Get the coordinates of the page contents (excluding the page shadow)
   * relative to the screen.
   * @param {number} page The index of the page to get the rect for.
   * @return {!ViewportRect} A rect representing the page in screen coordinates.
   */
  getPageScreenRect(page) {
    if (!this.documentDimensions_) {
      return {x: 0, y: 0, width: 0, height: 0};
    }
    if (page >= this.pageDimensions_.length) {
      page = this.pageDimensions_.length - 1;
    }

    const pageDimensions = this.pageDimensions_[page];

    // Compute the page dimensions minus the shadows.
    const insetDimensions = this.getPageInsetDimensions(page);

    // Compute the x-coordinate of the page within the document.
    // TODO(raymes): This should really be set when the PDF plugin passes the
    // page coordinates, but it isn't yet.
    const x = (this.documentDimensions_.width - pageDimensions.width) / 2 +
        Viewport.PAGE_SHADOW.left;
    // Compute the space on the left of the document if the document fits
    // completely in the screen.
    const zoom = this.getZoom();
    let spaceOnLeft =
        (this.size.width - this.documentDimensions_.width * zoom) / 2;
    spaceOnLeft = Math.max(spaceOnLeft, 0);

    return {
      x: x * zoom + spaceOnLeft - this.window_.pageXOffset,
      y: insetDimensions.y * zoom - this.window_.pageYOffset +
          this.embedTopOffset_,
      width: insetDimensions.width * zoom,
      height: insetDimensions.height * zoom
    };
  }

  /**
   * Check if the current fitting type is a paged mode.
   * In a paged mode, page up and page down scroll to the top of the
   * previous/next page and part of the page is under the toolbar.
   * @return {boolean} Whether the current fitting type is a paged mode.
   */
  isPagedMode() {
    return (
        this.fittingType_ == FittingType.FIT_TO_PAGE ||
        this.fittingType_ == FittingType.FIT_TO_HEIGHT);
  }

  /** @param {!Point} point The position to which to scroll the viewport. */
  scrollTo(point) {
    let changed = false;
    const newPosition = this.position;
    if (point.x !== undefined && point.x != newPosition.x) {
      newPosition.x = point.x;
      changed = true;
    }
    if (point.y !== undefined && point.y != newPosition.y) {
      newPosition.y = point.y;
      changed = true;
    }

    if (changed) {
      this.position = newPosition;
    }
  }

  /** @param {!Point} delta The delta by which to scroll the viewport. */
  scrollBy(delta) {
    const newPosition = this.position;
    newPosition.x += delta.x;
    newPosition.y += delta.y;
    this.scrollTo(newPosition);
  }

  /** Removes all events being tracked from the tracker. */
  resetTracker() {
    if (this.tracker_) {
      this.tracker_.removeAll();
    }
  }
}

/**
 * Enumeration of pinch states.
 * This should match PinchPhase enum in pdf/out_of_process_instance.h
 * @enum {number}
 */
Viewport.PinchPhase = {
  PINCH_NONE: 0,
  PINCH_START: 1,
  PINCH_UPDATE_ZOOM_OUT: 2,
  PINCH_UPDATE_ZOOM_IN: 3,
  PINCH_END: 4
};

/**
 * The increment to scroll a page by in pixels when up/down/left/right arrow
 * keys are pressed. Usually we just let the browser handle scrolling on the
 * window when these keys are pressed but in certain cases we need to simulate
 * these events.
 */
Viewport.SCROLL_INCREMENT = 40;

/**
 * Predefined zoom factors to be used when zooming in/out. These are in
 * ascending order. This should match the lists in
 * components/zoom/page_zoom_constants.h and
 * chrome/browser/resources/settings/appearance_page/appearance_page.js
 */
Viewport.ZOOM_FACTORS = [
  0.25, 1 / 3, 0.5, 2 / 3, 0.75, 0.8, 0.9, 1, 1.1, 1.25, 1.5, 1.75, 2, 2.5, 3,
  4, 5
];

/** The minimum and maximum range to be used to clip zoom factor. */
Viewport.ZOOM_FACTOR_RANGE = {
  min: Viewport.ZOOM_FACTORS[0],
  max: Viewport.ZOOM_FACTORS[Viewport.ZOOM_FACTORS.length - 1]
};

/** The width of the page shadow around pages in pixels. */
Viewport.PAGE_SHADOW = {
  top: 3,
  bottom: 7,
  left: 5,
  right: 5
};
// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * Parses the open pdf parameters passed in the url to set initial viewport
 * settings for opening the pdf.
 */
class OpenPdfParamsParser {
  /**
   * @param {function(Object)} postMessageCallback
   *     Function called to fetch information for a named destination.
   */
  constructor(postMessageCallback) {
    /** @private {!Array<!Object>} */
    this.outstandingRequests_ = [];

    /** @private {!function(Object)} */
    this.postMessageCallback_ = postMessageCallback;
  }

  /**
   * Parse zoom parameter of open PDF parameters. The PDF should be opened at
   * the specified zoom level.
   *
   * @param {string} paramValue zoom value.
   * @return {Object} Map with zoom parameters (zoom and position).
   * @private
   */
  parseZoomParam_(paramValue) {
    const paramValueSplit = paramValue.split(',');
    if (paramValueSplit.length != 1 && paramValueSplit.length != 3) {
      return {};
    }

    // User scale of 100 means zoom value of 100% i.e. zoom factor of 1.0.
    const zoomFactor = parseFloat(paramValueSplit[0]) / 100;
    if (Number.isNaN(zoomFactor)) {
      return {};
    }

    // Handle #zoom=scale.
    if (paramValueSplit.length == 1) {
      return {'zoom': zoomFactor};
    }

    // Handle #zoom=scale,left,top.
    const position = {
      x: parseFloat(paramValueSplit[1]),
      y: parseFloat(paramValueSplit[2])
    };
    return {'position': position, 'zoom': zoomFactor};
  }

  /**
   * Parse view parameter of open PDF parameters. The PDF should be opened at
   * the specified fitting type mode and position.
   *
   * @param {string} paramValue view value.
   * @return {Object} Map with view parameters (view and viewPosition).
   * @private
   */
  parseViewParam_(paramValue) {
    const viewModeComponents = paramValue.toLowerCase().split(',');
    if (viewModeComponents.length < 1) {
      return {};
    }

    const params = {};
    const viewMode = viewModeComponents[0];
    let acceptsPositionParam;
    if (viewMode === 'fit') {
      params['view'] = FittingType.FIT_TO_PAGE;
      acceptsPositionParam = false;
    } else if (viewMode === 'fith') {
      params['view'] = FittingType.FIT_TO_WIDTH;
      acceptsPositionParam = true;
    } else if (viewMode === 'fitv') {
      params['view'] = FittingType.FIT_TO_HEIGHT;
      acceptsPositionParam = true;
    }

    if (!acceptsPositionParam || viewModeComponents.length < 2) {
      return params;
    }

    const position = parseFloat(viewModeComponents[1]);
    if (!Number.isNaN(position)) {
      params['viewPosition'] = position;
    }

    return params;
  }

  /**
   * Parse the parameters encoded in the fragment of a URL into a dictionary.
   *
   * @param {string} url to parse
   * @return {Object} Key-value pairs of URL parameters
   * @private
   */
  parseUrlParams_(url) {
    const params = {};

    const paramIndex = url.search('#');
    if (paramIndex == -1) {
      return params;
    }

    const paramTokens = url.substring(paramIndex + 1).split('&');
    if ((paramTokens.length == 1) && (paramTokens[0].search('=') == -1)) {
      // Handle the case of http://foo.com/bar#NAMEDDEST. This is not
      // explicitly mentioned except by example in the Adobe
      // "PDF Open Parameters" document.
      params['nameddest'] = paramTokens[0];
      return params;
    }

    for (const paramToken of paramTokens) {
      const keyValueSplit = paramToken.split('=');
      if (keyValueSplit.length != 2) {
        continue;
      }
      params[keyValueSplit[0]] = keyValueSplit[1];
    }

    return params;
  }

  /**
   * Parse PDF url parameters used for controlling the state of UI. These need
   * to be available when the UI is being initialized, rather than when the PDF
   * is finished loading.
   *
   * @param {string} url that needs to be parsed.
   * @return {Object} parsed url parameters.
   */
  getUiUrlParams(url) {
    const params = this.parseUrlParams_(url);
    const uiParams = {toolbar: true};

    if ('toolbar' in params && params['toolbar'] == 0) {
      uiParams.toolbar = false;
    }

    return uiParams;
  }

  /**
   * Parse PDF url parameters. These parameters are mentioned in the url
   * and specify actions to be performed when opening pdf files.
   * See http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/
   * pdfs/pdf_open_parameters.pdf for details.
   *
   * @param {string} url that needs to be parsed.
   * @param {Function} callback function to be called with viewport info.
   */
  getViewportFromUrlParams(url, callback) {
    const params = {};
    params['url'] = url;

    const urlParams = this.parseUrlParams_(url);

    if ('page' in urlParams) {
      // |pageNumber| is 1-based, but goToPage() take a zero-based page number.
      const pageNumber = parseInt(urlParams['page'], 10);
      if (!Number.isNaN(pageNumber) && pageNumber > 0) {
        params['page'] = pageNumber - 1;
      }
    }

    if ('view' in urlParams) {
      Object.assign(params, this.parseViewParam_(urlParams['view']));
    }

    if ('zoom' in urlParams) {
      Object.assign(params, this.parseZoomParam_(urlParams['zoom']));
    }

    if (params.page === undefined && 'nameddest' in urlParams) {
      this.outstandingRequests_.push({callback: callback, params: params});
      this.postMessageCallback_({
        type: 'getNamedDestination',
        namedDestination: urlParams['nameddest']
      });
    } else {
      callback(params);
    }
  }

  /**
   * This is called when a named destination is received and the page number
   * corresponding to the request for which a named destination is passed.
   *
   * @param {number} pageNumber The page corresponding to the named destination
   *    requested.
   */
  onNamedDestinationReceived(pageNumber) {
    const outstandingRequest = this.outstandingRequests_.shift();
    if (pageNumber != -1) {
      outstandingRequest.params.page = pageNumber;
    }
    outstandingRequest.callback(outstandingRequest.params);
  }
}
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * NavigatorDelegate for calling browser-specific functions to do the actual
 * navigating.
 */
class NavigatorDelegate {
  /**
   * @param {number} tabId The tab ID of the PDF viewer or -1 if the viewer is
   *     not displayed in a tab.
   */
  constructor(tabId) {
    /** @private {number} */
    this.tabId_ = tabId;
  }

  /**
   * Called when navigation should happen in the current tab.
   * @param {string} url The url to be opened in the current tab.
   */
  navigateInCurrentTab(url) {
    // When the PDFviewer is inside a browser tab, prefer the tabs API because
    // it can navigate from one file:// URL to another.
    if (chrome.tabs && this.tabId_ != -1) {
      chrome.tabs.update(this.tabId_, {url: url});
    } else {
      window.location.href = url;
    }
  }

  /**
   * Called when navigation should happen in the new tab.
   * @param {string} url The url to be opened in the new tab.
   * @param {boolean} active Indicates if the new tab should be the active tab.
   */
  navigateInNewTab(url, active) {
    // Prefer the tabs API because it guarantees we can just open a new tab.
    // window.open doesn't have this guarantee.
    if (chrome.tabs) {
      chrome.tabs.create({url: url, active: active});
    } else {
      window.open(url);
    }
  }

  /**
   * Called when navigation should happen in the new window.
   * @param {string} url The url to be opened in the new window.
   */
  navigateInNewWindow(url) {
    // Prefer the windows API because it guarantees we can just open a new
    // window. window.open with '_blank' argument doesn't have this guarantee.
    if (chrome.windows) {
      chrome.windows.create({url: url});
    } else {
      window.open(url, '_blank');
    }
  }
}

/** Navigator for navigating to links inside or outside the PDF. */
class PdfNavigator {
  /**
   * @param {string} originalUrl The original page URL.
   * @param {!Viewport} viewport The viewport info of the page.
   * @param {!OpenPdfParamsParser} paramsParser The object for URL parsing.
   * @param {!NavigatorDelegate} navigatorDelegate The object with callback
   *    functions that get called when navigation happens in the current tab,
   *    a new tab, and a new window.
   */
  constructor(originalUrl, viewport, paramsParser, navigatorDelegate) {
    /** @private {?URL} */
    this.originalUrl_ = null;
    try {
      this.originalUrl_ = new URL(originalUrl);
    } catch (err) {
      console.warn('Invalid original URL');
    }

    /** @private {!Viewport} */
    this.viewport_ = viewport;

    /** @private {!OpenPdfParamsParser} */
    this.paramsParser_ = paramsParser;

    /** @private {!NavigatorDelegate} */
    this.navigatorDelegate_ = navigatorDelegate;
  }

  /**
   * Function to navigate to the given URL. This might involve navigating
   * within the PDF page or opening a new url (in the same tab or a new tab).
   * @param {string} urlString The URL to navigate to.
   * @param {!PdfNavigator.WindowOpenDisposition} disposition The window open
   *     disposition when navigating to the new URL.
   */
  navigate(urlString, disposition) {
    if (urlString.length == 0) {
      return;
    }

    // If |urlFragment| starts with '#', then it's for the same URL with a
    // different URL fragment.
    if (urlString[0] === '#' && this.originalUrl_) {
      // if '#' is already present in |originalUrl| then remove old fragment
      // and add new url fragment.
      const newUrl = new URL(this.originalUrl_.href);
      newUrl.hash = urlString;
      urlString = newUrl.href;
    }

    // If there's no scheme, then take a guess at the scheme.
    if (!urlString.includes('://') && !urlString.includes('mailto:')) {
      urlString = this.guessUrlWithoutScheme_(urlString);
    }

    let url = null;
    try {
      url = new URL(urlString);
    } catch (err) {
      return;
    }

    if (!this.isValidUrl_(url)) {
      return;
    }

    switch (disposition) {
      case PdfNavigator.WindowOpenDisposition.CURRENT_TAB:
        this.paramsParser_.getViewportFromUrlParams(
            url.href, this.onViewportReceived_.bind(this));
        break;
      case PdfNavigator.WindowOpenDisposition.NEW_BACKGROUND_TAB:
        this.navigatorDelegate_.navigateInNewTab(url.href, false);
        break;
      case PdfNavigator.WindowOpenDisposition.NEW_FOREGROUND_TAB:
        this.navigatorDelegate_.navigateInNewTab(url.href, true);
        break;
      case PdfNavigator.WindowOpenDisposition.NEW_WINDOW:
        this.navigatorDelegate_.navigateInNewWindow(url.href);
        break;
      case PdfNavigator.WindowOpenDisposition.SAVE_TO_DISK:
        // TODO(jaepark): Alt + left clicking a link in PDF should
        // download the link.
        this.paramsParser_.getViewportFromUrlParams(
            url.href, this.onViewportReceived_.bind(this));
        break;
      default:
        break;
    }
  }

  /**
   * Function to navigate to the edge:// URLs. This might involve navigating
   * within the PDF page or opening a new url (in the same tab or a new tab).
   * @param {string} url The URL to navigate to.
   * @param {number} disposition The window open disposition when
   *    navigating to the new URL.
   */
  navigateToEdgeUrl(url, disposition) {
    if (url.length == 0) {
      return;
    }
    if (!(url.startsWith('edge://') || (url == 'edge://'))) {
      return;
    }

    switch (disposition) {
      case PdfNavigator.WindowOpenDisposition.CURRENT_TAB:
        this.paramsParser_.getViewportFromUrlParams(
            url, this.onViewportReceived_.bind(this));
        break;
      case PdfNavigator.WindowOpenDisposition.NEW_FOREGROUND_TAB:
        this.navigatorDelegate_.navigateInNewTab(url, true);
        break;
      default:
        break;
    }
  }

  /**
   * Called when the viewport position is received.
   * @param {Object} viewportPosition Dictionary containing the viewport
   *    position.
   * @private
   */
  onViewportReceived_(viewportPosition) {
    let newUrl = null;
    try {
      newUrl = new URL(viewportPosition.url);
    } catch (err) {
    }

    const pageNumber = viewportPosition.page;
    if (pageNumber != undefined && this.originalUrl_ && newUrl &&
        this.originalUrl_.origin === newUrl.origin &&
        this.originalUrl_.pathname === newUrl.pathname) {
      this.viewport_.goToPage(pageNumber);
    } else {
      this.navigatorDelegate_.navigateInCurrentTab(viewportPosition.url);
    }
  }

  /**
   * Checks if the URL starts with a scheme and is not just a scheme.
   * @param {!URL} url The input URL
   * @return {boolean} Whether the url is valid.
   * @private
   */
  isValidUrl_(url) {
    // Make sure |url| starts with a valid scheme.
    const validSchemes = ['http:', 'https:', 'ftp:', 'file:', 'mailto:'];
    if (!validSchemes.includes(url.protocol)) {
      return false;
    }

    // Navigations to file:-URLs are only allowed from file:-URLs.
    if (url.protocol === 'file:' && this.originalUrl_ &&
        this.originalUrl_.protocol !== 'file:') {
      return false;
    }

    return true;
  }

  /**
   * Attempt to figure out what a URL is when there is no scheme.
   * @param {string} url The input URL
   * @return {string} The URL with a scheme or the original URL if it is not
   *     possible to determine the scheme.
   * @private
   */
  guessUrlWithoutScheme_(url) {
    // If the original URL is mailto:, that does not make sense to start with,
    // and neither does adding |url| to it.
    // If the original URL is not a valid URL, this cannot make a valid URL.
    // In both cases, just bail out.
    if (!this.originalUrl_ || this.originalUrl_.protocol === 'mailto:' ||
        !this.isValidUrl_(this.originalUrl_)) {
      return url;
    }

    // Check for absolute paths.
    if (url.startsWith('/')) {
      return this.originalUrl_.origin + url;
    }

    // Check for other non-relative paths.
    // In Adobe Acrobat Reader XI, it looks as though links with less than
    // 2 dot separators in the domain are considered relative links, and
    // those with 2 or more are considered http URLs. e.g.
    //
    // www.foo.com/bar -> http
    // foo.com/bar -> relative link
    if (url.startsWith('\\')) {
      // Prepend so that the relative URL will be correctly computed by new
      // URL() below.
      url = './' + url;
    }
    if (!url.startsWith('.')) {
      const domainSeparatorIndex = url.indexOf('/');
      const domainName = domainSeparatorIndex == -1 ?
          url :
          url.substr(0, domainSeparatorIndex);
      const domainDotCount = (domainName.match(/\./g) || []).length;
      if (domainDotCount >= 2) {
        return 'http://' + url;
      }
    }

    return new URL(url, this.originalUrl_.href).href;
  }
}

/**
 * Represents options when navigating to a new url. C++ counterpart of
 * the enum is in ui/base/window_open_disposition.h. This enum represents
 * the only values that are passed from Plugin.
 * @enum {number}
 */
PdfNavigator.WindowOpenDisposition = {
  CURRENT_TAB: 1,
  NEW_FOREGROUND_TAB: 3,
  NEW_BACKGROUND_TAB: 4,
  NEW_WINDOW: 6,
  SAVE_TO_DISK: 7
};
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * The period of time in milliseconds to wait between updating the viewport
 * position by the scroll velocity.
 *
 * @private
 */
ViewportScroller.DRAG_TIMER_INTERVAL_MS_ = 100;

/**
 * The maximum drag scroll distance per DRAG_TIMER_INTERVAL in pixels.
 *
 * @private
 */
ViewportScroller.MAX_DRAG_SCROLL_DISTANCE_ = 100;

/**
 * Creates a new ViewportScroller.
 * A ViewportScroller scrolls the page in response to drag selection with the
 * mouse.
 *
 * @param {Object} viewport The viewport info of the page.
 * @param {Object} plugin The PDF plugin element.
 * @param {Object} window The window containing the viewer.
 * @constructor
 */
function ViewportScroller(viewport, plugin, window) {
  this.viewport_ = viewport;
  this.plugin_ = plugin;
  this.window_ = window;
  this.mousemoveCallback_ = null;
  this.timerId_ = null;
  this.scrollVelocity_ = null;
  this.lastFrameTime_ = 0;
}

ViewportScroller.prototype = {
  /**
   * Start scrolling the page by |scrollVelocity_| every
   * |DRAG_TIMER_INTERVAL_MS_|.
   *
   * @private
   */
  startDragScrollTimer_: function() {
    if (this.timerId_ === null) {
      this.timerId_ = this.window_.setInterval(
          this.dragScrollPage_.bind(this),
          ViewportScroller.DRAG_TIMER_INTERVAL_MS_);
      this.lastFrameTime_ = Date.now();
    }
  },

  /**
   * Stops the drag scroll timer if it is active.
   *
   * @private
   */
  stopDragScrollTimer_: function() {
    if (this.timerId_ !== null) {
      this.window_.clearInterval(this.timerId_);
      this.timerId_ = null;
      this.lastFrameTime_ = 0;
    }
  },

  /**
   * Scrolls the viewport by the current scroll velocity.
   *
   * @private
   */
  dragScrollPage_: function() {
    const position = this.viewport_.position;
    const currentFrameTime = Date.now();
    const timeAdjustment = (currentFrameTime - this.lastFrameTime_) /
        ViewportScroller.DRAG_TIMER_INTERVAL_MS_;
    position.y += (this.scrollVelocity_.y * timeAdjustment);
    position.x += (this.scrollVelocity_.x * timeAdjustment);
    this.viewport_.position = position;
    this.lastFrameTime_ = currentFrameTime;
  },

  /**
   * Calculate the velocity to scroll while dragging using the distance of the
   * cursor outside the viewport.
   *
   * @param {Object} event The mousemove event.
   * @return {Object} Object with x and y direction scroll velocity.
   * @private
   */
  calculateVelocity_: function(event) {
    const x =
        Math.min(
            Math.max(
                -event.offsetX, event.offsetX - this.plugin_.offsetWidth, 0),
            ViewportScroller.MAX_DRAG_SCROLL_DISTANCE_) *
        Math.sign(event.offsetX);
    const y =
        Math.min(
            Math.max(
                -event.offsetY, event.offsetY - this.plugin_.offsetHeight, 0),
            ViewportScroller.MAX_DRAG_SCROLL_DISTANCE_) *
        Math.sign(event.offsetY);
    return {x: x, y: y};
  },

  /**
   * Handles mousemove events. It updates the scroll velocity and starts and
   * stops timer based on scroll velocity.
   *
   * @param {Object} event The mousemove event.
   * @private
   */
  onMousemove_: function(event) {
    this.scrollVelocity_ = this.calculateVelocity_(event);
    if (!this.scrollVelocity_.x && !this.scrollVelocity_.y) {
      this.stopDragScrollTimer_();
    } else if (!this.timerId_) {
      this.startDragScrollTimer_();
    }
  },

  /**
   * Sets whether to scroll the viewport when the mouse is outside the
   * viewport.
   *
   * @param {boolean} isSelecting Represents selection status.
   */
  setEnableScrolling: function(isSelecting) {
    if (isSelecting) {
      if (!this.mousemoveCallback_) {
        this.mousemoveCallback_ = this.onMousemove_.bind(this);
      }
      this.plugin_.addEventListener(
          'mousemove', this.mousemoveCallback_, false);
    } else {
      this.stopDragScrollTimer_();
      if (this.mousemoveCallback_) {
        this.plugin_.removeEventListener(
            'mousemove', this.mousemoveCallback_, false);
      }
    }
  }
};
// Copyright 2014 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * Turn a dictionary received from postMessage into a key event.
 *
 * @param {Object} dict A dictionary representing the key event.
 * @return {Event} A key event.
 */
function DeserializeKeyEvent(dict) {
  const e = document.createEvent('Event');
  e.initEvent('keydown', true, true);
  e.keyCode = dict.keyCode;
  e.code = dict.code;
  e.shiftKey = dict.shiftKey;
  e.ctrlKey = dict.ctrlKey;
  e.altKey = dict.altKey;
  e.metaKey = dict.metaKey;
  e.fromScriptingAPI = true;
  return e;
}

/**
 * Turn a key event into a dictionary which can be sent over postMessage.
 *
 * @param {Event} event A key event.
 * @return {Object} A dictionary representing the key event.
 */
function SerializeKeyEvent(event) {
  return {
    keyCode: event.keyCode,
    code: event.code,
    shiftKey: event.shiftKey,
    ctrlKey: event.ctrlKey,
    altKey: event.altKey,
    metaKey: event.metaKey
  };
}

/**
 * An enum containing a value specifying whether the PDF is currently loading,
 * has finished loading or failed to load.
 * @enum {string}
 */
const LoadState = {
  LOADING: 'loading',
  SUCCESS: 'success',
  FAILED: 'failed'
};

/**
 * Create a new PDFScriptingAPI. This provides a scripting interface to
 * the PDF viewer so that it can be customized by things like print preview.
 *
 * @param {Window} window the window of the page containing the pdf viewer.
 * @param {Object} plugin the plugin element containing the pdf viewer.
 * @constructor
 */
function PDFScriptingAPI(window, plugin) {
  this.loadState_ = LoadState.LOADING;
  this.pendingScriptingMessages_ = [];
  this.setPlugin(plugin);

  window.addEventListener('message', event => {
    if (event.origin != 'chrome-extension://mhjfbmdgcfjbbpaeojofohoefgiehjai' &&
        event.origin != 'edge://print') {
      console.error(
          'Received message that was not from the extension: ' + event);
      return;
    }
    switch (event.data.type) {
      case 'viewport':
        /**
         * @type {{
         *   pageX: number,
         *   pageY: number,
         *   pageWidth: number,
         *   viewportWidth: number,
         *   viewportHeight: number
         * }}
         */
        const viewportData = event.data;
        if (this.viewportChangedCallback_) {
          this.viewportChangedCallback_(
              viewportData.pageX, viewportData.pageY, viewportData.pageWidth,
              viewportData.viewportWidth, viewportData.viewportHeight);
        }
        break;
      case 'documentLoaded': {
        const data = /** @type {{load_state: LoadState}} */ (event.data);
        this.loadState_ = data.load_state;
        if (this.loadCallback_) {
          this.loadCallback_(this.loadState_ == LoadState.SUCCESS);
        }
        break;
      }
      case 'getSelectedTextReply': {
        const data = /** @type {{selectedText: string}} */ (event.data);
        if (this.selectedTextCallback_) {
          this.selectedTextCallback_(data.selectedText);
          this.selectedTextCallback_ = null;
        }
        break;
      }
      case 'getPasswordCallback': {
        if (this.passwordCallback_) {
          /** Sends a Boolean value to denote password dialog box is up */
          this.passwordCallback_(true);
        }
        break;
      }
      case 'getInvalidInputCallback': {
        if (this.invalidInputCallback_) {
          this.invalidInputCallback_();
        }
        break;
      }
      case 'sendKeyEvent':
        if (this.keyEventCallback_) {
          this.keyEventCallback_(DeserializeKeyEvent(event.data.keyEvent));
        }
        break;
    }
  }, false);
}

PDFScriptingAPI.prototype = {
  /**
   * Send a message to the extension. If messages try to get sent before there
   * is a plugin element set, then we queue them up and send them later (this
   * can happen in print preview).
   *
   * @param {Object} message The message to send.
   * @private
   */
  sendMessage_: function(message) {
    if (this.plugin_) {
      this.plugin_.postMessage(message, '*');
    } else {
      this.pendingScriptingMessages_.push(message);
    }
  },

  /**
   * Sets the plugin element containing the PDF viewer. The element will usually
   * be passed into the PDFScriptingAPI constructor but may also be set later.
   *
   * @param {Object} plugin the plugin element containing the PDF viewer.
   */
  setPlugin: function(plugin) {
    this.plugin_ = plugin;

    if (this.plugin_) {
      // Send a message to ensure the postMessage channel is initialized which
      // allows us to receive messages.
      this.sendMessage_({type: 'initialize'});
      // Flush pending messages.
      while (this.pendingScriptingMessages_.length > 0) {
        this.sendMessage_(this.pendingScriptingMessages_.shift());
      }
    }
  },

  /**
   * Sets the callback which will be run when the PDF viewport changes.
   *
   * @param {Function} callback the callback to be called.
   */
  setViewportChangedCallback: function(callback) {
    this.viewportChangedCallback_ = callback;
  },

  /**
   * Sets the callback which will be run when the PDF document has finished
   * loading. If the document is already loaded, it will be run immediately.
   *
   * @param {Function} callback the callback to be called.
   */
  setLoadCallback: function(callback) {
    this.loadCallback_ = callback;
    if (this.loadState_ != LoadState.LOADING && this.loadCallback_) {
      this.loadCallback_(this.loadState_ == LoadState.SUCCESS);
    }
  },

  /**
   * This sets the password callback.
   * Once the password dialog is up the callback is called
   * @param {Function} callback the pdf password
   */
  setPasswordCallback: function(callback) {
    this.passwordCallback_ = callback;
  },

  /**
   * The sets the invalid input callback
   * This means the password sent was checked and found to be wrong
   * @param {Function} callback
   */
  setInvalidInputCallback: function(callback) {
    this.invalidInputCallback_ = callback;
  },

  /**
   * Sets a callback that gets run when a key event is fired in the PDF viewer.
   * @param {Function} callback the callback to be called with a key event.
   */
  setKeyEventCallback: function(callback) {
    this.keyEventCallback_ = callback;
  },

  /**
   * Resets the PDF viewer into print preview mode.
   *
   * @param {string} url the url of the PDF to load.
   * @param {boolean} grayscale whether or not to display the PDF in grayscale.
   * @param {Array<number>} pageNumbers an array of the page numbers.
   * @param {boolean} modifiable whether or not the document is modifiable.
   */
  resetPrintPreviewMode: function(url, grayscale, pageNumbers, modifiable) {
    this.loadState_ = LoadState.LOADING;
    this.sendMessage_({
      type: 'resetPrintPreviewMode',
      url: url,
      grayscale: grayscale,
      pageNumbers: pageNumbers,
      modifiable: modifiable
    });
  },

  /**
   * Hide the toolbars after a delay.
   */
  hideToolbars: function() {
    this.sendMessage_({type: 'hideToolbars'});
  },

  /**
   * Load a page into the document while in print preview mode.
   *
   * @param {string} url the url of the pdf page to load.
   * @param {number} index the index of the page to load.
   */
  loadPreviewPage: function(url, index) {
    this.sendMessage_({type: 'loadPreviewPage', url: url, index: index});
  },

  /** @param {boolean} darkMode Whether the page is in dark mode. */
  darkModeChanged: function(darkMode) {
    this.sendMessage_({type: 'darkModeChanged', darkMode: darkMode});
  },

  /**
   * Select all the text in the document. May only be called after document
   * load.
   */
  selectAll: function() {
    this.sendMessage_({type: 'selectAll'});
  },

  /**
   * Get the selected text in the document. The callback will be called with the
   * text that is selected. May only be called after document load.
   *
   * @param {Function} callback a callback to be called with the selected text.
   * @return {boolean} true if the function is successful, false if there is an
   *     outstanding request for selected text that has not been answered.
   */
  getSelectedText: function(callback) {
    if (this.selectedTextCallback_) {
      return false;
    }
    this.selectedTextCallback_ = callback;
    this.sendMessage_({type: 'getSelectedText'});
    return true;
  },

  /**
   * Print the document. May only be called after document load.
   */
  print: function() {
    this.sendMessage_({type: 'print'});
  },

  /**
   * Send a key event to the extension.
   *
   * @param {Event} keyEvent the key event to send to the extension.
   */
  sendKeyEvent: function(keyEvent) {
    this.sendMessage_(
        {type: 'sendKeyEvent', keyEvent: SerializeKeyEvent(keyEvent)});
  },

  /**
   * @param {number} scrollX The amount to horizontally scroll in pixels.
   * @param {number} scrollY The amount to vertically scroll in pixels.
   */
  scrollPosition: function(scrollX, scrollY) {
    this.sendMessage_({type: 'scrollPosition', x: scrollX, y: scrollY});
  },
};

/**
 * Creates a PDF viewer with a scripting interface. This is basically 1) an
 * iframe which is navigated to the PDF viewer extension and 2) a scripting
 * interface which provides access to various features of the viewer for use
 * by print preview and accessibility.
 *
 * @param {string} src the source URL of the PDF to load initially.
 * @param {string} baseUrl the base URL of the PDF viewer
 * @return {HTMLIFrameElement} the iframe element containing the PDF viewer.
 */
function PDFCreateOutOfProcessPlugin(src, baseUrl) {
  const client = new PDFScriptingAPI(window, null);
  const iframe = assertInstanceof(
      window.document.createElement('iframe'), HTMLIFrameElement);
  // mimeTypeHandler is the root html page PDF extension loads.
  const mimeTypeHandler = "edge_pdf/index.html";
  iframe.setAttribute('src', baseUrl + '/' + mimeTypeHandler + '?' + src);
  // Prevent the frame from being tab-focusable.
  iframe.setAttribute('tabindex', '-1');

  iframe.onload = function() {
    client.setPlugin(iframe.contentWindow);
  };

  // Add the functions to the iframe so that they can be called directly.
  iframe.setViewportChangedCallback =
      client.setViewportChangedCallback.bind(client);
  iframe.setLoadCallback = client.setLoadCallback.bind(client);
  iframe.setKeyEventCallback = client.setKeyEventCallback.bind(client);
  iframe.resetPrintPreviewMode = client.resetPrintPreviewMode.bind(client);
  iframe.loadPreviewPage = client.loadPreviewPage.bind(client);
  iframe.sendKeyEvent = client.sendKeyEvent.bind(client);
  iframe.scrollPosition = client.scrollPosition.bind(client);
  iframe.hideToolbars = client.hideToolbars.bind(client);
  iframe.darkModeChanged = client.darkModeChanged.bind(client);
  return iframe;
}
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * Abstract parent of classes that manage updating the browser
 * with zoom changes and/or updating the viewer's zoom when
 * the browser zoom changes.
 */
class ZoomManager {
  /**
   * @param {function():number} getViewportZoom Callback to get the viewport's
   *     current zoom level.
   * @param {number} initialZoom The initial browser zoom level.
   */
  constructor(getViewportZoom, initialZoom) {
    if (this.constructor === ZoomManager) {
      throw new TypeError('Instantiated abstract class: ZoomManager');
    }

    /** @private {number} */
    this.browserZoom_ = initialZoom;

    /** @private {function():number} */
    this.getViewportZoom_ = getViewportZoom;

    /** @private {!EventTarget} */
    this.eventTarget_ = new cr.EventTarget();
  }

  /** @return {!EventTarget} */
  getEventTarget() {
    return this.eventTarget_;
  }

  /**
   * Creates the appropriate kind of zoom manager given the zoom behavior.
   *
   * @param {BrowserApi.ZoomBehavior} zoomBehavior How to manage zoom.
   * @param {function():number} getViewportZoom A function that gets the current
   *     viewport zoom.
   * @param {function(number):Promise} setBrowserZoomFunction A function that
   *     sets the browser zoom to the provided value.
   * @param {number} initialZoom The initial browser zoom level.
   */
  static create(
      zoomBehavior, getViewportZoom, setBrowserZoomFunction, initialZoom) {
    switch (zoomBehavior) {
      case BrowserApi.ZoomBehavior.MANAGE:
        return new ActiveZoomManager(
            getViewportZoom, setBrowserZoomFunction, initialZoom);
      case BrowserApi.ZoomBehavior.PROPAGATE_PARENT:
        return new EmbeddedZoomManager(getViewportZoom, initialZoom);
      default:
        return new InactiveZoomManager(getViewportZoom, initialZoom);
    }
  }

  /**
   * Invoked when a browser-initiated zoom-level change occurs.
   *
   * @param {number} newZoom the zoom level to zoom to.
   */
  onBrowserZoomChange(newZoom) {}

  /**
   * Invoked when an extension-initiated zoom-level change occurs.
   */
  onPdfZoomChange() {}

  /**
   * Combines the internal pdf zoom and the browser zoom to
   * produce the total zoom level for the viewer.
   *
   * @param {number} internalZoom the zoom level internal to the viewer.
   * @return {number} the total zoom level.
   */
  applyBrowserZoom(internalZoom) {
    return this.browserZoom_ * internalZoom;
  }

  /**
   * Given a zoom level, return the internal zoom level needed to
   * produce that zoom level.
   *
   * @param {number} totalZoom the total zoom level.
   * @return {number} the zoom level internal to the viewer.
   */
  internalZoomComponent(totalZoom) {
    return totalZoom / this.browserZoom_;
  }

  /**
   * Returns whether two numbers are approximately equal.
   *
   * @param {number} a The first number.
   * @param {number} b The second number.
   */
  floatingPointEquals(a, b) {
    const MIN_ZOOM_DELTA = 0.01;
    // If the zoom level is close enough to the current zoom level, don't
    // change it. This avoids us getting into an infinite loop of zoom changes
    // due to floating point error.
    return Math.abs(a - b) <= MIN_ZOOM_DELTA;
  }
}

/**
 * InactiveZoomManager has no control over the browser's zoom
 * and does not respond to browser zoom changes.
 */
class InactiveZoomManager extends ZoomManager {}

/**
 * ActiveZoomManager controls the browser's zoom.
 */
class ActiveZoomManager extends ZoomManager {
  /**
   * Constructs a ActiveZoomManager.
   * @param {function():number} getViewportZoom A function that gets the current
   *     viewport zoom level
   * @param {function(number):Promise} setBrowserZoomFunction A function that
   *     sets the browser zoom to the provided value.
   * @param {number} initialZoom The initial browser zoom level.
   */
  constructor(getViewportZoom, setBrowserZoomFunction, initialZoom) {
    super(getViewportZoom, initialZoom);

    /** @private {function(number):Promise} */
    this.setBrowserZoomFunction_ = setBrowserZoomFunction;

    /** @private {?Promise} */
    this.changingBrowserZoom_ = null;
  }

  /**
   * Invoked when a browser-initiated zoom-level change occurs.
   *
   * @param {number} newZoom the zoom level to zoom to.
   */
  onBrowserZoomChange(newZoom) {
    // If we are changing the browser zoom level, ignore any browser zoom level
    // change events. Either, the change occurred before our update and will be
    // overwritten, or the change being reported is the change we are making,
    // which we have already handled.
    if (this.changingBrowserZoom_) {
      return;
    }

    if (this.floatingPointEquals(this.browserZoom_, newZoom)) {
      return;
    }

    this.browserZoom_ = newZoom;
    this.eventTarget_.dispatchEvent(
        new CustomEvent('set-zoom', {detail: newZoom}));
  }

  /**
   * Invoked when an extension-initiated zoom-level change occurs.
   * @override
   */
  onPdfZoomChange() {
    // If we are already changing the browser zoom level in response to a
    // previous extension-initiated zoom-level change, ignore this zoom change.
    // Once the browser zoom level is changed, we check whether the extension's
    // zoom level matches the most recently sent zoom level.
    if (this.changingBrowserZoom_) {
      return;
    }

    const viewportZoom = this.getViewportZoom_();
    if (this.floatingPointEquals(this.browserZoom_, viewportZoom)) {
      return;
    }

    this.changingBrowserZoom_ =
        this.setBrowserZoomFunction_(viewportZoom).then(() => {
          this.browserZoom_ = viewportZoom;
          this.changingBrowserZoom_ = null;

          // The extension's zoom level may have changed while the browser zoom
          // change was in progress. We call back into onPdfZoomChange to ensure
          // the browser zoom is up to date.
          this.onPdfZoomChange();
        });
  }

  /**
   * Combines the internal pdf zoom and the browser zoom to
   * produce the total zoom level for the viewer.
   *
   * @param {number} internalZoom the zoom level internal to the viewer.
   * @return {number} the total zoom level.
   */
  applyBrowserZoom(internalZoom) {
    // The internal zoom and browser zoom are changed together, so the
    // browser zoom is already applied.
    return internalZoom;
  }

  /**
   * Given a zoom level, return the internal zoom level needed to
   * produce that zoom level.
   *
   * @param {number} totalZoom the total zoom level.
   * @return {number} the zoom level internal to the viewer.
   */
  internalZoomComponent(totalZoom) {
    // The internal zoom and browser zoom are changed together, so the
    // internal zoom is the total zoom.
    return totalZoom;
  }
}

/**
 * This EmbeddedZoomManager responds to changes in the browser zoom,
 * but does not control the browser zoom.
 */
class EmbeddedZoomManager extends ZoomManager {
  /**
   * Invoked when a browser-initiated zoom-level change occurs.
   *
   * @param {number} newZoom the new browser zoom level.
   */
  onBrowserZoomChange(newZoom) {
    const oldZoom = this.browserZoom_;
    this.browserZoom_ = newZoom;
    this.eventTarget_.dispatchEvent(
        new CustomEvent('update-zoom-from-browser', {detail: oldZoom}));
  }
}
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * A class that listens for touch events and produces events when these
 * touches form gestures (e.g. pinching).
 */
class GestureDetector {
  /**
   * @param {!Element} element The element to monitor for touch gestures.
   */
  constructor(element) {
    /** @private {!Element} */
    this.element_ = element;

    this.element_.addEventListener(
        'touchstart',
        /** @type {function(!Event)} */ (this.onTouchStart_.bind(this)),
        {passive: true});

    const boundOnTouch =
        /** @type {function(!Event)} */ (this.onTouch_.bind(this));
    this.element_.addEventListener('touchmove', boundOnTouch, {passive: true});
    this.element_.addEventListener('touchend', boundOnTouch, {passive: true});
    this.element_.addEventListener(
        'touchcancel', boundOnTouch, {passive: true});

    this.element_.addEventListener(
        'wheel',
        /** @type {function(!Event)} */ (this.onWheel_.bind(this)),
        {passive: false});

    this.pinchStartEvent_ = null;
    this.lastTouchTouchesCount_ = 0;

    /** @private {TouchEvent} */
    this.lastEvent_ = null;

    /**
     * The scale relative to the start of the pinch when handling ctrl-wheels.
     * null when there is no ongoing pinch.
     *
     * @private {?number}
     */
    this.accumulatedWheelScale_ = null;
    /**
     * A timeout ID from setTimeout used for sending the pinchend event when
     * handling ctrl-wheels.
     *
     * @private {?number}
     */
    this.wheelEndTimeout_ = null;

    /** @private {!Map<string, !Array<!Function>>} */
    this.listeners_ =
        new Map([['pinchstart', []], ['pinchupdate', []], ['pinchend', []]]);
  }

  /**
   * Add a |listener| to be notified of |type| events.
   *
   * @param {string} type The event type to be notified for.
   * @param {!Function} listener The callback.
   */
  addEventListener(type, listener) {
    if (this.listeners_.has(type)) {
      this.listeners_.get(type).push(listener);
    }
  }

  /**
   * @return {boolean} True if the last touch start was a two finger touch.
   */
  wasTwoFingerTouch() {
    return this.lastTouchTouchesCount_ == 2;
  }

  /**
   * Call the relevant listeners with the given |pinchEvent|.
   *
   * @param {!Object} pinchEvent The event to notify the listeners of.
   * @private
   */
  notify_(pinchEvent) {
    const listeners = this.listeners_.get(pinchEvent.type);

    for (const l of listeners) {
      l(pinchEvent);
    }
  }

  /**
   * The callback for touchstart events on the element.
   *
   * @param {!TouchEvent} event Touch event on the element.
   * @private
   */
  onTouchStart_(event) {
    this.lastTouchTouchesCount_ = event.touches.length;
    if (!this.wasTwoFingerTouch()) {
      return;
    }

    this.pinchStartEvent_ = event;
    this.lastEvent_ = event;
    this.notify_({type: 'pinchstart', center: GestureDetector.center_(event)});
  }

  /**
   * The callback for touch move, end, and cancel events on the element.
   *
   * @param {!TouchEvent} event Touch event on the element.
   * @private
   */
  onTouch_(event) {
    if (!this.pinchStartEvent_) {
      return;
    }

    const lastEvent = /** @type {!TouchEvent} */ (this.lastEvent_);

    // Check if the pinch ends with the current event.
    if (event.touches.length < 2 ||
        lastEvent.touches.length !== event.touches.length) {
      const startScaleRatio =
          GestureDetector.pinchScaleRatio_(lastEvent, this.pinchStartEvent_);
      const center = GestureDetector.center_(lastEvent);
      const endEvent = {
        type: 'pinchend',
        startScaleRatio: startScaleRatio,
        center: center
      };
      this.pinchStartEvent_ = null;
      this.lastEvent_ = null;
      this.notify_(endEvent);
      return;
    }

    const scaleRatio = GestureDetector.pinchScaleRatio_(event, lastEvent);
    const startScaleRatio =
        GestureDetector.pinchScaleRatio_(event, this.pinchStartEvent_);
    const center = GestureDetector.center_(event);
    this.notify_({
      type: 'pinchupdate',
      scaleRatio: scaleRatio,
      direction: scaleRatio > 1.0 ? 'in' : 'out',
      startScaleRatio: startScaleRatio,
      center: center
    });

    this.lastEvent_ = event;
  }

  /**
   * The callback for wheel events on the element.
   *
   * @param {!WheelEvent} event Wheel event on the element.
   * @private
   */
  onWheel_(event) {
    // We handle ctrl-wheels to invoke our own pinch zoom. On Mac, synthetic
    // ctrl-wheels are created from trackpad pinches. We handle these ourselves
    // to prevent the browser's native pinch zoom. We also use our pinch
    // zooming mechanism for handling non-synthetic ctrl-wheels. This allows us
    // to anchor the zoom around the mouse position instead of the scroll
    // position.
    if (!event.ctrlKey) {
      return;
    }

    event.preventDefault();

    const wheelScale = Math.exp(-event.deltaY / 100);
    // Clamp scale changes from the wheel event as they can be
    // quite dramatic for non-synthetic ctrl-wheels.
    const scale = Math.min(1.25, Math.max(0.75, wheelScale));
    const position = {x: event.clientX, y: event.clientY};

    if (this.accumulatedWheelScale_ == null) {
      this.accumulatedWheelScale_ = 1.0;
      this.notify_({type: 'pinchstart', center: position});
    }

    this.accumulatedWheelScale_ *= scale;
    this.notify_({
      type: 'pinchupdate',
      scaleRatio: scale,
      direction: scale > 1.0 ? 'in' : 'out',
      startScaleRatio: this.accumulatedWheelScale_,
      center: position
    });

    // We don't get any phase information for the ctrl-wheels, so we don't know
    // when the gesture ends. We'll just use a timeout to send the pinch end
    // event a short time after the last ctrl-wheel we see.
    if (this.wheelEndTimeout_ != null) {
      window.clearTimeout(this.wheelEndTimeout_);
      this.wheelEndTimeout_ = null;
    }
    const gestureEndDelayMs = 100;
    const endEvent = {
      type: 'pinchend',
      startScaleRatio: this.accumulatedWheelScale_,
      center: position
    };
    this.wheelEndTimeout_ = window.setTimeout(function(endEvent) {
      this.notify_(endEvent);
      this.wheelEndTimeout_ = null;
      this.accumulatedWheelScale_ = null;
    }.bind(this), gestureEndDelayMs, endEvent);
  }

  /**
   * Computes the change in scale between this touch event
   * and a previous one.
   *
   * @param {!TouchEvent} event Latest touch event on the element.
   * @param {!TouchEvent} prevEvent A previous touch event on the element.
   * @return {?number} The ratio of the scale of this event and the
   *     scale of the previous one.
   * @private
   */
  static pinchScaleRatio_(event, prevEvent) {
    const distance1 = GestureDetector.distance_(prevEvent);
    const distance2 = GestureDetector.distance_(event);
    return distance1 === 0 ? null : distance2 / distance1;
  }

  /**
   * Computes the distance between fingers.
   *
   * @param {!TouchEvent} event Touch event with at least 2 touch points.
   * @return {number} Distance between touch[0] and touch[1].
   * @private
   */
  static distance_(event) {
    const touch1 = event.touches[0];
    const touch2 = event.touches[1];
    const dx = touch1.clientX - touch2.clientX;
    const dy = touch1.clientY - touch2.clientY;
    return Math.sqrt(dx * dx + dy * dy);
  }

  /**
   * Computes the midpoint between fingers.
   *
   * @param {!TouchEvent} event Touch event with at least 2 touch points.
   * @return {!Object} Midpoint between touch[0] and touch[1].
   * @private
   */
  static center_(event) {
    const touch1 = event.touches[0];
    const touch2 = event.touches[1];
    return {
      x: (touch1.clientX + touch2.clientX) / 2,
      y: (touch1.clientY + touch2.clientY) / 2
    };
  }
}
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

'use strict';

/**
 * @param {!Object} streamInfo The stream object pointing to the data contained
 *     in the PDF.
 * @return {Promise<number>} A promise that will resolve to the default zoom
 *     factor.
 */
function lookupDefaultZoom(streamInfo) {
  // Webviews don't run in tabs so |streamInfo.tabId| is -1 when running within
  // a webview.
  if (!chrome.tabs || streamInfo.tabId < 0) {
    return Promise.resolve(1);
  }

  return new Promise(function(resolve, reject) {
    chrome.tabs.getZoomSettings(streamInfo.tabId, function(zoomSettings) {
      resolve(zoomSettings.defaultZoomFactor);
    });
  });
}

/**
 * Returns a promise that will resolve to the initial zoom factor
 * upon starting the plugin. This may differ from the default zoom
 * if, for example, the page is zoomed before the plugin is run.
 *
 * @param {!Object} streamInfo The stream object pointing to the data contained
 *     in the PDF.
 * @return {Promise<number>} A promise that will resolve to the initial zoom
 *     factor.
 */
function lookupInitialZoom(streamInfo) {
  // Webviews don't run in tabs so |streamInfo.tabId| is -1 when running within
  // a webview.
  if (!chrome.tabs || streamInfo.tabId < 0) {
    return Promise.resolve(1);
  }

  return new Promise(function(resolve, reject) {
    chrome.tabs.getZoom(streamInfo.tabId, resolve);
  });
}

/**
 * A class providing an interface to the browser.
 */
class BrowserApi {
  /**
   * @param {!Object} streamInfo The stream object which points to the data
   *     contained in the PDF.
   * @param {number} defaultZoom The default browser zoom.
   * @param {number} initialZoom The initial browser zoom
   *     upon starting the plugin.
   * @param {BrowserApi.ZoomBehavior} zoomBehavior How to manage zoom.
   */
  constructor(streamInfo, defaultZoom, initialZoom, zoomBehavior) {
    this.streamInfo_ = streamInfo;
    this.defaultZoom_ = defaultZoom;
    this.initialZoom_ = initialZoom;
    this.zoomBehavior_ = zoomBehavior;
  }

  /**
   * @param {!Object} streamInfo The stream object pointing to the data
   *     contained in the PDF.
   * @param {BrowserApi.ZoomBehavior} zoomBehavior How to manage zoom.
   * @return {Promise<BrowserApi>} A promise to a BrowserApi.
   */
  static create(streamInfo, zoomBehavior) {
    return Promise
        .all([lookupDefaultZoom(streamInfo), lookupInitialZoom(streamInfo)])
        .then(function(zoomFactors) {
          return new BrowserApi(
              streamInfo, zoomFactors[0], zoomFactors[1], zoomBehavior);
        });
  }

  /**
   * @return {Object} The stream info object pointing to the data contained in
   *     the PDF.
   */
  getStreamInfo() {
    return this.streamInfo_;
  }

  /**
   * Sets the browser zoom.
   *
   * @param {number} zoom The zoom factor to send to the browser.
   * @return {Promise} A promise that will be resolved when the browser zoom
   *     has been updated.
   */
  setZoom(zoom) {
    assert(
        this.zoomBehavior_ == BrowserApi.ZoomBehavior.MANAGE,
        'Viewer does not manage browser zoom.');
    return new Promise((resolve, reject) => {
      chrome.tabs.setZoom(this.streamInfo_.tabId, zoom, resolve);
    });
  }

  /**
   * @return {number} The default browser zoom factor.
   */
  getDefaultZoom() {
    return this.defaultZoom_;
  }

  /**
   * @return {number} The initial browser zoom factor.
   */
  getInitialZoom() {
    return this.initialZoom_;
  }

  /**
   * @return {BrowserApi.ZoomBehavior} How to manage zoom.
   */
  getZoomBehavior() {
    return this.zoomBehavior_;
  }

  /**
   * Adds an event listener to be notified when the browser zoom changes.
   *
   * @param {!Function} listener The listener to be called with the new zoom
   *     factor.
   */
  addZoomEventListener(listener) {
    if (!(this.zoomBehavior_ == BrowserApi.ZoomBehavior.MANAGE ||
          this.zoomBehavior_ == BrowserApi.ZoomBehavior.PROPAGATE_PARENT)) {
      return;
    }

    chrome.tabs.onZoomChange.addListener(info => {
      const zoomChangeInfo =
          /** @type {{tabId: number, newZoomFactor: number}} */ (info);
      if (zoomChangeInfo.tabId != this.streamInfo_.tabId) {
        return;
      }
      listener(zoomChangeInfo.newZoomFactor);
    });
  }
}

/**
 * Enumeration of ways to manage zoom changes.
 * @enum {number}
 */
BrowserApi.ZoomBehavior = {
  NONE: 0,
  MANAGE: 1,
  PROPAGATE_PARENT: 2
};

/**
 * Creates a BrowserApi for an extension running as a mime handler.
 *
 * @return {Promise<BrowserApi>} A promise to a BrowserApi instance constructed
 *     using the mimeHandlerPrivate API.
 */
function createBrowserApiForMimeHandlerView() {
  return new Promise(function(resolve, reject) {
           chrome.mimeHandlerPrivate.getStreamInfo(resolve);
         })
      .then(function(streamInfo) {
        const promises = [];
        let zoomBehavior = BrowserApi.ZoomBehavior.NONE;
        if (streamInfo.tabId != -1) {
          zoomBehavior = streamInfo.embedded ?
              BrowserApi.ZoomBehavior.PROPAGATE_PARENT :
              BrowserApi.ZoomBehavior.MANAGE;
          promises.push(new Promise(function(resolve) {
                          chrome.tabs.get(streamInfo.tabId, resolve);
                        }).then(function(tab) {
            if (tab) {
              streamInfo.tabUrl = tab.url;
            }
          }));
        }
        if (zoomBehavior == BrowserApi.ZoomBehavior.MANAGE) {
          promises.push(new Promise(function(resolve) {
            chrome.tabs.setZoomSettings(
                streamInfo.tabId, {mode: 'manual', scope: 'per-tab'}, resolve);
          }));
        }
        return Promise.all(promises).then(function() {
          return BrowserApi.create(streamInfo, zoomBehavior);
        });
      });
}

/**
 * Creates a BrowserApi instance for an extension not running as a mime handler.
 *
 * @return {Promise<BrowserApi>} A promise to a BrowserApi instance constructed
 *     from the URL.
 */
function createBrowserApiForPrintPreview() {
  const url = window.location.search.substring(1);
  const streamInfo = {
    streamUrl: url,
    originalUrl: url,
    responseHeaders: {},
    embedded: window.parent != window,
    tabId: -1,
  };
  return new Promise(function(resolve, reject) {
           if (!chrome.tabs) {
             resolve();
             return;
           }
           chrome.tabs.getCurrent(function(tab) {
             streamInfo.tabId = tab.id;
             streamInfo.tabUrl = tab.url;
             resolve();
           });
         })
      .then(function() {
        return BrowserApi.create(streamInfo, BrowserApi.ZoomBehavior.NONE);
      });
}

/**
 * @return {Promise<BrowserApi>} A promise to a BrowserApi instance for the
 *     current environment.
 */
function createBrowserApi() {
  if (location.origin === 'edge://print') {
    return createBrowserApiForPrintPreview();
  }

  return createBrowserApiForMimeHandlerView();
}
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.


/**
 * Handles events specific to the PDF viewer and logs the corresponding metrics.
 */
class PDFMetrics {
  /**
   * Records when the zoom mode is changed to fit a FittingType.
   *
   * @param {FittingType} fittingType the new FittingType.
   */
  static recordFitTo(fittingType) {
    if (fittingType == FittingType.FIT_TO_PAGE) {
      PDFMetrics.record(PDFMetrics.UserAction.FIT_TO_PAGE);
    } else if (fittingType == FittingType.FIT_TO_WIDTH) {
      PDFMetrics.record(PDFMetrics.UserAction.FIT_TO_WIDTH);
    }
    // There is no user action to do a fit-to-height, this only happens with
    // the open param "view=FitV".
  }

  /**
   * Records the given action to chrome.metricsPrivate.
   *
   * @param {PDFMetrics.UserAction} action
   */
  static record(action) {
    if (!chrome.metricsPrivate) {
      return;
    }
    if (!PDFMetrics.actionsMetric_) {
      PDFMetrics.actionsMetric_ = {
        'metricName': 'PDF.Actions',
        'type': chrome.metricsPrivate.MetricTypeType.HISTOGRAM_LOG,
        'min': 1,
        'max': PDFMetrics.UserAction.NUMBER_OF_ACTIONS,
        'buckets': PDFMetrics.UserAction.NUMBER_OF_ACTIONS + 1
      };
    }
    chrome.metricsPrivate.recordValue(PDFMetrics.actionsMetric_, action);
    if (PDFMetrics.firstMap_.has(action)) {
      const firstAction = PDFMetrics.firstMap_.get(action);
      if (!PDFMetrics.firstActionRecorded_.has(firstAction)) {
        chrome.metricsPrivate.recordValue(
            PDFMetrics.actionsMetric_, firstAction);
        PDFMetrics.firstActionRecorded_.add(firstAction);
      }
    }
  }

  static resetForTesting() {
    PDFMetrics.firstActionRecorded_.clear();
    PDFMetrics.actionsMetric_ = null;
  }
}

/** @private {?chrome.metricsPrivate.MetricType} */
PDFMetrics.actionsMetric_ = null;

/** @private {Set} */
PDFMetrics.firstActionRecorded_ = new Set();

// Keep in sync with enums.xml.
// Do not change the numeric values or reuse them since these numbers are
// persisted to logs.
/**
 * User Actions that can be recorded by calling PDFMetrics.record.
 * The *_FIRST values are recorded automaticlly,
 * eg. PDFMetrics.record(...ROTATE) will also record ROTATE_FIRST
 * on the first instance.
 *
 * @enum {number}
 */
PDFMetrics.UserAction = {
  /**
   * Recorded when the document is first loaded. This event serves as
   * denominator to determine percentages of documents in which an action was
   * taken as well as average number of each action per document.
   */
  DOCUMENT_OPENED: 0,

  /** Recorded when the document is rotated clockwise or counter-clockwise. */
  ROTATE_FIRST: 1,
  ROTATE: 2,

  FIT_TO_WIDTH_FIRST: 3,
  FIT_TO_WIDTH: 4,

  FIT_TO_PAGE_FIRST: 5,
  FIT_TO_PAGE: 6,

  /** Recorded when the bookmarks panel is opened. */
  OPEN_BOOKMARKS_PANEL_FIRST: 7,
  OPEN_BOOKMARKS_PANEL: 8,

  /** Recorded when a bookmark is followed. */
  FOLLOW_BOOKMARK_FIRST: 9,
  FOLLOW_BOOKMARK: 10,

  /** Recorded when the page selection is used to navigate to another page. */
  PAGE_SELECTOR_NAVIGATE_FIRST: 11,
  PAGE_SELECTOR_NAVIGATE: 12,

  /** Recorded when the user triggers a save of the document. */
  SAVE_FIRST: 13,
  SAVE: 14,

  /**
   * Recorded when the user triggers a save of the document and the document
   * has been modified by annotations.
   */
  SAVE_WITH_ANNOTATION_FIRST: 15,
  SAVE_WITH_ANNOTATION: 16,

  PRINT_FIRST: 17,
  PRINT: 18,

  ENTER_ANNOTATION_MODE_FIRST: 19,
  ENTER_ANNOTATION_MODE: 20,

  EXIT_ANNOTATION_MODE_FIRST: 21,
  EXIT_ANNOTATION_MODE: 22,

  /** Recorded when a pen stroke is made. */
  ANNOTATE_STROKE_TOOL_PEN_FIRST: 23,
  ANNOTATE_STROKE_TOOL_PEN: 24,

  /** Recorded when an eraser stroke is made. */
  ANNOTATE_STROKE_TOOL_ERASER_FIRST: 25,
  ANNOTATE_STROKE_TOOL_ERASER: 26,

  /** Recorded when a highlighter stroke is made. */
  ANNOTATE_STROKE_TOOL_HIGHLIGHTER_FIRST: 27,
  ANNOTATE_STROKE_TOOL_HIGHLIGHTER: 28,

  /** Recorded when a stroke is made using touch. */
  ANNOTATE_STROKE_DEVICE_TOUCH_FIRST: 29,
  ANNOTATE_STROKE_DEVICE_TOUCH: 30,

  /** Recorded when a stroke is made using mouse. */
  ANNOTATE_STROKE_DEVICE_MOUSE_FIRST: 31,
  ANNOTATE_STROKE_DEVICE_MOUSE: 32,

  /** Recorded when a stroke is made using pen. */
  ANNOTATE_STROKE_DEVICE_PEN_FIRST: 33,
  ANNOTATE_STROKE_DEVICE_PEN: 34,

  NUMBER_OF_ACTIONS: 35,
};

// Map from UserAction to the 'FIRST' action. These metrics are recorded
// by PDFMetrics.log the first time each corresponding action occurs.
/** @private Map<number, number> */
PDFMetrics.firstMap_ = new Map([
  [
    PDFMetrics.UserAction.ROTATE,
    PDFMetrics.UserAction.ROTATE_FIRST,
  ],
  [
    PDFMetrics.UserAction.FIT_TO_WIDTH,
    PDFMetrics.UserAction.FIT_TO_WIDTH_FIRST,
  ],
  [
    PDFMetrics.UserAction.FIT_TO_PAGE,
    PDFMetrics.UserAction.FIT_TO_PAGE_FIRST,
  ],
  [
    PDFMetrics.UserAction.OPEN_BOOKMARKS_PANEL,
    PDFMetrics.UserAction.OPEN_BOOKMARKS_PANEL_FIRST,
  ],
  [
    PDFMetrics.UserAction.FOLLOW_BOOKMARK,
    PDFMetrics.UserAction.FOLLOW_BOOKMARK_FIRST,
  ],
  [
    PDFMetrics.UserAction.PAGE_SELECTOR_NAVIGATE,
    PDFMetrics.UserAction.PAGE_SELECTOR_NAVIGATE_FIRST,
  ],
  [
    PDFMetrics.UserAction.SAVE,
    PDFMetrics.UserAction.SAVE_FIRST,
  ],
  [
    PDFMetrics.UserAction.SAVE_WITH_ANNOTATION,
    PDFMetrics.UserAction.SAVE_WITH_ANNOTATION_FIRST,
  ],
  [
    PDFMetrics.UserAction.PRINT,
    PDFMetrics.UserAction.PRINT_FIRST,
  ],
  [
    PDFMetrics.UserAction.ENTER_ANNOTATION_MODE,
    PDFMetrics.UserAction.ENTER_ANNOTATION_MODE_FIRST,
  ],
  [
    PDFMetrics.UserAction.EXIT_ANNOTATION_MODE,
    PDFMetrics.UserAction.EXIT_ANNOTATION_MODE_FIRST,
  ],
  [
    PDFMetrics.UserAction.ANNOTATE_STROKE_TOOL_PEN,
    PDFMetrics.UserAction.ANNOTATE_STROKE_TOOL_PEN_FIRST,
  ],
  [
    PDFMetrics.UserAction.ANNOTATE_STROKE_TOOL_ERASER,
    PDFMetrics.UserAction.ANNOTATE_STROKE_TOOL_ERASER_FIRST,
  ],
  [
    PDFMetrics.UserAction.ANNOTATE_STROKE_TOOL_HIGHLIGHTER,
    PDFMetrics.UserAction.ANNOTATE_STROKE_TOOL_HIGHLIGHTER_FIRST,
  ],
  [
    PDFMetrics.UserAction.ANNOTATE_STROKE_DEVICE_TOUCH,
    PDFMetrics.UserAction.ANNOTATE_STROKE_DEVICE_TOUCH_FIRST,
  ],
  [
    PDFMetrics.UserAction.ANNOTATE_STROKE_DEVICE_MOUSE,
    PDFMetrics.UserAction.ANNOTATE_STROKE_DEVICE_MOUSE_FIRST,
  ],
  [
    PDFMetrics.UserAction.ANNOTATE_STROKE_DEVICE_PEN,
    PDFMetrics.UserAction.ANNOTATE_STROKE_DEVICE_PEN_FIRST,
  ],
]);<link rel="import" href="edge://resources/html/polymer.html">

<link rel="import" href="edge://resources/polymer/v1_0/paper-styles/color.html">

<custom-style>
<style>
  html {
    --iron-icon-height: 20px;
    --iron-icon-width: 20px;
    --viewer-icon-ink-color: rgb(189, 189, 189);
  }
</style>
</custom-style>
<link rel="import" href="edge://resources/html/polymer.html">
<link rel="import" href="edge://resources/polymer/v1_0/iron-iconset-svg/iron-iconset-svg.html">

<iron-iconset-svg size="24" name="pdf">
  <svg>
    <defs>
      <!--
      These icons are copied from Polymer's iron-icons and kept in sorted order.
      See http://to-be-replaced.invalid/Y1OdAq for instructions on adding additional icons.
      -->
      <g id="add"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></g>
      <g id="bookmark"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"></path></g>
      <g id="bookmark-border"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"></path></g>
      <g id="create"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path></g>
      <g id="eraser"><path d="M21.41,11.33 L13.04,20 L4.73,20 L2.58,17.86 C1.8,17.08 1.8,15.83 2.58,15.04 L13.62,3.58 C14.4,2.81 15.68,2.81 16.46,3.58 L21.41,8.51 C22.2,9.29 22.2,10.55 21.41,11.33 L21.41,11.33 Z"></path><polygon points="17.26 18 15.26 20 21.96 20 21.96 18"></polygon></g>
      <g id="fullscreen-exit"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></g>
      <g id="highlighter"><path d="M10.22,9.49 L4.31,15.49 C3.54,16.29 3.61,17.54 4.39,18.34 L0.77,22 L6.45,22 L7.19,21.25 C7.97,22.06 9.14,22.11 9.92,21.3 L15.88,15.25 L10.22,9.49 L10.22,9.49 Z"></path><path style="fill: var(--pen-tip-fill)"  d="M22.68,5.49 L19.86,2.62 C19.08,1.82 17.79,1.78 17.02,2.58 L11.27,8.43 L16.93,14.18 L22.62,8.4 C23.39,7.59 23.45,6.29 22.68,5.49 L22.68,5.49 Z"></path><path style="fill: var(--pen-tip-border)" d="M18.4,3c0.3,0,0.5,0.1,0.7,0.3L22,6.2c0.4,0.4,0.4,1.1-0.1,1.5l-5,5.1l-4.3-4.3l5.1-5.2 C17.9,3.1,18.1,3,18.4,3 M18.4,2c-0.5,0-1,0.2-1.4,0.6l-5.8,5.9l5.7,5.8l5.7-5.8c0.8-0.8,0.8-2.1,0.1-2.9l-2.8-2.9 C19.5,2.2,18.9,2,18.4,2L18.4,2z"></path></g>
      <g id="marker"><polygon points="3 17.25 3 21 6.74 21 14.28 13.47 10.53 9.72"></polygon><path style="fill: var(--pen-tip-fill)" d="M18.37,3.3 L20.71,5.63 C21.1,6.02 21.11,6.66 20.72,7.05 L15.35,12.41 L11.59,8.65 L14.12,6.12 L13.39,5.39 L7.73,11.05 L6.33,9.65 L12.7,3.29 C13.09,2.9 13.74,2.91 14.12,3.3 L15.54,4.71 L16.96,3.3 C17.34,2.91 17.98,2.91 18.37,3.3 L18.37,3.3 Z"></path><path style="fill: var(--pen-tip-border)" d="M17.7,4L20,6.3L15.4,11L13,8.6l1.8-1.8l0.7-0.7l-0.7-0.7l-0.2-0.2l0.2,0.2l0.7,0.7l0.7-0.7L17.7,4 M13.4,3 c-0.3,0-0.5,0.1-0.7,0.3L6.3,9.6l1.4,1.4l5.7-5.7l0.7,0.7l-2.5,2.5l3.8,3.8L20.7,7c0.4-0.4,0.4-1,0-1.4l-2.3-2.3 C18.2,3.1,17.9,3,17.7,3S17.2,3.1,17,3.3l-1.4,1.4l-1.4-1.4C13.9,3.1,13.7,3,13.4,3L13.4,3z"></path></g>
      <g id="redo"><path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"></path></g>
      <g id="remove"><path d="M19 13H5v-2h14v2z"></path></g>
      <g id="rotate-right"><path d="M15.55 5.55L11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42l1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z"></path></g>
      <g id="undo"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"></path></g>
    </defs>
  </svg>
</iron-iconset-svg>
<link rel="import" href="edge://resources/html/polymer.html">

<link rel="import" href="edge://resources/cr_elements/cr_icon_button/cr_icon_button.html">
<link rel="import" href="edge://resources/cr_elements/icons.html">
<link rel="import" href="edge://resources/cr_elements/shared_vars_css.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-ripple/paper-ripple.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-styles/color.html">

<dom-module id="viewer-bookmark" attributes="bookmark">
  <template>
    <style>
      #item {
        @apply --layout-center;
        @apply --layout-horizontal;
        cursor: pointer;
        height: 30px;
        position: relative;
      }

      #item:hover {
        background-color: var(--cr-menu-background-focus-color);
      }

      paper-ripple {
        /* Allowing the ripple to capture pointer events prevents a focus
         * rectangle for showing up for clicks, while still allowing it with
         * tab-navigation. This undoes a paper-ripple bug fix aimed at
         * non-Chrome browsers. TODO(tsergeant): Improve focus in
         * viewer-bookmark so this can be removed (https://crbug.com/5448190).
         */
        pointer-events: auto;
      }

      #title {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      #expand {
        --cr-icon-button-color: var(--primary-text-color);
        --cr-icon-button-icon-size: 16px;
        --cr-icon-button-size: 28px;
        margin: 0;
        transition: transform 150ms;
      }

      :host-context([dir=rtl]) #expand {
        transform: rotate(180deg);
      }

      :host([children-shown_]) #expand {
        transform: rotate(90deg);
      }
    </style>
    <div id="item" on-click="onClick_">
      <paper-ripple></paper-ripple>
      <cr-icon-button id="expand" iron-icon="cr:chevron-right"
          on-click="toggleChildren_"></cr-icon-button>
      <span id="title" tabindex="0">{{bookmark.title}}</span>
    </div>
    <!-- dom-if will stamp the complex bookmark tree lazily as individual nodes
      are opened. -->
    <template is="dom-if" if="[[childrenShown_]]">
      <template is="dom-repeat" items="[[bookmark.children]]">
        <viewer-bookmark bookmark="{{item}}" depth="[[childDepth_]]">
        </viewer-bookmark>
      </template>
    </template>
  </template>
  <script src="viewer-bookmark.js"></script>
</dom-module>
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

/**
 * The |title| is the text label displayed for the bookmark.
 *
 * The bookmark may point at a location in the PDF or a URI.
 * If it points at a location, |page| indicates which 0-based page it leads to.
 * Optionally, |y| is the y position in that page, in pixel coordinates.
 * If it points at an URI, |uri| is the target for that bookmark.
 *
 * |children| is an array of the |Bookmark|s that are below this in a table of
 * contents tree
 * structure.
 * @typedef {{
 *   title: string,
 *   page: (number | undefined),
 *   y: (number | undefined),
 *   uri: (string | undefined),
 *   children: !Array<!Bookmark>
 * }}
 */
let Bookmark;

(function() {
/** Amount that each level of bookmarks is indented by (px). */
const BOOKMARK_INDENT = 20;

Polymer({
  is: 'viewer-bookmark',

  properties: {
    /** @type {Bookmark} */
    bookmark: {
      type: Object,
      observer: 'bookmarkChanged_',
    },

    depth: {
      type: Number,
      observer: 'depthChanged_'
    },

    /** @private */
    childDepth_: Number,

    /** @private */
    childrenShown_: {
      type: Boolean,
      reflectToAttribute: true,
      value: false,
    },

    /** @type {?HTMLElement} The target for the key bindings below. */
    keyEventTarget: Object,
  },

  behaviors: [Polymer.IronA11yKeysBehavior],

  keyBindings: {'enter': 'onEnter_', 'space': 'onSpace_'},

  /** @override */
  attached: function() {
    this.keyEventTarget = this.$.item;
  },

  /** @private */
  bookmarkChanged_: function() {
    this.$.expand.style.visibility =
        this.bookmark.children.length > 0 ? 'visible' : 'hidden';
  },

  /** @private */
  depthChanged_: function() {
    this.childDepth_ = this.depth + 1;
    this.$.item.style.paddingInlineStart =
        (this.depth * BOOKMARK_INDENT) + 'px';
  },

  /** @private */
  onClick_: function() {
    if (this.bookmark.hasOwnProperty('page')) {
      if (this.bookmark.hasOwnProperty('y')) {
        this.fire('change-page-and-xy', {
          page: this.bookmark.page,
          x: 0,
          y: this.bookmark.y,
          origin: 'bookmark'
        });
      } else {
        this.fire(
            'change-page', {page: this.bookmark.page, origin: 'bookmark'});
      }
    } else if (this.bookmark.hasOwnProperty('uri')) {
      this.fire('navigate', {uri: this.bookmark.uri, newtab: true});
    }
  },

  /**
   * @param {!KeyboardEvent} e
   * @private
   */
  onEnter_: function(e) {
    // Don't allow events which have propagated up from the expand button to
    // trigger a click.
    if (e.detail.keyboardEvent.target != this.$.expand) {
      this.onClick_();
    }
  },

  /**
   * @param {!KeyboardEvent} e
   * @private
   */
  onSpace_: function(e) {
    // cr-icon-button stops propagation of space events, so there's no need
    // to check the event source here.
    this.onClick_();
    // Prevent default space scroll behavior.
    e.detail.keyboardEvent.preventDefault();
  },

  /**
   * @param {!Event} e
   * @private
   */
  toggleChildren_: function(e) {
    this.childrenShown_ = !this.childrenShown_;
    e.stopPropagation();  // Prevent the above onClick_ handler from firing.
  }
});
})();
<link rel="import" href="edge://resources/html/polymer.html">

<link rel="import" href="edge://resources/cr_elements/cr_button/cr_button.html">
<link rel="import" href="edge://resources/cr_elements/cr_dialog/cr_dialog.html">
<link rel="import" href="edge://resources/cr_elements/hidden_style_css.html">

<dom-module id="viewer-error-screen">
  <template>
    <style include="cr-hidden-style"></style>
    <cr-dialog id="dialog" no-cancel>
      <div slot="title">[[strings.errorDialogTitle]]</div>
      <div slot="body">[[strings.pageLoadFailed]]</div>
      <div slot="button-container" hidden$="[[!reloadFn]]">
        <cr-button class="action-button" on-click="reload">
          [[strings.pageReload]]
        </cr-button>
      </div>
    </cr-dialog>
  </template>
  <script src="viewer-error-screen.js"></script>
</dom-module>
// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

Polymer({
  is: 'viewer-error-screen',
  properties: {
    reloadFn: Function,

    strings: Object,
  },

  show: function() {
    /** @type {!CrDialogElement} */ (this.$.dialog).showModal();
  },

  reload: function() {
    if (this.reloadFn) {
      this.reloadFn();
    }
  }
});
<link rel="import" href="edge://resources/edge_html/polymer.html">

<link rel="import" href="edge://resources/edge_elements/hidden_style_css.html">
<link rel="import" href="edge://resources/edge_elements/paper_button_style_css.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-button/paper-button.html">

<dom-module id="viewer-annotation-pop-up">
  <template>
    <style>
      #popUpItem {
        position: relative;
        top: 50px;
        box-shadow: 1px 1px;
        border-radius: 5px;
        left: 50px;
        width: 240px;
        border: 2px solid rgb(255, 230, 0);
        padding: 10px;
        max-height: 280px;
        text-overflow: ellipsis;
        white-space: normal;
        overflow-y: hidden;
        -ms-hyphens: auto;
        -moz-hyphens: auto;
        -webkit-filter: brightness(50%);
        filter: drop-shadow(2px 2px 2px gray);
        -webkit-hyphens: auto;
        hyphens: auto;
        overflow-wrap: break-word;
        word-wrap: break-word;
        overflow: hidden;
        background-color: rgb(255, 255, 255);
        color: rgb(14, 13, 13);
      }

      #author {
        float: left;
        z-index: 5;
        font-weight: bold;
      }
    </style>
    <div id="popUpItem" hidden$="{{hidden_}}">
      <div id="author">
        {{authorName_}}
      </div>
      {{data_}}
    </div>
  </template>
  <script src="viewer-annotation-pop-up.js"></script>
</dom-module>// Copyright 2014 The Chromium Authors. All rights reserved.
// Copyright (C) Microsoft Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

Polymer({
  is: 'viewer-annotation-pop-up',
  properties: {
    strings: Object,
    data_: {type:String},
    authorName_: {type:String},
    hidden_: {type: Boolean, value: true}
  },

  hide: function() {
    if(!this.hidden_){
      this.data_ = "";
      this.authorName_ = "";
      this.hidden_ = true;
    }
  },

  show: function () {
    if(this.hidden_){
      this.hidden_ = false;
    }
  },

  height : function(){
    return this.$['popUpItem'].clientHeight;
  },

  width : function(){
    return this.$['popUpItem'].clientWidth;
  },

  setPosition : function (coords){
    this.$['popUpItem'].style.left = coords.x + "px";
    this.$['popUpItem'].style.top = coords.y + "px";
  },

  setAuthor : function (authorName){
    if (authorName === ""){
      this.authorName_ = "";
    } else {
      this.authorName_ = authorName + " : ";
    }
  },

  setColor : function (r,g,b,a){
    this.$['popUpItem'].style.borderColor = 'rgba(' + [r,g,b,a].join(',') + ')';
  },
});<link rel="import" href="edge://resources/html/assert.html">
<link rel="import" href="edge://resources/html/polymer.html">
<link rel="import" href="edge://resources/html/util.html">

<dom-module id="viewer-page-indicator">
  <template>
    <style>
      :host {
        display: flex;
        opacity: 0;
        pointer-events: none;
        position: fixed;
        right: 0;
        transition: opacity 400ms ease-in-out;
      }

      :host-context([dir=rtl]) {
        left: 0;
        right: auto;
      }

      #text {
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 5px;
        color: white;
        font-family: sans-serif;
        font-size: 12px;
        font-weight: bold;
        line-height: 48px;
        text-align: center;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
        width: 62px;
      }

      #triangle-end {
        border-bottom: 6px solid transparent;
        border-inline-start: 8px solid rgba(0, 0, 0, 0.5);
        border-top: 6px solid transparent;
        height: 0;
        margin-top: 18px;
        width: 0;
      }
    </style>
    <div id="text">{{label}}</div>
    <div id="triangle-end"></div>
  </template>
  <script src="viewer-page-indicator.js"></script>
</dom-module>
// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

Polymer({
  is: 'viewer-page-indicator',

  properties: {
    label: {type: String, value: '1'},

    index: {type: Number, observer: 'indexChanged'},

    pageLabels: {type: Array, value: null, observer: 'pageLabelsChanged'}
  },

  /** @type {number|undefined} */
  timerId: undefined,

  /** @override */
  ready: function() {
    const callback = this.fadeIn_.bind(this);
    window.addEventListener('scroll', function() {
      requestAnimationFrame(callback);
    });
  },

  /** @private */
  fadeIn_: function() {
    const percent = window.scrollY /
        (document.scrollingElement.scrollHeight -
         document.documentElement.clientHeight);
    this.style.top =
        percent * (document.documentElement.clientHeight - this.offsetHeight) +
        'px';
    // 
    this.style.opacity = 1;
    clearTimeout(this.timerId);

    this.timerId = setTimeout(() => {
      this.style.opacity = 0;
      this.timerId = undefined;
    }, 2000);
  },

  pageLabelsChanged: function() {
    this.indexChanged();
  },

  indexChanged: function() {
    if (this.pageLabels) {
      this.label = this.pageLabels[this.index];
    } else {
      this.label = String(this.index + 1);
    }
  }
});
<link rel="import" href="edge://resources/html/polymer.html">

<link rel="import" href="edge://resources/cr_elements/cr_input/cr_input.html">

<dom-module id="viewer-page-selector">
  <template>
    <style>
      :host {
        color: #fff;
        display: flex;
        font-size: 0.81rem;
      }

      :host ::selection {
        background: rgba(255, 255, 255, 0.3);
      }

      #pageselector-container,
      #pagelength-spacer {
        padding: 0 3px;
        text-align: start;
        /* --page-length-digits is set through JavaScript */
        width: calc(var(--page-length-digits, 1) * 1ch);
      }

      #pageselector-container:focus-within,
      #pageselector-container:hover {
        background: rgba(0, 0, 0, 0.5);
      }

      #pageselector {
        --cr-input-focus-color: transparent;
        --cr-input-error-display: none;
        --cr-input-background-color: transparent;
        --cr-input-color: white;
      }

      #pageselector::part(input) {
        caret-color: var(--cr-input-color);
        padding: 0;
        text-align: end;
      }
    </style>
    <div id="pageselector-container">
      <cr-input id="pageselector" value="[[pageNo]]" on-mouseup="select"
          on-value-changed="onInputValueChange_" on-change="pageNoCommitted"
          aria-label$="{{strings.labelPageNumber}}">
      </cr-input>
    </div>
    <span id="slash">/</span>
    <span id="pagelength-spacer">
      <span id="pagelength">{{docLength}}</span>
    </span>
  </template>
  <script src="viewer-page-selector.js"></script>
</dom-module>
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

Polymer({
  is: 'viewer-page-selector',

  properties: {
    /**
     * The number of pages the document contains.
     */
    docLength: {type: Number, value: 1, observer: 'docLengthChanged_'},

    /**
     * The current page being viewed (1-based). A change to pageNo is mirrored
     * immediately to the input field. A change to the input field is not
     * mirrored back until pageNoCommitted() is called and change-page is fired.
     */
    pageNo: {
      type: Number,
      value: 1,
    },

    strings: Object,
  },

  /** @return {!CrInputElement} */
  get pageSelector() {
    return this.$.pageselector;
  },

  pageNoCommitted: function() {
    const page = parseInt(this.pageSelector.value, 10);

    if (!isNaN(page) && page <= this.docLength && page > 0) {
      this.fire('change-page', {page: page - 1, origin: 'pageselector'});
    } else {
      this.pageSelector.value = this.pageNo.toString();
    }
    this.pageSelector.blur();
  },

  /** @private */
  docLengthChanged_: function() {
    const numDigits = this.docLength.toString().length;
    this.style.setProperty('--page-length-digits', `${numDigits}`);
  },

  select: function() {
    this.pageSelector.select();
  },

  /**
   * @return {boolean} True if the selector input field is currently focused.
   */
  isActive: function() {
    return this.shadowRoot.activeElement == this.pageSelector;
  },

  /**
   * Immediately remove any non-digit characters.
   * @private
   */
  onInputValueChange_: function() {
    this.pageSelector.value = this.pageSelector.value.replace(/[^\d]/, '');
  },
});
<link rel="import" href="edge://resources/html/polymer.html">

<link rel="import" href="edge://resources/cr_elements/cr_button/cr_button.html">
<link rel="import" href="edge://resources/cr_elements/cr_dialog/cr_dialog.html">
<link rel="import" href="edge://resources/cr_elements/cr_input/cr_input.html">
<link rel="import" href="edge://resources/cr_elements/shared_style_css.html">
<link rel="import" href="edge://resources/cr_elements/shared_vars_css.html">

<dom-module id="viewer-password-screen">
  <template>
    <style include="cr-shared-style">
      #password {
        margin-top: var(--cr-form-field-bottom-spacing);
      }
    </style>
    <cr-dialog id="dialog" no-cancel>
      <div slot="title">[[strings.passwordDialogTitle]]</div>
      <div slot="body">
        <div id="message">[[strings.passwordPrompt]]</div>
        <cr-input id="password"
            type="password"
            error-message="[[strings.passwordInvalid]]"
            invalid="[[invalid]]"
            autofocus>
        </cr-input>
      </div>
      <div slot="button-container">
        <cr-button id="submit" class="action-button" on-click="submit">
          [[strings.passwordSubmit]]
        </cr-button>
      </div>
    </cr-dialog>
  </template>
  <script src="viewer-password-screen.js"></script>
</dom-module>
// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

Polymer({
  is: 'viewer-password-screen',

  properties: {
    invalid: Boolean,

    strings: Object,
  },

  get active() {
    return this.$.dialog.open;
  },

  show: function() {
    this.$.dialog.showModal();
  },

  close: function() {
    if (this.active) {
      this.$.dialog.close();
    }
  },

  deny: function() {
    const password = /** @type {!CrInputElement} */ (this.$.password);
    password.disabled = false;
    this.$.submit.disabled = false;
    this.invalid = true;
    password.select();
  },

  submit: function() {
    const password = /** @type {!CrInputElement} */ (this.$.password);
    if (password.value.length == 0) {
      return;
    }
    password.disabled = true;
    this.$.submit.disabled = true;
    this.fire('password-submitted', {password: password.value});
  },
});
<link rel="import" href="edge://resources/html/polymer.html">

<link rel="import" href="edge://resources/cr_elements/cr_icon_button/cr_icon_button.html">
<link rel="import" href="edge://resources/cr_elements/hidden_style_css.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-progress/paper-progress.html">
<link rel="import" href="edge://resources/cr_elements/icons.html">
<link rel="import" href="../icons.html">
<link rel="import" href="../viewer-bookmark/viewer-bookmark.html">
<link rel="import" href="../viewer-page-selector/viewer-page-selector.html">

<link rel="import" href="../viewer-toolbar-dropdown/viewer-toolbar-dropdown.html">

<dom-module id="viewer-pdf-toolbar">
  <template>
    <style include="cr-hidden-style">
      :host ::selection {
        background: rgba(255, 255, 255, 0.3);
      }

      /* We introduce a wrapper aligner element to help with laying out the main
       * toolbar content without changing the bottom-aligned progress bar. */
      #aligner {
        align-items: center;
        display: flex;
        padding: 0 8px;
        width: 100%;
      }

      #title {
        flex: 5;
        font-size: 0.87rem;
        font-weight: 500;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      #pageselector-container {
        text-align: center;
        /* The container resizes according to the width of the toolbar. On small
         * screens with large numbers of pages, overflow page numbers without
         * wrapping. */
        white-space: nowrap;
      }

      #buttons {
        flex: 5;
        text-align: end;
        user-select: none;
      }

      cr-icon-button {
        --cr-icon-button-color: rgb(241, 241, 241);
        margin: 6px;
      }

      cr-icon-button:hover {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 50%;
      }

      paper-progress {
        --paper-progress-active-color: var(--google-blue-300);
        --paper-progress-container-color: transparent;
        --paper-progress-height: 3px;
        transition: opacity 150ms;
        width: 100%;
      }

      #toolbar {
        @apply --shadow-elevation-2dp;
        background-color: rgb(50, 54, 57);
        position: relative;
      }

      #annotations-bar {
        align-items: center;
        background-color: rgb(32, 33, 34);
        justify-content: center;
      }

      #toolbar,
      #annotations-bar {
        color: rgb(241, 241, 241);
        display: flex;
        height: 48px;
        padding: 0 16px;
      }

      #progress-container {
        bottom: 0;
        left: 0;
        margin: 0;
        position: absolute;
        right: 0;
        top: auto;
        width: auto;
      }

      #pen,
      #highlighter {
        --dropdown-width: 346px;
      }

      #pen,
      #highlighter {
        --dropdown-open-background: rgb(50, 54, 57);
      }

      #eraser {
        opacity: 0.38;
      }

      #eraser[selected],
      #eraser:focus,
      #eraser:hover {
        opacity: 1;
      }

      #annotation-separator {
        background: white;
        height: 30px;
        margin-inline-end: 12px;
        margin-inline-start: 12px;
        opacity: 0.38;
        width: 1px;
      }

      :host([annotation-mode]) #annotate {
        background-color: rgba(255, 255, 255, 0.24);
        border-radius: 50%;
      }

      #bookmarks {
        margin-inline-start: 8px;
      }

      #pen {
        margin-inline-end: 10px;
      }

      #highlighter {
        margin-inline-end: 6px;
      }

      .invisible {
        visibility: hidden;
      }

      @media(max-width: 675px) {
        #bookmarks,
        #rotate-left {
          display: none;
        }

        #pageselector-container {
          flex: 2;
        }
      }

      @media(max-width: 450px) {
        #rotate-right {
          display: none;
        }
      }

      @media(max-width: 400px) {
        #buttons,
        #pageselector-container {
          display: none;
        }
      }
    </style>
    <div id="toolbar">
      <div id="aligner">
        <span id="title" title="{{docTitle}}">
          <span>{{docTitle}}</span>
        </span>

        <div id="pageselector-container">
          <viewer-page-selector id="pageselector" class="invisible"
              doc-length="{{docLength}}" page-no="{{pageNo}}"
              strings="{{strings}}">
          </viewer-page-selector>
        </div>

        <div id="buttons" class="invisible">
          <template is="dom-if" if="[[pdfAnnotationsEnabled]]">
            <cr-icon-button id="annotate" iron-icon="pdf:create"
                disabled="[[!annotationAvailable]]" on-click="toggleAnnotation"
                aria-label$="{{strings.tooltipAnnotate}}"
                title$="{{strings.tooltipAnnotate}}"></cr-icon-button>
          </template>

          <cr-icon-button id="rotate-right" iron-icon="pdf:rotate-right"
              disabled="[[annotationMode]]" on-click="rotateRight"
              aria-label$="{{strings.tooltipRotateCW}}"
              title$="{{strings.tooltipRotateCW}}"></cr-icon-button>

          <cr-icon-button id="download" iron-icon="cr:file-download"
              on-click="download" aria-label$="{{strings.tooltipDownload}}"
              title$="{{strings.tooltipDownload}}"></cr-icon-button>

          <cr-icon-button id="print" iron-icon="cr:print" on-click="print"
              hidden="[[!printingEnabled]]" title$="{{strings.tooltipPrint}}"
              aria-label$="{{strings.tooltipPrint}}"></cr-icon-button>

          <viewer-toolbar-dropdown id="bookmarks"
                                   selected
                                   metrics-id="bookmarks"
                                   hidden$="[[!bookmarks.length]]"
                                   open-icon="pdf:bookmark"
                                   closed-icon="pdf:bookmark-border"
                                   header="{{strings.bookmarks}}">
            <template is="dom-repeat" items="[[bookmarks]]">
              <viewer-bookmark bookmark="[[item]]" depth="0"></viewer-bookmark>
            </template>
          </viewer-toolbar-dropdown>
        </div>
      </div>
      <div id="progress-container">
        <paper-progress id="progress"
            value="[[loadProgress]]"
            indeterminate="[[annotationMode]]"></paper-progress>
      </div>
    </div>

    <div id="annotations-bar" hidden>
      <viewer-toolbar-dropdown id="pen"
          selected$="[[isAnnotationTool_('pen', annotationTool.tool)]]"
          open-after-select
          on-click="annotationToolClicked_"
          open-icon="pdf:marker"
          closed-icon="pdf:marker"
          dropdown-centered
          hide-header
          header$="{{strings.annotationPen}}"
          style="--pen-tip-fill: #000000">
        <viewer-pen-options
          selected-color="#000000"
          selected-size="0.1429"
          strings="[[strings]]"
          on-selected-size-changed="annotationToolOptionChanged_"
          on-selected-color-changed="annotationToolOptionChanged_">
        </viewer-pen-options>
      </viewer-toolbar-dropdown>

      <viewer-toolbar-dropdown id="highlighter"
          selected$="[[isAnnotationTool_('highlighter', annotationTool.tool)]]"
          open-after-select
          on-click="annotationToolClicked_"
          open-icon="pdf:highlighter"
          closed-icon="pdf:highlighter"
          dropdown-centered
          hide-header
          header$="{{strings.annotationHighlighter}}"
          style="--pen-tip-fill: #ffbc00">
        <viewer-pen-options
          selected-color="#ffbc00"
          selected-size="0.7143"
          strings="[[strings]]"
          on-selected-size-changed="annotationToolOptionChanged_"
          on-selected-color-changed="annotationToolOptionChanged_">
        </viewer-pen-options>
      </viewer-toolbar-dropdown>

      <cr-icon-button id="eraser"
          selected$="[[isAnnotationTool_('eraser', annotationTool.tool)]]"
          on-click="annotationToolClicked_" iron-icon="pdf:eraser"
          aria-label$="{{strings.annotationEraser}}"
          title$="{{strings.annotationEraser}}"></cr-icon-button>

      <div id="annotation-separator"></div>

      <cr-icon-button id="undo" disabled="[[!canUndoAnnotation]]"
          iron-icon="pdf:undo" on-click="undo"
          aria-label$="{{strings.annotationUndo}}"
          title$="{{strings.annotationUndo}}"></cr-icon-button>

      <cr-icon-button id="redo" disabled="[[!canRedoAnnotation]]"
          iron-icon="pdf:redo" on-click="redo"
          aria-label$="{{strings.annotationRedo}}"
          title$="{{strings.annotationRedo}}"></cr-icon-button>
    </div>
  </template>
  <script src="viewer-pdf-toolbar.js"></script>
</dom-module>
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
(function() {
Polymer({
  is: 'viewer-pdf-toolbar',

  properties: {
    /**
     * Whether annotation mode can be entered. This would be false if for
     * example the PDF is encrypted or password protected. Note, this is
     * true regardless of whether the feature flag is enabled.
     */
    annotationAvailable: {
      type: Boolean,
      value: true,
    },

    /** Whether the viewer is currently in annotation mode. */
    annotationMode: {
      type: Boolean,
      notify: true,
      value: false,
      reflectToAttribute: true,
    },

    /** @type {?Object} */
    annotationTool: {
      type: Object,
      value: null,
      notify: true,
    },

    /**
     * Tree of PDF bookmarks (empty if the document has no bookmarks).
     * @type {!Array<!Bookmark>}
     */
    bookmarks: {
      type: Array,
      value: () => [],
    },

    canRedoAnnotation: {
      type: Boolean,
      value: false,
    },

    canUndoAnnotation: {
      type: Boolean,
      value: false,
    },

    /** The number of pages in the PDF document. */
    docLength: Number,

    /** The title of the PDF document. */
    docTitle: String,

    /** The current loading progress of the PDF document (0 - 100). */
    loadProgress: {
      type: Number,
      observer: 'loadProgressChanged_',
    },

    /** Whether the toolbar is opened and visible. */
    opened: {
      type: Boolean,
      value: true,
    },

    /** The number of the page being viewed (1-based). */
    pageNo: Number,

    /** Whether the PDF Annotations feature is enabled. */
    pdfAnnotationsEnabled: {
      type: Boolean,
      value: false,
    },

    /** Whether the Printing feature is enabled. */
    printingEnabled: {
      type: Boolean,
      value: false,
    },

    strings: Object,
  },

  /** @type {?Object} */
  animation_: null,

  /**
   * @param {number} newProgress
   * @param {number} oldProgress
   * @private
   */
  loadProgressChanged_: function(newProgress, oldProgress) {
    const loaded = newProgress >= 100;
    const progressReset = newProgress < oldProgress;
    if (progressReset || loaded) {
      this.$.pageselector.classList.toggle('invisible', !loaded);
      this.$.buttons.classList.toggle('invisible', !loaded);
      this.$.progress.style.opacity = loaded ? 0 : 1;
      this.$['annotations-bar'].hidden = !loaded || !this.annotationMode;
    }
  },

  hide: function() {
    if (this.opened && !this.shouldKeepOpen()) {
      this.toggleVisibility();
    }
  },

  show: function() {
    if (!this.opened) {
      this.toggleVisibility();
    }
  },

  toggleVisibility: function() {
    this.opened = !this.opened;

    // We keep a handle on the animation in order to cancel the filling
    // behavior of previous animations.
    if (this.animation_) {
      this.animation_.cancel();
    }

    if (this.opened) {
      this.animation_ = this.animate(
          [{transform: 'translateY(-100%)'}, {transform: 'translateY(0%)'}], {
            duration: 250,
            easing: 'cubic-bezier(0, 0, 0.2, 1)',
            fill: 'forwards',
          });
    } else {
      this.animation_ = this.animate(
          [{transform: 'translateY(0%)'}, {transform: 'translateY(-100%)'}], {
            duration: 250,
            easing: 'cubic-bezier(0.4, 0, 1, 1)',
            fill: 'forwards',
          });
    }
  },

  selectPageNumber: function() {
    this.$.pageselector.select();
  },

  /** @return {boolean} Whether the toolbar should be kept open. */
  shouldKeepOpen: function() {
    return this.$.bookmarks.dropdownOpen || this.loadProgress < 100 ||
        this.$.pageselector.isActive() || this.annotationMode;
  },

  /** @return {boolean} Whether a dropdown was open and was hidden. */
  hideDropdowns: function() {
    let result = false;
    if (this.$.bookmarks.dropdownOpen) {
      this.$.bookmarks.toggleDropdown();
      result = true;
    }
    if (this.$.pen.dropdownOpen) {
      this.$.pen.toggleDropdown();
      result = true;
    }
    if (this.$.highlighter.dropdownOpen) {
      this.$.highlighter.toggleDropdown();
      result = true;
    }
    return result;
  },

  /** @param {number} lowerBound */
  setDropdownLowerBound: function(lowerBound) {
    this.$.bookmarks.lowerBound = lowerBound;
  },

  rotateRight: function() {
    this.fire('rotate-right');
  },

  download: function() {
    this.fire('save');
  },

  print: function() {
    this.fire('print');
  },

  undo: function() {
    this.fire('undo');
  },

  redo: function() {
    this.fire('redo');
  },

  toggleAnnotation: function() {
    this.annotationMode = !this.annotationMode;
    if (this.annotationMode) {
      // Select pen tool when entering annotation mode.
      this.updateAnnotationTool_(this.$.pen);
    }
    this.dispatchEvent(new CustomEvent('annotation-mode-toggled', {
      detail: {
        value: this.annotationMode,
      },
    }));
  },

  /**
   * @param {!Event} e
   * @private
   */
  annotationToolClicked_: function(e) {
    this.updateAnnotationTool_(/** @type {!HTMLElement} */ (e.currentTarget));
  },

  /**
   * @param {!Event} e
   * @private
   */
  annotationToolOptionChanged_: function(e) {
    const element = e.currentTarget.parentElement;
    if (!this.annotationTool || element.id != this.annotationTool.tool) {
      return;
    }
    this.updateAnnotationTool_(e.currentTarget.parentElement);
  },

  /**
   * @param {!HTMLElement} element
   * @private
   */
  updateAnnotationTool_: function(element) {
    const tool = element.id;
    const options = element.querySelector('viewer-pen-options') || {
      selectedSize: 1,
      selectedColor: null,
    };
    const attributeStyleMap = element.attributeStyleMap;
    attributeStyleMap.set('--pen-tip-fill', options.selectedColor);
    attributeStyleMap.set(
        '--pen-tip-border',
        options.selectedColor == '#000000' ? 'currentcolor' :
                                             options.selectedColor);
    this.annotationTool = {
      tool: tool,
      size: options.selectedSize,
      color: options.selectedColor,
    };
  },

  /**
   * @param {string} toolName
   * @return {boolean} Whether the annotation tool is using tool |toolName|.
   * @private
   */
  isAnnotationTool_: function(toolName) {
    return !!this.annotationTool && this.annotationTool.tool === toolName;
  },
});
})();
<link rel="import" href="edge://resources/html/polymer.html">

<link rel="import" href="edge://resources/cr_elements/cr_icon_button/cr_icon_button.html">
<link rel="import" href="edge://resources/cr_elements/icons.html">
<link rel="import" href="edge://resources/cr_elements/shared_vars_css.html">

<dom-module id="viewer-toolbar-dropdown">
  <template>
    <style>
      :host {
        display: inline-block;
        position: relative;
        text-align: start;
        --dropdown-width: 260px;
      }

      :host-context([hidden]) {
        display: none;
      }

      :host([dropdown-centered]) {
        --container-offset: calc(50% - var(--dropdown-width) / 2);
      }

      #container {
        position: absolute;
        right: var(--container-offset, 0);
      }

      :host-context([dir=rtl]) #container {
        left: var(--container-offset, 0);
        right: auto;
      }

      #dropdown {
        background-color: var(--cr-menu-background-color);
        border-radius: 4px;
        color: var(--cr-primary-text-color);
        overflow-y: hidden;
        padding-bottom: 2px;
        width: var(--dropdown-width);
      }

      @media (prefers-color-scheme: light) {
        #dropdown {
          @apply --shadow-elevation-2dp;
        }
      }

      @media (prefers-color-scheme: dark) {
        #dropdown {
          background-image: linear-gradient(var(--cr-menu-background-sheen),
                                            var(--cr-menu-background-sheen));
          box-shadow: var(--cr-menu-shadow);
        }
      }

      #scroll-container {
        max-height: 300px;
        overflow-y: auto;
        padding: 6px 0 4px 0;
      }

      #button {
        --cr-icon-button-color: currentColor;
        --cr-icon-button-height: 32px;
        --cr-icon-button-icon-start-offset: 4px;
        --cr-icon-button-width: 48px;
        margin: 0;
      }

      #button:hover {
        background-color: rgba(255, 255, 255, 0.08);
        opacity: 1;
      }

      :host([selected]) #button {
        opacity: 1;

      }
      :host([dropdown-open]) #button {
        background-color: rgba(255, 255, 255, 0.24);
      }

      h1 {
        border-bottom: var(--cr-separator-line);
        font-size: 0.87rem;
        font-weight: 500;
        margin: 0;
        padding: 14px 28px;
      }
    </style>
    <cr-icon-button on-click="toggleDropdown" id="button"
        iron-icon="[[dropdownIcon_]],cr:arrow-drop-down" title$="[[header]]">
    </cr-icon-button>

    <div id="container">
      <div id="dropdown" style="display: none">
        <template is="dom-if" if="[[!hideHeader]]">
          <h1>{{header}}</h1>
        </template>
        <div id="scroll-container">
          <slot></slot>
        </div>
      </div>
    </div>
  </template>
  <script src="viewer-toolbar-dropdown.js"></script>
</dom-module>
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

(function() {
/**
 * Size of additional padding in the inner scrollable section of the dropdown.
 */
const DROPDOWN_INNER_PADDING = 12;

/** Size of vertical padding on the outer #dropdown element. */
const DROPDOWN_OUTER_PADDING = 2;

/** Minimum height of toolbar dropdowns (px). */
const MIN_DROPDOWN_HEIGHT = 200;

Polymer({
  is: 'viewer-toolbar-dropdown',

  properties: {
    /** Icon to display when the dropdown is closed. */
    closedIcon: String,

    /** Whether the dropdown should be centered or right aligned. */
    dropdownCentered: {
      type: Boolean,
      reflectToAttribute: true,
      value: false,
    },

    /** True if the dropdown is currently open. */
    dropdownOpen: {
      type: Boolean,
      reflectToAttribute: true,
      value: false,
    },

    /**
     * String to be displayed at the top of the dropdown and for the tooltip
     * of the button.
      */
    header: String,

    /** Whether to hide the header at the top of the dropdown. */
    hideHeader: {
      type: Boolean,
      value: false,
    },

    /** Lowest vertical point that the dropdown should occupy (px). */
    lowerBound: {
      type: Number,
      observer: 'lowerBoundChanged_',
    },

    /** Unique id to identify this dropdown for metrics purposes. */
    metricsId: String,

    /** Whether the dropdown must be selected before opening. */
    openAfterSelect: {
      type: Boolean,
      value: false,
    },

    /** Icon to display when the dropdown is open. */
    openIcon: String,

    /** Whether the dropdown is marked as selected. */
    selected: {
      type: Boolean,
      reflectToAttribute: true,
      value: false,
    },

    /**
     * Toolbar icon currently being displayed.
     * @private
     */
    dropdownIcon_: {
      type: String,
      computed: 'computeIcon_(dropdownOpen, closedIcon, openIcon)',
    },
  },

  /**
   * Current animation being played, or null if there is none.
   * @private {?Object}
   */
  animation_: null,

  /**
   * True if the max-height CSS property for the dropdown scroll container
   * is valid. If false, the height will be updated the next time the
   * dropdown is visible.
   * @private {boolean}
   */
  maxHeightValid_: false,

  /**
   * @return {string} Current icon for the dropdown.
   * @private
   */
  computeIcon_: function(dropdownOpen, closedIcon, openIcon) {
    return dropdownOpen ? openIcon : closedIcon;
  },

  /** @private */
  lowerBoundChanged_: function() {
    this.maxHeightValid_ = false;
    if (this.dropdownOpen) {
      this.updateMaxHeight();
    }
  },

  toggleDropdown: function() {
    if (!this.dropdownOpen && this.openAfterSelect && !this.selected) {
      // The dropdown has `openAfterSelect` set, but is not yet selected.
      return;
    }
    this.dropdownOpen = !this.dropdownOpen;
    if (this.dropdownOpen) {
      this.$.dropdown.style.display = 'block';
      if (!this.maxHeightValid_) {
        this.updateMaxHeight();
      }
      this.fire('dropdown-opened', this.metricsId);
    }

    if (this.dropdownOpen) {
      const listener = (e) => {
        if (e.path.includes(this)) {
          return;
        }
        if (this.dropdownOpen) {
          this.toggleDropdown();
          this.blur();
        }
        // Clean up the handler. The dropdown may already be closed.
        window.removeEventListener('pointerdown', listener);
      };
      window.addEventListener('pointerdown', listener);
    }

    this.playAnimation_(this.dropdownOpen);
  },

  updateMaxHeight: function() {
    const scrollContainer = this.$['scroll-container'];
    let height = this.lowerBound - scrollContainer.getBoundingClientRect().top -
        DROPDOWN_INNER_PADDING;
    height = Math.max(height, MIN_DROPDOWN_HEIGHT);
    scrollContainer.style.maxHeight = height + 'px';
    this.maxHeightValid_ = true;
  },

  /**
   * Start an animation on the dropdown.
   * @param {boolean} isEntry True to play entry animation, false to play
   * exit.
   * @private
   */
  playAnimation_: function(isEntry) {
    this.animation_ = isEntry ? this.animateEntry_() : this.animateExit_();
    this.animation_.onfinish = () => {
      this.animation_ = null;
      if (!this.dropdownOpen) {
        this.$.dropdown.style.display = 'none';
      }
    };
  },

  /**
   * @return {!Object} Animation
   * @private
   */
  animateEntry_: function() {
    let maxHeight =
        this.$.dropdown.getBoundingClientRect().height - DROPDOWN_OUTER_PADDING;

    if (maxHeight < 0) {
      maxHeight = 0;
    }

    this.$.dropdown.animate(
        {
          opacity: [0, 1],
        },
        {
          duration: 150,
          easing: 'cubic-bezier(0, 0, 0.2, 1)',
        });
    return this.$.dropdown.animate(
        [
          {height: '20px', transform: 'translateY(-10px)'},
          {height: maxHeight + 'px', transform: 'translateY(0)'},
        ],
        {
          duration: 250,
          easing: 'cubic-bezier(0, 0, 0.2, 1)',
        });
  },

  /**
   * @return {!Object} Animation
   * @private
   */
  animateExit_: function() {
    return this.$.dropdown.animate(
        [
          {transform: 'translateY(0)', opacity: 1},
          {transform: 'translateY(-5px)', opacity: 0},
        ],
        {
          duration: 100,
          easing: 'cubic-bezier(0.4, 0, 1, 1)',
        });
  }
});

})();
<link rel="import" href="edge://resources/html/polymer.html">
<link rel="import" href="edge://resources/cr_elements/shared_vars_css.html">
<link rel="import" href="edge://resources/cr_elements/cr_icon_button/cr_icon_button.html">
<link rel="import" href="edge://resources/polymer/v1_0/paper-styles/shadow.html">

<dom-module id="viewer-zoom-button">
  <template>
    <style>
      :host {
        --translate-x-distance: 132px;
      }

      :host([new-print-preview]) {
        --translate-x-distance: 96px;
      }

      #wrapper {
        transition: transform 250ms;
        transition-timing-function: cubic-bezier(0, 0, 0.2, 1);
      }

      :host([closed_]) #wrapper {
        /* 132px roughly flips the location of the button across the right edge
         * of the page. */
        transform: translateX(var(--translate-x-distance));
        transition-timing-function: cubic-bezier(0.4, 0, 1, 1);
      }

      :host([show-on-left][closed_]) #wrapper {
        transform: translateX(calc(-1 * var(--translate-x-distance)));
      }

      cr-icon-button {
        --cr-icon-button-size: 36px;
        --cr-icon-button-icon-size: 20px;
        background-color: rgb(242, 242, 242);
        border-radius: 50%;
        color: var(--paper-grey-700);
        overflow: visible;
        @apply --shadow-elevation-2dp;
      }

      :host(:not([new-print-preview])) cr-icon-button {
        --cr-icon-button-ripple-opacity: .4;
      }

      cr-icon-button([disabled]) {
        box-shadow: none;
      }

      :host([new-print-preview]) cr-icon-button {
        --cr-icon-button-size: 32px;
        background-color: var(--google-grey-600);
        color: white;
      }

      @media (prefers-color-scheme: light) {
        :host([new-print-preview]) cr-icon-button {
          --cr-icon-button-ripple-opacity: .5;
        }
      }

      @media (prefers-color-scheme: dark) {
        :host([new-print-preview]) cr-icon-button {
          background-color: var(--google-grey-900);
          color: var(--google-grey-200);
        }
      }

      :host([keyboard-navigation-active]) cr-icon-button:focus {
        @apply --shadow-elevation-6dp;
      }

      cr-icon-button:active {
        @apply --shadow-elevation-8dp;
      }
    </style>
    <div id="wrapper">
      <cr-icon-button iron-icon="[[visibleIcon_]]" on-click="fireClick_"
          aria-label$="[[visibleTooltip_]]" title="[[visibleTooltip_]]">
      </cr-icon-button>
    </div>
  </template>
  <script src="viewer-zoom-button.js"></script>
</dom-module>
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

Polymer({
  is: 'viewer-zoom-button',

  properties: {
    /** Index of the icon currently being displayed. */
    activeIndex: {
      type: Number,
      value: 0,
    },

    delay: {
      type: Number,
      observer: 'delayChanged_',
    },

    /**
     * Icons to be displayed on the FAB. Multiple icons should be separated with
     * spaces, and will be cycled through every time the FAB is clicked.
     */
    icons: String,

    /**
     * Used to show the appropriate drop shadow when buttons are focused with
     * the keyboard.
     */
    keyboardNavigationActive: {
      type: Boolean,
      reflectToAttribute: true,
    },

    newPrintPreview: {
      type: Boolean,
      reflectToAttribute: true,
    },

    showOnLeft: {
      type: Boolean,
      reflectToAttribute: true,
    },

    /** @type {?Array<string>} */
    tooltips: Array,

    /** @private */
    closed_: {
      type: Boolean,
      reflectToAttribute: true,
      value: false,
    },

    /**
     * Array version of the list of icons. Polymer does not allow array
     * properties to be set from HTML, so we must use a string property and
     * perform the conversion manually.
     * @private {!Array<string>}
     */
    icons_: {
      type: Array,
      value: [''],
      computed: 'computeIconsArray_(icons)',
    },

    /**
     * Icon currently being displayed on the FAB.
     * @private
     */
    visibleIcon_: {
      type: String,
      computed: 'computeVisibleIcon_(icons_, activeIndex)',
    },

    /** @private */
    visibleTooltip_: {
      type: String,
      computed: 'computeVisibleTooltip_(tooltips, activeIndex)',
    }
  },

  /**
   * @param {string} icons Icon names in a string, delimited by spaces
   * @return {!Array<string>} Array of icon name strings
   * @private
   */
  computeIconsArray_: function(icons) {
    return icons.split(' ');
  },

  /**
   * @param {!Array<string>} icons Array of icon name strings.
   * @param {number} activeIndex Index of the currently active icon.
   * @return {string} Icon name for the currently visible icon.
   * @private
   */
  computeVisibleIcon_: function(icons, activeIndex) {
    return icons[activeIndex];
  },

  /**
   * @param {?Array<string>} tooltips Array of tooltip strings.
   * @param {number} activeIndex Index of the currently active icon.
   * @return {string} Tooltip for the currently visible icon.
   * @private
   */
  computeVisibleTooltip_: function(tooltips, activeIndex) {
    return tooltips === undefined ? '' : tooltips[activeIndex];
  },

  /** @private */
  delayChanged_: function() {
    this.$.wrapper.style.transitionDelay = this.delay + 'ms';
  },

  show: function() {
    this.closed_ = false;
  },

  hide: function() {
    this.closed_ = true;
  },

  /** @private */
  fireClick_: function() {
    // We cannot attach an on-click to the entire viewer-zoom-button, as this
    // will include clicks on the margins. Instead, proxy clicks on the FAB
    // through.
    this.fire('fabclick');

    this.activeIndex = (this.activeIndex + 1) % this.icons_.length;
  }
});
<link rel="import" href="edge://resources/html/polymer.html">
<link rel="import" href="edge://resources/html/util.html">
<link rel="import" href="edge://resources/cr_elements/icons.html">
<link rel="import" href="../icons.html">
<link rel="import" href="viewer-zoom-button.html">

<dom-module id="viewer-zoom-toolbar">
  <template>
    <style>
      :host {
        --button-position-offset: 48px;
        bottom: 0;
        padding: 48px 0;
        position: fixed;
        right: 0;
        user-select: none;
        z-index: 3;
      }

      :host([new-print-preview]) {
        --button-position-offset: 24px;
      }

      :host([show-on-left_]) {
        left: 0;
        right: auto;
      }

      #zoom-buttons {
        position: relative;
        right: var(--button-position-offset);
      }

      :host([show-on-left_]) #zoom-buttons {
        left: var(--button-position-offset);
        right: auto;
      }

      viewer-zoom-button {
        display: block;
      }

      /* A small gap between the zoom in/zoom out buttons. */
      #zoom-out-button {
        margin-top: 10px;
      }

      /* A larger gap between the fit button and bottom two buttons. */
      #zoom-in-button {
        margin-top: 24px;
      }
    </style>
    <div id="zoom-buttons">
      <viewer-zoom-button id="fit-button" on-fabclick="fitToggle" delay="100"
          new-print-preview="[[newPrintPreview]]"
          show-on-left="[[showOnLeft_]]"
          keyboard-navigation-active="[[keyboardNavigationActive_]]"
          icons="pdf:fullscreen-exit cr:fullscreen">
      </viewer-zoom-button>
      <viewer-zoom-button id="zoom-in-button" icons="pdf:add"
          new-print-preview="[[newPrintPreview]]"
          show-on-left="[[showOnLeft_]]"
          keyboard-navigation-active="[[keyboardNavigationActive_]]"
          on-fabclick="zoomIn" delay="50"></viewer-zoom-button>
      <viewer-zoom-button id="zoom-out-button" icons="pdf:remove"
          new-print-preview="[[newPrintPreview]]"
          show-on-left="[[showOnLeft_]]"
          keyboard-navigation-active="[[keyboardNavigationActive_]]"
          on-fabclick="zoomOut" delay="0"></viewer-zoom-button>
    </div>
  </template>
  <script src="viewer-zoom-toolbar.js"></script>
</dom-module>
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

(function() {

const FIT_TO_PAGE_BUTTON_STATE = 0;
const FIT_TO_WIDTH_BUTTON_STATE = 1;

Polymer({
  is: 'viewer-zoom-toolbar',

  properties: {
    newPrintPreview: {
      type: Boolean,
      reflectToAttribute: true,
    },

    /** @private */
    keyboardNavigationActive_: {
      type: Boolean,
      value: false,
    },

    /** @private */
    showOnLeft_: {
      type: Boolean,
      computed: 'computeShowOnLeft_(newPrintPreview)',
      reflectToAttribute: true,
    },
  },

  listeners: {
    'focus': 'onFocus_',
    'keyup': 'onKeyUp_',
    'pointerdown': 'onPointerDown_',
  },

  /** @private {boolean} */
  isPrintPreview_: false,

  /** @private {boolean} */
  visible_: true,

  /** @param {boolean} isPrintPreview */
  setIsPrintPreview: function(isPrintPreview) {
    this.isPrintPreview_ = isPrintPreview;
  },

  /** @return {boolean} */
  isPrintPreview: function() {
    return this.isPrintPreview_;
  },

  /** @return {boolean} */
  isVisible: function() {
    return this.visible_;
  },

  /** @private */
  onFocus_: function() {
    // This can only happen when the plugin is shown within Print Preview using
    // keyboard navigation.
    if (!this.visible_) {
      assert(this.isPrintPreview_);
      this.fire('keyboard-navigation-active', true);
      this.show();
    }
  },

  /** @private */
  onKeyUp_: function() {
    if (this.isPrintPreview_) {
      this.fire('keyboard-navigation-active', true);
    }
    this.keyboardNavigationActive_ = true;
  },

  /** @private */
  onPointerDown_: function() {
    if (this.isPrintPreview_) {
      this.fire('keyboard-navigation-active', false);
    }
    this.keyboardNavigationActive_ = false;
  },

  /**
   * @return {boolean} Whether to show the zoom toolbar on the left side of the
   *     viewport.
   * @private
   */
  computeShowOnLeft_: function() {
    return isRTL() !== this.newPrintPreview;
  },

  /**
   * Change button tooltips to match any changes to localized strings.
   * @param {!{tooltipFitToPage: string,
   *           tooltipFitToWidth: string,
   *           tooltipZoomIn: string,
   *           tooltipZoomOut: string}} strings
   */
  setStrings: function(strings) {
    this.$['fit-button'].tooltips =
        [strings.tooltipFitToPage, strings.tooltipFitToWidth];
    this.$['zoom-in-button'].tooltips = [strings.tooltipZoomIn];
    this.$['zoom-out-button'].tooltips = [strings.tooltipZoomOut];
  },

  /** Handle clicks of the fit-button. */
  fitToggle: function() {
    this.fireFitToChangedEvent_(
        this.$['fit-button'].activeIndex == FIT_TO_WIDTH_BUTTON_STATE ?
            FittingType.FIT_TO_WIDTH :
            FittingType.FIT_TO_PAGE,
        true);
  },

  /** Handle the keyboard shortcut equivalent of fit-button clicks. */
  fitToggleFromHotKey: function() {
    this.fitToggle();

    // Toggle the button state since there was no mouse click.
    const button = this.$['fit-button'];
    button.activeIndex =
        (button.activeIndex == FIT_TO_WIDTH_BUTTON_STATE ?
             FIT_TO_PAGE_BUTTON_STATE :
             FIT_TO_WIDTH_BUTTON_STATE);
  },

  /**
   * Handle forcing zoom via scripting to a fitting type.
   * @param {!FittingType} fittingType Page fitting type to force.
   */
  forceFit: function(fittingType) {
    this.fireFitToChangedEvent_(fittingType, false);

    // Set the button state since there was no mouse click.
    const nextButtonState =
        (fittingType == FittingType.FIT_TO_WIDTH ? FIT_TO_PAGE_BUTTON_STATE :
                                                   FIT_TO_WIDTH_BUTTON_STATE);
    this.$['fit-button'].activeIndex = nextButtonState;
  },

  /**
   * Fire a 'fit-to-changed' {CustomEvent} with the given FittingType as detail.
   * @param {!FittingType} fittingType to include as payload.
   * @param {boolean} userInitiated whether the event was initiated by a user
   *     action.
   * @private
   */
  fireFitToChangedEvent_: function(fittingType, userInitiated) {
    this.fire(
        'fit-to-changed',
        {fittingType: fittingType, userInitiated: userInitiated});
  },

  /**
   * Handle clicks of the zoom-in-button.
   */
  zoomIn: function() {
    this.fire('zoom-in');
  },

  /**
   * Handle clicks of the zoom-out-button.
   */
  zoomOut: function() {
    this.fire('zoom-out');
  },

  show: function() {
    if (!this.visible_) {
      this.visible_ = true;
      this.$['fit-button'].show();
      this.$['zoom-in-button'].show();
      this.$['zoom-out-button'].show();
    }
  },

  hide: function() {
    if (this.visible_) {
      this.visible_ = false;
      this.$['fit-button'].hide();
      this.$['zoom-in-button'].hide();
      this.$['zoom-out-button'].hide();
    }
  },
});
})();
!function(t){function e(e){for(var r,s,h=e[0],c=e[1],u=e[2],d=0,l=[];d<h.length;d++)s=h[d],i[s]&&l.push(i[s][0]),i[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);for(a&&a(e);l.length;)l.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,h=1;h<n.length;h++){var c=n[h];0!==i[c]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var r={},i={0:0},o=[];function s(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var r=new Promise(function(e,r){n=i[t]=[e,r]});e.push(n[2]=r);var o,h=document.createElement("script");h.charset="utf-8",h.timeout=120,s.nc&&h.setAttribute("nonce",s.nc),h.src=function(t){return s.p+""+({1:"pdfui_component",3:"vendors~pdfui_component"}[t]||t)+".chunk.js"}(t);var c=new Error;o=function(e){h.onerror=h.onload=null,clearTimeout(u);var n=i[t];if(0!==n){if(n){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",c.name="ChunkLoadError",c.type=r,c.request=o,n[1](c)}i[t]=void 0}};var u=setTimeout(function(){o({type:"timeout",target:h})},12e4);h.onerror=h.onload=o,document.head.appendChild(h)}return Promise.all(e)},s.m=t,s.c=r,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(n,r,function(e){return t[e]}.bind(null,r));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/dist/",s.oe=function(t){throw console.error(t),t};var h=window.webpackJsonp=window.webpackJsonp||[],c=h.push.bind(h);h.push=e,h=h.slice();for(var u=0;u<h.length;u++)e(h[u]);var a=c;o.push([10,2]),n()}({10:function(t,e,n){"use strict";n.r(e);var r=n(1),i=n(2),o=n(3);const s=2,h=255,c=0,u=0,a=255,d=1,l=65535;class k{constructor(t,e,n,r){this.red=this.checkColorComponent(t),this.green=this.checkColorComponent(e),this.blue=this.checkColorComponent(n),this.alpha=this.checkColorComponent(r)}clone(){return new k(this.red,this.green,this.blue,this.alpha)}getRGBHex(){return this.asHex(this.red)+this.asHex(this.green)+this.asHex(this.blue)}getRGBAHex(){return this.getRGBHex()+this.asHex(this.alpha)}checkColorComponent(t){if(t<0||t>255)throw new Error("PdfColor out of range");return Math.floor(t)}asHex(t){return t<16?"0"+t.toString(16):t.toString(16)}}class g{constructor(t,e){this.width=t,this.color=e.clone(),this.rgbHex="#"+this.color.getRGBHex()}clone(){return new g(this.width,this.color)}getWidth(){return this.width}getColor(){return this.rgbHex}setColor(t,e,n,r=255){this.color=new k(t,e,n,r),this.rgbHex="#"+this.color.getRGBHex()}getAsDataObject(){return{width:this.width,color:{r:this.color.red,g:this.color.green,b:this.color.blue}}}}class f{constructor(){this.isInitialized=!1}addPoint(t){this.isInitialized?(this.left=Math.min(this.left,t.x),this.right=Math.max(this.right,t.x),this.top=Math.min(this.top,t.y),this.bottom=Math.max(this.bottom,t.y)):this.setRect(t.x,t.y,t.x,t.y)}addRect(t){this.isInitialized?(this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom)):this.setRect(t.left,t.top,t.right,t.bottom)}getRect(){return this.isInitialized?{left:this.left,top:this.top,right:this.right+1,bottom:this.bottom+1}:{left:0,top:0,right:0,bottom:0}}setRect(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r,this.isInitialized=!0}}class S{constructor(t,e){this.x=t,this.y=e}}class b{constructor(t,e,n){this.controlPoint1=new S(t.x,t.y),this.controlPoint2=new S(e.x,e.y),this.endPoint=new S(n.x,n.y)}}class p{constructor(){this.bezierSegments=[],this.bezierStartPoint=null}updateBezierCurveData(t,e){if(null===this.bezierStartPoint){const e=t.get(0);this.bezierStartPoint=new S(e.cp0.x,e.cp0.y)}e<0&&this.bezierSegments.splice(e);for(let e=0;e<t.size();e++){const n=t.get(e);this.bezierSegments.push(this.convertInkSegmentToBezierSegment(n))}}getAsDataObject(){return{bezierStartPoint:this.bezierStartPoint,bezierSegments:this.bezierSegments}}hasData(){return this.bezierSegments.length>0&&null!==this.bezierStartPoint}convertInkSegmentToBezierSegment(t){return new b(t.cp1,t.cp2,t.cp3)}}class m{constructor(t,e,n){this.inkPoints=[],this.strokeId=t,this.inkPoints=[n],this.inkAttributes=e.clone(),this.boundingRect=new f,this.boundingRect.addPoint(n),this.inkRenderingSegments=new p}addPoint(t){this.inkPoints.push(t),this.boundingRect.addPoint(t)}getBoundingRect(){return this.boundingRect.getRect()}getAsDataObject(){return{inkStrokeId:this.strokeId,inkPoints:this.inkPoints,inkAttributes:this.inkAttributes.getAsDataObject(),inkRenderingSegments:this.inkRenderingSegments.getAsDataObject()}}}class w{constructor(){this.nextStrokeId=d,this.currentStroke=null,this.wetStrokes=new Map,this.currentInkAttributes=new g(s,new k(h,c,u,a))}beginStroke(t){if(null!==this.currentStroke)throw new Error("PdfWetInk beginStroke - previous stroke incomplete");this.currentStroke=new m